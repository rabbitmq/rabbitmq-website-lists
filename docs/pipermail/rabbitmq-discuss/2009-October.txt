From suhail at mixpanel.com  Thu Oct  1 21:03:58 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Thu, 1 Oct 2009 13:03:58 -0700
Subject: [rabbitmq-discuss] RabbitMQ throughput
Message-ID: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com>

Does anyone know what rabbitmq throughput is from items sitting in the queue
to sending them to a consumer?
Lets say we're doing 200 items in the queue a second with 50 consumers
waiting to process the item, usually they do in < 30ms. Watching our
consumer logs, it feels like they don't get items fast enough from rabbitmq,
is that possible or is it me?

I am going to try adding another rabbit queue today to distribute it and see
if it churns through faster.

Suhail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091001/a72bbf38/attachment.htm 

From matthias at lshift.net  Thu Oct  1 21:32:43 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 01 Oct 2009 21:32:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com>
Message-ID: <4AC511EB.30702@lshift.net>

Suhail,

Suhail Doshi wrote:
> Does anyone know what rabbitmq throughput is from items sitting in the 
> queue to sending them to a consumer?
> 
> Lets say we're doing 200 items in the queue a second with 50 consumers 
> waiting to process the item, usually they do in < 30ms.

So that's ~7kHz, which doesn't look unreasonable, but there are many 
factors at play here which we'd need to know about in order to make a 
better assessment:

- are these messages persistent or transient?
- how big are the messages?
- do the consumer consume in no-ack mode, or ack mode?
- are the consumers sharing a connection (or even channel) or do they 
all have their separate connection/channel?
- where are the consumers in the network topology in relation to the server?
- what's the hardware spec of the server machine?
- what version of Erlang are you running?
- what AMQP client are you using?

Also, ...

> Watching our consumer logs, it feels like they don't get items fast
> enough from rabbitmq, is that possible or is it me?

Can you instrument the consumers to measure how long they are blocked 
waiting for messages from RabbitMQ?

Also, with 200 messages shared across 50 consumers each consumer will 
only get four items, which is a rather small figure to do any meaningful 
statistical analysis with.


Regards,

Matthias.



From suhail at mixpanel.com  Thu Oct  1 21:40:50 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Thu, 1 Oct 2009 13:40:50 -0700
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <4AC511EB.30702@lshift.net>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com> 
	<4AC511EB.30702@lshift.net>
Message-ID: <376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com>

On Thu, Oct 1, 2009 at 1:32 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Suhail,
>
> Suhail Doshi wrote:
>
>> Does anyone know what rabbitmq throughput is from items sitting in the
>> queue to sending them to a consumer?
>>
>> Lets say we're doing 200 items in the queue a second with 50 consumers
>> waiting to process the item, usually they do in < 30ms.
>>
>
> So that's ~7kHz, which doesn't look unreasonable, but there are many
> factors at play here which we'd need to know about in order to make a better
> assessment:
>
> - are these messages persistent or transient? Persistent

- how big are the messages? Less than 500 bytes usually
> - do the consumer consume in no-ack mode, or ack mode? ack mode
> - are the consumers sharing a connection (or even channel) or do they all
> have their separate connection/channel? do not share a channel/connection
> - where are the consumers in the network topology in relation to the
> server? very close, same rack presumably
> - what's the hardware spec of the server machine? quad core, 4 GB of RAM
> - what version of Erlang are you running? 5.7.2
> - what AMQP client are you using? Python library created by Barry Pederson
>
> Also, ...
>
>  Watching our consumer logs, it feels like they don't get items fast
>> enough from rabbitmq, is that possible or is it me?
>>
>
> Can you instrument the consumers to measure how long they are blocked
> waiting for messages from RabbitMQ? Yes possibly, I should check you're
> right.
>
> Also, with 200 messages shared across 50 consumers each consumer will only
> get four items, which is a rather small figure to do any meaningful
> statistical analysis with.
>
>
> Regards,
>
> Matthias.
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091001/c60b6a4d/attachment.htm 

From suhail at mixpanel.com  Thu Oct  1 21:49:46 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Thu, 1 Oct 2009 13:49:46 -0700
Subject: [rabbitmq-discuss] rabbitmq clustering
Message-ID: <376f3e6f0910011349w2947bd8bp262642c6d7e34c22@mail.gmail.com>

One that was unclear to me in the clustering documentation is how you setup
consumers to work with clusters or if there even is any setup?
Does the consumer need to be aware of all the nodes in a cluster?
If not does the consumer just need to be hooked up to the node that the
other nodes are clustered around and things are automatically load balanced?

My consumers are connected to a single node right now, so is my producer. If
add nodes and cluster them around this node will rabbitmq handle all the
load balancing?

This seems a bit to magical to me and seems like both producers and
consumers would need to be aware of the nodes.

I am using the AMQP python lib

Suhail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091001/aa7046e0/attachment.htm 

From suhail at mixpanel.com  Thu Oct  1 21:56:35 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Thu, 1 Oct 2009 13:56:35 -0700
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com> 
	<4AC511EB.30702@lshift.net>
	<376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com>
Message-ID: <376f3e6f0910011356r5e9ffa70rbc89eed942c0d404@mail.gmail.com>

Turns out I already output info to basically notice if the consumer is
blocking:
2009-10-01 20:55:27,935 INFO [id: 99704402] Processing complete,
acknowledged.
2009-10-01 20:55:27,939 INFO [id: 99704402] Received queue item,
processing...

2009-10-01 20:55:29,215 INFO [id: 99704402] Processing complete,
acknowledged.
2009-10-01 20:55:29,215 INFO [id: 99704402] Received queue item,
processing...

You'll notice there's a gap between receiving and processing so that means
the consumer is just waiting for an item. So it really does look like
rabbitmq is not able to get items to me fast enough with lots of items
backed in the queue.

Suhail

On Thu, Oct 1, 2009 at 1:40 PM, Suhail Doshi <suhail at mixpanel.com> wrote:

>
>
> On Thu, Oct 1, 2009 at 1:32 PM, Matthias Radestock <matthias at lshift.net>wrote:
>
>> Suhail,
>>
>> Suhail Doshi wrote:
>>
>>> Does anyone know what rabbitmq throughput is from items sitting in the
>>> queue to sending them to a consumer?
>>>
>>> Lets say we're doing 200 items in the queue a second with 50 consumers
>>> waiting to process the item, usually they do in < 30ms.
>>>
>>
>> So that's ~7kHz, which doesn't look unreasonable, but there are many
>> factors at play here which we'd need to know about in order to make a better
>> assessment:
>>
>> - are these messages persistent or transient? Persistent
>
> - how big are the messages? Less than 500 bytes usually
>> - do the consumer consume in no-ack mode, or ack mode? ack mode
>> - are the consumers sharing a connection (or even channel) or do they all
>> have their separate connection/channel? do not share a channel/connection
>> - where are the consumers in the network topology in relation to the
>> server? very close, same rack presumably
>> - what's the hardware spec of the server machine? quad core, 4 GB of RAM
>> - what version of Erlang are you running? 5.7.2
>> - what AMQP client are you using? Python library created by Barry Pederson
>>
>> Also, ...
>>
>>  Watching our consumer logs, it feels like they don't get items fast
>>> enough from rabbitmq, is that possible or is it me?
>>>
>>
>> Can you instrument the consumers to measure how long they are blocked
>> waiting for messages from RabbitMQ? Yes possibly, I should check you're
>> right.
>>
>> Also, with 200 messages shared across 50 consumers each consumer will only
>> get four items, which is a rather small figure to do any meaningful
>> statistical analysis with.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091001/dccafcca/attachment.htm 

From matthias at lshift.net  Thu Oct  1 22:19:52 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 01 Oct 2009 22:19:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com>
	<4AC511EB.30702@lshift.net>
	<376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com>
Message-ID: <4AC51CF8.80200@lshift.net>

Suhail,

Suhail Doshi wrote:
>     Persistent, ack mode 

in which case 7KHz outbound is quite reasonable. For comparison, I 
suggest you try transient messages, and no-ack mode.

> So it really does look like rabbitmq is not able to get items to me
> fast enough with lots of items backed in the queue.

You mentioned 200 items, which really isn't a lot.

How fast is "fast enough"? You have *50* consumers draining from a 
single queue. No matter how fast rabbit is, if you add enough consumers 
eventually rabbit won't be able to keep them all busy.


Regards,

Matthias.



From temijun at gmail.com  Thu Oct  1 23:52:40 2009
From: temijun at gmail.com (Sammy Yu)
Date: Thu, 1 Oct 2009 15:52:40 -0700
Subject: [rabbitmq-discuss] Overriding node long name
Message-ID: <6bd5d4070910011552k72e43b3bsafd416406c1b6462@mail.gmail.com>

Hi,
   I would like to use -name (long name) option so that I can set
something along the lines of rabbit@<ip address> rather than
rabbit@<hostname>.  Is it possible to do this?  I think I read
somewhere this is not possible because of some erlang limitation, when
I try it I get this error:
{error_logger,{{2009,10,1},{15,50,38}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2009,10,1},{15,50,38}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.22.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,505}],[]]}
{error_logger,{{2009,10,1},{15,50,38}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2009,10,1},{15,50,38}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2009,10,1},{15,50,38}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Thanks,
Sammy

Thanks,
Sammy



From suhail at mixpanel.com  Fri Oct  2 00:03:11 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Thu, 1 Oct 2009 16:03:11 -0700
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <4AC51CF8.80200@lshift.net>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com> 
	<4AC511EB.30702@lshift.net>
	<376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com> 
	<4AC51CF8.80200@lshift.net>
Message-ID: <376f3e6f0910011603m256d8ce6o8b1db4a369d658c9@mail.gmail.com>

On Thu, Oct 1, 2009 at 2:19 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Suhail,
>
> Suhail Doshi wrote:
>
>>    Persistent, ack mode
>>
>
> in which case 7KHz outbound is quite reasonable. For comparison, I suggest
> you try transient messages, and no-ack mode.
>
>  So it really does look like rabbitmq is not able to get items to me
>> fast enough with lots of items backed in the queue.
>>
>
> You mentioned 200 items, which really isn't a lot.
>

200 items per second isn't a lot?

>
> How fast is "fast enough"? You have *50* consumers draining from a single
> queue. No matter how fast rabbit is, if you add enough consumers eventually
> rabbit won't be able to keep them all busy.
>
> My expectation is that rabbit should push a new item to my consumer once
that consumer has ACKed a message in less than 100ms


>
> Regards,
>
> Matthias.
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091001/8b5c9134/attachment.htm 

From tsuraan at gmail.com  Fri Oct  2 02:44:53 2009
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 1 Oct 2009 20:44:53 -0500
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <376f3e6f0910011603m256d8ce6o8b1db4a369d658c9@mail.gmail.com>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com>
	<4AC511EB.30702@lshift.net>
	<376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com>
	<4AC51CF8.80200@lshift.net>
	<376f3e6f0910011603m256d8ce6o8b1db4a369d658c9@mail.gmail.com>
Message-ID: <84fb38e30910011844p3cb7e9dbgb513561802b60c75@mail.gmail.com>

>> How fast is "fast enough"? You have *50* consumers draining from a single
>> queue. No matter how fast rabbit is, if you add enough consumers
>> eventually
>> rabbit won't be able to keep them all busy.
>>
>> My expectation is that rabbit should push a new item to my consumer once
> that consumer has ACKed a message in less than 100ms

Out of curiosity, are you using basic_get, or basic_consume?  I've
found that basic_get has performance like that, whereas basic_consume
is at least 10x faster.  I'm also using persistent messages with
explicit ack (in transactional mode), and using Barry's python library
I get in the 1k - 10k messages/second range on hardware that isn't any
better than yours.



From gmr at myyearbook.com  Fri Oct  2 02:56:48 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 1 Oct 2009 21:56:48 -0400
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <84fb38e30910011844p3cb7e9dbgb513561802b60c75@mail.gmail.com>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com> 
	<4AC511EB.30702@lshift.net>
	<376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com> 
	<4AC51CF8.80200@lshift.net>
	<376f3e6f0910011603m256d8ce6o8b1db4a369d658c9@mail.gmail.com> 
	<84fb38e30910011844p3cb7e9dbgb513561802b60c75@mail.gmail.com>
Message-ID: <af1bce590910011856n63b7b674u1d53fcfb2f981a6c@mail.gmail.com>

On Thu, Oct 1, 2009 at 9:44 PM, tsuraan <tsuraan at gmail.com> wrote:
>
> Out of curiosity, are you using basic_get, or basic_consume?  I've
> found that basic_get has performance like that, whereas basic_consume
> is at least 10x faster.  I'm also using persistent messages with
> explicit ack (in transactional mode), and using Barry's python library
> I get in the 1k - 10k messages/second range on hardware that isn't any
> better than yours.


I have to second this sentiment about basic_consume vs basic_get.  The
performance of basic_get is terrible to be honest, it also does not scale
across multiple consumers.

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091001/8fd8e714/attachment.htm 

From suhail at mixpanel.com  Fri Oct  2 05:31:05 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Thu, 1 Oct 2009 21:31:05 -0700
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <af1bce590910011856n63b7b674u1d53fcfb2f981a6c@mail.gmail.com>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com> 
	<4AC511EB.30702@lshift.net>
	<376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com> 
	<4AC51CF8.80200@lshift.net>
	<376f3e6f0910011603m256d8ce6o8b1db4a369d658c9@mail.gmail.com> 
	<84fb38e30910011844p3cb7e9dbgb513561802b60c75@mail.gmail.com> 
	<af1bce590910011856n63b7b674u1d53fcfb2f981a6c@mail.gmail.com>
Message-ID: <376f3e6f0910012131u6d8f5febyaabd023d43e383d6@mail.gmail.com>

I use basic_consume and basic_ack
Suhail

On Thu, Oct 1, 2009 at 6:56 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

>
> On Thu, Oct 1, 2009 at 9:44 PM, tsuraan <tsuraan at gmail.com> wrote:
>>
>> Out of curiosity, are you using basic_get, or basic_consume?  I've
>> found that basic_get has performance like that, whereas basic_consume
>> is at least 10x faster.  I'm also using persistent messages with
>> explicit ack (in transactional mode), and using Barry's python library
>> I get in the 1k - 10k messages/second range on hardware that isn't any
>> better than yours.
>
>
> I have to second this sentiment about basic_consume vs basic_get.  The
> performance of basic_get is terrible to be honest, it also does not scale
> across multiple consumers.
>
> Regards,
>
> Gavin
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091001/26d38a43/attachment.htm 

From akalend at mail.ru  Fri Oct  2 07:49:56 2009
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Fri, 02 Oct 2009 10:49:56 +0400
Subject: [rabbitmq-discuss] RabbitMQ Statistic API
In-Reply-To: <376f3e6f0910012131u6d8f5febyaabd023d43e383d6@mail.gmail.com>
References: <376f3e6f0910012131u6d8f5febyaabd023d43e383d6@mail.gmail.com>
Message-ID: <E1Mtbxk-0006Wp-00.akalend-mail-ru@f12.mail.ru>

I develope the large social network and will to use RabbitMQ for consumering and "What is new from friends". I't very well if RabbitMQ will to have the the  statistic API for administration:
- the list of queue ( the list queue where is messages more than ... )
the 
- the list of exchanges ( the list of exchanges where last messages was published till ...)
- list bindings 
- usage memory
- count messages per day/hour
- max/average messages into queue

It is very usefull for optimization of use, garbage of old queues, exchanges, etc

The using rabbitmqctl dont  not allow automatization of administrative.


Alexandre. 



From akalend at mail.ru  Fri Oct  2 07:53:48 2009
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Fri, 02 Oct 2009 10:53:48 +0400
Subject: [rabbitmq-discuss] Russian discussion group in Google
Message-ID: <E1Mtc1U-0008O2-00.akalend-mail-ru@f39.mail.ru>

The russian language discussion group RabbitMQ_rus  is http://groups.google.com/group/rabbitmq_rus?lnk=iggc

Alexandre



From matthias at lshift.net  Fri Oct  2 08:27:08 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 02 Oct 2009 08:27:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ throughput
In-Reply-To: <376f3e6f0910011603m256d8ce6o8b1db4a369d658c9@mail.gmail.com>
References: <376f3e6f0910011303n5efb11a2lf35803bbca00d326@mail.gmail.com>
	<4AC511EB.30702@lshift.net>	<376f3e6f0910011340r48d15247m2e529c19e3b07c65@mail.gmail.com>
	<4AC51CF8.80200@lshift.net>
	<376f3e6f0910011603m256d8ce6o8b1db4a369d658c9@mail.gmail.com>
Message-ID: <4AC5AB4C.4080406@lshift.net>

Suhail,

Suhail Doshi wrote:
> 200 items per second isn't a lot? 

I misread your original post. I thought you said there were 200 items in 
the queue that the 50 consumers are then draining in 30ms, whereas 
actually you were saying that messages get published to the queue at a 
rate of 200Hz (which still isn't a lot) and you have 50 consumers which 
take <30ms to process each item. Right?

> My expectation is that rabbit should push a new item to my consumer once 
> that consumer has ACKed a message in less than 100ms

Are you using qos? Only with qos will rabbit wait for the acks before 
sending more messages; otherwise it will just keep sending them.

Also, are you using tx mode on either the publishing or consuming side? 
Depending on the size of the transactions that can slow things down 
significantly since a tx commit is forced to wait for a disk fsync.

Also, how long does the queue get?

As others have said, if you have things set up correctly you should be 
able to see a throughput of thousands of Hz.


Regards,

Matthias.



From matthias at lshift.net  Fri Oct  2 08:38:05 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 02 Oct 2009 08:38:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ Statistic API
In-Reply-To: <E1Mtbxk-0006Wp-00.akalend-mail-ru@f12.mail.ru>
References: <376f3e6f0910012131u6d8f5febyaabd023d43e383d6@mail.gmail.com>
	<E1Mtbxk-0006Wp-00.akalend-mail-ru@f12.mail.ru>
Message-ID: <4AC5ADDD.6030305@lshift.net>

Alexandre,

Alexandre Kalendarev wrote:
> I't very well if RabbitMQ will to have the the  statistic API for administration:
> - the list of queue ( the list queue where is messages more than ... )

'rabbitmqctl list_queues' shows queues and their message counts. It 
takes just a little bit of post-processing to produce results like 
"total message count", "top ten queues", "queues with more than X 
messages", etc.

> - the list of exchanges ( the list of exchanges where last messages was published till ...)

You can certainly get the list of the exchanges ('rabbitmqctl 
list_exchanges'), but no stats. Stats on exchanges would be tricky to 
implement w/o impacting performance - atm they are completely stateless.

> - list bindings

'rabbitmqctl list_bindings'

> - usage memory

You can get the queue memory with 'rabbitmqctl list_queues', though that 
doesn't necessarily include messages since they may be shared between 
queues. For total Erlang memory usage, the operating system has plenty 
of commands and utilities to give you accurate figures.

> - count messages per day/hour
> - max/average messages into queue

These, and a whole bunch of other stats, are on our todo list.


Regards,

Matthias.



From akalend at mail.ru  Fri Oct  2 10:44:13 2009
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Fri, 02 Oct 2009 13:44:13 +0400
Subject: [rabbitmq-discuss] productivity RabbitMQ
In-Reply-To: <4AC5ADDD.6030305@lshift.net>
References: <4AC5ADDD.6030305@lshift.net>
Message-ID: <E1MtegP-0007Ak-00.akalend-mail-ru@f5.mail.ru>


Hi All,

I develope the large social network and plane to use RabbitMQ for delivery blog news. I see some problem:  If in social network logining super popular user ( Madonna or Britni for example), the very match Admirers of Star will to receive very match messages. The prospective loading the 200 000 consumers in one time to one stars. The all consumers is prospective near 10 000 000. 
 
Whether will consult RabbitMq (or clauster) will cope with this loading?


Alexandre



From alexis.richardson at gmail.com  Fri Oct  2 11:06:32 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 2 Oct 2009 11:06:32 +0100
Subject: [rabbitmq-discuss] Russian discussion group in Google
In-Reply-To: <E1Mtc1U-0008O2-00.akalend-mail-ru@f39.mail.ru>
References: <E1Mtc1U-0008O2-00.akalend-mail-ru@f39.mail.ru>
Message-ID: <167204d20910020306m70ec1e5dtc6a61eb8179b19f0@mail.gmail.com>

Toje govoritye po-rabbitu?

Thanks for setting this up Alexandre.

alexis


On Fri, Oct 2, 2009 at 7:53 AM, Alexandre Kalendarev <akalend at mail.ru> wrote:
> The russian language discussion group RabbitMQ_rus ?is http://groups.google.com/group/rabbitmq_rus?lnk=iggc
>
> Alexandre
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From suhail at mixpanel.com  Fri Oct  2 11:41:33 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Fri, 2 Oct 2009 03:41:33 -0700
Subject: [rabbitmq-discuss] rabbitmq erlang client
Message-ID: <376f3e6f0910020341x5c384e87lece3fdb75d72ad21@mail.gmail.com>

Getting the following crasher:

=SUPERVISOR REPORT==== 2-Oct-2009::03:40:40 ===
     Supervisor: {local,metrics_sup}
     Context:    start_error
     Reason:     {'EXIT',
                     {{badmatch,
                          {error,
                              {undef,
                                  [{rabbit_framing_channel,start_link,

[#Fun<amqp_network_driver.0.121542398>,
                                        [<0.52.0>]]},
                                   {amqp_network_driver,handshake,1},
                                   {amqp_connection,init,1},
                                   {gen_server,init_it,6},
                                   {proc_lib,init_p_do_apply,3}]}}},
                      [{amqp_connection,start,5},
                       {metrics_queue,amqp_lifecycle,0},
                       {metrics_web,start,1},
                       {supervisor,do_start_child,2},
                       {supervisor,start_children,3},
                       {supervisor,init_children,2},
                       {gen_server,init_it,6},
                       {proc_lib,init_p_do_apply,3}]}}
     Offender:   [{pid,undefined},
                  {name,metrics_web},
                  {mfa,
                      {metrics_web,start,
                          [[{ip,"0.0.0.0"},
                            {port,8000},
                            {docroot,


Any ideas?

-- Suail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091002/03b8cf26/attachment.htm 

From matthew at lshift.net  Fri Oct  2 11:50:39 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Oct 2009 11:50:39 +0100
Subject: [rabbitmq-discuss] rabbitmq erlang client
In-Reply-To: <376f3e6f0910020341x5c384e87lece3fdb75d72ad21@mail.gmail.com>
References: <376f3e6f0910020341x5c384e87lece3fdb75d72ad21@mail.gmail.com>
Message-ID: <20091002105039.GC30360@mrnibble.lshift.net>

Which version of the erlang client are you using and which version of
the broker are you using? The two tend to need to be very closely
related.

Matthew



From gmr at myyearbook.com  Fri Oct  2 13:03:25 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 2 Oct 2009 08:03:25 -0400
Subject: [rabbitmq-discuss] RabbitMQ Statistic API
In-Reply-To: <E1Mtbxk-0006Wp-00.akalend-mail-ru@f12.mail.ru>
References: <376f3e6f0910012131u6d8f5febyaabd023d43e383d6@mail.gmail.com> 
	<E1Mtbxk-0006Wp-00.akalend-mail-ru@f12.mail.ru>
Message-ID: <af1bce590910020503t3f7a8d37i8a33cd97e842fdd8@mail.gmail.com>

In addition to what Matthias pointed out, be sure to check out Alice:
http://github.com/auser/alice

On Fri, Oct 2, 2009 at 2:49 AM, Alexandre Kalendarev <akalend at mail.ru>wrote:

> I develope the large social network and will to use RabbitMQ for
> consumering and "What is new from friends". I't very well if RabbitMQ will
> to have the the  statistic API for administration:
> - the list of queue ( the list queue where is messages more than ... )
> the
> - the list of exchanges ( the list of exchanges where last messages was
> published till ...)
> - list bindings
> - usage memory
> - count messages per day/hour
> - max/average messages into queue
>
> It is very usefull for optimization of use, garbage of old queues,
> exchanges, etc
>
> The using rabbitmqctl dont  not allow automatization of administrative.
>
>
> Alexandre.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091002/264da743/attachment.htm 

From alexis.richardson at gmail.com  Fri Oct  2 14:13:47 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 2 Oct 2009 14:13:47 +0100
Subject: [rabbitmq-discuss] productivity RabbitMQ
In-Reply-To: <E1MtegP-0007Ak-00.akalend-mail-ru@f5.mail.ru>
References: <4AC5ADDD.6030305@lshift.net>
	<E1MtegP-0007Ak-00.akalend-mail-ru@f5.mail.ru>
Message-ID: <167204d20910020613o571a7372s6da5742c4047def1@mail.gmail.com>

Alexandre

Yes we have worked with others to design configurations able to do
this.  You need to think carefully about how to structure your
bindings.  A lot depends on what you think you need to persist, and to
what end.  For example you do not necessarily want to use one big
cluster.

But yes, this is possible with RabbitMQ.

alexis


On Fri, Oct 2, 2009 at 10:44 AM, Alexandre Kalendarev <akalend at mail.ru> wrote:
>
> Hi All,
>
> I develope the large social network and plane to use RabbitMQ for delivery blog news. I see some problem: ?If in social network logining super popular user ( Madonna or Britni for example), the very match Admirers of Star will to receive very match messages. The prospective loading the 200 000 consumers in one time to one stars. The all consumers is prospective near 10 000 000.
>
> Whether will consult RabbitMq (or clauster) will cope with this loading?
>
>
> Alexandre
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From akalend at mail.ru  Fri Oct  2 14:49:07 2009
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Fri, 02 Oct 2009 17:49:07 +0400
Subject: [rabbitmq-discuss] =?windows-1251?q?RabbitMQ_Statistic_API?=
In-Reply-To: <af1bce590910020503t3f7a8d37i8a33cd97e842fdd8@mail.gmail.com>
References: <af1bce590910020503t3f7a8d37i8a33cd97e842fdd8@mail.gmail.com>
Message-ID: <E1MtiVP-000498-00.akalend-mail-ru@f235.mail.ru>

Gavian,

> In addition to what Matthias pointed out, be sure to check out Alice:
> http://github.com/auser/alice


Thanks,
it is usefull links.


Alexandre.




From rtrlists at googlemail.com  Fri Oct  2 15:06:30 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Fri, 2 Oct 2009 15:06:30 +0100
Subject: [rabbitmq-discuss] Dynamically binding to a topic exchange without
	losing messages?
Message-ID: <6a3ae47e0910020706n3f91cd1ag3de6b98a5e2f6ec4@mail.gmail.com>

Hi,

I have a usage scenario that I am having a bit of trouble translating into
exchanges, queues and bindings. This is using the Erlang client.

I have a stream of messages that have the identifying characteristics <type>
and <id>. I would like to process these such that I can recognise a
particular <type>=START to indicate that all messages related to <id> that
follow are to be processed in some fashion by a new Erlang process.

So, I declare a topic exchange and bind a queue with the key 'START.*'. I
now get my "starter" messages, nice. My naive idea was to have this starter
create a new queue and bind it with key '*.ID' and then have a new Erlang
process work on the messages arriving there.

What I am trying to get my head around is, how can I quarantee that any
messages arriving for the new ID don't get lost while my starter process is
setting stuff up? For example, a message with key START.27 arrives, the
starter now sets up the new queue and binding against '*.27', but before
that is complete, a message with key X.27 got published (and potentially
lost).

One way I could see getting this to work, would be to have my starter
process read _all_ messages (not just the START ones), synchronously
starting the sub processes, and passing any non-starter messages to another
exchange where the sub-processes have bound their queues.

Somehow this "pass it along" approach seems a bit clunky to me. Is there a
more elegant way? Or, alternatively, does RabbitMQ Erlang Client have some
nice and easy functions to "consume message from here, look at it, and if
not for me, publish it to there"? It looks to me as if I need to transmit
the RoutingKey as part of the message, as it doesn't seem to be part of the
#content{} structure. But maybe I've missed something.

Thanks for any thoughts,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091002/2ed4ae49/attachment.htm 

From 0x6e6562 at gmail.com  Fri Oct  2 16:13:24 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 2 Oct 2009 16:13:24 +0100
Subject: [rabbitmq-discuss] Dynamically binding to a topic exchange
	without losing messages?
In-Reply-To: <6a3ae47e0910020706n3f91cd1ag3de6b98a5e2f6ec4@mail.gmail.com>
References: <6a3ae47e0910020706n3f91cd1ag3de6b98a5e2f6ec4@mail.gmail.com>
Message-ID: <269388e30910020813x7278839eme58c8f742c24b118@mail.gmail.com>

Robby,

On Fri, Oct 2, 2009 at 3:06 PM, Robert Raschke <rtrlists at googlemail.com> wrote:
> What I am trying to get my head around is, how can I quarantee that any
> messages arriving for the new ID don't get lost while my starter process is
> setting stuff up? For example, a message with key START.27 arrives, the
> starter now sets up the new queue and binding against '*.27', but before
> that is complete, a message with key X.27 got published (and potentially
> lost).

Don't know if this helps but if you're concerned about about messages
being binned, then you can set the mandatory flag when publishing the
message which will have the effect that if the message could not get
routed to at least one queue, it will be returned to the sender.

Ben



From pauljones23 at gmail.com  Fri Oct  2 16:32:41 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 2 Oct 2009 16:32:41 +0100
Subject: [rabbitmq-discuss] Dynamically binding to a topic exchange
	without losing messages?
In-Reply-To: <6a3ae47e0910020706n3f91cd1ag3de6b98a5e2f6ec4@mail.gmail.com>
References: <6a3ae47e0910020706n3f91cd1ag3de6b98a5e2f6ec4@mail.gmail.com>
Message-ID: <29598b610910020832g27c414bbyc4dad1e385f6aced@mail.gmail.com>

Hi Robert,

In terms of your application, is only one Erlang process every going to
process a given stream? Would it be possible to change the model slightly,
and in a start message send the name of a queue instead? That way your
producer could allocate a queue, connect it to that topic, and send out a
message telling consumers where to listen.

(Some might argue this violates some AMQP design principles though, since it
starts coupling the sender to the receiver more than you'd otherwise hope)

Paul.

On Fri, Oct 2, 2009 at 3:06 PM, Robert Raschke <rtrlists at googlemail.com>wrote:

> Hi,
>
> I have a usage scenario that I am having a bit of trouble translating into
> exchanges, queues and bindings. This is using the Erlang client.
>
> I have a stream of messages that have the identifying characteristics
> <type> and <id>. I would like to process these such that I can recognise a
> particular <type>=START to indicate that all messages related to <id> that
> follow are to be processed in some fashion by a new Erlang process.
>
> So, I declare a topic exchange and bind a queue with the key 'START.*'. I
> now get my "starter" messages, nice. My naive idea was to have this starter
> create a new queue and bind it with key '*.ID' and then have a new Erlang
> process work on the messages arriving there.
>
> What I am trying to get my head around is, how can I quarantee that any
> messages arriving for the new ID don't get lost while my starter process is
> setting stuff up? For example, a message with key START.27 arrives, the
> starter now sets up the new queue and binding against '*.27', but before
> that is complete, a message with key X.27 got published (and potentially
> lost).
>
> One way I could see getting this to work, would be to have my starter
> process read _all_ messages (not just the START ones), synchronously
> starting the sub processes, and passing any non-starter messages to another
> exchange where the sub-processes have bound their queues.
>
> Somehow this "pass it along" approach seems a bit clunky to me. Is there a
> more elegant way? Or, alternatively, does RabbitMQ Erlang Client have some
> nice and easy functions to "consume message from here, look at it, and if
> not for me, publish it to there"? It looks to me as if I need to transmit
> the RoutingKey as part of the message, as it doesn't seem to be part of the
> #content{} structure. But maybe I've missed something.
>
> Thanks for any thoughts,
> Robby
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091002/20160296/attachment.htm 

From rtrlists at googlemail.com  Fri Oct  2 17:09:23 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Fri, 2 Oct 2009 17:09:23 +0100
Subject: [rabbitmq-discuss] Dynamically binding to a topic exchange
	without losing messages?
In-Reply-To: <29598b610910020832g27c414bbyc4dad1e385f6aced@mail.gmail.com>
References: <6a3ae47e0910020706n3f91cd1ag3de6b98a5e2f6ec4@mail.gmail.com>
	<29598b610910020832g27c414bbyc4dad1e385f6aced@mail.gmail.com>
Message-ID: <6a3ae47e0910020909t3d68f282vf16e14cc90d6dd6e@mail.gmail.com>

Ben and Paul, thanks for your thoughts.

My producer is generating a constant stream of messages with keys Type.Id,
where the Type is one of a few hundred possible values and the Id identifies
is an entity where something of that Type just happened. More concretely, in
a trouble ticketing system for example, tickets have an Id and they
constantly get updated with stuff of a certain Type.

After a particular Type of update, I need to start processing all following
updates on the ticket with the given Id, up until some kind of "stop" update
happens.

So I was thinking of having one process per ticket that needs monitored
(~1000 at any one time). But the producer doesn't know which ones will get
monitored. And I have to ignore all messages that are not of type "start
monitoring" and aren't currently monitored by a process. Thus I can't use
the mandatory flag either.

I'll try playing with the "look and forward" approach to see how awkward
it'll be.

Thanks,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091002/c07cc706/attachment.htm 

From temijun at gmail.com  Fri Oct  2 20:56:21 2009
From: temijun at gmail.com (Sammy Yu)
Date: Fri, 2 Oct 2009 12:56:21 -0700
Subject: [rabbitmq-discuss] Adding new nodes to a cluster
Message-ID: <6bd5d4070910021256q52a9d1dftb4990834714d7620@mail.gmail.com>

Hi guys,
   I've getting my rabbitmq cluster setup.  I noticed in the
documentation there was reference to two different kinds of nodes, a
ram and disk node and it seems to infer that there can only be one ram
node and N disk nodes.  My understanding is that the ram node has no
persistent information about the other nodes whereas the disk node
does.  What's the reasoning behind the constraint and why is it it
necessary to have a ram node (I'm assuming there are some performance
implications)?   Also is it true that the output of the first node
listed in rabbitmqctl status is the ram node?  So given the following
output:
 {nodes,[rabbit at rabbit1,rabbit at rabbit2,rabbit at rabbit3]},
We can assume that rabbit1 is the ram node and rabbit2 and rabbit3 are
disk nodes.

Thanks,
Sammy



From temijun at gmail.com  Sat Oct  3 01:43:40 2009
From: temijun at gmail.com (Sammy Yu)
Date: Fri, 2 Oct 2009 17:43:40 -0700
Subject: [rabbitmq-discuss] IP address of clustered rabbitmq in
	Connection.redirect reponse
Message-ID: <6bd5d4070910021743i3c894678wb9d76b914f43ff1@mail.gmail.com>

Hey guys,
   I'm running in an environment with broken DNS server, so I've been
using inetrc to get clustering working.  However on the client side
when I try to connect (insist=False), I get a connection.redirect with
hostname of the other the nodes, is it possible to get it to return IP
instead?

Thanks,
Sammy



From brian at echonest.com  Sun Oct  4 14:03:28 2009
From: brian at echonest.com (Brian Whitman)
Date: Sun, 4 Oct 2009 09:03:28 -0400
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
	including swap, dying
Message-ID: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>

Hi, we're using 184cb96f7846+ (bug20980) and our host alerted us that rabbit
was eating up all available swap on a 16GB real + 8GB swap machine.

"""
PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  SWAP COMMAND
18445 rabbitmq  18   0 24.7g  14g 1696 S 1087.1 91.7   2268:18  10g beam.smp

In an effort to prevent kernel panic, we restarted the rabbitmq service,
freeing up a considerable amount of swap:

However, the rabbitmq server is not starting again as expected, due to the
following exception:

2009-10-04 06:26:29.797201500 {"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_disk_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
"""

They had to delete the mnesia folder (losing all our disk-backed queues) and
restart\, now it's fine. I would guess that this breakage coincided with us
storing quite a large number of unacked messages in the queues (job
instructions for a very large batch)

a) Would upgrading this branch fix this? We were avoiding doing so because
things were relatively stable.

b) is there anything else I can look at to debug? The logs don't have
anything of importance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091004/a1ddc7e7/attachment.htm 

From suhail at mixpanel.com  Sun Oct  4 20:43:15 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Sun, 4 Oct 2009 12:43:15 -0700
Subject: [rabbitmq-discuss] Producer eating up RAM
Message-ID: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com>

I had this problem earlier today and it seems to continue:
I have rabbitmq working great and the producer alongside but then out of
nowhere all of a sudden the producer consumes my complete 4 GB of RAM all at
once causing swapping to occur amongst other things.

Any ideas why my producer would suddenly jump and consume all the RAM
available? I am getting a serious amount of volume of items hitting the
queue.

I run rabbitmq in persistence alongside with the producer and using acking
for my producers.

Suhail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091004/b91659da/attachment.htm 

From 0x6e6562 at gmail.com  Sun Oct  4 22:17:57 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 4 Oct 2009 22:17:57 +0100
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com>
Message-ID: <269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com>

Suhail,

On Sun, Oct 4, 2009 at 8:43 PM, Suhail Doshi <suhail at mixpanel.com> wrote:
> Any ideas why my producer would suddenly jump and consume all the RAM
> available? I am getting a serious amount of volume of items hitting the
> queue.

In general, a producer is a client process running outside of
RabbitMQ, so it is difficult to see how RabbitMQ is affecting the
memory consumption of this process. Maybe you can post a cut down
version of your producer application that reproduces the symptoms.

Ben



From suhail at mixpanel.com  Mon Oct  5 02:03:48 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Sun, 4 Oct 2009 18:03:48 -0700
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com> 
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com>
Message-ID: <376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com>

Problem is, it only happens every 5+ hours and not sure how to duplicate it
but here is a crash dump:
=erl_crash_dump:0.1
Sat Oct  3 20:18:09 2009
Slogan: eheap_alloc: Cannot allocate 6960012640 bytes of memory (of type
"heap").
System version: Erlang R13B01 (erts-5.7.2) [source] [64-bit] [smp:4:4]
[rq:4] [async-threads:0] [hipe] [kernel-poll:false]
Compiled: Tue Jun 23 19:56:26 2009
Atoms: 7552
=memory
total: 11040213416
processes: 10989180488
processes_used: 10989135536
system: 51032928
atom: 507961
atom_used: 494181
binary: 43474800
code: 4668039
ets: 311600
=hash_table:atom_tab
size: 4813
used: 3776
objs: 7552
depth: 8
=index_table:atom_tab
size: 8192
limit: 1048576
entries: 7552
=hash_table:module_code
size: 97
used: 71
objs: 119
depth: 4
=index_table:module_code
size: 1024
limit: 65536
entries: 119
=hash_table:export_list
size: 2411
used: 1770
objs: 3269
depth: 8
=index_table:export_list
size: 4096
limit: 65536
entries: 3269
=hash_table:secondary_export_table
size: 97
used: 0
objs: 0
depth: 0
=hash_table:process_reg
size: 47
used: 31
objs: 43
depth: 4
=hash_table:fun_table
size: 397
used: 301
objs: 566
depth: 6
=hash_table:node_table
size: 11
used: 1
objs: 1
depth: 1
=hash_table:dist_table
size: 11
used: 1
objs: 1
depth: 1
=allocated_areas
sys_misc: 80890
static: 991232
atom_space: 98328 84868
atom_table: 104153
module_table: 9084
export_table: 52172
register_table: 468
fun_table: 3266
module_refs: 2048
loaded_code: 4228461
dist_table: 507
node_table: 227
bits_bufs_size: 0
bif_timer: 80192
link_lh: 0
proc: 75296 39952
atom_entry: 305480 305160
export_entry: 316248 315192
module_entry: 7784 7720
reg_proc: 2480 1800
atom_entry: 305480 305160
export_entry: 316248 315192
module_entry: 7784 7720
reg_proc: 2480 1800
monitor_sh: 4400 512
nlink_sh: 11368 6328
fun_entry: 51328 50096
db_tab: 6624 5640
driver_event_data_state: 56 56
driver_select_data_state: 1352 200
=allocator:sys_alloc
option e: true
option m: libc
option tt: 131072
option tp: 0
=allocator:temp_alloc[0]
versions: 2.1 2.2
option e: true
option t: false
option ramv: false
option sbct: 524288
option asbcst: 4145152
option rsbcst: 90
option rsbcmt: 80
option rmbcmt: 100
option mmbcs: 131072
option mmsbc: 256
option mmmbc: 10
option lmbcs: 10485760
option smbcs: 1048576
option mbcgs: 10
option mbsd: 3
option as: gf
mbcs blocks: 0 136 136
mbcs blocks size: 0 46568 46568
mbcs carriers: 1 1 1
mbcs mseg carriers: 0
mbcs sys_alloc carriers: 1
mbcs carriers size: 131112 131112 131112
mbcs mseg carriers size: 0
mbcs sys_alloc carriers size: 131112
sbcs blocks: 0 0 0
sbcs blocks size: 0 0 0
sbcs carriers: 0 0 0
sbcs mseg carriers: 0


On Sun, Oct 4, 2009 at 2:17 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Suhail,
>
> On Sun, Oct 4, 2009 at 8:43 PM, Suhail Doshi <suhail at mixpanel.com> wrote:
> > Any ideas why my producer would suddenly jump and consume all the RAM
> > available? I am getting a serious amount of volume of items hitting the
> > queue.
>
> In general, a producer is a client process running outside of
> RabbitMQ, so it is difficult to see how RabbitMQ is affecting the
> memory consumption of this process. Maybe you can post a cut down
> version of your producer application that reproduces the symptoms.
>
> Ben
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091004/5364b86e/attachment.htm 

From suhail at mixpanel.com  Mon Oct  5 02:08:02 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Sun, 4 Oct 2009 18:08:02 -0700
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com> 
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com> 
	<376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com>
Message-ID: <376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com>

Here's part of the queue code we use:
-export([amqp_lifecycle/0, send_message/5, log/2]).

-include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit.hrl").
-include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit_framing.hrl").
-include("rabbitmq-erlang-client/include/amqp_client.hrl").

-record(rabbit_info, {channel, ticket, exchange, routing_key}).

amqp_lifecycle() ->
    User = "user",
    Password = "pass",
    Realm = <<"realm">>, %% virtual_host
    Connection = amqp_connection:start(User, Password, "127.0.0.1", Realm),
    Channel = amqp_connection:open_channel(Connection),
    Access = #'access.request'{
        realm = Realm,
        exclusive = false,
        passive = true,
        active = true,
        write = true,
        read = true
    },
    #'access.request_ok'{ticket = Ticket} = amqp_channel:call(Channel,
Access),

    Q = <<"q">>,
    X = <<"x">>,
    BindKey = <<"b">>,

    QueueDeclare = #'queue.declare'{ticket = Ticket, queue = Q,
                                    passive = false, durable = true,
                                    exclusive = false, auto_delete = false,
                                    nowait = false, arguments = []},

    #'queue.declare_ok'{queue = Q} = amqp_channel:call(Channel,
QueueDeclare),

    ExchangeDeclare = #'exchange.declare'{ticket = Ticket,
                                          exchange = X, type = <<"direct">>,
                                          passive = false, durable = true,
                                          auto_delete = false, internal =
false,
                                          nowait = false, arguments = []},

    #'exchange.declare_ok'{} = amqp_channel:call(Channel, ExchangeDeclare),
    QueueBind = #'queue.bind'{ticket = Ticket,
                              queue = Q,
                              exchange = X,
                              routing_key = BindKey,
                              nowait = false, arguments = []},
    #'queue.bind_ok'{} = amqp_channel:call(Channel, QueueBind),

    RabbitInfo = #'rabbit_info'{
        channel = Channel,
        ticket = Ticket,
        exchange = X,
        routing_key = BindKey
    },
    RabbitInfo.

send_message(Channel, Ticket, X, RoutingKey, Payload) ->
    BasicPublish = #'basic.publish'{ticket = Ticket,
                                    exchange = X,
                                    routing_key = RoutingKey,
                                    mandatory = false,
                                    immediate = false},
    BasicProperties = amqp_util:basic_properties(),
    Properties = BasicProperties#'P_basic'{delivery_mode=2}, %% Persistence
plz
    Content = #content{class_id = 60,
         properties = Properties,
         properties_bin = none,
         payload_fragments_rev = [Payload]
        },
    amqp_channel:cast(Channel, BasicPublish, Content).

On Sun, Oct 4, 2009 at 6:03 PM, Suhail Doshi <suhail at mixpanel.com> wrote:

> Problem is, it only happens every 5+ hours and not sure how to duplicate it
> but here is a crash dump:
> =erl_crash_dump:0.1
> Sat Oct  3 20:18:09 2009
> Slogan: eheap_alloc: Cannot allocate 6960012640 bytes of memory (of type
> "heap").
> System version: Erlang R13B01 (erts-5.7.2) [source] [64-bit] [smp:4:4]
> [rq:4] [async-threads:0] [hipe] [kernel-poll:false]
> Compiled: Tue Jun 23 19:56:26 2009
> Atoms: 7552
> =memory
> total: 11040213416
> processes: 10989180488
> processes_used: 10989135536
> system: 51032928
> atom: 507961
> atom_used: 494181
> binary: 43474800
> code: 4668039
> ets: 311600
> =hash_table:atom_tab
> size: 4813
> used: 3776
> objs: 7552
> depth: 8
> =index_table:atom_tab
> size: 8192
> limit: 1048576
> entries: 7552
> =hash_table:module_code
> size: 97
> used: 71
> objs: 119
> depth: 4
> =index_table:module_code
> size: 1024
> limit: 65536
> entries: 119
> =hash_table:export_list
> size: 2411
> used: 1770
> objs: 3269
> depth: 8
> =index_table:export_list
> size: 4096
> limit: 65536
> entries: 3269
> =hash_table:secondary_export_table
> size: 97
> used: 0
> objs: 0
> depth: 0
> =hash_table:process_reg
> size: 47
> used: 31
> objs: 43
> depth: 4
> =hash_table:fun_table
> size: 397
> used: 301
> objs: 566
> depth: 6
> =hash_table:node_table
> size: 11
> used: 1
> objs: 1
> depth: 1
> =hash_table:dist_table
> size: 11
> used: 1
> objs: 1
> depth: 1
> =allocated_areas
> sys_misc: 80890
> static: 991232
> atom_space: 98328 84868
> atom_table: 104153
> module_table: 9084
> export_table: 52172
> register_table: 468
> fun_table: 3266
> module_refs: 2048
> loaded_code: 4228461
> dist_table: 507
> node_table: 227
> bits_bufs_size: 0
> bif_timer: 80192
> link_lh: 0
> proc: 75296 39952
> atom_entry: 305480 305160
> export_entry: 316248 315192
> module_entry: 7784 7720
> reg_proc: 2480 1800
> atom_entry: 305480 305160
> export_entry: 316248 315192
> module_entry: 7784 7720
> reg_proc: 2480 1800
> monitor_sh: 4400 512
> nlink_sh: 11368 6328
> fun_entry: 51328 50096
> db_tab: 6624 5640
> driver_event_data_state: 56 56
> driver_select_data_state: 1352 200
> =allocator:sys_alloc
> option e: true
> option m: libc
> option tt: 131072
> option tp: 0
> =allocator:temp_alloc[0]
> versions: 2.1 2.2
> option e: true
> option t: false
> option ramv: false
> option sbct: 524288
> option asbcst: 4145152
> option rsbcst: 90
> option rsbcmt: 80
> option rmbcmt: 100
> option mmbcs: 131072
> option mmsbc: 256
> option mmmbc: 10
> option lmbcs: 10485760
> option smbcs: 1048576
> option mbcgs: 10
> option mbsd: 3
> option as: gf
> mbcs blocks: 0 136 136
> mbcs blocks size: 0 46568 46568
> mbcs carriers: 1 1 1
> mbcs mseg carriers: 0
> mbcs sys_alloc carriers: 1
> mbcs carriers size: 131112 131112 131112
> mbcs mseg carriers size: 0
> mbcs sys_alloc carriers size: 131112
> sbcs blocks: 0 0 0
> sbcs blocks size: 0 0 0
> sbcs carriers: 0 0 0
> sbcs mseg carriers: 0
>
>
> On Sun, Oct 4, 2009 at 2:17 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>
>> Suhail,
>>
>> On Sun, Oct 4, 2009 at 8:43 PM, Suhail Doshi <suhail at mixpanel.com> wrote:
>> > Any ideas why my producer would suddenly jump and consume all the RAM
>> > available? I am getting a serious amount of volume of items hitting the
>> > queue.
>>
>> In general, a producer is a client process running outside of
>> RabbitMQ, so it is difficult to see how RabbitMQ is affecting the
>> memory consumption of this process. Maybe you can post a cut down
>> version of your producer application that reproduces the symptoms.
>>
>> Ben
>>
>
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091004/015f5d84/attachment.htm 

From matthew at lshift.net  Mon Oct  5 11:04:21 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 5 Oct 2009 11:04:21 +0100
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
 including swap, dying
In-Reply-To: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
Message-ID: <20091005100419.GA25365@mrnibble.lshift.net>

Hi Brian,

On Sun, Oct 04, 2009 at 09:03:28AM -0400, Brian Whitman wrote:
> Hi, we're using 184cb96f7846+ (bug20980) and our host alerted us that rabbit
> was eating up all available swap on a 16GB real + 8GB swap machine.

20980 stopped getting development work some time ago. As per my recent
email to the list, development work is currently focussed on moving away
from using mnesia. I wouldn't really recommend using 20980 any more -
the branches that it grew into which then went through QA did catch some
bugs which will be present in 20980.

> 
> """
> PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  SWAP COMMAND
> 18445 rabbitmq  18   0 24.7g  14g 1696 S 1087.1 91.7   2268:18  10g beam.smp
> 
> In an effort to prevent kernel panic, we restarted the rabbitmq service,
> freeing up a considerable amount of swap:
> 
> However, the rabbitmq server is not starting again as expected, due to the
> following exception:
> 
> 2009-10-04 06:26:29.797201500 {"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_disk_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
> """

Hmm, interesting. Is this in a clustered setup, or unclustered?

> They had to delete the mnesia folder (losing all our disk-backed queues) and
> restart\, now it's fine. I would guess that this breakage coincided with us
> storing quite a large number of unacked messages in the queues (job
> instructions for a very large batch)

How many messages did you have in there, and do you know the average
size?

> a) Would upgrading this branch fix this? We were avoiding doing so because
> things were relatively stable.

The work in 20980 went onto other branches but has not gone onto default
yet because of issues we uncovered in the persister design. Thus the
default branch has the same persister as in v1.6. You would probably be
better off using branch bug21444, which has had the benefit of a lot of
QA attention and bug fixes. That said, all the usual warnings about
using unreleased code do apply.

> b) is there anything else I can look at to debug? The logs don't have
> anything of importance.

Not really - the clustering code was wrong in 20980 for a long time, so
if you were in a clustered setup, I'd blame that - and the error that
you've got would support that too. However, if you just had billions of
messages in there, then even in a non clustered setup, I could believe
mnesia would be taking a long time to start up and that might cause the
above error.

Best wishes,

Matthew



From 0x6e6562 at gmail.com  Mon Oct  5 12:03:08 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 5 Oct 2009 12:03:08 +0100
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com>
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com>
	<376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com>
	<376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com>
Message-ID: <269388e30910050403t6472a16p54f12247da26604d@mail.gmail.com>

Suhail,

On Mon, Oct 5, 2009 at 2:08 AM, Suhail Doshi <suhail at mixpanel.com> wrote:
> Here's part of the queue code we use:

A few observations:

- Tickets and realms are toast in Rabbit now, so you can nuke that code;
- You set a lot of fields that are identical to the default values,
hence adding unnecessary extra code;
- You are also using a fairly old version of the Erlang client - you
are less likely to get any serious feedback when you are not using the
latest version;

In general the idea is to write the most concise piece of code that
you can that replicates the issue, even if it does take 5 hours to
reproduce - we can run the code for 5 hours locally if we need to as
well. Otherwise we have little hope of being able to help you.

Ben



From matthew at lshift.net  Mon Oct  5 17:13:17 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 5 Oct 2009 17:13:17 +0100
Subject: [rabbitmq-discuss] Overriding node long name
In-Reply-To: <6bd5d4070910011552k72e43b3bsafd416406c1b6462@mail.gmail.com>
References: <6bd5d4070910011552k72e43b3bsafd416406c1b6462@mail.gmail.com>
Message-ID: <20091005161317.GB25365@mrnibble.lshift.net>

Hi Sammy,

If you edit the rabbitmq-server script and change the -sname to -name,
then yes, you can set RABBITMQ_NODENAME to be foo at ip-address and that'll
work fine. Note that you'll also probably need to edit the other scripts
similarly to make them continue to work (rabbitmqctl, rabbitmq-multi
etc) - an sname node can't connect to a long name node (and vice versa).

Matthew

On Thu, Oct 01, 2009 at 03:52:40PM -0700, Sammy Yu wrote:
> Hi,
>    I would like to use -name (long name) option so that I can set
> something along the lines of rabbit@<ip address> rather than
> rabbit@<hostname>.  Is it possible to do this?  I think I read
> somewhere this is not possible because of some erlang limitation, when
> I try it I get this error:
> {error_logger,{{2009,10,1},{15,50,38}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> {error_logger,{{2009,10,1},{15,50,38}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.22.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,505}],[]]}
> {error_logger,{{2009,10,1},{15,50,38}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2009,10,1},{15,50,38}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2009,10,1},{15,50,38}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> 
> Thanks,
> Sammy
> 
> Thanks,
> Sammy
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From matthew at lshift.net  Mon Oct  5 17:21:29 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 5 Oct 2009 17:21:29 +0100
Subject: [rabbitmq-discuss] Adding new nodes to a cluster
In-Reply-To: <6bd5d4070910021256q52a9d1dftb4990834714d7620@mail.gmail.com>
References: <6bd5d4070910021256q52a9d1dftb4990834714d7620@mail.gmail.com>
Message-ID: <20091005162129.GC25365@mrnibble.lshift.net>

Hi Sammy,

On Fri, Oct 02, 2009 at 12:56:21PM -0700, Sammy Yu wrote:
>    I've getting my rabbitmq cluster setup.  I noticed in the
> documentation there was reference to two different kinds of nodes, a
> ram and disk node and it seems to infer that there can only be one ram
> node and N disk nodes.  My understanding is that the ram node has no
> persistent information about the other nodes whereas the disk node
> does.  What's the reasoning behind the constraint and why is it it
> necessary to have a ram node (I'm assuming there are some performance
> implications)?

You can have as many RAM nodes and you'd like and as many disk nodes as
you'd like. In some versions of Rabbit, we've tried to enforce that you
can't create a cluster only of RAM nodes, but in truth this is
impossible to achieve so we've actually dropped all attempts to enforce
this in v1.7.

RAM nodes can go faster because their mnesia tables are only in memory,
thus they do not have to wait for disks. However, although persistent
messages will still be sent to disk on a RAM node, routing tables,
and accountancy information for exchanges and queues is not held on
disk. As such, should you create a cluster only of RAM nodes, durable
queues and exchanges will not survive server restarts because although
the messages will survive, there will be no entries in mnesia saying the
exchange/queue ever existed.

Thus having at least one disk node solves this because mnesia shares all
information across all nodes in a cluster - thus the disk node will
record everything necessary.

> Also is it true that the output of the first node
> listed in rabbitmqctl status is the ram node?  So given the following
> output:
>  {nodes,[rabbit at rabbit1,rabbit at rabbit2,rabbit at rabbit3]},
> We can assume that rabbit1 is the ram node and rabbit2 and rabbit3 are
> disk nodes.

No. The output of rabbitmqctl status indicates every node that is in the
cluster, and does not indicate which of the nodes are RAM nodes and
which are disk nodes.

Matthew



From matthew at lshift.net  Mon Oct  5 17:24:11 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 5 Oct 2009 17:24:11 +0100
Subject: [rabbitmq-discuss] IP address of clustered rabbitmq in
 Connection.redirect reponse
In-Reply-To: <6bd5d4070910021743i3c894678wb9d76b914f43ff1@mail.gmail.com>
References: <6bd5d4070910021743i3c894678wb9d76b914f43ff1@mail.gmail.com>
Message-ID: <20091005162411.GD25365@mrnibble.lshift.net>

Hi Sammy,

On Fri, Oct 02, 2009 at 05:43:40PM -0700, Sammy Yu wrote:
>    I'm running in an environment with broken DNS server, so I've been
> using inetrc to get clustering working.  However on the client side
> when I try to connect (insist=False), I get a connection.redirect with
> hostname of the other the nodes, is it possible to get it to return IP
> instead?

No, sorry, that is not possible. One reason for this is that it would be
difficult for an erlang VM to know which IP addresses it is contactable
on, should the host have several available.

Matthew



From bmurphy1976 at gmail.com  Mon Oct  5 17:25:10 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Mon, 5 Oct 2009 11:25:10 -0500
Subject: [rabbitmq-discuss] C# Client + Virtual Host Problem
Message-ID: <7fd310d10910050925s5e8c95c0x1bb23f46692cf390@mail.gmail.com>

We're having trouble connecting to a RabbitMQ virtual host under mono.  If
we connect to the root virtual host (/) everything works fine.  Any insight
into what we might be doing wrong?  We're using v1.6.0 client driver.

Thanks,
Bryan




[2009-10-05 08:57:04,516] [INFO ] Establishing Message Bus Connection
[2009-10-05 08:57:04,517] [INFO ] Protocol: 0-8
[2009-10-05 08:57:04,517] [INFO ] Host: 10.255.203.226
[2009-10-05 08:57:04,518] [INFO ] Port: 5672
[2009-10-05 08:57:04,518] [INFO ] Virtual Host: /publisher

Unhandled Exception: None of the specified endpoints were reachable
Endpoints attempted:
  endpoint=amqp-0-8://10.255.203.226:5672, attempts=1, outcome=The AMQP
operation was interrupted: AMQP close-reason, initiated by Library, code=0,
text="End of stream", classId=0, methodId=0,
cause=System.IO.EndOfStreamException: Failed to read past end of stream.
  at System.IO.BinaryReader.ReadByte () [0x00047] in
/home/bmurphy/src/mono/mcs/class/corlib/System.IO/BinaryReader.cs:293
  at RabbitMQ.Client.Impl.Frame.ReadFrom (RabbitMQ.Util.NetworkBinaryReader
reader) [0x00000]
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame () [0x00000]
  at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration () [0x00000]
  at RabbitMQ.Client.Impl.ConnectionBase.MainLoop () [0x00000]
Stack trace:
  at RabbitMQ.Client.ConnectionFactory.CreateConnection (Int32 maxRedirects,
RabbitMQ.Client.AmqpTcpEndpoint[] endpoints) [0x00000]
  at RabbitMQ.Client.ConnectionFactory.CreateConnection
(RabbitMQ.Client.AmqpTcpEndpoint[] endpoints) [0x00000]
  at RabbitMQ.Client.ConnectionFactory.CreateConnection (IProtocol version,
System.String hostName, Int32 portNumber) [0x00000]




rabbitmqctl status
Status of node 'rabbit at domU-12-31-39-01-C4-14' ...
[{running_applications,[{rabbit,"RabbitMQ","1.6.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.3"},
                        {os_mon,"CPO  CXC 138 46","2.1.6"},
                        {sasl,"SASL  CXC 138 11","2.1.5.3"},
                        {stdlib,"ERTS  CXC 138 10","1.15.3"},
                        {kernel,"ERTS  CXC 138 10","2.12.3"}]},
 {nodes,['rabbit at domU-12-31-39-01-C4-14']},
 {running_nodes,['rabbit at domU-12-31-39-01-C4-14']}]
...done.




rabbitmqctl list_vhosts
Listing vhosts ...
/
/publisher
...done.




mono --version
Mono JIT compiler version 2.5 (/trunk/mono r142445 Tue Sep 22 18:25:08 PDT
2009)
Copyright (C) 2002-2008 Novell, Inc and Contributors. www.mono-project.com
        TLS:           __thread
        GC:            Included Boehm (with typed GC and Parallel Mark)
        SIGSEGV:       altstack
        Notifications: epoll
        Architecture:  x86
        Disabled:      none




Relevant code:

        using RabbitMQConnectionFactory = RabbitMQ.Client.ConnectionFactory;

        public ConnectionFactory(MessageBusConnectionConfig config)
        {
            Contract.ArgumentNotNull("config", config);
            this.Config = config;
            this.ProviderConnectionFactory = new
RabbitMQConnectionFactory();

            if (!string.IsNullOrEmpty(config.VirtualHost))
                this.ProviderConnectionFactory.Parameters.VirtualHost =
config.VirtualHost;
        }

        public IConnection GetConnection()
        {
            if (_log.IsInfoEnabled)
            {
                _log.Info("Establishing Message Bus Connection");
                _log.Info("Protocol: " + Protocols.DefaultProtocol);
                _log.Info("Host: " + this.Config.ServerName);
                _log.Info("Port: " + (this.Config.ServerPort ?? 5672));
                _log.Info("Virtual Host: " +
this.ProviderConnectionFactory.Parameters.VirtualHost);
            }

            return new Connection(
                this.ProviderConnectionFactory.CreateConnection(
                    Protocols.DefaultProtocol,
                    this.Config.ServerName,
                    this.Config.ServerPort ?? 5672
                ));
        }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091005/0b68f268/attachment.htm 

From matthias at lshift.net  Mon Oct  5 18:05:06 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 05 Oct 2009 18:05:06 +0100
Subject: [rabbitmq-discuss] C# Client + Virtual Host Problem
In-Reply-To: <7fd310d10910050925s5e8c95c0x1bb23f46692cf390@mail.gmail.com>
References: <7fd310d10910050925s5e8c95c0x1bb23f46692cf390@mail.gmail.com>
Message-ID: <4ACA2742.6090709@lshift.net>

Bryan,

Bryan Murphy wrote:
> We're having trouble connecting to a RabbitMQ virtual host under mono.  
> If we connect to the root virtual host (/) everything works fine.  Any 
> insight into what we might be doing wrong?  We're using v1.6.0 client 
> driver.

There should be some error messages in the server log to help you
identify the cause.


Regards,

Matthias.




From temijun at gmail.com  Mon Oct  5 18:21:25 2009
From: temijun at gmail.com (Sammy Yu)
Date: Mon, 5 Oct 2009 10:21:25 -0700
Subject: [rabbitmq-discuss] Adding new nodes to a cluster
In-Reply-To: <20091005162129.GC25365@mrnibble.lshift.net>
References: <6bd5d4070910021256q52a9d1dftb4990834714d7620@mail.gmail.com>
	<20091005162129.GC25365@mrnibble.lshift.net>
Message-ID: <6bd5d4070910051021v7ff6943dhe7482f0424a14e27@mail.gmail.com>

Hi Matthew,
   Thanks for the detailed explanation, it really clarifies things.
Is there an easy way to determine whether a node is running under ram
or disk mode?

Best,
Sammy

On Mon, Oct 5, 2009 at 9:21 AM, Matthew Sackman <matthew at lshift.net> wrote:
> Hi Sammy,
>
> On Fri, Oct 02, 2009 at 12:56:21PM -0700, Sammy Yu wrote:
>> ? ?I've getting my rabbitmq cluster setup. ?I noticed in the
>> documentation there was reference to two different kinds of nodes, a
>> ram and disk node and it seems to infer that there can only be one ram
>> node and N disk nodes. ?My understanding is that the ram node has no
>> persistent information about the other nodes whereas the disk node
>> does. ?What's the reasoning behind the constraint and why is it it
>> necessary to have a ram node (I'm assuming there are some performance
>> implications)?
>
> You can have as many RAM nodes and you'd like and as many disk nodes as
> you'd like. In some versions of Rabbit, we've tried to enforce that you
> can't create a cluster only of RAM nodes, but in truth this is
> impossible to achieve so we've actually dropped all attempts to enforce
> this in v1.7.
>
> RAM nodes can go faster because their mnesia tables are only in memory,
> thus they do not have to wait for disks. However, although persistent
> messages will still be sent to disk on a RAM node, routing tables,
> and accountancy information for exchanges and queues is not held on
> disk. As such, should you create a cluster only of RAM nodes, durable
> queues and exchanges will not survive server restarts because although
> the messages will survive, there will be no entries in mnesia saying the
> exchange/queue ever existed.
>
> Thus having at least one disk node solves this because mnesia shares all
> information across all nodes in a cluster - thus the disk node will
> record everything necessary.
>
>> Also is it true that the output of the first node
>> listed in rabbitmqctl status is the ram node? ?So given the following
>> output:
>> ?{nodes,[rabbit at rabbit1,rabbit at rabbit2,rabbit at rabbit3]},
>> We can assume that rabbit1 is the ram node and rabbit2 and rabbit3 are
>> disk nodes.
>
> No. The output of rabbitmqctl status indicates every node that is in the
> cluster, and does not indicate which of the nodes are RAM nodes and
> which are disk nodes.
>
> Matthew
>



From bmurphy1976 at gmail.com  Mon Oct  5 18:52:25 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Mon, 5 Oct 2009 12:52:25 -0500
Subject: [rabbitmq-discuss] C# Client + Virtual Host Problem
In-Reply-To: <4ACA2742.6090709@lshift.net>
References: <7fd310d10910050925s5e8c95c0x1bb23f46692cf390@mail.gmail.com>
	<4ACA2742.6090709@lshift.net>
Message-ID: <7fd310d10910051052y4b6ae83dn1a5f47a662a705d0@mail.gmail.com>

On Mon, Oct 5, 2009 at 12:05 PM, Matthias Radestock <matthias at lshift.net>wrote:

> There should be some error messages in the server log to help you
> identify the cause.
>
>
> Regards,
>
> Matthias.
>
>
=ERROR REPORT==== 5-Oct-2009::10:50:09 ===
exception on TCP connection <0.997.0> from 10.255.203.226:59761
{channel0_error,opening,
                {amqp,access_refused,
                      "access to vhost '/publisher' refused for user
'guest'",
                      'connection.open'}}


Not sure why I didn't think to look at the RabbitMQ log.  It would be nice
if the driver gave a better error message, but at least I now know!

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091005/2a684202/attachment.htm 

From matthias at lshift.net  Mon Oct  5 19:21:38 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 05 Oct 2009 19:21:38 +0100
Subject: [rabbitmq-discuss] C# Client + Virtual Host Problem
In-Reply-To: <7fd310d10910051052y4b6ae83dn1a5f47a662a705d0@mail.gmail.com>
References: <7fd310d10910050925s5e8c95c0x1bb23f46692cf390@mail.gmail.com>	<4ACA2742.6090709@lshift.net>
	<7fd310d10910051052y4b6ae83dn1a5f47a662a705d0@mail.gmail.com>
Message-ID: <4ACA3932.9040003@lshift.net>

Bryan,

> =ERROR REPORT==== 5-Oct-2009::10:50:09 ===
> exception on TCP connection <0.997.0> from 10.255.203.226:59761 
> <http://10.255.203.226:59761>
> {channel0_error,opening,
>                 {amqp,access_refused,
>                       "access to vhost '/publisher' refused for user 
> 'guest'",
>                       'connection.open'}}
> 
> 
> Not sure why I didn't think to look at the RabbitMQ log.  It would be 
> nice if the driver gave a better error message

The client could report an error along the lines of "server closed 
connection during connection.open. Likely causes include ...". That's on 
our todo list.

The message can't be precise about the error since the protocol does not 
permit the server to return an error message until after the connection 
has been fully opened.


Regards,

Matthias.



From brian at echonest.com  Mon Oct  5 19:23:14 2009
From: brian at echonest.com (Brian Whitman)
Date: Mon, 5 Oct 2009 14:23:14 -0400
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
	including swap, dying
In-Reply-To: <20091005100419.GA25365@mrnibble.lshift.net>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
	<20091005100419.GA25365@mrnibble.lshift.net>
Message-ID: <dbd9700a0910051123t37207495g69b47a960b5ab3ba@mail.gmail.com>

>
> Hmm, interesting. Is this in a clustered setup, or unclustered?
>

Unclustered


> How many messages did you have in there, and do you know the average
> size?
>

Can't know for sure but my guess is about 20 queues, about 500K messages in
each queue, message sizes are about 1KB each.



> The work in 20980 went onto other branches but has not gone onto default
> yet because of issues we uncovered in the persister design. Thus the
> default branch has the same persister as in v1.6. You would probably be
> better off using branch bug21444, which has had the benefit of a lot of
> QA attention and bug fixes. That said, all the usual warnings about
> using unreleased code do apply.
>


Does bug21444 have the disk mode auto-pinning stuff?

I understand about the warnings, the stable branch though would crash almost
immediately with our message load.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091005/e12c7f18/attachment.htm 

From tsuraan at gmail.com  Mon Oct  5 21:15:00 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 5 Oct 2009 15:15:00 -0500
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
	including swap, dying
In-Reply-To: <20091005100419.GA25365@mrnibble.lshift.net>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
	<20091005100419.GA25365@mrnibble.lshift.net>
Message-ID: <84fb38e30910051315p442d024fnbbbd5a3771d6812f@mail.gmail.com>

> The work in 20980 went onto other branches but has not gone onto default
> yet because of issues we uncovered in the persister design. Thus the
> default branch has the same persister as in v1.6. You would probably be
> better off using branch bug21444, which has had the benefit of a lot of
> QA attention and bug fixes. That said, all the usual warnings about
> using unreleased code do apply.

In your current workflow, is bug21444 basically the stable
accumulation of changes from 21368?  It looks like 21444 is mostly
merges from 21368 and default, but sometimes the commits indicate that
21444 gets its own development as well.  21368 has a ton of
informative commit messages; it looks more active and less stable.  Is
that accurate?



From suhail at mixpanel.com  Mon Oct  5 22:23:51 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Mon, 5 Oct 2009 14:23:51 -0700
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <269388e30910050403t6472a16p54f12247da26604d@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com> 
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com> 
	<376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com> 
	<376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com> 
	<269388e30910050403t6472a16p54f12247da26604d@mail.gmail.com>
Message-ID: <376f3e6f0910051423q5491e091rf9867b7cfc2f2d3@mail.gmail.com>

I have actually traced to the error_logger process:
State: Waiting
Name: error_logger
Spawned as: proc_lib:init_p/5
Spawned by: <0.1.0>
Started: Mon Oct  5 20:22:42 2009
Message queue length: 113
Number of heap fragments: 0
Heap fragment data: 0
Link list: [<0.25.0>, <0.0.0>, {to,<0.25.0>,#Ref<0.0.0.254510>}]
Reductions: 615399844
Stack+heap: 356352655
OldHeap: 285082125
Heap unused: 50293735
OldHeap unused: 285082125
Program counter: 0x00007f49a1b7f108 (io:wait_io_mon_reply/2 + 56)
CP: 0x0000000000000000 (invalid)
arity = 0
=proc:<0.5.0>


Anyone else seen this problem? Seems like an erlang thing not a rabbitmq
thing.

On Mon, Oct 5, 2009 at 4:03 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Suhail,
>
> On Mon, Oct 5, 2009 at 2:08 AM, Suhail Doshi <suhail at mixpanel.com> wrote:
> > Here's part of the queue code we use:
>
> A few observations:
>
> - Tickets and realms are toast in Rabbit now, so you can nuke that code;
> - You set a lot of fields that are identical to the default values,
> hence adding unnecessary extra code;
> - You are also using a fairly old version of the Erlang client - you
> are less likely to get any serious feedback when you are not using the
> latest version;
>
> In general the idea is to write the most concise piece of code that
> you can that replicates the issue, even if it does take 5 hours to
> reproduce - we can run the code for 5 hours locally if we need to as
> well. Otherwise we have little hope of being able to help you.
>
> Ben
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091005/fbc318a3/attachment.htm 

From 0x6e6562 at gmail.com  Mon Oct  5 22:30:29 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 5 Oct 2009 22:30:29 +0100
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <376f3e6f0910051423q5491e091rf9867b7cfc2f2d3@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com>
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com>
	<376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com>
	<376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com>
	<269388e30910050403t6472a16p54f12247da26604d@mail.gmail.com>
	<376f3e6f0910051423q5491e091rf9867b7cfc2f2d3@mail.gmail.com>
Message-ID: <269388e30910051430u27a4a8c5n56c7534ef8267be9@mail.gmail.com>

Suhail,

On Mon, Oct 5, 2009 at 10:23 PM, Suhail Doshi <suhail at mixpanel.com> wrote:
> Anyone else seen this problem? Seems like an erlang thing not a rabbitmq
> thing.

I've never seen it myself. But if you don't send some concise runnable
code that reproduces the issue, you are not going to get much help
much from anybody.

Ben



From akalend at mail.ru  Tue Oct  6 09:57:49 2009
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Tue, 06 Oct 2009 12:57:49 +0400
Subject: [rabbitmq-discuss] the limitation or bug
In-Reply-To: <167204d20910020504t5a265922t1e5eef5daac8e291@mail.gmail.com>
References: <167204d20910020504t5a265922t1e5eef5daac8e291@mail.gmail.com>
Message-ID: <E1Mv5rh-00062Q-00.akalend-mail-ru@f252.mail.ru>

Hi All,

I create the 100 000 messages and bind to one exchange.
After creating 32 684 queues and bindings I have crush. The log have message:
error{
'EXIT', 
  {syslem_limit,
.... 
 }
}

If I create 3 node by rabbit_multi (rabbit at myhost, rabbit_1 at myhost & rabbit_2 at myhost) I can to create only 32 684 queues by one node. I have three connections by 5672,5673,5674 ports.

Can I create more that 32 684 queues in one node?
Can RabbitMQ distribute the queues by nodes using one connection.



Alexandre




From majek04 at gmail.com  Tue Oct  6 10:47:57 2009
From: majek04 at gmail.com (majek04)
Date: Tue, 6 Oct 2009 10:47:57 +0100
Subject: [rabbitmq-discuss] the limitation or bug
In-Reply-To: <E1Mv5rh-00062Q-00.akalend-mail-ru@f252.mail.ru>
References: <167204d20910020504t5a265922t1e5eef5daac8e291@mail.gmail.com>
	<E1Mv5rh-00062Q-00.akalend-mail-ru@f252.mail.ru>
Message-ID: <3bb0d9710910060247r3273e46dpef3f7b29d64a7633@mail.gmail.com>

On Tue, Oct 6, 2009 at 09:57, Alexandre Kalendarev <akalend at mail.ru> wrote:
> Can I create more that 32 684 queues in one node?

Please try to increase the erlang process limit. You can do that
by supplying "+P <number>" parameter to erlang ("erl").
http://erlang.org/doc/man/erl.html#max_processes

To check what is your current limit, you can run erlang and type:
$ erl +P99999
> erlang:system_info(process_limit).
99999
>

There were similar discussions in the past, you can try to
search rabbitmq mailing list archive to find more info.

Cheers!
  Marek Majkowski



From matthew at lshift.net  Tue Oct  6 11:01:24 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 6 Oct 2009 11:01:24 +0100
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
 including swap, dying
In-Reply-To: <dbd9700a0910051123t37207495g69b47a960b5ab3ba@mail.gmail.com>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
	<20091005100419.GA25365@mrnibble.lshift.net>
	<dbd9700a0910051123t37207495g69b47a960b5ab3ba@mail.gmail.com>
Message-ID: <20091006100124.GE25365@mrnibble.lshift.net>

On Mon, Oct 05, 2009 at 02:23:14PM -0400, Brian Whitman wrote:
> > How many messages did you have in there, and do you know the average
> > size?
> >
> 
> Can't know for sure but my guess is about 20 queues, about 500K messages in
> each queue, message sizes are about 1KB each.

Hmm, 10million rows in mnesia should be fine, but I can definitely
believe that mnesia would take more than 30 seconds to start up, esp if
this is on EC2 which is known to have disk bandwidth issues (correct me
if I'm wrong there). It's very possible that nothing was wrong at all -
it just timed out waiting for mnesia to start up and load in all the
tables, which would in turn stop Rabbit from starting up.

> Does bug21444 have the disk mode auto-pinning stuff?
> 
> I understand about the warnings, the stable branch though would crash almost
> immediately with our message load.

Yes. Basically, a lot of the various features of 20980 got split out
into different branches. The main bulk of the work, in terms of the new
persister was in 21368, but that lacked the manual controls for pinning
queues to disk - everything it did was automatic only. 21368 then went
through a lot of QA - the code is in good shape (although flawed due to
issues with mnesia), and 21444 adds to 21368 the manual controls.

Matthew



From matthew at lshift.net  Tue Oct  6 11:05:33 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 6 Oct 2009 11:05:33 +0100
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
 including swap, dying
In-Reply-To: <84fb38e30910051315p442d024fnbbbd5a3771d6812f@mail.gmail.com>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
	<20091005100419.GA25365@mrnibble.lshift.net>
	<84fb38e30910051315p442d024fnbbbd5a3771d6812f@mail.gmail.com>
Message-ID: <20091006100533.GF25365@mrnibble.lshift.net>

On Mon, Oct 05, 2009 at 03:15:00PM -0500, tsuraan wrote:
> In your current workflow, is bug21444 basically the stable
> accumulation of changes from 21368?  It looks like 21444 is mostly
> merges from 21368 and default, but sometimes the commits indicate that
> 21444 gets its own development as well.  21368 has a ton of
> informative commit messages; it looks more active and less stable.  Is
> that accurate?

No, that's not really accurate. It's difficult to say whether a branch
is "stable" or not. Our basic method is to develop on a branch, then the
branch will go through QA which may well result in further changes to
that branch - that may very well create a cluster of small commits over
the code base as bugs are tracked down or refactorings occur. But at
this point, the code is getting more stable and improving in quality.

21368 is the basic new persister - v2. This is being grown on a
different branch into an altered design (v3) which does not use mnesia
for reasons I've outlined before. 21444 is a set of manual controls that
extend 21368. Thus from time to time I merge 21368 into 21444. All long
standing branches get default merged into them from time to time so that
recent fixes which have been merged into default get propogated out to
branches. This also helps to ensure infrastructure remains working
across all branches, and it makes the eventual merge back into default
easier too.

Matthew



From alexis.richardson at gmail.com  Tue Oct  6 11:45:20 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 6 Oct 2009 11:45:20 +0100
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <269388e30910051430u27a4a8c5n56c7534ef8267be9@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com>
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com>
	<376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com>
	<376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com>
	<269388e30910050403t6472a16p54f12247da26604d@mail.gmail.com>
	<376f3e6f0910051423q5491e091rf9867b7cfc2f2d3@mail.gmail.com>
	<269388e30910051430u27a4a8c5n56c7534ef8267be9@mail.gmail.com>
Message-ID: <167204d20910060345q12e83599pf6ad52950ef613a0@mail.gmail.com>

Suhail

Have you tried running this with the latest erlang client yet?

alexis


On Mon, Oct 5, 2009 at 10:30 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Suhail,
>
> On Mon, Oct 5, 2009 at 10:23 PM, Suhail Doshi <suhail at mixpanel.com> wrote:
>> Anyone else seen this problem? Seems like an erlang thing not a rabbitmq
>> thing.
>
> I've never seen it myself. But if you don't send some concise runnable
> code that reproduces the issue, you are not going to get much help
> much from anybody.
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tsuraan at gmail.com  Tue Oct  6 16:31:06 2009
From: tsuraan at gmail.com (tsuraan)
Date: Tue, 6 Oct 2009 10:31:06 -0500
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
	including swap, dying
In-Reply-To: <20091006100533.GF25365@mrnibble.lshift.net>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
	<20091005100419.GA25365@mrnibble.lshift.net>
	<84fb38e30910051315p442d024fnbbbd5a3771d6812f@mail.gmail.com>
	<20091006100533.GF25365@mrnibble.lshift.net>
Message-ID: <84fb38e30910060831v52cab40ex4f58903ab32e741d@mail.gmail.com>

> No, that's not really accurate. It's difficult to say whether a branch
> is "stable" or not. Our basic method is to develop on a branch, then the
> branch will go through QA which may well result in further changes to
> that branch - that may very well create a cluster of small commits over
> the code base as bugs are tracked down or refactorings occur. But at
> this point, the code is getting more stable and improving in quality.
>
> 21368 is the basic new persister - v2. This is being grown on a
> different branch into an altered design (v3) which does not use mnesia
> for reasons I've outlined before. 21444 is a set of manual controls that
> extend 21368. Thus from time to time I merge 21368 into 21444. All long
> standing branches get default merged into them from time to time so that
> recent fixes which have been merged into default get propogated out to
> branches. This also helps to ensure infrastructure remains working
> across all branches, and it makes the eventual merge back into default
> easier too.

Ok, thanks for the info.  Would it be possible to have a page where
the most active bug numbers are explained, or a blog entry or two on
lshift that explains them?  You guys are really responsive on this
list, but sometimes it would be cool to be able to find information
without just asking you :)



From matthew at lshift.net  Tue Oct  6 17:41:17 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 6 Oct 2009 17:41:17 +0100
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
 including swap, dying
In-Reply-To: <84fb38e30910060831v52cab40ex4f58903ab32e741d@mail.gmail.com>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
	<20091005100419.GA25365@mrnibble.lshift.net>
	<84fb38e30910051315p442d024fnbbbd5a3771d6812f@mail.gmail.com>
	<20091006100533.GF25365@mrnibble.lshift.net>
	<84fb38e30910060831v52cab40ex4f58903ab32e741d@mail.gmail.com>
Message-ID: <20091006164116.GI25365@mrnibble.lshift.net>

On Tue, Oct 06, 2009 at 10:31:06AM -0500, tsuraan wrote:
> Ok, thanks for the info.  Would it be possible to have a page where
> the most active bug numbers are explained, or a blog entry or two on
> lshift that explains them?  You guys are really responsive on this
> list, but sometimes it would be cool to be able to find information
> without just asking you :)

The short answer is no. The reason is that as a rule, we don't really
like advertising what is on each branch because we would prefer for
people to stick with official releases, or the default branch, unless
they have very good reasons. As soon as we start putting lists up of
what is in what branch, people will use those branches, which makes life
much much harder for us, in terms of offering meaningful support. People
may then be tempted to start merging branches together to get the mix of
features they want... this would rapidly descend into disaster.

Any branch that has been merged into default is considered QA'd and
finished. There are very few long running branches outside of default -
the new persister work, and the AMQP 0.9.1 work are two obvious
examples.

Matthew



From akalend at mail.ru  Wed Oct  7 09:37:14 2009
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Wed, 07 Oct 2009 12:37:14 +0400
Subject: [rabbitmq-discuss] the select messages by routing-key
Message-ID: <E1MvS1K-0005r2-00.akalend-mail-ru@f66.mail.ru>

Hi All,

I have the received messages into the queue with routing-key:
message #1  - key: news
message #2  - key: realty
message #3  - key: realty
message #4  - key: news

Can I to read from queue only by single routing-key, for example:
only first reading block
message #2  - key: realty
message #3  - key: realty

only Second reading block:
message #1  - key: news
message #4  - key: news


I see next path:
- read all messages with no_ack (basic.get )
- filtring by key 

read second block:
- read all messages (basic.get )
- filtring by second key 

Lack of this method is duble the incoming flow

The second path is to have the two different queues.


thanks 



Alexandre 



From suhail at mixpanel.com  Wed Oct  7 11:27:44 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Wed, 7 Oct 2009 03:27:44 -0700
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <167204d20910060345q12e83599pf6ad52950ef613a0@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com> 
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com> 
	<376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com> 
	<376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com> 
	<269388e30910050403t6472a16p54f12247da26604d@mail.gmail.com> 
	<376f3e6f0910051423q5491e091rf9867b7cfc2f2d3@mail.gmail.com> 
	<269388e30910051430u27a4a8c5n56c7534ef8267be9@mail.gmail.com> 
	<167204d20910060345q12e83599pf6ad52950ef613a0@mail.gmail.com>
Message-ID: <376f3e6f0910070327s687f012ck2f498c28e7d87f7f@mail.gmail.com>

Running it now, will let you know the results of it--so far so good.
Suhail

On Tue, Oct 6, 2009 at 3:45 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Suhail
>
> Have you tried running this with the latest erlang client yet?
>
> alexis
>
>
> On Mon, Oct 5, 2009 at 10:30 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> > Suhail,
> >
> > On Mon, Oct 5, 2009 at 10:23 PM, Suhail Doshi <suhail at mixpanel.com>
> wrote:
> >> Anyone else seen this problem? Seems like an erlang thing not a rabbitmq
> >> thing.
> >
> > I've never seen it myself. But if you don't send some concise runnable
> > code that reproduces the issue, you are not going to get much help
> > much from anybody.
> >
> > Ben
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/19b528f0/attachment.htm 

From alexis.richardson at gmail.com  Wed Oct  7 11:38:40 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 7 Oct 2009 11:38:40 +0100
Subject: [rabbitmq-discuss] the select messages by routing-key
In-Reply-To: <E1MvSCd-0003fs-00.akalend-mail-ru@f288.mail.ru>
References: <167204d20910070144o5cb286bdne148c6c4323ca42f@mail.gmail.com>
	<E1MvSCd-0003fs-00.akalend-mail-ru@f288.mail.ru>
Message-ID: <167204d20910070338k4ff71c7ck364a28ea857414cf@mail.gmail.com>

Alexandre

2009/10/7 Alexandre Kalendarev <akalend at mail.ru>:
> Alexis,
>
> It is second path.

Understood.


> First path: ?I have million users, million queues.
> Second path: I will to have two-five million queues.

In RabbitMQ:

* the messages are stored efficiently i.e. the same message, even if
in two queues, is only stored once per node
* the queues take up some (small) space
* the bindings take up space

So in fact there is little difference between one queue with two
bindings, and two queues with one binding each.  As the number of
bindings grows relative to the number of queues, the difference
between your 'path one' and 'path two' decreases monotonically towards
zero.  (All other things being equal).

Does this help?

alexis






>
>
>>
>> To achieve this you need two queues and one exchange.
>>
>> Bind queue 1 to the exchange with key 'news'.
>> Bind queue 2 to the exchange with key 'realty'.
>>
>> To see messages with key 'news', consume from queue 1.
>> To see messages with key 'realty', consume from queue 2.
>>
>> alexis
>>
>>
>>
>>
>>
>> On Wed, Oct 7, 2009 at 9:37 AM, Alexandre Kalendarev <akalend at mail.ru> wrote:
>> > Hi All,
>> >
>> > I have the received messages into the queue with routing-key:
>> > message #1 ?- key: news
>> > message #2 ?- key: realty
>> > message #3 ?- key: realty
>> > message #4 ?- key: news
>> >
>> > Can I to read from queue only by single routing-key, for example:
>> > only first reading block
>> > message #2 ?- key: realty
>> > message #3 ?- key: realty
>> >
>> > only Second reading block:
>> > message #1 ?- key: news
>> > message #4 ?- key: news
>> >
>> >
>> > I see next path:
>> > - read all messages with no_ack (basic.get )
>> > - filtring by key
>> >
>> > read second block:
>> > - read all messages (basic.get )
>> > - filtring by second key
>> >
>> > Lack of this method is duble the incoming flow
>> >
>> > The second path is to have the two different queues.
>> >
>> >
>> > thanks
>> >
>> >
>> >
>> > Alexandre
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>>
>



From alexis.richardson at gmail.com  Wed Oct  7 11:59:19 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 7 Oct 2009 11:59:19 +0100
Subject: [rabbitmq-discuss] rabbitmq clustering
In-Reply-To: <376f3e6f0910011349w2947bd8bp262642c6d7e34c22@mail.gmail.com>
References: <376f3e6f0910011349w2947bd8bp262642c6d7e34c22@mail.gmail.com>
Message-ID: <167204d20910070359j6c9db9bctb127f59a387ab7a0@mail.gmail.com>

Suhail

Have you been able to resolve this?

alexis


On Thu, Oct 1, 2009 at 9:49 PM, Suhail Doshi <suhail at mixpanel.com> wrote:
> One that was unclear to me in the clustering documentation is how you setup
> consumers to work with clusters or if there even is any setup?
> Does the consumer need to be aware of all the nodes in a cluster?
> If not does the consumer just need to be hooked up to the node that the
> other nodes are clustered around and things are automatically load balanced?
> My consumers are connected to a single node right now, so is my producer. If
> add nodes and cluster them around this node will rabbitmq handle all the
> load balancing?
> This seems a bit to magical to me and seems like both producers and
> consumers would need to be aware of the nodes.
> I am using the AMQP python lib
> Suhail
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From akalend at mail.ru  Wed Oct  7 12:17:37 2009
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Wed, 07 Oct 2009 15:17:37 +0400
Subject: [rabbitmq-discuss] rabbitmqctl  clustering timeout
In-Reply-To: <167204d20910070359j6c9db9bctb127f59a387ab7a0@mail.gmail.com>
References: <167204d20910070359j6c9db9bctb127f59a387ab7a0@mail.gmail.com>
Message-ID: <E1MvUWX-0005vQ-00.akalend-mail-ru@f3.mail.ru>

I create cluster with three node (rabbit1, rabbit2,rabbit3).
I sent to the rabbit2 some messages and I must check it by rabbitmqctl. 

rabbit2>rabbitmqctl list_queues
Error: {badrpc,timeout}

rabbit1>rabbitmqctl  -n rabbit at rabbit1 list_queues
Error: {badrpc,timeout}

rabbit1>rabbitmqctl  list_queues


Alexandre



From rtrlists at googlemail.com  Wed Oct  7 12:28:01 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 7 Oct 2009 12:28:01 +0100
Subject: [rabbitmq-discuss] Publish with immediate for dynamic worker
	creation?
Message-ID: <6a3ae47e0910070428s15fe897dkf4dad642534a67a1@mail.gmail.com>

Hi,

I'm wondering if I'm wandering the right path here. (I'm using 1.6.0 with
erlang client.)

I was intending to use a basic.publish with mandatory and immediate set to
true, and a return handler to allow me to add new workers reading from a
queue.

I create a work queue with a return handler and a reply queue. I also create
one initial worker, subscribing to the work queue with no_ack set to false.

I then publish a work message onto the work queue and the worker picks it
up, does the work and publishes the answer back into the reply queue.

My intention was that my work message publish uses the immediate flag to
generate a basic.return if the message cannot be immediately delivered. I
thought that if my worker is busy it won't get the next message, leading to
the basic.return. But I believe my thinking is wrong. It looks like the
second work message is routed to the initial work consumer immediately, even
if it is still busy.

Have I overlooked something obvious, or would I need to implement a 1
message flow control on the channel that the work consumer is using?

Thanks for any pointers,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/0d2af3b3/attachment.htm 

From pauljones23 at gmail.com  Wed Oct  7 13:10:04 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 7 Oct 2009 13:10:04 +0100
Subject: [rabbitmq-discuss] Publish with immediate for dynamic worker
	creation?
In-Reply-To: <6a3ae47e0910070428s15fe897dkf4dad642534a67a1@mail.gmail.com>
References: <6a3ae47e0910070428s15fe897dkf4dad642534a67a1@mail.gmail.com>
Message-ID: <29598b610910070510x73be974eh7a18353d1c8815a8@mail.gmail.com>

Hi Robert,

If you set the QOS on the consumer to 1 (as you say), then this should
prevent the message being queued at the client.

Thanks,
Paul.

On Wed, Oct 7, 2009 at 12:28 PM, Robert Raschke <rtrlists at googlemail.com>wrote:

> Hi,
>
> I'm wondering if I'm wandering the right path here. (I'm using 1.6.0 with
> erlang client.)
>
> I was intending to use a basic.publish with mandatory and immediate set to
> true, and a return handler to allow me to add new workers reading from a
> queue.
>
> I create a work queue with a return handler and a reply queue. I also
> create one initial worker, subscribing to the work queue with no_ack set to
> false.
>
> I then publish a work message onto the work queue and the worker picks it
> up, does the work and publishes the answer back into the reply queue.
>
> My intention was that my work message publish uses the immediate flag to
> generate a basic.return if the message cannot be immediately delivered. I
> thought that if my worker is busy it won't get the next message, leading to
> the basic.return. But I believe my thinking is wrong. It looks like the
> second work message is routed to the initial work consumer immediately, even
> if it is still busy.
>
> Have I overlooked something obvious, or would I need to implement a 1
> message flow control on the channel that the work consumer is using?
>
> Thanks for any pointers,
> Robby
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/0951b2f9/attachment.htm 

From rtrlists at googlemail.com  Wed Oct  7 13:55:09 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 7 Oct 2009 13:55:09 +0100
Subject: [rabbitmq-discuss] Publish with immediate for dynamic worker
	creation?
In-Reply-To: <29598b610910070510x73be974eh7a18353d1c8815a8@mail.gmail.com>
References: <6a3ae47e0910070428s15fe897dkf4dad642534a67a1@mail.gmail.com>
	<29598b610910070510x73be974eh7a18353d1c8815a8@mail.gmail.com>
Message-ID: <6a3ae47e0910070555s3a37d085g6eb748b7a4b780ec@mail.gmail.com>

Superb.

Thank you. I got lost looking at flow control, which is wrong for my model.

Setting the QoS prefetch-count to 1 in my workers leads to my desired return
notification. I can then set up a new worker and requeue the work message.
Works like a charm.

Splendid,
Robby

On Wed, Oct 7, 2009 at 1:10 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Robert,
>
> If you set the QOS on the consumer to 1 (as you say), then this should
> prevent the message being queued at the client.
>
> Thanks,
> Paul.
>
> On Wed, Oct 7, 2009 at 12:28 PM, Robert Raschke <rtrlists at googlemail.com>wrote:
>
>> Hi,
>>
>> I'm wondering if I'm wandering the right path here. (I'm using 1.6.0 with
>> erlang client.)
>>
>> I was intending to use a basic.publish with mandatory and immediate set to
>> true, and a return handler to allow me to add new workers reading from a
>> queue.
>>
>> I create a work queue with a return handler and a reply queue. I also
>> create one initial worker, subscribing to the work queue with no_ack set to
>> false.
>>
>> I then publish a work message onto the work queue and the worker picks it
>> up, does the work and publishes the answer back into the reply queue.
>>
>> My intention was that my work message publish uses the immediate flag to
>> generate a basic.return if the message cannot be immediately delivered. I
>> thought that if my worker is busy it won't get the next message, leading to
>> the basic.return. But I believe my thinking is wrong. It looks like the
>> second work message is routed to the initial work consumer immediately, even
>> if it is still busy.
>>
>> Have I overlooked something obvious, or would I need to implement a 1
>> message flow control on the channel that the work consumer is using?
>>
>> Thanks for any pointers,
>> Robby
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/573e694b/attachment.htm 

From tonyg at lshift.net  Wed Oct  7 14:07:25 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 07 Oct 2009 14:07:25 +0100
Subject: [rabbitmq-discuss] Return of 'getting started, broker runs;
 can't  get status'
In-Reply-To: <m2tyyvmeg5.fsf@apache.org>
References: <m21vlzl7y5.fsf@apache.org>	<29598b610909220143s7f24bde7q8d3771eaaef9e8f9@mail.gmail.com>	<m2skefjqyb.fsf@apache.org>	<29598b610909220259y58b5958ds5eb49e615b94ca1d@mail.gmail.com>	<m2ocp3jncp.fsf@apache.org>
	<m2tyyvmeg5.fsf@apache.org>
Message-ID: <4ACC928D.9090907@lshift.net>

J Aaron Farr wrote:
> I suppose I could just use the dev server instance, but would someday
> really like to know why I can't get this to run on my OS X laptop.

It is an epmd issue, I think. Epmd interacts badly with the way OS X
changes its hostname depending on available network connections. I've
had enormous intermittent trouble getting Erlang's shortname-based
distribution mechanism to work consistently on OS X machines with wifi
enabled, for instance.

One workaround seems to be, for a machine named "gandalf", to add

127.0.0.1	gandalf gandalf.local

... to your /etc/hosts file and restart epmd. It's a total cludge, but
gets results. It *might* adversely affect other things, but so far I
haven't noticed any problems.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From matthias at lshift.net  Wed Oct  7 14:24:22 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 07 Oct 2009 14:24:22 +0100
Subject: [rabbitmq-discuss] Publish with immediate for dynamic worker
 creation?
In-Reply-To: <6a3ae47e0910070555s3a37d085g6eb748b7a4b780ec@mail.gmail.com>
References: <6a3ae47e0910070428s15fe897dkf4dad642534a67a1@mail.gmail.com>	<29598b610910070510x73be974eh7a18353d1c8815a8@mail.gmail.com>
	<6a3ae47e0910070555s3a37d085g6eb748b7a4b780ec@mail.gmail.com>
Message-ID: <4ACC9686.10009@lshift.net>

Robert,

Robert Raschke wrote:
> Setting the QoS prefetch-count to 1 in my workers leads to my desired 
> return notification. I can then set up a new worker and requeue the work 
> message. Works like a charm.

Glad to hear you got things to work. It's an interesting and novel use 
of the 'immediate' flag.

An alternative approach would be to monitor the queue length (e.g. by 
issuing a passive queue.declare) and create/destroy workers based on 
that information. That way queues can still do queuing, which helps in 
smoothing out temporary spikes.


Regards,

Matthias.



From pauljones23 at gmail.com  Wed Oct  7 14:42:09 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 7 Oct 2009 14:42:09 +0100
Subject: [rabbitmq-discuss] Return of 'getting started, broker runs;
	can't 	get status'
In-Reply-To: <4ACC928D.9090907@lshift.net>
References: <m21vlzl7y5.fsf@apache.org>
	<29598b610909220143s7f24bde7q8d3771eaaef9e8f9@mail.gmail.com>
	<m2skefjqyb.fsf@apache.org>
	<29598b610909220259y58b5958ds5eb49e615b94ca1d@mail.gmail.com>
	<m2ocp3jncp.fsf@apache.org> <m2tyyvmeg5.fsf@apache.org>
	<4ACC928D.9090907@lshift.net>
Message-ID: <29598b610910070642i7434004vccbbdd3460171b3f@mail.gmail.com>

On Wed, Oct 7, 2009 at 2:07 PM, Tony Garnock-Jones <tonyg at lshift.net> wrote:

>
> One workaround seems to be, for a machine named "gandalf", to add
>
> 127.0.0.1       gandalf gandalf.local
>
> ... to your /etc/hosts file and restart epmd. It's a total cludge, but
> gets results. It *might* adversely affect other things, but so far I
> haven't noticed any problems.
>

I've actually found that I got my OS X machine to respond quite sanely when
I used the Sharing Preference Panel to disable the "Use dynamic global
hostname" option (under Edit in the hostname section) - which tells it to
ignore names provided by DHCP servers.

Paul.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/f7907d2b/attachment.htm 

From tonyg at lshift.net  Wed Oct  7 16:13:53 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 07 Oct 2009 16:13:53 +0100
Subject: [rabbitmq-discuss] Return of 'getting started, broker runs;
 can't 	get status'
In-Reply-To: <29598b610910070642i7434004vccbbdd3460171b3f@mail.gmail.com>
References: <m21vlzl7y5.fsf@apache.org>	
	<29598b610909220143s7f24bde7q8d3771eaaef9e8f9@mail.gmail.com>	
	<m2skefjqyb.fsf@apache.org>	
	<29598b610909220259y58b5958ds5eb49e615b94ca1d@mail.gmail.com>	
	<m2ocp3jncp.fsf@apache.org> <m2tyyvmeg5.fsf@apache.org>	
	<4ACC928D.9090907@lshift.net>
	<29598b610910070642i7434004vccbbdd3460171b3f@mail.gmail.com>
Message-ID: <4ACCB031.9000109@lshift.net>

Paul Jones wrote:
> I've actually found that I got my OS X machine to respond quite sanely
> when I used the Sharing Preference Panel to disable the "Use dynamic
> global hostname" option (under Edit in the hostname section) - which
> tells it to ignore names provided by DHCP servers.

Fascinating! Thanks for the tip -- I'll try that out when I get home
tonight.

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From david.wragg at lshift.net  Wed Oct  7 16:15:58 2009
From: david.wragg at lshift.net (David Wragg)
Date: Wed, 07 Oct 2009 16:15:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 release
Message-ID: <k5bpkjute9.fsf@mrbraver.lshift.net>

An embedded and charset-unspecified text was scrubbed...
Name: README-1.7.0.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/3aaed239/attachment.txt 

From irrer at umich.edu  Wed Oct  7 16:20:07 2009
From: irrer at umich.edu (Jim Irrer)
Date: Wed, 7 Oct 2009 11:20:07 -0400
Subject: [rabbitmq-discuss] big transfers
Message-ID: <3b6ef0790910070820k2e0aca65p945b8f35e94993db@mail.gmail.com>

Hello -

Someone must have bumped into this problem before, but what is a
good strategy for transferring very large buffers (tens or even
hundreds of megabytes)?   No matter how the server is configured,
a message could be sent that is too large to handle.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/bb37d631/attachment.htm 

From rtrlists at googlemail.com  Wed Oct  7 16:34:20 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 7 Oct 2009 16:34:20 +0100
Subject: [rabbitmq-discuss] Publish with immediate for dynamic worker
	creation?
In-Reply-To: <4ACC9686.10009@lshift.net>
References: <6a3ae47e0910070428s15fe897dkf4dad642534a67a1@mail.gmail.com>
	<29598b610910070510x73be974eh7a18353d1c8815a8@mail.gmail.com>
	<6a3ae47e0910070555s3a37d085g6eb748b7a4b780ec@mail.gmail.com>
	<4ACC9686.10009@lshift.net>
Message-ID: <6a3ae47e0910070834k485ef75bo211e0b37f4e8fa@mail.gmail.com>

Hi Matthias,

On Wed, Oct 7, 2009 at 2:24 PM, Matthias Radestock <matthias at lshift.net>wrote:

> An alternative approach would be to monitor the queue length (e.g. by
> issuing a passive queue.declare) and create/destroy workers based on that
> information. That way queues can still do queuing, which helps in smoothing
> out temporary spikes.
>
>
> Regards,
>
> Matthias.
>

I was trying hard (maybe a little too hard :) not to have any busy loops in
my code.

Getting used to dynamic queues will take me a bit of time. It's ever so
slightly too flexible. I've read about various usage scenarios in various
blogs. But in general, they all tend to be a bit on the generic and vague
side. Does anyone have pointers to real life writeups? I guess I should
attempt to find time to write one myself, once my project is nearing
completion.

Thanks,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/303eb5cd/attachment.htm 

From holger.hoffstaette at googlemail.com  Wed Oct  7 16:41:10 2009
From: holger.hoffstaette at googlemail.com (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Wed, 07 Oct 2009 17:41:10 +0200
Subject: [rabbitmq-discuss] big transfers
In-Reply-To: <3b6ef0790910070820k2e0aca65p945b8f35e94993db@mail.gmail.com>
References: <3b6ef0790910070820k2e0aca65p945b8f35e94993db@mail.gmail.com>
Message-ID: <4ACCB696.8050007@googlemail.com>

Jim Irrer wrote:
> Someone must have bumped into this problem before, but what is a
> good strategy for transferring very large buffers (tens or even
> hundreds of megabytes)?   No matter how the server is configured,
> a message could be sent that is too large to handle.

The typical approach is to take the broker out of the critical path and
only send metadata, i.e. the necessary information for a client to
retrieve the payload: file path, url, encoding (e.g. compression), size
(to allow for up front allocation and possibly rejection in case the local
node is not up for it) etc. so that the consumer can pick up the big
message by itself.
This also implies that all clients need to be able to distinguish between
regular payloads and proxy messages, so adding this late to an
architecture can be difficult..

-h



From lynton.grice at logosworld.com  Wed Oct  7 17:59:33 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Wed, 7 Oct 2009 18:59:33 +0200
Subject: [rabbitmq-discuss] Erlang client for RabbitMQ 1.7.0?
Message-ID: <002901ca476f$8fa3f770$aeebe650$@grice@logosworld.com>

Hi there,

 

It is so awesome that RabbitMQ 1.7 is out now, great stuff!

 

What Erlang client can we use with this version? Is their one available yet?

 

Thanks again ;-)

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/064bb5eb/attachment.htm 

From david.wragg at lshift.net  Wed Oct  7 18:33:37 2009
From: david.wragg at lshift.net (David Wragg)
Date: Wed, 07 Oct 2009 18:33:37 +0100
Subject: [rabbitmq-discuss] Erlang client for RabbitMQ 1.7.0?
In-Reply-To: <002901ca476f$8fa3f770$aeebe650$@grice@logosworld.com> (Lynton
	Grice's message of "Wed\, 7 Oct 2009 18\:59\:33 +0200")
References: <002901ca476f$8fa3f770$aeebe650$@grice@logosworld.com>
Message-ID: <k5y6nnt8ge.fsf@mrbraver.lshift.net>

Hi Lynton,

"Lynton Grice" <lynton.grice at logosworld.com> writes:
> It is so awesome that RabbitMQ 1.7 is out now, great stuff!

Thanks!

> What Erlang client can we use with this version? Is their one available yet?

I think the answer is that the latest version in the default branch on
hg.rabbitmq.com should work.  But since the erlang client is not
currently included in our main releases, we haven't yet confirmed
this.  When we do, it will probably get tagged with rabbitmq_v1_7_0,
like the other repositories, to indicate the appropriate version to
use.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From irrer at umich.edu  Wed Oct  7 18:36:47 2009
From: irrer at umich.edu (Jim Irrer)
Date: Wed, 7 Oct 2009 13:36:47 -0400
Subject: [rabbitmq-discuss] big transfers
In-Reply-To: <4ACCB696.8050007@googlemail.com>
References: <3b6ef0790910070820k2e0aca65p945b8f35e94993db@mail.gmail.com>
	<4ACCB696.8050007@googlemail.com>
Message-ID: <3b6ef0790910071036r2bf2241ei1a82a9d6b8942af5@mail.gmail.com>

We're still developing our infrastructure, so that's not an issue.

Thanks.

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


2009/10/7 Holger Hoffst?tte <holger.hoffstaette at googlemail.com>

> Jim Irrer wrote:
> > Someone must have bumped into this problem before, but what is a
> > good strategy for transferring very large buffers (tens or even
> > hundreds of megabytes)?   No matter how the server is configured,
> > a message could be sent that is too large to handle.
>
> The typical approach is to take the broker out of the critical path and
> only send metadata, i.e. the necessary information for a client to
> retrieve the payload: file path, url, encoding (e.g. compression), size
> (to allow for up front allocation and possibly rejection in case the local
> node is not up for it) etc. so that the consumer can pick up the big
> message by itself.
> This also implies that all clients need to be able to distinguish between
> regular payloads and proxy messages, so adding this late to an
> architecture can be difficult..
>
> -h
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/cbe42ad0/attachment.htm 

From suhail at mixpanel.com  Wed Oct  7 20:00:00 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Wed, 7 Oct 2009 12:00:00 -0700
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <376f3e6f0910070327s687f012ck2f498c28e7d87f7f@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com> 
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com> 
	<376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com> 
	<376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com> 
	<269388e30910050403t6472a16p54f12247da26604d@mail.gmail.com> 
	<376f3e6f0910051423q5491e091rf9867b7cfc2f2d3@mail.gmail.com> 
	<269388e30910051430u27a4a8c5n56c7534ef8267be9@mail.gmail.com> 
	<167204d20910060345q12e83599pf6ad52950ef613a0@mail.gmail.com> 
	<376f3e6f0910070327s687f012ck2f498c28e7d87f7f@mail.gmail.com>
Message-ID: <376f3e6f0910071200k2bdd28bft43aa608a013262ab@mail.gmail.com>

Seems to have fixed the problem, I guess it was a bug in an older version of
erlang.
Suhail

On Wed, Oct 7, 2009 at 3:27 AM, Suhail Doshi <suhail at mixpanel.com> wrote:

> Running it now, will let you know the results of it--so far so good.
> Suhail
>
>
> On Tue, Oct 6, 2009 at 3:45 AM, Alexis Richardson <
> alexis.richardson at gmail.com> wrote:
>
>> Suhail
>>
>> Have you tried running this with the latest erlang client yet?
>>
>> alexis
>>
>>
>> On Mon, Oct 5, 2009 at 10:30 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>> > Suhail,
>> >
>> > On Mon, Oct 5, 2009 at 10:23 PM, Suhail Doshi <suhail at mixpanel.com>
>> wrote:
>> >> Anyone else seen this problem? Seems like an erlang thing not a
>> rabbitmq
>> >> thing.
>> >
>> > I've never seen it myself. But if you don't send some concise runnable
>> > code that reproduces the issue, you are not going to get much help
>> > much from anybody.
>> >
>> > Ben
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>>
>
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/d6348b81/attachment.htm 

From suhail at mixpanel.com  Wed Oct  7 20:00:30 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Wed, 7 Oct 2009 12:00:30 -0700
Subject: [rabbitmq-discuss] rabbitmq clustering
In-Reply-To: <167204d20910070359j6c9db9bctb127f59a387ab7a0@mail.gmail.com>
References: <376f3e6f0910011349w2947bd8bp262642c6d7e34c22@mail.gmail.com> 
	<167204d20910070359j6c9db9bctb127f59a387ab7a0@mail.gmail.com>
Message-ID: <376f3e6f0910071200w1e8b148ex95a4c79c3568100@mail.gmail.com>

No, I am still unsure how clustering actually works.
Suhail

On Wed, Oct 7, 2009 at 3:59 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Suhail
>
> Have you been able to resolve this?
>
> alexis
>
>
> On Thu, Oct 1, 2009 at 9:49 PM, Suhail Doshi <suhail at mixpanel.com> wrote:
> > One that was unclear to me in the clustering documentation is how you
> setup
> > consumers to work with clusters or if there even is any setup?
> > Does the consumer need to be aware of all the nodes in a cluster?
> > If not does the consumer just need to be hooked up to the node that the
> > other nodes are clustered around and things are automatically load
> balanced?
> > My consumers are connected to a single node right now, so is my producer.
> If
> > add nodes and cluster them around this node will rabbitmq handle all the
> > load balancing?
> > This seems a bit to magical to me and seems like both producers and
> > consumers would need to be aware of the nodes.
> > I am using the AMQP python lib
> > Suhail
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/cd9c4daa/attachment.htm 

From suhail at mixpanel.com  Wed Oct  7 20:03:59 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Wed, 7 Oct 2009 12:03:59 -0700
Subject: [rabbitmq-discuss] Python client for 1.7.0
Message-ID: <376f3e6f0910071203l167da6d6ga59535ddd6ed5cce@mail.gmail.com>

Does the existing one still work or is there going to be an update or one
already available?

Suhail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/44fc409f/attachment.htm 

From gmr at myyearbook.com  Wed Oct  7 20:05:56 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 7 Oct 2009 15:05:56 -0400
Subject: [rabbitmq-discuss] Python client for 1.7.0
In-Reply-To: <376f3e6f0910071203l167da6d6ga59535ddd6ed5cce@mail.gmail.com>
References: <376f3e6f0910071203l167da6d6ga59535ddd6ed5cce@mail.gmail.com>
Message-ID: <af1bce590910071205q551376d5j16c3cd2c5fead63f@mail.gmail.com>

I don't believe the protocol has changed (AMQP-8) so you shouldn't need to
change anything in the client library.
Gavin

On Wed, Oct 7, 2009 at 3:03 PM, Suhail Doshi <suhail at mixpanel.com> wrote:

> Does the existing one still work or is there going to be an update or one
> already available?
>
> Suhail
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/8c232b59/attachment.htm 

From majek04 at gmail.com  Wed Oct  7 20:49:45 2009
From: majek04 at gmail.com (majek04)
Date: Wed, 7 Oct 2009 20:49:45 +0100
Subject: [rabbitmq-discuss] Python client for 1.7.0
In-Reply-To: <af1bce590910071205q551376d5j16c3cd2c5fead63f@mail.gmail.com>
References: <376f3e6f0910071203l167da6d6ga59535ddd6ed5cce@mail.gmail.com>
	<af1bce590910071205q551376d5j16c3cd2c5fead63f@mail.gmail.com>
Message-ID: <3bb0d9710910071249j5ec30934kafb4c6292ffd6575@mail.gmail.com>

On Wed, Oct 7, 2009 at 20:05, Gavin M. Roy <gmr at myyearbook.com> wrote:
> I don't believe the protocol has changed (AMQP-8) so you shouldn't need to
> change anything in the client library.

That's right. We still use AMQP 0.8, so no client changes are required.
(Except for our .Net and Java clients, in which we suggest to upgrade,
as we made them better! )

Cheers!
   Marek



From bmurphy1976 at gmail.com  Wed Oct  7 21:40:23 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 7 Oct 2009 15:40:23 -0500
Subject: [rabbitmq-discuss] Job Server Resource Allocation Help
Message-ID: <7fd310d10910071340w18237fagf5855c93f8dbbd3c@mail.gmail.com>

We have paying and non-paying customers.  We want to have a pool of servers,
where a fixed percentage of the servers are dedicated to processing jobs
from paying customers only.  The remaining servers will process jobs from
both paying and non-paying customers on a first come first serve basis.

Each job is very CPU sensitive.  We never want more than one job running per
CPU, and each job should run one time.

Down the road, we'll want to dedicate servers to specific customers, but we
don't need to solve that now.

Is there a simple way to do this (using the .NET client)?

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/d423a7cc/attachment.htm 

From 0x6e6562 at gmail.com  Wed Oct  7 21:58:21 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 7 Oct 2009 21:58:21 +0100
Subject: [rabbitmq-discuss] Erlang client for RabbitMQ 1.7.0?
In-Reply-To: <-1057758097680386507@unknownmsgid>
References: <-1057758097680386507@unknownmsgid>
Message-ID: <269388e30910071358s4e40600bnb87255ce1a84139c@mail.gmail.com>

Lynton,

On Wed, Oct 7, 2009 at 5:59 PM, Lynton Grice
<lynton.grice at logosworld.com> wrote:
> What Erlang client can we use with this version? Is their one available yet?

Until the Erlang client is formally released, the answer is that the
current head of the default branch in the client will match the
current head of the default branch in the server.

As for compatibility with 1.7.0, I don't think there are any API
differences ATM, so you should be fine to give it a go.

Ben



From alexis.richardson at gmail.com  Wed Oct  7 22:02:44 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 7 Oct 2009 22:02:44 +0100
Subject: [rabbitmq-discuss] Job Server Resource Allocation Help
In-Reply-To: <7fd310d10910071340w18237fagf5855c93f8dbbd3c@mail.gmail.com>
References: <7fd310d10910071340w18237fagf5855c93f8dbbd3c@mail.gmail.com>
Message-ID: <167204d20910071402i1b233207o8f43b832f582c83a@mail.gmail.com>

Bryan

I assume each job should be completed at most once.

You can achieve something almost like what you want by creating two
queues.  Use one for "paying" and one for "non-paying" jobs by binding
each queue to the (direct) exchange using the keys "paying" and
"nonpaying" respectively.  Assign N servers to the "paying" queue.
Let the remainder consume from both queues using some selection scheme
(eg worker randomly chooses a queue each time a new job is needed).

Many other schemes are possible.  However trying to achieve some total
order (eg 'first come first serve') may be more complex than you
really need.

alexis



On Wed, Oct 7, 2009 at 9:40 PM, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
> We have paying and non-paying customers.? We want to have a pool of servers,
> where a fixed percentage of the servers are dedicated to processing jobs
> from paying customers only.? The remaining servers will process jobs from
> both paying and non-paying customers on a first come first serve basis.
>
> Each job is very CPU sensitive.? We never want more than one job running per
> CPU, and each job should run one time.
>
> Down the road, we'll want to dedicate servers to specific customers, but we
> don't need to solve that now.
>
> Is there a simple way to do this (using the .NET client)?
>
> Thanks,
> Bryan
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From bmurphy1976 at gmail.com  Wed Oct  7 22:18:15 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 7 Oct 2009 16:18:15 -0500
Subject: [rabbitmq-discuss] Job Server Resource Allocation Help
In-Reply-To: <167204d20910071402i1b233207o8f43b832f582c83a@mail.gmail.com>
References: <7fd310d10910071340w18237fagf5855c93f8dbbd3c@mail.gmail.com>
	<167204d20910071402i1b233207o8f43b832f582c83a@mail.gmail.com>
Message-ID: <7fd310d10910071418k366b1df6ia655583e7c27d71f@mail.gmail.com>

On Wed, Oct 7, 2009 at 4:02 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Bryan
>
> I assume each job should be completed at most once.
>

Ideally, yes.  Don't want to run 2-3 hour jobs more than necessary. :)


> You can achieve something almost like what you want by creating two
> queues.  Use one for "paying" and one for "non-paying" jobs by binding
> each queue to the (direct) exchange using the keys "paying" and
> "nonpaying" respectively.  Assign N servers to the "paying" queue.
> Let the remainder consume from both queues using some selection scheme
> (eg worker randomly chooses a queue each time a new job is needed).
>

I was thinking along those lines, but wanted to make sure I wasn't missing
something obvious.  That will require some coding on our end that I was
hoping to avoid.

Many other schemes are possible.  However trying to achieve some total
> order (eg 'first come first serve') may be more complex than you
> really need.
>
> alexis
>
>
Total order isn't necessary, we just want to make a good faith effort to
serve those who's requests came first.

I have a related question... BasicConsume has a "filter" parameter.  It's
been a few months since I read the AMQP spec.  I took a quick look online,
but couldn't find any good documentation.  What does that do (if anything)
and how do you use it?

Ideally, what I was originally fishing for was something like this:

Client:
  headers["paying"] = "true";
  bus.Send(message, headers);

Server A:
  bus.Receive(queue="jobs", filter="paying == 'true'");

Server B:
  bus.Receive(queue="jobs" /* no filter */);

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/1e704aea/attachment.htm 

From MVierling at attinteractive.com  Thu Oct  8 01:33:45 2009
From: MVierling at attinteractive.com (Michael Vierling)
Date: Wed, 7 Oct 2009 17:33:45 -0700
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 release
In-Reply-To: <k5bpkjute9.fsf@mrbraver.lshift.net>
References: <k5bpkjute9.fsf@mrbraver.lshift.net>
Message-ID: <313F3102E02BDA4B8D68829F0D34882805579962@SFOEXM01.YELLOWPAGES.LOCAL>

> Finally, there are a number of small bug fixes.

Will the bug fixes be ported to the still beta 1.6 branch?  When will
the 1.6 branch go into 'final' status?

> We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

Are you making this recommendation, even if the 1.7 status is beta?

Thanks,
Michael



From alexis.richardson at gmail.com  Thu Oct  8 08:21:08 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 8 Oct 2009 08:21:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 release
In-Reply-To: <313F3102E02BDA4B8D68829F0D34882805579962@SFOEXM01.YELLOWPAGES.LOCAL>
References: <k5bpkjute9.fsf@mrbraver.lshift.net>
	<313F3102E02BDA4B8D68829F0D34882805579962@SFOEXM01.YELLOWPAGES.LOCAL>
Message-ID: <167204d20910080021h1b608eb8jdb5bb188eeffee9d@mail.gmail.com>

Michael

Thank-you for your questions.  The way we use 'beta' is perhaps
slightly different from the expectation implied in your post.  We'd
love any advice you have on this and how to make our language clearer.

We have a reasonably frequent release cycle, making a 1.x release on
average every 3-4 months.  Sometimes there are even shorter gaps
between releases.  We have a pretty thorough QA process for these
releases, and push as many bug fixes into them as we can.  This is why
we recommend that people upgrade.  The "beta" status reflects the fact
that our QA process may not have caught everything,  Some users may
want to wait a few weeks (or longer) to see how others get on.

So we should probably have declared 1.6 "stable" by now.  It is
certainly seen as a stable release based on feedback.  But, it's never
going to contain all the changes that went into 1.7.

We are constrained in how many versions we can support, so the 1.x
upgrades will be the norm for the time being, rather than 1.x.y drops
every few weeks.  We can support specific builds commercially.

Please can you let us know what you think of this.  As I say, we want
to make everything clearer and better.

alexis



On Thu, Oct 8, 2009 at 1:33 AM, Michael Vierling
<MVierling at attinteractive.com> wrote:
>> Finally, there are a number of small bug fixes.
>
> Will the bug fixes be ported to the still beta 1.6 branch? ?When will
> the 1.6 branch go into 'final' status?
>
>> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
>
> Are you making this recommendation, even if the 1.7 status is beta?
>
> Thanks,
> Michael
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthew at lshift.net  Thu Oct  8 12:20:41 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 8 Oct 2009 12:20:41 +0100
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
 including swap, dying
In-Reply-To: <20091005100419.GA25365@mrnibble.lshift.net>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
	<20091005100419.GA25365@mrnibble.lshift.net>
Message-ID: <20091008112041.GA20401@wellquite.org>

Hi Brian,

On Mon, Oct 05, 2009 at 11:04:21AM +0100, Matthew Sackman wrote:
> However, if you just had billions of
> messages in there, then even in a non clustered setup, I could believe
> mnesia would be taking a long time to start up and that might cause the
> above error.

I've just come across this thread:
http://www.trapexit.org/forum/viewtopic.php?p=44433
which does indeed seem to support the idea that even modest mnesia
databases can take rather more than the 30 seconds we give them to
start up. Given that I would imagine this could happen even in v1.7
with, say, a couple million durable queues, exchanges and bindings,
this is certainly something we will look at as the 30 second timeout
may well be grossly too short.

Matthew



From mwilhelm at vz.net  Thu Oct  8 13:06:16 2009
From: mwilhelm at vz.net (Martin Wilhelm)
Date: Thu, 08 Oct 2009 14:06:16 +0200
Subject: [rabbitmq-discuss] Issues with rabbitmq and manual configured
	hostname
In-Reply-To: <4ACCF1B1.1070807@lshift.net>
References: <4ACCC4F3.2000807@vz.net> <4ACCF1B1.1070807@lshift.net>
Message-ID: <4ACDD5B8.7060800@vz.net>

Hi Rabbits,

I had tried rabbitmq-1.7.0 with the following
config:

[root at lnxv-3339:~]$ cat /etc/rabbitmq/rabbitmq.conf
NODENAME=wico at localhost
RABBITMQ_MNESIA_BASE=/data/netapp/config/tmp/rabbitmq-DB/mnesia

localhost is listed in /etc/hosts

If I start rabbitmq, odd things are happen:

========================= >% ===========================

[root at lnxv-3339:~]$ Erlang has closed
/etc/init.d/rabbitmq-server start
Starting rabbitmq-server: Starting all nodes...
Starting node wico at localhost@lnxv-3339...

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.0  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : wico at localhost
app descriptor:
/usr/lib64/rabbitmq/lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : XVo5QytTWAtzrwBowsFu3A==
log           : /var/log/rabbitmq/wico at localhost.log
sasl log      : /var/log/rabbitmq/wico at localhost-sasl.log
database dir  : /data/netapp/config/tmp/rabbitmq-DB/mnesia/wico at localhost

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running

Error: cannot_get_pid
FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.


========================= >% ===========================

Again: cannot_get_pid, but the queue is running (we can
connect etc.). We need a "positive result" if rabbitmq
is started. For now we get an exit != 0 (cannot_get_pid).

With Version 1.7.0 rabbitmqctl status gives:

========================= >% ===========================

[root at lnxv-3339:~]$ rabbitmqctl -n wico at localhost status
Status of node wico at localhost ...
[{running_applications,[{rabbit,"RabbitMQ","1.7.0"},
                           {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                           {os_mon,"CPO  CXC 138 46","2.1.8"},
                           {sasl,"SASL  CXC 138 11","2.1.5.4"},
                           {stdlib,"ERTS  CXC 138 10","1.15.5"},
                           {kernel,"ERTS  CXC 138 10","2.12.5"}]},
    {nodes,[wico at localhost]},
    {running_nodes,[wico at localhost]}]
...done.

========================= >% ===========================

This seems to be ok now.

Again - I'm unable to stop rabbitmq correctly:

========================= >% ===========================

[root at lnxv-3339:~]$ /usr/sbin/rabbitmq-multi stop_all
Stopping all nodes...
Error: no_nodes_running

========================= >% ===========================

But there are nodes running as rabbitmqctl shows (and
we can connect to). ;)


Can someone give me a hint?
Sorry for going like a bull at a gate...



Greetings,
Martin


VZnet Netzwerke Ltd. || Saarbr?cker Str. 38 || D - 10405 Berlin


MWilhelm at vz.net


VZnet Netzwerke Limited, Registered Office Berlin, Registration Court Charlottenburg, HRB 101454
Executive Directors: Markus Berger-de Le?n, Clemens Riedl
Non-Executive Directors: Dr. Jochen Gutbrod, Martin Weber, Claas van Delden
Headquarters: VZnet Netzwerke Limited, 5 New Street Square, London EC4A 3TW, United Kingdom
Companies House Cardiff No. 5607971, Place of Registration: England and Wales




From majek04 at gmail.com  Thu Oct  8 14:49:34 2009
From: majek04 at gmail.com (majek04)
Date: Thu, 8 Oct 2009 14:49:34 +0100
Subject: [rabbitmq-discuss] Issues with rabbitmq and manual configured
	hostname
In-Reply-To: <4ACDD5B8.7060800@vz.net>
References: <4ACCC4F3.2000807@vz.net> <4ACCF1B1.1070807@lshift.net>
	<4ACDD5B8.7060800@vz.net>
Message-ID: <3bb0d9710910080649h694ea448q1e960ed6d5563702@mail.gmail.com>

On Thu, Oct 8, 2009 at 13:06, Martin Wilhelm <mwilhelm at vz.net> wrote:
> Hi Rabbits,
>
> I had tried rabbitmq-1.7.0 with the following
> config:
>
> [root at lnxv-3339:~]$ cat /etc/rabbitmq/rabbitmq.conf
> NODENAME=wico at localhost
> RABBITMQ_MNESIA_BASE=/data/netapp/config/tmp/rabbitmq-DB/mnesia

Hi!

First, I think you should use RABBITMQ_NODENAME instead of NODENAME.
This shouldn't make much difference, but it's preferred.

Second, we set the nodename using erlang "-sname" short name option.
This mean that you shouldn't use "@" notation. In your case specifying
"RABBITMQ_NODENAME=wico" might work. Here are some details:
http://www.erlang.org/doc/reference_manual/distributed.html#11.2


Hope that helps.

Marek Majkowski



From tonyg at lshift.net  Thu Oct  8 15:05:02 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 08 Oct 2009 15:05:02 +0100
Subject: [rabbitmq-discuss] AMQP's message ordering guarantees are stupid
 (was Re: Job Server Resource Allocation Help)
In-Reply-To: <7fd310d10910071418k366b1df6ia655583e7c27d71f@mail.gmail.com>
References: <7fd310d10910071340w18237fagf5855c93f8dbbd3c@mail.gmail.com>	<167204d20910071402i1b233207o8f43b832f582c83a@mail.gmail.com>
	<7fd310d10910071418k366b1df6ia655583e7c27d71f@mail.gmail.com>
Message-ID: <4ACDF18E.9020504@lshift.net>

Bryan Murphy wrote:
> Total order isn't necessary, we just want to make a good faith effort to
> serve those who's requests came first.

Many, many, many people are in this situation. To me, it's the situation
AMQP should be designed to accommodate.

I get more and more annoyed with the AMQP spec's insistence on
preserving perfect ordering (given some heavily caveated list of
preconditions, of course!). My preference would be for the sum total of
the spec's input on the ordering question to read something along the
lines of "brokers SHOULD preserve relative message ordering where possible."

Requiring any kind of strict order preservation leads to complexity,
inefficiency, and scaling bottlenecks in the broker, not to mention
nasty surprises for application developers down the line when they
discover the (common but underadvertised!) corner cases where AMQP
*cannot* preserve message ordering. Explicit is better than implicit,
after all! Those who rely on the broker preserving perfect (rather than
rough/best-effort!) ordering are kind of doomed.

I should totally blog about this rather than ranting in the mailing list :-)

Tony




From tonyg at lshift.net  Thu Oct  8 15:08:27 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 08 Oct 2009 15:08:27 +0100
Subject: [rabbitmq-discuss] Job Server Resource Allocation Help
In-Reply-To: <7fd310d10910071418k366b1df6ia655583e7c27d71f@mail.gmail.com>
References: <7fd310d10910071340w18237fagf5855c93f8dbbd3c@mail.gmail.com>	<167204d20910071402i1b233207o8f43b832f582c83a@mail.gmail.com>
	<7fd310d10910071418k366b1df6ia655583e7c27d71f@mail.gmail.com>
Message-ID: <4ACDF25B.1000903@lshift.net>

But to answer your question, Bryan:

Bryan Murphy wrote:
> I have a related question... BasicConsume has a "filter" parameter. 
> It's been a few months since I read the AMQP spec.  I took a quick look
> online, but couldn't find any good documentation.  What does that do (if
> anything) and how do you use it? 

It is unspecified. QPid, I believe, uses it to implement JMS-style
message selectors. We don't currently do anything with it (mostly
because of the question "how on earth should one interpret what's put in
there anyway"). I think people were headed in the direction of
specifying some kind of SQL92-like predicate language for use there. Ick.

> Ideally, what I was originally fishing for was something like this:
> 
> Client:
>   headers["paying"] = "true";
>   bus.Send(message, headers);
> Server A:
>   bus.Receive(queue="jobs", filter="paying == 'true'");
> Server B:
>   bus.Receive(queue="jobs" /* no filter */);

Yes I think that was the original intent. For now, consider it for
experimental use only, I suppose.

(For your use case, what's to stop people falsely advertising that they
are paying customers when they submit jobs? Hmm that reminds me of the
idea of getting the broker to securely annotate messages with some
unforgeable ID stamp that was discussed on this list some time ago...)

Tony



From matthias at lshift.net  Thu Oct  8 15:18:22 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 08 Oct 2009 15:18:22 +0100
Subject: [rabbitmq-discuss] Issues with rabbitmq and manual configured
 hostname
In-Reply-To: <3bb0d9710910080649h694ea448q1e960ed6d5563702@mail.gmail.com>
References: <4ACCC4F3.2000807@vz.net>
	<4ACCF1B1.1070807@lshift.net>	<4ACDD5B8.7060800@vz.net>
	<3bb0d9710910080649h694ea448q1e960ed6d5563702@mail.gmail.com>
Message-ID: <4ACDF4AE.60606@lshift.net>

majek04 wrote:
> On Thu, Oct 8, 2009 at 13:06, Martin Wilhelm <mwilhelm at vz.net> wrote:
>> [root at lnxv-3339:~]$ cat /etc/rabbitmq/rabbitmq.conf
>> NODENAME=wico at localhost
>> RABBITMQ_MNESIA_BASE=/data/netapp/config/tmp/rabbitmq-DB/mnesia
> 
> First, I think you should use RABBITMQ_NODENAME instead of NODENAME.
> This shouldn't make much difference, but it's preferred.

err, quite the opposite. Settings in rabbitmq.conf should not have the 
RABBITMQ_ prefix. That way one can still override the settings from the 
command line.

> Second, we set the nodename using erlang "-sname" short name option.
> This mean that you shouldn't use "@" notation. In your case specifying
> "RABBITMQ_NODENAME=wico" might work.

Indeed the scripts assume that the @ suffix is absent.

The reason Martin wants to set the node name to <something>@localhost is 
so that it remains the same when failing over to a different machine.

It would be quite easy to change the scripts (well, actually the erlang 
code behind them) to accept suffixed node names. I will file a bug for that.


Matthias.



From mwilhelm at vz.net  Thu Oct  8 16:19:01 2009
From: mwilhelm at vz.net (Martin Wilhelm)
Date: Thu, 08 Oct 2009 17:19:01 +0200
Subject: [rabbitmq-discuss] Issues with rabbitmq and manual configured
	hostname
In-Reply-To: <4ACDF4AE.60606@lshift.net>
References: <4ACCC4F3.2000807@vz.net>	<4ACCF1B1.1070807@lshift.net>	<4ACDD5B8.7060800@vz.net>	<3bb0d9710910080649h694ea448q1e960ed6d5563702@mail.gmail.com>
	<4ACDF4AE.60606@lshift.net>
Message-ID: <4ACE02E5.4080005@vz.net>

Matthias Radestock wrote:

> The reason Martin wants to set the node name to <something>@localhost is 
> so that it remains the same when failing over to a different machine.
> 
> It would be quite easy to change the scripts (well, actually the erlang 
> code behind them) to accept suffixed node names. I will file a bug for that.

Yes, this is the point.


Martin
VZnet Netzwerke Ltd. || Saarbr?cker Str. 38 || D - 10405 Berlin


MWilhelm at vz.net


VZnet Netzwerke Limited, Registered Office Berlin, Registration Court Charlottenburg, HRB 101454
Executive Directors: Markus Berger-de Le?n, Clemens Riedl
Non-Executive Directors: Dr. Jochen Gutbrod, Martin Weber, Claas van Delden
Headquarters: VZnet Netzwerke Limited, 5 New Street Square, London EC4A 3TW, United Kingdom
Companies House Cardiff No. 5607971, Place of Registration: England and Wales




From ted.slusser at vanderbilt.edu  Thu Oct  8 17:46:34 2009
From: ted.slusser at vanderbilt.edu (Ted Slusser)
Date: Thu, 8 Oct 2009 11:46:34 -0500
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
Message-ID: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>

Hello,

I am attempting to install 1.7.0-1 on debian using apt-get.

After it installs I get an error:

Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/ 
startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
  subprocess post-installation script returned error exit status 1
Errors were encountered while processing:
  rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)

And I have an erl_crash.dump in /var/lib/rabbitmq.

Unfortunately, I'm stuck.  I haven't got a clue how to determine the  
cause of the erl_crash.dump.

Can anyone assist?

Thanks,
Ted




From david.wragg at lshift.net  Thu Oct  8 17:57:30 2009
From: david.wragg at lshift.net (David Wragg)
Date: Thu, 08 Oct 2009 17:57:30 +0100
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
In-Reply-To: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu> (Ted
	Slusser's message of "Thu\, 8 Oct 2009 11\:46\:34 -0500")
References: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>
Message-ID: <k5vdipsu11.fsf@mrbraver.lshift.net>

Hi Ted,

Ted Slusser <ted.slusser at vanderbilt.edu> writes:
> After it installs I get an error:
>
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/ 
> startup_log, _err
> rabbitmq-server.
> invoke-rc.d: initscript rabbitmq-server, action "start" failed.
> dpkg: error processing rabbitmq-server (--configure):
>   subprocess post-installation script returned error exit status 1
> Errors were encountered while processing:
>   rabbitmq-server
> E: Sub-process /usr/bin/dpkg returned an error code (1)
>
> And I have an erl_crash.dump in /var/lib/rabbitmq.
>
> Unfortunately, I'm stuck.  I haven't got a clue how to determine the  
> cause of the erl_crash.dump.
>
> Can anyone assist?

Which version of Debian are you using, and is this a fresh install of
rabbitmq-server, or is it an upgrade (and if the latter, from which
version)?

Also, could you senattach the /var/log/rabbitmq/startup_* files, and
the erl_crash.dump file?

Thanks,
David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From suhail at mixpanel.com  Thu Oct  8 18:19:25 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Thu, 8 Oct 2009 10:19:25 -0700
Subject: [rabbitmq-discuss] Producer eating up RAM
In-Reply-To: <376f3e6f0910071200k2bdd28bft43aa608a013262ab@mail.gmail.com>
References: <376f3e6f0910041243h755b2b8l409f2cbd8b15019@mail.gmail.com> 
	<269388e30910041417v4f8a2082qc0800db64d1b22@mail.gmail.com> 
	<376f3e6f0910041803w3c0f1930w1bcec749a7c83e91@mail.gmail.com> 
	<376f3e6f0910041808q75d5207dhaccb8b912418f117@mail.gmail.com> 
	<269388e30910050403t6472a16p54f12247da26604d@mail.gmail.com> 
	<376f3e6f0910051423q5491e091rf9867b7cfc2f2d3@mail.gmail.com> 
	<269388e30910051430u27a4a8c5n56c7534ef8267be9@mail.gmail.com> 
	<167204d20910060345q12e83599pf6ad52950ef613a0@mail.gmail.com> 
	<376f3e6f0910070327s687f012ck2f498c28e7d87f7f@mail.gmail.com> 
	<376f3e6f0910071200k2bdd28bft43aa608a013262ab@mail.gmail.com>
Message-ID: <376f3e6f0910081019r23983b57m925aa5671b75e25c@mail.gmail.com>

I replied to this too soon and sadly is still a problem. Will post code
later.
Suhail

On Wed, Oct 7, 2009 at 12:00 PM, Suhail Doshi <suhail at mixpanel.com> wrote:

> Seems to have fixed the problem, I guess it was a bug in an older version
> of erlang.
> Suhail
>
>
> On Wed, Oct 7, 2009 at 3:27 AM, Suhail Doshi <suhail at mixpanel.com> wrote:
>
>> Running it now, will let you know the results of it--so far so good.
>> Suhail
>>
>>
>> On Tue, Oct 6, 2009 at 3:45 AM, Alexis Richardson <
>> alexis.richardson at gmail.com> wrote:
>>
>>> Suhail
>>>
>>> Have you tried running this with the latest erlang client yet?
>>>
>>> alexis
>>>
>>>
>>> On Mon, Oct 5, 2009 at 10:30 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>>> > Suhail,
>>> >
>>> > On Mon, Oct 5, 2009 at 10:23 PM, Suhail Doshi <suhail at mixpanel.com>
>>> wrote:
>>> >> Anyone else seen this problem? Seems like an erlang thing not a
>>> rabbitmq
>>> >> thing.
>>> >
>>> > I've never seen it myself. But if you don't send some concise runnable
>>> > code that reproduces the issue, you are not going to get much help
>>> > much from anybody.
>>> >
>>> > Ben
>>> >
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>>
>>
>>
>>
>> --
>> http://mixpanel.com
>> Blog: http://blog.mixpanel.com
>>
>
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091008/e4c2f7c8/attachment.htm 

From ted.slusser at vanderbilt.edu  Thu Oct  8 20:02:36 2009
From: ted.slusser at vanderbilt.edu (Ted Slusser)
Date: Thu, 8 Oct 2009 14:02:36 -0500
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
In-Reply-To: <k5vdipsu11.fsf@mrbraver.lshift.net>
References: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>
	<k5vdipsu11.fsf@mrbraver.lshift.net>
Message-ID: <810D5BA3-E5F1-4569-941D-D2C30FEBC58B@vanderbilt.edu>

Hi David,

It is "lenny" version of Debian.

uname -a gives:

Linux edisubu4.mc.vanderbilt.edu 2.6.18.xs4.0.1.900.5799 #2 SMP Mon  
Aug 13 13:56:47 UTC 2007 i686 GNU/Linux

I got the error upon performing an upgrade of rabbitmq-server from 1.5 
(?) so I uninstalled completely rabbit.  I also uninstalled and re- 
installed erlang-base.  Also I did apt-get dist-upgrade to make sure  
all my deps were 'fresh'.

Please see attached zipFile for logs and erl_crash.dump.  My smtp  
server won't allow .zip extensions so please rename the file if  
necessary.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Archive.zipFile
Type: application/octet-stream
Size: 87801 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091008/3f4d85c5/attachment.obj 
-------------- next part --------------


Thanks,

Ted


On Oct 8, 2009, at 11:57 AM, David Wragg wrote:

> Hi Ted,
>
> Ted Slusser <ted.slusser at vanderbilt.edu> writes:
>> After it installs I get an error:
>>
>> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/
>> startup_log, _err
>> rabbitmq-server.
>> invoke-rc.d: initscript rabbitmq-server, action "start" failed.
>> dpkg: error processing rabbitmq-server (--configure):
>>  subprocess post-installation script returned error exit status 1
>> Errors were encountered while processing:
>>  rabbitmq-server
>> E: Sub-process /usr/bin/dpkg returned an error code (1)
>>
>> And I have an erl_crash.dump in /var/lib/rabbitmq.
>>
>> Unfortunately, I'm stuck.  I haven't got a clue how to determine the
>> cause of the erl_crash.dump.
>>
>> Can anyone assist?
>
> Which version of Debian are you using, and is this a fresh install of
> rabbitmq-server, or is it an upgrade (and if the latter, from which
> version)?
>
> Also, could you senattach the /var/log/rabbitmq/startup_* files, and
> the erl_crash.dump file?
>
> Thanks,
> David
>
> -- 
> [][][] David Wragg       | mail: david.wragg at lshift.net
>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
> []  [] LShift Ltd        | web: www.lshift.net


From matthias at lshift.net  Thu Oct  8 20:23:33 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 08 Oct 2009 20:23:33 +0100
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
In-Reply-To: <810D5BA3-E5F1-4569-941D-D2C30FEBC58B@vanderbilt.edu>
References: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>	<k5vdipsu11.fsf@mrbraver.lshift.net>
	<810D5BA3-E5F1-4569-941D-D2C30FEBC58B@vanderbilt.edu>
Message-ID: <4ACE3C35.1090200@lshift.net>

Ted,

Ted Slusser wrote:
> I got the error upon performing an upgrade of rabbitmq-server from 
> 1.5(?) so I uninstalled completely rabbit.  I also uninstalled and 
> re-installed erlang-base.  Also I did apt-get dist-upgrade to make sure 
> all my deps were 'fresh'.

It looks like your Erlang install doesn't have crypto enabled.

What version of Erlang did you install?

Are you sure that all of rabbitmq's erlang package dependencies are met? 
Here's what the debian control file says:

erlang-base | erlang-base-hipe, erlang-ssl | erlang-nox (<< 
1:13.b-dfsg1-1), erlang-os-mon | erlang-nox (<< 1:13.b-dfsg1-1), 
erlang-mnesia | erlang-nox (<< 1:13.b-dfsg1-1)


Regards,

Matthias.



From ted.slusser at vanderbilt.edu  Thu Oct  8 20:29:57 2009
From: ted.slusser at vanderbilt.edu (Ted Slusser)
Date: Thu, 8 Oct 2009 14:29:57 -0500
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
In-Reply-To: <4ACE3C35.1090200@lshift.net>
References: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>	<k5vdipsu11.fsf@mrbraver.lshift.net>
	<810D5BA3-E5F1-4569-941D-D2C30FEBC58B@vanderbilt.edu>
	<4ACE3C35.1090200@lshift.net>
Message-ID: <88D3B9CA-9C5B-4D2A-841D-D4203082C5DF@vanderbilt.edu>

Here is what I have for erlang
slusset at edisubu4:~$ sudo dpkg -l | grep erlang
ii  erlang                               1:12.b.3- 
dfsg-4                               Concurrent, real-time,  
distributed functiona
ii  erlang-base                          1:12.b.3- 
dfsg-4                               Concurrent, real-time,  
distributed functiona
ii  erlang-dev                           1:12.b.3- 
dfsg-4                               Concurrent, real-time,  
distributed functiona
ii  erlang-examples                      1:12.b.3- 
dfsg-4                               Concurrent, real-time,  
distributed functiona
ii  erlang-mode                          1:12.b.3- 
dfsg-4                               Concurrent, real-time,  
distributed functiona
ii  erlang-nox                           1:12.b.3- 
dfsg-4                               Concurrent, real-time,  
distributed functiona
ii  erlang-src                           1:12.b.3- 
dfsg-4                               Concurrent, real-time,  
distributed functiona
ii  erlang-x11                           1:12.b.3- 
dfsg-4                               Concurrent, real-time,  
distributed functiona


When I try to install erlang-ssl I get this:

slusset at edisubu4:~$ sudo apt-get install erlang-ssl
Reading package lists... Done
Building dependency tree
Reading state information... Done
Package erlang-ssl is not available, but is referred to by another  
package.
This may mean that the package is missing, has been obsoleted, or
is only available from another source
E: Package erlang-ssl has no installation candidate

I'm looking for a source that has this package.  Here's my sources.list:

slusset at edisubu4:~$ cat /etc/apt/sources.list
deb http://security.debian.org/ lenny/updates main

deb http://ftp.debian.org/debian lenny main
deb-src http://ftp.debian.org/debian lenny main

deb http://ftp.debian.org/debian etch-proposed-updates main

deb http://www.rabbitmq.com/debian/ testing main

Any thoughts on where I can get erlang-ssl?

Thanks,
Ted

On Oct 8, 2009, at 2:23 PM, Matthias Radestock wrote:

> Ted,
>
> Ted Slusser wrote:
>> I got the error upon performing an upgrade of rabbitmq-server from  
>> 1.5(?) so I uninstalled completely rabbit.  I also uninstalled and  
>> re-installed erlang-base.  Also I did apt-get dist-upgrade to make  
>> sure all my deps were 'fresh'.
>
> It looks like your Erlang install doesn't have crypto enabled.
>
> What version of Erlang did you install?
>
> Are you sure that all of rabbitmq's erlang package dependencies are  
> met? Here's what the debian control file says:
>
> erlang-base | erlang-base-hipe, erlang-ssl | erlang-nox (<< 1:13.b- 
> dfsg1-1), erlang-os-mon | erlang-nox (<< 1:13.b-dfsg1-1), erlang- 
> mnesia | erlang-nox (<< 1:13.b-dfsg1-1)
>
>
> Regards,
>
> Matthias.




From ted.slusser at vanderbilt.edu  Thu Oct  8 21:15:15 2009
From: ted.slusser at vanderbilt.edu (Ted Slusser)
Date: Thu, 8 Oct 2009 15:15:15 -0500
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
In-Reply-To: <88D3B9CA-9C5B-4D2A-841D-D4203082C5DF@vanderbilt.edu>
References: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>	<k5vdipsu11.fsf@mrbraver.lshift.net>
	<810D5BA3-E5F1-4569-941D-D2C30FEBC58B@vanderbilt.edu>
	<4ACE3C35.1090200@lshift.net>
	<88D3B9CA-9C5B-4D2A-841D-D4203082C5DF@vanderbilt.edu>
Message-ID: <0DC7F20A-BD89-44AA-9801-11228704C495@vanderbilt.edu>

Now I have updated erlang and I have the following:

ii  erlang-appmon                        1:13.b.2.1-dfsg
ii  erlang-asn1                          1:13.b.2.1-dfsg
ii  erlang-base                          1:13.b.2.1-dfsg
ii  erlang-common-test                   1:13.b.2.1-dfsg
ii  erlang-corba                         1:13.b.2.1-dfsg
ii  erlang-crypto                        1:13.b.2.1-dfsg
ii  erlang-debugger                      1:13.b.2.1-dfsg
ii  erlang-dialyzer                      1:13.b.2.1-dfsg
ii  erlang-docbuilder                    1:13.b.2.1-dfsg
ii  erlang-edoc                          1:13.b.2.1-dfsg
ii  erlang-et                            1:13.b.2.1-dfsg
ii  erlang-eunit                         1:13.b.2.1-dfsg
ii  erlang-gs                            1:13.b.2.1-dfsg
ii  erlang-ic                            1:13.b.2.1-dfsg
ii  erlang-inets                         1:13.b.2.1-dfsg
ii  erlang-inviso                        1:13.b.2.1-dfsg
ii  erlang-megaco                        1:13.b.2.1-dfsg
ii  erlang-mnesia                        1:13.b.2.1-dfsg
rc  erlang-mode                          1:12.b.3-dfsg
ii  erlang-observer                      1:13.b.2.1-dfsg
ii  erlang-odbc                          1:13.b.2.1-dfsg
ii  erlang-os-mon                        1:13.b.2.1-dfsg
ii  erlang-parsetools                    1:13.b.2.1-dfsg
ii  erlang-percept                       1:13.b.2.1-dfsg
ii  erlang-pman                          1:13.b.2.1-dfsg
ii  erlang-public-key                    1:13.b.2.1-dfsg
ii  erlang-reltool                       1:13.b.2.1-dfsg
ii  erlang-runtime-tools                 1:13.b.2.1-dfsg
ii  erlang-snmp                          1:13.b.2.1-dfsg
ii  erlang-ssh                           1:13.b.2.1-dfsg
ii  erlang-ssl                           1:13.b.2.1-dfsg
ii  erlang-syntax-tools                  1:13.b.2.1-dfsg
ii  erlang-test-server                   1:13.b.2.1-dfsg
ii  erlang-toolbar                       1:13.b.2.1-dfsg
ii  erlang-tools                         1:13.b.2.1-dfsg
ii  erlang-tv                            1:13.b.2.1-dfsg
ii  erlang-typer                         1:13.b.2.1-dfsg
ii  erlang-webtool                       1:13.b.2.1-dfsg
ii  erlang-wx                            1:13.b.2.1-dfsg
ii  erlang-xmerl                         1:13.b.2.1-dfsg

But I am still getting a erl_crash.dump when attempting to install  
rabbitmq-server.

:(

-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump.zipFile
Type: application/octet-stream
Size: 87004 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091008/ec448507/attachment.obj 
-------------- next part --------------


Any advice on how to interpret the erl_crash.dump?

Thanks,
Ted


From matthias at lshift.net  Thu Oct  8 21:39:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 08 Oct 2009 21:39:21 +0100
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
In-Reply-To: <0DC7F20A-BD89-44AA-9801-11228704C495@vanderbilt.edu>
References: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>	<k5vdipsu11.fsf@mrbraver.lshift.net>	<810D5BA3-E5F1-4569-941D-D2C30FEBC58B@vanderbilt.edu>	<4ACE3C35.1090200@lshift.net>	<88D3B9CA-9C5B-4D2A-841D-D4203082C5DF@vanderbilt.edu>
	<0DC7F20A-BD89-44AA-9801-11228704C495@vanderbilt.edu>
Message-ID: <4ACE4DF9.5030407@lshift.net>

Ted,

Ted Slusser wrote:
> Now I have updated erlang and [...]
> But I am still getting a erl_crash.dump when attempting to install 
> rabbitmq-server.
> [...]
> Any advice on how to interpret the erl_crash.dump?

Usually there is enough info the startup logs, so you don't have to look 
at the crash dump. Are the logs still complaining about ssl? If so, 
check that you have openssl installed.


Regards,

Matthias.



From david.wragg at lshift.net  Thu Oct  8 21:50:52 2009
From: david.wragg at lshift.net (David Wragg)
Date: Thu, 08 Oct 2009 21:50:52 +0100
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
In-Reply-To: <0DC7F20A-BD89-44AA-9801-11228704C495@vanderbilt.edu> (Ted
	Slusser's message of "Thu\, 8 Oct 2009 15\:15\:15 -0500")
References: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>
	<k5vdipsu11.fsf@mrbraver.lshift.net>
	<810D5BA3-E5F1-4569-941D-D2C30FEBC58B@vanderbilt.edu>
	<4ACE3C35.1090200@lshift.net>
	<88D3B9CA-9C5B-4D2A-841D-D4203082C5DF@vanderbilt.edu>
	<0DC7F20A-BD89-44AA-9801-11228704C495@vanderbilt.edu>
Message-ID: <k53a5t8v9v.fsf@mrbraver.lshift.net>

Hi Ted,

Ted Slusser <ted.slusser at vanderbilt.edu> writes:
> Now I have updated erlang and I have the following:
>
> ii  erlang-appmon                        1:13.b.2.1-dfsg
> [...]
> ii  erlang-xmerl                         1:13.b.2.1-dfsg
>
> But I am still getting a erl_crash.dump when attempting to install
> rabbitmq-server.

I'm not sure why you have erlang/OTP R13B on a lenny machine.  Lenny
still includes erlang/OTP R12B.  I have a lenny system with rabbit
working, and here's the full list of erlang packages I have installed:

ii  erlang-base                       1:12.b.3-dfsg-4
ii  erlang-nox                        1:12.b.3-dfsg-4

Your list look more like the set of erlang packages I would expect to
see on a Debian unstable (sid) machine, which includes erlang R13B and
has it broken down into a large number of packages, as in your list.

Note that on lenny, you *shoudn't* have a erlang-ssl package - that
component is included in one of the two packages above.

I suspect that this erlang installation is not working quite
correctly, and that is leading to the rabbitmq problem.

I suggest that you remove all erlang packages, as well as
rabbitmq-server, and start again.  If apt-get installs something other
than the two erlang packages I mentioned above, you probably have an
issue in your apt configuration.

> Any advice on how to interpret the erl_crash.dump?

The /var/log/rabbit/startup_* files are usually the best place to look
to diagnose problems with rabbitmq-server, and we need to see those to
understand files what going on.  The erl_crash.dump file sometimes
gives useful context, but it contains a lot of information which is
uninteresting in most cases.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From ted.slusser at vanderbilt.edu  Thu Oct  8 22:04:02 2009
From: ted.slusser at vanderbilt.edu (Ted Slusser)
Date: Thu, 8 Oct 2009 16:04:02 -0500
Subject: [rabbitmq-discuss] Install 1.7 on debian with apt-get
In-Reply-To: <k53a5t8v9v.fsf@mrbraver.lshift.net>
References: <0C63648E-A5AE-412A-8FE2-A1BA499A4910@vanderbilt.edu>
	<k5vdipsu11.fsf@mrbraver.lshift.net>
	<810D5BA3-E5F1-4569-941D-D2C30FEBC58B@vanderbilt.edu>
	<4ACE3C35.1090200@lshift.net>
	<88D3B9CA-9C5B-4D2A-841D-D4203082C5DF@vanderbilt.edu>
	<0DC7F20A-BD89-44AA-9801-11228704C495@vanderbilt.edu>
	<k53a5t8v9v.fsf@mrbraver.lshift.net>
Message-ID: <F3335406-987C-4C55-99D5-9DE27CA374D2@vanderbilt.edu>

Hi,

I was able to get it running on a different lenny box.  I will now  
compare differences between the two.  Thanks for the assistance.

Ted

On Oct 8, 2009, at 3:50 PM, David Wragg wrote:

> Hi Ted,
>
> Ted Slusser <ted.slusser at vanderbilt.edu> writes:
>> Now I have updated erlang and I have the following:
>>
>> ii  erlang-appmon                        1:13.b.2.1-dfsg
>> [...]
>> ii  erlang-xmerl                         1:13.b.2.1-dfsg
>>
>> But I am still getting a erl_crash.dump when attempting to install
>> rabbitmq-server.
>
> I'm not sure why you have erlang/OTP R13B on a lenny machine.  Lenny
> still includes erlang/OTP R12B.  I have a lenny system with rabbit
> working, and here's the full list of erlang packages I have installed:
>
> ii  erlang-base                       1:12.b.3-dfsg-4
> ii  erlang-nox                        1:12.b.3-dfsg-4
>
> Your list look more like the set of erlang packages I would expect to
> see on a Debian unstable (sid) machine, which includes erlang R13B and
> has it broken down into a large number of packages, as in your list.
>
> Note that on lenny, you *shoudn't* have a erlang-ssl package - that
> component is included in one of the two packages above.
>
> I suspect that this erlang installation is not working quite
> correctly, and that is leading to the rabbitmq problem.
>
> I suggest that you remove all erlang packages, as well as
> rabbitmq-server, and start again.  If apt-get installs something other
> than the two erlang packages I mentioned above, you probably have an
> issue in your apt configuration.
>
>> Any advice on how to interpret the erl_crash.dump?
>
> The /var/log/rabbit/startup_* files are usually the best place to look
> to diagnose problems with rabbitmq-server, and we need to see those to
> understand files what going on.  The erl_crash.dump file sometimes
> gives useful context, but it contains a lot of information which is
> uninteresting in most cases.
>
> David
>
> -- 
> [][][] David Wragg       | mail: david.wragg at lshift.net
>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
> []  [] LShift Ltd        | web: www.lshift.net




From matthias at lshift.net  Thu Oct  8 22:35:23 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 08 Oct 2009 22:35:23 +0100
Subject: [rabbitmq-discuss] Issues with rabbitmq and manual configured
 hostname
In-Reply-To: <4ACDF4AE.60606@lshift.net>
References: <4ACCC4F3.2000807@vz.net>
	<4ACCF1B1.1070807@lshift.net>	<4ACDD5B8.7060800@vz.net>
	<3bb0d9710910080649h694ea448q1e960ed6d5563702@mail.gmail.com>
	<4ACDF4AE.60606@lshift.net>
Message-ID: <4ACE5B1B.9010300@lshift.net>

Martin,

Matthias Radestock wrote:
> Indeed the scripts assume that the @ suffix is absent.
> 
> The reason Martin wants to set the node name to <something>@localhost is 
> so that it remains the same when failing over to a different machine.
> 
> It would be quite easy to change the scripts (well, actually the erlang 
> code behind them) to accept suffixed node names. I will file a bug for 
> that.

The 'bug21771' branch in hg addresses the above. Feel free to give it a 
try. The usual disclaimers about using unreleased code apply.


Regards,

Matthias.



From ghaidar0 at gmail.com  Fri Oct  9 13:10:00 2009
From: ghaidar0 at gmail.com (George Haidar)
Date: Fri, 9 Oct 2009 23:10:00 +1100
Subject: [rabbitmq-discuss] Clarification needed on how to publish to topic
	exchange
Message-ID: <da73e0750910090510v1906e6dble8850f8c3917190c@mail.gmail.com>

Hi,
I have rabbitmq-server installed ?- checked out from mercurial and
built along with all plugins at the time of writing. I created two
mock java application to test it out - one to publish, one to
subscribe. My program is based on the example listed on the rabbitmq
site under the java api guide. I setup a topic exchange ("report") and
a queue ("live") and bound the two together with the binding key
"report.live". Then I tried to publish message using the routing key
"report.*". `rabbitmqctl list_queue -p bfms` reports 0 messages in the
"live" queue. I was wondering if what I am trying to do is even
possible. If it is, what am I doing wrong?

Following is my code for the publisher:

package com.example;


import com.rabbitmq.client.*;
import com.rabbitmq.client.AMQP.Exchange;
import java.io.IOException;
import java.util.Calendar;
import java.util.logging.Level;
import java.util.logging.Logger;

public class RMQPublisher
{
    public static void main(String[] args)
    {
        ConnectionParameters connParams = new ConnectionParameters();
        connParams.setUsername("bfmsAdmin");
        connParams.setPassword("bfmsAdmin");
        connParams.setVirtualHost("bfms");
        connParams.setRequestedHeartbeat(0);
        try
        {
            System.out.println("Here");
            ConnectionFactory factory = new ConnectionFactory(connParams);
            Connection conn = factory.newConnection("xxxxxx");
            Channel channel = conn.createChannel();
            channel.exchangeDeclare("report", "topic", false, false,
false, null);
            channel.queueDeclare("live");
            channel.queueBind("live", "report", "report.live");
            System.out.println("Here");
            while (true)
            {
                Thread.sleep(1000);
                channel.basicPublish("report", "report.*", null,
("Hello World! "+
Calendar.getInstance().getTimeInMillis()).getBytes());
            }

        } catch (InterruptedException ex) {
            Logger.getLogger(RMQPublisher.class.getName()).log(Level.SEVERE,
null, ex);
        } catch (ShutdownSignalException sse)
        {
        } catch (IOException e)
        {
            System.out.println(e.getMessage());
            e.printStackTrace();
        }

    }

}

Regards



From matthew at lshift.net  Fri Oct  9 13:13:43 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 9 Oct 2009 13:13:43 +0100
Subject: [rabbitmq-discuss] Clarification needed on how to publish to
 topic exchange
In-Reply-To: <da73e0750910090510v1906e6dble8850f8c3917190c@mail.gmail.com>
References: <da73e0750910090510v1906e6dble8850f8c3917190c@mail.gmail.com>
Message-ID: <20091009121343.GJ25365@mrnibble.lshift.net>

Hi George,

On Fri, Oct 09, 2009 at 11:10:00PM +1100, George Haidar wrote:
> I have rabbitmq-server installed ?- checked out from mercurial and
> built along with all plugins at the time of writing. I created two
> mock java application to test it out - one to publish, one to
> subscribe. My program is based on the example listed on the rabbitmq
> site under the java api guide. I setup a topic exchange ("report") and
> a queue ("live") and bound the two together with the binding key
> "report.live". Then I tried to publish message using the routing key
> "report.*". `rabbitmqctl list_queue -p bfms` reports 0 messages in the
> "live" queue. I was wondering if what I am trying to do is even
> possible. If it is, what am I doing wrong?

You have routing key and binding key confused. The binding key is the
one that can have wildcards ('*' and '#') in it. The routing key does
not. So you should use a binding key of "report.*" and set the routing
key, when publishing, to "report.live".

Hope that helps,

Matthew



From brian at echonest.com  Fri Oct  9 21:07:51 2009
From: brian at echonest.com (Brian Whitman)
Date: Fri, 9 Oct 2009 16:07:51 -0400
Subject: [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,
	including swap, dying
In-Reply-To: <20091008112041.GA20401@wellquite.org>
References: <dbd9700a0910040603y2c3392b3jd663843080daf0f3@mail.gmail.com>
	<20091005100419.GA25365@mrnibble.lshift.net>
	<20091008112041.GA20401@wellquite.org>
Message-ID: <dbd9700a0910091307p2b708ff3t36fc39c93d9783e9@mail.gmail.com>

Hi Matthew, all, I had a couple people here test out this new branch vs. our
old branch on a local VM.  One thing we didn't know is that our messages
were relatively big -- 10KB each (I thought they were always much smaller.)
They report:
On a virtual machine with 1.5GB ram, we saw the following behaviour:

latest stable erlang + rabbitmq (20980) died once, and another time became
unresponsive, both times just before it hit ~2M messages (9KB each). CPU was
pegged around 90 %, and swap grew to almost 5GB.

latest stable erlang + rabbitmq (21444) never died, even with 3.5M+
messages. CPU was 90 %, and swap never grew past ~1.7GB.


We're going to upgrade to 21444 on our host and see how it goes.

Thanks
Brian




On Thu, Oct 8, 2009 at 7:20 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Brian,
>
> On Mon, Oct 05, 2009 at 11:04:21AM +0100, Matthew Sackman wrote:
> > However, if you just had billions of
> > messages in there, then even in a non clustered setup, I could believe
> > mnesia would be taking a long time to start up and that might cause the
> > above error.
>
> I've just come across this thread:
> http://www.trapexit.org/forum/viewtopic.php?p=44433
> which does indeed seem to support the idea that even modest mnesia
> databases can take rather more than the 30 seconds we give them to
> start up. Given that I would imagine this could happen even in v1.7
> with, say, a couple million durable queues, exchanges and bindings,
> this is certainly something we will look at as the 30 second timeout
> may well be grossly too short.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091009/f26ecbd3/attachment.htm 

From jeremy.lal at m4x.org  Sat Oct 10 08:38:43 2009
From: jeremy.lal at m4x.org (=?UTF-8?B?SsOpcsOpbXkgTGFs?=)
Date: Sat, 10 Oct 2009 09:38:43 +0200
Subject: [rabbitmq-discuss] stomp usual port and iana
Message-ID: <4AD03A03.7020607@edagames.com>

I figured there were some ports assigned to STOMP,
is there a reason for using 61613 ?
AMQP runs on privileged port, and not STOMP, which is weird.


imqstomp        7672/tcp    iMQ STOMP Server
#                           Amy Kang <amy.kang&sun.com> 10 March 2009
#               7672/udp    Reserved
imqstomps       7673/tcp    iMQ STOMP Server over SSL
#                           Amy Kang <amy.kang&sun.com> 10 March 2009




From jewel at subvert-the-dominant-paradigm.net  Sat Oct 10 21:24:51 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Sat, 10 Oct 2009 22:24:51 +0200
Subject: [rabbitmq-discuss] Debian package for rabbitmq 1.7
Message-ID: <1255206291.22704.1013.camel@cmalu.WAG54GS>

I have uploaded a new package for rabbitmq-server 1.7 to debian
unstable.

Please check to see whether I have included all the updates to the
packaging scripts.

John Leuner





From arnaudsj at gmail.com  Mon Oct 12 03:42:18 2009
From: arnaudsj at gmail.com (=?iso-8859-1?Q?S=E9bastien?=)
Date: Sun, 11 Oct 2009 21:42:18 -0500
Subject: [rabbitmq-discuss] Async Python AMQP client lib
Message-ID: <6A687040-891A-42DA-831B-7431F7A795A5@gmail.com>

Hi,

I am new to using RabbitMQ and would like to know if the py-amqplib  
has a branch available with non-blocking sockets for async style amqp  
consumers & producers. I did see some code was shared about a year  
ago: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-March/000550.html 
, but I can't seem to see it integrated in the current source  
available in the mercurial repository.

I have looked at tx-amqplib, but I don't like the heavy dependencies  
on twisted, zope, etc...

Thank you in advance for your advice!

Cheers!

S?bastien Arnaud
arnaudsj at gmail.com




From adityagupta.iiitm at GMAIL.COM  Mon Oct 12 08:08:52 2009
From: adityagupta.iiitm at GMAIL.COM (Katrina)
Date: Mon, 12 Oct 2009 00:08:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Channel.isopen returns false and {timeout,
 running} exception
In-Reply-To: <4AC24B1E.1020509@lshift.net>
References: <25531373.post@talk.nabble.com>
	<29598b610909290054j184c12acx3416be5838ad3475@mail.gmail.com>
	<25667088.post@talk.nabble.com>
	<29598b610909291052x9ce9a07md33895c13524c390@mail.gmail.com>
	<4AC24B1E.1020509@lshift.net>
Message-ID: <25851350.post@talk.nabble.com>


Hi Matthias, 

the problem is still occurring ... till now we had set heartbeat as "10" ..
so  wat if we set it to '0'. 

Actually.. wat we are doing is .. we create a rabbitMQ connection through
our ..java client .. thn all the channels created we save them in 
threadlocal .. so . while getting the channel .. we only check for (
channel.isopen()) ... and if connection got terminated or disconnected ..
then we .. call .. the shutdown listener .. 

so my .. question is .. if we set heartbeat as "0" .. then will 
shutdownlistner get called ??

 

Matthias Radestock-2 wrote:
> 
> Katrina,
> 
> Paul Jones wrote:
>> Would you have any kind of networking event that happens at this time? 
>> For example, would it be possible that your network link gets reset?
>> 
>> Maybe you could try leaving an SSH connection open to the server over 
>> that time period, and see if it too ends up broken?
> 
> Actually, my guess would be that the error is caused by a busy machine, 
> perhaps due to backups or some other heavy duty cron jobs running.
> 
> I have seen heartbeat timeouts (that's what the {timeout,running} error 
> is) getting triggered under those circumstance on a customer system.
> 
> If so then the solution is to either increase the heartbeat interval or 
> turn off heartbeats altogether (by setting the interval to 0 in the
> client).
> 
> 
> Regards,
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/Channel.isopen-returns-false-and-%7Btimeout%2Crunning%7D-exception-tp25531373p25851350.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Mon Oct 12 09:42:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 12 Oct 2009 09:42:00 +0100
Subject: [rabbitmq-discuss] Channel.isopen returns false and {timeout,
 running} exception
In-Reply-To: <25851350.post@talk.nabble.com>
References: <25531373.post@talk.nabble.com>	<29598b610909290054j184c12acx3416be5838ad3475@mail.gmail.com>	<25667088.post@talk.nabble.com>	<29598b610909291052x9ce9a07md33895c13524c390@mail.gmail.com>	<4AC24B1E.1020509@lshift.net>
	<25851350.post@talk.nabble.com>
Message-ID: <4AD2EBD8.1020301@lshift.net>

Katrina,

Katrina wrote:
> the problem is still occurring ... till now we had set heartbeat as "10" ..
> so  wat if we set it to '0'. 
> [...]
> so my .. question is .. if we set heartbeat as "0" .. then will 
> shutdownlistner get called ??

The shutdown listeners should get called when the connection is 
terminated, whatever the reason.

Note that in the RabbitMQ 1.7.0 clients the default heartbeat interval 
is 0, i.e. disabled. So if you are using the 1.7.0 Java client, simply 
removing your explicit "10" setting ought to disable heartbeats.


Regards,

Matthias.



From matthias at lshift.net  Mon Oct 12 10:40:57 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 12 Oct 2009 10:40:57 +0100
Subject: [rabbitmq-discuss] stomp usual port and iana
In-Reply-To: <4AD03A03.7020607@edagames.com>
References: <4AD03A03.7020607@edagames.com>
Message-ID: <4AD2F9A9.9000505@lshift.net>

Jeremy,

J?r?my Lal wrote:
> I figured there were some ports assigned to STOMP,
> is there a reason for using 61613 ?
> AMQP runs on privileged port, and not STOMP, which is weird.

By "privileged", do you mean using an IANA-assigned port number?

> imqstomp        7672/tcp    iMQ STOMP Server
> #                           Amy Kang <amy.kang&sun.com> 10 March 2009
> #               7672/udp    Reserved
> imqstomps       7673/tcp    iMQ STOMP Server over SSL
> #                           Amy Kang <amy.kang&sun.com> 10 March 2009

The above look to be product specific (I am assuming that iMQ is a 
product). There is still an open bug in ActiveMQ's bug tracking system 
to get IANA port numbers assigned for STOMP:
   https://issues.apache.org/activemq/browse/AMQ-1530


Matthias.



From ami.nuscule at gmail.com  Mon Oct 12 11:01:01 2009
From: ami.nuscule at gmail.com (L'ami Nuscule)
Date: Mon, 12 Oct 2009 12:01:01 +0200
Subject: [rabbitmq-discuss] RQL plugin installation issue
Message-ID: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>

Hi all !!

Maybe this question has been asked numerous times, i'm new to this ML.



ben at nunuske:/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins$ sudo  
rabbitmq-activate-plugins
ERROR: failed to load application amqp_client: {"no such file or  
directory",  "amqp_client.app"}

That is the error i get when trying to install RQL plugin as  
explained on http://www.rabbitmq.com/rabbitmq-bql.html#installation ...
is it a well known issue ??

By the way i needed to rename .zip file to .ez to make rabbitmq- 
activate-plugin perform an action...


And actually, indeed i have no amqp_client in ebin directory.



Thx all !! Nice work anyway !!!!




From majek04 at gmail.com  Mon Oct 12 11:16:13 2009
From: majek04 at gmail.com (majek04)
Date: Mon, 12 Oct 2009 11:16:13 +0100
Subject: [rabbitmq-discuss] Async Python AMQP client lib
In-Reply-To: <6A687040-891A-42DA-831B-7431F7A795A5@gmail.com>
References: <6A687040-891A-42DA-831B-7431F7A795A5@gmail.com>
Message-ID: <3bb0d9710910120316u120044aoae8363818186b22a@mail.gmail.com>

On Mon, Oct 12, 2009 at 03:42, S?bastien <arnaudsj at gmail.com> wrote:
> I am new to using RabbitMQ and would like to know if the py-amqplib
> has a branch available with non-blocking sockets for async style amqp
> consumers & producers.
> I did see some code was shared about a year
> ago: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-March/000550.html
> , but I can't seem to see it integrated in the current source
> available in the mercurial repository.

Hi!

First, Alexis has a bunch of interesting links:
http://delicious.com/alexisrichardson/rabbitmq+python

The non-blocking code for py-amqplib was added to mainline for
a while, but later removed. I did some hacking on py-amqplib
to make non-blocking consuming, but to be frank, it barely works:
http://code.google.com/p/evserver/source/browse/trunk/evserver/examples/django_chat/views.py#68
(the hack there is to make py-amqplib socket non-blocking,
and catch exceptions from deep inside amqplib)


> I have looked at tx-amqplib, but I don't like the heavy dependencies
> on twisted, zope, etc...

I'm afraid tx-amqp is the most mature in async amqp-python world.
It's pretty nice to work with, once you get started. But
getting started with twisted is not always a nice experience.
Though, I do recommend tx-amqp.

Cheers!
  Marek Majkowski



From pauljones23 at gmail.com  Mon Oct 12 11:21:27 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 12 Oct 2009 11:21:27 +0100
Subject: [rabbitmq-discuss] RQL plugin installation issue
In-Reply-To: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>
References: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>
Message-ID: <29598b610910120321n30ca8d63j3013c6d7f731abbb@mail.gmail.com>

Hi,

At this point, all of the plugins are experimental, so we're not yet
providing binary builds of these plugins. I'm assuming that you've
downloaded the source zip from the download page, which would most likely
lead to the error that you've described.

To install the plugins at this stage, I'd recommend checking out a source
build, building the plugins via that, then taking the .ez files from there
and installing them into your server.

To do this, follow the instructions under:
  http://www.rabbitmq.com/plugin-development.html#getting-started

Once the make has completed, you should see a number of files within the
dist directory of the rabbitmq-bql directory. Take:
  - amqp_client.ez
  - rabbitmq-bql.ez
  - rfc4627_jsonrpc.ez
and place these into the plugins directory.

Hopefully this should get you going.

Thanks,
Paul.

On Mon, Oct 12, 2009 at 11:01 AM, L'ami Nuscule <ami.nuscule at gmail.com>wrote:

> Hi all !!
>
> Maybe this question has been asked numerous times, i'm new to this ML.
>
>
>
> ben at nunuske:/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins$ sudo
> rabbitmq-activate-plugins
> ERROR: failed to load application amqp_client: {"no such file or
> directory",  "amqp_client.app"}
>
> That is the error i get when trying to install RQL plugin as
> explained on http://www.rabbitmq.com/rabbitmq-bql.html#installation ...
> is it a well known issue ??
>
> By the way i needed to rename .zip file to .ez to make rabbitmq-
> activate-plugin perform an action...
>
>
> And actually, indeed i have no amqp_client in ebin directory.
>
>
>
> Thx all !! Nice work anyway !!!!
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091012/4a63fbd4/attachment.htm 

From matthias at lshift.net  Mon Oct 12 11:39:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 12 Oct 2009 11:39:16 +0100
Subject: [rabbitmq-discuss] rabbitmqctl  clustering timeout
In-Reply-To: <E1MvUWX-0005vQ-00.akalend-mail-ru@f3.mail.ru>
References: <167204d20910070359j6c9db9bctb127f59a387ab7a0@mail.gmail.com>
	<E1MvUWX-0005vQ-00.akalend-mail-ru@f3.mail.ru>
Message-ID: <4AD30754.8080209@lshift.net>

Alexandre,

Alexandre Kalendarev wrote:
> I create cluster with three node (rabbit1, rabbit2,rabbit3).
> I sent to the rabbit2 some messages and I must check it by rabbitmqctl. 
> 
> rabbit2>rabbitmqctl list_queues
> Error: {badrpc,timeout}
> 
> rabbit1>rabbitmqctl  -n rabbit at rabbit1 list_queues
> Error: {badrpc,timeout}
> 
> rabbit1>rabbitmqctl  list_queues

Have you tried this in the RabbitMQ 1.7.0 release? It contains improved
diagnostics for tracking down the causes of badrpc errors in rabbitmqctl.


Regards,

Matthias.



From arnaudsj at gmail.com  Mon Oct 12 15:05:56 2009
From: arnaudsj at gmail.com (=?iso-8859-1?Q?S=E9bastien?=)
Date: Mon, 12 Oct 2009 09:05:56 -0500
Subject: [rabbitmq-discuss] Async Python AMQP client lib
In-Reply-To: <cedc0c090910120517r1e64ed59ua4b221987e2738da@mail.gmail.com>
References: <6A687040-891A-42DA-831B-7431F7A795A5@gmail.com>
	<cedc0c090910120517r1e64ed59ua4b221987e2738da@mail.gmail.com>
Message-ID: <1E173F33-1B19-4C67-B176-4240EBEF8B0B@gmail.com>

Thank you all for the advice - looks like I need to give txAMQP a  
better shot. Just had some issues though getting zope_interface to  
install on Snow Leopard under Python 2.6.3, not sure why...

Thanks!

S?bastien

On Oct 12, 2009, at 7:17 AM, Laurens Van Houtven wrote:

> On Mon, Oct 12, 2009 at 4:42 AM, S?bastien <arnaudsj at gmail.com> wrote:
>> Hi,
>>
>> I have looked at tx-amqplib, but I don't like the heavy dependencies
>> on twisted, zope, etc...
>
> Have you used Twisted before? Not to be snide, it's just that the
> perceived heaviness of Twisted is grossly exaggerated :-)
>
> The only dependency in Zope AFAIK is zope interfaces, which most
> distributions package separately. Also, I don't think txAMQP actually
> needs all of Twisted -- which is to say I'm pretty sure it works with
> just the Twisted core libs, which can be installed separately (and,
> again, are generally packaged separately).
>
> So yeah, +1 for txAMQP. Use it, it's awesome! It's also written
> (mostly) by Esteve, and Esteve is awesome too.
>
> Another important thing is that it actually works properly, which is
> apparently more than can be said about the alternative :-)
>
>> Thank you in advance for your advice!
>>
>> Cheers!
>>
>> S?bastien Arnaud
>> arnaudsj at gmail.com
>
>
> Enjoy
> Laurens




From bp at barryp.org  Mon Oct 12 15:12:53 2009
From: bp at barryp.org (Barry Pederson)
Date: Mon, 12 Oct 2009 09:12:53 -0500
Subject: [rabbitmq-discuss] Async Python AMQP client lib
In-Reply-To: <6A687040-891A-42DA-831B-7431F7A795A5@gmail.com>
References: <6A687040-891A-42DA-831B-7431F7A795A5@gmail.com>
Message-ID: <4AD33965.4080204@barryp.org>

S?bastien wrote:
> Hi,
> 
> I am new to using RabbitMQ and would like to know if the py-amqplib  
> has a branch available with non-blocking sockets for async style amqp  
> consumers & producers. I did see some code was shared about a year  
> ago: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-March/000550.html 
> , but I can't seem to see it integrated in the current source  
> available in the mercurial repository.
> 
> I have looked at tx-amqplib, but I don't like the heavy dependencies  
> on twisted, zope, etc...

There's an experimental branch at

   http://hg.barryp.org/py-amqplib-devel/

that has an optional "threaded" mode that offers a timeout on wait() 
calls, and attempts to do some flow-control.  I consider it experimental 
mainly because it needs testing and feedback, and I haven't really 
figured out how you'd write unittests for such features.  It does pass 
all the same existing unittests as the regular branch.

For more heavy-duty async support, txAMQP is still probably a better bet.

	Barry



From ami.nuscule at gmail.com  Mon Oct 12 16:02:05 2009
From: ami.nuscule at gmail.com (L'ami Nuscule)
Date: Mon, 12 Oct 2009 17:02:05 +0200
Subject: [rabbitmq-discuss] RQL plugin installation issue
In-Reply-To: <29598b610910120321n30ca8d63j3013c6d7f731abbb@mail.gmail.com>
References: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>
	<29598b610910120321n30ca8d63j3013c6d7f731abbb@mail.gmail.com>
Message-ID: <6AD4C2F4-B202-4E77-A96B-6DCD4B4DC793@gmail.com>

So i tried, unsuccessful ):

I end up with a :

init terminating in do_boot ()

make[1]: *** [src/command_parser.erl] Erreur 1
make[1]: quittant le r?pertoire ? /path/rabbit/rabbitmq-public- 
umbrella/rabbitmq-bql ?



Idem with :

make all

make

make packages







Le 12 oct. 09 ? 12:21, Paul Jones a ?crit :

> Hi,
>
> At this point, all of the plugins are experimental, so we're not  
> yet providing binary builds of these plugins. I'm assuming that  
> you've downloaded the source zip from the download page, which  
> would most likely lead to the error that you've described.
>
> To install the plugins at this stage, I'd recommend checking out a  
> source build, building the plugins via that, then taking the .ez  
> files from there and installing them into your server.
>
> To do this, follow the instructions under:
>   http://www.rabbitmq.com/plugin-development.html#getting-started
>
> Once the make has completed, you should see a number of files  
> within the dist directory of the rabbitmq-bql directory. Take:
>   - amqp_client.ez
>   - rabbitmq-bql.ez
>   - rfc4627_jsonrpc.ez
> and place these into the plugins directory.
>
> Hopefully this should get you going.
>
> Thanks,
> Paul.
>
> On Mon, Oct 12, 2009 at 11:01 AM, L'ami Nuscule  
> <ami.nuscule at gmail.com> wrote:
> Hi all !!
>
> Maybe this question has been asked numerous times, i'm new to this ML.
>
>
>
> ben at nunuske:/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins$ sudo
> rabbitmq-activate-plugins
> ERROR: failed to load application amqp_client: {"no such file or
> directory",  "amqp_client.app"}
>
> That is the error i get when trying to install RQL plugin as
> explained on http://www.rabbitmq.com/rabbitmq- 
> bql.html#installation ...
> is it a well known issue ??
>
> By the way i needed to rename .zip file to .ez to make rabbitmq-
> activate-plugin perform an action...
>
>
> And actually, indeed i have no amqp_client in ebin directory.
>
>
>
> Thx all !! Nice work anyway !!!!
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>




From pauljones23 at gmail.com  Mon Oct 12 16:30:13 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 12 Oct 2009 16:30:13 +0100
Subject: [rabbitmq-discuss] RQL plugin installation issue
In-Reply-To: <6AD4C2F4-B202-4E77-A96B-6DCD4B4DC793@gmail.com>
References: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>
	<29598b610910120321n30ca8d63j3013c6d7f731abbb@mail.gmail.com>
	<6AD4C2F4-B202-4E77-A96B-6DCD4B4DC793@gmail.com>
Message-ID: <29598b610910120830g34ab0ab4lf1754d81e3d2b21d@mail.gmail.com>

Unfortunately, there isn't enough detail in that trace to give me any ideas
what is going on. I assume there was more trace above this?

On Mon, Oct 12, 2009 at 4:02 PM, L'ami Nuscule <ami.nuscule at gmail.com>wrote:

> So i tried, unsuccessful ):
>
> I end up with a :
>
> init terminating in do_boot ()
>
> make[1]: *** [src/command_parser.erl] Erreur 1
> make[1]: quittant le r?pertoire ?
> /path/rabbit/rabbitmq-public-umbrella/rabbitmq-bql ?
>
>
>
> Idem with :
>
> make all
>
> make
>
> make packages
>
>
>
>
>
>
>
> Le 12 oct. 09 ? 12:21, Paul Jones a ?crit :
>
>
>  Hi,
>>
>> At this point, all of the plugins are experimental, so we're not yet
>> providing binary builds of these plugins. I'm assuming that you've
>> downloaded the source zip from the download page, which would most likely
>> lead to the error that you've described.
>>
>> To install the plugins at this stage, I'd recommend checking out a source
>> build, building the plugins via that, then taking the .ez files from there
>> and installing them into your server.
>>
>> To do this, follow the instructions under:
>>  http://www.rabbitmq.com/plugin-development.html#getting-started
>>
>> Once the make has completed, you should see a number of files within the
>> dist directory of the rabbitmq-bql directory. Take:
>>  - amqp_client.ez
>>  - rabbitmq-bql.ez
>>  - rfc4627_jsonrpc.ez
>> and place these into the plugins directory.
>>
>> Hopefully this should get you going.
>>
>> Thanks,
>> Paul.
>>
>> On Mon, Oct 12, 2009 at 11:01 AM, L'ami Nuscule <ami.nuscule at gmail.com>
>> wrote:
>> Hi all !!
>>
>> Maybe this question has been asked numerous times, i'm new to this ML.
>>
>>
>>
>> ben at nunuske:/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins$ sudo
>> rabbitmq-activate-plugins
>> ERROR: failed to load application amqp_client: {"no such file or
>> directory",  "amqp_client.app"}
>>
>> That is the error i get when trying to install RQL plugin as
>> explained on http://www.rabbitmq.com/rabbitmq-bql.html#installation ...
>> is it a well known issue ??
>>
>> By the way i needed to rename .zip file to .ez to make rabbitmq-
>> activate-plugin perform an action...
>>
>>
>> And actually, indeed i have no amqp_client in ebin directory.
>>
>>
>>
>> Thx all !! Nice work anyway !!!!
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091012/652e7893/attachment.htm 

From ami.nuscule at gmail.com  Mon Oct 12 16:56:56 2009
From: ami.nuscule at gmail.com (L'ami Nuscule)
Date: Mon, 12 Oct 2009 17:56:56 +0200
Subject: [rabbitmq-discuss] RQL plugin installation issue
In-Reply-To: <29598b610910120830g34ab0ab4lf1754d81e3d2b21d@mail.gmail.com>
References: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>
	<29598b610910120321n30ca8d63j3013c6d7f731abbb@mail.gmail.com>
	<6AD4C2F4-B202-4E77-A96B-6DCD4B4DC793@gmail.com>
	<29598b610910120830g34ab0ab4lf1754d81e3d2b21d@mail.gmail.com>
Message-ID: <4121E403-2F1C-4C0D-8886-67FF80FDD655@gmail.com>

Here are the very last lines of the make command (i'm on ubuntu 9.04):



Archive: rabbit_common.ez
creating: rabbit_common/
creating: rabbit_common/include/
inflating: rabbit_common/include/rabbit_framing.hrl
inflating: rabbit_common/include/rabbit.hrl
inflating: rabbit_common/include/rabbit_framing_spec.hrl
creating: rabbit_common/ebin/
inflating: rabbit_common/ebin/rabbit_binary_parser.beam
inflating: rabbit_common/ebin/gen_server2.beam
inflating: rabbit_common/ebin/rabbit_basic.beam
inflating: rabbit_common/ebin/rabbit_framing_channel.beam
inflating: rabbit_common/ebin/rabbit_heartbeat.beam
inflating: rabbit_common/ebin/rabbit_writer.beam
inflating: rabbit_common/ebin/rabbit_framing.beam
inflating: rabbit_common/ebin/rabbit_channel.beam
inflating: rabbit_common/ebin/rabbit_misc.beam
inflating: rabbit_common/ebin/rabbit_binary_generator.beam
inflating: rabbit_common/ebin/rabbit_common.app
inflating: rabbit_common/ebin/rabbit_reader.beam

inflating: rabbit_common/ebin/rabbit_net.beam

erlc -I include -pa build/deps/amqp_client/ebin -pa build/deps/ 
rabbit_common/ebin -o ebin -Wall +debug_info -pa ebin src/leex.erl
erl -I -pa ebin -noshell -eval 'ok = leex:file("src/ 
command_lexer.xrl",[{outdir,"src"}]), halt().'
Parsing file src/command_lexer.xrl, contained 43 rules.
NFA contains 265 states, DFA contains 166 states, minimised to 158  
states.
Writing file src/command_lexer.erl, ok
erl -I -pa ebin -noshell -eval '{ok, _} = yecc:file("src/ 
command_parser"), halt().'
{"init terminating in do_boot",{undef,[{yecc,file,["src/ 
command_parser"]},{erl_eval,do_apply,5},{erl_eval,expr,5}, 
{erl_eval,exprs,5},{init,start_it,1},{init,start_em,1}]}}
Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
make[1]: *** [src/command_parser.erl] Erreur 1
make[1]: quittant le r?pertoire ? /home/ben/Bureau/rabbitUmbrella/ 
rabbitmq-public-umbrella/rabbitmq-bql ?
make: *** [all] Erreur 2



Should i send the crash.dump ??


Le 12 oct. 09 ? 17:30, Paul Jones a ?crit :

> Unfortunately, there isn't enough detail in that trace to give me  
> any ideas what is going on. I assume there was more trace above this?
>
> On Mon, Oct 12, 2009 at 4:02 PM, L'ami Nuscule  
> <ami.nuscule at gmail.com> wrote:
> So i tried, unsuccessful ):
>
> I end up with a :
>
> init terminating in do_boot ()
>
> make[1]: *** [src/command_parser.erl] Erreur 1
> make[1]: quittant le r?pertoire ? /path/rabbit/rabbitmq-public- 
> umbrella/rabbitmq-bql ?
>
>
>
> Idem with :
>
> make all
>
> make
>
> make packages
>
>
>
>
>
>
>
> Le 12 oct. 09 ? 12:21, Paul Jones a ?crit :
>
>
> Hi,
>
> At this point, all of the plugins are experimental, so we're not  
> yet providing binary builds of these plugins. I'm assuming that  
> you've downloaded the source zip from the download page, which  
> would most likely lead to the error that you've described.
>
> To install the plugins at this stage, I'd recommend checking out a  
> source build, building the plugins via that, then taking the .ez  
> files from there and installing them into your server.
>
> To do this, follow the instructions under:
>  http://www.rabbitmq.com/plugin-development.html#getting-started
>
> Once the make has completed, you should see a number of files  
> within the dist directory of the rabbitmq-bql directory. Take:
>  - amqp_client.ez
>  - rabbitmq-bql.ez
>  - rfc4627_jsonrpc.ez
> and place these into the plugins directory.
>
> Hopefully this should get you going.
>
> Thanks,
> Paul.
>
> On Mon, Oct 12, 2009 at 11:01 AM, L'ami Nuscule  
> <ami.nuscule at gmail.com> wrote:
> Hi all !!
>
> Maybe this question has been asked numerous times, i'm new to this ML.
>
>
>
> ben at nunuske:/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins$ sudo
> rabbitmq-activate-plugins
> ERROR: failed to load application amqp_client: {"no such file or
> directory",  "amqp_client.app"}
>
> That is the error i get when trying to install RQL plugin as
> explained on http://www.rabbitmq.com/rabbitmq- 
> bql.html#installation ...
> is it a well known issue ??
>
> By the way i needed to rename .zip file to .ez to make rabbitmq-
> activate-plugin perform an action...
>
>
> And actually, indeed i have no amqp_client in ebin directory.
>
>
>
> Thx all !! Nice work anyway !!!!
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>




From pauljones23 at gmail.com  Mon Oct 12 17:42:44 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 12 Oct 2009 17:42:44 +0100
Subject: [rabbitmq-discuss] RQL plugin installation issue
In-Reply-To: <4121E403-2F1C-4C0D-8886-67FF80FDD655@gmail.com>
References: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>
	<29598b610910120321n30ca8d63j3013c6d7f731abbb@mail.gmail.com>
	<6AD4C2F4-B202-4E77-A96B-6DCD4B4DC793@gmail.com>
	<29598b610910120830g34ab0ab4lf1754d81e3d2b21d@mail.gmail.com>
	<4121E403-2F1C-4C0D-8886-67FF80FDD655@gmail.com>
Message-ID: <29598b610910120942j5b84d11v344b31ba556f3c69@mail.gmail.com>

Do you know what version of Erlang you have installed?

On Mon, Oct 12, 2009 at 4:56 PM, L'ami Nuscule <ami.nuscule at gmail.com>wrote:

> Here are the very last lines of the make command (i'm on ubuntu 9.04):
>
>
>
> Archive: rabbit_common.ez
> creating: rabbit_common/
> creating: rabbit_common/include/
> inflating: rabbit_common/include/rabbit_framing.hrl
> inflating: rabbit_common/include/rabbit.hrl
> inflating: rabbit_common/include/rabbit_framing_spec.hrl
> creating: rabbit_common/ebin/
> inflating: rabbit_common/ebin/rabbit_binary_parser.beam
> inflating: rabbit_common/ebin/gen_server2.beam
> inflating: rabbit_common/ebin/rabbit_basic.beam
> inflating: rabbit_common/ebin/rabbit_framing_channel.beam
> inflating: rabbit_common/ebin/rabbit_heartbeat.beam
> inflating: rabbit_common/ebin/rabbit_writer.beam
> inflating: rabbit_common/ebin/rabbit_framing.beam
> inflating: rabbit_common/ebin/rabbit_channel.beam
> inflating: rabbit_common/ebin/rabbit_misc.beam
> inflating: rabbit_common/ebin/rabbit_binary_generator.beam
> inflating: rabbit_common/ebin/rabbit_common.app
> inflating: rabbit_common/ebin/rabbit_reader.beam
>
> inflating: rabbit_common/ebin/rabbit_net.beam
>
> erlc -I include -pa build/deps/amqp_client/ebin -pa
> build/deps/rabbit_common/ebin -o ebin -Wall +debug_info -pa ebin
> src/leex.erl
> erl -I -pa ebin -noshell -eval 'ok =
> leex:file("src/command_lexer.xrl",[{outdir,"src"}]), halt().'
> Parsing file src/command_lexer.xrl, contained 43 rules.
> NFA contains 265 states, DFA contains 166 states, minimised to 158 states.
> Writing file src/command_lexer.erl, ok
> erl -I -pa ebin -noshell -eval '{ok, _} = yecc:file("src/command_parser"),
> halt().'
> {"init terminating in
> do_boot",{undef,[{yecc,file,["src/command_parser"]},{erl_eval,do_apply,5},{erl_eval,expr,5},{erl_eval,exprs,5},{init,start_it,1},{init,start_em,1}]}}
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> make[1]: *** [src/command_parser.erl] Erreur 1
> make[1]: quittant le r?pertoire ?
> /home/ben/Bureau/rabbitUmbrella/rabbitmq-public-umbrella/rabbitmq-bql ?
> make: *** [all] Erreur 2
>
>
>
> Should i send the crash.dump ??
>
>
> Le 12 oct. 09 ? 17:30, Paul Jones a ?crit :
>
>
>  Unfortunately, there isn't enough detail in that trace to give me any
>> ideas what is going on. I assume there was more trace above this?
>>
>> On Mon, Oct 12, 2009 at 4:02 PM, L'ami Nuscule <ami.nuscule at gmail.com>
>> wrote:
>> So i tried, unsuccessful ):
>>
>> I end up with a :
>>
>> init terminating in do_boot ()
>>
>> make[1]: *** [src/command_parser.erl] Erreur 1
>> make[1]: quittant le r?pertoire ?
>> /path/rabbit/rabbitmq-public-umbrella/rabbitmq-bql ?
>>
>>
>>
>> Idem with :
>>
>> make all
>>
>> make
>>
>> make packages
>>
>>
>>
>>
>>
>>
>>
>> Le 12 oct. 09 ? 12:21, Paul Jones a ?crit :
>>
>>
>> Hi,
>>
>> At this point, all of the plugins are experimental, so we're not yet
>> providing binary builds of these plugins. I'm assuming that you've
>> downloaded the source zip from the download page, which would most likely
>> lead to the error that you've described.
>>
>> To install the plugins at this stage, I'd recommend checking out a source
>> build, building the plugins via that, then taking the .ez files from there
>> and installing them into your server.
>>
>> To do this, follow the instructions under:
>>  http://www.rabbitmq.com/plugin-development.html#getting-started
>>
>> Once the make has completed, you should see a number of files within the
>> dist directory of the rabbitmq-bql directory. Take:
>>  - amqp_client.ez
>>  - rabbitmq-bql.ez
>>  - rfc4627_jsonrpc.ez
>> and place these into the plugins directory.
>>
>> Hopefully this should get you going.
>>
>> Thanks,
>> Paul.
>>
>> On Mon, Oct 12, 2009 at 11:01 AM, L'ami Nuscule <ami.nuscule at gmail.com>
>> wrote:
>> Hi all !!
>>
>> Maybe this question has been asked numerous times, i'm new to this ML.
>>
>>
>>
>> ben at nunuske:/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins$ sudo
>> rabbitmq-activate-plugins
>> ERROR: failed to load application amqp_client: {"no such file or
>> directory",  "amqp_client.app"}
>>
>> That is the error i get when trying to install RQL plugin as
>> explained on http://www.rabbitmq.com/rabbitmq-bql.html#installation ...
>> is it a well known issue ??
>>
>> By the way i needed to rename .zip file to .ez to make rabbitmq-
>> activate-plugin perform an action...
>>
>>
>> And actually, indeed i have no amqp_client in ebin directory.
>>
>>
>>
>> Thx all !! Nice work anyway !!!!
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091012/4dbd8481/attachment.htm 

From rtrlists at googlemail.com  Mon Oct 12 18:20:21 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 12 Oct 2009 18:20:21 +0100
Subject: [rabbitmq-discuss] RQL plugin installation issue
In-Reply-To: <4121E403-2F1C-4C0D-8886-67FF80FDD655@gmail.com>
References: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>
	<29598b610910120321n30ca8d63j3013c6d7f731abbb@mail.gmail.com>
	<6AD4C2F4-B202-4E77-A96B-6DCD4B4DC793@gmail.com>
	<29598b610910120830g34ab0ab4lf1754d81e3d2b21d@mail.gmail.com>
	<4121E403-2F1C-4C0D-8886-67FF80FDD655@gmail.com>
Message-ID: <6a3ae47e0910121020u1b1fefdcn81b56532223a8650@mail.gmail.com>

On Mon, Oct 12, 2009 at 4:56 PM, L'ami Nuscule <ami.nuscule at gmail.com>wrote:

>
> erl -I -pa ebin -noshell -eval '{ok, _} = yecc:file("src/
> command_parser"), halt().'
> {"init terminating in do_boot",{undef,[{yecc,file,["src/
> command_parser"]},{erl_eval,do_apply,5},{erl_eval,expr,5},
> {erl_eval,exprs,5},{init,start_it,1},{init,start_em,1}]}}
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> make[1]: *** [src/command_parser.erl] Erreur 1
> make[1]: quittant le r?pertoire ? /home/ben/Bureau/rabbitUmbrella/
> rabbitmq-public-umbrella/rabbitmq-bql ?
> make: *** [all] Erreur 2
>
>
Looks like you don't have yecc. Not sure where you would get it from though.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091012/af6f1658/attachment.htm 

From matthias at lshift.net  Mon Oct 12 18:40:09 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 12 Oct 2009 18:40:09 +0100
Subject: [rabbitmq-discuss] RQL plugin installation issue
In-Reply-To: <6a3ae47e0910121020u1b1fefdcn81b56532223a8650@mail.gmail.com>
References: <3E119EDD-3921-4040-B3CE-9581469E737B@gmail.com>	<29598b610910120321n30ca8d63j3013c6d7f731abbb@mail.gmail.com>	<6AD4C2F4-B202-4E77-A96B-6DCD4B4DC793@gmail.com>	<29598b610910120830g34ab0ab4lf1754d81e3d2b21d@mail.gmail.com>	<4121E403-2F1C-4C0D-8886-67FF80FDD655@gmail.com>
	<6a3ae47e0910121020u1b1fefdcn81b56532223a8650@mail.gmail.com>
Message-ID: <4AD369F9.7060207@lshift.net>

Robert Raschke wrote:
> 
> On Mon, Oct 12, 2009 at 4:56 PM, L'ami Nuscule <ami.nuscule at gmail.com
> <mailto:ami.nuscule at gmail.com>> wrote:
> 
> 
>     erl -I -pa ebin -noshell -eval '{ok, _} = yecc:file("src/
>     command_parser"), halt().'
>     {"init terminating in do_boot",{undef,[{yecc,file,["src/
>     command_parser"]},{erl_eval,do_apply,5},{erl_eval,expr,5},
>     {erl_eval,exprs,5},{init,start_it,1},{init,start_em,1}]}}
>     Crash dump was written to: erl_crash.dump
>     init terminating in do_boot ()
>     make[1]: *** [src/command_parser.erl] Erreur 1
>     make[1]: quittant le r?pertoire ? /home/ben/Bureau/rabbitUmbrella/
>     rabbitmq-public-umbrella/rabbitmq-bql ?
>     make: *** [all] Erreur 2
> 
> 
> Looks like you don't have yecc. Not sure where you would get it from though.

yecc has been part of Erlang/OTP for a long time.

Recent debian/ubuntu packages for Erlang/OTP are split into lots of
smaller packages. 'yecc' is in the erlang-parsetools package, which you
may need to install (rabbitmq-server does not need it, so it won't get
installed automatically when installing the server).


Regards,

Matthias.



From marknutter at gmail.com  Mon Oct 12 21:18:04 2009
From: marknutter at gmail.com (Mark Nutter)
Date: Mon, 12 Oct 2009 15:18:04 -0500
Subject: [rabbitmq-discuss] Frame Errors
Message-ID: <476587320910121318o740bf354ia84feab09f1134f6@mail.gmail.com>

Hey all. I'm running into an issue with my rabbitMQ server. I have an
inkling of what the problem might be but I wanted to run it by you folks.
Some background, I'm running rabbitMB 1.6.0
[{running_applications,[{rabbit,"RabbitMQ","1.6.0"}, {mnesia,"MNESIA CXC 138
12","4.3.5"}, {os_mon,"CPO CXC 138 46","2.1.2.1"}, {sasl,"SASL CXC 138
11","2.1.5.1"}, {stdlib,"ERTS CXC 138 10","1.14.5"}, {kernel,"ERTS CXC 138
10","2.11.5"}]}, {nodes,[rabbit at neutrino]}, {running_nodes,[rabbit at neutrino]}]
I'm using the Java client. I have an app that basically takes the Twitter
firehose, throws every link it gets into an exchange, and that exchange
throws the links to different bins depending on what the links are and who
they're from. So the routing keys are typically [twitter_user_id].[link]
(e.g. 1022101.http://google.com). Everything has been running wonderfully,
but I recently noticed that rabbitMQ has been throwing frame errors every
now and then. I have a sneaking suspicion that this is related to unicode
characters in certain tweets (usually foreign language tweets). Would the
fact that it's trying to run a binding check on an extremely long key be the
cause for these errors? If not, what else might be the issue? Here's the
error report for one of the crashes: =CRASH REPORT==== 6-Oct-2009::02:13:25
=== crasher: pid: <0.1309.0> registered_name: [] error_info:
{amqp,frame_error, "cannot decode <<0,1,9,109,97,105,110,116,114,....(this
goes on forever, truncated for sanity's sake)>>", 'basic.publish'}
initial_call: {gen,init_it, [gen_server2, <0.1308.0>, <0.1308.0>,
rabbit_channel, [1,<0.1306.0>,<0.1307.0>,<<"firehose_pull">>,<<"/">>], []]}
ancestors: [<0.1308.0>] messages: [] links: [<0.1307.0>] dictionary:
[{permission_cache, [{{resource,<<"/">>,exchange,<<"maintrack">>},write},
{{resource,<<"/">>,exchange,<<"maintrack">>},read},
{{resource,<<"/">>,queue,<<"firehose">>},write},
{{resource,<<"/">>,queue,<<"firehose">>},configure},
{{resource,<<"/">>,exchange,<<"maintrack">>}, configure}]},
{guid,{{8,<0.1309.0>},0}}] trap_exit: true status: running heap_size: 6765
stack_size: 21 reductions: 921224340 neighbours: neighbour:
[{pid,<0.1307.0>}, {registered_name,[]},
{initial_call,{rabbit_writer,mainloop,1}},
{current_function,{erlang,hibernate,3}}, {ancestors,[]},
{messages,[shutdown]}, {links,[<0.1309.0>]}, {dictionary,[]},
{trap_exit,false}, {status,runnable}, {heap_size,233}, {stack_size,0},
{reductions,76}] Thanks in advance!


-- 
Mark Nutter
612-205-1388
marknutter at gmail.com
http://nuttersmark.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091012/412da450/attachment.htm 

From matthias at lshift.net  Mon Oct 12 23:24:25 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 12 Oct 2009 23:24:25 +0100
Subject: [rabbitmq-discuss] Frame Errors
In-Reply-To: <476587320910121318o740bf354ia84feab09f1134f6@mail.gmail.com>
References: <476587320910121318o740bf354ia84feab09f1134f6@mail.gmail.com>
Message-ID: <4AD3AC99.3060108@lshift.net>

Mark,

Mark Nutter wrote:
> I'm using the Java client. I have an 
> app that basically takes the Twitter firehose, throws every link it gets 
> into an exchange, and that exchange throws the links to different bins 
> depending on what the links are and who they're from. So the routing 
> keys are typically [twitter_user_id].[link] (e.g. 
> 1022101.http://google.com). Everything has been running wonderfully, but 
> I recently noticed that rabbitMQ has been throwing frame errors every 
> now and then. I have a sneaking suspicion that this is related to 
> unicode characters in certain tweets (usually foreign language tweets). 
> Would the fact that it's trying to run a binding check on an extremely 
> long key be the cause for these errors? If not, what else might be the 
> issue? Here's the error report for one of the crashes: =CRASH REPORT==== 
> 6-Oct-2009::02:13:25 === crasher: pid: <0.1309.0> registered_name: [] 
> error_info: {amqp,frame_error, "cannot decode 
> <<0,1,9,109,97,105,110,116,114,....(this goes on forever, truncated for 
> sanity's sake)>>", 'basic.publish'}

The server knows nothing about unicode; it just matches routing keys as 
bitstrings.

How long do the routing keys get? The protocol limits them to 255 bytes. 
That's not enforced by the Java client codec though, so if you supply a 
routing key longer than that it will produce a malformed frame. I will 
raise a bug to add some checks.


Regards,

Matthias.



From brian.peck at lmco.com  Tue Oct 13 03:47:04 2009
From: brian.peck at lmco.com (peckb)
Date: Mon, 12 Oct 2009 19:47:04 -0700 (PDT)
Subject: [rabbitmq-discuss]  Having trouble connecting via jInterface
Message-ID: <25866384.post@talk.nabble.com>


Hey all,

I'm trying to query my rabbitmq broker from java and I am able to make the
simple example calls that I found at
http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/,
but when I try a more complex call i get no response.

I'm trying to call the list_queues method with the following code.

...

OtpSelf self = new OtpSelf("guest", "myCookie");
OtpPeer other = new OtpPeer("rabbit at mercury");
OtpConnection connection = self.connect(other);


OtpErlangObject obj = new OtpErlangBinary((byte)47);
// the magic 47 was in reference to the answer I found at 
//
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-April/003265.html
// though I am unsure it is behaving properly

connection.sendRPC("rabbit_amqqueue", "info_all", new OtpErlangList(obj));

OtpMsg receiveMsg = connection.receiveMsg();
System.out.println(receiveMsg.getMsg());

...

However the output is always {rex, []}. If I try connection.receiveRPC() the
received data is just [].

But when I hop over to the command line and type rabbitmqctl list_queues I
get

Listing queues ...
SimpleQueue     501
...done.

Also, when I try and go into erlang [erl, no parameters] and type 

rpc:call(rabbit at mercury, rabbit_amqqueue, info_all, [<<"/">>]).

I get 

{badrpc, nodedown}

Any thoughts on what might be causing my java code to not work?

Thanks,

Brian

Note: In case you're wondering I'm on Ubuntu 9.0.4.




-- 
View this message in context: http://www.nabble.com/Having-trouble-connecting-via-jInterface-tp25866384p25866384.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From aaron.feng at gmail.com  Tue Oct 13 11:36:55 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Tue, 13 Oct 2009 06:36:55 -0400
Subject: [rabbitmq-discuss] Having trouble connecting via jInterface
In-Reply-To: <25866384.post@talk.nabble.com>
References: <25866384.post@talk.nabble.com>
Message-ID: <4e3934860910130336g732d02b4x64771cff684362ce@mail.gmail.com>

Brian,

Try connection.receiveRPC() instead of OtpMsg receiveMsg =
connection.receiveMsg();

Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091013/bfd5ceb3/attachment.htm 

From lynton.grice at logosworld.com  Tue Oct 13 11:56:56 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 13 Oct 2009 12:56:56 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?
Message-ID: <002f01ca4bf3$e609f9b0$b21ded10$@grice@logosworld.com>

Hi guys,

 

Please forgive me so the stupid question and if this question has been
answered before.

 

A long time ago I heard Mnesia has a 2GB storage limit. My question is what
happens in the case were a company wanting to use RabbitMQ needs larger
persistence? Say like 8GB?

 

I have just installed the 1.7 release and it is super, great work guys!!

 

Lynton

 

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091013/de311a3b/attachment.htm 

From matthew at lshift.net  Tue Oct 13 12:20:32 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 13 Oct 2009 12:20:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?
In-Reply-To: <002f01ca4bf3$e609f9b0$b21ded10$@grice@logosworld.com>
References: <002f01ca4bf3$e609f9b0$b21ded10$@grice@logosworld.com>
Message-ID: <20091013112032.GA20572@mrnibble.lshift.net>

On Tue, Oct 13, 2009 at 12:56:56PM +0200, Lynton Grice wrote:
> A long time ago I heard Mnesia has a 2GB storage limit.

That information is not correct. Mnesia has several different ways of
operating a table:

1. ram_copies. The table is stored in an ets table in memory and is
never written to disk. The only limit is the amount of available memory.
No 2GB limit here.

2. disc_copies. The table is stored in an ets table in memory, and is
periodically written to disk using the disk_log module (glad to see even
within Erlang's only libraries, they can't decide how to spell disk).
Again, there is no limit in size.

3. disc_only_copies. The table is stored in a dets table only on disk.
Dets tables have 32-bit internal pointers within the file, so you are
limited to 2GB.

Wonderfully, this means that if you happen to have a table in
disc_copies mode which is > 2GB, and you then decide you want to save
memory and force it to disc_only_copies, you blow up the table as dets
can't cope with tables that big.

> My question is what
> happens in the case were a company wanting to use RabbitMQ needs larger
> persistence? Say like 8GB?

The persister does not use Mnesia in any way. This is true of the
current persister in 1.7 and the future persister. We are not using
mnesia for the persister entirely because of its limitations.

The persister in 1.7 keeps all messages in memory, so you're entirely
bound by the amount of RAM available. The new persister will not have
this limitation and will be able to scale much better than the current
persister. I realise that we've been making noises about the "new"
persister since April, and we had hoped to get it out with 1.7, but hey,
software development is never a predictable activity!

> I have just installed the 1.7 release and it is super, great work guys!!

Good to hear! :D

Matthew



From lynton.grice at logosworld.com  Tue Oct 13 13:15:46 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 13 Oct 2009 14:15:46 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?
In-Reply-To: <20091013120300.GB20572@mrnibble.lshift.net>
References: <002f01ca4bf3$e609f9b0$b21ded10$@grice@logosworld.com>
	<20091013112032.GA20572@mrnibble.lshift.net>
	<004501ca4bf9$6b62d6e0$422884a0$@grice@logosworld.com>
	<20091013120300.GB20572@mrnibble.lshift.net>
Message-ID: <004b01ca4bfe$e9cdde80$bd699b80$@grice@logosworld.com>

Hi Matthew,

Thanks for the detailed response, and I really look forward to what the
persister will be doing in future releases, sounds great.

The SYNC transactions are not my concern, I do not really mind if those
messages get lost, it is the ASYNC ones that I want 100% guarantee they will
never get lost.

You said " With the persister in 1.7, messages are kept in RAM but are also
written out to disk." - are the messages written to disk by default as well?
As in the choice between "ram_copies", "disk_copies" and "disc_only_copies"?
Or are the messages simple written anyway in the 1.7 persister?

Using transactions sounds like the answer for me for now, thanks.

Last question: Do you ever forsee a day when there is no 2GB limit to DETS?

Thanks again ;-)

Lynton

-----Original Message-----
From: Matthew Sackman [mailto:matthew at lshift.net] 
Sent: 13 October 2009 02:03 PM
To: Lynton Grice
Subject: Re: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?

Hi Lynton,

Please keep rabbitmq-discuss copied in unless you have specific reason
not to, that way others can benefit from discussions.

On Tue, Oct 13, 2009 at 01:36:28PM +0200, Lynton Grice wrote:
> Forgive me if I am wrong here but in my case I want the stuff to happily
> survive a system crash ..so:
> 
> - "ram_copies" - in a system crash the messages will be lost
> - "disc_copies" - much better with the ETS and disk_log stuff BUT still
the
> *possibility* that message that are ONLY in ETS tables will get "lost" on
a
> server crash

Yes, there is the possibility that mnesia dirty operations will be lost,
but provided you use sync_transactions, you still get the guarantee that
they've been written to disk. The main gain from keeping stuff in RAM is
for speed of lookups, and also writes can be batched in some places.

> - "disc_only_copies" - although probably a little slower that the "memory
> messaging", this is the one I like, but it does have the 2GB limit ;-(

Oh, dets is *very* slow indeed. In fact it's awful - I've never seen
dets drive a disk at above 10MB/s. The new persister can easily generate
enough IO in sensible patterns to be able to totally saturate disk
bandwidth - 70+MB/s sustained is very achievable.

> You say " The persister in 1.7 keeps all messages in memory..." - then may
I
> ask a stupid question, what happens if you have 10 000 message with the
new
> persister in memory and the server bounces?

Hang on, what I'm referring to by the "new" persister, is the persister
that we're in the process of developing and is not in 1.7. With the
persister in 1.7, messages are kept in RAM but are also written out to
disk. If you exhaust RAM then yes, you will blow up RabbitMQ, though
RabbitMQ does try quite hard these days to use flow control to stop
producers when RAM gets really tight, so it should be reasonably
resiliant. However, see, eg Brian Whitman's post:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-October/005095.htm
l
Here, he is talking about a very experimental version of the new,
unreleased persister, which demonstrates that it is able to scale vastly
beyond the amount of available RAM now.

> I am a HUGE RabbitMQ fan, I am just trying to see how safe these "memory
> messages" really are from System failure?

Pretty much the only way of guaranteeing that a message has been sent to
disk and stored safely is to put the channel in transactional mode and
do a commit. When you get back the commit-ok, you know it's either
already been delivered to a client and acknowledged, or that it's been
written to disk. In all other cases, there are very few hard guarantees
offered - writing a persistent message to a queue without using
transactions means that there will be a window after the client has
published the message during which the message has not been fsync'd on
disk and at that point, a crash *may* result in messages being lost. As
ever, it's a tradeoff - if you use transactions, the extra fsync's all
over the place will hurt performance quite badly, but you get guarantees
that you otherwise wouldn't get.

What we tend to recommend is that you really think about how much
message loss you can cope with - most applications can cope with, say, a
minute's worth of messages being lost in the event of system failure as
it's possible the messages can be regenerated through other means.

Matthew




From matthew at lshift.net  Tue Oct 13 13:34:07 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 13 Oct 2009 13:34:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?
In-Reply-To: <004b01ca4bfe$e9cdde80$bd699b80$@grice@logosworld.com>
References: <002f01ca4bf3$e609f9b0$b21ded10$@grice@logosworld.com>
	<20091013112032.GA20572@mrnibble.lshift.net>
	<004501ca4bf9$6b62d6e0$422884a0$@grice@logosworld.com>
	<20091013120300.GB20572@mrnibble.lshift.net>
	<004b01ca4bfe$e9cdde80$bd699b80$@grice@logosworld.com>
Message-ID: <20091013123407.GC20572@mrnibble.lshift.net>

Lynton,

On Tue, Oct 13, 2009 at 02:15:46PM +0200, Lynton Grice wrote:
> The SYNC transactions are not my concern, I do not really mind if those
> messages get lost, it is the ASYNC ones that I want 100% guarantee they will
> never get lost.

I'm completely confused by what you mean by this. That is just not
possible. If you send an async message, eg basic.publish, there are
probably a good few dozen buffers in your local computer, the language
you're writing in, the OS network stack, the network card itself, and so
forth, all in which the message can be stored and lost in the event of
power failure. Not to mention buffers in network hubs/switches/routers,
and then in Rabbit itself, all of which can hold the message
temporarily, after it's been "sent" and before it's been written to
disk.

Unless you get some sort of reply from Rabbit, which says that "yes,
I've received the message and it's been written to disk", there is *no*
guarantee that any message you send has even been received by Rabbit,
let alone safely stored.

> You said " With the persister in 1.7, messages are kept in RAM but are also
> written out to disk." - are the messages written to disk by default as well?
> As in the choice between "ram_copies", "disk_copies" and "disc_only_copies"?
> Or are the messages simple written anyway in the 1.7 persister?

By definition, persistent messages are written to disk. They also happen
to be stored in RAM in the persister in 1.7 (and before), for a variety
of reasons. This has *nothing* to do with the various modes of operation
of mnesia, as the persister does not use mnesia at all.

> Using transactions sounds like the answer for me for now, thanks.

Right, and thus this is effectively synchronous messaging as you get the
reply back from Rabbit - the commit-ok - when you commit on the channel.

> Last question: Do you ever forsee a day when there is no 2GB limit to DETS?

It's possible that the Erlang/OTP folks will get round to rewriting it
to make it 64-bit safe, I don't know. Certainly it's not something we're
looking at doing.

Matthew



From lynton.grice at logosworld.com  Tue Oct 13 13:58:21 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 13 Oct 2009 14:58:21 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?
In-Reply-To: <20091013123407.GC20572@mrnibble.lshift.net>
References: <002f01ca4bf3$e609f9b0$b21ded10$@grice@logosworld.com>	<20091013112032.GA20572@mrnibble.lshift.net>	<004501ca4bf9$6b62d6e0$422884a0$@grice@logosworld.com>	<20091013120300.GB20572@mrnibble.lshift.net>	<004b01ca4bfe$e9cdde80$bd699b80$@grice@logosworld.com>
	<20091013123407.GC20572@mrnibble.lshift.net>
Message-ID: <004c01ca4c04$dc142b90$943c82b0$@grice@logosworld.com>

Hi there,

I am an SAP PI / XI consultant by trade so I guess my "message
acknowledgement" from a "broker" can also been seen as your SYNC whereby the
sending client gets an "ok" back from RabbitMQ.....I understand now
...thanks

And yes, you are 100% correct on the "buffers" along the way...

But most importantly is that you have cleared my thoughts that Mnesia was
used for persistence....great....and that it is actually the Erlang standard
DETS stuff that is the "problem"....I hope they make it 64 bit one day

You have helped a lot and got my brain around a few things ;-)

Chat later

Lynton



-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew
Sackman
Sent: 13 October 2009 02:34 PM
To: 'rabbitmq'
Subject: Re: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?

Lynton,

On Tue, Oct 13, 2009 at 02:15:46PM +0200, Lynton Grice wrote:
> The SYNC transactions are not my concern, I do not really mind if those
> messages get lost, it is the ASYNC ones that I want 100% guarantee they
will
> never get lost.

I'm completely confused by what you mean by this. That is just not
possible. If you send an async message, eg basic.publish, there are
probably a good few dozen buffers in your local computer, the language
you're writing in, the OS network stack, the network card itself, and so
forth, all in which the message can be stored and lost in the event of
power failure. Not to mention buffers in network hubs/switches/routers,
and then in Rabbit itself, all of which can hold the message
temporarily, after it's been "sent" and before it's been written to
disk.

Unless you get some sort of reply from Rabbit, which says that "yes,
I've received the message and it's been written to disk", there is *no*
guarantee that any message you send has even been received by Rabbit,
let alone safely stored.

> You said " With the persister in 1.7, messages are kept in RAM but are
also
> written out to disk." - are the messages written to disk by default as
well?
> As in the choice between "ram_copies", "disk_copies" and
"disc_only_copies"?
> Or are the messages simple written anyway in the 1.7 persister?

By definition, persistent messages are written to disk. They also happen
to be stored in RAM in the persister in 1.7 (and before), for a variety
of reasons. This has *nothing* to do with the various modes of operation
of mnesia, as the persister does not use mnesia at all.

> Using transactions sounds like the answer for me for now, thanks.

Right, and thus this is effectively synchronous messaging as you get the
reply back from Rabbit - the commit-ok - when you commit on the channel.

> Last question: Do you ever forsee a day when there is no 2GB limit to
DETS?

It's possible that the Erlang/OTP folks will get round to rewriting it
to make it 64-bit safe, I don't know. Certainly it's not something we're
looking at doing.

Matthew

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From kyle at raidi.us  Mon Oct 12 15:46:27 2009
From: kyle at raidi.us (Kyle Schaffrick)
Date: Mon, 12 Oct 2009 10:46:27 -0400
Subject: [rabbitmq-discuss] Async Python AMQP client lib
In-Reply-To: <6A687040-891A-42DA-831B-7431F7A795A5@gmail.com>
References: <6A687040-891A-42DA-831B-7431F7A795A5@gmail.com>
Message-ID: <E1MxMBD-0005Vh-6G@victory.heartlandliberty.org>

On Sun, 11 Oct 2009 21:42:18 -0500
S?bastien <arnaudsj at gmail.com> wrote:

> Hi,
> 
> I am new to using RabbitMQ and would like to know if the py-amqplib  
> has a branch available with non-blocking sockets for async style
> amqp consumers & producers. I did see some code was shared about a
> year ago:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-March/000550.html ,
> but I can't seem to see it integrated in the current source available
> in the mercurial repository.
> 
> I have looked at tx-amqplib, but I don't like the heavy dependencies  
> on twisted, zope, etc...
> 

I'm also working on an asynchronous/non-blocking AMQP library for
Python, built on Eventlet.

  http://bitbucket.org/edarc/amqpev

Have a look at the examples on the BB Wiki page to get a feel for the
style of the API.

It is alpha quality at the moment, still missing a feature or two, and
unfortunately I'm not aware of anyone else who has tried it yet. If
you're in the immediate need for something production ready, stick to
txAMQP.

As an aside, I would advise anyone considering Twisted to also have a
look at Eventlet, if only to compare two very different ways of looking
at event-driven problems. Only trouble with Eventlet is a practical one:
it simply cannot compete right now with Twisted's huge library of
implemented protocols.

> Thank you in advance for your advice!
> 
> Cheers!
> 
> S?bastien Arnaud
> arnaudsj at gmail.com
> 

-Kyle



From brian.peck at lmco.com  Tue Oct 13 16:07:24 2009
From: brian.peck at lmco.com (peckb)
Date: Tue, 13 Oct 2009 08:07:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Having trouble connecting via jInterface
In-Reply-To: <4e3934860910130336g732d02b4x64771cff684362ce@mail.gmail.com>
References: <25866384.post@talk.nabble.com>
	<4e3934860910130336g732d02b4x64771cff684362ce@mail.gmail.com>
Message-ID: <25874678.post@talk.nabble.com>


When I try that I just get [] from the output, which Java is telling me is an
OtpErlangList with .arity() = 0


Aaron Feng wrote:
> 
> Brian,
> 
> Try connection.receiveRPC() instead of OtpMsg receiveMsg =
> connection.receiveMsg();
> 
> Aaron
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/Having-trouble-connecting-via-jInterface-tp25866384p25874678.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From siva at runa.com  Tue Oct 13 23:42:11 2009
From: siva at runa.com (Siva Jagadeesan)
Date: Tue, 13 Oct 2009 15:42:11 -0700
Subject: [rabbitmq-discuss] Connection.createChannel returns null
Message-ID: <cd1ea3450910131542r29309215r74c5d24cd81de1e1@mail.gmail.com>

HI All:
For some reason when I create a channel using connection.createChannel it is
returning null. When I throw that connection and create a new connection ...
from then on it returns a channel for one time ... so i have to discard my
connection and create new connection every time I create channel.

I do not know why createChannel returns null.

Any insights?

-- Siva Jagadeesan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091013/f2e19548/attachment.htm 

From 0x6e6562 at gmail.com  Wed Oct 14 00:18:24 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 14 Oct 2009 00:18:24 +0100
Subject: [rabbitmq-discuss] Connection.createChannel returns null
In-Reply-To: <cd1ea3450910131542r29309215r74c5d24cd81de1e1@mail.gmail.com>
References: <cd1ea3450910131542r29309215r74c5d24cd81de1e1@mail.gmail.com>
Message-ID: <269388e30910131618m5eef6c63g7a8d30a4a3cef6a9@mail.gmail.com>

Siva,

On Tue, Oct 13, 2009 at 11:42 PM, Siva Jagadeesan <siva at runa.com> wrote:
> For some reason when I create a channel using connection.createChannel it is
> returning null. When I throw that connection and create a new connection ...
> from then on it returns a channel for one time ... so i have to discard my
> connection and create new connection every time I create channel.
> I do not know why createChannel returns null.

There is one known issue with createChannel returning null, which has
been fixed in 1.7.0.

This is documented here:
http://hopper.squarespace.com/blog/2009/8/31/hotspot-arithmetic.html

However, this may not be the cause in your case.

Please can you send a cut down version of the code that reproduces the symptom.

Ben



From brian.peck at lmco.com  Wed Oct 14 01:26:08 2009
From: brian.peck at lmco.com (peckb)
Date: Tue, 13 Oct 2009 17:26:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Having trouble connecting via jInterface
In-Reply-To: <25874678.post@talk.nabble.com>
References: <25866384.post@talk.nabble.com>
	<4e3934860910130336g732d02b4x64771cff684362ce@mail.gmail.com>
	<25874678.post@talk.nabble.com>
Message-ID: <25883302.post@talk.nabble.com>


I swapped over to python using http://gist.github.com/102602 as a base and
had much more luck, still don't know what was wrong with the java side
though.

Brian
-- 
View this message in context: http://www.nabble.com/Having-trouble-connecting-via-jInterface-tp25866384p25883302.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From siva at runa.com  Wed Oct 14 02:33:24 2009
From: siva at runa.com (Siva Jagadeesan)
Date: Tue, 13 Oct 2009 18:33:24 -0700
Subject: [rabbitmq-discuss] Connection.createChannel returns null
In-Reply-To: <269388e30910131618m5eef6c63g7a8d30a4a3cef6a9@mail.gmail.com>
References: <cd1ea3450910131542r29309215r74c5d24cd81de1e1@mail.gmail.com>
	<269388e30910131618m5eef6c63g7a8d30a4a3cef6a9@mail.gmail.com>
Message-ID: <cd1ea3450910131833x1be396dx2b49706a155694c2@mail.gmail.com>

HI Ben:
We are using RabbitMQ 1.6

It is simple code where we use one connection to create channels (almost
100K) but it starts returning null after creating 500 of them.So I discard
that connection and create a new connection. But when I create channel from
new connection , it creates only one channel and after that it keeps
returning null.

I changed my code to call createChannel(int channelNumber) ...it seems to be
working ... it has processed like 10 k records.

I will update ...

-- Siva Jagadeesan

On Tue, Oct 13, 2009 at 4:18 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Siva,
>
> On Tue, Oct 13, 2009 at 11:42 PM, Siva Jagadeesan <siva at runa.com> wrote:
> > For some reason when I create a channel using connection.createChannel it
> is
> > returning null. When I throw that connection and create a new connection
> ...
> > from then on it returns a channel for one time ... so i have to discard
> my
> > connection and create new connection every time I create channel.
> > I do not know why createChannel returns null.
>
> There is one known issue with createChannel returning null, which has
> been fixed in 1.7.0.
>
> This is documented here:
> http://hopper.squarespace.com/blog/2009/8/31/hotspot-arithmetic.html
>
> However, this may not be the cause in your case.
>
> Please can you send a cut down version of the code that reproduces the
> symptom.
>
> Ben
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091013/336bb78a/attachment.htm 

From celldee at gmail.com  Wed Oct 14 13:01:10 2009
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 14 Oct 2009 13:01:10 +0100
Subject: [rabbitmq-discuss] Recovering after forced connection close
Message-ID: <1C3C17BC-8A76-4CC1-AEFC-FCE1DB9F8F02@gmail.com>

I'm trying to make sure that I handle reconnection correctly in the  
event that RabbitMQ forces connection closure or a broken pipe  
condition occurs. I'm using RabbitMQ 1.7.0 with Erlang 12-B and the  
bunny Ruby client v0.6.0 for testing. If I shutdown the server while  
my client is connected or invoke an AMQP method with incorrect  
arguments I can create the condition whereby RabbitMQ will forcefully  
close the connection. What I'm seeing is this type of error in the  
log when I try to reconnect with the same client instance -

exception on TCP connection <0.1567.0> from 127.0.0.1:57174
{channel_frame_while_starting,1,starting,
                               {method,'connection.start_ok',
                                        
<<0,0,0,102,8,112,108,97,116,102,111,
                                          
114,109,83,0,0,0,4,82,117,98,121,7,
                                          
112,114,111,100,117,99,116,83,0,0,0,
                                          
5,66,117,110,110,121,11,105,110,102,
                                          
111,114,109,97,116,105,111,110,83,0,
                                          
0,0,31,104,116,116,112,58,47,47,103,
                                          
105,116,104,117,98,46,99,111,109,47,
                                          
99,101,108,108,100,101,101,47,98,117,
                                          
110,110,121,7,118,101,114,115,105,
                                          
111,110,83,0,0,0,5,48,46,54,46,49,8,
                                          
65,77,81,80,76,65,73,78,0,0,0,35,5,
                                          
76,79,71,73,78,83,0,0,0,5,103,117,
                                          
101,115,116,8,80,65,83,83,87,79,82,
                                          
68,83,0,0,0,5,103,117,101,115,116,5,
                                         101,110,95,85,83>>}}

I can connect with another instance without difficulty. Firstly, can  
anyone explain why this error is occurring in the circumstances that  
I have outlined and secondly, is there a way that I can reconnect  
using the same client instance.

I'm sure that I read something that stated that this is the correct  
behaviour for an AMQP server, but unfortunately I can't recall where  
I read it.

Regards,

Chris 



From tonyg at lshift.net  Wed Oct 14 13:35:42 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 14 Oct 2009 13:35:42 +0100
Subject: [rabbitmq-discuss] Recovering after forced connection close
In-Reply-To: <1C3C17BC-8A76-4CC1-AEFC-FCE1DB9F8F02@gmail.com>
References: <1C3C17BC-8A76-4CC1-AEFC-FCE1DB9F8F02@gmail.com>
Message-ID: <4AD5C59E.2010905@lshift.net>

Hi Chris,

Chris Duncan wrote:
> exception on TCP connection <0.1567.0> from 127.0.0.1:57174
> {channel_frame_while_starting,1,starting,
>                                {method,'connection.start_ok',

This occurs when a method frame with non-zero channel number is received
during the connection startup and negotiation phase. I suspect the Ruby
client library: I think it is getting confused somehow, and issuing a
connection.start-ok with non-zero channel number (which is not permitted
by the spec).

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From celldee at gmail.com  Wed Oct 14 13:57:58 2009
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 14 Oct 2009 13:57:58 +0100
Subject: [rabbitmq-discuss] Recovering after forced connection close
References: <BB1FFA96-A456-4FC3-ACFD-261F34357CB7@gmail.com>
Message-ID: <5966A62D-65EE-4592-B13B-8DF55D930E5C@gmail.com>

Fabulous! Thanks Tony, that makes perfect sense.

Regards,

Chris
>




From scott.brooks at epicadvertising.com  Wed Oct 14 16:04:42 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Wed, 14 Oct 2009 10:04:42 -0500
Subject: [rabbitmq-discuss] rabbitmq-c
In-Reply-To: <4AD30845.1000305@lshift.net>
References: <D2DD5010-F61C-47E8-953B-BBF3F927C523@epicadvertising.com>
	<4AD30845.1000305@lshift.net>
Message-ID: <CEEEF50F-34A2-4155-9047-755C3D96F5E4@epicadvertising.com>

I've attached the bundle, hopefully I've generated that right.

changeset:   50:e0f5366d047c
tag:         tip
parent:      48:943c20e50f0f
user:        "Scott Brooks <scott.brooks at epicadvertising.com>"
date:        Wed Oct 14 10:42:50 2009 -0400
files:       librabbitmq/amqp.h librabbitmq/amqp_api.c librabbitmq/ 
amqp_socket.c
description:
Updated amqp_simple_rpc to take a 0 terminated array of  
amqp_method_number_t replies
Updated AMQP_SIMPLE_RPC macro for the new format
Added AMQP_MULTIPLE_RESPONSE_RPC macro to take a 0 terminated array of  
amqp_method_number_t replies
Added amqp_basic_get function
Added amqp_queue_purge function
Added amqp_get_rpc_reply function to expose amqp_rpc_reply when we are  
not statically linking
Added amqp_data_in_buffer function to check to see if  
amqp_simple_wait_frames will hit a blocking read



-------------- next part --------------
A non-text attachment was scrubbed...
Name: basic_get_and_more.bundle
Type: application/octet-stream
Size: 2143 bytes
Desc: basic_get_and_more.bundle
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091014/96af8443/attachment.obj 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ATT00001.c
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091014/96af8443/attachment.txt 

From tonyg at lshift.net  Wed Oct 14 17:54:56 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 14 Oct 2009 17:54:56 +0100
Subject: [rabbitmq-discuss] rabbitmq-c
In-Reply-To: <CEEEF50F-34A2-4155-9047-755C3D96F5E4@epicadvertising.com>
References: <D2DD5010-F61C-47E8-953B-BBF3F927C523@epicadvertising.com>
	<4AD30845.1000305@lshift.net>
	<CEEEF50F-34A2-4155-9047-755C3D96F5E4@epicadvertising.com>
Message-ID: <4AD60260.6070104@lshift.net>

Scott Brooks wrote:
> I've attached the bundle, hopefully I've generated that right.

Applied, with thanks! Great stuff.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From cremes.devlist at mac.com  Wed Oct 14 18:20:20 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Wed, 14 Oct 2009 12:20:20 -0500
Subject: [rabbitmq-discuss] rabbitmq-c
In-Reply-To: <CEEEF50F-34A2-4155-9047-755C3D96F5E4@epicadvertising.com>
References: <D2DD5010-F61C-47E8-953B-BBF3F927C523@epicadvertising.com>
	<4AD30845.1000305@lshift.net>
	<CEEEF50F-34A2-4155-9047-755C3D96F5E4@epicadvertising.com>
Message-ID: <3EBDBCDD-121F-4994-BEE3-452131C8884E@mac.com>


On Oct 14, 2009, at 10:04 AM, Scott Brooks wrote:

> I've attached the bundle, hopefully I've generated that right.
>
> changeset:   50:e0f5366d047c
> tag:         tip
> parent:      48:943c20e50f0f
> user:        "Scott Brooks <scott.brooks at epicadvertising.com>"
> date:        Wed Oct 14 10:42:50 2009 -0400
> files:       librabbitmq/amqp.h librabbitmq/amqp_api.c librabbitmq/
> amqp_socket.c
> description:
> Updated amqp_simple_rpc to take a 0 terminated array of
> amqp_method_number_t replies
> Updated AMQP_SIMPLE_RPC macro for the new format
> Added AMQP_MULTIPLE_RESPONSE_RPC macro to take a 0 terminated array of
> amqp_method_number_t replies
> Added amqp_basic_get function
> Added amqp_queue_purge function
> Added amqp_get_rpc_reply function to expose amqp_rpc_reply when we are
> not statically linking
> Added amqp_data_in_buffer function to check to see if
> amqp_simple_wait_frames will hit a blocking read

Scott,

are you going to announce a new ruby amqp library based off of this  
work?

cr




From theczintheroc2007 at gmail.com  Thu Oct 15 01:28:57 2009
From: theczintheroc2007 at gmail.com (Colin Z)
Date: Wed, 14 Oct 2009 20:28:57 -0400
Subject: [rabbitmq-discuss] AMQP ack with multiple subscribers
Message-ID: <ce47f6b80910141728x60efff1cn64eae134b01bc2a9@mail.gmail.com>

If I have a queue with multiple subscribers/consumers and it also requires
acks for the messages, what is the resulting behavior?

Will the queue round robin the messages out to the subscribers regardless of
whether the messages have been ack'ed yet or not? Or will the first message
basically stall the delivery of the other messages in the queue until the
first message has been ack'ed?

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091014/d08b9e5a/attachment.htm 

From sh at defuze.org  Thu Oct 15 06:34:33 2009
From: sh at defuze.org (Sylvain Hellegouarch)
Date: Thu, 15 Oct 2009 07:34:33 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?
In-Reply-To: <20091013112032.GA20572@mrnibble.lshift.net>
References: <002f01ca4bf3$e609f9b0$b21ded10$@grice@logosworld.com>
	<20091013112032.GA20572@mrnibble.lshift.net>
Message-ID: <4AD6B469.20106@defuze.org>


>
> The persister does not use Mnesia in any way. This is true of the
> current persister in 1.7 and the future persister. We are not using
> mnesia for the persister entirely because of its limitations.
>
> The persister in 1.7 keeps all messages in memory, so you're entirely
> bound by the amount of RAM available. The new persister will not have
> this limitation and will be able to scale much better than the current
> persister. I realise that we've been making noises about the "new"
> persister since April, and we had hoped to get it out with 1.7, but hey,
> software development is never a predictable activity!
>
>   
Understable indeed :)

I have a related question:

I'm not versed to Erlang enough to understand how/when it releases 
memory, it has grabbed. So if there is a sudden burst of messages into 
RabbitMQ, the memory usage will grow but will it be released eventually?

Cheers,
- Sylvain



From sh at defuze.org  Thu Oct 15 06:39:25 2009
From: sh at defuze.org (Sylvain Hellegouarch)
Date: Thu, 15 Oct 2009 07:39:25 +0200
Subject: [rabbitmq-discuss] CPU usage with RabbitMQ 1.7
Message-ID: <4AD6B58D.2010701@defuze.org>

Hello there,

We've been stress testing our infrastructure recently and we've been 
surprised to notice that RabbitMQ was really hungry in memory (which is 
more or less okay if we the OS gets it back eventually) but also in CPU.

Our messages are about 100 bytes each and our consumer isn't as fast as 
our producer (though it is very capable in our book) but we have 
difficulties understanding why Rabbit is so CPU bound.

We were also feeling that the queue isn't filled as fast as the exchange 
(topic) and Rabbit seems to feed the queues on demand based on the 
consumer speed. Is it a valid description of what happens or is it a 
false observation on our part?

Thanks for any tips,
- Sylvain



From vertolet666 at yandex.ru  Thu Oct 15 10:15:21 2009
From: vertolet666 at yandex.ru (DOBRO)
Date: Thu, 15 Oct 2009 02:15:21 -0700 (PDT)
Subject: [rabbitmq-discuss]  unknown revision rabbitmq_v1_7_0
Message-ID: <25904861.post@talk.nabble.com>


Hi there!

Tried to compile stomp adapter for RabbitMQ 1.7.0.
Running hg -R rabbitmq-stomp up rabbitmq_v1_7_0
gives:
abort: unknown revision 'rabbitmq_v1_7_0'!

hg tags:
tip                              141:d34b8079faa5
rabbitmq_v1_6_0                  102:6d49eaa2fc25
rabbitmq_v1_5_5                   99:7376596ad8a4
rabbitmq_v1_5_3                   91:5ee5e2c0b64a
rabbitmq_v1_5_1                   65:2eba20816126
rabbitmq_v1_5_0                   60:1a1ff5067bb6
rabbitmq_v1_4_0                   49:71b922193057
Migrated to mercurial             11:a28eea2c2a2b

Which proper revision should I use to compile stomp adapter for RabbitMQ
1.7.0?
Is it ready?
-- 
View this message in context: http://www.nabble.com/unknown-revision-rabbitmq_v1_7_0-tp25904861p25904861.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From ben.browitt at gmail.com  Thu Oct 15 10:51:33 2009
From: ben.browitt at gmail.com (Ben Browitt)
Date: Thu, 15 Oct 2009 11:51:33 +0200
Subject: [rabbitmq-discuss] Streaming stock prices to long-polling clients
Message-ID: <b0200d7f0910150251o2f618c38x3daf09f49eeed171@mail.gmail.com>

Hi,

In my application I need to stream stock prices to users.
The 'last price' will be retrieved from a separate service when a consumer
connects which simplifies things.
Each user will subscribe to several stocks.
Users are web browsers connecting using long-polling.

Do I create one queue per consumer with several bindings, one for each
stock?
Prices in this case will be sent with a topic routing key.
Another option is to create one queue per stock. each consumer will be
subscribed to several queues.
Messages will be sent with a direct routing key.

Users will connect using a browser with long-polling to the mochiweb plugin.
Each user will be presented at the server side as an erlang AMQP client.
When using long-polling it is possible that the server sent responses to
both connections and have to wait for the user to send a new request.
How do I handle this scenario? Does the erlang client store the messages in
its state?
Every time the erlang client gets a new long-polling request it checks for
messages in the state,
if there are messages it sends them immediately and if there aren't it
keep-alive the request.
Another option is that the erlang client will acknowledge messages only if
it can pass it to the web client.
What will happen in this case? Will the queue keep sending new messages or
will it wait for the erlang client o 'initialize' the channel?
Are there a suspend and resume features?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091015/ab24e5d3/attachment.htm 

From majek04 at gmail.com  Thu Oct 15 11:15:03 2009
From: majek04 at gmail.com (majek04)
Date: Thu, 15 Oct 2009 11:15:03 +0100
Subject: [rabbitmq-discuss] AMQP ack with multiple subscribers
In-Reply-To: <ce47f6b80910141728x60efff1cn64eae134b01bc2a9@mail.gmail.com>
References: <ce47f6b80910141728x60efff1cn64eae134b01bc2a9@mail.gmail.com>
Message-ID: <3bb0d9710910150315u4c3da99eq8a9f433498cfc0ce@mail.gmail.com>

On Thu, Oct 15, 2009 at 01:28, Colin Z <theczintheroc2007 at gmail.com> wrote:
> If I have a queue with multiple subscribers/consumers and it also requires
> acks for the messages, what is the resulting behavior?
>
> Will the queue round robin the messages out to the subscribers regardless of
> whether the messages have been ack'ed yet or not? Or will the first message
> basically stall the delivery of the other messages in the queue until the
> first message has been ack'ed?

By default, if you have two consumers that are reading from one
queue, they will receive exactly every second message. No matter
if the messages were "light" or "heavy". For example, if queue looks like:
[light, heavy, light, heavy, light, heavy]
The first consumer will get all the "light" messages, and the second
one will get all the "heavy" ones. No matter when they will be acknowledged.
See this code:
http://ai.pjwstk.edu.pl/~majek/dump/qos_no.py


Basic.qos is used to fight this limitation. Using it you can specify
how many messages are allowed to be unacknowledged for a channel.
Here you can see how to use it:
http://ai.pjwstk.edu.pl/~majek/dump/qos_yes.py

Cheers!
  Marek Majkowski



From tonyg at lshift.net  Thu Oct 15 11:25:18 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 15 Oct 2009 11:25:18 +0100
Subject: [rabbitmq-discuss] AMQP ack with multiple subscribers
In-Reply-To: <ce47f6b80910141728x60efff1cn64eae134b01bc2a9@mail.gmail.com>
References: <ce47f6b80910141728x60efff1cn64eae134b01bc2a9@mail.gmail.com>
Message-ID: <4AD6F88E.7000001@lshift.net>

Colin Z wrote:
> Will the queue round robin the messages out to the subscribers
> regardless of whether the messages have been ack'ed yet or not?

Yes, as best it can, up to each subscriber's basic.qos and TCP buffer
limitations.

Acking only affects flow of messages when basic.qos is in effect.

Regards,
  Tony




From scott.brooks at epicadvertising.com  Thu Oct 15 14:21:44 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Thu, 15 Oct 2009 08:21:44 -0500
Subject: [rabbitmq-discuss] rabbitmq-c
In-Reply-To: <3EBDBCDD-121F-4994-BEE3-452131C8884E@mac.com>
References: <D2DD5010-F61C-47E8-953B-BBF3F927C523@epicadvertising.com>
	<4AD30845.1000305@lshift.net>
	<CEEEF50F-34A2-4155-9047-755C3D96F5E4@epicadvertising.com>
	<3EBDBCDD-121F-4994-BEE3-452131C8884E@mac.com>
Message-ID: <9C77FF01-1437-4FFA-B926-278BADB848ED@epicadvertising.com>

On 2009-10-14, at 1:20 PM, Chuck Remes wrote:

>
> Scott,
>
> are you going to announce a new ruby amqp library based off of this
> work?
>
> cr
>

I'm pretty sure we will.  Right now it depends on ffi-0.6.0 which  
doesn't have a gem made for it yet.
Once that's out, I'm pretty sure I'll clean things up, and send it out.

Scott


>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From theczintheroc2007 at gmail.com  Thu Oct 15 15:18:40 2009
From: theczintheroc2007 at gmail.com (Colin Z)
Date: Thu, 15 Oct 2009 10:18:40 -0400
Subject: [rabbitmq-discuss] AMQP ack with multiple subscribers
In-Reply-To: <3bb0d9710910150315u4c3da99eq8a9f433498cfc0ce@mail.gmail.com>
References: <ce47f6b80910141728x60efff1cn64eae134b01bc2a9@mail.gmail.com>
	<3bb0d9710910150315u4c3da99eq8a9f433498cfc0ce@mail.gmail.com>
Message-ID: <ce47f6b80910150718p19a28bas432897ff407de7ce@mail.gmail.com>

Thanks Marek and Tony,

Sorry to belabor the question, but I just want to make sure I understand.

Say I have Consumers A and B subscribed to queue Q which has 10 messages in
it.

"A" would get message 1 and let's say it takes 10 seconds to process before
it ACKs. At what time would "B" get message 2: immediately, or after 10
seconds?


On Thu, Oct 15, 2009 at 6:15 AM, majek04 <majek04 at gmail.com> wrote:

> On Thu, Oct 15, 2009 at 01:28, Colin Z <theczintheroc2007 at gmail.com>
> wrote:
> > If I have a queue with multiple subscribers/consumers and it also
> requires
> > acks for the messages, what is the resulting behavior?
> >
> > Will the queue round robin the messages out to the subscribers regardless
> of
> > whether the messages have been ack'ed yet or not? Or will the first
> message
> > basically stall the delivery of the other messages in the queue until the
> > first message has been ack'ed?
>
> By default, if you have two consumers that are reading from one
> queue, they will receive exactly every second message. No matter
> if the messages were "light" or "heavy". For example, if queue looks like:
> [light, heavy, light, heavy, light, heavy]
> The first consumer will get all the "light" messages, and the second
> one will get all the "heavy" ones. No matter when they will be
> acknowledged.
> See this code:
> http://ai.pjwstk.edu.pl/~majek/dump/qos_no.py<http://ai.pjwstk.edu.pl/%7Emajek/dump/qos_no.py>
>
>
> Basic.qos is used to fight this limitation. Using it you can specify
> how many messages are allowed to be unacknowledged for a channel.
> Here you can see how to use it:
> http://ai.pjwstk.edu.pl/~majek/dump/qos_yes.py<http://ai.pjwstk.edu.pl/%7Emajek/dump/qos_yes.py>
>
> Cheers!
>  Marek Majkowski
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091015/999e08ff/attachment.htm 

From tonyg at lshift.net  Thu Oct 15 15:41:09 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 15 Oct 2009 15:41:09 +0100
Subject: [rabbitmq-discuss] AMQP ack with multiple subscribers
In-Reply-To: <ce47f6b80910150718p19a28bas432897ff407de7ce@mail.gmail.com>
References: <ce47f6b80910141728x60efff1cn64eae134b01bc2a9@mail.gmail.com>	<3bb0d9710910150315u4c3da99eq8a9f433498cfc0ce@mail.gmail.com>
	<ce47f6b80910150718p19a28bas432897ff407de7ce@mail.gmail.com>
Message-ID: <4AD73485.6080607@lshift.net>

Colin Z wrote:
> "A" would get message 1 and let's say it takes 10 seconds to process
> before it ACKs. At what time would "B" get message 2: immediately, or
> after 10 seconds?

Immediately.

Regards,
  Tony




From tsuraan at gmail.com  Thu Oct 15 17:38:10 2009
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 15 Oct 2009 11:38:10 -0500
Subject: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?
In-Reply-To: <4AD6B469.20106@defuze.org>
References: <20091013112032.GA20572@mrnibble.lshift.net>
	<4AD6B469.20106@defuze.org>
Message-ID: <84fb38e30910150938ie983245x5ca8151400606ac7@mail.gmail.com>

> I'm not versed to Erlang enough to understand how/when it releases
> memory, it has grabbed. So if there is a sudden burst of messages into
> RabbitMQ, the memory usage will grow but will it be released eventually?

Yup.  In practice, I've seen rabbit grow to over 1.5G, and then shrink
back down to ~200MB as messages are drained.  I don't think I've ever
seen it shrink down to the memory usage of a totally new rabbit
server, but it definitely does free up RAM as it runs.



From tsuraan at gmail.com  Thu Oct 15 20:23:21 2009
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 15 Oct 2009 14:23:21 -0500
Subject: [rabbitmq-discuss] When is persister.log.previous made?
Message-ID: <84fb38e30910151223x27e19ba1mee1a24f06a7c06b4@mail.gmail.com>

One of our systems overfed the rabbit, and it's now a bit angry.  The
strange problem that we're having, though, is that it seems that the
commit after the thousandth ack'd message is triggering the persister
log rollover, which is then causing beam to run out of memory.  The
only thing we're doing is basic_get'ing messages, acking them, and
then committing (the channel is transactional).  We've also tried
committing every thousand messages; either way, the first commit after
the thousandth ack'd message is causing the persister log rollover,
followed immediately by beam crashing due to being out of RAM.

Does anybody know why rolling the persister log would cause the system
to run out of memory?  It seems like a strange place to need to
allocate a lot of RAM, but I'm not at all familiar with how the
persister rollover works.  I'm going to next try just doing basic_gets
without being in a transaction to see if that prevents the crash, but
I'd like a better understanding of how the log rollover works, and why
it seems to need a lot of memory to succeed.

Also, will the future (1.8?) persister still do the process described
in https://dev.rabbitmq.com/wiki/RabbitPersisterDesign ?  Writing the
entire rabbit state to disk every so-often doesn't seem like it would
work terribly well when storing huge amounts of data, or am I
understanding how the persister log works?



From sh at defuze.org  Thu Oct 15 20:25:03 2009
From: sh at defuze.org (Sylvain Hellegouarch)
Date: Thu, 15 Oct 2009 21:25:03 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7 and persistence limit?
In-Reply-To: <84fb38e30910150938ie983245x5ca8151400606ac7@mail.gmail.com>
References: <20091013112032.GA20572@mrnibble.lshift.net>	
	<4AD6B469.20106@defuze.org>
	<84fb38e30910150938ie983245x5ca8151400606ac7@mail.gmail.com>
Message-ID: <4AD7770F.4050900@defuze.org>

tsuraan a ?crit :
>> I'm not versed to Erlang enough to understand how/when it releases
>> memory, it has grabbed. So if there is a sudden burst of messages into
>> RabbitMQ, the memory usage will grow but will it be released eventually?
>>     
>
> Yup.  In practice, I've seen rabbit grow to over 1.5G, and then shrink
> back down to ~200MB as messages are drained.  I don't think I've ever
> seen it shrink down to the memory usage of a totally new rabbit
> server, but it definitely does free up RAM as it runs.
>   
Thanks for the feedback. That's useful to know :)

- Sylvain



From nabble at sonicsnes.net  Thu Oct 15 20:48:52 2009
From: nabble at sonicsnes.net (sonicsnes)
Date: Thu, 15 Oct 2009 12:48:52 -0700 (PDT)
Subject: [rabbitmq-discuss]  rabbitmq-stomp connection stats?
Message-ID: <25914888.post@talk.nabble.com>


I'm relatively new to rabbitmq, but I've recently managed to set up an
instance of rabbitmq. We're planning on having a couple thousand clients
connected to the rabbitmq-stomp adapter, but need to have a way to count the
number (and ip addresses of) the current connections. Running "rabbitmqctl
list_connections" doesn't seem to pick up on anyone connecting through
stomp. Any suggestions?
-- 
View this message in context: http://www.nabble.com/rabbitmq-stomp-connection-stats--tp25914888p25914888.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From diclophis at gmail.com  Thu Oct 15 21:24:28 2009
From: diclophis at gmail.com (Jon Bardin)
Date: Thu, 15 Oct 2009 13:24:28 -0700
Subject: [rabbitmq-discuss] presence notifications
Message-ID: <c1d41d540910151324w274de0d9n37f9098032ab7685@mail.gmail.com>

Hello,

Is it possible to broadcast a message to a particular queue/topic when a
client connects/disconnects?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091015/5e350a0a/attachment.htm 

From 0x6e6562 at gmail.com  Thu Oct 15 23:22:52 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 15 Oct 2009 23:22:52 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp connection stats?
In-Reply-To: <25914888.post@talk.nabble.com>
References: <25914888.post@talk.nabble.com>
Message-ID: <269388e30910151522s53af846eh8c845567773d77f7@mail.gmail.com>

Sonicsnes,

On Thu, Oct 15, 2009 at 8:48 PM, sonicsnes <nabble at sonicsnes.net> wrote:
>
> I'm relatively new to rabbitmq, but I've recently managed to set up an
> instance of rabbitmq. We're planning on having a couple thousand clients
> connected to the rabbitmq-stomp adapter, but need to have a way to count the
> number (and ip addresses of) the current connections. Running "rabbitmqctl
> list_connections" doesn't seem to pick up on anyone connecting through
> stomp. Any suggestions?

rabbitmqctl addresses the core Rabbit API, of which the AMQP TCP
listeners are a part. The STOMP adapter OTOH sets up its own TCP
listener hierarchy on the STOMP port and delegates decoded STOMP
commands to the corresponding AMQP *channels* within the same VM as
the AMQP broker. The core Rabbit broker has no awareness of any
applications running in the same process space as itself and hence
cannot report on these processes (without any notion of a listener
plugin mechanism). If you really need this management information I
suggest that you either use AMQP instead of STOMP as a wire protocol
or port the TCP supervision functionality to the STOMP adapter.

Ben



From nabble at sonicsnes.net  Thu Oct 15 23:27:28 2009
From: nabble at sonicsnes.net (sonicsnes)
Date: Thu, 15 Oct 2009 15:27:28 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-stomp connection stats?
In-Reply-To: <25914888.post@talk.nabble.com>
References: <25914888.post@talk.nabble.com>
Message-ID: <25917037.post@talk.nabble.com>


After thinking about it more, I think I may be able to get away with a queue
list. I can just force each stomp client to subscribe to a unique queue when
it connects (with its own IP address in the name), then request a queue list
from the server side. Then, when the stomp client disconnects,
rabbitmq-stomp automatically deletes the unique queue automagically.

Thanks for the input.
-- 
View this message in context: http://www.nabble.com/rabbitmq-stomp-connection-stats--tp25914888p25917037.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From tim at cloudspace.com  Fri Oct 16 16:11:02 2009
From: tim at cloudspace.com (Tim Rosenblatt)
Date: Fri, 16 Oct 2009 11:11:02 -0400
Subject: [rabbitmq-discuss] RabbitMQ randomly dying under Ubuntu 9.04
Message-ID: <381842ac0910160811v304e6fddqdd7ff69c4a3b43c8@mail.gmail.com>

How can i debug a rabbitmq server that randomly dies/stops accepting
connections? I'm running off ubuntu and installed via apt-get. Usually when
restarting, it's the persister that won't restart. The current solution is
to delete the contents of /var/lib/rabbmq, but that feels like a hack and
not a solution.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091016/6c3be3b3/attachment.htm 

From allengeoffreyjones at gmail.com  Sat Oct 17 14:16:58 2009
From: allengeoffreyjones at gmail.com (Allen Jones)
Date: Sat, 17 Oct 2009 14:16:58 +0100
Subject: [rabbitmq-discuss] Errors Running on Win 2008 as a service
Message-ID: <001201ca4f2c$1c078290$541687b0$@com>

Hi,

 

I tried to send this through Nabble, but it wouldn't post properly, so sorry
if you see this multiple times. 

 

I am having a recurring problem and don't know enough about Rabbit to
understand the cause how to fix it.

 

I am running RMQ 1.6 as a Windows Service on Windows Server 2008 sp1.
Generally things are fine, but there have been a few instances where the
service just stops/crashes. The debug info for one recent crash is pasted
below. Looks like some kind of memory allocation problem, but it doesn't
seem to be happening necessarily when the exchange is under the highest
usage/demand, or when the queues are at the largest. So not sure what the
cause might be. Would 


Eshell V5.5.5  (abort with ^G) 
(rabbit at WIN-8SEQ2ZQC8P2)1> RabbitMQ 1.6.0 (AMQP 8-0) 
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd. 
Licensed under the MPL.  See http://www.rabbitmq.com/

(rabbit at WIN-8SEQ2ZQC8P2)1> node        : rabbit at WIN-8SEQ2ZQC8P2 
(rabbit at WIN-8SEQ2ZQC8P2)1> log         :
C:/QuantumBlack/RabbitMQ/log/rabbit.log 
(rabbit at WIN-8SEQ2ZQC8P2)1> sasl log    :
C:/QuantumBlack/RabbitMQ/log/rabbit-sasl.log 
(rabbit at WIN-8SEQ2ZQC8P2)1> database dir:
c:/QuantumBlack/RabbitMQ/db/rabbit-mnesia 
(rabbit at WIN-8SEQ2ZQC8P2)1> 
(rabbit at WIN-8SEQ2ZQC8P2)1> starting database
...(rabbit at WIN-8SEQ2ZQC8P2)1> done 
(rabbit at WIN-8SEQ2ZQC8P2)1> starting core processes
...(rabbit at WIN-8SEQ2ZQC8P2)1> done 
(rabbit at WIN-8SEQ2ZQC8P2)1> starting recovery
...(rabbit at WIN-8SEQ2ZQC8P2)1> done 
(rabbit at WIN-8SEQ2ZQC8P2)1> starting persister
...(rabbit at WIN-8SEQ2ZQC8P2)1> done 
(rabbit at WIN-8SEQ2ZQC8P2)1> starting guid generator
...(rabbit at WIN-8SEQ2ZQC8P2)1> done 
(rabbit at WIN-8SEQ2ZQC8P2)1> starting builtin applications
...(rabbit at WIN-8SEQ2ZQC8P2)1> done 
(rabbit at WIN-8SEQ2ZQC8P2)1> starting TCP listeners
...(rabbit at WIN-8SEQ2ZQC8P2)1> done 
(rabbit at WIN-8SEQ2ZQC8P2)1> 
broker running 
(rabbit at WIN-8SEQ2ZQC8P2)1> binary_alloc: Cannot allocate 319762309 bytes of
memory (of type "binary"). 

This application has requested the Runtime to terminate it in an unusual
way. 
Please contact the application's support team for more information.

 

I had the same thing occur again last night, but the error this time was: 

 binary_alloc: Cannot allocate 521936656 bytes of memory (of type "binary").


Having a look around, I noticed that the rabbit_persister.log file was about
this size, so I am assuming the two are related. 

Any help much appreciated. 

Regards 
Allen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091017/f8dd33f2/attachment.htm 

From uwe at datek.no  Sun Oct 18 22:00:28 2009
From: uwe at datek.no (Uwe Kubosch)
Date: Sun, 18 Oct 2009 23:00:28 +0200
Subject: [rabbitmq-discuss] What does "beta" mean for RabbitMQ?
Message-ID: <3A0E721E-A1B2-478F-89B2-1521B029DFE3@datek.no>

Hi all!

Here are a few FAQs for you:

Why are all the releases of RabiitMQ "beta"?

What does "beta" mean in this context?

Should I NOT use RabbitMQ in a production environment?

What are the criteria for a "final" release of RabbitMQ?

Feel free to answer directly or post a link  :)  I have read the FAQs  
and other documentation, and RabbitMQ seems mature from user reports,  
but the official status of "beta" bothers me, and I am struggling to  
understand what it means.

Any reply is appreciated.


With kind regards,
Uwe Kubosch
Datek Wireless AS
Norway

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091018/9199b82b/attachment.htm 

From alexis.richardson at gmail.com  Sun Oct 18 22:16:58 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 18 Oct 2009 22:16:58 +0100
Subject: [rabbitmq-discuss] What does "beta" mean for RabbitMQ?
In-Reply-To: <3A0E721E-A1B2-478F-89B2-1521B029DFE3@datek.no>
References: <3A0E721E-A1B2-478F-89B2-1521B029DFE3@datek.no>
Message-ID: <167204d20910181416y489f05caqe5bfe4fe852df2d8@mail.gmail.com>

Uwe

Great questions.  We seek advice on how to make this clearer.  Please
take a look at this first, and let us know what you think:

http://www.trapexit.org/forum/viewtopic.php?p=49591&sid=20d06e54360b9122cd625eb6e459cfeb

alexis


On Sun, Oct 18, 2009 at 10:00 PM, Uwe Kubosch <uwe at datek.no> wrote:
> Hi all!
> Here are a few FAQs for you:
> Why are all the releases of RabiitMQ "beta"?
> What does "beta" mean in this context?
> Should I NOT use RabbitMQ in a production environment?
> What are the criteria for a "final" release of RabbitMQ?
> Feel free to answer directly or post a link ?:) ?I have read the FAQs and
> other documentation, and RabbitMQ seems mature from user reports, but the
> official status of "beta" bothers me, and I am struggling to understand what
> it means.
> Any reply is appreciated.
>
> With kind regards,
> Uwe Kubosch
> Datek Wireless AS
> Norway
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From ben.browitt at gmail.com  Mon Oct 19 02:03:27 2009
From: ben.browitt at gmail.com (Ben Browitt)
Date: Mon, 19 Oct 2009 03:03:27 +0200
Subject: [rabbitmq-discuss] mochiweb plugin
Message-ID: <b0200d7f0910181803t1685b6b1od61c6b47f85b2365@mail.gmail.com>

Hi,

I'm trying to use the rabbitmq-mochiweb plugin as explained in
http://www.rabbitmq.com/plugin-development.html#getting-started
I have several issues with it.

rabbitmq_mochiweb.app is missing rabbit_mochiweb_registry in the list of
modules

When activating the rabbitmq-mochiweb plugin, mochiweb is not included in
the erlang path.
I needed to add the mochiweb folder to the rabbitmq-server/plugins directory
in addition to rabbitmq-mochiweb.
Isn't the plugin suppose to take care of that?

When trying to activate the rabbitmq-jsonrpc I'm getting:
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit_jsonrpc,{bad_return,{{rabbit_jsonrpc,start,[normal,[]]},{'EXIT',{noproc,{gen_server,call,[rabbit_mochiweb_registry,{add,#Fun<rabbit_mochiweb.0.118905840>,#Fun<rabbit_jsonrpc.0.21203153>}]}}}}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit_jsonrpc,{bad_return,{{rabbit_jsonrpc,start,[normal,[]]},{'EXIT',{noproc,{gen_server,call,[rabbit_mochiweb_registry,{
make: *** [run] Error 1

The README of the rabbitmq-mochiweb is outdated.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091019/7b3637e8/attachment.htm 

From pauljones23 at gmail.com  Mon Oct 19 08:52:17 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 19 Oct 2009 08:52:17 +0100
Subject: [rabbitmq-discuss] mochiweb plugin
In-Reply-To: <b0200d7f0910181803t1685b6b1od61c6b47f85b2365@mail.gmail.com>
References: <b0200d7f0910181803t1685b6b1od61c6b47f85b2365@mail.gmail.com>
Message-ID: <29598b610910190052g684a78eci6534570ee84c864c@mail.gmail.com>

Hi Ben,

We'll have a look at these issues and get them corrected as quickly as
possible.

As for installing mochiweb, the mochiweb.ez file does need to be installed
into your plugin directory - the rabbitmq-mochiweb is mainly focussed on
providing a support layer around it.

Can you explain more about the process that you're following to get the
error you report? The plugin activation process itself shouldn't cause
applications to be started - I'm assuming you're seeing this error when
booting rabbit after installing the plugins?

Paul.

On Mon, Oct 19, 2009 at 2:03 AM, Ben Browitt <ben.browitt at gmail.com> wrote:

> Hi,
>
> I'm trying to use the rabbitmq-mochiweb plugin as explained in
> http://www.rabbitmq.com/plugin-development.html#getting-started
> I have several issues with it.
>
> rabbitmq_mochiweb.app is missing rabbit_mochiweb_registry in the list of
> modules
>
> When activating the rabbitmq-mochiweb plugin, mochiweb is not included in
> the erlang path.
> I needed to add the mochiweb folder to the rabbitmq-server/plugins
> directory in addition to rabbitmq-mochiweb.
> Isn't the plugin suppose to take care of that?
>
> When trying to activate the rabbitmq-jsonrpc I'm getting:
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit_jsonrpc,{bad_return,{{rabbit_jsonrpc,start,[normal,[]]},{'EXIT',{noproc,{gen_server,call,[rabbit_mochiweb_registry,{add,#Fun<rabbit_mochiweb.0.118905840>,#Fun<rabbit_jsonrpc.0.21203153>}]}}}}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit_jsonrpc,{bad_return,{{rabbit_jsonrpc,start,[normal,[]]},{'EXIT',{noproc,{gen_server,call,[rabbit_mochiweb_registry,{
> make: *** [run] Error 1
>
> The README of the rabbitmq-mochiweb is outdated.
>
> Thanks
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091019/24cd076b/attachment.htm 

From ben.browitt at gmail.com  Mon Oct 19 09:08:24 2009
From: ben.browitt at gmail.com (Ben Browitt)
Date: Mon, 19 Oct 2009 10:08:24 +0200
Subject: [rabbitmq-discuss] mochiweb plugin
In-Reply-To: <29598b610910190052g684a78eci6534570ee84c864c@mail.gmail.com>
References: <b0200d7f0910181803t1685b6b1od61c6b47f85b2365@mail.gmail.com>
	<29598b610910190052g684a78eci6534570ee84c864c@mail.gmail.com>
Message-ID: <b0200d7f0910190108w31cd1990r17ba0ef9c48aac83@mail.gmail.com>

On Mon, Oct 19, 2009 at 9:52 AM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Ben,
>
> We'll have a look at these issues and get them corrected as quickly as
> possible.
>
> As for installing mochiweb, the mochiweb.ez file does need to be installed
> into your plugin directory - the rabbitmq-mochiweb is mainly focussed on
> providing a support layer around it.
>

If mochiweb.ez should be installed in the plugin directory it will help if
you can document it or even better create two plugins, rabbitmq-mochiweb for
the wrapper and mochiweb for mochiweb itself.
When I run make in the rabbitmq-mochiweb folder I saw that mochiweb is being
downloaded and compiled automatically so I thought the plugin is taking care
of everything for me.

Can you explain more about the process that you're following to get the
> error you report? The plugin activation process itself shouldn't cause
> applications to be started - I'm assuming you're seeing this error when
> booting rabbit after installing the plugins?


Yes, I'm getting the error when running rabbit after compiling, linking and
activating the plugins.

I've created the umbrella project
compiled the rabbitmq-mochiweb, erlang-rfc4627 and rabbitmq-jsonrpc plugins
linked the three plugins to the rabbitmq-server/plugins directory
run the scripts/rabbitmq-activate-plugins script
rabbitmq-server/make run

Ben


On Mon, Oct 19, 2009 at 2:03 AM, Ben Browitt <ben.browitt at gmail.com> wrote:
>
>> Hi,
>>
>> I'm trying to use the rabbitmq-mochiweb plugin as explained in
>> http://www.rabbitmq.com/plugin-development.html#getting-started
>> I have several issues with it.
>>
>> rabbitmq_mochiweb.app is missing rabbit_mochiweb_registry in the list of
>> modules
>>
>> When activating the rabbitmq-mochiweb plugin, mochiweb is not included in
>> the erlang path.
>> I needed to add the mochiweb folder to the rabbitmq-server/plugins
>> directory in addition to rabbitmq-mochiweb.
>> Isn't the plugin suppose to take care of that?
>>
>> When trying to activate the rabbitmq-jsonrpc I'm getting:
>> {"Kernel pid
>> terminated",application_controller,"{application_start_failure,rabbit_jsonrpc,{bad_return,{{rabbit_jsonrpc,start,[normal,[]]},{'EXIT',{noproc,{gen_server,call,[rabbit_mochiweb_registry,{add,#Fun<rabbit_mochiweb.0.118905840>,#Fun<rabbit_jsonrpc.0.21203153>}]}}}}}}"}
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,rabbit_jsonrpc,{bad_return,{{rabbit_jsonrpc,start,[normal,[]]},{'EXIT',{noproc,{gen_server,call,[rabbit_mochiweb_registry,{
>> make: *** [run] Error 1
>>
>> The README of the rabbitmq-mochiweb is outdated.
>>
>> Thanks
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091019/76019c85/attachment.htm 

From pauljones23 at gmail.com  Mon Oct 19 09:24:44 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 19 Oct 2009 09:24:44 +0100
Subject: [rabbitmq-discuss] mochiweb plugin
In-Reply-To: <b0200d7f0910190108w31cd1990r17ba0ef9c48aac83@mail.gmail.com>
References: <b0200d7f0910181803t1685b6b1od61c6b47f85b2365@mail.gmail.com>
	<29598b610910190052g684a78eci6534570ee84c864c@mail.gmail.com>
	<b0200d7f0910190108w31cd1990r17ba0ef9c48aac83@mail.gmail.com>
Message-ID: <29598b610910190124y73228b9fo298b1dff25d54b92@mail.gmail.com>

Ben,

On Mon, Oct 19, 2009 at 9:08 AM, Ben Browitt <ben.browitt at gmail.com> wrote:

> If mochiweb.ez should be installed in the plugin directory it will help if
> you can document it or even better create two plugins, rabbitmq-mochiweb for
> the wrapper and mochiweb for mochiweb itself.
> When I run make in the rabbitmq-mochiweb folder I saw that mochiweb is
> being downloaded and compiled automatically so I thought the plugin is
> taking care of everything for me.
>

I'm getting the documentation updated to make this clearer. We wanted to
avoid actually including mochiweb into the plugin, as bundling external
dependencies could quickly lead to naming clashes if taken up as a standard
pattern.


>
> Can you explain more about the process that you're following to get the
>> error you report? The plugin activation process itself shouldn't cause
>> applications to be started - I'm assuming you're seeing this error when
>> booting rabbit after installing the plugins?
>
>
> Yes, I'm getting the error when running rabbit after compiling, linking and
> activating the plugins.
>
> I've created the umbrella project
> compiled the rabbitmq-mochiweb, erlang-rfc4627 and rabbitmq-jsonrpc plugins
> linked the three plugins to the rabbitmq-server/plugins directory
> run the scripts/rabbitmq-activate-plugins script
> rabbitmq-server/make run
>
>
I've followed this exact set of steps, and the server is starting cleanly
for me. My plugin directory symlinks look like:
erlang-rfc4627 -> ../../erlang-rfc4627/
mochiweb -> ../../rabbitmq-mochiweb/deps/mochiweb
rabbitmq-jsonrpc -> ../../rabbitmq-jsonrpc
rabbitmq-mochiweb -> ../../rabbitmq-mochiweb

As an aside, if you're wanting the functionality previously provided by
rabbitmq-http2, then you'll also want to link in the
rabbitmq-jsonrpc-channel plugin - this plugin provides the actual support
for making JSON-RPC calls against the rabbit channel objects.

Paul.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091019/db81fbbc/attachment.htm 

From ben.browitt at gmail.com  Mon Oct 19 09:32:47 2009
From: ben.browitt at gmail.com (Ben Browitt)
Date: Mon, 19 Oct 2009 10:32:47 +0200
Subject: [rabbitmq-discuss] mochiweb plugin
In-Reply-To: <29598b610910190124y73228b9fo298b1dff25d54b92@mail.gmail.com>
References: <b0200d7f0910181803t1685b6b1od61c6b47f85b2365@mail.gmail.com>
	<29598b610910190052g684a78eci6534570ee84c864c@mail.gmail.com>
	<b0200d7f0910190108w31cd1990r17ba0ef9c48aac83@mail.gmail.com>
	<29598b610910190124y73228b9fo298b1dff25d54b92@mail.gmail.com>
Message-ID: <b0200d7f0910190132o3c9bb8a0v17f2838cf79217f0@mail.gmail.com>

On Mon, Oct 19, 2009 at 10:24 AM, Paul Jones <pauljones23 at gmail.com> wrote:

> Ben,
>
> On Mon, Oct 19, 2009 at 9:08 AM, Ben Browitt <ben.browitt at gmail.com>wrote:
>
>> If mochiweb.ez should be installed in the plugin directory it will help if
>> you can document it or even better create two plugins, rabbitmq-mochiweb for
>> the wrapper and mochiweb for mochiweb itself.
>> When I run make in the rabbitmq-mochiweb folder I saw that mochiweb is
>> being downloaded and compiled automatically so I thought the plugin is
>> taking care of everything for me.
>>
>
> I'm getting the documentation updated to make this clearer. We wanted to
> avoid actually including mochiweb into the plugin, as bundling external
> dependencies could quickly lead to naming clashes if taken up as a standard
> pattern.
>
>
>>
>> Can you explain more about the process that you're following to get the
>>> error you report? The plugin activation process itself shouldn't cause
>>> applications to be started - I'm assuming you're seeing this error when
>>> booting rabbit after installing the plugins?
>>
>>
>> Yes, I'm getting the error when running rabbit after compiling, linking
>> and activating the plugins.
>>
>> I've created the umbrella project
>> compiled the rabbitmq-mochiweb, erlang-rfc4627 and rabbitmq-jsonrpc
>> plugins
>> linked the three plugins to the rabbitmq-server/plugins directory
>> run the scripts/rabbitmq-activate-plugins script
>> rabbitmq-server/make run
>>
>>
> I've followed this exact set of steps, and the server is starting cleanly
> for me. My plugin directory symlinks look like:
> erlang-rfc4627 -> ../../erlang-rfc4627/
> mochiweb -> ../../rabbitmq-mochiweb/deps/mochiweb
> rabbitmq-jsonrpc -> ../../rabbitmq-jsonrpc
> rabbitmq-mochiweb -> ../../rabbitmq-mochiweb
>

I've repeated all the steps and still getting the error.
It happens when jsonrpc tries to use rabbit_mochiweb_registry. Erlang
complains that the proc is not registered.

>
> As an aside, if you're wanting the functionality previously provided by
> rabbitmq-http2, then you'll also want to link in the
> rabbitmq-jsonrpc-channel plugin - this plugin provides the actual support
> for making JSON-RPC calls against the rabbit channel objects.
>

I know. I'm trying to create a plugin that uses the mochiweb plugin but got
errors so I've tried using the jsonrpc
plugin as a reference but got the same errors.

I'll try to remove the umbrella folder and repeat all the steps.

There is also a bug in the rabbit_metronome hello-word example
at http://www.rabbitmq.com/plugin-development.html#getting-started
rabbit_metronome_worker/init calls amqp_connection:start_direct(<<"guest">>,
<<"guest">>)
but there is no amqp_connection:start_direct/2.  I think it should be
amqp_connetion:start_direct() because guest is the default.


>
> Paul.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091019/8daf9a1a/attachment.htm 

From pauljones23 at gmail.com  Mon Oct 19 10:03:23 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 19 Oct 2009 10:03:23 +0100
Subject: [rabbitmq-discuss] mochiweb plugin
In-Reply-To: <b0200d7f0910190132o3c9bb8a0v17f2838cf79217f0@mail.gmail.com>
References: <b0200d7f0910181803t1685b6b1od61c6b47f85b2365@mail.gmail.com>
	<29598b610910190052g684a78eci6534570ee84c864c@mail.gmail.com>
	<b0200d7f0910190108w31cd1990r17ba0ef9c48aac83@mail.gmail.com>
	<29598b610910190124y73228b9fo298b1dff25d54b92@mail.gmail.com>
	<b0200d7f0910190132o3c9bb8a0v17f2838cf79217f0@mail.gmail.com>
Message-ID: <29598b610910190203s1a91cc83j74b42a011fac7e25@mail.gmail.com>

Ben,

On Mon, Oct 19, 2009 at 9:32 AM, Ben Browitt <ben.browitt at gmail.com> wrote:

>
> I've repeated all the steps and still getting the error.
> It happens when jsonrpc tries to use rabbit_mochiweb_registry. Erlang
> complains that the proc is not registered.
>
>>
>> As an aside, if you're wanting the functionality previously provided by
>> rabbitmq-http2, then you'll also want to link in the
>> rabbitmq-jsonrpc-channel plugin - this plugin provides the actual support
>> for making JSON-RPC calls against the rabbit channel objects.
>>
>
> I know. I'm trying to create a plugin that uses the mochiweb plugin but got
> errors so I've tried using the jsonrpc
> plugin as a reference but got the same errors.
>
>
I take it that when you remove the jsonrpc plugin, the broker starts up ok?
If it does, can you bring up the Erlang toolbar (toolbar:start()), open the
application monitor, and let me know what processes are running under the
rabbit_mochiweb application? I'd be interested to know if the registry is
perhaps crashing out.

If you just try to register a static docroot from an Erlang terminal in this
state (Rabbit running, but with no plugins other than
mochiweb/rabbit_mochiweb), does it work?

Another option when developing plugins is to do a "make run" from the plugin
directory. As long as you've declared the dependencies in the Makefile (and
are using our standard include.mk), then you should find that it will
auto-wire the dependencies automatically, and prevent you needing to do
symlinks.

Paul.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091019/e9e59d31/attachment.htm 

From pauljones23 at gmail.com  Mon Oct 19 10:22:05 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 19 Oct 2009 10:22:05 +0100
Subject: [rabbitmq-discuss] mochiweb plugin
In-Reply-To: <b0200d7f0910190211s6e2fa2e9vfcc3885091a7d7bd@mail.gmail.com>
References: <b0200d7f0910181803t1685b6b1od61c6b47f85b2365@mail.gmail.com>
	<29598b610910190052g684a78eci6534570ee84c864c@mail.gmail.com>
	<b0200d7f0910190108w31cd1990r17ba0ef9c48aac83@mail.gmail.com>
	<29598b610910190124y73228b9fo298b1dff25d54b92@mail.gmail.com>
	<b0200d7f0910190132o3c9bb8a0v17f2838cf79217f0@mail.gmail.com>
	<29598b610910190203s1a91cc83j74b42a011fac7e25@mail.gmail.com>
	<b0200d7f0910190211s6e2fa2e9vfcc3885091a7d7bd@mail.gmail.com>
Message-ID: <29598b610910190222h568621ecxdad192d456feec53@mail.gmail.com>

On Mon, Oct 19, 2009 at 10:11 AM, Ben Browitt <ben.browitt at gmail.com> wrote:

>
> I've removed the umbrella folder and repeated all the steps. The jsonrpc
> plugin is running now so I don't know
> what happened before. If it'll crash again I'll use the toolbar and report
> my findings as you explained above.
>
>
I'm glad to hear it went away. As you say though - if it does happen again,
the findings would be very interesting.


>
>> Another option when developing plugins is to do a "make run" from the
>> plugin directory. As long as you've declared the dependencies in the
>> Makefile (and are using our standard include.mk), then you should find
>> that it will auto-wire the dependencies automatically, and prevent you
>> needing to do symlinks.
>>
>
> Very useful, thanks.
>

No worries. I might try to find a way to make this explicit in the
documentation too, since it (hopefully) makes the turnaround time on the
development process shorter.

By the way, if you're able to share, I'd be very interested to hear at some
point what your plugin is going to do.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091019/5aa0cd70/attachment.htm 

From mail at sebastian-latza.de  Mon Oct 19 11:41:06 2009
From: mail at sebastian-latza.de (Sebastian)
Date: Mon, 19 Oct 2009 12:41:06 +0200
Subject: [rabbitmq-discuss] Round-robin queue failover
Message-ID: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>

Hi everybody,

I'm looking into a way how to implement a HA setup for persistent  
queues. Since the rabbitmq cluster doesn't replicate queues across  
multiple nodes my initial idea was to implement this on the client:  
connect publisher and consumers to multiple independent servers,  
create identical exchanges and queues, then send the messages round  
robin to the nodes. While this has the additional benefit of proper  
scalability it requires some effort on the client, I basically have to  
override all methods and encapsulate the "replication" logic there.  
While this isn't a true HA setup (messages in the broken node can't be  
delivered until restart and correct order of messages isn't guaranteed  
anymore) it solves 90% of the problem by providing a way to allow  
continuous message publishing.

Now I have come across this [1] blog-post by Ilya Grigorik which  
says:  "Assign two identically named queues to an exchange and the  
broker will automatically round-robin the messages". So my  
understanding is that I could just create identical queues on every  
node, and the broker will take care of the rest: if one node goes  
down, messages will just be spread over the other queues/nodes.
Is this supported by rabbitmq? I've looked around in the amqp specs  
and documentation, but couldn't find anything related.

Regards
Sebastian

[1] http://www.igvita.com/2009/10/08/advanced-messaging-routing-with-amqp/



From matthias at lshift.net  Mon Oct 19 11:58:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 11:58:19 +0100
Subject: [rabbitmq-discuss] CPU usage with RabbitMQ 1.7
In-Reply-To: <4AD6B58D.2010701@defuze.org>
References: <4AD6B58D.2010701@defuze.org>
Message-ID: <4ADC464B.7040100@lshift.net>

Sylvain,

Sylvain Hellegouarch wrote:
> We've been stress testing our infrastructure recently and we've been 
> surprised to notice that RabbitMQ was really hungry in memory (which is 
> more or less okay if we the OS gets it back eventually) but also in CPU.
> 
> Our messages are about 100 bytes each and our consumer isn't as fast as 
> our producer (though it is very capable in our book) but we have 
> difficulties understanding why Rabbit is so CPU bound.
> 
> We were also feeling that the queue isn't filled as fast as the exchange 
> (topic) and Rabbit seems to feed the queues on demand based on the 
> consumer speed. Is it a valid description of what happens or is it a 
> false observation on our part?

Could you describe your test set up in more detail?

- What clients are you using?
- What is the routing topology, i.e. the numbers of producers,
consumers, exchanges, queues and bindings and how they are "wired up"?
- Are the messages marked as persistent?
- Do producers or consumers use transactions?
- Do consumers consume message with basic.consume or basic.get?
- Do consumers operate in auto-ack or normal, ack'ing mode?
- What do the producers do? Send messages in tight loop?
- How are you measuring speed?
- What hardware, O/S and version of Erlang are you running?

If you could post the test code that would be ideal. Assuming it's
self-contained and well-factored ;)

It may also be worthwhile to compare your results with what you get from
the MulticastMain example program in the Java client.


Matthias.



From matthias at lshift.net  Mon Oct 19 12:08:05 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 12:08:05 +0100
Subject: [rabbitmq-discuss] unknown revision rabbitmq_v1_7_0
In-Reply-To: <25904861.post@talk.nabble.com>
References: <25904861.post@talk.nabble.com>
Message-ID: <4ADC4895.3010402@lshift.net>

DOBRO wrote:
> Tried to compile stomp adapter for RabbitMQ 1.7.0.
> Running hg -R rabbitmq-stomp up rabbitmq_v1_7_0
> gives:
> abort: unknown revision 'rabbitmq_v1_7_0'!
> [...]
> Which proper revision should I use to compile stomp adapter for RabbitMQ
> 1.7.0?
> Is it ready?

The packages listed under 'Experimental Downloads' at
<http://www.rabbitmq.com/download.html#experimental> don't get tagged
during our formal release process, because we'd generally like people to
use the latest versions (i.e. the latest revision in the 'default'
branch in the hg repository).  These packages should work, and we hope
they are useful to people, but we provide them on an 'as is' basis -
they don't get tested prior to release in the same way that our released
packages do. We expect that in time some of those experimental packages
will graduate to join our released packages.

With all that said, sometimes we do go ahead and tag those other
packages, as you can see, in particular when the latest revisions on
'default' do not work with the most recent official server release.


Regards,

Matthias.



From matthias at lshift.net  Mon Oct 19 12:24:24 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 12:24:24 +0100
Subject: [rabbitmq-discuss] Streaming stock prices to long-polling
	clients
In-Reply-To: <b0200d7f0910150251o2f618c38x3daf09f49eeed171@mail.gmail.com>
References: <b0200d7f0910150251o2f618c38x3daf09f49eeed171@mail.gmail.com>
Message-ID: <4ADC4C68.90108@lshift.net>

Ben,

Ben Browitt wrote:
> In my application I need to stream stock prices to users.
> The 'last price' will be retrieved from a separate service when a
> consumer connects which simplifies things.
> Each user will subscribe to several stocks.
> Users are web browsers connecting using long-polling.
> 
> Do I create one queue per consumer with several bindings, one for each
> stock?
> Prices in this case will be sent with a topic routing key.
> Another option is to create one queue per stock. each consumer will be
> subscribed to several queues.
> Messages will be sent with a direct routing key.

In the latter case, each quote would only go to one consumer, which is
probably not what you want. In an AMQP system, to get the same message
delivered to N consumers you need (at least) N queues. Exchanges *copy*
messages to queues, whereas queues *round-robin* message delivery to
consumers.

Your first setup should work fine, except there is no need to use a
topic exchange. Just use a direct exchange, one queue per user and for
each of the stock symbols a user is interested in create a binding
between the user's queue and the direct exchange.

> Users will connect using a browser with long-polling to the mochiweb plugin.
> Each user will be presented at the server side as an erlang AMQP client.

Have you considered using the rabbitmq-jsonrpc-channel plugin? Even if
you don't want to use it, it's worth taking a look at how it's
implemented since that may well answer some of your questions regarding
long-polling.


Regards,

Matthias.



From matthias at lshift.net  Mon Oct 19 13:10:54 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 13:10:54 +0100
Subject: [rabbitmq-discuss] rabbitmq clustering
In-Reply-To: <376f3e6f0910011349w2947bd8bp262642c6d7e34c22@mail.gmail.com>
References: <376f3e6f0910011349w2947bd8bp262642c6d7e34c22@mail.gmail.com>
Message-ID: <4ADC574E.5070109@lshift.net>

Suhail,

Suhail Doshi wrote:
> One that was unclear to me in the clustering documentation is how you
> setup consumers to work with clusters or if there even is any setup?
> 
> Does the consumer need to be aware of all the nodes in a cluster?

Logically/functionally, clients just need to be aware of *one* cluster
node. But if you want to balance load then you either need to stick a
load balancer in front of rabbitmq or make the clients aware of all nodes.

> If not does the consumer just need to be hooked up to the node that
> the other nodes are clustered around and things are automatically
> load balanced?

As noted above, there is no automatic load balancing.

Well, actually there is some very crude load balancing going on atm,
with the server redirecting clients to the least loaded node, but a) I
don't whether the AMQP python lib supports that, and b) that
functionality will disappear when we move to AMQP 0-9-1.


Regards,

Matthias.



From matthias at lshift.net  Mon Oct 19 13:31:43 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 13:31:43 +0100
Subject: [rabbitmq-discuss] When is persister.log.previous made?
In-Reply-To: <84fb38e30910151223x27e19ba1mee1a24f06a7c06b4@mail.gmail.com>
References: <84fb38e30910151223x27e19ba1mee1a24f06a7c06b4@mail.gmail.com>
Message-ID: <4ADC5C2F.5010701@lshift.net>

Tsuraan,

tsuraan wrote:
> One of our systems overfed the rabbit, and it's now a bit angry.  The
> strange problem that we're having, though, is that it seems that the
> commit after the thousandth ack'd message is triggering the persister
> log rollover, which is then causing beam to run out of memory.  The
> only thing we're doing is basic_get'ing messages, acking them, and
> then committing (the channel is transactional).  We've also tried
> committing every thousand messages; either way, the first commit after
> the thousandth ack'd message is causing the persister log rollover,
> followed immediately by beam crashing due to being out of RAM.

The logic for when the persister log is rolled over is quite complex,
involving both time-based and message-count based heuristics.

As an aside, why are you using transactions on the consuming side? I
have yet to come across a use case where that is genuinely required.

> Does anybody know why rolling the persister log would cause the system
> to run out of memory?  It seems like a strange place to need to
> allocate a lot of RAM

When rolling the persister log, rabbit writes a snapshot of all
currently persisted messages, and it needs to allocate memory for that
entire snapshot.

> Also, will the future (1.8?) persister still do the process described
> in https://dev.rabbitmq.com/wiki/RabbitPersisterDesign ?

No.

> Writing the entire rabbit state to disk every so-often doesn't seem 
> like it would work terribly well when storing huge amounts of data

Indeed.


Regards,

Matthias.



From matthias at lshift.net  Mon Oct 19 13:53:37 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 13:53:37 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp connection stats?
In-Reply-To: <269388e30910151522s53af846eh8c845567773d77f7@mail.gmail.com>
References: <25914888.post@talk.nabble.com>
	<269388e30910151522s53af846eh8c845567773d77f7@mail.gmail.com>
Message-ID: <4ADC6151.6070905@lshift.net>

Ben Hood wrote:
> rabbitmqctl addresses the core Rabbit API, of which the AMQP TCP
> listeners are a part. The STOMP adapter OTOH sets up its own TCP
> listener hierarchy on the STOMP port and delegates decoded STOMP
> commands to the corresponding AMQP *channels* within the same VM as
> the AMQP broker. The core Rabbit broker has no awareness of any
> applications running in the same process space as itself and hence
> cannot report on these processes (without any notion of a listener
> plugin mechanism).

It shouldn't be too hard to make stomp connections, and connections
created by other plugins, show up in rabbitmqctl, so I have created a
bug to look into that.

Matthias.



From matthias at lshift.net  Mon Oct 19 15:01:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 15:01:16 +0100
Subject: [rabbitmq-discuss] presence notifications
In-Reply-To: <c1d41d540910151324w274de0d9n37f9098032ab7685@mail.gmail.com>
References: <c1d41d540910151324w274de0d9n37f9098032ab7685@mail.gmail.com>
Message-ID: <4ADC712C.3000903@lshift.net>

Jon,

Jon Bardin wrote:
> Is it possible to broadcast a message to a particular queue/topic when a
> client connects/disconnects?

We did some exploratory work on a resource (i.e. exchange & queue)
lifecycle notification extension a while ago. See the 'bug19230' branch
in hg. Currently that work is on hold due to other, more important,
items taking precedence.

Could you explain your use case in a bit more detail?


Regards,

Matthias.



From matthias at lshift.net  Mon Oct 19 16:06:34 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 16:06:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ randomly dying under Ubuntu 9.04
In-Reply-To: <381842ac0910160811v304e6fddqdd7ff69c4a3b43c8@mail.gmail.com>
References: <381842ac0910160811v304e6fddqdd7ff69c4a3b43c8@mail.gmail.com>
Message-ID: <4ADC807A.7090108@lshift.net>

Tim,

Tim Rosenblatt wrote:
> How can i debug a rabbitmq server that randomly dies/stops accepting
> connections? I'm running off ubuntu and installed via apt-get. Usually
> when restarting, it's the persister that won't restart. The current
> solution is to delete the contents of /var/lib/rabbmq, but that feels
> like a hack and not a solution.

I recommend running 'rabbitmqctl list_queues' to get an idea of how many
messages are in the queues. You are probably feeding rabbit with more
messages than it can stomach.


Regards,

Matthias.



From tsuraan at gmail.com  Mon Oct 19 17:10:36 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 19 Oct 2009 11:10:36 -0500
Subject: [rabbitmq-discuss] When is persister.log.previous made?
In-Reply-To: <4ADC5C2F.5010701@lshift.net>
References: <84fb38e30910151223x27e19ba1mee1a24f06a7c06b4@mail.gmail.com>
	<4ADC5C2F.5010701@lshift.net>
Message-ID: <84fb38e30910190910k2387d28du1cf3ebe55dae909b@mail.gmail.com>

> As an aside, why are you using transactions on the consuming side? I
> have yet to come across a use case where that is genuinely required.

Our consumers are almost always also producers, so we do the message
ack and the creation of new messages in a transaction.  I'm not sure
that it's necessary; I'm used to databases, where I tend to do
everything in a transaction to ensure that everything is consistent
when I'm done, but our messaging stuff is designed to handle multiple
copies of the same message, so it's probably a bit overkill to also
use transactions.

I seem to remember that I had some problem when I was first looking at
rabbit that I could publish a stream of messages in non-transactional
mode, and not all the messages would be delivered (or enqueued).  I
think I may have been doing something stupid like exiting my program
without closing my channel, but moving to transactional mode fixed the
problem, and I think I've been a bit religious about transactions
since then.

> When rolling the persister log, rabbit writes a snapshot of all
> currently persisted messages, and it needs to allocate memory for that
> entire snapshot.

Ok, that explains it.

>> Also, will the future (1.8?) persister still do the process described
>> in https://dev.rabbitmq.com/wiki/RabbitPersisterDesign ?
>
> No.

Glad to hear it :)

Thanks!



From matthias at lshift.net  Mon Oct 19 17:54:57 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 19 Oct 2009 17:54:57 +0100
Subject: [rabbitmq-discuss] When is persister.log.previous made?
In-Reply-To: <84fb38e30910190910k2387d28du1cf3ebe55dae909b@mail.gmail.com>
References: <84fb38e30910151223x27e19ba1mee1a24f06a7c06b4@mail.gmail.com>	<4ADC5C2F.5010701@lshift.net>
	<84fb38e30910190910k2387d28du1cf3ebe55dae909b@mail.gmail.com>
Message-ID: <4ADC99E1.8040508@lshift.net>

Tsuraan,

tsuraan wrote:
>> As an aside, why are you using transactions on the consuming side? I
>> have yet to come across a use case where that is genuinely required.
> 
> Our consumers are almost always also producers, so we do the message
> ack and the creation of new messages in a transaction.  I'm not sure
> that it's necessary; I'm used to databases, where I tend to do
> everything in a transaction to ensure that everything is consistent
> when I'm done, but our messaging stuff is designed to handle multiple
> copies of the same message, so it's probably a bit overkill to also
> use transactions.
> 
> I seem to remember that I had some problem when I was first looking at
> rabbit that I could publish a stream of messages in non-transactional
> mode, and not all the messages would be delivered (or enqueued).  I
> think I may have been doing something stupid like exiting my program
> without closing my channel, but moving to transactional mode fixed the
> problem, and I think I've been a bit religious about transactions
> since then.

Transactions are currently the only way for a client to get an
acknowledgment from the broker that sent messages have not only made it
to the broker (a normal connection/channel.close, or indeed any other
synchronous AMQP operation, is sufficient for that) but also will
survive a broker restart (if they were marked as persistent).

So use of tx mode on the sending side is quite common.

Use of tx mode on the receiving side, for acks, is much less common,
since the worst thing that can happen if an ack gets lost is that the
message will get delivered again. That can happen in other situations
anyway, e.g. client or connection failure, so apps need to be able to
cope with it already.

If your producers are also senders, and you want the aforementioned
guarantees on sending, I would recommend using two channels - one in tx
mode for sending and one on non-tx mode for receiving/ack'ing.


Regard,

Matthias.



From alex at beautifulpixel.com  Tue Oct 20 02:24:16 2009
From: alex at beautifulpixel.com (Squeegy)
Date: Mon, 19 Oct 2009 18:24:16 -0700 (PDT)
Subject: [rabbitmq-discuss]  Can't run rabbitmq-server... Install issue?
Message-ID: <25967988.post@talk.nabble.com>


I seem to have quite an adventure getting rabbitmq-server running on my snow
leopard machine.

Macports failed to install erlang, due to some bizarre compilation errors,
so I installed it from source.  It also failed to install rabbitmq-server,
so I tried to install it manually.  I it appears to have install erlangs
libs to /usr/local/lib/erlang/lib/, so that it where I put the
rabbitmq-server-1.7.0 directory.  But when I run the server, it's not happy:

---
$ /usr/local/lib/erlang/lib/rabbitmq-server-1.7.0/scripts/rabbitmq-server
{"init terminating in
do_boot",{undef,[{rabbit,start,[]},{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
---

The crash log is no less than 12,000 lines and I have no idea what to make
of it.  I can run "erl" just fine, and I get the erlang prompt (I think):

---
$ erl
Erlang R13B02 (erts-5.7.3) [source] [smp:2:2] [rq:2] [async-threads:0]
[kernel-poll:false]

Eshell V5.7.3  (abort with ^G)
1>
---

So I have no idea what is going on here.  I have put the crashdump up here:
http://gist.github.com/213893

In case someone  smarter than I can make heads or tails of it.  I would
really appreciate any tips here and what noobie mistake I made here.

Thank you to anyone who can help me out.
-- 
View this message in context: http://www.nabble.com/Can%27t-run-rabbitmq-server...-Install-issue--tp25967988p25967988.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From arilerner at mac.com  Tue Oct 20 02:31:16 2009
From: arilerner at mac.com (Ari Lerner)
Date: Mon, 19 Oct 2009 18:31:16 -0700
Subject: [rabbitmq-discuss] Can't run rabbitmq-server... Install issue?
In-Reply-To: <25967988.post@talk.nabble.com>
References: <25967988.post@talk.nabble.com>
Message-ID: <8DD1D4A6-6953-4EF3-BF6D-6ADBBECA4DD4@mac.com>

Did you make rabbit?

cd rabbitmq-server && make ?

Ari

On Oct 19, 2009, at 6:24 PM, Squeegy wrote:

>
> I seem to have quite an adventure getting rabbitmq-server running on  
> my snow
> leopard machine.
>
> Macports failed to install erlang, due to some bizarre compilation  
> errors,
> so I installed it from source.  It also failed to install rabbitmq- 
> server,
> so I tried to install it manually.  I it appears to have install  
> erlangs
> libs to /usr/local/lib/erlang/lib/, so that it where I put the
> rabbitmq-server-1.7.0 directory.  But when I run the server, it's  
> not happy:
>
> ---
> $ /usr/local/lib/erlang/lib/rabbitmq-server-1.7.0/scripts/rabbitmq- 
> server
> {"init terminating in
> do_boot",{undef,[{rabbit,start,[]},{init,start_it,1},{init,start_em, 
> 1}]}}
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> ---
>
> The crash log is no less than 12,000 lines and I have no idea what  
> to make
> of it.  I can run "erl" just fine, and I get the erlang prompt (I  
> think):
>
> ---
> $ erl
> Erlang R13B02 (erts-5.7.3) [source] [smp:2:2] [rq:2] [async-threads:0]
> [kernel-poll:false]
>
> Eshell V5.7.3  (abort with ^G)
> 1>
> ---
>
> So I have no idea what is going on here.  I have put the crashdump  
> up here:
> http://gist.github.com/213893
>
> In case someone  smarter than I can make heads or tails of it.  I  
> would
> really appreciate any tips here and what noobie mistake I made here.
>
> Thank you to anyone who can help me out.
> -- 
> View this message in context: http://www.nabble.com/Can%27t-run-rabbitmq-server...-Install-issue--tp25967988p25967988.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From alex at beautifulpixel.com  Tue Oct 20 02:39:56 2009
From: alex at beautifulpixel.com (Alex Wayne)
Date: Mon, 19 Oct 2009 18:39:56 -0700
Subject: [rabbitmq-discuss] Can't run rabbitmq-server... Install issue?
In-Reply-To: <8DD1D4A6-6953-4EF3-BF6D-6ADBBECA4DD4@mac.com>
References: <25967988.post@talk.nabble.com>
	<8DD1D4A6-6953-4EF3-BF6D-6ADBBECA4DD4@mac.com>
Message-ID: <ae58b0e00910191839rae103b2n747c99ce4f3394cc@mail.gmail.com>

Om my.  Well that is embarrasing...
In my defense the installation instruction don't mention rabbit actually has
to be compiled at all:
http://www.rabbitmq.com/install.html#install-generic-unix
It says:

1. Install erlang
2. unpack rabbitmq tarball and place with other erlang libs
3. Customize script/rabbitmq-server environment variables

Not actually knowing erlang at all I had no idea this was a even a compiled
language at all.  It seems that a step 2.5 "run a make command in the
rabbitmq-server_version directory", would have saved me a headache.

Anyway, thanks very much for the head slapper there.  I probably should have
known.
-Alex


On Mon, Oct 19, 2009 at 6:31 PM, Ari Lerner <arilerner at mac.com> wrote:

> Did you make rabbit?
>
> cd rabbitmq-server && make ?
>
> Ari
>
> On Oct 19, 2009, at 6:24 PM, Squeegy wrote:
>
>
>> I seem to have quite an adventure getting rabbitmq-server running on my
>> snow
>> leopard machine.
>>
>> Macports failed to install erlang, due to some bizarre compilation errors,
>> so I installed it from source.  It also failed to install rabbitmq-server,
>> so I tried to install it manually.  I it appears to have install erlangs
>> libs to /usr/local/lib/erlang/lib/, so that it where I put the
>> rabbitmq-server-1.7.0 directory.  But when I run the server, it's not
>> happy:
>>
>> ---
>> $ /usr/local/lib/erlang/lib/rabbitmq-server-1.7.0/scripts/rabbitmq-server
>> {"init terminating in
>> do_boot",{undef,[{rabbit,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>
>> Crash dump was written to: erl_crash.dump
>> init terminating in do_boot ()
>> ---
>>
>> The crash log is no less than 12,000 lines and I have no idea what to make
>> of it.  I can run "erl" just fine, and I get the erlang prompt (I think):
>>
>> ---
>> $ erl
>> Erlang R13B02 (erts-5.7.3) [source] [smp:2:2] [rq:2] [async-threads:0]
>> [kernel-poll:false]
>>
>> Eshell V5.7.3  (abort with ^G)
>> 1>
>> ---
>>
>> So I have no idea what is going on here.  I have put the crashdump up
>> here:
>> http://gist.github.com/213893
>>
>> In case someone  smarter than I can make heads or tails of it.  I would
>> really appreciate any tips here and what noobie mistake I made here.
>>
>> Thank you to anyone who can help me out.
>> --
>> View this message in context:
>> http://www.nabble.com/Can%27t-run-rabbitmq-server...-Install-issue--tp25967988p25967988.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091019/2b63d060/attachment.htm 

From dglaubman at acm.org  Tue Oct 20 03:46:45 2009
From: dglaubman at acm.org (David Glaubman)
Date: Mon, 19 Oct 2009 19:46:45 -0700 (PDT)
Subject: [rabbitmq-discuss]  Simple benchmark and results
Message-ID: <25968960.post@talk.nabble.com>


Hi, I am experimenting with RabbitMQ (v1.7.0) on Windows using the .Net
client.

First, my initial reaction to AMQP/RabbitMQ is very positive -- I've
received good support in getting started, the protocol and client API are
clear and seem straightforward, and (so far) everything works.

Second, I?d like to offer some performance numbers for a very simple
benchmark I am using.
Your mileage will most assuredly vary.

And third, I am looking for some insight as to suitability/tunability of
RabbitMQ for a particular use case. (but I'll leave that to my next message)

Thanks,
David

The setup
---------
In local setup, I have one rabbitmq server and one single-threaded client
which runs the benchmark.
In distributed setup, client runs as in local setup, but rabbitmq server
runs on another machine.

Client machine: Quad CPU @ 2.4Ghz, 4Gb memory, running 32-bit Windows XP SP2
Server machine: Quad CPU @ 2.2GHz, 4Gb memory, running 64-bit Windows Server
2008 Standard
Network: 1Gbps Ethernet, tracert shows 2 hops between machines

The benchmark
-------------
Benchmark consists of 
	1. BasicPublish of 1000 24-byte messages to a Fanout exchange
(non-persistent)
	2. Dequeuing these 1000 messages using a QueueingBasicConsumer
      3. Sending 1000 24-byte messages using MSMQ
      4. Receiving 1000 24-byte messages using MSMQ
(All benchmarks were run using MeasureIt, a free microbenchmarking tool for
.Net code.)

Results
-------
RabbitMQ:
In the local case, published about 4K messages per second, consumed about
10K messages per second.
In the remote case, median times were the same as for local, but big
outliers occurred on some runs.
(Using BasicGet instead of QueueingBasicConsumer, I got around 1500 messages
per sec remote, 3K local)

MSMQ:
In the local case, MSMQ sent about 40K messages per second, received about
40K messages per second.
In the remote case, MSMQ sent about 33K messages per second, received about
1.2K per second.

I've run the benchmark about 50 times so far, and median times are pretty
stable, tho max time for a single Consumed message can run up to 5ms.

So, one question I have is: Is there a way to achieve MSMQ-like Send
performance using rabbitmq?

The code
--------

(This is called by the harness with hostname of the local or remote machine,
port = 5672 and a 24-byte binary message payload).

    private static void AmqpWorker(string serverAddress, int basePort,
LossBullet message)
    {
        var exchange = "fanout";
        var routingKey= "key";
        var endpoint = new AmqpTcpEndpoint(serverAddress, basePort++);
        var connection = new ConnectionFactory().CreateConnection(endpoint);
        var channel = connection.CreateModel();
        string queue = null;
        channel.ExchangeDeclare(exchange, ExchangeType.Fanout);
        queue = channel.QueueDeclare("q1");
        channel.QueueBind(queue, exchange, routingKey, false, null);
        var consumer = new QueueingBasicConsumer(channel);

        LossBullet bullet = message;

        timer1000.Measure("Publish fanout", 1, delegate
       {
           channel.BasicPublish(exchange, routingKey, null,
bullet.ToBytes());
       });

        BasicDeliverEventArgs eventArgs = null;
        consumer.Model.BasicConsume(queue, null, consumer);

        timer1000.Measure("Consume fanout", 1, delegate
       {
           eventArgs = consumer.Queue.Dequeue() as BasicDeliverEventArgs;
           message = new LossBullet( eventArgs.Body);
           consumer.Model.BasicAck( eventArgs.DeliveryTag, false);
       });
    }



-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p25968960.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Tue Oct 20 06:08:54 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 20 Oct 2009 06:08:54 +0100
Subject: [rabbitmq-discuss] Can't run rabbitmq-server... Install issue?
In-Reply-To: <ae58b0e00910191839rae103b2n747c99ce4f3394cc@mail.gmail.com>
References: <25967988.post@talk.nabble.com>	<8DD1D4A6-6953-4EF3-BF6D-6ADBBECA4DD4@mac.com>
	<ae58b0e00910191839rae103b2n747c99ce4f3394cc@mail.gmail.com>
Message-ID: <4ADD45E6.2060900@lshift.net>

Alex,

Alex Wayne wrote:
> In my defense the installation instruction don't mention rabbit actually 
> has to be compiled at 
> all: http://www.rabbitmq.com/install.html#install-generic-unix
> It says:
> 
> 1. Install erlang
> 2. unpack rabbitmq tarball and place with other erlang libs
> 3. Customize script/rabbitmq-server environment variables

Actually, the instructions (at the above URL and in the INSTALL file 
inside the tarball) say

# Install a recent version of Erlang.
# Download rabbitmq-server-generic-unix-version.tar.gz, where version is 
the version of RabbitMQ Server you want to install.
# Contained in the tarball is a directory named rabbitmq_server-version. 
You should extract this into somewhere appropriate for application 
binaries on your system.
# Within the sbin directory is a shell script rabbitmq-server which may 
need customisation for your installation. [...]

> Not actually knowing erlang at all I had no idea this was a even a 
> compiled language at all.  It seems that a step 2.5 "run a make command 
> in the rabbitmq-server_version directory", would have saved me a headache.

The rabbitmq-server-generic-unix-version.tar.gz mentioned above, 
available from http://www.rabbitmq.com/server.html, is pre-compiled. So 
no compile steps are necessary. And there is no Makefile in that tar. 
Did you perhaps download the *source* tarball? In that case the clue is 
in the name ;) and the build instructions at 
http://www.rabbitmq.com/build-server.html tell you what to do.

As an aside, there is no need for rabbit to be put in a "place with 
other erlang libs" - that used to be the case prior to 1.7.0 but is no 
longer true (and the docs reflect that).


Regards,

Matthias.



From matthias at lshift.net  Tue Oct 20 06:44:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 20 Oct 2009 06:44:35 +0100
Subject: [rabbitmq-discuss] Errors Running on Win 2008 as a service
In-Reply-To: <001201ca4f2c$1c078290$541687b0$@com>
References: <001201ca4f2c$1c078290$541687b0$@com>
Message-ID: <4ADD4E43.2060205@lshift.net>

Allen,

Allen Jones wrote:
> I am running RMQ 1.6 as a Windows Service on Windows Server 2008 sp1. 
> Generally things are fine, but there have been a few instances where the 
> service just stops/crashes. The debug info for one recent crash is 
> pasted below. Looks like some kind of memory allocation problem, but it 
> doesn't seem to be happening necessarily when the exchange is under the 
> highest usage/demand, or when the queues are at the largest. 
> [...]
> binary_alloc: Cannot allocate 319762309 bytes of memory (of type "binary"). 
> [...]
> Having a look around, I noticed that the rabbit_persister.log file was 
> about this size, so I am assuming the two are related. 

It looks like the amount of message data you are asking RabbitMQ to hold 
on to exceeds the available memory.

I recommend running 'rabbitmqctl list_queues' to check on how many 
messages you have in the queues.


Regards,

Matthias.



From matthias at lshift.net  Tue Oct 20 06:53:17 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 20 Oct 2009 06:53:17 +0100
Subject: [rabbitmq-discuss] Round-robin queue failover
In-Reply-To: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>
References: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>
Message-ID: <4ADD504D.1080305@lshift.net>

Sebastian,

Sebastian wrote:
> Now I have come across this [1] blog-post by Ilya Grigorik which  
> says:  "Assign two identically named queues to an exchange and the  
> broker will automatically round-robin the messages". So my  
> understanding is that I could just create identical queues on every  
> node, and the broker will take care of the rest: if one node goes  
> down, messages will just be spread over the other queues/nodes.
> Is this supported by rabbitmq? I've looked around in the amqp specs  
> and documentation, but couldn't find anything related.
> 
> [1] http://www.igvita.com/2009/10/08/advanced-messaging-routing-with-amqp/

That part of the article is wrong. Exchanges route messages to all the 
queues bound with a binding that matches the message. There is no 
round-robining going on; that only happens for delivering messages to 
multiple consumers of the same queue.

Regards,

Matthias.



From matthias at lshift.net  Tue Oct 20 07:10:11 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 20 Oct 2009 07:10:11 +0100
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <25968960.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com>
Message-ID: <4ADD5443.6080701@lshift.net>

David,

David Glaubman wrote:
> Hi, I am experimenting with RabbitMQ (v1.7.0) on Windows using the .Net
> client.
> [...]
> Client machine: Quad CPU @ 2.4Ghz, 4Gb memory, running 32-bit Windows XP SP2
> Server machine: Quad CPU @ 2.2GHz, 4Gb memory, running 64-bit Windows Server
> 2008 Standard
> Network: 1Gbps Ethernet, tracert shows 2 hops between machines
> [...]
> Benchmark consists of 
> 	1. BasicPublish of 1000 24-byte messages to a Fanout exchange
> (non-persistent)
> 	2. Dequeuing these 1000 messages using a QueueingBasicConsumer
>       3. Sending 1000 24-byte messages using MSMQ
>       4. Receiving 1000 24-byte messages using MSMQ
> (All benchmarks were run using MeasureIt, a free microbenchmarking tool for
> .Net code.)
> 
> Results
> -------
> RabbitMQ:
> In the local case, published about 4K messages per second, consumed about
> 10K messages per second.
> In the remote case, median times were the same as for local, but big
> outliers occurred on some runs.
> (Using BasicGet instead of QueueingBasicConsumer, I got around 1500 messages
> per sec remote, 3K local)
> 
> MSMQ:
> In the local case, MSMQ sent about 40K messages per second, received about
> 40K messages per second.
> In the remote case, MSMQ sent about 33K messages per second, received about
> 1.2K per second.

It looks like MSMQ may have some optimisation for the local case - 
perhaps it bypasses the TCP/IP stack?

As for rabbit, I suspect the main bottleneck is actually the .net 
client. What's the CPU load like for the client? It may well be maxing 
out one core.

We and other users have seen much higher message rates from RabbitMQ on 
similar hardware than what you are reporting - not quite matching MSQM 
perhaps, but close.

If you can, try running some tests with the MulticastMain example that 
ships with the Java client, for comparison.

Also, note that in your particular test setup the RabbitMQ server will 
not be able to take full advantage of the multiple cores since there is 
too little inherent parallelism. Presumably your intended use case does 
have more than a single message stream, going from one producer to one 
consumer; such a configuration will produce higher message rates overall.


Regards,

Matthias.



From matthias at lshift.net  Tue Oct 20 07:32:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 20 Oct 2009 07:32:35 +0100
Subject: [rabbitmq-discuss] Errors Running on Win 2008 as a service
In-Reply-To: <000901ca514d$76fd64d0$64f82e70$@com>
References: <001201ca4f2c$1c078290$541687b0$@com> <4ADD4E43.2060205@lshift.net>
	<000901ca514d$76fd64d0$64f82e70$@com>
Message-ID: <4ADD5983.50907@lshift.net>

Allen,

Allen Jones wrote:
> That was my assumption. I have changed my approach to messaging and have
> dramatically reduced the amount of data I am pushing through RMQ. So I seem
> to have solved the problem.

Pushing lots of data through rabbit shouldn't be a problem; it's when 
rabbit has to *buffer/store* lots of data - because either there are no 
consumers or they are too slow - that memory consumption becomes an issue.

> I was finding it near impossible to find any info on the mnesia database
> that RMQ uses. Do you know of anything useful.

Try http://www.erlang.org/doc/apps/mnesia/part_frame.html

Note that RabbitMQ only stores routing and configuration information in 
mnesia. Messages are stored separately, using custom code.


Regards,

Matthias.



From uwe at datek.no  Tue Oct 20 08:16:23 2009
From: uwe at datek.no (Uwe Kubosch)
Date: Tue, 20 Oct 2009 09:16:23 +0200
Subject: [rabbitmq-discuss] What does "beta" mean for RabbitMQ?
In-Reply-To: <167204d20910181416y489f05caqe5bfe4fe852df2d8@mail.gmail.com>
References: <3A0E721E-A1B2-478F-89B2-1521B029DFE3@datek.no>
	<167204d20910181416y489f05caqe5bfe4fe852df2d8@mail.gmail.com>
Message-ID: <10199A34-51BF-4B2F-AB36-41A4A1B7A128@datek.no>

Hi Alexis!

Thank you for the quick reply.

My initial thoughts:

'beta' implies 'unfinished' and 'unstable'

'release candidate' better reflects your description of the status of  
the release.

Make an event of declaring a release "final", and announce this event  
in the initial release announcement.  Something like:

"This release has 'release candidate' status pending user feedback and  
will be declared as 'final' in 4 weeks unless major bugs are  
detected.  We recommend that developers, testers and non-critical  
systems using earlier versions of RabbitMQ upgrade to this latest  
release."

Then 4 weeks later:  "RabbitMQ 1.8.0 declared final!  The package has  
been downloaded 4 million times and we have received positive feedback  
from our users.  No major bugs have been reported.  We recommend that  
all users of earlier versions of RabbitMQ upgrade to this latest  
release."

If you detect major bugs, you do not announce the 'final' status.  You  
should announce the bug instead and include when the bug is expected  
to fixed.  Something like "A major bug was reported and will be fixed  
in the 1.9.0 release.

Personally I like patch level releases to quickly fix bugs to make a  
minor release branch stable, but i realize it takes less organization  
and effort to fix the bug in the next minor release.

I also like packaging the release candidate with an 'rc1' in the  
version string like rabbitmq-server-1.8.0rc1, but that requires  
repackaging when the final release is out, so keeping the same package  
but declaring it stable after a while saves the extra packaging.

Really, any solution that keeps me from browsing around looking for  
the 'stable' release is good :)


Uwe



On Oct 18, 2009, at 11:16 PM, Alexis Richardson wrote:

> Uwe
>
> Great questions.  We seek advice on how to make this clearer.  Please
> take a look at this first, and let us know what you think:
>
> http://www.trapexit.org/forum/viewtopic.php?p=49591&sid=20d06e54360b9122cd625eb6e459cfeb
>
> alexis
>
>
> On Sun, Oct 18, 2009 at 10:00 PM, Uwe Kubosch <uwe at datek.no> wrote:
>> Hi all!
>> Here are a few FAQs for you:
>> Why are all the releases of RabiitMQ "beta"?
>> What does "beta" mean in this context?
>> Should I NOT use RabbitMQ in a production environment?
>> What are the criteria for a "final" release of RabbitMQ?
>> Feel free to answer directly or post a link  :)  I have read the  
>> FAQs and
>> other documentation, and RabbitMQ seems mature from user reports,  
>> but the
>> official status of "beta" bothers me, and I am struggling to  
>> understand what
>> it means.
>> Any reply is appreciated.
>>
>> With kind regards,
>> Uwe Kubosch
>> Datek Wireless AS
>> Norway
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091020/ba620f05/attachment.htm 

From ben.browitt at gmail.com  Tue Oct 20 16:55:40 2009
From: ben.browitt at gmail.com (Ben Browitt)
Date: Tue, 20 Oct 2009 17:55:40 +0200
Subject: [rabbitmq-discuss] Streaming stock prices to long-polling
	clients
In-Reply-To: <4ADC4C68.90108@lshift.net>
References: <b0200d7f0910150251o2f618c38x3daf09f49eeed171@mail.gmail.com>
	<4ADC4C68.90108@lshift.net>
Message-ID: <b0200d7f0910200855x28ca78bay9308505b988ba591@mail.gmail.com>

Matthias,

Thank you. The round-robin and direct exchange were the missing parts.

Ben

On Mon, Oct 19, 2009 at 1:24 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Ben,
>
> Ben Browitt wrote:
> > In my application I need to stream stock prices to users.
> > The 'last price' will be retrieved from a separate service when a
> > consumer connects which simplifies things.
> > Each user will subscribe to several stocks.
> > Users are web browsers connecting using long-polling.
> >
> > Do I create one queue per consumer with several bindings, one for each
> > stock?
> > Prices in this case will be sent with a topic routing key.
> > Another option is to create one queue per stock. each consumer will be
> > subscribed to several queues.
> > Messages will be sent with a direct routing key.
>
> In the latter case, each quote would only go to one consumer, which is
> probably not what you want. In an AMQP system, to get the same message
> delivered to N consumers you need (at least) N queues. Exchanges *copy*
> messages to queues, whereas queues *round-robin* message delivery to
> consumers.
>
> Your first setup should work fine, except there is no need to use a
> topic exchange. Just use a direct exchange, one queue per user and for
> each of the stock symbols a user is interested in create a binding
> between the user's queue and the direct exchange.
>
> > Users will connect using a browser with long-polling to the mochiweb
> plugin.
> > Each user will be presented at the server side as an erlang AMQP client.
>
> Have you considered using the rabbitmq-jsonrpc-channel plugin? Even if
> you don't want to use it, it's worth taking a look at how it's
> implemented since that may well answer some of your questions regarding
> long-polling.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091020/1046330b/attachment.htm 

From alex at beautifulpixel.com  Tue Oct 20 17:54:48 2009
From: alex at beautifulpixel.com (Alex Wayne)
Date: Tue, 20 Oct 2009 09:54:48 -0700
Subject: [rabbitmq-discuss] Can't run rabbitmq-server... Install issue?
In-Reply-To: <4ADD45E6.2060900@lshift.net>
References: <25967988.post@talk.nabble.com>
	<8DD1D4A6-6953-4EF3-BF6D-6ADBBECA4DD4@mac.com>
	<ae58b0e00910191839rae103b2n747c99ce4f3394cc@mail.gmail.com>
	<4ADD45E6.2060900@lshift.net>
Message-ID: <ae58b0e00910200954t179930f7sae0a36841ac4cca8@mail.gmail.com>

Yeah it appears I was confused on a few facts gathered from readme's and
googling.  I guess I thought that section was for installing from source.
Ok, thanks the help.  Gonna remove my foot from my mouth and continue on!
-Alex


On Mon, Oct 19, 2009 at 10:08 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Alex,
>
> Alex Wayne wrote:
>
>> In my defense the installation instruction don't mention rabbit actually
>> has to be compiled at all:
>> http://www.rabbitmq.com/install.html#install-generic-unix
>> It says:
>>
>> 1. Install erlang
>> 2. unpack rabbitmq tarball and place with other erlang libs
>> 3. Customize script/rabbitmq-server environment variables
>>
>
> Actually, the instructions (at the above URL and in the INSTALL file inside
> the tarball) say
>
> # Install a recent version of Erlang.
> # Download rabbitmq-server-generic-unix-version.tar.gz, where version is
> the version of RabbitMQ Server you want to install.
> # Contained in the tarball is a directory named rabbitmq_server-version.
> You should extract this into somewhere appropriate for application binaries
> on your system.
> # Within the sbin directory is a shell script rabbitmq-server which may
> need customisation for your installation. [...]
>
>  Not actually knowing erlang at all I had no idea this was a even a
>> compiled language at all.  It seems that a step 2.5 "run a make command in
>> the rabbitmq-server_version directory", would have saved me a headache.
>>
>
> The rabbitmq-server-generic-unix-version.tar.gz mentioned above, available
> from http://www.rabbitmq.com/server.html, is pre-compiled. So no compile
> steps are necessary. And there is no Makefile in that tar. Did you perhaps
> download the *source* tarball? In that case the clue is in the name ;) and
> the build instructions at http://www.rabbitmq.com/build-server.html tell
> you what to do.
>
> As an aside, there is no need for rabbit to be put in a "place with other
> erlang libs" - that used to be the case prior to 1.7.0 but is no longer true
> (and the docs reflect that).
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091020/17a88f20/attachment.htm 

From ghaidar0 at gmail.com  Wed Oct 21 06:53:35 2009
From: ghaidar0 at gmail.com (George Haidar)
Date: Wed, 21 Oct 2009 16:53:35 +1100
Subject: [rabbitmq-discuss] Effects of closing a rabbitmq connection
Message-ID: <da73e0750910202253pd1927a6g4193fffbc951721e@mail.gmail.com>

Hi,
Would calling the close() method on a rabbitmq Connection object:
1. cause all channels to close properly? and
2. cause all non-durable exchanges and queues to be deleted?

Regards,
George Haidar



From dglaubman at acm.org  Wed Oct 21 06:53:58 2009
From: dglaubman at acm.org (David Glaubman)
Date: Tue, 20 Oct 2009 22:53:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <4ADD5443.6080701@lshift.net>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
Message-ID: <25986856.post@talk.nabble.com>


Matthias,

> It looks like MSMQ may have some optimisation for the local case - 
> perhaps it bypasses the TCP/IP stack?

Yes, I believe local MSMQ is highly optimized (perhaps using pipes?).
My major interest there was the send rate of 33K messages per second 
that MSMQ managed for the remote case, 
compared  to 4K with Rabbit's .Net client.
It's odd -- MSMQ Send seems to be  8X faster than Rabbit/.Net Publish, 
but MSMQ Receive is 8X slower than Consume!

> As for rabbit, I suspect the main bottleneck is actually the .net 
> client. What's the CPU load like for the client? It may well be maxing 
> out one core.

For Rabbit, in remote case, client CPU load peaks at around 40% 
(2 cores at a little almost 60%, other 2 < 10%).
Server CPU load goes to around 30%, 
concentrated on two cores(around 60%, 50%, 5%, 5%).

> [...]
> If you can, try running some tests with the MulticastMain example that 
> ships with the Java client, for comparison.

The Java client tells a very different story ...

   ./runjava.bat com.rabbitmq.examples.MulticastMain -h ca1tesla1 -x 1 -y 1
-z 20 -s 24 -a
   (Single Publisher, single consumer each on its own thread)

Averaged 20K/sec sends, 20K/sec receives.  All server CPUs were at 85-95%,
client CPUs at 35%, 
avg reported latency around 8 or 9 ms.

If #Publishers and/or #Consumers > 1, 
    all server CPUs were maxed out the whole time, client stayed at 35%.

With #Producers = 2, # consumers = 1,   sends/sec = 30K, rcv/sec = 14K. 

With #Producers = 1, # consumers = 2,   sends/sec = 17K, rcv/sec = 27K 
(both consumers get the same messages)

> Also, note that in your particular test setup the RabbitMQ server will 
> not be able to take full advantage of the multiple cores since there is 
> too little inherent parallelism. 

Is load on the server cores so evenly distributed when using the Java client 
(even with single Publisher, single Consumer) 
largely because sends and receives are running simultaneously on separate
(client) threads? 

> Presumably your intended use case does 
> have more than a single message stream, 
> going from one producer to one 
> consumer; such a configuration will produce higher message rates overall.

Yes.  I'm trying to pipeline a large computation 
which consists of a small number of massively parallel stages. 
Each stage consists of a large number of components 
each of which transform an input stream (from previous stage) 
to an output stream (next stage).
I'm basically looking for a way to send messages fast enough
to prove the concept is workable (or not).
If I can come close to saturating Gbit Ethernet 
using COTS h/w and s/w, 
I'll know I'm on the right track. (and, contrariwise).

David

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: Monday, October 19, 2009 11:10 PM
To: David Glaubman
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Simple benchmark and results

[...]
-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p25986856.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Wed Oct 21 08:03:18 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 21 Oct 2009 08:03:18 +0100
Subject: [rabbitmq-discuss] Effects of closing a rabbitmq connection
In-Reply-To: <da73e0750910202253pd1927a6g4193fffbc951721e@mail.gmail.com>
References: <da73e0750910202253pd1927a6g4193fffbc951721e@mail.gmail.com>
Message-ID: <4ADEB236.9030204@lshift.net>

George,

George Haidar wrote:
> Would calling the close() method on a rabbitmq Connection object:
> 1. cause all channels to close properly? and

Yes.

> 2. cause all non-durable exchanges and queues to be deleted?

No. The durability setting controls whether resources survive a broker 
restart.

However, you can mark a queue as exclusive, which will cause it to get 
deleted when the creating connection closes. And marking a queue 
auto-delete will cause it to get deleted when its last consumer 
disappears (which may happen in several ways, including through closing 
a connection).


Regards,

Matthias.



From matthias at lshift.net  Wed Oct 21 08:42:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 21 Oct 2009 08:42:28 +0100
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <25986856.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
	<25986856.post@talk.nabble.com>
Message-ID: <4ADEBB64.8060605@lshift.net>

David,

David Glaubman wrote:
> For Rabbit, in remote case, client CPU load peaks at around 40% 
> (2 cores at a little almost 60%, other 2 < 10%).
> Server CPU load goes to around 30%, 
> concentrated on two cores(around 60%, 50%, 5%, 5%).

Given that sending is asynchronous, if neither the client or the server 
are maxing out a CPU then the network communication would seem to be the 
bottleneck.

Nagle is the obvious culprit, but both the client and the server disable 
that.

Could it be that the Windows firewall or antivirus is getting in the 
way? We have seen some very odd behaviour with these two. OTOH, that 
should affect the Java client too. Hmm.

> The Java client tells a very different story ...
> 
>    ./runjava.bat com.rabbitmq.examples.MulticastMain -h ca1tesla1 -x 1 -y 1
> -z 20 -s 24 -a
>    (Single Publisher, single consumer each on its own thread)
> 
> Averaged 20K/sec sends, 20K/sec receives.  All server CPUs were at 85-95%,
> client CPUs at 35%, 
> avg reported latency around 8 or 9 ms.

These figures are much more in line with what I'd expect to see.

Note that there is one obvious difference to the .net tests: By setting 
the "-a" flag the consumers will operate in auto-ack mode, whereas in 
the .net code you posted you do an explicit ack. The former is quite a 
bit more efficient and may well account for the bulk of the difference 
between the .net and java consumer performance. The setting won't affect 
the sending side at all though,

The discrepancy between the .net and Java client merits investigation. 
Can you package up your test code in a form that makes it 
straightforward to run and thus try to reproduce your results? Bonus 
points if it is easy to get the test to run under mono.

> If I can come close to saturating Gbit Ethernet using COTS h/w and
> s/w, I'll know I'm on the right track.

Message size has a big impact. Small messages carry a significant 
(relative) framing and processing overhead. To get anywhere close to 
saturating Gbit Ethernet your message payloads would have to be 
substantially larger than 24 bytes. And you'd definitely want to create 
multiple streams. Our OPRA testing with Intel two years ago did both 
these things.


Regards,

Matthias.



From dglaubman at acm.org  Wed Oct 21 18:44:37 2009
From: dglaubman at acm.org (David Glaubman)
Date: Wed, 21 Oct 2009 10:44:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <4ADEBB64.8060605@lshift.net>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
	<25986856.post@talk.nabble.com> <4ADEBB64.8060605@lshift.net>
Message-ID: <25997030.post@talk.nabble.com>


Matthias,

You write:
[...]
> Note that there is one obvious difference to the .net tests: 
> By setting the "-a" flag the consumers will operate 
> in auto-ack mode, whereas in the .net code you posted you do an explicit
> ack. 
> The former is quite a bit more efficient and may well account 
> for the bulk of the difference between the .net and java consumer
> performance. 

Bingo! Setting 'noAck' = true on basicConsume increases messages received to
about 33K per sec.

As to the low send rate --
> Given that sending is asynchronous

Not so fast! (so to speak;-) -- rabbit .Net client uses TCPClient, 
which "provides simple methods for connecting, sending, and receiving 
stream data over a network in synchronous blocking mode." 
(http://msdn.microsoft.com/en-us/library/system.net.sockets.tcpclient.aspx)

> Can you package up your test code in a form that makes it 
> straightforward to run and thus try to reproduce your results? 
> Bonus points if it is easy to get the test to run under mono.

Okay.

Thanks 
David

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: Wednesday, October 21, 2009 12:42 AM
To: David Glaubman
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Simple benchmark and results

David,
[...]

-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p25997030.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From pkirsanov at 38studios.com  Wed Oct 21 18:57:16 2009
From: pkirsanov at 38studios.com (Philippe Kirsanov)
Date: Wed, 21 Oct 2009 13:57:16 -0400
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <25997030.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com>
	<4ADD5443.6080701@lshift.net><25986856.post@talk.nabble.com>
	<4ADEBB64.8060605@lshift.net> <25997030.post@talk.nabble.com>
Message-ID: <D1AC29FC5C9E644C91BE7C9294BF701B027A76E8@gmg-maynard-mai.greenmonstergames.net>

What exactly "noAck" parameter in basicConsume mean? Is it auto-ack on
message or something else? API guide sais it is "handshake ack".
On api-guide page there is an example that sets noAvk = false and also
sends ack upon message delivery:
boolean noAck = false;
QueueingConsumer consumer = new QueueingConsumer(channel);
channel.basicConsume(queueName, noAck, consumer);
while (/* decide whether to continue reading */) {
    QueueingConsumer.Delivery delivery;
    try {
        delivery = consumer.nextDelivery();
    } catch (InterruptedException ie) {
        continue;
    }
    // (process the message components ...)
    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
}



-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of David
Glaubman
Sent: Wednesday, October 21, 2009 13:45
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Simple benchmark and results


Matthias,

You write:
[...]
> Note that there is one obvious difference to the .net tests: 
> By setting the "-a" flag the consumers will operate 
> in auto-ack mode, whereas in the .net code you posted you do an
explicit
> ack. 
> The former is quite a bit more efficient and may well account 
> for the bulk of the difference between the .net and java consumer
> performance. 

Bingo! Setting 'noAck' = true on basicConsume increases messages
received to
about 33K per sec.

As to the low send rate --
> Given that sending is asynchronous

Not so fast! (so to speak;-) -- rabbit .Net client uses TCPClient, 
which "provides simple methods for connecting, sending, and receiving 
stream data over a network in synchronous blocking mode." 
(http://msdn.microsoft.com/en-us/library/system.net.sockets.tcpclient.as
px)

> Can you package up your test code in a form that makes it 
> straightforward to run and thus try to reproduce your results? 
> Bonus points if it is easy to get the test to run under mono.

Okay.

Thanks 
David

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: Wednesday, October 21, 2009 12:42 AM
To: David Glaubman
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Simple benchmark and results

David,
[...]

-- 
View this message in context:
http://www.nabble.com/Simple-benchmark-and-results-tp25968960p25997030.h
tml
Sent from the RabbitMQ mailing list archive at Nabble.com.


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From dglaubman at acm.org  Wed Oct 21 19:14:31 2009
From: dglaubman at acm.org (David Glaubman)
Date: Wed, 21 Oct 2009 11:14:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <D1AC29FC5C9E644C91BE7C9294BF701B027A76E8@gmg-maynard-mai.greenmonstergames.net>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
	<25986856.post@talk.nabble.com> <4ADEBB64.8060605@lshift.net>
	<25997030.post@talk.nabble.com>
	<D1AC29FC5C9E644C91BE7C9294BF701B027A76E8@gmg-maynard-mai.greenmonstergames.net>
Message-ID: <25997547.post@talk.nabble.com>



Philippe Kirsanov wrote:
> 
>> What exactly "noAck" parameter in basicConsume mean? Is it auto-ack
>> on message or something else? API guide sais it is "handshake ack".
> 
I think it means auto-ack -- when I set it true in BasicConsume 
and remove the call to BasicAck my receive performance more than tripled.

Here?s a quote on noAck: 
(http://www.trapexit.org/forum/viewtopic.php?p=48116)
    AMQP says that a broker shouldn't forget about a msg until it's been 
    ack'd. Now this can either happen by an explicit ack coming from the 
    consumer, or from an implicit ack, by setting noAck to true when 
    subscribing to the queue. Yes, the unfortunate naming of "noAck" is, um, 
    unfortunate. Internally, we tend to invert this and then call it 
    AckRequired.

Hope this helps.

David


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of David
Glaubman
Sent: Wednesday, October 21, 2009 13:45
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Simple benchmark and results


Matthias,

You write:
[...]
> Note that there is one obvious difference to the .net tests: 
> By setting the "-a" flag the consumers will operate 
> in auto-ack mode, whereas in the .net code you posted you do an
explicit
> ack. 
> The former is quite a bit more efficient and may well account 
> for the bulk of the difference between the .net and java consumer
> performance. 

Bingo! Setting 'noAck' = true on basicConsume increases messages
received to
about 33K per sec.

[...]
-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p25997547.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Wed Oct 21 19:16:41 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 21 Oct 2009 19:16:41 +0100
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <25997030.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com>
	<4ADD5443.6080701@lshift.net>	<25986856.post@talk.nabble.com>
	<4ADEBB64.8060605@lshift.net> <25997030.post@talk.nabble.com>
Message-ID: <4ADF5009.5090707@lshift.net>

David,

David Glaubman wrote:
>> Given that sending is asynchronous
> 
> Not so fast! (so to speak;-) -- rabbit .Net client uses TCPClient, 
> which "provides simple methods for connecting, sending, and receiving 
> stream data over a network in synchronous blocking mode." 
> (http://msdn.microsoft.com/en-us/library/system.net.sockets.tcpclient.aspx)

Do you know what is meant by "synchronous blocking mode"? I thought it
just meant that, say, a call to Write won't return until the kernel has
taken responsibility for the data (which doesn't mean it's been sent,
let alone received by the other end or passed to the app layer there).
That would not involve any waiting unless the buffers involved are full
due to network congestion or the server not draining the data fast enough.


Matthias.



From sh at defuze.org  Wed Oct 21 19:20:24 2009
From: sh at defuze.org (Sylvain Hellegouarch)
Date: Wed, 21 Oct 2009 20:20:24 +0200
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <25997547.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com>
	<4ADD5443.6080701@lshift.net>	<25986856.post@talk.nabble.com>
	<4ADEBB64.8060605@lshift.net>	<25997030.post@talk.nabble.com>	<D1AC29FC5C9E644C91BE7C9294BF701B027A76E8@gmg-maynard-mai.greenmonstergames.net>
	<25997547.post@talk.nabble.com>
Message-ID: <4ADF50E8.3020102@defuze.org>

David Glaubman a ?crit :
> Philippe Kirsanov wrote:
>   
>>> What exactly "noAck" parameter in basicConsume mean? Is it auto-ack
>>> on message or something else? API guide sais it is "handshake ack".
>>>       
> I think it means auto-ack -- when I set it true in BasicConsume 
> and remove the call to BasicAck my receive performance more than tripled.
>
> Here?s a quote on noAck: 
> (http://www.trapexit.org/forum/viewtopic.php?p=48116)
>     AMQP says that a broker shouldn't forget about a msg until it's been 
>     ack'd. Now this can either happen by an explicit ack coming from the 
>     consumer, or from an implicit ack, by setting noAck to true when 
>     subscribing to the queue. Yes, the unfortunate naming of "noAck" is, um, 
>     unfortunate. Internally, we tend to invert this and then call it 
>     AckRequired.
>
> Hope this helps.
>   

I assume this means that if the consumer fails at processing correctly 
the message it won't see it again right, whereas with an ack by the 
consumer, one can ensure consistency if the processing fails before the 
ack call.

- Sylvain



From alexis.richardson at gmail.com  Wed Oct 21 20:22:52 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 21 Oct 2009 20:22:52 +0100
Subject: [rabbitmq-discuss] What does "beta" mean for RabbitMQ?
In-Reply-To: <10199A34-51BF-4B2F-AB36-41A4A1B7A128@datek.no>
References: <3A0E721E-A1B2-478F-89B2-1521B029DFE3@datek.no>
	<167204d20910181416y489f05caqe5bfe4fe852df2d8@mail.gmail.com>
	<10199A34-51BF-4B2F-AB36-41A4A1B7A128@datek.no>
Message-ID: <167204d20910211222o6541b01bl6df8c29257a362a6@mail.gmail.com>

Uwe

We are still discussing this.  The current proposal we are looking at,
is to radically simplify the release status descriptions.  We may
provide an orthogonal statement concerning 'which version to use' that
politely explains that each release - while QAd to a high standard -
is still ipso facto novel, in order to ward conservative adopters off
being among the very first to use it.

alexis


On Tue, Oct 20, 2009 at 8:16 AM, Uwe Kubosch <uwe at datek.no> wrote:
> Hi Alexis!
> Thank you for the quick reply.
> My initial thoughts:
> 'beta' implies 'unfinished' and 'unstable'
> 'release candidate' better reflects your description of the status of the
> release.
> Make an event of declaring a release "final", and announce this event in the
> initial release announcement. ?Something like:
> "This release has 'release candidate' status pending user feedback and will
> be declared as 'final' in 4 weeks unless major bugs are detected. ?We
> recommend that developers, testers and non-critical systems using earlier
> versions of RabbitMQ upgrade to?this latest release."
> Then 4 weeks later: ?"RabbitMQ 1.8.0 declared final! ?The package has been
> downloaded 4 million times and we have received positive feedback from our
> users. ?No major bugs have been reported. ?We recommend that all users of
> earlier versions of RabbitMQ upgrade to?this latest release."
> If you detect major bugs, you do not announce the 'final' status. ?You
> should announce the bug instead and include when the bug is expected to
> fixed. ?Something like "A major bug was reported and will be fixed in the
> 1.9.0 release.
> Personally I like patch level releases to quickly fix bugs to make a minor
> release branch stable, but i realize it takes less organization and effort
> to fix the bug in the next minor release.
> I also like packaging the release candidate with an 'rc1' in the version
> string like rabbitmq-server-1.8.0rc1, but that requires repackaging when the
> final release is out, so keeping the same package but declaring it stable
> after a while saves the extra packaging.
> Really, any solution that keeps me from browsing around looking for the
> 'stable' release is good :)
>
> Uwe
>
>
> On Oct 18, 2009, at 11:16 PM, Alexis Richardson wrote:
>
> Uwe
>
> Great questions. ?We seek advice on how to make this clearer. ?Please
> take a look at this first, and let us know what you think:
>
> http://www.trapexit.org/forum/viewtopic.php?p=49591&sid=20d06e54360b9122cd625eb6e459cfeb
>
> alexis
>
>
> On Sun, Oct 18, 2009 at 10:00 PM, Uwe Kubosch <uwe at datek.no> wrote:
>
> Hi all!
>
> Here are a few FAQs for you:
>
> Why are all the releases of RabiitMQ "beta"?
>
> What does "beta" mean in this context?
>
> Should I NOT use RabbitMQ in a production environment?
>
> What are the criteria for a "final" release of RabbitMQ?
>
> Feel free to answer directly or post a link ?:) ?I have read the FAQs and
>
> other documentation, and RabbitMQ seems mature from user reports, but the
>
> official status of "beta" bothers me, and I am struggling to understand what
>
> it means.
>
> Any reply is appreciated.
>
> With kind regards,
>
> Uwe Kubosch
>
> Datek Wireless AS
>
> Norway
>
> _______________________________________________
>
> rabbitmq-discuss mailing list
>
> rabbitmq-discuss at lists.rabbitmq.com
>
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From kyle at raidi.us  Wed Oct 21 21:06:20 2009
From: kyle at raidi.us (Kyle Schaffrick)
Date: Wed, 21 Oct 2009 16:06:20 -0400
Subject: [rabbitmq-discuss] Round-robin queue failover
In-Reply-To: <4ADD504D.1080305@lshift.net>
References: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>
	<4ADD504D.1080305@lshift.net>
Message-ID: <E1N0hRr-0000I0-TK@victory.heartlandliberty.org>

On Tue, 20 Oct 2009 06:53:17 +0100
Matthias Radestock <matthias at lshift.net> wrote:

> Sebastian,
> 
> Sebastian wrote:
> > Now I have come across this [1] blog-post by Ilya Grigorik which  
> > says:  "Assign two identically named queues to an exchange and the  
> > broker will automatically round-robin the messages". So my  
> > understanding is that I could just create identical queues on
> > every node, and the broker will take care of the rest: if one node
> > goes down, messages will just be spread over the other queues/nodes.
> > Is this supported by rabbitmq? I've looked around in the amqp
> > specs and documentation, but couldn't find anything related.
> > 
> > [1]
> > http://www.igvita.com/2009/10/08/advanced-messaging-routing-with-amqp/
> 
> That part of the article is wrong. Exchanges route messages to all
> the queues bound with a binding that matches the message. There is no 
> round-robining going on; that only happens for delivering messages to 
> multiple consumers of the same queue.
> 
> Regards,
> 
> Matthias.
> 

The author of the article seems to be confusing "declaring and consuming
from the same queue from two different places" with "creating two
identically-named queues" which (if I understand correctly) is not
possible, since declaration is idempotent. I would guess that's why the
operation is called "declare" and not "create".

If you reword it to remove the misunderstanding, then the statement
seems correct. Attempting to create two identically-named queues will
result in declaring the same queue twice; the two consumers then
consuming from that queue will see load-balancing behavior.

-Kyle



From marknutter at gmail.com  Thu Oct 22 02:57:02 2009
From: marknutter at gmail.com (Mark Nutter)
Date: Wed, 21 Oct 2009 20:57:02 -0500
Subject: [rabbitmq-discuss] 100% CPU usage and system crawls to a halt
Message-ID: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>

I have rabbitMQ 1.6 on Hardy, and I'm running into an issue where the
rabbitMQ process randomly will ramp up to 100% CPU usage and stay there.
Once this happens, all message routing crawls to a near halt and the server
has to be restarted.
A quick overview of what I have it doing: I'm taking a firehose of Twitter
statuses and throwing every single one of them into a main queue from which
they are thrown into a mySQL database. These statuses also get routed to
other smaller queues based on different routing keys like twitter user ids
and URLs. These messages come in fast, about 1000 per 10 seconds, and we
pull the messages off the queue about as fast as they come in.

I've seen a few threads discussing the 100% CPU usage problem, but no real
solutions.  Am I going about this the wrong way?  What might be causing this
problem.  Is 1.7 a better option and is there a stable package out there
that works on Hardy?  Thanks in advance for your input.

-- 
Mark Nutter
marknutter at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091021/cff03a5b/attachment.htm 

From matthias at lshift.net  Thu Oct 22 09:58:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 22 Oct 2009 09:58:12 +0100
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <4ADF50E8.3020102@defuze.org>
References: <25968960.post@talk.nabble.com>	<4ADD5443.6080701@lshift.net>	<25986856.post@talk.nabble.com>	<4ADEBB64.8060605@lshift.net>	<25997030.post@talk.nabble.com>	<D1AC29FC5C9E644C91BE7C9294BF701B027A76E8@gmg-maynard-mai.greenmonstergames.net>	<25997547.post@talk.nabble.com>
	<4ADF50E8.3020102@defuze.org>
Message-ID: <4AE01EA4.4060408@lshift.net>

Sylvain,

Sylvain Hellegouarch wrote:
> I assume this means that if the consumer fails at processing correctly 
> the message it won't see it again right, whereas with an ack by the 
> consumer, one can ensure consistency if the processing fails before the 
> ack call.

Sort of. In auto-ack/no-ack mode the broker forgets about the message as 
soon as it has sent it. So any failure of the broker, network or 
consuming client after the sending will result in the message being 
lost. By contrast, when acks are enabled the broker only forgets about a 
message when the client has sent it an ack. Any failure before then 
results in an eventual retransmit.


Regards,

Matthias.



From Franck.Boisson at mlp.com  Thu Oct 22 10:22:42 2009
From: Franck.Boisson at mlp.com (Boisson, Franck)
Date: Thu, 22 Oct 2009 17:22:42 +0800
Subject: [rabbitmq-discuss] Java API V1.6.0 - Performance problem with
	basicConsume and dynamic bindings
Message-ID: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>

Hello,

 

I am facing a performance issue with the Java Amqp-lib V1.6.0.

On the client side, my use-case is the following:

-          create the amqp connection

-          create a queue that will be dedicated to all incoming
messages: queue A

-          create a channel that will listen to messages coming for
queue A on a subscription basis (basicConsume): channel A

-          create another channel to handle dynamic bindings requests
(will be explained after): channel B

-          start the binding queue A --> channel A thanks to a
basicConsume request through channel A

-          ask for a lot of bindings through Channel B to redirect
incoming market data messages (published by a server which is working
correctly) to queue A (queueBind done through channel B with queue A id)

 

Doing that, after a couple of sec and before having finished to ask for
all "dynamic bindings", my incoming message listener if falling behind
(messages are waiting on queue A and this number never decrease but
increase).

 

Do you know from where it could come from?

 

Best regards

Franck


######################################################################
The information contained in this communication is confidential and
may contain information that is privileged or exempt from disclosure
under applicable law. If you are not a named addressee, please notify
the sender immediately and delete this email from your system.
If you have received this communication, and are not a named
recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited.
######################################################################
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091022/30af43de/attachment.htm 

From Franck.Boisson at mlp.com  Thu Oct 22 10:25:33 2009
From: Franck.Boisson at mlp.com (Boisson, Franck)
Date: Thu, 22 Oct 2009 17:25:33 +0800
Subject: [rabbitmq-discuss] Java API V1.6.0 - Performance problem with
	basicConsume and dynamic bindings
In-Reply-To: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>
References: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>
Message-ID: <1590A5C25AF3E9438F4232897EEFA514D816B3@EXCHSI001.AD.MLP.COM>

I forgot to mention that my channel A listener have auto-ack enabled

 

________________________________

From: Boisson, Franck 
Sent: Thursday, October 22, 2009 5:23 PM
To: rabbitmq
Subject: Java API V1.6.0 - Performance problem with basicConsume and
dynamic bindings

 

Hello,

 

I am facing a performance issue with the Java Amqp-lib V1.6.0.

On the client side, my use-case is the following:

-          create the amqp connection

-          create a queue that will be dedicated to all incoming
messages: queue A

-          create a channel that will listen to messages coming for
queue A on a subscription basis (basicConsume): channel A

-          create another channel to handle dynamic bindings requests
(will be explained after): channel B

-          start the binding queue A --> channel A thanks to a
basicConsume request through channel A

-          ask for a lot of bindings through Channel B to redirect
incoming market data messages (published by a server which is working
correctly) to queue A (queueBind done through channel B with queue A id)

 

Doing that, after a couple of sec and before having finished to ask for
all "dynamic bindings", my incoming message listener if falling behind
(messages are waiting on queue A and this number never decrease but
increase).

 

Do you know from where it could come from?

 

Best regards

Franck


######################################################################
The information contained in this communication is confidential and
may contain information that is privileged or exempt from disclosure
under applicable law. If you are not a named addressee, please notify
the sender immediately and delete this email from your system.
If you have received this communication, and are not a named
recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited.
######################################################################
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091022/eee0897f/attachment.htm 

From matthew at lshift.net  Thu Oct 22 11:04:15 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 22 Oct 2009 11:04:15 +0100
Subject: [rabbitmq-discuss] 100% CPU usage and system crawls to a halt
In-Reply-To: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>
References: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>
Message-ID: <20091022100415.GB6284@wellquite.org>

Hi Mark,

On Wed, Oct 21, 2009 at 08:57:02PM -0500, Mark Nutter wrote:
> A quick overview of what I have it doing: I'm taking a firehose of Twitter
> statuses and throwing every single one of them into a main queue from which
> they are thrown into a mySQL database. These statuses also get routed to
> other smaller queues based on different routing keys like twitter user ids
> and URLs. These messages come in fast, about 1000 per 10 seconds, and we
> pull the messages off the queue about as fast as they come in.

Are you setting QoS, and are you using Basic.Get or a subscription to a
queue? The latter will be better. Also, if you don't care about losing
messages, make sure you're not setting the persistent flag on the
publishes, and you may wish to set NoAck when pulling messages off the
queue. If you're not setting NoAck, make sure you are acking messages as
you receive them.

Finally, what type of exchange are you using? Topic exchanges are much
slower (especially with large numbers of bindings) than fanout.

> I've seen a few threads discussing the 100% CPU usage problem, but no real
> solutions.  Am I going about this the wrong way?  What might be causing this
> problem.  Is 1.7 a better option and is there a stable package out there
> that works on Hardy?  Thanks in advance for your input.

We always recommend using our latest and greatest release, but I'm not
sure if it's available for Hardy yet. I would also suggest that given
the current release of Erlang is R13B02 and the version in Hardy is
R11B5, you're somewhat behind the times there too.

Generally, if you have the logic in your consumers to be able to drop
messages out later on, then we tend to suggest that using a fanout
exchange to multiple queues is much better than using a topic exchange
with many many bindings. We do have plans to improve the efficiency of
the topic exchange, but it's a little way off just yet (unless people
wish to pay us to do it!).

On modern hardware, no persistence, fanout exchange, a real consumer
(not Basic.Get) and setting NoAck, we regularly see around 20kHz,
depending on the message size. Now obviously, that'll change easily with
a billion different variables, but given your message rate of 100Hz, I
would be surprised if you can't make it work.

Please let us know if you have any further salient details!

Matthew



From matthias at lshift.net  Thu Oct 22 15:17:23 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 22 Oct 2009 15:17:23 +0100
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <25997030.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com>
	<4ADD5443.6080701@lshift.net>	<25986856.post@talk.nabble.com>
	<4ADEBB64.8060605@lshift.net> <25997030.post@talk.nabble.com>
Message-ID: <4AE06973.6010802@lshift.net>

David,

David Glaubman wrote:
> You write:
> [...]
>> Note that there is one obvious difference to the .net tests: 
>> By setting the "-a" flag the consumers will operate 
>> in auto-ack mode, whereas in the .net code you posted you do an explicit
>> ack. 
>> The former is quite a bit more efficient and may well account 
>> for the bulk of the difference between the .net and java consumer
>> performance. 
> 
> Bingo! Setting 'noAck' = true on basicConsume increases messages received to
> about 33K per sec.

I have just run some experiments with code very similar to yours - the
only significant changes I made was to set the message to be a byte[24]
array, use DateTime.Now for timing and do 50,000 iterations, i.e.

            var publishStart = DateTime.Now;
            for (int i = 0; i < 50000; i++) {
                channel.BasicPublish(exchange, routingKey, null, message);
            }
            Console.WriteLine("publish: {0}", DateTime.Now - publishStart);

In the local case I get sending rates of ~10kHz on my ancient machine
running mono on debian. That's significantly higher than the ~4kHz you
are reporting.

The consuming rate is half that but increases to ~15kHz with nAck=true.


So something weird is going on in your set up.


Regards,

Matthias.



From matthias at lshift.net  Thu Oct 22 15:29:54 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 22 Oct 2009 15:29:54 +0100
Subject: [rabbitmq-discuss] Java API V1.6.0 - Performance problem with
 basicConsume and dynamic bindings
In-Reply-To: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>
References: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>
Message-ID: <4AE06C62.7020303@lshift.net>

Franck,

Boisson, Franck wrote:
> Doing that, after a couple of sec and before having finished to ask for
> all ?dynamic bindings?, my incoming message listener if falling behind
> (messages are waiting on queue A and this number never decrease but
> increase).

Does the consumer stop receiving messages altogether or does it just
slow down?

Do either the client or server max out the CPU?

Does the binding creation continue to proceed after the point when you
observe the listener falling behind?

How many bindings are you creating in total?

Are you using a topic exchange?


Regards,

Matthias.



From sjaday at gmail.com  Thu Oct 22 19:03:56 2009
From: sjaday at gmail.com (Stephen Day)
Date: Thu, 22 Oct 2009 11:03:56 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4AE01D24.8020704@lshift.net>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>
	<4AD59AAA.4060703@lshift.net> <4AD5A1F3.1050108@lshift.net>
	<4d376de30910141231v3954a376y86cb245e449f573a@mail.gmail.com>
	<167204d20910150233u3c9d5615k93ddbc681b166d8c@mail.gmail.com>
	<4d376de30910151508s46f73efbrf2025ffe2dc785e@mail.gmail.com>
	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>
	<4AE01D24.8020704@lshift.net>
Message-ID: <4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>

>From your suggestions, it looks like I was on the right track. Output is
inline.

Moved to rabbitmq-discuss.

And again, your guidance is greatly appreciated.

-Stephen

On Thu, Oct 22, 2009 at 1:51 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Stephen,
>
> Stephen Day wrote:
>
>> After running for few days, limiting queue size on producer side (no
>> memory backpressure), I have noticed that RabbitMQ has restarted several
>> times due to out of memory errors. Currently, I have about 150,000
>> persistent messages being consumed by 16 clients with qos. Over about 2-6
>> hours, the RSS and VM size of the erlang process grows unbounded, without
>> the producers adding any messages to the queue (externally limited to
>> 100,000), and the erlang process crashes. I am running version 1.7.0.
>>
>
> Memory consumption can increase due to gc effects, but not without bounds.
>
> How many messages does rabbit think there are in the queues - check with
> 'rabbitmqctl list_queues' - and how big are the messages?
>

$ ~/rabbitmq/sbin/rabbitmqctl list_queues name messages
messages_unacknowledged consumers memory
Listing queues ...
<redacted>    0    0    0    2376
<redacted>    27    0    0    27572
<redacted>    0    0    1    2992
<redacted>    149917    16    16    71106232

The messages are no bigger than 512 bytes, but vary in size.


>
> How large is the persister log?


$ du -b mnesia/rabbit/*
162    mnesia/rabbit/DECISION_TAB.LOG
98    mnesia/rabbit/LATEST.LOG
8    mnesia/rabbit/rabbit_config.DCD
995    mnesia/rabbit/rabbit_durable_exchange.DCD
606    mnesia/rabbit/rabbit_durable_queue.DCD
976    mnesia/rabbit/rabbit_durable_queue.DCL
1396    mnesia/rabbit/rabbit_durable_route.DCD
16720    mnesia/rabbit/rabbit_durable_route.DCL
82515919    mnesia/rabbit/rabbit_persister.LOG
82526910    mnesia/rabbit/rabbit_persister.LOG.previous
4    mnesia/rabbit/rabbit_serial
134    mnesia/rabbit/rabbit_user.DCD
192    mnesia/rabbit/rabbit_user_permission.DCD
133    mnesia/rabbit/rabbit_vhost.DCD
12383    mnesia/rabbit/schema.DAT


>
>  Now, I was under the impression that this memory problem was due to the
>> number of messages being added, but this may not be the case. What
>> information do you need to troubleshoot this? Are there any erlang tools,
>> similar to valgrind, that can track down this memory usage?
>>
>
> There are plenty of tools to figure out what's going on in a running Erlang
> system. You need to know a fair bit about Erlang to use them though.
>
> As a starting point, remsh into rabbit with "erl -sname sh -remsh rabbit@<host>"
> (you'll need to run this as the 'rabbitmq' user in a typical rabbit
> installation) and on the prompt type
>  memory().
> which will tell you at a coarse-grain level where the memory has gone.
>

Here is the memory() output:

(rabbit at vs-dfw-ctl11)1> memory().
[{total,1015558480},
 {processes,161498128},
 {processes_used,161494240},
 {system,854060352},
 {atom,516217},
 {atom_used,492146},
 {binary,778446312},
 {code,3860276},
 {ets,70066180}]

Right now, the system is using around 1GB of memory, mostly concentrated in
binary allocation. I was looking at this yesterday as well, and the process
memory hasn't changed much.


>
>
> Regards,
>
> Matthias.
> PS: could we move this discussion onto rabbitmq-discuss, please?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091022/eed2a2e9/attachment.htm 

From ryan at echonest.com  Thu Oct 22 19:04:12 2009
From: ryan at echonest.com (Ryan Berdeen)
Date: Thu, 22 Oct 2009 14:04:12 -0400
Subject: [rabbitmq-discuss] Monitoring RabbitMQ with rabbitmqctl list_queues
Message-ID: <b51ebe1c0910221104g22693451s244360bf9131f14a@mail.gmail.com>

Hi,

I have a simple realtime monitor for RabbitMQ that displays the list
of several queues, and updates every second.

I'd like to use "rabbitmqctl list_queues" to do this, as it sounds
like it would be a lot easier than my current solution, which is to
use the Python amqp client to get the queue length.

Will running this every second have an impact on performance or
otherwise be a bad idea? Is there a different solution I should
consider?

Thanks,

Ryan



From gmr at myyearbook.com  Thu Oct 22 19:09:07 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 22 Oct 2009 14:09:07 -0400
Subject: [rabbitmq-discuss] Monitoring RabbitMQ with rabbitmqctl
	list_queues
In-Reply-To: <b51ebe1c0910221104g22693451s244360bf9131f14a@mail.gmail.com>
References: <b51ebe1c0910221104g22693451s244360bf9131f14a@mail.gmail.com>
Message-ID: <af1bce590910221109q65dca197qec12ac46a0cbcfb6@mail.gmail.com>

You should check out Alice:

http://github.com/auser/alice

On Thu, Oct 22, 2009 at 2:04 PM, Ryan Berdeen <ryan at echonest.com> wrote:
> Hi,
>
> I have a simple realtime monitor for RabbitMQ that displays the list
> of several queues, and updates every second.
>
> I'd like to use "rabbitmqctl list_queues" to do this, as it sounds
> like it would be a lot easier than my current solution, which is to
> use the Python amqp client to get the queue length.
>
> Will running this every second have an impact on performance or
> otherwise be a bad idea? Is there a different solution I should
> consider?
>
> Thanks,
>
> Ryan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthias at lshift.net  Thu Oct 22 19:33:41 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 22 Oct 2009 19:33:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>	<4AD59AAA.4060703@lshift.net>
	<4AD5A1F3.1050108@lshift.net>	<4d376de30910141231v3954a376y86cb245e449f573a@mail.gmail.com>	<167204d20910150233u3c9d5615k93ddbc681b166d8c@mail.gmail.com>	<4d376de30910151508s46f73efbrf2025ffe2dc785e@mail.gmail.com>	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>	<4AE01D24.8020704@lshift.net>
	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
Message-ID: <4AE0A585.1020701@lshift.net>

Stephen,

Stephen Day wrote:
> $ ~/rabbitmq/sbin/rabbitmqctl list_queues name messages
> [...]
> <redacted>    149917    16    16    71106232
> du -b mnesia/rabbit/*
> [...]
> 82515919    mnesia/rabbit/rabbit_persister.LOG
> 82526910    mnesia/rabbit/rabbit_persister.LOG.previous

That all looks reasonable.

> Here is the memory() output:
> 
> (rabbit at vs-dfw-ctl11)1> memory().
> [{total,1015558480},
>  {processes,161498128},
>  {processes_used,161494240},
>  {system,854060352},
>  {atom,516217},
>  {atom_used,492146},
>  {binary,778446312},
>  {code,3860276},
>  {ets,70066180}]

Interesting. There is far more binary data allocated than you have
message data in your system.

We've noticed in the past that binaries can take quite a while to get
collected by the gc. One experiment you may want to try is to run
  garbage_collect(whereis(rabbit_persister)).
from the Erlang shell and see what difference that makes to the memory
report.

Also, the output of
   process_info(whereis(rabbit_persister)).
might be useful.

> Right now, the system is using around 1GB of memory

And you are saying that figure keeps growing, and eventually RabbitMQ
runs out of memory, even though the figures reported by 'rabbitmqctl
list_queues' and 'du' remain roughly constant? That's strange indeed.


Regards,

Matthias.



From dglaubman at acm.org  Thu Oct 22 21:34:55 2009
From: dglaubman at acm.org (David Glaubman)
Date: Thu, 22 Oct 2009 13:34:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <4AE06973.6010802@lshift.net>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
	<25986856.post@talk.nabble.com> <4ADEBB64.8060605@lshift.net>
	<25997030.post@talk.nabble.com> <4AE06973.6010802@lshift.net>
Message-ID: <26016750.post@talk.nabble.com>


Matthias,

I did some profiling of a simple example (basically the SendString example, 
with Publish called in a loop). I understand this is not a realistic
scenario, 
but it does give some sense of where Publish takes time against .Net.

Anyway, almost all of the time was spent in Binarywriter.Write(byte) called
from Frame.WriteTo.  Each Write(byte) was taking about 3-5 mu-sec. 

Since this was so, I looked at NetworkBinarywriter, 
since it calls BinaryWriter.Write(byte) 4x for every uint32 or int32 and 2X
for every uint16.

Using BinaryWriter as a guide, I turned the overrides of Write(int32) etc
to write to a byte array in the proper network order 
and then write the array to the underlying Stream.

Running against the original RabbitMQ.Client dll, doing 10K Publishes of a
24-char string to a remote server,
I got about 1.5K messages per second:
   C:\> SendMultiString.exe ca1tesla1 directexchange direct key
123456789012345678901234 10000
   10000 messages sent in in 7248 mSec

Buffering the int/short Writes in a modified version of NetworkBinaryWriter, 
I got around 7.5K messages per sec.:  (5X speedup)
   C:\> SendMultiString.exe ca1tesla1 directexchange direct key
123456789012345678901234 10000
   10000 messages sent in in 1391 mSec

Also turning on Nagle (setting TCP_NODELAY to false), got it up to 15K per
sec: (total speed up > 10X)
  C:\> SendMultiString.exe ca1tesla1 directexchange direct key
123456789012345678901234 10000
  10000 messages sent in in 676 mSec

Nagle enabled with the original NetworkBinaryWriter was slightly better (in
this case) than the modified NetworkBinarywriter: (about 8.5K)
  C:\> SendMultiString.exe ca1tesla1 directexchange direct key
123456789012345678901234 10000
  10000 messages sent in in 1136 mSec


I'm not proposing that either the NBW should be rewritten along the lines
above or that Nagle's algorithm be enabled on Windows.
But I do think this shows there is something going on with Microsoft's
Socket/TCPClient implementations and there may be real gains available in
writing a whole Frame at once 
to the socket stream (at least when using TCPClient on Windows).

regards,
David

http://www.nabble.com/file/p26016750/NetworkBinaryReader.cs
NetworkBinaryReader.cs 
http://www.nabble.com/file/p26016750/SendMultiString.cs SendMultiString.cs 
-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p26016750.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From dglaubman at acm.org  Thu Oct 22 21:46:46 2009
From: dglaubman at acm.org (David Glaubman)
Date: Thu, 22 Oct 2009 13:46:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <26016750.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
	<25986856.post@talk.nabble.com> <4ADEBB64.8060605@lshift.net>
	<25997030.post@talk.nabble.com> <4AE06973.6010802@lshift.net>
	<26016750.post@talk.nabble.com>
Message-ID: <26016912.post@talk.nabble.com>


Matthias,

Oops -- I uploaded the original NetworkBinaryWriter not the modified version
I used for the test s.

Here is the relevant code:

       /// <summary>
        /// Override BinaryWriter's method for network-order.
        /// </summary>
        public override void Write(short i) {
            buffer[0] = (byte)(i >> 8);
            buffer[1] = (byte)i;
            WriteBuffer(2);
        }

        /// <summary>
        /// Override BinaryWriter's method for network-order.
        /// </summary>
        public override void Write(ushort i) {
            buffer[0] = (byte)(i >> 8);
            buffer[1] = (byte)i;
            WriteBuffer(2);
        }

        /// <summary>
        /// Override BinaryWriter's method for network-order.
        /// </summary>
        public override void Write(int i) {
            buffer[0] = (byte)(i >> 24);
            buffer[1] = (byte)(i >> 16);
            buffer[2] = (byte)(i >> 8);
            buffer[3] = (byte)(i);
            WriteBuffer(4);
        }

        /// <summary>
        /// Override BinaryWriter's method for network-order.
        /// </summary>
        public override void Write(uint i)
        {
            buffer[0] = (byte)(i >> 24);
            buffer[1] = (byte)(i >> 16);
            buffer[2] = (byte)(i >> 8);
            buffer[3] = (byte)(i);
            WriteBuffer(4);
        }

        /// <summary>
        /// Override BinaryWriter's method for network-order.
        /// </summary>
        public override void Write(long i) {
            buffer[0] = (byte)(i >> 56);
            buffer[1] = (byte)(i >> 48);
            buffer[2] = (byte)(i >> 40);
            buffer[3] = (byte)(i >> 32);
            buffer[4] = (byte)(i >> 24);
            buffer[5] = (byte)(i >> 16);
            buffer[6] = (byte)(i >> 8);
            buffer[7] = (byte) (i);
            WriteBuffer(8);
        }

        /// <summary>
        /// Override BinaryWriter's method for network-order.
        /// </summary>
        public override void Write(ulong i) {
            buffer[0] = (byte)(i >> 56);
            buffer[1] = (byte)(i >> 48);
            buffer[2] = (byte)(i >> 40);
            buffer[3] = (byte)(i >> 32);
            buffer[4] = (byte)(i >> 24);
            buffer[5] = (byte)(i >> 16);
            buffer[6] = (byte)(i >> 8);
            buffer[7] = (byte)(i);
            WriteBuffer(8);
        }

        private byte[] buffer = new byte[8];
        private void WriteBuffer(int n)
        {
            OutStream.Write(buffer, 0, n);
        }


-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p26016912.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From sjaday at gmail.com  Thu Oct 22 21:50:52 2009
From: sjaday at gmail.com (Stephen Day)
Date: Thu, 22 Oct 2009 13:50:52 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4AE0A585.1020701@lshift.net>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>
	<4AD59AAA.4060703@lshift.net> <4AD5A1F3.1050108@lshift.net>
	<4d376de30910141231v3954a376y86cb245e449f573a@mail.gmail.com>
	<167204d20910150233u3c9d5615k93ddbc681b166d8c@mail.gmail.com>
	<4d376de30910151508s46f73efbrf2025ffe2dc785e@mail.gmail.com>
	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>
	<4AE01D24.8020704@lshift.net>
	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
	<4AE0A585.1020701@lshift.net>
Message-ID: <4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>

Unfortunately, the system has crashed since the last outputs I provided, but
the behavior remains. There definitely seems to be some memory held up in
the persister, but I dont think this is the main source. Below, I printed
out the memory for the process, gc'd it, then printed it again:

1> process_info(whereis(rabbit_persister)).
[{registered_name,rabbit_persister},
 {current_function,{gen_server2,process_next_msg,8}},
 {initial_call,{proc_lib,init_p,5}},
 {status,waiting},
 {message_queue_len,0},
 {messages,[]},
 {links,[<0.76.0>,<0.188.0>]},
 {dictionary,[{'$ancestors',[rabbit_sup,<0.75.0>]},
              {'$initial_call',{rabbit_persister,init,1}}]},
 {trap_exit,true},
 {error_handler,error_handler},
 {priority,normal},
 {group_leader,<0.74.0>},
 {total_heap_size,43398670},
 {heap_size,5135590},
 {stack_size,13},
 {reductions,128289510},
 {garbage_collection,[{fullsweep_after,65535},
                      {minor_gcs,49}]},
 {suspending,[]}]
2> garbage_collect(whereis(rabbit_persister)).
true
3> process_info(whereis(rabbit_persister)).
[{registered_name,rabbit_persister},
 {current_function,{gen_server2,process_next_msg,8}},
 {initial_call,{proc_lib,init_p,5}},
 {status,waiting},
 {message_queue_len,0},
 {messages,[]},
 {links,[<0.76.0>,<0.188.0>]},
 {dictionary,[{'$ancestors',[rabbit_sup,<0.75.0>]},
              {'$initial_call',{rabbit_persister,init,1}}]},
 {trap_exit,true},
 {error_handler,error_handler},
 {priority,normal},
 {group_leader,<0.74.0>},
 {total_heap_size,987},
 {heap_size,610},
 {stack_size,13},
 {reductions,133572480},
 {garbage_collection,[{fullsweep_after,65535},{minor_gcs,6}]},
 {suspending,[]}]

So, even the though this collected quite a bit of memory, we can see that
the binary allocation is still large:

4> memory().
[{total,906056008},
 {processes,72681252},
 {processes_used,72668564},
 {system,833374756},
 {atom,515733},
 {atom_used,490081},
 {binary,769103232},
 {code,3890441},
 {ets,58694668}]

Is there a way I can print the allocators for this binary memory?

-Stephen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091022/568e9637/attachment.htm 

From sjaday at gmail.com  Thu Oct 22 22:22:44 2009
From: sjaday at gmail.com (Stephen Day)
Date: Thu, 22 Oct 2009 14:22:44 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>
	<4AD5A1F3.1050108@lshift.net>
	<4d376de30910141231v3954a376y86cb245e449f573a@mail.gmail.com>
	<167204d20910150233u3c9d5615k93ddbc681b166d8c@mail.gmail.com>
	<4d376de30910151508s46f73efbrf2025ffe2dc785e@mail.gmail.com>
	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>
	<4AE01D24.8020704@lshift.net>
	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
	<4AE0A585.1020701@lshift.net>
	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
Message-ID: <4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>

As a light experiment, to isolate garbage collection, I ran this:

4> memory().
[{total,367371832},
 {processes,139434000},
 {processes_used,139430112},
 {system,227937832},
 {atom,514765},
 {atom_used,488348},
 {binary,157628784},
 {code,3880064},
 {ets,64744732}]

(rabbit at vs-dfw-ctl11)5> [erlang:garbage_collect(P) || P <-
erlang:processes()].
[true,true,true,true,true,true,true,true,true,true,true,
 true,true,true,true,true,true,true,true,true,true,true,true,
 true,true,true,true,true,true|...]

(rabbit at vs-dfw-ctl11)6>
memory().
[{total,145833144},
 {processes,50900752},
 {processes_used,50896864},
 {system,94932392},
 {atom,514765},
 {atom_used,488348},
 {binary,24622512},
 {code,3880064},
 {ets,64745716}]

This really cut down on usage, so its likely that the binary gc is falling
behind rabbits requirements. How do I track down the uncollected binary heap
usage to a process?

_steve

On Thu, Oct 22, 2009 at 1:50 PM, Stephen Day <sjaday at gmail.com> wrote:

> Unfortunately, the system has crashed since the last outputs I provided,
> but the behavior remains. There definitely seems to be some memory held up
> in the persister, but I dont think this is the main source. Below, I printed
> out the memory for the process, gc'd it, then printed it again:
>
> 1> process_info(whereis(rabbit_persister)).
> [{registered_name,rabbit_persister},
>  {current_function,{gen_server2,process_next_msg,8}},
>  {initial_call,{proc_lib,init_p,5}},
>  {status,waiting},
>  {message_queue_len,0},
>  {messages,[]},
>  {links,[<0.76.0>,<0.188.0>]},
>  {dictionary,[{'$ancestors',[rabbit_sup,<0.75.0>]},
>               {'$initial_call',{rabbit_persister,init,1}}]},
>  {trap_exit,true},
>  {error_handler,error_handler},
>  {priority,normal},
>  {group_leader,<0.74.0>},
>  {total_heap_size,43398670},
>  {heap_size,5135590},
>  {stack_size,13},
>  {reductions,128289510},
>  {garbage_collection,[{fullsweep_after,65535},
>                       {minor_gcs,49}]},
>  {suspending,[]}]
> 2> garbage_collect(whereis(rabbit_persister)).
> true
> 3> process_info(whereis(rabbit_persister)).
> [{registered_name,rabbit_persister},
>  {current_function,{gen_server2,process_next_msg,8}},
>  {initial_call,{proc_lib,init_p,5}},
>  {status,waiting},
>  {message_queue_len,0},
>  {messages,[]},
>  {links,[<0.76.0>,<0.188.0>]},
>  {dictionary,[{'$ancestors',[rabbit_sup,<0.75.0>]},
>               {'$initial_call',{rabbit_persister,init,1}}]},
>  {trap_exit,true},
>  {error_handler,error_handler},
>  {priority,normal},
>  {group_leader,<0.74.0>},
>  {total_heap_size,987},
>  {heap_size,610},
>  {stack_size,13},
>  {reductions,133572480},
>  {garbage_collection,[{fullsweep_after,65535},{minor_gcs,6}]},
>  {suspending,[]}]
>
> So, even the though this collected quite a bit of memory, we can see that
> the binary allocation is still large:
>
> 4> memory().
> [{total,906056008},
>  {processes,72681252},
>  {processes_used,72668564},
>  {system,833374756},
>  {atom,515733},
>  {atom_used,490081},
>  {binary,769103232},
>  {code,3890441},
>  {ets,58694668}]
>
> Is there a way I can print the allocators for this binary memory?
>
> -Stephen
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091022/181c1537/attachment.htm 

From matthias at lshift.net  Fri Oct 23 00:05:06 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 23 Oct 2009 00:05:06 +0100
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <26016750.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com>
	<4ADD5443.6080701@lshift.net>	<25986856.post@talk.nabble.com>
	<4ADEBB64.8060605@lshift.net>	<25997030.post@talk.nabble.com>
	<4AE06973.6010802@lshift.net> <26016750.post@talk.nabble.com>
Message-ID: <4AE0E522.4070103@lshift.net>

David,

David Glaubman wrote:
> Buffering the int/short Writes in a modified version of NetworkBinaryWriter, 
> I got around 7.5K messages per sec.:  (5X speedup)

The lack of buffering in the .net client is an issue we noticed a while 
ago and we filed a bug to look into it. Our results at the time didn't 
show as dramatic a difference as your tests. I've increased the severity 
of that bug now, so we'll address it sooner.

Is this a showstopper for you or is the performance as it stands 
sufficient for your intended use case?

Thanks for your help in tracking this down.


Regards,

Matthias.



From matthias at lshift.net  Fri Oct 23 00:24:11 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 23 Oct 2009 00:24:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>	<4AD5A1F3.1050108@lshift.net>	<4d376de30910141231v3954a376y86cb245e449f573a@mail.gmail.com>	<167204d20910150233u3c9d5615k93ddbc681b166d8c@mail.gmail.com>	<4d376de30910151508s46f73efbrf2025ffe2dc785e@mail.gmail.com>	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>	<4AE01D24.8020704@lshift.net>	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>	<4AE0A585.1020701@lshift.net>	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
Message-ID: <4AE0E99B.7040300@lshift.net>

Stephen,

Stephen Day wrote:
> (rabbit at vs-dfw-ctl11)5> [erlang:garbage_collect(P) || P <- 
> erlang:processes()].
> [true,true,true,true,true,true,true,true,true,true,true,
>  true,true,true,true,true,true,true,true,true,true,true,true,
>  true,true,true,true,true,true|...]
> 
> (rabbit at vs-dfw-ctl11)6> 
> memory().                                             
> [{total,145833144},
>  {processes,50900752},
>  {processes_used,50896864},
>  {system,94932392},
>  {atom,514765},
>  {atom_used,488348},
>  {binary,24622512},
>  {code,3880064},
>  {ets,64745716}]
> 
> This really cut down on usage, so its likely that the binary gc is 
> falling behind rabbits requirements.

Agreed.

> How do I track down the uncollected binary heap usage to a process?

Binaries are shared between processes and ref counted, so no single 
process owns them. There is a process_info item called 'binary' that 
provides information on the binaries referenced by a process, but I've 
never looked at that myself, so don't know how useful the contained info is.

One thing you could try is to run the above garbage_collect code 
interleaved with the memory reporting code to identify which process 
results in the biggest drop in memory memory usage when gc'ed.


Regards,

Matthias.



From sjaday at gmail.com  Fri Oct 23 01:47:50 2009
From: sjaday at gmail.com (Stephen Day)
Date: Thu, 22 Oct 2009 17:47:50 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4AE0E99B.7040300@lshift.net>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>
	<167204d20910150233u3c9d5615k93ddbc681b166d8c@mail.gmail.com>
	<4d376de30910151508s46f73efbrf2025ffe2dc785e@mail.gmail.com>
	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>
	<4AE01D24.8020704@lshift.net>
	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
	<4AE0A585.1020701@lshift.net>
	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
	<4AE0E99B.7040300@lshift.net>
Message-ID: <4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>

I won't bore you with all the output, but I tracked down the binary usage to
these two processes:

[{Pid1, _Info, _Bin}, {Pid2, _Info2, _Bin2} | Other ] = [{P,
process_info(P), BinInfo} || {P, {binary, BinInfo}} <- [{P, process_info(P,
binary)} || P <- processes()], length(BinInfo) > 100000].

<0.157.0>             gen:init_it/6                      1682835  1873131
0
                      gen_server2:process_next_msg/8
13
<0.158.0>             rabbit_persister:init/1           19590700 29789397
0
rabbit_persister      gen_server2:process_next_msg/8
13

I tried your suggestion to free memory and check, but it looks most was held
up in the persister:

35> M = [{erlang:garbage_collect(P), memory(total)} || P <-
erlang:processes()].

51> [{P,Mem} || {Mem, P} <- lists:zip( [Me||{true, Me} <- M], processes()),
Mem < 842757048].
[{<0.148.0>,842753448},
 {<0.149.0>,842700248},
 {<0.150.0>,842700248},
 {<0.151.0>,842700248},
 {<0.152.0>,842697224},
 {<0.154.0>,842697792},
 {<0.155.0>,842724104},
 {<0.156.0>,842712824},
 {<0.157.0>,825951032},
 {<0.158.0>,602886872},
 {<0.159.0>,345002144},
 {<0.177.0>,345002144},
 {<0.178.0>,345002144},
 {<0.179.0>,345002144},
 {<0.180.0>,345002144},
 {<0.181.0>,345002144},
 {<0.182.0>,345002144},
 {<0.183.0>,345002144},
 {<0.184.0>,345002144},
 {<0.245.0>,345000624},
 {<0.247.0>,345001520},
 {<0.248.0>,344996984},
 {<0.249.0>,344995464},
 {<0.250.0>,344995512},
 {<0.252.0>,344996416},
 {<0.253.0>,344991880},
 {<0.254.0>,344991928},
 {<0.261.0>,...},
 {...}|...]

So it looks like the large chunks are held up between between gen_server2
and rabbit_persister.

_steve

On Thu, Oct 22, 2009 at 4:24 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Stephen,
>
> Stephen Day wrote:
>
>> (rabbit at vs-dfw-ctl11)5> [erlang:garbage_collect(P) || P <-
>> erlang:processes()].
>> [true,true,true,true,true,true,true,true,true,true,true,
>>  true,true,true,true,true,true,true,true,true,true,true,true,
>>  true,true,true,true,true,true|...]
>>
>> (rabbit at vs-dfw-ctl11)6> memory().
>>     [{total,145833144},
>>  {processes,50900752},
>>  {processes_used,50896864},
>>  {system,94932392},
>>  {atom,514765},
>>  {atom_used,488348},
>>  {binary,24622512},
>>  {code,3880064},
>>  {ets,64745716}]
>>
>> This really cut down on usage, so its likely that the binary gc is falling
>> behind rabbits requirements.
>>
>
> Agreed.
>
>  How do I track down the uncollected binary heap usage to a process?
>>
>
> Binaries are shared between processes and ref counted, so no single process
> owns them. There is a process_info item called 'binary' that provides
> information on the binaries referenced by a process, but I've never looked
> at that myself, so don't know how useful the contained info is.
>
> One thing you could try is to run the above garbage_collect code
> interleaved with the memory reporting code to identify which process results
> in the biggest drop in memory memory usage when gc'ed.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091022/70f3fc7f/attachment.htm 

From sjaday at gmail.com  Fri Oct 23 01:55:32 2009
From: sjaday at gmail.com (Stephen Day)
Date: Thu, 22 Oct 2009 17:55:32 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>
	<4d376de30910151508s46f73efbrf2025ffe2dc785e@mail.gmail.com>
	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>
	<4AE01D24.8020704@lshift.net>
	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
	<4AE0A585.1020701@lshift.net>
	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
	<4AE0E99B.7040300@lshift.net>
	<4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
Message-ID: <4d376de30910221755k4d2950dax166ec95b0811ab5f@mail.gmail.com>

I am not quite sure on the function evaluation order, but it might help to
know that <0.159.0> is the disk_log process:

<0.159.0>             disk_log:init/2                       1597   879997
0
                      disk_log:loop/1
4

_steve

On Thu, Oct 22, 2009 at 5:47 PM, Stephen Day <sjaday at gmail.com> wrote:

> I won't bore you with all the output, but I tracked down the binary usage
> to these two processes:
>
> [{Pid1, _Info, _Bin}, {Pid2, _Info2, _Bin2} | Other ] = [{P,
> process_info(P), BinInfo} || {P, {binary, BinInfo}} <- [{P, process_info(P,
> binary)} || P <- processes()], length(BinInfo) > 100000].
>
> <0.157.0>             gen:init_it/6                      1682835
> 1873131    0
>                       gen_server2:process_next_msg/8
> 13
> <0.158.0>             rabbit_persister:init/1           19590700
> 29789397    0
> rabbit_persister      gen_server2:process_next_msg/8
> 13
>
> I tried your suggestion to free memory and check, but it looks most was
> held up in the persister:
>
> 35> M = [{erlang:garbage_collect(P), memory(total)} || P <-
> erlang:processes()].
>
> 51> [{P,Mem} || {Mem, P} <- lists:zip( [Me||{true, Me} <- M], processes()),
> Mem < 842757048].
> [{<0.148.0>,842753448},
>  {<0.149.0>,842700248},
>  {<0.150.0>,842700248},
>  {<0.151.0>,842700248},
>  {<0.152.0>,842697224},
>  {<0.154.0>,842697792},
>  {<0.155.0>,842724104},
>  {<0.156.0>,842712824},
>  {<0.157.0>,825951032},
>  {<0.158.0>,602886872},
>  {<0.159.0>,345002144},
>  {<0.177.0>,345002144},
>  {<0.178.0>,345002144},
>  {<0.179.0>,345002144},
>  {<0.180.0>,345002144},
>  {<0.181.0>,345002144},
>  {<0.182.0>,345002144},
>  {<0.183.0>,345002144},
>  {<0.184.0>,345002144},
>  {<0.245.0>,345000624},
>  {<0.247.0>,345001520},
>  {<0.248.0>,344996984},
>  {<0.249.0>,344995464},
>  {<0.250.0>,344995512},
>  {<0.252.0>,344996416},
>  {<0.253.0>,344991880},
>  {<0.254.0>,344991928},
>  {<0.261.0>,...},
>  {...}|...]
>
> So it looks like the large chunks are held up between between gen_server2
> and rabbit_persister.
>
> _steve
>
>
> On Thu, Oct 22, 2009 at 4:24 PM, Matthias Radestock <matthias at lshift.net>wrote:
>
>> Stephen,
>>
>> Stephen Day wrote:
>>
>>> (rabbit at vs-dfw-ctl11)5> [erlang:garbage_collect(P) || P <-
>>> erlang:processes()].
>>> [true,true,true,true,true,true,true,true,true,true,true,
>>>  true,true,true,true,true,true,true,true,true,true,true,true,
>>>  true,true,true,true,true,true|...]
>>>
>>> (rabbit at vs-dfw-ctl11)6> memory().
>>>       [{total,145833144},
>>>  {processes,50900752},
>>>  {processes_used,50896864},
>>>  {system,94932392},
>>>  {atom,514765},
>>>  {atom_used,488348},
>>>  {binary,24622512},
>>>  {code,3880064},
>>>  {ets,64745716}]
>>>
>>> This really cut down on usage, so its likely that the binary gc is
>>> falling behind rabbits requirements.
>>>
>>
>> Agreed.
>>
>>  How do I track down the uncollected binary heap usage to a process?
>>>
>>
>> Binaries are shared between processes and ref counted, so no single
>> process owns them. There is a process_info item called 'binary' that
>> provides information on the binaries referenced by a process, but I've never
>> looked at that myself, so don't know how useful the contained info is.
>>
>> One thing you could try is to run the above garbage_collect code
>> interleaved with the memory reporting code to identify which process results
>> in the biggest drop in memory memory usage when gc'ed.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091022/9d90bf03/attachment.htm 

From simon.hegarty at jeppesen.com  Fri Oct 23 02:02:18 2009
From: simon.hegarty at jeppesen.com (simon hegarty)
Date: Thu, 22 Oct 2009 18:02:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <4AE0E522.4070103@lshift.net>
References: <4AE0E522.4070103@lshift.net>
Message-ID: <26019121.post@talk.nabble.com>



Matthias Radestock-2 wrote:
> 
> Is this a showstopper for you or is the performance as it stands 
> sufficient for your intended use case?
> 

I'm yet another user looking to replace MSMQ, looking at AMQP with .net -
rabbit in particular

I am to begin, shortly, a performance evaluation along the lines David has
and have been following this thread with a degree of alarm.

It'll be easier to convince people to change to rabbit if I can produce
statistics showing strong performance compared to MSMQ.

Is there any way the required changes could be made available sooner rather
than later?

Thanks
simon



-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p26019121.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From Franck.Boisson at mlp.com  Fri Oct 23 03:34:44 2009
From: Franck.Boisson at mlp.com (Boisson, Franck)
Date: Fri, 23 Oct 2009 10:34:44 +0800
Subject: [rabbitmq-discuss] Java API V1.6.0 - Performance problem with
	basicConsume and dynamic bindings
In-Reply-To: <4AE06C62.7020303@lshift.net>
References: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>
	<4AE06C62.7020303@lshift.net>
Message-ID: <1590A5C25AF3E9438F4232897EEFA514D816B5@EXCHSI001.AD.MLP.COM>

> Does the consumer stop receiving messages altogether or does it just
slow down?
Consumer does not stop receiving messages but I see that the number of
messages waiting in the queue is growing.

> Do either the client or server max out the CPU?
No, CPU is normal (less that 10% is used)

> Does the binding creation continue to proceed after the point when you
observe the listener falling behind?
Yes it continues. By the way, binding creation take some time so I
created a kind of "administration channel pool" associated to a separate
connection taking only care of that

> How many bindings are you creating in total?
I am creating 1695 bindings in total

Regards
Franck
######################################################################
The information contained in this communication is confidential and
may contain information that is privileged or exempt from disclosure
under applicable law. If you are not a named addressee, please notify
the sender immediately and delete this email from your system.
If you have received this communication, and are not a named
recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited.
######################################################################



From dglaubman at acm.org  Fri Oct 23 04:04:04 2009
From: dglaubman at acm.org (David Glaubman)
Date: Thu, 22 Oct 2009 20:04:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <4AE0E522.4070103@lshift.net>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
	<25986856.post@talk.nabble.com> <4ADEBB64.8060605@lshift.net>
	<25997030.post@talk.nabble.com> <4AE06973.6010802@lshift.net>
	<26016750.post@talk.nabble.com> <4AE0E522.4070103@lshift.net>
Message-ID: <26020282.post@talk.nabble.com>


Not a showstopper, since with the partial fix, Rabbit should be sufficient to
show feasibility of the approach.

Still, sooner is better than later, and I hope you folks will take a close
look at network performance on .Net/Windows, since it seems to differ from
Mono (or even Java on Windows).

I also think it may be worthwhile to consider programming against Socket
interface rather than TCPClient to maximize performance.

(just my 0.01334 Euros.)

David



Matthias Radestock-2 wrote:
> 
> David,
> 
> David Glaubman wrote:
>> Buffering the int/short Writes in a modified version of
>> NetworkBinaryWriter, 
>> I got around 7.5K messages per sec.:  (5X speedup)
> 
> The lack of buffering in the .net client is an issue we noticed a while 
> ago and we filed a bug to look into it. Our results at the time didn't 
> show as dramatic a difference as your tests. I've increased the severity 
> of that bug now, so we'll address it sooner.
> 
> Is this a showstopper for you or is the performance as it stands 
> sufficient for your intended use case?
> 
> Thanks for your help in tracking this down.
> 
> 
> Regards,
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p26020282.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Fri Oct 23 07:54:49 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 23 Oct 2009 07:54:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>	<167204d20910150233u3c9d5615k93ddbc681b166d8c@mail.gmail.com>	<4d376de30910151508s46f73efbrf2025ffe2dc785e@mail.gmail.com>	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>	<4AE01D24.8020704@lshift.net>	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>	<4AE0A585.1020701@lshift.net>	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>	<4AE0E99B.7040300@lshift.net>
	<4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
Message-ID: <4AE15339.10801@lshift.net>

Stephen,

Stephen Day wrote:
> I won't bore you with all the output, but I tracked down the binary 
> usage to these two processes:
> 
> [{Pid1, _Info, _Bin}, {Pid2, _Info2, _Bin2} | Other ] = [{P, 
> process_info(P), BinInfo} || {P, {binary, BinInfo}} <- [{P, 
> process_info(P, binary)} || P <- processes()], length(BinInfo) > 100000].
> 
> <0.157.0>             gen:init_it/6                      1682835  
> 1873131    0
>                       gen_server2:process_next_msg/8          

Do you know what that process is? process_info(P) may have some clues to 
figure that out.

>  {<0.157.0>,825951032},
>  {<0.158.0>,602886872},
>  {<0.159.0>,345002144},

Right, so that's some mystery process (probably a queue), the persister 
and disk_log. We may have to force a more aggressive gc strategy on the 
latter two.


Regards,

Matthias.



From alexis.richardson at gmail.com  Fri Oct 23 09:49:57 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 23 Oct 2009 09:49:57 +0100
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <26020282.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
	<25986856.post@talk.nabble.com> <4ADEBB64.8060605@lshift.net>
	<25997030.post@talk.nabble.com> <4AE06973.6010802@lshift.net>
	<26016750.post@talk.nabble.com> <4AE0E522.4070103@lshift.net>
	<26020282.post@talk.nabble.com>
Message-ID: <167204d20910230149u40d849a8l625e85890cac1aaa@mail.gmail.com>

On Fri, Oct 23, 2009 at 4:04 AM, David Glaubman <dglaubman at acm.org> wrote:
>
> Not a showstopper, since with the partial fix, Rabbit should be sufficient to
> show feasibility of the approach.
>
> Still, sooner is better than later, and I hope you folks will take a close
> look at network performance on .Net/Windows, since it seems to differ from
> Mono (or even Java on Windows).

Understood.


> I also think it may be worthwhile to consider programming against Socket
> interface rather than TCPClient to maximize performance.

Is that something you could have a crack at?

alexis



> (just my 0.01334 Euros.)
>
> David
>
>
>
> Matthias Radestock-2 wrote:
>>
>> David,
>>
>> David Glaubman wrote:
>>> Buffering the int/short Writes in a modified version of
>>> NetworkBinaryWriter,
>>> I got around 7.5K messages per sec.: ?(5X speedup)
>>
>> The lack of buffering in the .net client is an issue we noticed a while
>> ago and we filed a bug to look into it. Our results at the time didn't
>> show as dramatic a difference as your tests. I've increased the severity
>> of that bug now, so we'll address it sooner.
>>
>> Is this a showstopper for you or is the performance as it stands
>> sufficient for your intended use case?
>>
>> Thanks for your help in tracking this down.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p26020282.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From Alister.Morton at tradition.com  Fri Oct 23 10:30:37 2009
From: Alister.Morton at tradition.com (Alister Morton)
Date: Fri, 23 Oct 2009 10:30:37 +0100
Subject: [rabbitmq-discuss] Monitoring RabbitMQ with
	rabbitmqctl	list_queues
In-Reply-To: <af1bce590910221109q65dca197qec12ac46a0cbcfb6@mail.gmail.com>
References: <b51ebe1c0910221104g22693451s244360bf9131f14a@mail.gmail.com>
	<af1bce590910221109q65dca197qec12ac46a0cbcfb6@mail.gmail.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066EED033D29@SVR-2K3-BH-EMC.tradition.int>

Unfortunately it's a bit opaque to a windows user like me.

I understand our office which is currently using Rabbit has looked at monitoring and is now leaning toward other message brokers precisely because they offer comprehensive monitoring out of the box. I'm fairly sure they've /looked/ at alice too

We're running our stuff on windows servers.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
Sent: 22 October 2009 19:09
To: Ryan Berdeen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Monitoring RabbitMQ with rabbitmqctl list_queues

You should check out Alice:

http://github.com/auser/alice

On Thu, Oct 22, 2009 at 2:04 PM, Ryan Berdeen <ryan at echonest.com> wrote:
> Hi,
>
> I have a simple realtime monitor for RabbitMQ that displays the list
> of several queues, and updates every second.
>
> I'd like to use "rabbitmqctl list_queues" to do this, as it sounds
> like it would be a lot easier than my current solution, which is to
> use the Python amqp client to get the queue length.
>
> Will running this every second have an impact on performance or
> otherwise be a bad idea? Is there a different solution I should
> consider?
>
> Thanks,
>
> Ryan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


 Click https://www.mailcontrol.com/sr/OHMRo!j3l0zTndxI!oX7UuzsNXr4lLvtuoEAeVPO2jHoy8qUWhxzdvTGDAYwos2DV0j1AIkJyVOOd!jBVaBGJg==  to report this email as spam.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From alexis.richardson at gmail.com  Fri Oct 23 10:35:48 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 23 Oct 2009 10:35:48 +0100
Subject: [rabbitmq-discuss] Monitoring RabbitMQ with rabbitmqctl
	list_queues
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891066EED033D29@SVR-2K3-BH-EMC.tradition.int>
References: <b51ebe1c0910221104g22693451s244360bf9131f14a@mail.gmail.com>
	<af1bce590910221109q65dca197qec12ac46a0cbcfb6@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E7891066EED033D29@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <167204d20910230235t742b8c9ep57f77b9325b35768@mail.gmail.com>

Alister,

Would it be possible to describe the comprehensive monitoring that you
need please?

alexis


On Fri, Oct 23, 2009 at 10:30 AM, Alister Morton
<Alister.Morton at tradition.com> wrote:
> Unfortunately it's a bit opaque to a windows user like me.
>
> I understand our office which is currently using Rabbit has looked at monitoring and is now leaning toward other message brokers precisely because they offer comprehensive monitoring out of the box. I'm fairly sure they've /looked/ at alice too
>
> We're running our stuff on windows servers.
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
> Sent: 22 October 2009 19:09
> To: Ryan Berdeen
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Monitoring RabbitMQ with rabbitmqctl list_queues
>
> You should check out Alice:
>
> http://github.com/auser/alice
>
> On Thu, Oct 22, 2009 at 2:04 PM, Ryan Berdeen <ryan at echonest.com> wrote:
>> Hi,
>>
>> I have a simple realtime monitor for RabbitMQ that displays the list
>> of several queues, and updates every second.
>>
>> I'd like to use "rabbitmqctl list_queues" to do this, as it sounds
>> like it would be a lot easier than my current solution, which is to
>> use the Python amqp client to get the queue length.
>>
>> Will running this every second have an impact on performance or
>> otherwise be a bad idea? Is there a different solution I should
>> consider?
>>
>> Thanks,
>>
>> Ryan
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ?Click https://www.mailcontrol.com/sr/OHMRo!j3l0zTndxI!oX7UuzsNXr4lLvtuoEAeVPO2jHoy8qUWhxzdvTGDAYwos2DV0j1AIkJyVOOd!jBVaBGJg== ?to report this email as spam.
>
> The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tim at cloudspace.com  Fri Oct 23 11:58:01 2009
From: tim at cloudspace.com (Tim Rosenblatt)
Date: Fri, 23 Oct 2009 06:58:01 -0400
Subject: [rabbitmq-discuss] RabbitMQ randomly dying under Ubuntu 9.04
In-Reply-To: <4ADC807A.7090108@lshift.net>
References: <381842ac0910160811v304e6fddqdd7ff69c4a3b43c8@mail.gmail.com> 
	<4ADC807A.7090108@lshift.net>
Message-ID: <381842ac0910230358r6f3f7b33xf5c2b431861b133d@mail.gmail.com>

Hey Matthias, thanks for the comment. The queues are small, usually 5-15k
items, never more than 50k. I seem to be getting a lot less errors since
I've decreased the number of workers connecting to RabbitMQ. 12 seems to be
OK, 20 does not. Any suggestions on how to increase this limit, as I'm going
to have to add workers as this project grows.

-- Tim

On Mon, Oct 19, 2009 at 11:06 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Tim,
>
> Tim Rosenblatt wrote:
> > How can i debug a rabbitmq server that randomly dies/stops accepting
> > connections? I'm running off ubuntu and installed via apt-get. Usually
> > when restarting, it's the persister that won't restart. The current
> > solution is to delete the contents of /var/lib/rabbmq, but that feels
> > like a hack and not a solution.
>
> I recommend running 'rabbitmqctl list_queues' to get an idea of how many
> messages are in the queues. You are probably feeding rabbit with more
> messages than it can stomach.
>
>
> Regards,
>
> Matthias.
>



-- 
Tim Rosenblatt
Cloudspace
Office: 407-823-8808
Cell: 407-719-2777

10244 E Colonial Dr, Suite 106
Orlando, FL 32817
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091023/bea4ac1a/attachment.htm 

From matthew at lshift.net  Fri Oct 23 12:02:07 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 23 Oct 2009 12:02:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ randomly dying under Ubuntu 9.04
In-Reply-To: <381842ac0910230358r6f3f7b33xf5c2b431861b133d@mail.gmail.com>
References: <381842ac0910160811v304e6fddqdd7ff69c4a3b43c8@mail.gmail.com>
	<4ADC807A.7090108@lshift.net>
	<381842ac0910230358r6f3f7b33xf5c2b431861b133d@mail.gmail.com>
Message-ID: <20091023110205.GA22262@mrnibble.lshift.net>

Hi Tim,

On Fri, Oct 23, 2009 at 06:58:01AM -0400, Tim Rosenblatt wrote:
> Hey Matthias, thanks for the comment. The queues are small, usually 5-15k
> items, never more than 50k. I seem to be getting a lot less errors since
> I've decreased the number of workers connecting to RabbitMQ. 12 seems to be
> OK, 20 does not. Any suggestions on how to increase this limit, as I'm going
> to have to add workers as this project grows.

What kind of throughput rates are you using, how big are your messages
and are you using any sort of persistence? Also, what kind of error
messages do you see when clients are trying to connect?

Matthew



From david.wragg at lshift.net  Fri Oct 23 12:14:32 2009
From: david.wragg at lshift.net (David Wragg)
Date: Fri, 23 Oct 2009 12:14:32 +0100
Subject: [rabbitmq-discuss] 100% CPU usage and system crawls to a halt
In-Reply-To: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>
	(Mark Nutter's message of "Wed\, 21 Oct 2009 20\:57\:02 -0500")
References: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>
Message-ID: <k54opqnyzr.fsf@mrbraver.lshift.net>

Mark Nutter <marknutter at gmail.com> writes:
> Is 1.7 a better option and is there a stable package out there
> that works on Hardy?

We provide an APT repostory containing Debian packages for the latest
version of rabbitmq-server, making it quite easy to try 1.7 on Hardy.
See <http://www.rabbitmq.com/debian.html#apt>.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From marknutter at gmail.com  Fri Oct 23 16:17:23 2009
From: marknutter at gmail.com (Mark Nutter)
Date: Fri, 23 Oct 2009 10:17:23 -0500
Subject: [rabbitmq-discuss] 100% CPU usage and system crawls to a halt
In-Reply-To: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>
References: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>
Message-ID: <476587320910230817g1d55ff1cm575179ab28896932@mail.gmail.com>

Quick question:  is there a limit to the amount of exchanges you want to
create on a particular node?  For instance, thousands, even hundreds of
thousands of exchanges?  Thanks,

Mark

On Wed, Oct 21, 2009 at 8:57 PM, Mark Nutter <marknutter at gmail.com> wrote:

> I have rabbitMQ 1.6 on Hardy, and I'm running into an issue where the
> rabbitMQ process randomly will ramp up to 100% CPU usage and stay there.
> Once this happens, all message routing crawls to a near halt and the server
> has to be restarted.
> A quick overview of what I have it doing: I'm taking a firehose of Twitter
> statuses and throwing every single one of them into a main queue from which
> they are thrown into a mySQL database. These statuses also get routed to
> other smaller queues based on different routing keys like twitter user ids
> and URLs. These messages come in fast, about 1000 per 10 seconds, and we
> pull the messages off the queue about as fast as they come in.
>
> I've seen a few threads discussing the 100% CPU usage problem, but no real
> solutions.  Am I going about this the wrong way?  What might be causing this
> problem.  Is 1.7 a better option and is there a stable package out there
> that works on Hardy?  Thanks in advance for your input.
>
> --
> Mark Nutter
> marknutter at gmail.com
>



-- 
Mark Nutter
612-205-1388
marknutter at gmail.com
http://nuttersmark.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091023/98b262f0/attachment.htm 

From matthew at lshift.net  Fri Oct 23 16:55:19 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 23 Oct 2009 16:55:19 +0100
Subject: [rabbitmq-discuss] 100% CPU usage and system crawls to a halt
In-Reply-To: <476587320910230817g1d55ff1cm575179ab28896932@mail.gmail.com>
References: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>
	<476587320910230817g1d55ff1cm575179ab28896932@mail.gmail.com>
Message-ID: <20091023155519.GE22262@mrnibble.lshift.net>

On Fri, Oct 23, 2009 at 10:17:23AM -0500, Mark Nutter wrote:
> Quick question:  is there a limit to the amount of exchanges you want to
> create on a particular node?  For instance, thousands, even hundreds of
> thousands of exchanges?  Thanks,

The exchange is simply a record in memory. It's not especially big, but
it is a resource. Provided you don't run out of memory, there's no other
limiting factor. Of course, if each exchange has several bindings to
several queues and you end up with millions of queues then yes, you will
find that much harder to achieve, it's not impossible though, provided
you have juicy enough hardware.

Matthew



From 0x6e6562 at gmail.com  Fri Oct 23 17:14:19 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 23 Oct 2009 17:14:19 +0100
Subject: [rabbitmq-discuss] 100% CPU usage and system crawls to a halt
In-Reply-To: <20091023155519.GE22262@mrnibble.lshift.net>
References: <476587320910211857t19266e6aue40900e8555f6ea6@mail.gmail.com>
	<476587320910230817g1d55ff1cm575179ab28896932@mail.gmail.com>
	<20091023155519.GE22262@mrnibble.lshift.net>
Message-ID: <269388e30910230914q2ed1f2ddib03b38e8982cc390@mail.gmail.com>

Mark,

On Fri, Oct 23, 2009 at 4:55 PM, Matthew Sackman <matthew at lshift.net> wrote:
> On Fri, Oct 23, 2009 at 10:17:23AM -0500, Mark Nutter wrote:
>> Quick question: ?is there a limit to the amount of exchanges you want to
>> create on a particular node? ?For instance, thousands, even hundreds of
>> thousands of exchanges? ?Thanks,
>
> The exchange is simply a record in memory. It's not especially big, but
> it is a resource. Provided you don't run out of memory, there's no other
> limiting factor. Of course, if each exchange has several bindings to
> several queues and you end up with millions of queues then yes, you will
> find that much harder to achieve, it's not impossible though, provided
> you have juicy enough hardware.

FWIW there is article that briefly touches on this subject:
http://hopper.squarespace.com/blog/2008/11/7/measuring-scalability.html

Ben



From marknutter at gmail.com  Fri Oct 23 17:41:46 2009
From: marknutter at gmail.com (Mark Nutter)
Date: Fri, 23 Oct 2009 11:41:46 -0500
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a queue
Message-ID: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>

I'm attempting to get the number of messages that are in a queue.  I'm using
a consumer to pull messages from the queue.  I've tried using the
queueDeclare getMessageCount() function and that gives me the message count
*once* but every time after that it just gives me a message count of zero
back.  Any other way of finding it?  Is the consumer somehow messing things
up?  Thanks!

-- 
Mark Nutter
612-205-1388
marknutter at gmail.com
http://nuttersmark.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091023/c9c784e8/attachment.htm 

From matthew at lshift.net  Fri Oct 23 18:17:54 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 23 Oct 2009 18:17:54 +0100
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
 queue
In-Reply-To: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
Message-ID: <20091023171754.GA6672@mrnibble.lshift.net>

On Fri, Oct 23, 2009 at 11:41:46AM -0500, Mark Nutter wrote:
> I'm attempting to get the number of messages that are in a queue.  I'm using
> a consumer to pull messages from the queue.  I've tried using the
> queueDeclare getMessageCount() function and that gives me the message count
> *once* but every time after that it just gives me a message count of zero
> back.  Any other way of finding it?  Is the consumer somehow messing things
> up?  Thanks!

If the consumer has removed all the msgs from the queue, then the
queueDeclare msg count will indeed be 0. The queueDeclare msg count only
tells you the number of messages currently buffered in the queue.

Matthew



From marknutter at gmail.com  Fri Oct 23 18:59:46 2009
From: marknutter at gmail.com (Mark Nutter)
Date: Fri, 23 Oct 2009 12:59:46 -0500
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
	queue
In-Reply-To: <20091023171754.GA6672@mrnibble.lshift.net>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
	<20091023171754.GA6672@mrnibble.lshift.net>
Message-ID: <476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>

Ahh.. I see now. So is there a way to tell how many messages the consumer
currently has?

On Fri, Oct 23, 2009 at 12:17 PM, Matthew Sackman <matthew at lshift.net>wrote:

> On Fri, Oct 23, 2009 at 11:41:46AM -0500, Mark Nutter wrote:
> > I'm attempting to get the number of messages that are in a queue.  I'm
> using
> > a consumer to pull messages from the queue.  I've tried using the
> > queueDeclare getMessageCount() function and that gives me the message
> count
> > *once* but every time after that it just gives me a message count of zero
> > back.  Any other way of finding it?  Is the consumer somehow messing
> things
> > up?  Thanks!
>
> If the consumer has removed all the msgs from the queue, then the
> queueDeclare msg count will indeed be 0. The queueDeclare msg count only
> tells you the number of messages currently buffered in the queue.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Mark Nutter
612-205-1388
marknutter at gmail.com
http://nuttersmark.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091023/0fb81e2e/attachment.htm 

From matthias at lshift.net  Fri Oct 23 22:09:20 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 23 Oct 2009 22:09:20 +0100
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
 queue
In-Reply-To: <476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>	<20091023171754.GA6672@mrnibble.lshift.net>
	<476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>
Message-ID: <4AE21B80.7080607@lshift.net>

Mark,

Mark Nutter wrote:
> Ahh.. I see now. So is there a way to tell how many messages the 
> consumer currently has?

The server knows how many messages have been sent out to a consumer and 
not acknowledged yet, and you can see that count, per queue, in the 
messages_unacknowledged info item of 'rabbitmqctl list_queues'.

There is no way to get the same information via the protocol.

Regards,

Matthias.



From matthias at lshift.net  Fri Oct 23 22:20:13 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 23 Oct 2009 22:20:13 +0100
Subject: [rabbitmq-discuss] Java API V1.6.0 - Performance problem with
 basicConsume and dynamic bindings
In-Reply-To: <1590A5C25AF3E9438F4232897EEFA514D816B5@EXCHSI001.AD.MLP.COM>
References: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>	<4AE06C62.7020303@lshift.net>
	<1590A5C25AF3E9438F4232897EEFA514D816B5@EXCHSI001.AD.MLP.COM>
Message-ID: <4AE21E0D.6080505@lshift.net>

Franck,

Boisson, Franck wrote:
>> Does the consumer stop receiving messages altogether or does it just
> slow down?
> Consumer does not stop receiving messages but I see that the number of
> messages waiting in the queue is growing.

How are you observing the queue message counts? Via 'rabbitmqctl 
list_queues'? If so, what does the breakdown into messages_ready, 
messages_unacknowledged and messages_uncommited show?

>> Do either the client or server max out the CPU?
> No, CPU is normal (less that 10% is used)

That's very odd. Can you post some code to reproduce this behaviour? 
Also, it would safe time if you repeated the tests on the 1.7.0 client 
and server.


Regards,

Matthias



From Franck.Boisson at mlp.com  Sat Oct 24 08:03:42 2009
From: Franck.Boisson at mlp.com (Boisson, Franck)
Date: Sat, 24 Oct 2009 15:03:42 +0800
Subject: [rabbitmq-discuss] Java API V1.6.0 - Performance problem with
	basicConsume and dynamic bindings
In-Reply-To: <4AE21E0D.6080505@lshift.net>
References: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>	<4AE06C62.7020303@lshift.net>
	<1590A5C25AF3E9438F4232897EEFA514D816B5@EXCHSI001.AD.MLP.COM>
	<4AE21E0D.6080505@lshift.net>
Message-ID: <1590A5C25AF3E9438F4232897EEFA514CF3030@EXCHSI001.AD.MLP.COM>

> How are you observing the queue message counts? Via 'rabbitmqctl 
> list_queues'? If so, what does the breakdown into messages_ready, 
> messages_unacknowledged and messages_uncommited show?
Yes I am observing the queue message counts via 'rabbitmqctl
list_queues' and when I ask for the options you metion, all the messages
in the queue are in the messages_ready part.

> That's very odd. Can you post some code to reproduce this behaviour? 
> Also, it would safe time if you repeated the tests on the 1.7.0 client

> and server.
Will be hard to provide some peace of code because I have now my own
library encapsulating yours but I will try.
About 1.7.0, I have just done the test and problem remain the same.

Regards,

Franck
######################################################################
The information contained in this communication is confidential and
may contain information that is privileged or exempt from disclosure
under applicable law. If you are not a named addressee, please notify
the sender immediately and delete this email from your system.
If you have received this communication, and are not a named
recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited.
######################################################################



From matthias at lshift.net  Sat Oct 24 11:00:33 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 24 Oct 2009 11:00:33 +0100
Subject: [rabbitmq-discuss] Java API V1.6.0 - Performance problem with
 basicConsume and dynamic bindings
In-Reply-To: <1590A5C25AF3E9438F4232897EEFA514CF3030@EXCHSI001.AD.MLP.COM>
References: <1590A5C25AF3E9438F4232897EEFA514D816B2@EXCHSI001.AD.MLP.COM>	<4AE06C62.7020303@lshift.net>	<1590A5C25AF3E9438F4232897EEFA514D816B5@EXCHSI001.AD.MLP.COM>	<4AE21E0D.6080505@lshift.net>
	<1590A5C25AF3E9438F4232897EEFA514CF3030@EXCHSI001.AD.MLP.COM>
Message-ID: <4AE2D041.90009@lshift.net>

Franck,

Boisson, Franck wrote:
> Will be hard to provide some peace of code because I have now my own
> library encapsulating yours but I will try.

Another thing to try is to insert the tracer 
(http://www.rabbitmq.com/examples.html#tracer) between the client and 
server and inspect the result for any oddities. Feel free to post the 
output here.


Regards,

Matthias.



From mail at sebastian-latza.de  Mon Oct 26 16:04:52 2009
From: mail at sebastian-latza.de (Sebastian)
Date: Mon, 26 Oct 2009 17:04:52 +0100
Subject: [rabbitmq-discuss] Round-robin queue failover
In-Reply-To: <E1N0hRr-0000I0-TK@victory.heartlandliberty.org>
References: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>
	<4ADD504D.1080305@lshift.net>
	<E1N0hRr-0000I0-TK@victory.heartlandliberty.org>
Message-ID: <06A7EF6A-AE41-4FBC-8543-7AAC8ECABE7F@sebastian-latza.de>


Kyle Schaffrick:

> Attempting to create two identically-named queues will
> result in declaring the same queue twice; the two consumers then
> consuming from that queue will see load-balancing behavior.

Thanks for the clarification. Since this does not work: how do I  
achieve reliable persistent message delivery even if the one node  
holding the queue dies? As stated before my take would be to replicate  
queues client-side on independent brokers, but this seems to be  
getting quite complicated as the queues have to be "double-declared",  
linked and properly re-initialized on startup of a new empty broker  
(basically doing some kind of client-side clustering).

Regards
Sebastian



From allen.jones at quantumblack.com  Mon Oct 26 16:10:07 2009
From: allen.jones at quantumblack.com (Allen Jones)
Date: Mon, 26 Oct 2009 16:10:07 -0000
Subject: [rabbitmq-discuss] IBasicConsumer.HandleBasicDeliver threading
	behavior
Message-ID: <4ae5c9e1.1a135e0a.7793.6697@mx.google.com>

I have created my own implementation of IBasicConsumer. I just discovered
DefaultBasicConsumer, so I might start using that, but overall things are
working very well except the for the odd anomaly, which I am trying to sort
out. My question is also relevant to DefaultBasicConsumer as well.

 

The documentation makes it clear that the IBasicConsumer.HandleBasicDeliver
event handler is called on the connection's thread (i.e. single).  I just
wanted to confirm that the Model will only process messages one at a time
i.e. there is no chance that multiple HandleBasicDeliver calls will be
executed concurrently. Can somebody confirm? 

 

Regards

Allen Jones

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091026/de641431/attachment.htm 

From allen.jones at quantumblack.com  Mon Oct 26 16:15:30 2009
From: allen.jones at quantumblack.com (Allen Jones)
Date: Mon, 26 Oct 2009 16:15:30 -0000
Subject: [rabbitmq-discuss] Messages left in queue
Message-ID: <4ae5cb23.095c5e0a.5eee.ffffafc3@mx.google.com>

I am occasionally seeing messages stuck in queues (using 1.6).

 

I am ensuring I ACK any messages I receive and most of the time (hundreds of
thousands of messages) things are fine. But occasionally there are messages
stuck. 

 

It tends to be more in my dev environment than in production, so it could be
to do with tearing processes down in an unfriendly way. But I just wanted to
check if there are any known circumstances where messages might get stuck in
1.6?

 

Regards

Allen Jones

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091026/c0ba8be6/attachment.htm 

From alexis.richardson at gmail.com  Mon Oct 26 16:23:27 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 26 Oct 2009 16:23:27 +0000
Subject: [rabbitmq-discuss] Round-robin queue failover
In-Reply-To: <06A7EF6A-AE41-4FBC-8543-7AAC8ECABE7F@sebastian-latza.de>
References: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>
	<4ADD504D.1080305@lshift.net>
	<E1N0hRr-0000I0-TK@victory.heartlandliberty.org>
	<06A7EF6A-AE41-4FBC-8543-7AAC8ECABE7F@sebastian-latza.de>
Message-ID: <167204d20910260923g657d8414u6af072167fa01fcd@mail.gmail.com>

Sebastian

On Mon, Oct 26, 2009 at 4:04 PM, Sebastian <mail at sebastian-latza.de> wrote:
>
> Kyle Schaffrick:
>
>> Attempting to create two identically-named queues will
>> result in declaring the same queue twice; the two consumers then
>> consuming from that queue will see load-balancing behavior.
>
> Thanks for the clarification. Since this does not work: how do I
> achieve reliable persistent message delivery even if the one node
> holding the queue dies?

At the risk of being seen as pedantic...

You could achieve it by waiting for the node to recover from disk.  In
other words: RabbitMQ provides "eventual delivery" out of the box.  If
you want to 'persist more reliably' than on one drive using RabbitMQ
out of the box, then use a RAID or a SAN.

I am guessing that what you mean is *availability* in which a message
can always reach a suitable queue even if the sending client loses its
connection with the node that crashed.  The problem with using a
single node is the time it takes to recover, and client reconnection
costs (if any).  The time to recover is partly influenced by how much
state has to recover, and partly by the size of the unavailability
window that you can tolerate.

Many applications don't like to wait more than (say) 1ms, 10ms or 50ms
before they can send their message.  In this case you will typically
want to send a message *before* the crashed node has been able to
recover.  You can achieve this in two ways:

1. You don't care about replicating state and can use any other queue
as a 'suitable queue'.  This is easy - just make sure the right
consumers and routes are wired up.

2. You do care about replicating state - which I think is the case you
have in mind.  Then you can fail over to a passive server.  We can
provide some more info on this if you like -- we have done it for a
few people but it is not yet 'available OOTB'.  (You can also do
active/active but it is much more fiddly atm).



> As stated before my take would be to replicate
> queues client-side on independent brokers, but this seems to be
> getting quite complicated as the queues have to be "double-declared",
> linked and properly re-initialized on startup of a new empty broker
> (basically doing some kind of client-side clustering).

Right.  I think you probably want case 2 above.

alexis



> Regards
> Sebastian
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From mail at sebastian-latza.de  Mon Oct 26 16:49:57 2009
From: mail at sebastian-latza.de (Sebastian)
Date: Mon, 26 Oct 2009 17:49:57 +0100
Subject: [rabbitmq-discuss] Round-robin queue failover
In-Reply-To: <167204d20910260923g657d8414u6af072167fa01fcd@mail.gmail.com>
References: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>
	<4ADD504D.1080305@lshift.net>
	<E1N0hRr-0000I0-TK@victory.heartlandliberty.org>
	<06A7EF6A-AE41-4FBC-8543-7AAC8ECABE7F@sebastian-latza.de>
	<167204d20910260923g657d8414u6af072167fa01fcd@mail.gmail.com>
Message-ID: <945BC466-5C2A-42F1-A5C3-8B55DFB53F9D@sebastian-latza.de>

Alexis Richardson:

> 2. You do care about replicating state - which I think is the case you
> have in mind.  Then you can fail over to a passive server.  We can
> provide some more info on this if you like -- we have done it for a
> few people but it is not yet 'available OOTB'.  (You can also do
> active/active but it is much more fiddly atm).
>

I want to make sure that when an event happens, it can be delivered to  
the correct queue in any case ( "always writable"). As a very  
simplified example I would want to send out welcome mails  
asynchronously to newly registered customers. If the message queue for  
this function wasn't available at the time I'd have to shut down my  
registration which I would want to avoid naturally.
I'd be happy to provide you with testing/feedback and maybe some basic  
erlang hacking for anything that might help regarding that problem.

Regards
Sebastian




From alexis.richardson at gmail.com  Mon Oct 26 16:58:18 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 26 Oct 2009 16:58:18 +0000
Subject: [rabbitmq-discuss] Round-robin queue failover
In-Reply-To: <945BC466-5C2A-42F1-A5C3-8B55DFB53F9D@sebastian-latza.de>
References: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>
	<4ADD504D.1080305@lshift.net>
	<E1N0hRr-0000I0-TK@victory.heartlandliberty.org>
	<06A7EF6A-AE41-4FBC-8543-7AAC8ECABE7F@sebastian-latza.de>
	<167204d20910260923g657d8414u6af072167fa01fcd@mail.gmail.com>
	<945BC466-5C2A-42F1-A5C3-8B55DFB53F9D@sebastian-latza.de>
Message-ID: <167204d20910260958g5266ea6fsd814475f8a2310a3@mail.gmail.com>

On Mon, Oct 26, 2009 at 4:49 PM, Sebastian <mail at sebastian-latza.de> wrote:
> Alexis Richardson:
>
>> 2. You do care about replicating state - which I think is the case you
>> have in mind. ?Then you can fail over to a passive server. ?We can
>> provide some more info on this if you like -- we have done it for a
>> few people but it is not yet 'available OOTB'. ?(You can also do
>> active/active but it is much more fiddly atm).
>>
>
> I want to make sure that when an event happens, it can be delivered to the
> correct queue in any case ( "always writable"). As a very simplified example
> I would want to send out welcome mails asynchronously to newly registered
> customers. If the message queue for this function wasn't available at the
> time I'd have to shut down my registration which I would want to avoid
> naturally.

Right.  So does that mean you need to have an 'unavailability' window
of ZERO seconds, or are willing to tolerate holding the message on the
client for delivery within some interval, eg 1ms, 10ms, 100ms, 1sec,
...

In any case, I suspect that active/passive failover would suffice in
your case.  More on that soon...


> I'd be happy to provide you with testing/feedback and maybe some basic
> erlang hacking for anything that might help regarding that problem.

Thank-you - we may take you up on that!

alexis



> Regards
> Sebastian
>
>



From jasonjwwilliams at gmail.com  Mon Oct 26 17:10:17 2009
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 26 Oct 2009 11:10:17 -0600
Subject: [rabbitmq-discuss] Round-robin queue failover
In-Reply-To: <167204d20910260923g657d8414u6af072167fa01fcd@mail.gmail.com>
References: <7AC5DDDF-E1B7-42A8-89FC-4E72D51FE61E@sebastian-latza.de>
	<4ADD504D.1080305@lshift.net>
	<E1N0hRr-0000I0-TK@victory.heartlandliberty.org>
	<06A7EF6A-AE41-4FBC-8543-7AAC8ECABE7F@sebastian-latza.de>
	<167204d20910260923g657d8414u6af072167fa01fcd@mail.gmail.com>
Message-ID: <3E06B26C-D3BE-47DA-9A23-C7CB7B13E6FA@gmail.com>

The solution we use is pretty much what Alexis describes. No  
clustering. And both consumers and producers declare queues on a fail  
over to a hot standby/passive server. That way messages are never  
lost. When the old server comes back up we fail back.

-J

Sent via iPhone

On Oct 26, 2009, at 10:23, Alexis Richardson <alexis.richardson at gmail.com 
 > wrote:

> Sebastian
>
> On Mon, Oct 26, 2009 at 4:04 PM, Sebastian <mail at sebastian-latza.de>  
> wrote:
>>
>> Kyle Schaffrick:
>>
>>> Attempting to create two identically-named queues will
>>> result in declaring the same queue twice; the two consumers then
>>> consuming from that queue will see load-balancing behavior.
>>
>> Thanks for the clarification. Since this does not work: how do I
>> achieve reliable persistent message delivery even if the one node
>> holding the queue dies?
>
> At the risk of being seen as pedantic...
>
> You could achieve it by waiting for the node to recover from disk.  In
> other words: RabbitMQ provides "eventual delivery" out of the box.  If
> you want to 'persist more reliably' than on one drive using RabbitMQ
> out of the box, then use a RAID or a SAN.
>
> I am guessing that what you mean is *availability* in which a message
> can always reach a suitable queue even if the sending client loses its
> connection with the node that crashed.  The problem with using a
> single node is the time it takes to recover, and client reconnection
> costs (if any).  The time to recover is partly influenced by how much
> state has to recover, and partly by the size of the unavailability
> window that you can tolerate.
>
> Many applications don't like to wait more than (say) 1ms, 10ms or 50ms
> before they can send their message.  In this case you will typically
> want to send a message *before* the crashed node has been able to
> recover.  You can achieve this in two ways:
>
> 1. You don't care about replicating state and can use any other queue
> as a 'suitable queue'.  This is easy - just make sure the right
> consumers and routes are wired up.
>
> 2. You do care about replicating state - which I think is the case you
> have in mind.  Then you can fail over to a passive server.  We can
> provide some more info on this if you like -- we have done it for a
> few people but it is not yet 'available OOTB'.  (You can also do
> active/active but it is much more fiddly atm).
>
>
>
>> As stated before my take would be to replicate
>> queues client-side on independent brokers, but this seems to be
>> getting quite complicated as the queues have to be "double-declared",
>> linked and properly re-initialized on startup of a new empty broker
>> (basically doing some kind of client-side clustering).
>
> Right.  I think you probably want case 2 above.
>
> alexis
>
>
>
>> Regards
>> Sebastian
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From g at rre.tt  Mon Oct 26 18:41:44 2009
From: g at rre.tt (Garrett Smith)
Date: Mon, 26 Oct 2009 13:41:44 -0500
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
	memory
Message-ID: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>

Apart from using rabbitmqctrl to check some of the more obvious
sources for lost memory (e.g. connections, queues, etc.) are there
other techniques for tracking down where the broker might be
allocating resources that aren't cleaned up?

As this is Erlang, I'd assume one point of focus is process creation
and using whatever techniques are used in Erlang -- e.g. tracing, etc.

One thing I see routinely in the rabbit logs that I'd like to cleanup is:

exception on TCP connection <0.31875.6> from XXX.XXX.XXX.XXX:XXXXX
connection_closed_abruptly

However, using pidstat, I see memory allocation in the beam process
occurring independently of those log messages.

Garrett



From matthias at lshift.net  Mon Oct 26 21:56:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 26 Oct 2009 21:56:28 +0000
Subject: [rabbitmq-discuss] IBasicConsumer.HandleBasicDeliver threading
 behavior
In-Reply-To: <4ae5c9e1.1a135e0a.7793.6697@mx.google.com>
References: <4ae5c9e1.1a135e0a.7793.6697@mx.google.com>
Message-ID: <4AE61B0C.3010809@lshift.net>

Allen,

Allen Jones wrote:
> The documentation makes it clear that the 
> IBasicConsumer.HandleBasicDeliver event handler is called on the 
> connection?s thread (i.e. single).  I just wanted to confirm that the 
> Model will only process messages one at a time i.e. there is no chance 
> that multiple HandleBasicDeliver calls will be executed concurrently. 
> Can somebody confirm?

Your assumption is correct... as long as you don't use the same 
IBasicConsumer instance in multiple IModels.


Regards,

Matthias.



From matthias at lshift.net  Mon Oct 26 22:17:22 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 26 Oct 2009 22:17:22 +0000
Subject: [rabbitmq-discuss] Messages left in queue
In-Reply-To: <4ae5cb23.095c5e0a.5eee.ffffafc3@mx.google.com>
References: <4ae5cb23.095c5e0a.5eee.ffffafc3@mx.google.com>
Message-ID: <4AE61FF2.7000005@lshift.net>

Allen,

Allen Jones wrote:
> I am ensuring I ACK any messages I receive and most of the time 
> (hundreds of thousands of messages) things are fine. But occasionally 
> there are messages stuck.

How are you observing the "stuckness"?

Check the output of 'rabbitmqctl list_queues name consumers 
messages_ready messages_unacknowledged'.

'consumers' is the current consumer count for that queue.

The 'messages_ready' figure should be zero unless you have no consumers 
or there is a backlog due to some form of flow control taking place 
(e.g. basic.qos or TCP-level).

The 'messages_unacknowledged' figure tells you how many messages sent to 
consumer are awaiting an acknowledgement.

> It tends to be more in my dev environment than in production, so it 
> could be to do with tearing processes down in an unfriendly way.

Closing the channel/model or connection - either via the API or 
"forcefully", e.g. by closing the socket or killing the client 
application - will requeue the unacknowledged messages. So that 
shouldn't result in stuckness.

> I just wanted to check if there are any known circumstances where
> messages might get stuck in 1.6?

There is no known problem in that area, though please upgrade to 1.7 if 
you can.


Regards,

Matthias.



From matthias at lshift.net  Mon Oct 26 22:30:59 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 26 Oct 2009 22:30:59 +0000
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
 memory
In-Reply-To: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>
References: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>
Message-ID: <4AE62323.5030603@lshift.net>

Garrett,

Garrett Smith wrote:
> Apart from using rabbitmqctl to check some of the more obvious
> sources for lost memory (e.g. connections, queues, etc.) are there
> other techniques for tracking down where the broker might be
> allocating resources that aren't cleaned up?

The output of the various rabbitmqctl list_* commands is definitely the 
first port of call. Do the "row counts" of these increase? Or do the 
message counts in the queues increase?

> As this is Erlang, I'd assume one point of focus is process creation
> and using whatever techniques are used in Erlang -- e.g. tracing, etc.

See the recent thread at
 
http://www.nabble.com/Re%3A-RabbitMQ-crashes-hard-when-it-runs-out-of-memory-td26014566.html

for some further avenues of investigation.

> One thing I see routinely in the rabbit logs that I'd like to cleanup is:
> 
> exception on TCP connection <0.31875.6> from XXX.XXX.XXX.XXX:XXXXX
> connection_closed_abruptly

That is caused by clients disconnecting without following the proper 
AMQP shutdown protocol, e.g. they simply close the socket instead of 
sending a "connection.close" command and waiting for "connection.close_ok".

With correctly implemented client libraries and applications you should 
only see that in the event of an application crash or network problems.

However, there are no ill effects from this. In particular, no resource 
leakage results from abruptly closed connections.


Regards,

Matthias.



From dglaubman at acm.org  Tue Oct 27 16:47:15 2009
From: dglaubman at acm.org (David Glaubman)
Date: Tue, 27 Oct 2009 09:47:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <167204d20910230149u40d849a8l625e85890cac1aaa@mail.gmail.com>
References: <25968960.post@talk.nabble.com> <4ADD5443.6080701@lshift.net>
	<25986856.post@talk.nabble.com> <4ADEBB64.8060605@lshift.net>
	<25997030.post@talk.nabble.com> <4AE06973.6010802@lshift.net>
	<26016750.post@talk.nabble.com> <4AE0E522.4070103@lshift.net>
	<26020282.post@talk.nabble.com>
	<167204d20910230149u40d849a8l625e85890cac1aaa@mail.gmail.com>
Message-ID: <26081081.post@talk.nabble.com>


I am interested.  Would not be able to give this any cycles until after
Thanskgiving.

David


Alexis Richardson-4 wrote:
> 
> On Fri, Oct 23, 2009 at 4:04 AM, David Glaubman <dglaubman at acm.org> wrote:
> [...]
>> I also think it may be worthwhile to consider programming against Socket
>> interface rather than TCPClient to maximize performance.
> 
> Is that something you could have a crack at?
> 
> alexis
> 

-- 
View this message in context: http://www.nabble.com/Simple-benchmark-and-results-tp25968960p26081081.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Tue Oct 27 17:29:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 27 Oct 2009 17:29:00 +0000
Subject: [rabbitmq-discuss] Simple benchmark and results
In-Reply-To: <26081081.post@talk.nabble.com>
References: <25968960.post@talk.nabble.com>
	<4ADD5443.6080701@lshift.net>	<25986856.post@talk.nabble.com>
	<4ADEBB64.8060605@lshift.net>	<25997030.post@talk.nabble.com>
	<4AE06973.6010802@lshift.net>	<26016750.post@talk.nabble.com>
	<4AE0E522.4070103@lshift.net>	<26020282.post@talk.nabble.com>	<167204d20910230149u40d849a8l625e85890cac1aaa@mail.gmail.com>
	<26081081.post@talk.nabble.com>
Message-ID: <4AE72DDC.3090301@lshift.net>

David,

David Glaubman wrote:
> I am interested.  Would not be able to give this any cycles until after
> Thanskgiving.

Too late. Already fixed on the trunk. See
  http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/cd22d1910063

In our tests on Windows this gives a 5-10x improvement in send
performance for tiny messages.


Regards,

Matthias.



From frank at revsys.com  Tue Oct 27 21:09:18 2009
From: frank at revsys.com (Frank Wiles)
Date: Tue, 27 Oct 2009 16:09:18 -0500
Subject: [rabbitmq-discuss] Unable to get STOMP plugin working with 1.7.0 on
	Debian Lenny
Message-ID: <7bbd319d0910271409i7daec861m435f6fa5912f85f6@mail.gmail.com>

Hi Everyone,

I asked about this in IRC, but was asked to post my question to the
list so it is archived here.  Apparently the docs aren't up to do date
on this.  Here is the procedure I went through:

1) Installed rabbitmq-server_1.7.0-1_all.deb
2) Cloned the public umbrella package
3) Built rabbitmq-stomp plugin as directed in the docs
5) Copied all of the files in dist/ for that plugin to
/usr/lib/rabbitmq/plugins
6) Ran rabbitmq-activate-plugins
7) Created /etc/default/rabbitmq to contain:
SERVER_START_ARGS='-rabbit_stomp listeners [{"0.0.0.0",61613}]'

Restarted the server.   While the server runs, I see no mention of
'stomp' in the args or when viewing a status.  And the 61613 port
isn't open.  Any ideas?

-- 
Frank Wiles
Revolution Systems | http://www.revsys.com/
frank at revsys.com   | (800) 647-6298



From kapouer at melix.org  Tue Oct 27 21:35:11 2009
From: kapouer at melix.org (=?ISO-8859-1?Q?J=E9r=E9my_Lal?=)
Date: Tue, 27 Oct 2009 22:35:11 +0100
Subject: [rabbitmq-discuss] Unable to get STOMP plugin working with
 1.7.0 on Debian Lenny
In-Reply-To: <7bbd319d0910271409i7daec861m435f6fa5912f85f6@mail.gmail.com>
References: <7bbd319d0910271409i7daec861m435f6fa5912f85f6@mail.gmail.com>
Message-ID: <4AE7678F.8000407@melix.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 27/10/2009 22:09, Frank Wiles wrote:
> Hi Everyone,
> 
> I asked about this in IRC, but was asked to post my question to the
> list so it is archived here.  Apparently the docs aren't up to do date
> on this.  Here is the procedure I went through:
> 
> 1) Installed rabbitmq-server_1.7.0-1_all.deb
> 2) Cloned the public umbrella package
> 3) Built rabbitmq-stomp plugin as directed in the docs
> 5) Copied all of the files in dist/ for that plugin to
> /usr/lib/rabbitmq/plugins
> 6) Ran rabbitmq-activate-plugins
> 7) Created /etc/default/rabbitmq to contain:
> SERVER_START_ARGS='-rabbit_stomp listeners [{"0.0.0.0",61613}]'
> 
> Restarted the server.   While the server runs, I see no mention of
> 'stomp' in the args or when viewing a status.  And the 61613 port
> isn't open.  Any ideas?
> 

Once compiled, put the .ez in
/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins/rabbit_stomp.ez
then
rabbitmq-activate-plugins
and restart server, that's it.
It seems no /etc/rabbitmq/rabbitmq.conf is needed at all.
I'm using rabbitmq-server 1.7.0-2

Regards,
J?r?my Lal

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEARECAAYFAkrnZ48ACgkQDMRIEQdBQdxL3QCg0LPtScigiP3GpLHyIkXq3uii
hbcAoOiRQRDtk36StdJmeauPMmi8Vj38
=hSlq
-----END PGP SIGNATURE-----




From frank at revsys.com  Tue Oct 27 22:04:06 2009
From: frank at revsys.com (Frank Wiles)
Date: Tue, 27 Oct 2009 17:04:06 -0500
Subject: [rabbitmq-discuss] Unable to get STOMP plugin working with
	1.7.0 on Debian Lenny
In-Reply-To: <4AE7678F.8000407@melix.org>
References: <7bbd319d0910271409i7daec861m435f6fa5912f85f6@mail.gmail.com>
	<4AE7678F.8000407@melix.org>
Message-ID: <7bbd319d0910271504w1be9356ci7ebdbed344b2b5c0@mail.gmail.com>

On Tue, Oct 27, 2009 at 4:35 PM, J?r?my Lal <kapouer at melix.org> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 27/10/2009 22:09, Frank Wiles wrote:
>> Hi Everyone,
>>
>> I asked about this in IRC, but was asked to post my question to the
>> list so it is archived here. ?Apparently the docs aren't up to do date
>> on this. ?Here is the procedure I went through:
>>
>> 1) Installed rabbitmq-server_1.7.0-1_all.deb
>> 2) Cloned the public umbrella package
>> 3) Built rabbitmq-stomp plugin as directed in the docs
>> 5) Copied all of the files in dist/ for that plugin to
>> /usr/lib/rabbitmq/plugins
>> 6) Ran rabbitmq-activate-plugins
>> 7) Created /etc/default/rabbitmq to contain:
>> SERVER_START_ARGS='-rabbit_stomp listeners [{"0.0.0.0",61613}]'
>>
>> Restarted the server. ? While the server runs, I see no mention of
>> 'stomp' in the args or when viewing a status. ?And the 61613 port
>> isn't open. ?Any ideas?
>>
>
> Once compiled, put the .ez in
> /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins/rabbit_stomp.ez
> then
> rabbitmq-activate-plugins
> and restart server, that's it.
> It seems no /etc/rabbitmq/rabbitmq.conf is needed at all.
> I'm using rabbitmq-server 1.7.0-2


Ah so I was just using the wrong directory.  Thanks that did it for me!

-- 
Frank Wiles
Revolution Systems | http://www.revsys.com/
frank at revsys.com   | (800) 647-6298



From g at rre.tt  Tue Oct 27 23:43:02 2009
From: g at rre.tt (Garrett Smith)
Date: Tue, 27 Oct 2009 18:43:02 -0500
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
	memory
In-Reply-To: <4AE62323.5030603@lshift.net>
References: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>
	<4AE62323.5030603@lshift.net>
Message-ID: <ce2570e20910271643x39009babuee163eb11fc70779@mail.gmail.com>

(repost to list)

On Mon, Oct 26, 2009 at 5:30 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Garrett Smith wrote:
>>
>> Apart from using rabbitmqctl to check some of the more obvious
>> sources for lost memory (e.g. connections, queues, etc.) are there
>> other techniques for tracking down where the broker might be
>> allocating resources that aren't cleaned up?
>
> The output of the various rabbitmqctl list_* commands is definitely the
> first port of call. Do the "row counts" of these increase? Or do the message
> counts in the queues increase?

Hah, I missed something obvious here. Thanks for reminding me to start
at the beginning :)

So, here's the problem, which everyone reasonably faces: when a
consumer goes away, their queues pile up, which is basically a "leak"
at the application/system level (not with rabbit).

I'm being a little lazy here by not looking into the docs or the AMQP
spec, but is there a way to guard against an eventual crash in this
case (I believe this has manifested itself for me once by running out
of Erlang processes, but memory is certainly an issue as well)?

Having worked with qpid a bit, their broker will respect the
time-to-live/expires info associated with a message. I know, at least
in 1.6, rabbit didn't do that. That would be one solution.

A fallback would be a limit to the number of messages a queue could handle.

Short of that, I can run a daemon to routinely check rabbit for queues
that pile up, but that's a moving part I'd prefer to avoid if
possible.

Garrett



From matthias at lshift.net  Wed Oct 28 01:00:22 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 28 Oct 2009 01:00:22 +0000
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
 memory
In-Reply-To: <ce2570e20910271643x39009babuee163eb11fc70779@mail.gmail.com>
References: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>	<4AE62323.5030603@lshift.net>
	<ce2570e20910271643x39009babuee163eb11fc70779@mail.gmail.com>
Message-ID: <4AE797A6.10707@lshift.net>

Garrett,

Garrett Smith wrote:
> Hah, I missed something obvious here. Thanks for reminding me to start
> at the beginning :)
> 
> So, here's the problem, which everyone reasonably faces: when a
> consumer goes away, their queues pile up, which is basically a "leak"
> at the application/system level (not with rabbit).
> 
> I'm being a little lazy here by not looking into the docs or the AMQP
> spec, but is there a way to guard against an eventual crash in this
> case (I believe this has manifested itself for me once by running out
> of Erlang processes, but memory is certainly an issue as well)?

I'd definitely recommend reading the spec. If you did then you'd know 
about the exclusive and auto-delete flags to queue.declare ;) Queues 
declared with the former get automatically deleted when their creating 
connection disappears, and the latter when their last consumer disappears.

HTH,

Matthias.



From g at rre.tt  Wed Oct 28 15:48:39 2009
From: g at rre.tt (Garrett Smith)
Date: Wed, 28 Oct 2009 10:48:39 -0500
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
	memory
In-Reply-To: <4AE797A6.10707@lshift.net>
References: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>
	<4AE62323.5030603@lshift.net>
	<ce2570e20910271643x39009babuee163eb11fc70779@mail.gmail.com>
	<4AE797A6.10707@lshift.net>
Message-ID: <ce2570e20910280848s34ec2f90yfebebea858f6e0b9@mail.gmail.com>

On Tue, Oct 27, 2009 at 8:00 PM, Matthias Radestock <matthias at lshift.net> wrote:

>> So, here's the problem, which everyone reasonably faces: when a
>> consumer goes away, their queues pile up, which is basically a "leak"
>> at the application/system level (not with rabbit).
>>
>> I'm being a little lazy here by not looking into the docs or the AMQP
>> spec, but is there a way to guard against an eventual crash in this
>> case (I believe this has manifested itself for me once by running out
>> of Erlang processes, but memory is certainly an issue as well)?
>
> I'd definitely recommend reading the spec. If you did then you'd know about
> the exclusive and auto-delete flags to queue.declare ;) Queues declared with
> the former get automatically deleted when their creating connection
> disappears, and the latter when their last consumer disappears.

Yup, I'm familiar with those flags (and actually have read the spec, a
few times even :)

I need both non-exclusive/non-auto-delete so that the queue is
preserved when either the creating connection or the last consumer
goes away. Various agents come and go (restarting is one example, but
there are other cases). Not to preach to the choir, but one of the
benefits of async messaging is you can insulate from dropped
connections.

It sounds like I'm left with the option of running a cleanup/check
process occasionally to ensure that we don't run into queues piling
up. No other options, given exclusive=false and autodelete=false?

I know that the expires/TTL is ignored in rabbit, and is perhaps not
entirely fleshed out in the 0.8 spec, but it seems an important
feature wrt resource resource management.

Garrett



From rtrlists at googlemail.com  Wed Oct 28 15:59:36 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 28 Oct 2009 15:59:36 +0000
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
	memory
In-Reply-To: <ce2570e20910280848s34ec2f90yfebebea858f6e0b9@mail.gmail.com>
References: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>
	<4AE62323.5030603@lshift.net>
	<ce2570e20910271643x39009babuee163eb11fc70779@mail.gmail.com>
	<4AE797A6.10707@lshift.net>
	<ce2570e20910280848s34ec2f90yfebebea858f6e0b9@mail.gmail.com>
Message-ID: <6a3ae47e0910280859n5a04df31j395bd8c02c273fcf@mail.gmail.com>

On Wed, Oct 28, 2009 at 3:48 PM, Garrett Smith <g at rre.tt> wrote:

> Yup, I'm familiar with those flags (and actually have read the spec, a
> few times even :)
>
> I need both non-exclusive/non-auto-delete so that the queue is
> preserved when either the creating connection or the last consumer
> goes away. Various agents come and go (restarting is one example, but
> there are other cases). Not to preach to the choir, but one of the
> benefits of async messaging is you can insulate from dropped
> connections.
>
> It sounds like I'm left with the option of running a cleanup/check
> process occasionally to ensure that we don't run into queues piling
> up. No other options, given exclusive=false and autodelete=false?
>
> I know that the expires/TTL is ignored in rabbit, and is perhaps not
> entirely fleshed out in the 0.8 spec, but it seems an important
> feature wrt resource resource management.
>
>
Unless you've also got persitant messages, why not have auto-delete queues
that every producer and consumer just declares up front? If no-one's around
using that queue, it goes away, once someone needs it, the declare makes it
appear.

Or am I missing something?

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091028/db6ae3fb/attachment.htm 

From matthias at lshift.net  Wed Oct 28 16:01:36 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 28 Oct 2009 16:01:36 +0000
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
 memory
In-Reply-To: <ce2570e20910280848s34ec2f90yfebebea858f6e0b9@mail.gmail.com>
References: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>	
	<4AE62323.5030603@lshift.net>	
	<ce2570e20910271643x39009babuee163eb11fc70779@mail.gmail.com>	
	<4AE797A6.10707@lshift.net>
	<ce2570e20910280848s34ec2f90yfebebea858f6e0b9@mail.gmail.com>
Message-ID: <4AE86AE0.6070405@lshift.net>

Garrett,

Garrett Smith wrote:
> I need both non-exclusive/non-auto-delete so that the queue is
> preserved when either the creating connection or the last consumer
> goes away.

Why do you want the queue to be preserved when you do not want any of
its messages preserved?

> I know that the expires/TTL is ignored in rabbit, and is perhaps not
> entirely fleshed out in the 0.8 spec, but it seems an important
> feature wrt resource resource management.

Discarding messages from a queue based on some expiry property is but
one of many different conceivable ways in which one may wish to manage
resources. Yes, it happens to be one that is half-defined by the spec,
but I doubt it's the most useful one. We will get round to implementing
it eventually, but we are considering others too, such as limiting
queues by msg count or size, eviction policies based on message
properties other than expiry, etc.

Regards,

Matthias.



From g at rre.tt  Wed Oct 28 17:21:49 2009
From: g at rre.tt (Garrett Smith)
Date: Wed, 28 Oct 2009 12:21:49 -0500
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
	memory
In-Reply-To: <4AE86AE0.6070405@lshift.net>
References: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>
	<4AE62323.5030603@lshift.net>
	<ce2570e20910271643x39009babuee163eb11fc70779@mail.gmail.com>
	<4AE797A6.10707@lshift.net>
	<ce2570e20910280848s34ec2f90yfebebea858f6e0b9@mail.gmail.com>
	<4AE86AE0.6070405@lshift.net>
Message-ID: <ce2570e20910281021u7f6b6131u1d4ee2532376729e@mail.gmail.com>

On Wed, Oct 28, 2009 at 11:01 AM, Matthias Radestock
<matthias at lshift.net> wrote:
> Garrett,
>
> Garrett Smith wrote:
>> I need both non-exclusive/non-auto-delete so that the queue is
>> preserved when either the creating connection or the last consumer
>> goes away.
>
> Why do you want the queue to be preserved when you do not want any of
> its messages preserved?

Let's say I restart a process and terminate a connection on an
exclusive queue. I'm interested in the messages -- I'm gonna come back
online after the restart. I don't want to delete the queue. Trust me
:)

Let's say, on the other hand, that I decommission the queue owner and
(admittedly sloppily) don't delete the queue. Messages pile up and I
run out of memory/processes.

I understand this is entirely application specific. It's like running
out of disk space when you keep writing to a database. I understand
that and will deal with it easily enough, though I do think that
protections against resource exhaustion are important.

>> I know that the expires/TTL is ignored in rabbit, and is perhaps not
>> entirely fleshed out in the 0.8 spec, but it seems an important
>> feature wrt resource resource management.
>
> Discarding messages from a queue based on some expiry property is but
> one of many different conceivable ways in which one may wish to manage
> resources. Yes, it happens to be one that is half-defined by the spec,
> but I doubt it's the most useful one. We will get round to implementing
> it eventually, but we are considering others too, such as limiting
> queues by msg count or size, eviction policies based on message
> properties other than expiry, etc.

In my experience (again, working with qpid), time-to-live/expires is a
flexible and effective way to deal with this problem. Not trying to
spark a debate, but it's not obvious to me how that approach is
inferior to the others you listed. I understand if this is topic for
future consideration though.

Garrett



From matthias at lshift.net  Wed Oct 28 19:11:26 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 28 Oct 2009 19:11:26 +0000
Subject: [rabbitmq-discuss] General approaches for tracking unreclaimed
 memory
In-Reply-To: <ce2570e20910281021u7f6b6131u1d4ee2532376729e@mail.gmail.com>
References: <ce2570e20910261141n26d909e2l9c7f22ee219d678c@mail.gmail.com>	<4AE62323.5030603@lshift.net>	<ce2570e20910271643x39009babuee163eb11fc70779@mail.gmail.com>	<4AE797A6.10707@lshift.net>	<ce2570e20910280848s34ec2f90yfebebea858f6e0b9@mail.gmail.com>	<4AE86AE0.6070405@lshift.net>
	<ce2570e20910281021u7f6b6131u1d4ee2532376729e@mail.gmail.com>
Message-ID: <4AE8975E.8050808@lshift.net>

Garrett,

Garrett Smith wrote:
> Let's say I restart a process and terminate a connection on an
> exclusive queue. I'm interested in the messages -- I'm gonna come back
> online after the restart. I don't want to delete the queue. Trust me
> :)
> 
> Let's say, on the other hand, that I decommission the queue owner and
> (admittedly sloppily) don't delete the queue. Messages pile up and I
> run out of memory/processes.
> 
> I understand this is entirely application specific. It's like running
> out of disk space when you keep writing to a database. I understand
> that and will deal with it easily enough, though I do think that
> protections against resource exhaustion are important.

Understood. However, message expiry is entirely in the control of the
client, so it's not something a server can rely on for keeping resources
bounded unless it can trust the clients and clients have been correctly
coded to supply a reasonable expiry time.

Also, you'd still want a mechanism to delete the queue in your scenario,
because otherwise the system will waste resources on publishing and then
deleting messages from it.

It seems like what you are really after is a server-controlled "time to
live when unused" setting for a queue, i.e. the server would
automatically delete the queue after it hasn't been used for a while.
And you'd probably want to put limits on queue sizes too. etc, etc.


Regards,

Matthias.



From tim at cloudspace.com  Thu Oct 29 11:55:27 2009
From: tim at cloudspace.com (Tim Rosenblatt)
Date: Thu, 29 Oct 2009 07:55:27 -0400
Subject: [rabbitmq-discuss] Monitoring queue size via Nagios
Message-ID: <381842ac0910290455k4fee61a4m7a55268194b59160@mail.gmail.com>

I was searching for a Nagios plugin to monitor RabbitMQ, and only found an
unanswered question to this mailing list of how it could be done.

I wanted to share the Ruby code I wrote for monitoring queue size. A next
step for monitoring is to connect directly to the queue with the Bunny gem
and make sure it is accepting connections.

#########

#!/usr/bin/ruby

VERSION_STRING = "Cloudspace RabbitMQ queue size checker v1.0 2009-10-20"


require 'optparse'

options = { :warning => 0, :critical => 0 }

OptionParser.new do |opts|
  opts.banner = "Usage #{__FILE__} [options]"

  opts.on("-?", "-h", "Help") do |v|
    puts "use --help for usage information"
    exit(3)
  end

  opts.on("--nagios", "Running from Nagios") do |v|
    options[:nagios] = true
  end

  opts.on("-v", "--verbose", "Run verbosely") do |v|
    options[:verbose] = v
  end

  opts.on("-V", "--version", "Prints \"#{VERSION_STRING}\"") do |v|
    puts VERSION_STRING
    exit(0)
  end

  opts.on("-w NUMBER", "--warning NUMBER", "Queue size for warning
threshold") do |n|
    options[:warning] = n.to_i
    puts "-w must be an integer greater than 0" or exit(3) unless
options[:warning] > 0
  end

  opts.on("-c NUMBER", "--critical NUMBER", "Queue size for critical
threshold") do |n|
    options[:critical] = n.to_i
    puts "-c must be an integer greater than 0" or exit(3) unless
options[:critical] > 0
  end

end.parse!(ARGV)


output = `sudo rabbitmqctl list_queues`
queue_sizes = output.scan(/\d+/)

puts output.gsub(/\n/, "")

queue_sizes.each do |q_size|
  q_size = q_size.to_i
  exit(2) if q_size > options[:critical]
  exit(1) if q_size > options[:warning]
end

exit(0)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091029/a51aaf52/attachment.htm 

From matthias at lshift.net  Thu Oct 29 12:04:34 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 29 Oct 2009 12:04:34 +0000
Subject: [rabbitmq-discuss] Monitoring queue size via Nagios
In-Reply-To: <381842ac0910290455k4fee61a4m7a55268194b59160@mail.gmail.com>
References: <381842ac0910290455k4fee61a4m7a55268194b59160@mail.gmail.com>
Message-ID: <4AE984D2.5000303@lshift.net>

Tim,

Tim Rosenblatt wrote:
> output = `sudo rabbitmqctl list_queues`
> queue_sizes = output.scan(/\d+/)

You may want to supply the '-q' option to rabbitmqctl in order to
suppress the output of information messages ("Listing queues ..." ,
"...done", etc).


Regards,

Matthias.



From tim at cloudspace.com  Thu Oct 29 12:09:20 2009
From: tim at cloudspace.com (Tim Rosenblatt)
Date: Thu, 29 Oct 2009 08:09:20 -0400
Subject: [rabbitmq-discuss] Monitoring queue size via Nagios
In-Reply-To: <4AE984D2.5000303@lshift.net>
References: <381842ac0910290455k4fee61a4m7a55268194b59160@mail.gmail.com> 
	<4AE984D2.5000303@lshift.net>
Message-ID: <381842ac0910290509y55d66819t2a0dd877f0cb4eb0@mail.gmail.com>

Yep! Good addition.

Also to note: you will probably have to configure sudoers to allow nagios to
run rabbitmqctl without prompting for a password. Use the following line

nagios                          ALL=(ALL) NOPASSWD: /usr/sbin/rabbitmqctl

-- Tim

On Thu, Oct 29, 2009 at 8:04 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Tim,
>
> Tim Rosenblatt wrote:
> > output = `sudo rabbitmqctl list_queues`
> > queue_sizes = output.scan(/\d+/)
>
> You may want to supply the '-q' option to rabbitmqctl in order to
> suppress the output of information messages ("Listing queues ..." ,
> "...done", etc).
>
>
> Regards,
>
> Matthias.
>



-- 
Tim Rosenblatt
Cloudspace
Office: 407-823-8808
Cell: 407-719-2777

10244 E Colonial Dr, Suite 106
Orlando, FL 32817
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091029/9010ebe6/attachment.htm 

From askh at opera.com  Thu Oct 29 12:42:13 2009
From: askh at opera.com (Ask Solem)
Date: Thu, 29 Oct 2009 13:42:13 +0100
Subject: [rabbitmq-discuss] Monitoring queue size via Nagios
In-Reply-To: <381842ac0910290509y55d66819t2a0dd877f0cb4eb0@mail.gmail.com>
References: <381842ac0910290455k4fee61a4m7a55268194b59160@mail.gmail.com>
	<4AE984D2.5000303@lshift.net>
	<381842ac0910290509y55d66819t2a0dd877f0cb4eb0@mail.gmail.com>
Message-ID: <5D6B0147-9EF3-492D-ABE9-47A46713F9BD@opera.com>


On Oct 29, 2009, at 1:09 PM, Tim Rosenblatt wrote:

> Yep! Good addition.
>
> Also to note: you will probably have to configure sudoers to allow  
> nagios to run rabbitmqctl without prompting for a password. Use the  
> following line
>
> nagios                          ALL=(ALL) NOPASSWD: /usr/sbin/ 
> rabbitmqctl
>


Cool, I didn't know about -q.

You can even restrict it to specific rabbitmqctl subcommands, for my  
munin plugins[1] I use:

munin ALL= NOPASSWD: /usr/sbin/rabbitmqctl list_queues *
munin ALL= NOPASSWD: /usr/sbin/rabbitmqctl list_connections

This way you don't give it access to stop, reset etc.


[1]: http://github.com/ask/rabbitmq-munin



From traceye at pmamediagroup.com  Thu Oct 29 18:04:20 2009
From: traceye at pmamediagroup.com (tracey eubanks)
Date: Thu, 29 Oct 2009 12:04:20 -0600
Subject: [rabbitmq-discuss] rabbitmq node down..
Message-ID: <DF3DC207-4E98-4E25-AE62-978B252F7FC1@pmamediagroup.com>

I downloaded rabbitmq v1.7.0 and installed it into my /usr/local/lib/ 
erlang/lib (erlang vR13B02-1) directory then linked the rabbitmq- 
server, rabbitmqctl, rabbitmq-multi and rabbitmq-env files to /bin. I  
can start the server just fine but when I try to connect to it or run  
rabbitmqctl status, it gives me this error,

Error: unable to connect to node rabbit at mymac: nodedown
diagnostics:
- unable to connect to epmd on mymac: nxdomain
- current node: rabbitmqctl19789 at mymac
- current node home dir: /Users/administrator
- current node cookie hash: F0FO97xqCdIRZ5FhimfiDg==


I'm not sure what's going on. I installed rabbitmq v1.6.0 the same way  
and everything works just fine.

Thanks guys



From pauljones23 at gmail.com  Thu Oct 29 18:59:49 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Thu, 29 Oct 2009 18:59:49 +0000
Subject: [rabbitmq-discuss] rabbitmq node down..
In-Reply-To: <DF3DC207-4E98-4E25-AE62-978B252F7FC1@pmamediagroup.com>
References: <DF3DC207-4E98-4E25-AE62-978B252F7FC1@pmamediagroup.com>
Message-ID: <29598b610910291159g3aaed5f4k11e8cf460df9e337@mail.gmail.com>

Hi Tracey,

Could you please also supply the output shown when the server starts? (And
in the log file). It should also display a cookie hash, which lets you
ensure that the cookies being used are the same.

Also, for 1.7.0 onwards, you no longer need to put rabbit into the erlang
lib dir - it be installed anywhere (the packages currently put it in
/usr/lib/rabbitmq/lib).

Paul.

On Thu, Oct 29, 2009 at 6:04 PM, tracey eubanks
<traceye at pmamediagroup.com>wrote:

> I downloaded rabbitmq v1.7.0 and installed it into my /usr/local/lib/
> erlang/lib (erlang vR13B02-1) directory then linked the rabbitmq-
> server, rabbitmqctl, rabbitmq-multi and rabbitmq-env files to /bin. I
> can start the server just fine but when I try to connect to it or run
> rabbitmqctl status, it gives me this error,
>
> Error: unable to connect to node rabbit at mymac: nodedown
> diagnostics:
> - unable to connect to epmd on mymac: nxdomain
> - current node: rabbitmqctl19789 at mymac
> - current node home dir: /Users/administrator
> - current node cookie hash: F0FO97xqCdIRZ5FhimfiDg==
>
>
> I'm not sure what's going on. I installed rabbitmq v1.6.0 the same way
> and everything works just fine.
>
> Thanks guys
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091029/1576cfc8/attachment.htm 

From traceye at pmamediagroup.com  Thu Oct 29 19:10:22 2009
From: traceye at pmamediagroup.com (tracey eubanks)
Date: Thu, 29 Oct 2009 13:10:22 -0600
Subject: [rabbitmq-discuss] rabbitmq node down..
In-Reply-To: <29598b610910291159g3aaed5f4k11e8cf460df9e337@mail.gmail.com>
References: <DF3DC207-4E98-4E25-AE62-978B252F7FC1@pmamediagroup.com>
	<29598b610910291159g3aaed5f4k11e8cf460df9e337@mail.gmail.com>
Message-ID: <7123AD88-FE43-49A8-B3C9-7D58CBD68D03@pmamediagroup.com>

Hey Paul,
Here's the output when the server starts;
sudo rabbitmq-server

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.0  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies  
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at mymac
app descriptor: /usr/local/lib/erlang/lib/rabbitmq-server-1.7.0/ 
scripts/../ebin/rabbit.app
home dir      : /Users/administrator
cookie hash   : F0FO97xqCdIRZ5FhimfiDg==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running



This is from /var/log/rabbitmq/rabbit.log;
=INFO REPORT==== 29-Oct-2009::12:35:48 ===
disk_log: repairing "/var/lib/rabbitmq/mnesia/rabbit/ 
rabbit_persister.LOG" ...

=INFO REPORT==== 29-Oct-2009::12:35:48 ===
Repaired persister log - 1 recovered, 0 bad

=INFO REPORT==== 29-Oct-2009::12:35:48 ===
Rolling persister log to "/var/lib/rabbitmq/mnesia/rabbit/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 29-Oct-2009::12:35:48 ===
started TCP Listener on 0.0.0.0:5672


Thanks

On Oct 29, 2009, at 12:59 PM, Paul Jones wrote:

> Hi Tracey,
>
> Could you please also supply the output shown when the server  
> starts? (And in the log file). It should also display a cookie hash,  
> which lets you ensure that the cookies being used are the same.
>
> Also, for 1.7.0 onwards, you no longer need to put rabbit into the  
> erlang lib dir - it be installed anywhere (the packages currently  
> put it in /usr/lib/rabbitmq/lib).
>
> Paul.
>
> On Thu, Oct 29, 2009 at 6:04 PM, tracey eubanks <traceye at pmamediagroup.com 
> > wrote:
> I downloaded rabbitmq v1.7.0 and installed it into my /usr/local/lib/
> erlang/lib (erlang vR13B02-1) directory then linked the rabbitmq-
> server, rabbitmqctl, rabbitmq-multi and rabbitmq-env files to /bin. I
> can start the server just fine but when I try to connect to it or run
> rabbitmqctl status, it gives me this error,
>
> Error: unable to connect to node rabbit at mymac: nodedown
> diagnostics:
> - unable to connect to epmd on mymac: nxdomain
> - current node: rabbitmqctl19789 at mymac
> - current node home dir: /Users/administrator
> - current node cookie hash: F0FO97xqCdIRZ5FhimfiDg==
>
>
> I'm not sure what's going on. I installed rabbitmq v1.6.0 the same way
> and everything works just fine.
>
> Thanks guys
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091029/ad17ce42/attachment.htm 

From pauljones23 at gmail.com  Thu Oct 29 19:16:18 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Thu, 29 Oct 2009 19:16:18 +0000
Subject: [rabbitmq-discuss] rabbitmq node down..
In-Reply-To: <7123AD88-FE43-49A8-B3C9-7D58CBD68D03@pmamediagroup.com>
References: <DF3DC207-4E98-4E25-AE62-978B252F7FC1@pmamediagroup.com>
	<29598b610910291159g3aaed5f4k11e8cf460df9e337@mail.gmail.com>
	<7123AD88-FE43-49A8-B3C9-7D58CBD68D03@pmamediagroup.com>
Message-ID: <29598b610910291216t2fd65df1t5c539a2430398ba4@mail.gmail.com>

Hi Tracey,

I just noticed in your original email the message:
  unable to connect to epmd on mymac: nxdomain

Does "mymac" actually resolve to your local machine's address? Perhaps try
adding a hosts entry for it to make completely sure that it will resolve.

Paul.

On Thu, Oct 29, 2009 at 7:10 PM, tracey eubanks
<traceye at pmamediagroup.com>wrote:

> Hey Paul,
> Here's the output when the server starts;
> sudo rabbitmq-server
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.0  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
> and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node          : rabbit at mymac
> app descriptor:
> /usr/local/lib/erlang/lib/rabbitmq-server-1.7.0/scripts/../ebin/rabbit.app
> home dir      : /Users/administrator
> cookie hash   : F0FO97xqCdIRZ5FhimfiDg==
> log           : /var/log/rabbitmq/rabbit.log
> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>
> starting database             ...done
> starting core processes       ...done
> starting recovery             ...done
> starting persister            ...done
> starting guid generator       ...done
> starting builtin applications ...done
> starting TCP listeners        ...done
> starting SSL listeners        ...done
>
> broker running
>
>
>
> This is from /var/log/rabbitmq/rabbit.log;
> =INFO REPORT==== 29-Oct-2009::12:35:48 ===
> disk_log: repairing "/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG"
> ...
>
> =INFO REPORT==== 29-Oct-2009::12:35:48 ===
> Repaired persister log - 1 recovered, 0 bad
>
> =INFO REPORT==== 29-Oct-2009::12:35:48 ===
> Rolling persister log to
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG.previous"
>
> =INFO REPORT==== 29-Oct-2009::12:35:48 ===
> started TCP Listener on 0.0.0.0:5672
>
>
> Thanks
>
> On Oct 29, 2009, at 12:59 PM, Paul Jones wrote:
>
> Hi Tracey,
>
> Could you please also supply the output shown when the server starts? (And
> in the log file). It should also display a cookie hash, which lets you
> ensure that the cookies being used are the same.
>
> Also, for 1.7.0 onwards, you no longer need to put rabbit into the erlang
> lib dir - it be installed anywhere (the packages currently put it in
> /usr/lib/rabbitmq/lib).
>
> Paul.
>
> On Thu, Oct 29, 2009 at 6:04 PM, tracey eubanks <traceye at pmamediagroup.com
> > wrote:
>
>> I downloaded rabbitmq v1.7.0 and installed it into my /usr/local/lib/
>> erlang/lib (erlang vR13B02-1) directory then linked the rabbitmq-
>> server, rabbitmqctl, rabbitmq-multi and rabbitmq-env files to /bin. I
>> can start the server just fine but when I try to connect to it or run
>> rabbitmqctl status, it gives me this error,
>>
>> Error: unable to connect to node rabbit at mymac: nodedown
>> diagnostics:
>> - unable to connect to epmd on mymac: nxdomain
>> - current node: rabbitmqctl19789 at mymac
>> - current node home dir: /Users/administrator
>> - current node cookie hash: F0FO97xqCdIRZ5FhimfiDg==
>>
>>
>> I'm not sure what's going on. I installed rabbitmq v1.6.0 the same way
>> and everything works just fine.
>>
>> Thanks guys
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091029/9088645c/attachment.htm 

From traceye at pmamediagroup.com  Thu Oct 29 19:22:47 2009
From: traceye at pmamediagroup.com (tracey eubanks)
Date: Thu, 29 Oct 2009 13:22:47 -0600
Subject: [rabbitmq-discuss] rabbitmq node down..
In-Reply-To: <29598b610910291216t2fd65df1t5c539a2430398ba4@mail.gmail.com>
References: <DF3DC207-4E98-4E25-AE62-978B252F7FC1@pmamediagroup.com>
	<29598b610910291159g3aaed5f4k11e8cf460df9e337@mail.gmail.com>
	<7123AD88-FE43-49A8-B3C9-7D58CBD68D03@pmamediagroup.com>
	<29598b610910291216t2fd65df1t5c539a2430398ba4@mail.gmail.com>
Message-ID: <8749F206-D87D-4D08-8155-94CF46833D29@pmamediagroup.com>

Paul,
That was the problem. It works now.
Thanks!

On Oct 29, 2009, at 1:16 PM, Paul Jones wrote:

> Hi Tracey,
>
> I just noticed in your original email the message:
>   unable to connect to epmd on mymac: nxdomain
>
> Does "mymac" actually resolve to your local machine's address?  
> Perhaps try adding a hosts entry for it to make completely sure that  
> it will resolve.
>
> Paul.
>
> On Thu, Oct 29, 2009 at 7:10 PM, tracey eubanks <traceye at pmamediagroup.com 
> > wrote:
> Hey Paul,
> Here's the output when the server starts;
> sudo rabbitmq-server
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.0  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies  
> LLC., and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node          : rabbit at mymac
> app descriptor: /usr/local/lib/erlang/lib/rabbitmq-server-1.7.0/ 
> scripts/../ebin/rabbit.app
> home dir      : /Users/administrator
> cookie hash   : F0FO97xqCdIRZ5FhimfiDg==
> log           : /var/log/rabbitmq/rabbit.log
> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>
> starting database             ...done
> starting core processes       ...done
> starting recovery             ...done
> starting persister            ...done
> starting guid generator       ...done
> starting builtin applications ...done
> starting TCP listeners        ...done
> starting SSL listeners        ...done
>
> broker running
>
>
>
> This is from /var/log/rabbitmq/rabbit.log;
> =INFO REPORT==== 29-Oct-2009::12:35:48 ===
> disk_log: repairing "/var/lib/rabbitmq/mnesia/rabbit/ 
> rabbit_persister.LOG" ...
>
> =INFO REPORT==== 29-Oct-2009::12:35:48 ===
> Repaired persister log - 1 recovered, 0 bad
>
> =INFO REPORT==== 29-Oct-2009::12:35:48 ===
> Rolling persister log to "/var/lib/rabbitmq/mnesia/rabbit/ 
> rabbit_persister.LOG.previous"
>
> =INFO REPORT==== 29-Oct-2009::12:35:48 ===
> started TCP Listener on 0.0.0.0:5672
>
>
> Thanks
>
> On Oct 29, 2009, at 12:59 PM, Paul Jones wrote:
>
>> Hi Tracey,
>>
>> Could you please also supply the output shown when the server  
>> starts? (And in the log file). It should also display a cookie  
>> hash, which lets you ensure that the cookies being used are the same.
>>
>> Also, for 1.7.0 onwards, you no longer need to put rabbit into the  
>> erlang lib dir - it be installed anywhere (the packages currently  
>> put it in /usr/lib/rabbitmq/lib).
>>
>> Paul.
>>
>> On Thu, Oct 29, 2009 at 6:04 PM, tracey eubanks <traceye at pmamediagroup.com 
>> > wrote:
>> I downloaded rabbitmq v1.7.0 and installed it into my /usr/local/lib/
>> erlang/lib (erlang vR13B02-1) directory then linked the rabbitmq-
>> server, rabbitmqctl, rabbitmq-multi and rabbitmq-env files to /bin. I
>> can start the server just fine but when I try to connect to it or run
>> rabbitmqctl status, it gives me this error,
>>
>> Error: unable to connect to node rabbit at mymac: nodedown
>> diagnostics:
>> - unable to connect to epmd on mymac: nxdomain
>> - current node: rabbitmqctl19789 at mymac
>> - current node home dir: /Users/administrator
>> - current node cookie hash: F0FO97xqCdIRZ5FhimfiDg==
>>
>>
>> I'm not sure what's going on. I installed rabbitmq v1.6.0 the same  
>> way
>> and everything works just fine.
>>
>> Thanks guys
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091029/14b0bcce/attachment.htm 

From diclophis at gmail.com  Thu Oct 29 21:52:45 2009
From: diclophis at gmail.com (Jon Bardin)
Date: Thu, 29 Oct 2009 14:52:45 -0700
Subject: [rabbitmq-discuss] rabbitmqctl and performance issues
Message-ID: <c1d41d540910291452me8f164fi40bacfddd02748dc@mail.gmail.com>

Has anyone run into any problems "rapid firing" rabbitmqctl to get queue
information?

I am developing an application that needs to know if a queue has lost its
consumer is as close to real-time as possible...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091029/5974044e/attachment.htm 

From matthew at lshift.net  Thu Oct 29 22:40:25 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 29 Oct 2009 22:40:25 +0000
Subject: [rabbitmq-discuss] rabbitmqctl and performance issues
In-Reply-To: <c1d41d540910291452me8f164fi40bacfddd02748dc@mail.gmail.com>
References: <c1d41d540910291452me8f164fi40bacfddd02748dc@mail.gmail.com>
Message-ID: <20091029224024.GA13109@wellquite.org>

On Thu, Oct 29, 2009 at 02:52:45PM -0700, Jon Bardin wrote:
> Has anyone run into any problems "rapid firing" rabbitmqctl to get queue
> information?

Yes, don't do this. Queues are inspected using high priority msgs.
Firing too many of these in can degrade performance of Rabbit and
actually lead to higher memory usage because all queues have to respond
to the list_queues command, which prevents idle queues from hibernating,
which would free up resources.

That said I can't think of any immediate solutions to your problem -
maybe if you told us a little more about what you were trying to do,
we'd be able to propose a different solution.

Matthew



From niranjan.par at gmail.com  Fri Oct 30 05:10:50 2009
From: niranjan.par at gmail.com (niranjan)
Date: Fri, 30 Oct 2009 10:40:50 +0530
Subject: [rabbitmq-discuss] RabbitMQ server losing connections
Message-ID: <4AEA755A.8070501@gmail.com>

Hi All,

I am using RabbitMQ 1.6 with ruby AMQP to subscribe to the queue over 
the network. Immediately after starting the listeners I see the queues 
registered with the server (rabbitmqctl list_queues) as well as 
connections (rabbitmqctl list_connections).

~$ sudo rabbitmqctl list_connections
Listing connections ...
guest    10.7.253.22    53703
guest    10.7.253.12    55797
...done...done.

~$ sudo rabbitmqctl list_queues name durable messages messages_ready
Listing queues ...
foo_deletes    false    0    0
foo_updates    false    0    0
foo_creates    false    0    0
duplicate_listener_on_localhost  false    0    0
...done.

~$ netstat -anlp | grep 5672
tcp        0      0 0.0.0.0:5672            0.0.0.0:*               
LISTEN      -              
tcp        0      0 10.7.253.12:5672        10.7.253.12:55797       
ESTABLISHED -              
tcp        0      0 10.7.253.12:5672        10.7.253.22:53703       
ESTABLISHED -

After an hour or so server loses the connection with with listeners. The 
list_queues still shows all the queues but list_connections shows no 
active connections.

~$ sudo rabbitmqctl list_connections
Listing connections ...
...done...done.

~$ sudo rabbitmqctl list_queues name durable messages messages_ready
Listing queues ...
foo_deletes    false    0    0
foo_updates    false    0    0
foo_creates    false    0    0
duplicate_listener_on_localhost  false    0    0
...done.

~$ netstat -anlp | grep 5672
tcp        0      0 0.0.0.0:5672            0.0.0.0:*               
LISTEN      -              

I am not too sure which side lies the problem as on listener side I 
don't see any logs indicating that the connection is lost, but server 
definitely has lost it. Server not only loses the connection over the 
network but connection from localhost as well.

Has anyone faced similar problem or could you point out where I should 
start?

Thanks and Regards,
Niranjan




From scott.brooks at epicadvertising.com  Fri Oct 30 17:02:24 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Fri, 30 Oct 2009 12:02:24 -0500
Subject: [rabbitmq-discuss] rabbit-erlang-client/ebin/amqp_client.app.in
 refers to non existant files
Message-ID: <8A1AF416-6685-4E3B-A346-73D671A00E42@epicadvertising.com>

http://hg.rabbitmq.com/rabbitmq-erlang-client/file/7b812ff8bf61/ebin/amqp_client.app.in

vs files listed int

http://hg.rabbitmq.com/rabbitmq-erlang-client/file/7b812ff8bf61/src/

Are they going to be called

amqp_direct_connection.erl or amqp_direct_driver
amqp_network_connection.erl or amqp_network_driver

Thanks
Scott



From 0x6e6562 at gmail.com  Fri Oct 30 17:14:03 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 30 Oct 2009 17:14:03 +0000
Subject: [rabbitmq-discuss] rabbit-erlang-client/ebin/amqp_client.app.in
	refers to non existant files
In-Reply-To: <8A1AF416-6685-4E3B-A346-73D671A00E42@epicadvertising.com>
References: <8A1AF416-6685-4E3B-A346-73D671A00E42@epicadvertising.com>
Message-ID: <269388e30910301014m1bfea81epdb3e8da58091e921@mail.gmail.com>

Scott,

On Fri, Oct 30, 2009 at 5:02 PM, Scott Brooks
<scott.brooks at epicadvertising.com> wrote:
> http://hg.rabbitmq.com/rabbitmq-erlang-client/file/7b812ff8bf61/ebin/amqp_client.app.in
>
> vs files listed int
>
> http://hg.rabbitmq.com/rabbitmq-erlang-client/file/7b812ff8bf61/src/
>
> Are they going to be called
>
> amqp_direct_connection.erl or amqp_direct_driver
> amqp_network_connection.erl or amqp_network_driver

Ooops, we missed that when we refactored the drivers. The answer is
the former - the *_drivers are now toast. Interestingly enough,
nothing seems to be bothered by bogus module entries in the app
descriptor.

Thanks for the heads up,

Ben



From scott.brooks at epicadvertising.com  Fri Oct 30 17:19:14 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Fri, 30 Oct 2009 12:19:14 -0500
Subject: [rabbitmq-discuss] rabbit-erlang-client/ebin/amqp_client.app.in
 refers to non existant files
In-Reply-To: <269388e30910301014m1bfea81epdb3e8da58091e921@mail.gmail.com>
References: <8A1AF416-6685-4E3B-A346-73D671A00E42@epicadvertising.com>
	<269388e30910301014m1bfea81epdb3e8da58091e921@mail.gmail.com>
Message-ID: <FC84AB94-3D3E-4908-B500-83B13718F6EE@epicadvertising.com>

On 2009-10-30, at 1:14 PM, Ben Hood wrote:

> Scott,
>
> On Fri, Oct 30, 2009 at 5:02 PM, Scott Brooks
> <scott.brooks at epicadvertising.com> wrote:
>> http://hg.rabbitmq.com/rabbitmq-erlang-client/file/7b812ff8bf61/ebin/amqp_client.app.in
>>
>> vs files listed int
>>
>> http://hg.rabbitmq.com/rabbitmq-erlang-client/file/7b812ff8bf61/src/
>>
>> Are they going to be called
>>
>> amqp_direct_connection.erl or amqp_direct_driver
>> amqp_network_connection.erl or amqp_network_driver
>
> Ooops, we missed that when we refactored the drivers. The answer is
> the former - the *_drivers are now toast. Interestingly enough,
> nothing seems to be bothered by bogus module entries in the app
> descriptor.
>
> Thanks for the heads up,
>
> Ben

I've got a plugin I'm working on that is not loading due to that which  
is how I ran across it.

Scott



From traceye at pmamediagroup.com  Sat Oct 31 14:52:23 2009
From: traceye at pmamediagroup.com (Tracey Eubanks)
Date: Sat, 31 Oct 2009 08:52:23 -0600
Subject: [rabbitmq-discuss] RabbitMQ server losing connections
In-Reply-To: <4AEA755A.8070501@gmail.com>
References: <4AEA755A.8070501@gmail.com>
Message-ID: <FA86BFB2-2EFD-494A-B262-6155844C2D42@pmamediagroup.com>

Hey Niranjan,
Does the rabbitmq server log have any errors in it?



On Oct 29, 2009, at 11:10 PM, niranjan <niranjan.par at gmail.com> wrote:

> Hi All,
>
> I am using RabbitMQ 1.6 with ruby AMQP to subscribe to the queue over
> the network. Immediately after starting the listeners I see the queues
> registered with the server (rabbitmqctl list_queues) as well as
> connections (rabbitmqctl list_connections).
>
> ~$ sudo rabbitmqctl list_connections
> Listing connections ...
> guest    10.7.253.22    53703
> guest    10.7.253.12    55797
> ...done...done.
>
> ~$ sudo rabbitmqctl list_queues name durable messages messages_ready
> Listing queues ...
> foo_deletes    false    0    0
> foo_updates    false    0    0
> foo_creates    false    0    0
> duplicate_listener_on_localhost  false    0    0
> ...done.
>
> ~$ netstat -anlp | grep 5672
> tcp        0      0 0.0.0.0:5672            0.0.0.0:*
> LISTEN      -
> tcp        0      0 10.7.253.12:5672        10.7.253.12:55797
> ESTABLISHED -
> tcp        0      0 10.7.253.12:5672        10.7.253.22:53703
> ESTABLISHED -
>
> After an hour or so server loses the connection with with listeners.  
> The
> list_queues still shows all the queues but list_connections shows no
> active connections.
>
> ~$ sudo rabbitmqctl list_connections
> Listing connections ...
> ...done...done.
>
> ~$ sudo rabbitmqctl list_queues name durable messages messages_ready
> Listing queues ...
> foo_deletes    false    0    0
> foo_updates    false    0    0
> foo_creates    false    0    0
> duplicate_listener_on_localhost  false    0    0
> ...done.
>
> ~$ netstat -anlp | grep 5672
> tcp        0      0 0.0.0.0:5672            0.0.0.0:*
> LISTEN      -
>
> I am not too sure which side lies the problem as on listener side I
> don't see any logs indicating that the connection is lost, but server
> definitely has lost it. Server not only loses the connection over the
> network but connection from localhost as well.
>
> Has anyone faced similar problem or could you point out where I should
> start?
>
> Thanks and Regards,
> Niranjan
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From steve at changesciences.com  Sat Oct 31 19:03:22 2009
From: steve at changesciences.com (Steve Ellis)
Date: Sat, 31 Oct 2009 15:03:22 -0400
Subject: [rabbitmq-discuss] Could not upgrade the network driver to ssl
Message-ID: <4AEC89FA.4050008@changesciences.com>

OS: Ubuntu 8.04.1
Erlang Version: R12B-5
Rabbit Version: 1.7.0

I'm trying to get ssl going with the Erlang client. Have followed the
instructions here: http://www.rabbitmq.com/ssl.html creating all the
certificates etc.

I attempt to connect to the server with code like this:
SSLOptions = [{cacertfile, "/home/testca/cacert.pem"}, {certfile, 
"/home/client/cert.pem"}, {keyfile,"/home/client/key.pem"},{verify_code, 
0}],
Params = #amqp_params{username = <<"guest">>, password = <<"guest">>,
virtual_host = <<"/">>, host = "localhost", port = 5671, ssl_options  =
SSLOptions},
Connection = amqp_connection:start_network(Params),
....

And the Erlang shell says:

=ERROR REPORT==== 31-Oct-2009::14:07:59 ===
SSL: certify: ./ssl_connection.erl:1356:Fatal error: internal_error

=ERROR REPORT==== 31-Oct-2009::14:07:59 ===
Could not upgrade the network driver to ssl: esslerrssl
** exception exit: {badmatch,{error,esslerrssl}}
      in function  amqp_connection:start_network_internal/2
      in call from test_2:init/1
      in call from gen_server:init_it/6
      in call from proc_lib:init_p_do_apply/3

The rabbit.log says:
=INFO REPORT==== 31-Oct-2009::14:07:47 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 31-Oct-2009::14:07:47 ===
started SSL Listener on 0.0.0.0:5671

=INFO REPORT==== 31-Oct-2009::14:07:59 ===
accepted TCP connection on 0.0.0.0:5671 from 127.0.0.1:51406

=ERROR REPORT==== 31-Oct-2009::14:07:59 ===
SSL: hello: ./ssl_handshake.erl:227:Fatal error: internal_error

=ERROR REPORT==== 31-Oct-2009::14:07:59 ===
failed to upgrade TCP connection from 127.0.0.1:51406 to SSL:
esslerrssl

My rabbitmq.config file looks like this:

[{rabbit, [{ssl_listeners, [{"0.0.0.0",5671}]}, {ssl_options, 
[{cacertfile,"/home/testca/cacert.pem"},
{certfile,"/home/server/cert.pem"}, {keyfile,"/home/server/key.pem"}, 
{verify_code, 0}]}]}].

Thanks!








From matthew at lshift.net  Sat Oct 31 19:37:08 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Sat, 31 Oct 2009 19:37:08 +0000
Subject: [rabbitmq-discuss] Could not upgrade the network driver to ssl
In-Reply-To: <4AEC89FA.4050008@changesciences.com>
References: <4AEC89FA.4050008@changesciences.com>
Message-ID: <20091031193708.GA5572@wellquite.org>

Hi Steve,

Whilst I have had SSL working on Erlang as old as R12B5, I'm also
aware it is a little bit hit and miss. The SSL module shipped with
Erlang had more bugs back then and it sadly still has one or two bugs
even in the latest R13B02. SSL is also a fairly tricky thing to get
right it would seem - we've discovered bugs in the Mono implementation
too in the course of adding SSL support to RabbitMQ.

If you can, could you try to see if the Java tests work for you? If you
grab the Java client, build it, start up Rabbit, and then run:

rabbitmq-java-client# SSL_CERTS_DIR=/home/ PASSWORD=MySecretPassword ant test-ssl

where MySecretPassword is the password to the pkcs#12 file, and under
/home/ you have the client and server dirs as you seem to have, that
should give us some idea of whether it's a client or server issue - you
should, everything being well, get something like:

detect-ssl:

make-client-keystore:
     [exec] Certificate was added to keystore
     [exec] Certificate was added to keystore

test-ssl:
    [junit] Running com.rabbitmq.client.test.ssl.SSLTests
    [junit] Tests run: 3, Failures: 0, Errors: 0, Time elapsed: 1.166 sec

remove-client-keystore:
   [delete] Deleting: /tmp/tmp.hIOPseDjbs
   [delete] Deleting: /tmp/tmp.kfgI0FVTd6

You need the SSL_CERTS_DIR and PASSWORD env vars, otherwise the SSL
tests won't run. They will use the certs in /home/client

They should all work with verify_code set to 1 in the server - that's
how we run them as we deliberately have some negative tests to ensure
that the connection fails if the server asks for a certificate and the
client doesn't present one - so if you have verify_code set to 0, then
you will probably see one test fail as in that case, a connection can be
established when we were expecting it to fail.

If those won't work for you, I'd recommend you see if you can get hold
of a more recent version of Erlang - I certainly test the SSL support
with R13B02 frequently and it seems pretty reliable. That said, the
Erlang AMQP client is still not officially released and I suspect the
SSL code paths there get slightly less action. However, I've just
grabbed the latest version of the Erlang client default branch and run
the SSL tests (Don't have RabbitMQ running already. For these tests, I'm
reasonably sure you'll not only need to have compiled RabbitMQ yourself,
but also have the rabbitmq-server and rabbitmq-erlang-client directories
as siblings - the client tests will attempt to start up the broker
automatically):

rabbitmq-erlang-client# SSL_CERTS_DIR=/home/ make test_ssl

(PASSWORD isn't needed because neither the Erlang client nor server use
the pkcs#12 files), and all the tests pass for me on R13B02, so it may
very well be you're hitting a bug in R12B5's SSL module. I've also just
checked and realised that the tests in the Erlang client use the
new-style SSL module args, so you'll need to edit common.mk in the
Erlang client, and replace the
"{verify,verify_peer},{fail_if_no_peer_cert,true}" text with
"{verify_code,2}" to get the same behaviour.

Please let us know how you get on.

Matthew



From python.django.user at gmail.com  Sat Oct 31 23:37:47 2009
From: python.django.user at gmail.com (python.django.user)
Date: Sat, 31 Oct 2009 16:37:47 -0700 (PDT)
Subject: [rabbitmq-discuss]  how to use rabbitmq on shared hosting servers
Message-ID: <26146825.post@talk.nabble.com>


Hi,
I am thinking of setting up rabbitmq and erlang on a shared hosting web
server. Are there any pointers on how to install to a custom directory
without requiring administrative rights?

Thanks!
-- 
View this message in context: http://old.nabble.com/how-to-use-rabbitmq-on-shared-hosting-servers-tp26146825p26146825.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




