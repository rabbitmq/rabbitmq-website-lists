<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Should I upgrade all clients if I upgrade	the server to 2.2.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Should%20I%20upgrade%20all%20clients%20if%20I%20upgrade%0A%09the%20server%20to%202.2.0&In-Reply-To=%3CD9147D6D-4C4B-4517-8676-7A8BB1BE26CC%40npcinternational.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010183.html">
   <LINK REL="Next"  HREF="010185.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Should I upgrade all clients if I upgrade	the server to 2.2.0</H1>
    <B>Jon Brisbin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Should%20I%20upgrade%20all%20clients%20if%20I%20upgrade%0A%09the%20server%20to%202.2.0&In-Reply-To=%3CD9147D6D-4C4B-4517-8676-7A8BB1BE26CC%40npcinternational.com%3E"
       TITLE="[rabbitmq-discuss] Should I upgrade all clients if I upgrade	the server to 2.2.0">jon.brisbin at npcinternational.com
       </A><BR>
    <I>Tue Nov 30 14:54:33 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010183.html">[rabbitmq-discuss] Should I upgrade all clients if I upgrade the server to 2.2.0
</A></li>
        <LI>Next message: <A HREF="010185.html">[rabbitmq-discuss] Should I upgrade all clients if I upgrade the server to 2.2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10184">[ date ]</a>
              <a href="thread.html#10184">[ thread ]</a>
              <a href="subject.html#10184">[ subject ]</a>
              <a href="author.html#10184">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Nov 30, 2010, at 8:38 AM, Matthew Sackman wrote:

&gt;<i> Certainly should have done. Can you send us the logs and error message -
</I>&gt;<i> you said &quot;the broker wouldn't start&quot; - with what error? It's sounding as
</I>&gt;<i> if something's gone wrong.
</I>
The log file was huge (225MB), so I just excerpted it, the apt log, and a console transcript that shows the startup_[err|log]:

Apt log...

Setting up rabbitmq-server (2.2.0-1) ...
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action &quot;start&quot; failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit status 1
E: Sub-process /usr/bin/dpkg returned an error code (1)
A package failed to install.  Trying to recover:
Setting up rabbitmq-server (2.2.0-1) ...
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action &quot;start&quot; failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit status 1
Errors were encountered while processing:
 rabbitmq-server
Press return to continue.

Trying to start the broker manually...

+-( ~ ):&gt; sudo service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.

+-( ~ ):&gt; cat /var/log/rabbitmq/startup_err 
Erlang has closed
Error: {node_start_failed,normal}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})

+-( ~ ):&gt; cat /var/log/rabbitmq/startup_log 
Starting all nodes...
Starting node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at warehouse2...</A>
Activating RabbitMQ plugins ...
0 plugins activated:


+---+   +---+
|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   +---+   +-------+
</I>|<i>                   |
</I>|<i> RabbitMQ  +---+   |
</I>|<i>           |   |   |
</I>|<i>   v2.2.0  +---+   |
</I>|<i>                   |
</I>+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at warehouse2</A>
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.2.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
cookie hash    : LEz6QvNGm+HR8egGn/MvzQ==
log            : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at warehouse2.log</A>
sasl log       : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at warehouse2-sasl.log</A>
database dir   : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at warehouse2</A>
erlang version : 5.7.4

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...BOOT ERROR: FAILED
Reason: {error,{schema_mismatch,[add_ip_to_listener,add_queue_ttl,
                                 hash_passwords,remove_user_scope],
                                []}}
Stacktrace: [{rabbit_mnesia,ensure_version_ok,1},
             {rabbit_mnesia,init_db,2},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]
{&quot;Kernel pid terminated&quot;,application_controller,&quot;{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}&quot;}

From the log:

=ERROR REPORT==== 30-Nov-2010::08:17:12 ===
FAILED
Reason: {error,{schema_mismatch,[add_ip_to_listener,add_queue_ttl,
                                 hash_passwords,remove_user_scope],
                                []}}
Stacktrace: [{rabbit_mnesia,ensure_version_ok,1},
             {rabbit_mnesia,init_db,2},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]

=INFO REPORT==== 30-Nov-2010::08:17:13 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent


Jon Brisbin
Portal Webmaster
NPC International, Inc.



</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010183.html">[rabbitmq-discuss] Should I upgrade all clients if I upgrade the server to 2.2.0
</A></li>
	<LI>Next message: <A HREF="010185.html">[rabbitmq-discuss] Should I upgrade all clients if I upgrade the server to 2.2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10184">[ date ]</a>
              <a href="thread.html#10184">[ thread ]</a>
              <a href="subject.html#10184">[ subject ]</a>
              <a href="author.html#10184">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
