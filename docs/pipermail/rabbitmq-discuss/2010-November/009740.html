<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Protection against slow consumers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Protection%20against%20slow%20consumers&In-Reply-To=%3CA3F29C19-2170-415E-A80C-179E809BAE1C%40krutil.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009739.html">
   <LINK REL="Next"  HREF="009731.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Protection against slow consumers</H1>
    <B>Jiri Krutil</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Protection%20against%20slow%20consumers&In-Reply-To=%3CA3F29C19-2170-415E-A80C-179E809BAE1C%40krutil.com%3E"
       TITLE="[rabbitmq-discuss] Protection against slow consumers">jiri at krutil.com
       </A><BR>
    <I>Mon Nov  1 22:07:38 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009739.html">[rabbitmq-discuss] Protection against slow consumers
</A></li>
        <LI>Next message: <A HREF="009731.html">[rabbitmq-discuss] Protection against slow consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9740">[ date ]</a>
              <a href="thread.html#9740">[ thread ]</a>
              <a href="subject.html#9740">[ subject ]</a>
              <a href="author.html#9740">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In our use case, we assume that consumers will be fast and the message  
flow fairly low. So normally there should be almost no messages kept  
on the broker.

What we are concerned about is a consumer that (willingly or not)  
subscribes but does not consume, or consumes but does not ack.  
(Consumers are not under our control and belong to different clients  
that use our API.)

Of course we don't want one such funny consumer to disrupt the message  
flow to all other consumers (by draining broker memory or disk).

So anything that will prevent this should be OK - per-queue message  
TTL or per-queue limit on message count/size.

Cheers
Jiri


On 1 Nov 2010, at 21:27, Alexis Richardson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis at rabbitmq.com</A>&gt; wrote:

&gt;<i> Christian, Jiri,
</I>&gt;<i>
</I>&gt;<i> What are your thoughts on per message TTLs for this?
</I>&gt;<i>
</I>&gt;<i> alexis
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mon, Nov 1, 2010 at 6:41 PM, Christian Legnitto
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">clegnitto at mozilla.com</A>&gt; wrote:
</I>&gt;&gt;<i> There is not something like <A HREF="http://activemq.apache.org/slow-consumer-handling.html">http://activemq.apache.org/slow-consumer-handling.html</A> 
</I>&gt;&gt;<i>  for Rabbit. You can sort of approximate it with a maintenance  
</I>&gt;&gt;<i> script that sweeps through and drains messages from a queue  
</I>&gt;&gt;<i> depending on a heuristic of your choice.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We are interested in something like this too (see my message titled  
</I>&gt;&gt;<i> &quot;Missing features making me look at moving off RabbitMQ&quot; to the  
</I>&gt;&gt;<i> list).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Christian
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Nov 1, 2010, at 9:33 AM, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jiri at krutil.com</A> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi Emile
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I assume you have subscribers each set up with their own queue  
</I>&gt;&gt;&gt;&gt;<i> and binding.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Yes, each subscriber uses an exclusive auto-delete queue bound to  
</I>&gt;&gt;&gt;<i> the exchange.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> In this case I would expect long queues associated with slow  
</I>&gt;&gt;&gt;&gt;<i> subscribers to be persisted to disk automatically. This prevents  
</I>&gt;&gt;&gt;&gt;<i> RAM pressure, which the broker attempts to relieve by blocking  
</I>&gt;&gt;&gt;&gt;<i> producers.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I see what you mean, but what if the subscriber uses a large  
</I>&gt;&gt;&gt;<i> prefetch buffer and consumes without ever acking?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Also, even if long queues get persisted to disk, this consumes  
</I>&gt;&gt;&gt;<i> resources and the queues can't grow forever.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is there no way how can we limit the queue size or message time to  
</I>&gt;&gt;&gt;<i> live?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> This assumes that you are running version 2.0.0 or later.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We are running RabbitMQ 2.1.0.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Cheers
</I>&gt;&gt;&gt;<i> Jiri
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009739.html">[rabbitmq-discuss] Protection against slow consumers
</A></li>
	<LI>Next message: <A HREF="009731.html">[rabbitmq-discuss] Protection against slow consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9740">[ date ]</a>
              <a href="thread.html#9740">[ thread ]</a>
              <a href="subject.html#9740">[ subject ]</a>
              <a href="author.html#9740">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
