<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] does rabbit eat memory?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20does%20rabbit%20eat%20memory%3F&In-Reply-To=%3C4CEFE26D.2070204%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010125.html">
   <LINK REL="Next"  HREF="010135.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] does rabbit eat memory?</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20does%20rabbit%20eat%20memory%3F&In-Reply-To=%3C4CEFE26D.2070204%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] does rabbit eat memory?">simon at rabbitmq.com
       </A><BR>
    <I>Fri Nov 26 16:38:05 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010125.html">[rabbitmq-discuss] does rabbit eat memory?
</A></li>
        <LI>Next message: <A HREF="010135.html">[rabbitmq-discuss] DQOTD: Is publishing to an undeclared exchange	ok?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10126">[ date ]</a>
              <a href="thread.html#10126">[ thread ]</a>
              <a href="subject.html#10126">[ subject ]</a>
              <a href="author.html#10126">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Bear in mind that's set by default anyway (to 0.4).

RabbitMQ can benefit from keeping things in memory, but you don't want 
it to eat all your memory. Therefore it will try not to exceed (physical 
ram) * (vm_memory_high_watermark). It can go a bit over, but at that 
point it'll become much more aggressive about swapping messages out to 
disk so it's rare to go a long way over.

And as Matthew points out, GCing makes all this a bit approximate. But 
my workstation can sustain ca 20k messages per second for as long as 
I've cared to watch it.

Cheers, Simon

On 26/11/10 16:30, Jason J. W. Williams wrote:
&gt;<i> Have you tried setting vm_memory_high_watermark in the rabbitmq.config file?
</I>&gt;<i>
</I>&gt;<i> -J
</I>&gt;<i>
</I>&gt;<i> On Fri, Nov 26, 2010 at 9:15 AM, Robert Fuller&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">fullergalway at gmail.com</A>&gt;  wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Rabbitmq is very nice. Easy to install, and very easy to get running with it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We are experimenting using the java interfaces. We are publishing json
</I>&gt;&gt;<i> messages of various sizes to a queue from several servers. A single
</I>&gt;&gt;<i> thread is consuming these messages, acknowledging each message.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Having noticed memory consumption on our server I ran a test of using
</I>&gt;&gt;<i> a clean install, and adding 3600 messages to the queue, then consuming
</I>&gt;&gt;<i> these messages and checking for memory usage using top command. I
</I>&gt;&gt;<i> notice that the memory used by rabbitmq slowly creeps upwards.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is there a step I am missing to free some memory?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ps and status output below.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Rob.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the ps line at each stage:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
</I>&gt;&gt;<i> before publishing any messages:
</I>&gt;&gt;<i> 26643 rabbitmq  20   0  278m  34m 2844 S    0  0.2   0:01.43 beam.smp
</I>&gt;&gt;<i> after publishing 3666 messages to the queue:
</I>&gt;&gt;<i> 26643 rabbitmq  20   0  315m  65m 2924 S    0  0.4   0:05.21 beam.smp
</I>&gt;&gt;<i> consuming the messages from the queue.
</I>&gt;&gt;<i> after 1st cycle: (zero messages now in queue)
</I>&gt;&gt;<i> 26643 rabbitmq  20   0  300m  52m 2924 S    0  0.3   0:08.18 beam.smp
</I>&gt;&gt;<i> publish 3666 messages with consumer running...
</I>&gt;&gt;<i> after 2nd cycle:  (zero messages now in queue)
</I>&gt;&gt;<i> 26643 rabbitmq  20   0  306m  63m 2924 S    0  0.4   0:14.30 beam.smp
</I>&gt;&gt;<i> publish 3666 messages with consumer running...
</I>&gt;&gt;<i> after 3rd cycle:  (zero messages now in queue)
</I>&gt;&gt;<i> 26643 rabbitmq  20   0  316m  72m 2924 S    0  0.5   0:18.72 beam.smp
</I>&gt;&gt;<i> later, with all publisher/consumer connections now closed:
</I>&gt;&gt;<i> 26643 rabbitmq  20   0  316m  72m 2924 S    0  0.5   0:19.87 beam.smp
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Output of status command follows:
</I>&gt;&gt;<i> Status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at test</A> ...
</I>&gt;&gt;<i> [{running_applications,
</I>&gt;&gt;<i>      [{rabbit_management,&quot;RabbitMQ Management Console&quot;,&quot;2.1.1&quot;},
</I>&gt;&gt;<i>       {webmachine,&quot;webmachine&quot;,&quot;1.7.0&quot;},
</I>&gt;&gt;<i>       {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;2.1.1&quot;},
</I>&gt;&gt;<i>       {rabbit,&quot;RabbitMQ&quot;,&quot;2.1.1&quot;},
</I>&gt;&gt;<i>       {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.12&quot;},
</I>&gt;&gt;<i>       {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.4&quot;},
</I>&gt;&gt;<i>       {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.8&quot;},
</I>&gt;&gt;<i>       {rabbit_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.1.1&quot;},
</I>&gt;&gt;<i>       {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;1.3&quot;},
</I>&gt;&gt;<i>       {crypto,&quot;CRYPTO version 1&quot;,&quot;1.6.3&quot;},
</I>&gt;&gt;<i>       {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.2&quot;},
</I>&gt;&gt;<i>       {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.16.4&quot;},
</I>&gt;&gt;<i>       {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.13.4&quot;}]},
</I>&gt;&gt;<i>   {nodes,[{disc,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at test</A>]}]},
</I>&gt;&gt;<i>   {running_nodes,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at test</A>]}]
</I>&gt;&gt;<i> ...done.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> $ uname -a
</I>&gt;&gt;<i> Linux test 2.6.32-25-server #45-Ubuntu SMP Sat Oct 16 20:06:58 UTC
</I>&gt;&gt;<i> 2010 x86_64 GNU/Linux
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010125.html">[rabbitmq-discuss] does rabbit eat memory?
</A></li>
	<LI>Next message: <A HREF="010135.html">[rabbitmq-discuss] DQOTD: Is publishing to an undeclared exchange	ok?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10126">[ date ]</a>
              <a href="thread.html#10126">[ thread ]</a>
              <a href="subject.html#10126">[ subject ]</a>
              <a href="author.html#10126">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
