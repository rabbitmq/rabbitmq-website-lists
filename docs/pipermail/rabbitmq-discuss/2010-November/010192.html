<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Routing key questions/suggestions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Routing%20key%20questions/suggestions&In-Reply-To=%3C20101130180619.GN21718%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010191.html">
   <LINK REL="Next"  HREF="010193.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Routing key questions/suggestions</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Routing%20key%20questions/suggestions&In-Reply-To=%3C20101130180619.GN21718%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Routing key questions/suggestions">matthew at rabbitmq.com
       </A><BR>
    <I>Tue Nov 30 18:06:19 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010191.html">[rabbitmq-discuss] Routing key questions/suggestions
</A></li>
        <LI>Next message: <A HREF="010193.html">[rabbitmq-discuss] Routing key questions/suggestions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10192">[ date ]</a>
              <a href="thread.html#10192">[ thread ]</a>
              <a href="subject.html#10192">[ subject ]</a>
              <a href="author.html#10192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Nov 30, 2010 at 09:43:49AM -0800, Christian Legnitto wrote:
&gt;<i> 1. Why use &quot;.&quot; as the routing token separator?
</I>
Well, something has to be chosen, and whatever is chosen is going to be
inconvenient for someone. I don't know whether there was some reason to
choose . over anything else.

&gt;<i> Can we make it configurable on the broker?
</I>
Well, it's only code. Having had a quick look through, it seems like the
splitting is currently only done at the use point. So I reckon maybe the
only change that's needed is in rabbit_exchange_type_topic.erl, change
the split_topic_key/1 fun to split on whatever you want.

&gt;<i> Can we support sending a magic X-AMQP-ROUTING-SEPERATOR or something
</I>&gt;<i> header with the message so it can be anything and vary by message?
</I>
Erm that would be substantially more complex.

&gt;<i> 	* It seems like an odd choice to use a character that will show
</I>&gt;<i> 	up in data a lot
</I>
True. Maybe , would be a better choice given most programming languages
use , to separate list elements anyway.

&gt;<i> Example:
</I>&gt;<i> 
</I>&gt;<i> I'm listening to commit messages from GitHub. My binding is
</I>&gt;<i> github.push.*.mycoolproject, which means I want to listen to all push
</I>&gt;<i> messages by anyone for a project named mycoolproject. If someone's
</I>&gt;<i> github username has a period in it though, I won't see the messages
</I>&gt;<i> (github.push.john.smith.mycoolproject). If I bound with
</I>&gt;<i> github.push.#.mycoolproject I would see the previous message, but I
</I>&gt;<i> might also get messages for other projects with GitHub users that have
</I>&gt;<i> mycoolproject in their username
</I>&gt;<i> (github.push.this.is.mycoolproject.user.project2). I know this isn't
</I>&gt;<i> the best example, but I'm sick and my head is a bit murky ha.
</I>
Yeah, I know the feeling :/ As I said, _any_ choice is ultimately going
to collide with something else so you're always going to have to do some
sort of encoding / escaping yourself. It looks like AMQP doesn't support
any sort of escaping to prevent the . being interpreted as a semantic .
so you really are going to have to do translation to something other
than .

If, in your case, there is no character that cannot appear in a github
username (and I'd hope not - surely the whole web supports every unicode
code point by now...) then you're just not going to be able to solve
this. This possibly points to AMQP needing to change to support escaping
of . with a \

&gt;<i> 2. Are there are future plans to publish a message with multiple routing keys?
</I>
Not that I'm aware of.

&gt;<i> 	* I know I can publish the same message multiple times with different routing keys, seems inefficient
</I>
Indeed.

&gt;<i> For bugzilla messages, when someone changes a bug I send a
</I>&gt;<i> bug.changed.[field] message. Many tools want to pivot on specific
</I>&gt;<i> users though. It'd be nice to publish them also as
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bzuser at example.com.changed.bug</A> so those tools don't have to listen to
</I>&gt;<i> all changes and group by user themselves, which seems very
</I>&gt;<i> inefficient.
</I>
You could put _everything_ in the routing key.
$USER.$BUG_NUMBER.$FIELD
and then the different tools just need to choose where to put # and *.
If you prefix each field value with the field name then it ensures that
such binding keys can anchor in the right place which is useful when the
range of fields overlap. Eg QA and Assign fields - if you were trying to
match changes by me to bugs, you'd be ill-advised to just do #.matthew.#
given that that would match changes _not_ by me but for bugs where I'm
the QA or assignee. Thus a key of:

user.matthew.bug.12345.qa.matthew.assignee.matthew.field.status

then allows a much more precise match of #.qa.matthew.# for example.

Matthew
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010191.html">[rabbitmq-discuss] Routing key questions/suggestions
</A></li>
	<LI>Next message: <A HREF="010193.html">[rabbitmq-discuss] Routing key questions/suggestions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10192">[ date ]</a>
              <a href="thread.html#10192">[ thread ]</a>
              <a href="subject.html#10192">[ subject ]</a>
              <a href="author.html#10192">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
