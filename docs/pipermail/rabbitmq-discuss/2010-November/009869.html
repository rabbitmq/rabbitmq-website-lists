<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ 2.x.x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Usefulness%20of%20Channel.Flow%20with%20RabbitMQ%202.x.x&In-Reply-To=%3C4dddb88f-6938-4acc-9ee9-e26806034ad8%4035g2000prt.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009960.html">
   <LINK REL="Next"  HREF="009870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ 2.x.x</H1>
    <B>A. MacLeod</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Usefulness%20of%20Channel.Flow%20with%20RabbitMQ%202.x.x&In-Reply-To=%3C4dddb88f-6938-4acc-9ee9-e26806034ad8%4035g2000prt.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ 2.x.x">allister.macleod at gmail.com
       </A><BR>
    <I>Tue Nov  9 16:43:27 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009960.html">[rabbitmq-discuss] consume messages from exchanges
</A></li>
        <LI>Next message: <A HREF="009870.html">[rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ 2.x.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9869">[ date ]</a>
              <a href="thread.html#9869">[ thread ]</a>
              <a href="subject.html#9869">[ subject ]</a>
              <a href="author.html#9869">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi. I am researching AMQP flow control strategies to use for a
distributed application that uses RabbitMQ for interprocess message
passing.  The &quot;channel.flow&quot; and &quot;channel.flow_ok&quot; messages from the
AMQP spec at first seemed to be a useful first step for flow control.
However, from looking at various documentation, forum posts, and
looking at the RabbitMQ source, it looks like we may not get very much
benefit from channel.flow when we are using RabbitMQ version 2.0.0 or
later.

Am I correct in concluding that a RabbitMQ 2.x.x broker will never
generate a channel.flow message, ever?  I grepped the Erlang source
and saw that the broker responds to incoming channel.flow messages
appropriately.  There is a comment in the memory management code that
mentions that a memory alarm should cause channel.flow, but I did not
see anything in actual code to back that up.

A post from Marek M. in
<A HREF="http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/2d26d2d740c216be/a3ff743a389bb360">http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/2d26d2d740c216be/a3ff743a389bb360</A>
indicates that channel.flow behavior has changed between 1.8.1 and
2.0.0.  From what I understand, the broker now effects flow control by
just not reading bytes from the socket instead of issuing channel.flow
messages.  This is consistent with a test I ran, using the 2.0.0 Java
client library, where I have a producer thread continuously shove 8kb
messages into a direct exchange, and have a slow-poke consumer using
basic.consume to receive acknowledgement-required messages very
slowly.  Once the memory fills up, the producer visibly slows down,
but FlowListener never has handleFlow called.

I have also tried some experiments where I use something like
consumerChannel.flow(false) to stop flow on the consumer's channel.
However, when I try to reopen the flow by doing
consumerChannel.flow(true), my consumer instance (of a class derived
from DefaultConsumer) never receives any more messages.  Do I need to
re-issue consumerChannel.basicConsume(...) after I re-enable flow from
the consumer side?

Thanks in advance,
  Allister
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009960.html">[rabbitmq-discuss] consume messages from exchanges
</A></li>
	<LI>Next message: <A HREF="009870.html">[rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ 2.x.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9869">[ date ]</a>
              <a href="thread.html#9869">[ thread ]</a>
              <a href="subject.html#9869">[ subject ]</a>
              <a href="author.html#9869">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
