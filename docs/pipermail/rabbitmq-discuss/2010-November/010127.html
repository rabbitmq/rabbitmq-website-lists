<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] does rabbit eat memory?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20does%20rabbit%20eat%20memory%3F&In-Reply-To=%3CAANLkTimB3DOW%3D-1c_emewsT5xQR%2BddH6CRc9ifhMPCYE%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010123.html">
   <LINK REL="Next"  HREF="010129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] does rabbit eat memory?</H1>
    <B>Robert Fuller</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20does%20rabbit%20eat%20memory%3F&In-Reply-To=%3CAANLkTimB3DOW%3D-1c_emewsT5xQR%2BddH6CRc9ifhMPCYE%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] does rabbit eat memory?">fullergalway at gmail.com
       </A><BR>
    <I>Fri Nov 26 16:44:51 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010123.html">[rabbitmq-discuss] does rabbit eat memory?
</A></li>
        <LI>Next message: <A HREF="010129.html">[rabbitmq-discuss] does rabbit eat memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10127">[ date ]</a>
              <a href="thread.html#10127">[ thread ]</a>
              <a href="subject.html#10127">[ subject ]</a>
              <a href="author.html#10127">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26 November 2010 16:33, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt; wrote:
&gt;<i> On Fri, Nov 26, 2010 at 04:28:14PM +0000, Robert Fuller wrote:
</I>&gt;&gt;<i> On 26 November 2010 16:19, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; On Fri, Nov 26, 2010 at 04:15:53PM +0000, Robert Fuller wrote:
</I>&gt;&gt;<i> &gt;&gt; Having noticed memory consumption on our server I ran a test of using
</I>&gt;&gt;<i> &gt;&gt; a clean install, and adding 3600 messages to the queue, then consuming
</I>&gt;&gt;<i> &gt;&gt; these messages and checking for memory usage using top command. I
</I>&gt;&gt;<i> &gt;&gt; notice that the memory used by rabbitmq slowly creeps upwards.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Are you acknowledging messages or consuming with noAck/autoAck = true ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The consumer is acknowledging each message.
</I>&gt;<i>
</I>&gt;<i> Ok, in which case there's nothing more you can do. Erlang is a GC'd
</I>&gt;<i> language and so when it obtains memory on demand, it may choose not to
</I>&gt;<i> promptly return that memory to the OS. It might take a while for some
</I>&gt;<i> large contiguous block of free memory to occur before Erlang free's the
</I>&gt;<i> memory.
</I>&gt;<i>
</I>&gt;<i> Thus whilst the memory use of Rabbit may initially rise, provided you
</I>&gt;<i> keep draining the queues such that they don't grow endlessly, you should
</I>&gt;<i> find the memory use levels out after a while.
</I>
Thanks Mathew, this makes sense and also maybe sheds some light on the
larger picture which is this: Over a number of hours during our
producers were producing a few million messages at about the same rate
the consumer was able to process them. However, because the consumer
started after the producer, there remained at all times some thousands
of messages in the queue. Memory consumption seemed to rise and rise.
Is it only when the queue reaches a zero size that the memory is
cleared?

What strategies would you suggest for dealing with this?

One I can think of would be to maintain a rotation of queues... after
putting a million messages onto any queue move on to the next queue.
The consumer, finding no messages on a queue will move to the next
queue in the rotation. Is this reasonable?


&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010123.html">[rabbitmq-discuss] does rabbit eat memory?
</A></li>
	<LI>Next message: <A HREF="010129.html">[rabbitmq-discuss] does rabbit eat memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10127">[ date ]</a>
              <a href="thread.html#10127">[ thread ]</a>
              <a href="subject.html#10127">[ subject ]</a>
              <a href="author.html#10127">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
