<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Java client: Closing channel in channel shutdown listener
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Java%20client%3A%20Closing%20channel%20in%20channel%0A%20shutdown%20listener&In-Reply-To=%3C4CD1731D.5080602%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009761.html">
   <LINK REL="Next"  HREF="009768.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Java client: Closing channel in channel shutdown listener</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Java%20client%3A%20Closing%20channel%20in%20channel%0A%20shutdown%20listener&In-Reply-To=%3C4CD1731D.5080602%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Java client: Closing channel in channel shutdown listener">simon at rabbitmq.com
       </A><BR>
    <I>Wed Nov  3 14:35:09 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009761.html">[rabbitmq-discuss] Java client: Closing channel in channel shutdown	listener
</A></li>
        <LI>Next message: <A HREF="009768.html">[rabbitmq-discuss] Java client: Closing channel in channel shutdown listener
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9762">[ date ]</a>
              <a href="thread.html#9762">[ thread ]</a>
              <a href="subject.html#9762">[ subject ]</a>
              <a href="author.html#9762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/11/10 14:19, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jiri at krutil.com</A> wrote:
&gt;<i> Using the Java client, I have a shutdown listener registered on a
</I>&gt;<i> channel. When this listener gets invoked, I attempt to close all AMQP
</I>&gt;<i> resources. This includes closing other channels.
</I>&gt;<i>
</I>&gt;<i> When I attempt to close another channel inside the channel shutdown
</I>&gt;<i> listener, the connection thread seems to hang. The call stack looks like
</I>&gt;<i> this:
</I>
Hi Jiri. The shutdown listener is invoked by the connection's mainloop 
thread, so it can't in itself do anything that involves sending data 
over the connection (which includes closing channels).

Do you need to close channels? If the error is hard, the connection will 
be closed and implicitly all channels will close; if the error is soft 
only the channel that caused the error will close and the others will 
keep working.

Cheers, Simon

&gt;<i>
</I>&gt;<i> BlockingValueOrException&lt;V,E&gt;.uninterruptibleGetValue(int) line: 51
</I>&gt;<i> AMQChannel$SimpleBlockingRpcContinuation(AMQChannel$BlockingRpcContinuation&lt;T&gt;).getReply(int)
</I>&gt;<i> line: 348
</I>&gt;<i> ChannelN.close(int, String, boolean, Throwable, boolean) line: 416
</I>&gt;<i> ChannelN.close(int, String) line: 360
</I>&gt;<i> ChannelN.close() line: 353
</I>&gt;<i> MyClass.shutdownCompleted(ShutdownSignalException) line: 40
</I>&gt;<i> ChannelN(ShutdownNotifierComponent).notifyListeners() line: 74
</I>&gt;<i> ChannelN.processAsync(Command) line: 242
</I>&gt;<i> ChannelN(AMQChannel).handleCompleteInboundCommand(AMQCommand) line: 165
</I>&gt;<i> ChannelN(AMQChannel).handleFrame(Frame) line: 110
</I>&gt;<i> AMQConnection$MainLoop.run() line: 434
</I>&gt;<i>
</I>&gt;<i> Both broker and Java client are 2.1.0.
</I>&gt;<i>
</I>&gt;<i> Am I doing something I shouldn't?
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> Jiri
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009761.html">[rabbitmq-discuss] Java client: Closing channel in channel shutdown	listener
</A></li>
	<LI>Next message: <A HREF="009768.html">[rabbitmq-discuss] Java client: Closing channel in channel shutdown listener
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9762">[ date ]</a>
              <a href="thread.html#9762">[ thread ]</a>
              <a href="subject.html#9762">[ subject ]</a>
              <a href="author.html#9762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
