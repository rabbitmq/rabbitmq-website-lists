<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] does rabbit eat memory?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20does%20rabbit%20eat%20memory%3F&In-Reply-To=%3CAANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010133.html">
   <LINK REL="Next"  HREF="010118.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] does rabbit eat memory?</H1>
    <B>Robert Fuller</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20does%20rabbit%20eat%20memory%3F&In-Reply-To=%3CAANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] does rabbit eat memory?">fullergalway at gmail.com
       </A><BR>
    <I>Fri Nov 26 16:15:53 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010133.html">[rabbitmq-discuss] RES:  RES: Exchanges and Queues
</A></li>
        <LI>Next message: <A HREF="010118.html">[rabbitmq-discuss] does rabbit eat memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10117">[ date ]</a>
              <a href="thread.html#10117">[ thread ]</a>
              <a href="subject.html#10117">[ subject ]</a>
              <a href="author.html#10117">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Rabbitmq is very nice. Easy to install, and very easy to get running with it.

We are experimenting using the java interfaces. We are publishing json
messages of various sizes to a queue from several servers. A single
thread is consuming these messages, acknowledging each message.

Having noticed memory consumption on our server I ran a test of using
a clean install, and adding 3600 messages to the queue, then consuming
these messages and checking for memory usage using top command. I
notice that the memory used by rabbitmq slowly creeps upwards.

Is there a step I am missing to free some memory?

ps and status output below.

Thanks,
Rob.

Here is the ps line at each stage:

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
before publishing any messages:
26643 rabbitmq  20   0  278m  34m 2844 S    0  0.2   0:01.43 beam.smp
after publishing 3666 messages to the queue:
26643 rabbitmq  20   0  315m  65m 2924 S    0  0.4   0:05.21 beam.smp
consuming the messages from the queue.
after 1st cycle: (zero messages now in queue)
26643 rabbitmq  20   0  300m  52m 2924 S    0  0.3   0:08.18 beam.smp
publish 3666 messages with consumer running...
after 2nd cycle:  (zero messages now in queue)
26643 rabbitmq  20   0  306m  63m 2924 S    0  0.4   0:14.30 beam.smp
publish 3666 messages with consumer running...
after 3rd cycle:  (zero messages now in queue)
26643 rabbitmq  20   0  316m  72m 2924 S    0  0.5   0:18.72 beam.smp
later, with all publisher/consumer connections now closed:
26643 rabbitmq  20   0  316m  72m 2924 S    0  0.5   0:19.87 beam.smp


Output of status command follows:
Status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at test</A> ...
[{running_applications,
     [{rabbit_management,&quot;RabbitMQ Management Console&quot;,&quot;2.1.1&quot;},
      {webmachine,&quot;webmachine&quot;,&quot;1.7.0&quot;},
      {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;2.1.1&quot;},
      {rabbit,&quot;RabbitMQ&quot;,&quot;2.1.1&quot;},
      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.12&quot;},
      {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.4&quot;},
      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.8&quot;},
      {rabbit_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.1.1&quot;},
      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;1.3&quot;},
      {crypto,&quot;CRYPTO version 1&quot;,&quot;1.6.3&quot;},
      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.2&quot;},
      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.16.4&quot;},
      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.13.4&quot;}]},
 {nodes,[{disc,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at test</A>]}]},
 {running_nodes,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at test</A>]}]
...done.


$ uname -a
Linux test 2.6.32-25-server #45-Ubuntu SMP Sat Oct 16 20:06:58 UTC
2010 x86_64 GNU/Linux
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010133.html">[rabbitmq-discuss] RES:  RES: Exchanges and Queues
</A></li>
	<LI>Next message: <A HREF="010118.html">[rabbitmq-discuss] does rabbit eat memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10117">[ date ]</a>
              <a href="thread.html#10117">[ thread ]</a>
              <a href="subject.html#10117">[ subject ]</a>
              <a href="author.html#10117">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
