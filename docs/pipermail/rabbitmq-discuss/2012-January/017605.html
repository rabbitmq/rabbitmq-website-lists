<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mnesia crash after RabbitMQ node machine restart	(clustered)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mnesia%20crash%20after%20RabbitMQ%20node%20machine%20restart%0A%09%28clustered%29&In-Reply-To=%3Cfca8dc17-ec6b-41d4-b0bf-5bc213d54469%40e27g2000vbu.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017607.html">
   <LINK REL="Next"  HREF="017611.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mnesia crash after RabbitMQ node machine restart	(clustered)</H1>
    <B>LuCo</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mnesia%20crash%20after%20RabbitMQ%20node%20machine%20restart%0A%09%28clustered%29&In-Reply-To=%3Cfca8dc17-ec6b-41d4-b0bf-5bc213d54469%40e27g2000vbu.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Mnesia crash after RabbitMQ node machine restart	(clustered)">lucooo at gmail.com
       </A><BR>
    <I>Tue Jan 24 09:32:54 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017607.html">[rabbitmq-discuss] erroneous basicGet closing the channel?
</A></li>
        <LI>Next message: <A HREF="017611.html">[rabbitmq-discuss] Mnesia crash after RabbitMQ node machine restart (clustered)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17605">[ date ]</a>
              <a href="thread.html#17605">[ thread ]</a>
              <a href="subject.html#17605">[ subject ]</a>
              <a href="author.html#17605">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello.

We have a RabbitMQ cluster across 2 machines. Machine 1 is created as
a disc node, and Machine 2 as a memory node.

These machines are restarted on the weekend every week. This has not
been a problem over the last 5 weeks (since trialling RabbitMQ) and
during this time the nodes have been little used, however the weekend
just passed resulted in the error below on the disc node just after
the machine on which the node runs was restarted:

&quot;
=ERROR REPORT==== 22-Jan-2012::01:17:37 ===
Mnesia('<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE1</A>'): ** ERROR ** (core dumped to file: &quot;c:/
Documents and Settings/user/Application Data/RabbitMQ/
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">MnesiaCore.rabbit at MACHINE1_1327_195058_860060</A>&quot;)
 ** FATAL ** Failed to merge schema: Bad cookie in table definition
mirrored_sup_childspec: '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE1</A>' =
{cstruct,mirrored_sup_childspec,ordered_set,
['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE2</A>,'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE1</A>'],[],[],0,read_write,false,[],
[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],
{{1324,33984,878002},'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE1</A>'},{{5,0},{'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE2</A>',
{1324,34466,491790}}}}, '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE2</A>' =
{cstruct,mirrored_sup_childspec,ordered_set,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE2</A>'],[],[],
0,read_write,false,[],[],false,mirrored_sup_childspec,
[key,mirroring_pid,childspec],[],[],
{{1327,194914,615072},'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MACHINE2</A>'},{{2,0},[]}}
=ERROR REPORT==== 22-Jan-2012::01:17:44 ===
** Generic server mnesia_subscr terminating
** Last message in was {'EXIT',&lt;0.51.0&gt;,killed}
** When Server state == {state,&lt;0.51.0&gt;,57361}
** Reason for termination ==
** killed
=ERROR REPORT==== 22-Jan-2012::01:17:44 ===
** Generic server mnesia_monitor terminating
** Last message in was {'EXIT',&lt;0.51.0&gt;,killed}
** When Server state == {state,&lt;0.51.0&gt;,[],[],true,[],undefined,[]}
** Reason for termination ==
** killed
=ERROR REPORT==== 22-Jan-2012::01:17:44 ===
** Generic server mnesia_recover terminating
** Last message in was {'EXIT',&lt;0.51.0&gt;,killed}
** When Server state == {state,&lt;0.51.0&gt;,undefined,undefined,undefined,
0,false,
                               true,[]}
** Reason for termination ==
** killed
=ERROR REPORT==== 22-Jan-2012::01:17:44 ===
** Generic server mnesia_snmp_sup terminating
** Last message in was {'EXIT',&lt;0.51.0&gt;,killed}
** When Server state == {state,
                            {local,mnesia_snmp_sup},
                            simple_one_for_one,
                            [{child,undefined,mnesia_snmp_sup,
                                 {mnesia_snmp_hook,start,[]},
                                 transient,3000,worker,
                                 [mnesia_snmp_sup,mnesia_snmp_hook,
                                  supervisor]}],
                            undefined,0,86400000,[],mnesia_snmp_sup,
[]}
** Reason for termination ==
** killed
=INFO REPORT==== 22-Jan-2012::01:17:44 ===
    application: mnesia
    exited: {shutdown,{mnesia_sup,start,[normal,[]]}}
    type: permanent
&quot;

The memory node then had this error in the log just after the machine
on which the node runs was restarted:
&quot;
=INFO REPORT==== 22-Jan-2012::01:12:08 ===
node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at G1SVR2-IIS</A>' lost 'rabbit'
=INFO REPORT==== 22-Jan-2012::01:12:08 ===
Statistics database started.
=INFO REPORT==== 22-Jan-2012::01:15:13 ===
Limiting to approx 924 file handles (829 sockets)
=INFO REPORT==== 22-Jan-2012::01:15:14 ===
    application: mnesia
    exited: stopped
    type: permanent
=INFO REPORT==== 22-Jan-2012::01:15:14 ===
Memory limit set to 818MB of 2047MB total.
...&lt;log continues with default initialisation of the node&gt;...
&quot;

As mentioned, the nodes have been seldom used and contained only 2
durable queues. This crash resulted in the nodes resuming their
default configuration (lost previously configured users).

The times on the machines above are the same so I am a little confused
at the messages on the MACHINE 2 (memory) which seems to have crashed
before MACHINE 1?

I can understand why this has possibly happened (one node up/one node
down when attempting to cluster on restart) but why has it not
happened the previous 5 restarts? What actually happens on a Rabbit
restart (following server restart) in a cluster scenario? Do I need a
custom start up script to cover all bases?

Any thoughts?

Daniel

</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017607.html">[rabbitmq-discuss] erroneous basicGet closing the channel?
</A></li>
	<LI>Next message: <A HREF="017611.html">[rabbitmq-discuss] Mnesia crash after RabbitMQ node machine restart (clustered)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17605">[ date ]</a>
              <a href="thread.html#17605">[ thread ]</a>
              <a href="subject.html#17605">[ subject ]</a>
              <a href="author.html#17605">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
