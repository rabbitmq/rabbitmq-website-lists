<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] High publish rates, mirrored queues,	high watermark...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20publish%20rates%2C%20mirrored%20queues%2C%0A%09high%20watermark...&In-Reply-To=%3C9BA1A4042F8141F8973C36034BCFDFB2%40jimeh.me%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017599.html">
   <LINK REL="Next"  HREF="017348.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] High publish rates, mirrored queues,	high watermark...</H1>
    <B>Jim Myhrberg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20publish%20rates%2C%20mirrored%20queues%2C%0A%09high%20watermark...&In-Reply-To=%3C9BA1A4042F8141F8973C36034BCFDFB2%40jimeh.me%3E"
       TITLE="[rabbitmq-discuss] High publish rates, mirrored queues,	high watermark...">contact at jimeh.me
       </A><BR>
    <I>Thu Jan 12 16:41:58 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017599.html">[rabbitmq-discuss] rabbitmq-c API improvements for multiple	channels
</A></li>
        <LI>Next message: <A HREF="017348.html">[rabbitmq-discuss] High publish rates, mirrored queues, high watermark...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17347">[ date ]</a>
              <a href="thread.html#17347">[ thread ]</a>
              <a href="subject.html#17347">[ subject ]</a>
              <a href="author.html#17347">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, I was hoping you guys would be able to answer some quick questions about an issue we're having.

We've recently started using mirrored queues across two RabbitMQ instances on two servers, and it's working really well except for when publish rates are really high for a longer period of time. At that point RabbitMQ starts eating a lot of memory on the master node until it hits our high watermark limit of 18.9GB, at which point things basically stop working.

My theory of what is happening is that when RabbitMQ can't process incoming publish requests fast enough, it caches the raw TCP packets in memory until it can deal with them and direct it to the queue(s) in question. And I'm assuming the fact that we are using mirrored queues adds overhead in dealing with a publish request as it needs to be synced to the other node(s). Am I right?

My theory is based on the fact that we could deal with much higher publish rates without and problems before we switched to mirrored queues. And the fact that we've had a few points when memory usage has been excessive we've seen queues that were completely empty according to the management plugin, but our workers were still processing +1000 messages/sec for a good hour, all the while the management plugin said no incoming messages, and +1000 msg/s get/acks.

Thanks :)


-jim 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/602e7f4d/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/602e7f4d/attachment.htm</A>&gt;
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017599.html">[rabbitmq-discuss] rabbitmq-c API improvements for multiple	channels
</A></li>
	<LI>Next message: <A HREF="017348.html">[rabbitmq-discuss] High publish rates, mirrored queues, high watermark...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17347">[ date ]</a>
              <a href="thread.html#17347">[ thread ]</a>
              <a href="subject.html#17347">[ subject ]</a>
              <a href="author.html#17347">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
