<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question	related to workload distribution
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Brabbitmq-consistent-hash-exchange%5D%20Question%0A%09related%20to%20workload%20distribution&In-Reply-To=%3C94c214ac-239b-4de0-87f9-0fcada595db9%4018g2000yqe.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017676.html">
   <LINK REL="Next"  HREF="017681.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question	related to workload distribution</H1>
    <B>Josh Stone</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Brabbitmq-consistent-hash-exchange%5D%20Question%0A%09related%20to%20workload%20distribution&In-Reply-To=%3C94c214ac-239b-4de0-87f9-0fcada595db9%4018g2000yqe.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question	related to workload distribution">pacesysjosh at gmail.com
       </A><BR>
    <I>Wed Jan 25 23:47:35 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017676.html">[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question related to workload distribution
</A></li>
        <LI>Next message: <A HREF="017681.html">[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question related to workload distribution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17678">[ date ]</a>
              <a href="thread.html#17678">[ thread ]</a>
              <a href="subject.html#17678">[ subject ]</a>
              <a href="author.html#17678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthew - That is very true about the hash keys.

Regarding workers seeing a message with a routing key they're not
expecting, I'm not sure how a worker would know if a message is
acceptable for them without knowing what the hash ring looks like. If
our workers did mirror the hash algorithm, when a re-mapping occurred
they could check locally to see what work was effected. This brings us
closer to something like Dynamo where each node maintains a view of
the hash ring. In our case, each worker's view of the hash ring would
match that on the consistent hash exchange. This is likely the only
way they could handle key-remappings.

Has anyone gone down this road?

Josh

On Jan 25, 3:33&#160;pm, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matt... at rabbitmq.com</A>&gt; wrote:
&gt;<i> On Wed, Jan 25, 2012 at 01:29:35PM -0800, Josh Stone wrote:
</I>&gt;<i> &gt; A followup question. When a new queue is created and a key-remapping
</I>&gt;<i> &gt; occurs, is there any way I could learn which keys were re-mapped? This
</I>&gt;<i> &gt; would allow me to migrate and data/work corresponding to those keys.
</I>&gt;<i> &gt; Perhaps a message could be published to a common queue indicating
</I>&gt;<i> &gt; which keys were re-mapped.
</I>&gt;<i>
</I>&gt;<i> The binding (and thus queue) selected by the consistent hash exachange
</I>&gt;<i> is selected by hashing the message's routing key, and then finding the
</I>&gt;<i> nearest higher binding. Given an infinite number of routing keys will
</I>&gt;<i> hash to the same result, no such message could be constructed to say
</I>&gt;<i> which routing keys have been remapped. The best you could do would be to
</I>&gt;<i> somehow keep track of every routing key the exchange has ever seen, and
</I>&gt;<i> from that figure out which of those would have been routed differently
</I>&gt;<i> in light of the additional-or-loss-of queue/binding. That also isn't
</I>&gt;<i> feasible.
</I>&gt;<i>
</I>&gt;<i> In general, you should probably assume you have relatively little churn
</I>&gt;<i> off such an exchange, and thus if a worker does see a message with a
</I>&gt;<i> routing key it's not expected (caused by eg loss of a queue) then
</I>&gt;<i> propogate the error further up and restart the corresponding session on
</I>&gt;<i> the publishing side so that the entire set of messages with that routing
</I>&gt;<i> key get resent.
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017676.html">[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question related to workload distribution
</A></li>
	<LI>Next message: <A HREF="017681.html">[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question related to workload distribution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17678">[ date ]</a>
              <a href="thread.html#17678">[ thread ]</a>
              <a href="subject.html#17678">[ subject ]</a>
              <a href="author.html#17678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
