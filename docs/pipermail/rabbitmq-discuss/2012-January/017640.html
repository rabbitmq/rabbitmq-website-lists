<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20server%20performance%20issue%20%28erl.exe%29&In-Reply-To=%3C8fc9ce15-481d-42ab-8aab-0062443c1d3b%40o4g2000pbc.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017792.html">
   <LINK REL="Next"  HREF="017652.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)</H1>
    <B>Yogesh Ketkar</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20server%20performance%20issue%20%28erl.exe%29&In-Reply-To=%3C8fc9ce15-481d-42ab-8aab-0062443c1d3b%40o4g2000pbc.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)">yogimogi at gmail.com
       </A><BR>
    <I>Wed Jan 25 08:30:54 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017792.html">[rabbitmq-discuss] State-of-the-art Perl client?
</A></li>
        <LI>Next message: <A HREF="017652.html">[rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17640">[ date ]</a>
              <a href="thread.html#17640">[ thread ]</a>
              <a href="subject.html#17640">[ subject ]</a>
              <a href="author.html#17640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is what I played around with.
Had around 5000 messages (each with 20 bytes of payload) pumped on a
queue say MainQueue.

MainQueue has a single consumer which reads messages from the queue
and based on payload does
queueDeclare and routes the messages to newly/already declared queue.
There would at most be 100 queues with name
Queue-1 to Queue-100 which would get generated based on the payload.

There is a threadpool (with 10 threads) which is under control of a
ExecutorService.
Each thread is provided a queue name to work on. Thread reads all the
messages from that queue (using basicGet) and in the end
deletes the queue. Each thread creates a new channel and closes it in
the end.
So overall at any point of time at the most 11 channels are in use (1
by MainQueue consumer and 10 by threads), which I
verified by running rabbitmqadmin.py list channels.

This worked for 5000 messages, but moment I pumped in another 10000
messages on MainQueue, things fell apart.
It started taking 5-10 seconds just for consumer to consume a message
from MainQueue and deliver it to appropriate queue.
When this starts happening erl.exe process is still taking 100% CPU no
matter what you do (killing all consumer Java programs, deleting all
the queues, with rabbitmqadmin.py), CPU usage by erl.exe is still 100%
and now unless you restart the service
RabbitMQ is almost unusable.

I even checked rabbitmqadmin.py list (channels, queues, connections),
everything showed 0. But still CPU consumption was 100%.

Environment: Windowns 7, RAM 4GB

Any clues how to debug this?

regards, Yogesh
</PRE>





















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017792.html">[rabbitmq-discuss] State-of-the-art Perl client?
</A></li>
	<LI>Next message: <A HREF="017652.html">[rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17640">[ date ]</a>
              <a href="thread.html#17640">[ thread ]</a>
              <a href="subject.html#17640">[ subject ]</a>
              <a href="author.html#17640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
