<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Unable to build Debian package since 2.7.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unable%20to%20build%20Debian%20package%20since%202.7.0&In-Reply-To=%3CCAHoS6UZiEGuwwKKAjhYp0z9XCNcDGGE2%3Dy6n%2BTu%3DifW38HfcHQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017176.html">
   <LINK REL="Next"  HREF="017177.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Unable to build Debian package since 2.7.0</H1>
    <B>Jared Biel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unable%20to%20build%20Debian%20package%20since%202.7.0&In-Reply-To=%3CCAHoS6UZiEGuwwKKAjhYp0z9XCNcDGGE2%3Dy6n%2BTu%3DifW38HfcHQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Unable to build Debian package since 2.7.0">jared.biel at bolderthinking.com
       </A><BR>
    <I>Thu Jan  5 16:53:12 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017176.html">[rabbitmq-discuss] Unable to build Debian package since 2.7.0
</A></li>
        <LI>Next message: <A HREF="017177.html">[rabbitmq-discuss] Unable to build Debian package since 2.7.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17185">[ date ]</a>
              <a href="thread.html#17185">[ thread ]</a>
              <a href="subject.html#17185">[ subject ]</a>
              <a href="author.html#17185">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon,

I'm not sure what logic Debian uses when determining to implement a
START=yes/no function in init scripts. Apache 2 installs and listens
on 0.0.0.0 but MySQL runs through a postinst configure script before
it starts up. There are some daemons that don't start out of the box
without editing an /etc/default file: monit, puppet, saslauthd,
opensips (3rd party package from vendor.)

The packages that have this behavior have an entry in their init
script to alert the user when trying to start a daemon if it's not
been enabled. Also, there's a debian package control file that can be
used to specify config files (DEBIAN/conffiles) that shouldn't be
modified on upgrade. This means  that START=no would only affect new
installations and upgrades of existing installs that don't have
knowledge of this.

if is_true &quot;$START&quot; ; then
  start-stop-daemon --start --quiet --pidfile $PIDFILE ...
else
  echo &quot;puppet not configured to start, please edit
/etc/default/puppet to enable&quot;
fi

My reason for wanting rabbitmq to use this process is the following:

1. Rabbitmq package is installed and post install script starts the daemon
2. The first time the daemon has been started an erlang cookie is generated
3. The mnesia database is initialized and it's keyed to the cookie
4. I drop in my cookie that's used across all of my nodes and attempt
to restart rabbitmq. It fails because the mnesia database expects to
have a different cookie. I must now blow away the database.

There also exists the potential for abuse of a newly installed
rabbitmq server, given that it listens on 0.0.0.0 and uses guest/guest
by default. Of course preventing abuse is the responsibility of the
admin but /etc/default can serve as a bit of a safety.

Overall it doesn't affect me much because I need to repackage anyway
to enable -name in lieu of -sname but I think it'd be a nice thing to
have by default.

Thanks,
Jared

On Thu, Jan 5, 2012 at 04:48, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
&gt;<i> On 04/01/12 19:32, Jared Biel wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. An /etc/default/rabbitmq file that contains something like START=no
</I>&gt;&gt;<i> 2. Modification to rabbitmq-server.init to make use of that file so
</I>&gt;&gt;<i> rabbitmq won't start unless START is equal to a true value.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hmm. I have to admit to not being a Debian packaging expert but is this how
</I>&gt;<i> things are meant to work? If I apt-get install apache2 or mysql, then by the
</I>&gt;<i> time apt has done its work I have a running server.
</I>&gt;<i>
</I>&gt;<i> So I think if we did this then we would want to default to START=yes or else
</I>&gt;<i> lots of people would turn up on this mailing list saying &quot;I just installed
</I>&gt;<i> rabbitmq-server and nothing happened!&quot;. And if we do that then why not just
</I>&gt;<i> use update-rc.d?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017176.html">[rabbitmq-discuss] Unable to build Debian package since 2.7.0
</A></li>
	<LI>Next message: <A HREF="017177.html">[rabbitmq-discuss] Unable to build Debian package since 2.7.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17185">[ date ]</a>
              <a href="thread.html#17185">[ thread ]</a>
              <a href="subject.html#17185">[ subject ]</a>
              <a href="author.html#17185">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
