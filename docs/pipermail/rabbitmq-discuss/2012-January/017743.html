<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Securing RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Securing%20RabbitMQ&In-Reply-To=%3CAF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB%40MAILCCR.us.syncsort.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017740.html">
   <LINK REL="Next"  HREF="017745.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Securing RabbitMQ</H1>
    <B>Bell, Paul M.</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Securing%20RabbitMQ&In-Reply-To=%3CAF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB%40MAILCCR.us.syncsort.com%3E"
       TITLE="[rabbitmq-discuss] Securing RabbitMQ">pbell at syncsort.com
       </A><BR>
    <I>Sun Jan 29 16:58:25 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017740.html">[rabbitmq-discuss] Securing RabbitMQ
</A></li>
        <LI>Next message: <A HREF="017745.html">[rabbitmq-discuss] Securing RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17743">[ date ]</a>
              <a href="thread.html#17743">[ thread ]</a>
              <a href="subject.html#17743">[ subject ]</a>
              <a href="author.html#17743">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

Thanks very much for your instructive reply.

By way of background, I am working on a layered architecture. One of these layers, sitting just above the business services, is an AMQP consumer as it faces up. Facing down, it is a REST web service client. Suppose that the enqueued messages look pretty much like RESTful URIs (e.g., <A HREF="http://&lt;host">http://&lt;host</A>&gt;:&lt;port&gt;/&lt;appContextPath&gt;/users meaning something like &quot;return a list of users&quot;). The consumer pulls such a message and presents it via customary servlet container infrastructure (e.g., Tomcat + Spring) to the appropriate business service where the real work is done.

Such messages were produced in the first place by an authenticated user at a UI. (It is interesting to me that, despite the significant advantages of decoupling layers via a queue, the queue itself becomes almost like another login point. That is, just as input can come from the UI, input can come also from the queue.) Ideally, only an authenticated user (or process) can place messages into the queue. And that's where one of the security issues arises.

If an attacker has access to queue storage (the Mnesia directory?) he might be able to deconstruct the clear text messages and reconstruct spurious messages of his own making. If he then had access to RabbitMQ, i.e., could connect and login to it, he could insert spurious messages into the queue.

So that's why I was thinking along the lines of messages being encrypted in the queue. 

But there are other security issues here: 

a. securing the broker password. I routinely see the &quot;guest/guest&quot; examples where the password is stored in code. I know these are examples and, as such, provide needful and simple instruction. But in the real world, we can't be storing passwords in code. As usual, the storing/securing of keys and passwords is the hard part of security.

b. then there's the matter of the web services themselves: they are, presumably, publicly accessible via  a web browser. If you know the URL you can try to invoke these services, whether or not you put anything in the queue via an authenticated log in.

I would like to hear your and others' thoughts about these issues.

Thanks again.

-Paul 
________________________________________
From: Alexandru Scvor&#355;ov [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scvalex at gmail.com</A>] On Behalf Of Alexandru Scvor&#355;ov [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexandru at rabbitmq.com</A>]
Sent: Saturday, January 28, 2012 12:11 PM
To: Bell, Paul M.
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Securing RabbitMQ

Hi Paul,

&gt;<i> Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a &quot;roll your own&quot; approach.
</I>
No, there isn't any in-built RabbitMQ feature to encrypt at-rest
messages.  You'll have to roll your own.  As a rule, RabbitMQ does *not*
modify (or inspect) the contents of received messages.

If you use SSL on both the producer and consumer sides, the only way for
an attacker to get the messages would be to gain access to machine
hosting RabbitMQ or to the network the RabbitMQ cluster is running on
(if there is a cluster).

So, are you planning against an attacker who has gotten his hands on an
offline machine with RabbitMQ on it?  I haven't tried, but I suppose you
could use an encrypted file system.  RabbitMQ stores messages and state
only in its mnesia database directory, so if you encrypt that, you
should be secure.

&gt;<i> I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.
</I>
I'm not quite sure I follow.  Could you elaborate?

Cheers,
Alex


On Sat, Jan 28, 2012 at 11:40:33AM -0500, Bell, Paul M. wrote:
&gt;<i> Hello again,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have started reading <A HREF="http://www.rabbitmq.com/ssl.html,">http://www.rabbitmq.com/ssl.html,</A> and it looks....reassuring. :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a &quot;roll your own&quot; approach.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Paul
</I>&gt;<i>
</I>&gt;<i> ________________________________
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ATTENTION: -----
</I>&gt;<i>
</I>&gt;<i> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017740.html">[rabbitmq-discuss] Securing RabbitMQ
</A></li>
	<LI>Next message: <A HREF="017745.html">[rabbitmq-discuss] Securing RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17743">[ date ]</a>
              <a href="thread.html#17743">[ thread ]</a>
              <a href="subject.html#17743">[ subject ]</a>
              <a href="author.html#17743">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
