<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue Lease (x-expires)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20Lease%20%28x-expires%29&In-Reply-To=%3Ce373a182-82a1-4008-bb71-01ff42a4833b%40b10g2000pbd.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017562.html">
   <LINK REL="Next"  HREF="017577.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue Lease (x-expires)</H1>
    <B>Yogesh Ketkar</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20Lease%20%28x-expires%29&In-Reply-To=%3Ce373a182-82a1-4008-bb71-01ff42a4833b%40b10g2000pbd.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Queue Lease (x-expires)">yogimogi at gmail.com
       </A><BR>
    <I>Mon Jan 23 14:33:08 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017562.html">[rabbitmq-discuss] Queue Lease (x-expires)
</A></li>
        <LI>Next message: <A HREF="017577.html">[rabbitmq-discuss] Queue Lease (x-expires)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17563">[ date ]</a>
              <a href="thread.html#17563">[ thread ]</a>
              <a href="subject.html#17563">[ subject ]</a>
              <a href="author.html#17563">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Steve.

I am planning to write a Java Client which will get list of queues
using something like
Process proc = Runtime.getRuntime().exec(&quot;rabbitmqadmin.py list queues
name -f bash&quot;) and then iterate over each queue name
and call
channel1.queueDelete(queueName, true, true)

Just one question.
Assume that this client is trying to delete the queue on one channel
and and some other client is trying to do
channel2.queueDeclare as it wants to publish a message on the same
queue.
Is there a chance of deadlock due to timing of these 2 calls, on two
different channels, channel1.queueDelete and channel2.queueDeclare?

regards, Yogesh


On Jan 23, 5:23&#160;pm, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">st... at rabbitmq.com</A>&gt; wrote:
&gt;<i> Yogesh,
</I>&gt;<i>
</I>&gt;<i> rabbitmqadmin can delete the queue but without the checks that it might not be
</I>&gt;<i> empty and might be being used. &#160;If you can be sure that the queue is dead, then
</I>&gt;<i> a rabbitmqadmin check followed by a delete would be quite adequate.
</I>&gt;<i>
</I>&gt;<i> However, if it is possible that the queue might not be dead (just usage being
</I>&gt;<i> slow) or it might be reused, then it is imperative that the delete be
</I>&gt;<i> conditional. &#160;The java client interface (or some other client interface) should
</I>&gt;<i> be used to make the delete conditional.
</I>&gt;<i>
</I>&gt;<i> We notice here that the rabbitmqadmin interface doesn't allow you to
</I>&gt;<i> conditionally delete. We have raised a bug to do this -- but in the meantime, I
</I>&gt;<i> would code a script that issues the rabbitmqadmin calls to determine which
</I>&gt;<i> queues to conditionally delete, and then invoke simple stand-alone client app to
</I>&gt;<i> do the conditional deletes. &#160; It's a bit klunky, but reasonably safe.
</I>&gt;<i>
</I>&gt;<i> Hope this helps.
</I>&gt;<i> Steve Powell &#160;(a happy bunny)
</I>&gt;<i> ----------some more definitions from the SPD----------
</I>&gt;<i> vermin (v.) Treating the dachshund for roundworm.
</I>&gt;<i> chinchilla (n.) Cooling device for the lower jaw.
</I>&gt;<i> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
</I>&gt;<i>
</I>&gt;<i> On 22 Jan 2012, at 07:40, Yogesh Ketkar wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Thanks Steve and Simon.
</I>&gt;<i>
</I>&gt;<i> &gt; I checked that rabbitmqadmin.py uses http calls (RESTful APIs)
</I>&gt;<i> &gt; provided by RabbitMQ to perform the operations.
</I>&gt;<i> &gt; Can you provide me a sample
</I>&gt;<i> &gt; - (either using rabbitmqadmin or using RESTful client) to delete a
</I>&gt;<i> &gt; queue say &quot;Yogesh&quot; with isEmpty and isUnused flags set to True?
</I>&gt;<i> &gt; &#160;I could delete the queue using DELETE http request on
</I>&gt;<i> &gt;<A HREF="http://localhost:55672/api/queues/%2f/Yogesh">http://localhost:55672/api/queues/%2f/Yogesh</A>
</I>&gt;<i> &gt; &#160;But couldn't figure out a way to specify isEmpty and isUnused flags.
</I>&gt;<i> &gt; - I was able to do this in a Java client using interface
</I>&gt;<i> &gt; com.rabbitmq.client.Channel { queueDelete(&quot;Yogesh&quot;, true, true) }.
</I>&gt;<i> &gt; &#160;But then, how do I get list of queues using com.rabbitmq.client?
</I>&gt;<i>
</I>&gt;<i> &gt; regards, Yogesh
</I>&gt;<i>
</I>&gt;<i> &gt; On Jan 20, 7:25 pm, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">st... at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; Just a thought,
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; If you go the way Simon says and have something from outside poking the mgmt API
</I>&gt;<i> &gt;&gt; every few minutes, make sure you issue queueDelete with the if-empty bit set.
</I>&gt;<i> &gt;&gt; There is a window between the poking and the deleting in which messages may
</I>&gt;<i> &gt;&gt; arrive on the queue (i.e. it's not idle anymore), and it may even not be in-use
</I>&gt;<i> &gt;&gt; (have consumers) by the time you get to it.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; Steve Powell
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">st... at rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; [wrk:+44-2380-111-528begin_of_the_skype_highlighting&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+44-2380-111-528&#160;&#160;&#160;&#160;&#160;&#160;begin_of_the_skype_highlighting &#160; &#160; &#160; &#160; &#160; &#160;+44-2380-111-528 &#160; &#160; &#160;] [mob:+44-7815-838-558begin_of_the_skype_highlighting&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+44-7815-838-558&#160;&#160;&#160;&#160;&#160;&#160;begin_of_the_skype_highlighting &#160; &#160; &#160; &#160; &#160; &#160;+44-7815-838-558 &#160; &#160; &#160;]
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; On 20 Jan 2012, at 12:47, Simon MacMullen wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; On 16/01/12 15:56, Yogesh Ketkar wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt; I would like to delete the queue with no messages in it and so asked
</I>&gt;<i> &gt;&gt;&gt;&gt; the question.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; I see.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt;&gt; Can you suggest an alternative to achieve
</I>&gt;<i> &gt;&gt;&gt;&gt; 1. Delete the queue when last event processed from the queue has
</I>&gt;<i> &gt;&gt;&gt;&gt; &lt;Action&gt;Delete&lt;/Action&gt; &#160;as this implies that
</I>&gt;<i> &gt;&gt;&gt;&gt; &#160; &#160;no more events with same&lt;AppId&gt; &#160;would ever get created.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; Well, you could have your client do that.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt;&gt; 2. Delete the queue when it is IDLE for certain period, meaning it is
</I>&gt;<i> &gt;&gt;&gt;&gt; empty and no more event was added to it for certain time period.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; Hmm. Well there's nothing built in to do this, but you could have something from outside poking the mgmt API every few minutes - look at the output of (e.g.)
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; rabbitmqadmin list queues name messages consumers idle_since
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; --
</I>&gt;<i> &gt;&gt;&gt; Simon MacMullen
</I>&gt;<i> &gt;&gt;&gt; RabbitMQ, VMware
</I>&gt;<i> &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt;&gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discussTh
</I></PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017562.html">[rabbitmq-discuss] Queue Lease (x-expires)
</A></li>
	<LI>Next message: <A HREF="017577.html">[rabbitmq-discuss] Queue Lease (x-expires)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17563">[ date ]</a>
              <a href="thread.html#17563">[ thread ]</a>
              <a href="subject.html#17563">[ subject ]</a>
              <a href="author.html#17563">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
