<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] About RabbitMQ federation plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20About%20RabbitMQ%20federation%20plugin&In-Reply-To=%3CCAOn7oW8ENFjansMm2J%3D3NLa78yeXUHu6cXMvvbrmQH9m2Ok76w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017415.html">
   <LINK REL="Next"  HREF="017422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] About RabbitMQ federation plugin</H1>
    <B>Simone Busoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20About%20RabbitMQ%20federation%20plugin&In-Reply-To=%3CCAOn7oW8ENFjansMm2J%3D3NLa78yeXUHu6cXMvvbrmQH9m2Ok76w%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] About RabbitMQ federation plugin">simone.busoli at gmail.com
       </A><BR>
    <I>Tue Jan 17 07:24:39 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017415.html">[rabbitmq-discuss] About RabbitMQ federation plugin
</A></li>
        <LI>Next message: <A HREF="017422.html">[rabbitmq-discuss] About RabbitMQ federation plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17416">[ date ]</a>
              <a href="thread.html#17416">[ thread ]</a>
              <a href="subject.html#17416">[ subject ]</a>
              <a href="author.html#17416">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Brian, no you definitely don't need to create any queues manually for
the federation to work. Once you federate an exchange the exchange is
created by the plugin on the downstream server (it has to exist on the
upstream instead) and when you bind a queue to the federated exchange on
the downstream server the bindings are sent to the upstream, which will
deliver just the interesting messages published to the exchange on the
upstream server to the downstream server. In other words it should work
quite intuitively.
On Jan 17, 2012 7:51 AM, &quot;Brian Jing&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">brian.newsgroup at gmail.com</A>&gt; wrote:

&gt;<i> Hi guys,
</I>&gt;<i>
</I>&gt;<i> I've played with the federation plugin a little. It seems that in order to
</I>&gt;<i> send a message to a queue on the downstream server, the same queue has to
</I>&gt;<i> be declared on the upstream server for federation to work?
</I>&gt;<i>
</I>&gt;<i> For example:
</I>&gt;<i> __________________
</I>&gt;<i> |                              |
</I>&gt;<i> | Downstream server |   Exchange-D &lt;------  q1
</I>&gt;<i> |_________________|
</I>&gt;<i>              ^
</I>&gt;<i>              |
</I>&gt;<i>              |
</I>&gt;<i> __________________
</I>&gt;<i> |                              |
</I>&gt;<i> | Upstream server     |  Exchange-U &lt;------  q1
</I>&gt;<i> |_________________|
</I>&gt;<i>
</I>&gt;<i> _______
</I>&gt;<i> |            |
</I>&gt;<i> | Client   |
</I>&gt;<i> |_______|
</I>&gt;<i>
</I>&gt;<i> If I want to send messages from client through Upstream server to
</I>&gt;<i> Downstream server, The messages can only get through when I declare a &quot;q1&quot;
</I>&gt;<i> on Upstream server, bind that queue to Exchange-U with a routing key, then
</I>&gt;<i> send the message to Exchange-U using that routing key. Not sure if this is
</I>&gt;<i> how it's supposed to work.
</I>&gt;<i>
</I>&gt;<i> Is it possible not to declare q1 on Upstream server and make federation
</I>&gt;<i> work? My problem is that I have multiple customers listening to their own
</I>&gt;<i> queues on Downstream server, and customers can be removed or added at any
</I>&gt;<i> time. Say if X just connected to Downstream server, and I want to send
</I>&gt;<i> messages to it. How would I be able to send messages to X given that I
</I>&gt;<i> don't have a queue on Upstream server that corresponds to it? Though I
</I>&gt;<i> already know X is in the customer list, when my clients start and
</I>&gt;<i> initialise, I don't think it's a good idea to just create queues for all
</I>&gt;<i> customers on the list, which I think would consume system resources
</I>&gt;<i> unnecessarily.
</I>&gt;<i>
</I>&gt;<i> Hopefully it all makes sense to you guys. Let me know if it's unclear.
</I>&gt;<i>
</I>&gt;<i> The following is my federation config.
</I>&gt;<i> {rabbitmq_federation,
</I>&gt;<i>    [ {exchanges, [[{exchange,     &quot;Exchange-D&quot;},
</I>&gt;<i>                    {virtual_host, &quot;/&quot;},
</I>&gt;<i>                    {type,         &quot;topic&quot;},
</I>&gt;<i>                    {durable,      true},
</I>&gt;<i>                    {auto_delete,  false},
</I>&gt;<i>                    {internal,     false},
</I>&gt;<i>                    {upstream_set, &quot;upsteam-servers&quot;}]
</I>&gt;<i>                  ]},
</I>&gt;<i>      {upstream_sets, [{&quot;upsteam-servers&quot;, [[{connection, &quot;192.168.0.21&quot;},
</I>&gt;<i>                                          {exchange,   &quot;Exchange-U&quot;},
</I>&gt;<i>                                          {max_hops,   2}
</I>&gt;<i>                                          ]}
</I>&gt;<i>                      ]},
</I>&gt;<i>      {connections, [{&quot;Upstream-server&quot;,       [{host,          &quot;upstream&quot;},
</I>&gt;<i>                                          {protocol,        &quot;amqps&quot;},
</I>&gt;<i>                                          {port,            5671},
</I>&gt;<i>                                          {ssl_options,
</I>&gt;<i>                                           [{cacertfile,
</I>&gt;<i> &quot;/etc/rabbitmq/certs/testca/cacert.pem&quot;},
</I>&gt;<i>                                            {certfile,
</I>&gt;<i> &quot;/etc/rabbitmq/certs/client/cert.pem&quot;},
</I>&gt;<i>                                            {keyfile,
</I>&gt;<i> &quot;/etc/rabbitmq/certs/client/key.pem&quot;},
</I>&gt;<i>                                            {verify,     verify_peer},
</I>&gt;<i>                                            {fail_if_no_peer_cert, false}
</I>&gt;<i>                                           ]}
</I>&gt;<i>                                         ]}
</I>&gt;<i>                                      ]},
</I>&gt;<i>      {local_username, &quot;guest&quot;},
</I>&gt;<i>    ]
</I>&gt;<i>   }
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Brian
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/45aeb133/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/45aeb133/attachment.htm</A>&gt;
</PRE>















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017415.html">[rabbitmq-discuss] About RabbitMQ federation plugin
</A></li>
	<LI>Next message: <A HREF="017422.html">[rabbitmq-discuss] About RabbitMQ federation plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17416">[ date ]</a>
              <a href="thread.html#17416">[ thread ]</a>
              <a href="subject.html#17416">[ subject ]</a>
              <a href="author.html#17416">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
