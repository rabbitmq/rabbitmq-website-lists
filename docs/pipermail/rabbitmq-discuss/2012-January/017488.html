<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in	production environment.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-c%20for%20a%20reliable%20rabbitmq%20client%20in%0A%09production%20environment.&In-Reply-To=%3C1a2bd242-be09-4c75-9b94-ba214b9b6cb1%40a40g2000vbu.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017431.html">
   <LINK REL="Next"  HREF="017618.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in	production environment.</H1>
    <B>TZHA</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-c%20for%20a%20reliable%20rabbitmq%20client%20in%0A%09production%20environment.&In-Reply-To=%3C1a2bd242-be09-4c75-9b94-ba214b9b6cb1%40a40g2000vbu.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in	production environment.">sophiewenxizhang at googlemail.com
       </A><BR>
    <I>Thu Jan 19 12:04:22 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017431.html">[rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in production environment.
</A></li>
        <LI>Next message: <A HREF="017618.html">[rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in production environment.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17488">[ date ]</a>
              <a href="thread.html#17488">[ thread ]</a>
              <a href="subject.html#17488">[ subject ]</a>
              <a href="author.html#17488">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the reply.

I am now in the position to get the cancellation notification
following your advice.

On 17 Jan., 16:52, Alan Antonuk &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alan.anto... at gmail.com</A>&gt; wrote:
&gt;<i> Responses inlined
</I>&gt;<i>
</I>&gt;<i> On Mon, Jan 16, 2012 at 5:02 AM, TZHA &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sophiewenxizh... at googlemail.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Hi,
</I>&gt;<i>
</I>&gt;<i> &gt; i am working with rabbitmq-c (downloaded from github/newest version -
</I>&gt;<i> &gt; cmake/VS2010 rebuild under windows) and would like to prepare a
</I>&gt;<i> &gt; rabbitmq/c/c++ based solution for a production environment.
</I>&gt;<i>
</I>&gt;<i> &gt; However for a real application, we still have some reliability
</I>&gt;<i> &gt; requirements that are apparently not yet supported by rabbitmq-c.
</I>&gt;<i>
</I>&gt;<i> &gt; The first requirement is to get &#8220;cancellation notification&#8221; in case,
</I>&gt;<i> &gt; e.g. whenever a queue is down &#8211; so that the client/consumer can
</I>&gt;<i> &gt; reconnect to the broker.
</I>&gt;<i>
</I>&gt;<i> &gt; For this purpose &#8211; as I understood, the client has to send &#160;the
</I>&gt;<i> &gt; &#8220;client-capabilities&#8221; with
</I>&gt;<i>
</I>&gt;<i> &gt; &#160; ...
</I>&gt;<i> &gt; &#160; consumer_cancel_notify = true,
</I>&gt;<i> &gt; &#160; publisher_confirms = true
</I>&gt;<i>
</I>&gt;<i> &gt; For the consumer_cancel_notify - the client does need to tell the broker
</I>&gt;<i>
</I>&gt;<i> that it wants to turn this on.
</I>&gt;<i>
</I>&gt;<i> For the publisher_confirms - the client is not required to tell the broker
</I>&gt;<i> to enable this. &#160;To enabled it on a channel you should send send a
</I>&gt;<i> confirm.select to enable publisher_confirms for a channel. You can send the
</I>&gt;<i> client capabilities to query the broker to see if it supports this
</I>&gt;<i> extension before continuing connecting to a broker.
</I>&gt;<i>
</I>&gt;<i> For some more info how rabbit supports these extensions:<A HREF="http://www.rabbitmq.com/extensions.html">http://www.rabbitmq.com/extensions.html</A>
</I>&gt;<i>
</I>&gt;<i> for the connection setup. In &#160;case of of rabbitmq-c, I saw that one
</I>&gt;<i>
</I>&gt;<i> &gt; shall set the capabilities in amqp_login (amqp_socket.c) &#160;method.
</I>&gt;<i> &gt; Current this is set to NULL.
</I>&gt;<i>
</I>&gt;<i> &gt; &#160;amqp_connection_open_t s
</I>&gt;<i> &gt; &#160;s.capabilities.len = 0;
</I>&gt;<i> &gt; &#160;s.capabilities.bytes = NULL;
</I>&gt;<i>
</I>&gt;<i> The format of that field is I believe a shortstr. &#160;However that's not where
</I>&gt;<i> you want to send capabilities. &#160;When you get the connection.start method
</I>&gt;<i> from the broker, you need to examine the server-properties (which is a
</I>&gt;<i> table) parameter to see if the broker supports the extensions you want.
</I>&gt;<i> &#160;When you respond with a connection.start-ok, you need to put the
</I>&gt;<i> extensions you want to enable in the client-properties parameter, which is
</I>&gt;<i> also a table.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Can some expert tell me what kind of syntax can be used for the
</I>&gt;<i> &gt; s.capabilities.bytes field?
</I>&gt;<i>
</I>&gt;<i> &gt; The next requirement is to receive publisher_confirms. I guess that
</I>&gt;<i> &gt; the client-capabilities is also a pre-condition, and I have to set the
</I>&gt;<i> &gt; &#8220;mandatory&#8221; parameter for the amqp_basic_publish method to 1. Is there
</I>&gt;<i> &gt; anything else I have to set?
</I>&gt;<i>
</I>&gt;<i> In order to enable publisher confirms,
</I>&gt;<i>
</I>&gt;<i> You need to do the confirm.select (amqp_confirm_select(...) ) method on the
</I>&gt;<i> channel you want to enable publisher confirms on.
</I>&gt;<i> After which anytime you do a basic.publish, (amqp_basic_publish(...)) you
</I>&gt;<i> will eventually get a basic.ack back from the broker once the message has
</I>&gt;<i> been processed*.
</I>&gt;<i> * Note: processed does not mean delivered, it just means that the broker
</I>&gt;<i> received it and did something with it (routed to a queue, returned it,
</I>&gt;<i> dropped it etc). &#160;If you want ensure that the message got routed a queue -
</I>&gt;<i> send the mandatory flag. &#160;If the message isn't routed to a queue the
</I>&gt;<i> message will returned to the client with a basic.return, then you will be a
</I>&gt;<i> basic.ack.
</I>&gt;<i>
</I>&gt;<i> More information on publisher confirms:<A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.confirm">http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.confirm</A>
</I>&gt;<i> More information on the basic publish fields:<A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish">http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish</A>
</I>&gt;<i> Finally an example client that leverages rabbitmq-c and uses publisher
</I>&gt;<i> confirms:<A HREF="https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cp...">https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cp...</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Thanks in advance for any advices.
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017431.html">[rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in production environment.
</A></li>
	<LI>Next message: <A HREF="017618.html">[rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in production environment.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17488">[ date ]</a>
              <a href="thread.html#17488">[ thread ]</a>
              <a href="subject.html#17488">[ subject ]</a>
              <a href="author.html#17488">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
