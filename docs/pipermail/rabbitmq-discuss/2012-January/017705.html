<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Stuck log rotation in linux?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Stuck%20log%20rotation%20in%20linux%3F&In-Reply-To=%3C4B393627EE3CE74A9F189B639F857D2E071CE197%40BVNYMAIL.bvn.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017703.html">
   <LINK REL="Next"  HREF="017713.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Stuck log rotation in linux?</H1>
    <B>Sutherland, Rob</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Stuck%20log%20rotation%20in%20linux%3F&In-Reply-To=%3C4B393627EE3CE74A9F189B639F857D2E071CE197%40BVNYMAIL.bvn.com%3E"
       TITLE="[rabbitmq-discuss] Stuck log rotation in linux?">RSutherland at BroadViewNet.com
       </A><BR>
    <I>Thu Jan 26 21:18:33 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017703.html">[rabbitmq-discuss] Vhost concept
</A></li>
        <LI>Next message: <A HREF="017713.html">[rabbitmq-discuss] Stuck log rotation in linux?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17705">[ date ]</a>
              <a href="thread.html#17705">[ thread ]</a>
              <a href="subject.html#17705">[ subject ]</a>
              <a href="author.html#17705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Several times now I've run into the issue of rabbitmq getting &quot;stuck&quot;
during log rotation. Log rotation is done via the usual logrotate daily
cron using the default logrotate configutaion. This is not simply a case
of log rotation taking too long as this condition can persist for
months. This cause log rotation to freeze for the entire system (since
logrotate correctly refuses to be invoked if there's already a log
rotation in progress) and results in log files growing out of control
(e.g. a 900 MB /var/log/messages file).

 

Here's an example of such a process tree (a snippet from ps axjf):

 

PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND

    1 25352 25352 25352 ?           -1 Ss       0   0:00 sh -c
/usr/sbin/rabbitmq-server &gt; /var/log/rabbitmq/startup_log 2&gt;
/var/log/rabbitmq/startup_err

25352 25356 25352 25352 ?           -1 S        0   0:00  \_ /bin/sh
/usr/sbin/rabbitmq-server

25356 25363 25352 25352 ?           -1 S        0   0:00      \_ su
rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmq-server 

25363 25367 25367 25367 ?           -1 Ssl    105   3:56          \_
/usr/lib64/erlang/erts-5.8.1/bin/beam.smp -W w -K true -A30 -P 1048576
-- -root /usr/lib64/erlang -prognam

25367 25479 25479 25479 ?           -1 Ss     105   0:00              \_
/usr/lib64/erlang/lib/os_mon-2.2.5/priv/bin/cpu_sup

25367 25480 25480 25480 ?           -1 Ss     105   0:00              \_
inet_gethost 4

25480 25481 25480 25480 ?           -1 S      105   0:00
\_ inet_gethost 4

 

 

Any ideas? I have yet to find a pattern to the appearance of this issue.

 

Thanks in advance,

 

Rob

 

OS: SUSE Linux Enterprise System version 11 SP1

# uname -a

Linux PVHA30node1 2.6.32.46-0.3-default #1 SMP 2011-09-29 17:49:31 +0200
x86_64 x86_64 x86_64 GNU/Linux

 

# cat /etc/logrotate.d/ rabbitmq-server

/var/log/rabbitmq/*.log {

        weekly

        missingok

        rotate 20

        compress

        delaycompress

        notifempty

        sharedscripts

        postrotate

            /sbin/service rabbitmq-server rotate-logs &gt; /dev/null

        endscript

}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/c62792ec/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/c62792ec/attachment.htm</A>&gt;
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017703.html">[rabbitmq-discuss] Vhost concept
</A></li>
	<LI>Next message: <A HREF="017713.html">[rabbitmq-discuss] Stuck log rotation in linux?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17705">[ date ]</a>
              <a href="thread.html#17705">[ thread ]</a>
              <a href="subject.html#17705">[ subject ]</a>
              <a href="author.html#17705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
