<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question related to workload distribution
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Brabbitmq-consistent-hash-exchange%5D%20Question%0A%20related%20to%20workload%20distribution&In-Reply-To=%3C20120125233340.GA17447%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017673.html">
   <LINK REL="Next"  HREF="017678.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question related to workload distribution</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Brabbitmq-consistent-hash-exchange%5D%20Question%0A%20related%20to%20workload%20distribution&In-Reply-To=%3C20120125233340.GA17447%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question related to workload distribution">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Jan 25 23:33:41 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017673.html">[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question	related to workload distribution
</A></li>
        <LI>Next message: <A HREF="017678.html">[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question	related to workload distribution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17676">[ date ]</a>
              <a href="thread.html#17676">[ thread ]</a>
              <a href="subject.html#17676">[ subject ]</a>
              <a href="author.html#17676">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jan 25, 2012 at 01:29:35PM -0800, Josh Stone wrote:
&gt;<i> A followup question. When a new queue is created and a key-remapping
</I>&gt;<i> occurs, is there any way I could learn which keys were re-mapped? This
</I>&gt;<i> would allow me to migrate and data/work corresponding to those keys.
</I>&gt;<i> Perhaps a message could be published to a common queue indicating
</I>&gt;<i> which keys were re-mapped.
</I>
The binding (and thus queue) selected by the consistent hash exachange
is selected by hashing the message's routing key, and then finding the
nearest higher binding. Given an infinite number of routing keys will
hash to the same result, no such message could be constructed to say
which routing keys have been remapped. The best you could do would be to
somehow keep track of every routing key the exchange has ever seen, and
from that figure out which of those would have been routed differently
in light of the additional-or-loss-of queue/binding. That also isn't
feasible.

In general, you should probably assume you have relatively little churn
off such an exchange, and thus if a worker does see a message with a
routing key it's not expected (caused by eg loss of a queue) then
propogate the error further up and restart the corresponding session on
the publishing side so that the entire set of messages with that routing
key get resent.

Matthew
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017673.html">[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question	related to workload distribution
</A></li>
	<LI>Next message: <A HREF="017678.html">[rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question	related to workload distribution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17676">[ date ]</a>
              <a href="thread.html#17676">[ thread ]</a>
              <a href="subject.html#17676">[ subject ]</a>
              <a href="author.html#17676">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
