<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problems with rabbit and hoping I can get some	help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problems%20with%20rabbit%20and%20hoping%20I%20can%20get%20some%0A%09help&In-Reply-To=%3CCA%2B22WDRAgsB3iuXMne4PxgRr4z0%3DfbQZthZgGbAyYPQRVGofAQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017816.html">
   <LINK REL="Next"  HREF="017818.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problems with rabbit and hoping I can get some	help</H1>
    <B>Dathan Pattishall</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problems%20with%20rabbit%20and%20hoping%20I%20can%20get%20some%0A%09help&In-Reply-To=%3CCA%2B22WDRAgsB3iuXMne4PxgRr4z0%3DfbQZthZgGbAyYPQRVGofAQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Problems with rabbit and hoping I can get some	help">dathan at schoolfeed.com
       </A><BR>
    <I>Tue Jan 31 20:52:55 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017816.html">[rabbitmq-discuss] [announce] New maintainer for the rabbitmq-c	library
</A></li>
        <LI>Next message: <A HREF="017818.html">[rabbitmq-discuss] Problems with rabbit and hoping I can get	some	help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17817">[ date ]</a>
              <a href="thread.html#17817">[ thread ]</a>
              <a href="subject.html#17817">[ subject ]</a>
              <a href="author.html#17817">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Let me first describe my setup.

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at webnode1</A>]# rabbitmqadmin.py show overview
+--------------------+-----------------+--------------------+------------------+
|<i> management_version |      node       | statistics_db_node |
</I>statistics_level |
+--------------------+-----------------+--------------------+------------------+
|<i> 2.7.1              | <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at webnode1</A> | <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at webnode1</A>    | fine
</I>    |
+--------------------+-----------------+--------------------+------------------+

Rabbit MQ's producers comes from PHP 5.3.8
<A HREF="http://www.php.net/manual/en/book.amqp.php.">http://www.php.net/manual/en/book.amqp.php.</A> Each apache process could
produce a rabbit message, I am producing around 1000 messages a second on
 c1.xtralarge instance at ec2.

My erlang version is

/usr/local/bin/erl -v
Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe]
[kernel-poll:false]


The PROBLEM:

After about 40 mins of rabbit accepting messages all connections block
causing a rather bad error on the front ends killing traffic. Turning
rabbit off and restarting the web servers forces a recovery.

Stats from Rabbit:

Roughly 5000 queues are made
Roughly 3600 exchanges are made
Each exchange can have at most 1200 queues bound to it.
Each Queue is setup for autodelete and so is the exchanges with delivery
type 1.
All data passed is JSON

The consumer is NODE and its keeping up with the consumption

RabbitMQ memlimit is around 5.3G
RabbitMQ mem used hits around 1.9G when it freezes produces
RabbitMQ proc used hits around 220K
RabbitMQ fd_total is 50K
RabbitMQ socks_total is around 45K and Socks used is 4K
mem_ets hists 100M // not sure what this is

Any idea what is going on? What limit am I hitting? Why does RabbitMQ
block? How can I detect that I am about to hit a block state? Any
suggestions or request of additional data would be great.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/1331150d/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/1331150d/attachment.htm</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017816.html">[rabbitmq-discuss] [announce] New maintainer for the rabbitmq-c	library
</A></li>
	<LI>Next message: <A HREF="017818.html">[rabbitmq-discuss] Problems with rabbit and hoping I can get	some	help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17817">[ date ]</a>
              <a href="thread.html#17817">[ thread ]</a>
              <a href="subject.html#17817">[ subject ]</a>
              <a href="author.html#17817">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
