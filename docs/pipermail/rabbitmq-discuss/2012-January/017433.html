<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Seeming high CPU for broker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Seeming%20high%20CPU%20for%20broker&In-Reply-To=%3C4F159F1C.6050201%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017211.html">
   <LINK REL="Next"  HREF="017187.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Seeming high CPU for broker</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Seeming%20high%20CPU%20for%20broker&In-Reply-To=%3C4F159F1C.6050201%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Seeming high CPU for broker">simon at rabbitmq.com
       </A><BR>
    <I>Tue Jan 17 16:17:32 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017211.html">[rabbitmq-discuss] Seeming high CPU for broker
</A></li>
        <LI>Next message: <A HREF="017187.html">[rabbitmq-discuss] pika + ssl disconnects with ssl_upgrade_error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17433">[ date ]</a>
              <a href="thread.html#17433">[ thread ]</a>
              <a href="subject.html#17433">[ subject ]</a>
              <a href="author.html#17433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/01/12 13:50, Chris Hampson wrote:
&gt;<i> Hi All,
</I>&gt;<i>
</I>&gt;<i> We've been running a few brokers for quite some time now. About a
</I>&gt;<i> month ago one of them pretty much maxed out the CPU of the machine it
</I>&gt;<i> was running on and has maintained this high level ever since.
</I>
Has it been restarted since?

&gt;<i> It's only ever using 20% (max) of the memory, not swapping, the load
</I>&gt;<i> average of the machine is less than one and the service seems
</I>&gt;<i> unaffected.
</I>&gt;<i>
</I>&gt;<i> Is this something I shouldn't be concerned with, it's not really
</I>&gt;<i> having to cope with too much at the moment, a couple of active
</I>&gt;<i> VHOSTS, small handful of exchanges, and in general less than 200/sec
</I>&gt;<i> messages to even the busiest of those.
</I>
Well, this definitely seems wrong. One immediate possibility springs to 
mind: the mgmt plugin had some pretty poor efficiency in the face of 
large numbers of {queues/channels/connections} until 2.5.0 (both for 
responding to queries and background CPU usage). If you have lots of 
{queues/channels/connections} that's worth considering.

2.3.1 is in general a bit old, and a lot of optimisation has flowed 
under the bridge since then, so as always I'd suggest an upgrade ;-)

&gt;<i> I'm getting nagged by the ops guys due to it setting off
</I>&gt;<i> notifications for the high CPU load, if it's expected or not
</I>&gt;<i> something to worry about this I can just tell them to disable that
</I>&gt;<i> notification (or at least ignore it).
</I>&gt;<i>
</I>&gt;<i> Are there any ways (beyond rabbitmqctl and the web interface) to see
</I>&gt;<i> what's going on and if there's trouble ahead?
</I>
Nothing very lovely. Erlang ships with a utility called etop which can 
give you a top-like view of the processes in your Erlang VM. It's a bit 
fiddly and low level though.

It may not be installed by default and the script to launch it is in 
often not put in your path - for example with Debian you'd need to 
apt-get install erlang-observer and invoke it from:

/usr/lib/erlang/lib/observer-0.9.8.3/priv/bin/	

You can invoke it with:

$ /path/to/etop -node rabbit@$(hostname)

(If using our deb / rpm packaging you may need to become rabbitmq to do 
this, or copy the Erlang cookie from the rabbitmq user.)

This should show what process(es) are using all that CPU and we can go 
from there...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017211.html">[rabbitmq-discuss] Seeming high CPU for broker
</A></li>
	<LI>Next message: <A HREF="017187.html">[rabbitmq-discuss] pika + ssl disconnects with ssl_upgrade_error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17433">[ date ]</a>
              <a href="thread.html#17433">[ thread ]</a>
              <a href="subject.html#17433">[ subject ]</a>
              <a href="author.html#17433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
