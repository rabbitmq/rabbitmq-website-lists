<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lack%20of%20Ack%2C%20Failure%20and%20Re-delivery&In-Reply-To=%3CAF4AD4ADFB23054CB4C75F50FF8C40B73B4044755E%40MAILCCR.us.syncsort.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017651.html">
   <LINK REL="Next"  HREF="017675.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Lack of Ack, Failure and Re-delivery</H1>
    <B>Bell, Paul M.</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lack%20of%20Ack%2C%20Failure%20and%20Re-delivery&In-Reply-To=%3CAF4AD4ADFB23054CB4C75F50FF8C40B73B4044755E%40MAILCCR.us.syncsort.com%3E"
       TITLE="[rabbitmq-discuss] Lack of Ack, Failure and Re-delivery">pbell at syncsort.com
       </A><BR>
    <I>Wed Jan 25 20:25:20 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017651.html">[rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
</A></li>
        <LI>Next message: <A HREF="017675.html">[rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17672">[ date ]</a>
              <a href="thread.html#17672">[ thread ]</a>
              <a href="subject.html#17672">[ subject ]</a>
              <a href="author.html#17672">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you, Simon.

-Paul

-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Simon MacMullen
Sent: Wednesday, January 25, 2012 9:21 AM
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery

On 25/01/12 14:05, Bell, Paul M. wrote:
&gt;<i> Hello again,
</I>&gt;<i>
</I>&gt;<i> I&#8217;m working my way through several recovery scenarios. I think we&#8217;ve
</I>&gt;<i> established the following:
</I>&gt;<i>
</I>&gt;<i> a.If broker bounces, durable messages in the durable queue that have
</I>&gt;<i> been consumed &#8211; but not acked &#8211; will be redelivered.
</I>&gt;<i>
</I>&gt;<i> b.Such redelivered messages will have the &#8220;redelivered&#8221; flag set.
</I>&gt;<i>
</I>&gt;<i> c.If consumer bounces, both (a) and (b) still hold.
</I>&gt;<i>
</I>&gt;<i> In re (a): is redelivery accomplished by placing another copy of the
</I>&gt;<i> message in the queue (thus, two copies of same message are in the  queue
</I>&gt;<i> &#8211; one consumed but not acked, the other brand new); OR does the broker
</I>&gt;<i> simply know that it&#8217;s OK to redeliver the original message?
</I>
The broker just knows it's OK to redeliver the original message.

&gt;<i> In re (b): the redelivered flag seems to enable the creation of what
</I>&gt;<i> Hohpe calls an &#8220;idempotent receiver.&#8221; That is, the consumer can use this
</I>&gt;<i> flag to decide how to dispose of the redelivered message. Consider a
</I>&gt;<i> scenario wherein the consumers, all pulling from a single queue,
</I>&gt;<i> dispatch the work to a lower layer service. If there are multiple
</I>&gt;<i> consumer nodes (even multiple consumer threads), they will need some
</I>&gt;<i> means of coordinating the disposition of the redelivered message. For
</I>&gt;<i> example, NodeA consumes (but doesn&#8217;t ack) message 1. But it does
</I>&gt;<i> dispatch the work represented by message 1 to a lower layer service. If
</I>&gt;<i> the broker bounces and message 1 is redelivered, it might be consumed by
</I>&gt;<i> NodeB. But the message 1 task is already in-flight on NodeA. So,
</I>&gt;<i> depending on both the idempotency of the task and application specific
</I>&gt;<i> functionality, NodeB might want to discard the redelivered message 1.
</I>&gt;<i> Such intra-consumer/intra-consumer node coordination suggests that the
</I>&gt;<i> first consumer of the message needs to record something, probably in the
</I>&gt;<i> persistence layer, that says &#8220;I&#8217;ve started this particular task (using a
</I>&gt;<i> unique request ID). Does this seem right?
</I>
Yes, depending on what exactly your requirements are. The redelivered
flag is there as an optimisation, so you don't have to check every message.

&gt;<i> In re (c): does redelivery after consumer bounce work because the broker
</I>&gt;<i> detects the loss of connection?
</I>
Yes.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017651.html">[rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
</A></li>
	<LI>Next message: <A HREF="017675.html">[rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17672">[ date ]</a>
              <a href="thread.html#17672">[ thread ]</a>
              <a href="subject.html#17672">[ subject ]</a>
              <a href="author.html#17672">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
