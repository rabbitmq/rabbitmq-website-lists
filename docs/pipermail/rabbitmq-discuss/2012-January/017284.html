<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Newcomer%20to%20Rabbit%20seeks%20exchange-type%20advice&In-Reply-To=%3CCABMnSbH1s5ve5EcO%2BfR-pv4ZeTNi%3DZSWvyRzG-3y45L2O8hpEA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017281.html">
   <LINK REL="Next"  HREF="017288.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice</H1>
    <B>Mark Petrovic</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Newcomer%20to%20Rabbit%20seeks%20exchange-type%20advice&In-Reply-To=%3CCABMnSbH1s5ve5EcO%2BfR-pv4ZeTNi%3DZSWvyRzG-3y45L2O8hpEA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice">mspetrovic at gmail.com
       </A><BR>
    <I>Tue Jan 10 22:20:44 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017281.html">[rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
</A></li>
        <LI>Next message: <A HREF="017288.html">[rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17284">[ date ]</a>
              <a href="thread.html#17284">[ thread ]</a>
              <a href="subject.html#17284">[ subject ]</a>
              <a href="author.html#17284">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Talking to myself here (I have no problem with that :-)), I think I
have at least one solution to this.

- Create a single exchange E
- The Publisher P creates a channel with a single queue and routing
key with the same names as the Table T in question.
- Publisher publishes a message to channel
- The Consumer C1 iterates over the table names T1 and T2 he cares
about and binds his channel to queues and routing keys with the same
name as the table name iterated over
- The Consumer C1 then starts a thread for each of these queues, and
whose run() method calls channel.basicConsume(queueName, autoAck,
rabbitConsumer)

where rabbitConsumer extends com.rabbitmq.client.DefaultConsumer.

While this seems to work, and is a bit easier to understand how to
program than header exchanges (if a header exchange would even work
for me - I wonder), I dont' like the thread-per-queue I need to spawn
to handle messages inbound for each queue.

What would be nice is if I could call channel.basicConsume(autoAck,
rabbitConsumer), which would read messages off all the queues that
were bound to that channel.

While I have something working, I'm not yet real thrilled with my
programming model.

Anybody?

Thanks!

On Tue, Jan 10, 2012 at 10:28 AM, Mark Petrovic &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mspetrovic at gmail.com</A>&gt; wrote:
&gt;<i> Hello.
</I>&gt;<i>
</I>&gt;<i> This note is longer than I thought it would be, but I do not believe
</I>&gt;<i> my situation is complicated.
</I>&gt;<i>
</I>&gt;<i> I am a RabbitMQ newcomer and am trying to identify which exchange type
</I>&gt;<i> to use for my application.
</I>&gt;<i>
</I>&gt;<i> I have a publisher P that needs to send messages about database table
</I>&gt;<i> updates. &#160;A message will bear the name of a single table name,
</I>&gt;<i> followed by some opaque application data:
</I>&gt;<i>
</I>&gt;<i> Logically,
</I>&gt;<i>
</I>&gt;<i> message == tableName | somedata
</I>&gt;<i>
</I>&gt;<i> So consider a simplified database with three tables of interest: &#160;T1,
</I>&gt;<i> T2, and T3.
</I>&gt;<i>
</I>&gt;<i> There are two consumers, C1 and C2.
</I>&gt;<i>
</I>&gt;<i> C1 needs to receive all messages concerning tables T1 and T2.
</I>&gt;<i>
</I>&gt;<i> C2 needs to receive all messages concerning tables T2 and T3.
</I>&gt;<i>
</I>&gt;<i> By implication, C1 and C2 must both receive messages about T2, where
</I>&gt;<i> their interests overlap.
</I>&gt;<i>
</I>&gt;<i> Ideally, I want to publish to a single exchange, and, therefore, my
</I>&gt;<i> consumers also bind to this same single exchange. &#160;I say this because
</I>&gt;<i> in fact there are a lot more than three tables to treat - there are
</I>&gt;<i> almost 200. &#160;A proliferation of exchanges per-table would be not good.
</I>&gt;<i>
</I>&gt;<i> I am considering a topic or header exchange.
</I>&gt;<i>
</I>&gt;<i> If a header exchange, I was thinking of the publisher P putting the
</I>&gt;<i> concerned table name in a &quot;table header&quot; and the consumers binding to
</I>&gt;<i> the exchange with an interest in receiving messages with a table
</I>&gt;<i> header value equal to T1, T2, or T3 (I believe x-match == any would be
</I>&gt;<i> appropriate when the consumer binds). &#160;But some of my readings on
</I>&gt;<i> header exhchanges here
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010935.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010935.html</A>
</I>&gt;<i>
</I>&gt;<i> suggest that header exchanges may not be as useful as maybe the name
</I>&gt;<i> suggests. &#160;Maybe I'm being overly paranoid.
</I>&gt;<i>
</I>&gt;<i> And I consider topic exchanges because I know they admit messages
</I>&gt;<i> about T2 consumed by C1 still being available to C2.
</I>&gt;<i>
</I>&gt;<i> Would someone be kind enough to suggest approaches to discern which
</I>&gt;<i> type of exchange to use.
</I>&gt;<i>
</I>&gt;<i> Thank you very kindly.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Mark
</I>


-- 
Mark
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017281.html">[rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
</A></li>
	<LI>Next message: <A HREF="017288.html">[rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17284">[ date ]</a>
              <a href="thread.html#17284">[ thread ]</a>
              <a href="subject.html#17284">[ subject ]</a>
              <a href="author.html#17284">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
