<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ to the browser - scale question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20to%20the%20browser%20-%20scale%20question&In-Reply-To=%3CCABzX%2Bqwf%3DT_YW3SGL%2B-ic4mGL_YzL6sj4AGGBnyWd6DmM-MgjA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017174.html">
   <LINK REL="Next"  HREF="017230.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ to the browser - scale question</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20to%20the%20browser%20-%20scale%20question&In-Reply-To=%3CCABzX%2Bqwf%3DT_YW3SGL%2B-ic4mGL_YzL6sj4AGGBnyWd6DmM-MgjA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ to the browser - scale question">majek04 at gmail.com
       </A><BR>
    <I>Thu Jan  5 11:01:23 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017174.html">[rabbitmq-discuss] Federating distributed RabbitMQ brokers
</A></li>
        <LI>Next message: <A HREF="017230.html">[rabbitmq-discuss] RabbitMQ to the browser - scale question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17178">[ date ]</a>
              <a href="thread.html#17178">[ thread ]</a>
              <a href="subject.html#17178">[ subject ]</a>
              <a href="author.html#17178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Dec 21, 2011 at 01:28, monosodiumg &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">monosodiumg at gmail.com</A>&gt; wrote:
&gt;<i> My use case is distributing data updates &#160;to user's browsers. Typical
</I>&gt;<i> initial load of 5KB and updates of &lt;200B at a rate of 0.5 updates/s.
</I>&gt;<i> I have 500 topics and 1M browser clients, with a very uneven sub
</I>&gt;<i> profile &#160;e.g. 30% of users subscribing to the same one topic. Most
</I>&gt;<i> users subscribe to just one topic. Clients using browsers are a bit
</I>&gt;<i> erratic.
</I>
Outgoing messages = 1M * 0.5 msg/sec = 500K msg/sec

A normal RabbitMQ broker should handle around 30K msg/sec.
With a strong box, new Erlang and HIPE enabled you should
be able to get up to 50K msg/sec per box.

So, for your needs you should consider partitioning the clients
and using mulitple brokers. As far as I understand most messages
are broadcasted (you mentioned 500 topics). Just forwarding
all messages to all brokers should do (as far as the rate of
produced messages is reasonable, let's say few K msg/sec).

By using multiple brokers you also will gain a bit of fault tolerance.

Outgoing throughput = 5KB * churn_rate_per_sec + 1M clients * 200B * 0.5 sec
  - that's around 100MiB/s

Yes, you should use multiple brokers :)

&gt;<i> I have a few questions:
</I>&gt;<i> 1. Can RabbitMQ handle that load?
</I>
Use mutliple brokers and publish all messages to all of them.

&gt;<i> 2. What is the roadmap for rabbitmq_jsonrpc_channel?
</I>
As you may see from the commit history we're not heavily
working on it at the minute. We're considering creating a plugin
that would combine SockJS and rabbitmq-stomp plugin, in order to
allow some form of web messaging.

&gt;<i> 3. How does RabbitMQ (+jsonrpc plugin) deal with browser clients
</I>&gt;<i> failing to disconnect explicitly?
</I>
Frankly - I don't know!

&gt;<i> 4. What does this mean for thread and socket counts server-side?
</I>
Erlang/Rabbit don't use too much operating system threads, don't worry
about that.
But Erlang does use a thing called &quot;erlang processes&quot;, and there is a
preconfigured limit for that. If you're considering starting many connections
against a single RabbitMQ broker you may consider updating that limit.

Socket limit is on most unix-es set to 1024. Feel free to modify this
number using `ulimit -n`.

Additionally, rabbitmq-management plugin shows files/sockets counters,
you can use that to see how rabbit is doing and how many file descriptors
are still available.

Cheers,
   Marek
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017174.html">[rabbitmq-discuss] Federating distributed RabbitMQ brokers
</A></li>
	<LI>Next message: <A HREF="017230.html">[rabbitmq-discuss] RabbitMQ to the browser - scale question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17178">[ date ]</a>
              <a href="thread.html#17178">[ thread ]</a>
              <a href="subject.html#17178">[ subject ]</a>
              <a href="author.html#17178">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
