<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Federation Issues: Disconnects and Failures on	Queue Bind - 2012-01-20
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20Issues%3A%20Disconnects%20and%20Failures%20on%0A%09Queue%20Bind%20-%202012-01-20&In-Reply-To=%3C4F19E73D.9080107%40aol.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017519.html">
   <LINK REL="Next"  HREF="017557.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Federation Issues: Disconnects and Failures on	Queue Bind - 2012-01-20</H1>
    <B>DawgTool</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20Issues%3A%20Disconnects%20and%20Failures%20on%0A%09Queue%20Bind%20-%202012-01-20&In-Reply-To=%3C4F19E73D.9080107%40aol.com%3E"
       TITLE="[rabbitmq-discuss] Federation Issues: Disconnects and Failures on	Queue Bind - 2012-01-20">dawgtool at aol.com
       </A><BR>
    <I>Fri Jan 20 22:14:21 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017519.html">[rabbitmq-discuss] Persistant Messages in TopicExchange
</A></li>
        <LI>Next message: <A HREF="017557.html">[rabbitmq-discuss] Federation Issues: Disconnects and Failures on	Queue Bind - 2012-01-20
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17534">[ date ]</a>
              <a href="thread.html#17534">[ thread ]</a>
              <a href="subject.html#17534">[ subject ]</a>
              <a href="author.html#17534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

Trying to setup Federation across two RabbitMQ clusters (2.7.1, R15B).
Everything seems to start up fine, but then I have a constant stream of 
disconnects, in some cases it doesn't clear the connection, just keeps 
adding more (killed it after reaching several hundred).
It seems to start once I bind a queue to the exchange (dc001-exchange-d) 
on the DOWNSTREAM server.


******************** CONFIG on UPSTREAM ********************
==&gt; enabled_plugins &lt;==
[rabbitmq_management,rabbitmq_management_agent,rabbitmq_management_visualiser,rabbitmq_federation].

==&gt; rabbitmq.config &lt;==
[
   {rabbit,                    [{vm_memory_high_watermark, 0.6},
                                {collect_statistics_interval, 5000},
                                {hipe_compile, true}
                               ]
   },
   {mnesia,                    [{dc_dump_limit, 40},
                                {dump_log_write_threshold, 50000},
                                {send_compressed, 9},
                                {snmp, true}
                               ]
   },
   {rabbitmq_management,       [ {http_log_dir, 
&quot;/data/rabbitmq/dc001/rabbit-mgmt&quot;} ] },
   {rabbitmq_management_agent, [ {force_fine_statistics, true} ] },

   {rabbitmq_federation,       [{exchanges, [
                                       [{exchange, &quot;dc001-exchange-d&quot;}, 
{virtual_host, &quot;/&quot;}, {type, &quot;fanout&quot;}, {durable, true}, {auto_delete, 
false}, {internal, false}, {upstream_set, &quot;dc001-servers&quot;} ]
                                      ]},
                                {upstream_sets, [
                                           {&quot;dc001-servers&quot;, [
                                            [{connection, &quot;host-001&quot;}, 
{exchange, &quot;dc001-exchange-u&quot;}, {max_hops, 1}]
                                           ]}
                                          ]},
                                {connections,   [
                                           {&quot;host-001&quot;, [{host, 
&quot;host-001.domain.com&quot;}, {protocol, &quot;amqp&quot;}, {port, 5672},
                                                           {mechanism, 
default}, {prefetch_count, 1000}, {virtual_host, &quot;/&quot;},
                                                           {username, 
&quot;guest&quot;}, {password, &quot;guest&quot;}, {reconnect_delay, 10},
                                                           {heartbeat, 5}]}
                                          ]},
                                {local_username, &quot;guest&quot;}
                               ]}
].

==&gt; rabbitmq-env.conf &lt;==
NODENAME=dc001
BASE=/data/rabbitmq/dc001
MNESIA_BASE=/data/rabbitmq/dc001/mnesia
LOG_BASE=/data/rabbitmq/dc001/log
SERVER_START_ARGS=&quot;+K true -smp enable&quot;


******************** Log on UPSTREAM ********************
=INFO REPORT==== 20-Jan-2012::16:15:27 ===
accepted TCP connection on 0.0.0.0:5672 from 192.168.0.48:49407

=INFO REPORT==== 20-Jan-2012::16:15:27 ===
starting TCP connection &lt;0.32601.22&gt; from 192.168.0.48:49407

=ERROR REPORT==== 20-Jan-2012::16:15:27 ===
connection &lt;0.32601.22&gt;, channel 2 - error:
{amqp_error,not_found,
             &quot;no exchange 'federation: dc001-exchange-u -&gt; 
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dc001 at host-007.domain.com</A>:dc001-exchange-d A' in vhost '/'&quot;,
             'exchange.delete'}

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
connection &lt;0.32601.22&gt;, channel 1 - error:
{amqp_error,not_found,&quot;no exchange 'dc001-exchange-u' in vhost '/'&quot;,
             'exchange.bind'}

=INFO REPORT==== 20-Jan-2012::16:30:42 ===
closing TCP connection &lt;0.32601.22&gt; from 192.168.0.48:49407

=INFO REPORT==== 20-Jan-2012::16:30:42 ===
accepted TCP connection on 0.0.0.0:5672 from 192.168.0.48:55900

=INFO REPORT==== 20-Jan-2012::16:30:42 ===
starting TCP connection &lt;0.7666.23&gt; from 192.168.0.48:55900

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
connection &lt;0.7666.23&gt;, channel 2 - error:
{amqp_error,not_found,
             &quot;no exchange 'federation: dc001-exchange-u -&gt; 
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dc001 at host-007.domain.com</A>:dc001-exchange-d A' in vhost '/'&quot;,
             'exchange.delete'}

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
connection &lt;0.7666.23&gt;, channel 1 - error:
{amqp_error,not_found,&quot;no exchange 'dc001-exchange-u' in vhost '/'&quot;,
             'exchange.bind'}





******************** Log on DOWNSTREAM ********************
=INFO REPORT==== 20-Jan-2012::16:15:27 ===
Federation exchange 'dc001-exchange-d' in vhost '/' connected to 
host-001.domain.com:5672:/:dc001-exchange-u

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
** Generic server &lt;0.4323.0&gt; terminating
** Last message in was {'$gen_cast',
                         {enqueue,1,
                          {add_binding,
                           {binding,
                            
{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;dc001-exchange-d&quot;&gt;&gt;},
&lt;&lt;&gt;&gt;,
                            {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,
&lt;&lt;&quot;dc.omniture:mongodb:all&quot;&gt;&gt;},
                            []}}}}
** When Server state == {state,
                             {upstream,
                                 
{amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
&lt;&lt;&quot;/&quot;&gt;&gt;,&quot;host-001.domain.com&quot;,5672,0,0,
                                     5,infinity,none,
                                     [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                      
#Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                                     [],[]},
&lt;&lt;&quot;dc001-exchange-u&quot;&gt;&gt;,1000,1,10,none,none,
                                 &quot;host-001&quot;},
&lt;0.4340.0&gt;,&lt;0.4350.0&gt;,
&lt;&lt;&quot;federation: dc001-exchange-u -&gt; 
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dc001 at host-007.domain.com</A>:dc001-exchange-d&quot;&gt;&gt;,
&lt;&lt;&quot;federation: dc001-exchange-u -&gt; 
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dc001 at host-007.domain.com</A>:dc001-exchange-d B&quot;&gt;&gt;,
                             {0,nil},
                             1,
                             {dict,0,16,16,8,80,48,
                                 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  []},
                                 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
&lt;0.4327.0&gt;,&lt;0.4335.0&gt;,
                             
{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;dc001-exchange-d&quot;&gt;&gt;},
                             {0,nil}}
** Reason for termination ==
** {{shutdown,
         {server_initiated_close,404,
&lt;&lt;&quot;NOT_FOUND - no exchange 'dc001-exchange-u' in vhost '/'&quot;&gt;&gt;}},
     {gen_server,call,
         [&lt;0.4350.0&gt;,
          {call,
              {'exchange.bind',0,
&lt;&lt;&quot;federation: dc001-exchange-u -&gt; 
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dc001 at host-007.domain.com</A>:dc001-exchange-d B&quot;&gt;&gt;,
&lt;&lt;&quot;dc001-exchange-u&quot;&gt;&gt;,&lt;&lt;&gt;&gt;,false,[]},
              none,&lt;0.4323.0&gt;},
          infinity]}}

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
** Generic server &lt;0.12029.0&gt; terminating
** Last message in was {'$gen_cast',maybe_go}
** When Server state == {not_started,
                             {{upstream,
                                  {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,
&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                                      &quot;host-001.domain.com&quot;,5672,0,0,5,
                                      infinity,none,
                                      [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                       
#Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                                      [],[]},
&lt;&lt;&quot;dc001-exchange-u&quot;&gt;&gt;,1000,1,10,none,none,
                                  &quot;host-001&quot;},
                              {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
&lt;&lt;&quot;dc001-exchange-d&quot;&gt;&gt;}}}
** Reason for termination ==
** {{shutdown,
         {server_initiated_close,404,
&lt;&lt;&quot;NOT_FOUND - no exchange 'dc001-exchange-u' in vhost '/'&quot;&gt;&gt;}},
     {gen_server,call,
         [&lt;0.12056.0&gt;,
          {call,
              {'exchange.bind',0,
&lt;&lt;&quot;federation: dc001-exchange-u -&gt; 
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dc001 at host-007.domain.com</A>:dc001-exchange-d A&quot;&gt;&gt;,
&lt;&lt;&quot;dc001-exchange-u&quot;&gt;&gt;,&lt;&lt;&gt;&gt;,false,[]},
              none,&lt;0.12029.0&gt;},
          infinity]}}

</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017519.html">[rabbitmq-discuss] Persistant Messages in TopicExchange
</A></li>
	<LI>Next message: <A HREF="017557.html">[rabbitmq-discuss] Federation Issues: Disconnects and Failures on	Queue Bind - 2012-01-20
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17534">[ date ]</a>
              <a href="thread.html#17534">[ thread ]</a>
              <a href="subject.html#17534">[ subject ]</a>
              <a href="author.html#17534">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
