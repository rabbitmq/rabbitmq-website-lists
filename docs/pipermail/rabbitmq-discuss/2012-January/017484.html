<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Lost messages in cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lost%20messages%20in%20cluster&In-Reply-To=%3C25cd13fb-515c-4817-8b51-3855869124cb%40strongmad.batnest.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017483.html">
   <LINK REL="Next"  HREF="017450.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Lost messages in cluster</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lost%20messages%20in%20cluster&In-Reply-To=%3C25cd13fb-515c-4817-8b51-3855869124cb%40strongmad.batnest.org%3E"
       TITLE="[rabbitmq-discuss] Lost messages in cluster">jerryk at vmware.com
       </A><BR>
    <I>Thu Jan 19 00:48:36 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017483.html">[rabbitmq-discuss] Lost messages in cluster
</A></li>
        <LI>Next message: <A HREF="017450.html">[rabbitmq-discuss] [.net client] exception using IBasicProperties
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17484">[ date ]</a>
              <a href="thread.html#17484">[ thread ]</a>
              <a href="subject.html#17484">[ subject ]</a>
              <a href="author.html#17484">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Artsiom:

&gt;<i> I mean a set of brokers, exchanges and queues and relations between them.
</I>
Gotcha.  Sometimes it's helpful to keep the actual network topology of
the brokers and how the networks connect them mentally separate from
the implicit topology of exchanges, bindings, and queues that live
within the brokers, since, as we've seen earlier in this thread, they
often aren't quite the same thing, depending on how things are
configured. :-)

&gt;<i> Not, I dont use mirrored queues.
</I>
Gotcha.

&gt;<i> Each node is physical/virtual machine with installed rabbitmq broker,
</I>&gt;<i> consumer and producer. Consumer and producer always connect to local
</I>&gt;<i> broker.
</I>&gt;<i> Consumer receives messages only from queues that were
</I>&gt;<i> declared on local broker.  Producer publishes messages to fanout
</I>&gt;<i> exchange to which all queues are bound.
</I>
So your consumers and producers live on the same machine as the broker
they're using and essentially use Rabbit as an IPC mechanism?  Or am I
misreading you?  As for the fanout exchanges into which you're
publishing, are you expecting messages pushed into them ever to be
seen on other hosts/nodes?  I'm trying to guess what the nature of
your application is and make sure I'm not misunderstanding you.  It
sounds from the above paragraph that you're not currently looking at a
clustering scenario at all?

&gt;<i> All brokers are in the same
</I>&gt;<i> datacenter, but any broker may become unavailable to others. And if
</I>&gt;<i> that period of time is less than net_ticktime, queue, declared on that
</I>&gt;<i> broker, misses messages.
</I>
So at minimum you have a network environment that you believe is
sufficiently hostile or unreliable that you can't cluster your brokers
using the regular Rabbit/Erlang distribution mechanisms?

&gt;<i> I tried to use active/active mirrored queues, declaring them
</I>&gt;<i> with &quot;x-ha-policy&quot; = &quot;all&quot; and faced some unpleasant issue:
</I>&gt;<i> If any node become unavailable, the command
</I>&gt;<i> # rabbitmqctl list_queues
</I>&gt;<i> hangs and I cant get any information.
</I>
Ah, now *that* shouldn't be happening.  Which version of RabbitMQ were
you using and are you sure your cluster was set up OK?  Does the
broker appear to actually be alive and listening on port 5672 (the
default AMQP port; elsewhere if you've changed it).  Having
rabbitmqctl hang is generally a sign that something is misconfigured...

&gt;<i> Thats why I looked at federation plugin.
</I>
With federation you'd be able to have messages published to one broker
or cluster thereof automatically sent downstream to other
brokers/clusters.  If you're all in a single LAN type deployment this
may be overkill-ish for what you need.

Can you say a bit more about your application and what sorts of things
are communicating and what they're passing amongst one another?  Are
you sure clustering, with an appropriate HA solution, whether the
original active-passive or the new active-active definitely doesn't
meet your needs?

&gt;<i> I'll continue playing with HA queues and hope this solution will help
</I>&gt;<i> to solve my problem. I will keep you informed of the results of my
</I>&gt;<i> experiments.
</I>
Please do.  If I'm missing the structure of your intended use class,
please also disabuse me of my misunderstanding so I can try to help
more coherently... :-)

Best regards,
Jerry
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017483.html">[rabbitmq-discuss] Lost messages in cluster
</A></li>
	<LI>Next message: <A HREF="017450.html">[rabbitmq-discuss] [.net client] exception using IBasicProperties
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17484">[ date ]</a>
              <a href="thread.html#17484">[ thread ]</a>
              <a href="subject.html#17484">[ subject ]</a>
              <a href="author.html#17484">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
