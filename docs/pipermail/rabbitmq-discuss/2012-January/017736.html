<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem in high availability setup together with corosync
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20in%20high%20availability%20setup%20together%0A%20with%20corosync&In-Reply-To=%3C4F22E401.9040606%40native-instruments.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017735.html">
   <LINK REL="Next"  HREF="017763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem in high availability setup together with corosync</H1>
    <B>Christopher Grebs</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20in%20high%20availability%20setup%20together%0A%20with%20corosync&In-Reply-To=%3C4F22E401.9040606%40native-instruments.de%3E"
       TITLE="[rabbitmq-discuss] Problem in high availability setup together with corosync">christopher.grebs at native-instruments.de
       </A><BR>
    <I>Fri Jan 27 17:50:57 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017735.html">[rabbitmq-discuss] Problem in high availability setup together with	corosync
</A></li>
        <LI>Next message: <A HREF="017763.html">[rabbitmq-discuss] Problem in high availability setup together with	corosync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17736">[ date ]</a>
              <a href="thread.html#17736">[ thread ]</a>
              <a href="subject.html#17736">[ subject ]</a>
              <a href="author.html#17736">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey there,

I just missed to say that we are running RabbitMQ 2.7.1.

Regards,
Christopher.

On 01/27/2012 06:49 PM, Christopher Grebs wrote:
&gt;<i> Hey there,
</I>&gt;<i>
</I>&gt;<i> today we experimented with some high availability setup featuring 
</I>&gt;<i> RabbitMQ + HA-Queues and Corosync.  Currently we have this setup:
</I>&gt;<i>
</I>&gt;<i>  * 2 nodes named mq01ha and mq02ha
</I>&gt;<i>
</I>&gt;<i> Both nodes have ha-ip addresses that move to the other node that is 
</I>&gt;<i> not down so that all services can proceed, no matter to what node they 
</I>&gt;<i> are connected.
</I>&gt;<i>
</I>&gt;<i> Our test scenario:
</I>&gt;<i>
</I>&gt;<i> One producer is pushing to mq01ha and one consumer is consuming from 
</I>&gt;<i> mq01ha, the consumer is a bit slower so that messages pile up unacked.
</I>&gt;<i>
</I>&gt;<i> Now we kill mq01ha by pusing the virtual power button (virtual 
</I>&gt;<i> maschines are great!), corosync moves the ip from mq01ha to mq02ha and 
</I>&gt;<i> the consumers and producers proceed with their work.  This works great 
</I>&gt;<i> and everything is fine again.
</I>&gt;<i>
</I>&gt;<i> Now (and this is the part where I need your knowledge) we currently 
</I>&gt;<i> have the setup that if mq01 starts up again the ip address moves back 
</I>&gt;<i> to mq01.
</I>&gt;<i>
</I>&gt;<i> Now mq01 is back up, all consumers and producers are proceeding with 
</I>&gt;<i> their work.  But unfortunately in mq01 and mq02 all messages that were 
</I>&gt;<i> unacked while mq01 gone down are still unacked and there is some not 
</I>&gt;<i> existing connection open in the connections view on rabbitmq. This is 
</I>&gt;<i> true for both, the web interface and for rabbitmqctl. Even if I 
</I>&gt;<i> shutdown all consumers and producers this connection exists, so it's 
</I>&gt;<i> not related to any real TCP connection.
</I>&gt;<i>
</I>&gt;<i> I think that rabbitmq is not designed for this kind of scenario, but 
</I>&gt;<i> maybe you can tell me more about what rabbitmq does.  Maybe we found 
</I>&gt;<i> some bug, I don't know.
</I>&gt;<i>
</I>&gt;<i> What we are now planning is a simple setup with only one ha-ip that 
</I>&gt;<i> moves from host to host only in failover so that - in theory - 
</I>&gt;<i> everything should work properly again.  But we have to check if then 
</I>&gt;<i> again we have the problem that unacked messages stay unacked.
</I>&gt;<i>
</I>&gt;<i> Hopefully I described this stuff clear enough :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Christopher.
</I>&gt;<i>
</I>

-- 
Christopher Grebs
Data Processing Developer

Tel +49-30-611035-1664
Fax -49-30-611035-2652
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">christopher.grebs at native-instruments.de</A>

NATIVE INSTRUMENTS GmbH
Schlesische Strasse 29-30
10997 Berlin, Germany

<A HREF="http://www.native-instruments.com">http://www.native-instruments.com</A>



***

KOMPLETE 8 ULTIMATE - the premium NI producer collection
=&gt;   <A HREF="http://www.native-instruments.com/komplete8">http://www.native-instruments.com/komplete8</A>

TRAKTOR KONTROL S2 - the professional 2.1 DJ system
=&gt;   <A HREF="http://www.native-instruments.com/s2">http://www.native-instruments.com/s2</A>

-&gt;&gt;&gt;&gt;&gt;&gt;  NATIVE INSTRUMENTS - The Future of Sound&lt;&lt;&lt;&lt;&lt;&lt;-

Registergericht: Amtsgericht Charlottenburg
Registernummer: HRB 72458
UST.-ID.-Nr. DE 20 374 7747

Gesch&#228;ftsf&#252;hrung: Daniel Haver (CEO), Mate Galic

</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017735.html">[rabbitmq-discuss] Problem in high availability setup together with	corosync
</A></li>
	<LI>Next message: <A HREF="017763.html">[rabbitmq-discuss] Problem in high availability setup together with	corosync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17736">[ date ]</a>
              <a href="thread.html#17736">[ thread ]</a>
              <a href="subject.html#17736">[ subject ]</a>
              <a href="author.html#17736">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
