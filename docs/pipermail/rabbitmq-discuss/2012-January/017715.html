<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Uneven file descriptor use on HA Cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Uneven%20file%20descriptor%20use%20on%20HA%20Cluster&In-Reply-To=%3C4F229226.7090408%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017696.html">
   <LINK REL="Next"  HREF="017729.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Uneven file descriptor use on HA Cluster</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Uneven%20file%20descriptor%20use%20on%20HA%20Cluster&In-Reply-To=%3C4F229226.7090408%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Uneven file descriptor use on HA Cluster">simon at rabbitmq.com
       </A><BR>
    <I>Fri Jan 27 12:01:42 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017696.html">[rabbitmq-discuss] Uneven file descriptor use on HA Cluster
</A></li>
        <LI>Next message: <A HREF="017729.html">[rabbitmq-discuss] Uneven file descriptor use on HA Cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17715">[ date ]</a>
              <a href="thread.html#17715">[ thread ]</a>
              <a href="subject.html#17715">[ subject ]</a>
              <a href="author.html#17715">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi.

First of all, a few points: RabbitMQ will try to be smart about its use 
of file descriptors for actual files - while one descriptor will be used 
for each *connection*, it will keep file descriptors open until it 
starts to run out, at which point it will start to swap them.

So seeing high numbers of file descriptors used with low numbers of 
connections open is not a cause to panic - especially if you have lots 
of queues.

Having said that, if you don't have lots of queues then that number of 
FDs used is odd. And the asymmetry is odd too, unless you have lots of 
non-mirrored queues on one node.

What does lsof say?

Finally, lots of bugs got fixed around HA between 2.6.1 and 2.7.1 so it 
might be worth upgrading in case that helps.

Cheers, Simon

On 26/01/12 16:04, Dave Seltzer wrote:
&gt;<i> Hello Everyone,
</I>&gt;<i>
</I>&gt;<i> My google-fu is failing me, so maybe someone can help me out with an
</I>&gt;<i> issue I&#8217;ve been having.
</I>&gt;<i>
</I>&gt;<i> I have two RabbitMQ 2.6.1 servers running on Centos 5.7. The two servers
</I>&gt;<i> (QueuePool01 and QueuePool02) are running as a cluster as we have a
</I>&gt;<i> number of durable HA queues. I&#8217;m load-balancing client-interactions
</I>&gt;<i> using HAproxy on a third server.
</I>&gt;<i>
</I>&gt;<i> I started noticing that QueuePool02was using ~800 out of 1024 file
</I>&gt;<i> descriptors (while QueuePool01 was only using ~50). So to decrease the
</I>&gt;<i> risk of running out of descriptors I increase the number to 4096 and
</I>&gt;<i> restarted the node.
</I>&gt;<i>
</I>&gt;<i> Now, again I see the number of file descriptors on QueuePool02
</I>&gt;<i> increasing even though QueuePool01 is remaining steady. Is it possible
</I>&gt;<i> there is some sort of leak? Should the two servers tend to use the same
</I>&gt;<i> number of file descriptors?
</I>&gt;<i>
</I>&gt;<i> Here is what the current load looks like
</I>&gt;<i>
</I>&gt;<i> Dave S
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017696.html">[rabbitmq-discuss] Uneven file descriptor use on HA Cluster
</A></li>
	<LI>Next message: <A HREF="017729.html">[rabbitmq-discuss] Uneven file descriptor use on HA Cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17715">[ date ]</a>
              <a href="thread.html#17715">[ thread ]</a>
              <a href="subject.html#17715">[ subject ]</a>
              <a href="author.html#17715">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
