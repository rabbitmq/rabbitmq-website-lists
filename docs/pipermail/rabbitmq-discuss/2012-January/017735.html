<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem in high availability setup together with	corosync
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20in%20high%20availability%20setup%20together%20with%0A%09corosync&In-Reply-To=%3C4F22E391.5060908%40native-instruments.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017762.html">
   <LINK REL="Next"  HREF="017736.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem in high availability setup together with	corosync</H1>
    <B>Christopher Grebs</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20in%20high%20availability%20setup%20together%20with%0A%09corosync&In-Reply-To=%3C4F22E391.5060908%40native-instruments.de%3E"
       TITLE="[rabbitmq-discuss] Problem in high availability setup together with	corosync">christopher.grebs at native-instruments.de
       </A><BR>
    <I>Fri Jan 27 17:49:05 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017762.html">[rabbitmq-discuss] Specifying channel_max
</A></li>
        <LI>Next message: <A HREF="017736.html">[rabbitmq-discuss] Problem in high availability setup together with corosync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17735">[ date ]</a>
              <a href="thread.html#17735">[ thread ]</a>
              <a href="subject.html#17735">[ subject ]</a>
              <a href="author.html#17735">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey there,

today we experimented with some high availability setup featuring 
RabbitMQ + HA-Queues and Corosync.  Currently we have this setup:

  * 2 nodes named mq01ha and mq02ha

Both nodes have ha-ip addresses that move to the other node that is not 
down so that all services can proceed, no matter to what node they are 
connected.

Our test scenario:

One producer is pushing to mq01ha and one consumer is consuming from 
mq01ha, the consumer is a bit slower so that messages pile up unacked.

Now we kill mq01ha by pusing the virtual power button (virtual maschines 
are great!), corosync moves the ip from mq01ha to mq02ha and the 
consumers and producers proceed with their work.  This works great and 
everything is fine again.

Now (and this is the part where I need your knowledge) we currently have 
the setup that if mq01 starts up again the ip address moves back to mq01.

Now mq01 is back up, all consumers and producers are proceeding with 
their work.  But unfortunately in mq01 and mq02 all messages that were 
unacked while mq01 gone down are still unacked and there is some not 
existing connection open in the connections view on rabbitmq. This is 
true for both, the web interface and for rabbitmqctl. Even if I shutdown 
all consumers and producers this connection exists, so it's not related 
to any real TCP connection.

I think that rabbitmq is not designed for this kind of scenario, but 
maybe you can tell me more about what rabbitmq does.  Maybe we found 
some bug, I don't know.

What we are now planning is a simple setup with only one ha-ip that 
moves from host to host only in failover so that - in theory - 
everything should work properly again.  But we have to check if then 
again we have the problem that unacked messages stay unacked.

Hopefully I described this stuff clear enough :)


Thanks!

Cheers,
Christopher.

-- 
Christopher Grebs
Data Processing Developer

Tel +49-30-611035-1664
Fax -49-30-611035-2652
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">christopher.grebs at native-instruments.de</A>

NATIVE INSTRUMENTS GmbH
Schlesische Strasse 29-30
10997 Berlin, Germany

<A HREF="http://www.native-instruments.com">http://www.native-instruments.com</A>



***

KOMPLETE 8 ULTIMATE - the premium NI producer collection
=&gt;   <A HREF="http://www.native-instruments.com/komplete8">http://www.native-instruments.com/komplete8</A>

TRAKTOR KONTROL S2 - the professional 2.1 DJ system
=&gt;   <A HREF="http://www.native-instruments.com/s2">http://www.native-instruments.com/s2</A>

-&gt;&gt;&gt;&gt;&gt;&gt;  NATIVE INSTRUMENTS - The Future of Sound&lt;&lt;&lt;&lt;&lt;&lt;-

Registergericht: Amtsgericht Charlottenburg
Registernummer: HRB 72458
UST.-ID.-Nr. DE 20 374 7747

Gesch&#228;ftsf&#252;hrung: Daniel Haver (CEO), Mate Galic

</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017762.html">[rabbitmq-discuss] Specifying channel_max
</A></li>
	<LI>Next message: <A HREF="017736.html">[rabbitmq-discuss] Problem in high availability setup together with corosync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17735">[ date ]</a>
              <a href="thread.html#17735">[ thread ]</a>
              <a href="subject.html#17735">[ subject ]</a>
              <a href="author.html#17735">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
