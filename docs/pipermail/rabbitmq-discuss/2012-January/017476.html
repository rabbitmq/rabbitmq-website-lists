<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ HA
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20HA&In-Reply-To=%3C24684219.1780.1326906982618.JavaMail.geo-discussion-forums%40prlk31%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017466.html">
   <LINK REL="Next"  HREF="017356.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ HA</H1>
    <B>jrob</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20HA&In-Reply-To=%3C24684219.1780.1326906982618.JavaMail.geo-discussion-forums%40prlk31%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ HA">roberts.john at gmail.com
       </A><BR>
    <I>Wed Jan 18 17:16:22 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017466.html">[rabbitmq-discuss] RabbitMQ HA
</A></li>
        <LI>Next message: <A HREF="017356.html">[rabbitmq-discuss] Clarification needed for HA of RabbitMQ	statistics database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17476">[ date ]</a>
              <a href="thread.html#17476">[ thread ]</a>
              <a href="subject.html#17476">[ subject ]</a>
              <a href="author.html#17476">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yup, that was it exactly.  I just had the diff up, so here are the two 
major changes I had to make:

-    channel.queue( @queue, :durable =&gt; true ).subscribe(:ack=&gt;true) do 
|<i>header,message|
</I>+    channel.queue( @queue, :durable =&gt; true, :arguments =&gt; {'x-ha-policy' 
=&gt; 'all'} ).subscribe(:ack=&gt;true) do |header,message|

   def self.get_channel(host)
     connection = AMQP.connect( :host=&gt;host )
+    connection.on_connection_interruption do |conn, settings|
+      conn.reconnect(false,1)
+    end
+
     channel    = AMQP::Channel.new( connection )
+    channel.auto_recovery = true
+
+    channel
   end

As I said, this hasn't gone into production yet, but it seems to be doing 
well in our staging environment.  I don't think our message rate is high 
enough to really exercise this setup in staging, so I can't really comment 
on performance yet.  (We're holding off moving this into production as we 
are trying to provide high availability for our applications and services 
across the board, which in some cases means we will be using one VM for 
multiple services.  Since the other services aren't ready to go yet, we 
haven't pushed this up.)

- jrob

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/63fd7f23/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/63fd7f23/attachment.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017466.html">[rabbitmq-discuss] RabbitMQ HA
</A></li>
	<LI>Next message: <A HREF="017356.html">[rabbitmq-discuss] Clarification needed for HA of RabbitMQ	statistics database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17476">[ date ]</a>
              <a href="thread.html#17476">[ thread ]</a>
              <a href="subject.html#17476">[ subject ]</a>
              <a href="author.html#17476">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
