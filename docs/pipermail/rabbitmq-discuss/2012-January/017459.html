<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ HA
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20HA&In-Reply-To=%3C11354968.2215.1326848670369.JavaMail.geo-discussion-forums%40prdv33%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017351.html">
   <LINK REL="Next"  HREF="017460.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ HA</H1>
    <B>jrob</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20HA&In-Reply-To=%3C11354968.2215.1326848670369.JavaMail.geo-discussion-forums%40prdv33%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ HA">roberts.john at gmail.com
       </A><BR>
    <I>Wed Jan 18 01:04:30 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017351.html">[rabbitmq-discuss] RabbitMQ HA
</A></li>
        <LI>Next message: <A HREF="017460.html">[rabbitmq-discuss] RabbitMQ HA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17459">[ date ]</a>
              <a href="thread.html#17459">[ thread ]</a>
              <a href="subject.html#17459">[ subject ]</a>
              <a href="author.html#17459">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In order to do this in our setup, we use HAProxy &lt;<A HREF="http://haproxy.1wt.eu/">http://haproxy.1wt.eu/</A>&gt; in 
front of three virtual machines (our systems are all deployed on RackSpace 
Cloud VMs).  All of our software only knows about the Virtual IP that 
points at our HAProxy installation; HAProxy knows about the three VMs, each 
of which is running one node of a RabbitMQ cluster.  All of our Queues are 
created as HA queues so that messages are replicated across all nodes in 
the event of a single node failure.

This method allows us to simply add another VM and bring it into the 
cluster if we want to expand capacity, and no updates are required to our 
code base as it continues to interact with HAProxy for connections.  The 
trick was to make sure we set everything up properly to automatically 
reconnect in our code in the event of a disconnection, as HAProxy times out 
connections at an interval determined by your settings.

Having said all that, we have yet to move this into production, so I can't 
speak to whether or not it will behave as anticipated in the wild. 
 However, initial testing is very promising, and when we force a node to 
fail, HAProxy automatically detects that it has gone down, and just stops 
handing out connections to that node.  Just in case anyone complains about 
the single point of failure that is HAProxy, that has also been setup to 
failover on a Virtual IP; should our main HAProxy machine ever go down, the 
other HAProxy instance will take over and continue handing out node 
connections.

This has been an interesting experiment, feel free to bug me if you want 
more details on our setup.

- jrob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/ef7f62c1/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/ef7f62c1/attachment.htm</A>&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017351.html">[rabbitmq-discuss] RabbitMQ HA
</A></li>
	<LI>Next message: <A HREF="017460.html">[rabbitmq-discuss] RabbitMQ HA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17459">[ date ]</a>
              <a href="thread.html#17459">[ thread ]</a>
              <a href="subject.html#17459">[ subject ]</a>
              <a href="author.html#17459">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
