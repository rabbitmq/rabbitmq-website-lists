<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue Lease (x-expires)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20Lease%20%28x-expires%29&In-Reply-To=%3CCAD59333-CC5B-4C0A-957D-85115324B4A8%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017545.html">
   <LINK REL="Next"  HREF="017563.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue Lease (x-expires)</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20Lease%20%28x-expires%29&In-Reply-To=%3CCAD59333-CC5B-4C0A-957D-85115324B4A8%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Queue Lease (x-expires)">steve at rabbitmq.com
       </A><BR>
    <I>Mon Jan 23 12:23:43 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017545.html">[rabbitmq-discuss] Queue Lease (x-expires)
</A></li>
        <LI>Next message: <A HREF="017563.html">[rabbitmq-discuss] Queue Lease (x-expires)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17562">[ date ]</a>
              <a href="thread.html#17562">[ thread ]</a>
              <a href="subject.html#17562">[ subject ]</a>
              <a href="author.html#17562">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yogesh,

rabbitmqadmin can delete the queue but without the checks that it might not be
empty and might be being used.  If you can be sure that the queue is dead, then
a rabbitmqadmin check followed by a delete would be quite adequate.

However, if it is possible that the queue might not be dead (just usage being
slow) or it might be reused, then it is imperative that the delete be
conditional.  The java client interface (or some other client interface) should
be used to make the delete conditional.

We notice here that the rabbitmqadmin interface doesn't allow you to
conditionally delete. We have raised a bug to do this -- but in the meantime, I
would code a script that issues the rabbitmqadmin calls to determine which
queues to conditionally delete, and then invoke simple stand-alone client app to
do the conditional deletes.   It's a bit klunky, but reasonably safe.

Hope this helps.
Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 22 Jan 2012, at 07:40, Yogesh Ketkar wrote:

&gt;<i> Thanks Steve and Simon.
</I>&gt;<i> 
</I>&gt;<i> I checked that rabbitmqadmin.py uses http calls (RESTful APIs)
</I>&gt;<i> provided by RabbitMQ to perform the operations.
</I>&gt;<i> Can you provide me a sample
</I>&gt;<i> - (either using rabbitmqadmin or using RESTful client) to delete a
</I>&gt;<i> queue say &quot;Yogesh&quot; with isEmpty and isUnused flags set to True?
</I>&gt;<i>  I could delete the queue using DELETE http request on
</I>&gt;<i> <A HREF="http://localhost:55672/api/queues/%2f/Yogesh">http://localhost:55672/api/queues/%2f/Yogesh</A>
</I>&gt;<i>  But couldn't figure out a way to specify isEmpty and isUnused flags.
</I>&gt;<i> - I was able to do this in a Java client using interface
</I>&gt;<i> com.rabbitmq.client.Channel { queueDelete(&quot;Yogesh&quot;, true, true) }.
</I>&gt;<i>  But then, how do I get list of queues using com.rabbitmq.client?
</I>&gt;<i> 
</I>&gt;<i> regards, Yogesh
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Jan 20, 7:25 pm, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">st... at rabbitmq.com</A>&gt; wrote:
</I>&gt;&gt;<i> Just a thought,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If you go the way Simon says and have something from outside poking the mgmt API
</I>&gt;&gt;<i> every few minutes, make sure you issue queueDelete with the if-empty bit set.
</I>&gt;&gt;<i> There is a window between the poking and the deleting in which messages may
</I>&gt;&gt;<i> arrive on the queue (i.e. it's not idle anymore), and it may even not be in-use
</I>&gt;&gt;<i> (have consumers) by the time you get to it.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Steve Powell
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">st... at rabbitmq.com</A>
</I>&gt;&gt;<i> [wrk:+44-2380-111-528begin_of_the_skype_highlighting            +44-2380-111-528      ] [mob:+44-7815-838-558begin_of_the_skype_highlighting            +44-7815-838-558      ]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On 20 Jan 2012, at 12:47, Simon MacMullen wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On 16/01/12 15:56, Yogesh Ketkar wrote:
</I>&gt;&gt;&gt;&gt;<i> I would like to delete the queue with no messages in it and so asked
</I>&gt;&gt;&gt;&gt;<i> the question.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I see.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Can you suggest an alternative to achieve
</I>&gt;&gt;&gt;&gt;<i> 1. Delete the queue when last event processed from the queue has
</I>&gt;&gt;&gt;&gt;<i> &lt;Action&gt;Delete&lt;/Action&gt;  as this implies that
</I>&gt;&gt;&gt;&gt;<i>    no more events with same&lt;AppId&gt;  would ever get created.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Well, you could have your client do that.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 2. Delete the queue when it is IDLE for certain period, meaning it is
</I>&gt;&gt;&gt;&gt;<i> empty and no more event was added to it for certain time period.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Hmm. Well there's nothing built in to do this, but you could have something from outside poking the mgmt API every few minutes - look at the output of (e.g.)
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> rabbitmqadmin list queues name messages consumers idle_since
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Cheers, Simon
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> Simon MacMullen
</I>&gt;&gt;&gt;<i> RabbitMQ, VMware
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/85a4060e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/85a4060e/attachment.htm</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017545.html">[rabbitmq-discuss] Queue Lease (x-expires)
</A></li>
	<LI>Next message: <A HREF="017563.html">[rabbitmq-discuss] Queue Lease (x-expires)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17562">[ date ]</a>
              <a href="thread.html#17562">[ thread ]</a>
              <a href="subject.html#17562">[ subject ]</a>
              <a href="author.html#17562">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
