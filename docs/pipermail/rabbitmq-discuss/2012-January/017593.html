<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Shovel questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20questions&In-Reply-To=%3CCAFDmHdNb_UbPrS2%3DePhqr3MVX1b4SuYvyU6jXKjYfy-SOBnRVg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017546.html">
   <LINK REL="Next"  HREF="017594.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Shovel questions</H1>
    <B>Elias Levy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20questions&In-Reply-To=%3CCAFDmHdNb_UbPrS2%3DePhqr3MVX1b4SuYvyU6jXKjYfy-SOBnRVg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Shovel questions">fearsome.lucidity at gmail.com
       </A><BR>
    <I>Mon Jan 23 21:44:42 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017546.html">[rabbitmq-discuss] Shovel questions
</A></li>
        <LI>Next message: <A HREF="017594.html">[rabbitmq-discuss] Shovel questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17593">[ date ]</a>
              <a href="thread.html#17593">[ thread ]</a>
              <a href="subject.html#17593">[ subject ]</a>
              <a href="author.html#17593">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Jan 22, 2012 at 4:46 AM, Simone Busoli &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simone.busoli at gmail.com</A>&gt;wrote:

&gt;<i> On Sat, Jan 21, 2012 at 23:58, Elias Levy &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">fearsome.lucidity at gmail.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> We are thinking of exposing a portion of our message bus to customers.
</I>&gt;&gt;<i>  To do we we will be creating a new cluster that can be exposed and will be
</I>&gt;&gt;<i> linking it to our existing cluster.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've looked a the Federation plug-in, but it has a feature disqualifies
</I>&gt;&gt;<i> it for our purposes.   We'd like to keep communications from our existing
</I>&gt;&gt;<i> cluster to the new exposed cluster unidirectional.  That means now allowing
</I>&gt;&gt;<i> incoming connections into the existing cluster, in case there is ever a
</I>&gt;&gt;<i> RabbitMQ vulnerability (or say, an Erlang or OpenSSL vulnerability) that
</I>&gt;&gt;<i> would allow the external cluster to be compromised.  Since both cluster are
</I>&gt;&gt;<i> running RabbitMQ, we don't want an attacker to be able to jump from the
</I>&gt;&gt;<i> external cluster to the internal one.  From what I've gathered, the AMQP
</I>&gt;&gt;<i> client that the Federation plug-in uses executed within the downstream
</I>&gt;&gt;<i> broker, and thus it has to be able to make an AMQP connection to the
</I>&gt;&gt;<i> upstream broker.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is that correct?  Any plans to allow for the opposite behavior (upstream
</I>&gt;&gt;<i> connects to the downstream broker)?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I don't know the internals of the federation plugin well enough to be able
</I>&gt;<i> to answer this question. I know that it uses exchange-exchange bindings and
</I>&gt;<i> I'm not sure if it's even feasible to have it work in the way you describe.
</I>&gt;<i>
</I>
I think you are wrong.  The Federation plug-in does not use
exchange-to-exchange bindings.  Such bindings are not supported across
virtual hosts, never mind across clusters.  The Federation plug-in merely
provides a nice illusion of such binding by using an internal AMQP client
as I described.

Any other takers?

That leaves us with the Shovel plug-in, which can be configured to run on
&gt;&gt;<i> either the upstream or downstream broker.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One problem with the Shovel plug-in is that it appears you can only
</I>&gt;&gt;<i> manage the shovels within the configuration file.  Is there no way to
</I>&gt;&gt;<i> manage shovels online, either through AMQP or a management plug-in?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> No, there is no way to do that except in the configuration file.
</I>&gt;<i>
</I>
That's too bad.


&gt;<i> If neither of those are possible, can RabbitMQ reload its configuration
</I>&gt;&gt;<i> without restarting?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> No, you cannot do that. Nonetheless be aware that shovel is not hard to
</I>&gt;<i> set up manually as an external component from the broker, although with
</I>&gt;<i> some gotchas. We've been doing that for some time before the federation
</I>&gt;<i> plugin was published.
</I>&gt;<i>
</I>
Interesting.  Do you have any documentation on how one may go about doing
so?  Or are you merely standing up a new RabbitMQ instance with the shovel
configured, and not using the broker in those new instances?

One disadvantage of running the shovel appart from the downstream and
upstream brokers is that now the messages must cross the network twice,
once from the upstream to the shovel, and then from the shovel to the
downstream.  With the shovel within the upstream or downstream broker only
one network transfer is needed.


&gt;<i> Finally, its unclear whether you should only define a shovel in a single
</I>&gt;&gt;<i> node in a cluster or in multiple ones?  If you define it in multiple ones,
</I>&gt;&gt;<i> does it create multiple shovel clients competing for messages?  If not,
</I>&gt;&gt;<i> will a shovel fail over if the node with the existing client fails?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Shovel is a low level mechanis, so whatever you configure it, it will do
</I>&gt;<i> what you told it to, i.e. pick messages from one queue and publish them to
</I>&gt;<i> some exchange. How you set it up is then up to you according to what you
</I>&gt;<i> want to accomplish.
</I>&gt;<i>
</I>
I understand that.  My question is whether the shovel is cluster aware,
like the federation plug-in.

The federation plug-in, when configured on all nodes, will only make a
single connection to the upstream broker, and if the nodes with the
connection dies, another node will create a new one.

My understanding is that the shovel is not cluster aware.  If you configure
the shovel on each node in your cluster, you'll end up with as many shovels
and connections as there are nodes.  That's not particularly bad, as it
will give you load balancing across nodes, but I want to confirm my
understanding.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/212f988e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/212f988e/attachment.htm</A>&gt;
</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017546.html">[rabbitmq-discuss] Shovel questions
</A></li>
	<LI>Next message: <A HREF="017594.html">[rabbitmq-discuss] Shovel questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17593">[ date ]</a>
              <a href="thread.html#17593">[ thread ]</a>
              <a href="subject.html#17593">[ subject ]</a>
              <a href="author.html#17593">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
