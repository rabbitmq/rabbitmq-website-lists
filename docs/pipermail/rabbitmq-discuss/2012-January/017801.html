<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering - communication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20-%20communication&In-Reply-To=%3C20120131134341.GA4567%40southbank.eng.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017808.html">
   <LINK REL="Next"  HREF="017802.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering - communication</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20-%20communication&In-Reply-To=%3C20120131134341.GA4567%40southbank.eng.vmware.com%3E"
       TITLE="[rabbitmq-discuss] Clustering - communication">alexandru at rabbitmq.com
       </A><BR>
    <I>Tue Jan 31 13:43:41 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017808.html">[rabbitmq-discuss] Clustering - communication
</A></li>
        <LI>Next message: <A HREF="017802.html">[rabbitmq-discuss] Clustering - communication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17801">[ date ]</a>
              <a href="thread.html#17801">[ thread ]</a>
              <a href="subject.html#17801">[ subject ]</a>
              <a href="author.html#17801">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> But I think I have it: backend is on 2.4.1 and back2 is on 2.7.1. They
</I>&gt;<i> both use the same 0-9-1 protocol but that'll be it, won't it?
</I>
They both need to be the same version.  AMQP is used to talk to the
clients; Erlang messages are used to communicate inside the cluster.  As
a rule, all nodes need to run the same version of Erlang and the same
version of RabbitMQ.  If they don't, it might work, but the behaviour is
undefined.

&gt;<i> &gt; Well, one of them has to be.
</I>&gt;<i> Well - for example - if backend is started (and processing messages)
</I>&gt;<i> and back2 is stopped - and I run the command:
</I>&gt;<i> rabbitmqctl -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at backend</A> status
</I>&gt;<i> or:
</I>&gt;<i> rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at backend</A>
</I>&gt;<i>  on back2 - that should be OK?
</I>
Yes.

&gt;<i> &gt; Stop_app is the equivalent of a clean shutdown, so, it will kill
</I>&gt;<i> &gt; transient messages/queues, but save to disc persistent messages/durable
</I>&gt;<i> &gt; queues/any other configuration.
</I>&gt;<i> So the solution is to make everything durable I want to keep?
</I>
Yes.

&gt;<i> Is the same true when I just do:
</I>&gt;<i> /etc/init.d/rabitmq-server stop
</I>
Yes.

&gt;<i> &gt;&#160;Again, when it's stopped, it won't have
</I>&gt;<i> &gt; any connections, so it won't get new messages.
</I>&gt;<i> That's why we're trying to do it as fast as possible.
</I>
Bear in mind that the more persistent things you have (messages and
queues), the longer it will take for RabbitMQ to shutdown and to recover
from unclean shutdowns (caused by killing the rabbitmq-server process,
for instance).

The problem you're seeing is probably caused by the version mismatch.

Cheers,
Alex

On Tue, Jan 31, 2012 at 01:21:49PM +0000, Dan Dart wrote:
&gt;<i> &gt; You seem to have done everything right.
</I>&gt;<i> Ouch.
</I>&gt;<i> 
</I>&gt;<i> &gt; Well, one of them has to be.
</I>&gt;<i> Well - for example - if backend is started (and processing messages)
</I>&gt;<i> and back2 is stopped - and I run the command:
</I>&gt;<i> rabbitmqctl -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at backend</A> status
</I>&gt;<i> or:
</I>&gt;<i> rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at backend</A>
</I>&gt;<i>  on back2 - that should be OK?
</I>&gt;<i> 
</I>&gt;<i>  &gt; The *target* nodes also have to be started for rabbitmqctl to work.
</I>&gt;<i> The ones you're trying to cluster into - they are started.
</I>&gt;<i> 
</I>&gt;<i> &gt; Stop_app is the equivalent of a clean shutdown, so, it will kill
</I>&gt;<i> &gt; transient messages/queues, but save to disc persistent messages/durable
</I>&gt;<i> &gt; queues/any other configuration.
</I>&gt;<i> So the solution is to make everything durable I want to keep?
</I>&gt;<i> Is the same true when I just do:
</I>&gt;<i> /etc/init.d/rabitmq-server stop
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt;&#160;Again, when it's stopped, it won't have
</I>&gt;<i> &gt; any connections, so it won't get new messages.
</I>&gt;<i> That's why we're trying to do it as fast as possible.
</I>&gt;<i> 
</I>&gt;<i> &gt; That sounds a bit worrying. &#160;Could you just put some human readable text
</I>&gt;<i> &gt; in both (e.g. &quot;test&quot;), make sure that both nodes are started, and try
</I>&gt;<i> &gt; the rabbitmqctl status command from one to the other?
</I>&gt;<i> Well - yes - it reads the same on each. No more carriage returns - the
</I>&gt;<i> hex is exact.
</I>&gt;<i> and the current node cookie hash is also the same.
</I>&gt;<i> 
</I>&gt;<i> But I think I have it: backend is on 2.4.1 and back2 is on 2.7.1. They
</I>&gt;<i> both use the same 0-9-1 protocol but that'll be it, won't it?
</I>&gt;<i> 
</I>&gt;<i> Cheers
</I>&gt;<i> Dan
</I></PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017808.html">[rabbitmq-discuss] Clustering - communication
</A></li>
	<LI>Next message: <A HREF="017802.html">[rabbitmq-discuss] Clustering - communication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17801">[ date ]</a>
              <a href="thread.html#17801">[ thread ]</a>
              <a href="subject.html#17801">[ subject ]</a>
              <a href="author.html#17801">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
