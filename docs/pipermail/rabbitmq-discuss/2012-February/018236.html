<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumers may hang after network instability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumers%20may%20hang%20after%20network%20instability&In-Reply-To=%3C6391f6db-070f-4848-9d1f-86b628598d14%40k40g2000yqf.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018230.html">
   <LINK REL="Next"  HREF="018238.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumers may hang after network instability</H1>
    <B>Alexey</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumers%20may%20hang%20after%20network%20instability&In-Reply-To=%3C6391f6db-070f-4848-9d1f-86b628598d14%40k40g2000yqf.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Consumers may hang after network instability">gmlexx at gmail.com
       </A><BR>
    <I>Fri Feb 17 10:22:05 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018230.html">[rabbitmq-discuss] Question about using multi-channel
</A></li>
        <LI>Next message: <A HREF="018238.html">[rabbitmq-discuss] Consumers may hang after network instability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18236">[ date ]</a>
              <a href="thread.html#18236">[ thread ]</a>
              <a href="subject.html#18236">[ subject ]</a>
              <a href="author.html#18236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

We are using 2.7.1 version of .NET client and 2.7.1 rabbitmq-server.
Several times we catched all consumers of rabbitmq server was hang
after network instability (lost and reestablished connection or server
with rabbitmq power cable unpluged)

Problem method is IModel.Close() or IConnection.Close() (sorry, I
don't remember which is)

Parts of our code responded for connection below:

public void Connect()
{
	var cf = new ConnectionFactory
	{
		HostName = replica.EndPoint.Address.ToString(),
		Port = replica.EndPoint.Port,
		UserName = mqUsername,
		Password = mqPassword,
	};
	connection = cf.CreateConnection();
	Model = connection.CreateModel();
	Model.DeclareQueue(queueName);
	Model.BasicConsume(queueName, false, thisConsumerTag, true, false,
null, this);
}

public void Disconnect(){
	if (Model != null &amp;&amp; Model.IsOpen) Model.Close(200, &quot;Close on client
initiative&quot;);
	if (connection != null &amp;&amp; connection.IsOpen) connection.Close(200,
&quot;Close on client initiative&quot;, disconnectTimeout);
}

Can anyone suggest a right way to close connection without chance to
hang?
Would appreciate for help.
</PRE>


































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018230.html">[rabbitmq-discuss] Question about using multi-channel
</A></li>
	<LI>Next message: <A HREF="018238.html">[rabbitmq-discuss] Consumers may hang after network instability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18236">[ date ]</a>
              <a href="thread.html#18236">[ thread ]</a>
              <a href="subject.html#18236">[ subject ]</a>
              <a href="author.html#18236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
