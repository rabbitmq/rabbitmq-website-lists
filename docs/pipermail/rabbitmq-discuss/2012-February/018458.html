<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Moving a queue from one node to another
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Moving%20a%20queue%20from%20one%20node%20to%20another&In-Reply-To=%3C20120228112155.GA26899%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018443.html">
   <LINK REL="Next"  HREF="018456.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Moving a queue from one node to another</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Moving%20a%20queue%20from%20one%20node%20to%20another&In-Reply-To=%3C20120228112155.GA26899%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Moving a queue from one node to another">matthew at rabbitmq.com
       </A><BR>
    <I>Tue Feb 28 11:21:55 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018443.html">[rabbitmq-discuss] Moving a queue from one node to another
</A></li>
        <LI>Next message: <A HREF="018456.html">[rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18458">[ date ]</a>
              <a href="thread.html#18458">[ thread ]</a>
              <a href="subject.html#18458">[ subject ]</a>
              <a href="author.html#18458">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ionel,

On Mon, Feb 27, 2012 at 07:25:41PM +0000, Ionel Gog wrote:
&gt;<i> Is there any way I can move queues from one RabbitMQ node to another?
</I>
Nope, sorry, not an individual queue.

&gt;<i> - Mirrored queues. But I don't think you can make a queue mirrored *after*
</I>&gt;<i> it has been created. Can you?
</I>
No, you can't do that.

&gt;<i> - Shared network disk. But this requires a broker restart - and thus
</I>&gt;<i> implies loosing all non-durable queues and non-persistent messages.
</I>&gt;<i> 
</I>&gt;<i> Is there any other way?
</I>
I would suggest something along the lines of the following.

- bring up the new broker. Do not cluster it.
- declare all the exchanges/bindings/queues you need on the new broker
  - i.e. have the topology match exactly
- change all publishers to be publishing to the new broker
- wait for all messages to be drained from the old broker, and then
  switch over all consumers to be consuming from the new broker
- shut down the old broker

In general, whilst this does require manual intervention, and will
certainly require thought especially if your consumers also publish
messages (you'll want to abstract those connections out and generally
start the switchover from the top of the message flow to the bottom),
this process does allow you to upgrade Rabbits with no downtime at all,
though potentially with some service disruption.

Matthew
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018443.html">[rabbitmq-discuss] Moving a queue from one node to another
</A></li>
	<LI>Next message: <A HREF="018456.html">[rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18458">[ date ]</a>
              <a href="thread.html#18458">[ thread ]</a>
              <a href="subject.html#18458">[ subject ]</a>
              <a href="author.html#18458">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
