<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unexpected%20behaviour%20with%20STOMP%20%26%20NACK&In-Reply-To=%3C20120222131513.83a8.abe10f7e5afbbb3a79ce619739541149%40cern.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018335.html">
   <LINK REL="Next"  HREF="018428.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK</H1>
    <B>Lionel Cons</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unexpected%20behaviour%20with%20STOMP%20%26%20NACK&In-Reply-To=%3C20120222131513.83a8.abe10f7e5afbbb3a79ce619739541149%40cern.ch%3E"
       TITLE="[rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK">lionel.cons at cern.ch
       </A><BR>
    <I>Wed Feb 22 12:24:19 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018335.html">[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</A></li>
        <LI>Next message: <A HREF="018428.html">[rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18334">[ date ]</a>
              <a href="thread.html#18334">[ thread ]</a>
              <a href="subject.html#18334">[ subject ]</a>
              <a href="author.html#18334">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I get an unexpected behaviour with STOMP &amp; NACK with RabbitMQ 2.7.1.

Here is my test, using an empty queue.
 - client1 connects, sends a message to the queue and disconnects
 - client2 connects, subscribes to the queue with ack:client
 - client2 receives the message (so far so good) but does not ack it
 - client3 connects, subscribes to the queue
 - client2 sends a NACK frame for the message
 - client2 receives the message once more
 - client3 receives nothing

I would have expected the other client (client3) to receive the
message that has not been consumed by client2. In fact, this is how
ActiveMQ and Apollo work.

FWIW, the STOMP 1.1 spec mentions:

 | NACK is the opposite of ACK. It is used to tell the server that the
 | client did not consume the message. The server can then either send
 | the message to a different client, discard it, or put it in a dead
 | letter queue. The exact behavior is server specific.

So, although the behavior is not strictly defined, re-sending the
message to the same client does not look appropriate to me.

What do you think?

Cheers,

Lionel
</PRE>

































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018335.html">[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</A></li>
	<LI>Next message: <A HREF="018428.html">[rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18334">[ date ]</a>
              <a href="thread.html#18334">[ thread ]</a>
              <a href="subject.html#18334">[ subject ]</a>
              <a href="author.html#18334">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
