<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] &#31572;&#22797;:   Can't process_flag(trap_exit, true) in process
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%0A%20%3D%3Futf-8%3Fb%3F562U5aSNOiAgIENhbid0IHByb2Nlc3NfZmxh%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fg%3D28trap%3D5Fexit%3D2C_true%3D29_in_process%3F%3D&In-Reply-To=%3C20120210103647.GC3845%40southbank.Home%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018059.html">
   <LINK REL="Next"  HREF="018073.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] &#31572;&#22797;:   Can't process_flag(trap_exit, true) in process</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%0A%20%3D%3Futf-8%3Fb%3F562U5aSNOiAgIENhbid0IHByb2Nlc3NfZmxh%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fg%3D28trap%3D5Fexit%3D2C_true%3D29_in_process%3F%3D&In-Reply-To=%3C20120210103647.GC3845%40southbank.Home%3E"
       TITLE="[rabbitmq-discuss] &#31572;&#22797;:   Can't process_flag(trap_exit, true) in process">alexandru at rabbitmq.com
       </A><BR>
    <I>Fri Feb 10 10:36:47 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018059.html">[rabbitmq-discuss]  &#31572;&#22797;:  Can't process_flag(trap_exit, true) in process
</A></li>
        <LI>Next message: <A HREF="018073.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE	frames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18064">[ date ]</a>
              <a href="thread.html#18064">[ thread ]</a>
              <a href="subject.html#18064">[ subject ]</a>
              <a href="author.html#18064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi David,

&gt;<i> the process 1 follow:
</I>...
&gt;<i> the process 2 follow:
</I>...

Ok.  That code looks fine.  So, when you run that, process 2 receives a
basic.cancel?  And if you remove the process_flag(...) in process 1, it
doesn't?  That sounds very strange and shouldn't happen.

When you say &quot;receives a basic.cancel&quot;, do you mean that process 2 exits
with an non-normal message?  Could you post the exact message if so?

Is there anything like an error in the RabbitMQ or SASL logs?

Also, what version of the server and client are you using?

Cheers,
Alex


On Fri, Feb 10, 2012 at 09:59:23AM +0000, Liuzhuofu wrote:
&gt;<i> Hi Alex:
</I>&gt;<i> 
</I>&gt;<i> the process 1 follow:
</I>&gt;<i> process_flag(trap_exit, true),
</I>&gt;<i> ....
</I>&gt;<i> ...
</I>&gt;<i> {ok, Tag, Pid} = tcloud_mq_amqp_func:tc_subdesc_queue(ReadChannel, Que, MFA),   %% subscribe the queue with process 2 start with MFA
</I>&gt;<i> %% and after this code, the process 1 do nothing but wait for call/cast   process 1 is a gen_server.
</I>&gt;<i> %% process 1 never do unbind/delete opertion to the queue or any other thing
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> the process 2 follow:
</I>&gt;<i> loop() -&gt;     %% loop/0 is the F of MFA that start the process 2
</I>&gt;<i> receive
</I>&gt;<i> Msg -&gt;
</I>&gt;<i> io:format(&quot;Msg:~p~n&quot;, [Msg]),
</I>&gt;<i> loop()
</I>&gt;<i> end
</I>&gt;<i> 
</I>&gt;<i> Regard
</I>&gt;<i> David
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ________________________________________
</I>&gt;<i> &#21457;&#20214;&#20154;: Alexandru Scvor&#355;ov [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scvalex at gmail.com</A>] &#20195;&#34920; Alexandru Scvor&#355;ov [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexandru at rabbitmq.com</A>]
</I>&gt;<i> &#21457;&#36865;&#26102;&#38388;: 2012&#24180;2&#26376;10&#26085; 17:38
</I>&gt;<i> &#21040;: Liuzhuofu
</I>&gt;<i> Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &#20027;&#39064;: Re: [rabbitmq-discuss] Can't process_flag(trap_exit, true) in process
</I>&gt;<i> 
</I>&gt;<i> Hi David,
</I>&gt;<i> 
</I>&gt;<i> &gt; I create a connection and channel in process 1, and subscribe a queue with process 2, which created by &quot;spawn_link&quot; in process 1, if I run &quot;process_flag(trap_exit, true)&quot; in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run &quot;process_flag(trap_exit, true)&quot; in process 1, the process 2 will never receive that.
</I>&gt;<i> 
</I>&gt;<i> I don't follow. Are you saying that running &quot;process_flag(trap_exit,
</I>&gt;<i> true)&quot; in process 1, the queue will get deleted immediately (and hence
</I>&gt;<i> process 2 will receive a basic.cancel)?
</I>&gt;<i> 
</I>&gt;<i> Could you post your code please?
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Alex
</I>&gt;<i> 
</I>&gt;<i> On Fri, Feb 10, 2012 at 08:22:10AM +0000, Liuzhuofu wrote:
</I>&gt;<i> &gt; Hi all:
</I>&gt;<i> &gt; I found a strange thing:
</I>&gt;<i> &gt; I create a connection and channel in process 1, and subscribe a queue with process 2, which created by &quot;spawn_link&quot; in process 1, if I run &quot;process_flag(trap_exit, true)&quot; in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run &quot;process_flag(trap_exit, true)&quot; in process 1, the process 2 will never receive that.
</I>&gt;<i> &gt; Why ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; David
</I>&gt;<i> 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I></PRE>






























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018059.html">[rabbitmq-discuss]  &#31572;&#22797;:  Can't process_flag(trap_exit, true) in process
</A></li>
	<LI>Next message: <A HREF="018073.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE	frames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18064">[ date ]</a>
              <a href="thread.html#18064">[ thread ]</a>
              <a href="subject.html#18064">[ subject ]</a>
              <a href="author.html#18064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
