<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Message presence notification
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Message%20presence%20notification&In-Reply-To=%3C4F46217B.7030504%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018374.html">
   <LINK REL="Next"  HREF="018368.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Message presence notification</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Message%20presence%20notification&In-Reply-To=%3C4F46217B.7030504%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Message presence notification">simon at rabbitmq.com
       </A><BR>
    <I>Thu Feb 23 11:22:35 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018374.html">[rabbitmq-discuss] Message presence notification
</A></li>
        <LI>Next message: <A HREF="018368.html">[rabbitmq-discuss] Message presence notification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18360">[ date ]</a>
              <a href="thread.html#18360">[ thread ]</a>
              <a href="subject.html#18360">[ subject ]</a>
              <a href="author.html#18360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hmm, interesting situation.

basic.qos(0) means &quot;no limit&quot; and RabbitMQ will push all the messages at 
you. Unlikely to be what you want.

I don't think there's a completely beautiful answer to your question. 
You could:

a) Have the slow link poll with (passive?) queue.declare()s. The 
declare-ok you get back will tell you the number of messages in the 
queue at the time the declare was received.

b) Do the same, but using HTTP to the management plugin. You have to use 
another protocol, which is a pain, but you can poll a ton of queues with 
one request, so that may be useful.

c) Have the slow link consume with qos(1) and acks. Every time it gets a 
message, it cancels its consumer and rejects the message (with 
requeue=true). Then the fast link fires up, does its consuming, shuts 
down again, then the slow link starts its consumer again. The bad news 
is that the first message always gets its requeued flag set. The good 
news is, no polling.

Cheers, Simon

On 23/02/12 09:51, Cermak, Marek wrote:
&gt;<i> Hello everybody,
</I>&gt;<i>
</I>&gt;<i> in our scenario we use two different connections to rabbitmq server &#8211;
</I>&gt;<i> one is using a slow and permanently open link the second is very fast
</I>&gt;<i> but opens only on demand and should be closed once it is not in use.
</I>&gt;<i>
</I>&gt;<i> These two connection we want to use for consuming messages from many
</I>&gt;<i> (tens, hundreds) queues in the following way
</I>&gt;<i>
</I>&gt;<i> 1.open the connection on a slow link and &quot;watch&quot; the queues;
</I>&gt;<i>
</I>&gt;<i> 2.once there is a message in one of the watched queues, the client
</I>&gt;<i> receives a notification (no message) from rabbit;
</I>&gt;<i>
</I>&gt;<i> 3.client opens the fast link, consumes available messages from queues
</I>&gt;<i> and closes the link;
</I>&gt;<i>
</I>&gt;<i> 4.back to #2.
</I>&gt;<i>
</I>&gt;<i> How can we achieve this with AMQP (0.9.1 or 1.0) ? Can we do it with no
</I>&gt;<i> RabbitMQ protocol extension?
</I>&gt;<i>
</I>&gt;<i> I was thinking about channel.basicQoS(0) but what would I get in that case?
</I>&gt;<i>
</I>&gt;<i> Thank you for your help.
</I>&gt;<i>
</I>&gt;<i> Marek
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>












































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018374.html">[rabbitmq-discuss] Message presence notification
</A></li>
	<LI>Next message: <A HREF="018368.html">[rabbitmq-discuss] Message presence notification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18360">[ date ]</a>
              <a href="thread.html#18360">[ thread ]</a>
              <a href="subject.html#18360">[ subject ]</a>
              <a href="author.html#18360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
