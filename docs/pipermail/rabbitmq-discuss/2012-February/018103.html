<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active/Active%3A%20shutdown%20of%20one%20service%0A%20brings%20down%20the%20cluster&In-Reply-To=%3CCAFWGgNHcqkpE72WTVw8yxsQssgvs%2BETNcNx-dby2NbkuqKv8Kg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018039.html">
   <LINK REL="Next"  HREF="018119.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster</H1>
    <B>Vadim Chekan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active/Active%3A%20shutdown%20of%20one%20service%0A%20brings%20down%20the%20cluster&In-Reply-To=%3CCAFWGgNHcqkpE72WTVw8yxsQssgvs%2BETNcNx-dby2NbkuqKv8Kg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster">kot.begemot at gmail.com
       </A><BR>
    <I>Fri Feb 10 00:20:53 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018039.html">[rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster
</A></li>
        <LI>Next message: <A HREF="018119.html">[rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18103">[ date ]</a>
              <a href="thread.html#18103">[ thread ]</a>
              <a href="subject.html#18103">[ subject ]</a>
              <a href="author.html#18103">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon,

I think we nailed down a problem. We had a channel leak in our application.
With ~50 connections we had &gt;90 channels per connection and growing. This
definitely correlates to high CPU usage.

What I still do not understand either it triggered rabbit into unstable
state or it was something else. Maybe increasing latencies in message
handling triggered cluster members into flipping neighbor aliveness status
back and force? Just speculating here: could timeouts because of high load
cause network fragmentation, when every node temporally does not see
neighbors, becomes a master, than see a neighbor, freak out, etc?

I've attached logs from all 3 cluster members. They are polluted with load
balancer &quot;ping&quot;.

Vadim.

On Thu, Feb 9, 2012 at 4:21 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hi. Thanks for the error report. There seem to be a lot of strange things
</I>&gt;<i> happening here - can you provide more complete logs from such an incident?
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 09/02/12 02:42, Vadim Chekan wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Given: 3 servers in active/active configuration, rabbit: 2.7.1, erlang
</I>&gt;&gt;<i> R14B03, CentOS, 64bits.
</I>&gt;&gt;<i> We experienced at least 2 occasions of the following situation: we
</I>&gt;&gt;<i> observe abnormal high CPU utilization on one of rabbit servers (40% when
</I>&gt;&gt;<i> &lt;10% is a norm) without any obvious reason. We did nice restart rabbit
</I>&gt;&gt;<i> service and the whole cluster went down (restarted).
</I>&gt;&gt;<i> Another effect is that cluster seems to enters some (inconsistent?)
</I>&gt;&gt;<i> state and queues can not be registered/deleted, list of queues can not
</I>&gt;&gt;<i> be viewed through management UI, etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is a log which contains errors when cluster in broken state:
</I>&gt;&gt;<i> <A HREF="http://pastebin.com/6rweU3MD">http://pastebin.com/6rweU3MD</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Questions:
</I>&gt;&gt;<i>   Are those errors critical?
</I>&gt;&gt;<i>   If we experience a high CPU situation again, what can we do, any
</I>&gt;&gt;<i> additional logging, profiling, process snapshots, etc?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Vadim.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i>  From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT
</I>&gt;&gt;<i> is explicitly specified
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ______________________________**_________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>
</I>


-- 
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018039.html">[rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster
</A></li>
	<LI>Next message: <A HREF="018119.html">[rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18103">[ date ]</a>
              <a href="thread.html#18103">[ thread ]</a>
              <a href="subject.html#18103">[ subject ]</a>
              <a href="author.html#18103">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
