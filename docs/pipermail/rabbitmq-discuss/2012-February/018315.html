<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumers and exceptions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumers%20and%20exceptions&In-Reply-To=%3C11213BC2-92C4-4F3A-87F3-7DAF727F47B2%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018253.html">
   <LINK REL="Next"  HREF="018429.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumers and exceptions</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumers%20and%20exceptions&In-Reply-To=%3C11213BC2-92C4-4F3A-87F3-7DAF727F47B2%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Consumers and exceptions">steve at rabbitmq.com
       </A><BR>
    <I>Tue Feb 21 17:41:07 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018253.html">[rabbitmq-discuss] Consumers and exceptions
</A></li>
        <LI>Next message: <A HREF="018429.html">[rabbitmq-discuss] Consumers and exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18315">[ date ]</a>
              <a href="thread.html#18315">[ thread ]</a>
              <a href="subject.html#18315">[ subject ]</a>
              <a href="author.html#18315">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jon,

I can't see Consumer Exceptions discussed in that thread, but in any case: if a
Consumer callback throws an Exception, it is caught (on the Consumer callback
thread) and passed to the connection's ExceptionHandler
handleConsumerException() method.

This setting is not exposed on the newConnection() call but is accessible on
one of the low-level, public AMQConnection() constructors. It is a final
attribute.

By default this is set to the DefaultExceptionHandler, which implements methods:

  handleUnexpectedConnectionDriverException -- and is a no-op
and
  handleReturnListenerException
  handleFlowListenerException
  handleConfirmListenerException
  handleConsumerException
each of which kills the connection.

The basic idea is that Consumer callbacks and Listeners should NOT throw
exceptions except in the direst of circumstances.

The connection.close() ought to drive the ShutdownListeners for the connection
and for any open channels on that connection, but there was a bug in this area
(which is fixed and will be in the next release).

It is entirely possible that Consumers will continue to be called (there may be
consumer callbacks queued up), and the last call should be handleCancel().

But the connection and all its channels will need to be recreated to continue.

Does this help?

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 19 Feb 2012, at 18:01, Jon Hill wrote:

&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I've just been reading this post:
</I>&gt;<i> <A HREF="http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/77bc5f0329fa61c4/bf0c15a0502555ae?lnk=gst&amp;q=defaultconsumer#bf0c15a0502555ae">http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/77bc5f0329fa61c4/bf0c15a0502555ae?lnk=gst&amp;q=defaultconsumer#bf0c15a0502555ae</A>
</I>&gt;<i> 
</I>&gt;<i> It tells me that if an Exception is thrown from a Consumer the
</I>&gt;<i> expected behaviour is to close the connection (my shutdown listener
</I>&gt;<i> doesn't kick in when this occurs either).
</I>&gt;<i> 
</I>&gt;<i> So, should I return immediately once the consumption has finished and
</I>&gt;<i> handle the application layer processing of the messages in a separate
</I>&gt;<i> thread?
</I>&gt;<i> 
</I>&gt;<i> Best,
</I>&gt;<i> 
</I>&gt;<i> Jon
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018253.html">[rabbitmq-discuss] Consumers and exceptions
</A></li>
	<LI>Next message: <A HREF="018429.html">[rabbitmq-discuss] Consumers and exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18315">[ date ]</a>
              <a href="thread.html#18315">[ thread ]</a>
              <a href="subject.html#18315">[ subject ]</a>
              <a href="author.html#18315">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
