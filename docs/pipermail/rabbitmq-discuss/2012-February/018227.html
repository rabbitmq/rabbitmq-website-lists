<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Passive queue declaration and channel closure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Passive%20queue%20declaration%20and%20channel%20closure&In-Reply-To=%3C4F3E48A8.8010902%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018207.html">
   <LINK REL="Next"  HREF="018231.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Passive queue declaration and channel closure</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Passive%20queue%20declaration%20and%20channel%20closure&In-Reply-To=%3C4F3E48A8.8010902%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Passive queue declaration and channel closure">simon at rabbitmq.com
       </A><BR>
    <I>Fri Feb 17 12:31:36 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018207.html">[rabbitmq-discuss] Passive queue declaration and channel closure
</A></li>
        <LI>Next message: <A HREF="018231.html">[rabbitmq-discuss] Passive queue declaration and channel closure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18227">[ date ]</a>
              <a href="thread.html#18227">[ thread ]</a>
              <a href="subject.html#18227">[ subject ]</a>
              <a href="author.html#18227">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/02/12 17:10, Busoli, Simone wrote:
&gt;<i> Hi, I&#8217;m revamping this
</I>&gt;<i> &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011314.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011314.html</A>&gt;
</I>&gt;<i> old thread because I&#8217;m trying to solve pretty much the same problem. I
</I>&gt;<i> need to know whether a queue that I have declared still exists on the
</I>&gt;<i> server or has for any reason been deleted.
</I>&gt;<i>
</I>&gt;<i> Without relying on the management plugin I think the only way to do that
</I>&gt;<i> is to declare the queue as passive.
</I>
Yes.

&gt;<i> At least with the .NET client and
</I>&gt;<i> apparently the Java client too, when the queue does not exist, besides
</I>&gt;<i> throwing an exception, the channel is closed as well.
</I>
It's the server closing the channel really. The channel closure causes 
the exception to be thrown, not the other way around.

&gt;<i> From the spec:
</I>&gt;<i> If set, the server will reply with Declare-Ok if the queue already
</I>&gt;<i> exists with the same name, and raise an error if not. The client can use
</I>&gt;<i> this to check whether a queue exists without modifying the server state.
</I>&gt;<i>
</I>&gt;<i> There is no mention of channel closure, while the last sentence implies
</I>&gt;<i> that using the passive bit is indeed a way for a client to check queue
</I>&gt;<i> existence, so closing the channel when it doesn&#8217;t is a bit unexpected.
</I>
The key phrase is &quot;raise an error&quot;. This is defined to always close the 
channel (and sometimes the connection too depending on the error code) 
in AMQP.

&gt;<i> That said, it&#8217;s not a big deal to recreate the channel in such cases,
</I>&gt;<i> but I&#8217;d appreciate your opinion. Any chance this behavior can be changed
</I>&gt;<i> in the client libraries?
</I>
It's probably slightly easier to open a new channel just to issue the 
queue.declare then close it anyway. That's what I'd do.

It's not really the client's purview, and currently the only way for the 
server to indicate an error is to close *something* anyway, so this 
isn't a trivial change...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018207.html">[rabbitmq-discuss] Passive queue declaration and channel closure
</A></li>
	<LI>Next message: <A HREF="018231.html">[rabbitmq-discuss] Passive queue declaration and channel closure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18227">[ date ]</a>
              <a href="thread.html#18227">[ thread ]</a>
              <a href="subject.html#18227">[ subject ]</a>
              <a href="author.html#18227">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
