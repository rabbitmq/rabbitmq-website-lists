<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Huge memory Consumption in RabbitMQ client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Huge%20memory%20Consumption%20in%20RabbitMQ%20client&In-Reply-To=%3CCABGiY4CaoPt4aqrdiGm_nu7TxjeLfHA0evvr3vx50U%3D4MYCiTw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018229.html">
   <LINK REL="Next"  HREF="018195.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Huge memory Consumption in RabbitMQ client</H1>
    <B>Ashish Jain</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Huge%20memory%20Consumption%20in%20RabbitMQ%20client&In-Reply-To=%3CCABGiY4CaoPt4aqrdiGm_nu7TxjeLfHA0evvr3vx50U%3D4MYCiTw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Huge memory Consumption in RabbitMQ client">ashjain2 at gmail.com
       </A><BR>
    <I>Wed Feb 15 14:51:26 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018229.html">[rabbitmq-discuss] How to configure
</A></li>
        <LI>Next message: <A HREF="018195.html">[rabbitmq-discuss] Huge memory Consumption in RabbitMQ client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18156">[ date ]</a>
              <a href="thread.html#18156">[ thread ]</a>
              <a href="subject.html#18156">[ subject ]</a>
              <a href="author.html#18156">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear All,

I am a newbie in rabbitmq and this is my first post in the rabbitmq
community.

I am seeing a weird issue which definitely does not make sense to me. Here
is the problem statement

We are running a rabbitmq server on IP1 and a simple client application on
IP2. We are observing an abrupt memory consumption on the *client *end
which goes on till all the messages are pumped in rabbitmq and after
that memory usage remains constant. This particular situation has already
led us to few OOM.

Each message pumped into RMQ is around 100 KB and there are 35000 of those.
We see heap usage going up at the client end up till all the 35k messages
are pumped at the server end. How can this be possible as I
am reading one message at a time? How can a load on server impact the
client. I did some test around this to confirm my observation.

Test1: I pumped 2000 messages Heap usage was limited to less than 1 GB at
the client side.
Test2: Over these 2000 messages I again started pumping few more thousand
messages. Side by side client is also consuming the messages the memory
usage keeps increasing at the client side till I pump messages. Once I stop
heap usage remains constant.. Once again if I pump I see heap going up
again and once I stop it remains constant at the current level.

Another observation here is that heap memory never comes down. Is JVM not
able to GC these objects? What could be the possibility?

Few points to note here I am using reusable channels, Queue Consumer. I
have used RabbitMQ client 2.5.1 as well as RMQ client 2.2 however there is
no change in behavior.

Any help or pointers on these issues would be really helpful.

Thanks
Ashish
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/6cad375e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/6cad375e/attachment.htm</A>&gt;
</PRE>
























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018229.html">[rabbitmq-discuss] How to configure
</A></li>
	<LI>Next message: <A HREF="018195.html">[rabbitmq-discuss] Huge memory Consumption in RabbitMQ client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18156">[ date ]</a>
              <a href="thread.html#18156">[ thread ]</a>
              <a href="subject.html#18156">[ subject ]</a>
              <a href="author.html#18156">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
