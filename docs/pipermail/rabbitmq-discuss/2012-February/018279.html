<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP doesn't include the routing-key on	MESSAGE frames
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20doesn%27t%20include%20the%20routing-key%20on%0A%09MESSAGE%20frames&In-Reply-To=%3CE2D4D1E4-13BF-4D66-8F40-A9766BCEE0A5%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018136.html">
   <LINK REL="Next"  HREF="018285.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP doesn't include the routing-key on	MESSAGE frames</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20doesn%27t%20include%20the%20routing-key%20on%0A%09MESSAGE%20frames&In-Reply-To=%3CE2D4D1E4-13BF-4D66-8F40-A9766BCEE0A5%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] STOMP doesn't include the routing-key on	MESSAGE frames">steve at rabbitmq.com
       </A><BR>
    <I>Mon Feb 20 17:04:33 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018136.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on	MESSAGE frames
</A></li>
        <LI>Next message: <A HREF="018285.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE frames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18279">[ date ]</a>
              <a href="thread.html#18279">[ thread ]</a>
              <a href="subject.html#18279">[ subject ]</a>
              <a href="author.html#18279">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tony,

Sorry I was so long in replying.

When you say 'no longer propagated', you imply that we used to do this. I guess
that was in the original implementation? :-) I don't think leaving this out was
an 'oversight' exactly, but more a desire to hide the implementation from the
pure STOMP user.

There is really no limit to the amount of information we could include in the
MESSAGE headers gleaned from the underlying implementation. We could easily
provide the AMQP exchange-name, consumer-tag and delivery-tag.

Of course, the more we include the more we reveal about the particular mapping
we have decided to use between the STOMP and AMQP protocols. This would inhibit
changes to that mapping, for future enhancements. For example, the routingKey you
extract in your patch might be a queue name generated by the server, a recast of
the destination information, or empty. The meaning and content of the header
value might change as we change our mapping.

So, I'm reluctant to include this information unless there is a compelling STOMP
reason for doing so. Is your application a pure STOMP one?
 
Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 14 Feb 2012, at 17:13, Tony Garnock-Jones wrote:

No comments on this?

On 10 February 2012 10:56, Tony Garnock-Jones
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonygarnockjones+rabbitmq at gmail.com</A>&gt; wrote:
Hi all,

Attempting to use the STOMP adapter the other day I discovered an
oversight in the new design: the AMQP routing key is no longer
propagated into outgoing MESSAGE frames. This stopped my application
from working.

Here's a patch (obviously crude, e.g. doesn't define a
?HEADER_ROUTING_KEY macro or anything) that causes the routing_key to
be sent along:

diff -r 3be0091c6401 src/rabbit_stomp_util.erl
--- a/src/rabbit_stomp_util.erl Wed Feb 08 15:53:59 2012 +0000
+++ b/src/rabbit_stomp_util.erl Fri Feb 10 10:53:21 2012 -0500
@@ -78,9 +78,11 @@

 message_headers(Destination, SessionId,
                #'basic.deliver'{consumer_tag = ConsumerTag,
-                                 delivery_tag = DeliveryTag},
+                                 delivery_tag = DeliveryTag,
+                                 routing_key = RoutingKey},
                Props = #'P_basic'{headers       = Headers}) -&gt;
    Basic = [{?HEADER_DESTINATION, Destination},
+             {&quot;amqp-routing-key&quot;, binary_to_list(RoutingKey)},
             {?HEADER_MESSAGE_ID,
              create_message_id(ConsumerTag, SessionId, DeliveryTag)}],


I'd be very happy to see this included into the master branch of the
STOMP adapter.

Regards,
 Tony
--
Tony Garnock-Jones
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonygarnockjones at gmail.com</A>
<A HREF="http://homepages.kcbbs.gen.nz/tonyg/">http://homepages.kcbbs.gen.nz/tonyg/</A>



-- 
Tony Garnock-Jones
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonygarnockjones at gmail.com</A>
<A HREF="http://homepages.kcbbs.gen.nz/tonyg/">http://homepages.kcbbs.gen.nz/tonyg/</A>
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018136.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on	MESSAGE frames
</A></li>
	<LI>Next message: <A HREF="018285.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE frames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18279">[ date ]</a>
              <a href="thread.html#18279">[ thread ]</a>
              <a href="subject.html#18279">[ subject ]</a>
              <a href="author.html#18279">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
