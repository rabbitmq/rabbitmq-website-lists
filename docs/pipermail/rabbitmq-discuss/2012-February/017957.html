<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Looking for some clarification on mirrored queue	implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Looking%20for%20some%20clarification%20on%20mirrored%20queue%0A%09implementation&In-Reply-To=%3CCB5569AD.2BAC7%25mpietrek%40skytap.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018336.html">
   <LINK REL="Next"  HREF="017996.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Looking for some clarification on mirrored queue	implementation</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Looking%20for%20some%20clarification%20on%20mirrored%20queue%0A%09implementation&In-Reply-To=%3CCB5569AD.2BAC7%25mpietrek%40skytap.com%3E"
       TITLE="[rabbitmq-discuss] Looking for some clarification on mirrored queue	implementation">mpietrek at skytap.com
       </A><BR>
    <I>Mon Feb  6 19:27:41 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018336.html">[rabbitmq-discuss] rabbitmqadmin and ability to read configuration files
</A></li>
        <LI>Next message: <A HREF="017996.html">[rabbitmq-discuss] Looking for some clarification on mirrored queue implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17957">[ date ]</a>
              <a href="thread.html#17957">[ thread ]</a>
              <a href="subject.html#17957">[ subject ]</a>
              <a href="author.html#17957">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here at work, we've been having a spirited debate about the RabbitMQ
descriptions on how HA/mirrored durable queues work. I apologize in advance
if this seems like I'm splitting hairs below, but our team have some very
specific questions regarding the exact wording. While nobody doubts the  end
result of mirroring, the mechanics of *exactly* how this happen are the
subject of debate here. As the designated point person for RabbitMQ in our
company, I'm responsible for driving these questions to closure.

First, I'll mention that we've read and re-read &quot;Highly Available Queues&quot;
and &quot;High Availability in RabbitMQ: solving part of the puzzle&quot; multiple
times.

<A HREF="http://www.rabbitmq.com/ha.html">http://www.rabbitmq.com/ha.html</A>
<A HREF="http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solvin">http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solvin</A>
g-part-of-the-puzzle/

The crux of the questions come down to these quotes:

--
&quot;The slaves apply the operations that occur to the master in exactly the
same order as the master and thus maintain the same state. All actions other
than publishes go only to the master, and the master then broadcasts the
effect of the actions to the slaves. Thus clients consuming from a mirrored
queue are in fact consuming from the master.&quot;

and

&quot;messages published to a mirrored-queue are always published directly to the
master and all slaves.&quot;
--

One interpretation of the 2nd quote above (&quot;published directly to...&quot;) is
that clients are responsible for writing their messages to the master *as
well as* to all slaves. Perhaps there's some mechanism where at connect
time, the master sends a list of servers to the connecting client, and the
client writes to all instances in the list.

Other people have a different interpretation of how this works, which is
that publishes to *any* broker instances are forwarded by the receiving
slave to the master instance, which in turn pushes the publish requests to
all slaves. (Of course, if the master received the message initially,
there's no need for forwarding.)

Simple question: Which of the above interpretations is correct?

Follow up question: What is the exact flow for a publish that goes to a
slave? Does the slave do anything other than push the message to the master,
which in turn handles the message as if it came to the master in the first
place? Perhaps it writes the message to the local store first, then pushes
it to the master? (Like I said, spirited debate.)

Thanks much for your help,

Matt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/3e6e9dd3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/3e6e9dd3/attachment.htm</A>&gt;
</PRE>






















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018336.html">[rabbitmq-discuss] rabbitmqadmin and ability to read configuration files
</A></li>
	<LI>Next message: <A HREF="017996.html">[rabbitmq-discuss] Looking for some clarification on mirrored queue implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17957">[ date ]</a>
              <a href="thread.html#17957">[ thread ]</a>
              <a href="subject.html#17957">[ subject ]</a>
              <a href="author.html#17957">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
