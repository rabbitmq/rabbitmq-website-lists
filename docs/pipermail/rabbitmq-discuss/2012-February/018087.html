<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Naive Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Naive%20Question&In-Reply-To=%3CEA40E90E-3FB2-4C28-B812-6BFEA3417550%40syncsort.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018085.html">
   <LINK REL="Next"  HREF="018094.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Naive Question</H1>
    <B>Bell, Paul M.</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Naive%20Question&In-Reply-To=%3CEA40E90E-3FB2-4C28-B812-6BFEA3417550%40syncsort.com%3E"
       TITLE="[rabbitmq-discuss] Naive Question">pbell at syncsort.com
       </A><BR>
    <I>Sat Feb 11 02:48:35 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018085.html">[rabbitmq-discuss] Naive Question
</A></li>
        <LI>Next message: <A HREF="018094.html">[rabbitmq-discuss] Naive Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18087">[ date ]</a>
              <a href="thread.html#18087">[ thread ]</a>
              <a href="subject.html#18087">[ subject ]</a>
              <a href="author.html#18087">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Most kind of you, Jerry. I will check it out tomorrow on home desktop (writing now from phone).

Thanks.

-Paul

On Feb 10, 2012, at 9:28 PM, &quot;Jerry Kuch&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jerryk at vmware.com</A>&gt; wrote:

&gt;<i> Hi, Paul.
</I>&gt;<i> 
</I>&gt;<i> From what I understand of your application this sounds like the right idea.
</I>&gt;<i> Also, a shortcut that may be suitable for you, if you don't want fancy topic routing,
</I>&gt;<i> might be to use the AMQP &quot;default exchange&quot; which will exist by default in any
</I>&gt;<i> vhost.
</I>&gt;<i> 
</I>&gt;<i> The default exchange's name is just the empty string, &quot;&quot;.  It's automatically
</I>&gt;<i> bound to any queue you create, with a binding key equal to the name of the queue.
</I>&gt;<i> 
</I>&gt;<i> If you activate the rabbitmq visualiser plugin and browse around you can get a
</I>&gt;<i> nice, interactive view of your queues and exchanges and the bindings between them.
</I>&gt;<i> 
</I>&gt;<i> On my own broker I just created queues called &quot;HB&quot; and &quot;MGMT&quot;, and no exchanges, 
</I>&gt;<i> and no bindings.  The attached screenshot shows those queues as the labeled
</I>&gt;<i> rectangles, the bindings as the arrows (if you mouse over one, the routing 
</I>&gt;<i> key will be displayed), and the default exchange as the unlabeled circle at
</I>&gt;<i> the base of the binding arrows (recall it's name is &quot;&quot;; had it a non-empty name,
</I>&gt;<i> you'd see that).
</I>&gt;<i> 
</I>&gt;<i> To publish to the queues I would just publish to an exchange called &quot;&quot;, with 
</I>&gt;<i> routing key set to either &quot;MGMT&quot; or &quot;HB&quot;.
</I>&gt;<i> 
</I>&gt;<i> For a scenario like yours this might make a nice short cut.
</I>&gt;<i> 
</I>&gt;<i> Best regards,
</I>&gt;<i> Jerry
</I>&gt;<i> 
</I>&gt;<i> ----- Original Message -----
</I>&gt;<i> From: &quot;Paul M. Bell&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pbell at syncsort.com</A>&gt;
</I>&gt;<i> To: &quot;Jerry Kuch&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jerryk at vmware.com</A>&gt;
</I>&gt;<i> Cc: &quot;RabbitMQ List&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> Sent: Friday, February 10, 2012 5:53:44 PM
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Naive Question
</I>&gt;<i> 
</I>&gt;<i> Hi Jerry,
</I>&gt;<i> 
</I>&gt;<i> Yeah, I think that makes sense.
</I>&gt;<i> 
</I>&gt;<i> Could your two queue be characterized like this:
</I>&gt;<i> 
</I>&gt;<i> 1. Monitor creates the HB queue. With binding key &quot;HB,&quot; consumer binds this queue to the exchange. Monitor writes to exchange with routing-key &quot;HB.&quot;
</I>&gt;<i> 
</I>&gt;<i> 2. Producer creates the MGMT queue. With binding key &quot;MGMT,&quot; monitor binds this queue to exchange. Producer writes to exchange with routing-key &quot;MGMT.&quot;
</I>&gt;<i> 
</I>&gt;<i> As always, thank you.
</I>&gt;<i> 
</I>&gt;<i> -Paul
</I>&gt;<i> 
</I>&gt;<i> On Feb 10, 2012, at 8:15 PM, &quot;Jerry Kuch&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jerryk at vmware.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi, Paul:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Nope:  Redeclarations of a queue with the same name and properties, within a
</I>&gt;&gt;<i> vhost, are idempotent.  Redeclaring the thing before you start using it is
</I>&gt;&gt;<i> a fairly common idiom.  If the resource didn't exist, then it's created;
</I>&gt;&gt;<i> otherwise you've verified its existence.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Redeclaring a queue with a given name with different properties fails, so you
</I>&gt;&gt;<i> can't accidentally vandalize some existing piece of messaging fabric that
</I>&gt;&gt;<i> somebody else might be using.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On point b:  producers publish messages to *exchanges*, not to queues.
</I>&gt;&gt;<i> Which queues, if any, the messages end up in depends on how queues
</I>&gt;&gt;<i> are bound to the exchange in question, and the properties of the message.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> With regard to your specific scenario with MGMT and HB messages, are you
</I>&gt;&gt;<i> sure you want them in the same queue?  It's not really possible in any
</I>&gt;&gt;<i> graceful way for a consumer to selectively read some but not other messages
</I>&gt;&gt;<i> from a queue unless one does something obnoxious like basic.get-ing and then
</I>&gt;&gt;<i> rejecting the messages you weren't interested in so that they're requeued.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> From what I understand of the design you're sketching, you may want two
</I>&gt;&gt;<i> queues, one from which the monitor reads MGMT messages and one from which 
</I>&gt;&gt;<i> something else reads HB messages.  You could imagine binding both of those
</I>&gt;&gt;<i> queues to a topic exchange and have your producer use routing keys to land
</I>&gt;&gt;<i> your messages in the desired place.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Make sense?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Best regards,
</I>&gt;&gt;<i> Jerry
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ----- Original Message -----
</I>&gt;&gt;<i> From: &quot;Paul M. Bell&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pbell at syncsort.com</A>&gt;
</I>&gt;&gt;<i> To: &quot;RabbitMQ List&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> Sent: Friday, February 10, 2012 3:36:47 PM
</I>&gt;&gt;<i> Subject: [rabbitmq-discuss] Naive Question
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> All,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Hi again.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Only after trying to think through a real world scenario did I realize that my grasp of certain fundamental AMQP concepts is tenuous.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Specifically, given a producer and a consumer, is the normative behavior for only *one* of them to declare (create?) the queue over which they communicate? As I look over the examples that I've &quot;written&quot; (&quot;copied&quot; would be more accurate), I see my producer doing this:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
</I>&gt;&gt;<i> Exchange ex = new FanoutExchange(routingKey, true, false);
</I>&gt;&gt;<i> admin.declareExchange(ex);
</I>&gt;&gt;<i> admin.declareQueue(new Queue(this.queueName));
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> And I see my consumer doing this:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ConsumerSimpleMessageListenerContainer container = new ConsumerSimpleMessageListenerContainer();
</I>&gt;&gt;<i> container.setConnectionFactory(connectionFactory());
</I>&gt;&gt;<i> container.setQueueNames(this.queueName);
</I>&gt;&gt;<i> container.setConcurrentConsumers(this.onOfConsumer);
</I>&gt;&gt;<i> container.setMessageListener(new MessageListenerAdapter(new ConsumerHandler(), new SimpleMessageConverter()));
</I>&gt;&gt;<i> container.startConsumers();
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What would happen if each declared a queue of the same name and type - would that give rise to two distinct queues, leaving the producer and consumer unable to communicate?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If it's normative for only one party to create the queue and the other to bind to it, what will happen if, when I try to bind to the queue, it doesn't yet exist?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Here's what I am trying to get to (I assume it requires a topic exchange):
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> a. a queue that holds two different message types, call them &quot;MGMT&quot; and &quot;HB.&quot;
</I>&gt;&gt;<i> b. a producer writes MGMT messages to this queue
</I>&gt;&gt;<i> c. something called a &quot;monitor&quot; writes HB messages to this queue
</I>&gt;&gt;<i> d. consumer reads HB messages from this queue
</I>&gt;&gt;<i> e. monitor reads MGMT messages from this queue
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Schematically I think it looks like this:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Producer(MGMT) -&gt; monitor
</I>&gt;&gt;<i> Monitor(HB)    -&gt; consumer
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> How would I define these relationships via RabbitMQ? Who does what to whom?! I suspect it's simple, but after two solid weeks of 10 hour days, I am fried.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thank you for your help.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> -Paul
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> PS: What follows is not an attempt to curry favor - but this is a really fine list; folks are friendly, knowledgeable, and eager to help. I really appreciate it.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ATTENTION: -----
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &lt;Screen Shot 2012-02-10 at 6.16.55 PM.png&gt;
</I></PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018085.html">[rabbitmq-discuss] Naive Question
</A></li>
	<LI>Next message: <A HREF="018094.html">[rabbitmq-discuss] Naive Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18087">[ date ]</a>
              <a href="thread.html#18087">[ thread ]</a>
              <a href="subject.html#18087">[ subject ]</a>
              <a href="author.html#18087">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
