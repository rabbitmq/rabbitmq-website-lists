<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Strange message loss behavior with mirrored queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20message%20loss%20behavior%20with%20mirrored%0A%20queues&In-Reply-To=%3CCB554E16.2BA39%25mpietrek%40skytap.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017940.html">
   <LINK REL="Next"  HREF="017980.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Strange message loss behavior with mirrored queues</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20message%20loss%20behavior%20with%20mirrored%0A%20queues&In-Reply-To=%3CCB554E16.2BA39%25mpietrek%40skytap.com%3E"
       TITLE="[rabbitmq-discuss] Strange message loss behavior with mirrored queues">mpietrek at skytap.com
       </A><BR>
    <I>Mon Feb  6 17:43:34 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017940.html">[rabbitmq-discuss] Strange message loss behavior with mirrored queues
</A></li>
        <LI>Next message: <A HREF="017980.html">[rabbitmq-discuss] Strange message loss behavior with mirrored queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17954">[ date ]</a>
              <a href="thread.html#17954">[ thread ]</a>
              <a href="subject.html#17954">[ subject ]</a>
              <a href="author.html#17954">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Emile,

Thanks much for the reply. I certainly understand that in a mirrored
setup, message publishing will be slower. However, I still think there
some sort of issue here.

I could understand that I'd lose messages if I rapidly published 100,000
messages to the broker and then abruptly killed the broker. However,
that's not what happening. My app is writing the messages and then cleanly
existing without any errors, and nothing &quot;bad&quot; is happening to the broker.

While I would expect it might longer for the broker to catch up and
eventually process all 100,000 messages, it doesn't. Instead, it reports
that the queue has about 25,000 message (varies from run to run). I've
waited for 10 minutes and never seen any more messages appear in the queue.

Conversely, if I run the identical scenario without mirroring, all 100,000
message appear in the queue within seconds of my app exiting.

Also, I understand that with publisher-confirms I can wait till I see
100,000 messages written, but I wouldn't expect that *not* using them, and
simply exiting from my client process would cause messages to be lost. As
far as I can tell, all messages were sent on the wire to the broker, and
barring an error state in the broker, should eventually appear in the
queue.

I'll follow up offline with my exact code and config.

Thanks,

Matt

On 2/6/12 2:43 AM, &quot;Emile Joubert&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i>Hi Matt,
</I>&gt;<i>
</I>&gt;<i>On 03/02/12 18:57, Matt Pietrek wrote:
</I>&gt;&gt;<i> I'm writing some basic throughput tests to verify that RabbitMQ will
</I>&gt;&gt;<i> scale to our needs in HA environments. In one scenario I'm finding
</I>&gt;&gt;<i> substantial message loss.
</I>&gt;<i>
</I>&gt;<i>I wouldn't describe what you're seeing as message loss, rather a
</I>&gt;<i>demonstration that publishing in a HA environment with more nodes is
</I>&gt;<i>slower. Publishing is slower because it takes longer to send the
</I>&gt;<i>messages to a greater number of nodes in the cluster.
</I>&gt;<i>
</I>&gt;<i>You should make use of publisher confirms
</I>&gt;<i>(<A HREF="http://www.rabbitmq.com/extensions.html#publishing">http://www.rabbitmq.com/extensions.html#publishing</A>)
</I>&gt;<i>to make sure that published messages have been safely received by the
</I>&gt;<i>broker.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>-Emile
</I>

</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017940.html">[rabbitmq-discuss] Strange message loss behavior with mirrored queues
</A></li>
	<LI>Next message: <A HREF="017980.html">[rabbitmq-discuss] Strange message loss behavior with mirrored queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17954">[ date ]</a>
              <a href="thread.html#17954">[ thread ]</a>
              <a href="subject.html#17954">[ subject ]</a>
              <a href="author.html#17954">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
