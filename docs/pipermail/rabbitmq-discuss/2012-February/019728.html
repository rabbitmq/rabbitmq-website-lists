<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> No subject
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20No%20subject&In-Reply-To=%3Cmailman.11.1335307957.2884.rabbitmq-discuss%40lists.rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019521.html">
   <LINK REL="Next"  HREF="019774.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>No subject</H1>
    <B></B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20No%20subject&In-Reply-To=%3Cmailman.11.1335307957.2884.rabbitmq-discuss%40lists.rabbitmq.com%3E"
       TITLE="No subject">
       </A><BR>
    <I>Thu Feb 16 03:44:05 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019521.html">No subject
</A></li>
        <LI>Next message: <A HREF="019774.html">No subject
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19728">[ date ]</a>
              <a href="thread.html#19728">[ thread ]</a>
              <a href="subject.html#19728">[ subject ]</a>
              <a href="author.html#19728">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>explicitly specified

--14dae93a122f5c3c9f04be749b1f
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi all,&lt;br&gt;I&amp;#39;m investigating a case when in certain conditions .net cli=
ent can kill server for ~15minutes.&lt;br&gt;We have a specific firewall setup an=
d it can return an ascii string &amp;quot;uou do not have access to this servic=
e&amp;quot;. Details do not matter, but in such case .net client will just kill=
 the client box instantly. Even mouse wont move.&lt;br&gt;
&lt;br&gt;I&amp;#39;ve investigated it and found that the problem is in RabbitMQ.Clie=
nt.Impl.Frams.cs:ReadFrom():&lt;br&gt;=A0=A0=A0=A0=A0=A0=A0=A0=A0=A0=A0 int paylo=
adSize =3D reader.ReadInt32(); // FIXME - throw exn on unreasonable value&lt;b=
r&gt;In case if client attempts to connect to a socket which returns non-ampq =
message, it will attempt to allocate an array, of generally speaking random=
 size.&lt;br&gt;
Ampq-0.9.1 spec (paragraph 4.2.3=A0 General Frame Format) says:&lt;br&gt;&amp;gt; If =
a peer receives a frame with a type that is not one of these defined types,=
 it MUST treat this as a&lt;br&gt;fatal protocol error and close the connection w=
ithout sending any further data on it&lt;br&gt;
&lt;br&gt;But I can not understand the logic of the code in Frame.ReadFrom:&lt;br&gt;&lt;a=
 href=3D&quot;<A HREF="http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/0d3c7b59412e/pr=">http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/0d3c7b59412e/pr=</A>
ojects/client/RabbitMQ.Client/src/client/impl/Frame.cs#l107&quot;&gt;<A HREF="http://hg.rabb=">http://hg.rabb=</A>
itmq.com/rabbitmq-dotnet-client/file/0d3c7b59412e/projects/client/RabbitMQ.=
Client/src/client/impl/Frame.cs#l107&lt;/a&gt;&lt;br&gt;
&lt;pre&gt; if (type =3D=3D &amp;#39;A&amp;#39;)&lt;/pre&gt;The local variable name which recie=
ves the value is &amp;quot;type&amp;quot;, but it checks for &amp;quot;AMQP&amp;quot; which=
 should not be expected and it fail to check for type in 1-4 range which sh=
ould be expected according to the spec. And it will keep reading &amp;quot;size=
&amp;quot; and &amp;quot;byte[size]&amp;quot; even though they can be a garbage.&lt;br&gt;
Am I missing something?&lt;br&gt;&lt;br&gt;Vadim.&lt;br clear=3D&quot;all&quot;&gt;&lt;br&gt;-- &lt;br&gt;From RFC =
2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT is explicitly =
specified&lt;br&gt;

--14dae93a122f5c3c9f04be749b1f--
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019521.html">No subject
</A></li>
	<LI>Next message: <A HREF="019774.html">No subject
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19728">[ date ]</a>
              <a href="thread.html#19728">[ thread ]</a>
              <a href="subject.html#19728">[ subject ]</a>
              <a href="author.html#19728">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
