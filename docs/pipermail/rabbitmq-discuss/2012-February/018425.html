<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [help] [beginner] server stops sending messages; publish (in transaction) hangs on commit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Bhelp%5D%20%5Bbeginner%5D%20server%20stops%20sending%0A%20messages%3B%20publish%20%28in%20transaction%29%20hangs%20on%20commit&In-Reply-To=%3CCAKYODbip9zOg2%3D7xNukG6oMAGVqZHdU1ibza%3D5%2B98xvUTQtzow%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018404.html">
   <LINK REL="Next"  HREF="018436.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [help] [beginner] server stops sending messages; publish (in transaction) hangs on commit</H1>
    <B>Alistair Bayley</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Bhelp%5D%20%5Bbeginner%5D%20server%20stops%20sending%0A%20messages%3B%20publish%20%28in%20transaction%29%20hangs%20on%20commit&In-Reply-To=%3CCAKYODbip9zOg2%3D7xNukG6oMAGVqZHdU1ibza%3D5%2B98xvUTQtzow%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] [help] [beginner] server stops sending messages; publish (in transaction) hangs on commit">alistair at abayley.org
       </A><BR>
    <I>Mon Feb 27 03:37:24 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018404.html">[rabbitmq-discuss] [help] [beginner] server stops sending messages; publish (in transaction) hangs on commit
</A></li>
        <LI>Next message: <A HREF="018436.html">[rabbitmq-discuss] [help] [beginner] server stops sending messages; publish (in transaction) hangs on commit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18425">[ date ]</a>
              <a href="thread.html#18425">[ thread ]</a>
              <a href="subject.html#18425">[ subject ]</a>
              <a href="author.html#18425">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25 February 2012 00:38, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
&gt;&gt;<i>
</I>&gt;&gt;<i> OK. Can I have some guidance as to how much memory we should allocate?
</I>&gt;<i>
</I>&gt;<i> This is a real how-long-is-a-piece-of-string question I'm afraid. 512M would
</I>&gt;<i> already be a significant step towards the comfort zone though.
</I>
rabbitmqctl report shows a large number of channels (in the thousands)
and memory usage seems to correlate with the large number of channels.
I've left the server running and shut down each of the clients, and
the channels have vanished from the report output, so I suspect a
dodgy client here. We're using python kombu over ampqlib, so maybe
kombu is doing something undesirable. A quick glance at the source
shows that it has a channel pool, so maybe that's to blame. Anyway,
more investigation required...

Once the number of channels is down to less than 10, the memory usage
is around 32M, which seems fine to me. Maybe I don't need to allocate
more, if I can solve this channels problem.


&gt;&gt;<i> Is there an
</I>&gt;&gt;<i> option to get the server to return something that says that it is not
</I>&gt;&gt;<i> accepting messages?
</I>&gt;<i>
</I>&gt;<i> In ancient history we used to do this; there's a method in AMQP 0-9-1 called
</I>&gt;<i> channel.flow which the server should be able to use to tell a client to shut
</I>&gt;<i> up. In practice it was unreliable (client may not support it, or may take
</I>&gt;<i> too long to take notice of it).
</I>
I will do some more testing. Maybe the immediate flag on basic_publish
will do something useful. python amqplib is protocol version 0.8, so
whatever I do must fit in with that.

Alistair
</PRE>










































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018404.html">[rabbitmq-discuss] [help] [beginner] server stops sending messages; publish (in transaction) hangs on commit
</A></li>
	<LI>Next message: <A HREF="018436.html">[rabbitmq-discuss] [help] [beginner] server stops sending messages; publish (in transaction) hangs on commit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18425">[ date ]</a>
              <a href="thread.html#18425">[ thread ]</a>
              <a href="subject.html#18425">[ subject ]</a>
              <a href="author.html#18425">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
