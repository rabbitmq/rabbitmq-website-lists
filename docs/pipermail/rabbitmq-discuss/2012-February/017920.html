<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Using Pika Python client library with BlockingConnections and publisher-confirms - Does it work?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20Pika%20Python%20client%20library%20with%0A%20BlockingConnections%20and%20publisher-confirms%20-%20Does%20it%20work%3F&In-Reply-To=%3CCB51B270.2B979%25mpietrek%40skytap.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018146.html">
   <LINK REL="Next"  HREF="017927.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Using Pika Python client library with BlockingConnections and publisher-confirms - Does it work?</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20Pika%20Python%20client%20library%20with%0A%20BlockingConnections%20and%20publisher-confirms%20-%20Does%20it%20work%3F&In-Reply-To=%3CCB51B270.2B979%25mpietrek%40skytap.com%3E"
       TITLE="[rabbitmq-discuss] Using Pika Python client library with BlockingConnections and publisher-confirms - Does it work?">mpietrek at skytap.com
       </A><BR>
    <I>Fri Feb  3 23:49:04 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018146.html">[rabbitmq-discuss] High volume message consumption slows down consistently over time when using Pika and transactions
</A></li>
        <LI>Next message: <A HREF="017927.html">[rabbitmq-discuss] Using Pika Python client library with	BlockingConnections and publisher-confirms - Does it work?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17920">[ date ]</a>
              <a href="thread.html#17920">[ thread ]</a>
              <a href="subject.html#17920">[ subject ]</a>
              <a href="author.html#17920">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just trying to figure out if this should work so that I can stop beating my
head against the wall.  And apologies for posting here, but I couldn&#185;t find
a forum dedicated to Pika to post to.

Our app is such that the asynchronous processing model doesn't work for us.
We want to reliably pull one message at a time off the queue, process it,
acknowledge it, and be done with it.

Towards this end, we're using a very simple setup using BlockingConnection,
basic_publish, basic_get and basic_ack. We're also using tx_select and
tx_confirm to guarantee messages are safely in the broker. However, given
what I've been reading, it seems like the RabbitMQ folks are strongly trying
to get folks off of transactions and on to publisher-confirms.

While I have strong concerns about message loss because of client crashes,
I'm nonetheless trying to experiment with publisher-confirms to see if they
work at all in our scenario.

And this is where I hit the wall. I can't get publisher-confirm callbacks to
work. The callback is never called. Is this expected to work?

Given a working example (without publisher-confirms), I've modified it as
follows:

        self.channel = self.connection.channel()
        self.channel.confirm_delivery(publisher_confirm,)

...
    def write_message(self, queue_name, json_string):
        self.channel.basic_publish(exchange='',
            routing_key=queue_name,
            body=json_string,
            properties=pika.BasicProperties(delivery_mode=2))

    def publisher_confirm(frame):
        print &quot;Got the message!&quot;

My publisher_confirm() method is never called. And by putting breakpoints at
strategic points inside the Pika client library, I don't ever see any data
coming back from the server that would result in callbacks, despite my
writing 1000s messages/sec.

Thanks for any insight folks have,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/aa32de7d/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/aa32de7d/attachment.htm</A>&gt;
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018146.html">[rabbitmq-discuss] High volume message consumption slows down consistently over time when using Pika and transactions
</A></li>
	<LI>Next message: <A HREF="017927.html">[rabbitmq-discuss] Using Pika Python client library with	BlockingConnections and publisher-confirms - Does it work?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17920">[ date ]</a>
              <a href="thread.html#17920">[ thread ]</a>
              <a href="subject.html#17920">[ subject ]</a>
              <a href="author.html#17920">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
