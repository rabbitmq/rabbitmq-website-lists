<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Initiating%20queue%20monitoring%2C%0A%20but%20returning%20to%20main%20method%20with%20indication%20of%20success&In-Reply-To=%3C4F44D498.7060404%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018325.html">
   <LINK REL="Next"  HREF="018328.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Initiating%20queue%20monitoring%2C%0A%20but%20returning%20to%20main%20method%20with%20indication%20of%20success&In-Reply-To=%3C4F44D498.7060404%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success">simon at rabbitmq.com
       </A><BR>
    <I>Wed Feb 22 11:42:16 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018325.html">[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</A></li>
        <LI>Next message: <A HREF="018328.html">[rabbitmq-discuss] [PATCH] rabbitmqadmin support for mirrored	queues and alternate exchanges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18330">[ date ]</a>
              <a href="thread.html#18330">[ thread ]</a>
              <a href="subject.html#18330">[ subject ]</a>
              <a href="author.html#18330">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi James. You could either fire up a new thread, or (probably simpler) 
use a DefaultConsumer and override its handleDelivery() method rather 
than use QueueingConsumer.

Cheers, Simon

On 21/02/12 20:33, McMahon, James S (TASC) wrote:
&gt;<i> The rabbitMQ examples all show a use case where the receiver enters into
</I>&gt;<i> a while( true ) loop that is only terminated when the coder hits Ctrl-C
</I>&gt;<i> at the command line.
</I>&gt;<i>
</I>&gt;<i> In my case, I call a method in a Listener class from a main java method
</I>&gt;<i> in my primary class, Driver. As a result, control passes to
</I>&gt;<i> callListener() in Listener.java and loops there endlessly waiting for
</I>&gt;<i> messages it gets from the direct exchange. In my main() method of
</I>&gt;<i> Driver.java, it makes a call right now like this:
</I>&gt;<i>
</I>&gt;<i> callListener();
</I>&gt;<i>
</I>&gt;<i> and inside my callListener method I implement similar to that that which
</I>&gt;<i> was shown in the tutorials:
</I>&gt;<i>
</I>&gt;<i> ConnectionFactory factory = new ConnectionFactory();
</I>&gt;<i> factory.setHost(&quot;localhost&quot;);
</I>&gt;<i> Connection connection = factory.newConnection();
</I>&gt;<i> Channel channel = connection.createChannel();
</I>&gt;<i>
</I>&gt;<i> channel.exchangeDeclare(EXCHANGE_NAME, &quot;topic&quot;);
</I>&gt;<i> String queueName = channel.queueDeclare().getQueue();
</I>&gt;<i>
</I>&gt;<i> for(String bindingKey : argv){
</I>&gt;<i> channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> System.out.println(&quot; [*] Waiting for messages. To exit press CTRL+C&quot;);
</I>&gt;<i>
</I>&gt;<i> QueueingConsumer consumer = new QueueingConsumer(channel);
</I>&gt;<i> channel.basicConsume(queueName, true, consumer);
</I>&gt;<i>
</I>&gt;<i> while (true) {
</I>&gt;<i> QueueingConsumer.Delivery delivery = consumer.nextDelivery();
</I>&gt;<i> String message = new String(delivery.getBody());
</I>&gt;<i> String routingKey = delivery.getEnvelope().getRoutingKey();
</I>&gt;<i>
</I>&gt;<i> // ...my other method calls to process the messages
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> I lose program control at that point, because this does not return me to
</I>&gt;<i> my main() in Driver, where I need to accomplish other actions while this
</I>&gt;<i> listener is monitoring the queue. What I need is for that call to
</I>&gt;<i> initiate the while loop and listen to the queue, and if it does so
</I>&gt;<i> successfully return me to my calling program with some indication of
</I>&gt;<i> success even as the while loop sits there listening to the queue for
</I>&gt;<i> messages.
</I>&gt;<i>
</I>&gt;<i> How can I implement this?
</I>&gt;<i>
</I>&gt;<i> Thanks very much.
</I>&gt;<i>
</I>&gt;<i> CONFIDENTIALITY NOTICE: This message and any attachments or files
</I>&gt;<i> transmitted with it (collectively, the &quot;Message&quot;) are intended only for
</I>&gt;<i> the addressee and may contain information that is privileged,
</I>&gt;<i> proprietary and/or prohibited from disclosure by law or contract. If you
</I>&gt;<i> are not the intended recipient: (a) please do not read, copy or
</I>&gt;<i> retransmit the Message; (b) permanently delete and/or destroy all
</I>&gt;<i> electronic and hard copies of the Message; (c) notify us by return
</I>&gt;<i> email; and (d) you are hereby notified that any dissemination,
</I>&gt;<i> distribution or copying of the Message is strictly prohibited.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018325.html">[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</A></li>
	<LI>Next message: <A HREF="018328.html">[rabbitmq-discuss] [PATCH] rabbitmqadmin support for mirrored	queues and alternate exchanges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18330">[ date ]</a>
              <a href="thread.html#18330">[ thread ]</a>
              <a href="subject.html#18330">[ subject ]</a>
              <a href="author.html#18330">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
