<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20Plugin%3A%20Alternative%20exchange%20other%0A%09than%20amq.topic%3F&In-Reply-To=%3CFD6F02F2-5F48-46AB-B61B-E46EAA48F11F%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018458.html">
   <LINK REL="Next"  HREF="018459.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20Plugin%3A%20Alternative%20exchange%20other%0A%09than%20amq.topic%3F&In-Reply-To=%3CFD6F02F2-5F48-46AB-B61B-E46EAA48F11F%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?">steve at rabbitmq.com
       </A><BR>
    <I>Tue Feb 28 10:02:49 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018458.html">[rabbitmq-discuss] Moving a queue from one node to another
</A></li>
        <LI>Next message: <A HREF="018459.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue 28
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18456">[ date ]</a>
              <a href="thread.html#18456">[ thread ]</a>
              <a href="subject.html#18456">[ subject ]</a>
              <a href="author.html#18456">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Cliff,

On the STOMP page, it says that subscribing to an explicit exchange does what
you want. Is there something I've missed?

&gt;<i> Having to create a queue and bind it to an alternatively named
</I>&gt;<i> federated topic exchange using an AMQ client before each Stomp
</I>&gt;<i> subscription significantly reduces the utility of the Stomp plugin (in
</I>&gt;<i> this federated case).
</I>
--8&lt;---cut-here------------------------
For SUBSCRIBE frames, a destination of the form /exchange/&lt;name&gt;[/&lt;pattern&gt;] can be used. This destination:

	&#8226; creates an exclusive, auto-delete queue on &lt;name&gt; exchange;
	&#8226; if &lt;pattern&gt; is supplied, binds the queue to &lt;name&gt; exchange using &lt;pattern&gt;; and
	&#8226; registers a subscription against the queue, for the current STOMP session.
---------------------------------------

Steve Powell  (a hippy bunny, man)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 22 Feb 2012, at 12:08, Cliff Redmond wrote:

&gt;<i> (Sending directly because my post is awaiting moderator approval)
</I>&gt;<i> 
</I>&gt;<i> Hi Steve,
</I>&gt;<i> 
</I>&gt;<i> thanks for your answer.
</I>&gt;<i> 
</I>&gt;<i> I'm facing the exact same problem as Ken: I think your solution only
</I>&gt;<i> partially addresses the issue.
</I>&gt;<i> 
</I>&gt;<i> One of the most useful features of the Stomp plugin is that when a
</I>&gt;<i> (Stomp) consumer subscribes to a Stomp topic, it automatically creates
</I>&gt;<i> a new queue (with a lifecycle dictated by the subscription) and binds
</I>&gt;<i> it to the default topic exchange on the relevant host.
</I>&gt;<i> 
</I>&gt;<i> e.g. invoking the following in a consumer:
</I>&gt;<i> 
</I>&gt;<i> $frame = Net::Stomp::Frame-&gt;new( {
</I>&gt;<i>      command =&gt; &quot;SUBSCRIBE&quot;,
</I>&gt;<i>      headers =&gt; {
</I>&gt;<i>          destination =&gt; &quot;/topic/durable-topic-prefetch&quot;,
</I>&gt;<i>          id =&gt; $subscriberId,
</I>&gt;<i>          persistent =&gt; &quot;true&quot;,
</I>&gt;<i>          ack =&gt; &quot;client&quot;,
</I>&gt;<i>          prefetch_count =&gt; 1,
</I>&gt;<i>      },
</I>&gt;<i> });
</I>&gt;<i> 
</I>&gt;<i> $stomp-&gt;send_frame($frame);
</I>&gt;<i> 
</I>&gt;<i> will create a queue on the relevant broker:
</I>&gt;<i> 
</I>&gt;<i> sh-3.2# rabbitmqctl list_queues
</I>&gt;<i> Listing queues ...
</I>&gt;<i> [...]
</I>&gt;<i> stomp.dsub.durable-topic-prefetch.?&#1819;?R?M?\0006??1&gt;?U	0
</I>&gt;<i> [...]
</I>&gt;<i> ...done.
</I>&gt;<i> 
</I>&gt;<i> and bind it to the default topic exchange:
</I>&gt;<i> 
</I>&gt;<i> Listing bindings ...
</I>&gt;<i> [...]
</I>&gt;<i> amq.topic	exchange	stomp.dsub.durable-topic-prefetch.?&#1819;?R?M?\0006??1&gt;?
</I>&gt;<i> U	queue	durable-topic-prefetch	[]
</I>&gt;<i> [...]
</I>&gt;<i> ...done.
</I>&gt;<i> 
</I>&gt;<i> Having to create a queue and bind it to an alternatively named
</I>&gt;<i> federated topic exchange using an AMQ client before each Stomp
</I>&gt;<i> subscription significantly reduces the utility of the Stomp plugin (in
</I>&gt;<i> this federated case).
</I>&gt;<i> 
</I>&gt;<i> My suggestion would be for a change to either of the Stomp or
</I>&gt;<i> Federation plugins:
</I>&gt;<i> 
</I>&gt;<i> - be able to specify a topic exchange to the Stomp plugin (i.e. rather
</I>&gt;<i> than have it always use amq.topic),
</I>&gt;<i> - be able to federate internal/predefined exchanges in the Federation
</I>&gt;<i> plugin.
</I>&gt;<i> 
</I>&gt;<i> With a preference for the former.
</I>&gt;<i> 
</I>&gt;<i> Hope this helps &amp; many thanks,
</I>&gt;<i> 
</I>&gt;<i> Cliff.
</I>&gt;<i> 
</I>&gt;<i> On Feb 21, 6:25 pm, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">st... at rabbitmq.com</A>&gt; wrote:
</I>&gt;&gt;<i> Hi Ken,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> It is possible for you to SEND to the exchange of your choice from a STOMP
</I>&gt;&gt;<i> application, using a destination of the form: /exchange/&lt;name&gt;/&lt;pattern&gt; (<A HREF="seehttp://www.rabbitmq.com/stomp.html#d.ed">seehttp://www.rabbitmq.com/stomp.html#d.ed</A>) and there is no reason why this
</I>&gt;&gt;<i> shouldn't be a topic exchange of your own making.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If you need to SUBSCRIBE to AMQP destinations you can use the destination
</I>&gt;&gt;<i> /amq/queue/&lt;name&gt; (but the queue must exist).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Between them, these should allow you to use STOMP with federated exchanges
</I>&gt;&gt;<i> without plugin modifications.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Let us know how you get on.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Steve Powell  (a federated bunny)
</I>&gt;&gt;<i> ----------some more definitions from the SPD----------
</I>&gt;&gt;<i> vermin (v.) Treating the dachshund for roundworm.
</I>&gt;&gt;<i> chinchilla (n.) Cooling device for the lower jaw.
</I>&gt;&gt;<i> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On 20 Feb 2012, at 16:19, Ken Simon wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Greetings,
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I'm trying to get federation working (via the rabbitmq_federation
</I>&gt;&gt;&gt;<i> plugin) in our environment of STOMP hosts, and to do so I have to
</I>&gt;&gt;&gt;<i> enable federation in the STOMP plugin's exchange: amq.topic.  This
</I>&gt;&gt;&gt;<i> unfortunately doesn't seem to work because amq.* exchanges are
</I>&gt;&gt;&gt;<i> reserved and cannot be re-declared.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> My solution at this point has been to edit the source of the STOMP
</I>&gt;&gt;&gt;<i> plugin and point it at an exchange called &quot;stomp_topic&quot; (which I made
</I>&gt;&gt;&gt;<i> up, but could be anything) instead of the default amq.topic.  Then I
</I>&gt;&gt;&gt;<i> just configure the federation plugin to work with that exchange and it
</I>&gt;&gt;&gt;<i> works fine.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> My question is, is there a better way of doing this?  I hate
</I>&gt;&gt;&gt;<i> maintaining my own downstream changes to plugins if I don't have to.
</I>&gt;&gt;&gt;<i> The docs say that the STOMP plugin routes all messages through
</I>&gt;&gt;&gt;<i> amq.topic, so it appears that's not configurable.  But wouldn't it
</I>&gt;&gt;&gt;<i> make sense to allow use of an exchange that's not reserved?  Or am I
</I>&gt;&gt;&gt;<i> missing something, and this is actually way easier?  I'm having
</I>&gt;&gt;&gt;<i> trouble finding any documented cases of people using both STOMP and
</I>&gt;&gt;&gt;<i> federation.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> Ken
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018458.html">[rabbitmq-discuss] Moving a queue from one node to another
</A></li>
	<LI>Next message: <A HREF="018459.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue 28
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18456">[ date ]</a>
              <a href="thread.html#18456">[ thread ]</a>
              <a href="subject.html#18456">[ subject ]</a>
              <a href="author.html#18456">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
