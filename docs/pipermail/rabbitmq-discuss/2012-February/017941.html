<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Using Pika Python client library with BlockingConnections and publisher-confirms - Does it work?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20Pika%20Python%20client%20library%20with%0A%20BlockingConnections%20and%20publisher-confirms%20-%20Does%20it%20work%3F&In-Reply-To=%3CCABzX%2Bqx5DFgSmv3qgnF%3D0Qm_45WJCoh-sQGYhFQkPdnce3aFLQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017939.html">
   <LINK REL="Next"  HREF="017943.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Using Pika Python client library with BlockingConnections and publisher-confirms - Does it work?</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20Pika%20Python%20client%20library%20with%0A%20BlockingConnections%20and%20publisher-confirms%20-%20Does%20it%20work%3F&In-Reply-To=%3CCABzX%2Bqx5DFgSmv3qgnF%3D0Qm_45WJCoh-sQGYhFQkPdnce3aFLQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Using Pika Python client library with BlockingConnections and publisher-confirms - Does it work?">majek04 at gmail.com
       </A><BR>
    <I>Mon Feb  6 13:13:35 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="017939.html">[rabbitmq-discuss] Using Pika Python client library with	BlockingConnections and publisher-confirms - Does it work?
</A></li>
        <LI>Next message: <A HREF="017943.html">[rabbitmq-discuss] Using Pika Python client library with	BlockingConnections and publisher-confirms - Does it work?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17941">[ date ]</a>
              <a href="thread.html#17941">[ thread ]</a>
              <a href="subject.html#17941">[ subject ]</a>
              <a href="author.html#17941">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 6, 2012 at 12:40, Ask Solem &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ask at rabbitmq.com</A>&gt; wrote:
&gt;<i> On 6 Feb 2012, at 11:59, Marek Majkowski wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> &lt;shameless plug&gt;
</I>&gt;&gt;<i> It's rather simple using Puka:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; client = puka.Client(&quot;<A HREF="amqp://localhost/&quot;">amqp://localhost/&quot;</A>)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; promise = client.connect()
</I>&gt;&gt;<i> &#160; client.wait(promise)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; promise = client.basic_publish(exchange='', routing_key='test',
</I>&gt;&gt;<i> body=&quot;Hello world!&quot;)
</I>&gt;&gt;<i> &#160; client.wait(promise)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://github.com/majek/puka/blob/master/examples/send.py">https://github.com/majek/puka/blob/master/examples/send.py</A>
</I>&gt;&gt;<i> &lt;/shameless plug&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> But that doesn't use publisher confirms?
</I>
Internally it does. `client.wait` will block until pub-ack or an
error comes back.

&gt;<i> It may take a long time for a confirmation to arrive, so blocking while
</I>&gt;<i> waiting for a publisher confirm is likely to be very inefficient. &#160;But if that
</I>&gt;<i> is sufferable then this would also be possible using kombu/pika.
</I>
You can do other things in the meantime, for example create queue
or publish another message, just need to synchronize at some point
(we're talking about  sync programming style here).

    promise1 = client.basic_publish(exchange='', routing_key='test',
body=&quot;Hello world!&quot;)

    promise2 = client.queue_declare(queue='test')
    client.wait(promise2)

    promise3 = client.basic_publish(exchange='', routing_key='test2',
body=&quot;Hello world!&quot;)
    client.wait(promise3)

    client.wait(promise1)

Of course you may wait for any of the three promises and so on.

(Alternatively you can use callbacks and async programming if
you want to know about the pub-ack when-it-happens, but
that's another story)

Marek
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017939.html">[rabbitmq-discuss] Using Pika Python client library with	BlockingConnections and publisher-confirms - Does it work?
</A></li>
	<LI>Next message: <A HREF="017943.html">[rabbitmq-discuss] Using Pika Python client library with	BlockingConnections and publisher-confirms - Does it work?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17941">[ date ]</a>
              <a href="thread.html#17941">[ thread ]</a>
              <a href="subject.html#17941">[ subject ]</a>
              <a href="author.html#17941">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
