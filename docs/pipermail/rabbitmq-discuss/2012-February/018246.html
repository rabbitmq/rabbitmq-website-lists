<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03	performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Looking%20for%20guidance%20on%20R14B04%20vs.%20R13B03%0A%09performance&In-Reply-To=%3CCACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018228.html">
   <LINK REL="Next"  HREF="018258.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03	performance</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Looking%20for%20guidance%20on%20R14B04%20vs.%20R13B03%0A%09performance&In-Reply-To=%3CCACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03	performance">mpietrek at skytap.com
       </A><BR>
    <I>Fri Feb 17 19:17:24 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018228.html">[rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03 performance
</A></li>
        <LI>Next message: <A HREF="018258.html">[rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03 performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18246">[ date ]</a>
              <a href="thread.html#18246">[ thread ]</a>
              <a href="subject.html#18246">[ subject ]</a>
              <a href="author.html#18246">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm quite sure about them all being on ramdisks. It was the first thing I
verified. :-)

One interesting thing to note is that the 37/sec was up quite a bit from
the 25 or so that I was getting before switching to ramdisks.

Now, here's a big reveal...

The 37/sec rate were seeing is for a single client process using mirroring
with 3 queues, persistent messages, and transactions.

If I run multiple identical clients, all writing to the same queue, it
scales extremely well. With five clients, the incoming message rate is five
times as high. Pushing things up to an extreme, I capped out at about 1700
messages/sec to the same queue with 100 clients. The rate per individual
client was about half of the original 37, but that's still very reasonable
for 100 clients banging on the broker.

While I'm very happy with these results, I'm still puzzled. Given that all
clients are writing to the same queue, I'd expect resource
contention/blocking in the broker to slow things down much faster than they
do. Any comment on this? Am I overlooking anything critical to my
understanding?

Thanks,

Matt


On Fri, Feb 17, 2012 at 4:39 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 15/02/12 19:18, Matt Pietrek wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> If I remove the clustering, so as to just hit a single broker, the rate
</I>&gt;&gt;<i> goes up to 900 message/sec. Thus, I'm directed back to looking for
</I>&gt;&gt;<i> latency between the master/slaves.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'll poke at this a bit more, but are you absolutely sure that the
</I>&gt;<i> MNESIA_DIR is on a ramdisk on all the machines in the cluster? It's just
</I>&gt;<i> that 36 msg/s is quite close to the performance I would expect with an
</I>&gt;<i> HDD-fsync-per-commit. Just one machine could be slowing the cluster down,
</I>&gt;<i> you won't see tx.commit-ok until the message is on disk on all the nodes...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/0cffd8f7/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/0cffd8f7/attachment.htm</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018228.html">[rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03 performance
</A></li>
	<LI>Next message: <A HREF="018258.html">[rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03 performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18246">[ date ]</a>
              <a href="thread.html#18246">[ thread ]</a>
              <a href="subject.html#18246">[ subject ]</a>
              <a href="author.html#18246">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
