<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE frames
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20doesn%27t%20include%20the%20routing-key%20on%0A%20MESSAGE%20frames&In-Reply-To=%3CCAM8fPiTqRg8LtiMa21U-Vh7nFFc3YdBw9Gs8X_nASeVn8Oxiaw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018279.html">
   <LINK REL="Next"  HREF="018286.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE frames</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20doesn%27t%20include%20the%20routing-key%20on%0A%20MESSAGE%20frames&In-Reply-To=%3CCAM8fPiTqRg8LtiMa21U-Vh7nFFc3YdBw9Gs8X_nASeVn8Oxiaw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE frames">tonygarnockjones+rabbitmq at gmail.com
       </A><BR>
    <I>Mon Feb 20 19:56:16 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018279.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on	MESSAGE frames
</A></li>
        <LI>Next message: <A HREF="018286.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE frames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18285">[ date ]</a>
              <a href="thread.html#18285">[ thread ]</a>
              <a href="subject.html#18285">[ subject ]</a>
              <a href="author.html#18285">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Steve,

On 20 February 2012 12:04, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>&gt; wrote:
&gt;<i> Sorry I was so long in replying.
</I>
Thanks for getting back to me!

&gt;<i> When you say 'no longer propagated', you imply that we used to do this. I guess
</I>&gt;<i> that was in the original implementation? :-)
</I>
It was, yep.

&gt;<i> There is really no limit to the amount of information we could include in the
</I>&gt;<i> MESSAGE headers gleaned from the underlying implementation. We could easily
</I>&gt;<i> provide the AMQP exchange-name, consumer-tag and delivery-tag.
</I>
You already do, or at least you give equivalents. The destination
perforce covers the exchange name; the consumer-tag is covered by the
&quot;subscription&quot; header in MESSAGE; and the delivery-tag is covered by
&quot;message-id&quot;. What's missing is the small gap between the concrete
destination to which the message was sent and the abstract destination
(really, a destination pattern) used in the SUBSCRIBE. And that gap
is, in AMQP, covered exactly by the routing-key. Think of it as the
bindings from unification of the destination from subscribe with the
destination from publish (erm, if you imagine the
subscription-destination-pattern to be a regex, it's kind of the
capture groups).

Adding the routing_key puts the final small missing piece in place. A
perhaps more STOMPish way of giving it would be to have a &quot;to&quot; header
or similar carried in a MESSAGE, containing the full destination given
in the SEND. Oh wait! I've just checked, and actually that's what's
required by the 1.1 spec already. So the STOMP adapter isn't quite
spec-compliant, in that it's giving the destination from the
*subscribe* rather than the *send*.

(This makes sense, actually: the server needn't repeat the SUBSCRIBE's
destination header in each MESSAGE, as the client after all was the
one that specified it in the SUBSCRIBE! Carrying the SEND's
destination into the MESSAGE genuinely tells the consuming client
something they can't know in advance.)

&gt;<i> The meaning and content of the header
</I>&gt;<i> value might change as we change our mapping.
</I>
I don't care about that: I just want the routing key, because I'm
using STOMP for simple interop with real AMQP clients.

&gt;<i> So, I'm reluctant to include this information unless there is a compelling STOMP
</I>&gt;<i> reason for doing so. Is your application a pure STOMP one?
</I>
No: that's why the routing_key is important.

Regards,
  Tony
-- 
Tony Garnock-Jones
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonygarnockjones at gmail.com</A>
<A HREF="http://homepages.kcbbs.gen.nz/tonyg/">http://homepages.kcbbs.gen.nz/tonyg/</A>
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018279.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on	MESSAGE frames
</A></li>
	<LI>Next message: <A HREF="018286.html">[rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE frames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18285">[ date ]</a>
              <a href="thread.html#18285">[ thread ]</a>
              <a href="subject.html#18285">[ subject ]</a>
              <a href="author.html#18285">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
