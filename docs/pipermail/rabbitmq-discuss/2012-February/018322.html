<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20stall/hang%20when%20leaving%20a%20cluster&In-Reply-To=%3CCB69271E.2EDC1%25mpietrek%40skytap.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018453.html">
   <LINK REL="Next"  HREF="018331.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20stall/hang%20when%20leaving%20a%20cluster&In-Reply-To=%3CCB69271E.2EDC1%25mpietrek%40skytap.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster">mpietrek at skytap.com
       </A><BR>
    <I>Tue Feb 21 18:49:02 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018453.html">[rabbitmq-discuss] Ensuring low latency for publishers
</A></li>
        <LI>Next message: <A HREF="018331.html">[rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18322">[ date ]</a>
              <a href="thread.html#18322">[ thread ]</a>
              <a href="subject.html#18322">[ subject ]</a>
              <a href="author.html#18322">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've noticed a pattern here that seems to be consistently reproducible.

In our setup, we have three RabbitMQ 2.71 brokers in a cluster on Ubuntu
10.04. They're all mirroring the same set of queues, but that may or may not
be relevant here.

Starting from a healthy state (Management web console showing all brokers,
and all queues in sync), I simply run &quot;rabbitmqctl stop_app&quot; for one of the
nodes, followed by running &quot;rabbitmqctl start_app&quot; on the same node.

The expected results is that the one broker should drop out of the cluster,
then rejoin it. This is indeed what happens when I run against a broker that
does *not* have the stats database (as shown by the Web UI).

If I try this action on the node with the stats database, rabbitmqctl waits
forever and I have to ctrl-c out.  If I then try &quot;rabbitmqctl stop&quot;, it
errors out, saying that the node is down.

The only way I can get the cluster back up is to shut down the other two
actively running nodes, then restart all three nodes.

Known issue? Something I'm overlooking? Searching online isn't turning up
anything obvious.

Thanks,

Matt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/8f43f1a7/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/8f43f1a7/attachment.htm</A>&gt;
</PRE>

























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018453.html">[rabbitmq-discuss] Ensuring low latency for publishers
</A></li>
	<LI>Next message: <A HREF="018331.html">[rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18322">[ date ]</a>
              <a href="thread.html#18322">[ thread ]</a>
              <a href="subject.html#18322">[ subject ]</a>
              <a href="author.html#18322">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
