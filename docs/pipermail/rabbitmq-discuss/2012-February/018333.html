<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Initiating%20queue%20monitoring%2C%0A%20but%20returning%20to%20main%20method%20with%20indication%20of%20success&In-Reply-To=%3CC974010E949511448F6DC6F748F604D90FEB1A14%40TSEAMB01%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018332.html">
   <LINK REL="Next"  HREF="018335.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success</H1>
    <B>McMahon, James S (TASC)</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Initiating%20queue%20monitoring%2C%0A%20but%20returning%20to%20main%20method%20with%20indication%20of%20success&In-Reply-To=%3CC974010E949511448F6DC6F748F604D90FEB1A14%40TSEAMB01%3E"
       TITLE="[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success">james.mcmahon at TASC.COM
       </A><BR>
    <I>Wed Feb 22 12:14:34 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018332.html">[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</A></li>
        <LI>Next message: <A HREF="018335.html">[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18333">[ date ]</a>
              <a href="thread.html#18333">[ thread ]</a>
              <a href="subject.html#18333">[ subject ]</a>
              <a href="author.html#18333">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I apologize for omitting the mailing list. Am still learning the ropes of the forum. Will be sure to keep the mailing list on the cc line from now on.

I think this does answer my question. You hit the nail ont he head re: the source of my confusion: how would handleDelivery() substitute for the while() loop in this:

    while (true) {
      QueueingConsumer.Delivery delivery = consumer.nextDelivery();
      String message = new String(delivery.getBody());
      System.out.println(&quot; [x] Received '&quot; + message + &quot;'&quot;);
    }

The source of my confusion is piecing this all together. Would I simply replace this

    QueueingConsumer consumer = new QueueingConsumer(channel);
    channel.basicConsume(QUEUE_NAME, true, consumer);

with something like the following?

    //strike the Queueingconsumer consumer.....
    
    boolean autoAck = false;
channel.basicConsume(ticket, queueName, autoAck,
     new DefaultConsumer(channel) {
         @Override
         public void handleDelivery(String consumerTag,
                                    Envelope envelope,
                                    AMQP.BasicProperties properties,
                                    byte[] body)
             throws IOException
         {
             String routingKey = envelope.getRoutingKey();
             String contentType = properties.contentType;
             long deliveryTag = envelope.getDeliveryTag();
             //
             // my custom handling stuff here
             //
             channel.basicAck(deliveryTag, false);
         }
     });

Does this get invoked every time a message arrives for my queue through the direct exchange?

What purpose does the   channel.basicAck(deliveryTag, false);    serve?

Thank you again for helping me to better understand how to work with this as I learn rabbitMQ, Simon.

Jim



________________________________________
From: Simon MacMullen [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>]
Sent: Wednesday, February 22, 2012 7:00 AM
To: McMahon, James S (TASC)
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success

Please keep the mailing list CCed.

Rather than pass a QueueingConsumer to basicConsume() and pulling
deliveries out of it with nextDelivery(), you can override
handleDelivery() on DefaultConsumer to do whatever you need to to when
receiving a message. The handleDelivery() callback will then get invoked
in another thread, although this is invisible to you, so you don't need
to enter any while loop.

Does this answer your question? It's not clear what is unclear to you :)

Cheers, Simon

On 22/02/12 11:52, McMahon, James S (TASC) wrote:
&gt;<i>       Thank you for the reply and guidance, Simon. Being new to rabbitMQ, I don't have an understanding of what you mean, though. Is there a link to an example or reference to which you can direct me?
</I>&gt;<i>
</I>&gt;<i>       Thanks again for your help.
</I>&gt;<i>
</I>&gt;<i> Jim
</I>&gt;<i> ________________________________________
</I>&gt;<i> From: Simon MacMullen [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>]
</I>&gt;<i> Sent: Wednesday, February 22, 2012 6:42 AM
</I>&gt;<i> To: McMahon, James S (TASC)
</I>&gt;<i> Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</I>&gt;<i>
</I>&gt;<i> Hi James. You could either fire up a new thread, or (probably simpler)
</I>&gt;<i> use a DefaultConsumer and override its handleDelivery() method rather
</I>&gt;<i> than use QueueingConsumer.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> On 21/02/12 20:33, McMahon, James S (TASC) wrote:
</I>&gt;&gt;<i> The rabbitMQ examples all show a use case where the receiver enters into
</I>&gt;&gt;<i> a while( true ) loop that is only terminated when the coder hits Ctrl-C
</I>&gt;&gt;<i> at the command line.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In my case, I call a method in a Listener class from a main java method
</I>&gt;&gt;<i> in my primary class, Driver. As a result, control passes to
</I>&gt;&gt;<i> callListener() in Listener.java and loops there endlessly waiting for
</I>&gt;&gt;<i> messages it gets from the direct exchange. In my main() method of
</I>&gt;&gt;<i> Driver.java, it makes a call right now like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> callListener();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> and inside my callListener method I implement similar to that that which
</I>&gt;&gt;<i> was shown in the tutorials:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ConnectionFactory factory = new ConnectionFactory();
</I>&gt;&gt;<i> factory.setHost(&quot;localhost&quot;);
</I>&gt;&gt;<i> Connection connection = factory.newConnection();
</I>&gt;&gt;<i> Channel channel = connection.createChannel();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> channel.exchangeDeclare(EXCHANGE_NAME, &quot;topic&quot;);
</I>&gt;&gt;<i> String queueName = channel.queueDeclare().getQueue();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> for(String bindingKey : argv){
</I>&gt;&gt;<i> channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> System.out.println(&quot; [*] Waiting for messages. To exit press CTRL+C&quot;);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> QueueingConsumer consumer = new QueueingConsumer(channel);
</I>&gt;&gt;<i> channel.basicConsume(queueName, true, consumer);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> while (true) {
</I>&gt;&gt;<i> QueueingConsumer.Delivery delivery = consumer.nextDelivery();
</I>&gt;&gt;<i> String message = new String(delivery.getBody());
</I>&gt;&gt;<i> String routingKey = delivery.getEnvelope().getRoutingKey();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> // ...my other method calls to process the messages
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I lose program control at that point, because this does not return me to
</I>&gt;&gt;<i> my main() in Driver, where I need to accomplish other actions while this
</I>&gt;&gt;<i> listener is monitoring the queue. What I need is for that call to
</I>&gt;&gt;<i> initiate the while loop and listen to the queue, and if it does so
</I>&gt;&gt;<i> successfully return me to my calling program with some indication of
</I>&gt;&gt;<i> success even as the while loop sits there listening to the queue for
</I>&gt;&gt;<i> messages.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How can I implement this?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks very much.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> CONFIDENTIALITY NOTICE: This message and any attachments or files
</I>&gt;&gt;<i> transmitted with it (collectively, the &quot;Message&quot;) are intended only for
</I>&gt;&gt;<i> the addressee and may contain information that is privileged,
</I>&gt;&gt;<i> proprietary and/or prohibited from disclosure by law or contract. If you
</I>&gt;&gt;<i> are not the intended recipient: (a) please do not read, copy or
</I>&gt;&gt;<i> retransmit the Message; (b) permanently delete and/or destroy all
</I>&gt;&gt;<i> electronic and hard copies of the Message; (c) notify us by return
</I>&gt;&gt;<i> email; and (d) you are hereby notified that any dissemination,
</I>&gt;&gt;<i> distribution or copying of the Message is strictly prohibited.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i> CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the &quot;Message&quot;) are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
</I>

--
Simon MacMullen
RabbitMQ, VMware
</PRE>
































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018332.html">[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</A></li>
	<LI>Next message: <A HREF="018335.html">[rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18333">[ date ]</a>
              <a href="thread.html#18333">[ thread ]</a>
              <a href="subject.html#18333">[ subject ]</a>
              <a href="author.html#18333">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
