<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on slave nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%202.7.1%20mirrored%20queues%20leak%20a%20lot%20of%20memory%0A%20on%20slave%20nodes&In-Reply-To=%3CCAChq9g3Bh4%3Dmm3qask6SiingrnyjFU9DdWpPhWBAYJyYb6%2BVdg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018347.html">
   <LINK REL="Next"  HREF="018350.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on slave nodes</H1>
    <B>Travis</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%202.7.1%20mirrored%20queues%20leak%20a%20lot%20of%20memory%0A%20on%20slave%20nodes&In-Reply-To=%3CCAChq9g3Bh4%3Dmm3qask6SiingrnyjFU9DdWpPhWBAYJyYb6%2BVdg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on slave nodes">hcoyote at ghostar.org
       </A><BR>
    <I>Wed Feb 22 21:58:22 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018347.html">[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on	slave nodes
</A></li>
        <LI>Next message: <A HREF="018350.html">[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on slave nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18348">[ date ]</a>
              <a href="thread.html#18348">[ thread ]</a>
              <a href="subject.html#18348">[ subject ]</a>
              <a href="author.html#18348">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Feb 22, 2012 at 2:12 PM, Reverend Chip &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rev.chip at gmail.com</A>&gt; wrote:
&gt;<i> I have a four-node 2.7.1 cluster. &#160;I just started experimenting with
</I>&gt;<i> mirrored queues. &#160;One queue is mirrored across nodes 1&amp;2, a second queue
</I>&gt;<i> is mirrored across nodes 3&amp;4. &#160;I've been feeding a lot of large messages
</I>&gt;<i> through, using delivery-mode 2. &#160;Most of the messages I've purged, since
</I>&gt;<i> the reader process can't keep up yet.
</I>&gt;<i>
</I>&gt;<i> Here's the problem: Memory usage. &#160;Nodes 1 &amp; 3, presumably the master
</I>&gt;<i> nodes for the queues, have maintained a normal memory profile, 3-6GB.
</I>&gt;<i> But nodes 2 &amp; 4, the presumable slaves, have had their memory grow to
</I>&gt;<i> 58GB each. &#160;Worse, when I purged and then even deleted the queues, the
</I>&gt;<i> memory usage did not go down. &#160;It seems I may have to reboot these nodes
</I>&gt;<i> to get the memory back, and obviously I can't use mirrored queues if
</I>&gt;<i> they're going to make my nodes do this, which is disappointing. &#160;I do
</I>&gt;<i> have a workaround involving alternate exchanges, but the workaround can
</I>&gt;<i> leave data stranded if a node is lost forever.
</I>&gt;<i>
</I>&gt;<i> Is there any other info I can provide to help diagnose and/or fix this?
</I>
I think we're experiencing the same thing.  Previously, we were seeing
a memory leak in 2.6.1 which was patched[1] in subsequent releases.
Since then, we've upgraded to 2.7.1 as well and we're seeing slowly
growing memory usage on our slaves that requires us to restart the
slaves periodically to keep the memory usage down.

In our case, we're using only two nodes with mirrored queues.

Travis

[1] this patch <A HREF="http://hg.rabbitmq.com/rabbitmq-server/rev/89315378597d">http://hg.rabbitmq.com/rabbitmq-server/rev/89315378597d</A>
fixed our memory leak in 2.6.1.  worked great when we applied just the
patch to 2.6.1.  it has to be something different in 2.7.1 causing
this new memory leak though.


-- 
Travis Campbell
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">travis at ghostar.org</A>
</PRE>



























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018347.html">[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on	slave nodes
</A></li>
	<LI>Next message: <A HREF="018350.html">[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on slave nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18348">[ date ]</a>
              <a href="thread.html#18348">[ thread ]</a>
              <a href="subject.html#18348">[ subject ]</a>
              <a href="author.html#18348">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
