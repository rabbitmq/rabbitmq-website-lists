<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unexpected%20behaviour%20with%20STOMP%20%26%20NACK&In-Reply-To=%3CC71F5D87-E010-4007-8CEB-7560CCEBFFD7%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018334.html">
   <LINK REL="Next"  HREF="018337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unexpected%20behaviour%20with%20STOMP%20%26%20NACK&In-Reply-To=%3CC71F5D87-E010-4007-8CEB-7560CCEBFFD7%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK">steve at rabbitmq.com
       </A><BR>
    <I>Mon Feb 27 10:21:39 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018334.html">[rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK
</A></li>
        <LI>Next message: <A HREF="018337.html">[rabbitmq-discuss] RabbitMQ crash after few hours
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18428">[ date ]</a>
              <a href="thread.html#18428">[ thread ]</a>
              <a href="subject.html#18428">[ subject ]</a>
              <a href="author.html#18428">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Lionel,

Apologies for the tardy reply.

Thank you for reporting this. What is happening is that the NACK sets the
'requeue=true' flag, which, by definition, puts the message back on its queue.
It is then available for redelivery. Whether it gets redelivered to the same
consumer depends on lots of things, but is entirely possible, and is expected
when there is only one consumer.

Currently, we expect this behaviour and did not think it was prohibited by the
specification.

If this is determined to violate the specification we could set requeue=false on
NACK, then neither this client, nor any other, will see the message; which is
allowable server behaviour. There is currently no mechanism for re-routing
messages that are NACKd, but this may change in the near future.

Steve Powell
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 22 Feb 2012, at 12:24, Lionel Cons wrote:

&gt;<i> I get an unexpected behaviour with STOMP &amp; NACK with RabbitMQ 2.7.1.
</I>&gt;<i> 
</I>&gt;<i> Here is my test, using an empty queue.
</I>&gt;<i> - client1 connects, sends a message to the queue and disconnects
</I>&gt;<i> - client2 connects, subscribes to the queue with ack:client
</I>&gt;<i> - client2 receives the message (so far so good) but does not ack it
</I>&gt;<i> - client3 connects, subscribes to the queue
</I>&gt;<i> - client2 sends a NACK frame for the message
</I>&gt;<i> - client2 receives the message once more
</I>&gt;<i> - client3 receives nothing
</I>&gt;<i> 
</I>&gt;<i> I would have expected the other client (client3) to receive the
</I>&gt;<i> message that has not been consumed by client2. In fact, this is how
</I>&gt;<i> ActiveMQ and Apollo work.
</I>&gt;<i> 
</I>&gt;<i> FWIW, the STOMP 1.1 spec mentions:
</I>&gt;<i> 
</I>&gt;<i> | NACK is the opposite of ACK. It is used to tell the server that the
</I>&gt;<i> | client did not consume the message. The server can then either send
</I>&gt;<i> | the message to a different client, discard it, or put it in a dead
</I>&gt;<i> | letter queue. The exact behavior is server specific.
</I>&gt;<i> 
</I>&gt;<i> So, although the behavior is not strictly defined, re-sending the
</I>&gt;<i> message to the same client does not look appropriate to me.
</I>&gt;<i> 
</I>&gt;<i> What do you think?
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> 
</I>&gt;<i> Lionel
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018334.html">[rabbitmq-discuss] Unexpected behaviour with STOMP &amp; NACK
</A></li>
	<LI>Next message: <A HREF="018337.html">[rabbitmq-discuss] RabbitMQ crash after few hours
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18428">[ date ]</a>
              <a href="thread.html#18428">[ thread ]</a>
              <a href="subject.html#18428">[ subject ]</a>
              <a href="author.html#18428">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
