<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumers may hang after network instability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumers%20may%20hang%20after%20network%20instability&In-Reply-To=%3C88E590DC4586974D825FC82AE798294E520F237D%40GSVCLU04.ges.ferlan.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018236.html">
   <LINK REL="Next"  HREF="018266.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumers may hang after network instability</H1>
    <B>Busoli, Simone</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumers%20may%20hang%20after%20network%20instability&In-Reply-To=%3C88E590DC4586974D825FC82AE798294E520F237D%40GSVCLU04.ges.ferlan.it%3E"
       TITLE="[rabbitmq-discuss] Consumers may hang after network instability">Simone.Busoli at ferrari.com
       </A><BR>
    <I>Fri Feb 17 16:08:16 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018236.html">[rabbitmq-discuss] Consumers may hang after network instability
</A></li>
        <LI>Next message: <A HREF="018266.html">[rabbitmq-discuss] Consumers may hang after network instability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18238">[ date ]</a>
              <a href="thread.html#18238">[ thread ]</a>
              <a href="subject.html#18238">[ subject ]</a>
              <a href="author.html#18238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alexey, you need to enable heartbeats to make sure that you detect network issues. It's an option on the ConnectionFactory class.

-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Alexey
Sent: venerd&#236; 17 febbraio 2012 11:22
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: [rabbitmq-discuss] Consumers may hang after network instability

Hello,

We are using 2.7.1 version of .NET client and 2.7.1 rabbitmq-server.
Several times we catched all consumers of rabbitmq server was hang after network instability (lost and reestablished connection or server with rabbitmq power cable unpluged)

Problem method is IModel.Close() or IConnection.Close() (sorry, I don't remember which is)

Parts of our code responded for connection below:

public void Connect()
{
	var cf = new ConnectionFactory
	{
		HostName = replica.EndPoint.Address.ToString(),
		Port = replica.EndPoint.Port,
		UserName = mqUsername,
		Password = mqPassword,
	};
	connection = cf.CreateConnection();
	Model = connection.CreateModel();
	Model.DeclareQueue(queueName);
	Model.BasicConsume(queueName, false, thisConsumerTag, true, false, null, this); }

public void Disconnect(){
	if (Model != null &amp;&amp; Model.IsOpen) Model.Close(200, &quot;Close on client initiative&quot;);
	if (connection != null &amp;&amp; connection.IsOpen) connection.Close(200, &quot;Close on client initiative&quot;, disconnectTimeout); }

Can anyone suggest a right way to close connection without chance to hang?
Would appreciate for help.
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>

_________________________________________________________________________________________________________________
Questo messaggio &#232; da intendersi esclusivamente ad uso del destinatario e pu&#242; contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non &#232; il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione &#232; 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


</PRE>

































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018236.html">[rabbitmq-discuss] Consumers may hang after network instability
</A></li>
	<LI>Next message: <A HREF="018266.html">[rabbitmq-discuss] Consumers may hang after network instability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18238">[ date ]</a>
              <a href="thread.html#18238">[ thread ]</a>
              <a href="subject.html#18238">[ subject ]</a>
              <a href="author.html#18238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
