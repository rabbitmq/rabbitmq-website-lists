<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problems with RabbitMQ not responding on channel	request
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problems%20with%20RabbitMQ%20not%20responding%20on%20channel%0A%09request&In-Reply-To=%3CAANLkTinLFONtpKROb0T0R8AG%3DONo4NAV813Bu8OgckKg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008476.html">
   <LINK REL="Next"  HREF="008479.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problems with RabbitMQ not responding on channel	request</H1>
    <B>Cal Leeming [Simplicity Media Ltd]</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problems%20with%20RabbitMQ%20not%20responding%20on%20channel%0A%09request&In-Reply-To=%3CAANLkTinLFONtpKROb0T0R8AG%3DONo4NAV813Bu8OgckKg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Problems with RabbitMQ not responding on channel	request">cal.leeming at simplicitymedialtd.co.uk
       </A><BR>
    <I>Wed Aug 18 14:48:16 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008476.html">[rabbitmq-discuss] Java Client Threading Patches
</A></li>
        <LI>Next message: <A HREF="008479.html">[rabbitmq-discuss] Problems with RabbitMQ not responding on	channel request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8477">[ date ]</a>
              <a href="thread.html#8477">[ thread ]</a>
              <a href="subject.html#8477">[ subject ]</a>
              <a href="author.html#8477">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys,

I seem to have a problem where RabbitMQ will stop accepting channel requests
after either a certain amount of messages are in the queue, or once I have
sent 200-300 connection requests.

I have done this using the Tracer and without the Tracer, and experience the
exact same problem each time. I'm also not using any custom rabbitmq config.

At first I thought it was a memory problem, but if I restart RabbitMQ,
sometimes it will start accepting connections again and allow me to put more
items on the queue, but then other times it won't.

Whenever I delete the mnesia folder, it will start working again, but then
after a few thousands messages (20k+) it will randomly stop again.

Currently, I am at 324k messages in the queue.

Does anyone have any ideas what could be causing this?

Cheers

Cal



System info
-----------------
 <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at mail01.dmemedialtd.com</A> [/var/log/rabbitmq] &gt; uname -a
Linux mail01.dmemedialtd.com 2.6.26-2-amd64 #1 SMP Sun Jun 20 20:16:30 UTC
2010 x86_64 GNU/Linux

 <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at mail01.dmemedialtd.com</A> [/var/log/rabbitmq] &gt; cat /etc/issue
Debian GNU/Linux 5.0 \n \l

top - 14:42:53 up 49 days, 15:35,  2 users,  load average: 0.00, 0.00, 0.00
Tasks:  60 total,   1 running,  59 sleeping,   0 stopped,   0 zombie
Cpu0  :  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu1  :  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Mem:   1027932k total,   766764k used,   261168k free,    25584k buffers
Swap:   971892k total,   212020k used,   759872k free,   288416k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 4682 rabbitmq  20   0  610m 349m 2020 S    0 34.8   0:28.47 beam.smp
 4735 rabbitmq  20   0  3772  372  368 S    0  0.0   0:00.00 cpu_sup
 4764 rabbitmq  20   0 10492  392  388 S    0  0.0   0:00.00 inet_gethost
 4766 rabbitmq  20   0 16784  560  556 S    0  0.1   0:00.00 inet_gethost
14382 rabbitmq  20   0 11004  940  332 S    0  0.1   0:01.50 epmd

rabbitmq 14382  0.0  0.0  11004   940 ?        S    Aug12   0:01
/usr/lib/erlang/erts-5.6.3/bin/epmd -daemon
rabbitmq  4682  0.9 34.7 624684 357480 ?       Ssl  13:54   0:28
/usr/lib/erlang/erts-5.6.3/bin/beam.smp -W w -K true -A30 -P 1048576 --
-root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/../ebin -noshell -noinput
-s rabbit -sname <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mail01</A> -boot start_sasl -kernel
inet_default_listen_options [{nodelay,true}] -kernel
inet_default_connect_options [{nodelay,true}] -sasl errlog_type error
-kernel error_logger {file,&quot;/var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mail01.log</A>&quot;} -sasl
sasl_error_logger {file,&quot;/var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mail01-sasl.log</A>&quot;} -os_mon
start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup false
-mnesia dir &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mail01</A>&quot; -noshell -noinput
rabbitmq  4735  0.0  0.0   3772   372 ?        Ss   13:54   0:00  \_
/usr/lib/erlang/lib/os_mon-2.1.6/priv/bin/cpu_sup
rabbitmq  4764  0.0  0.0  10492   392 ?        Ss   13:54   0:00  \_
inet_gethost 4
rabbitmq  4766  0.0  0.0  16784   560 ?        S    13:54   0:00      \_
inet_gethost 4


 <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at mail01.dmemedialtd.com</A> [~/rabbitmq-java-client-1.4.0/build/dist] &gt;
rabbitmqctl list_queues
Listing queues ...
po_box 324722
...done.


 <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at mail01.dmemedialtd.com</A> [/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mail01</A>] &gt; ls
-la
total 162608
drwxr-xr-x 2 rabbitmq rabbitmq     4096 2010-08-18 14:00 .
drwxr-xr-x 3 rabbitmq rabbitmq     4096 2010-08-12 21:54 ..
-rw-r--r-- 1 rabbitmq rabbitmq      155 2010-08-18 14:00 DECISION_TAB.LOG
-rw-r--r-- 1 rabbitmq rabbitmq       91 2010-08-18 14:00 LATEST.LOG
-rw-r--r-- 1 rabbitmq rabbitmq        8 2010-08-12 21:54 rabbit_config.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      822 2010-08-18 13:31
rabbit_durable_exchange.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      198 2010-08-18 13:54
rabbit_durable_queue.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      271 2010-08-18 13:57
rabbit_durable_queue.DCL
-rw-r--r-- 1 rabbitmq rabbitmq      348 2010-08-18 13:31
rabbit_durable_route.DCD
-rw-r--r-- 1 rabbitmq rabbitmq 83128355 2010-08-18 13:55
rabbit_persister.LOG
-rw-r--r-- 1 rabbitmq rabbitmq 83128355 2010-08-18 13:55
rabbit_persister.LOG.previous
-rw-r--r-- 1 rabbitmq rabbitmq        3 2010-08-18 13:54 rabbit_serial
-rw-r--r-- 1 rabbitmq rabbitmq      127 2010-08-18 13:31 rabbit_user.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      185 2010-08-18 13:31
rabbit_user_permission.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      581 2010-08-18 14:00
rabbit_user_permission.DCL
-rw-r--r-- 1 rabbitmq rabbitmq      126 2010-08-18 13:31 rabbit_vhost.DCD
-rw-r--r-- 1 rabbitmq rabbitmq    12389 2010-08-12 21:54 schema.DAT



Client Side:
-------------------
&gt;&gt;&gt;<i> conn = amqp.Connection(host=&quot;10.1.3.2:5673&quot;, userid=&quot;guest&quot;,
</I>password=&quot;guest&quot;, virtual_host=&quot;/&quot;, insist=True)
&gt;&gt;&gt;<i> chan = conn.channel()
</I> ---- Blocks forever and a day ----
 ---- Press CTRL + C ----
^CTraceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py&quot;, line
230, in channel
  File &quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py&quot;, line
82, in __init__
  File &quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py&quot;, line
471, in _x_open
  File
&quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py&quot;, line
89, in wait
  File &quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py&quot;, line
198, in _wait_method
  File &quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/method_framing.py&quot;,
line 212, in read_method
  File &quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/method_framing.py&quot;,
line 127, in _next_method
  File &quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/transport.py&quot;, line
109, in read_frame
  File &quot;build/bdist.linux-x86_64/egg/amqplib/client_0_8/transport.py&quot;, line
200, in _read
KeyboardInterrupt

Tracer proxy result:
-------------------
 <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at mail01.dmemedialtd.com</A> [~/rabbitmq-java-client-1.4.0/build/dist] &gt;
./runjava.sh com.rabbitmq.tools.Tracer
Usage: Tracer [&lt;listenport&gt; [&lt;connecthost&gt; [&lt;connectport&gt;]]]
Invoked as: Tracer 5673 localhost 5672
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false

---- this is where the connection is started ----
1282138358084: conn#0 ch#0 &lt;-
{#method&lt;connection.start&gt;(version-major=8,version-minor=0,server
properties={platform=Erlang/OTP, product=RabbitMQ, version=1.8.1,
copyright=Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial
Technologies LLC., and Rabbit Technologies Ltd., information=Licensed under
the MPL.  See <A HREF="http://www.rabbitmq.com/},mechanisms=PLAIN">http://www.rabbitmq.com/},mechanisms=PLAIN</A>
AMQPLAIN,locales=en_US),null,&quot;&quot;}
1282138358084: conn#0 ch#0 &lt;-
{#method&lt;connection.tune&gt;(channel-max=0,frame-max=131072,heartbeat=0),null,&quot;&quot;}
1282138358086: conn#0 ch#0 -&gt;
{#method&lt;connection.start-ok&gt;(client-properties={library=Python amqplib,
library_version=0.6.1},mechanism=AMQPLAIN,response=LOGINSguesPASSWORDSguest,locale=en_US),null,&quot;&quot;}
1282138358124: conn#0 ch#0 -&gt;
{#method&lt;connection.tune-ok&gt;(channel-max=65535,frame-max=131072,heartbeat=0),null,&quot;&quot;}
1282138358125: conn#0 ch#0 -&gt;
{#method&lt;connection.open&gt;(virtual-host=/,capabilities=,insist=true),null,&quot;&quot;}
1282138358164: conn#0 ch#0 &lt;-
{#method&lt;connection.open-ok&gt;(known-hosts=mail01:5672),null,&quot;&quot;}

---- this is where the channel is opened ----
1282138359932: conn#0 ch#1 -&gt; {#method&lt;channel.open&gt;(out-of-band=),null,&quot;&quot;}
---- nothing comes back afterwards ----


 <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at mail01.dmemedialtd.com</A> [~] &gt; rabbitmqctl list_connections
Listing connections ...
guest   127.0.0.1       43467   running
...done.

 <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at mail01.dmemedialtd.com</A> [~] &gt; rabbitmqctl list_channels
Listing channels ...
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mail01.3566.0</A>&gt;  guest   false   0       0
...done.

Logs
----------------
 <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at mail01.dmemedialtd.com</A> [/var/log/rabbitmq] &gt; tail -n 20
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mail01.log</A>

=WARNING REPORT==== 18-Aug-2010::14:28:49 ===
exception on TCP connection &lt;0.873.0&gt; from 10.1.3.1:36844
connection_closed_abruptly

=INFO REPORT==== 18-Aug-2010::14:28:49 ===
closing TCP connection &lt;0.873.0&gt; from 10.1.3.1:36844

=WARNING REPORT==== 18-Aug-2010::14:31:54 ===
exception on TCP connection &lt;0.3212.0&gt; from 127.0.0.1:57206
connection_closed_abruptly

=INFO REPORT==== 18-Aug-2010::14:31:54 ===
closing TCP connection &lt;0.3212.0&gt; from 127.0.0.1:57206

=INFO REPORT==== 18-Aug-2010::14:32:37 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:43467

=INFO REPORT==== 18-Aug-2010::14:32:37 ===
starting TCP connection &lt;0.3559.0&gt; from 127.0.0.1:43467




-- 

Cal Leeming

Operational Security &amp; Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">support at simplicitymedialtd.co.uk</A>
*Fax: *+44 (02476) 578987 | *Email: *<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cal.leeming at simplicitymedialtd.co.uk</A>
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/d0b0f406/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/d0b0f406/attachment-0001.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008476.html">[rabbitmq-discuss] Java Client Threading Patches
</A></li>
	<LI>Next message: <A HREF="008479.html">[rabbitmq-discuss] Problems with RabbitMQ not responding on	channel request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8477">[ date ]</a>
              <a href="thread.html#8477">[ thread ]</a>
              <a href="subject.html#8477">[ subject ]</a>
              <a href="author.html#8477">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
