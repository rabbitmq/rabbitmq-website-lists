<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Turning consumers on/off in Erlang client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Turning%20consumers%20on/off%20in%20Erlang%20client&In-Reply-To=%3C20100830174318.GC3857%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008648.html">
   <LINK REL="Next"  HREF="008655.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Turning consumers on/off in Erlang client</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Turning%20consumers%20on/off%20in%20Erlang%20client&In-Reply-To=%3C20100830174318.GC3857%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Turning consumers on/off in Erlang client">matthew at rabbitmq.com
       </A><BR>
    <I>Mon Aug 30 18:43:18 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008648.html">[rabbitmq-discuss] Turning consumers on/off in Erlang client
</A></li>
        <LI>Next message: <A HREF="008655.html">[rabbitmq-discuss] Turning consumers on/off in Erlang client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8652">[ date ]</a>
              <a href="thread.html#8652">[ thread ]</a>
              <a href="subject.html#8652">[ subject ]</a>
              <a href="author.html#8652">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jon,

On Mon, Aug 30, 2010 at 08:28:33AM -0500, Jon Brisbin wrote:
&gt;<i> In my webhooks plugin, I'm trying to add some basic support for scheduling requests to go out at a particular time. Rather than try to implement some kind of sleep() call that waits until the next configured send window (which is getting a little complicated to manage) I'd like to simply cancel the consumer whenever the time is after a send window and start it back up whenever the window opens. I can figure out whether I'm in a send window easy enough but when I try to turn the consumer on and off (by asynchronously doing basic.cancel and basic.consume) it will give me an error something along the lines of (my logs have rolled past this error long ago, sorry for not having it verbatim) &quot;unexpected delivery and no default consumer&quot;. I think this is coming from the erlang client, not the broker. 
</I>
Hmm, that error was meant to catch the case where you do a basic.cancel,
but you have outstanding unack'd messages and then you do
basic.redeliver - the messages get resend but the client has since lost
knowledge about that ctag, hence the error.

If you're doing a basic.cancel with nowait = true then I can certainly
believe this would happen then too. But why are you doing that?

&gt;<i> Is there a way to &quot;nicely&quot; manage the consumer so that it stops reasonably (not by simply interrupting whatever it's currently doing)? A kind of &quot;cancel this consumer after the next message delivery&quot;? Or should I be doing this in a different way?
</I>
Yes - any of:
1. don't use the nowait version of basic.cancel
2. set qos prefetch_count to 1 and never cancel unless you have an
unacknowledged message
3. use amqp_channel:register_default_consumer to set a consumer which
will be invoked if the ctag isn't recognised.

Matthew
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008648.html">[rabbitmq-discuss] Turning consumers on/off in Erlang client
</A></li>
	<LI>Next message: <A HREF="008655.html">[rabbitmq-discuss] Turning consumers on/off in Erlang client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8652">[ date ]</a>
              <a href="thread.html#8652">[ thread ]</a>
              <a href="subject.html#8652">[ subject ]</a>
              <a href="author.html#8652">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
