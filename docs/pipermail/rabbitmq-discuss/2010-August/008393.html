<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] New Persister merged into default
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20Persister%20merged%20into%20default&In-Reply-To=%3C20100812142839.GA4164%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008387.html">
   <LINK REL="Next"  HREF="008282.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] New Persister merged into default</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20Persister%20merged%20into%20default&In-Reply-To=%3C20100812142839.GA4164%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] New Persister merged into default">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Aug 12 15:28:40 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008387.html">[rabbitmq-discuss] New Persister merged into default
</A></li>
        <LI>Next message: <A HREF="008282.html">[rabbitmq-discuss] BQL with 1.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8393">[ date ]</a>
              <a href="thread.html#8393">[ thread ]</a>
              <a href="subject.html#8393">[ subject ]</a>
              <a href="author.html#8393">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Aug 12, 2010 at 08:31:20AM -0400, Aaron Westendorf wrote:
&gt;<i> Bummer, that's a big surprise.  I'd be curious to see a comparison
</I>&gt;<i> with a persister backed by a storage engine that does use mmap, like
</I>&gt;<i> Tokyo Cabinet.  Not that I doubt the team's abilities, we just have
</I>&gt;<i> had fantastic results with applications such as Varnish, TC and Mongo
</I>&gt;<i> which all make extensive use of mmap and let the kernel do all the
</I>&gt;<i> heavy lifting.
</I>
Bear in mind that we don't have many random seeks. All our writes are
append only, and queues only have one read head. This doesn't make life
easy, but it does mean that predicting where the next read is going to
be is rather easy. Plus obviously using block reads etc etc... Given the
way queues are accessed, I'm not convinced you'd see enormous speedups
using mmap. Oh and also, you tend to have many writes for a message, and
0 or 1 reads for a message. So all those stores that are optimised for
heavy read loads - well, needless to say they don't tend to maintain
their performance when presented with a high write-to-read ratio.

&gt;<i> Maybe with the abstraction layer in place, we'll take
</I>&gt;<i> that on the next time we have a hack-a-thon day.
</I>
Please do - the Toke Erlang driver for Tokyo Cabinet that I wrote should
serve you well there.

&gt;<i> I'd also be curious
</I>&gt;<i> to try an extension of the persistent messaging, so that after X
</I>&gt;<i> seconds it can be thrown out.
</I>
If you get anywhere with that, please let us know! We have plans to do a
per-queue TTL (no message in the queue can have been in the queue for
more than N seconds), but general per message TTL is very very much
harder, which is why we've not done it.

Matthew
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008387.html">[rabbitmq-discuss] New Persister merged into default
</A></li>
	<LI>Next message: <A HREF="008282.html">[rabbitmq-discuss] BQL with 1.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8393">[ date ]</a>
              <a href="thread.html#8393">[ thread ]</a>
              <a href="subject.html#8393">[ subject ]</a>
              <a href="author.html#8393">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
