<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Producers%20hanging%20when%20reaching%20high%20memory%0A%20watermark%20on%201.8.1&In-Reply-To=%3CAANLkTinPhR8iR-9OJ9hK8ceoYhnM%2BEq%3D1P0Fxftd9GAa%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008449.html">
   <LINK REL="Next"  HREF="008452.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1</H1>
    <B>Aaron Westendorf</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Producers%20hanging%20when%20reaching%20high%20memory%0A%20watermark%20on%201.8.1&In-Reply-To=%3CAANLkTinPhR8iR-9OJ9hK8ceoYhnM%2BEq%3D1P0Fxftd9GAa%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1">aaron at agoragames.com
       </A><BR>
    <I>Mon Aug 16 16:04:23 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008449.html">[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
</A></li>
        <LI>Next message: <A HREF="008452.html">[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8450">[ date ]</a>
              <a href="thread.html#8450">[ thread ]</a>
              <a href="subject.html#8450">[ subject ]</a>
              <a href="author.html#8450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Aug 16, 2010 at 10:44 AM, Matthias Radestock
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:
&gt;<i> If you can live with the massive performance degradation that swapping
</I>&gt;<i> entails, and have plenty of swap configured, then disabling rabbit's memory
</I>&gt;<i> monitoring is a viable alternative.
</I>
We can, and we'd take corrective action once we saw that condition arise.

&gt;<i> Though once the new persister is released, I don't see what you'd be gaining
</I>&gt;<i> with that. The new persister provides a much more sophisticated and
</I>&gt;<i> performant swapping mechanism than the kernel can provide.
</I>
Really looking forward to this.  We've held off on deploying 1.8.x
because of the flow control changes, but plan to roll out because of
the new persister.  Will the persister only write to disk based on
vm_memory_high_watermark, or is there another control?

&gt;<i> Once rabbit starts swapping, clients will experience pauses in publishing
</I>&gt;<i> anyway, through TCP backpressure.
</I>&gt;<i>
</I>&gt;<i> By &quot;shifting the burden of memory management&quot; do you mean &quot;having to deal
</I>&gt;<i> with the channel.flow message&quot;? The AMQP client library should take care of
</I>&gt;<i> that.
</I>
When I modded py-amqplib to support libevent, I didn't implement flow
control.  I see its value, but for our usage, implementing it would
only shift the backlog that's consuming memory from the Rabbit hosts
to the client hosts.  I do plan to add it back when I refactor our
work for publication, though we're still not likely use it.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aaron at agoragames.com</A>
www.agoragames.com
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008449.html">[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
</A></li>
	<LI>Next message: <A HREF="008452.html">[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8450">[ date ]</a>
              <a href="thread.html#8450">[ thread ]</a>
              <a href="subject.html#8450">[ subject ]</a>
              <a href="author.html#8450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
