<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Disk node vs ram node
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Disk%20node%20vs%20ram%20node&In-Reply-To=%3CAEC6A2084B89EA49B99F71108C2E53EB846A2D%40ign-msg-06.hq.ign.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008289.html">
   <LINK REL="Next"  HREF="008363.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Disk node vs ram node</H1>
    <B>Vince Chang</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Disk%20node%20vs%20ram%20node&In-Reply-To=%3CAEC6A2084B89EA49B99F71108C2E53EB846A2D%40ign-msg-06.hq.ign.com%3E"
       TITLE="[rabbitmq-discuss] Disk node vs ram node">vchang at ign.com
       </A><BR>
    <I>Thu Aug  5 22:56:55 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008289.html">[rabbitmq-discuss] Disk node vs ram node
</A></li>
        <LI>Next message: <A HREF="008363.html">[rabbitmq-discuss] Disk node vs ram node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8290">[ date ]</a>
              <a href="thread.html#8290">[ thread ]</a>
              <a href="subject.html#8290">[ subject ]</a>
              <a href="author.html#8290">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your answers!

#2. I mean that if I send a message that is meant for Q1, where Q1 was originally on node A but now is down because node A is down, will the queue be created on the other nodes B,C? It looks like your answer is no, just to confirm? I am using the 1.7.2 Java client. Is there a way to set up the cluster such that a queue (like Q1 in our case) will be created(automatically) on other nodes (such as node B and node C) if node A goes down? What happens when I make either (node B or node C) or both (node B and node C) disk nodes? 

#3. Not sure if I should do anything before hand, but I ran the command you provided and got this output:
$ erl -sname mgmtsh -remsh <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>
Erlang R13B03 (erts-5.7.4) [source] [smp:4:4] [rq:4] [async-threads:0] [hipe] [kernel-poll:false]

*** ERROR: Shell process terminated! (^G to start new job) ***
{error_logger,{{2010,8,5},{14,52,59}},&quot;~s~n&quot;,[&quot;Error in process &lt;0.33.0&gt; on node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mgmtsh at ebony</A>' with exit value: {badarg,[{erlang,list_to_existing_atom,[\&quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ubuntu</A>\&quot;]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}\n&quot;]}

=ERROR REPORT==== 5-Aug-2010::14:52:59 ===
Error in process &lt;0.33.0&gt; on node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mgmtsh at ebony</A>' with exit value: {badarg,[{erlang,list_to_existing_atom,[&quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ubuntu</A>&quot;]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}

FYI: I'm running Ubuntu and installed rabbitMQ 1.7.2 with sudo apt-get install rabbitmq-server. 

-----Original Message-----
From: Alexandru Scvor&#355;ov [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scvalex at gmail.com</A>] On Behalf Of Alexandru Scvortov
Sent: Thursday, August 05, 2010 2:38 PM
To: Vince Chang
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Disk node vs ram node

On Thu, Aug 05, 2010 at 01:49:51PM -0700, Vince Chang wrote:
&gt;<i> 1. So if I start node A by itself, and then cluster B against A, then A becomes a disk node because I specified A in the rabbitmqctl command? Here are the steps
</I>&gt;<i> 
</I>&gt;<i> Node1: 
</I>&gt;<i> start_app
</I>&gt;<i> add_vhost host1
</I>&gt;<i> add_user user pass
</I>&gt;<i> 
</I>&gt;<i> Node2:
</I>&gt;<i> stop_app
</I>&gt;<i> reset
</I>&gt;<i> cluster node1 &lt;--- (is this the step that makes node A a disk node?)
</I>&gt;<i> start_app
</I>&gt;<i> 
</I>&gt;<i> Node3:
</I>&gt;<i> stop_app
</I>&gt;<i> reset
</I>&gt;<i> cluster node1 
</I>&gt;<i> start_app
</I>
I've just tried that on default.

All the nodes start up as disc nodes.  At that point, you turn *Node2*
into a ram node.  In the third group of commands, you also turn *Node3*
into a ram node.

So, the sequence is:
1. Start Node1 as a disc node
2. Cluster Node2 with Node1; Node2 becomes a ram node
3. Cluster Node3 with Node1; Node3 becomes a ram node
At the end, Node1 is disc; Node2 and Node3 are ram

&gt;<i> 2. To be clear, if I send a message that creates the queue Q1 in node A in a cluster with node A, node B, and node C and node A goes down, then I will lose those messages on node A. Node A is down, but B and C should still be alive. If I send the same message to be queued on Q1, will Q1 be created on node B and node C? For me so far, that is not the case. When I send a message to be queued on Q1 (where the messages on Q1 on node A are now lost because node A is down) I do not see the queue getting created on either node B or node C. Is there something wrong with my steps?
</I>
I'm not quite sure what you mean by ``message that creates the queue''.

If you declare a queue Q1 on node A with queue.declare, then Q1 will
reside on node A.  If node A goes down, all the messages on its queues
(including Q1) will become inaccessible.  If Q1 was declared as durable,
then the messages published as persistent on it will become available
when node A comes back online.

In a cluster, when a node goes down, its queues become inaccesbile.
They are *not* automatically created on other nodes.

Incidentally, which client are you using?

&gt;<i> 3. I am using RabbitMQ 1.7.2. Just to be clear there is _no way_ on 1.7.2 to determine whether or not a node is a disk node or ram node? 
</I>
There's no way to do it with the provided tools.

If you're not squeamish about running a bit of Erlang, you could do
this:

% erl -sname mgmtsh -remsh <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>

This gives you a remote Erlang shell named mgmtsh, connected to
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>

Then, running this should give you the disc nodes:
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>)1&gt; mnesia:table_info(rabbit_durable_exchange, disc_copies).

And running this should give you the ram nodes:
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>)2&gt; mnesia:table_info(rabbit_durable_exchange, ram_copies).


Cheers,
Alex




</PRE>















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008289.html">[rabbitmq-discuss] Disk node vs ram node
</A></li>
	<LI>Next message: <A HREF="008363.html">[rabbitmq-discuss] Disk node vs ram node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8290">[ date ]</a>
              <a href="thread.html#8290">[ thread ]</a>
              <a href="subject.html#8290">[ subject ]</a>
              <a href="author.html#8290">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
