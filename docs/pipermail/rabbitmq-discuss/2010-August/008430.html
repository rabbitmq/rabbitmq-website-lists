<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Producers hanging when reaching high memory	watermark on 1.8.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Producers%20hanging%20when%20reaching%20high%20memory%0A%09watermark%20on%201.8.1&In-Reply-To=%3C3F4B38CF-80CB-4621-9108-A328F2365D52%40yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008429.html">
   <LINK REL="Next"  HREF="008431.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Producers hanging when reaching high memory	watermark on 1.8.1</H1>
    <B>Dave Greggory</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Producers%20hanging%20when%20reaching%20high%20memory%0A%09watermark%20on%201.8.1&In-Reply-To=%3C3F4B38CF-80CB-4621-9108-A328F2365D52%40yahoo.com%3E"
       TITLE="[rabbitmq-discuss] Producers hanging when reaching high memory	watermark on 1.8.1">davegreggory at yahoo.com
       </A><BR>
    <I>Mon Aug 16 04:40:37 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008429.html">[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
</A></li>
        <LI>Next message: <A HREF="008431.html">[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8430">[ date ]</a>
              <a href="thread.html#8430">[ thread ]</a>
              <a href="subject.html#8430">[ subject ]</a>
              <a href="author.html#8430">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthias,

What I'm trying to achieve is to get my client apps to be unaffected if RabbitMQ goes down. In this case, from hitting high memory watermark. Right now, when Rabbit hits that watermark, the clients hang or slow down to a crawl. Maybe that is caused by the threads being blocked by flow control, there by making it appear to be hung. 

 I don't want that. I want sends to throw an exception or some other event I can respond to so that the client apps don't break down or suffer a performance hit just because they lose messaging functionality. How do I do that?

Thanks, 
Dave


On Aug 15, 2010, at 11:05 PM, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:

&gt;<i> Dave,
</I>&gt;<i> 
</I>&gt;<i> Dave Greggory wrote:
</I>&gt;&gt;<i> Spring-AMQP doesn't seem to abide by flow control messages when
</I>&gt;&gt;<i> sending.
</I>&gt;<i> 
</I>&gt;<i> That would surprise me. It's calling into RabbitMQ's Java client APIs, which take care of flow control automatically.
</I>&gt;<i> 
</I>&gt;<i> What evidence are you seeing that flow control isn't working?
</I>&gt;<i> 
</I>&gt;&gt;<i> What's the standard pattern for doing so when using basic publish?
</I>&gt;<i> 
</I>&gt;<i> You shouldn't have to do anything; basic.publish should automatically block when the server has told the client to stop sending messages.
</I>&gt;<i> 
</I>&gt;&gt;<i> And how does setting the high memory watermark to 0 affect how
</I>&gt;&gt;<i> RabbitMQ allocates memory for itself? Does it still limit itself to
</I>&gt;&gt;<i> 40% or use up all that's there? Is that advisable?
</I>&gt;<i> 
</I>&gt;<i> The default threshold is 40% instead of 100% since we need a safety margin. See <A HREF="http://www.rabbitmq.com/extensions.html#memsup">http://www.rabbitmq.com/extensions.html#memsup</A> for details of how the whole flow control mechanism operates.
</I>&gt;<i> 
</I>&gt;<i> In some setups a higher threshold may be safe, but disabling flow control altogether is not advisable.
</I>&gt;<i> 
</I>&gt;<i> Mark Pollack wrote:
</I>&gt;<i> &gt; If this is a matter of calling the 'flow' method on the channel,
</I>&gt;<i> 
</I>&gt;<i> That's for flow control in the other direction, i.e. the client telling the server that it should stop sending messages.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Matthias.
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008429.html">[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
</A></li>
	<LI>Next message: <A HREF="008431.html">[rabbitmq-discuss] Producers hanging when reaching high memory watermark on 1.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8430">[ date ]</a>
              <a href="thread.html#8430">[ thread ]</a>
              <a href="subject.html#8430">[ subject ]</a>
              <a href="author.html#8430">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
