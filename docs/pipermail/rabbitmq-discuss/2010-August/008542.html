<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problems with SSL support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problems%20with%20SSL%20support&In-Reply-To=%3CAANLkTikipmGDeV5D_k%3DyRR%2BT2r89V5HHCPuOd_C%2Bovg8%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008550.html">
   <LINK REL="Next"  HREF="008543.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problems with SSL support</H1>
    <B>Gordon Robinson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problems%20with%20SSL%20support&In-Reply-To=%3CAANLkTikipmGDeV5D_k%3DyRR%2BT2r89V5HHCPuOd_C%2Bovg8%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Problems with SSL support">gordon.robinson at gmail.com
       </A><BR>
    <I>Mon Aug 23 22:07:22 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008550.html">[rabbitmq-discuss] Inconsistency in the Windows instructions/kit
</A></li>
        <LI>Next message: <A HREF="008543.html">[rabbitmq-discuss] Problems with SSL support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8542">[ date ]</a>
              <a href="thread.html#8542">[ thread ]</a>
              <a href="subject.html#8542">[ subject ]</a>
              <a href="author.html#8542">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I&#8217;ve recently upgraded my version of RabbitMQ and ubuntu and am now having
problems trying to get it to work using the SSL support.  I&#8217;ve using Ubuntu
10.4 and RabbitMQ 1.8.1.  Erlang is at version 5.7.4 (R13B03).  erlang_ssl
is version 3.10.7.



Whenever I try and connect to the server from my .Net client using the 1.8.1
library I get the following in my log file:



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

Limiting to approx 924 file handles



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

Memory limit set to 198MB.



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

Rolling persister log to &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ubuntu</A>
/rabbit_persister.LOG.previous&quot;



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

started TCP Listener on 0.0.0.0:5672



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

started SSL Listener on 0.0.0.0:5671



=INFO REPORT==== 23-Aug-2010::15:14:02 ===

accepted TCP connection on 0.0.0.0:5671 from 192.168.152.1:49757



=INFO REPORT==== 23-Aug-2010::15:14:02 ===

starting TCP connection &lt;0.309.0&gt; from 192.168.152.1:49757



=ERROR REPORT==== 23-Aug-2010::15:14:02 ===

** State machine &lt;0.310.0&gt; terminating

** Last message in was {tcp,#Port&lt;0.1886&gt;,&lt;&lt;65,77,81,80,1,1,8,0&gt;&gt;}

** When State == hello

**      Data  == {state,server,

                     {#Ref&lt;0.0.0.489&gt;,&lt;0.309.0&gt;},

                     gen_tcp,tcp,tcp_closed,&quot;localhost&quot;,5671,#Port&lt;0.1886&gt;,

                     {ssl_options,[],verify_peer,#Fun&lt;ssl.2.46498989&gt;,false,

                         false,1,&quot;/opt/memex/server/cert.pem&quot;,

                         &quot;/opt/memex/server/key.pem&quot;,undefined,undefined,

                         &quot;/opt/memex/testca/cacert.pem&quot;,

                         [&lt;&lt;0,10&gt;&gt;,&lt;&lt;0,47&gt;&gt;,&lt;&lt;0,5&gt;&gt;,&lt;&lt;0,4&gt;&gt;,&lt;&lt;0,9&gt;&gt;],

                         #Fun&lt;ssl.0.78632910&gt;,true,[]},

                     {socket_options,binary,0,0,0,false},

                     {connection_states,

                         {connection_state,

                             {security_parameters,undefined,0,0,0,undefined,


undefined,undefined,undefined,0,undefined,0,

                                 undefined,undefined,undefined,undefined},

                             undefined,undefined,undefined,0},

                         {connection_state,

                             {security_parameters,undefined,0,undefined,

                                 undefined,undefined,undefined,undefined,

                                 undefined,undefined,undefined,undefined,

                                 undefined,undefined,


&lt;&lt;76,114,200,122,113,163,4,87,181,206,33,228,


217,189,66,80,91,54,17,1,216,163,45,205,102,

                                   27,203,158,65,229,96,147&gt;&gt;,

                                 undefined},

                             undefined,undefined,undefined,undefined},

                         {connection_state,

                             {security_parameters,undefined,0,0,0,undefined,


undefined,undefined,undefined,0,undefined,0,

                                 undefined,undefined,undefined,undefined},

                             undefined,undefined,undefined,0},

                         {connection_state,

                             {security_parameters,undefined,0,undefined,

                                 undefined,undefined,undefined,undefined,

                                 undefined,undefined,undefined,undefined,

                                 undefined,undefined,


&lt;&lt;76,114,200,122,113,163,4,87,181,206,33,228,


217,189,66,80,91,54,17,1,216,163,45,205,102,

                                   27,203,158,65,229,96,147&gt;&gt;,

                                 undefined},

                             undefined,undefined,undefined,undefined}},

                     &lt;&lt;&gt;&gt;,&lt;&lt;&gt;&gt;,


{{&lt;&lt;1,35,69,103,137,171,205,239,254,220,186,152,118,84,50,

                         16,0,0,0,0,0,0,0,0,97,98,98,105,116,109,113,95,115,


101,114,118,101,114,45,49,46,56,46,49,47,115,98,105,


110,47,46,46,47,101,98,105,110,47,115,115,108,95,104,


97,110,100,115,104,97,107,101,46,98,101,97,109,0,0,0,

                         0,0,0,0,0,49,0,0,0,0,0,0,0&gt;&gt;,

                       &lt;&lt;1,35,69,103,137,171,205,239,254,220,186,152,118,84,

                         50,16,240,225,210,195,0,0,0,0,0,0,0,0,48,46,55,47,


101,98,105,110,47,115,115,108,95,104,97,110,100,115,


104,97,107,101,46,98,101,97,109,97,107,101,46,98,153,


0,0,0,3,0,0,0,156,104,56,183,0,0,0,0,0,0,0,0,0,0,0,0,

                         0,0,0,0,0,0,0,0,0,0,0,0&gt;&gt;},


{&lt;&lt;1,35,69,103,137,171,205,239,254,220,186,152,118,84,50,

                         16,0,0,0,0,0,0,0,0,97,98,98,105,116,109,113,95,115,


101,114,118,101,114,45,49,46,56,46,49,47,115,98,105,


110,47,46,46,47,101,98,105,110,47,115,115,108,95,104,


97,110,100,115,104,97,107,101,46,98,101,97,109,0,0,0,

                         0,0,0,0,0,49,0,0,0,0,0,0,0&gt;&gt;,

                       &lt;&lt;1,35,69,103,137,171,205,239,254,220,186,152,118,84,

                         50,16,240,225,210,195,0,0,0,0,0,0,0,0,48,46,55,47,


101,98,105,110,47,115,115,108,95,104,97,110,100,115,

                         104,97,107,101,46,98,101,97,109,97,107,101,46,98,

                         153,0,0,0,3,0,0,0,156,104,56,183,0,0,0,0,0,0,0,0,0,

                         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0&gt;&gt;}},

                     [],


&lt;&lt;48,130,2,209,48,130,1,185,160,3,2,1,2,2,1,1,48,13,6,9,


42,134,72,134,247,13,1,1,5,5,0,48,22,49,20,48,18,6,3,85,


4,3,19,11,80,97,116,114,105,97,114,99,104,77,81,48,30,


23,13,49,48,48,56,50,51,49,55,53,50,50,56,90,23,13,49,


49,48,56,50,51,49,55,53,50,50,56,90,48,17,49,15,48,13,6,


3,85,4,3,19,6,117,98,117,110,116,117,48,130,1,34,48,13,


6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,


1,10,2,130,1,1,0,240,206,61,195,81,249,30,191,37,80,210,


97,45,52,21,235,156,125,76,104,74,32,39,190,81,131,140,


53,54,175,97,1,9,128,56,190,218,230,249,207,159,18,133,


83,145,66,0,97,124,232,160,11,249,209,23,61,8,95,8,33,


245,156,86,182,210,188,192,27,80,117,210,22,173,120,9,


106,96,0,6,206,76,151,170,59,241,226,148,132,207,167,95,


188,147,93,16,97,25,47,234,156,253,53,10,200,210,242,66,


239,60,34,255,187,237,10,68,27,113,6,193,167,59,32,213,


22,145,143,242,26,123,21,71,166,234,19,91,46,225,221,54,


233,199,14,174,245,55,173,48,218,79,52,38,73,42,93,70,


139,30,245,74,0,241,194,124,240,242,126,48,158,154,219,


135,44,39,254,90,42,38,179,250,11,104,51,110,30,35,14,


236,2,44,22,235,210,74,32,101,251,124,163,238,174,119,

                       125,145,184,92,191,171,76,165,32,30,22,213,97,11,134,


244,58,126,132,189,95,73,139,61,109,181,221,249,234,232,


220,14,118,14,199,17,156,136,161,28,5,150,96,16,83,11,


17,99,249,10,82,59,6,144,29,2,3,1,0,1,163,47,48,45,48,9,


6,3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,


48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,


13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,0,94,58,

                       169,57,227,155,93,3,38,59,200,79,56,104,214,5,211,33,


161,223,25,140,196,71,236,28,94,33,28,61,253,101,30,240,


161,177,217,18,52,196,217,247,167,230,122,90,77,184,58,


54,73,75,138,171,196,150,159,13,10,244,126,101,157,99,


30,161,56,69,0,159,214,217,6,60,217,186,253,189,37,107,


157,120,14,120,142,211,92,236,66,62,222,175,139,183,175,


183,244,95,24,46,191,235,134,208,179,138,67,1,117,238,


118,184,157,122,3,109,121,91,145,188,249,22,153,207,187,


51,185,228,131,18,121,185,232,40,51,46,47,240,113,223,


132,65,166,251,161,183,49,197,229,8,161,210,162,56,70,


177,2,55,137,68,156,246,194,13,37,102,190,212,91,64,245,


224,245,193,211,33,114,58,249,216,224,248,177,59,52,171,


234,94,235,145,154,189,220,221,216,114,110,59,62,7,113,

                       86,51,82,92,23,14,188,23,220,170,203,179,222,249,172,


172,53,80,33,113,48,110,17,231,18,107,40,134,80,59,227,


220,51,19,160,10,17,223,243,252,177,50,111,36,85,31,216,

                       239,69,57,41,248,16,155,230&gt;&gt;,

                     {session,undefined,undefined,undefined,undefined,

                         undefined,false,undefined},

                     143416,ssl_session_cache,undefined,undefined,false,

                     undefined,undefined,

                     {'RSAPrivateKey','two-prime',


30398894548410421145429503863141262794424948956980331525482246936698923945493304052034839119789003402128662978724398013149831739744571701598176856460306520767824104259514408250283911043782279373063969484605834921709214208612587276909566299321046864779542406219279789218623508096670096828074380473629160218113186622787723537092279159445817379513076561854396992128528895918242061646866646429621915320993554813978211567538416829402129313385939899845838282300263008183018421675819186452009553790489791666498892895752488841223943132536960611059968546332387113905936758131542047418381322919547853895110090268178995216814109,

                         65537,


20210577738732912250311340804809361162071560735974289412519835566563094345988285154268001436248935047950777473930443417137868205199360333583102094842432148601486669679655184037740063963862878631050296449078313612290978859234747590361225304698363580758567247871987716493490142893146000869628712116773269588531860908341493168497266906442321885515898434445130197299948246674007686696230057104952905643853071699676628178237289258631271288302406865959096315047458066090622897857576117174910893747661810297852718394850805367999588003104017411898288838853890622731631964394697537884326611820388152917699596495600193889685169,


179054234250895360208868484599140198401723455804053707464741994806412431405409304622807329906865989982021588267147308910141470689516351409253917903626138921640273527757280681594860864376999930099824366432907523084840885643395443547539152884598628614516227853353088712805742623001192712249408671311086599141447,


169774787374280770779066149172673101156163602152615726519303049607462237337000172660482791848674503292362270716756848525641876904749106722609903750688570413926737680514719703855084839715287341595671727627273611295510055591169382981580324505177869713458443375239988258382126728365756524656365624864100967156347,


52145034330417761645276163038576526644419089636024979182325491140503649324864458062329687025686929288750843548938363639760137168013627157132921511643933769602304965908959199977409928094044900832892074061041442018970553174387680784111757815515654145546130045761891010766596025185784581320356651977408163803861,


54219544680771114521657300489556250777400616339689750157148066409572983619381625856903807519306000486887442606492833661011100349671159859380583265970547610715879879353236849439048563334314418719157258636172493162870217793356045986305082501386587928997134745926315733828797662765999115935391191668914250615413,


149383369136315075137099878868863322421183694610764911283368726453550984587106254460395177686264404117511654210035460973354287280862647798049584797321416944299546978437856430847674270084226772637166060174983178495596302686112381529307249392410214651869398395853785925605752575147149686720932768370380284639697,

                         asn1_NOVALUE},

                     undefined,undefined,#Ref&lt;0.0.0.492&gt;,

                     {&lt;0.309.0&gt;,#Ref&lt;0.0.0.498&gt;},

                     0,&lt;&lt;&gt;&gt;,true}

** Reason for termination =

** {function_clause,[{ssl_record,mac_hash,

                                 [undefined,0,undefined,0,21,2,&lt;&lt;2,22&gt;&gt;]},

                     {ssl_record,hash_and_bump_seqno,5},

                     {ssl_record,cipher,4},

                     {ssl_record,encode_plain_text,4},

                     {ssl_connection,handle_own_alert,4},

                     {ssl_connection,handle_info,3},

                     {gen_fsm,handle_msg,7},

                     {proc_lib,init_p_do_apply,3}]}



=ERROR REPORT==== 23-Aug-2010::15:14:02 ===

error on TCP connection &lt;0.309.0&gt;:{ssl_upgrade_failure,

                                   {{function_clause,

                                     [{ssl_record,mac_hash,

                                       [undefined,0,undefined,0,21,2,

                                        &lt;&lt;2,22&gt;&gt;]},

                                      {ssl_record,hash_and_bump_seqno,5},

                                      {ssl_record,cipher,4},

                                      {ssl_record,encode_plain_text,4},

                                      {ssl_connection,handle_own_alert,4},

                                      {ssl_connection,handle_info,3},

                                      {gen_fsm,handle_msg,7},

                                      {proc_lib,init_p_do_apply,3}]},

                                    {gen_fsm,sync_send_all_state_event,

                                     [&lt;0.310.0&gt;,started,5000]}}}



=INFO REPORT==== 23-Aug-2010::15:14:02 ===

closing TCP connection &lt;0.309.0&gt;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100823/57887162/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100823/57887162/attachment-0001.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008550.html">[rabbitmq-discuss] Inconsistency in the Windows instructions/kit
</A></li>
	<LI>Next message: <A HREF="008543.html">[rabbitmq-discuss] Problems with SSL support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8542">[ date ]</a>
              <a href="thread.html#8542">[ thread ]</a>
              <a href="subject.html#8542">[ subject ]</a>
              <a href="author.html#8542">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
