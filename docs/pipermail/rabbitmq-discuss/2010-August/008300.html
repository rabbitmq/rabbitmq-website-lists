<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Exactly Once Delivery
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Exactly%20Once%20Delivery&In-Reply-To=%3C4C5C821C.6010308%40jboss.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008275.html">
   <LINK REL="Next"  HREF="008303.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Exactly Once Delivery</H1>
    <B>Tim Fox</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Exactly%20Once%20Delivery&In-Reply-To=%3C4C5C821C.6010308%40jboss.com%3E"
       TITLE="[rabbitmq-discuss] Exactly Once Delivery">tim.fox at jboss.com
       </A><BR>
    <I>Fri Aug  6 22:43:56 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008275.html">[rabbitmq-discuss] Exactly Once Delivery
</A></li>
        <LI>Next message: <A HREF="008303.html">[rabbitmq-discuss] Exactly Once Delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8300">[ date ]</a>
              <a href="thread.html#8300">[ thread ]</a>
              <a href="subject.html#8300">[ subject ]</a>
              <a href="author.html#8300">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/08/10 15:16, David Wragg wrote:
&gt;<i> Tony Garnock-Jones&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at rabbitmq.com</A>&gt;  writes:
</I>&gt;<i>    
</I>&gt;&gt;<i> John Apps wrote:
</I>&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i> The JMS standard offers guaranteed once
</I>&gt;&gt;&gt;<i>        
</I>&gt;&gt;<i> What exactly do they mean by that? In particular, how do they deal
</I>&gt;&gt;<i> with duplicates? Do they report failure, or silently let a dup through
</I>&gt;&gt;<i> in certain situations? If you could point me to the part of the spec
</I>&gt;&gt;<i> that sets out the JMS resolution of these issues, that's be really
</I>&gt;&gt;<i> useful.
</I>&gt;&gt;<i>      
</I>&gt;<i> As an API spec, it's quite easy for JMS to mandate something apparently
</I>&gt;<i> impossible, without hinting at how it might actually be implemented.
</I>&gt;<i>
</I>&gt;<i> Most of the spec says that the PERSISTENT delivery mode gives
</I>&gt;<i> &quot;once-and-only-once&quot; delivery.  But section 4.4.13 (of JMS 1.1) admits
</I>&gt;<i> that there are a number of caveats to this.  So it's really
</I>&gt;<i> &quot;once-and-only-once-except-in-some-corner-cases&quot;.
</I>&gt;<i>
</I>&gt;<i> I think the wrinkle that might prevent us saying that RabbitMQ gives the
</I>&gt;<i> same guarantees is on the publishing side.  The caveats in JMS all seems
</I>&gt;<i> to apply only to the consuming side.  But what happens with an AMQP
</I>&gt;<i> producer if the connection gets dropped before a tx.commit-ok gets back
</I>&gt;<i> to the client?  In that case the client has to re-publish, leading to a
</I>&gt;<i> potential dup.  This can be avoided by a de-dup filter on published
</I>&gt;<i> messages in the broker.  I don't know if JMS brokers really go to such
</I>&gt;<i> lengths.
</I>&gt;<i>    
</I>Some do. It's fairly common for JMS brokers to implement duplicate 
detection on the server side, to get around the &quot;lost commit-ok problem&quot; 
and give us near as possible once and only once, from the publisher to 
the server at least.

The way we do it in HornetQ is we have a well defined header key 
&quot;_HQ_DUP_ID&quot;. The client can set this with some unique value of it's 
choice before sending (e.g. a GUID). When the server receives the 
message if the _HQ_DUP_ID header is set, it looks up the value in it's 
cache, and if it's seen it before it ignores it. The cache can 
optionally be persisted.

On the client side, the producer can resend the message/transaction if 
it does not receive a confirmation-ok, so it effectively makes 
sends/commits idempotent.
David
&gt;<i>    
</I>

-- 
Sent from my BBC Micro Model B

Tim Fox
JBoss

HornetQ - putting the buzz in messaging <A HREF="http://hornetq.org">http://hornetq.org</A>
<A HREF="http://hornetq.blogspot.com/">http://hornetq.blogspot.com/</A>
<A HREF="http://twitter.com/hornetq">http://twitter.com/hornetq</A>
<A HREF="irc://irc.freenode.net:6667#hornetq">irc://irc.freenode.net:6667#hornetq</A>	
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">fox at redhat.com</A>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008275.html">[rabbitmq-discuss] Exactly Once Delivery
</A></li>
	<LI>Next message: <A HREF="008303.html">[rabbitmq-discuss] Exactly Once Delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8300">[ date ]</a>
              <a href="thread.html#8300">[ thread ]</a>
              <a href="subject.html#8300">[ subject ]</a>
              <a href="author.html#8300">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
