<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Node scheduling with RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Node%20scheduling%20with%20RabbitMQ&In-Reply-To=%3CAANLkTimw62J8_CoDdA0pwWAp-Sw-AwMQq-N8z_M7OUF0%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008321.html">
   <LINK REL="Next"  HREF="008304.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Node scheduling with RabbitMQ</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Node%20scheduling%20with%20RabbitMQ&In-Reply-To=%3CAANLkTimw62J8_CoDdA0pwWAp-Sw-AwMQq-N8z_M7OUF0%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Node scheduling with RabbitMQ">majek04 at gmail.com
       </A><BR>
    <I>Wed Aug 11 17:11:29 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008321.html">[rabbitmq-discuss] Node scheduling with RabbitMQ
</A></li>
        <LI>Next message: <A HREF="008304.html">[rabbitmq-discuss] rabbit_binary_parser:ensure_content_decoded/2 - why /2 rather than /1?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8373">[ date ]</a>
              <a href="thread.html#8373">[ thread ]</a>
              <a href="subject.html#8373">[ subject ]</a>
              <a href="author.html#8373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Pete,

On Mon, Aug 9, 2010 at 03:55, Pete Hunt &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">floydophone at gmail.com</A>&gt; wrote:
&gt;<i> I was considering writing an x-script exchange for RabbitMQ and
</I>&gt;<i> creating one queue per worker to dump messages in; this is a feasible
</I>&gt;<i> way to go, right?
</I>
Well, the question about data locality is pretty tricky to answer.
First. If you have fixed number of workers, than you can just create
two queues for every worker. One queue with requests for 'data to be
prefetched',
another one with real task requests.

But it's more common that you don't know in advance how many workers
will be needed. In such case, I'm sorry, but if doing a task requires
downloading data, than well, it requires downloading data.
If a task is two-stage, and I'm afraid you can't do much
about it. Maybe running more than one worker on a single host, to make
sure that CPU is always saturated, even if another task is busy with
downloading?

&gt;<i> The exchange could probably handle data locality,
</I>&gt;<i> however, what happens when a worker dies with messages sitting on the
</I>&gt;<i> queue?
</I>
In AMQP every message needs to be acknowledged before it's removed from
the server. If your worker received a message, and died without acking it,
the message will simply be redelivered to another worker.

&gt;<i> I also am relatively new to the non-Amazon SQS message queuing world,
</I>&gt;<i> so I guess that this becomes less a question of how to do proper data
</I>&gt;<i> locality and more about how to do reliability with RabbitMQ. On SQS,
</I>&gt;<i> due to the visibility timeout semantics I am assured that if I design
</I>&gt;<i> idempotent tasks they will eventually occur even if there is a node
</I>&gt;<i> failure.
</I>
Yes, instead of timeouts AMQP/RabbitMQ uses explicit acknowledgments.

&gt;<i> Right now, the solution that makes the most sense to me is to have a
</I>&gt;<i> single consumer that farms the tasks out to the worker nodes, however,
</I>&gt;<i> this means that I need to build reliability capabilities like
</I>&gt;<i> visibility timeouts into the consumer rather than relying on a battle
</I>&gt;<i> tested piece of software like RabbitMQ. Is there some sort of
</I>&gt;<i> functionality in RabbitMQ that accounts for this? Am I missing an
</I>&gt;<i> important piece of documentation somewhere?
</I>
Look at the basic.consume examples, see how the acknowledgments are done.
For example:
<A HREF="http://github.com/tonyg/pika/blob/master/examples/demo_receive.py#L74">http://github.com/tonyg/pika/blob/master/examples/demo_receive.py#L74</A>

You also will be interested in the 'qos' command. For example
<A HREF="http://github.com/majek/pika/blob/master/examples/demo_channel_flow_asyncore.py#L55">http://github.com/majek/pika/blob/master/examples/demo_channel_flow_asyncore.py#L55</A>

Cheers,
   Marek
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008321.html">[rabbitmq-discuss] Node scheduling with RabbitMQ
</A></li>
	<LI>Next message: <A HREF="008304.html">[rabbitmq-discuss] rabbit_binary_parser:ensure_content_decoded/2 - why /2 rather than /1?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8373">[ date ]</a>
              <a href="thread.html#8373">[ thread ]</a>
              <a href="subject.html#8373">[ subject ]</a>
              <a href="author.html#8373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
