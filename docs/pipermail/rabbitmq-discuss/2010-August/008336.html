<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] New user : Help needed in understanding memory	usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20user%20%3A%20Help%20needed%20in%20understanding%20memory%0A%09usage&In-Reply-To=%3C5384000.161281398354503.JavaMail.avanti%40angrystood-lm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008335.html">
   <LINK REL="Next"  HREF="008338.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] New user : Help needed in understanding memory	usage</H1>
    <B>Avanti Nadgir</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20user%20%3A%20Help%20needed%20in%20understanding%20memory%0A%09usage&In-Reply-To=%3C5384000.161281398354503.JavaMail.avanti%40angrystood-lm%3E"
       TITLE="[rabbitmq-discuss] New user : Help needed in understanding memory	usage">avanti at yahoo-inc.com
       </A><BR>
    <I>Tue Aug 10 00:59:15 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008335.html">[rabbitmq-discuss] To declare a MQ listener at java application	startup
</A></li>
        <LI>Next message: <A HREF="008338.html">[rabbitmq-discuss] New user : Help needed in understanding memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8336">[ date ]</a>
              <a href="thread.html#8336">[ thread ]</a>
              <a href="subject.html#8336">[ subject ]</a>
              <a href="author.html#8336">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am experimenting with RabbitMQ on a rhel vm (ver 1.8.1)
Have started the broker and am able to publish and consume events till the resident memory usage of the broker peaks at about 400M (it keeps growing with the number of messages published even though the consumer is consuming events) After this the broker needs to be restarted to bring back the memory usage to 0 before more messages can be sent.

Attached is the code snippet of the publisher and consumer.  
=================================================================
Publisher :
                factory.setHost(&quot;localhost&quot;);
                factory.setPort(5672);
                Connection conn = factory.newConnection();

                Channel channel = conn.createChannel();

                System.out.println(&quot;done creating conn&quot;);
                String exchangeName = &quot;testExchange&quot;;
                String queueName = &quot;testQueueNew&quot;;
                String routingKey = &quot;&quot;;
                channel.exchangeDeclare(exchangeName, &quot;direct&quot;, true);
                channel.queueDeclare(queueName, true, false, true, null);
                channel.queueBind(queueName, exchangeName, routingKey);

                byte[] messageBodyBytes = new byte[2000];
                for(int j = 0;j&lt;2000;j++) {
                        messageBodyBytes[j] = 'A';
                }
                for(int i = 0; i &lt; numMessages; i++) {
                        channel.basicPublish(exchangeName, routingKey, null, messageBodyBytes);
                        if(sleepInterval != 0) {
                                if (i % sleepInterval == 0) {
                                        Thread.sleep(timeToSleep);
                                        System.out.println(&quot;Published Message &quot; + i);
                                }
                        }
                }

                channel.close();
                conn.close();
==================================================================
Consumer :
                ConnectionFactory factory = new ConnectionFactory();
                factory.setHost(&quot;localhost&quot;);
                factory.setPort(5672);
                Connection conn = factory.newConnection();
                Channel channel = conn.createChannel();

                String exchangeName = &quot;testExchange&quot;;
                String routingKey = &quot;&quot;;
                String queueName = &quot;testQueue&quot;;
                channel.exchangeDeclare(exchangeName, &quot;direct&quot;, true);
                channel.queueBind(queueName, exchangeName, routingKey);

                boolean noAck = false;
                QueueingConsumer consumer = new QueueingConsumer(channel);
                channel.basicConsume(queueName, noAck, consumer);
                int count = 0;
                while (count &lt; numMessages) {
                    count++;
                    QueueingConsumer.Delivery delivery;
                    try {
                        delivery = consumer.nextDelivery();
                    } catch (InterruptedException ie) {
                        continue;
                    }
                    // (process the message components ...)

                        byte[] body = delivery.getBody();
                        String resp = new String(body);
                        channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                }

                channel.close();
                conn.close();

===================================================================================
Any help is appreciated.

Thanks,
Avanti
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008335.html">[rabbitmq-discuss] To declare a MQ listener at java application	startup
</A></li>
	<LI>Next message: <A HREF="008338.html">[rabbitmq-discuss] New user : Help needed in understanding memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8336">[ date ]</a>
              <a href="thread.html#8336">[ thread ]</a>
              <a href="subject.html#8336">[ subject ]</a>
              <a href="author.html#8336">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
