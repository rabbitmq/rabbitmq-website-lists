<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ - live upgrade
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20-%20live%20upgrade&In-Reply-To=%3C20100811141112.GU29106%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008366.html">
   <LINK REL="Next"  HREF="008388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ - live upgrade</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20-%20live%20upgrade&In-Reply-To=%3C20100811141112.GU29106%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ - live upgrade">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Aug 11 15:11:13 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008366.html">[rabbitmq-discuss] RabbitMQ - live upgrade
</A></li>
        <LI>Next message: <A HREF="008388.html">[rabbitmq-discuss] RabbitMQ - live upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8367">[ date ]</a>
              <a href="thread.html#8367">[ thread ]</a>
              <a href="subject.html#8367">[ subject ]</a>
              <a href="author.html#8367">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Dave,

On Wed, Aug 11, 2010 at 10:01:20AM -0400, Dave Greggory wrote:
&gt;<i> We have two nodes in the cluster and they can talk to each other
</I>&gt;<i> directly (obviously). They're both 1.8.1 and say we want to upgrade
</I>&gt;<i> them one at a time to 1.new version without affecting clients. If we
</I>&gt;<i> take down 1 node out of the load balancer then clients will connect to
</I>&gt;<i> the other node when they detect the connection loss. Now we can
</I>&gt;<i> shutdown this first node and upgrade it.
</I>
That would work, but obviously any queues that are declared on the node
that is now down will be unavailable.

&gt;<i> Will we lose any of the persisted messages in the downed node due to
</I>&gt;<i> the new persister and/or mnesia differences?
</I>
Yes. You will lose all persisted messages. And all declared queues,
exchanges, bindings, vhosts and users.

&gt;<i> when we bring up the newly upgraded node, it will attempt to cluster
</I>&gt;<i> itself with the still up second node with old version? Can only very
</I>&gt;<i> bad things happen in this situation?
</I>
Hmmm, I'm not sure if it will try to recluster. If it does, it'll
certainly fail. You can not cluster between rabbit with different
versions of rabbit (well, actually, you probably can sometimes, but the
outcome is undefined at best). Don't do this.

&gt;<i> Other than being very quick on the trigger finger and downing the
</I>&gt;<i> second node as we're bringing up the first node, are there any other
</I>&gt;<i> solutions?
</I>
Yes, build a new cluster, then switch your producers over to the new
cluster (where they must create new queues, exchanges etc etc). Have
your consumers continue to drain the old cluster, and then when the old
cluster is empty, switch the consumers to the new cluster.

&gt;<i> Or will the new version just not work without having to upgrade client
</I>&gt;<i> API (java) and restsrting clients?
</I>
There is no requirement to touch your clients. The on-the-wire AMQP
protocol has not changed. There have been changes and likely
improvements to the clients but I don't believe there should be any
problems with 1.8.1 clients connecting to the next released version of
the RabbitMQ broker.

Matthew
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008366.html">[rabbitmq-discuss] RabbitMQ - live upgrade
</A></li>
	<LI>Next message: <A HREF="008388.html">[rabbitmq-discuss] RabbitMQ - live upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8367">[ date ]</a>
              <a href="thread.html#8367">[ thread ]</a>
              <a href="subject.html#8367">[ subject ]</a>
              <a href="author.html#8367">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
