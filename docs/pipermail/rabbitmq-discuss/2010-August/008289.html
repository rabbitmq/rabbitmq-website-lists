<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Disk node vs ram node
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Disk%20node%20vs%20ram%20node&In-Reply-To=%3C20100805213800.GB3413%40dakota%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008287.html">
   <LINK REL="Next"  HREF="008290.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Disk node vs ram node</H1>
    <B>Alexandru Scvortov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Disk%20node%20vs%20ram%20node&In-Reply-To=%3C20100805213800.GB3413%40dakota%3E"
       TITLE="[rabbitmq-discuss] Disk node vs ram node">alexandru at rabbitmq.com
       </A><BR>
    <I>Thu Aug  5 22:38:00 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008287.html">[rabbitmq-discuss] Disk node vs ram node
</A></li>
        <LI>Next message: <A HREF="008290.html">[rabbitmq-discuss] Disk node vs ram node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8289">[ date ]</a>
              <a href="thread.html#8289">[ thread ]</a>
              <a href="subject.html#8289">[ subject ]</a>
              <a href="author.html#8289">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Aug 05, 2010 at 01:49:51PM -0700, Vince Chang wrote:
&gt;<i> 1. So if I start node A by itself, and then cluster B against A, then A becomes a disk node because I specified A in the rabbitmqctl command? Here are the steps
</I>&gt;<i> 
</I>&gt;<i> Node1: 
</I>&gt;<i> start_app
</I>&gt;<i> add_vhost host1
</I>&gt;<i> add_user user pass
</I>&gt;<i> 
</I>&gt;<i> Node2:
</I>&gt;<i> stop_app
</I>&gt;<i> reset
</I>&gt;<i> cluster node1 &lt;--- (is this the step that makes node A a disk node?)
</I>&gt;<i> start_app
</I>&gt;<i> 
</I>&gt;<i> Node3:
</I>&gt;<i> stop_app
</I>&gt;<i> reset
</I>&gt;<i> cluster node1 
</I>&gt;<i> start_app
</I>
I've just tried that on default.

All the nodes start up as disc nodes.  At that point, you turn *Node2*
into a ram node.  In the third group of commands, you also turn *Node3*
into a ram node.

So, the sequence is:
1. Start Node1 as a disc node
2. Cluster Node2 with Node1; Node2 becomes a ram node
3. Cluster Node3 with Node1; Node3 becomes a ram node
At the end, Node1 is disc; Node2 and Node3 are ram

&gt;<i> 2. To be clear, if I send a message that creates the queue Q1 in node A in a cluster with node A, node B, and node C and node A goes down, then I will lose those messages on node A. Node A is down, but B and C should still be alive. If I send the same message to be queued on Q1, will Q1 be created on node B and node C? For me so far, that is not the case. When I send a message to be queued on Q1 (where the messages on Q1 on node A are now lost because node A is down) I do not see the queue getting created on either node B or node C. Is there something wrong with my steps?
</I>
I'm not quite sure what you mean by ``message that creates the queue''.

If you declare a queue Q1 on node A with queue.declare, then Q1 will
reside on node A.  If node A goes down, all the messages on its queues
(including Q1) will become inaccessible.  If Q1 was declared as durable,
then the messages published as persistent on it will become available
when node A comes back online.

In a cluster, when a node goes down, its queues become inaccesbile.
They are *not* automatically created on other nodes.

Incidentally, which client are you using?

&gt;<i> 3. I am using RabbitMQ 1.7.2. Just to be clear there is _no way_ on 1.7.2 to determine whether or not a node is a disk node or ram node? 
</I>
There's no way to do it with the provided tools.

If you're not squeamish about running a bit of Erlang, you could do
this:

% erl -sname mgmtsh -remsh <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>

This gives you a remote Erlang shell named mgmtsh, connected to
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>

Then, running this should give you the disc nodes:
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>)1&gt; mnesia:table_info(rabbit_durable_exchange, disc_copies).

And running this should give you the ram nodes:
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>)2&gt; mnesia:table_info(rabbit_durable_exchange, ram_copies).


Cheers,
Alex



</PRE>














































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008287.html">[rabbitmq-discuss] Disk node vs ram node
</A></li>
	<LI>Next message: <A HREF="008290.html">[rabbitmq-discuss] Disk node vs ram node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8289">[ date ]</a>
              <a href="thread.html#8289">[ thread ]</a>
              <a href="subject.html#8289">[ subject ]</a>
              <a href="author.html#8289">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
