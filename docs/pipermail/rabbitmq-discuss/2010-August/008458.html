<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] problem with new persiter with 1000	topics/queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20problem%20with%20new%20persiter%20with%201000%0A%09topics/queues&In-Reply-To=%3C597082.60604.qm%40web31809.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008453.html">
   <LINK REL="Next"  HREF="008459.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] problem with new persiter with 1000	topics/queues</H1>
    <B>alex chen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20problem%20with%20new%20persiter%20with%201000%0A%09topics/queues&In-Reply-To=%3C597082.60604.qm%40web31809.mail.mud.yahoo.com%3E"
       TITLE="[rabbitmq-discuss] problem with new persiter with 1000	topics/queues">chen650 at yahoo.com
       </A><BR>
    <I>Tue Aug 17 08:21:41 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008453.html">[rabbitmq-discuss] problem with new persiter with 1000	topics/queues
</A></li>
        <LI>Next message: <A HREF="008459.html">[rabbitmq-discuss] Authenticate client using certificate only
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8458">[ date ]</a>
              <a href="thread.html#8458">[ thread ]</a>
              <a href="subject.html#8458">[ subject ]</a>
              <a href="author.html#8458">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthew,

Thanks to the fix you put in to the default branch, our test showed that it was 
able  to consume 10 GB of messages without any errors.

however, there is unexpected memory usage when consuming from 200 GB of backed 
up data.
first, when i tried to publish to 1000 topics/queues, when the queue size 
reached 100 GB, the memory usage would grow to 4GB.  our system has 8 GB of 
RAM.  with the default high watermark of 0.4, the broker started to throttle the 
publisher.  the publish rate would drop from 80 MB/sec to 10 MB/sec.  when queue 
size reached 200 GB, i started the consumer,  then the memory usage would grow 
to 10 GB.  the system started swapping and the consume rate dropped from 30 
MB/sec to &lt; 10 MB/sec.

later i tried to increase the high watermark to 0.7.  the max mem usage for 
broker reached around 6.6 GB while publishing to 200 GB.  for some reason the 
throttling did not occur, so the publish rate maintained at 80 MB/sec.  however, 
when starting to consume the messages from 200 GB, the mem usage would still 
reach 10 GB.  the system started swapping, the consume rate dropped from 30 
MB/sec to 20 MB/sec.  it is better than the 0.4 watermark case.

these tests were run with 1000 topics/queues.  if i decrease the topics to 100,. 
the broker's mem usage would remain below 3GB, even when the data size reached 
200 GB.

any idea on how to decrease the usage of broker for the 1000 topics case?  i am 
not sure if it is caused by a bug, or it is something that cannot be avoided.
thanks.

-alex




----- Original Message ----
&gt;<i> From: alex chen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">chen650 at yahoo.com</A>&gt;
</I>&gt;<i> To: Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;; 
</I><A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
&gt;<i> Sent: Mon, August 16, 2010 10:42:21 AM
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] problem with new persiter with 1000 
</I>&gt;<i>topics/queues
</I>&gt;<i> 
</I>&gt;<i> Matthew and Matthias,
</I>&gt;<i> 
</I>&gt;<i> Thanks a lot for fixing it so quickly!   It is  greatly appreciated!
</I>&gt;<i> I will run some tests today using the default  branch.  will let you know the 
</I>&gt;<i> results  asap.
</I>&gt;<i> 
</I>&gt;<i> -alex
</I>

      
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008453.html">[rabbitmq-discuss] problem with new persiter with 1000	topics/queues
</A></li>
	<LI>Next message: <A HREF="008459.html">[rabbitmq-discuss] Authenticate client using certificate only
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8458">[ date ]</a>
              <a href="thread.html#8458">[ thread ]</a>
              <a href="subject.html#8458">[ subject ]</a>
              <a href="author.html#8458">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
