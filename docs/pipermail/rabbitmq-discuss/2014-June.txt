From stammailbox at gmail.com  Sun Jun  1 14:31:56 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 1 Jun 2014 16:31:56 +0300
Subject: [rabbitmq-discuss] Is it possible to get a "push" when number of
	messages reaches threshold?
Message-ID: <CAJ2-Vr=tHcgicFvmCN1PPfG2Qkcpbd8s7S7OUtdFctVFpuvxOA@mail.gmail.com>

Hi,

I want to check

1. What is the best practice to get the number of messages in a queue.
    I know I can get it via queue.getMessageCount()
    I also know that you can get it as the monitor plugin gets it. is it an
http request? or with the rabbitmqctl application.(JNI?) ?
    What is the best way if I want to react only when X messages arrive?
2. And more important - can I get the number of messages in a queue via
push?

Can I declare a threshold to receive a push notification (e.g. get a signal
every time I have 5000 messages)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140601/a761bc41/attachment.html>

From mklishin at gopivotal.com  Sun Jun  1 14:37:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 1 Jun 2014 17:37:22 +0400
Subject: [rabbitmq-discuss] Is it possible to get a "push" when number
 of messages reaches threshold?
In-Reply-To: <CAJ2-Vr=tHcgicFvmCN1PPfG2Qkcpbd8s7S7OUtdFctVFpuvxOA@mail.gmail.com>
References: <CAJ2-Vr=tHcgicFvmCN1PPfG2Qkcpbd8s7S7OUtdFctVFpuvxOA@mail.gmail.com>
Message-ID: <etPan.538b2cac.6b8b4567.82c0@mercurio.local>

On 1 June 2014 at 17:34:11, rails (stammailbox at gmail.com) wrote:
> > 1. What is the best practice to get the number of messages in a  
> queue.
> I know I can get it via queue.getMessageCount()

Do a queue.declare (possibly with passive = true), check # of messages ready from
queue.declare-ok. You can also query queue stats using HTTP API.

> What is the best way if I want to react only when X messages arrive??

Add a consumer and process deliveries in batches ?in your own code.

> 2. And more important - can I get the number of messages in a queue  
> via push?

There is no such feature in RabbitMQ. You have to periodically check the counter.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From videlalvaro at gmail.com  Sun Jun  1 16:18:19 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 1 Jun 2014 17:18:19 +0200
Subject: [rabbitmq-discuss] Is it possible to get a "push" when number
 of messages reaches threshold?
In-Reply-To: <etPan.538b2cac.6b8b4567.82c0@mercurio.local>
References: <CAJ2-Vr=tHcgicFvmCN1PPfG2Qkcpbd8s7S7OUtdFctVFpuvxOA@mail.gmail.com>
 <etPan.538b2cac.6b8b4567.82c0@mercurio.local>
Message-ID: <CAMcAHLU6=2K2KG=JUD7wAM+igqSVchZ17UfCR6qLucUmypuS_w@mail.gmail.com>

Hi,

I'd guess this could be attempted using queue length:
http://www.rabbitmq.com/maxlength.html and setting up a separate dead
letter queue for that 5000th message.

Regards,

Alvaro


On Sun, Jun 1, 2014 at 3:37 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 1 June 2014 at 17:34:11, rails (stammailbox at gmail.com) wrote:
> > > 1. What is the best practice to get the number of messages in a
> > queue.
> > I know I can get it via queue.getMessageCount()
>
> Do a queue.declare (possibly with passive = true), check # of messages
> ready from
> queue.declare-ok. You can also query queue stats using HTTP API.
>
> > What is the best way if I want to react only when X messages arrive?
>
> Add a consumer and process deliveries in batches  in your own code.
>
> > 2. And more important - can I get the number of messages in a queue
> > via push?
>
> There is no such feature in RabbitMQ. You have to periodically check the
> counter.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140601/600741f8/attachment.html>

From taomailings at gmail.com  Sun Jun  1 00:40:28 2014
From: taomailings at gmail.com (Mazzaroth M.)
Date: Sat, 31 May 2014 16:40:28 -0700 (PDT)
Subject: [rabbitmq-discuss] pika.exceptions.ConnectionClosed
Message-ID: <993b658f-18a4-415e-a792-26a10e802e63@googlegroups.com>

Hi, very new to pika and rabbitmq. The moment I add some sort of work to 
the basic consumption callback, I get a pika.exceptions.ConnectionClosed. 
Any ideas? Code and log at http://pastebin.com/M90Q6me1 

pika 0.9.13 and python 2.7.5 on mac os x mountain lion.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140531/359e3c34/attachment.html>

From neeraj at rockonllc.com  Mon Jun  2 06:13:13 2014
From: neeraj at rockonllc.com (Neeraj.Chaudhary)
Date: Sun, 1 Jun 2014 22:13:13 -0700
Subject: [rabbitmq-discuss] Revert RabbitMq from 3.3.0 to 3.2.4
Message-ID: <003601cf7e21$5b42f8d0$11c8ea70$@rockonllc.com>

Hi,

 

My production server is running on 3.2.4 and is working great, I created
another server for testing and by default it has 3.3.0. 

I am unable to get stomp configured on port 15675 for SSL on 3.3.0. It's
been 2 days and I tried all the possible options mentioned on various
forums.

To validate and map what's going wrong in 3.3.0 I would like to revert
rabbitmq to 3.2.4 and see if same configuration works there or not. Can
someone guide me how can I revert to 3.2.4?

Thanking you all.

 

Regards,

Neeraj Chaudhary

+1 925 359 9074

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140601/d52f302c/attachment.html>

From srinatsr at cisco.com  Mon Jun  2 07:07:35 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Mon, 2 Jun 2014 06:07:35 +0000
Subject: [rabbitmq-discuss] Debug Logging in catalina.out
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB1E270@xmb-aln-x10.cisco.com>

Hello,

I don't want the following logs to be logged in catalina.out.

2014-06-02 02:06:16,170|DEBUG|T:SimpleAsyncTaskExecutor-1|org.springframework.amqp.rabbit.listener.BlockingQueueConsumer|Retrieving delivery for Consumer: tags=[[amq.ctag-Z0IyGvXnd8FI4ISm7EHhaQ]], channel=Cached Rabbit Channel: AMQChannel(amqp://guest at 64.102.209.136:5672/,1), acknowledgeMode=AUTO local queue size=0

It keeps on logging for every sec.

How to change this?

Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/838e592d/attachment.html>

From Dinesh.Hirani at decuragroup.com  Mon Jun  2 10:04:35 2014
From: Dinesh.Hirani at decuragroup.com (Dinesh Hirani)
Date: Mon, 2 Jun 2014 09:04:35 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config
Message-ID: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>

Hi Support,

I've just testing the upgrade to 3.3.1 which has a breaking change of 'guest' user can only connect via localhost.

I created rabbitmq.config
%% -*- mode: erlang -*-
%% ----------------------------------------------------------------------------
%% RabbitMQ Sample Configuration File.
%%
%% See http://www.rabbitmq.com/configure.html for details.
%% ----------------------------------------------------------------------------
[
                {rabbit, [{loopback_users, []}]}
].

I've put the file in location C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\etc

I added system environment variable.
RABBITMQ_CONFIG_FILE
C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\etc\rabbitmq
I understand that I have to remove .config
https://www.rabbitmq.com/relocate.html

I then restarted the rabbit service.

I still cannot login as guest on a remote computer.

What am I doing wrong?

Regards,
Dinesh Hirani
Technical Architect

D:  +44 (0) 20 3480 6572
O:  +44 (0) 20 3480 6500
A:  11-12 St James's Square, London, UK, SW1Y 4LB
E:   dinesh.hirani at decuragroup.com<mailto:dinesh.hirani at decuragroup.com>
W: www.decuragroup.com<http://www.decuragroup.com>
[cid:image001.gif at 01CF7E46.ED06A580]


The information in this e-mail is confidential and may be legally privileged. It is intended solely for the addressee(s). Access by any other person to this e-mail is not authorized. If you are not the intended recipient, please delete this e-mail. Any disclosure of this e-mail or of the parties to it and any copying or distribution of it is prohibited (and may be unlawful). The information expressed herein may be changed at any time without notice or obligation to update. We do not represent that this message is virus-free, complete or accurate and it should not be relied upon as such. Electronic communications may be monitored for operational and business purposes to the extent permitted by applicable law. This email does not constitute legal or tax advice, and the information contained in this communication should not be regarded as such.


Decura IM LLP is authorised and regulated by the Financial Conduct Authority. Registered office address: 11-12 St James's Square, London SW1Y 4LB. Registered in England and Wales: OC375344

 

Decura LLP is authorised and regulated by the Financial Conduct Authority. Registered office address: 11-12 St James's Square, London SW1Y 4LB. Registered in England and Wales: OC377231
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/b6327335/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 2374 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/b6327335/attachment.gif>

From simon at rabbitmq.com  Mon Jun  2 10:30:47 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Jun 2014 10:30:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config
In-Reply-To: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>
References: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>
Message-ID: <538C4447.7040404@rabbitmq.com>

On 02/06/2014 10:04AM, Dinesh Hirani wrote:
> I?ve put the file in location C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-3.3.1\etc

That's not the right location. The example configuration file will be 
removed from there in a future release, it's too confusing.

You need %APPDATA%\RabbitMQ\rabbitmq.config. Typically this will expand 
to something like 
c:\Users\<Username>\AppData\Roaming\RabbitMQ\rabbitmq.config

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun  2 10:40:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Jun 2014 10:40:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config
In-Reply-To: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>
References: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>
Message-ID: <538C4688.3010605@rabbitmq.com>

On 02/06/2014 10:04AM, Dinesh Hirani wrote:
> I added system environment variable.
>
> RABBITMQ_CONFIG_FILE

Sorry, didn't see this. Note that after changing locations with 
environment variables on Windows you need to *reinstall* the service 
(with the rabbitmq-service.bat batch file), not just restart it.

Also: you can check the logs to see where RabbitMQ is looking for the 
config.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun  2 10:40:46 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Jun 2014 10:40:46 +0100
Subject: [rabbitmq-discuss] Revert RabbitMq from 3.3.0 to 3.2.4
In-Reply-To: <003601cf7e21$5b42f8d0$11c8ea70$@rockonllc.com>
References: <003601cf7e21$5b42f8d0$11c8ea70$@rockonllc.com>
Message-ID: <538C469E.6060701@rabbitmq.com>

On 02/06/2014 6:13AM, Neeraj.Chaudhary wrote:
> To validate and map what?s going wrong in 3.3.0 I would like to revert
> rabbitmq to 3.2.4 and see if same configuration works there or not. Can
> someone guide me how can I revert to 3.2.4?

RabbitMQ doesn't support version downgrades while keeping persistent 
storage. I'm assuming since this is a testing server that's not a big deal.

So you need to downgrade your installation (obviously how you do this 
depends on how you installed it) and then delete the database base 
directory (again depends how you installed it, typically 
/var/lib/rabbitmq/mnesia on Unix but look at 
http://www.rabbitmq.com/relocate.html).

Alternatively (if you're on Unix and have installed through RPMs / debs) 
it might be easier to stop the 3.3.0 server, download the generic Unix 
tarball for 3.2.4 and unpack and run it from your home directory.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun  2 10:48:55 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Jun 2014 10:48:55 +0100
Subject: [rabbitmq-discuss] rabbitmq erlang amqp_client question.
In-Reply-To: <DF4A5C62-2512-4BFE-ACA2-3489A52787D4@gmail.com>
References: <DF4A5C62-2512-4BFE-ACA2-3489A52787D4@gmail.com>
Message-ID: <538C4887.6030707@rabbitmq.com>

On 30/05/2014 5:34AM, ale wrote:
> Hi,
>
> I?m implementing a basic consumer in erlang using the
> amqp_gen_consumer behavior from the official amqp_client.

Is there a reason you're implementing amqp_gen_consumer yourself? 
Normally you would use amqp_selective_consumer or amqp_direct_consumer 
rather than implementing your own.

If you do want your own consumer implementation, you need to configure 
it by opening the channel with amqp_connection:open_channel/2 not /1:

{ok, Channel} = amqp_connection:open_channel(
                     Connection, {my_consumer_module, ConsumerArgs})

> All that is working fine but hen I publish messages to the queue I
> would expect to receive messages via the [handle_deliver] callback
> but instead I?m receiving messages trough [handle_info].

That's the default amqp_direct_consumer behaviour you're seeing.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Dinesh.Hirani at decuragroup.com  Mon Jun  2 10:59:21 2014
From: Dinesh.Hirani at decuragroup.com (Dinesh Hirani)
Date: Mon, 2 Jun 2014 09:59:21 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config
In-Reply-To: <538C4688.3010605@rabbitmq.com>
References: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>
 <538C4688.3010605@rabbitmq.com>
Message-ID: <E75DB63556459344A03DD1B8FDE21D2E2F2697D3@PDC1INXCH01S.decura.decuragroup.com>

Ran rabbitmq-service.bat

It says the following in the log file
config file(s) : c:/Program Files (x86)/RabbitMQ Server/rabbitmq_server-3.3.1/etc/rabbitmq.config (not found)

File does exist.
Directory of C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\etc

02/06/2014  09:26    <DIR>          .
02/06/2014  09:26    <DIR>          ..
02/06/2014  09:23               331 rabbitmq.config
29/04/2014  13:24            18,804 rabbitmq.config.example

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 02 June 2014 10:40
To: Discussions about RabbitMQ; Dinesh Hirani
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config

On 02/06/2014 10:04AM, Dinesh Hirani wrote:
> I added system environment variable.
>
> RABBITMQ_CONFIG_FILE

Sorry, didn't see this. Note that after changing locations with environment variables on Windows you need to *reinstall* the service (with the rabbitmq-service.bat batch file), not just restart it.

Also: you can check the logs to see where RabbitMQ is looking for the config.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal


The information in this e-mail is confidential and may be legally privileged. It is intended solely for the addressee(s). Access by any other person to this e-mail is not authorized. If you are not the intended recipient, please delete this e-mail. Any disclosure of this e-mail or of the parties to it and any copying or distribution of it is prohibited (and may be unlawful). The information expressed herein may be changed at any time without notice or obligation to update. We do not represent that this message is virus-free, complete or accurate and it should not be relied upon as such. Electronic communications may be monitored for operational and business purposes to the extent permitted by applicable law. This email does not constitute legal or tax advice, and the information contained in this communication should not be regarded as such.


Decura IM LLP is authorised and regulated by the Financial Conduct Authority. Registered office address: 11-12 St James's Square, London SW1Y 4LB. Registered in England and Wales: OC375344

 

Decura LLP is authorised and regulated by the Financial Conduct Authority. Registered office address: 11-12 St James's Square, London SW1Y 4LB. Registered in England and Wales: OC377231


From simon at rabbitmq.com  Mon Jun  2 11:02:44 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Jun 2014 11:02:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config
In-Reply-To: <E75DB63556459344A03DD1B8FDE21D2E2F2697D3@PDC1INXCH01S.decura.decuragroup.com>
References: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>
 <538C4688.3010605@rabbitmq.com>
 <E75DB63556459344A03DD1B8FDE21D2E2F2697D3@PDC1INXCH01S.decura.decuragroup.com>
Message-ID: <538C4BC4.1030600@rabbitmq.com>

On 02/06/2014 10:59AM, Dinesh Hirani wrote:
> Ran rabbitmq-service.bat
>
> It says the following in the log file
> config file(s) : c:/Program Files (x86)/RabbitMQ Server/rabbitmq_server-3.3.1/etc/rabbitmq.config (not found)
>
> File does exist.
> Directory of C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\etc
>
> 02/06/2014  09:26    <DIR>          .
> 02/06/2014  09:26    <DIR>          ..
> 02/06/2014  09:23               331 rabbitmq.config
> 29/04/2014  13:24            18,804 rabbitmq.config.example

Do you have a permissions problem then?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Dinesh.Hirani at decuragroup.com  Mon Jun  2 11:05:58 2014
From: Dinesh.Hirani at decuragroup.com (Dinesh Hirani)
Date: Mon, 2 Jun 2014 10:05:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config
In-Reply-To: <538C4BC4.1030600@rabbitmq.com>
References: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>
 <538C4688.3010605@rabbitmq.com>
 <E75DB63556459344A03DD1B8FDE21D2E2F2697D3@PDC1INXCH01S.decura.decuragroup.com>
 <538C4BC4.1030600@rabbitmq.com>
Message-ID: <E75DB63556459344A03DD1B8FDE21D2E2F269809@PDC1INXCH01S.decura.decuragroup.com>

No I've even tried running RabbitMQ service as my admin account and I get same error.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 02 June 2014 11:03
To: Dinesh Hirani; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config

On 02/06/2014 10:59AM, Dinesh Hirani wrote:
> Ran rabbitmq-service.bat
>
> It says the following in the log file
> config file(s) : c:/Program Files (x86)/RabbitMQ Server/rabbitmq_server-3.3.1/etc/rabbitmq.config (not found)
>
> File does exist.
> Directory of C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\etc
>
> 02/06/2014  09:26    <DIR>          .
> 02/06/2014  09:26    <DIR>          ..
> 02/06/2014  09:23               331 rabbitmq.config
> 29/04/2014  13:24            18,804 rabbitmq.config.example

Do you have a permissions problem then?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal


The information in this e-mail is confidential and may be legally privileged. It is intended solely for the addressee(s). Access by any other person to this e-mail is not authorized. If you are not the intended recipient, please delete this e-mail. Any disclosure of this e-mail or of the parties to it and any copying or distribution of it is prohibited (and may be unlawful). The information expressed herein may be changed at any time without notice or obligation to update. We do not represent that this message is virus-free, complete or accurate and it should not be relied upon as such. Electronic communications may be monitored for operational and business purposes to the extent permitted by applicable law. This email does not constitute legal or tax advice, and the information contained in this communication should not be regarded as such.


Decura IM LLP is authorised and regulated by the Financial Conduct Authority. Registered office address: 11-12 St James's Square, London SW1Y 4LB. Registered in England and Wales: OC375344

 

Decura LLP is authorised and regulated by the Financial Conduct Authority. Registered office address: 11-12 St James's Square, London SW1Y 4LB. Registered in England and Wales: OC377231


From Dinesh.Hirani at decuragroup.com  Mon Jun  2 11:10:23 2014
From: Dinesh.Hirani at decuragroup.com (Dinesh Hirani)
Date: Mon, 2 Jun 2014 10:10:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config
References: <E75DB63556459344A03DD1B8FDE21D2E2F26972E@PDC1INXCH01S.decura.decuragroup.com>
 <538C4688.3010605@rabbitmq.com>
 <E75DB63556459344A03DD1B8FDE21D2E2F2697D3@PDC1INXCH01S.decura.decuragroup.com>
 <538C4BC4.1030600@rabbitmq.com> 
Message-ID: <E75DB63556459344A03DD1B8FDE21D2E2F26983A@PDC1INXCH01S.decura.decuragroup.com>

Fixed, I did not uninstall and reinstall service, even though you said.

-----Original Message-----
From: Dinesh Hirani 
Sent: 02 June 2014 11:06
To: 'Simon MacMullen'; Discussions about RabbitMQ
Subject: RE: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config

No I've even tried running RabbitMQ service as my admin account and I get same error.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 02 June 2014 11:03
To: Dinesh Hirani; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.3.1 - rabbitmq.config

On 02/06/2014 10:59AM, Dinesh Hirani wrote:
> Ran rabbitmq-service.bat
>
> It says the following in the log file
> config file(s) : c:/Program Files (x86)/RabbitMQ Server/rabbitmq_server-3.3.1/etc/rabbitmq.config (not found)
>
> File does exist.
> Directory of C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\etc
>
> 02/06/2014  09:26    <DIR>          .
> 02/06/2014  09:26    <DIR>          ..
> 02/06/2014  09:23               331 rabbitmq.config
> 29/04/2014  13:24            18,804 rabbitmq.config.example

Do you have a permissions problem then?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal


The information in this e-mail is confidential and may be legally privileged. It is intended solely for the addressee(s). Access by any other person to this e-mail is not authorized. If you are not the intended recipient, please delete this e-mail. Any disclosure of this e-mail or of the parties to it and any copying or distribution of it is prohibited (and may be unlawful). The information expressed herein may be changed at any time without notice or obligation to update. We do not represent that this message is virus-free, complete or accurate and it should not be relied upon as such. Electronic communications may be monitored for operational and business purposes to the extent permitted by applicable law. This email does not constitute legal or tax advice, and the information contained in this communication should not be regarded as such.


Decura IM LLP is authorised and regulated by the Financial Conduct Authority. Registered office address: 11-12 St James's Square, London SW1Y 4LB. Registered in England and Wales: OC375344

 

Decura LLP is authorised and regulated by the Financial Conduct Authority. Registered office address: 11-12 St James's Square, London SW1Y 4LB. Registered in England and Wales: OC377231


From o.sevryukov at videal.net  Mon Jun  2 10:44:09 2014
From: o.sevryukov at videal.net (o.sevryukov at videal.net)
Date: Mon, 2 Jun 2014 02:44:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Can you tell me how cluster works in RabbitMQ ?
Message-ID: <ddde5d53-9d56-4f4f-b773-b5853c8df574@googlegroups.com>

Can you tell me how cluster works in RabbitMQ ?
I have 1 master and 2 slaves in cluster, but only the master is processing 
queues and highly loaded and slaves stay idle all the time.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/253f0e03/attachment.html>

From mklishin at gopivotal.com  Mon Jun  2 12:48:26 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 2 Jun 2014 15:48:26 +0400
Subject: [rabbitmq-discuss] Can you tell me how cluster works in
 RabbitMQ ?
In-Reply-To: <ddde5d53-9d56-4f4f-b773-b5853c8df574@googlegroups.com>
References: <ddde5d53-9d56-4f4f-b773-b5853c8df574@googlegroups.com>
Message-ID: <etPan.538c64a3.66334873.a8bc@mercurio.local>

On 2 June 2014 at 15:25:29, o.sevryukov at videal.net (o.sevryukov at videal.net) wrote:
> > I have 1 master and 2 slaves in cluster, but only the master is 
> processing queues and highly loaded and slaves stay idle all 
> the time.

Queues in a cluster have master and, optionally, 1 or more mirrors. The node
on which the queue was declared is its master. Queue operations are routed to master
by other nodes.

To spread the load between cluster
nodes, distributed client connections between them so that clients connect
to masters of the queues they work with. This reduces intra-cluster communication
and, in turn, throughput .
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From rtrlists at googlemail.com  Mon Jun  2 12:57:06 2014
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 2 Jun 2014 12:57:06 +0100
Subject: [rabbitmq-discuss] Can you tell me how cluster works in
	RabbitMQ ?
In-Reply-To: <ddde5d53-9d56-4f4f-b773-b5853c8df574@googlegroups.com>
References: <ddde5d53-9d56-4f4f-b773-b5853c8df574@googlegroups.com>
Message-ID: <CAH+xwdBk4j6c0OMyEEPMk9hEQ0mCRkX7hjSkMwEc2q7wkdz9Yg@mail.gmail.com>

Do you maybe have your producers and/or consumers only connecting to just
that one node?

To make use of the cluster, you need to make use of all machines in the
cluster. For example, you could put a load balancer in front of the
cluster, if you want your consumers/producers to all connect to just the
one address.

Robby
 On Jun 2, 2014 12:24 PM, <o.sevryukov at videal.net> wrote:

> Can you tell me how cluster works in RabbitMQ ?
> I have 1 master and 2 slaves in cluster, but only the master is processing
> queues and highly loaded and slaves stay idle all the time.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/6c80a9b6/attachment.html>

From videlalvaro at gmail.com  Mon Jun  2 13:05:41 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 2 Jun 2014 14:05:41 +0200
Subject: [rabbitmq-discuss] Is it possible to get a "push" when number
 of messages reaches threshold?
In-Reply-To: <CAJ2-VrnDPn-QAVpGkxnJaO7NOdWYcdDb9M9qizuXw8JmNEF7dQ@mail.gmail.com>
References: <CAJ2-Vr=tHcgicFvmCN1PPfG2Qkcpbd8s7S7OUtdFctVFpuvxOA@mail.gmail.com>
 <etPan.538b2cac.6b8b4567.82c0@mercurio.local>
 <CAMcAHLU6=2K2KG=JUD7wAM+igqSVchZ17UfCR6qLucUmypuS_w@mail.gmail.com>
 <CAJ2-VrnDPn-QAVpGkxnJaO7NOdWYcdDb9M9qizuXw8JmNEF7dQ@mail.gmail.com>
Message-ID: <CAMcAHLUb30NnYUtuUaBPR-Ez=p116FsFLLY8qe1A-O8cs4=7kw@mail.gmail.com>

Something along those lines, yes. Note that this is borderline hackish.

Also keep in mind to always CC the RabbitMQ discuss list.


On Mon, Jun 2, 2014 at 1:20 PM, rails <stammailbox at gmail.com> wrote:

> @Alvaro,
> I already have a DLE but I can't see how it can assist me in working on
> bulks. Do you mean I can subscribe to a queue in the DLE and than when a
> message arrives - start to consume from the original queue that was filled?
> and then move the message back from DLE to the queue? maybe I failed to
> understand...
>
>
> On Sun, Jun 1, 2014 at 6:18 PM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
>
>> Hi,
>>
>> I'd guess this could be attempted using queue length:
>> http://www.rabbitmq.com/maxlength.html and setting up a separate dead
>> letter queue for that 5000th message.
>>
>> Regards,
>>
>> Alvaro
>>
>>
>> On Sun, Jun 1, 2014 at 3:37 PM, Michael Klishin <mklishin at gopivotal.com>
>> wrote:
>>
>>> On 1 June 2014 at 17:34:11, rails (stammailbox at gmail.com) wrote:
>>> > > 1. What is the best practice to get the number of messages in a
>>> > queue.
>>> > I know I can get it via queue.getMessageCount()
>>>
>>> Do a queue.declare (possibly with passive = true), check # of messages
>>> ready from
>>> queue.declare-ok. You can also query queue stats using HTTP API.
>>>
>>> > What is the best way if I want to react only when X messages arrive?
>>>
>>> Add a consumer and process deliveries in batches  in your own code.
>>>
>>> > 2. And more important - can I get the number of messages in a queue
>>> > via push?
>>>
>>> There is no such feature in RabbitMQ. You have to periodically check the
>>> counter.
>>> --
>>> MK
>>>
>>> Software Engineer, Pivotal/RabbitMQ
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/e54c1f2a/attachment.html>

From gadido30 at gmail.com  Mon Jun  2 12:49:31 2014
From: gadido30 at gmail.com (Gadi Dor)
Date: Mon, 2 Jun 2014 04:49:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Basic_Consume
Message-ID: <499596ce-2c11-49f8-8cee-60f76bf4b40c@googlegroups.com>

Hi All

When I am using:

basic_consume( Queue, true, ChPid, undefined,ConsumerTag, false, undefined)

I got strange error:


[{basic_consume,
                              
                            [{amqqueue,
                                                            {resource,
                                                             <<"/">>,queue,
                                                             
<<"user1 at jabber.tld">>},
                                                            true,false,none,
                                                            
[],<12016.1240.0>,
                                                            [],[],undefined,
                                                            [],[]},
                                                           true,<0.416.0>,
                                                           undefined,
                                                           undefined,false,
                                                           undefined],
                                                          []},
                                                         {rabbit_misc,
                                                          
with_exit_handler,2,
                                                          []},
                                                         {rpc,
                                                          
'-handle_call_call/6-fun-0-',
                                                          5,
                                                          [{file,"rpc.erl"},
                                                           {line,205}]}]}

Any Idea Please?

Thank You
Gadi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/6a527a05/attachment.html>

From simon at rabbitmq.com  Mon Jun  2 14:34:20 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Jun 2014 14:34:20 +0100
Subject: [rabbitmq-discuss] Basic_Consume
In-Reply-To: <499596ce-2c11-49f8-8cee-60f76bf4b40c@googlegroups.com>
References: <499596ce-2c11-49f8-8cee-60f76bf4b40c@googlegroups.com>
Message-ID: <538C7D5C.9090009@rabbitmq.com>

On 02/06/2014 12:49PM, Gadi Dor wrote:
> Hi All
>
> When I am using:
>
> basic_consume( Queue, true, ChPid, undefined,ConsumerTag, false, undefined)

You don't say where this is from, but that looks like an old version of 
rabbit_amqqueue:basic_consume().

That's not a public API. It makes a number of undocumented assumptions 
about the caller, and changes freely between RabbitMQ releases. I very 
much doubt you want to use it.

> I got strange error:
>
> [{basic_consume,
>                              [{amqqueue,
>                                {resource,
>                                 <<"/">>,queue,
>                                 <<"user1 at jabber.tld">>},
>                                true,false,none,
>                                [],<12016.1240.0>,
>                                [],[],undefined,
>                                [],[]},
>                               true,<0.416.0>,
>                               undefined,
>                               undefined,false,
>                               undefined],
>                              []},
>                             {rabbit_misc,
>                              with_exit_handler,2,
>                              []},
>                             {rpc,
>                              '-handle_call_call/6-fun-0-',
>                              5,
>                              [{file,"rpc.erl"},
>                               {line,205}]}]}

That error message looks like important bits have been removed.

> Any Idea Please?

To consume from a queue using Erlang, use the Erlang client: 
http://www.rabbitmq.com/erlang-client-user-guide.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From gperes at daitangroup.com  Mon Jun  2 15:40:19 2014
From: gperes at daitangroup.com (gui.balde)
Date: Mon, 2 Jun 2014 07:40:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Workpool memory leak on 3.3.1?
Message-ID: <1401720019012-35984.post@n5.nabble.com>

Good morning,

I know this was a known issue back with 2.7.1

We've been profiling one of our modules running on an ec2 instance consuming
from a rabbit queue.
The message consumer simply queues the delivered object as a task to be
consumed by an internal thread, no hassle.
This internal thread takes each item from the internal queue and goes over
the wire to the database. This takes time due to net i/o and transactions.
This makes our consumer a slow consumer ;)

In this scenario we expected to see messages queueing up on "rabbitmqctl
list_queues", but instead, we see none. What we see is the workPool (inside
com.rabbitmq.client.impl.ConsumerWorkService) filling up to 780MB of items
in the 'pool' HashMap. Which then leads to an OutOfMemoryError when under a
heavy load.

We currently have 90 consumers synchronizing that one internal queue I
referred to.

Does anyone see any problems here?

Thanks in advance.

Guilherme.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Workpool-memory-leak-on-3-3-1-tp35984.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Jun  2 15:55:49 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 2 Jun 2014 18:55:49 +0400
Subject: [rabbitmq-discuss] Workpool memory leak on 3.3.1?
In-Reply-To: <1401720019012-35984.post@n5.nabble.com>
References: <1401720019012-35984.post@n5.nabble.com>
Message-ID: <etPan.538c9090.19495cff.a8bc@mercurio.local>

?On 2 June 2014 at 18:46:07, gui.balde (gperes at daitangroup.com) wrote:
> > In this scenario we expected to see messages queueing up on "rabbitmqctl  
> list_queues", but instead, we see none. What we see is the workPool  
> (inside
> com.rabbitmq.client.impl.ConsumerWorkService) filling  
> up to 780MB of items
> in the 'pool' HashMap. Which then leads to an OutOfMemoryError  
> when under a
> heavy load.
>  
> We currently have 90 consumers synchronizing that one internal  
> queue I
> referred to.

Are you using QueueingConsumer by any chance? Do you use default basicQos value?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From gperes at daitangroup.com  Mon Jun  2 16:45:16 2014
From: gperes at daitangroup.com (gui.balde)
Date: Mon, 2 Jun 2014 08:45:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Workpool memory leak on 3.3.1?
In-Reply-To: <etPan.538c9090.19495cff.a8bc@mercurio.local>
References: <1401720019012-35984.post@n5.nabble.com>
 <etPan.538c9090.19495cff.a8bc@mercurio.local>
Message-ID: <1401723916095-35986.post@n5.nabble.com>

Hi Michael,

We're using spring-amqp 1.3.4. It uses a inner class InternalConsumer that
extends rabbitmq-client's DefaultConsumer (found at spring-amqp's
BlockingQueueConsumer). It handles devilery by putting items on a
BlockingQueue.

Since we're using AckMode.NONE on spring-amqp, I believe we use the default
basicQoS value.

Should I try a different basicQoS?

Thank you very much.

Guilherme.






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Workpool-memory-leak-on-3-3-1-tp35984p35986.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Jun  2 17:14:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 2 Jun 2014 20:14:20 +0400
Subject: [rabbitmq-discuss] Workpool memory leak on 3.3.1?
In-Reply-To: <1401723916095-35986.post@n5.nabble.com>
References: <1401720019012-35984.post@n5.nabble.com>
 <etPan.538c9090.19495cff.a8bc@mercurio.local>
 <1401723916095-35986.post@n5.nabble.com>
Message-ID: <etPan.538ca2f8.625558ec.a8bc@mercurio.local>

On 2 June 2014 at 20:09:44, gui.balde (gperes at daitangroup.com) wrote:
> > We're using spring-amqp 1.3.4. It uses a inner class InternalConsumer  
> that
> extends rabbitmq-client's DefaultConsumer (found at spring-amqp's  
> BlockingQueueConsumer). It handles devilery by putting items  
> on a
> BlockingQueue.
>  
> Since we're using AckMode.NONE on spring-amqp, I believe we  
> use the default
> basicQoS value.
>  
> Should I try a different basicQoS?

By default there is no limit on how many messages consumers can be given.
Plus you use automatic acknowledgements. This means that RabbitMQ will
try to deliver messages to your consumer as fast as possible,
and if the consumer cannot keep up, its internal BlockingQueue will grow
and grow until you run out of heap.?

This is not a memory leak. You need to use manual acknowledgements
and a non-unlimited basic.qos value (equal to roughly how many messages
you expect to be processed at a time).
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From gperes at daitangroup.com  Mon Jun  2 17:24:07 2014
From: gperes at daitangroup.com (gui.balde)
Date: Mon, 2 Jun 2014 09:24:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Workpool memory leak on 3.3.1?
In-Reply-To: <etPan.538ca2f8.625558ec.a8bc@mercurio.local>
References: <1401720019012-35984.post@n5.nabble.com>
 <etPan.538c9090.19495cff.a8bc@mercurio.local>
 <1401723916095-35986.post@n5.nabble.com>
 <etPan.538ca2f8.625558ec.a8bc@mercurio.local>
Message-ID: <1401726247511-35988.post@n5.nabble.com>

Hi Michael,

I just shot for 'memory leak' cause I saw it was an issue in the past. I've
been trying to improve our consumer logic to make it faster/more effective.
It was good refactoring, but it can only take us too far before we run out
of memory again. 

I'll look into the QoS and manual acks. Those were good tips. Should I have
any questions, I'll post back.

Thank you very much for your time.

Guilherme.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Workpool-memory-leak-on-3-3-1-tp35984p35988.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From guardion at sapo.pt  Mon Jun  2 17:24:40 2014
From: guardion at sapo.pt (guardion)
Date: Mon, 2 Jun 2014 09:24:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Redundant Cluster
Message-ID: <1401726280815-35989.post@n5.nabble.com>

Hello, i'm having doubts regarding the following situation:

I have a producer sending messages to a rabbitmq cluster composed by two
machines (A and B)

I can use mirrored queues to achieve availability in case of crash. A and B
have the same state (exchanges, queues, messages) right ?

What i need is that messages delivered to the cluster are replicated and
consumed individually, meaning, Message Y arrives at the cluster, then it's
replicated to A and B, and consumed by a consumer working in A and another
consumer working in B.

The same message should be consumed separatly in each node.

How can i make this? Do i need to turn off mirored queues and create
different exchanges ? Or ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Redundant-Cluster-tp35989.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Jun  2 17:37:12 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 2 Jun 2014 20:37:12 +0400
Subject: [rabbitmq-discuss] Redundant Cluster
In-Reply-To: <1401726280815-35989.post@n5.nabble.com>
References: <1401726280815-35989.post@n5.nabble.com>
Message-ID: <etPan.538ca851.6b8b4567.151@mercurio.local>

?On 2 June 2014 at 20:26:13, guardion (guardion at sapo.pt) wrote:
> > I have a producer sending messages to a rabbitmq cluster composed  
> by two
> machines (A and B)
>  
> I can use mirrored queues to achieve availability in case of crash.  
> A and B
> have the same state (exchanges, queues, messages) right ?

Queue mirroring replicate queue state. It does not affect exchanges.

See?http://www.rabbitmq.com/ha.html and?http://www.rabbitmq.com/partitions.html
for more information.

> What i need is that messages delivered to the cluster are replicated  
> and
> consumed individually, meaning, Message Y arrives at the cluster,  
> then it's
> replicated to A and B, and consumed by a consumer working in A and  
> another
> consumer working in B.
>  
> The same message should be consumed separatly in each node.
>  
> How can i make this? Do i need to turn off mirored queues and create  
> different exchanges ?

You need to use fanout or topic exchange and make sure that messages
are routed to multiple queues. First part of your question suggests
you want those queues to be mirrored.

However, you may want to replicate data between two clusters. See
Shovel and Federation plugins:

http://www.rabbitmq.com/shovel.html
http://www.rabbitmq.com/federation.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mcintoshj at gmail.com  Mon Jun  2 17:43:05 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 2 Jun 2014 11:43:05 -0500
Subject: [rabbitmq-discuss] Redundant Cluster
In-Reply-To: <etPan.538ca851.6b8b4567.151@mercurio.local>
References: <1401726280815-35989.post@n5.nabble.com>
 <etPan.538ca851.6b8b4567.151@mercurio.local>
Message-ID: <CAD6m6fFdexGa+Vd0PRpr484WxYm1LEK3Swh7ZXPtrTBSn3zJ5A@mail.gmail.com>

If you're worried about the crash - definitely look at two clusters.  You
can use shovel to keep them in sync.  We're using a fanout to two queues on
the publish side to a rabbit cluster locally.  Then each queue is shoveled
to a cluster on the remote side.

Jason


On Mon, Jun 2, 2014 at 11:37 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 2 June 2014 at 20:26:13, guardion (guardion at sapo.pt) wrote:
> > > I have a producer sending messages to a rabbitmq cluster composed
> > by two
> > machines (A and B)
> >
> > I can use mirrored queues to achieve availability in case of crash.
> > A and B
> > have the same state (exchanges, queues, messages) right ?
>
> Queue mirroring replicate queue state. It does not affect exchanges.
>
> See http://www.rabbitmq.com/ha.html and
> http://www.rabbitmq.com/partitions.html
> for more information.
>
> > What i need is that messages delivered to the cluster are replicated
> > and
> > consumed individually, meaning, Message Y arrives at the cluster,
> > then it's
> > replicated to A and B, and consumed by a consumer working in A and
> > another
> > consumer working in B.
> >
> > The same message should be consumed separatly in each node.
> >
> > How can i make this? Do i need to turn off mirored queues and create
> > different exchanges ?
>
> You need to use fanout or topic exchange and make sure that messages
> are routed to multiple queues. First part of your question suggests
> you want those queues to be mirrored.
>
> However, you may want to replicate data between two clusters. See
> Shovel and Federation plugins:
>
> http://www.rabbitmq.com/shovel.html
> http://www.rabbitmq.com/federation.html
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/f63bd5d1/attachment.html>

From grussell at gopivotal.com  Mon Jun  2 18:07:36 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Mon, 2 Jun 2014 13:07:36 -0400
Subject: [rabbitmq-discuss] Workpool memory leak on 3.3.1?
In-Reply-To: <1401726247511-35988.post@n5.nabble.com>
References: <1401720019012-35984.post@n5.nabble.com>
 <etPan.538c9090.19495cff.a8bc@mercurio.local>
 <1401723916095-35986.post@n5.nabble.com>
 <etPan.538ca2f8.625558ec.a8bc@mercurio.local>
 <1401726247511-35988.post@n5.nabble.com>
Message-ID: <CADtU9_tb4ntKZbO88nyK+qeY60KdwFLa0tdJvYyzzgch41xo7w@mail.gmail.com>

For the most part, with Spring-AMQP, you can avoid having to do manual acks
- use AcknowledgeMode.AUTO (default), set the prefetch (basic.qos) and
txSize to, say, 1000, and the container will send the ack each time 1000
messages are processed (per thread).

http://docs.spring.io/spring-amqp/docs/1.3.4.RELEASE/reference/html/amqp.html#containerAttributes


On Mon, Jun 2, 2014 at 12:24 PM, gui.balde <gperes at daitangroup.com> wrote:

> Hi Michael,
>
> I just shot for 'memory leak' cause I saw it was an issue in the past. I've
> been trying to improve our consumer logic to make it faster/more effective.
> It was good refactoring, but it can only take us too far before we run out
> of memory again.
>
> I'll look into the QoS and manual acks. Those were good tips. Should I have
> any questions, I'll post back.
>
> Thank you very much for your time.
>
> Guilherme.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Workpool-memory-leak-on-3-3-1-tp35984p35988.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/4ccd6dc4/attachment.html>

From gperes at daitangroup.com  Mon Jun  2 18:18:56 2014
From: gperes at daitangroup.com (gui.balde)
Date: Mon, 2 Jun 2014 10:18:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Workpool memory leak on 3.3.1?
In-Reply-To: <CADtU9_tb4ntKZbO88nyK+qeY60KdwFLa0tdJvYyzzgch41xo7w@mail.gmail.com>
References: <1401720019012-35984.post@n5.nabble.com>
 <etPan.538c9090.19495cff.a8bc@mercurio.local>
 <1401723916095-35986.post@n5.nabble.com>
 <etPan.538ca2f8.625558ec.a8bc@mercurio.local>
 <1401726247511-35988.post@n5.nabble.com>
 <CADtU9_tb4ntKZbO88nyK+qeY60KdwFLa0tdJvYyzzgch41xo7w@mail.gmail.com>
Message-ID: <1401729536781-35993.post@n5.nabble.com>

Hi Gary,

I just tried it. Worked like a charm ;)
Now I see the queue filling up and holding those messages for us. So our
component is not flooded anymore.

Thanks Gary,

Guilherme.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Workpool-memory-leak-on-3-3-1-tp35984p35993.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From nhooey at gmail.com  Tue Jun  3 00:51:00 2014
From: nhooey at gmail.com (Neil Hooey)
Date: Mon, 2 Jun 2014 19:51:00 -0400
Subject: [rabbitmq-discuss] Feature: rabbitmq-management: Display "Time To
	Empty" for queues
Message-ID: <CANFtSwh1mrFk1_3NaP9MLVg4+dTskab0ro3XvMEeaiFfvpWGsQ@mail.gmail.com>

It would be helpful to have a "Time To Empty" column that would tell you
how much time it will take for a queue to empty where the value is based on
the publish/consume rates.

If the queue is expanding, you could display "infinity" or something more
useful.

What do you think?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/cdd6d3b4/attachment.html>

From vish.ramachandran at gmail.com  Tue Jun  3 07:31:04 2014
From: vish.ramachandran at gmail.com (vish.ramachandran)
Date: Mon, 2 Jun 2014 23:31:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Dynamic Shovel parameter validation regression
 between RMQ 3.3.0 and 3.3.1?
Message-ID: <1401777063809-35995.post@n5.nabble.com>

Hi RMQ team,

Following command used to work with RMQ 3.3.0. However, with RMQ 3.3.1, it
does not work anymore.

~/Documents/rabbitScripts$ rabbitmqctl set_parameter -p myvhost shovel
testShovel '{"src-uri": "amqp://myuser@/myvhost", "src-queue":
"mysourceExchange", "dest-uri": ["amqp://destrmq1.example.com",
"amqp://destrmq1.example.com"], "dest-exchange": "myDestExchange",
"dest-exchange-key" : "routingKey"}'
Setting runtime parameter "testShovel" for component "shovel" to
"{\"src-uri\": \"amqp://myuser@/myvhost\", \"src-queue\":
\"mysourceExchange\", \"dest-uri\": [\"amqp://destrmq1.example.com\",
\"amqp://destrmq1.example.com\"], \"dest-exchange\": \"myDestExchange\",
\"dest-exchange-key\" : \"routingKey\"}" ...
Error: {function_clause,
           [{rabbit_shovel_parameters,validate_params_user,
                [{amqp_params_direct,<<"myuser">>,none,<<"myvhost">>,
                     'rabbit at vishr-mac1',none,[]},
                 none],
                [{file,"rabbitmq-shovel/src/rabbit_shovel_parameters.erl"},
                 {line,115}]},
            {rabbit_parameter_validation,'-proplist/3-fun-0-',3,
                [{file,"src/rabbit_parameter_validation.erl"},{line,59}]},
            {lists,foldl,3,[{file,"lists.erl"},{line,1248}]},
            {rabbit_parameter_validation,proplist,3,
                [{file,"src/rabbit_parameter_validation.erl"},{line,55}]},
            {rabbit_shovel_parameters,validate,5,
                [{file,"rabbitmq-shovel/src/rabbit_shovel_parameters.erl"},
                 {line,55}]},
            {rabbit_runtime_parameters,set_any0,5,
                [{file,"src/rabbit_runtime_parameters.erl"},{line,99}]},
            {rabbit_runtime_parameters,set_any,5,
                [{file,"src/rabbit_runtime_parameters.erl"},{line,90}]},
            {rpc,'-handle_call_call/6-fun-0-',5,
                [{file,"rpc.erl"},{line,205}]}]}


However, if we add "localhost" to the source URI, it works: 

~/Documents/rabbitScripts$ rabbitmqctl set_parameter -p myvhost shovel
testShovel '{"src-uri": "amqp://myuser at localhost/myvhost", "src-queue":
"mysourceExchange", "dest-uri": ["amqp://destrmq1.example.com",
"amqp://destrmq1.example.com"], "dest-exchange": "myDestExchange",
"dest-exchange-key" : "routingKey"}'
Setting runtime parameter "testShovel" for component "shovel" to
"{\"src-uri\": \"amqp://myuser at localhost/myvhost\", \"src-queue\":
\"mysourceExchange\", \"dest-uri\": [\"amqp://destrmq1.example.com\",
\"amqp://destrmq1.example.com\"], \"dest-exchange\": \"myDestExchange\",
\"dest-exchange-key\" : \"routingKey\"}" ...
...done.
~/Documents/rabbitScripts$


>From the static shovel documentation at
http://www.rabbitmq.com/shovel-static.html

"If the host is omitted (not valid in a general AMQP URI), the shovel uses a
direct connection to the broker in which it is running. This avoids using
the network stack."

Has the support for this direct access been removed in 3.3.1 ? This used to
work for 3.3.0.

Thanks
Vish



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Dynamic-Shovel-parameter-validation-regression-between-RMQ-3-3-0-and-3-3-1-tp35995.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Jun  3 08:05:34 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jun 2014 08:05:34 +0100
Subject: [rabbitmq-discuss] Dynamic Shovel parameter validation
 regression between RMQ 3.3.0 and 3.3.1?
In-Reply-To: <1401777063809-35995.post@n5.nabble.com>
References: <1401777063809-35995.post@n5.nabble.com>
Message-ID: <538D73BE.8080706@rabbitmq.com>

On 03/06/2014 07:31, vish.ramachandran wrote:
> Has the support for this direct access been removed in 3.3.1 ? This used to
> work for 3.3.0.

It was a bug introduced in 3.3.1. Sorry about that. It will be fixed in 
3.3.2.

Cheers, Simon

From simon at rabbitmq.com  Tue Jun  3 08:13:44 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jun 2014 08:13:44 +0100
Subject: [rabbitmq-discuss] rabbitmq erlang amqp_client question.
In-Reply-To: <930473F0-2AAE-415C-9053-C5295CA0A2EA@gmail.com>
References: <DF4A5C62-2512-4BFE-ACA2-3489A52787D4@gmail.com>
 <538C4887.6030707@rabbitmq.com>
 <930473F0-2AAE-415C-9053-C5295CA0A2EA@gmail.com>
Message-ID: <538D75A8.6080508@rabbitmq.com>

On 02/06/2014 23:45, ale wrote:
> Can you point me to doc or code example that describes how to
> implement amqp_selective_consumer or amqp_direct_consumer inside an
> OTP application?

See http://www.rabbitmq.com/erlang-client-user-guide.html#subscribing

Cheers, Simon

From Pieter.erzeel at ae.be  Mon Jun  2 21:19:24 2014
From: Pieter.erzeel at ae.be (Pieter Erzeel)
Date: Mon, 2 Jun 2014 20:19:24 +0000
Subject: [rabbitmq-discuss] Dual domain ldap configuration
Message-ID: <A413800EF2AC704B9F9AD032DB4F9BF1A7304217@AEBEEXS01.ae.be>

Hi,

I have a bit of a problem getting the LDAP configuration right for my rabbitmq setup.
The broker should be able to authenticate users that live in different LDAP servers for different domains. We have an internal LDAP server and an external one for the DMZ.
Obviously the DN's aren't the same, so I would have to configure different binding parameters for each server.
Is this possible? Or can this only be done by basically setting up two separate clusters with federation?

Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140602/792037b7/attachment.html>

From alexelement01 at gmail.com  Mon Jun  2 23:45:51 2014
From: alexelement01 at gmail.com (ale)
Date: Mon, 2 Jun 2014 15:45:51 -0700
Subject: [rabbitmq-discuss] rabbitmq erlang amqp_client question.
In-Reply-To: <538C4887.6030707@rabbitmq.com>
References: <DF4A5C62-2512-4BFE-ACA2-3489A52787D4@gmail.com>
 <538C4887.6030707@rabbitmq.com>
Message-ID: <930473F0-2AAE-415C-9053-C5295CA0A2EA@gmail.com>

Hi Simon,

I?m new to erlang (1 week) and wasn?t sure what I was doing, I grabbed the amqp_gen_consumer because I wanted to learn and understand how it works under the hood.
I figured out how the amqp_gen_consumer works.   (Was a great learning experience.).

Now that I?m done with that I?m glad that you mentioned about the amqp_selective_consumer and amqp_direct_consumer.
Can you point me to doc or code example that describes how to implement amqp_selective_consumer or amqp_direct_consumer inside an OTP application?

Thanks!
A

On Jun 2, 2014, at 2:48 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 30/05/2014 5:34AM, ale wrote:
>> Hi,
>> 
>> I?m implementing a basic consumer in erlang using the
>> amqp_gen_consumer behavior from the official amqp_client.
> 
> Is there a reason you're implementing amqp_gen_consumer yourself? Normally you would use amqp_selective_consumer or amqp_direct_consumer rather than implementing your own.
> 
> If you do want your own consumer implementation, you need to configure it by opening the channel with amqp_connection:open_channel/2 not /1:
> 
> {ok, Channel} = amqp_connection:open_channel(
>                    Connection, {my_consumer_module, ConsumerArgs})
> 
>> All that is working fine but hen I publish messages to the queue I
>> would expect to receive messages via the [handle_deliver] callback
>> but instead I?m receiving messages trough [handle_info].
> 
> That's the default amqp_direct_consumer behaviour you're seeing.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal


From simon at rabbitmq.com  Tue Jun  3 09:53:07 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jun 2014 09:53:07 +0100
Subject: [rabbitmq-discuss] Feature: rabbitmq-management: Display "Time
 To Empty" for queues
In-Reply-To: <CANFtSwh1mrFk1_3NaP9MLVg4+dTskab0ro3XvMEeaiFfvpWGsQ@mail.gmail.com>
References: <CANFtSwh1mrFk1_3NaP9MLVg4+dTskab0ro3XvMEeaiFfvpWGsQ@mail.gmail.com>
Message-ID: <538D8CF3.6090200@rabbitmq.com>

Historically I've tended to think there's little point; it's just 
dividing one number by another.

But... people do keep asking. So it's quite possibly worth doing just as 
a usability thing.

Cheers, Simon

On 03/06/2014 00:51, Neil Hooey wrote:
> It would be helpful to have a "Time To Empty" column that would tell you
> how much time it will take for a queue to empty where the value is based
> on the publish/consume rates.
>
> If the queue is expanding, you could display "infinity" or something
> more useful.
>
> What do you think?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Tue Jun  3 10:00:47 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jun 2014 10:00:47 +0100
Subject: [rabbitmq-discuss] Dual domain ldap configuration
In-Reply-To: <A413800EF2AC704B9F9AD032DB4F9BF1A7304217@AEBEEXS01.ae.be>
References: <A413800EF2AC704B9F9AD032DB4F9BF1A7304217@AEBEEXS01.ae.be>
Message-ID: <538D8EBF.4040800@rabbitmq.com>

I'm afraid that's not possible; we assume one LDAP configuration.

So you could connect two clusters with shovel / federation. Other things 
you could do, of varying degrees of hackishness:

* Use a single cluster, with different nodes of the cluster configured 
to talk to different LDAP servers (nothing says all cluster nodes need 
to have the same auth setup). Clients would need to know which node to 
connect to obviously.

* Create a patched clone of the LDAP plugin called 
rabbit_auth_backend_ldap2 or whatever, and configure "both" plugins 
seperately.

* Create an LDAP proxy which talks to both LDAP servers. A quick Google 
suggests that OpenLDAP with back-ldap and suffixmassage might be one 
route to do this.

Cheers, Simon

On 02/06/2014 21:19, Pieter Erzeel wrote:
> Hi,
>
> I have a bit of a problem getting the LDAP configuration right for my
> rabbitmq setup.
>
> The broker should be able to authenticate users that live in different
> LDAP servers for different domains. We have an internal LDAP server and
> an external one for the DMZ.
>
> Obviously the DN?s aren?t the same, so I would have to configure
> different binding parameters for each server.
>
> Is this possible? Or can this only be done by basically setting up two
> separate clusters with federation?
>
> Pieter
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From Nikunj.Badjatya at emc.com  Tue Jun  3 11:14:26 2014
From: Nikunj.Badjatya at emc.com (Badjatya, Nikunj)
Date: Tue, 3 Jun 2014 10:14:26 +0000
Subject: [rabbitmq-discuss] RabbitMQ server  3.1.3:  "badmatch, {error,
	not_found}" (server down)
Message-ID: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>

Hello All,

My RabbitMQ server is down and I am seeing following error in RabbitMQ logs.

{{{
service at server:/var/log/rabbitmq> cat vim rabbit\@localhost.log

[snip]

=INFO REPORT==== 2-Jun-2016::09:35:58 ===
Error description:
   {badmatch,{error,not_found}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at localhost.log
   /var/log/rabbitmq/rabbit at localhost-sasl.log

Stack trace:
   [{rabbit_binding,recover_semi_durable_route,3,[]},
    {rabbit_binding,'-recover/2-lc$^0/1-0-',3,[]},
    {rabbit_binding,recover,2,[]},
    {rabbit,recover,0,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]},
    {rabbit,'-start/2-lc$^0/1-0-',1,[]},
    {rabbit,start,2,[]}]


=INFO REPORT==== 2-Jun-2016::09:35:59 ===
Error description:
   {could_not_start,rabbit,
       {bad_return,
           {{rabbit,start,[normal,[]]},
            {'EXIT',
                {rabbit,failure_during_boot,{badmatch,{error,not_found}}}}}}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at localhost.log
   /var/log/rabbitmq/rabbit at localhost-sasl.log<mailto:/var/log/rabbitmq/rabbit at localhost-sasl.log>

[snip]

}}}

Manual reset and start_app does not work either.

I noticed this error first time when tried to create a rabbitmq user using rabbitmqctl.

Any idea what is causing this issue?

I am using RabbitMQ server "3.1.3-1.suse" on SLES-11 SP3 machine.

Thanks in advance for your time.


Regards,
Nikunj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140603/fdefbe77/attachment.html>

From mklishin at gopivotal.com  Tue Jun  3 11:41:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 3 Jun 2014 14:41:10 +0400
Subject: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error,
 not_found}" (server down)
In-Reply-To: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>
References: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>
Message-ID: <etPan.538da663.327b23c6.7a61@mercurio.local>

On 3 June 2014 at 14:15:52, Badjatya, Nikunj (nikunj.badjatya at emc.com) wrote:
> >
> Stack trace:
> [{rabbit_binding,recover_semi_durable_route,3,[]},
> {rabbit_binding,'-recover/2-lc$^0/1-0-',3,[]},
> {rabbit_binding,recover,2,[]},
> {rabbit,recover,0,[]},
> {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
> {rabbit,run_boot_step,1,[]},
> {rabbit,'-start/2-lc$^0/1-0-',1,[]},
> {rabbit,start,2,[]}]

See?http://markmail.org/thread/26j56abreqwd32fq and?http://markmail.org/thread/ntgfmmmnfrhjodtj.

This is a known bug (#25783) which is not resolved yet.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue Jun  3 12:19:31 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jun 2014 12:19:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error,
 not_found}" (server down)
In-Reply-To: <etPan.538da663.327b23c6.7a61@mercurio.local>
References: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>
 <etPan.538da663.327b23c6.7a61@mercurio.local>
Message-ID: <538DAF43.6010408@rabbitmq.com>

On 03/06/14 11:41, Michael Klishin wrote:
> This is a known bug (#25783) which is not resolved yet.

But one which we don't fully understand. If this is happening 
consistently at startup then please could you zip the Mnesia directory 
and send it to me off-list?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Tue Jun  3 12:24:40 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 03 Jun 2014 12:24:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error,
 not_found}" (server down)
In-Reply-To: <etPan.538da663.327b23c6.7a61@mercurio.local>
References: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>
 <etPan.538da663.327b23c6.7a61@mercurio.local>
Message-ID: <538DB078.3020208@rabbitmq.com>

On 03/06/14 11:41, Michael Klishin wrote:
> On 3 June 2014 at 14:15:52, Badjatya, Nikunj (nikunj.badjatya at emc.com) wrote:
>>>
>> Stack trace:
>> [{rabbit_binding,recover_semi_durable_route,3,[]},
>> {rabbit_binding,'-recover/2-lc$^0/1-0-',3,[]},
>> {rabbit_binding,recover,2,[]},
>> {rabbit,recover,0,[]},
>> {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>> {rabbit,run_boot_step,1,[]},
>> {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>> {rabbit,start,2,[]}]
>
> See http://markmail.org/thread/26j56abreqwd32fq and http://markmail.org/thread/ntgfmmmnfrhjodtj.
>
> This is a known bug (#25783) which is not resolved yet.

Actually, there is a bug with the above signature that we fixed in 3.2.0

25822 prevent crash at startup when starting a clustered node hosting a
       durable non-HA queue which had been bound to a transient exchange 
which
       was deleted when the node was down (since 2.5.0)

Does that at all sound like what might be happening?

If not then, as Simon says, please send him a copy of the mnesia dir 
off-list.

Matthias.

From Wesley.Cutting at amx.com  Tue Jun  3 15:30:44 2014
From: Wesley.Cutting at amx.com (Wesley Cutting)
Date: Tue, 3 Jun 2014 14:30:44 +0000
Subject: [rabbitmq-discuss] RabbitMQ Installation Question
Message-ID: <553ebca215d2464db737791a88a0b827@HQEXCHBE01.amx.internal>

To whom it may concern,

I have a technical question regarding the installation of RabbitMQ and enabling the RabbitMQ Management Tools. I achieve a successful install and enablement by running the provided RabbitMQ installer and running the plugin batch file found in the sbin folder independently. I am attempting to install RabbitMQ as a dependency for my application, currently it is bundled with Advanced Installer and runs as it normally would (not silently, with the installation dialog). As part of our RabbitMQ installation we have also bundled the Erlang dependency, that runs before RabbitMQ. After bundling the RabbitMQ exe into Advanced Installer I wrote a small C# app to programmatically execute the plugin batch file and restart RabbitMQ (for some reason Advanced Installer won't let you directly run a batch file). I have verified that the exe works by running it separately from Advanced Installer after it has installed RabbitMQ and its process has ended. The issue I am running into is when I attempt to bundle my personal exe with Advanced Installer. The plugin batch file does not enable the management tools, instead it states that the Erlang Home is not set correctly, which doesn't make sense to me because I thought that the RabbitMQ installation consumed that same environment variable. I have also encountered this problem when working with WIX as our installer technology so I know it is not a problem with Advanced Installer. The best I can surmise is that RabbitMQ and the plugin batch file cannot be run in the same process for whatever reason. Can you either confirm my suspicions or point in the direction of a potential work around?

Thank you,

Wes Cutting   |   Software Engineer
AMX Worldwide | 3000 Research Drive Richardson TX 75082 | 800-222-0193 ext. 7751


________________________________
The above message is confidential and intended only for the use of the person to whom it is addressed and may contain information that is privileged and/or exempt from disclosure under applicable law. If the reader of this message is not the intended recipient or the employee or agent responsible for delivering the message to the intended recipient, you are hereby notified that any dissemination, distribution, copying or other use of the information contained herein is strictly prohibited. If you have received this transmission in error, please notify the sender immediately by telephone and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140603/661cac8b/attachment.html>

From simon at rabbitmq.com  Tue Jun  3 16:38:30 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jun 2014 16:38:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ Installation Question
In-Reply-To: <553ebca215d2464db737791a88a0b827@HQEXCHBE01.amx.internal>
References: <553ebca215d2464db737791a88a0b827@HQEXCHBE01.amx.internal>
Message-ID: <538DEBF6.6020107@rabbitmq.com>

On 03/06/14 15:30, Wesley Cutting wrote:
> The plugin batch file does not enable the management tools, instead it
> states that the Erlang Home is not set correctly, which doesn?t make
> sense to me because I thought that the RabbitMQ installation consumed
> that same environment variable.

No. It doesn't consume it - it sets it. And if you end up setting 
environment variables while installing then they are not available to 
your installer or subprocesses launched from it until you broadcast a 
WM_WININICHANGE message. See here:

http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v3_3_1/packaging/windows-exe/rabbitmq_nsi.in#l238

for how we do it.

> I have also encountered this problem
> when working with WIX as our installer technology so I know it is not a
> problem with Advanced Installer. The best I can surmise is that RabbitMQ
> and the plugin batch file cannot be run in the same process for whatever
> reason. Can you either confirm my suspicions or point in the direction
> of a potential work around?

The rabbitmq-plugins.bat tool just edits the enabled_plugins file. This 
is a plain text file containing an Erlang term which is a list of 
explicitly enabled plugins. So you could deploy your own file containing 
exactly "[rabbitmq_management]." (without the quote marks) and not have 
to invoke the batch file at all.

If you are embedding RabbitMQ inside another product, you might find 
that you want to skip using the installer and just install the various 
components within your own installer. See

http://www.rabbitmq.com/install-windows-manual.html

for some information on how you might do that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From James.EDDY at us.thalesgroup.com  Tue Jun  3 17:53:12 2014
From: James.EDDY at us.thalesgroup.com (EDDY James)
Date: Tue, 3 Jun 2014 09:53:12 -0700
Subject: [rabbitmq-discuss] RMQ stuck in startup
Message-ID: <083E352F62C9974389AD0F9F875EA238188FE9D54F@THSONEA03CMS03P.ONE-03.GRP>

Hi All,

I use RMQ 3.1.5 w/ erlang R16B02 on PPC linux. I've recently seen an issue on startup, I have only seen this a few times and does not seem to be easily reproduced.

What I see is this:
Precondition: node1 and node2 both are started with mnesia completely removed, so there is no existing state of the mnesia DB (I do this by stopping both nodes and doing rm -rf on the database)

(1) start node1, node1 is started and ready
(2) start node2, node2 is started and ready
(3) Both nodes will have clients auto connecting, creating exchanges and publishing.
(4) on node2, run:
      rabbitmqctl stop_app
      rabbitmqctl join_cluster rabbit at node1
      rabbitmqctl start_app
   After running start_app, the rabbitmqctl script hangs on "Starting node rabbit at node2 ..." it does not ever show "done"
(5) any call to "rabbitmqctl status" returns:

Status of node rabbit at node2 ...
Error: {{case_clause,starting},
        [{rabbit_vm,mnesia_memory,0,[]},
         {rabbit_vm,memory,0,[]},
         {rabbit,status,0,[]},
         {rpc,'-handle_call_call/6-fun-0-',5,[{file,"rpc.erl"},{line,205}]}]}


node2 will stay in this state indefinitely. Has anyone seen anything like this before? Any ideas what might cause this, or where to further investigate (like epmd? mnesia init issue? etc)?

Thanks!
James

From howard at renci.org  Tue Jun  3 18:20:38 2014
From: howard at renci.org (Howard)
Date: Tue, 3 Jun 2014 13:20:38 -0400
Subject: [rabbitmq-discuss] Java example code for the header exchange
Message-ID: <538E03E6.1010206@renci.org>

Hi all

I am doing a project with RabbitMQ in java and we have decided to use a 
headers exchange. I downloaded the tutorials from 
https://github.com/rabbitmq/rabbitmq-tutorials but I didn't see one for 
how to use the header exchange in the java directory.  No problem, I 
googled  around a bit and adapted the topic exchange tutorials to use a 
headers exchange. I've cleaned these up, and thought it might be worth 
the time for someone to add these to the existing tutorial directory.  
Any suggestions on who to contact to see if that is a possibility?

Thanks
Howard
-- 
Howard Lander <mailto:howard at renci.org>
Senior Research Software Developer
Renaissance Computing Institute (RENCI) <http://www.renci.org>
The University of North Carolina at Chapel Hill
Duke University
North Carolina State University
100 Europa Drive
Suite 540
Chapel Hill, NC 27517
919-445-9651
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140603/e71e13e1/attachment.html>

From mklishin at gopivotal.com  Tue Jun  3 18:30:15 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 3 Jun 2014 21:30:15 +0400
Subject: [rabbitmq-discuss] Java example code for the header exchange
In-Reply-To: <538E03E6.1010206@renci.org>
References: <538E03E6.1010206@renci.org>
Message-ID: <etPan.538e0644.66334873.e723@mercurio.local>

On 3 June 2014 at 21:21:47, Howard (howard at renci.org) wrote:
> > I googled around a bit and adapted the topic exchange tutorials  
> to use a headers exchange. I've cleaned these up, and thought  
> it might be worth the time for someone to add these to the existing  
> tutorial directory. Any suggestions on who to contact to see  
> if that is a possibility?

Howard,

We would be happy to add your example to?https://github.com/rabbitmq/rabbitmq-tutorials,
so simply submit a pull request there . We will do our best with porting it to
other languages, too. However, writing a tutorial that uses headers exchange
is not a high priority at the moment.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jun  3 18:41:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 3 Jun 2014 21:41:24 +0400
Subject: [rabbitmq-discuss] Java example code for the header exchange
In-Reply-To: <538E078E.3060709@renci.org>
References: <538E03E6.1010206@renci.org>
 <etPan.538e0644.66334873.e723@mercurio.local>
 <538E078E.3060709@renci.org>
Message-ID: <etPan.538e08e1.625558ec.e723@mercurio.local>

On 3 June 2014 at 21:36:15, Howard (howard at renci.org) wrote:
> > I just thought the code might help someone else as it was not that  
> easy to find an example on the web. Have a look and see if it looks  
> OK. It works for me, but that may not be definitive.

Sure, can you submit a pull request on github? I will post my feedback
there.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From vish.ramachandran at gmail.com  Tue Jun  3 18:57:48 2014
From: vish.ramachandran at gmail.com (vish.ramachandran)
Date: Tue, 3 Jun 2014 10:57:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Dynamic Shovel parameter validation
 regression between RMQ 3.3.0 and 3.3.1?
In-Reply-To: <538D73BE.8080706@rabbitmq.com>
References: <1401777063809-35995.post@n5.nabble.com>
 <538D73BE.8080706@rabbitmq.com>
Message-ID: <1401818268399-36013.post@n5.nabble.com>

When is 3.3.2 release expected ? Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Dynamic-Shovel-parameter-validation-regression-between-RMQ-3-3-0-and-3-3-1-tp35995p36013.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Jun  3 19:01:36 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 3 Jun 2014 22:01:36 +0400
Subject: [rabbitmq-discuss] Dynamic Shovel parameter validation
 regression between RMQ 3.3.0 and 3.3.1?
In-Reply-To: <1401818268399-36013.post@n5.nabble.com>
References: <1401777063809-35995.post@n5.nabble.com>
 <538D73BE.8080706@rabbitmq.com> <1401818268399-36013.post@n5.nabble.com>
Message-ID: <etPan.538e0d9d.238e1f29.e723@mercurio.local>

?On 3 June 2014 at 21:58:58, vish.ramachandran (vish.ramachandran at gmail.com) wrote:
> > When is 3.3.2 release expected ?

No promises on a specific date but very soon.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From vish.ramachandran at gmail.com  Wed Jun  4 00:43:27 2014
From: vish.ramachandran at gmail.com (vish.ramachandran)
Date: Tue, 3 Jun 2014 16:43:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Federating messages in upstream with specific
	routing key
Message-ID: <1401839006941-36015.post@n5.nabble.com>

I am in reference to this FAQ at
https://www.rabbitmq.com/federated-exchanges.html

==========
Are all messages copied?
Only those messages that need to be copied are propagated. This is an
optimisation arranged dynamically by the federation plugin. (See below.)

==========

My situation requires me to federate from an upstream exchange only messages
with a specific routing key. The above FAQ seems to indicate this is
possible. However, I didn't find any option that allows me to specify a
routing key while configuring upstream queue. 

Is this possible ?

Thanks
Vish




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Federating-messages-in-upstream-with-specific-routing-key-tp36015.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From andnrk at gmail.com  Wed Jun  4 01:47:06 2014
From: andnrk at gmail.com (Andrius Norkaitis)
Date: Wed, 4 Jun 2014 03:47:06 +0300
Subject: [rabbitmq-discuss] Use of QueueDeclarePassive generates errors in
	log
Message-ID: <CAB4ybe8-t9ZCvz+k66or1B2rM81xvfbNpXF4gwZ-=azWPHs02Q@mail.gmail.com>

Hi,

QueueDeclarePassive(QueueName) generated error in log file. E.g.

if queue not exist, it writes:

*=ERROR REPORT==== 4-Jun-2014::03:33:00 ===*
*connection <0.26865.9>, channel 3 - soft error:*
*{amqp_error,not_found,*
*            "no queue 'xxxx' in vhost '/'",*
*            'queue.declare'}*

If it exist, it writes:

*=ERROR REPORT==== 4-Jun-2014::03:33:05 ===*
*connection <0.26865.9>, channel 3 - soft error:*
*{amqp_error,resource_locked,*
*            "cannot obtain exclusive access to locked queue 'xxxx' in
vhost '/'",*
*            'queue.declare'}*



*How to disable error logging when using this function? Maybe there is new
way to check **queue exist?*


*Thanks*
*A.N.*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/6ad23570/attachment.html>

From vish.ramachandran at gmail.com  Wed Jun  4 04:52:17 2014
From: vish.ramachandran at gmail.com (vish.ramachandran)
Date: Tue, 3 Jun 2014 20:52:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Federating messages in upstream with
	specific routing key
In-Reply-To: <1401839006941-36015.post@n5.nabble.com>
References: <1401839006941-36015.post@n5.nabble.com>
Message-ID: <1401853937203-36017.post@n5.nabble.com>

I have to correct myself here to be precise:

"while configuring upstream queue."

should be 

"while configuring the federation-upstream."

We are using federated exchanges here.

Thanks






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Federating-messages-in-upstream-with-specific-routing-key-tp36015p36017.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ambatinr at hotmail.com  Tue Jun  3 16:10:16 2014
From: ambatinr at hotmail.com (anate)
Date: Tue, 3 Jun 2014 08:10:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin guest account login issue
Message-ID: <1401808215899-36007.post@n5.nabble.com>

I installed RabbitMQ and enabled Management plugin. I was able to login using
localhost(http://localhost:15672/) 'guest' account.I changed the password
after I logged in. But it doesn't work if I use the
'http://servername:15672'). It doesn't allow me to login. I am getting
'login failed'. It works if I login using localhost. How to resolve this
issue? Please let me know.  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Management-plugin-guest-account-login-issue-tp36007.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gadido30 at gmail.com  Tue Jun  3 18:08:00 2014
From: gadido30 at gmail.com (Gadi Dor)
Date: Tue, 3 Jun 2014 20:08:00 +0300
Subject: [rabbitmq-discuss] Basic_Consume
In-Reply-To: <538C7D5C.9090009@rabbitmq.com>
References: <499596ce-2c11-49f8-8cee-60f76bf4b40c@googlegroups.com>
 <538C7D5C.9090009@rabbitmq.com>
Message-ID: <CAPVeivq3PhVuSRO2CohK_keA5CMaUmwmrHM-rM94Eeq2UiHncA@mail.gmail.com>

Hi,

I don't want to make large changes in the code, Is there simple way to fix
it?

I am looking for basic guide to write with erlang and rabbitmq , How can I
debug my code and so?

Thank You
Gadi


On Mon, Jun 2, 2014 at 4:34 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 02/06/2014 12:49PM, Gadi Dor wrote:
>
>> Hi All
>>
>> When I am using:
>>
>> basic_consume( Queue, true, ChPid, undefined,ConsumerTag, false,
>> undefined)
>>
>
> You don't say where this is from, but that looks like an old version of
> rabbit_amqqueue:basic_consume().
>
> That's not a public API. It makes a number of undocumented assumptions
> about the caller, and changes freely between RabbitMQ releases. I very much
> doubt you want to use it.
>
>  I got strange error:
>>
>> [{basic_consume,
>>                              [{amqqueue,
>>                                {resource,
>>                                 <<"/">>,queue,
>>                                 <<"user1 at jabber.tld">>},
>>                                true,false,none,
>>                                [],<12016.1240.0>,
>>                                [],[],undefined,
>>                                [],[]},
>>                               true,<0.416.0>,
>>                               undefined,
>>                               undefined,false,
>>                               undefined],
>>                              []},
>>                             {rabbit_misc,
>>                              with_exit_handler,2,
>>                              []},
>>                             {rpc,
>>                              '-handle_call_call/6-fun-0-',
>>                              5,
>>                              [{file,"rpc.erl"},
>>                               {line,205}]}]}
>>
>
> That error message looks like important bits have been removed.
>
>  Any Idea Please?
>>
>
> To consume from a queue using Erlang, use the Erlang client:
> http://www.rabbitmq.com/erlang-client-user-guide.html
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140603/9f70aab5/attachment.html>

From alexelement01 at gmail.com  Tue Jun  3 22:24:06 2014
From: alexelement01 at gmail.com (Alex Ethier)
Date: Tue, 3 Jun 2014 14:24:06 -0700
Subject: [rabbitmq-discuss] rabbitmq erlang amqp_client question.
In-Reply-To: <538D75A8.6080508@rabbitmq.com>
References: <DF4A5C62-2512-4BFE-ACA2-3489A52787D4@gmail.com>
 <538C4887.6030707@rabbitmq.com>
 <930473F0-2AAE-415C-9053-C5295CA0A2EA@gmail.com>
 <538D75A8.6080508@rabbitmq.com>
Message-ID: <5765D46C-3C9C-4601-88F2-77679AD9CBDA@gmail.com>

Thanks, I figured it out yesterday.  All is well.  Thank you!
A

Sent from my iPhone

On Jun 3, 2014, at 0:13, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 02/06/2014 23:45, ale wrote:
> Can you point me to doc or code example that describes how to
> implement amqp_selective_consumer or amqp_direct_consumer inside an
> OTP application?

See http://www.rabbitmq.com/erlang-client-user-guide.html#subscribing

Cheers, Simon

From miguel.araujo.perez at gmail.com  Wed Jun  4 08:40:28 2014
From: miguel.araujo.perez at gmail.com (=?UTF-8?Q?Miguel_Araujo_P=C3=A9rez?=)
Date: Wed, 4 Jun 2014 00:40:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Pause minority cluster with publisher confirms
	losing messages
Message-ID: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>

Hello,

We've setup a RabbitMQ 3.3.1-1 cluster of 3 nodes in pause minority mode. 
We are making some tests to make sure we don't lose any messages when a 
node of the cluster goes down. 

So I've setup a little Python script that uses py-amqp to queue messages, 
It uses publisher confirms for doing so. The queue is durable and mirrored 
through a policy to all nodes. I use the script to push to the 3 different 
nodes in a loop, running 3 separate processes, one message every second, 
each message containing information of the publisher that produced it. Once 
I am publishing to the 3 nodes separated I enter node3 and write iptables 
rules to close connection with the other 2 rabbitmq nodes. It takes the 
cluster around a minute to decide that one node is down and node3 to stop 
Rabbit process. publishers to nodes 1 and 2 keep working without issues, 
however publisher3 blocks right after node3 blocks connections as I would 
expect as node3 cannot confirm the message as it doesn't see the other 2 
nodes. 

The issue is that sometimes after a while publisher3 resumes and continues 
pushing messages and according to the library receiving acks for them, that 
goes for a period of 6-8 seconds until an exception is raised because 
connection is closed (node3 stops Rabbit). Those "acked messages" aren't 
however in the queue when I consume it later to see what's inside. However, 
other times it works as i would expect and doesn't enqueue any other 
message after iptables takes place.

So I thought this could be a library issue, and ported the code to PHP 
using official php-amqplib and exact same thing happens. My theory is that 
sometimes node3 after trying to coordinate with other 2 nodes goes into a 
partition for some seconds, in those seconds it confirms messages and then 
pause minority cluster policy kicks in and stops Rabbit. 

To be honest, I'm open to suggestions on what to try. We cannot afford 
losing messages in any situation. 

Thanks, Cheers
Miguel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/b3781723/attachment.html>

From bvnr.mail at gmail.com  Wed Jun  4 08:51:07 2014
From: bvnr.mail at gmail.com (Narayan)
Date: Wed, 4 Jun 2014 00:51:07 -0700 (PDT)
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
Message-ID: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>

I'm trying to get SSL working on my Rabbit server, following the 
instructions at https://www.rabbitmq.com/ssl.html , but am getting this 
error when making connections:

*started SSL Listener on [::]:5671*
*error on AMQP connection <0.678.0>: 
{ssl_upgrade_error,{options,{cacertfile,[47,11... *
in broker log file.

I'm following the SSL troubleshooting 
guide http://www.rabbitmq.com/troubleshooting-ssl.html

** Check SSL support in Erlang               ----- SUCCESS*
ssl:versions().
SSL version: [{ssl_app,"5.3"},
 {supported,['tlsv1.2','tlsv1.1',tlsv1,sslv3]},
 {available,['tlsv1.2','tlsv1.1',tlsv1,sslv3]}]
RabbitMQ 3.3.0, Erlang R16B01

** Check keys and certificates with OpenSSL       ------ SUCCESS*
    openssl client output is listed below 
    *openssl s_client -connect localhost:8443 -cert client/cert.pem -key **client/key.pem 
-CAfile testca/cacert.pem*

*CONNECTED(00000003)
depth=1 CN = MyTestCA
verify return:1
depth=0 CN = primedev, O = server
verify return:1
---
Certificate chain
 0 s:/CN=primedev/O=server
   i:/CN=MyTestCA
 1 s:/CN=MyTestCA
   i:/CN=MyTestCA
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhNeVRl
c3RDQTAeFw0xNDA1MjgwNjU2NDNaFw0xNTA1MjgwNjU2NDNaMCQxETAPBgNVBAMM
CHByaW1lZGV2MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQC9IW8zoWmE8tUr46rc+QWrPYBlpHefUZ7HP1smlrN9rujrZM7l
ja7w+M7rHJSt0bTQ+dFfu1RTmWHkdgI4YIdgGvmhU3Bcij5Cyxn+vtZUaIAeYGfQ
QfPj6WsNiHOem/ieAkbhX+AvPDD7DBjlrqbo9ZtzeJxkhe/ENWHRlpdPNNpHpvbw
2azTPO55Nb2sDbeUOP0Bv1OieXM3r7CNruFF+KTAzxdC18kUM0Ty4jmwG3L1DFlF
zpm77ByB5DjFdNs+tBZ+1Fi1WrHp2NsSJe0IsCdCF9BG3RacpQv5tt/5/qL/af4G
xDyqebE/G9RwbM6Mnti3wGY34EGMtGFao/vDAgMBAAGjLzAtMAkGA1UdEwQCMAAw
CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
A4IBAQAL4TTARGRyGq/EMtbfkrQbInMoIPaV+VT8X6EKCvBrhjQZZ1bGHBYEBhry
EHQAJ1eiRPPLpVe4zpIP6xU8tiN/sIm4XOyj7hstSTThnixjNgZRmwUt/blMKA0p
PsFEKnAf2brwryO4KJcKbfjLCJfyWje8nXLR9dz/qrJ8+Vwve76lMnAoRqjDw1OF
z08evHevN3Mdb3Hyvd9WFRNMpQkjrmfx+v5dcXcbSOlpwtHIHMmX3Pq7QgXQdyo/
vNmGBYqyLofBwtKMOYbfhoksyJbCOeDCG5fYMUnSI1EqivjLPQX/0Dt2s0UzWOip
G2FWCQGgOKfLHWIawGNQcSpM83x4
-----END CERTIFICATE-----
subject=/CN=primedev/O=server
issuer=/CN=MyTestCA
---
No client certificate CA names sent
---
SSL handshake has read 2176 bytes and written 247 bytes
---
New, TLSv1/SSLv3, Cipher is DHE-RSA-AES256-SHA
Server public key is 2048 bit
Secure Renegotiation IS supported
Compression: zlib compression
Expansion: zlib compression
SSL-Session:
    Protocol  : TLSv1
    Cipher    : DHE-RSA-AES256-SHA
    Session-ID: 
81472A55C8EC471863BFC884C40322AC1A5C5FA00C8D845E71A98E122D60185E
    Session-ID-ctx:
    Master-Key: 
BB3BBA13077D4152455620760258906F1CF576966656D4417C3F80B1F7C1B357DCEBA4434363
879177A7AF55332FBC7A
    Key-Arg   : None
    Krb5 Principal: None
    PSK identity: None
    PSK identity hint: None
    TLS session ticket:
    0000 - 96 aa 8f 94 70 9c 42 0c-1b 44 62 f9 8c a8 42 5d   
....p.B..Db...B]
    0010 - fb 24 c2 7a 38 4e 69 e5-89 3d 71 ba 8f 59 2a 1a   
.$.z8Ni..=q..Y*.
    0020 - a0 9d e2 cc a8 fb 3d 71-b5 b3 d6 01 17 d9 22 b9   
......=q......".
    0030 - 6a 6b 73 59 1b 07 b7 84-23 b2 c7 08 4d 7f 88 2a   
jksY....#...M..*
    0040 - 6b 75 e5 3c 25 ca 26 da-77 b8 64 ce 72 15 30 da   ku.
<%.&.w.d.r.0.
    0050 - 5b 11 98 0a 25 dc 96 a3-77 bf b8 a0 e1 38 4e 22   
[...%...w....8N"
    0060 - 19 78 bc 5b 89 5b 3c f1-d5 17 e8 4f 57 0f 15 dc   .x.[.
[<....OW...
    0070 - 97 09 d8 7c 64 ce 68 e1-3f 18 95 23 3f 80 6a c7   
...|d.h.?..#?.j.
    0080 - 63 72 53 20 96 34 51 09-d3 28 8d 8c 73 03 31 a0   crS .4Q..
(..s.1.
    0090 - d0 73 3f 6a 19 25 11 10-5f d3 02 d5 92 75 ec f0   .s?
j.%.._....u..

    Compression: 1 (zlib compression)
    Start Time: 1401261748
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
---*


** Check broker is listening            ------ SUCCESS*

*started SSL Listener on [::]:5671*


** Attempt SSL connection to broker          ------ FAILED*

*=INFO REPORT==== ===
accepting AMQP connection <0.223.0> (.... -> 127.0.0.1:5671)*


After this got same error 

*error on AMQP connection <0.678.0>: {ssl_upgrade_error,{options,{cacertfile,[47,11... *


Here is what openssl s_client is showing when trying to connect with rmq ssl port


*openssl s_client -connect localhost:5671 -cert client/cert.pem -key client/key.pem -CAfile testca/cacert.pem
CONNECTED(00000003)
write:errno=104
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 0 bytes and written 113 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
---*


Please help me out to establish a SSL rabbit mq connection. Thanks in advance.


--

Thanks & Regards

Narayan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/04d6ac97/attachment.html>

From mklishin at gopivotal.com  Wed Jun  4 08:59:18 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 11:59:18 +0400
Subject: [rabbitmq-discuss] Management plugin guest account login issue
In-Reply-To: <1401808215899-36007.post@n5.nabble.com>
References: <1401808215899-36007.post@n5.nabble.com>
Message-ID: <etPan.538ed1f2.41b71efb.e723@mercurio.local>

?On 4 June 2014 at 11:52:50, anate (ambatinr at hotmail.com) wrote:
> > I installed RabbitMQ and enabled Management plugin. I was able  
> to login using
> localhost(http://localhost:15672/) 'guest' account.I changed  
> the password
> after I logged in. But it doesn't work if I use the
> 'http://servername:15672'). It doesn't allow me to login.  
> I am getting
> 'login failed'. It works if I login using localhost. How to resolve  
> this
> issue? Please let me know.

Starting with RabbitMQ 3.3, guest user can only log in from localhost by
default:?http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/

The post links to the docs that explain how to re-enable the old behaviour but
you *really* should use a separate user for remote connections. Otherwise you
have an admin user with well-known credentials that connect from outside. Not
a great security decision.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun  4 09:04:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 12:04:07 +0400
Subject: [rabbitmq-discuss] Use of QueueDeclarePassive generates errors
 in log
In-Reply-To: <CAB4ybe8-t9ZCvz+k66or1B2rM81xvfbNpXF4gwZ-=azWPHs02Q@mail.gmail.com>
References: <CAB4ybe8-t9ZCvz+k66or1B2rM81xvfbNpXF4gwZ-=azWPHs02Q@mail.gmail.com>
Message-ID: <etPan.538ed315.7545e146.e723@mercurio.local>

?On 4 June 2014 at 04:50:02, Andrius Norkaitis (andnrk at gmail.com) wrote:
> > QueueDeclarePassive(QueueName) generated error in log file.  
> E.g.
>  
> if queue not exist, it writes:
>  
> =ERROR REPORT==== 4-Jun-2014(http://airmail.calendar/2014-06-04%2012:00:00%20GMT+4)::03:33:00  
> ===
> connection <0.26865.9>, channel 3 - soft error:
> {amqp_error,not_found,
> "no queue 'xxxx' in vhost '/'",
> 'queue.declare'}

Which is entirely expected.

> If it exist, it writes:
>  
> =ERROR REPORT==== 4-Jun-2014(http://airmail.calendar/2014-06-04%2012:00:00%20GMT+4)::03:33:05  
> ===
> connection <0.26865.9>, channel 3 - soft error:
> {amqp_error,resource_locked,
> "cannot obtain exclusive access to locked queue 'xxxx' in vhost  
> '/'",
> 'queue.declare'}

The message says that you have 2 connections trying to use a queue
declared as exclusive. Use a non-exclusive queue and there will be no error.
?
> How to disable error logging when using this function? Maybe  
> there is new way to check queue exist?

There is no but you can simply declare the queue with the same arguments
instead of checking if it exists.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun  4 09:07:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 12:07:20 +0400
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
Message-ID: <etPan.538ed3d6.5bd062c2.e723@mercurio.local>

?On 4 June 2014 at 12:00:48, Narayan (bvnr.mail at gmail.com) wrote:
> > * Check SSL support in Erlang ----- SUCCESS
> ssl:versions().
> SSL version: [{ssl_app,"5.3"},
> {supported,['tlsv1.2','tlsv1.1',tlsv1,sslv3]},
> {available,['tlsv1.2','tlsv1.1',tlsv1,sslv3]}]
> RabbitMQ 3.3.0, Erlang R16B01

What client do you use? Do you configure SSL to any specific version?
What OS does your client and RabbitMQ run on?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun  4 09:17:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 12:17:38 +0400
Subject: [rabbitmq-discuss] Pause minority cluster with publisher
 confirms losing messages
In-Reply-To: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
References: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
Message-ID: <etPan.538ed640.4db127f8.e723@mercurio.local>



On 4 June 2014 at 11:58:41, Miguel Araujo P?rez (miguel.araujo.perez at gmail.com) wrote:
> > The issue is that sometimes after a while publisher3 resumes  
> and continues pushing messages and according to the library  
> receiving acks for them, that goes for a period of 6-8 seconds  
> until an exception is raised because connection is closed (node3  
> stops Rabbit). Those "acked messages" aren't however in the  
> queue when I consume it later to see what's inside. However, other  
> times it works as i would expect and doesn't enqueue any other  
> message after iptables takes place.
>  
> So I thought this could be a library issue, and ported the code  
> to PHP using official php-amqplib and exact same thing happens.  
> My theory is that sometimes node3 after trying to coordinate  
> with other 2 nodes goes into a partition for some seconds, in those  
> seconds it confirms messages and then pause minority cluster  
> policy kicks in and stops Rabbit.

Yes, it takes time for both RabbitMQ and client libraries to detect
connection failure. This is in part due to how TCP works. You can configure
the interval of inactivity for RabbitMQ nodes:

https://www.rabbitmq.com/nettick.html

and use a low (say, 1-3 seconds) heartbeat interval for client libraries.
This should make the exception be thrown much earlier (given that your client
supports it; Pika should) at the cost of having increased network traffic:

http://www.rabbitmq.com/reliability.html

Beyond that, your apps can publish last N messages (excessively) after a network
failure. If your consumers can de-duplicate them (e.g. every message has an id you can set),
that should work well.

If that's not the case, there is a trick that some companies do: they run a RabbitMQ
node local to machine (which at least greatly reduces the probability of RabbitMQ becoming
unreachable), publish with publisher confirms and a low heartbeat interval to the local
node and use Federation [1] or Shovel [2] to connect that node to other nodes.

By the way, there are only two official clients: Java and .NET.

1.?http://www.rabbitmq.com/federation.html
2.?http://www.rabbitmq.com/shovel.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From priyankthakkar at gmail.com  Wed Jun  4 09:44:33 2014
From: priyankthakkar at gmail.com (Priyank Thakkar)
Date: Wed, 4 Jun 2014 14:14:33 +0530
Subject: [rabbitmq-discuss] Rabbitmq Config Flie Ignored on Windows Server
	2003R2
Message-ID: <CAHmBT=ejxp9AuVFb1x2nLVYrcmcFvBMXRM6SR3KyUNRt6Vn5mg@mail.gmail.com>

Hi,

I have installed erlan OTP and rabbitmq server.

In the services.msc file i can see rabbitmq servcie running. I want to
provide custom configuration as i want to change the tcp port number.

I created an environment variable 'RABBITMQ_CONFIG_FILE" and provided path
to config file. I restarted the rabbitmq service, but in the log file i can
see the configuration file is ignored. The config file on the given path do
exist.

The log files says, "C:\WINDOWS config file(s) : c:/Program Files
(x86)/RabbitMQ Server/rabbitmq_server-3.3.1/etc/rabbitmq.config (not found)"

Regards,
Priyank Thakkar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/8ccf32fc/attachment.html>

From mklishin at gopivotal.com  Wed Jun  4 09:55:59 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 12:55:59 +0400
Subject: [rabbitmq-discuss] Rabbitmq Config Flie Ignored on Windows
 Server 2003R2
In-Reply-To: <CAHmBT=ejxp9AuVFb1x2nLVYrcmcFvBMXRM6SR3KyUNRt6Vn5mg@mail.gmail.com>
References: <CAHmBT=ejxp9AuVFb1x2nLVYrcmcFvBMXRM6SR3KyUNRt6Vn5mg@mail.gmail.com>
Message-ID: <etPan.538edf3d.1190cde7.e723@mercurio.local>

?On 4 June 2014 at 12:47:07, Priyank Thakkar (priyankthakkar at gmail.com) wrote:
> > I created an environment variable 'RABBITMQ_CONFIG_FILE"  
> and provided path to config file. I restarted the rabbitmq service,  
> but in the log file i can see the configuration file is ignored.  
> The config file on the given path do exist.
>  
> The log files says, "C:\WINDOWS config file(s) : c:/Program  
> Files (x86)/RabbitMQ Server/rabbitmq_server-3.3.1/etc/rabbitmq.config  
> (not found)"

See?http://markmail.org/thread/7fchvbzxmb65pkip:
you need to *reinstall* the service.

From?http://www.rabbitmq.com/configure.html:

?Restart the server after changes. Windows service users will need to re-install the service after adding or removing a configuration file.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun  4 11:22:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 14:22:24 +0400
Subject: [rabbitmq-discuss] Pause minority cluster with publisher
 confirms losing messages
In-Reply-To: <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>
References: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
 <etPan.538ed640.4db127f8.e723@mercurio.local>
 <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>
Message-ID: <etPan.538ef37b.ded7263.e723@mercurio.local>

On 4 June 2014 at 14:04:49, Miguel Araujo P?rez (miguel.araujo.perez at gmail.com) wrote:
> > It's my understanding that the node should do something like,  
> I cannot see nodes 1 and 2 (connection is broken), I'm by myself  
> here so I cannot confirm your publishes. Then says I've got to  
> stop, because I'm in minority. However, the fact that is confirming  
> messages for a small lapse of time feels like something is not  
> completely working. Also this actually doesn't always happens,  
> sometimes it does it right, so it's not consistent.

While I'm not very familiar with how the pause process works, there is an inherent race
condition between the decision to pause itself and incoming messages that are confirmed.

Once a node decides to pause, there may be messages "in flight" that were already
read from the socket and parsed, and being delivered to queues. These processes
(in both general and Erlang sense) can run in parallel on machines with over 1 core.

I'm not sure there is a one-size-fits-all solution on the server end. Try publishing
batches of messages and wait for confirms for a batch (and not a single message).
Then you'll have to re-try with batches, too, which means if a part of the earlier
batch was lost due to the race condition explained above, they will be retried.

And batching is a recommended practice with publisher confirms anyway.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Wed Jun  4 11:40:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jun 2014 11:40:57 +0100
Subject: [rabbitmq-discuss] Federating messages in upstream with
 specific routing key
In-Reply-To: <1401839006941-36015.post@n5.nabble.com>
References: <1401839006941-36015.post@n5.nabble.com>
Message-ID: <538EF7B9.1060709@rabbitmq.com>

On 04/06/14 00:43, vish.ramachandran wrote:
> I am in reference to this FAQ at
> https://www.rabbitmq.com/federated-exchanges.html
>
> ==========
> Are all messages copied?
> Only those messages that need to be copied are propagated. This is an
> optimisation arranged dynamically by the federation plugin. (See below.)
>
> ==========
>
> My situation requires me to federate from an upstream exchange only messages
> with a specific routing key. The above FAQ seems to indicate this is
> possible. However, I didn't find any option that allows me to specify a
> routing key while configuring upstream queue.
>
> Is this possible ?

It's automatic; there's nothing special to configure.

Federation will add a binding upstream when you add a binding 
downstream, and keep the bindings in sync. So only messages that will be 
delivered downstream get transmitted over the link.

Or are you saying you explicitly want to prevent messages from being 
federated, even if someone binds downstream saying they want them? In 
that case, you would need to do something like:

1) Declare two exchanges, A and B upstream. Ensure you publish to A.
2) Bind A (source) and B (destination) with the routing key you want to 
use to limit federated messages.
3) Set B as the upstream exchange for the federated exchange downstream.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Jun  4 11:50:13 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jun 2014 11:50:13 +0100
Subject: [rabbitmq-discuss] Pause minority cluster with publisher
 confirms losing messages
In-Reply-To: <etPan.538ef37b.ded7263.e723@mercurio.local>
References: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
 <etPan.538ed640.4db127f8.e723@mercurio.local>
 <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>
 <etPan.538ef37b.ded7263.e723@mercurio.local>
Message-ID: <538EF9E5.7040803@rabbitmq.com>

On 04/06/14 11:22, Michael Klishin wrote:
> While I'm not very familiar with how the pause process works, there is an inherent race
> condition between the decision to pause itself and incoming messages that are confirmed.
>
> Once a node decides to pause, there may be messages "in flight" that were already
> read from the socket and parsed, and being delivered to queues. These processes
> (in both general and Erlang sense) can run in parallel on machines with over 1 core.

Yes, that's correct. Now at the moment the window can be of a reasonable 
size, as when minority detection kicks in we do a graceful shutdown. We 
could reduce the size of the window by telling all channels to 
immediately close before doing anything else, but we can't eliminate the 
window altogether.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From miguel.araujo.perez at gmail.com  Wed Jun  4 11:04:28 2014
From: miguel.araujo.perez at gmail.com (=?UTF-8?Q?Miguel_Araujo_P=C3=A9rez?=)
Date: Wed, 4 Jun 2014 12:04:28 +0200
Subject: [rabbitmq-discuss] Pause minority cluster with publisher
 confirms losing messages
In-Reply-To: <etPan.538ed640.4db127f8.e723@mercurio.local>
References: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
 <etPan.538ed640.4db127f8.e723@mercurio.local>
Message-ID: <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>

Hi Michael,

Thanks for your fast reply.

To be honest, I don't mind that when a node goes down in a RabbitMQ cluster
it takes a minute or more to decide that the cluster is broken and what to
do. What I don't fully understand is why the node fallen stops confirming
for a while, then suddenly resumes for some seconds (not always, just some
times) and then stops Rabbit process closing the connection and having
confirmed messages lost.

It's my understanding that the node should do something like, I cannot see
nodes 1 and 2 (connection is broken), I'm by myself here so I cannot
confirm your publishes. Then says I've got to stop, because I'm in
minority. However, the fact that is confirming messages for a small lapse
of time feels like something is not completely working. Also this actually
doesn't always happens, sometimes it does it right, so it's not consistent.

To be honest, i like the trick of having a local RabbitMQ, however for us
it would be simpler just a cluster. Having a local RabbitMQ, maintaing some
federation or shoveling would be a little overkill.

While doing all these tests. Once, when flushing iptables in node3 it has
core dumped some Erlang trace. All times before it simply detects network
and rejoins cluster without issues. is this something i should report? how?

Thanks, cheers
Miguel


2014-06-04 10:17 GMT+02:00 Michael Klishin <mklishin at gopivotal.com>:

>
>
> On 4 June 2014 at 11:58:41, Miguel Araujo P?rez (
> miguel.araujo.perez at gmail.com) wrote:
> > > The issue is that sometimes after a while publisher3 resumes
> > and continues pushing messages and according to the library
> > receiving acks for them, that goes for a period of 6-8 seconds
> > until an exception is raised because connection is closed (node3
> > stops Rabbit). Those "acked messages" aren't however in the
> > queue when I consume it later to see what's inside. However, other
> > times it works as i would expect and doesn't enqueue any other
> > message after iptables takes place.
> >
> > So I thought this could be a library issue, and ported the code
> > to PHP using official php-amqplib and exact same thing happens.
> > My theory is that sometimes node3 after trying to coordinate
> > with other 2 nodes goes into a partition for some seconds, in those
> > seconds it confirms messages and then pause minority cluster
> > policy kicks in and stops Rabbit.
>
> Yes, it takes time for both RabbitMQ and client libraries to detect
> connection failure. This is in part due to how TCP works. You can configure
> the interval of inactivity for RabbitMQ nodes:
>
> https://www.rabbitmq.com/nettick.html
>
> and use a low (say, 1-3 seconds) heartbeat interval for client libraries.
> This should make the exception be thrown much earlier (given that your
> client
> supports it; Pika should) at the cost of having increased network traffic:
>
> http://www.rabbitmq.com/reliability.html
>
> Beyond that, your apps can publish last N messages (excessively) after a
> network
> failure. If your consumers can de-duplicate them (e.g. every message has
> an id you can set),
> that should work well.
>
> If that's not the case, there is a trick that some companies do: they run
> a RabbitMQ
> node local to machine (which at least greatly reduces the probability of
> RabbitMQ becoming
> unreachable), publish with publisher confirms and a low heartbeat interval
> to the local
> node and use Federation [1] or Shovel [2] to connect that node to other
> nodes.
>
> By the way, there are only two official clients: Java and .NET.
>
> 1. http://www.rabbitmq.com/federation.html
> 2. http://www.rabbitmq.com/shovel.html
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/40447598/attachment.html>

From mklishin at gopivotal.com  Wed Jun  4 11:57:45 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 14:57:45 +0400
Subject: [rabbitmq-discuss] Pause minority cluster with publisher
 confirms losing messages
In-Reply-To: <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>
References: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
 <etPan.538ed640.4db127f8.e723@mercurio.local>
 <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>
Message-ID: <etPan.538efbc7.7fdcc233.e723@mercurio.local>

On 4 June 2014 at 14:55:57, Miguel Araujo P?rez (miguel.araujo.perez at gmail.com) wrote:
> > While doing all these tests. Once, when flushing iptables in  
> node3 it has core dumped some Erlang trace. All times before it  
> simply detects network and rejoins cluster without issues.  
> is this something i should report? how?

Miguel,

We have filed a bug for the general issue here. Feel free to post the trace
you see to the list (unless you think it contains sensitive information, which
is probably doesn't).?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From dcodix at gmail.com  Wed Jun  4 12:08:10 2014
From: dcodix at gmail.com (Dan C)
Date: Wed, 4 Jun 2014 13:08:10 +0200
Subject: [rabbitmq-discuss] |Spam| Disk mirrored queues deleting messages
Message-ID: <CA+8+0E+h6Bu=bc4ZM9pumx8y4DgxFNrErnWwqOsf6bfG_OrEhA@mail.gmail.com>

Hi,

I'm doing some testing with rabbitmq 3.1.5 .
I don't know if I am doing something wrong or it is the normal behabiour,
but, when I setup a 2 nodes cluster, both to disk and everytghing
persistent, and withe the policy:
rabbitmqctl set_policy  ha-all "^ha_" '{"ha-mode":"all"}'

The system does something I don't understand.
If I create and send messages to a "ha_helloworld" queue those messages are
sent to both nodes, and I can see how both nodes save those messages to
disc as I can see how the "mnesia" directory grows.
If I stop one of the nodes the space of "mnesia" in that node increase
(??), but when I start it again it will just decrease and lose all messages.

Now, If I were to do the same with the second node, with the first node
already restarted, the second node will just loose all messages to, so I
will be losing all messages from the cluster.

I'll show the process at the end of the mail.

I don't know if this is the normal behabiour. I thougt that it is, as maybe
it would be difficult to the server on the restarted node to know which
messages has been already consumed while it was down. But if it is the
case, why would anyone has a mirrored queue write to disk if all data can
be lost anyway?

I already tryed to find info about this fact but without success...

Here the process of both nodes:


----------------------------------------------------------------------------------
NODE 1
[root at ip-10-0-11-105 rabbitmq]# pwd
/var/lib/rabbitmq
[root at ip-10-0-11-105 rabbitmq]# du -hs *
1.4M erl_crash.dump
2.3M mnesia

(send some messages)

[root at ip-10-0-11-105 rabbitmq]# rabbitmqctl list_queues
Listing queues ...
ha_hello 10000
...done.
[root at ip-10-0-11-105 rabbitmq]# du -hs *
1.4M erl_crash.dump
4.6M mnesia
[root at ip-10-0-11-105 rabbitmq]# /etc/init.d/rabbitmq-server stop
Stopping rabbitmq-server: rabbitmq-server.
[root at ip-10-0-11-105 rabbitmq]# du -hs *
1.4M erl_crash.dump
5.2M mnesia
[root at ip-10-0-11-105 rabbitmq]# /etc/init.d/rabbitmq-server start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.
[root at ip-10-0-11-105 rabbitmq]# du -hs *
1.4M erl_crash.dump
2.3M mnesia

(restart seccond node)

[root at ip-10-0-11-105 rabbitmq]#  rabbitmqctl list_queues
Listing queues ...
ha_hello 0
...done.
[root at ip-10-0-11-105 rabbitmq]# du -hs *
1.4M erl_crash.dump
2.3M mnesia

----------------------------------------------------------------------------------

NODE 2

[root at ip-10-0-10-175 rabbitmq]# pwd
/var/lib/rabbitmq
[root at ip-10-0-10-175 rabbitmq]# du -hs *
1.2M erl_crash.dump
2.3M mnesia

(send some messages)

[root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
Listing queues ...
ha_hello 10000
...done.
[root at ip-10-0-10-175 rabbitmq]# du -hs *
1.2M erl_crash.dump
4.6M mnesia

(stop other node)

[root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
Listing queues ...
ha_hello 10000
...done.
[root at ip-10-0-10-175 rabbitmq]# du -hs *
1.2M erl_crash.dump
4.6M mnesia

[root at ip-10-0-10-175 rabbitmq]# /etc/init.d/rabbitmq-server stop
Stopping rabbitmq-server: rabbitmq-server.
[root at ip-10-0-10-175 rabbitmq]# du -hs *
1.2M erl_crash.dump
5.2M mnesia
[root at ip-10-0-10-175 rabbitmq]# /etc/init.d/rabbitmq-server start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.
[root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
Listing queues ...
ha_hello 0
...done.
[root at ip-10-0-10-175 rabbitmq]# du -hs *
1.2M erl_crash.dump
2.3M mnesia

----------------------------------------------------------------------------------

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/f9d95fb7/attachment.html>

From simon at rabbitmq.com  Wed Jun  4 12:13:19 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jun 2014 12:13:19 +0100
Subject: [rabbitmq-discuss] |Spam| Disk mirrored queues deleting messages
In-Reply-To: <CA+8+0E+h6Bu=bc4ZM9pumx8y4DgxFNrErnWwqOsf6bfG_OrEhA@mail.gmail.com>
References: <CA+8+0E+h6Bu=bc4ZM9pumx8y4DgxFNrErnWwqOsf6bfG_OrEhA@mail.gmail.com>
Message-ID: <538EFF4F.1010904@rabbitmq.com>

Please read: http://www.rabbitmq.com/ha.html#unsynchronised-slaves

(and also: there have been quite a few fixes to mirrored queues since 
3.1.5, you are strongly advised to upgrade)

Cheers, Simon

On 04/06/14 12:08, Dan C wrote:
> Hi,
>
> I'm doing some testing with rabbitmq 3.1.5 .
> I don't know if I am doing something wrong or it is the normal
> behabiour, but, when I setup a 2 nodes cluster, both to disk and
> everytghing persistent, and withe the policy:
> rabbitmqctl set_policy  ha-all "^ha_" '{"ha-mode":"all"}'
>
> The system does something I don't understand.
> If I create and send messages to a "ha_helloworld" queue those messages
> are sent to both nodes, and I can see how both nodes save those messages
> to disc as I can see how the "mnesia" directory grows.
> If I stop one of the nodes the space of "mnesia" in that node increase
> (??), but when I start it again it will just decrease and lose all messages.
>
> Now, If I were to do the same with the second node, with the first node
> already restarted, the second node will just loose all messages to, so I
> will be losing all messages from the cluster.
>
> I'll show the process at the end of the mail.
>
> I don't know if this is the normal behabiour. I thougt that it is, as
> maybe it would be difficult to the server on the restarted node to know
> which messages has been already consumed while it was down. But if it is
> the case, why would anyone has a mirrored queue write to disk if all
> data can be lost anyway?
>
> I already tryed to find info about this fact but without success...
>
> Here the process of both nodes:
>
>
> ----------------------------------------------------------------------------------
> NODE 1
> [root at ip-10-0-11-105 rabbitmq]# pwd
> /var/lib/rabbitmq
> [root at ip-10-0-11-105 rabbitmq]# du -hs *
> 1.4Merl_crash.dump
> 2.3Mmnesia
>
> (send some messages)
>
> [root at ip-10-0-11-105 rabbitmq]# rabbitmqctl list_queues
> Listing queues ...
> ha_hello10000
> ...done.
> [root at ip-10-0-11-105 rabbitmq]# du -hs *
> 1.4Merl_crash.dump
> 4.6Mmnesia
> [root at ip-10-0-11-105 rabbitmq]# /etc/init.d/rabbitmq-server stop
> Stopping rabbitmq-server: rabbitmq-server.
> [root at ip-10-0-11-105 rabbitmq]# du -hs *
> 1.4Merl_crash.dump
> 5.2Mmnesia
> [root at ip-10-0-11-105 rabbitmq]# /etc/init.d/rabbitmq-server start
> Starting rabbitmq-server: SUCCESS
> rabbitmq-server.
> [root at ip-10-0-11-105 rabbitmq]# du -hs *
> 1.4Merl_crash.dump
> 2.3Mmnesia
>
> (restart seccond node)
>
> [root at ip-10-0-11-105 rabbitmq]#  rabbitmqctl list_queues
> Listing queues ...
> ha_hello0
> ...done.
> [root at ip-10-0-11-105 rabbitmq]# du -hs *
> 1.4Merl_crash.dump
> 2.3Mmnesia
>
> ----------------------------------------------------------------------------------
>
> NODE 2
>
> [root at ip-10-0-10-175 rabbitmq]# pwd
> /var/lib/rabbitmq
> [root at ip-10-0-10-175 rabbitmq]# du -hs *
> 1.2Merl_crash.dump
> 2.3Mmnesia
>
> (send some messages)
>
> [root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
> Listing queues ...
> ha_hello10000
> ...done.
> [root at ip-10-0-10-175 rabbitmq]# du -hs *
> 1.2Merl_crash.dump
> 4.6Mmnesia
>
> (stop other node)
>
> [root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
> Listing queues ...
> ha_hello10000
> ...done.
> [root at ip-10-0-10-175 rabbitmq]# du -hs *
> 1.2Merl_crash.dump
> 4.6Mmnesia
>
> [root at ip-10-0-10-175 rabbitmq]# /etc/init.d/rabbitmq-server stop
> Stopping rabbitmq-server: rabbitmq-server.
> [root at ip-10-0-10-175 rabbitmq]# du -hs *
> 1.2Merl_crash.dump
> 5.2Mmnesia
> [root at ip-10-0-10-175 rabbitmq]# /etc/init.d/rabbitmq-server start
> Starting rabbitmq-server: SUCCESS
> rabbitmq-server.
> [root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
> Listing queues ...
> ha_hello0
> ...done.
> [root at ip-10-0-10-175 rabbitmq]# du -hs *
> 1.2Merl_crash.dump
> 2.3Mmnesia
>
> ----------------------------------------------------------------------------------
>
> Thanks!
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From ranjithavshet09 at gmail.com  Wed Jun  4 12:20:13 2014
From: ranjithavshet09 at gmail.com (Ranjitha Shet)
Date: Wed, 4 Jun 2014 16:50:13 +0530
Subject: [rabbitmq-discuss] Autorecovery Issue
Message-ID: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>

Hi,

I am trying to use the autorecovery feature..


public ConnectToRabbitMq(String sServeltName, String sDeviceName, Object
oStreamType) throws IOException {

        /* *****create a connection to the server/broker:******************/
        ConnectionFactory factory = new ConnectionFactory();

        factory.setAutomaticRecoveryEnabled(true);

        factory.setUsername(USERNAME);//the AMQP user name used when
connecting to the broker
        factory.setPassword(PASSWORD);//the password used when connecting
to the broker
        factory.setVirtualHost(VHOST);//the virtual host used when
connecting to the broker
        factory.setHost(HOST);//connect to a broker on the local machine -
hence the localhost.
        factory.setPort(PORT);//the default port used for connections

        connection = factory.newConnection();
        channel = connection.createChannel();// data channel, opens channel

        /* *****create a connection to the server/broker:******************/

            /* ******declare que and exch******************/

            exchangeName = sDeviceName;
            queueName = new
StringBuffer(sServeltName).append('_').append(exchangeName).toString();

            channel.exchangeDeclare(exchangeName, "topic", false, false,
null);
            channel.queueDeclare(queueName, false, false, true, null);

            /* ******declare que and exch******************/

            String replytoBindinKey = SOMEKEY;

            channel.queueBind(queueName, exchangeName, replytoBindinKey);

            consumer = new QueueingConsumer(channel);
            channel.basicConsume(queueName, true, consumer);

    }

What I am trying to do is..,
I publish a message(request) to a particular exchange.., it goes to server
and in server side.., based on request published and routingkey,, response
is published from server side..
and I receive the response..

To publish I use  --> channel.basicPublish

and to receive message what I do is -->

while(true){

QueueingConsumer.Delivery delivery = consumer.nextDelivery();
..
..
}

when I disconnect the network cable, say it gets disconnected when both
receiving and publishing takes place.. (Message published and received are
different messages(same exchange))
 I get the following message.

Caught an exception during connection recovery!
java.net.NoRouteToHostException: No route to host: connect
at java.net.PlainSocketImpl.socketConnect(Native Method)
at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
at java.net.Socket.connect(Socket.java:519)
at
com.rabbitmq.client.impl.FrameHandlerFactory.create(FrameHandlerFactory.java:32)
at
com.rabbitmq.client.impl.recovery.RecoveryAwareAMQConnectionFactory.newConnection(RecoveryAwareAMQConnectionFactory.java:34)
at
com.rabbitmq.client.impl.recovery.AutorecoveringConnection.recoverConnection(AutorecoveringConnection.java:388)
at
com.rabbitmq.client.impl.recovery.AutorecoveringConnection.beginAutomaticRecovery(AutorecoveringConnection.java:360)
at
com.rabbitmq.client.impl.recovery.AutorecoveringConnection.access$000(AutorecoveringConnection.java:48)
at
com.rabbitmq.client.impl.recovery.AutorecoveringConnection$1.shutdownCompleted(AutorecoveringConnection.java:345)
at
com.rabbitmq.client.impl.ShutdownNotifierComponent.notifyListeners(ShutdownNotifierComponent.java:75)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:572)
at java.lang.Thread.run(Thread.java:619)
 and on connecting back.., if server side publish message to tat particular
exchange.., wont receive any message in my application,, and I get this
error

DefaultExceptionHandler: Consumer
com.rabbitmq.client.QueueingConsumer at 137d090
(amq.ctag-gl009sKgA7rr2PyKA1MxAS) method handleDelivery for channel
AMQChannel(amqp://guest at localhost:5672/,1) threw an exception for channel
AMQChannel(amqp://guest at localhost:5672/,1):
com.rabbitmq.client.ShutdownSignalException: connection error
at
com.rabbitmq.client.QueueingConsumer.checkShutdown(QueueingConsumer.java:172)
at
com.rabbitmq.client.QueueingConsumer.handleDelivery(QueueingConsumer.java:124)
at
com.rabbitmq.client.impl.ConsumerDispatcher$5.run(ConsumerDispatcher.java:140)
at
com.rabbitmq.client.impl.ConsumerWorkService$WorkPoolRunnable.run(ConsumerWorkService.java:85)
at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
at java.lang.Thread.run(Thread.java:619)
Caused by: java.net.SocketException: Software caused connection abort: recv
failed
at java.net.SocketInputStream.socketRead0(Native Method)
at java.net.SocketInputStream.read(SocketInputStream.java:129)
at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:139)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:532)
... 1 more


On connecting back the network cable.., connection , channel, exchange, que
and binding cant be recovered? Not getting where I am going wrong..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/0bed955c/attachment.html>

From simon at rabbitmq.com  Wed Jun  4 12:20:28 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jun 2014 12:20:28 +0100
Subject: [rabbitmq-discuss] RMQ stuck in startup
In-Reply-To: <083E352F62C9974389AD0F9F875EA238188FE9D54F@THSONEA03CMS03P.ONE-03.GRP>
References: <083E352F62C9974389AD0F9F875EA238188FE9D54F@THSONEA03CMS03P.ONE-03.GRP>
Message-ID: <538F00FC.8000609@rabbitmq.com>

On 03/06/14 17:53, EDDY James wrote:
> Status of node rabbit at node2 ...
> Error: {{case_clause,starting},
>          [{rabbit_vm,mnesia_memory,0,[]},
>           {rabbit_vm,memory,0,[]},
>           {rabbit,status,0,[]},
>           {rpc,'-handle_call_call/6-fun-0-',5,[{file,"rpc.erl"},{line,205}]}]}

So it looks like "rabbitmqctl status" doesn't correctly handle being 
invoked while Mnesia is starting (or stopping). This will be fixed in 
the next release.

> node2 will stay in this state indefinitely. Has anyone seen anything
> like this before? Any ideas what might cause this, or where to further
> investigate (like epmd? mnesia init issue? etc)?

It's definitely Mnesia hanging on startup; more than that I don't know.

* Is there anything interesting in the node2 logs?
* Can you try upgrading Erlang?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Wed Jun  4 12:37:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 15:37:09 +0400
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
Message-ID: <etPan.538f0502.6b68079a.e723@mercurio.local>

On 4 June 2014 at 15:22:30, Ranjitha Shet (ranjithavshet09 at gmail.com) wrote:
> > Caught an exception during connection recovery!
> java.net.NoRouteToHostException: No route to host: connect  

This means that RabbitMQ Java client cannot connect to the broker because
OS cannot route packets to it (expected with the network cable being pulled out).

There is a bug fix in the upcoming 3.3.2 release that makes sure any exception
(including the one above) results in a reconnection attempt after a grace period.
Previously only some network I/O exceptions triggered reconnection.

Try with a nighly build of the client if you can.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun  4 13:09:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 16:09:47 +0400
Subject: [rabbitmq-discuss] Fw: Re:  SSL upgrade error cacrtfile
Message-ID: <etPan.538f0ca9.25e45d32.e723@mercurio.local>

On 4 June 2014 at 16:08:14, Narayan Reddy (bvnr.mail at gmail.com) wrote:
> Hi Michael,
> Thanks for your reply, Please help me out to fix this issue.
> 
> *What client do you use?*
> I needs to use the cpp client, but the ssl connection is not happening even
> with openssl util (in s_client mode)
> *Do you configure SSL to any specific version?*
> No, Not aware of this how can i check that can you give me command to check
> 
> *# erl*
> *Erlang R16B (erts-5.10.1) [source] [smp:8:8] [async-threads:10] [hipe]
> [kernel-poll:false]*
> 
> *Eshell V5.10.1 (abort with ^G)*
> *1> ssl:versions().*
> *[{ssl_app,"5.2.1"},*
> * {supported,['tlsv1.2','tlsv1.1',tlsv1,sslv3]},*
> * {available,['tlsv1.2','tlsv1.1',tlsv1,sslv3]}]*
> *2>*
> *2>*
> 
> 
> *What OS does your client and RabbitMQ run on?*
> # cat /etc/redhat-release
> Red Hat Enterprise Linux Server release 6.2 (Santiago)
> 
> My Rabbitmq.config file
> 
> *# cat /etc/rabbitmq/rabbitmq.config*
> *[*
> * {rabbit, [*
> * {ssl_listeners, [5671]},*
> * {ssl_options, [{cacertfile,"/home/prime/SSL/testca/cacert.pem"},*
> * {certfile,"/home/prime/SSL/server/cert.pem"},*
> * {keyfile,"/home/prime/SSL/server/key.pem"},*
> * {verify,verify_peer},*
> * {fail_if_no_peer_cert,true}]},*
> 
> * {loopback_users, []}*
> * ]}*
> *].*
> 
> Openssl client output:
> 
> *$ openssl s_client -connect localhost:5671 -cert client/cert.pem -key
> client/key.pem -CAfile testca/cacert.pem*
> *CONNECTED(00000003)*
> *write:errno=104*
> *---*
> *no peer certificate available*
> *---*
> *No client certificate CA names sent*
> *---*
> *SSL handshake has read 0 bytes and written 113 bytes*
> *---*
> *New, (NONE), Cipher is (NONE)*
> *Secure Renegotiation IS NOT supported*
> *Compression: NONE*
> *Expansion: NONE*
> *---*
> 
> 
> rabbitmq broker.log
> 
> *=INFO REPORT==== 4-Jun-2014::17:27:17 ===*
> *accepting AMQP connection <0.951.0> (127.0.0.1:38486
> -> 127.0.0.1:5671 )*
> 
> *=ERROR REPORT==== 4-Jun-2014::17:27:22 ===*
> *error on AMQP connection <0.951.0>:
> {ssl_upgrade_error,{options,{cacertfile,[47,104,111,109,101,47,112,114,105,109,101,47,83,83,76,47...* 
> 
> 
> --
> Thanks & Regards
> Narayan
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun  4 13:13:49 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 16:13:49 +0400
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
Message-ID: <etPan.538f0d98.519b500d.e723@mercurio.local>

Narayan,

please keep rabbitmq-discuss in CC.?

On 4 June 2014 at 16:08:14, Narayan Reddy (bvnr.mail at gmail.com) wrote:
> > What client do you use?
> I needs to use the cpp client,

Which one? Can you link to it?

> but the ssl connection is not happening  
> even with openssl util (in s_client mode)

?

> Openssl client output:
>  
> $ openssl s_client -connect localhost:5671 -cert client/cert.pem  
> -key client/key.pem -CAfile testca/cacert.pem
> CONNECTED(00000003)
> write:errno=104
> ---
> no peer certificate available
> ---
> No client certificate CA names sent
> ---
> SSL handshake has read 0 bytes and written 113 bytes
> ---
> New, (NONE), Cipher is (NONE)
> Secure Renegotiation IS NOT su

This suggests the client and the server cannot agree on a shared cipher suite
to use.

What do

?* openssl version
?*?openssl ciphers -v

output for you?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun  4 13:25:32 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 16:25:32 +0400
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
Message-ID: <etPan.538f1058.431bd7b7.e723@mercurio.local>

On 4 June 2014 at 16:19:05, Ranjitha Shet (ranjithavshet09 at gmail.com) wrote:
> > >>>> Try with a nighly build of the client if you can.
>  
> there are other packages released after 3.3.1? Intermediate  
> version?

Please keep rabbitmq-discuss in CC.

http://www.rabbitmq.com/nightlies/rabbitmq-java-client/ has nightly builds
of the Java client. Unfortunately, it seems ?there's a problem with producing nightly builds
and the May 5th version does not include the fix I've mentioned.

Here's how to build the client from source:

http://www.rabbitmq.com/build-java-client.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From bvnr.mail at gmail.com  Wed Jun  4 13:20:12 2014
From: bvnr.mail at gmail.com (Narayan Reddy)
Date: Wed, 4 Jun 2014 17:50:12 +0530
Subject: [rabbitmq-discuss] Fwd:  SSL upgrade error cacrtfile
Message-ID: <CAKV0HmP5ecqa9hOo5wBUJy71AX6ehRj2hcBP9HN=P1cMhHE2kw@mail.gmail.com>

Hi Michael,
                Thanks for your reply, Please help me out to fix this issue.

*What client do you use?*
I needs to use the cpp client, but the ssl connection is not happening even
with openssl util (in s_client mode)
*Do you configure SSL to any specific version?*
No, Not aware of this how can i check that can you give me command to check

*# erl*
*Erlang R16B (erts-5.10.1) [source] [smp:8:8] [async-threads:10] [hipe]
[kernel-poll:false]*

*Eshell V5.10.1  (abort with ^G)*
*1> ssl:versions().*
*[{ssl_app,"5.2.1"},*
* {supported,['tlsv1.2','tlsv1.1',tlsv1,sslv3]},*
* {available,['tlsv1.2','tlsv1.1',tlsv1,sslv3]}]*
*2>*
*2>*


*What OS does your client and RabbitMQ run on?*
# cat /etc/redhat-release
Red Hat Enterprise Linux Server release 6.2 (Santiago)

My Rabbitmq.config file

*# cat /etc/rabbitmq/rabbitmq.config*
*[*
*  {rabbit, [*
*     {ssl_listeners, [5671]},*
*     {ssl_options, [{cacertfile,"/home/prime/SSL/testca/cacert.pem"},*
*                    {certfile,"/home/prime/SSL/server/cert.pem"},*
*                    {keyfile,"/home/prime/SSL/server/key.pem"},*
*                    {verify,verify_peer},*
*                    {fail_if_no_peer_cert,true}]},*

*  {loopback_users, []}*
*   ]}*
*].*

Openssl client output:

*$ openssl s_client -connect localhost:5671 -cert client/cert.pem  -key
client/key.pem  -CAfile testca/cacert.pem*
*CONNECTED(00000003)*
*write:errno=104*
*---*
*no peer certificate available*
*---*
*No client certificate CA names sent*
*---*
*SSL handshake has read 0 bytes and written 113 bytes*
*---*
*New, (NONE), Cipher is (NONE)*
*Secure Renegotiation IS NOT supported*
*Compression: NONE*
*Expansion: NONE*
*---*


rabbitmq broker.log

 *=INFO REPORT==== 4-Jun-2014::17:27:17 ===*
*accepting AMQP connection <0.951.0> (127.0.0.1:38486
<http://127.0.0.1:38486> -> 127.0.0.1:5671 <http://127.0.0.1:5671>)*

*=ERROR REPORT==== 4-Jun-2014::17:27:22 ===*
*error on AMQP connection <0.951.0>:
{ssl_upgrade_error,{options,{cacertfile,[47,104,111,109,101,47,112,114,105,109,101,47,83,83,76,47...*


--
Thanks & Regards
Narayan


On 4 June 2014 13:37, Michael Klishin <mklishin at gopivotal.com> wrote:

>  On 4 June 2014 at 12:00:48, Narayan (bvnr.mail at gmail.com) wrote:
> > > * Check SSL support in Erlang ----- SUCCESS
> > ssl:versions().
> > SSL version: [{ssl_app,"5.3"},
> > {supported,['tlsv1.2','tlsv1.1',tlsv1,sslv3]},
> > {available,['tlsv1.2','tlsv1.1',tlsv1,sslv3]}]
> > RabbitMQ 3.3.0, Erlang R16B01
>
> What client do you use? Do you configure SSL to any specific version?
> What OS does your client and RabbitMQ run on?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/67d0497d/attachment.html>

From bvnr.mail at gmail.com  Wed Jun  4 13:27:55 2014
From: bvnr.mail at gmail.com (Narayan Reddy)
Date: Wed, 4 Jun 2014 17:57:55 +0530
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <etPan.538f0d98.519b500d.e723@mercurio.local>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
Message-ID: <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>

Hi Michael,
           Thanks for the reply, Ignore the duplicate mail sorry for that.
           First I want to check with openssl util, if it works fine then i
can go to cpp client.










*This suggests the client and the server cannot agree on a shared cipher
suite to use.What do  * openssl version * openssl ciphers -v output for
you?*

# openssl version
OpenSSL 1.0.0-fips 29 Mar 2010


# openssl ciphers -v
DHE-RSA-AES256-SHA      SSLv3 Kx=DH       Au=RSA  Enc=AES(256)  Mac=SHA1
DHE-DSS-AES256-SHA      SSLv3 Kx=DH       Au=DSS  Enc=AES(256)  Mac=SHA1
DHE-RSA-CAMELLIA256-SHA SSLv3 Kx=DH       Au=RSA  Enc=Camellia(256) Mac=SHA1
DHE-DSS-CAMELLIA256-SHA SSLv3 Kx=DH       Au=DSS  Enc=Camellia(256) Mac=SHA1
AES256-SHA              SSLv3 Kx=RSA      Au=RSA  Enc=AES(256)  Mac=SHA1
CAMELLIA256-SHA         SSLv3 Kx=RSA      Au=RSA  Enc=Camellia(256) Mac=SHA1
PSK-AES256-CBC-SHA      SSLv3 Kx=PSK      Au=PSK  Enc=AES(256)  Mac=SHA1
EDH-RSA-DES-CBC3-SHA    SSLv3 Kx=DH       Au=RSA  Enc=3DES(168) Mac=SHA1
EDH-DSS-DES-CBC3-SHA    SSLv3 Kx=DH       Au=DSS  Enc=3DES(168) Mac=SHA1
DES-CBC3-SHA            SSLv3 Kx=RSA      Au=RSA  Enc=3DES(168) Mac=SHA1
PSK-3DES-EDE-CBC-SHA    SSLv3 Kx=PSK      Au=PSK  Enc=3DES(168) Mac=SHA1
KRB5-DES-CBC3-SHA       SSLv3 Kx=KRB5     Au=KRB5 Enc=3DES(168) Mac=SHA1
KRB5-DES-CBC3-MD5       SSLv3 Kx=KRB5     Au=KRB5 Enc=3DES(168) Mac=MD5
DHE-RSA-AES128-SHA      SSLv3 Kx=DH       Au=RSA  Enc=AES(128)  Mac=SHA1
DHE-DSS-AES128-SHA      SSLv3 Kx=DH       Au=DSS  Enc=AES(128)  Mac=SHA1
DHE-RSA-SEED-SHA        SSLv3 Kx=DH       Au=RSA  Enc=SEED(128) Mac=SHA1
DHE-DSS-SEED-SHA        SSLv3 Kx=DH       Au=DSS  Enc=SEED(128) Mac=SHA1
DHE-RSA-CAMELLIA128-SHA SSLv3 Kx=DH       Au=RSA  Enc=Camellia(128) Mac=SHA1
DHE-DSS-CAMELLIA128-SHA SSLv3 Kx=DH       Au=DSS  Enc=Camellia(128) Mac=SHA1
AES128-SHA              SSLv3 Kx=RSA      Au=RSA  Enc=AES(128)  Mac=SHA1
SEED-SHA                SSLv3 Kx=RSA      Au=RSA  Enc=SEED(128) Mac=SHA1
CAMELLIA128-SHA         SSLv3 Kx=RSA      Au=RSA  Enc=Camellia(128) Mac=SHA1
PSK-AES128-CBC-SHA      SSLv3 Kx=PSK      Au=PSK  Enc=AES(128)  Mac=SHA1
RC4-SHA                 SSLv3 Kx=RSA      Au=RSA  Enc=RC4(128)  Mac=SHA1
RC4-MD5                 SSLv3 Kx=RSA      Au=RSA  Enc=RC4(128)  Mac=MD5
PSK-RC4-SHA             SSLv3 Kx=PSK      Au=PSK  Enc=RC4(128)  Mac=SHA1
KRB5-RC4-SHA            SSLv3 Kx=KRB5     Au=KRB5 Enc=RC4(128)  Mac=SHA1
KRB5-RC4-MD5            SSLv3 Kx=KRB5     Au=KRB5 Enc=RC4(128)  Mac=MD5
EDH-RSA-DES-CBC-SHA     SSLv3 Kx=DH       Au=RSA  Enc=DES(56)   Mac=SHA1
EDH-DSS-DES-CBC-SHA     SSLv3 Kx=DH       Au=DSS  Enc=DES(56)   Mac=SHA1
DES-CBC-SHA             SSLv3 Kx=RSA      Au=RSA  Enc=DES(56)   Mac=SHA1
KRB5-DES-CBC-SHA        SSLv3 Kx=KRB5     Au=KRB5 Enc=DES(56)   Mac=SHA1
KRB5-DES-CBC-MD5        SSLv3 Kx=KRB5     Au=KRB5 Enc=DES(56)   Mac=MD5
EXP-EDH-RSA-DES-CBC-SHA SSLv3 Kx=DH(512)  Au=RSA  Enc=DES(40)   Mac=SHA1
export
EXP-EDH-DSS-DES-CBC-SHA SSLv3 Kx=DH(512)  Au=DSS  Enc=DES(40)   Mac=SHA1
export
EXP-DES-CBC-SHA         SSLv3 Kx=RSA(512) Au=RSA  Enc=DES(40)   Mac=SHA1
export
EXP-RC2-CBC-MD5         SSLv3 Kx=RSA(512) Au=RSA  Enc=RC2(40)   Mac=MD5
 export
EXP-KRB5-RC2-CBC-SHA    SSLv3 Kx=KRB5     Au=KRB5 Enc=RC2(40)   Mac=SHA1
export
EXP-KRB5-DES-CBC-SHA    SSLv3 Kx=KRB5     Au=KRB5 Enc=DES(40)   Mac=SHA1
export
EXP-KRB5-RC2-CBC-MD5    SSLv3 Kx=KRB5     Au=KRB5 Enc=RC2(40)   Mac=MD5
 export
EXP-KRB5-DES-CBC-MD5    SSLv3 Kx=KRB5     Au=KRB5 Enc=DES(40)   Mac=MD5
 export
EXP-RC4-MD5             SSLv3 Kx=RSA(512) Au=RSA  Enc=RC4(40)   Mac=MD5
 export
EXP-KRB5-RC4-SHA        SSLv3 Kx=KRB5     Au=KRB5 Enc=RC4(40)   Mac=SHA1
export
EXP-KRB5-RC4-MD5        SSLv3 Kx=KRB5     Au=KRB5 Enc=RC4(40)   Mac=MD5
 export



On 4 June 2014 17:43, Michael Klishin <mklishin at gopivotal.com> wrote:

> Narayan,
>
> please keep rabbitmq-discuss in CC.
>
> On 4 June 2014 at 16:08:14, Narayan Reddy (bvnr.mail at gmail.com) wrote:
> > > What client do you use?
> > I needs to use the cpp client,
>
> Which one? Can you link to it?
>
> > but the ssl connection is not happening
> > even with openssl util (in s_client mode)
>
> ?
>
> > Openssl client output:
> >
> > $ openssl s_client -connect localhost:5671 -cert client/cert.pem
> > -key client/key.pem -CAfile testca/cacert.pem
> > CONNECTED(00000003)
> > write:errno=104
> > ---
> > no peer certificate available
> > ---
> > No client certificate CA names sent
> > ---
> > SSL handshake has read 0 bytes and written 113 bytes
> > ---
> > New, (NONE), Cipher is (NONE)
> > Secure Renegotiation IS NOT su
>
> This suggests the client and the server cannot agree on a shared cipher
> suite
> to use.
>
> What do
>
>  * openssl version
>  * openssl ciphers -v
>
> output for you?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/cebce878/attachment.html>

From mklishin at gopivotal.com  Wed Jun  4 14:05:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Jun 2014 17:05:07 +0400
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
Message-ID: <etPan.538f19a0.333ab105.e723@mercurio.local>

On 4 June 2014 at 16:56:11, Narayan Reddy (bvnr.mail at gmail.com) wrote:
> > # openssl ciphers -v

OK, great. What about

io:format("~p~n", [ssl:cipher_suites()]).

from the Erlang shell? (`erl`)
--  
MK ?

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Wed Jun  4 16:21:16 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jun 2014 16:21:16 +0100
Subject: [rabbitmq-discuss] |Spam| Disk mirrored queues deleting messages
In-Reply-To: <CA+8+0E+gGUxVd3621NFNm_H773+TMpZi3+=eFSwA2vT3w5Yy2Q@mail.gmail.com>
References: <CA+8+0E+h6Bu=bc4ZM9pumx8y4DgxFNrErnWwqOsf6bfG_OrEhA@mail.gmail.com>	<538EFF4F.1010904@rabbitmq.com>
 <CA+8+0E+gGUxVd3621NFNm_H773+TMpZi3+=eFSwA2vT3w5Yy2Q@mail.gmail.com>
Message-ID: <538F396C.9090203@rabbitmq.com>

No, it's not.

You can wait for queues to synchronise due to consumers draining 
messages, or you can explicitly synchronise the queue after restarting 
the first node (manually or automatically).

In Mercurial (and thus eventually in 3.4.0 when it is released) RabbitMQ 
will by default shut down a mirrored queue when the master gracefully 
shuts down and there are only unsynchronised slaves to fail over to, 
since people do tend to trip over this.

Cheers, Simon

On 04/06/14 12:27, Dan C wrote:
> OK!
>
> Thanks for the fast answer!
> I was noticing that but I didn't know it "officially".
>
> Do you know if this behabiour is different in newer rabbitmq versions?
>
>
> On Wed, Jun 4, 2014 at 1:13 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Please read: http://www.rabbitmq.com/ha.__html#unsynchronised-slaves
>     <http://www.rabbitmq.com/ha.html#unsynchronised-slaves>
>
>     (and also: there have been quite a few fixes to mirrored queues
>     since 3.1.5, you are strongly advised to upgrade)
>
>     Cheers, Simon
>
>
>     On 04/06/14 12:08, Dan C wrote:
>
>         Hi,
>
>         I'm doing some testing with rabbitmq 3.1.5 .
>         I don't know if I am doing something wrong or it is the normal
>         behabiour, but, when I setup a 2 nodes cluster, both to disk and
>         everytghing persistent, and withe the policy:
>         rabbitmqctl set_policy  ha-all "^ha_" '{"ha-mode":"all"}'
>
>         The system does something I don't understand.
>         If I create and send messages to a "ha_helloworld" queue those
>         messages
>         are sent to both nodes, and I can see how both nodes save those
>         messages
>         to disc as I can see how the "mnesia" directory grows.
>         If I stop one of the nodes the space of "mnesia" in that node
>         increase
>         (??), but when I start it again it will just decrease and lose
>         all messages.
>
>         Now, If I were to do the same with the second node, with the
>         first node
>         already restarted, the second node will just loose all messages
>         to, so I
>         will be losing all messages from the cluster.
>
>         I'll show the process at the end of the mail.
>
>         I don't know if this is the normal behabiour. I thougt that it
>         is, as
>         maybe it would be difficult to the server on the restarted node
>         to know
>         which messages has been already consumed while it was down. But
>         if it is
>         the case, why would anyone has a mirrored queue write to disk if all
>         data can be lost anyway?
>
>         I already tryed to find info about this fact but without success...
>
>         Here the process of both nodes:
>
>
>         ------------------------------__------------------------------__----------------------
>         NODE 1
>         [root at ip-10-0-11-105 rabbitmq]# pwd
>         /var/lib/rabbitmq
>         [root at ip-10-0-11-105 rabbitmq]# du -hs *
>         1.4Merl_crash.dump
>         2.3Mmnesia
>
>         (send some messages)
>
>         [root at ip-10-0-11-105 rabbitmq]# rabbitmqctl list_queues
>         Listing queues ...
>         ha_hello10000
>         ...done.
>         [root at ip-10-0-11-105 rabbitmq]# du -hs *
>         1.4Merl_crash.dump
>         4.6Mmnesia
>         [root at ip-10-0-11-105 rabbitmq]# /etc/init.d/rabbitmq-server stop
>         Stopping rabbitmq-server: rabbitmq-server.
>         [root at ip-10-0-11-105 rabbitmq]# du -hs *
>         1.4Merl_crash.dump
>         5.2Mmnesia
>         [root at ip-10-0-11-105 rabbitmq]# /etc/init.d/rabbitmq-server start
>         Starting rabbitmq-server: SUCCESS
>         rabbitmq-server.
>         [root at ip-10-0-11-105 rabbitmq]# du -hs *
>         1.4Merl_crash.dump
>         2.3Mmnesia
>
>         (restart seccond node)
>
>         [root at ip-10-0-11-105 rabbitmq]#  rabbitmqctl list_queues
>         Listing queues ...
>         ha_hello0
>         ...done.
>         [root at ip-10-0-11-105 rabbitmq]# du -hs *
>         1.4Merl_crash.dump
>         2.3Mmnesia
>
>
>         ------------------------------__------------------------------__----------------------
>
>         NODE 2
>
>         [root at ip-10-0-10-175 rabbitmq]# pwd
>         /var/lib/rabbitmq
>         [root at ip-10-0-10-175 rabbitmq]# du -hs *
>         1.2Merl_crash.dump
>         2.3Mmnesia
>
>         (send some messages)
>
>         [root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
>         Listing queues ...
>         ha_hello10000
>         ...done.
>         [root at ip-10-0-10-175 rabbitmq]# du -hs *
>         1.2Merl_crash.dump
>         4.6Mmnesia
>
>         (stop other node)
>
>         [root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
>         Listing queues ...
>         ha_hello10000
>         ...done.
>         [root at ip-10-0-10-175 rabbitmq]# du -hs *
>         1.2Merl_crash.dump
>         4.6Mmnesia
>
>         [root at ip-10-0-10-175 rabbitmq]# /etc/init.d/rabbitmq-server stop
>         Stopping rabbitmq-server: rabbitmq-server.
>         [root at ip-10-0-10-175 rabbitmq]# du -hs *
>         1.2Merl_crash.dump
>         5.2Mmnesia
>         [root at ip-10-0-10-175 rabbitmq]# /etc/init.d/rabbitmq-server start
>         Starting rabbitmq-server: SUCCESS
>         rabbitmq-server.
>         [root at ip-10-0-10-175 rabbitmq]# rabbitmqctl list_queues
>         Listing queues ...
>         ha_hello0
>         ...done.
>         [root at ip-10-0-10-175 rabbitmq]# du -hs *
>         1.2Merl_crash.dump
>         2.3Mmnesia
>
>         ------------------------------__------------------------------__----------------------
>
>         Thanks!
>
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From Nikunj.Badjatya at emc.com  Wed Jun  4 16:21:47 2014
From: Nikunj.Badjatya at emc.com (Badjatya, Nikunj)
Date: Wed, 4 Jun 2014 15:21:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error,
 not_found}" (server down)
In-Reply-To: <538DB078.3020208@rabbitmq.com>
References: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>
 <etPan.538da663.327b23c6.7a61@mercurio.local> <538DB078.3020208@rabbitmq.com>
Message-ID: <022ADF639A140D4790580A766237164C1D599F7E@MX101CL02.corp.emc.com>

Thank you all for quick replies.
Well this issue was not reproducible and we hit this only once.

I didn?t quite understand the reason given in http://markmail.org/thread/26j56abreqwd32fq#query:+page:1+mid:2j2la4yehcxferjy+state:results link.

Can you please explain it in simpler way?

I am not deleting node as part of any operation. Here are the operations which I am doing currently using Pika python library:

1. Create user using rabbitmqctl
2. Connect to localhost using BlockingConnection
3. get channel
4. create exchange if not done already
5. publish using basic_publish
6. Close connection
6. Delete user using rabbitmqctl


Thanks
Nikunj


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Tuesday, June 03, 2014 4:55 PM
To: Discussions about RabbitMQ
Cc: Badjatya, Nikunj
Subject: Re: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error, not_found}" (server down)

On 03/06/14 11:41, Michael Klishin wrote:
> On 3 June 2014 at 14:15:52, Badjatya, Nikunj (nikunj.badjatya at emc.com) wrote:
>>>
>> Stack trace:
>> [{rabbit_binding,recover_semi_durable_route,3,[]},
>> {rabbit_binding,'-recover/2-lc$^0/1-0-',3,[]},
>> {rabbit_binding,recover,2,[]},
>> {rabbit,recover,0,[]},
>> {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>> {rabbit,run_boot_step,1,[]},
>> {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>> {rabbit,start,2,[]}]
>
> See http://markmail.org/thread/26j56abreqwd32fq and http://markmail.org/thread/ntgfmmmnfrhjodtj.
>
> This is a known bug (#25783) which is not resolved yet.

Actually, there is a bug with the above signature that we fixed in 3.2.0

25822 prevent crash at startup when starting a clustered node hosting a
       durable non-HA queue which had been bound to a transient exchange which
       was deleted when the node was down (since 2.5.0)

Does that at all sound like what might be happening?

If not then, as Simon says, please send him a copy of the mnesia dir off-list.

Matthias.

From vish.ramachandran at gmail.com  Wed Jun  4 16:31:14 2014
From: vish.ramachandran at gmail.com (Viswanathan Ramachandran)
Date: Wed, 4 Jun 2014 08:31:14 -0700
Subject: [rabbitmq-discuss] Supporting both SSL+Password as well as
 SSL+Certificate based authentication
In-Reply-To: <534FC120.5050504@rabbitmq.com>
References: <1397684335559-34914.post@n5.nabble.com>
 <534FC120.5050504@rabbitmq.com>
Message-ID: <CAB_tbjA0YD_1STHcsPkEQeJVx1UBTi-Lteru+fOki7HwoZQsMQ@mail.gmail.com>

Simon,

Can you please confirm if 3.3.2 will have this bug fix as well?

I see that a fix went in from
http://hg.rabbitmq.com/rabbitmq-server/shortlog/13443

*5 days ago**Simon MacMullen**Since we always check the peer cert is there
before using cert authentication we do not need to enforce
fail_if_no_peer_cert. And enforcing it prevents you from doing PLAIN auth
without a cert on the same socket.* bug25550
<http://hg.rabbitmq.com/rabbitmq-server/rev/70b7b3a7578e>changeset
<http://hg.rabbitmq.com/rabbitmq-server/rev/70b7b3a7578e> | files
<http://hg.rabbitmq.com/rabbitmq-server/file/70b7b3a7578e>
Thanks
Vish





On Thu, Apr 17, 2014 at 4:55 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/04/2014 22:38, vish.ramachandran wrote:
>
>> It does not seem right to mandate that password based clients also present
>> valid certificate. If they could, then there is no need for password based
>> authentication.
>>
>
> I'm afraid that is the requirement at the moment. A future release may
> improve this situation.
>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/92b89cf4/attachment.html>

From simon at rabbitmq.com  Wed Jun  4 16:32:47 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jun 2014 16:32:47 +0100
Subject: [rabbitmq-discuss] Supporting both SSL+Password as well as
 SSL+Certificate based authentication
In-Reply-To: <CAB_tbjA0YD_1STHcsPkEQeJVx1UBTi-Lteru+fOki7HwoZQsMQ@mail.gmail.com>
References: <1397684335559-34914.post@n5.nabble.com>	<534FC120.5050504@rabbitmq.com>
 <CAB_tbjA0YD_1STHcsPkEQeJVx1UBTi-Lteru+fOki7HwoZQsMQ@mail.gmail.com>
Message-ID: <538F3C1F.7050302@rabbitmq.com>

On 04/06/14 16:31, Viswanathan Ramachandran wrote:
> Can you please confirm if 3.3.2 will have this bug fix as well?

Yes, it will.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From bvnr.mail at gmail.com  Wed Jun  4 14:44:27 2014
From: bvnr.mail at gmail.com (Narayan Reddy)
Date: Wed, 4 Jun 2014 19:14:27 +0530
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <etPan.538f19a0.333ab105.e723@mercurio.local>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
Message-ID: <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>

# erl
Erlang R16B (erts-5.10.1) [source] [smp:8:8] [async-threads:10] [hipe]
[kernel-poll:false]

Eshell V5.10.1  (abort with ^G)
1> io:format("~p~n", [ssl:cipher_suites()]).
[{dhe_rsa,aes_256_cbc,sha256},
 {dhe_dss,aes_256_cbc,sha256},
 {rsa,aes_256_cbc,sha256},
 {dhe_rsa,aes_128_cbc,sha256},
 {dhe_dss,aes_128_cbc,sha256},
 {rsa,aes_128_cbc,sha256},
 {dhe_rsa,aes_256_cbc,sha},
 {dhe_dss,aes_256_cbc,sha},
 {rsa,aes_256_cbc,sha},
 {dhe_rsa,'3des_ede_cbc',sha},
 {dhe_dss,'3des_ede_cbc',sha},
 {rsa,'3des_ede_cbc',sha},
 {dhe_rsa,aes_128_cbc,sha},
 {dhe_dss,aes_128_cbc,sha},
 {rsa,aes_128_cbc,sha},
 {rsa,rc4_128,sha},
 {rsa,rc4_128,md5},
 {dhe_rsa,des_cbc,sha},
 {rsa,des_cbc,sha}]
ok
2>




On 4 June 2014 18:35, Michael Klishin <mklishin at gopivotal.com> wrote:

> On 4 June 2014 at 16:56:11, Narayan Reddy (bvnr.mail at gmail.com) wrote:
> > > # openssl ciphers -v
>
> OK, great. What about
>
> io:format("~p~n", [ssl:cipher_suites()]).
>
> from the Erlang shell? (`erl`)
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/87899f01/attachment.html>

From vish.ramachandran at gmail.com  Wed Jun  4 21:28:27 2014
From: vish.ramachandran at gmail.com (vish.ramachandran)
Date: Wed, 4 Jun 2014 13:28:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Supporting both SSL+Password as well as
 SSL+Certificate based authentication
In-Reply-To: <538F3C1F.7050302@rabbitmq.com>
References: <1397684335559-34914.post@n5.nabble.com>
 <534FC120.5050504@rabbitmq.com>
 <CAB_tbjA0YD_1STHcsPkEQeJVx1UBTi-Lteru+fOki7HwoZQsMQ@mail.gmail.com>
 <538F3C1F.7050302@rabbitmq.com>
Message-ID: <1401913707709-36052.post@n5.nabble.com>

Thanks for the quick turnaround on the fix.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Supporting-both-SSL-Password-as-well-as-SSL-Certificate-based-authentication-tp34914p36052.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mswatson at gmail.com  Wed Jun  4 23:13:13 2014
From: mswatson at gmail.com (DallasEng)
Date: Wed, 4 Jun 2014 15:13:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Pressured to move to AMQP 1.0
Message-ID: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>

Having finally demonstrated to my company that RabbitMQ and AMQP allow us 
to build kickass distributed solutions, I am now getting strong pressure to 
move off RabbitMQ to "something more modern that supports AMQP 1.0".  I 
understand that 0.9.1 and 1.0 are completely different beasts, and that 
there's a 1.0 protocol plugin for RabbitMQ, but that plugin has limitations 
and things in 1.0 that it does not support.  The Powers That Be at the 
company look at IBM and Microsoft having AMQP 1.0 support and saying that's 
clearly where we need to be if we want to (a) not be left behind, and (b) 
advertise that we're using "the industry standard".

Since there's no indication that RabbitMQ will ever support a 
fully-compliant 1.0 mode, do any of you have suggestions for how I can 
demonstrate that staying on RabbitMQ for new development is a good idea?

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/fcbe8233/attachment.html>

From michael.s.klishin at gmail.com  Wed Jun  4 23:31:05 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 5 Jun 2014 02:31:05 +0400
Subject: [rabbitmq-discuss] Pressured to move to AMQP 1.0
In-Reply-To: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
References: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
Message-ID: <CAE3HoVSmUjYvKgq2utrsuBn6fHAeOUJ9UbYBExCwMT-crUuTLw@mail.gmail.com>

2014-06-05 2:13 GMT+04:00 DallasEng <mswatson at gmail.com>:

> Since there's no indication that RabbitMQ will ever support a
> fully-compliant 1.0 mode


What kind of indication do you need?

So far RabbitMQ team received very little feedback on the plugin. Missing
features can be added given that

 * There is enough interest
 * AMQP 1.0 clients become stable and get support for the missing features

As for the question about staying with 0-9-1, at least when AMQP 1.0 plugin
was developed,
its ecosystem barely existed (or it existed behind closed doors). RabbitMQ
ecosystem is there and is vibrant.
Plus Rabbit supports STOMP, MQTT, and Web messaging.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/2425938e/attachment.html>

From mswatson at gmail.com  Thu Jun  5 00:15:32 2014
From: mswatson at gmail.com (Michael Watson)
Date: Wed, 4 Jun 2014 18:15:32 -0500
Subject: [rabbitmq-discuss] Pressured to move to AMQP 1.0
In-Reply-To: <CAE3HoVSmUjYvKgq2utrsuBn6fHAeOUJ9UbYBExCwMT-crUuTLw@mail.gmail.com>
References: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
 <CAE3HoVSmUjYvKgq2utrsuBn6fHAeOUJ9UbYBExCwMT-crUuTLw@mail.gmail.com>
Message-ID: <CAFp2mKAB13eUKTU-91rinKCEfwOdgg_kmMUdPrgHitMzeVQLtA@mail.gmail.com>

Thanks, MK.

The main problem is one of perception.  "AMQP 1.0 is the standard.
 It's ISO/IEC 19464 and we're chartered with using industry standards."  I
can argue that 0.9.1, which has strong support from a massive community, is
the de facto standard, but "ISO/IEC" are hard TLAs to ignore.

Apache has a lot of respect internally, so Qpid is getting some strong
interest, and I haven't found any recent comparisons between RabbitMQ and
Qpid's Java or C++ implementations.

Re: The AMQP 1.0 plug-in, since we're launching creation of a large-scale
distributed platform project that needs high reliability, the fact that the
plugin still calls itself a prototype several years down the road is seen
internally as problematic.

There's some concern about 1.0's application-headers vs basic.properties
and the fact that the plugin doesn't transcode them, because we've found
those dictionaries to be useful.

MQTT is a compelling feature, thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/09adaad3/attachment.html>

From youseke at gmail.com  Thu Jun  5 03:01:16 2014
From: youseke at gmail.com (=?UTF-8?B?5by15p2x5ZOy?=)
Date: Wed, 4 Jun 2014 19:01:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Can someone tell me whether the following bug
	has been fixed?
Message-ID: <6b0a3b45-62c1-43c5-8f3a-bdc727c89fc8@googlegroups.com>



Right now I ran into the problem by using 2.8.4. 

[rabbitmq-discuss] Hang while waiting for shutdown of last node in an HA 
cluster 
<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018389.html>

I can't be sure by just reading the CHANGELOG and this bug is too rare to 
be confirmed being fixed by testing.

Can someone tell me whether this bug has been fixed?

I really need the information and thank a lot in advance!

Best regards.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/fb6ce495/attachment.html>

From youseke at gmail.com  Thu Jun  5 03:04:32 2014
From: youseke at gmail.com (=?UTF-8?B?5by15p2x5ZOy?=)
Date: Wed, 4 Jun 2014 19:04:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Can someone tell me whether this bug has been
	fixed?
Message-ID: <23d64870-8557-4085-acfb-1c545b7f98e0@googlegroups.com>



Right now I ran into the problem by using 2.8.4. 

[rabbitmq-discuss] Hangwhile waiting for shutdown of last node in an HA 
cluster 
<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021309.html>

I can't be sure by just reading the CHANGELOG and this bug is too rare to 
be confirmed being fixed by testing.

Can someone tell me whether this bug has been fixed?

I really need the information and thank a lot in advance!

Best regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140604/9ea15156/attachment.html>

From sayedmomeen at gmail.com  Thu Jun  5 07:52:53 2014
From: sayedmomeen at gmail.com (sayedmomeen)
Date: Wed, 4 Jun 2014 23:52:53 -0700 (PDT)
Subject: [rabbitmq-discuss] non-blocking in client connection..
Message-ID: <1401951173550-36056.post@n5.nabble.com>

Hi...
i have added one amqp client connection... 
and putting that in select() when exchange get and msg ill come to knw..
i just wanted to knw... default amqp client connection is blocking or
non-blocking mode...

and how to set that to blocking or non-blocking after connection made....




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/non-blocking-in-client-connection-tp36056.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Jun  5 08:44:05 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jun 2014 08:44:05 +0100
Subject: [rabbitmq-discuss] Can someone tell me whether the following
 bug has been fixed?
In-Reply-To: <6b0a3b45-62c1-43c5-8f3a-bdc727c89fc8@googlegroups.com>
References: <6b0a3b45-62c1-43c5-8f3a-bdc727c89fc8@googlegroups.com>
Message-ID: <53901FC5.8050206@rabbitmq.com>

That's hard to say. We never got to the bottom of what Matt was seeing.

But we have fixed several bugs since then that involve hanging on 
shutdown, which could have been what he was seeing. So I would say the 
odds are good.

Cheers, Simon

On 05/06/2014 03:01, ??? wrote:
> Right now I ran into the problem by using 2.8.4.
>
> [rabbitmq-discuss] Hang while waiting for shutdown of last node in an HA
> cluster
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018389.html>
>
> I can't be sure by just reading the CHANGELOG and this bug is too rare
> to be confirmed being fixed by testing.
>
> Can someone tell me whether this bug has been fixed?
>
> I really need the information and thank a lot in advance!
>
> Best regards.
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Thu Jun  5 09:06:30 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jun 2014 09:06:30 +0100
Subject: [rabbitmq-discuss] Pressured to move to AMQP 1.0
In-Reply-To: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
References: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
Message-ID: <53902506.9050609@rabbitmq.com>

On 04/06/2014 23:13, DallasEng wrote:
> Since there's no indication that RabbitMQ will ever support a
> fully-compliant 1.0 mode, do any of you have suggestions for how I can
> demonstrate that staying on RabbitMQ for new development is a good idea?

Ultimately, it's a market, not a planned economy :-)

RabbitMQ will support AMQP 1.0 to the extent that the market demands it. 
You are right to say that the 1.0 plugin has seen little development 
since its release: that's simply because we haven't heard back from 
anyone who's using it. If AMQP 1.0 takes off, RabbitMQ users will not be 
left behind.

(Is anyone out there using it? Please tell us if you are!)

On 05/06/2014 00:15, Michael Watson wrote:
> The main problem is one of perception. "AMQP 1.0 is the standard.
> It's  ISO/IEC 19464 and we're chartered with using industry standards." I can
> argue that 0.9.1, which has strong support from a massive community, is
> the de facto standard, but "ISO/IEC" are hard TLAs to ignore.

I would argue that "ISO standard" and "industry standard" are two 
different things. TCP/IP is an industry standard, the OSI networking 
stack is an ISO standard, even though no-one uses it.

Cheers, Simon


From andnrk at gmail.com  Thu Jun  5 09:11:56 2014
From: andnrk at gmail.com (Andrius Norkaitis)
Date: Thu, 5 Jun 2014 11:11:56 +0300
Subject: [rabbitmq-discuss] Use of QueueDeclarePassive generates errors
	in log
In-Reply-To: <etPan.538ed315.7545e146.e723@mercurio.local>
References: <CAB4ybe8-t9ZCvz+k66or1B2rM81xvfbNpXF4gwZ-=azWPHs02Q@mail.gmail.com>
 <etPan.538ed315.7545e146.e723@mercurio.local>
Message-ID: <CAB4ybe83D=+ymzajb3SELMERDzUW0tZ+W_nXt60zBMdWQ4EqeA@mail.gmail.com>

I understand error messages and expect them by design, but my problem is
large disk writes to log file because of them. I'm looking how to disable
logging them to log file.



2014-06-04 11:04 GMT+03:00 Michael Klishin <mklishin at gopivotal.com>:

>  On 4 June 2014 at 04:50:02, Andrius Norkaitis (andnrk at gmail.com) wrote:
> > > QueueDeclarePassive(QueueName) generated error in log file.
> > E.g.
> >
> > if queue not exist, it writes:
> >
> > =ERROR REPORT==== 4-Jun-2014(
> http://airmail.calendar/2014-06-04%2012:00:00%20GMT+4)::03:33:00
> > ===
> > connection <0.26865.9>, channel 3 - soft error:
> > {amqp_error,not_found,
> > "no queue 'xxxx' in vhost '/'",
> > 'queue.declare'}
>
> Which is entirely expected.
>
> > If it exist, it writes:
> >
> > =ERROR REPORT==== 4-Jun-2014(
> http://airmail.calendar/2014-06-04%2012:00:00%20GMT+4)::03:33:05
> > ===
> > connection <0.26865.9>, channel 3 - soft error:
> > {amqp_error,resource_locked,
> > "cannot obtain exclusive access to locked queue 'xxxx' in vhost
> > '/'",
> > 'queue.declare'}
>
> The message says that you have 2 connections trying to use a queue
> declared as exclusive. Use a non-exclusive queue and there will be no
> error.
>
> > How to disable error logging when using this function? Maybe
> > there is new way to check queue exist?
>
> There is no but you can simply declare the queue with the same arguments
> instead of checking if it exists.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/6aad0b53/attachment.html>

From Nikunj.Badjatya at emc.com  Thu Jun  5 09:54:17 2014
From: Nikunj.Badjatya at emc.com (Badjatya, Nikunj)
Date: Thu, 5 Jun 2014 08:54:17 +0000
Subject: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error,
 not_found}" (server down)
In-Reply-To: <022ADF639A140D4790580A766237164C1D599F7E@MX101CL02.corp.emc.com>
References: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>
 <etPan.538da663.327b23c6.7a61@mercurio.local>
 <538DB078.3020208@rabbitmq.com>
 <022ADF639A140D4790580A766237164C1D599F7E@MX101CL02.corp.emc.com>
Message-ID: <022ADF639A140D4790580A766237164C1D59B1CA@MX101CL02.corp.emc.com>

Hello Folks,

Any thoughts on this?

Thanks


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Badjatya, Nikunj
Sent: Wednesday, June 04, 2014 8:52 PM
To: Matthias Radestock; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error, not_found}" (server down)

Thank you all for quick replies.
Well this issue was not reproducible and we hit this only once.

I didn?t quite understand the reason given in http://markmail.org/thread/26j56abreqwd32fq#query:+page:1+mid:2j2la4yehcxferjy+state:results link.

Can you please explain it in simpler way?

I am not deleting node as part of any operation. Here are the operations which I am doing currently using Pika python library:

1. Create user using rabbitmqctl
2. Connect to localhost using BlockingConnection 3. get channel 4. create exchange if not done already 5. publish using basic_publish 6. Close connection 6. Delete user using rabbitmqctl


Thanks
Nikunj


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Tuesday, June 03, 2014 4:55 PM
To: Discussions about RabbitMQ
Cc: Badjatya, Nikunj
Subject: Re: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error, not_found}" (server down)

On 03/06/14 11:41, Michael Klishin wrote:
> On 3 June 2014 at 14:15:52, Badjatya, Nikunj (nikunj.badjatya at emc.com) wrote:
>>>
>> Stack trace:
>> [{rabbit_binding,recover_semi_durable_route,3,[]},
>> {rabbit_binding,'-recover/2-lc$^0/1-0-',3,[]},
>> {rabbit_binding,recover,2,[]},
>> {rabbit,recover,0,[]},
>> {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>> {rabbit,run_boot_step,1,[]},
>> {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>> {rabbit,start,2,[]}]
>
> See http://markmail.org/thread/26j56abreqwd32fq and http://markmail.org/thread/ntgfmmmnfrhjodtj.
>
> This is a known bug (#25783) which is not resolved yet.

Actually, there is a bug with the above signature that we fixed in 3.2.0

25822 prevent crash at startup when starting a clustered node hosting a
       durable non-HA queue which had been bound to a transient exchange which
       was deleted when the node was down (since 2.5.0)

Does that at all sound like what might be happening?

If not then, as Simon says, please send him a copy of the mnesia dir off-list.

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mklishin at gopivotal.com  Thu Jun  5 10:00:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 13:00:20 +0400
Subject: [rabbitmq-discuss] Use of QueueDeclarePassive generates errors
 in log
In-Reply-To: <CAB4ybe83D=+ymzajb3SELMERDzUW0tZ+W_nXt60zBMdWQ4EqeA@mail.gmail.com>
References: <CAB4ybe8-t9ZCvz+k66or1B2rM81xvfbNpXF4gwZ-=azWPHs02Q@mail.gmail.com>
 <etPan.538ed315.7545e146.e723@mercurio.local>
 <CAB4ybe83D=+ymzajb3SELMERDzUW0tZ+W_nXt60zBMdWQ4EqeA@mail.gmail.com>
Message-ID: <etPan.539031c1.6b8b4567.14893@mercurio.local>

?On 5 June 2014 at 12:14:52, Andrius Norkaitis (andnrk at gmail.com) wrote:
> > I'm looking how to disable logging them to log file

"log_levels" in?https://www.rabbitmq.com/configure.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun  5 10:19:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 13:19:22 +0400
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
 <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
Message-ID: <etPan.53903637.643c9869.14893@mercurio.local>

On 5 June 2014 at 12:03:16, Narayan Reddy (bvnr.mail at gmail.com) wrote:
> > Any other information needed ? Any thing should i change and  
> check ? Please help me to resolve this issue .

I suspected that client and server may not have a shared cipher suite to use
but then it would be clear from the error message.

I now suspect that the client you use simply does not support SSL or do
it correctly. Please contain the author (and specify what client that is here).

You can also try with {fail_if_no_peer_cert,false},
or even no peer verification (if that's acceptable in your environment).

Because Erlang's SSL support does not use OpenSSL, it may be worth trying using
a more recent OTP release (R16B03 or R17).?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From andnrk at gmail.com  Thu Jun  5 10:20:09 2014
From: andnrk at gmail.com (Andrius Norkaitis)
Date: Thu, 5 Jun 2014 12:20:09 +0300
Subject: [rabbitmq-discuss] Use of QueueDeclarePassive generates errors
	in log
In-Reply-To: <etPan.539031c1.6b8b4567.14893@mercurio.local>
References: <CAB4ybe8-t9ZCvz+k66or1B2rM81xvfbNpXF4gwZ-=azWPHs02Q@mail.gmail.com>
 <etPan.538ed315.7545e146.e723@mercurio.local>
 <CAB4ybe83D=+ymzajb3SELMERDzUW0tZ+W_nXt60zBMdWQ4EqeA@mail.gmail.com>
 <etPan.539031c1.6b8b4567.14893@mercurio.local>
Message-ID: <CAB4ybe97n-y7qZ7XEEej=A5qp1Q22HxHKmhfy2n=Reg_oshGHQ@mail.gmail.com>

Tried before posting.

[
{rabbit, [ {log_levels, [{connection, none}]} ] }
].

does not work as these messages are still logged.


2014-06-05 12:00 GMT+03:00 Michael Klishin <mklishin at gopivotal.com>:

>  On 5 June 2014 at 12:14:52, Andrius Norkaitis (andnrk at gmail.com) wrote:
> > > I'm looking how to disable logging them to log file
>
> "log_levels" in https://www.rabbitmq.com/configure.html
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/84ceb5da/attachment.html>

From mklishin at gopivotal.com  Thu Jun  5 10:20:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 13:20:22 +0400
Subject: [rabbitmq-discuss] non-blocking in client connection..
In-Reply-To: <1401951173550-36056.post@n5.nabble.com>
References: <1401951173550-36056.post@n5.nabble.com>
Message-ID: <etPan.53903670.66334873.14893@mercurio.local>

On 5 June 2014 at 11:42:59, sayedmomeen (sayedmomeen at gmail.com) wrote:
> > i have added one amqp client connection...
> and putting that in select() when exchange get and msg ill come  
> to knw..
> i just wanted to knw... default amqp client connection is blocking  
> or
> non-blocking mode...

It's not possible to say without knowing what client you use.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun  5 10:25:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 13:25:54 +0400
Subject: [rabbitmq-discuss] Use of QueueDeclarePassive generates errors
 in log
In-Reply-To: <CAB4ybe97n-y7qZ7XEEej=A5qp1Q22HxHKmhfy2n=Reg_oshGHQ@mail.gmail.com>
References: <CAB4ybe8-t9ZCvz+k66or1B2rM81xvfbNpXF4gwZ-=azWPHs02Q@mail.gmail.com>
 <etPan.538ed315.7545e146.e723@mercurio.local>
 <CAB4ybe83D=+ymzajb3SELMERDzUW0tZ+W_nXt60zBMdWQ4EqeA@mail.gmail.com>
 <etPan.539031c1.6b8b4567.14893@mercurio.local>
 <CAB4ybe97n-y7qZ7XEEej=A5qp1Q22HxHKmhfy2n=Reg_oshGHQ@mail.gmail.com>
Message-ID: <etPan.539037bf.19495cff.14893@mercurio.local>

?On 5 June 2014 at 13:23:18, Andrius Norkaitis (andnrk at gmail.com) wrote:
> > [
> {rabbit, [ {log_levels, [{connection, none}]} ] }
> ].
>  
> does not work as these messages are still logged.

Yes, as things stand, errors are always logged.

I recommend not relying on passive declare so much if it produces
excessive log writes. Simply declare what you need and use it.

Not logging anything is a dangerous feature I'm a bit hesitant to consider.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun  5 10:31:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 13:31:22 +0400
Subject: [rabbitmq-discuss] Use of QueueDeclarePassive generates errors
 in log
In-Reply-To: <etPan.539037bf.19495cff.14893@mercurio.local>
References: <CAB4ybe8-t9ZCvz+k66or1B2rM81xvfbNpXF4gwZ-=azWPHs02Q@mail.gmail.com>
 <etPan.538ed315.7545e146.e723@mercurio.local>
 <CAB4ybe83D=+ymzajb3SELMERDzUW0tZ+W_nXt60zBMdWQ4EqeA@mail.gmail.com>
 <etPan.539031c1.6b8b4567.14893@mercurio.local>
 <CAB4ybe97n-y7qZ7XEEej=A5qp1Q22HxHKmhfy2n=Reg_oshGHQ@mail.gmail.com>
 <etPan.539037bf.19495cff.14893@mercurio.local>
Message-ID: <etPan.53903908.625558ec.14893@mercurio.local>



On 5 June 2014 at 13:27:46, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Yes, as things stand, errors are always logged.

Apparently only channel-level ("soft") errors are logged. Connection-level
errors can be silenced. So this is a gap in logging then.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From noreply+1572807377 at badoo.com  Thu Jun  5 10:35:53 2014
From: noreply+1572807377 at badoo.com (Roman Gaufman)
Date: Thu,  5 Jun 2014 09:35:53 +0000
Subject: [rabbitmq-discuss] =?utf-8?q?=E2=98=85_Read_your_message_before_i?=
	=?utf-8?q?t_gets_deleted!?=
Message-ID: <20140605093553.471F71157D588@cluster1018.monopost.com>

Read the message that Roman Gaufman left for you before it gets deleted!

To read your message, follow this link:
http://eu1.badoo.com/roman.gaufman/in/xBN8.PRbl9M/?lang_id=3&g=57-0-4&m=65&mid=539039f9000000000003004d03a0a6f90080b6b801dc


If clicking the links in this message does not work, copy and paste them into the address bar of your browser.


This email is part of our delivery procedure for the message sent by Roman Gaufman. If you have received this email by mistake, please ignore it. The message will be deleted soon.


Have fun!
The Badoo Team

You have received this email from Badoo Trading Limited (postal address below).
If you do not wish to receive further email communications from Badoo click here to opt out: https://eu1.badoo.com/impersonation.phtml?lang_id=3&email=rabbitmq-discuss%40lists.rabbitmq.com&block_code=a51d0c&m=65&mid=539039f9000000000003004d03a0a6f90080b6b801dc&g=0-0-4.

Badoo Trading Limited is a limited company registered in England and Wales
under CRN 7540255 with its registered office at Media Village, 131 - 151 Great Titchfield Street, London, W1W 5BB.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/a3fa6b77/attachment.html>

From bvnr.mail at gmail.com  Thu Jun  5 09:02:35 2014
From: bvnr.mail at gmail.com (Narayan Reddy)
Date: Thu, 5 Jun 2014 13:32:35 +0530
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
Message-ID: <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>

Hi Michael,
            Any other information needed ? Any thing should i change and
check ? Please help me to resolve this issue .

--
Thanks & Regards
Narayan


On 4 June 2014 19:14, Narayan Reddy <bvnr.mail at gmail.com> wrote:

> # erl
> Erlang R16B (erts-5.10.1) [source] [smp:8:8] [async-threads:10] [hipe]
> [kernel-poll:false]
>
> Eshell V5.10.1  (abort with ^G)
> 1> io:format("~p~n", [ssl:cipher_suites()]).
> [{dhe_rsa,aes_256_cbc,sha256},
>  {dhe_dss,aes_256_cbc,sha256},
>  {rsa,aes_256_cbc,sha256},
>  {dhe_rsa,aes_128_cbc,sha256},
>  {dhe_dss,aes_128_cbc,sha256},
>  {rsa,aes_128_cbc,sha256},
>  {dhe_rsa,aes_256_cbc,sha},
>  {dhe_dss,aes_256_cbc,sha},
>  {rsa,aes_256_cbc,sha},
>  {dhe_rsa,'3des_ede_cbc',sha},
>  {dhe_dss,'3des_ede_cbc',sha},
>  {rsa,'3des_ede_cbc',sha},
>  {dhe_rsa,aes_128_cbc,sha},
>  {dhe_dss,aes_128_cbc,sha},
>  {rsa,aes_128_cbc,sha},
>  {rsa,rc4_128,sha},
>  {rsa,rc4_128,md5},
>  {dhe_rsa,des_cbc,sha},
>  {rsa,des_cbc,sha}]
> ok
> 2>
>
>
>
>
> On 4 June 2014 18:35, Michael Klishin <mklishin at gopivotal.com> wrote:
>
>> On 4 June 2014 at 16:56:11, Narayan Reddy (bvnr.mail at gmail.com) wrote:
>> > > # openssl ciphers -v
>>
>> OK, great. What about
>>
>> io:format("~p~n", [ssl:cipher_suites()]).
>>
>> from the Erlang shell? (`erl`)
>> --
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/7254d254/attachment.html>

From tmutton1 at gmail.com  Thu Jun  5 10:32:49 2014
From: tmutton1 at gmail.com (Thomas Mutton)
Date: Thu, 5 Jun 2014 02:32:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Understanding Basic Get and Consume
Message-ID: <f88deb27-2874-4929-b373-9f39010436b6@googlegroups.com>

(Using a Windows installations only)

I have two brokers set up in a federation.

Using the RabbitMQ .NET library, I am able to publish and consume messages 
from and to either end respectively. This works.

Dropping out of .NET, I am attempting to consume a message via command line 
(rabbitmqadmin script). The call I'm using is *get*.

>From what I understand (looking into the docs), this is a synchronous call 
- so it's a call from the client to the broker. What happens when the 
command gets to the broker is *broker A* asks *broker B* for any messages 
(using the *upstream*). Messages (if any) then get passed to *broker A* 
from *broker B*. This all happens asynchronously. My question is: Is there 
an asynchronous call I can make from the command line to get a message over 
a federation like the one described above? I have heard about consume but 
have not seen any examples and according to the rabbitmqadmin script, it 
does not recognise it.

My second question is: Given that *get *is synchronous and *consume *is 
asynchronous, what is going on under the hood? Where is the difference? Are 
they both calls to the broker but consume waits for a response?

Thanks

Tom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/3dd0d51b/attachment.html>

From miguel.araujo.perez at gmail.com  Thu Jun  5 11:38:49 2014
From: miguel.araujo.perez at gmail.com (=?UTF-8?Q?Miguel_Araujo_P=C3=A9rez?=)
Date: Thu, 5 Jun 2014 12:38:49 +0200
Subject: [rabbitmq-discuss] Pause minority cluster with publisher
 confirms losing messages
In-Reply-To: <etPan.538efbc7.7fdcc233.e723@mercurio.local>
References: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
 <etPan.538ed640.4db127f8.e723@mercurio.local>
 <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>
 <etPan.538efbc7.7fdcc233.e723@mercurio.local>
Message-ID: <CA+b0Eje2Vx+9Tqv95GPSLncGcjuvZ-Frk8XfCtQ0mTSa9VnL7A@mail.gmail.com>

Hi,

Thanks, is there a URL I can access to follow bug status?

> Once a node decides to pause, there may be messages "in flight" that were
already
> read from the socket and parsed, and being delivered to queues. These
processes
> (in both general and Erlang sense) can run in parallel on machines with
over 1 core.

My understanding is that for confirming a message, a node in the cluster
must see the other nodes and get confirmation from them. If that is the
case It makes sense it doesn't confirm messages when iptables rules are
applied and that is what happens after some seconds, when it resumes and
starts confirming messages that are then lost. Not sure I follow how
multiple cores make things harder here, I'm probably not seeing some
concurrent issue here.

I'm attaching Erlang log from node3 here. if you look at it you will see
how first thing it detects is node rabbitmq-2 and rabbitmq-1 are not
responding. Then it promotes mirrored queues from slave to master. Cluster
minority status detected comes last thing.

I'm not an expert in RabbitMQ internals, I've been reading the code parts
that control this flow and it feels like confirms could be paused until
being sure things are ok. I mean if node3 knows it's connected to 2 nodes
(node2 and node1), then sees both nodes down, looks like something is going
wrong.

The part that most strikes me is that it takes 1 minute and 3 seconds to
detect minority since we know both nodes are down?

I will send another email with the Erlang trace.

Thanks, cheers
Miguel


2014-06-04 12:57 GMT+02:00 Michael Klishin <mklishin at gopivotal.com>:

> On 4 June 2014 at 14:55:57, Miguel Araujo P?rez (
> miguel.araujo.perez at gmail.com) wrote:
> > > While doing all these tests. Once, when flushing iptables in
> > node3 it has core dumped some Erlang trace. All times before it
> > simply detects network and rejoins cluster without issues.
> > is this something i should report? how?
>
> Miguel,
>
> We have filed a bug for the general issue here. Feel free to post the trace
> you see to the list (unless you think it contains sensitive information,
> which
> is probably doesn't).
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/358c8082/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: node3.log
Type: application/octet-stream
Size: 2782 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/358c8082/attachment.obj>

From mklishin at gopivotal.com  Thu Jun  5 11:46:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 14:46:00 +0400
Subject: [rabbitmq-discuss] Understanding Basic Get and Consume
In-Reply-To: <f88deb27-2874-4929-b373-9f39010436b6@googlegroups.com>
References: <f88deb27-2874-4929-b373-9f39010436b6@googlegroups.com>
Message-ID: <etPan.53904a81.507ed7ab.14893@mercurio.local>

?On 5 June 2014 at 14:42:05, Thomas Mutton (tmutton1 at gmail.com) wrote:
> > I have two brokers set up in a federation.

Queue or exchange federation?

> Using the RabbitMQ .NET library, I am able to publish and consume  
> messages from and to either end respectively. This works.
>  
> Dropping out of .NET, I am attempting to consume a message via  
> command line (rabbitmqadmin script). The call I'm using is get.  
>  
> From what I understand (looking into the docs), this is a synchronous  
> call - so it's a call from the client to the broker. What happens  
> when the command gets to the broker is broker A asks broker B for  
> any messages (using the upstream). Messages (if any) then get  
> passed to broker Afrom broker B. This all happens asynchronously.  
> My question is: Is there an asynchronous call I can make from the  
> command line to get a message over a federation like the one described  
> above? I have heard about consume but have not seen any examples  
> and according to the rabbitmqadmin script, it does not recognise  
> it.
>  
> My second question is: Given that get is synchronous and consume  
> is asynchronous, what is going on under the hood? Where is the  
> difference? Are they both calls to the broker but consume waits  
> for a response?

basic.get fetches 1 message at a time (like HTTP GET). basic.consume creates
a (supposedly long running) subscription which means RabbitMQ will push messages
to the consumer.

basic.get cannot retrieve messages from federated queues over federation for the reason you've mentioned:
it has to wait for a response. See Limitations on?http://www.rabbitmq.com/federated-queues.html.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mark at wolfe.id.au  Thu Jun  5 11:59:01 2014
From: mark at wolfe.id.au (Mark Wolfe)
Date: Thu, 5 Jun 2014 20:59:01 +1000
Subject: [rabbitmq-discuss] MQTT And RabbitMQ
Message-ID: <CAPwMmOCL5_MmW+RocZNHX4R0EzByE_C=L30Qb=oK1dPRaXOh_A@mail.gmail.com>

Gday All

Just wanted to see if others are having similar issues with RabbitMQ and
MQTT.

Firstly we are seeing a lot of errors around duplicate client-ids, after
debugging this a few times it seemed there were orphaned or somehow
retained connections which aren't showing in the standard rabbitmq session
list.

These connections are somehow leading to the newer connection being kicked
off, like a routine is kicking off the oldest connection for a given
client, where there is only one..

We are also getting these traces from time to time (see below).

I saw there is some pretty significant work going on around the MQTT
plugin, is this related to any of the symptoms I described?

Lastly as you can see in the trace we are running an SSL proxy in front of
RabbitMQ.

=ERROR REPORT==== 7-May-2014::14:11:25 ===
** Generic server <0.710.30> terminating
** Last message in was {inet_async,#Port<0.567958>,12806,

 {ok,<<16,69,0,6,77,81,73,115,100,112,3,194,0,30,0,
                                 20,52,57,51,45,54,66,67,66,50,66,68,67,49,

 53,65,48,56,67,56,68,0,7,115,116,114,101,97,
                                 109,115,0,24,72,97,118,106,101,114,104,111,
                                 70,114,97,110,74,111,103,114,121,111,99,78,
                                 111,110,115,55>>}}
** When Server state == {state,#Port<0.567958>,
                            "127.0.0.1:34267 -> 127.0.0.1:2883
",true,running,
                            {none,<0.731.30>},
                            <0.711.30>,false,none,
                            {proc_state,#Port<0.567958>,
                                {dict,4,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},

{{[["$bkt/c884c1f687e7a3227666d1...",1]],
                                      [],[],[],[],[],[],
                                      [["$bkt/c884c1f687e7a32...",1]],
                                      [],[],[],
                                      [["$bkt/c884c1f687e...",1]],
                                      [],
                                      [["$bkt/c884c1f68...",0]],
                                      [],[]}}},
                                {<<"amq.ctag-6D0VFf1CiAX92MduztwyMQ">>,
                                 <<"amq.ctag-xsYcdvDhFzF7PROcEpeYgA">>},
                                {0,nil},
                                {0,nil},
                                undefined,2,"493-6BCB2BDC15A08C8D",true,
                                undefined,
                                {<0.721.30>,undefined},
                                <0.715.30>,<<"amq.topic">>}}
** Reason for termination ==
** {function_clause,
       [{rabbit_mqtt_processor,process_login,
            [<<"useraccounthere">>,<<"XXXXXXX">>,3,
             {proc_state,#Port<0.567958>,
                 {dict,4,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[["$bkt/c884...",1]],
                       [],[],[],[],[],[],
                       [["$blo...",1]],
                       [],[],[],
                       [["...",1]],
                       [],
                       [["...",0]],
                       [],[]}}},
                 {<<"amq.ctag-6D0VFf1CiAX92MduztwyMQ">>,
                  <<"amq.ctag-xsYcdvDhFzF7PROcEpeYgA">>},
                 {0,nil},
                 {0,nil},
                 undefined,2,"493-6BCB2BDC15A08C8D",true,undefined,
                 {<0.721.30>,undefined},
                 <0.715.30>,<<"amq.topic">>}],
            []},
        {rabbit_mqtt_processor,process_request,3,[]},
        {rabbit_mqtt_reader,process_received_bytes,2,[]},
        {gen_server2,handle_msg,2,[]},
        {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}

=ERROR REPORT==== 7-May-2014::14:11:25 ===
** Generic server <0.715.30> terminating
** Last message in was {'EXIT',<0.710.30>,
                        {function_clause,
                         [{rabbit_mqtt_processor,process_login,
                           [<<"useraccounthere">>,<<"XXXXXXX">>,3,
                            {proc_state,#Port<0.567958>,
                             {dict,4,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[["$b...",1]],
                                [],[],[],[],[],[],
                                [["...",1]],
                                [],[],[],
                                [["...",'...']],
                                [],
                                [['...']],
                                [],[]}}},
                             {<<"amq.ctag-6D0VFf1CiAX92MduztwyMQ">>,
                              <<"amq.ctag-xsYcdvDhFzF7PROcEpeYgA">>},
                             {0,nil},
                             {0,nil},
                             undefined,2,"493-6BCB2BDC15A08C8D",true,
                             undefined,
                             {<0.721.30>,undefined},
                             <0.715.30>,<<"amq.topic">>}],
                           []},
                          {rabbit_mqtt_processor,process_request,3,[]},
                          {rabbit_mqtt_reader,process_received_bytes,2,[]},
                          {gen_server2,handle_msg,2,[]},
                          {proc_lib,wake_up,3,
                           [{file,"proc_lib.erl"},{line,237}]}]}}
** When Server state == {state,amqp_direct_connection,
                         {state,rabbit at somehostsomewhere,
                          {user,<<"useraccounthere">>,
                           [whatever],
                           rabbit_auth_backend_internal,
                           {internal_user,<<"useraccounthere">>,

<<161,99,227,145,114,48,147,95,100,75,53,57,61,183,
                              253,109,128,232,30,86>>,
                            [whatever]}},
                          <<"/">>,
                          {amqp_params_direct,<<"useraccounthere">>,
                           <<"XXXXXXX">>,<<"/">>,
                           rabbit at somehostsomewhere,
                           {amqp_adapter_info,
                            {0,0,0,0,0,65535,32512,1},
                            2883,
                            {0,0,0,0,0,65535,32512,1},
                            34267,<<"127.0.0.1:34267 -> 127.0.0.1:2883">>,
                            {'MQTT',"3"},
                            [{ssl,false}]},
                           []},
                          {amqp_adapter_info,
                           {0,0,0,0,0,65535,32512,1},
                           2883,
                           {0,0,0,0,0,65535,32512,1},
                           34267,<<"127.0.0.1:34267 -> 127.0.0.1:2883">>,
                           {'MQTT',"3"},
                           [{ssl,false}]},
                          <0.718.30>,undefined},
                         <0.717.30>,
                         {amqp_params_direct,<<"useraccounthere">>,
                          <<"XXXXXXX">>,<<"/">>,
                          rabbit at somehostsomewhere,
                          {amqp_adapter_info,
                           {0,0,0,0,0,65535,32512,1},
                           2883,
                           {0,0,0,0,0,65535,32512,1},
                           34267,<<"127.0.0.1:34267 -> 127.0.0.1:2883">>,
                           {'MQTT',"3"},
                           [{ssl,false}]},
                          []},
                         0,
                         [{<<"capabilities">>,table,
                           [{<<"publisher_confirms">>,bool,true},
                            {<<"exchange_exchange_bindings">>,bool,true},
                            {<<"basic.nack">>,bool,true},
                            {<<"consumer_cancel_notify">>,bool,true},
                            {<<"connection.blocked">>,bool,true},
                            {<<"consumer_priorities">>,bool,true},

{<<"authentication_failure_close">>,bool,true}]},

{<<"cluster_name">>,longstr,<<"rabbit at somehostsomewhere">>},
                          {<<"copyright">>,longstr,
                           <<"Copyright (C) 2007-2013 GoPivotal, Inc.">>},
                          {<<"information">>,longstr,
                           <<"Licensed under the MPL.  See
http://www.rabbitmq.com/">>},
                          {<<"platform">>,longstr,<<"Erlang/OTP">>},
                          {<<"product">>,longstr,<<"RabbitMQ">>},
                          {<<"version">>,longstr,<<"3.3.0">>}],
                         none,false}
** Reason for termination ==
** {unexpected_msg,
       {'EXIT',<0.710.30>,
           {function_clause,
               [{rabbit_mqtt_processor,process_login,
                    [<<"useraccounthere">>,<<"XXXXXXX">>,3,
                     {proc_state,#Port<0.567958>,
                         {dict,4,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[["...",1]],
                               [],[],[],[],[],[],
                               [['...']],
                               [],[],[],
                               ['...'],
                               [],
                               ['...'],
                               [],[]}}},
                         {<<"amq.ctag-6D0VFf1CiAX92MduztwyMQ">>,
                          <<"amq.ctag-xsYcdvDhFzF7PROcEpeYgA">>},
                         {0,nil},
                         {0,nil},
                         undefined,2,"493-6BCB2BDC15A08C8D",true,undefined,
                         {<0.721.30>,undefined},
                         <0.715.30>,<<"amq.topic">>}],
                    []},
                {rabbit_mqtt_processor,process_request,3,[]},
                {rabbit_mqtt_reader,process_received_bytes,2,[]},
                {gen_server2,handle_msg,2,[]},
                {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}

=WARNING REPORT==== 7-May-2014::14:11:25 ===
MQTT disconnect from "493-6BCB2BDC15A08C8D"


-- 
Regards,

Mark Wolfe

--
I am not young enough to know everything.
--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/166bcbed/attachment.html>

From mklishin at gopivotal.com  Thu Jun  5 12:10:27 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 15:10:27 +0400
Subject: [rabbitmq-discuss] MQTT And RabbitMQ
In-Reply-To: <CAPwMmOCL5_MmW+RocZNHX4R0EzByE_C=L30Qb=oK1dPRaXOh_A@mail.gmail.com>
References: <CAPwMmOCL5_MmW+RocZNHX4R0EzByE_C=L30Qb=oK1dPRaXOh_A@mail.gmail.com>
Message-ID: <etPan.53905041.41b71efb.14893@mercurio.local>

On 5 June 2014 at 15:00:22, Mark Wolfe (mark at wolfe.id.au) wrote:
> > We are also getting these traces from time to time (see below).  
>  
> I saw there is some pretty significant work going on around the  
> MQTT plugin, is this related to any of the symptoms I described?  

It sounds like the root cause is the same as in a bug that was
fixed in the last few weeks. Should be in 3.3.2.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mark at wolfe.id.au  Thu Jun  5 12:19:51 2014
From: mark at wolfe.id.au (Mark Wolfe)
Date: Thu, 5 Jun 2014 21:19:51 +1000
Subject: [rabbitmq-discuss] MQTT And RabbitMQ
In-Reply-To: <etPan.53905041.41b71efb.14893@mercurio.local>
References: <CAPwMmOCL5_MmW+RocZNHX4R0EzByE_C=L30Qb=oK1dPRaXOh_A@mail.gmail.com>
 <etPan.53905041.41b71efb.14893@mercurio.local>
Message-ID: <CAPwMmOBV51ZEUOviEfiXJZ5b-o-hUK_A_eJaV0ZVDRjF9rPj+Q@mail.gmail.com>

That is great to hear, when is that release likely to drop?


On Thu, Jun 5, 2014 at 9:10 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 5 June 2014 at 15:00:22, Mark Wolfe (mark at wolfe.id.au) wrote:
> > > We are also getting these traces from time to time (see below).
> >
> > I saw there is some pretty significant work going on around the
> > MQTT plugin, is this related to any of the symptoms I described?
>
> It sounds like the root cause is the same as in a bug that was
> fixed in the last few weeks. Should be in 3.3.2.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>



-- 
Regards,

Mark Wolfe

--
I am not young enough to know everything.
--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/2280afa8/attachment.html>

From mklishin at gopivotal.com  Thu Jun  5 12:22:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 15:22:25 +0400
Subject: [rabbitmq-discuss] MQTT And RabbitMQ
In-Reply-To: <CAPwMmOBV51ZEUOviEfiXJZ5b-o-hUK_A_eJaV0ZVDRjF9rPj+Q@mail.gmail.com>
References: <CAPwMmOCL5_MmW+RocZNHX4R0EzByE_C=L30Qb=oK1dPRaXOh_A@mail.gmail.com>
 <etPan.53905041.41b71efb.14893@mercurio.local>
 <CAPwMmOBV51ZEUOviEfiXJZ5b-o-hUK_A_eJaV0ZVDRjF9rPj+Q@mail.gmail.com>
Message-ID: <etPan.5390530f.7545e146.14893@mercurio.local>

On 5 June 2014 at 15:21:02, Mark Wolfe (mark at wolfe.id.au) wrote:
> > That is great to hear, when is that release likely to drop?

No ?promises on the exact date but soon.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From gsim at redhat.com  Thu Jun  5 13:00:10 2014
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 05 Jun 2014 13:00:10 +0100
Subject: [rabbitmq-discuss] Pressured to move to AMQP 1.0
In-Reply-To: <CAFp2mKAB13eUKTU-91rinKCEfwOdgg_kmMUdPrgHitMzeVQLtA@mail.gmail.com>
References: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
 <CAE3HoVSmUjYvKgq2utrsuBn6fHAeOUJ9UbYBExCwMT-crUuTLw@mail.gmail.com>
 <CAFp2mKAB13eUKTU-91rinKCEfwOdgg_kmMUdPrgHitMzeVQLtA@mail.gmail.com>
Message-ID: <53905BCA.4070805@redhat.com>

On 06/05/2014 12:15 AM, Michael Watson wrote:
> "AMQP 1.0 is the standard.  It's ISO/IEC 19464 and we're chartered with
> using industry standards."  I can argue that 0.9.1, which has strong
> support from a massive community, is the de facto standard, but
> "ISO/IEC" are hard TLAs to ignore.

In my opinion, as far as protocols go, what matters most is the extent 
of support and the level of interoperability.

That's what makes TCP/IP (or HTTP,further up the stack) an industry 
standard - everyone supports it.

I would argue that support for AMQP 1.0 is at least growing. It is 
unlikely that the earlier iterations of the protocol see new 
implementations, particularly on the broker side.

So 0.9.1 is to all intents and purposes the RabbitMQ protocol (much like 
0-10 is just a Qpid protocol, or OpenWire is just an ActiveMQ protocol).

If interoperability and choice is a consideration (and I'd certainly 
accept they aren't in every case) then AMQP 1.0, STOMP and MQTT are 
better choices as they are supported by more than one broker 
implementation (including RabbitMQ).

--Gordon.


From mklishin at gopivotal.com  Thu Jun  5 14:05:46 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Jun 2014 17:05:46 +0400
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <etPan.538f1058.431bd7b7.e723@mercurio.local>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
Message-ID: <etPan.53906b45.6b8b4567.166c0@mercurio.local>

On 4 June 2014 at 16:27:26, Michael Klishin (mklishin at gopivotal.com) wrote:
> > http://www.rabbitmq.com/nightlies/rabbitmq-java-client/  
> has nightly builds
> of the Java client. Unfortunately, it seems there's a problem  
> with producing nightly builds
> and the May 5th?
> version does not include the fix I've mentioned.
>  
> Here's how to build the client from source:
>  
> http://www.rabbitmq.com/build-java-client.html

Nightly builds are available again:

http://www.rabbitmq.com/nightlies/rabbitmq-java-client/v3.3.1.50605/
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From tonygarnockjones+rabbitmq at gmail.com  Thu Jun  5 14:27:59 2014
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 5 Jun 2014 09:27:59 -0400
Subject: [rabbitmq-discuss] Interoperability and Server Agnosticism (was Re:
 Pressured to move to AMQP 1.0)
Message-ID: <CAM8fPiSFyDeCJp81=s9RF0755EmPQXucQd38EQg1C+AESMmfQg@mail.gmail.com>

On 5 June 2014 08:00, Gordon Sim <gsim at redhat.com> wrote:

> So 0.9.1 is to all intents and purposes the RabbitMQ protocol (much like
> 0-10 is just a Qpid protocol, or OpenWire is just an ActiveMQ protocol).
>

That doesn't seem quite right. Support for 0-9-1 is even now an advertised
feature of Qpid-java:
http://qpid.apache.org/components/java-broker/index.html. There was quite a
bit of cross-implementor support for it, for a while there, whereas I'm not
aware of similar levels of interoperability for the other protocols you
mention.

If interoperability and choice is a consideration (and I'd certainly accept
> they aren't in every case) then AMQP 1.0, STOMP and MQTT are better choices
> as they are supported by more than one broker implementation (including
> RabbitMQ).
>

I've recently become curious about AMQP 1.0 interoperability again. I know
with STOMP and MQTT, quite sophisticated distributed systems can be written
using client libraries without regard for which STOMP or MQTT server one is
using. Beyond a certain point, however, one leaves the spec behind and
relies on implementation-specific behaviour.

For a while there, AMQP 0-9-1 enjoyed similar rough consensus and running
code. People can still run their clients against Qpid-java using AMQP
0-9-1, and get a certain base level of interchangeability with RabbitMQ.

What is the level of server-agnosticism that people are actually seeing
with AMQP 1.0?

It's clear that people can get the AMQP 1.0 transport and data encoding
languages to interoperate. They might even get some links established.

Is it possible to get server implementation agnosticism while programming
at the AMQP 1.0 equivalent of the conceptual level of exchanges, queues,
and bindings?

I read the OASIS spec yesterday, at long last, and it doesn't seem to cover
anything at that level, and the various extension registries at amqp.org
are all empty. Perhaps there's a de-facto standard for AMQP 1.0 broker
behaviour? Any pointers anyone has to hand would be appreciated.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/9f15f133/attachment.html>

From gsim at redhat.com  Thu Jun  5 15:25:09 2014
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 05 Jun 2014 15:25:09 +0100
Subject: [rabbitmq-discuss] Interoperability and Server Agnosticism (was
 Re: Pressured to move to AMQP 1.0)
In-Reply-To: <CAM8fPiSFyDeCJp81=s9RF0755EmPQXucQd38EQg1C+AESMmfQg@mail.gmail.com>
References: <CAM8fPiSFyDeCJp81=s9RF0755EmPQXucQd38EQg1C+AESMmfQg@mail.gmail.com>
Message-ID: <53907DC5.7080205@redhat.com>

On 06/05/2014 02:27 PM, Tony Garnock-Jones wrote:
> What is the level of server-agnosticism that people are actually seeing
> with AMQP 1.0?

A reasonable degree, though I would certainly love to see some consensus 
from implementers on extending that.

Specifically you can get reliable (i.e. acknowledged) or unreliable 
(unacknowledged) transfer to and from queues, you can get pub-sub, you 
can get request-reply with several different brokers[1] all based on the 
core protocol as published.

I would argue that's probably more than you get with either STOMP or 
MQTT on their own.

In addition several brokers support some extensions and conventions that 
essentially allow full JMS functionality against different brokers over 
AMQP 1.0.

> It's clear that people can get the AMQP 1.0 transport and data encoding
> languages to interoperate. They might even get some links established.
>
> Is it possible to get server implementation agnosticism while
> programming at the AMQP 1.0 equivalent of the conceptual level of
> exchanges, queues, and bindings?
>
> I read the OASIS spec yesterday, at long last, and it doesn't seem to
> cover anything at that level, and the various extension registries at
> amqp.org <http://amqp.org> are all empty.

There have been some filters registered for some time now:

   http://www.amqp.org/specification/1.0/filters

These are relied on for full JMS behaviour and also include some support 
for the old exchange types.

> Perhaps there's a de-facto standard for AMQP 1.0 broker behaviour?

There is work ongoing I believe to standardise the JMS mapping, 
including any extensions it requires, which will provide some of this.

--Gordon

[1] Both Qpid brokers, Qpid dispatch router, ActiveMQ, ApolloMQ, 
HornetQ, SwiftMQ and apart from the request-response, RabbitMQ. There is 
of course also Microsoft's ServiceBus and IBM's MQLight, but I haven't 
yet tried either of those.


From lepolac at gmail.com  Thu Jun  5 16:02:16 2014
From: lepolac at gmail.com (lepolac)
Date: Thu, 5 Jun 2014 08:02:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Permissions and exchanges
Message-ID: <1401980536396-36082.post@n5.nabble.com>

Hi,
 
I had a look at the permissions but they are regexp based to grant
permission on objects that matches the expression.
What if I want to revoke the configure permission for any resource ?
Is there a possibility to put ?none? as configure regexp ?
 
Also is there a way to allow queue declaration and bindings, but restrict
exchange creation ?

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Permissions-and-exchanges-tp36082.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tonygarnockjones+rabbitmq at gmail.com  Thu Jun  5 18:00:26 2014
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 5 Jun 2014 13:00:26 -0400
Subject: [rabbitmq-discuss] Interoperability and Server Agnosticism (was
 Re: Pressured to move to AMQP 1.0)
In-Reply-To: <53907DC5.7080205@redhat.com>
References: <CAM8fPiSFyDeCJp81=s9RF0755EmPQXucQd38EQg1C+AESMmfQg@mail.gmail.com>
 <53907DC5.7080205@redhat.com>
Message-ID: <CAM8fPiTkE8kQS27N+Epv47-cZ+ap_9CfjKC4yo_MSnTC10cN6A@mail.gmail.com>

On 5 June 2014 10:25, Gordon Sim <gsim at redhat.com> wrote:

> Specifically you can get reliable (i.e. acknowledged) or unreliable
> (unacknowledged) transfer to and from queues, you can get pub-sub, you can
> get request-reply with several different brokers all based on the core
> protocol as published.
>

Thanks. I've gone back and puzzled out some of how that might be done,
based on the spec document. But it doesn't look like many of the brokers
actually do things based on the spec's ideas of "distribution mode" and
"filter". Instead, they encode routing, filtering, and node type into
source and target *names*.

The documentation for each of (at least!) ApolloMQ [1], ActiveMQ [2], and
RabbitMQ [3] makes it clear that the semantics of AMQP 1.0 routing,
filtering, and delivery is largely based on encoding things into node
names. Each broker does this quite differently, and seemingly quite
independently of support for destination modes and filters.

This makes me think that reliably selecting, say, queueing functionality
requires intimate knowledge of the specific broker the client will be
running against, in order to choose the correct way of encoding the notion
of "queue" into the node name.

I may have missed something in the protocol spec, but on top of this, it
looks like there is no standard way to create nodes (queues/exchanges) with
application-chosen names. How do implementations deal with that?

Not being able to choose node names for shared resources in a portable way
makes it difficult both to select specific functionality (because of the
encoding of node type and filtering into node names) and to establish a
shared understanding of resource names between clients communicating via a
broker.

Based on what you've said so far, I don't think AMQP 1.0 server-agnostic
interop is there yet. It sounds more like it's en par with STOMP, actually,
which can do all of the things you list above, with the caveat that some
things are encoded into resource names, just like it seems AMQP 1.0
implementations do.

(Aside: Why isn't request-reply layered atop regular messaging? Why does it
need special support? That seems weird.)

Cheers,
  Tony

[1] http://activemq.apache.org/apollo/documentation/amqp-manual.html
[2] http://activemq.apache.org/amqp.html
[3] https://github.com/rabbitmq/rabbitmq-amqp1.0#routing-and-addressing
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/713235b3/attachment.html>

From gsim at redhat.com  Thu Jun  5 18:18:11 2014
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 05 Jun 2014 18:18:11 +0100
Subject: [rabbitmq-discuss] Interoperability and Server Agnosticism (was
 Re: Pressured to move to AMQP 1.0)
In-Reply-To: <CAM8fPiTkE8kQS27N+Epv47-cZ+ap_9CfjKC4yo_MSnTC10cN6A@mail.gmail.com>
References: <CAM8fPiSFyDeCJp81=s9RF0755EmPQXucQd38EQg1C+AESMmfQg@mail.gmail.com>
 <53907DC5.7080205@redhat.com>
 <CAM8fPiTkE8kQS27N+Epv47-cZ+ap_9CfjKC4yo_MSnTC10cN6A@mail.gmail.com>
Message-ID: <5390A653.3060000@redhat.com>

On 06/05/2014 06:00 PM, Tony Garnock-Jones wrote:
> This makes me think that reliably selecting, say, queueing functionality
> requires intimate knowledge of the specific broker the client will be
> running against, in order to choose the correct way of encoding the
> notion of "queue" into the node name.

Yes, that's true. You do need to potentially tailor the exact name you 
use in each case. That is an area I think we could improve by some 
consensus between existing implementers without requiring much extra 
effort by anyone.

> I may have missed something in the protocol spec, but on top of this, it
> looks like there is no standard way to create nodes (queues/exchanges)
> with application-chosen names. How do implementations deal with that?

ApolloMQ has a very nice approach that is a lot like RabbitMQ policies. 
You define a configuration along with a pattern and when links are 
attached for non-existent nodes matching that pattern, the policy is 
used to create them.

The Qpid c++ broker has copied this approach. It lets you control what 
part of the 'node' namespace can be created on demand and how to do that 
creation. It also centralises the configuration making it easy to change 
and enforce (as opposed to having to have it updated in all clients).

I'd love to see other implementations adopting similar approaches. (It 
would work with STOMP as well).

> Not being able to choose node names for shared resources in a portable
> way makes it difficult both to select specific functionality (because of
> the encoding of node type and filtering into node names) and to
> establish a shared understanding of resource names between clients
> communicating via a broker.
>
> Based on what you've said so far, I don't think AMQP 1.0 server-agnostic
> interop is there yet. It sounds more like it's en par with STOMP,
> actually, which can do all of the things you list above, with the caveat
> that some things are encoded into resource names, just like it seems
> AMQP 1.0 implementations do.

I've found that request-response doesn't work so well with STOMP because 
of the lack of support for creating temporary reply-queues and including 
a reference of some sort to them in the reply-to.

> (Aside: Why isn't request-reply layered atop regular messaging? Why does
> it need special support? That seems weird.)

I think having the ability to create a temp reply queue and a clear way 
of specifying that in the reuest message such that responses get back 
where they are expected is very helpful. AMQP 1.0 provides this.


From larry.gooroo at gmail.com  Fri Jun  6 05:44:46 2014
From: larry.gooroo at gmail.com (Larry Lewis)
Date: Thu, 5 Jun 2014 21:44:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Persistant/Semaphore
Message-ID: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>

Hi, been tinkering with RabbitMQ to solve a number of issues with 
distributed servers, mostly the tutorials/docs have given me the 
information needed but I have a special use case that I can't unravel.

In the simplest of the usages I have a queue called 'online' the message is 
either 'On' or 'Off' to indicate whether servers should be online or 
offline. The number of servers is variable depending on load (eg we are 
planning to use AWS for some of our sites) So there is always one and only 
one message persistently in the queue which indicates whether the server 
should be handling user web requests. So I need the value to be sticky, 
when a new server joins the queue it gets the last message and then is 
'subscribed' and will receive the state change.

My idea is that when everything is online I could just run a cron job which 
will ask the queue if it is on/off if off it will stop the web service (I 
already do this manually with a semaphore file) and wait for the message to 
'clear' back to 'online'. So how do I set up the sender and server side to 
do this sort of semaphore? I assume the consumer side will just be similar 
to what I have already being playing with on my local system here working 
through the tutorials.

Thanks in advance,
Larry

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/23ac4c0d/attachment.html>

From cesar.munoz at ammeon.com  Fri Jun  6 09:48:27 2014
From: cesar.munoz at ammeon.com (Cesar)
Date: Fri, 6 Jun 2014 01:48:27 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ waits forever for PID file during
	startup
Message-ID: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>

Hi all,

I am seeing this intermittent issue in RabbitMQ during its startup, right 
after installation. As you can see in this gist:

https://gist.github.com/xcu/9509f1d285dd9556667c

The startup was attempted at 0:51, and the wait /var/run/rabbitmq/pid is 
still hanging 9 hours later, which is blocking the rest of the 
installation. I believe the message in the startup_err is probably the 
cause of this, but after googling it I have found nothing useful.

Any ideas?

Thanks,
Cesar.

-- 
This email and any files transmitted with it are confidential and intended 
solely for the use of the individual or entity to whom they are addressed. 
If you have received this email in error please notify the system manager. 
This message contains confidential information and is intended only for the 
individual named. If you are not the named addressee you should not 
disseminate, distribute or copy this e-mail.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140606/389afdea/attachment.html>

From simon at rabbitmq.com  Fri Jun  6 10:16:31 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jun 2014 10:16:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ waits forever for PID file during
 startup
In-Reply-To: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>
References: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>
Message-ID: <539186EF.7010901@rabbitmq.com>

On 06/06/2014 9:48AM, Cesar wrote:
> Hi all,
>
> I am seeing this intermittent issue in RabbitMQ during its startup,
> right after installation. As you can see in this gist:
>
> https://gist.github.com/xcu/9509f1d285dd9556667c

Firstly, thanks for all the detail there.

> The startup was attempted at 0:51, and the wait /var/run/rabbitmq/pid is
> still hanging 9 hours later, which is blocking the rest of the
> installation. I believe the message in the startup_err is probably the
> cause of this, but after googling it I have found nothing useful.

So it looks like the startup shell script is failing to write its pid 
(which will become RabbitMQ's pid) to a file. The process which then 
waits for startup to complete then hangs forever since the file is missing.

So there are two issues here. One is that failing to write the pid file 
should lead to immediate failure - probably the script just needs to set 
"-e". I will make sure this gets some attention.

The second, and more baffling, issue is that on your system(s) the shell 
command:

     echo $$ > ${RABBITMQ_PID_FILE}

is actually failing due to "Cannot allocate memory". Yet in your startup 
log the machine seems to have 256GB, which ought to be enough to run 
even the most bloated version of echo.

So is it something about piping to a file? Are you hitting some ulimit 
or another? Is there anything unusual on this machine in terms of 
resource limits?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From cesar.munoz at ammeon.com  Fri Jun  6 10:49:46 2014
From: cesar.munoz at ammeon.com (Cesar Munoz)
Date: Fri, 6 Jun 2014 10:49:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ waits forever for PID file during
	startup
In-Reply-To: <539186EF.7010901@rabbitmq.com>
References: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>
 <539186EF.7010901@rabbitmq.com>
Message-ID: <CAHuDZ5rofeocjpouy5DuhvHxpbqAhH1UO00yeG=fEYT94r=XOw@mail.gmail.com>

Hi Simon,

the set -e looks like a very good idea, at least the process will return
the failure straight away!

These are the ulimits:

[root at ms1 ~]# ulimit -a
core file size          (blocks, -c) unlimited
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
pending signals                 (-i) 2066207
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
open files                      (-n) 1024
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 10240
cpu time               (seconds, -t) unlimited
max user processes              (-u) 2066207
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited


No error log showed up in /var/log/messages though...


Thanks!
Cesar.


On 6 June 2014 10:16, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/06/2014 9:48AM, Cesar wrote:
>
>> Hi all,
>>
>> I am seeing this intermittent issue in RabbitMQ during its startup,
>> right after installation. As you can see in this gist:
>>
>> https://gist.github.com/xcu/9509f1d285dd9556667c
>>
>
> Firstly, thanks for all the detail there.
>
>  The startup was attempted at 0:51, and the wait /var/run/rabbitmq/pid is
>> still hanging 9 hours later, which is blocking the rest of the
>> installation. I believe the message in the startup_err is probably the
>> cause of this, but after googling it I have found nothing useful.
>>
>
> So it looks like the startup shell script is failing to write its pid
> (which will become RabbitMQ's pid) to a file. The process which then waits
> for startup to complete then hangs forever since the file is missing.
>
> So there are two issues here. One is that failing to write the pid file
> should lead to immediate failure - probably the script just needs to set
> "-e". I will make sure this gets some attention.
>
> The second, and more baffling, issue is that on your system(s) the shell
> command:
>
>     echo $$ > ${RABBITMQ_PID_FILE}
>
> is actually failing due to "Cannot allocate memory". Yet in your startup
> log the machine seems to have 256GB, which ought to be enough to run even
> the most bloated version of echo.
>
> So is it something about piping to a file? Are you hitting some ulimit or
> another? Is there anything unusual on this machine in terms of resource
> limits?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>

-- 
This email and any files transmitted with it are confidential and intended 
solely for the use of the individual or entity to whom they are addressed. 
If you have received this email in error please notify the system manager. 
This message contains confidential information and is intended only for the 
individual named. If you are not the named addressee you should not 
disseminate, distribute or copy this e-mail.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140606/1fe6031a/attachment.html>

From Nikunj.Badjatya at emc.com  Fri Jun  6 11:14:53 2014
From: Nikunj.Badjatya at emc.com (Badjatya, Nikunj)
Date: Fri, 6 Jun 2014 10:14:53 +0000
Subject: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error,
 not_found}" (server down)
References: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>
 <etPan.538da663.327b23c6.7a61@mercurio.local>
 <538DB078.3020208@rabbitmq.com> 
Message-ID: <022ADF639A140D4790580A766237164C2BEFBF09@MX101CL02.corp.emc.com>

Hello All,

Any thoughts on this?

Thanks.


-----Original Message-----
From: Badjatya, Nikunj 
Sent: Wednesday, June 04, 2014 8:52 PM
To: 'Matthias Radestock'; 'Discussions about RabbitMQ'
Subject: RE: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error, not_found}" (server down)

Thank you all for quick replies.
Well this issue was not reproducible and we hit this only once.

I didn?t quite understand the reason given in http://markmail.org/thread/26j56abreqwd32fq#query:+page:1+mid:2j2la4yehcxferjy+state:results link.

Can you please explain it in simpler way?

I am not deleting node as part of any operation. Here are the operations which I am doing currently using Pika python library:

1. Create user using rabbitmqctl
2. Connect to localhost using BlockingConnection 3. get channel 4. create exchange if not done already 5. publish using basic_publish 6. Close connection 6. Delete user using rabbitmqctl


Thanks
Nikunj


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Tuesday, June 03, 2014 4:55 PM
To: Discussions about RabbitMQ
Cc: Badjatya, Nikunj
Subject: Re: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error, not_found}" (server down)

On 03/06/14 11:41, Michael Klishin wrote:
> On 3 June 2014 at 14:15:52, Badjatya, Nikunj (nikunj.badjatya at emc.com) wrote:
>>>
>> Stack trace:
>> [{rabbit_binding,recover_semi_durable_route,3,[]},
>> {rabbit_binding,'-recover/2-lc$^0/1-0-',3,[]},
>> {rabbit_binding,recover,2,[]},
>> {rabbit,recover,0,[]},
>> {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>> {rabbit,run_boot_step,1,[]},
>> {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>> {rabbit,start,2,[]}]
>
> See http://markmail.org/thread/26j56abreqwd32fq and http://markmail.org/thread/ntgfmmmnfrhjodtj.
>
> This is a known bug (#25783) which is not resolved yet.

Actually, there is a bug with the above signature that we fixed in 3.2.0

25822 prevent crash at startup when starting a clustered node hosting a
       durable non-HA queue which had been bound to a transient exchange which
       was deleted when the node was down (since 2.5.0)

Does that at all sound like what might be happening?

If not then, as Simon says, please send him a copy of the mnesia dir off-list.

Matthias.

From mklishin at gopivotal.com  Fri Jun  6 11:18:12 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 6 Jun 2014 14:18:12 +0400
Subject: [rabbitmq-discuss] RabbitMQ server 3.1.3: "badmatch, {error,
 not_found}" (server down)
In-Reply-To: <022ADF639A140D4790580A766237164C2BEFBF09@MX101CL02.corp.emc.com>
References: <022ADF639A140D4790580A766237164C1D599A74@MX101CL02.corp.emc.com>
 <etPan.538da663.327b23c6.7a61@mercurio.local>
 <538DB078.3020208@rabbitmq.com>
 <022ADF639A140D4790580A766237164C2BEFBF09@MX101CL02.corp.emc.com>
Message-ID: <etPan.53919582.643c9869.8563@mercurio.local>

On 6 June 2014 at 14:16:26, Badjatya, Nikunj (nikunj.badjatya at emc.com) wrote:
> > Any thoughts on this?

Try 3.3.1 and if the issue persists, send us an archive of your Mnesia directory
off-list.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Fri Jun  6 11:27:36 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jun 2014 11:27:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ waits forever for PID file during
 startup
In-Reply-To: <CAHuDZ5rofeocjpouy5DuhvHxpbqAhH1UO00yeG=fEYT94r=XOw@mail.gmail.com>
References: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>	<539186EF.7010901@rabbitmq.com>
 <CAHuDZ5rofeocjpouy5DuhvHxpbqAhH1UO00yeG=fEYT94r=XOw@mail.gmail.com>
Message-ID: <53919798.4080306@rabbitmq.com>

On 06/06/2014 10:49AM, Cesar Munoz wrote:
> Hi Simon,
>
> the set -e looks like a very good idea, at least the process will return
> the failure straight away!

Sure!

> These are the ulimits:
>
> [root at ms1 ~]# ulimit -a

<snip>

Those are the ulimits which apply to root - maybe they are different for 
the "rabbitmq" user?

But more to the point: we're failing to do something very very simple 
here, there has to be something weird about this system if echo or shell 
redirection can fail with an error message about memory allocation.

So have you configured anything unusual about this system?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From cesar.munoz at ammeon.com  Fri Jun  6 11:55:04 2014
From: cesar.munoz at ammeon.com (Cesar Munoz)
Date: Fri, 6 Jun 2014 11:55:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ waits forever for PID file during
	startup
In-Reply-To: <53919798.4080306@rabbitmq.com>
References: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>
 <539186EF.7010901@rabbitmq.com>
 <CAHuDZ5rofeocjpouy5DuhvHxpbqAhH1UO00yeG=fEYT94r=XOw@mail.gmail.com>
 <53919798.4080306@rabbitmq.com>
Message-ID: <CAHuDZ5qXfRaf4AOXYoe1gvB0tu=xb6q8DPhJ_vHy2RW1QoSp3g@mail.gmail.com>

Hi Simon,

the ulimits for rabbitmq user are pretty much the same, the only difference
is that max user processes is set to 1024 instead of 2066207.

About the system itself, it is true that there has to be something strange
going on if a shell redirection can fail, but I'm checking the
configuration and I don't see anything specially awkward.

We are using Red Hat 6.4, and these are the parameters that we set in the
sysctl.conf:
http://pastebin.com/SfJBwrna

The rest of the parameters in the kickstart file are pretty much the
standard ones.
This is an intermittent issue (we are testing how often it happens, so far
we got 3 failures in 13 installations), so it is harder to track it!
Either way, restarting the service works, so it looks like whatever causes
the problem disappears after a while. I've been trying to find what could
make this non-deterministic, but so far I haven't noticed anything unusual.

Thanks again!
Cesar.


On 6 June 2014 11:27, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/06/2014 10:49AM, Cesar Munoz wrote:
>
>> Hi Simon,
>>
>> the set -e looks like a very good idea, at least the process will return
>> the failure straight away!
>>
>
> Sure!
>
>
>  These are the ulimits:
>>
>> [root at ms1 ~]# ulimit -a
>>
>
> <snip>
>
> Those are the ulimits which apply to root - maybe they are different for
> the "rabbitmq" user?
>
> But more to the point: we're failing to do something very very simple
> here, there has to be something weird about this system if echo or shell
> redirection can fail with an error message about memory allocation.
>
> So have you configured anything unusual about this system?
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>

-- 
This email and any files transmitted with it are confidential and intended 
solely for the use of the individual or entity to whom they are addressed. 
If you have received this email in error please notify the system manager. 
This message contains confidential information and is intended only for the 
individual named. If you are not the named addressee you should not 
disseminate, distribute or copy this e-mail.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140606/f30f31f9/attachment.html>

From Chris.Nicel at 15below.com  Fri Jun  6 14:09:15 2014
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Fri, 6 Jun 2014 08:09:15 -0500
Subject: [rabbitmq-discuss] What happens during a network partition?
Message-ID: <1C5C5DECEB4DCA4EB25738317D20A98403892B5ED2@AUSP01VMBX06.collaborationhost.net>

Hi All,

We are having some problems with network partitions. We have dedicated equipment with our hosting provider so in theory network partitions shouldn't be a problem. But we have experienced more than one in the past month. We are running two vm's in a vsphere environment.

What happens in the event of a network partition? The log files show (/var/log/rabbitmq/rabbit at zmqX.log):

zmq1 (usually the primary node in the cluster):
=ERROR REPORT==== 6-Jun-2014::12:15:57 ===
** Node 'rabbit at zmq2' not responding **
** Removing (timedout) connection **

=INFO REPORT==== 6-Jun-2014::12:19:36 ===
rabbit on node 'rabbit at zmq2' down

zmq2:
=INFO REPORT==== 6-Jun-2014::12:19:21 ===
rabbit on node 'rabbit at 15below-zmq1' down

Curiously there is nothing else in the logs on zmq2 @ 12:15

Any help or advice would be helpful.

Cheers

Chris Nicel
Senior Systems Engineer
15below ltd : 15below Australia pty. ltd.

t:        +44 1273 764230
e:       chris.nicel at 15below.com<mailto:chris.nicel at 15below.com>
w:      15below.com<http://www.15below.com/>
[cid:image001.png at 01CF8190.E660A1C0]       @15below_travel<https://twitter.com/#!/15below_travel>


15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140606/10b2a9c9/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 808 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140606/10b2a9c9/attachment.png>

From mklishin at gopivotal.com  Fri Jun  6 14:37:04 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 6 Jun 2014 17:37:04 +0400
Subject: [rabbitmq-discuss] What happens during a network partition?
In-Reply-To: <1C5C5DECEB4DCA4EB25738317D20A98403892B5ED2@AUSP01VMBX06.collaborationhost.net>
References: <1C5C5DECEB4DCA4EB25738317D20A98403892B5ED2@AUSP01VMBX06.collaborationhost.net>
Message-ID: <etPan.5391c41b.6b8b4567.183cc@mercurio.local>

On 6 June 2014 at 17:11:10, Chris Nicel (chris.nicel at 15below.com) wrote:
> >
> What happens in the event of a network partition?

See?http://www.rabbitmq.com/partitions.html and?http://www.rabbitmq.com/ha.html.

> Curiously there is nothing else in the logs on zmq2 @ 12:15

Network partitions can be asymmetrical: node A can connect to B but
B can't connect to A. Or they don't detect connectivity loss
at the same time. So this is not necessarily an indication of something
unusual .
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Fri Jun  6 15:48:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jun 2014 15:48:57 +0100
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
Message-ID: <5391D4D9.80706@rabbitmq.com>

On 06/06/2014 5:44AM, Larry Lewis wrote:
> So I need the value to be
> sticky, when a new server joins the queue it gets the last message and
> then is 'subscribed' and will receive the state change.

See the LVC plugin here:

   http://www.rabbitmq.com/community-plugins.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Chris.Nicel at 15below.com  Fri Jun  6 15:54:07 2014
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Fri, 6 Jun 2014 09:54:07 -0500
Subject: [rabbitmq-discuss] What happens during a network partition?
In-Reply-To: <etPan.5391c41b.6b8b4567.183cc@mercurio.local>
References: <1C5C5DECEB4DCA4EB25738317D20A98403892B5ED2@AUSP01VMBX06.collaborationhost.net>
 <etPan.5391c41b.6b8b4567.183cc@mercurio.local>
Message-ID: <1C5C5DECEB4DCA4EB25738317D20A98403892B5F0A@AUSP01VMBX06.collaborationhost.net>

Hi Michael,

Thanks for the info. Not sure why I couldn't find those pages on your website.

I will pass this info on to our hosting provider. Hopefully they will shed some light on it.

Cheers

Chris

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com]
Sent: 06 June 2014 14:37
To: Chris Nicel; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] What happens during a network partition?

On 6 June 2014 at 17:11:10, Chris Nicel (chris.nicel at 15below.com) wrote:
> >
> What happens in the event of a network partition?

See http://www.rabbitmq.com/partitions.html and http://www.rabbitmq.com/ha.html.

> Curiously there is nothing else in the logs on zmq2 @ 12:15

Network partitions can be asymmetrical: node A can connect to B but B can't connect to A. Or they don't detect connectivity loss at the same time. So this is not necessarily an indication of something unusual .
--
MK

Software Engineer, Pivotal/RabbitMQ

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From simon at rabbitmq.com  Fri Jun  6 16:16:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jun 2014 16:16:57 +0100
Subject: [rabbitmq-discuss] What happens during a network partition?
In-Reply-To: <1C5C5DECEB4DCA4EB25738317D20A98403892B5ED2@AUSP01VMBX06.collaborationhost.net>
References: <1C5C5DECEB4DCA4EB25738317D20A98403892B5ED2@AUSP01VMBX06.collaborationhost.net>
Message-ID: <5391DB69.3050101@rabbitmq.com>

On 06/06/2014 2:09PM, Chris Nicel wrote:
> We are running two vm?s in a vsphere environment.

> Curiously there is nothing else in the logs on zmq2 @ 12:15

The asymmetry smells like http://www.rabbitmq.com/partitions.html#suspend

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From brent.williams at hp.com  Fri Jun  6 23:59:58 2014
From: brent.williams at hp.com (Williams, Brent (Snapfish Web Platform))
Date: Fri, 6 Jun 2014 22:59:58 +0000
Subject: [rabbitmq-discuss] High CPU Usage
Message-ID: <51BD98A617F6944F8EB8ABC68A63D3EB2CDF6B20@G4W3296.americas.hpqcorp.net>

All,

I have a clustered RabbitMQ service running 3.1.5. Both servers are Ubuntu 12.04 VMs running on ESX Vmware. Both have 16 CPUS and 32 GBs. Of RAM and 100 GBs of storage.

I have 10 Queues and multiple clients connecting around 1,000. My CPU is running at 300 % on the beam.swp process. Also my RabbitMq management console is reporting 5800 erlang processes. Any ideas what I might be missing? I have attached my rabbitmqctl report output below.

Reporting server status on {{2014,6,6},{22,48,23}}

...
Status of node 'rabbit at video-rabbitmq02' ...
[{pid,24741},
{running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.1.5"},
      {rabbitmq_management,"RabbitMQ Management Console","3.1.5"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.5"},
      {rabbit,"RabbitMQ","3.1.5"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.5"},
      {webmachine,"webmachine","1.10.3-rmq3.1.5-gite9359c7"},
      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.1.5-git680dba8"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.5"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
{os,{unix,linux}},
{erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:16:16] [rq:16] [async-threads:30] [kernel-poll:true]\n"},
{memory,
     [{total,170703648},
      {connection_procs,883728},
      {queue_procs,186440},
      {plugins,499872},
      {other_proc,9559536},
      {mnesia,111640},
      {mgmt_db,9904},
      {msg_index,43920},
      {other_ets,1167880},
      {binary,1848960},
      {code,17693226},
      {atom,1569041},
      {other_system,137129501}]},
{vm_memory_high_watermark,0.4},
{vm_memory_limit,12345879756},
{disk_free_limit,1000000000},
{disk_free,31037026304},
{file_descriptors,
     [{total_limit,202300},
      {total_used,14},
      {sockets_limit,182068},
      {sockets_used,12}]},
{processes,[{limit,1048576},{used,344}]},
{run_queue,0},
{uptime,2426}]

Cluster status of node 'rabbit at video-rabbitmq02' ...
[{nodes,[{disc,['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02']}]},
{running_nodes,['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02']},
{partitions,[]}]

Application environment of node 'rabbit at video-rabbitmq02' ...
[{auth_backends,[rabbit_auth_backend_internal]},
{auth_mechanisms,['PLAIN','AMQPLAIN']},
{backing_queue_module,rabbit_variable_queue},
{cluster_nodes,{['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02'],disc}},
{cluster_partition_handling,ignore},
{collect_statistics,fine},
{collect_statistics_interval,5000},
{default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
{default_user,<<"guest">>},
{default_user_tags,[administrator]},
{default_vhost,<<"/">>},
{delegate_count,16},
{disk_free_limit,1000000000},
{enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
{error_logger,{file,"/var/log/rabbitmq/rabbit at video-rabbitmq02.log"}},
{frame_max,131072},
{heartbeat,30},
{hipe_compile,false},
{hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
                rabbit_basic,rabbit_event,lists,queue,priority_queue,
                rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
                rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
                rabbit_amqqueue_process,rabbit_variable_queue,
                rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
                sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
                rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
                file_handle_cache,rabbit_msg_store,array,
                rabbit_msg_store_ets_index,rabbit_msg_file,
                rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
                mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
                ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
                ssl]},
{included_applications,[]},
{log_levels,[{connection,info}]},
{msg_store_file_size_limit,16777216},
{msg_store_index_module,rabbit_msg_store_ets_index},
{plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.5/sbin/../plugins"},
{plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at video-rabbitmq02-plugins-expand"},
{queue_index_max_journal_entries,65536},
{reverse_dns_lookups,false},
{sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at video-rabbitmq02-sasl.log"}},
{server_properties,[]},
{ssl_apps,[asn1,crypto,public_key,ssl]},
{ssl_cert_login_from,distinguished_name},
{ssl_listeners,[]},
{ssl_options,[]},
{tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
{tcp_listeners,[5672]},
{trace_vhosts,[]},
{vm_memory_high_watermark,0.4}]

Status of node 'rabbit at video-rabbitmq01' ...
[{pid,635},
{running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.1.5"},
      {rabbitmq_management,"RabbitMQ Management Console","3.1.5"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.5"},
      {rabbit,"RabbitMQ","3.1.5"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.5"},
      {webmachine,"webmachine","1.10.3-rmq3.1.5-gite9359c7"},
      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.1.5-git680dba8"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.5"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
{os,{unix,linux}},
{erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:16:16] [rq:16] [async-threads:30] [kernel-poll:true]\n"},
{memory,
     [{total,192724600},
      {connection_procs,64347776},
      {queue_procs,684680},
      {plugins,656872},
      {other_proc,13256928},
      {mnesia,111608},
      {mgmt_db,16321672},
      {msg_index,43920},
      {other_ets,2051136},
      {binary,4663672},
      {code,17271483},
      {atom,1551265},
      {other_system,71763588}]},
{vm_memory_high_watermark,0.4},
{vm_memory_limit,13402839449},
{disk_free_limit,1000000000},
{disk_free,34438590464},
{file_descriptors,
     [{total_limit,102300},
      {total_used,759},
      {sockets_limit,92068},
      {sockets_used,757}]},
{processes,[{limit,1048576},{used,8547}]},
{run_queue,125},
{uptime,3741}]

Cluster status of node 'rabbit at video-rabbitmq01' ...
[{nodes,[{disc,['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02']}]},
{running_nodes,['rabbit at video-rabbitmq02','rabbit at video-rabbitmq01']},
{partitions,[]}]

Application environment of node 'rabbit at video-rabbitmq01' ...
[{auth_backends,[rabbit_auth_backend_internal]},
{auth_mechanisms,['PLAIN','AMQPLAIN']},
{backing_queue_module,rabbit_variable_queue},
{cluster_nodes,{['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02'],disc}},
{cluster_partition_handling,ignore},
{collect_statistics,fine},
{collect_statistics_interval,5000},
{default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
{default_user,<<"guest">>},
{default_user_tags,[administrator]},
{default_vhost,<<"/">>},
{delegate_count,16},
{disk_free_limit,1000000000},
{enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
{error_logger,{file,"/var/log/rabbitmq/rabbit at video-rabbitmq01.log"}},
{frame_max,131072},
{heartbeat,30},
{hipe_compile,false},
{hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
                rabbit_basic,rabbit_event,lists,queue,priority_queue,
                rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
                rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
                rabbit_amqqueue_process,rabbit_variable_queue,
                rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
                sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
                rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
                file_handle_cache,rabbit_msg_store,array,
                rabbit_msg_store_ets_index,rabbit_msg_file,
                rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
                mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
                ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
                ssl]},
{included_applications,[]},
{log_levels,[{connection,info}]},
{msg_store_file_size_limit,16777216},
{msg_store_index_module,rabbit_msg_store_ets_index},
{plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.5/sbin/../plugins"},
{plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at video-rabbitmq01-plugins-expand"},
{queue_index_max_journal_entries,65536},
{reverse_dns_lookups,false},
{sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at video-rabbitmq01-sasl.log"}},
{server_properties,[]},
{ssl_apps,[asn1,crypto,public_key,ssl]},
{ssl_cert_login_from,distinguished_name},
{ssl_listeners,[]},
{ssl_options,[]},
{tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
{tcp_listeners,[5672]},
{trace_vhosts,[]},
{vm_memory_high_watermark,0.4}]

name    type       durable auto_delete       internal arguments          policy
                direct    true       false      false      []
amq.direct          direct    true       false      false      []             ha-all
amq.fanout        fanout  true       false      false      []             ha-all
amq.headers     headers               true       false      false      []             ha-all
amq.match         headers               true       false      false      []             ha-all
amq.rabbitmq.log            topic      true       false      false      []             ha-all
amq.rabbitmq.trace       topic      true       false      false      []             ha-all
amq.topic            topic      true       false      false      []             ha-all
default direct    true       false      false      []             ha-all
snapfish.video.transcode.completedjob               direct    true       false      false      []             ha-all
snapfish.video.transcode.startjob           direct    true       false      false      []             ha-all

Bindings on /:
source_name    source_kind       destination_name           destination_kind              routing_key       arguments
                exchange            POD1_SFPRD_FINISHED_JOBS   queue   POD1_SFPRD_FINISHED_JOBS   []
                exchange            POD1_SFQA_FINISHED_JOBS     queue   POD1_SFQA_FINISHED_JOBS     []
                exchange            POD2_SFPRD_FINISHED_JOBS   queue   POD2_SFPRD_FINISHED_JOBS   []
                exchange            POD2_SFQA_FINISHED_JOBS     queue   POD2_SFQA_FINISHED_JOBS     []
                exchange            POD3_SFPRD_FINISHED_JOBS   queue   POD3_SFPRD_FINISHED_JOBS   []
                exchange            POD4_SFPRD_FINISHED_JOBS   queue   POD4_SFPRD_FINISHED_JOBS   []
                exchange            POD5_SFPRD_FINISHED_JOBS   queue   POD5_SFPRD_FINISHED_JOBS   []
                exchange            snapfish.video.transcode.startjob           queue   snapfish.video.transcode.startjob           []
default exchange            POD1_SFPRD_FINISHED_JOBS   queue   POD1_SFPRD_FINISHED_JOBS   []
default exchange            POD1_SFPRD_FINISHED_JOBS   queue   snapfish.transcode.cj     []
default exchange            POD1_SFQA_FINISHED_JOBS     queue   POD1_SFQA_FINISHED_JOBS     []
default exchange            POD1_SFQA_FINISHED_JOBS     queue   snapfish.transcode.cj     []
default exchange            POD2_SFPRD_FINISHED_JOBS   queue   snapfish.transcode.cj     []
default exchange            POD2_SFQA_FINISHED_JOBS     queue   POD2_SFQA_FINISHED_JOBS     []
default exchange            POD2_SFQA_FINISHED_JOBS     queue   snapfish.transcode.cj     []
default exchange            POD3_SFPRD_FINISHED_JOBS   queue   snapfish.transcode.cj     []
default exchange            POD4_SFPRD_FINISHED_JOBS   queue   snapfish.transcode.cj     []
default exchange            POD5_SFPRD_FINISHED_JOBS   queue   snapfish.transcode.cj     []
default exchange            snapfish.video.transcode.startjob           queue   snapfish.video.transcode.startjob           []

Consumers on /:

Permissions on /:
user       configure             write     read
guest     .*            .*            .*

Policies on /:
vhost     name    pattern definition            priority
/              ha-all     ^.            {"ha-mode":"all"}            0

Parameters on /:

...done.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140606/86cf0fd1/attachment.html>

From mklishin at gopivotal.com  Sat Jun  7 00:48:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 7 Jun 2014 03:48:29 +0400
Subject: [rabbitmq-discuss] High CPU Usage
In-Reply-To: <51BD98A617F6944F8EB8ABC68A63D3EB2CDF6B20@G4W3296.americas.hpqcorp.net>
References: <51BD98A617F6944F8EB8ABC68A63D3EB2CDF6B20@G4W3296.americas.hpqcorp.net>
Message-ID: <etPan.5392536a.6b8b4567.1fd7@mercurio.local>

On 7 June 2014 at 03:04:24, Williams, Brent (Snapfish Web Platform) (brent.williams at hp.com) wrote:
> > I have 10 Queues and multiple clients connecting around 1,000.  
> My CPU is running at 300 % on the beam.swp process. Also my RabbitMq  
> management console is reporting 5800 erlang processes. Any  
> ideas what I might be missing?

300% CPU means 3 cores fully utilised . 5800 Erlang processes is fine: you can create
millions of them and send each a message on significantly more modest hardware.

Some numbers on how much a newly spawned Erlang process takes can be found
in the docs:?http://www.erlang.org/doc/efficiency_guide/processes.html

(in your case the number will be higher because SMP is almost certainly used)
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Sat Jun  7 00:51:18 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 7 Jun 2014 03:51:18 +0400
Subject: [rabbitmq-discuss] High CPU Usage
In-Reply-To: <etPan.5392536a.6b8b4567.1fd7@mercurio.local>
References: <51BD98A617F6944F8EB8ABC68A63D3EB2CDF6B20@G4W3296.americas.hpqcorp.net>
 <etPan.5392536a.6b8b4567.1fd7@mercurio.local>
Message-ID: <etPan.53925414.643c9869.1fd7@mercurio.local>



On 7 June 2014 at 03:50:15, Michael Klishin (mklishin at gopivotal.com) wrote:
> > 5800 Erlang processes is fine: you can create
> millions of them and send each a message on significantly more 
> modest hardware.

What I meant to say: millions _in 1 second_.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From jsosic at gmail.com  Sat Jun  7 02:36:11 2014
From: jsosic at gmail.com (Jakov Sosic)
Date: Sat, 07 Jun 2014 03:36:11 +0200
Subject: [rabbitmq-discuss] Moving from 2node to 3node cluster?
Message-ID: <53926C8B.4030402@gmail.com>

Hi,

I have a 2node rabbitmq cluster with about 10 HA queues.

I plan to expand it to 3 node cluster..

My plan so far is to:

- shut down secondary
- shut down primary
- change config on primary
- start primary
- change config on secondary
- start secondary
- sync secondary to primary
- start third server

Is there maybe a faster solution, or is this as best as I can do :)

From brentrwill at gmail.com  Sat Jun  7 00:14:11 2014
From: brentrwill at gmail.com (Brent Williams)
Date: Fri, 6 Jun 2014 16:14:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Help High CPU Usage
Message-ID: <e84e224d-65ca-4f32-8281-0990e663c164@googlegroups.com>



All,

 

I have a clustered RabbitMQ service running 3.1.5. Both servers are Ubuntu 
12.04 VMs running on ESX Vmware. Both have 16 CPUs and 32 GBs of RAM and 
100 GBs of storage.

 

I have 10 Queues and multiple clients connecting around 1,000. My CPU is 
running at 300 % on the beam.swp process. Also my RabbitMq management 
console is reporting 5800 erlang processes. Any ideas what I might be 
missing? I have attached my rabbitmqctl report output below.

 

Reporting server status on {{2014,6,6},{22,48,23}}

 

...

Status of node 'rabbit at video-rabbitmq02' ...

[{pid,24741},

{running_applications,

     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.1.5"},

      {rabbitmq_management,"RabbitMQ Management Console","3.1.5"},

      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.5"},

      {rabbit,"RabbitMQ","3.1.5"},

      {os_mon,"CPO  CXC 138 46","2.2.7"},

      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.5"},

      {webmachine,"webmachine","1.10.3-rmq3.1.5-gite9359c7"},

      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.1.5-git680dba8"},

      {xmerl,"XML parser","1.2.10"},

      {inets,"INETS  CXC 138 49","5.7.1"},

      {mnesia,"MNESIA  CXC 138 12","4.5"},

      {amqp_client,"RabbitMQ AMQP Client","3.1.5"},

      {sasl,"SASL  CXC 138 11","2.1.10"},

      {stdlib,"ERTS  CXC 138 10","1.17.5"},

      {kernel,"ERTS  CXC 138 10","2.14.5"}]},

{os,{unix,linux}},

{erlang_version,

     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:16:16] [rq:16] 
[async-threads:30] [kernel-poll:true]\n"},

{memory,

     [{total,170703648},

      {connection_procs,883728},

      {queue_procs,186440},

      {plugins,499872},

      {other_proc,9559536},

      {mnesia,111640},

      {mgmt_db,9904},

      {msg_index,43920},

      {other_ets,1167880},

      {binary,1848960},

      {code,17693226},

      {atom,1569041},

      {other_system,137129501}]},

{vm_memory_high_watermark,0.4},

{vm_memory_limit,12345879756},

{disk_free_limit,1000000000},

{disk_free,31037026304},

{file_descriptors,

     [{total_limit,202300},

      {total_used,14},

      {sockets_limit,182068},

      {sockets_used,12}]},

{processes,[{limit,1048576},{used,344}]},

{run_queue,0},

{uptime,2426}]

 

Cluster status of node 'rabbit at video-rabbitmq02' ...

[{nodes,[{disc,['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02']}]},

{running_nodes,['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02']},

{partitions,[]}]

 

Application environment of node 'rabbit at video-rabbitmq02' ...

[{auth_backends,[rabbit_auth_backend_internal]},

{auth_mechanisms,['PLAIN','AMQPLAIN']},

{backing_queue_module,rabbit_variable_queue},

{cluster_nodes,{['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02'],disc}},

{cluster_partition_handling,ignore},

{collect_statistics,fine},

{collect_statistics_interval,5000},

{default_permissions,[<<".*">>,<<".*">>,<<".*">>]},

{default_user,<<"guest">>},

{default_user_tags,[administrator]},

{default_vhost,<<"/">>},

{delegate_count,16},

{disk_free_limit,1000000000},

{enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},

{error_logger,{file,"/var/log/rabbitmq/rabbit at video-rabbitmq02.log"}},

{frame_max,131072},

{heartbeat,30},

{hipe_compile,false},

{hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,

                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,

                rabbit_basic,rabbit_event,lists,queue,priority_queue,

                rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,

                rabbit_exchange_type_direct,rabbit_guid,rabbit_net,

                rabbit_amqqueue_process,rabbit_variable_queue,

                
rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,

                sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,

                
rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,

                file_handle_cache,rabbit_msg_store,array,

                rabbit_msg_store_ets_index,rabbit_msg_file,

                
rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,

                
mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,

                ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,

                ssl]},

{included_applications,[]},

{log_levels,[{connection,info}]},

{msg_store_file_size_limit,16777216},

{msg_store_index_module,rabbit_msg_store_ets_index},

{plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.5/sbin/../plugins"},

{plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at video-rabbitmq02-plugins-expand"},

{queue_index_max_journal_entries,65536},

{reverse_dns_lookups,false},

{sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at video-rabbitmq02-sasl.log
"}},

{server_properties,[]},

{ssl_apps,[asn1,crypto,public_key,ssl]},

{ssl_cert_login_from,distinguished_name},

{ssl_listeners,[]},

{ssl_options,[]},

{tcp_listen_options,[binary,

                      {packet,raw},

                      {reuseaddr,true},

                      {backlog,128},

                      {nodelay,true},

                      {linger,{true,0}},

                      {exit_on_close,false}]},

{tcp_listeners,[5672]},

{trace_vhosts,[]},

{vm_memory_high_watermark,0.4}]

 

Status of node 'rabbit at video-rabbitmq01' ...

[{pid,635},

{running_applications,

     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.1.5"},

      {rabbitmq_management,"RabbitMQ Management Console","3.1.5"},

      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.5"},

      {rabbit,"RabbitMQ","3.1.5"},

      {os_mon,"CPO  CXC 138 46","2.2.7"},

      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.5"},

      {webmachine,"webmachine","1.10.3-rmq3.1.5-gite9359c7"},

      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.1.5-git680dba8"},

      {xmerl,"XML parser","1.2.10"},

      {inets,"INETS  CXC 138 49","5.7.1"},

      {mnesia,"MNESIA  CXC 138 12","4.5"},

      {amqp_client,"RabbitMQ AMQP Client","3.1.5"},

      {sasl,"SASL  CXC 138 11","2.1.10"},

      {stdlib,"ERTS  CXC 138 10","1.17.5"},

      {kernel,"ERTS  CXC 138 10","2.14.5"}]},

{os,{unix,linux}},

{erlang_version,

     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:16:16] [rq:16] 
[async-threads:30] [kernel-poll:true]\n"},

{memory,

     [{total,192724600},

      {connection_procs,64347776},

      {queue_procs,684680},

      {plugins,656872},

      {other_proc,13256928},

      {mnesia,111608},

      {mgmt_db,16321672},

      {msg_index,43920},

      {other_ets,2051136},

      {binary,4663672},

      {code,17271483},

      {atom,1551265},

      {other_system,71763588}]},

{vm_memory_high_watermark,0.4},

{vm_memory_limit,13402839449},

{disk_free_limit,1000000000},

{disk_free,34438590464},

{file_descriptors,

     [{total_limit,102300},

      {total_used,759},

      {sockets_limit,92068},

      {sockets_used,757}]},

{processes,[{limit,1048576},{used,8547}]},

{run_queue,125},

{uptime,3741}]

 

Cluster status of node 'rabbit at video-rabbitmq01' ...

[{nodes,[{disc,['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02']}]},

{running_nodes,['rabbit at video-rabbitmq02','rabbit at video-rabbitmq01']},

{partitions,[]}]

 

Application environment of node 'rabbit at video-rabbitmq01' ...

[{auth_backends,[rabbit_auth_backend_internal]},

{auth_mechanisms,['PLAIN','AMQPLAIN']},

{backing_queue_module,rabbit_variable_queue},

{cluster_nodes,{['rabbit at video-rabbitmq01','rabbit at video-rabbitmq02'],disc}},

{cluster_partition_handling,ignore},

{collect_statistics,fine},

{collect_statistics_interval,5000},

{default_permissions,[<<".*">>,<<".*">>,<<".*">>]},

{default_user,<<"guest">>},

{default_user_tags,[administrator]},

{default_vhost,<<"/">>},

{delegate_count,16},

{disk_free_limit,1000000000},

{enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},

{error_logger,{file,"/var/log/rabbitmq/rabbit at video-rabbitmq01.log"}},

{frame_max,131072},

{heartbeat,30},

{hipe_compile,false},

{hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,

                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,

                rabbit_basic,rabbit_event,lists,queue,priority_queue,

                rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,

                rabbit_exchange_type_direct,rabbit_guid,rabbit_net,

                rabbit_amqqueue_process,rabbit_variable_queue,

                
rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,

                sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,

                
rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,

                file_handle_cache,rabbit_msg_store,array,

                rabbit_msg_store_ets_index,rabbit_msg_file,

                
rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,

                
mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,

                ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,

                ssl]},

{included_applications,[]},

{log_levels,[{connection,info}]},

{msg_store_file_size_limit,16777216},

{msg_store_index_module,rabbit_msg_store_ets_index},

{plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.5/sbin/../plugins"},

{plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at video-rabbitmq01-plugins-expand"},

{queue_index_max_journal_entries,65536},

{reverse_dns_lookups,false},

{sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at video-rabbitmq01-sasl.log
"}},

{server_properties,[]},

{ssl_apps,[asn1,crypto,public_key,ssl]},

{ssl_cert_login_from,distinguished_name},

{ssl_listeners,[]},

{ssl_options,[]},

{tcp_listen_options,[binary,

                      {packet,raw},

                      {reuseaddr,true},

                      {backlog,128},

                      {nodelay,true},

                      {linger,{true,0}},

                      {exit_on_close,false}]},

{tcp_listeners,[5672]},

{trace_vhosts,[]},

{vm_memory_high_watermark,0.4}]

Consumers on /:

 Permissions on /:

user       configure             write     read

guest     .*            .*            .*

 

Policies on /:

vhost     name    pattern definition            priority

/              ha-all     ^.            {"ha-mode":"all"}            0

 

Parameters on /:

 

...done.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140606/2afc8dc3/attachment.html>

From daniekatz at gmail.com  Sun Jun  8 10:16:58 2014
From: daniekatz at gmail.com (Daniel Katz)
Date: Sun, 8 Jun 2014 02:16:58 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ: Erlang machine stopped instantly
 (distribution name conflict?) on Windows
Message-ID: <f1318c01-4d17-4e8b-9139-087c7d8eb40b@googlegroups.com>

Hi,

Just spent a better half of the day troubleshooting a problem caused by *Unicode 
characters in my Windows User name*, which become part of the RABBITMQ_BASE 
path, and resulted in the following misleading error: 
*RabbitMQ: Erlang machine stopped instantly (distribution name conflict?)*

After hours of searching the web i found several unanswered questions on 
the same issue dating back to 2010. On one of them, which members of the 
team were unable to replicate because the nature of the BUG that it is 
environment-dependent.
Then i found a post by a Russian blogger that described the problem, the 
cause and the solution: 
*http://plus-odin.blogspot.co.il/2013/04/erlang-machine-stopped-instantly-code.html*

For the sake of all other non Latin language speakers that might encounter 
the same problem *I suggest to add this issue to 
the troubleshooting documentation*. And than, if possible fix the bug (or 
limitation).

Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140608/5858fc74/attachment.html>

From mklishin at gopivotal.com  Sun Jun  8 11:30:52 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 8 Jun 2014 14:30:52 +0400
Subject: [rabbitmq-discuss] RabbitMQ: Erlang machine stopped instantly
 (distribution name conflict?) on Windows
In-Reply-To: <f1318c01-4d17-4e8b-9139-087c7d8eb40b@googlegroups.com>
References: <f1318c01-4d17-4e8b-9139-087c7d8eb40b@googlegroups.com>
Message-ID: <etPan.53943b76.643c9869.61ed@mercurio.local>

On 8 June 2014 at 14:28:40, Daniel Katz (daniekatz at gmail.com) wrote:
> > Then i found a post by a Russian blogger that described the problem,  
> the cause and the solution: http://plus-odin.blogspot.co.il/2013/04/erlang-machine-stopped-instantly-code.html  
>  
> For the sake of all other non Latin language speakers that might  
> encounter the same problem I suggest to add this issue to the troubleshooting  
> documentation. And than, if possible fix the bug (or limitation).  

Good idea. I can confirm that the analysis and the workaround (setting RABBITMQ_BASE
to a directory that only has ASCII characters in the path) in the post are sound.

Thank you for bringing this up!?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Thara.Vadakkeveedu at Kronos.com  Sun Jun  8 18:25:10 2014
From: Thara.Vadakkeveedu at Kronos.com (Vadakkeveedu, Thara)
Date: Sun, 8 Jun 2014 17:25:10 +0000
Subject: [rabbitmq-discuss] High CPU Usage
In-Reply-To: <etPan.5392536a.6b8b4567.1fd7@mercurio.local>
References: <51BD98A617F6944F8EB8ABC68A63D3EB2CDF6B20@G4W3296.americas.hpqcorp.net>
 <etPan.5392536a.6b8b4567.1fd7@mercurio.local>
Message-ID: <48F1E182B1021B449414C85E713CE825281105DA@WLT-MBX03.KRONOS.com>

Session time is roughly 3 mins...

Thara Vadakkeveedu | Performance Engineer | Kronos Incorporated
tel: +1 978 947 4123
Kronos | Time & Attendance ? Scheduling ? Absence Management ? HR & Payroll ? Hiring ? Labor Analytics
Join Kronos on: kronos.com | Facebook | Twitter | LinkedIn | YouTube


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Friday, June 06, 2014 7:48 PM
To: Williams, Brent (Snapfish Web Platform); Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] High CPU Usage

On 7 June 2014 at 03:04:24, Williams, Brent (Snapfish Web Platform) (brent.williams at hp.com) wrote:
> > I have 10 Queues and multiple clients connecting around 1,000.  
> My CPU is running at 300 % on the beam.swp process. Also my RabbitMq  
> management console is reporting 5800 erlang processes. Any  
> ideas what I might be missing?

300% CPU means 3 cores fully utilised . 5800 Erlang processes is fine: you can create
millions of them and send each a message on significantly more modest hardware.

Some numbers on how much a newly spawned Erlang process takes can be found
in the docs:?http://www.erlang.org/doc/efficiency_guide/processes.html

(in your case the number will be higher because SMP is almost certainly used)
--  
MK  

Software Engineer, Pivotal/RabbitMQ
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Thara.Vadakkeveedu at Kronos.com  Sun Jun  8 18:37:24 2014
From: Thara.Vadakkeveedu at Kronos.com (Vadakkeveedu, Thara)
Date: Sun, 8 Jun 2014 17:37:24 +0000
Subject: [rabbitmq-discuss] High CPU Usage
In-Reply-To: <48F1E182B1021B449414C85E713CE825281105DA@WLT-MBX03.KRONOS.com>
References: <51BD98A617F6944F8EB8ABC68A63D3EB2CDF6B20@G4W3296.americas.hpqcorp.net>
 <etPan.5392536a.6b8b4567.1fd7@mercurio.local>
 <48F1E182B1021B449414C85E713CE825281105DA@WLT-MBX03.KRONOS.com>
Message-ID: <48F1E182B1021B449414C85E713CE82528110602@WLT-MBX03.KRONOS.com>

Sent to the wrong address, please ignore this mail.. 

Thara Vadakkeveedu | Performance Engineer | Kronos Incorporated
tel: +1 978 947 4123
Kronos | Time & Attendance ? Scheduling ? Absence Management ? HR & Payroll ? Hiring ? Labor Analytics
Join Kronos on: kronos.com | Facebook | Twitter | LinkedIn | YouTube


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Vadakkeveedu, Thara
Sent: Sunday, June 08, 2014 1:25 PM
To: Discussions about RabbitMQ; Williams, Brent (Snapfish Web Platform)
Subject: Re: [rabbitmq-discuss] High CPU Usage

Session time is roughly 3 mins...

Thara Vadakkeveedu | Performance Engineer | Kronos Incorporated
tel: +1 978 947 4123
Kronos | Time & Attendance ? Scheduling ? Absence Management ? HR & Payroll ? Hiring ? Labor Analytics
Join Kronos on: kronos.com | Facebook | Twitter | LinkedIn | YouTube


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Friday, June 06, 2014 7:48 PM
To: Williams, Brent (Snapfish Web Platform); Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] High CPU Usage

On 7 June 2014 at 03:04:24, Williams, Brent (Snapfish Web Platform) (brent.williams at hp.com) wrote:
> > I have 10 Queues and multiple clients connecting around 1,000.  
> My CPU is running at 300 % on the beam.swp process. Also my RabbitMq  
> management console is reporting 5800 erlang processes. Any  
> ideas what I might be missing?

300% CPU means 3 cores fully utilised . 5800 Erlang processes is fine: you can create
millions of them and send each a message on significantly more modest hardware.

Some numbers on how much a newly spawned Erlang process takes can be found
in the docs:?http://www.erlang.org/doc/efficiency_guide/processes.html

(in your case the number will be higher because SMP is almost certainly used)
--  
MK  

Software Engineer, Pivotal/RabbitMQ
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From larry.gooroo at gmail.com  Mon Jun  9 04:57:52 2014
From: larry.gooroo at gmail.com (Larry Lewis)
Date: Sun, 8 Jun 2014 20:57:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
Message-ID: <52c7d899-b47e-4308-9721-98a6cebe3856@googlegroups.com>

OK grabbed the lvc plugin as suggested but the sample Python code doesn't 
seem to map to the PHP AMQP library ... 

Thanks again :-)
Larry

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140608/b5e16b33/attachment.html>

From mklishin at gopivotal.com  Mon Jun  9 05:04:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 9 Jun 2014 08:04:20 +0400
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <52c7d899-b47e-4308-9721-98a6cebe3856@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
 <52c7d899-b47e-4308-9721-98a6cebe3856@googlegroups.com>
Message-ID: <etPan.5395325d.6b8b4567.17b1@mercurio.local>

On 9 June 2014 at 08:00:06, Larry Lewis (larry.gooroo at gmail.com) wrote:
> > OK grabbed the lvc plugin as suggested but the sample Python  
> code doesn't seem to map to the PHP AMQP library

What do you find not mapping?

The only "novel" thing in that example [1]
is the custom exchange type. exchange_declare signature is pretty much identical
in php-amqplib (except for keyword args), replace "fanout" with "x-lvc":

https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_publisher_fanout.php#L20

and you're good to go.

1.?https://github.com/simonmacmullen/rabbitmq-lvc-plugin#use?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From larry.gooroo at gmail.com  Mon Jun  9 05:55:41 2014
From: larry.gooroo at gmail.com (Larry Lewis)
Date: Sun, 8 Jun 2014 21:55:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
Message-ID: <517ee98c-77eb-42db-ae98-00378c71cc10@googlegroups.com>

Send seems to work...

> <?php
> $txt = 'Hello World ';
> if( isset( $argv[1] ) )
> {
>     $txt = $argv[1];
> }
> require_once __DIR__ . '/vendor/autoload.php';
> use PhpAmqpLib\Connection\AMQPConnection;
> use PhpAmqpLib\Message\AMQPMessage;
>
> $connection = new AMQPConnection('api.dev.com', 5672, 'larry', '....');
> $channel = $connection->channel();
>
> $exchange = 'Site.Offline';
> $channel->exchange_declare( $exchange, 'x-lvc', false, true, false);
>
> $msg = new AMQPMessage( $txt );
> $channel->basic_publish( $msg, $exchange );
> echo " [x] Sent '{$txt}'\n";
>
> $channel->close();
> $connection->close();
>

But receive does not...

> <?php
>
> require_once __DIR__ . '/vendor/autoload.php';
> use PhpAmqpLib\Connection\AMQPConnection;
>
> $connection = new AMQPConnection('api.dev.com', 5672, 'larry', '.....');
> $channel = $connection->channel();
>
>
> $exchange = 'Site.Offline';
> $channel->exchange_declare( $exchange, 'x-lvc', false, true, false);
> $msg = $channel->basic_get( $exchange );
> echo " [x] Received ", $msg->body, "\n";
>
> $channel->close();
> $connection->close();
>

 Error Message basically ->  no queue 'Site.Offline'

Larry

PS: Your replies don't seem to be propagating to the google group ;-)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140608/019af231/attachment.html>

From mklishin at gopivotal.com  Mon Jun  9 06:03:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 9 Jun 2014 09:03:30 +0400
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <517ee98c-77eb-42db-ae98-00378c71cc10@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
 <517ee98c-77eb-42db-ae98-00378c71cc10@googlegroups.com>
Message-ID: <etPan.5395403c.643c9869.17b1@mercurio.local>

On 9 June 2014 at 08:57:56, Larry Lewis (larry.gooroo at gmail.com) wrote:
> > > $exchange = 'Site.Offline';
> > $channel->exchange_declare( $exchange, 'x-lvc', false,  
> true, false);
> > $msg = $channel->basic_get( $exchange );
> > echo " [x] Received ", $msg->body, "\n";
> >
> > $channel->close();
> > $connection->close();
>  
> Error Message basically -> no queue 'Site.Offline'

Your code does not declare a queue named 'Site.Offline'. ?This has nothing
to do with exchange type.

I recommend taking a look at the tutorials:
http://www.rabbitmq.com/getstarted.html

and protocol overview:

http://www.rabbitmq.com/tutorials/amqp-concepts.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun  9 06:04:55 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 9 Jun 2014 09:04:55 +0400
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <517ee98c-77eb-42db-ae98-00378c71cc10@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
 <517ee98c-77eb-42db-ae98-00378c71cc10@googlegroups.com>
 <517ee98c-77eb-42db-ae98-00378c71cc10@googlegroups.com>
Message-ID: <etPan.53954091.74b0dc51.17b1@mercurio.local>

On 9 June 2014 at 08:57:56, Larry Lewis (larry.gooroo at gmail.com) wrote:
> > PS: Your replies don't seem to be propagating to the google group  
> ;-)

Google group is just ?a mirror of [1].?

1.?https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From larry.gooroo at gmail.com  Mon Jun  9 07:41:06 2014
From: larry.gooroo at gmail.com (Larry Lewis)
Date: Sun, 8 Jun 2014 23:41:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
Message-ID: <070174eb-5cac-40a0-9926-6be5c769dbf7@googlegroups.com>

I am trying to use the examples to build the stuff.... but with the lvm 
plugin I know have (consumer)

<?php
>
> require_once __DIR__ . '/vendor/autoload.php';
> use PhpAmqpLib\Connection\AMQPConnection;
>
> $connection = new AMQPConnection('api.dev.com', 5672, 'larry', '....');
> $channel = $connection->channel();
> $exchange = 'SiteOffline';
> $channel->exchange_declare( $exchange, 'x-lvc', false, true, false);
> list($queue_name, ,) = $channel->queue_declare( "", false, false, true, 
> false ); 
> echo " [*] Waiting for messages on queue '{$queue_name}'. To exit press 
> CTRL+C", "\n";
> $channel->queue_bind( $queue_name, $exchange );
> $callback = function($msg) 
> {
>   echo " [x] Received ", $msg->body, "\n";
> };
>
> $channel->basic_consume( $queue_name, '', false, true, false, false, 
> $callback);
> while(count($channel->callbacks)) 
> {
>     $channel->wait();
> }
> $channel->close();
> $connection->close();
>
>
>
 It fails on "$channel->queue_bind( $queue_name, $exchange );" with a 
'INTERNAL_ERROR' the log says.....

=WARNING REPORT==== 9-Jun-2014::16:32:39 ===
> Non-AMQP exit reason '{undef,
>                        [{rabbit_basic,delivery,
>                          [false,
>                           {basic_message,
>                            {resource,<<"/">>,exchange,<<"SiteOffline">>},
>                            [<<>>],
>                            {content,60,
>                             {'P_basic',undefined,undefined,undefined,
>                              undefined,undefined,undefined,undefined,
>                              undefined,undefined,undefined,undefined,
>                              undefined,undefined,undefined},
>                             none,none,
>                             [<<"On">>]},
>                            
> <<61,89,209,245,71,119,135,115,235,39,104,132,185,
>                              144,44,94>>,
>                            false},
>                           undefined],
>                          []},
>                         {rabbit_exchange_type_lvc,add_binding,3,[]},
>                         {rabbit_binding,x_callback,4,
>                          [{file,"src/rabbit_binding.erl"},{line,544}]},
>                         {rabbit_binding,'-add/3-fun-0-',3,
>                          [{file,"src/rabbit_binding.erl"},{line,191}]},
>                         {rabbit_channel,binding_action,9,
>                          [{file,"src/rabbit_channel.erl"},{line,1303}]},
>                         {rabbit_channel,handle_cast,2,
>                          [{file,"src/rabbit_channel.erl"},{line,275}]},
>                         {gen_server2,handle_msg,2,
>                          [{file,"src/gen_server2.erl"},{line,1022}]},
>                         {proc_lib,init_p_do_apply,3,
>                          [{file,"proc_lib.erl"},{line,239}]}]}'
>

exit reason undef  I am assuming that lvm requires something different, 
hence my initial request for a php consumer example.

Larry

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140608/2965f6f5/attachment.html>

From mklishin at gopivotal.com  Mon Jun  9 08:46:23 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 9 Jun 2014 11:46:23 +0400
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <070174eb-5cac-40a0-9926-6be5c769dbf7@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
 <070174eb-5cac-40a0-9926-6be5c769dbf7@googlegroups.com>
Message-ID: <etPan.5395666d.6b8b4567.2536@mercurio.local>



On 9 June 2014 at 10:43:22, Larry Lewis (larry.gooroo at gmail.com) wrote:
> > exit reason undef I am assuming that lvm requires something 
> different, hence my initial request for a php consumer example. 

What version of RabbitMQ do you use? The error says a core RabbitMQ function
wasn't found, so I suspect it is a plugin/broker incompatibility issue.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Mon Jun  9 10:11:42 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 09 Jun 2014 10:11:42 +0100
Subject: [rabbitmq-discuss] Moving from 2node to 3node cluster?
In-Reply-To: <53926C8B.4030402@gmail.com>
References: <53926C8B.4030402@gmail.com>
Message-ID: <53957A4E.7050007@rabbitmq.com>

On 07/06/2014 2:36AM, Jakov Sosic wrote:
> I have a 2node rabbitmq cluster with about 10 HA queues.
>
> I plan to expand it to 3 node cluster..
>
> My plan so far is to:
>
> - shut down secondary
> - shut down primary
> - change config on primary
> - start primary
> - change config on secondary
> - start secondary
> - sync secondary to primary
> - start third server
>
> Is there maybe a faster solution, or is this as best as I can do :)

You don't need to do that.

I assume by "config" you're referring to 
http://www.rabbitmq.com/clustering.html#auto-config.

But the docs there say:

> Note that the cluster configuration is applied only to fresh nodes. A
> fresh nodes is a node which has just been reset or is being start for
> the first time. Thus, the automatic clustering won't take place after
> restarts of nodes. This means that any change to the clustering via
> rabbitmqctl will take precedence over the automatic clustering
> configuration.

So neither of the existing nodes need to be reconfigured. You just need 
to tell the third node to join the cluster, either with the config file 
(on the third node!) as mentioned above, or with 'rabbitmqctl 
join_cluster'. No downtime needed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From RabbitMQ at jenolan.org  Mon Jun  9 10:20:39 2014
From: RabbitMQ at jenolan.org (Larry Lewis)
Date: Mon, 09 Jun 2014 19:20:39 +1000
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <etPan.5395666d.6b8b4567.2536@mercurio.local>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
 <070174eb-5cac-40a0-9926-6be5c769dbf7@googlegroups.com>
 <etPan.5395666d.6b8b4567.2536@mercurio.local>
Message-ID: <53957C67.5030103@jenolan.org>


On 9/06/2014 5:46 pm, Michael Klishin wrote:
>
> On 9 June 2014 at 10:43:22, Larry Lewis (larry.gooroo at gmail.com) wrote:
>>> exit reason undef I am assuming that lvm requires something
>> different, hence my initial request for a php consumer example.
> What version of RabbitMQ do you use? The error says a core RabbitMQ function
> wasn't found, so I suspect it is a plugin/broker incompatibility issue.
RabbitMQ 3.3.1 latest from homebrew, and the plugin from the download 
directory. Plugin is enabled too

-- 
<? Larry >
Coding since 1973


From jsosic at gmail.com  Mon Jun  9 10:37:35 2014
From: jsosic at gmail.com (Jakov Sosic)
Date: Mon, 09 Jun 2014 11:37:35 +0200
Subject: [rabbitmq-discuss] Moving from 2node to 3node cluster?
In-Reply-To: <53957A4E.7050007@rabbitmq.com>
References: <53926C8B.4030402@gmail.com> <53957A4E.7050007@rabbitmq.com>
Message-ID: <5395805F.6080008@gmail.com>

On 06/09/2014 11:11 AM, Simon MacMullen wrote:
 > You don't need to do that.
>
> I assume by "config" you're referring to
> http://www.rabbitmq.com/clustering.html#auto-config.
>
> But the docs there say:
>
>> Note that the cluster configuration is applied only to fresh nodes. A
>> fresh nodes is a node which has just been reset or is being start for
>> the first time. Thus, the automatic clustering won't take place after
>> restarts of nodes. This means that any change to the clustering via
>> rabbitmqctl will take precedence over the automatic clustering
>> configuration.
>
> So neither of the existing nodes need to be reconfigured. You just need
> to tell the third node to join the cluster, either with the config file
> (on the third node!) as mentioned above, or with 'rabbitmqctl
> join_cluster'. No downtime needed.

Thank you I will try it, and report back!


From simon at rabbitmq.com  Mon Jun  9 10:39:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 09 Jun 2014 10:39:24 +0100
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <070174eb-5cac-40a0-9926-6be5c769dbf7@googlegroups.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
 <070174eb-5cac-40a0-9926-6be5c769dbf7@googlegroups.com>
Message-ID: <539580CC.1010201@rabbitmq.com>

On 09/06/2014 7:41AM, Larry Lewis wrote:
> Non-AMQP exit reason '{undef,
>                         [{rabbit_basic,delivery,
>                           [false,
>                            {basic_message,

Damn, the LVC plugin was never updated for 3.3.x. I've done that now, 
and deployed a new binary build at 
http://www.rabbitmq.com/community-plugins/v3.3.x/rabbitmq_lvc-3.3.x-cb8dba12.ez

Sorry about that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From RabbitMQ at jenolan.org  Mon Jun  9 11:34:56 2014
From: RabbitMQ at jenolan.org (Larry Lewis)
Date: Mon, 09 Jun 2014 20:34:56 +1000
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <539580CC.1010201@rabbitmq.com>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
 <070174eb-5cac-40a0-9926-6be5c769dbf7@googlegroups.com>
 <539580CC.1010201@rabbitmq.com>
Message-ID: <53958DD0.8050107@jenolan.org>


On 9/06/2014 7:39 pm, Simon MacMullen wrote:
> Damn, the LVC plugin was never updated for 3.3.x. I've done that now, 
> and deployed a new binary build at 
> http://www.rabbitmq.com/community-plugins/v3.3.x/rabbitmq_lvc-3.3.x-cb8dba12.ez

Upgraded/restarted ... code rejigged (again) seems to be working now 
<<<Phew>>>

-- 
<? Larry >
Coding since 1973


From simon at rabbitmq.com  Mon Jun  9 11:42:48 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 09 Jun 2014 11:42:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.2 released
Message-ID: <53958FA8.8070704@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.3.2

This release fixes a number of bugs in 3.3.1 and earlier versions. See 
the release notes at:

http://www.rabbitmq.com/release-notes/README-3.3.2.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                       The RabbitMQ Team
                       (http://www.rabbitmq.com)

From dmitry.andrianov at alertme.com  Mon Jun  9 16:21:26 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Mon, 09 Jun 2014 16:21:26 +0100
Subject: [rabbitmq-discuss] SSL_TIMEOUT
In-Reply-To: <523981CA.1090004@rabbitmq.com>
References: <52397AB0.2070906@alertme.com> <52397D3A.8040408@rabbitmq.com>
 <523980DF.3010203@alertme.com> <523981CA.1090004@rabbitmq.com>
Message-ID: <5395D0F6.8020403@alertme.com>

Hi.
I am reviving a very old thread here....
As your bugtracker is not public - is it somehow possible to submit a 
bug/issue/enhancement there?

I reeeally do not want to run a custom build of RabbitMQ server but 
there seem to be no other way to change SSL_TIMEOUT.
The problem is - we cannot control network environment where client apps 
are started and if in that environment DNS lookup takes more then 5 
seconds - the connection just fails and there is nothing can be done 
about it.

Any of the following would help:
* configurable SSL_TIMEOUT on the server side
* somehow modify SSL layer in Java client so it does not try to reverse 
lookup IP address into a name. I had a very quick look and I doubt that 
is easy because it is not RabbitMQ client but the Java standard library 
itself.

Thanks


On 18/09/13 11:34, Matthias Radestock wrote:
> On 18/09/13 11:30, Dmitry Andrianov wrote:
>> we cannot make 200Mhz CPU run any faster.
> Understood. Though 5 seconds is still a long time even on a 200MHz CPU.
> Think how many instructions get executed in that time :)
>
> Matthias.

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mklishin at gopivotal.com  Mon Jun  9 16:52:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 9 Jun 2014 19:52:57 +0400
Subject: [rabbitmq-discuss] SSL_TIMEOUT
In-Reply-To: <5395D0F6.8020403@alertme.com>
References: <52397AB0.2070906@alertme.com> <52397D3A.8040408@rabbitmq.com>
 <523980DF.3010203@alertme.com> <523981CA.1090004@rabbitmq.com>
 <5395D0F6.8020403@alertme.com>
Message-ID: <etPan.5395d876.6b8b4567.b99@mercurio.local>

On 9 June 2014 at 19:22:42, Dmitry Andrianov (dmitry.andrianov at alertme.com) wrote:
> > As your bugtracker is not public - is it somehow possible to submit 
> a
> bug/issue/enhancement there?

Just post it to rabbitmq-discuss , in a new thread.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From dmitry.andrianov at alertme.com  Mon Jun  9 17:15:29 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Mon, 09 Jun 2014 17:15:29 +0100
Subject: [rabbitmq-discuss] More about SSL_TIMEOUT
Message-ID: <5395DDA1.6020004@alertme.com>

[Michael Klishin suggested me to post the issue in a new thread in order 
for it to be reviewed properly for possible inclusion in your issue tracker]

So to remind. the issue is Rabbit MQ Java client failing to connect to 
the server (with "connection reset").
The problem is there because Rabbit MQ server kills inbound connection 
should SSL handshake not finish in 5 seconds.
I first experienced the issue in the network where something was not 
quite right with DNS server - I found that when establishing SSL 
connection the Java client did a reverse lookup of IP address. (That 
means the "forward" DNS lookup was already done and IP address resolved 
from the server name, TCP connection was already established to that IP 
and only then Java SSL code started reverse lookup).
When that reverse DNS lookup takes more than 5 sec, Rabbit MQ server 
kills the connection. And even though we retry 30 seconds later - it is 
not going to improve so process repeats.

Since that first time, I saw this problem multiple times on other 
networks. The solution each time was to manually hack /etc/hosts file to 
put there the IP address with arbitrary name. This makes that IP to name 
translation quick and connection succeeds. This is obviously a 
workaround, not a solution.

IIRC, that reverse lookup was done by standard Java SSL support, not 
Rabbit MQ client library so it is not a Rabbit MQ bug technically. I do 
not know why Java SSL code does that lookup but it did not seem easy how 
to avoid it.

So for me the solution would be to increase the timeout to 10 sec 
minimum or, probably better, make it configurable.

Many thanks


This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mklishin at gopivotal.com  Mon Jun  9 17:18:18 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 9 Jun 2014 20:18:18 +0400
Subject: [rabbitmq-discuss] More about SSL_TIMEOUT
In-Reply-To: <5395DDA1.6020004@alertme.com>
References: <5395DDA1.6020004@alertme.com>
Message-ID: <etPan.5395de63.643c9869.b99@mercurio.local>

On 9 June 2014 at 20:16:38, Dmitry Andrianov (dmitry.andrianov at alertme.com) wrote:
> > So for me the solution would be to increase the timeout to 10 sec  
> minimum or, probably better, make it configurable.

We have a bug for making SSL as configurable as Erlang SSL app allows.
This may be covered by it. If not, I'll file another issue.

Bumping the default to 10 second sounds OK with me, too.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From larry at jenolan.org  Mon Jun  9 10:37:29 2014
From: larry at jenolan.org (Larry Lewis)
Date: Mon, 09 Jun 2014 19:37:29 +1000
Subject: [rabbitmq-discuss] Persistant/Semaphore
In-Reply-To: <etPan.5395666d.6b8b4567.2536@mercurio.local>
References: <690b21bf-592c-4c41-9d44-e0aa7ebdce9c@googlegroups.com>
 <070174eb-5cac-40a0-9926-6be5c769dbf7@googlegroups.com>
 <etPan.5395666d.6b8b4567.2536@mercurio.local>
Message-ID: <53958059.8010204@jenolan.org>

On 9/06/2014 5:46 pm, Michael Klishin wrote:
> What version of RabbitMQ do you use? The error says a core RabbitMQ 
> function wasn't found, so I suspect it is a plugin/broker 
> incompatibility issue. 
I have managed to not get an exception by changing some code. However, 
it seems that the first time around that the value is not being 
returned. Will tinker some more and see what cooks up.

-- 
<? Larry >
Coding since 1973


From erlang at rambocoder.com  Mon Jun  9 13:54:21 2014
From: erlang at rambocoder.com (rambocoder)
Date: Mon, 9 Jun 2014 05:54:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Pressured to move to AMQP 1.0
In-Reply-To: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
References: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
Message-ID: <e57ba713-2af1-401d-a9c0-3671a52c54c7@googlegroups.com>

You can make a business case to your management that instead of spending 
hundreds of thousands of dollars on IBM Websphere MQ to get started,and 
then much more indefinitely for IBM support contract, you could hire 1 
Erlang developer who would implement the missing AMQP 1.0 features in 
RabbitMQ https://github.com/rabbitmq/rabbitmq-amqp1.0

That would create tremendous goodwill towards your company and make the 
world a better place :)

Or the company could just pay huge monthly bills by using Microsoft Azure 
Messaging http://azure.microsoft.com/en-us/pricing/details/service-bus/ 
because Microsoft charges for e-v-e-r-y-thing, even "Billable messages 
include any "no message available" replies".

Cheers,

-rambocoder

On Wednesday, June 4, 2014 6:13:13 PM UTC-4, DallasEng wrote:
>
> Having finally demonstrated to my company that RabbitMQ and AMQP allow us 
> to build kickass distributed solutions, I am now getting strong pressure to 
> move off RabbitMQ to "something more modern that supports AMQP 1.0".  I 
> understand that 0.9.1 and 1.0 are completely different beasts, and that 
> there's a 1.0 protocol plugin for RabbitMQ, but that plugin has limitations 
> and things in 1.0 that it does not support.  The Powers That Be at the 
> company look at IBM and Microsoft having AMQP 1.0 support and saying that's 
> clearly where we need to be if we want to (a) not be left behind, and (b) 
> advertise that we're using "the industry standard".
>
> Since there's no indication that RabbitMQ will ever support a 
> fully-compliant 1.0 mode, do any of you have suggestions for how I can 
> demonstrate that staying on RabbitMQ for new development is a good idea?
>
> Thanks!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140609/0abef3b1/attachment.html>

From mswatson at gmail.com  Mon Jun  9 17:47:55 2014
From: mswatson at gmail.com (Michael Watson)
Date: Mon, 9 Jun 2014 11:47:55 -0500
Subject: [rabbitmq-discuss] Pressured to move to AMQP 1.0
In-Reply-To: <e57ba713-2af1-401d-a9c0-3671a52c54c7@googlegroups.com>
References: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
 <e57ba713-2af1-401d-a9c0-3671a52c54c7@googlegroups.com>
Message-ID: <CAFp2mKB5G8oSLwF7c64uPy5gzOv_Lrju2q=G7fQy3v7d+pDZbg@mail.gmail.com>

Thanks, ramoboder.

I'm working through the issues now.  Have had some success, but decision
makers still somewhat hung up on the damned versioning. It's hard to claim
that we're using an industry standard in AMQP 0.9.1, even though many
consider it the defacto standard.  There's business value in being able to
claim compatibility with the version that Microsoft, IBM, and Apache are
all supporting.

Michael




On Mon, Jun 9, 2014 at 7:54 AM, rambocoder <erlang at rambocoder.com> wrote:

> You can make a business case to your management that instead of spending
> hundreds of thousands of dollars on IBM Websphere MQ to get started,and
> then much more indefinitely for IBM support contract, you could hire 1
> Erlang developer who would implement the missing AMQP 1.0 features in
> RabbitMQ https://github.com/rabbitmq/rabbitmq-amqp1.0
>
> That would create tremendous goodwill towards your company and make the
> world a better place :)
>
> Or the company could just pay huge monthly bills by using Microsoft Azure
> Messaging http://azure.microsoft.com/en-us/pricing/details/service-bus/
> because Microsoft charges for e-v-e-r-y-thing, even "Billable messages
> include any "no message available" replies".
>
> Cheers,
>
> -rambocoder
>
> On Wednesday, June 4, 2014 6:13:13 PM UTC-4, DallasEng wrote:
>>
>> Having finally demonstrated to my company that RabbitMQ and AMQP allow us
>> to build kickass distributed solutions, I am now getting strong pressure to
>> move off RabbitMQ to "something more modern that supports AMQP 1.0".  I
>> understand that 0.9.1 and 1.0 are completely different beasts, and that
>> there's a 1.0 protocol plugin for RabbitMQ, but that plugin has limitations
>> and things in 1.0 that it does not support.  The Powers That Be at the
>> company look at IBM and Microsoft having AMQP 1.0 support and saying that's
>> clearly where we need to be if we want to (a) not be left behind, and (b)
>> advertise that we're using "the industry standard".
>>
>> Since there's no indication that RabbitMQ will ever support a
>> fully-compliant 1.0 mode, do any of you have suggestions for how I can
>> demonstrate that staying on RabbitMQ for new development is a good idea?
>>
>> Thanks!
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140609/668230b5/attachment.html>

From nathan at nkbrown.us  Mon Jun  9 21:40:08 2014
From: nathan at nkbrown.us (Nathan Brown)
Date: Mon, 9 Jun 2014 13:40:08 -0700
Subject: [rabbitmq-discuss] Would like to start merging .NET client for
 WinRT (Windows 8 Store App) with mainline code
Message-ID: <CAFCmQSodWOuXMQjDaU0UCE5DQAOVesos3j8iWUbn1uLD8q4Qkg@mail.gmail.com>

Hello all,

I was involved with the obsoleting of all .NET 1.1 pre-generic collection
code (bug25552).  This was a pre-requisite for supporting the WinRT version
of the .NET framework as the non-generic collections had disappeared.

I have implemented most of the changes necessary for the RabbitMQ .NET
client to run in a Windows 8.x store app.  I have also been using my
changes in production for a year now now.  I just re-based the changes
forward to the most recent stable version and would like to contribute them
to the mainline code.

There are a couple issues that still need to be worked through:

   - Can the CI build be on a Windows 8/Server 2012 machine? Or is the
   build going to have to be ran separately just for this DLL?
   - How is the NuGet package going to be updated?
   - I haven't tested SSL.
   - The unit tests are currently partially ported to MSTest, but this is
   primarily because of reading WinRT configuration data doesn't work on the
   desktop, I think I should drop that entirely
   (Protocols.FromConfiguration(string)).

You can preview the changes here:
https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/branch/WinStore
<https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/branch/WinStore?head=dfab23238460732fd5afb9fd473f91babe55dbb5>

If someone open an issue and give me the bug number, I can move my changes
to a branch with that name.

Please let me know if you have any questions or feedback.

Thanks,
Nathan Brown
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140609/e78a6f78/attachment.html>

From mklishin at gopivotal.com  Mon Jun  9 21:54:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 10 Jun 2014 00:54:25 +0400
Subject: [rabbitmq-discuss] Would like to start merging .NET client for
 WinRT (Windows 8 Store App) with mainline code
In-Reply-To: <CAFCmQSodWOuXMQjDaU0UCE5DQAOVesos3j8iWUbn1uLD8q4Qkg@mail.gmail.com>
References: <CAFCmQSodWOuXMQjDaU0UCE5DQAOVesos3j8iWUbn1uLD8q4Qkg@mail.gmail.com>
Message-ID: <etPan.53961f1c.6b8b4567.9b84@mercurio.local>

On 10 June 2014 at 00:41:18, Nathan Brown (nathan at nkbrown.us) wrote:

Nathan,

First of all, thank you for working on this. It would be great to have
WinRT support in the .NET client!

> > There are a couple issues that still need to be worked through:  
> Can the CI build be on a Windows 8/Server 2012 machine? Or is the  
> build going to have to be ran separately just for this DLL?

Windows CI currently uses Windows XP. We'll see if adding more
Windows versions is easy enough, and in particular Windows 8.

> How is the NuGet package going to be updated?

Good question. If WinRT is an incompatible target, does it mean
there should be 2 packages, X and X-winrt, for example?

> I haven't tested SSL.

This needs to happen.

> The unit tests are currently partially ported to MSTest, but  
> this is primarily because of reading WinRT configuration data  
> doesn't work on the desktop, I think I should drop that entirely  
> (Protocols.FromConfiguration(string)).

Is it technically possible to run the current NUnit test suite
on WinRT? Protocol configuration is removed in default and 3.4 will only
support one protocol (0-9-1). Do we still need to worry about using MSTest
then?

I don't have a bug number to give but we also don't need one.
If your branch is in Mercurial or Git somewhere, we can work on it until it's
mostly done, then create a bug and pull it into the mainline.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From nathan at nkbrown.us  Mon Jun  9 22:47:34 2014
From: nathan at nkbrown.us (Nathan Brown)
Date: Mon, 9 Jun 2014 14:47:34 -0700
Subject: [rabbitmq-discuss] Would like to start merging .NET client for
 WinRT (Windows 8 Store App) with mainline code
In-Reply-To: <etPan.53961f1c.6b8b4567.9b84@mercurio.local>
References: <CAFCmQSodWOuXMQjDaU0UCE5DQAOVesos3j8iWUbn1uLD8q4Qkg@mail.gmail.com>
 <etPan.53961f1c.6b8b4567.9b84@mercurio.local>
Message-ID: <CAFCmQSqScL5fLdXjnh+9D2rQ2AryUdxOJdOBXCchi6rwm_5P-w@mail.gmail.com>

Mike,


>> How is the NuGet package going to be updated?

> Good question. If WinRT is an incompatible target, does it mean
> there should be 2 packages, X and X-winrt, for example?

Different platform DLLs go in a named folders inside of the NuGet package.
 Everything is delivered together and Visual Studio links to the correct
DLL.  If it was possible to build the NuGet package as part of the CI
process, that would be the best.  Currently the NuGet creation lives
elsewhere and is manually populated with the release binaries.

> Is it technically possible to run the current NUnit test suite
> on WinRT? Protocol configuration is removed in default and 3.4 will only
> support one protocol (0-9-1). Do we still need to worry about using MSTest
> then?

NUnit was able to test it without the configuration part.  I can remove
that and remove all the MSTest changes.  The test runner then works as a
desktop process (on Windows 8/Server 2012).

> If your branch is in Mercurial or Git somewhere, we can work on it until
it's
> mostly done, then create a bug and pull it into the mainline.

Anyone can pull it from Bitbucket
<https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client>right now.  I can
continue to work there.

Thanks,
Nathan Brown


On Mon, Jun 9, 2014 at 1:54 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 10 June 2014 at 00:41:18, Nathan Brown (nathan at nkbrown.us) wrote:
>
> Nathan,
>
> First of all, thank you for working on this. It would be great to have
> WinRT support in the .NET client!
>
> > > There are a couple issues that still need to be worked through:
> > Can the CI build be on a Windows 8/Server 2012 machine? Or is the
> > build going to have to be ran separately just for this DLL?
>
> Windows CI currently uses Windows XP. We'll see if adding more
> Windows versions is easy enough, and in particular Windows 8.
>
> > How is the NuGet package going to be updated?
>
> Good question. If WinRT is an incompatible target, does it mean
> there should be 2 packages, X and X-winrt, for example?
>
> > I haven't tested SSL.
>
> This needs to happen.
>
> > The unit tests are currently partially ported to MSTest, but
> > this is primarily because of reading WinRT configuration data
> > doesn't work on the desktop, I think I should drop that entirely
> > (Protocols.FromConfiguration(string)).
>
> Is it technically possible to run the current NUnit test suite
> on WinRT? Protocol configuration is removed in default and 3.4 will only
> support one protocol (0-9-1). Do we still need to worry about using MSTest
> then?
>
> I don't have a bug number to give but we also don't need one.
> If your branch is in Mercurial or Git somewhere, we can work on it until
> it's
> mostly done, then create a bug and pull it into the mainline.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140609/21147939/attachment.html>

From tonygarnockjones+rabbitmq at gmail.com  Mon Jun  9 22:53:38 2014
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 9 Jun 2014 17:53:38 -0400
Subject: [rabbitmq-discuss] Pressured to move to AMQP 1.0
In-Reply-To: <CAFp2mKB5G8oSLwF7c64uPy5gzOv_Lrju2q=G7fQy3v7d+pDZbg@mail.gmail.com>
References: <f18d4344-e73f-4c3b-96b8-7685b287bd7e@googlegroups.com>
 <e57ba713-2af1-401d-a9c0-3671a52c54c7@googlegroups.com>
 <CAFp2mKB5G8oSLwF7c64uPy5gzOv_Lrju2q=G7fQy3v7d+pDZbg@mail.gmail.com>
Message-ID: <CAM8fPiRHUPUtnfPWK5DbUbG+J5Vj7SOJiqXiUeniEWFieWu_Kw@mail.gmail.com>

Based on the state of interop as discussed the other day, I reckon the
RabbitMQ team should declare the 1.0 plugin "production". It doesn't seem
to be in any worse of a state than any other AMQP 1.0 implementation. It's
as compatible as anyone else, by the sounds of it.

If that were done, the boxes would all get ticked and people would be
reassured they could migrate to AMQP 1.0 if and when they felt like it.



On 9 June 2014 12:47, Michael Watson <mswatson at gmail.com> wrote:

> Thanks, ramoboder.
>
> I'm working through the issues now.  Have had some success, but decision
> makers still somewhat hung up on the damned versioning. It's hard to claim
> that we're using an industry standard in AMQP 0.9.1, even though many
> consider it the defacto standard.  There's business value in being able to
> claim compatibility with the version that Microsoft, IBM, and Apache are
> all supporting.
>
> Michael
>
>
>
>
> On Mon, Jun 9, 2014 at 7:54 AM, rambocoder <erlang at rambocoder.com> wrote:
>
>> You can make a business case to your management that instead of spending
>> hundreds of thousands of dollars on IBM Websphere MQ to get started,and
>> then much more indefinitely for IBM support contract, you could hire 1
>> Erlang developer who would implement the missing AMQP 1.0 features in
>> RabbitMQ https://github.com/rabbitmq/rabbitmq-amqp1.0
>>
>> That would create tremendous goodwill towards your company and make the
>> world a better place :)
>>
>> Or the company could just pay huge monthly bills by using Microsoft Azure
>> Messaging http://azure.microsoft.com/en-us/pricing/details/service-bus/
>> because Microsoft charges for e-v-e-r-y-thing, even "Billable messages
>> include any "no message available" replies".
>>
>> Cheers,
>>
>> -rambocoder
>>
>> On Wednesday, June 4, 2014 6:13:13 PM UTC-4, DallasEng wrote:
>>>
>>> Having finally demonstrated to my company that RabbitMQ and AMQP allow
>>> us to build kickass distributed solutions, I am now getting strong pressure
>>> to move off RabbitMQ to "something more modern that supports AMQP 1.0".  I
>>> understand that 0.9.1 and 1.0 are completely different beasts, and that
>>> there's a 1.0 protocol plugin for RabbitMQ, but that plugin has limitations
>>> and things in 1.0 that it does not support.  The Powers That Be at the
>>> company look at IBM and Microsoft having AMQP 1.0 support and saying that's
>>> clearly where we need to be if we want to (a) not be left behind, and (b)
>>> advertise that we're using "the industry standard".
>>>
>>> Since there's no indication that RabbitMQ will ever support a
>>> fully-compliant 1.0 mode, do any of you have suggestions for how I can
>>> demonstrate that staying on RabbitMQ for new development is a good idea?
>>>
>>> Thanks!
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140609/bd50891b/attachment.html>

From mklishin at gopivotal.com  Mon Jun  9 23:18:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 10 Jun 2014 02:18:50 +0400
Subject: [rabbitmq-discuss] Would like to start merging .NET client for
 WinRT (Windows 8 Store App) with mainline code
In-Reply-To: <CAFCmQSqScL5fLdXjnh+9D2rQ2AryUdxOJdOBXCchi6rwm_5P-w@mail.gmail.com>
References: <CAFCmQSodWOuXMQjDaU0UCE5DQAOVesos3j8iWUbn1uLD8q4Qkg@mail.gmail.com>
 <etPan.53961f1c.6b8b4567.9b84@mercurio.local>
 <CAFCmQSqScL5fLdXjnh+9D2rQ2AryUdxOJdOBXCchi6rwm_5P-w@mail.gmail.com>
Message-ID: <etPan.539632e8.643c9869.9b84@mercurio.local>

On 10 June 2014 at 01:48:41, Nathan Brown (nathan at nkbrown.us) wrote:
> > > Good question. If WinRT is an incompatible target, does it 
> mean
> > there should be 2 packages, X and X-winrt, for example?
> 
> Different platform DLLs go in a named folders inside of the NuGet 
> package. Everything is delivered together and Visual Studio 
> links to the correct DLL. If it was possible to build the NuGet 
> package as part of the CI process, that would be the best. Currently 
> the NuGet creation lives elsewhere and is manually populated 
> with the release binaries.

I'll ask our NuGet package maintainer to chime in. I suspect it's time to
open source the code used for NuGet packaging ;)

> > Is it technically possible to run the current NUnit test suite 
> > on WinRT? Protocol configuration is removed in default and 
> 3.4 will only
> > support one protocol (0-9-1). Do we still need to worry about 
> using MSTest
> > then?
> 
> NUnit was able to test it without the configuration part. I can 
> remove that and remove all the MSTest changes. The test runner 
> then works as a desktop process (on Windows 8/Server 2012).

Excellent!

> > If your branch is in Mercurial or Git somewhere, we can work on 
> it until it's
> > mostly done, then create a bug and pull it into the mainline. 
> 
> Anyone can pull it from Bitbucket(https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client) 
> right now. I can continue to work there.

Lets do that. A public Mercurial repo is all we care about when it's time
to merge.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From peter.mueller at viacom.com  Tue Jun 10 02:23:20 2014
From: peter.mueller at viacom.com (Mueller, Peter)
Date: Tue, 10 Jun 2014 01:23:20 +0000
Subject: [rabbitmq-discuss] in_group not functioning with ldap bind?
In-Reply-To: <B40C2431DABA3D4687EF0A32565FBB180147CD63@ABFABCA01A.mtvn.ad.viacom.com>
References: <B40C2431DABA3D4687EF0A32565FBB180147CD63@ABFABCA01A.mtvn.ad.viacom.com>
Message-ID: <B40C2431DABA3D4687EF0A32565FBB180147CD98@ABFABCA01A.mtvn.ad.viacom.com>

I am trying to get a new rabbitmq server to allow an ldap group (cn=rabbitmq_write,ou=Group,dc=company,dc=com) admin rights.  Other users should have read rights.  Currently I am able to login but not to create a test exchange or queue.  Config is attached (1).  Relevant log output (2).  I have tried various settings, such as ldap settings to more exactly match 'in_group' with how our ldap group structure is (3).

I was using rabbitmq-server-3.3.1-1.noarch.rpm, but just upgraded rabbitmq-server-3.3.2-1.noarch.rpm.  No changes to the rpm install other than the (1) conf file.  Centos-6.5, epel, all updates, selinux & iptables disabled.

Many thanks for your assistance.

(1)  conf file
[
  {rabbit,
   [
    {auth_backends,[rabbit_auth_backend_ldap, rabbit_auth_backend_internal]},{ssl_listeners, [5671]}
   ]
  },
  {rabbitmq_auth_backend_ldap,
   [ {servers,               ["ldap.server.company.com"]},
     {dn_lookup_bind,        {"cn=binduser,ou=LDAPusers,dc=company,dc=com", "bindpassword"}},
     {dn_lookup_base,        "dc=company,dc=com"},
     {dn_lookup_attribute,   "uid"},
     {use_ssl,               true},
     {ssl_options,           [{cacertfile, "/etc/rabbitmq/companyca.crt"},{verify,verify_peer},{fail_if_no_peer_cert,false} ]},
     {port,                  636},
     {log,                   network},
     {vhost_access_query,    {constant, true}},
     {resource_access_query,
      {for, [{permission, configure, {in_group,"cn=rabbitmq_write,ou=Group,dc=company,dc=com"}},
             {permission, read, {for, [{resource, exchange, {constant, true}},
                                       {resource, queue,    {constant, true}}
                                      ]}
             }
            ]
      }},
     {tag_queries,[
                   {administrator, {in_group, "cn=admins,ou=Group,dc=company,dc=com"}},
                   {management,    {constant, true}}
                  ]}
   ]
  }
].

(2) Log from rabbitmq
=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP bind succeeded: uid=muellerpe,ou=People,dc=company,dc=com

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP evaluating query: {for,
                            [{permission,configure,
                              {in_group,
                               "cn=rabbitmq_write,ou=Group,dc=company,dc=com"}},
                             {permission,read,
                              {for,
                               [{resource,exchange,{constant,true}},
                                {resource,queue,{constant,true}}]}}]}

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP selecting subquery permission = configure

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP evaluating query: {in_group,"cn=rabbitmq_write,ou=Group,dc=company,dc=com"}

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP evaluating query: {in_group,"cn=rabbitmq_write,ou=Group,dc=company,dc=com",
                                     "member"}

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
        LDAP filling template "cn=rabbitmq_write,ou=Group,dc=company,dc=com" with
            [{username,<<"muellerpe">>},
             {user_dn,"uid=muellerpe,ou=People,dc=company,dc=com"},
             {vhost,<<"/">>},
             {resource,exchange},
             {name,<<"test">>},
             {permission,configure}]

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
        LDAP template result: "cn=rabbitmq_write,ou=Group,dc=company,dc=com"

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP network traffic: search request = {'SearchRequest',
                                            "cn=rabbitmq_write,ou=Group,dc=company,dc=com",
                                            baseObject,derefAlways,0,0,false,
                                            {equalityMatch,
                                             {'AttributeValueAssertion',
                                              "member",
                                              "uid=muellerpe,ou=People,dc=company,dc=com"}},
                                            ["objectClass"]}

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP network traffic: search reply = {ok,
                                          {'LDAPMessage',2,
                                           {searchResDone,
                                            {'LDAPResult',success,[],[],
                                             asn1_NOVALUE}},
                                           asn1_NOVALUE}}

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP network traffic: search reply = searchResDone

=INFO REPORT==== 9-Jun-2014::20:43:35 ===
    LDAP evaluated in_group for "cn=rabbitmq_write,ou=Group,dc=company,dc=com": false

(3) ldap DN dump of group I want to make admin
dn: cn=rabbitmq_write,ou=Group,dc=company,dc=com
cn: rabbitmq_write
ou: Group
objectClass: hybridgroup
objectClass: top
gidNumber: 12345
seeAlso:
uniqueMember: uid=crawforb,ou=People,dc=company,dc=com
uniqueMember: uid=dasilvai,ou=People,dc=company,dc=com
uniqueMember: uid=muellerpe,ou=People,dc=company,dc=com
memberUid: crawforb
memberUid: dasilvai
memberUid: muellerpe

From ranjithavshet09 at gmail.com  Tue Jun 10 06:39:31 2014
From: ranjithavshet09 at gmail.com (Ranjitha Shet)
Date: Tue, 10 Jun 2014 11:09:31 +0530
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <etPan.53906b45.6b8b4567.166c0@mercurio.local>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
 <etPan.53906b45.6b8b4567.166c0@mercurio.local>
Message-ID: <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>

Hi,

>>>>>> There is a bug fix in the upcoming 3.3.2 release that makes sure any
> exception
> > (including the one above) results in a reconnection attempt after a
> grace period.
> > Previously only some network I/O exceptions triggered reconnection.


I get the same error while using rabbitmq-client.jar with the latest
version 3.3.2.
The server side the RabbitMQ version used is old one ie, 2.8.1

Is it because of the older version used in server side?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140610/37cd13f3/attachment.html>

From matthias at rabbitmq.com  Tue Jun 10 07:06:26 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 10 Jun 2014 07:06:26 +0100
Subject: [rabbitmq-discuss] pika.exceptions.ConnectionClosed
In-Reply-To: <993b658f-18a4-415e-a792-26a10e802e63@googlegroups.com>
References: <993b658f-18a4-415e-a792-26a10e802e63@googlegroups.com>
Message-ID: <5396A062.1050101@rabbitmq.com>

On 01/06/14 00:40, Mazzaroth M. wrote:
> Hi, very new to pika and rabbitmq. The moment I add some sort of work to
> the basic consumption callback, I get a
> pika.exceptions.ConnectionClosed. Any ideas?Code and log at
> http://pastebin.com/M90Q6me1

Check the server logs for errors.

Matthias

From matthias at rabbitmq.com  Tue Jun 10 07:09:01 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 10 Jun 2014 07:09:01 +0100
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
 <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
Message-ID: <5396A0FD.4080402@rabbitmq.com>

On 05/06/14 09:02, Narayan Reddy wrote:
>              Any other information needed ? Any thing should i change
> and check ? Please help me to resolve this issue .

Try the latest 3.3.2 release, which improves SSL error reporting at the 
server end.

Matthias.

From matthias at rabbitmq.com  Tue Jun 10 07:17:44 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 10 Jun 2014 07:17:44 +0100
Subject: [rabbitmq-discuss] Permissions and exchanges
In-Reply-To: <1401980536396-36082.post@n5.nabble.com>
References: <1401980536396-36082.post@n5.nabble.com>
Message-ID: <5396A308.4020007@rabbitmq.com>

On 05/06/14 16:02, lepolac wrote:
> Is there a possibility to put ?none? as configure regexp ?

^$

> Also is there a way to allow queue declaration and bindings, but
> restrict exchange creation ?

no.

Matthias.

From bvnr.mail at gmail.com  Tue Jun 10 08:28:26 2014
From: bvnr.mail at gmail.com (Narayan Reddy)
Date: Tue, 10 Jun 2014 12:58:26 +0530
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <5396A0FD.4080402@rabbitmq.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
 <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
 <5396A0FD.4080402@rabbitmq.com>
Message-ID: <CAKV0HmPREmG2eBbtVmKERwMfHo6yWFAtVBrObgMga9yt=qD=SA@mail.gmail.com>

Thanks Matthias , will check with RMQ 3.3.2 and get back to you.

@Michael checked with erlang R17 version & no peer verification both cases
it showed previous error itself (ssl_upgrade_error , cacertfile....)


On 10 June 2014 11:39, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 05/06/14 09:02, Narayan Reddy wrote:
>
>>              Any other information needed ? Any thing should i change
>> and check ? Please help me to resolve this issue .
>>
>
> Try the latest 3.3.2 release, which improves SSL error reporting at the
> server end.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140610/c5d52779/attachment.html>

From mklishin at gopivotal.com  Tue Jun 10 08:44:06 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 10 Jun 2014 11:44:06 +0400
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
 <etPan.53906b45.6b8b4567.166c0@mercurio.local>
 <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>
Message-ID: <etPan.5396b764.74b0dc51.9b84@mercurio.local>



On 10 June 2014 at 09:41:44, Ranjitha Shet (ranjithavshet09 at gmail.com) wrote:
> > Is it because of the older version used in server side?

Recovery is a client library feature.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From ranjithavshet09 at gmail.com  Tue Jun 10 09:04:19 2014
From: ranjithavshet09 at gmail.com (Ranjitha Shet)
Date: Tue, 10 Jun 2014 13:34:19 +0530
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <etPan.5396b764.74b0dc51.9b84@mercurio.local>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
 <etPan.53906b45.6b8b4567.166c0@mercurio.local>
 <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>
 <etPan.5396b764.74b0dc51.9b84@mercurio.local>
Message-ID: <CAP2+pdysviMg8q7HqY3_Fwwr3ZOhARO-7A4+AiMfJ9Q5iX=S+Q@mail.gmail.com>

Hi,

>> Recovery is a client library feature.

Is it fixed in the version 3.3.2.  ?





On Tue, Jun 10, 2014 at 1:14 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>
>
> On 10 June 2014 at 09:41:44, Ranjitha Shet (ranjithavshet09 at gmail.com)
> wrote:
> > > Is it because of the older version used in server side?
>
> Recovery is a client library feature.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140610/09f12e89/attachment.html>

From mklishin at gopivotal.com  Tue Jun 10 09:06:43 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 10 Jun 2014 12:06:43 +0400
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <CAP2+pdysviMg8q7HqY3_Fwwr3ZOhARO-7A4+AiMfJ9Q5iX=S+Q@mail.gmail.com>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
 <etPan.53906b45.6b8b4567.166c0@mercurio.local>
 <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>
 <etPan.5396b764.74b0dc51.9b84@mercurio.local>
 <CAP2+pdysviMg8q7HqY3_Fwwr3ZOhARO-7A4+AiMfJ9Q5iX=S+Q@mail.gmail.com>
Message-ID: <etPan.5396bcb1.2ae8944a.9b84@mercurio.local>

On 10 June 2014 at 12:04:20, Ranjitha Shet (ranjithavshet09 at gmail.com) wrote:
> > Is it fixed in the version 3.3.2. ?

In 3.3.2, this exception should not prevent further reconnection attempts.

You will still see it logged by default ExceptionHandler, because it is
still being raised until network connectivity is restored.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From bvnr.mail at gmail.com  Tue Jun 10 09:41:34 2014
From: bvnr.mail at gmail.com (Narayan Reddy)
Date: Tue, 10 Jun 2014 14:11:34 +0530
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <CAKV0HmPREmG2eBbtVmKERwMfHo6yWFAtVBrObgMga9yt=qD=SA@mail.gmail.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
 <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
 <5396A0FD.4080402@rabbitmq.com>
 <CAKV0HmPREmG2eBbtVmKERwMfHo6yWFAtVBrObgMga9yt=qD=SA@mail.gmail.com>
Message-ID: <CAKV0HmMph4BD4fwGc-Ld=jmot5jNKvbxLqM7LYzSnSKKhVTkxA@mail.gmail.com>

I checked with RMQ 3.3.2 , This is the error displayed in broker.log file.


*=INFO REPORT==== 10-Jun-2014::14:02:14 ===*
*accepting AMQP connection <0.323.0> (127.0.0.1:38626
<http://127.0.0.1:38626> -> 127.0.0.1:5671 <http://127.0.0.1:5671>)*

*=ERROR REPORT==== 10-Jun-2014::14:02:19 ===*
*error on AMQP connection <0.323.0>:*
*{ssl_upgrade_error,*
*
{options,{cacertfile,"/home/prime/SSL/testca/cacert.pem",{error,eacces}}}}*

In which cases it can throw the error eaccess ?,  Please help me to resolve
this issue.

Thanks






On 10 June 2014 12:58, Narayan Reddy <bvnr.mail at gmail.com> wrote:

> Thanks Matthias , will check with RMQ 3.3.2 and get back to you.
>
> @Michael checked with erlang R17 version & no peer verification both cases
> it showed previous error itself (ssl_upgrade_error , cacertfile....)
>
>
> On 10 June 2014 11:39, Matthias Radestock <matthias at rabbitmq.com> wrote:
>
>> On 05/06/14 09:02, Narayan Reddy wrote:
>>
>>>              Any other information needed ? Any thing should i change
>>> and check ? Please help me to resolve this issue .
>>>
>>
>> Try the latest 3.3.2 release, which improves SSL error reporting at the
>> server end.
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140610/f620dc4d/attachment.html>

From mklishin at gopivotal.com  Tue Jun 10 09:43:40 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 10 Jun 2014 12:43:40 +0400
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <CAKV0HmMph4BD4fwGc-Ld=jmot5jNKvbxLqM7LYzSnSKKhVTkxA@mail.gmail.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
 <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
 <5396A0FD.4080402@rabbitmq.com>
 <CAKV0HmPREmG2eBbtVmKERwMfHo6yWFAtVBrObgMga9yt=qD=SA@mail.gmail.com>
 <CAKV0HmMph4BD4fwGc-Ld=jmot5jNKvbxLqM7LYzSnSKKhVTkxA@mail.gmail.com>
Message-ID: <etPan.5396c55a.625558ec.9b84@mercurio.local>

?On 10 June 2014 at 12:42:15, Narayan Reddy (bvnr.mail at gmail.com) wrote:
> > {ssl_upgrade_error,
> {options,{cacertfile,"/home/prime/SSL/testca/cacert.pem",{error,eacces}}}}  
>  
>  
> In which cases it can throw the error eaccess ?, Please help me  
> to resolve this issue.

File permission error of a kind. Make sure the file can be read by
the active RabbitMQ process user.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue Jun 10 11:21:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Jun 2014 11:21:57 +0100
Subject: [rabbitmq-discuss] in_group not functioning with ldap bind?
In-Reply-To: <B40C2431DABA3D4687EF0A32565FBB180147CD98@ABFABCA01A.mtvn.ad.viacom.com>
References: <B40C2431DABA3D4687EF0A32565FBB180147CD63@ABFABCA01A.mtvn.ad.viacom.com>
 <B40C2431DABA3D4687EF0A32565FBB180147CD98@ABFABCA01A.mtvn.ad.viacom.com>
Message-ID: <5396DC45.7030607@rabbitmq.com>

Hi!

On 10/06/14 02:23, Mueller, Peter wrote:
> {in_group,"cn=rabbitmq_write,ou=Group,dc=company,dc=com"}

> uniqueMember: uid=crawforb,ou=People,dc=company,dc=com
> uniqueMember: uid=dasilvai,ou=People,dc=company,dc=com
> uniqueMember: uid=muellerpe,ou=People,dc=company,dc=com

There's your problem. LDAP servers determine group membership by the 
presence of a variety of differently-named attributes. The 2-tuple 
version of in_group looks for an attribute called "member", but yours 
are "uniqueMember".

So you want to change the above to:

{in_group,"cn=rabbitmq_write,ou=Group,dc=company,dc=com", "uniqueMember"}

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From wysiwyg.om at googlemail.com  Tue Jun 10 11:34:15 2014
From: wysiwyg.om at googlemail.com (wysiwyg.om at googlemail.com)
Date: Tue, 10 Jun 2014 03:34:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Trouble with SSL on my newly installed
	RabbitMQ instance
In-Reply-To: <ee905b6c-de6b-4586-ad89-513349763251@googlegroups.com>
References: <ee905b6c-de6b-4586-ad89-513349763251@googlegroups.com>
Message-ID: <6d8b1c66-1d0f-4c81-a63a-243cc47c0449@googlegroups.com>

hi,

I had the same issue until I changed the permissions of the generated ssl 
files.
Rabbitmq starts without any warning message even if the files are not 
readable. 
Make sure that the user who is running rabbitmq is able to read the needed 
ssl files (ca,crt,key).
 
oliver

 
Am Samstag, 5. April 2014 18:01:14 UTC+2 schrieb Joe Abrams:
>
> Hello,
>
> I'm trying to get SSL working on my Rabbit server, following the 
> instructions at https://www.rabbitmq.com/ssl.html verbatim, but am 
> getting this error when making connections:
>
> =INFO REPORT==== 5-Apr-2014::15:28:48 ===
> accepting AMQP connection <0.678.0> (.....)
>
> =ERROR REPORT==== 5-Apr-2014::15:28:53 ===
> error on AMQP connection <0.678.0>: 
> {ssl_upgrade_error,{options,{cacertfile,[47,11...
>
> I'm following the SSL troubleshooting guide and get the above error when 
> trying to 'Attempt SSL connection to Broker' from the same machine.
>
> It looks like my config *is* being read as I see this in my logs:
>
> =INFO REPORT==== 5-Apr-2014::14:38:13 ===
> started SSL Listener on [::]:5671
>
> +++ My system details +++
> Ubuntu 13.10 (I'm on ec2)
> SSL version: [{ssl_app,"5.3"},
>  {supported,['tlsv1.2','tlsv1.1',tlsv1,sslv3]},
>  {available,['tlsv1.2','tlsv1.1',tlsv1,sslv3]}]
> RabbitMQ 3.3.0, Erlang R16B01
>
> I've banged my head on this for a day now and am not making progress.  Any 
> help would be greatly appreciate.  Thanks -Joe
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140610/d9c8e583/attachment.html>

From peter.mueller at viacom.com  Tue Jun 10 15:34:45 2014
From: peter.mueller at viacom.com (Mueller, Peter)
Date: Tue, 10 Jun 2014 14:34:45 +0000
Subject: [rabbitmq-discuss] in_group not functioning with ldap bind?
In-Reply-To: <5396DC45.7030607@rabbitmq.com>
References: <B40C2431DABA3D4687EF0A32565FBB180147CD63@ABFABCA01A.mtvn.ad.viacom.com>
 <B40C2431DABA3D4687EF0A32565FBB180147CD98@ABFABCA01A.mtvn.ad.viacom.com>
 <5396DC45.7030607@rabbitmq.com>
Message-ID: <B40C2431DABA3D4687EF0A32565FBB180147D319@ABFABCA01A.mtvn.ad.viacom.com>

> {in_group,"cn=rabbitmq_write,ou=Group,dc=company,dc=com",
> "uniqueMember"}

Thanks!  I had tried this per the suggested docs
{in_group,"cn=rabbitmq_write,ou=Group,dc=company,dc=com",uniqueMember}

Above did not work.  However, with the quotes around it worked.  Might want to update the documentation to suggest the quotation, perhaps in an example.

http://www.rabbitmq.com/ldap.html .
{in_group, Pattern, AttributeName}
{in_group,"cn=yourgroupname,ou=Group,dc=company,dc=com","customfield"}

Regards

From 0x6e6562 at gmail.com  Tue Jun 10 18:17:16 2014
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 10 Jun 2014 18:17:16 +0100
Subject: [rabbitmq-discuss] frame size eror: source F5 Loadbalancer
In-Reply-To: <53859C4B.6030307@rabbitmq.com>
References: <6789221D917755409AD829E5EF0EAF5B7F7AD8B5@venmail01.vistaprint.net>
 <53859C4B.6030307@rabbitmq.com>
Message-ID: <CAB-G1jgv0T5AboOvTv+nbNUt7A84JVb1mewnu1X8vGaQNJaZUg@mail.gmail.com>

On Wed, May 28, 2014 at 9:20 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> My guess is that the load balancer is routing a new client connection to an
> existing server connection.

What's the general take on using F5 to maintain a transparent unbroken
AMQP conversation between a client and a set of individual cluster
nodes? Say for example one of the nodes dies to which a client had an
open connection to (via F5), is F5 smart enough to re-route the
existing AMQP conversation to another node in such a way that the
neither the server nor the client notice this?

From nathan at nkbrown.us  Tue Jun 10 20:42:29 2014
From: nathan at nkbrown.us (Nathan Brown)
Date: Tue, 10 Jun 2014 12:42:29 -0700
Subject: [rabbitmq-discuss] Would like to start merging .NET client for
 WinRT (Windows 8 Store App) with mainline code
In-Reply-To: <etPan.539632e8.643c9869.9b84@mercurio.local>
References: <CAFCmQSodWOuXMQjDaU0UCE5DQAOVesos3j8iWUbn1uLD8q4Qkg@mail.gmail.com>
 <etPan.53961f1c.6b8b4567.9b84@mercurio.local>
 <CAFCmQSqScL5fLdXjnh+9D2rQ2AryUdxOJdOBXCchi6rwm_5P-w@mail.gmail.com>
 <etPan.539632e8.643c9869.9b84@mercurio.local>
Message-ID: <CAFCmQSpQ-GGptTpFeqg1XTURx3aKWsQ91MMWEJgiUtwN+=hTRQ@mail.gmail.com>

> NUnit was able to test it without the configuration part. I can
> remove that and remove all the MSTest changes. The test runner
> then works as a desktop process (on Windows 8/Server 2012).

I merged with the most recent default branch to eliminate the protocol
configuration stuff and moved to a NUnit project for testing the WinStore
library.  I also backed out the MSTest changes.  This is all pushed to
Bitbucket.

There is a gotcha in that accessing the "Application.Current.Suspending"
event in ConnectionBase throws an exception when not in a full screen XAML
context.  This is equivalent to the AppDomain DomainUnload event, also used
in ConnectionBase.  My solution was to catch and ignore the exception for
the unit test.  An alternative could be to have an "ApplicationEventSource"
class that is implemented/overridden per platform and/or context.

Let me know when you have a chance to test it and if you have any
additional feedback for me.

Thanks,
Nathan Brown



On Mon, Jun 9, 2014 at 3:18 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 10 June 2014 at 01:48:41, Nathan Brown (nathan at nkbrown.us) wrote:
> > > > Good question. If WinRT is an incompatible target, does it
> > mean
> > > there should be 2 packages, X and X-winrt, for example?
> >
> > Different platform DLLs go in a named folders inside of the NuGet
> > package. Everything is delivered together and Visual Studio
> > links to the correct DLL. If it was possible to build the NuGet
> > package as part of the CI process, that would be the best. Currently
> > the NuGet creation lives elsewhere and is manually populated
> > with the release binaries.
>
> I'll ask our NuGet package maintainer to chime in. I suspect it's time to
> open source the code used for NuGet packaging ;)
>
> > > Is it technically possible to run the current NUnit test suite
> > > on WinRT? Protocol configuration is removed in default and
> > 3.4 will only
> > > support one protocol (0-9-1). Do we still need to worry about
> > using MSTest
> > > then?
> >
> > NUnit was able to test it without the configuration part. I can
> > remove that and remove all the MSTest changes. The test runner
> > then works as a desktop process (on Windows 8/Server 2012).
>
> Excellent!
>
> > > If your branch is in Mercurial or Git somewhere, we can work on
> > it until it's
> > > mostly done, then create a bug and pull it into the mainline.
> >
> > Anyone can pull it from Bitbucket(
> https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client)
> > right now. I can continue to work there.
>
> Lets do that. A public Mercurial repo is all we care about when it's time
> to merge.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140610/44ae0668/attachment.html>

From dsinclair at chariotsolutions.com  Tue Jun 10 20:50:42 2014
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Tue, 10 Jun 2014 15:50:42 -0400
Subject: [rabbitmq-discuss] Queue creation error
Message-ID: <CAGtiFWUVtGv8XH0RAC=cY+cBEgfLw7TR7GBCe3Gn6OK-hd9z3A@mail.gmail.com>

Hi all,

I am currently running a 2 node cluster with Rabbit 3.1.5. We have policies
setup to ensure that certain queues are mirrored on all the nodes in a
cluster.

Operations was configuring a new cluster and put the hipe_compile flag to
true (normally set to false). When they did this, queue creation was
failing for queues that needed to be mirrored. The error is below

=INFO REPORT==== 10-Jun-2014::19:19:52 ===
Adding mirror of queue 'title-server-test' in vhost '/test' on node
'rabbit at udbamq-cmc-02': <14717.5271.0>

=ERROR REPORT==== 10-Jun-2014::19:19:53 ===
** Generic server <0.5257.0> terminating
** Last message in was pre_hibernate
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/test">>,queue,
                           <<"title-server-test">>},
                          true,false,none,[],<0.5257.0>,[],[],
                          [{vhost,<<"/test">>},
                           {name,<<"unu-ha-all">>},
                           {pattern,

<<"menu-item-server.*|title-server.*|unu-server.*">>},
                           {definition,[{<<"ha-mode">>,<<"all">>}]},
                           {priority,0}],
                          []},
                         none,false,rabbit_mirror_queue_master,
                         {state,
                          {resource,<<"/test">>,queue,
                           <<"title-server-test">>},
                          <0.5259.0>,<0.5258.0>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           0,
                           {0,nil},
                           {0,nil},
                           {qistate,
                            "/var/lib/rabbitmq/mnesia/rabbit at udbamq-cmc-01
/queues/C3QO8FHBOV9KWRA6JK601BOPG",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            undefined,0,65536,
                            #Fun<rabbit_variable_queue.2.81334491>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,

 <<155,86,72,191,145,120,119,132,195,47,38,124,147,
                               109,237,88>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,35409996,
                              "/var/lib/rabbitmq/mnesia/rabbit at udbamq-cmc-01
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at udbamq-cmc-01
/msg_store_persistent",

 <0.4760.0>,35414093,35405899,35418190,35422287},
                            {client_msstate,msg_store_transient,

 <<167,204,117,67,245,155,36,187,165,217,239,159,
                               54,180,2,199>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,35389511,
                              "/var/lib/rabbitmq/mnesia/rabbit at udbamq-cmc-01
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at udbamq-cmc-01
/msg_store_transient",

 <0.4753.0>,35393608,35385408,35397705,35401802}},
                           true,0,0,0,infinity,0,0,0,0,0,
                           {rates,
                            {{1402,427992,812678},0},
                            {{1402,427992,812678},0},
                            0.0,0.0,
                            {1402,427992,812678}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,0,
                           {rates,
                            {{1402,427992,812678},0},
                            {{1402,427992,812678},0},
                            0.0,0.0,
                            {1402,427992,812678}}},
                          {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          [],
                          {set,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}}},
                         {[],[]},
                         undefined,undefined,#Ref<0.0.0.146892>,undefined,
                         {state,fine,5000,#Ref<0.0.0.146893>},
                         {0,nil},
                         undefined,undefined,undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined,undefined,running}
** Reason for termination ==
** {badarith,[{rabbit_variable_queue,ram_duration,1},
              {rabbit_mnesia,node_info,0},
              {rabbit_amqqueue_process,handle_pre_hibernate,1},
              {gen_server2,pre_hibernate,1},
              {rabbit_mnesia,node_info,0}]}

>From the sasl log

=CRASH REPORT==== 10-Jun-2014::19:19:53 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.5257.0>
    registered_name: []
    exception exit: {badarith,
                        [{rabbit_variable_queue,ram_duration,1},
                         {rabbit_mnesia,node_info,0},
                         {rabbit_amqqueue_process,handle_pre_hibernate,1},
                         {gen_server2,pre_hibernate,1},
                         {rabbit_mnesia,node_info,0}]}
      in function  gen_server2:terminate/3
      in call from rabbit_mnesia:node_info/0
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.4622.0>]
    messages: [{'EXIT',<0.5258.0>,{shutdown,ring_shutdown}}]
    links: [<0.4761.0>]
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct},
                  {guid,{{2815194435,4120585403,2782523295,917766855},1}}]
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 2122
  neighbours:

=SUPERVISOR REPORT==== 10-Jun-2014::19:19:53 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {badarith,[{rabbit_variable_queue,ram_duration,1},
                            {rabbit_mnesia,node_info,0},

{rabbit_amqqueue_process,handle_pre_hibernate,1},
                            {gen_server2,pre_hibernate,1},
                            {rabbit_mnesia,node_info,0}]}
     Offender:   [{pid,<0.5257.0>},
                  {name,rabbit_amqqueue},
                  {mfa,
                      {rabbit_amqqueue_process,start_link,
                          [{amqqueue,
                               {resource,<<"/unu-broker">>,queue,
                                   <<"title-server-date">>},
                               true,false,none,[],none,[],[],
                               [{vhost,<<"/unu-broker">>},
                                {name,<<"unu-ha-all">>},
                                {pattern,

<<"menu-item-server.*|title-server.*|unu-server.*">>},
                                {definition,[{<<"ha-mode">>,<<"all">>}]},
                                {priority,0}],
                               []}]}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 10-Jun-2014::19:21:33 ===
  crasher:
    initial call: mochiweb_acceptor:init/3
    pid: <0.4789.0>
    registered_name: []
    exception exit: {error,accept_failed}
      in function  mochiweb_acceptor:init/3
    ancestors: [rabbit_web_dispatch_sup_55672,rabbit_web_dispatch_sup,
                  <0.4613.0>]
    messages: []
    links: []
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 377
    stack_size: 24
    reductions: 2378
  neighbours:

=CRASH REPORT==== 10-Jun-2014::19:21:33 ===
  crasher:
    initial call: mochiweb_acceptor:init/3
    pid: <0.4787.0>
    registered_name: []
    exception exit: {error,accept_failed}
      in function  mochiweb_acceptor:init/3
    ancestors: [rabbit_web_dispatch_sup_55672,rabbit_web_dispatch_sup,
                  <0.4613.0>]
    messages: []
    links: []
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 377
    stack_size: 24
    reductions: 2383
  neighbours:

We can run with hipe_compile=false, but wanted to see if anyone else has
seen this.

thanks

dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140610/08d019e3/attachment.html>

From murthy at swapstech.com  Tue Jun 10 23:12:05 2014
From: murthy at swapstech.com (murthy at swapstech.com)
Date: Tue, 10 Jun 2014 18:12:05 -0400
Subject: [rabbitmq-discuss] Unable to connect to a node running in Amazon EC2
Message-ID: <acbfa664ca5cab0ed9ed378b82bc1207.squirrel@swapstech.com>

Dear RabbitMQ Users,

I have a node installed in Amazon EC2 (in a public domain) and I am able
to telnet and I am also able to see management console from a browser, but
when I try to connect to this server and publish a message, I am getting
the following error. Can you please let me know what is possibly causing
this issue?

Regards
Murthy

com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly
caused by authentication failure
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:355)
	at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
	at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
	at
com.swapstech.fxstar.message.amqp.AMQPFactory.setupRabbitMQ(AMQPFactory.java:62)
	at com.swapstech.fxstar.message.amqp.AMQPFactory.init(AMQPFactory.java:80)
	at
com.swapstech.fxstar.message.amqp.AMQPFactory.getInstance(AMQPFactory.java:137)
	at
com.swapstech.fxstar.workflow.service.WorkflowEngine.publishEvent(WorkflowEngine.java:111)
	at
com.swapstech.fxstar.workflow.test.PublishToWorkflowEngineTest.testCreateTradeVerifyAction(PublishToWorkflowEngineTest.java:12)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
	at java.lang.reflect.Method.invoke(Unknown Source)
	at junit.framework.TestCase.runTest(TestCase.java:154)
	at junit.framework.TestCase.runBare(TestCase.java:127)
	at junit.framework.TestResult$1.protect(TestResult.java:106)
	at junit.framework.TestResult.runProtected(TestResult.java:124)
	at junit.framework.TestResult.run(TestResult.java:109)
	at junit.framework.TestCase.run(TestCase.java:118)
	at junit.framework.TestSuite.runTest(TestSuite.java:208)
	at junit.framework.TestSuite.run(TestSuite.java:203)
	at
org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)
	at
org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
reason: java.net.SocketException: Connection reset
	at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
	at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
	at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
	at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:202)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:347)
	... 25 more
Caused by: java.net.SocketException: Connection reset
	at java.net.SocketInputStream.read(Unknown Source)
	at java.net.SocketInputStream.read(Unknown Source)
	at java.io.BufferedInputStream.fill(Unknown Source)
	at java.io.BufferedInputStream.read(Unknown Source)
	at java.io.DataInputStream.readUnsignedByte(Unknown Source)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
	at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:131)
	at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:515)



From mklishin at gopivotal.com  Tue Jun 10 23:49:37 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 11 Jun 2014 02:49:37 +0400
Subject: [rabbitmq-discuss] Unable to connect to a node running in
 Amazon EC2
In-Reply-To: <acbfa664ca5cab0ed9ed378b82bc1207.squirrel@swapstech.com>
References: <acbfa664ca5cab0ed9ed378b82bc1207.squirrel@swapstech.com>
Message-ID: <etPan.53978b9d.327b23c6.112b7@mercurio.local>

On 11 June 2014 at 02:11:44, murthy at swapstech.com (murthy at swapstech.com) wrote:
> > com.rabbitmq.client.PossibleAuthenticationFailureException:  
> Possibly
> caused by authentication failure

This exception means that TCP connection was closed before AMQP 0-9-1 connection negotiation
could finish. Per AMQP 0-9-1 spec, this is how brokers should indicate authentication
failure.

I suspect that it is simply an authentication failure and not a networking problem (those
would likely result in a different exception). If you upgrade to RabbitMQ and Java client 3.3,
you should see a more specific authentication failure exception.

Even better, have a look at RabbitMQ log ? does it log an incoming connection and an authentication failure??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From andretodd at verizon.net  Wed Jun 11 00:18:44 2014
From: andretodd at verizon.net (Andre)
Date: Tue, 10 Jun 2014 19:18:44 -0400
Subject: [rabbitmq-discuss] New to Rabbit in C#
Message-ID: <050a01cf8502$538d9450$faa8bcf0$@verizon.net>

I'm new to RabbitMQ and trying to write to a Queue and verify the message
was sent. If it fails I need to know about it. I made a fake queue to watch
it fail but no matter what I see no exceptions and when I am looking for a
ack I always get one. I never see the BasicNack.

 

I'm not even sure i'm the BasicAcks is the way to go.

 

 

private void button1_Click(object sender, EventArgs e)

    {

        var factory = new ConnectionFactory() { HostName = "localhost" };

        using (var connection = factory.CreateConnection())

        {

            using (var channel = connection.CreateModel())

            {

                channel.QueueDeclare("task_queue", true, false, false,
null);

 

                var message = ("Helllo world");

                var body = Encoding.UTF8.GetBytes(message);

                channel.ConfirmSelect();

 

                var properties = channel.CreateBasicProperties();

                properties.SetPersistent(true);

                properties.DeliveryMode = 2;

                channel.BasicAcks += channel_BasicAcks;

                channel.BasicNacks += channel_BasicNacks;

                //fake queue should be task_queue

                channel.BasicPublish("", "task_2queue", true, properties,
body);

 

                channel.WaitForConfirmsOrDie();

 

                Console.WriteLine(" [x] Sent {0}", message);

            }

        }

    }

 

    void channel_BasicNacks(IModel model, BasicNackEventArgs args)

    {

 

    }

 

    void channel_BasicAcks(IModel model, BasicAckEventArgs args)

    {

 

    }

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140610/d06d4c1e/attachment.html>

From mklishin at gopivotal.com  Wed Jun 11 00:22:28 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 11 Jun 2014 03:22:28 +0400
Subject: [rabbitmq-discuss] New to Rabbit in C#
In-Reply-To: <050a01cf8502$538d9450$faa8bcf0$@verizon.net>
References: <050a01cf8502$538d9450$faa8bcf0$@verizon.net>
Message-ID: <etPan.53979352.66334873.112b7@mercurio.local>

?On 11 June 2014 at 03:20:03, Andre (andretodd at verizon.net) wrote:
> >
> I'm new to RabbitMQ and trying to write to a Queue and verify the  
> message was sent. If it fails I need to know about it. I made a fake  
> queue to watch it fail but no matter what I see no exceptions and  
> when I am looking for a ack I always get one. I never see the BasicNack.  

You will get a nack if an internal error occurs, so it's not very easy to trigger
(but possible via rabbitmqctl eval). Publisher confirms is indeed the feature you want.

And to avoid messages being published successfully but routed nowhere, publish
them as mandatory. A mandatory message that cannot be routed anywhere will be
returned to the sender.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From andretodd at verizon.net  Wed Jun 11 00:27:51 2014
From: andretodd at verizon.net (Andre)
Date: Tue, 10 Jun 2014 19:27:51 -0400
Subject: [rabbitmq-discuss] New to Rabbit in C#
In-Reply-To: <etPan.53979352.66334873.112b7@mercurio.local>
References: <050a01cf8502$538d9450$faa8bcf0$@verizon.net>
 <etPan.53979352.66334873.112b7@mercurio.local>
Message-ID: <051601cf8503$9949a410$cbdcec30$@verizon.net>

Thanks for the fast response.

I believe I did put the mandatory flag on. (today is my first day at this) 

channel.BasicPublish("", "task_2queue", true, properties, body);

How do I receive the return?

Also, Publisher confirms, do you have any code examples of this?

Thanks so much
Andre



-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Tuesday, June 10, 2014 7:22 PM
To: Andre; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] New to Rabbit in C#

 On 11 June 2014 at 03:20:03, Andre (andretodd at verizon.net) wrote:
> >
> I'm new to RabbitMQ and trying to write to a Queue and verify the 
> message was sent. If it fails I need to know about it. I made a fake 
> queue to watch it fail but no matter what I see no exceptions and when 
> I am looking for a ack I always get one. I never see the BasicNack.

You will get a nack if an internal error occurs, so it's not very easy to trigger (but possible via rabbitmqctl eval). Publisher confirms is indeed the feature you want.

And to avoid messages being published successfully but routed nowhere, publish them as mandatory. A mandatory message that cannot be routed anywhere will be returned to the sender.
--
MK  

Software Engineer, Pivotal/RabbitMQ


From mklishin at gopivotal.com  Wed Jun 11 00:32:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 11 Jun 2014 03:32:24 +0400
Subject: [rabbitmq-discuss] New to Rabbit in C#
In-Reply-To: <051601cf8503$9949a410$cbdcec30$@verizon.net>
References: <050a01cf8502$538d9450$faa8bcf0$@verizon.net>
 <etPan.53979352.66334873.112b7@mercurio.local>
 <051601cf8503$9949a410$cbdcec30$@verizon.net>
Message-ID: <etPan.539795a6.19495cff.112b7@mercurio.local>

On 11 June 2014 at 03:27:50, Andre (andretodd at verizon.net) wrote:
> > channel.BasicPublish("", "task_2queue", true, properties,  
> body);

Correct, this is publishing as mandatory.

> How do I receive the return?

By registering a handler:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.3.2/rabbitmq-dotnet-client-3.3.2-client-htmldoc/html/type-RabbitMQ.Client.Events.BasicReturnEventHandler.html

> Also, Publisher confirms, do you have any code examples of this?  

It's the feature you are using. I'd recommend using

channel.ConfirmSelect + channel.WaitForConfirms but basic.ack
handlers is an option, too.?

If you care about throughput, wait for batches of messages
rather than every single one (IModel#WaitForConfirms blocks
the caller until all outstanding messages are acknowledged).
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From andretodd at verizon.net  Wed Jun 11 01:10:30 2014
From: andretodd at verizon.net (Andre)
Date: Tue, 10 Jun 2014 20:10:30 -0400
Subject: [rabbitmq-discuss] New to Rabbit in C#
In-Reply-To: <etPan.539795a6.19495cff.112b7@mercurio.local>
References: <050a01cf8502$538d9450$faa8bcf0$@verizon.net>
 <etPan.53979352.66334873.112b7@mercurio.local>
 <051601cf8503$9949a410$cbdcec30$@verizon.net>
 <etPan.539795a6.19495cff.112b7@mercurio.local>
Message-ID: <052001cf8509$8e9eb7c0$abdc2740$@verizon.net>

That worked! Thanks

Performance is a must on this. 

I had   channel.WaitForConfirms(); I assume I should insert bulk messages like 100 then call   channel.WaitForConfirms();?
Does it matter   channel.WaitForConfirms() or channel.WaitForConfirmsOrDie();

Thanks so much
andre

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Tuesday, June 10, 2014 7:32 PM
To: Discussions about RabbitMQ; Andre
Subject: RE: [rabbitmq-discuss] New to Rabbit in C#

On 11 June 2014 at 03:27:50, Andre (andretodd at verizon.net) wrote:
> > channel.BasicPublish("", "task_2queue", true, properties,
> body);

Correct, this is publishing as mandatory.

> How do I receive the return?

By registering a handler:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.3.2/rabbitmq-dotnet-client-3.3.2-client-htmldoc/html/type-RabbitMQ.Client.Events.BasicReturnEventHandler.html

> Also, Publisher confirms, do you have any code examples of this?  

It's the feature you are using. I'd recommend using

channel.ConfirmSelect + channel.WaitForConfirms but basic.ack handlers is an option, too. 

If you care about throughput, wait for batches of messages rather than every single one (IModel#WaitForConfirms blocks the caller until all outstanding messages are acknowledged).
--
MK  

Software Engineer, Pivotal/RabbitMQ


From mklishin at gopivotal.com  Wed Jun 11 01:13:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 11 Jun 2014 04:13:53 +0400
Subject: [rabbitmq-discuss] New to Rabbit in C#
In-Reply-To: <052001cf8509$8e9eb7c0$abdc2740$@verizon.net>
References: <050a01cf8502$538d9450$faa8bcf0$@verizon.net>
 <etPan.53979352.66334873.112b7@mercurio.local>
 <051601cf8503$9949a410$cbdcec30$@verizon.net>
 <etPan.539795a6.19495cff.112b7@mercurio.local>
 <052001cf8509$8e9eb7c0$abdc2740$@verizon.net>
Message-ID: <etPan.53979f5e.2ae8944a.112b7@mercurio.local>

?On 11 June 2014 at 04:11:52, Andre (andretodd at verizon.net) wrote:
> > I had channel.WaitForConfirms(); I assume I should insert  
> bulk messages like 100 then call channel.WaitForConfirms();??

Correct.

> Does it matter channel.WaitForConfirms() or channel.WaitForConfirmsOrDie();  

The former returns a boolean value (were all published messages acknowledged
successfully?), the latte throws an exception.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Wed Jun 11 08:15:13 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 11 Jun 2014 08:15:13 +0100
Subject: [rabbitmq-discuss] Queue creation error
In-Reply-To: <CAGtiFWUVtGv8XH0RAC=cY+cBEgfLw7TR7GBCe3Gn6OK-hd9z3A@mail.gmail.com>
References: <CAGtiFWUVtGv8XH0RAC=cY+cBEgfLw7TR7GBCe3Gn6OK-hd9z3A@mail.gmail.com>
Message-ID: <53980201.1050108@rabbitmq.com>

On 10/06/14 20:50, David Sinclair wrote:
> I am currently running a 2 node cluster with Rabbit 3.1.5. [...]
> Operations was configuring a new cluster and put the hipe_compile flag
> to true (normally set to false). When they did this, queue creation was
> failing for queues that needed to be mirrored. The error is
> [...]
>      exception exit: {badarith,
>                          [{rabbit_variable_queue,ram_duration,1},
>                           {rabbit_mnesia,node_info,0},
>                           {rabbit_amqqueue_process,handle_pre_hibernate,1},
>                           {gen_server2,pre_hibernate,1},
>                           {rabbit_mnesia,node_info,0}]}

The code that is failing has changed in more recent versions of rabbit, 
avoiding a floating point arithmetic rounding issue that could possibly 
trigger the above error. Please upgrade.

Also, please make sure you are using the latest Erlang version, since 
hipe compilation is an active area of development (and bug fixing).

Matthias.

From bvnr.mail at gmail.com  Wed Jun 11 08:15:27 2014
From: bvnr.mail at gmail.com (Narayan Reddy)
Date: Wed, 11 Jun 2014 12:45:27 +0530
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <etPan.5396c55a.625558ec.9b84@mercurio.local>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
 <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
 <5396A0FD.4080402@rabbitmq.com>
 <CAKV0HmPREmG2eBbtVmKERwMfHo6yWFAtVBrObgMga9yt=qD=SA@mail.gmail.com>
 <CAKV0HmMph4BD4fwGc-Ld=jmot5jNKvbxLqM7LYzSnSKKhVTkxA@mail.gmail.com>
 <etPan.5396c55a.625558ec.9b84@mercurio.local>
Message-ID: <CAKV0HmO67cQEdFkHdad1Ygzvt4swmgp5GTMq1kcG-aCSo5Dhgg@mail.gmail.com>

Checked the permissions for the files, all permissions set to 777 for ssl
files. and change the owner of the files to active RMQ process user. still
facing the same error  > {options,{cacertfile,"/home/
prime/SSL/testca/cacert.pem",{error,eacces}}}}
*-rwxrwxrwx 1 rabbitmq rabbitmq 1751 May 26 18:19 ca.key*
*drwxrwxrwx 2 rabbitmq rabbitmq 4096 May 28 12:31 client*
*drwxrwxrwx 2 rabbitmq rabbitmq 4096 May 28 12:27 server*
*drwxrwxrwx 4 rabbitmq rabbitmq 4096 May 28 12:30 testca*
*[root at primedev SSL]# cd server/*
*[root at primedev server]# ll*
*total 16*
*-rwxrwxrwx 1 rabbitmq rabbitmq 1058 May 28 12:26 cert.pem*
*-rwxrwxrwx 1 rabbitmq rabbitmq 2341 May 28 12:27 keycert.p12*
*-rwxrwxrwx 1 rabbitmq rabbitmq 1675 May 28 12:24 key.pem*
*-rwxrwxrwx 1 rabbitmq rabbitmq  911 May 28 12:25 req.pem*


--
Thanks


On 10 June 2014 14:13, Michael Klishin <mklishin at gopivotal.com> wrote:

>  On 10 June 2014 at 12:42:15, Narayan Reddy (bvnr.mail at gmail.com) wrote:
> > > {ssl_upgrade_error,
> >
> {options,{cacertfile,"/home/prime/SSL/testca/cacert.pem",{error,eacces}}}}
> >
> >
> > In which cases it can throw the error eaccess ?, Please help me
> > to resolve this issue.
>
> File permission error of a kind. Make sure the file can be read by
> the active RabbitMQ process user.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140611/7d520933/attachment.html>

From simon at rabbitmq.com  Wed Jun 11 10:38:08 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Jun 2014 10:38:08 +0100
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <CAKV0HmO67cQEdFkHdad1Ygzvt4swmgp5GTMq1kcG-aCSo5Dhgg@mail.gmail.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
 <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
 <5396A0FD.4080402@rabbitmq.com>
 <CAKV0HmPREmG2eBbtVmKERwMfHo6yWFAtVBrObgMga9yt=qD=SA@mail.gmail.com>
 <CAKV0HmMph4BD4fwGc-Ld=jmot5jNKvbxLqM7LYzSnSKKhVTkxA@mail.gmail.com>
 <etPan.5396c55a.625558ec.9b84@mercurio.local>
 <CAKV0HmO67cQEdFkHdad1Ygzvt4swmgp5GTMq1kcG-aCSo5Dhgg@mail.gmail.com>
Message-ID: <53982380.6020307@rabbitmq.com>

On 11/06/14 08:15, Narayan Reddy wrote:
> Checked the permissions for the files, all permissions set to 777 for
> ssl files. and change the owner of the files to active RMQ process user.
> still facing the same error >
> {options,{cacertfile,"/home/prime/SSL/testca/cacert.pem",{error,eacces}}}}

That "eaccess" really is telling you that the file cannot be read. Just 
because the permissions on the files are open doesn't mean the file can 
be read; intermediate directories must be readable too.

I strongly recommend you become the rabbitmq user (with e.g. "sudo -s -u 
rabbitmq") and try to read the files. This should let you diagnose any 
problems.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dsinclair at chariotsolutions.com  Wed Jun 11 14:21:58 2014
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Wed, 11 Jun 2014 09:21:58 -0400
Subject: [rabbitmq-discuss] Queue creation error
In-Reply-To: <53980201.1050108@rabbitmq.com>
References: <CAGtiFWUVtGv8XH0RAC=cY+cBEgfLw7TR7GBCe3Gn6OK-hd9z3A@mail.gmail.com>
 <53980201.1050108@rabbitmq.com>
Message-ID: <CAGtiFWUu16DnD7vX1hwcb2jUwGQcehp0RZb8SWDNLrPCYsWO8w@mail.gmail.com>

Thanks Matthias. I will get them upgraded and see if that fixes the problem.


On Wed, Jun 11, 2014 at 3:15 AM, Matthias Radestock <matthias at rabbitmq.com>
wrote:

> On 10/06/14 20:50, David Sinclair wrote:
>
>> I am currently running a 2 node cluster with Rabbit 3.1.5. [...]
>>
>> Operations was configuring a new cluster and put the hipe_compile flag
>> to true (normally set to false). When they did this, queue creation was
>> failing for queues that needed to be mirrored. The error is
>> [...]
>>
>>      exception exit: {badarith,
>>                          [{rabbit_variable_queue,ram_duration,1},
>>                           {rabbit_mnesia,node_info,0},
>>                           {rabbit_amqqueue_process,
>> handle_pre_hibernate,1},
>>                           {gen_server2,pre_hibernate,1},
>>                           {rabbit_mnesia,node_info,0}]}
>>
>
> The code that is failing has changed in more recent versions of rabbit,
> avoiding a floating point arithmetic rounding issue that could possibly
> trigger the above error. Please upgrade.
>
> Also, please make sure you are using the latest Erlang version, since hipe
> compilation is an active area of development (and bug fixing).
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140611/91cd9680/attachment.html>

From bvnr.mail at gmail.com  Wed Jun 11 15:01:55 2014
From: bvnr.mail at gmail.com (Narayan Reddy)
Date: Wed, 11 Jun 2014 19:31:55 +0530
Subject: [rabbitmq-discuss] SSL upgrade error cacrtfile
In-Reply-To: <53982380.6020307@rabbitmq.com>
References: <00f65419-f345-42c5-b398-d15b307984a6@googlegroups.com>
 <etPan.538ed3d6.5bd062c2.e723@mercurio.local>
 <CAKV0HmP515Aa=mVymfWgUzP85d+ZfFjPdwhw83jCgU4XKOyerg@mail.gmail.com>
 <etPan.538f0d98.519b500d.e723@mercurio.local>
 <CAKV0HmMrVZm7RBpN_EWQdMatp9_K7tD6C5YCk=0yNuaErB7HJg@mail.gmail.com>
 <etPan.538f19a0.333ab105.e723@mercurio.local>
 <CAKV0HmO1XCtmptLwruiGKq5njtvXR2OEhY_6_5rEDq7w_5Xjrw@mail.gmail.com>
 <CAKV0HmMgsquu0nW8UgW2EeCkvh-0o+6zxWBnUH=6zBRFhdX+Bw@mail.gmail.com>
 <5396A0FD.4080402@rabbitmq.com>
 <CAKV0HmPREmG2eBbtVmKERwMfHo6yWFAtVBrObgMga9yt=qD=SA@mail.gmail.com>
 <CAKV0HmMph4BD4fwGc-Ld=jmot5jNKvbxLqM7LYzSnSKKhVTkxA@mail.gmail.com>
 <etPan.5396c55a.625558ec.9b84@mercurio.local>
 <CAKV0HmO67cQEdFkHdad1Ygzvt4swmgp5GTMq1kcG-aCSo5Dhgg@mail.gmail.com>
 <53982380.6020307@rabbitmq.com>
Message-ID: <CAKV0HmPxh-ECTTfL5EOMpZpMaYsdH5VBLhGMNV3Mpx4yN59kgA@mail.gmail.com>

Thanks Simon, Michael, Matthias & RMQ team.

*sudo -s -u rabbitmq*
*bash-4.1$*
*bash-4.1$*
*bash-4.1$ cat /home/prime/SSL/testca/cert.pem*
*cat: /home/prime/SSL/testca/cert.pem: Permission denied*
*bash-4.1$*

Yes the error was due to permissions only, will correct it , Tried with
windows RMQ server it worked fine .. Thanks for the support RMQ team.



On 11 June 2014 15:08, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/06/14 08:15, Narayan Reddy wrote:
>
>> Checked the permissions for the files, all permissions set to 777 for
>> ssl files. and change the owner of the files to active RMQ process user.
>> still facing the same error >
>> {options,{cacertfile,"/home/prime/SSL/testca/cacert.pem",{
>> error,eacces}}}}
>>
>
> That "eaccess" really is telling you that the file cannot be read. Just
> because the permissions on the files are open doesn't mean the file can be
> read; intermediate directories must be readable too.
>
> I strongly recommend you become the rabbitmq user (with e.g. "sudo -s -u
> rabbitmq") and try to read the files. This should let you diagnose any
> problems.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140611/e3f159c2/attachment.html>

From aturetta+rabbit at commit.it  Wed Jun 11 15:35:53 2014
From: aturetta+rabbit at commit.it (Angelo Turetta)
Date: Wed, 11 Jun 2014 16:35:53 +0200
Subject: [rabbitmq-discuss] 3.3.x dynamic shovel, delivery-mode?
Message-ID: <CAAK-HJcKg5Q0_t3+CQV7et+Lx_eZQ9cRwGaZZd9NwZZeYaEyiw@mail.gmail.com>

I like very much the new dynamic shovels in 3.3, but I'm missing one key
feature: how can I force the delivery-mode of messages in transit?

The old static shovels allowed me to specify:

{publish_properties, [{delivery_mode, 2}]},

While the new api used to define dynamic ones seems not to allow any
publish_properties, or at least there is no docs about it.

Is it possible to make messages persistent with the help of dynamic
shovels? Any chance that default parameters specified for static shovels
would apply to dynamic ones?

Thank you
Angelo Turetta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140611/fdea9aaf/attachment.html>

From phillpafford at gmail.com  Wed Jun 11 22:05:22 2014
From: phillpafford at gmail.com (Phill Pafford)
Date: Wed, 11 Jun 2014 14:05:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Process for updating RabbitMQ Version 3.0.1 and
	3.1.1 to 3.3.x?
Message-ID: <24eddf98-270d-4ade-bd9b-718ef411e4e2@googlegroups.com>

I'm not sure if I downloaded the package and installed manually or with 
apt-get (Running Ubuntu).

Is there documentation on this upgrade process?

Thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140611/3437a447/attachment.html>

From mklishin at gopivotal.com  Wed Jun 11 22:11:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 12 Jun 2014 01:11:25 +0400
Subject: [rabbitmq-discuss] Process for updating RabbitMQ Version 3.0.1
 and 3.1.1 to 3.3.x?
In-Reply-To: <24eddf98-270d-4ade-bd9b-718ef411e4e2@googlegroups.com>
References: <24eddf98-270d-4ade-bd9b-718ef411e4e2@googlegroups.com>
Message-ID: <etPan.5398c61a.74b0dc51.14b20@mercurio.local>

?On 12 June 2014 at 01:07:33, Phill Pafford (phillpafford at gmail.com) wrote:
> > I'm not sure if I downloaded the package and installed manually  
> or with apt-get (Running Ubuntu).

You can find it out by running

sudo dpkg -s?rabbitmq-server

> Is there documentation on this upgrade process?

With apt, you just install the upgrade. With the tarball version, if you
did not override RabbitMQ database location and such [1], you should be able
to just stop the service and start the new version.

In both cases, the database will be irreversibly upgraded, so back it up
just in case (requires the node to be stopped).

If you need to upgrade a cluster, see [2].

1.?http://www.rabbitmq.com/relocate.html
2.?https://www.rabbitmq.com/clustering.html#upgrading
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Verteiler+rabbitmq-discuss at LuftHans.com  Wed Jun 11 23:43:13 2014
From: Verteiler+rabbitmq-discuss at LuftHans.com (der.hans)
Date: Wed, 11 Jun 2014 15:43:13 -0700 (MST)
Subject: [rabbitmq-discuss] bug 26118 and error
Message-ID: <alpine.DEB.2.02.1406111535460.3313@neigel.LuftHans.com>

moin moin,

http://hg.rabbitmq.com/rabbitmq-server/changeset/7b9702cbe25a

That patch looks to me like it might be addressing the following error.
Is that correct?

=ERROR REPORT==== 11-Jun-2014::07:00:06 ===
** Generic server <0.15653.7321> terminating
** Last message in was pre_hibernate
** When Server state == {not_started,
                             {amqqueue,
                                 {resource,<<"gen_vhost">>,queue,
                                     <<"some.obsfucated.string.example.com">>}
,
                                 false,false,none,
                                 [{<<"x-expires">>,signedint,10800000}],
                                 <7355.15166.7309>,[],[],
                                 [{vhost,<<"gen_vhost">>},
                                  {name,<<"ha-all.service">>},
                                  {pattern,<<"^service.*">>},
                                  {'apply-to',<<"queues">>},
                                  {definition,[{<<"ha-mode">>,<<"all">>}]},
                                  {priority,0}],
                                 [{<7355.26723.6522>,<7355.15166.7309>}],
                                 []}}
** Reason for termination == 
** {function_clause,
        [{rabbit_mirror_queue_slave,terminate,
             [{function_clause,
                  [{rabbit_mirror_queue_slave,handle_pre_hibernate,
                       [{not_started,
                            {amqqueue,
                                {resource,<<"gen_vhost">>,queue,
                                    <<"some.obsfucated.string.example.com">>},
                                false,false,none,
                                [{<<"x-expires">>,signedint,10800000}],
                                <7355.15166.7309>,[],[],
                                [{vhost,<<"gen_vhost">>},
                                 {name,<<"ha-all.service">>},
                                 {pattern,<<"^service.*">>},
                                 {'apply-to',<<"queues">>},
                                 {definition,[{<<"ha-mode">>,<<"all">>}]},
                                 {priority,0}],
                                [{<7355.26723.6522>,<7355.15166.7309>}],
                                []}}],
                       []},
                   {gen_server2,pre_hibernate,1,[]},
                   {proc_lib,init_p_do_apply,3,
                       [{file,"proc_lib.erl"},{line,239}]}]},
              {not_started,
                  {amqqueue,
                      {resource,<<"gen_vhost">>,queue,
                          <<"some.obsfucated.string.example.com">>},
                      false,false,none,
                      [{<<"x-expires">>,signedint,10800000}],
                      <7355.15166.7309>,[],[],
                      [{vhost,<<"gen_vhost">>},
                       {name,<<"ha-all.service">>},
                       {pattern,<<"^service.*">>},
                       {'apply-to',<<"queues">>},
                       {definition,[{<<"ha-mode">>,<<"all">>}]},
                       {priority,0}],
                      [{<7355.26723.6522>,<7355.15166.7309>}],
                      []}}],
             []},
         {gen_server2,terminate,3,[]},
         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}
** In 'terminate' callback with reason ==
** {function_clause,
        [{rabbit_mirror_queue_slave,handle_pre_hibernate,
             [{not_started,
                  {amqqueue,
                      {resource,<<"gen_vhost">>,queue,
                          <<"some.obsfucated.string.example.com">>},
                      false,false,none,
                      [{<<"x-expires">>,signedint,10800000}],
                      <7355.15166.7309>,[],[],
                      [{vhost,<<"gen_vhost">>},
                       {name,<<"ha-all.service">>},
                       {pattern,<<"^service.*">>},
                       {'apply-to',<<"queues">>},
                       {definition,[{<<"ha-mode">>,<<"all">>}]},
                       {priority,0}],
                      [{<7355.26723.6522>,<7355.15166.7309>}],
                      []}}],
             []},
         {gen_server2,pre_hibernate,1,[]},
         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}

ciao,

der.hans
-- 
#  http://www.LuftHans.com/        http://www.LuftHans.com/Classes/
#  "Communications without intelligence is noise;
#  Intelligence without communications is irrelevant."
#  Gen. Alfred. M. Gray, USMC

From mklishin at gopivotal.com  Wed Jun 11 23:46:17 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 12 Jun 2014 02:46:17 +0400
Subject: [rabbitmq-discuss] bug 26118 and error
In-Reply-To: <alpine.DEB.2.02.1406111535460.3313@neigel.LuftHans.com>
References: <alpine.DEB.2.02.1406111535460.3313@neigel.LuftHans.com>
Message-ID: <etPan.5398dc54.6b8b4567.c7f@mercurio.local>

On 12 June 2014 at 02:42:03, der.hans (verteiler+rabbitmq-discuss at lufthans.com) wrote:
> > That patch looks to me like it might be addressing the following  
> error.
> Is that correct?
>  
> =ERROR REPORT==== 11-Jun-2014(http://airmail.calendar/2014-06-11%2012:00:00%20GMT+4)::07:00:06  
> ===
> ** Generic server <0.15653.7321> terminating
> ** Last message in was pre_hibernate
> ** When Server state == {not_started,

Seems so.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From DeepNightTwo at gmail.com  Thu Jun 12 09:30:50 2014
From: DeepNightTwo at gmail.com (DeepNightTwo)
Date: Thu, 12 Jun 2014 01:30:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Does rabbitmq support to push the same data to
	multi consumers?
Message-ID: <1402561850196-36169.post@n5.nabble.com>

I have a rabbitmq cluster used as a working queue. There are 5 kinds of
consumers who want to consume exactly the same data.

What I know for now is using fanout exchange to "copy" the data to 5
DIFFERENT queues. And the 5 consumers can consume different queue. This is
kind of wasting resources because the data is the same in file queues.

My question is, does rabbitmq support to push the same data to multi
consumers? Just like a message need to be acked for a specified times to be
deleted.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Does-rabbitmq-support-to-push-the-same-data-to-multi-consumers-tp36169.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Thu Jun 12 10:56:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 12 Jun 2014 13:56:38 +0400
Subject: [rabbitmq-discuss] Does rabbitmq support to push the same data
 to multi consumers?
In-Reply-To: <1402561850196-36169.post@n5.nabble.com>
References: <1402561850196-36169.post@n5.nabble.com>
Message-ID: <etPan.53997970.6b8b4567.2f08@mercurio.local>

On 12 June 2014 at 12:32:05, DeepNightTwo (deepnighttwo at gmail.com) wrote:
> > I have a rabbitmq cluster used as a working queue. There are 5  
> kinds of
> consumers who want to consume exactly the same data.
>  
> What I know for now is using fanout exchange to "copy" the data  
> to 5
> DIFFERENT queues. And the 5 consumers can consume different  
> queue. This is
> kind of wasting resources because the data is the same in file  
> queues.

It is not wasting any significant amount of resources: message payload
is stored once and a reference is added to multiple queue indices.

> My question is, does rabbitmq support to push the same data to  
> multi
> consumers? Just like a message need to be acked for a specified  
> times to be
> deleted.

As you correctly point out above, the way to do it with RabbitMQ is
to use multiple queues (one per consumer) and a fanout, topic, or similar
exchange type.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu Jun 12 11:25:55 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Jun 2014 11:25:55 +0100
Subject: [rabbitmq-discuss] bug 26118 and error
In-Reply-To: <etPan.5398dc54.6b8b4567.c7f@mercurio.local>
References: <alpine.DEB.2.02.1406111535460.3313@neigel.LuftHans.com>
 <etPan.5398dc54.6b8b4567.c7f@mercurio.local>
Message-ID: <53998033.6060805@rabbitmq.com>

On 11/06/14 23:46, Michael Klishin wrote:
>>> > >That patch looks to me like it might be addressing the following
>> >error.
>> >Is that correct?
>> >
>> >=ERROR REPORT==== 11-Jun-2014(http://airmail.calendar/2014-06-11%2012:00:00%20GMT+4)::07:00:06
>> >===
>> >** Generic server <0.15653.7321> terminating
>> >** Last message in was pre_hibernate
>> >** When Server state == {not_started,
> Seems so.

Yes. From http://www.rabbitmq.com/release-notes/README-3.3.1.txt:

26118 prevent slave queue crash if a queue hibernates before it has
       fully started (since 3.2.2)


Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jun 12 11:32:23 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Jun 2014 11:32:23 +0100
Subject: [rabbitmq-discuss] Process for updating RabbitMQ Version 3.0.1
 and 3.1.1 to 3.3.x?
In-Reply-To: <etPan.5398c61a.74b0dc51.14b20@mercurio.local>
References: <24eddf98-270d-4ade-bd9b-718ef411e4e2@googlegroups.com>
 <etPan.5398c61a.74b0dc51.14b20@mercurio.local>
Message-ID: <539981B7.9070400@rabbitmq.com>

On 11/06/14 22:11, Michael Klishin wrote:
> With apt, you just install the upgrade. With the tarball version, if you
> did not override RabbitMQ database location and such [1], you should be able
> to just stop the service and start the new version.

But note that by default the tarball version stores the database (and 
config) within the directory structure of the unpacked tarball. So you 
would need to copy them over if you did not override their locations.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From phillpafford at gmail.com  Thu Jun 12 13:04:47 2014
From: phillpafford at gmail.com (Phill Pafford)
Date: Thu, 12 Jun 2014 08:04:47 -0400
Subject: [rabbitmq-discuss] Process for updating RabbitMQ Version 3.0.1
 and 3.1.1 to 3.3.x?
In-Reply-To: <539981B7.9070400@rabbitmq.com>
References: <24eddf98-270d-4ade-bd9b-718ef411e4e2@googlegroups.com>
 <etPan.5398c61a.74b0dc51.14b20@mercurio.local>
 <539981B7.9070400@rabbitmq.com>
Message-ID: <CACnhB+MG1q1kBCWahTMb=JE_jVcKb0U8unaQ5ifU08Ps7f=MnQ@mail.gmail.com>

Sorry maybe I'm missing something, I would definitely backup the config but
what database would I need to back up?



On Thu, Jun 12, 2014 at 6:32 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/06/14 22:11, Michael Klishin wrote:
>
>> With apt, you just install the upgrade. With the tarball version, if you
>> did not override RabbitMQ database location and such [1], you should be
>> able
>> to just stop the service and start the new version.
>>
>
> But note that by default the tarball version stores the database (and
> config) within the directory structure of the unpacked tarball. So you
> would need to copy them over if you did not override their locations.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
Thanks,
Phill Pafford

Linkedin: http://www.linkedin.com/in/phillpafford
MyBlog:   http://llihp.blogspot.com/
Twitter:    http://twitter.com/phillpafford
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140612/c3e91934/attachment.html>

From mklishin at gopivotal.com  Thu Jun 12 13:20:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 12 Jun 2014 16:20:02 +0400
Subject: [rabbitmq-discuss] Process for updating RabbitMQ Version 3.0.1
 and 3.1.1 to 3.3.x?
In-Reply-To: <CACnhB+MG1q1kBCWahTMb=JE_jVcKb0U8unaQ5ifU08Ps7f=MnQ@mail.gmail.com>
References: <24eddf98-270d-4ade-bd9b-718ef411e4e2@googlegroups.com>
 <etPan.5398c61a.74b0dc51.14b20@mercurio.local>
 <539981B7.9070400@rabbitmq.com>
 <CACnhB+MG1q1kBCWahTMb=JE_jVcKb0U8unaQ5ifU08Ps7f=MnQ@mail.gmail.com>
Message-ID: <etPan.53999b10.6b8b4567.6cc@mercurio.local>

On 12 June 2014 at 16:06:59, Phill Pafford (phillpafford at gmail.com) wrote:
> > what database would I need to back up?

What is at RABBITMQ_MNESIA_BASE, see?http://www.rabbitmq.com/relocate.html?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu Jun 12 16:29:19 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Jun 2014 16:29:19 +0100
Subject: [rabbitmq-discuss] 3.3.x dynamic shovel, delivery-mode?
In-Reply-To: <CAAK-HJcKg5Q0_t3+CQV7et+Lx_eZQ9cRwGaZZd9NwZZeYaEyiw@mail.gmail.com>
References: <CAAK-HJcKg5Q0_t3+CQV7et+Lx_eZQ9cRwGaZZd9NwZZeYaEyiw@mail.gmail.com>
Message-ID: <5399C74F.10706@rabbitmq.com>

On 11/06/14 15:35, Angelo Turetta wrote:
> I like very much the new dynamic shovels in 3.3, but I'm missing one key
> feature: how can I force the delivery-mode of messages in transit?

At the moment you can't.

> The old static shovels allowed me to specify:
>
> {publish_properties, [{delivery_mode, 2}]},
>
> While the new api used to define dynamic ones seems not to allow any
> publish_properties, or at least there is no docs about it.

No, there's no equivalent.

One goal for the dynamic shovel was to be a bit simpler than the static 
shovel, which does make it a bit less flexible.

> Is it possible to make messages persistent with the help of dynamic
> shovels? Any chance that default parameters specified for static shovels
> would apply to dynamic ones?

Hmm, that's an interesting idea. Alternatively, switching delivery_mode 
might be a common enough thing to be worth special casing, the way we 
already do for exchange and routing key. Hmm.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Thu Jun 12 17:19:06 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 12 Jun 2014 12:19:06 -0400
Subject: [rabbitmq-discuss] 3.3.x dynamic shovel, delivery-mode?
In-Reply-To: <5399C74F.10706@rabbitmq.com>
References: <CAAK-HJcKg5Q0_t3+CQV7et+Lx_eZQ9cRwGaZZd9NwZZeYaEyiw@mail.gmail.com>
 <5399C74F.10706@rabbitmq.com>
Message-ID: <CAKgmDnHRT7dW4g+UAV05ag=i1B7w8sW8+wtk42n77h72mDMqvg@mail.gmail.com>

+1 on that.

We will not be able to use dynamic shovels in our proxies and product
clusters until we can set delivery_mode, in our case to 1 as we never
persist messages in the core clusters.

Actually we set user_id too.

This usage is actually long-lived rather than dynamic in the usual sense,
but it is very inconvenient to have to restart to change configuration,
particularly since everything else needed to set up a new vhost in our
environment can be done dynamically.

ml


On Thu, Jun 12, 2014 at 11:29 AM, Simon MacMullen <simon at rabbitmq.com>
wrote:

> On 11/06/14 15:35, Angelo Turetta wrote:
>
>> I like very much the new dynamic shovels in 3.3, but I'm missing one key
>> feature: how can I force the delivery-mode of messages in transit?
>>
>
> At the moment you can't.
>
>
>  The old static shovels allowed me to specify:
>>
>> {publish_properties, [{delivery_mode, 2}]},
>>
>> While the new api used to define dynamic ones seems not to allow any
>> publish_properties, or at least there is no docs about it.
>>
>
> No, there's no equivalent.
>
> One goal for the dynamic shovel was to be a bit simpler than the static
> shovel, which does make it a bit less flexible.
>
>
>  Is it possible to make messages persistent with the help of dynamic
>> shovels? Any chance that default parameters specified for static shovels
>> would apply to dynamic ones?
>>
>
> Hmm, that's an interesting idea. Alternatively, switching delivery_mode
> might be a common enough thing to be worth special casing, the way we
> already do for exchange and routing key. Hmm.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140612/aaf004c7/attachment.html>

From paul.holyoake at googlemail.com  Thu Jun 12 16:34:25 2014
From: paul.holyoake at googlemail.com (Paul Holyoake)
Date: Thu, 12 Jun 2014 08:34:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to add new users in RabbitMQ cluster
Message-ID: <1aca1f86-8b6d-4295-be1d-06b700e686b0@googlegroups.com>

Hi,

We've recently set up a two node RabbitMQ cluster (both nodes are disk). 
Running RabbitMQ v3.3.0 and Erlang 17.

Using the admin console connecting to the primary node, I can add a user 
called "test" with the password "test". I add the "administrator" tag and 
add permissions to the "/" virtual host.

I can see the user replicated on the second node using the admin console. 

When logged out and trying to login as the "test" user to either's admin 
console, I get the login failed. I've tried restarting the rabbit service 
on the secondary node.

Any ideas?

Cheers
Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140612/8798d2b0/attachment.html>

From shadimari at gmail.com  Thu Jun 12 17:47:30 2014
From: shadimari at gmail.com (Shadi Mari)
Date: Thu, 12 Jun 2014 09:47:30 -0700 (PDT)
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
	to?!!
Message-ID: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>

Hello,

I am new to Rabbitmq, however i have built so many messaging solution on 
top of other stacks..

I am trying to leverage the capabilities of RabbitMQ in one of my solutions 
where HA and high scalability  is a must; so far the better option the came 
out of my research 
is to use active/active cluster and mirrored queues in order to provide HA, 
otherwise using active/standby where the queue lives on the node it was 
created on, will not achieve HA requirement.

On the other hand, this should be mixed a load balancer, where consumers 
and publishers are connected to the cluster through in order to direct 
consumers/publishers to a different node each time the connection takes 
place.

However, my understanding says that RabbiqMQ in the case of mirrored queue 
will connect consumers and publishers to the master node which will not 
help in distributing load across all nodes. I am not sure but it came to my 
knowledge that SoundCloud uses the same approach!

Is my understanding above correct? if Yes, then how do companies that uses 
RabbitMQ and require HA and high scalability work it out.

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140612/949996ee/attachment.html>

From mklishin at gopivotal.com  Thu Jun 12 18:51:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 12 Jun 2014 21:51:47 +0400
Subject: [rabbitmq-discuss] Unable to add new users in RabbitMQ cluster
In-Reply-To: <1aca1f86-8b6d-4295-be1d-06b700e686b0@googlegroups.com>
References: <1aca1f86-8b6d-4295-be1d-06b700e686b0@googlegroups.com>
Message-ID: <etPan.5399e8d2.6b8b4567.947@mercurio.local>

On 12 June 2014 at 21:50:51, Paul Holyoake (paul.holyoake at googlemail.com) wrote:
> > When logged out and trying to login as the "test" user to either's 
> admin console, I get the login failed. I've tried restarting 
> the rabbit service on the secondary node.
> 
> Any ideas?

What's in RabbitMQ log files?
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From ranjitiyer at gmail.com  Thu Jun 12 18:59:07 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Thu, 12 Jun 2014 10:59:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't delete guest user..
Message-ID: <1402595947585-36182.post@n5.nabble.com>

Group,

We are integrating RabbitMQ into our software and expose a simple API to
start/stop RabbitMQ. 

When someone starts RabbitMQ I reset the node, start it, add a user and
delete the guest user. When I delete the guest user (rabbitmqctl delete_user
guest) I always get this error. Not sure what it means. Read Simon's answer
to a similar sounding question in which he said it's related to the
resetting of the node. 

Deleting user "guest" ...
Error: {noproc,{gen_server2,call,
                           
[worker_pool,{next_free,<5098.105.0>},infinity]}}

Ranjit



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-guest-user-tp36182.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Thu Jun 12 19:02:08 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 12 Jun 2014 22:02:08 +0400
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
 to?!!
In-Reply-To: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
Message-ID: <etPan.5399eb3a.643c9869.947@mercurio.local>

?On 12 June 2014 at 21:52:47, Shadi Mari (shadimari at gmail.com) wrote:
> > However, my understanding says that RabbiqMQ in the case of  
> mirrored queue will connect consumers and publishers to the  
> master node which will not help in distributing load across all  
> nodes

"master" in the above does not mean a single cluster-wide master node. It means "master
for a particular queue". By spreading connections between nodes using a balancer,
you (should) spread the nodes where queues were declared (using queue.declare).
The node on which a queue was declared becomes its master.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From shadimari at gmail.com  Thu Jun 12 19:18:26 2014
From: shadimari at gmail.com (Shadi Mari)
Date: Thu, 12 Jun 2014 21:18:26 +0300
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
	to?!!
In-Reply-To: <etPan.5399eb3a.643c9869.947@mercurio.local>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
 <etPan.5399eb3a.643c9869.947@mercurio.local>
Message-ID: <CADsp-PUu+_Rrxbbjw1o6_M=GD=ODbx3NGCRfhjmecT6gQQJxbQ@mail.gmail.com>

Does that mean that if  i have two publishers declare the same queue on
different nodes of the cluster, i will end up having two master queues and
two slaves?

What is the right way and best practice to mix load balancing with HA on
RabbitMQ?

Shadi


On Thu, Jun 12, 2014 at 9:02 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 12 June 2014 at 21:52:47, Shadi Mari (shadimari at gmail.com) wrote:
> > > However, my understanding says that RabbiqMQ in the case of
> > mirrored queue will connect consumers and publishers to the
> > master node which will not help in distributing load across all
> > nodes
>
> "master" in the above does not mean a single cluster-wide master node. It
> means "master
> for a particular queue". By spreading connections between nodes using a
> balancer,
> you (should) spread the nodes where queues were declared (using
> queue.declare).
> The node on which a queue was declared becomes its master.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140612/e63ecbc5/attachment.html>

From mklishin at gopivotal.com  Thu Jun 12 19:21:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 12 Jun 2014 22:21:57 +0400
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
 to?!!
In-Reply-To: <CADsp-PUu+_Rrxbbjw1o6_M=GD=ODbx3NGCRfhjmecT6gQQJxbQ@mail.gmail.com>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
 <etPan.5399eb3a.643c9869.947@mercurio.local>
 <CADsp-PUu+_Rrxbbjw1o6_M=GD=ODbx3NGCRfhjmecT6gQQJxbQ@mail.gmail.com>
Message-ID: <etPan.5399efe2.74b0dc51.947@mercurio.local>

?On 12 June 2014 at 22:18:27, Shadi Mari (shadimari at gmail.com) wrote:
> > Does that mean that if i have two publishers declare the same  
> queue on different nodes of the cluster, i will end up having two  
> master queues and two slaves?

queue.declare is idempotent. If you declare a queue that already exists
with the same attributes, nothing happens. If the attributes differ, you get
an error.

> What is the right way and best practice to mix load balancing with  
> HA on RabbitMQ?

"the right way" depends on what you do. Having a load balancer in front of
a cluster to distribute queue masters is one technique. Not mirroring to all
nodes in the cluster is another (2-3 nodes is often sufficient). Having
your consumers connect to queue masters to avoid intra-cluster traffic
(you can infer queue masters from queue info over HTTP API) will?
increase throughput.

The goal is to spread queue masters between nodes and improve data locality.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From RabbitMQ at jenolan.org  Fri Jun 13 00:30:59 2014
From: RabbitMQ at jenolan.org (Larry Lewis)
Date: Fri, 13 Jun 2014 09:30:59 +1000
Subject: [rabbitmq-discuss] Exchange consumer declaration
In-Reply-To: <539981B7.9070400@rabbitmq.com>
References: <24eddf98-270d-4ade-bd9b-718ef411e4e2@googlegroups.com>
 <etPan.5398c61a.74b0dc51.14b20@mercurio.local>
 <539981B7.9070400@rabbitmq.com>
Message-ID: <539A3833.5090901@jenolan.org>

So far in my newest coding quest RabbitMQ is now running on our server with SSL and using the LVC plugin the first of my status indication widgets seems to be working ... yummo ... thanks guys.

Looking at the code for the Producer/Consumer processes found something that I don't really like ... it aint hair tearing by any means just not 'nice'.

When a LVC consumer is defined it needs to do a 'exchange_declare' but it needs to declare the exchange paramaters which is sub-optimal. A consumer should be able to use just the exchange name to derive the linkage. It should never be creating it (if it aint there that's an error). Why I am concerned is that as I create consumers of exchanges I do not want to be bothered with the settings of the exchange so that the code that creates the exchange is the only one that needs to worry about the attributes.

Is there a way to acquire/specify the exchange 'read-only', without using the definition options that are in the 'exchange_declare()' method?

-- 
<? Larry >
Coding since 1973


From carl.hoerberg at gmail.com  Fri Jun 13 00:37:17 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 12 Jun 2014 16:37:17 -0700 (PDT)
Subject: [rabbitmq-discuss] {disk_free_limit, {mem_relative, 1.0}}
Message-ID: <1402616237245-36187.post@n5.nabble.com>

It doesn't seems like we're able to configure disk_free_limit with
{mem_relative, 1.0} (as described here:
http://www.rabbitmq.com/configure.html). The mgmt interface reports "(not
available)" and the sasl log reports: 


=CRASH REPORT==== 9-Jun-2014::15:17:09 ===
  crasher:
    initial call: rabbit_disk_monitor:init/1
    pid: <0.251.0>
    registered_name: []
    exception exit: {badarith,
                        [{rabbit_disk_monitor,interval,1,[]},
                         {rabbit_disk_monitor,start_timer,1,[]},
                         {rabbit_disk_monitor,init,1,[]},
                         {gen_server,init_it,6,
                             [{file,"gen_server.erl"},{line,306}]},
                         {proc_lib,init_p_do_apply,3,
                             [{file,"proc_lib.erl"},{line,239}]}]}
      in function  gen_server:init_it/6 (gen_server.erl, line 330)
    ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.96.0>]
    messages: []
    links: [<0.250.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 6772
    stack_size: 27
    reductions: 40670
  neighbours:

=SUPERVISOR REPORT==== 9-Jun-2014::15:17:09 ===
     Supervisor: {local,rabbit_disk_monitor_sup}
     Context:    start_error
     Reason:     {badarith,
                     [{rabbit_disk_monitor,interval,1,[]},
                      {rabbit_disk_monitor,start_timer,1,[]},
                      {rabbit_disk_monitor,init,1,[]},
                      {gen_server,init_it,6,
                          [{file,"gen_server.erl"},{line,306}]},
                      {proc_lib,init_p_do_apply,3,
                          [{file,"proc_lib.erl"},{line,239}]}]}
     Offender:   [{pid,undefined},
                  {name,rabbit_disk_monitor},
                  {mfargs,
                     
{rabbit_disk_monitor,start_link,[{mem_relative,1.0}]}},
                  {restart_type,{transient,1}},
                  {shutdown,4294967295},
                  {child_type,worker}]




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/disk-free-limit-mem-relative-1-0-tp36187.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Jun 13 00:42:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 13 Jun 2014 03:42:02 +0400
Subject: [rabbitmq-discuss] Exchange consumer declaration
In-Reply-To: <539A3833.5090901@jenolan.org>
References: <24eddf98-270d-4ade-bd9b-718ef411e4e2@googlegroups.com>
 <etPan.5398c61a.74b0dc51.14b20@mercurio.local>
 <539981B7.9070400@rabbitmq.com> <539A3833.5090901@jenolan.org>
Message-ID: <etPan.539a3ae4.6b8b4567.8918@mercurio.local>

On 13 June 2014 at 03:33:09, Larry Lewis (rabbitmq at jenolan.org) wrote:
> > When a LVC consumer is defined it needs to do a 'exchange_declare'  
> but it needs to declare the exchange paramaters which is sub-optimal.  
> A consumer should be able to use just the exchange name to derive  
> the linkage. It should never be creating it (if it aint there that's  
> an error). Why I am concerned is that as I create consumers of exchanges  
> I do not want to be bothered with the settings of the exchange so  
> that the code that creates the exchange is the only one that needs  
> to worry about the attributes.
>  
> Is there a way to acquire/specify the exchange 'read-only',  
> without using the definition options that are in the 'exchange_declare()'  
> method?

The feature you want is called passive declare (set passive = true).
It results in a channel exception if the exchange does not exist and no-op
(success) ?if it does.

You can also use exchange name without declaring it first: if you are sure it's
there, simply pass it to queue.bind and similar methods.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From arunrao.seattle at gmail.com  Fri Jun 13 01:57:40 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Thu, 12 Jun 2014 17:57:40 -0700
Subject: [rabbitmq-discuss] {disk_free_limit, {mem_relative, 1.0}}
In-Reply-To: <1402616237245-36187.post@n5.nabble.com>
References: <1402616237245-36187.post@n5.nabble.com>
Message-ID: <CAEJg2GBHLOGO1E1rVRp+fP788EOYFP9btnedMDGrDUzGkoEJbw@mail.gmail.com>

The location of the parameter also matters, is your rabbitmq.config file
similar to this?

[
{rabbit, [
...
{disk_free_limit, {mem_relative,1.0}}
...
]}
].

Also setting this relative to memory sets really "low watermark". For
example, If you have 16G RAM and 100G Hard disk. Setting this relative to
RAM makes low watermark set at 16GB. This means that Publishers are blocked
when your available disk space approaches 84GB (100-16). So I set this
value to 0.1 and now publishers are not blocking in case of backup until
98.4 (100-1.6). HTH


On Thu, Jun 12, 2014 at 4:37 PM, carlhoerberg <carl.hoerberg at gmail.com>
wrote:

> It doesn't seems like we're able to configure disk_free_limit with
> {mem_relative, 1.0} (as described here:
> http://www.rabbitmq.com/configure.html). The mgmt interface reports "(not
> available)" and the sasl log reports:
>
>
> =CRASH REPORT==== 9-Jun-2014::15:17:09 ===
>   crasher:
>     initial call: rabbit_disk_monitor:init/1
>     pid: <0.251.0>
>     registered_name: []
>     exception exit: {badarith,
>                         [{rabbit_disk_monitor,interval,1,[]},
>                          {rabbit_disk_monitor,start_timer,1,[]},
>                          {rabbit_disk_monitor,init,1,[]},
>                          {gen_server,init_it,6,
>                              [{file,"gen_server.erl"},{line,306}]},
>                          {proc_lib,init_p_do_apply,3,
>                              [{file,"proc_lib.erl"},{line,239}]}]}
>       in function  gen_server:init_it/6 (gen_server.erl, line 330)
>     ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.96.0>]
>     messages: []
>     links: [<0.250.0>]
>     dictionary: []
>     trap_exit: false
>     status: running
>     heap_size: 6772
>     stack_size: 27
>     reductions: 40670
>   neighbours:
>
> =SUPERVISOR REPORT==== 9-Jun-2014::15:17:09 ===
>      Supervisor: {local,rabbit_disk_monitor_sup}
>      Context:    start_error
>      Reason:     {badarith,
>                      [{rabbit_disk_monitor,interval,1,[]},
>                       {rabbit_disk_monitor,start_timer,1,[]},
>                       {rabbit_disk_monitor,init,1,[]},
>                       {gen_server,init_it,6,
>                           [{file,"gen_server.erl"},{line,306}]},
>                       {proc_lib,init_p_do_apply,3,
>                           [{file,"proc_lib.erl"},{line,239}]}]}
>      Offender:   [{pid,undefined},
>                   {name,rabbit_disk_monitor},
>                   {mfargs,
>
> {rabbit_disk_monitor,start_link,[{mem_relative,1.0}]}},
>                   {restart_type,{transient,1}},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/disk-free-limit-mem-relative-1-0-tp36187.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140612/f4987372/attachment.html>

From carl.hoerberg at gmail.com  Fri Jun 13 03:51:02 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 12 Jun 2014 19:51:02 -0700 (PDT)
Subject: [rabbitmq-discuss] {disk_free_limit, {mem_relative, 1.0}}
In-Reply-To: <CAEJg2GBHLOGO1E1rVRp+fP788EOYFP9btnedMDGrDUzGkoEJbw@mail.gmail.com>
References: <1402616237245-36187.post@n5.nabble.com>
 <CAEJg2GBHLOGO1E1rVRp+fP788EOYFP9btnedMDGrDUzGkoEJbw@mail.gmail.com>
Message-ID: <6733EB823A13479CAB626758B8F46621@gmail.com>

yes, we do. setting an absolut number works. 
yes i know. 

rabbitmq 3.3.2, erlang 17 


On Friday 13 June 2014 at 09:00, Arun Rao [via RabbitMQ] wrote:

> The location of the parameter also matters, is your rabbitmq.config file similar to this?
> 
> [
> {rabbit, [
> ...
> {disk_free_limit, {mem_relative,1.0}}
> ...
> ]}
> ].
> 
> Also setting this relative to memory sets really "low watermark". For example, If you have 16G RAM and 100G Hard disk. Setting this relative to RAM makes low watermark set at 16GB. This means that Publishers are blocked when your available disk space approaches 84GB (100-16). So I set this value to 0.1 and now publishers are not blocking in case of backup until 98.4 (100-1.6). HTH 
> 
> 
> On Thu, Jun 12, 2014 at 4:37 PM, carlhoerberg <[hidden email] (/user/SendEmail.jtp?type=node&node=36189&i=0)> wrote:
> > It doesn't seems like we're able to configure disk_free_limit with
> > {mem_relative, 1.0} (as described here:
> > http://www.rabbitmq.com/configure.html). The mgmt interface reports "(not
> > available)" and the sasl log reports:
> > 
> > 
> > =CRASH REPORT==== 9-Jun-2014::15:17:09 ===
> > crasher:
> > initial call: rabbit_disk_monitor:init/1
> > pid: <0.251.0>
> > registered_name: []
> > exception exit: {badarith,
> > [{rabbit_disk_monitor,interval,1,[]},
> > {rabbit_disk_monitor,start_timer,1,[]},
> > {rabbit_disk_monitor,init,1,[]},
> > {gen_server,init_it,6,
> > [{file,"gen_server.erl"},{line,306}]},
> > {proc_lib,init_p_do_apply,3,
> > [{file,"proc_lib.erl"},{line,239}]}]}
> > in function gen_server:init_it/6 (gen_server.erl, line 330)
> > ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.96.0>]
> > messages: []
> > links: [<0.250.0>]
> > dictionary: []
> > trap_exit: false
> > status: running
> > heap_size: 6772
> > stack_size: 27
> > reductions: 40670
> > neighbours:
> > 
> > =SUPERVISOR REPORT==== 9-Jun-2014::15:17:09 ===
> > Supervisor: {local,rabbit_disk_monitor_sup}
> > Context: start_error
> > Reason: {badarith,
> > [{rabbit_disk_monitor,interval,1,[]},
> > {rabbit_disk_monitor,start_timer,1,[]},
> > {rabbit_disk_monitor,init,1,[]},
> > {gen_server,init_it,6,
> > [{file,"gen_server.erl"},{line,306}]},
> > {proc_lib,init_p_do_apply,3,
> > [{file,"proc_lib.erl"},{line,239}]}]}
> > Offender: [{pid,undefined},
> > {name,rabbit_disk_monitor},
> > {mfargs,
> > 
> > {rabbit_disk_monitor,start_link,[{mem_relative,1.0}]}},
> > {restart_type,{transient,1}},
> > {shutdown,4294967295},
> > {child_type,worker}]
> > 
> > 
> > 
> > 
> > --
> > View this message in context: http://rabbitmq.1065348.n5.nabble.com/disk-free-limit-mem-relative-1-0-tp36187.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com (http://Nabble.com).
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > [hidden email] (/user/SendEmail.jtp?type=node&node=36189&i=1)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=36189&i=2) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/disk-free-limit-mem-relative-1-0-tp36187p36189.html 
> To unsubscribe from {disk_free_limit, {mem_relative, 1.0}}, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=36187&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MzYxODd8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/disk-free-limit-mem-relative-1-0-tp36187p36190.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140612/4e3aacf8/attachment.html>

From paul.holyoake at googlemail.com  Fri Jun 13 08:40:10 2014
From: paul.holyoake at googlemail.com (Paul Holyoake)
Date: Fri, 13 Jun 2014 00:40:10 -0700 (PDT)
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
	to?!!
In-Reply-To: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
Message-ID: <d097aee5-b449-4294-9364-012f0c1be85d@googlegroups.com>

I've recently had a similar HA and scalability requirement. I couldn't find 
a perfect answer. I achieved HA through a network loadbalancer across a 
pair of clustered RabbitMQ nodes, with mirrored queues. If the NLB fails to 
connect on port 5672 of the primary it failsover to the secondary node. All 
queue data is available on this node due to the queue mirroring.

In order to achieve scalability my assumption is to logically partition the 
data messages and have over clusters to meet that requirement.

Would the NLB in round robin mode be viable and have the nodes effectively 
active/active?



On Thursday, June 12, 2014 5:47:30 PM UTC+1, Shadi Mari wrote:

> Hello,
>
> I am new to Rabbitmq, however i have built so many messaging solution on 
> top of other stacks..
>
> I am trying to leverage the capabilities of RabbitMQ in one of my 
> solutions where HA and high scalability  is a must; so far the better 
> option the came out of my research 
> is to use active/active cluster and mirrored queues in order to provide 
> HA, otherwise using active/standby where the queue lives on the node it was 
> created on, will not achieve HA requirement.
>
> On the other hand, this should be mixed a load balancer, where consumers 
> and publishers are connected to the cluster through in order to direct 
> consumers/publishers to a different node each time the connection takes 
> place.
>
> However, my understanding says that RabbiqMQ in the case of mirrored queue 
> will connect consumers and publishers to the master node which will not 
> help in distributing load across all nodes. I am not sure but it came to my 
> knowledge that SoundCloud uses the same approach!
>
> Is my understanding above correct? if Yes, then how do companies that uses 
> RabbitMQ and require HA and high scalability work it out.
>
> Thank you
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/ef261575/attachment.html>

From lettier.kevin at gmail.com  Fri Jun 13 09:52:41 2014
From: lettier.kevin at gmail.com (kevin lettier)
Date: Fri, 13 Jun 2014 10:52:41 +0200
Subject: [rabbitmq-discuss] Rabbitmq-management-exchange simple_test 541
	INTERNAL_ERROR
Message-ID: <CAFLu_aYHehib8XLuys4dCi=LChQ7Ryo6xcf4aGV0GM7AyWrLdw@mail.gmail.com>

Hi all,

I'm getting INTERNAL_ERROR when I'm running Rabbitmq-management-exchange
simple_test from my freshly cloned rabbitmq-public-umbrella repo.
I don't see anything inside test log file.

The simple_test outup is :

rabbit_exchange_type_management_test: simple_test (module
'rabbit_exchange_type_management_test')...*failed*
::{{shutdown,

{connection_closing,{server_initiated_close,541,<<"INTERNAL_ERROR">>}}},
 {gen_server,call,
     [<0.376.0>,
      {subscribe,

{'basic.consume',0,<<"amq.gen-oLyn5EMpJMlNvSMfgN9q"...>>,<<>>,false,
              true,false,false,[]},
          <0.356.0>},
      infinity]}}

Thanks,

k?vin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/29f89bd1/attachment.html>

From simon at rabbitmq.com  Fri Jun 13 10:00:27 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jun 2014 10:00:27 +0100
Subject: [rabbitmq-discuss] {disk_free_limit, {mem_relative, 1.0}}
In-Reply-To: <1402616237245-36187.post@n5.nabble.com>
References: <1402616237245-36187.post@n5.nabble.com>
Message-ID: <539ABDAB.1040001@rabbitmq.com>

On 13/06/2014 12:37AM, carlhoerberg wrote:
> It doesn't seems like we're able to configure disk_free_limit with
> {mem_relative, 1.0} (as described here:
> http://www.rabbitmq.com/configure.html). The mgmt interface reports "(not
> available)" and the sasl log reports:

Well, that's embarrassing. mem_relative has been broken since 3.2.0. 
It'll get fixed in 3.3.3 and I will kick our test suite.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 13 10:09:01 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jun 2014 10:09:01 +0100
Subject: [rabbitmq-discuss] Can't delete guest user..
In-Reply-To: <1402595947585-36182.post@n5.nabble.com>
References: <1402595947585-36182.post@n5.nabble.com>
Message-ID: <539ABFAD.5020705@rabbitmq.com>

On 12/06/2014 6:59PM, ranjitiyer wrote:
> When someone starts RabbitMQ I reset the node, start it, add a user and
> delete the guest user.

I think this is a race, you are trying to add or delete users before the 
node has finished starting.

I'll file a bug to make the resultant error message clearer.

You should investigate using 
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#wait in your tooling, 
so that you know when the server is completely started.

Cheers, Simon

> When I delete the guest user (rabbitmqctl delete_user
> guest) I always get this error. Not sure what it means. Read Simon's answer
> to a similar sounding question in which he said it's related to the
> resetting of the node.
>
> Deleting user "guest" ...
> Error: {noproc,{gen_server2,call,
>
> [worker_pool,{next_free,<5098.105.0>},infinity]}}
>
> Ranjit
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-guest-user-tp36182.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 13 10:20:58 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jun 2014 10:20:58 +0100
Subject: [rabbitmq-discuss] 3.3.x dynamic shovel, delivery-mode?
In-Reply-To: <CAKgmDnHRT7dW4g+UAV05ag=i1B7w8sW8+wtk42n77h72mDMqvg@mail.gmail.com>
References: <CAAK-HJcKg5Q0_t3+CQV7et+Lx_eZQ9cRwGaZZd9NwZZeYaEyiw@mail.gmail.com>
 <5399C74F.10706@rabbitmq.com>
 <CAKgmDnHRT7dW4g+UAV05ag=i1B7w8sW8+wtk42n77h72mDMqvg@mail.gmail.com>
Message-ID: <539AC27A.8030505@rabbitmq.com>

On 12/06/2014 5:19PM, Laing, Michael wrote:
> We will not be able to use dynamic shovels in our proxies and product
> clusters until we can set delivery_mode, in our case to 1 as we never
> persist messages in the core clusters.
>
> Actually we set user_id too.

Thanks, that's useful to know.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From lettier.kevin at gmail.com  Fri Jun 13 10:21:44 2014
From: lettier.kevin at gmail.com (kevin lettier)
Date: Fri, 13 Jun 2014 11:21:44 +0200
Subject: [rabbitmq-discuss] Rabbitmq-management-exchange simple_test 541
	INTERNAL_ERROR
In-Reply-To: <CAFLu_aYHehib8XLuys4dCi=LChQ7Ryo6xcf4aGV0GM7AyWrLdw@mail.gmail.com>
References: <CAFLu_aYHehib8XLuys4dCi=LChQ7Ryo6xcf4aGV0GM7AyWrLdw@mail.gmail.com>
Message-ID: <CAFLu_aag6fJeu1fi2ja5r+AAqgGucXFx0T92CX85QLKXMmsaog@mail.gmail.com>

I finally got an error report:


=INFO REPORT==== 13-Jun-2014::11:17:16 ===
Starting RabbitMQ %%VSN%% on Erlang R15B01
Copyright (C) 2007-2014 GoPivotal, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 13-Jun-2014::11:17:16 ===
node           : rabbit-test at ubuntu-kev
home dir       : /home/kevin
config file(s) : /etc/rabbitmq/rabbitmq.config (not found)
cookie hash    : uxgIQPxvM4w95ZRbie6WBw==
log            : /tmp/rabbitmq-test/log/rabbit-test.log
sasl log       : /tmp/rabbitmq-test/log/rabbit-test-sasl.log
database dir   : /tmp/rabbitmq-test/rabbit-test/rabbit-test

=INFO REPORT==== 13-Jun-2014::11:17:17 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 13-Jun-2014::11:17:18 ===
Memory limit set to 1581MB of 3954MB total.

=INFO REPORT==== 13-Jun-2014::11:17:18 ===
Disk free limit set to 50MB

=INFO REPORT==== 13-Jun-2014::11:17:18 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 13-Jun-2014::11:17:18 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 13-Jun-2014::11:17:18 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 13-Jun-2014::11:17:18 ===
Adding vhost '/'

=INFO REPORT==== 13-Jun-2014::11:17:19 ===
Creating user 'guest'

=INFO REPORT==== 13-Jun-2014::11:17:19 ===
Setting user tags for user 'guest' to [administrator]

=INFO REPORT==== 13-Jun-2014::11:17:19 ===
Setting permissions for 'guest' in '/' to '.*', '.*', '.*'

=INFO REPORT==== 13-Jun-2014::11:17:19 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 13-Jun-2014::11:17:19 ===
Management plugin started. Port: 15672

=INFO REPORT==== 13-Jun-2014::11:17:19 ===
Statistics database started.

=INFO REPORT==== 13-Jun-2014::11:17:19 ===
Server startup complete; 7 plugins started.
 * rabbitmq_management_exchange
 * rabbitmq_management
 * rabbitmq_management_agent
 * rabbitmq_web_dispatch
 * webmachine
 * mochiweb
 * amqp_client

=INFO REPORT==== 13-Jun-2014::11:17:19 ===
accepting AMQP connection <0.365.0> (127.0.0.1:50451 -> 127.0.0.1:5672)

=ERROR REPORT==== 13-Jun-2014::11:17:20 ===
** Generic server <0.381.0> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'basic.publish',0,<<"mgmt">>,
                                   <<"/overview?columns=rabbitmq_version">>,
                                   false,false},
                               {content,60,none,

<<6,32,16,191,125,176,62,75,116,247,104,23,

21,124,110,91,187,39,250,30,97,109,113,46,
                                     103,101,110,45,72,90,79,118,90,115,116,

112,100,74,107,115,56,113,53,73,90,113,78,
                                     101,75,119,3,71,69,84>>,
                                   rabbit_framing_amqp_0_9_1,[]},
                               flow}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.365.0>,
                            <0.379.0>,<0.365.0>,
                            <<"127.0.0.1:50451 -> 127.0.0.1:5672">>,
                            {lstate,<0.380.0>,false},
                            none,1,
                            {[],[]},
                            {user,<<"guest">>,
                                [administrator],
                                rabbit_auth_backend_internal,
                                {internal_user,<<"guest">>,

<<76,58,22,37,69,52,200,1,202,22,209,226,
                                      53,149,29,214,55,194,236,96>>,
                                    [administrator]}},
                            <<"/">>,<<"amq.gen-HZOvZstpdJks8q5IZqNeKw">>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {state,
                                {dict,0,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]}}},
                                erlang},
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            <0.370.0>,
                            {state,fine,5000,#Ref<0.0.0.1659>},
                            false,1,
                            {{0,nil},{0,nil}},
                            [],
                            {{0,nil},{0,nil}},
                            [{<<"publisher_confirms">>,bool,true},
                             {<<"exchange_exchange_bindings">>,bool,true},
                             {<<"basic.nack">>,bool,true},
                             {<<"consumer_cancel_notify">>,bool,true},
                             {<<"connection.blocked">>,bool,true},

{<<"authentication_failure_close">>,bool,true}],
                            none,0}
** Reason for termination ==
** {undef,
       [{rabbit_basic,delivery,
            [false,
             {basic_message,
                 {resource,<<"/">>,exchange,<<>>},
                 [<<"amq.gen-HZOvZstpdJks8q5IZqNeKw">>],
                 {content,60,
                     {'P_basic',<<"application/json">>,undefined,undefined,
                         undefined,undefined,

<<191,125,176,62,75,116,247,104,23,21,124,110,91,187,
                           39,250>>,
                         undefined,undefined,undefined,undefined,<<"200">>,
                         undefined,undefined,undefined},
                     none,none,
                     [<<"{\"rabbitmq_version\":\"%%VSN%%\"}">>]},
                 <<67,156,80,169,238,52,0,123,213,67,58,213,117,99,229,66>>,
                 false},
             undefined],
            []},
        {rabbit_exchange_type_management,handle_rpc,6,
            [{file,"src/rabbit_exchange_type_management.erl"},{line,86}]},
        {rabbit_exchange_type_management,'-route/2-lc$^0/1-0-',6,
            [{file,"src/rabbit_exchange_type_management.erl"},{line,55}]},
        {rabbit_exchange_type_management,route,2,
            [{file,"src/rabbit_exchange_type_management.erl"},{line,55}]},
        {rabbit_exchange,route1,3,
            [{file,"src/rabbit_exchange.erl"},{line,359}]},
        {rabbit_exchange,route,2,
            [{file,"src/rabbit_exchange.erl"},{line,352}]},
        {rabbit_channel,handle_method,3,
            [{file,"src/rabbit_channel.erl"},{line,696}]},
        {rabbit_channel,handle_cast,2,
            [{file,"src/rabbit_channel.erl"},{line,275}]}]}

=ERROR REPORT==== 13-Jun-2014::11:17:20 ===
AMQP connection <0.365.0> (running), channel 1 - error:
{undef,
    [{rabbit_basic,delivery,
         [false,
          {basic_message,
              {resource,<<"/">>,exchange,<<>>},
              [<<"amq.gen-HZOvZstpdJks8q5IZqNeKw">>],
              {content,60,
                  {'P_basic',<<"application/json">>,undefined,undefined,
                      undefined,undefined,

<<191,125,176,62,75,116,247,104,23,21,124,110,91,187,39,
                        250>>,
                      undefined,undefined,undefined,undefined,<<"200">>,
                      undefined,undefined,undefined},
                  none,none,
                  [<<"{\"rabbitmq_version\":\"%%VSN%%\"}">>]},
              <<67,156,80,169,238,52,0,123,213,67,58,213,117,99,229,66>>,
              false},
          undefined],
         []},
     {rabbit_exchange_type_management,handle_rpc,6,
         [{file,"src/rabbit_exchange_type_management.erl"},{line,86}]},
     {rabbit_exchange_type_management,'-route/2-lc$^0/1-0-',6,
         [{file,"src/rabbit_exchange_type_management.erl"},{line,55}]},
     {rabbit_exchange_type_management,route,2,
         [{file,"src/rabbit_exchange_type_management.erl"},{line,55}]},

{rabbit_exchange,route1,3,[{file,"src/rabbit_exchange.erl"},{line,359}]},

{rabbit_exchange,route,2,[{file,"src/rabbit_exchange.erl"},{line,352}]},
     {rabbit_channel,handle_method,3,
         [{file,"src/rabbit_channel.erl"},{line,696}]},
     {rabbit_channel,handle_cast,2,
         [{file,"src/rabbit_channel.erl"},{line,275}]}]}

=WARNING REPORT==== 13-Jun-2014::11:17:20 ===
Non-AMQP exit reason '{undef,
                       [{rabbit_basic,delivery,
                         [false,
                          {basic_message,
                           {resource,<<"/">>,exchange,<<>>},
                           [<<"amq.gen-HZOvZstpdJks8q5IZqNeKw">>],
                           {content,60,
                            {'P_basic',<<"application/json">>,undefined,
                             undefined,undefined,undefined,

<<191,125,176,62,75,116,247,104,23,21,124,110,91,
                               187,39,250>>,
                             undefined,undefined,undefined,undefined,
                             <<"200">>,undefined,undefined,undefined},
                            none,none,
                            [<<"{\"rabbitmq_version\":\"%%VSN%%\"}">>]},

<<67,156,80,169,238,52,0,123,213,67,58,213,117,99,
                             229,66>>,
                           false},
                          undefined],
                         []},
                        {rabbit_exchange_type_management,handle_rpc,6,
                         [{file,"src/rabbit_exchange_type_management.erl"},
                          {line,86}]},
                        {rabbit_exchange_type_management,
                         '-route/2-lc$^0/1-0-',6,
                         [{file,"src/rabbit_exchange_type_management.erl"},
                          {line,55}]},
                        {rabbit_exchange_type_management,route,2,
                         [{file,"src/rabbit_exchange_type_management.erl"},
                          {line,55}]},
                        {rabbit_exchange,route1,3,
                         [{file,"src/rabbit_exchange.erl"},{line,359}]},
                        {rabbit_exchange,route,2,
                         [{file,"src/rabbit_exchange.erl"},{line,352}]},
                        {rabbit_channel,handle_method,3,
                         [{file,"src/rabbit_channel.erl"},{line,696}]},
                        {rabbit_channel,handle_cast,2,
                         [{file,"src/rabbit_channel.erl"},{line,275}]}]}'

=WARNING REPORT==== 13-Jun-2014::11:17:20 ===
Connection (<0.360.0>) closing: received hard error {'connection.close',541,

<<"INTERNAL_ERROR">>,0,0} from server

=INFO REPORT==== 13-Jun-2014::11:17:20 ===
closing AMQP connection <0.365.0> (127.0.0.1:50451 -> 127.0.0.1:5672)

=INFO REPORT==== 13-Jun-2014::11:17:21 ===
stopped TCP Listener on [::]:5672


2014-06-13 10:52 GMT+02:00 kevin lettier <lettier.kevin at gmail.com>:

> Hi all,
>
> I'm getting INTERNAL_ERROR when I'm running Rabbitmq-management-exchange
> simple_test from my freshly cloned rabbitmq-public-umbrella repo.
> I don't see anything inside test log file.
>
> The simple_test outup is :
>
> rabbit_exchange_type_management_test: simple_test (module
> 'rabbit_exchange_type_management_test')...*failed*
> ::{{shutdown,
>
> {connection_closing,{server_initiated_close,541,<<"INTERNAL_ERROR">>}}},
>  {gen_server,call,
>      [<0.376.0>,
>       {subscribe,
>
> {'basic.consume',0,<<"amq.gen-oLyn5EMpJMlNvSMfgN9q"...>>,<<>>,false,
>               true,false,false,[]},
>           <0.356.0>},
>       infinity]}}
>
> Thanks,
>
> k?vin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/1492c918/attachment.html>

From simon at rabbitmq.com  Fri Jun 13 10:49:41 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jun 2014 10:49:41 +0100
Subject: [rabbitmq-discuss] Rabbitmq-management-exchange simple_test 541
 INTERNAL_ERROR
In-Reply-To: <CAFLu_aYHehib8XLuys4dCi=LChQ7Ryo6xcf4aGV0GM7AyWrLdw@mail.gmail.com>
References: <CAFLu_aYHehib8XLuys4dCi=LChQ7Ryo6xcf4aGV0GM7AyWrLdw@mail.gmail.com>
Message-ID: <539AC935.9030503@rabbitmq.com>

Damn, another plugin that wasn't updated for 3.3.x. Try again now.

Cheers, Simon

On 13/06/2014 9:52AM, kevin lettier wrote:
> Hi all,
>
> I'm getting INTERNAL_ERROR when I'm running Rabbitmq-management-exchange
> simple_test from my freshly cloned rabbitmq-public-umbrella repo.
> I don't see anything inside test log file.
>
> The simple_test outup is :
>
> rabbit_exchange_type_management_test: simple_test (module
> 'rabbit_exchange_type_management_test')...*failed*
> ::{{shutdown,
>
> {connection_closing,{server_initiated_close,541,<<"INTERNAL_ERROR">>}}},
>   {gen_server,call,
>       [<0.376.0>,
>        {subscribe,
>
> {'basic.consume',0,<<"amq.gen-oLyn5EMpJMlNvSMfgN9q"...>>,<<>>,false,
>                true,false,false,[]},
>            <0.356.0>},
>        infinity]}}
>
> Thanks,
>
> k?vin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From lettier.kevin at gmail.com  Fri Jun 13 11:04:31 2014
From: lettier.kevin at gmail.com (kevin lettier)
Date: Fri, 13 Jun 2014 12:04:31 +0200
Subject: [rabbitmq-discuss] Rabbitmq-management-exchange simple_test 541
	INTERNAL_ERROR
In-Reply-To: <539AC935.9030503@rabbitmq.com>
References: <CAFLu_aYHehib8XLuys4dCi=LChQ7Ryo6xcf4aGV0GM7AyWrLdw@mail.gmail.com>
 <539AC935.9030503@rabbitmq.com>
Message-ID: <CAFLu_aZDx_Eu6RY8eHzo957YgBpFm=AodMPZVYhT7GS7daLceg@mail.gmail.com>

Working like a charm, thanks a lot Simon !


2014-06-13 11:49 GMT+02:00 Simon MacMullen <simon at rabbitmq.com>:

> Damn, another plugin that wasn't updated for 3.3.x. Try again now.
>
> Cheers, Simon
>
>
> On 13/06/2014 9:52AM, kevin lettier wrote:
>
>> Hi all,
>>
>> I'm getting INTERNAL_ERROR when I'm running Rabbitmq-management-exchange
>> simple_test from my freshly cloned rabbitmq-public-umbrella repo.
>> I don't see anything inside test log file.
>>
>> The simple_test outup is :
>>
>> rabbit_exchange_type_management_test: simple_test (module
>> 'rabbit_exchange_type_management_test')...*failed*
>> ::{{shutdown,
>>
>> {connection_closing,{server_initiated_close,541,<<"INTERNAL_ERROR">>}}},
>>   {gen_server,call,
>>       [<0.376.0>,
>>        {subscribe,
>>
>> {'basic.consume',0,<<"amq.gen-oLyn5EMpJMlNvSMfgN9q"...>>,<<>>,false,
>>                true,false,false,[]},
>>            <0.356.0>},
>>        infinity]}}
>>
>> Thanks,
>>
>> k?vin
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/501f3f7e/attachment.html>

From guy.dillen at gmail.com  Fri Jun 13 12:45:29 2014
From: guy.dillen at gmail.com (Guy Dillen)
Date: Fri, 13 Jun 2014 13:45:29 +0200
Subject: [rabbitmq-discuss] |Spam| RabbitMQ and Raspberry Pi
Message-ID: <00b701cf86fc$fa80cf60$ef826e20$@gmail.com>

Hi,

 

I'm considering RabbitMQ message broker using on my Raspberry Pi (Home IoT
Gateway). I suppose RabbitMQ can be installed on a RPi, but is performance
acceptable on a RPi?

 

Thanks.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/58a67afc/attachment.html>

From mklishin at gopivotal.com  Fri Jun 13 12:57:13 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 13 Jun 2014 15:57:13 +0400
Subject: [rabbitmq-discuss] |Spam| RabbitMQ and Raspberry Pi
In-Reply-To: <00b701cf86fc$fa80cf60$ef826e20$@gmail.com>
References: <00b701cf86fc$fa80cf60$ef826e20$@gmail.com>
Message-ID: <etPan.539ae734.6b8b4567.1ed8@mercurio.local>



On 13 June 2014 at 15:47:46, Guy Dillen (guy.dillen at gmail.com) wrote:
> > I?m considering RabbitMQ message broker using on my Raspberry  
> Pi (Home IoT Gateway). I suppose RabbitMQ can be installed on  
> a RPi, but is performance acceptable on a RPi?

I remember seeing a 3 node cluster running on 3 Raspberry Pis.
It wasn't a production environment but I heard no complaints.

So I guess the answer is "depends on how we define acceptable, give
it a go" :)?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jun 13 13:08:46 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 13 Jun 2014 16:08:46 +0400
Subject: [rabbitmq-discuss] |Spam| RabbitMQ and Raspberry Pi
In-Reply-To: <00cf01cf86ff$73ec9260$5bc5b720$@gmail.com>
References: <00b701cf86fc$fa80cf60$ef826e20$@gmail.com>
 <etPan.539ae734.6b8b4567.1ed8@mercurio.local>
 <00cf01cf86ff$73ec9260$5bc5b720$@gmail.com>
Message-ID: <etPan.539ae9e9.643c9869.1ed8@mercurio.local>

+rabbitmq-discuss?

On 13 June 2014 at 16:03:14, Guy Dillen (guy.dillen at gmail.com) wrote:
> > One last question: do you know if RabbitMQ can be 'bridged' with  
> Microsoft Azure Service Bus?

You can develop an app that consumes from RabbitMQ queues using AMQP 0-9-1,
STOMP or MQTT, and publish them to ASB or any other broker. There is
no such tool built-in.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From andrei002 at gmail.com  Fri Jun 13 16:06:58 2014
From: andrei002 at gmail.com (Andrei A)
Date: Fri, 13 Jun 2014 08:06:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
	Client Certificates
Message-ID: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>

Hi everybody!

I have a small question regarding the Web-STOMP plugin:
I've noticed that on the plugin page it's stated that
"RabbitMQ-Web-Stomp is fully compatible with the RabbitMQ-STOMP plugin, 
with the exception of STOMP heartbeats."

Thus, I wanted to ask whether the Web-STOMP plugin supports "Authentication 
with SSL Client Certificates", as described in the corresponding section of 
the STOMP plugin description here http://www.rabbitmq.com/stomp.html

and if it does, which parameters should be specified in the 
rabbitmq.config,  as well as in the client JS code in order to enable 
authentication by a username specified in the Common Name field of the 
client certificate, instead of supplying the username/password in the 
client JS code.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/abd1a3db/attachment.html>

From ranjitiyer at gmail.com  Fri Jun 13 17:49:54 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Fri, 13 Jun 2014 09:49:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't delete guest user..
In-Reply-To: <539ABFAD.5020705@rabbitmq.com>
References: <1402595947585-36182.post@n5.nabble.com>
 <539ABFAD.5020705@rabbitmq.com>
Message-ID: <1402678194541-36205.post@n5.nabble.com>

Thanks Simon. That is consistent with what I observed as well. If I stepped
through my program in a debugger it would work fine, indicating that it was
a race condition. I put in a bunch of Sleep statements to make it work, but
I'll use wait as you suggest for a cleaner solution.

Thanks!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-guest-user-tp36182p36205.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Jun 13 18:20:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 13 Jun 2014 21:20:38 +0400
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
Message-ID: <etPan.539b3300.6b8b4567.50e9@mercurio.local>

?On 13 June 2014 at 20:36:57, Andrei A (andrei002 at gmail.com) wrote:
> > Thus, I wanted to ask whether the Web-STOMP plugin supports  
> "Authentication with SSL Client Certificates", as described  
> in the corresponding section of the STOMP plugin description  
> here http://www.rabbitmq.com/stomp.html

From [1]:

"In addition, encrypted connections are supported if SSL configuration parameters are provided in the ssl_config section"

1.?http://www.rabbitmq.com/web-stomp.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ktran0003 at gmail.com  Fri Jun 13 20:29:49 2014
From: ktran0003 at gmail.com (ktran0003 at gmail.com)
Date: Fri, 13 Jun 2014 12:29:49 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c examples - producer/consumer work
	queue not working ???
Message-ID: <f95625f9-6a02-4e29-a013-2551c7263d64@googlegroups.com>

I tried out the producer/consumer examples included in  rabbitmq-c as 
follows:
One producer and two consumers

In two separate terminal windows:  ./amqp_consumer localhost 5672
In one terminal window:  %./amqp_producer localhost 5672 1 6

Both consumers show:
6737 ms: Received 1 - 1 since last report (0 Hz)
6737 ms: Received 2 - 1 since last report (16949 Hz)
7739 ms: Received 3 - 1 since last report (0 Hz)
8737 ms: Received 4 - 1 since last report (1 Hz)
9738 ms: Received 5 - 1 since last report (0 Hz)
10737 ms: Received 6 - 1 since last report (1 Hz)

This is a surprise to me.  I thought the messages should be sent 
round-robin to both consumers (like the python example) so they would not 
receive everything like a fanout.
Do I miss something?  If this is the way it's supposed to work, how I 
change the code to make it work like a work queue?

Thanks,
-Kim




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/62dc14e0/attachment.html>

From mklishin at gopivotal.com  Fri Jun 13 20:39:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 13 Jun 2014 23:39:02 +0400
Subject: [rabbitmq-discuss] rabbitmq-c examples - producer/consumer work
 queue not working ???
In-Reply-To: <f95625f9-6a02-4e29-a013-2551c7263d64@googlegroups.com>
References: <f95625f9-6a02-4e29-a013-2551c7263d64@googlegroups.com>
Message-ID: <etPan.539b5372.643c9869.50e9@mercurio.local>

?On 13 June 2014 at 23:32:01, ktran0003 at gmail.com (ktran0003 at gmail.com) wrote:
> > This is a surprise to me. I thought the messages should be sent  
> round-robin to both consumers (like the python example) so they  
> would not receive everything like a fanout.
> Do I miss something? If this is the way it's supposed to work, how  
> I change the code to make it work like a work queue?

This example:
https://github.com/alanxz/rabbitmq-c/blob/master/examples/amqp_producer.c

uses a direct exchange that will deliver a message to multiple queues if multiple
queues were bound with the same routing key (queue names do not matter).

This tutorial:
http://www.rabbitmq.com/tutorials/tutorial-two-python.html

uses the default exchange which all queues are bound to automatically
with routing key = queue name. because 2 queues cannot have the same name,
we cannot get into the situation above.

So make sure the example you use is equivalent to tutorial 2: uses basic.qos = 1 and default
exchange. Or bind queues to amq.direct with different routing keys (but it is
a needless complication for what tutorial 2 covers).

See?http://www.rabbitmq.com/tutorials/amqp-concepts.html if something isn't clear.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From alan.antonuk at gmail.com  Fri Jun 13 20:51:41 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 13 Jun 2014 19:51:41 +0000
Subject: [rabbitmq-discuss] rabbitmq-c examples - producer/consumer work
 queue not working ???
References: <f95625f9-6a02-4e29-a013-2551c7263d64@googlegroups.com>
Message-ID: <CAAt2poJuodE0f_mS78wg8ssUFm-ggt9OfNOn1atxg_w7nMEHJg@mail.gmail.com>

The amqp_consume example sets no_ack = 1, so the broker sends messages to
consumers as fast as possible without waiting for any acknowledgement from
clients.

To make it work more like a work-queue, you'd need to set no_ack = 0,
requiring the consumer to send a basic.ack (amqp_basic_ack). In addition
you'll also need to set a qos (using amqp_basic_qos) which will limit the
number of unacked messages that each consumer can have. (to be pedantic -
the qos parameter is per-channel: see:
http://www.rabbitmq.com/consumer-prefetch.html )

-Alan

On Fri Jun 13 2014 at 12:30:38 PM, <ktran0003 at gmail.com> wrote:

> I tried out the producer/consumer examples included in  rabbitmq-c as
> follows:
> One producer and two consumers
>
> In two separate terminal windows:  ./amqp_consumer localhost 5672
> In one terminal window:  %./amqp_producer localhost 5672 1 6
>
> Both consumers show:
> 6737 ms: Received 1 - 1 since last report (0 Hz)
> 6737 ms: Received 2 - 1 since last report (16949 Hz)
> 7739 ms: Received 3 - 1 since last report (0 Hz)
> 8737 ms: Received 4 - 1 since last report (1 Hz)
> 9738 ms: Received 5 - 1 since last report (0 Hz)
> 10737 ms: Received 6 - 1 since last report (1 Hz)
>
> This is a surprise to me.  I thought the messages should be sent
> round-robin to both consumers (like the python example) so they would not
> receive everything like a fanout.
> Do I miss something?  If this is the way it's supposed to work, how I
> change the code to make it work like a work queue?
>
> Thanks,
> -Kim
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/59fd4aff/attachment.html>

From mcintoshj at gmail.com  Fri Jun 13 21:39:04 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 13 Jun 2014 15:39:04 -0500
Subject: [rabbitmq-discuss] 3.3.x dynamic shovel, delivery-mode?
In-Reply-To: <539AC27A.8030505@rabbitmq.com>
References: <CAAK-HJcKg5Q0_t3+CQV7et+Lx_eZQ9cRwGaZZd9NwZZeYaEyiw@mail.gmail.com>
 <5399C74F.10706@rabbitmq.com>
 <CAKgmDnHRT7dW4g+UAV05ag=i1B7w8sW8+wtk42n77h72mDMqvg@mail.gmail.com>
 <539AC27A.8030505@rabbitmq.com>
Message-ID: <CAD6m6fF2ZCtRdQYz1huWKNcvpv3+CA8uCg4ETAZ++NAVWGOyOg@mail.gmail.com>

We also set the following in our shovels.  Looking at the dynamic support,
some of these appear to be able to be set.

delivery_mode - we override right now as well but I'm probably going to
disable this and let whatever originally was published just go through.
Course, looks like Michael needs this

reconnect_delay - we set to 30 seconds (default seems to be 5) as we were
getting spammed during data center disconnects with the shorter retries.
 It appears configuring this dynamically is supported from what I can tell
of the source code.
prefetch_count - we set this to 1500 which seemed to be a pretty decent
number for our systems.  If I'm looking at the right setting (the
rabbitmq_shovel.app.src) this is defaulted to 1000.

headers (currently) - we set a source on a header specifying where the
message came from.  Because though that overrides any message published
headers, we're looking to use the cluster_id property instead.  Though,
just digging through the source, I see "AddHeaders" from
<<"add-forward-headers">>.  Looks like the dynamic shovel finally adds that
support without replacing existing headers!  Sadly, it's not in the static
shovel :(  I may play with adding this myself for some erlang programming
learning.






On Fri, Jun 13, 2014 at 4:20 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 12/06/2014 5:19PM, Laing, Michael wrote:
>
>> We will not be able to use dynamic shovels in our proxies and product
>> clusters until we can set delivery_mode, in our case to 1 as we never
>> persist messages in the core clusters.
>>
>> Actually we set user_id too.
>>
>
> Thanks, that's useful to know.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/9f658595/attachment.html>

From mcintoshj at gmail.com  Fri Jun 13 22:00:49 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 13 Jun 2014 16:00:49 -0500
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
	to?!!
In-Reply-To: <d097aee5-b449-4294-9364-012f0c1be85d@googlegroups.com>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
 <d097aee5-b449-4294-9364-012f0c1be85d@googlegroups.com>
Message-ID: <CAD6m6fHpFR=qdgKttv2uF7rmBLeTbUn8AYnJVAHFsMce6WKMgw@mail.gmail.com>

Paul:

You'll get load balanced connections this way to the cluster.  But queues
are 'mastered' on a single node in the cluster, and mirrored to other
nodes.  You can control somewhat which node the queues are mastered on.  If
you're declaring the queues in your publisher/consumer, then the queues are
mastered I believe on the connected node, so load balancing would get you
there.  For mirroring though, you can say build a 5 node cluster, mirror
your queue to 3 nodes, and then try and spread your queues out across the
nodes in such a way that allows growth.  You have redundancy x3, and the
ability to grow performance wise.  The biggest trick here is that your apps
may connect to a node that the queue isn't mastered on but it seems the
rabbit server (assuming it's not a master) acts as a proxy to the mastered
queue.  And you get pretty solid scalability/performance with such an
architecture.  At least, we have :)

Jason


On Fri, Jun 13, 2014 at 2:40 AM, Paul Holyoake <paul.holyoake at googlemail.com
> wrote:

> I've recently had a similar HA and scalability requirement. I couldn't
> find a perfect answer. I achieved HA through a network loadbalancer across
> a pair of clustered RabbitMQ nodes, with mirrored queues. If the NLB fails
> to connect on port 5672 of the primary it failsover to the secondary node.
> All queue data is available on this node due to the queue mirroring.
>
> In order to achieve scalability my assumption is to logically partition
> the data messages and have over clusters to meet that requirement.
>
> Would the NLB in round robin mode be viable and have the nodes effectively
> active/active?
>
>
>
> On Thursday, June 12, 2014 5:47:30 PM UTC+1, Shadi Mari wrote:
>
>> Hello,
>>
>> I am new to Rabbitmq, however i have built so many messaging solution on
>> top of other stacks..
>>
>> I am trying to leverage the capabilities of RabbitMQ in one of my
>> solutions where HA and high scalability  is a must; so far the better
>> option the came out of my research
>> is to use active/active cluster and mirrored queues in order to provide
>> HA, otherwise using active/standby where the queue lives on the node it was
>> created on, will not achieve HA requirement.
>>
>> On the other hand, this should be mixed a load balancer, where consumers
>> and publishers are connected to the cluster through in order to direct
>> consumers/publishers to a different node each time the connection takes
>> place.
>>
>> However, my understanding says that RabbiqMQ in the case of mirrored
>> queue will connect consumers and publishers to the master node which will
>> not help in distributing load across all nodes. I am not sure but it came
>> to my knowledge that SoundCloud uses the same approach!
>>
>> Is my understanding above correct? if Yes, then how do companies that
>> uses RabbitMQ and require HA and high scalability work it out.
>>
>> Thank you
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140613/3021fc1b/attachment.html>

From ranjitiyer at gmail.com  Fri Jun 13 22:56:51 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Fri, 13 Jun 2014 14:56:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin ports
Message-ID: <1402696611456-36212.post@n5.nabble.com>

<http://rabbitmq.1065348.n5.nabble.com/file/n36212/mgt-port.jpg> 

I've configured the mgt plugin to start on 27274 because we want to lock
down other ports, but I still see 55672 show up. This might be legacy, but
is there a way to shut it down? What might be the consequences?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Management-plugin-ports-tp36212.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From andrei002 at gmail.com  Fri Jun 13 23:21:49 2014
From: andrei002 at gmail.com (Andrei)
Date: Sat, 14 Jun 2014 01:21:49 +0300
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <etPan.539b3300.6b8b4567.50e9@mercurio.local>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
 <etPan.539b3300.6b8b4567.50e9@mercurio.local>
Message-ID: <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>

Hi Michael,

Yes, I've seen that section in the Web-STOMP plugin description, however
I'm interested not so much in the possibility of establishing SSL
connections, which is clearly supported, as in using client certificate
data (e.g. CN field) as the username for authenticating into RabbitMQ. In
otherwords, the STOMP plugin has a config option which implements this that
looks like this:
{rabbitmq_stomp, [{ssl_cert_login, true}]}
The question is whether the Web-STOMP plugin also has an option like this,
i.e. something like:
{rabbitmq_web_stomp, [{ssl_cert_login, true}]}

Thanks!


On Fri, Jun 13, 2014 at 8:20 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 13 June 2014 at 20:36:57, Andrei A (andrei002 at gmail.com) wrote:
> > > Thus, I wanted to ask whether the Web-STOMP plugin supports
> > "Authentication with SSL Client Certificates", as described
> > in the corresponding section of the STOMP plugin description
> > here http://www.rabbitmq.com/stomp.html
>
> From [1]:
>
> "In addition, encrypted connections are supported if SSL configuration
> parameters are provided in the ssl_config section"
>
> 1. http://www.rabbitmq.com/web-stomp.html
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140614/64c8c589/attachment.html>

From mklishin at gopivotal.com  Fri Jun 13 23:26:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 14 Jun 2014 02:26:30 +0400
Subject: [rabbitmq-discuss] Management plugin ports
In-Reply-To: <1402696611456-36212.post@n5.nabble.com>
References: <1402696611456-36212.post@n5.nabble.com>
Message-ID: <etPan.539b7ab1.6b8b4567.83e5@mercurio.local>

?On 14 June 2014 at 01:58:08, ranjitiyer (ranjitiyer at gmail.com) wrote:
> > I've configured the mgt plugin to start on 27274 because we want  
> to lock
> down other ports, but I still see 55672 show up. This might be legacy,  
> but
> is there a way to shut it down? What might be the consequences?  

Add?{redirect_old_port,false} to your mgmt plugin config.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jun 13 23:28:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 14 Jun 2014 02:28:22 +0400
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
 <etPan.539b3300.6b8b4567.50e9@mercurio.local>
 <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>
Message-ID: <etPan.539b7b20.643c9869.83e5@mercurio.local>

On 14 June 2014 at 02:21:50, Andrei (andrei002 at gmail.com) wrote:
> > The question is whether the Web-STOMP plugin also has an option 
> like this, i.e. something like:
> {rabbitmq_web_stomp, [{ssl_cert_login, true}]}

No, it's not currently supported in Web-STOMP .
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From shadimari at gmail.com  Sun Jun 15 09:13:28 2014
From: shadimari at gmail.com (Shadi Mari)
Date: Sun, 15 Jun 2014 11:13:28 +0300
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
	to?!!
In-Reply-To: <etPan.5399efe2.74b0dc51.947@mercurio.local>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
 <etPan.5399eb3a.643c9869.947@mercurio.local>
 <CADsp-PUu+_Rrxbbjw1o6_M=GD=ODbx3NGCRfhjmecT6gQQJxbQ@mail.gmail.com>
 <etPan.5399efe2.74b0dc51.947@mercurio.local>
Message-ID: <CADsp-PWsKoL+6it4pO4-rR0M7COC=cvFJri+n0V8EfH4BSoo3g@mail.gmail.com>

Thanks for clarifying this Michael. I am trying to reflect what you have
said on my scenario...

Let's say i have two nodes N1 and N2, and one Queue that is mirrored, the
master and slave reside on N1 and N2 respectively; in such a case and as
based on what you have advised, there is no way to distribute consumers and
publishers load across two nodes because the same work will be done by the
two nodes; thus to rectify, load distribution manifests itself when we have
two or more mirrored queues distributes across 3 or more machines...

Is my assumption correct?

Thank you


On Thu, Jun 12, 2014 at 9:21 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 12 June 2014 at 22:18:27, Shadi Mari (shadimari at gmail.com) wrote:
> > > Does that mean that if i have two publishers declare the same
> > queue on different nodes of the cluster, i will end up having two
> > master queues and two slaves?
>
> queue.declare is idempotent. If you declare a queue that already exists
> with the same attributes, nothing happens. If the attributes differ, you
> get
> an error.
>
> > What is the right way and best practice to mix load balancing with
> > HA on RabbitMQ?
>
> "the right way" depends on what you do. Having a load balancer in front of
> a cluster to distribute queue masters is one technique. Not mirroring to
> all
> nodes in the cluster is another (2-3 nodes is often sufficient). Having
> your consumers connect to queue masters to avoid intra-cluster traffic
> (you can infer queue masters from queue info over HTTP API) will
> increase throughput.
>
> The goal is to spread queue masters between nodes and improve data
> locality.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140615/ab4533c7/attachment.html>

From mklishin at gopivotal.com  Sun Jun 15 13:56:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 15 Jun 2014 16:56:02 +0400
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
 to?!!
In-Reply-To: <CADsp-PWsKoL+6it4pO4-rR0M7COC=cvFJri+n0V8EfH4BSoo3g@mail.gmail.com>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
 <etPan.5399eb3a.643c9869.947@mercurio.local>
 <CADsp-PUu+_Rrxbbjw1o6_M=GD=ODbx3NGCRfhjmecT6gQQJxbQ@mail.gmail.com>
 <etPan.5399efe2.74b0dc51.947@mercurio.local>
 <CADsp-PWsKoL+6it4pO4-rR0M7COC=cvFJri+n0V8EfH4BSoo3g@mail.gmail.com>
Message-ID: <etPan.539d97fd.6b8b4567.156da@mercurio.local>


?On 15 June 2014 at 12:13:28, Shadi Mari (shadimari at gmail.com) wrote:
> > Let's say i have two nodes N1 and N2, and one Queue that is mirrored,  
> the master and slave reside on N1 and N2 respectively; in such  
> a case and as based on what you have advised, there is no way to distribute  
> consumers and publishers load across two nodes because the same  
> work will be done by the two nodes; thus to rectify, load distribution  
> manifests itself when we have two or more mirrored queues distributes  
> across 3 or more machines...
>  
> Is my assumption correct?

It is. A single giant queue is problematic in other ways, too, so avoid this
scenario.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From shadimari at gmail.com  Sun Jun 15 14:13:32 2014
From: shadimari at gmail.com (Shadi Mari)
Date: Sun, 15 Jun 2014 16:13:32 +0300
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
	to?!!
In-Reply-To: <etPan.539d97fd.6b8b4567.156da@mercurio.local>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
 <etPan.5399eb3a.643c9869.947@mercurio.local>
 <CADsp-PUu+_Rrxbbjw1o6_M=GD=ODbx3NGCRfhjmecT6gQQJxbQ@mail.gmail.com>
 <etPan.5399efe2.74b0dc51.947@mercurio.local>
 <CADsp-PWsKoL+6it4pO4-rR0M7COC=cvFJri+n0V8EfH4BSoo3g@mail.gmail.com>
 <etPan.539d97fd.6b8b4567.156da@mercurio.local>
Message-ID: <CADsp-PUU--7uuZ7fxJVtu=0kJ5QEO7C_rqgRg1t-5QEzvm=5Pg@mail.gmail.com>

Sounds great!

One more thing i was not lucky enough to find is to explore various
performance benchmarks were done against several rabbitmq deployments that
will me to size a rabbitmq solution.

For instance what would require to achieve 15K+ msgs/second? given that i
have multiple publishers and consumers on the same queue and the queue
content is draining (i.e.. no accumulation)? do i need to have an SSD to
increase throughput or SATA will be enough?

Thanks


On Sun, Jun 15, 2014 at 3:56 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>
>  On 15 June 2014 at 12:13:28, Shadi Mari (shadimari at gmail.com) wrote:
> > > Let's say i have two nodes N1 and N2, and one Queue that is mirrored,
> > the master and slave reside on N1 and N2 respectively; in such
> > a case and as based on what you have advised, there is no way to
> distribute
> > consumers and publishers load across two nodes because the same
> > work will be done by the two nodes; thus to rectify, load distribution
> > manifests itself when we have two or more mirrored queues distributes
> > across 3 or more machines...
> >
> > Is my assumption correct?
>
> It is. A single giant queue is problematic in other ways, too, so avoid
> this
> scenario.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140615/ec6fbd67/attachment.html>

From real.recipient at hotmail.com  Sun Jun 15 19:12:12 2014
From: real.recipient at hotmail.com (Mailinglist Recipient)
Date: Sun, 15 Jun 2014 20:12:12 +0200
Subject: [rabbitmq-discuss] erlang: shared direct connection
Message-ID: <DUB127-W70943F6E6516C2BBB59AE480170@phx.gbl>

Hi everybody,
I have a bunch of erlang processes (in RMQ plugin) and lot of them (tens) uses direct connection to RMQ. Now I want to consider single shared direct connection (in a dedicated gen_server) with many channels for individual processes. According to list of AMQP errors on connection level I would say very few of them can happen using direct erlang connection (if any). This way I would not need to handle connecting and handling connection fails again and again.
Is it a reasonable way or should i stay with many individual direct connections? Thanks for help.

regards
Marek

 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140615/f1bf95f2/attachment.html>

From mklishin at gopivotal.com  Sun Jun 15 23:04:36 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 16 Jun 2014 02:04:36 +0400
Subject: [rabbitmq-discuss] High Scalability and High Availability...How
 to?!!
In-Reply-To: <CADsp-PUU--7uuZ7fxJVtu=0kJ5QEO7C_rqgRg1t-5QEzvm=5Pg@mail.gmail.com>
References: <139812c6-a4a3-4040-869f-f522f2cecffe@googlegroups.com>
 <etPan.5399eb3a.643c9869.947@mercurio.local>
 <CADsp-PUu+_Rrxbbjw1o6_M=GD=ODbx3NGCRfhjmecT6gQQJxbQ@mail.gmail.com>
 <etPan.5399efe2.74b0dc51.947@mercurio.local>
 <CADsp-PWsKoL+6it4pO4-rR0M7COC=cvFJri+n0V8EfH4BSoo3g@mail.gmail.com>
 <etPan.539d97fd.6b8b4567.156da@mercurio.local>
 <CADsp-PUU--7uuZ7fxJVtu=0kJ5QEO7C_rqgRg1t-5QEzvm=5Pg@mail.gmail.com>
Message-ID: <etPan.539e188d.6b8b4567.17785@mercurio.local>

On 15 June 2014 at 17:15:48, Shadi Mari (shadimari at gmail.com) wrote:
> > For instance what would require to achieve 15K+ msgs/second?  
> given that i have multiple publishers and consumers on the same  
> queue and the queue content is draining (i.e.. no accumulation)?  
> do i need to have an SSD to increase throughput or SATA will be enough?  

It depends on message size and if messages are published as persistent
but with commonly small messages (<= 1Kb), 15K/second
can be achieved with a single node, a single queue, and ?modest hardware.

You likely won't need an SSD, and SSD won't make any difference if you publish
messages as transient.

But don't take my word for it, run your own benchmarks. There is a tool
for that:?http://www.rabbitmq.com/java-tools.html

(and a couple of alternatives on GitHub, too)
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Sun Jun 15 23:06:31 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 16 Jun 2014 02:06:31 +0400
Subject: [rabbitmq-discuss] erlang: shared direct connection
In-Reply-To: <DUB127-W70943F6E6516C2BBB59AE480170@phx.gbl>
References: <DUB127-W70943F6E6516C2BBB59AE480170@phx.gbl>
Message-ID: <etPan.539e1904.643c9869.17785@mercurio.local>

On 15 June 2014 at 22:13:31, Mailinglist Recipient (real.recipient at hotmail.com) wrote:
> > According to list of AMQP errors on connection level I would  
> say very few of them can happen using direct erlang connection  
> (if any).

If you share a connection + channel between publishing processes, you can (and will)
get incorrect frame interleaving, which is a connection-level error.

> This way I would not need to handle connecting and handling  
> connection fails again and again.
> Is it a reasonable way or should i stay with many individual direct  
> connections? Thanks for help.

1 channel per process sounds like a good plan.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From DeepNightTwo at gmail.com  Mon Jun 16 03:43:23 2014
From: DeepNightTwo at gmail.com (DeepNightTwo)
Date: Sun, 15 Jun 2014 19:43:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Is DeliveryTag unique for every rabbitmq message?
Message-ID: <1402886603428-36226.post@n5.nabble.com>

The system stores rabbitmq messages into MySQL table. Is DeliveryTag unique
for every message? If so , it can be used as Primary Key for the table. 


DeliveryTag is retrieved by "long ackId =
delivery.getEnvelope().getDeliveryTag();"




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Is-DeliveryTag-unique-for-every-rabbitmq-message-tp36226.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Jun 16 03:55:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 16 Jun 2014 06:55:02 +0400
Subject: [rabbitmq-discuss] Is DeliveryTag unique for every rabbitmq
 message?
In-Reply-To: <1402886603428-36226.post@n5.nabble.com>
References: <1402886603428-36226.post@n5.nabble.com>
Message-ID: <etPan.539e5ca1.19495cff.17785@mercurio.local>



On 16 June 2014 at 06:44:33, DeepNightTwo (deepnighttwo at gmail.com) wrote:
> > The system stores rabbitmq messages into MySQL table. Is DeliveryTag  
> unique
> for every message? If so , it can be used as Primary Key for the table.  
> DeliveryTag is retrieved by "long ackId =
> delivery.getEnvelope().getDeliveryTag();"

delivery tags are scoped by channel. If a channel with id = N is closed
and then opened again, it is considered to be a completely new channel.

So no, you cannot use delivery tags to identify messages, you apps need
to generate identifiers instead.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From jharna.sharma at aricent.com  Mon Jun 16 09:24:41 2014
From: jharna.sharma at aricent.com (Jharna Sharma)
Date: Mon, 16 Jun 2014 13:54:41 +0530
Subject: [rabbitmq-discuss] rabbitmqadmin fails when trying to get
 message from a queue
Message-ID: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE7632E@GUREXMB01.ASIAN.AD.ARICENT.COM>

the following command:
rabbitmqadmin get queue=test requeue=false

returns this error message
*** {u'key_missing': u'encoding'}

What is the solution to this problem..??

And does fetching messages like this will delete them from the queue..??

Please reply,
Thanks....


"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/48dc691d/attachment.html>

From simon at rabbitmq.com  Mon Jun 16 10:29:23 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Jun 2014 10:29:23 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin fails when trying to get
 message from a queue
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE7632E@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE7632E@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <539EB8F3.5090608@rabbitmq.com>

On 16/06/2014 9:24AM, Jharna Sharma wrote:
> returns this error message
>
> *** {u'key_missing': u'encoding'}
>
> What is the solution to this problem..??

That's a bug in ancient versions of rabbitmqadmin. You need to use 
rabbitmqadmin from RabbitMQ 2.8.0 or later.

If you can't easily upgrade your server, you can get the latest 
rabbitmqadmin from:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/bin/rabbitmqadmin

Of course you'll need to specify --port 55672 when connecting to 2.x 
servers.

> And does fetching messages like this will delete them from the queue..??

Depends on the value of the "requeue" parameter.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 16 10:43:56 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Jun 2014 10:43:56 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin fails when trying to get
 message from a queue
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE7635F@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE7632E@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <539EB8F3.5090608@rabbitmq.com>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE7635F@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <539EBC5C.4040003@rabbitmq.com>

Please keep rabbitmq-discuss on CC.

On 16/06/2014 10:34AM, Jharna Sharma wrote:
> Thank you so much for replying..
> Can you please specify how it depends on "requeue" parameter..??

If requeue=false the messages will be delivered to rabbitmqadmin and 
acknowledged, so they're gone.

If requeue=true the messages will be delivered to rabbitmqadmin but not 
acknowledged, so they end up requeued afterwards.

> And how many messages can I get using "rabbitmqadmin get queue" command..??
> Basically I need to print all the messages of a queue...

You can specify how many times the API calls basic.get with the 'count' 
parameter. But all the messages will be marshalled in memory before 
delivering the HTTP response, so it's not a great idea to do this with 
very high 'count' parameters.

Cheers, Simon

> Please help...
>
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Monday, June 16, 2014 2:59 PM
> To: Discussions about RabbitMQ; Jharna Sharma
> Subject: Re: [rabbitmq-discuss] rabbitmqadmin fails when trying to get message from a queue
>
> On 16/06/2014 9:24AM, Jharna Sharma wrote:
>> returns this error message
>>
>> *** {u'key_missing': u'encoding'}
>>
>> What is the solution to this problem..??
>
> That's a bug in ancient versions of rabbitmqadmin. You need to use
> rabbitmqadmin from RabbitMQ 2.8.0 or later.
>
> If you can't easily upgrade your server, you can get the latest
> rabbitmqadmin from:
>
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/bin/rabbitmqadmin
>
> Of course you'll need to specify --port 55672 when connecting to 2.x
> servers.
>
>> And does fetching messages like this will delete them from the queue..??
>
> Depends on the value of the "requeue" parameter.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
>
> "DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jharna.sharma at aricent.com  Mon Jun 16 10:53:08 2014
From: jharna.sharma at aricent.com (Jharna Sharma)
Date: Mon, 16 Jun 2014 15:23:08 +0530
Subject: [rabbitmq-discuss] rabbitmqadmin fails when trying to get
 message from a queue
In-Reply-To: <539EBC5C.4040003@rabbitmq.com>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE7632E@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <539EB8F3.5090608@rabbitmq.com>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE7635F@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <539EBC5C.4040003@rabbitmq.com>
Message-ID: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE76375@GUREXMB01.ASIAN.AD.ARICENT.COM>

Ok, so is there any other command using which I can print all the messages in a particular queue/exchange..??

Thanks a lot for helping..!!!

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: Monday, June 16, 2014 3:14 PM
To: Jharna Sharma
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmqadmin fails when trying to get message from a queue

Please keep rabbitmq-discuss on CC.

On 16/06/2014 10:34AM, Jharna Sharma wrote:
> Thank you so much for replying..
> Can you please specify how it depends on "requeue" parameter..??

If requeue=false the messages will be delivered to rabbitmqadmin and
acknowledged, so they're gone.

If requeue=true the messages will be delivered to rabbitmqadmin but not
acknowledged, so they end up requeued afterwards.

> And how many messages can I get using "rabbitmqadmin get queue" command..??
> Basically I need to print all the messages of a queue...

You can specify how many times the API calls basic.get with the 'count'
parameter. But all the messages will be marshalled in memory before
delivering the HTTP response, so it's not a great idea to do this with
very high 'count' parameters.

Cheers, Simon

> Please help...
>
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Monday, June 16, 2014 2:59 PM
> To: Discussions about RabbitMQ; Jharna Sharma
> Subject: Re: [rabbitmq-discuss] rabbitmqadmin fails when trying to get message from a queue
>
> On 16/06/2014 9:24AM, Jharna Sharma wrote:
>> returns this error message
>>
>> *** {u'key_missing': u'encoding'}
>>
>> What is the solution to this problem..??
>
> That's a bug in ancient versions of rabbitmqadmin. You need to use
> rabbitmqadmin from RabbitMQ 2.8.0 or later.
>
> If you can't easily upgrade your server, you can get the latest
> rabbitmqadmin from:
>
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/bin/rabbitmqadmin
>
> Of course you'll need to specify --port 55672 when connecting to 2.x
> servers.
>
>> And does fetching messages like this will delete them from the queue..??
>
> Depends on the value of the "requeue" parameter.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
>
> "DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
>

--
Simon MacMullen
RabbitMQ, Pivotal


"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."

From shadimari at gmail.com  Mon Jun 16 14:02:24 2014
From: shadimari at gmail.com (Shadi Mari)
Date: Mon, 16 Jun 2014 06:02:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Multi-threaded and high load publishers -
 channels pool vs connections pool...
Message-ID: <a314938b-bc0a-41f7-915b-485e7bda44f4@googlegroups.com>

Hello,

I am wondering whether having multiple channels per connection or multiple 
connections and one channel is better to achieve better scalability for 
multi-threaded and high load publishers.

I am trying to circle publishers in a round-robin manner across channels or 
connections in order to minimize bottlenecks.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/eef8db6c/attachment.html>

From mklishin at gopivotal.com  Mon Jun 16 15:45:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 16 Jun 2014 18:45:24 +0400
Subject: [rabbitmq-discuss] Multi-threaded and high load publishers -
 channels pool vs connections pool...
In-Reply-To: <a314938b-bc0a-41f7-915b-485e7bda44f4@googlegroups.com>
References: <a314938b-bc0a-41f7-915b-485e7bda44f4@googlegroups.com>
Message-ID: <etPan.539f0322.41b71efb.17785@mercurio.local>



On 16 June 2014 at 17:04:36, Shadi Mari (shadimari at gmail.com) wrote:
> > I am wondering whether having multiple channels per connection 
> or multiple connections and one channel is better to achieve 
> better scalability for multi-threaded and high load publishers. 
> 
> I am trying to circle publishers in a round-robin manner across 
> channels or connections in order to minimize bottlenecks.

You cannot share channels between threads, you will get incorrect framing
(technically, frame interleaving) errors. Multiple connections unlikely
will make a difference and there is memory and socket overhead in using them.

So start with 1 channel per thread and measure in your own environment.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mr.wonglei at gmail.com  Mon Jun 16 16:36:30 2014
From: mr.wonglei at gmail.com (mr.wonglei at gmail.com)
Date: Mon, 16 Jun 2014 08:36:30 -0700 (PDT)
Subject: [rabbitmq-discuss] The RabbitMQ can't restart when upgraded version
	3.3.0
Message-ID: <b6989829-e842-4753-ba43-e7d9711a4bde@googlegroups.com>



Hi,

I upgraded RabbitMQ from version 3.2.4 to 3.3.0

And DID NOT start after ?1process.txt? has been.

Can anybody help me to resolve this issue? *PLEASE*.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/ed0b3e46/attachment.html>
-------------- next part --------------
do this by root

./rabbitmqctl stop_app
./rabbitmqctl forget_cluster_node rabbit at rac1
./rabbitmqctl reset

wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.3.0/rabbitmq-server-3.3.0.tar.gz

tar -zxvf rabbitmq-server-3.3.0.tar.gz

cd rabbitmq-server-3.3.0

make

TARGET_DIR=/usr/local/rabbitmq SBIN_DIR=/usr/local/rabbitmq/sbin  MAN_DIR=/usr/local/rabbitmq/man  DOC_DIR=/usr/local/rabbitmq/doc   DOC_INSTALL_DIR=/usr/local/rabbitmq/docinstall  make install



http://ip:15672  This website management page still displays version  3.2.4, 

ps -ef|grep rabbit    AND  kill -9 ***  

THEN ./rabbitmq-server start  get error
-------------- next part --------------
[root at rac1 sbin]# ./rabbitmq-server start

              RabbitMQ 3.3.0. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /var/log/rabbitmq/rabbit at rac1.log
  ######  ##        /var/log/rabbitmq/rabbit at rac1-sasl.log
  ##########
              Starting broker...

BOOT FAILED
===========

Error description:
   {could_not_start,rabbitmq_management,
    {{shutdown,
      {failed_to_start_child,rabbit_mgmt_sup,
       {'EXIT',
        {{shutdown,
          [{{'EXIT',
             {undef,
              [{rabbit,force_event_refresh,[],[]},
               {rabbit_mgmt_db,start_link,0,
                [{file,"rabbitmq-management/src/rabbit_mgmt_db.erl"},
                 {line,184}]},
               {supervisor2,do_start_child,2,
                [{file,"src/supervisor2.erl"},{line,420}]},
               {supervisor2,handle_start_child,2,
                [{file,"src/supervisor2.erl"},{line,798}]},
               {supervisor2,handle_call,3,
                [{file,"src/supervisor2.erl"},{line,501}]},
               {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
               {proc_lib,init_p_do_apply,3,
                [{file,"proc_lib.erl"},{line,239}]}]}},
            {child,undefined,rabbit_mgmt_db,
             {rabbit_mgmt_db,start_link,[]},
             permanent,4294967295,worker,
             [rabbit_mgmt_db]}}]},
         {gen_server2,call,[<0.309.0>,{init,<0.307.0>},infinity]}}}}},
     {rabbit_mgmt_app,start,[normal,[]]}}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at rac1.log
   /var/log/rabbitmq/rabbit at rac1-sasl.log

{"init terminating in do_boot",{rabbit,failure_during_boot,{could_not_start,rabbitmq_management,{{shutdown,{failed_to_start_child,rabbit_mgmt_sup,{'EXIT',{{shutdown,[{{'EXIT',{undef,[{rabbit,force_event_refresh,[],[]},{rabbit_mgmt_db,start_link,0,[{file,"rabbitmq-management/src/rabbit_mgmt_db.erl"},{line,184}]},{supervisor2,do_start_child,2,[{file,"src/supervisor2.erl"},{line,420}]},{supervisor2,handle_start_child,2,[{file,"src/supervisor2.erl"},{line,798}]},{supervisor2,handle_call,3,[{file,"src/supervisor2.erl"},{line,501}]},{gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{child,undefined,rabbit_mgmt_db,{rabbit_mgmt_db,start_link,[]},permanent,4294967295,worker,[rabbit_mgmt_db]}}]},{gen_server2,call,[<0.309.0>,{init,<0.307.0>},infinity]}}}}},{rabbit_mgmt_app,start,[normal,[]]}}}}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
[root at rac1 sbin]# 
-------------- next part --------------
[root at rac1 sbin]# ./rabbitmqctl status
Status of node rabbit at rac1 ...
Error: unable to connect to node rabbit at rac1: nodedown

DIAGNOSTICS
===========

attempted to contact: [rabbit at rac1]

rabbit at rac1:
  * rabbit seems not to be running at all
  * no other nodes on rac1

current node details:
- node name: rabbitmqctl11562 at rac1
- home dir: /root
- cookie hash: D2upmGOjCEUC+ArxVf/C1w==

[root at rac1 sbin]# ./rabbitmqctl cluster_status
Cluster status of node rabbit at rac1 ...
Error: unable to connect to node rabbit at rac1: nodedown

DIAGNOSTICS
===========

attempted to contact: [rabbit at rac1]

rabbit at rac1:
  * rabbit seems not to be running at all
  * no other nodes on rac1

current node details:
- node name: rabbitmqctl11625 at rac1
- home dir: /root
- cookie hash: D2upmGOjCEUC+ArxVf/C1w==

[root at rac1 sbin]# 
-------------- next part --------------
[root at rac1 sbin]# cat /etc/issue
Red Hat Enterprise Linux Server release 5.7 (Tikanga)
Kernel \r on an \m

[root at rac1 sbin]# 


[root at rac1 sbin]# hostname
rac1
[root at rac1 sbin]# 


[root at rac1 sbin]#  cat /etc/hosts
# Do not remove the following line, or various programs
# that require network functionality will fail.
#127.0.0.1 localhost.localdomain rac1 
172.17.50.13 rac1
172.17.50.31 HTTEST1
172.17.50.33 rac2
172.17.50.13 localhost localhost.localdomain localhost
[root at rac1 sbin]# 


----------- cookie ------------
[root at rac1 sbin]# cat /root/.erlang.cookie
QVAZLGVDXUACPZHPOFUA
[root at rac1 sbin]# 


[root at rac2 /]# cat /root/.erlang.cookie
QVAZLGVDXUACPZHPOFUA
[root at rac2 /]# 


[root at HTTEST1 /]# cat /root/.erlang.cookie
QVAZLGVDXUACPZHPOFUA
[root at HTTEST1 /]# 



[root at rac1 sbin]# ./rabbitmqctl -n rabbit at rac1 cluster_status
Cluster status of node rabbit at rac1 ...
Error: unable to connect to node rabbit at rac1: nodedown

DIAGNOSTICS
===========

attempted to contact: [rabbit at rac1]

rabbit at rac1:
  * rabbit seems not to be running at all
  * no other nodes on rac1

current node details:
- node name: rabbitmqctl12464 at rac1
- home dir: /root
- cookie hash: D2upmGOjCEUC+ArxVf/C1w==

[root at rac1 sbin]# 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at rac1.log
Type: application/octet-stream
Size: 9466 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/ed0b3e46/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at rac1-sasl.log
Type: application/octet-stream
Size: 6506 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/ed0b3e46/attachment-0001.obj>

From simon at rabbitmq.com  Mon Jun 16 18:11:45 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Jun 2014 18:11:45 +0100
Subject: [rabbitmq-discuss] The RabbitMQ can't restart when upgraded
 version 3.3.0
In-Reply-To: <b6989829-e842-4753-ba43-e7d9711a4bde@googlegroups.com>
References: <b6989829-e842-4753-ba43-e7d9711a4bde@googlegroups.com>
Message-ID: <539F2551.7040002@rabbitmq.com>

On 16/06/2014 4:36PM, mr.wonglei at gmail.com wrote:
> I upgraded RabbitMQ from version 3.2.4 to 3.3.0
>
> And DID NOT start after ?1process.txt? has been.

I confess to not fully understanding your upgrade process. But this:

>              {undef,
>               [{rabbit,force_event_refresh,[],[]},

is telling me that you somehow have ended up with 3.2.x plugins (or at 
least the management plugin) and a 3.3.x broker.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From nick.stroh at icgsolutions.com  Mon Jun 16 20:32:55 2014
From: nick.stroh at icgsolutions.com (nick.stroh at icgsolutions.com)
Date: Mon, 16 Jun 2014 12:32:55 -0700 (PDT)
Subject: [rabbitmq-discuss] multicast without cycles?
Message-ID: <91725107-e9e0-4536-ac48-9e161fc0ebe8@googlegroups.com>

Hello, I'm new to AMQP.  What's the best way to implement a multicast 
topology with the following characteristics:

- Each node can broadcast messages to each other node, but does not receive 
its own messages. 
- Nodes can join or leave the topology dynamically 

Thanks. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/4e362d32/attachment.html>

From rhu at hearsaycorp.com  Mon Jun 16 21:57:33 2014
From: rhu at hearsaycorp.com (Roger Hu)
Date: Mon, 16 Jun 2014 13:57:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Race condition when acknowledging messages?
Message-ID: <1a645ad8-66a8-4bec-91a5-b4ba0d363e40@googlegroups.com>

We are running RabbitMQ v3.3.1 and librabbitmq v1.5.2 and have noticed that 
our client is periodically getting these exceptions:

ChannelError: channel error 406, message: PRECONDITION_FAILED - unknown 
delivery tag 704117

We have a dedicated separate connection and channel setup to receive the 
message and ack it back immediately.     We notice that the delivery tag of 
the same as the one we're
trying to acknowledge back, so this tag ID appears to be consistent and one 
that RMQ should know about.  However, it appears to trigger a 
PRECONDITION_FAILED, making us think
we made a duplicate ACK acknowledgment somewhere.  We have placed logging 
statements to centralize all message acknowledgments and only see one ACK, 
confirming our belief
that it is a single ACK being made.

We noticed in this code 
(https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_channel.erl#L741-750) 
that the record of the note being
sent is handled by the rabbit_writer process.

            ok = rabbit_writer:send_command(
                   WriterPid,
                   #'basic.get_ok'{delivery_tag  = DeliveryTag,
                                   redelivered   = Redelivered,
                                   exchange      = ExchangeName#resource.name,
                                   routing_key   = RoutingKey,
                                   message_count = MessageCount},
                   Content),
            State1 = monitor_delivering_queue(NoAck, QPid, QName, State),
            {noreply, record_sent(none, not(NoAck), Msg, State1)};


 However, the delivery tag information appears to get record later 
in https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_channel.erl#L1380-1384:

   true  -> queue:in({DeliveryTag, ConsumerTag, {QPid, MsgId}},
                                  UAMQ);


Our current workaround is to delay acknowledging the message instead of 
trying to ack it right away.  The problem shows up intermittently, possibly 
when there are large queue volumes on the RMQ box and possibly when we 
start to queue up 50-60K unacknowledged messages, which may cause issues 
for the delivery tag to be added to the unacked list (UAMQ).

Is it possible there is a race condition in which the delivery tag received 
by the client has yet to be recorded?    Again, the problem happens 
intermittently but would like to suggest changing the code to record the 
delivery tag (in record_sent() before dispatching rabbit_writer.  

Would appreciate any thoughts about changing the code to add the message 
before responding back to the writer.

Thanks,

Roger
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/e2a373e9/attachment.html>

From mklishin at gopivotal.com  Tue Jun 17 01:54:32 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 04:54:32 +0400
Subject: [rabbitmq-discuss] multicast without cycles?
In-Reply-To: <91725107-e9e0-4536-ac48-9e161fc0ebe8@googlegroups.com>
References: <91725107-e9e0-4536-ac48-9e161fc0ebe8@googlegroups.com>
Message-ID: <etPan.539f91e6.6b8b4567.b262@mercurio.local>

On 17 June 2014 at 04:28:22, nick.stroh at icgsolutions.com (nick.stroh at icgsolutions.com) wrote:
> > Hello, I'm new to AMQP. What's the best way to implement a multicast 
> topology with the following characteristics:
> 
> - Each node can broadcast messages to each other node, but does 
> not receive its own messages.
> - Nodes can join or leave the topology dynamically

The simplest (and most efficient/scalable for the # of consumers) solution may be
to use a fanout exchange with every consumer having its own (server-named, exclusive)
queue it binds to the exchange. Clients then would add a header ("owner") to
every message and ignore deliveries from itself.

Newly joined clients then can simply declare an exclusive queue, bind it and consume.
Should a client fail, the queue will be deleted by RabbitMQ (because of the "exclusive"
attribute).

A downside to using server-generated exclusive queues: peers cannot route messages to each
other individually&

HTH.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From ktran0003 at gmail.com  Tue Jun 17 02:01:42 2014
From: ktran0003 at gmail.com (ktran0003 at gmail.com)
Date: Mon, 16 Jun 2014 18:01:42 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c TTL setting not working for me -
	please help
Message-ID: <de6cd927-ff42-407f-98cc-80b6bd20db4e@googlegroups.com>

I set up a queue via amq.direct exchange with one producer and one consumer.
I used the following code to set up TTL for the consumer:

    amqp_table_t table;
    amqp_table_entry_t entry;
    entry.key = amqp_cstring_bytes("x-message-ttl");
    entry.value.kind = AMQP_FIELD_KIND_I16;
    entry.value.value.i16 = 2000;
    table.num_entries = 1;
    table.entries = &entry;
    amqp_queue_declare_ok_t *r = amqp_queue_declare(conn, 1, 
amqp_empty_bytes, 0, 0, 0,  table);

Then every time I consume a message, I sleep for 5 secs just to delay the 
consuming rate.
I also have the producer send a message every 1 sec.

However, when I run the producer to produce 20 messages, the consumer will 
get all 20 messages with 5 sec delay in between.
Should some messages not delivered because of TTL  < 5 sec delay?

Thanks,
-Kim


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/a7b787c8/attachment.html>

From mklishin at gopivotal.com  Tue Jun 17 02:07:36 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 05:07:36 +0400
Subject: [rabbitmq-discuss] rabbitmq-c TTL setting not working for me -
 please help
In-Reply-To: <de6cd927-ff42-407f-98cc-80b6bd20db4e@googlegroups.com>
References: <de6cd927-ff42-407f-98cc-80b6bd20db4e@googlegroups.com>
Message-ID: <etPan.539f94f2.643c9869.b262@mercurio.local>

On 17 June 2014 at 05:03:54, ktran0003 at gmail.com (ktran0003 at gmail.com) wrote:
> > Then every time I consume a message, I sleep for 5 secs just to  
> delay the consuming rate.
> I also have the producer send a message every 1 sec.
>  
> However, when I run the producer to produce 20 messages, the consumer  
> will get all 20 messages with 5 sec delay in between.
> Should some messages not delivered because of TTL < 5 sec delay?  

They should. Do you use the TTL attribute being set for queues in the management UI??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From gavinmroy at gmail.com  Tue Jun 17 04:47:52 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Mon, 16 Jun 2014 23:47:52 -0400
Subject: [rabbitmq-discuss] Plugin startup behavior issue
Message-ID: <etPan.539fba68.6b8b4567.102e9@gmr-home.local>

I?ve been running into a weird issue with the pgsql_listen_exchange plugin code that I?ve been trying to fix.

If you start a fresh RabbitMQ install with an empty database and the plugin enabled, it will exit due to a no_such_vhost error for <<?/?>> in the rabbit_error_log module start/0. Logs:

https://gist.github.com/gmr/b29e672db7d4423defd1

What is odd about it, is if the database is not empty, that is rabbitmq is started before enabling the plugin, everything works just fine. This seems to be consistent with the default branch as well as with 3.3.0+. I?ve not tried earlier versions of RabbitMQ.

It seems it probably has something to do with the rabbit_boot_step ordering of my plugin combined with some logging somewhere in combination to the initial creation of the rabbitmq mnesia database, but I?m at a loss as to what?s going on beyond that.

If I change the plugin to run later in the boot step ordering (i.e. have in come in after recover), it works fine for the initial load, but then if I declare an exchange, it is not loaded soon enough to be there for the exchange to be recovered on boot.

From digging through pretty much everything I could find with boot steps, it seems that I should be able to require rabbit_registry and enable recover for the proper behavior.

I also have two other modules with boot steps, one is a mirrored_supervisor that enables the exchange and requires kernel_ready and the other is a?rabbit_policy_validator that requires rabbit_registry and enables recovery.

Any pointers on how I can debug what condition my plugin is creating to cause this failure would be greatly appreciated.

Gavin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/b97fb82b/attachment.html>

From ankitsoni9 at gmail.com  Tue Jun 17 06:29:40 2014
From: ankitsoni9 at gmail.com (Ankit)
Date: Mon, 16 Jun 2014 22:29:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Sample use cases of rabbitmq?
Message-ID: <0278672d-07d6-4694-941c-22c951719a02@googlegroups.com>

Hello,

Could someone walk through or link to sample applications and use cases of 
rabbitmq? I want to build an app using rabbitMQ to get a better handle on 
how to use it but I dont see where something like this might be useful and 
I found very few case studies/examples through google.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140616/41aa9c3c/attachment.html>

From mklishin at gopivotal.com  Tue Jun 17 06:43:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 09:43:25 +0400
Subject: [rabbitmq-discuss] Sample use cases of rabbitmq?
In-Reply-To: <0278672d-07d6-4694-941c-22c951719a02@googlegroups.com>
References: <0278672d-07d6-4694-941c-22c951719a02@googlegroups.com>
Message-ID: <etPan.539fd59b.2ae8944a.b262@mercurio.local>

On 17 June 2014 at 09:31:52, Ankit (ankitsoni9 at gmail.com) wrote:
> > Could someone walk through or link to sample applications and  
> use cases of rabbitmq? I want to build an app using rabbitMQ to  
> get a better handle on how to use it but I dont see where something  
> like this might be useful and I found very few case studies/examples  
> through google.

Start with tutorials, they demonstrate fairly realistic scenarios:
http://www.rabbitmq.com/getstarted.html

RabbitMQ is used to connection applications (services, microservices), see
e.g.?http://developers.soundcloud.com/blog/building-products-at-soundcloud-part-1-dealing-with-the-monolith

Often this means background/asynchronous processing of tasks (projects like Celery, EasyNetQ, etc),
but by no means limited to that.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From jharna.sharma at aricent.com  Tue Jun 17 08:26:42 2014
From: jharna.sharma at aricent.com (Jharna Sharma)
Date: Tue, 17 Jun 2014 12:56:42 +0530
Subject: [rabbitmq-discuss] unit of message_stats.publish_details.rate
Message-ID: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE765AD@GUREXMB01.ASIAN.AD.ARICENT.COM>

$ rabbitmqadmin list queues vhost name node messages "message_stats.publish_details.rate"

This command gives output:

+-------+----------------------------------+-------------------+----------+------------------------------------+
| vhost |               name               |       node        | messages | message_stats.publish_details.rate |
+-------+----------------------------------+-------------------+----------+------------------------------------+
| /     | amq.gen-UELtxwb8OGJ9XHlHJq0Jug== | rabbit at smacmullen | 0        | 100.985821591                      |
| /     | test                             | rabbit at misstiny   | 5052     | 100.985821591                      |
+-------+----------------------------------+-------------------+----------+------------------------------------+


Can anyone please explain what is the unit of "message_stats.publish_details.rate" (last column) ??
Is it messages per sec or per hr or what..??

Also is there any other rate which can be checked by any command (parameter) like this..??

Please help....
thank you...


"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/5f13aec7/attachment.html>

From mklishin at gopivotal.com  Tue Jun 17 08:31:35 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 11:31:35 +0400
Subject: [rabbitmq-discuss] unit of message_stats.publish_details.rate
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE765AD@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE765AD@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <etPan.539feef5.3d1b58ba.b262@mercurio.local>

On 17 June 2014 at 11:30:19, Jharna Sharma (jharna.sharma at aricent.com) wrote:
> >
> Can anyone please explain what is the unit of ?message_stats.publish_details.rate?  
> (last column) ??
>  
>  
> Is it messages per sec or per hr or what..??

Per second.

> Also is there any other rate which can be checked by any command  
> (parameter) like this..??

I don't think the interval is configurable, no .
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue Jun 17 08:35:08 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 08:35:08 +0100
Subject: [rabbitmq-discuss] unit of message_stats.publish_details.rate
In-Reply-To: <etPan.539feef5.3d1b58ba.b262@mercurio.local>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EE765AD@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.539feef5.3d1b58ba.b262@mercurio.local>
Message-ID: <539FEFAC.5080008@rabbitmq.com>

On 17/06/2014 08:31, Michael Klishin wrote:
>> >Also is there any other rate which can be checked by any command
>> >(parameter) like this..??
> I don't think the interval is configurable, no .

You can use avg_rate over the sampling interval. See 
http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/priv/www/doc/stats.html

Cheers, Simon

From simon at rabbitmq.com  Tue Jun 17 08:37:32 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 08:37:32 +0100
Subject: [rabbitmq-discuss] Plugin startup behavior issue
In-Reply-To: <etPan.539fba68.6b8b4567.102e9@gmr-home.local>
References: <etPan.539fba68.6b8b4567.102e9@gmr-home.local>
Message-ID: <539FF03C.2030203@rabbitmq.com>

On 17/06/2014 04:47, Gavin M. Roy wrote:
> If you start a fresh RabbitMQ install with an empty database and the
> plugin enabled, it will exit due to a no_such_vhost error for <<?/?>> in
> the rabbit_error_log module start/0. Logs:

So the issue you have there is that rabbit_log does not work early in 
the boot process (before recovery) since it tries to log to an 
amq.rabbitmq.log exchange which is not there.

You need to use error_logger directly for log messages early in the boot 
process.

Cheers, Simon


From simon at rabbitmq.com  Tue Jun 17 09:22:38 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 09:22:38 +0100
Subject: [rabbitmq-discuss] Race condition when acknowledging messages?
In-Reply-To: <1a645ad8-66a8-4bec-91a5-b4ba0d363e40@googlegroups.com>
References: <1a645ad8-66a8-4bec-91a5-b4ba0d363e40@googlegroups.com>
Message-ID: <539FFACE.7090005@rabbitmq.com>

On 16/06/2014 21:57, Roger Hu wrote:
> We noticed in this code
> (https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_channel.erl#L741-750)
> that the record of the note being
> sent is handled by the rabbit_writer process.
>
> ok = rabbit_writer:send_command(
> WriterPid,
> #'basic.get_ok'{delivery_tag = DeliveryTag,
> redelivered = Redelivered,
> exchange = ExchangeName#resource.name,
> routing_key = RoutingKey,
> message_count = MessageCount},
> Content),
> State1 = monitor_delivering_queue(NoAck, QPid, QName, State),
> {noreply, record_sent(none, not(NoAck), Msg, State1)};
>
>
>   However, the delivery tag information appears to get record later
> in https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_channel.erl#L1380-1384:
>
> true -> queue:in({DeliveryTag, ConsumerTag, {QPid, MsgId}},
> UAMQ);

Yes.

> Is it possible there is a race condition in which the delivery tag
> received by the client has yet to be recorded?

But no. Not in any way that makes any difference, anyway.

The point is that the channel can deliver the message and then record 
the ack, because it won't respond to any further messages from the 
outside world until it has returned from handle_cast(), by which time 
the ack is recorded.

So I suspect that there is an issue in your code I'm afraid.

Cheers, Simon


From simon at rabbitmq.com  Tue Jun 17 09:35:27 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 09:35:27 +0100
Subject: [rabbitmq-discuss] The RabbitMQ can't restart when upgraded
 version 3.3.0
In-Reply-To: <CAKnVV8dGLgQ+iHM=1poL3kGO2RM4mPGqeO-2=3_mhob9YCi-Kg@mail.gmail.com>
References: <b6989829-e842-4753-ba43-e7d9711a4bde@googlegroups.com>	<539F2551.7040002@rabbitmq.com>
 <CAKnVV8dGLgQ+iHM=1poL3kGO2RM4mPGqeO-2=3_mhob9YCi-Kg@mail.gmail.com>
Message-ID: <539FFDCF.1040100@rabbitmq.com>

Please keep rabbitmq-discuss on CC.

So it sounds like you have two RabbitMQ installations on top of each 
other. Probably the easiest way forward is to remove /usr/local/rabbitmq 
and re-run "make install".

In general though we recommend use of OS-specific packages or the binary 
tarball, "make install" requires more fiddling to use correctly.

Cheers, Simon

On 16/06/2014 20:25, ?? wrote:
> *Thanks  for your reply. Just now re-run the 'make' ,'make install' and
> got the same error.*
> *What should I do?
> *
>
>         [root at rac1 sbin]# ./rabbitmq-server start
>
>
>                        RabbitMQ 3.3.0. Copyright (C) 2007-2013
>         GoPivotal, Inc.
>
>            ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>
>            ##  ##
>
>            ##########  Logs: /var/log/rabbitmq/rabbit at rac1.log
>
>            ######  ##        /var/log/rabbitmq/rabbit at rac1-sasl.log
>
>            ##########
>
>                        Starting broker...
>
>
>         BOOT FAILED
>
>         ===========
>
>
>         Error description:
>
>             {could_not_start,rabbitmq_management,
>
>              {{shutdown,
>
>                {failed_to_start_child,rabbit_mgmt_sup,
>
>                 {'EXIT',
>
>                  {{shutdown,
>
>                    [{{'EXIT',
>
>                       {undef,
>
>                        [{rabbit,force_event_refresh,[],[]},
>
>                         {rabbit_mgmt_db,start_link,0,
>
>
>         [{file,"rabbitmq-management/src/rabbit_mgmt_db.erl"},
>
>                           {line,184}]},
>
>                         {supervisor2,do_start_child,2,
>
>                          [{file,"src/supervisor2.erl"},{line,420}]},
>
>                         {supervisor2,handle_start_child,2,
>
>                          [{file,"src/supervisor2.erl"},{line,798}]},
>
>                         {supervisor2,handle_call,3,
>
>                          [{file,"src/supervisor2.erl"},{line,501}]},
>
>
>           {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
>
>                         {proc_lib,init_p_do_apply,3,
>
>                          [{file,"proc_lib.erl"},{line,239}]}]}},
>
>                      {child,undefined,rabbit_mgmt_db,
>
>                       {rabbit_mgmt_db,start_link,[]},
>
>                       permanent,4294967295,worker,
>
>                       [rabbit_mgmt_db]}}]},
>
>
>           {gen_server2,call,[<0.309.0>,{init,<0.307.0>},infinity]}}}}},
>
>               {rabbit_mgmt_app,start,[normal,[]]}}}
>
>
>         Log files (may contain more information):
>
>             /var/log/rabbitmq/rabbit at rac1.log
>
>             /var/log/rabbitmq/rabbit at rac1-sasl.log
>
>
>         {"init terminating in
>         do_boot",{rabbit,failure_during_boot,{could_not_start,rabbitmq_management,{{shutdown,{failed_to_start_child,rabbit_mgmt_sup,{'EXIT',{{shutdown,[{{'EXIT',{undef,[{rabbit,force_event_refresh,[],[]},{rabbit_mgmt_db,start_link,0,[{file,"rabbitmq-management/src/rabbit_mgmt_db.erl"},{line,184}]},{supervisor2,do_start_child,2,[{file,"src/supervisor2.erl"},{line,420}]},{supervisor2,handle_start_child,2,[{file,"src/supervisor2.erl"},{line,798}]},{supervisor2,handle_call,3,[{file,"src/supervisor2.erl"},{line,501}]},{gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{child,undefined,rabbit_mgmt_db,{rabbit_mgmt_db,start_link,[]},permanent,4294967295,worker,[rabbit_mgmt_db]}}]},{gen_server2,call,[<0.309.0>,{init,<0.307.0>},infinity]}}}}},{rabbit_mgmt_app,start,[normal,[]]}}}}}
>
>
>         Crash dump was written to: erl_crash.dump
>
>         init terminating in do_boot ()
>
>
>
> *plugins info *
>
>     [root at rac1 sbin]# ./rabbitmq-plugins list
>     [e] amqp_client                       3.2.4
>     [e] amqp_client                       3.3.0
>     [ ] cowboy                            0.5.0-rmq3.2.4-git4b93c2d
>     [ ] cowboy                            0.5.0-rmq3.3.0-git4b93c2d
>     [ ] eldap                             3.2.4-gite309de4
>     [ ] eldap                             3.3.0-gite309de4
>     [e] mochiweb                          2.7.0-rmq3.2.4-git680dba8
>     [e] mochiweb                          2.7.0-rmq3.3.0-git680dba8
>     [ ] rabbitmq_amqp1_0                  3.2.4
>     [ ] rabbitmq_amqp1_0                  3.3.0
>     [ ] rabbitmq_auth_backend_ldap        3.2.4
>     [ ] rabbitmq_auth_backend_ldap        3.3.0
>     [ ] rabbitmq_auth_mechanism_ssl       3.2.4
>     [ ] rabbitmq_auth_mechanism_ssl       3.3.0
>     [ ] rabbitmq_consistent_hash_exchange 3.2.4
>     [ ] rabbitmq_consistent_hash_exchange 3.3.0
>     [ ] rabbitmq_federation               3.2.4
>     [ ] rabbitmq_federation               3.3.0
>     [ ] rabbitmq_federation_management    3.2.4
>     [ ] rabbitmq_federation_management    3.3.0
>     [ ] rabbitmq_jsonrpc                  3.2.4
>     [ ] rabbitmq_jsonrpc_channel          3.2.4
>     [ ] rabbitmq_jsonrpc_channel_examples 3.2.4
>     [E] rabbitmq_management               3.2.4
>     [E] rabbitmq_management               3.3.0
>     [e] rabbitmq_management_agent         3.2.4
>     [e] rabbitmq_management_agent         3.3.0
>     [ ] rabbitmq_management_visualiser    3.2.4
>     [ ] rabbitmq_management_visualiser    3.3.0
>     [ ] rabbitmq_mqtt                     3.2.4
>     [ ] rabbitmq_mqtt                     3.3.0
>     [ ] rabbitmq_shovel                   3.2.4
>     [ ] rabbitmq_shovel                   3.3.0
>     [ ] rabbitmq_shovel_management        3.2.4
>     [ ] rabbitmq_shovel_management        3.3.0
>     [ ] rabbitmq_stomp                    3.2.4
>     [ ] rabbitmq_stomp                    3.3.0
>     [ ] rabbitmq_tracing                  3.2.4
>     [ ] rabbitmq_tracing                  3.3.0
>     [e] rabbitmq_web_dispatch             3.2.4
>     [e] rabbitmq_web_dispatch             3.3.0
>     [ ] rabbitmq_web_stomp                3.2.4
>     [ ] rabbitmq_web_stomp                3.3.0
>     [ ] rabbitmq_web_stomp_examples       3.2.4
>     [ ] rabbitmq_web_stomp_examples       3.3.0
>     [ ] rfc4627_jsonrpc                   3.2.4-git5e67120
>     [ ] sockjs                            0.3.4-rmq3.2.4-git3132eb9
>     [ ] sockjs                            0.3.4-rmq3.3.0-git3132eb9
>     [e] webmachine                        1.10.3-rmq3.2.4-gite9359c7
>     [e] webmachine                        1.10.3-rmq3.3.0-gite9359c7
>     [root at rac1 sbin]#
>
>
>
>
> 2014-06-17 1:11 GMT+08:00 Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>>:
>
>     On 16/06/2014 4:36PM, mr.wonglei at gmail.com
>     <mailto:mr.wonglei at gmail.com> wrote:
>
>         I upgraded RabbitMQ from version 3.2.4 to 3.3.0
>
>         And DID NOT start after ?1process.txt? has been.
>
>
>     I confess to not fully understanding your upgrade process. But this:
>
>                       {undef,
>                        [{rabbit,force_event_refresh,[__],[]},
>
>
>     is telling me that you somehow have ended up with 3.2.x plugins (or
>     at least the management plugin) and a 3.3.x broker.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


From Rohit.Patle at techmahindra.com  Tue Jun 17 09:59:16 2014
From: Rohit.Patle at techmahindra.com (Rohit Patle)
Date: Tue, 17 Jun 2014 08:59:16 +0000
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
Message-ID: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

While working with rabbitmq-c library version 0.4.1 and AMQP version 0-9-1, We came across scenario where, If there are two listeners in two different networks but having the same static ip (ex. 192.168.10.20), the listener receives the "AMQP_STATUS_SSL_ERROR" i.e -0x0200 at both the listeners periodically. Could you please spread some light to understand the behaviour of it?

Thanks & Regards,
Rohit

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/bd2db69a/attachment.html>

From mklishin at gopivotal.com  Tue Jun 17 10:08:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 13:08:07 +0400
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <etPan.53a00593.2eb141f2.b262@mercurio.local>

On 17 June 2014 at 13:01:44, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > If there are two listeners in two different networks but having  
> the same static ip (ex. 192.168.10.20), the listener receives  
> the "AMQP_STATUS_SSL_ERROR" i.e -0x0200 at both the listeners  
> periodically

Are you saying that a RabbitMQ node is reachable from 2 networks and 2 clients
have the same IP??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From youpingl at sina.com  Tue Jun 17 10:13:21 2014
From: youpingl at sina.com (youpingl)
Date: Tue, 17 Jun 2014 17:13:21 +0800
Subject: [rabbitmq-discuss] client_timeout errors
Message-ID: <201406171713206107562@sina.com>

I used the delphi stomp client(v1.7) to connect the Rabbitmq server(v3.3.2) for RPC. But the Rabbitmq server appears errors report list below occasionally, what happens?    

1,rabbitmq's report:

=ERROR REPORT==== 15-May-2014::08:32:20 ===
** Generic server <0.4515.272> terminating
** Last message in was {'$gen_cast',client_timeout}
** When Server state == {state,"session-aVUZrMRW4ccDAF85RFj53Q",<0.4509.272>,
                            <0.4523.272>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            "1.0",#Fun<rabbit_stomp_reader.1.84385891>,
                            undefined,
                            {stomp_configuration,"guest","guest",false,false},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            #Fun<rabbit_stomp_util.trim_headers.1>,
                            {amqp_adapter_info,
                                {0,0,0,0,0,65535,2672,9740},
                                61613,
                                {0,0,0,0,0,65535,2669,58582},
                                50861,
                                <<"10.109.228.214:50861 -> 10.112.38.12:61613">>,
                                {'STOMP',0},
                                [{ssl,false}]},
                            #Fun<rabbit_stomp_reader.0.123360627>,none}
** Reason for termination == 
** client_timeout

2, erlang's report:

=CRASH REPORT==== 15-May-2014::08:32:20 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.4515.272>
    registered_name: []
    exception exit: client_timeout
      in function  gen_server2:terminate/3 
    ancestors: [<0.4506.272>,rabbit_stomp_client_sup_sup,rabbit_stomp_sup,
                  <0.259.0>]
    messages: [{'EXIT',<0.4523.272>,{shutdown,normal}}]
    links: [<0.4506.272>]
    dictionary: [{guid_secure,{{4,rabbit at fqmq1,#Ref<0.0.314.394>},0}}]
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 27
    reductions: 1097
  neighbours:
=SUPERVISOR REPORT==== 15-May-2014::08:32:20 ===
     Supervisor: {<0.4506.272>,
                                           rabbit_stomp_client_sup}
     Context:    child_terminated
     Reason:     client_timeout
     Offender:   [{pid,<0.4515.272>},
                  {name,rabbit_stomp_processor},
                  {mfargs,
                      {rabbit_stomp_processor,start_link,
                          [{stomp_configuration,"guest","guest",false,
                               false}]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/fd74653e/attachment.html>

From mklishin at gopivotal.com  Tue Jun 17 10:18:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 13:18:56 +0400
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00593.2eb141f2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <etPan.53a0081e.79e2a9e3.b262@mercurio.local>

Please keep rabbitmq-discuss in CC.

On 17 June 2014 at 13:15:29, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > I mean I am connecting to a rabbitMQ node from two different clients 
> situated in two different networks but having same ip.

I'm curious what RabbitMQ logs in such scenarios.

Regardless of what the
underlying SSL error is, this configuration is asking for confusion (of both
tools and people).
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jun 17 10:28:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 13:28:00 +0400
Subject: [rabbitmq-discuss] client_timeout errors
In-Reply-To: <201406171713206107562@sina.com>
References: <201406171713206107562@sina.com>
Message-ID: <etPan.53a00a3a.7545e146.b262@mercurio.local>

On 17 June 2014 at 13:14:01, youpingl (youpingl at sina.com) wrote:
> > I used the delphi stomp client(v1.7) to connect the Rabbitmq  
> server(v3.3.2) for RPC. But the Rabbitmq server appears errors  
> report list below occasionally, what happens?

This means a STOMP client missed a heartbeat. Mind you, we should log
something more sensible here but ultimately it is a network connectivity
issue between your client and RabbitMQ node it connects to.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Rohit.Patle at techmahindra.com  Tue Jun 17 10:30:39 2014
From: Rohit.Patle at techmahindra.com (Rohit Patle)
Date: Tue, 17 Jun 2014 09:30:39 +0000
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <etPan.53a0081e.79e2a9e3.b262@mercurio.local>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00593.2eb141f2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>,
 <etPan.53a0081e.79e2a9e3.b262@mercurio.local>
Message-ID: <27E054594442884E9A46DBCF9AE74081688CFF@BSDMSATMBX001.mahindrasatyam.ad>

Hi Michael,

The .log file is not showing anything specific, but as per the program flow I am trying to reconnect, The connection getting establish again and after some (round a minute) time I receive "AMQP_STATUS_SSL_ERROR" at the both the listeners.

Please suggest.

Regards,
Rohit
________________________________________
From: Michael Klishin [mklishin at gopivotal.com]
Sent: Tuesday, June 17, 2014 2:48 PM
To: Rohit Patle
Cc: Discussions about RabbitMQ
Subject: RE: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case

Please keep rabbitmq-discuss in CC.

On 17 June 2014 at 13:15:29, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > I mean I am connecting to a rabbitMQ node from two different clients
> situated in two different networks but having same ip.

I'm curious what RabbitMQ logs in such scenarios.

Regardless of what the
underlying SSL error is, this configuration is asking for confusion (of both
tools and people).
--
MK

Software Engineer, Pivotal/RabbitMQ

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.

From mklishin at gopivotal.com  Tue Jun 17 10:34:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 13:34:56 +0400
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <27E054594442884E9A46DBCF9AE74081688CFF@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00593.2eb141f2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a0081e.79e2a9e3.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CFF@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <etPan.53a00bdc.5bd062c2.b262@mercurio.local>

On 17 June 2014 at 13:31:56, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > The .log file is not showing anything specific, but as per the  
> program flow I am trying to reconnect, The connection getting  
> establish again and after some (round a minute) time I receive  
> "AMQP_STATUS_SSL_ERROR" at the both the listeners.

If it is an SSL handshake issue, there has to be something in Rabbit logs.

Have you tried connecting with openssl s_client or anything else mentioned on
http://www.rabbitmq.com/troubleshooting-ssl.html??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Rohit.Patle at techmahindra.com  Tue Jun 17 10:43:47 2014
From: Rohit.Patle at techmahindra.com (Rohit Patle)
Date: Tue, 17 Jun 2014 09:43:47 +0000
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <etPan.53a00bdc.5bd062c2.b262@mercurio.local>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00593.2eb141f2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a0081e.79e2a9e3.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CFF@BSDMSATMBX001.mahindrasatyam.ad>,
 <etPan.53a00bdc.5bd062c2.b262@mercurio.local>
Message-ID: <27E054594442884E9A46DBCF9AE74081688D0C@BSDMSATMBX001.mahindrasatyam.ad>

Hi Michael,

I believe it is not SSL handshake issue, because the connection is getting establish successfully, for both the connection I am getting comments in Rabbitmq log as "accepting AMQP connection" for the same ip's, but after some time like in a minute I am getting "AMQP_STATUS_SSL_ERROR" in my clients.

Please suggest.

Regards,
ROhit

________________________________________
From: Michael Klishin [mklishin at gopivotal.com]
Sent: Tuesday, June 17, 2014 3:04 PM
To: Rohit Patle
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case

On 17 June 2014 at 13:31:56, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > The .log file is not showing anything specific, but as per the
> program flow I am trying to reconnect, The connection getting
> establish again and after some (round a minute) time I receive
> "AMQP_STATUS_SSL_ERROR" at the both the listeners.

If it is an SSL handshake issue, there has to be something in Rabbit logs.

Have you tried connecting with openssl s_client or anything else mentioned on
http://www.rabbitmq.com/troubleshooting-ssl.html?
--
MK

Software Engineer, Pivotal/RabbitMQ

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.

From ceri at lshift.net  Tue Jun 17 10:50:34 2014
From: ceri at lshift.net (Ceri Storey)
Date: Tue, 17 Jun 2014 10:50:34 +0100
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <53A00F6A.7050407@lshift.net>

Hi Rohit,

(17/06/14 09:59), Rohit Patle wrote:
> Hi Alan,
>
> While working with rabbitmq-c library version 0.4.1 and AMQP version
> 0-9-1, We came across scenario where, If there are two listeners in
> two different networks but having the same static ip (ex.
> 192.168.10.20), the listener receives the "AMQP_STATUS_SSL_ERROR" i.e
> -0x0200 at both the listeners periodically. Could you please spread
> some light to understand the behaviour of it?

Does the RabbitMQ see both networks as having overlapping sets of IP
addresses? If so, then that's not going to work--the RabbitMQ server
will send all replies to one machine, and so anything related to the
connection on the other machine will get forcibly closed or ignored.
That's an IP/TCP level issue, rather than anything to do with Rabbit
specifically.

That said, if both networks are behind correctly configured NAT
gateways, that should be okay. If you do have people who manage the
network for you, it might be worth a chat with them about this.

Cheers,
>
> Thanks & Regards,
> Rohit
>
> ------------------------------------------------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of
> the intended recipient/s and may contain material that is CONFIDENTIAL
> AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or
> copying or distribution or forwarding of any or all of the contents in
> this message is STRICTLY PROHIBITED. If you are not the intended
> recipient, please contact the sender by email and delete all copies;
> your cooperation in this regard is appreciated.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/9222ad61/attachment.html>

From videlalvaro at gmail.com  Tue Jun 17 10:51:02 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 17 Jun 2014 11:51:02 +0200
Subject: [rabbitmq-discuss] Sample use cases of rabbitmq?
In-Reply-To: <etPan.539fd59b.2ae8944a.b262@mercurio.local>
References: <0278672d-07d6-4694-941c-22c951719a02@googlegroups.com>
 <etPan.539fd59b.2ae8944a.b262@mercurio.local>
Message-ID: <CAMcAHLUO7gDVBCfg6_zVSOGncP9_KRqp7_rMrrxE6nB3Ugpngw@mail.gmail.com>

Hi,

If you want to see commercial use cases, then take a look at our blogs:

The old one, where you can find Instagram's use case among others:
http://blogs.vmware.com/vfabric/rabbitmq
And our current blog for use cases, where Travis-CI is there, and many
more: http://blog.gopivotal.com/category/case-studies-2

Regards,

Alvaro


On Tue, Jun 17, 2014 at 7:43 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 17 June 2014 at 09:31:52, Ankit (ankitsoni9 at gmail.com) wrote:
> > > Could someone walk through or link to sample applications and
> > use cases of rabbitmq? I want to build an app using rabbitMQ to
> > get a better handle on how to use it but I dont see where something
> > like this might be useful and I found very few case studies/examples
> > through google.
>
> Start with tutorials, they demonstrate fairly realistic scenarios:
> http://www.rabbitmq.com/getstarted.html
>
> RabbitMQ is used to connection applications (services, microservices), see
> e.g.
> http://developers.soundcloud.com/blog/building-products-at-soundcloud-part-1-dealing-with-the-monolith
>
> Often this means background/asynchronous processing of tasks (projects
> like Celery, EasyNetQ, etc),
> but by no means limited to that.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/e6188808/attachment.html>

From mklishin at gopivotal.com  Tue Jun 17 10:50:52 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 13:50:52 +0400
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <27E054594442884E9A46DBCF9AE74081688D0C@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00593.2eb141f2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a0081e.79e2a9e3.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CFF@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00bdc.5bd062c2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688D0C@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <etPan.53a00f9a.12200854.b262@mercurio.local>

?On 17 June 2014 at 13:47:26, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > I believe it is not SSL handshake issue, because the connection  
> is getting establish successfully, for both the connection  
> I am getting comments in Rabbitmq log as "accepting AMQP connection"  
> for the same ip's, but after some time like in a minute I am getting  
> "AMQP_STATUS_SSL_ERROR" in my clients.

AMQP_STATUS_SSL_ERROR is very generic and without getting
more info from OpenSSL it's not really possible to tell what the problem is:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-September/030459.html

Try openssl s_client, it usually produces better error messages
and displays more info than almost any other tool out there.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Matthias.Bleyl at knorr-bremse.com  Tue Jun 17 11:20:50 2014
From: Matthias.Bleyl at knorr-bremse.com (Bleyl, Matthias)
Date: Tue, 17 Jun 2014 10:20:50 +0000
Subject: [rabbitmq-discuss] rabbitmq on WinCE
Message-ID: <1C3441967459674D85C620A136130C920359A8@MUCS72167.corp.knorr-bremse.com>

Hello everybody

we are trying to get a light weighted communication service (message broker) running in WinCE:

-          Win Embedded Compact 7 (high prio)

-          Win CE 6.0 (low prio)

To be honest, we were originally thinking on using zeroMQ for this.
However, it seems to be not possible to get zeroMQ running on WinCE (?).

Therefore, I would like to ask whether there are any positive experiences with the combination rabbitMQ / WinCE in the community?

Thanks
Matthias


Dr. techn. J. Zelisko GmbH
FN 122796h, LG Wr. Neustadt

This transmission is intended solely for the addressee and contains confidential information.
If you are not the intended recipient, please immediately inform the sender and delete the message and any attachments from your system. 
Furthermore, please do not copy the message or disclose the contents to anyone unless agreed otherwise. To the extent permitted by law we shall in no way be liable for any damages, whatever their nature, arising out of transmission failures, viruses, external influence, delays and the like.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/3965ff90/attachment.html>

From simon at rabbitmq.com  Tue Jun 17 11:22:47 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 11:22:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.3 released
Message-ID: <53A016F7.5000808@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.3.3.

This release fixes a small number of bugs in 3.3.2 and earlier versions. 
In particular it fixes a bug introduced in 3.3.2 which could cause 
logging to stop under some circumstances.

See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.3.3.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                       The RabbitMQ Team
                       (http://www.rabbitmq.com)

From mklishin at gopivotal.com  Tue Jun 17 11:25:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 14:25:30 +0400
Subject: [rabbitmq-discuss] rabbitmq on WinCE
In-Reply-To: <1C3441967459674D85C620A136130C920359A8@MUCS72167.corp.knorr-bremse.com>
References: <1C3441967459674D85C620A136130C920359A8@MUCS72167.corp.knorr-bremse.com>
Message-ID: <etPan.53a017b8.4db127f8.b262@mercurio.local>

On 17 June 2014 at 14:22:17, Bleyl, Matthias (matthias.bleyl at knorr-bremse.com) wrote:
> > Therefore, I would like to ask whether there are any positive  
> experiences with the combination rabbitMQ / WinCE in the community?  

RabbitMQ .NET client does not work with .NET compact. However, there is an
MQTT client for Win CE 7 which you can use with RabbitMQ:

https://m2mqtt.codeplex.com/?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Matthias.Bleyl at knorr-bremse.com  Tue Jun 17 11:38:31 2014
From: Matthias.Bleyl at knorr-bremse.com (Bleyl, Matthias)
Date: Tue, 17 Jun 2014 10:38:31 +0000
Subject: [rabbitmq-discuss] rabbitmq on WinCE
In-Reply-To: <etPan.53a017b8.4db127f8.b262@mercurio.local>
References: <1C3441967459674D85C620A136130C920359A8@MUCS72167.corp.knorr-bremse.com>
 <etPan.53a017b8.4db127f8.b262@mercurio.local>
Message-ID: <1C3441967459674D85C620A136130C92035A58@MUCS72167.corp.knorr-bremse.com>


Thanks, Michael for reply.

> " However, there is an MQTT client for Win CE 7 which you can use with RabbitMQ:"

What I need is a complete (and independent) communication service solution on WinCE, this means broker and clients.
The reason is that we have several components on a WinCE device which needs to be coupled by a messaging bus.

Therefore I asked whether RabbitMQ (as complete system) could be used on a WinCE platform.
Matthias 



-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Tuesday, June 17, 2014 12:26 PM
To: Bleyl, Matthias; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] rabbitmq on WinCE

On 17 June 2014 at 14:22:17, Bleyl, Matthias (matthias.bleyl at knorr-bremse.com) wrote:
> > Therefore, I would like to ask whether there are any positive
> experiences with the combination rabbitMQ / WinCE in the community?  

RabbitMQ .NET client does not work with .NET compact. However, there is an MQTT client for Win CE 7 which you can use with RabbitMQ:

https://m2mqtt.codeplex.com/
--
MK  

Software Engineer, Pivotal/RabbitMQ

Dr. techn. J. Zelisko GmbH
FN 122796h, LG Wr. Neustadt

This transmission is intended solely for the addressee and contains confidential information.
If you are not the intended recipient, please immediately inform the sender and delete the message and any attachments from your system. 
Furthermore, please do not copy the message or disclose the contents to anyone unless agreed otherwise. To the extent permitted by law we shall in no way be liable for any damages, whatever their nature, arising out of transmission failures, viruses, external influence, delays and the like.


From mklishin at gopivotal.com  Tue Jun 17 11:40:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 14:40:00 +0400
Subject: [rabbitmq-discuss] rabbitmq on WinCE
In-Reply-To: <1C3441967459674D85C620A136130C92035A58@MUCS72167.corp.knorr-bremse.com>
References: <1C3441967459674D85C620A136130C920359A8@MUCS72167.corp.knorr-bremse.com>
 <etPan.53a017b8.4db127f8.b262@mercurio.local>
 <1C3441967459674D85C620A136130C92035A58@MUCS72167.corp.knorr-bremse.com>
Message-ID: <etPan.53a01b1a.1f16e9e8.b262@mercurio.local>

On 17 June 2014 at 14:38:34, Bleyl, Matthias (matthias.bleyl at knorr-bremse.com) wrote:
> > What I need is a complete (and independent) communication service  
> solution on WinCE, this means broker and clients.
> The reason is that we have several components on a WinCE device  
> which needs to be coupled by a messaging bus.
>  
> Therefore I asked whether RabbitMQ (as complete system) could  
> be used on a WinCE platform.

So, do ?you want multiple apps all running on Win CE to communicate
over RabbitMQ or run Rabbit itself on Win CE?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Matthias.Bleyl at knorr-bremse.com  Tue Jun 17 11:46:22 2014
From: Matthias.Bleyl at knorr-bremse.com (Bleyl, Matthias)
Date: Tue, 17 Jun 2014 10:46:22 +0000
Subject: [rabbitmq-discuss] rabbitmq on WinCE
In-Reply-To: <etPan.53a01b1a.1f16e9e8.b262@mercurio.local>
References: <1C3441967459674D85C620A136130C920359A8@MUCS72167.corp.knorr-bremse.com>
 <etPan.53a017b8.4db127f8.b262@mercurio.local>
 <1C3441967459674D85C620A136130C92035A58@MUCS72167.corp.knorr-bremse.com>
 <etPan.53a01b1a.1f16e9e8.b262@mercurio.local>
Message-ID: <1C3441967459674D85C620A136130C92035AB0@MUCS72167.corp.knorr-bremse.com>


> So, do  you want multiple apps all running on Win CE to communicate over RabbitMQ or run Rabbit itself on Win CE?

I have several software components (on the same WinCE device) for which I am looking for a communication service.

As far as I understand I need to run Rabbit itself on Win CE for this.
(Most of the time, my WinCE device runs without any interface to a backend server. Therefor I must not depend on an external broker)
Matthias 


-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Tuesday, June 17, 2014 12:40 PM
To: Discussions about RabbitMQ; Bleyl, Matthias
Subject: RE: [rabbitmq-discuss] rabbitmq on WinCE

On 17 June 2014 at 14:38:34, Bleyl, Matthias (matthias.bleyl at knorr-bremse.com) wrote:
> > What I need is a complete (and independent) communication service
> solution on WinCE, this means broker and clients.
> The reason is that we have several components on a WinCE device which 
> needs to be coupled by a messaging bus.
>  
> Therefore I asked whether RabbitMQ (as complete system) could be used 
> on a WinCE platform.

So, do ?you want multiple apps all running on Win CE to communicate over RabbitMQ or run Rabbit itself on Win CE?
--
MK  

Software Engineer, Pivotal/RabbitMQ

Dr. techn. J. Zelisko GmbH
FN 122796h, LG Wr. Neustadt

This transmission is intended solely for the addressee and contains confidential information.
If you are not the intended recipient, please immediately inform the sender and delete the message and any attachments from your system. 
Furthermore, please do not copy the message or disclose the contents to anyone unless agreed otherwise. To the extent permitted by law we shall in no way be liable for any damages, whatever their nature, arising out of transmission failures, viruses, external influence, delays and the like.


From mklishin at gopivotal.com  Tue Jun 17 11:49:51 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 17 Jun 2014 14:49:51 +0400
Subject: [rabbitmq-discuss] rabbitmq on WinCE
In-Reply-To: <1C3441967459674D85C620A136130C92035AB0@MUCS72167.corp.knorr-bremse.com>
References: <1C3441967459674D85C620A136130C920359A8@MUCS72167.corp.knorr-bremse.com>
 <etPan.53a017b8.4db127f8.b262@mercurio.local>
 <1C3441967459674D85C620A136130C92035A58@MUCS72167.corp.knorr-bremse.com>
 <etPan.53a01b1a.1f16e9e8.b262@mercurio.local>
 <1C3441967459674D85C620A136130C92035AB0@MUCS72167.corp.knorr-bremse.com>
Message-ID: <etPan.53a01d6d.1190cde7.b262@mercurio.local>

On 17 June 2014 at 14:46:24, Bleyl, Matthias (matthias.bleyl at knorr-bremse.com) wrote:
> > I have several software components (on the same WinCE device) 
> for which I am looking for a communication service.
> 
> As far as I understand I need to run Rabbit itself on Win CE for this. 
> (Most of the time, my WinCE device runs without any interface 
> to a backend server. Therefor I must not depend on an external 
> broker)

Understood.

There is an Erlang port for Win CE:
http://erlang.org/doc/embedded/embedded_nt.html

however, I'm not sure if anyone has tried running RabbitMQ on it.
In theory there are only two parts that are OS-specific: disk monitor
and OS memory limit calculation, but the latter not functioning will likely cause
Rabbit to not start .

Give it a try and let us know how it goes.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From kyleo at 0b10.mx  Tue Jun 17 14:21:47 2014
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Tue, 17 Jun 2014 09:21:47 -0400 (EDT)
Subject: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)
In-Reply-To: <950360918.14934.1403011196243.JavaMail.zimbra@0b10.mx>
Message-ID: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>

Hi,

I just updated to rabbitmq-server 3.3.3 and running ./rabbitmq-server start no longer works.  If I run bash rabbitmq-server start it works fine.

It looks like the following was added in this release, can someone tell me why if this was on purpose?

rabbitmq 3.3.3
$ head -1 rabbitmq-server
#!/bin/sh -e

On rabbitmq 3.0.4:
$ head -1 rabbitmq-server
#!/bin/sh

Thanks,
Kyle



From simon at rabbitmq.com  Tue Jun 17 14:41:41 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 14:41:41 +0100
Subject: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)
In-Reply-To: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>
References: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>
Message-ID: <53A04595.2060104@rabbitmq.com>

On 17/06/2014 2:21PM, Kyle O'Donnell wrote:
> Hi,
>
> I just updated to rabbitmq-server 3.3.3 and running ./rabbitmq-server start no longer works.  If I run bash rabbitmq-server start it works fine.

Hmm, what is /bin/sh on your system? And why are you giving it the 
command line flag "start"? - that's not necessary.

> It looks like the following was added in this release, can someone tell me why if this was on purpose?
>
> rabbitmq 3.3.3
> $ head -1 rabbitmq-server
> #!/bin/sh -e
>
> On rabbitmq 3.0.4:
> $ head -1 rabbitmq-server
> #!/bin/sh

It was added on purpose. "-e" means "halt on error", by default sh will 
carry on even if something fails. We've had cases where that means 
something that should be a comprehensible failure is instead made rather 
less comprehensible.

But damn, if that's causing a breakage for you that's not great news. 
Are you seeing an error message?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From kyleo at 0b10.mx  Tue Jun 17 14:52:45 2014
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Tue, 17 Jun 2014 09:52:45 -0400 (EDT)
Subject: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)
In-Reply-To: <53A04595.2060104@rabbitmq.com>
References: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>
 <53A04595.2060104@rabbitmq.com>
Message-ID: <965615140.14954.1403013165933.JavaMail.zimbra@0b10.mx>

I can't remember where I saw 'start' my mistake, but the same applies whether I use 'start' or not.

I'm running ubuntu 12.04 (x86_64) by the way.

# apt-file search /bin/sh |grep " /bin"
dash: /bin/sh
# dpkg -l dash
ii  dash                        0.5.7-2ubuntu2              POSIX-compliant shell

There are no errors printed to the console:
$ ./rabbitmq-server 
$ echo $?
2

I added #!/bin/sh -ex and ran it again and didn't see anything obvious:

./rabbitmq-server 
++ dirname ./rabbitmq-server
+ . ./rabbitmq-env
++ SCRIPT_PATH=./rabbitmq-server
++ '[' -h ./rabbitmq-server ']'
+++ dirname ./rabbitmq-server
++ SCRIPT_DIR=.
++ RABBITMQ_HOME=./..
++ '[' x = xs4-test-q001 ']'
++ NODENAME=rabbit at s4-test-q001
++ . ./rabbitmq-defaults
+++ SYS_PREFIX=
+++ ERL_DIR=
+++ CLEAN_BOOT_FILE=start_clean
+++ SASL_BOOT_FILE=start_sasl
+++ CONFIG_FILE=/etc/rabbitmq/rabbitmq
+++ LOG_BASE=/var/log/rabbitmq
+++ MNESIA_BASE=/var/lib/rabbitmq/mnesia
+++ ENABLED_PLUGINS_FILE=/etc/rabbitmq/enabled_plugins
+++ PLUGINS_DIR=./../plugins
+++ CONF_ENV_FILE=/etc/rabbitmq/rabbitmq-env.conf
++ SERVER_ERL_ARGS='+K true +A30 +P 1048576   -kernel inet_default_connect_options [{nodelay,true}]'
++ '[' -f /etc/rabbitmq/rabbitmq.conf ']'
++ '[' -f /etc/rabbitmq/rabbitmq-env.conf ']'
++ true
++ '[' -f ./../etc/rabbitmq-env.conf ']'
++ . ./../etc/rabbitmq-env.conf
+++ RABBITMQ_BASE=/x/s/rabbitmq-server
+++ RABBITMQ_MNESIA_BASE=/x/s/rabbitmq-server/var/lib/mnesia
+++ RABBITMQ_LOG_BASE=/x/s/rabbitmq-server/var/log
+++ RABBITMQ_NODENAME=rabbit
+++ RABBITMQ_CONFIG_FILE=/x/s/rabbitmq-server/etc/rabbitmq
+++ RABBITMQ_NODE_PORT=35672
+++ RABBITMQ_DIST_PORT=35672
+++ RABBITMQ_PLUGINS_DIR=/x/s/rabbitmq-server/plugins
+++ RABBITMQ_ENABLED_PLUGINS_FILE=/x/s/rabbitmq-server/etc/enabled_plugins
+ DEFAULT_NODE_IP_ADDRESS=auto
+ DEFAULT_NODE_PORT=5672
+ '[' x = x ']'
+ RABBITMQ_NODE_IP_ADDRESS=
+ '[' x = x35672 ']'
+ '[' x = x ']'
+ '[' x '!=' x35672 ']'
+ RABBITMQ_NODE_IP_ADDRESS=auto
+ '[' x '!=' xauto ']'
+ '[' x = x35672 ']'
+ '[' x = x35672 ']'
+ '[' x = x35672 ']'
+ '[' x = x35672 ']'
+ '[' x = xrabbit ']'
+ '[' x = x ']'
+ RABBITMQ_SERVER_ERL_ARGS='+K true +A30 +P 1048576   -kernel inet_default_connect_options [{nodelay,true}]'
+ '[' x = x/x/s/rabbitmq-server/etc/rabbitmq ']'
+ '[' x = x/x/s/rabbitmq-server/var/log ']'
+ '[' x = x/x/s/rabbitmq-server/var/lib/mnesia ']'
+ '[' x = x ']'
+ RABBITMQ_SERVER_START_ARGS=
+ '[' x = x ']'
+ RABBITMQ_MNESIA_DIR=
+ '[' x = x ']'
+ RABBITMQ_MNESIA_DIR=/x/s/rabbitmq-server/var/lib/mnesia/rabbit
+ '[' x = x ']'
+ RABBITMQ_PID_FILE=
+ '[' x = x ']'
+ RABBITMQ_PID_FILE=/x/s/rabbitmq-server/var/lib/mnesia/rabbit.pid
+ '[' x = x ']'
+ RABBITMQ_PLUGINS_EXPAND_DIR=
+ '[' x = x ']'
+ RABBITMQ_PLUGINS_EXPAND_DIR=/x/s/rabbitmq-server/var/lib/mnesia/rabbit-plugins-expand
+ '[' x = x/x/s/rabbitmq-server/etc/enabled_plugins ']'
+ '[' x = x/x/s/rabbitmq-server/plugins ']'
+ '[' x = x ']'
+ RABBITMQ_LOGS=
+ '[' x = x ']'
+ RABBITMQ_LOGS=/x/s/rabbitmq-server/var/log/rabbit.log
+ '[' x = x ']'
+ RABBITMQ_SASL_LOGS=
+ '[' x = x ']'
+ RABBITMQ_SASL_LOGS=/x/s/rabbitmq-server/var/log/rabbit-sasl.log
+ RABBITMQ_START_RABBIT=
+ '[' x = x ']'
+ RABBITMQ_START_RABBIT=' -noinput'
+ '[' x = x ']'
+ RABBITMQ_START_RABBIT=' -noinput -s rabbit boot '
+ case "$(uname -s)" in
++ uname -s
+ detached=
+ '[' ']'
++ dirname /x/s/rabbitmq-server/var/lib/mnesia/rabbit.pid
+ mkdir -p /x/s/rabbitmq-server/var/lib/mnesia
+ echo 26755
+ RABBITMQ_EBIN_ROOT=./../ebin
+ RABBITMQ_CONFIG_FILE=/x/s/rabbitmq-server/etc/rabbitmq
+ RABBITMQ_DIST_PORT=35672
+ erl -pa ./../ebin -boot start_clean -noinput -hidden -s rabbit_prelaunch -sname rabbitmqprelaunch26755 -extra rabbit


----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>, "Kyle O'Donnell" <kyleo at 0b10.mx>
Sent: Tuesday, June 17, 2014 9:41:41 AM
Subject: Re: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)

On 17/06/2014 2:21PM, Kyle O'Donnell wrote:
> Hi,
>
> I just updated to rabbitmq-server 3.3.3 and running ./rabbitmq-server start no longer works.  If I run bash rabbitmq-server start it works fine.

Hmm, what is /bin/sh on your system? And why are you giving it the 
command line flag "start"? - that's not necessary.

> It looks like the following was added in this release, can someone tell me why if this was on purpose?
>
> rabbitmq 3.3.3
> $ head -1 rabbitmq-server
> #!/bin/sh -e
>
> On rabbitmq 3.0.4:
> $ head -1 rabbitmq-server
> #!/bin/sh

It was added on purpose. "-e" means "halt on error", by default sh will 
carry on even if something fails. We've had cases where that means 
something that should be a comprehensible failure is instead made rather 
less comprehensible.

But damn, if that's causing a breakage for you that's not great news. 
Are you seeing an error message?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jun 17 15:00:01 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 15:00:01 +0100
Subject: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)
In-Reply-To: <965615140.14954.1403013165933.JavaMail.zimbra@0b10.mx>
References: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>
 <53A04595.2060104@rabbitmq.com>
 <965615140.14954.1403013165933.JavaMail.zimbra@0b10.mx>
Message-ID: <53A049E1.3020406@rabbitmq.com>

On 17/06/2014 2:52PM, Kyle O'Donnell wrote:
> + RABBITMQ_DIST_PORT=35672
> + erl -pa ./../ebin -boot start_clean -noinput -hidden -s rabbit_prelaunch -sname rabbitmqprelaunch26755 -extra rabbit

Damn, I think it's tripping over the test for inet_dist_listen_min / 
inet_dist_listen_max. Which come to think of it did use a non-zero 
return code. Damn.

Well, that's a bug. Thank you for reporting it. As a workaround you 
could do one of:

* Remove -e from the script
* Just use RABBITMQ_DIST_PORT and remove inet_dist_listen_min / 
inet_dist_listen_max from your config; they're not needed these days

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From shadimari at gmail.com  Tue Jun 17 15:23:34 2014
From: shadimari at gmail.com (Shadi Mari)
Date: Tue, 17 Jun 2014 07:23:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Reliability and Publisher Confirms...
Message-ID: <5868caad-0580-4fc2-952b-37aca1944b2b@googlegroups.com>

Hello,

Speaking of persistent queues and reliability, I am aware that in order to 
increase rabbitmq reliability level, publisher confirms need to be enabled 
in order to tell exactly when messages are delivered/persisted. However, am 
not sure of how rabbitmq behaves where there are outstanding confirms/acks 
not yet received by the publisher and the connection between the publisher 
and the broker is broken. I am under the assumption that rabbitmq does not 
redeliver the acks when the connection is available again and it discards 
messages with undelivered acks to publisher, Is this assumption correct? In 
case Yes, does this mean i will have to track in memory all outstanding 
publish requests with no confirmations and re-publish them when the 
connection is available? I am afraid this might create a reliability hole.

Thank you,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/a5009606/attachment.html>

From gavinmroy at gmail.com  Tue Jun 17 15:29:51 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Tue, 17 Jun 2014 10:29:51 -0400
Subject: [rabbitmq-discuss] Plugin startup behavior issue
In-Reply-To: <539FF03C.2030203@rabbitmq.com>
References: <etPan.539fba68.6b8b4567.102e9@gmr-home.local>
 <539FF03C.2030203@rabbitmq.com>
Message-ID: <etPan.53a050df.6b8b4567.139b7@s826.ofc.lair>

On June 17, 2014 at 3:37:33 AM, Simon MacMullen (simon at rabbitmq.com) wrote:
So the issue you have there is that rabbit_log does not work early in?
the boot process (before recovery) since it tries to log to an?
amq.rabbitmq.log exchange which is not there.?

You need to use error_logger directly for log messages early in the boot?
process.?
As a first step I commented out (then removed) all logging from the plugin:

s826:pgsql-listen-exchange gavinr$ grep -Rl 'log' src/

s826:pgsql-listen-exchange gavinr$?

Unfortunately I am still getting the same error. Any other ideas?

Gavin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/e58c154f/attachment.html>

From aaron at agoragames.com  Tue Jun 17 15:54:49 2014
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 17 Jun 2014 10:54:49 -0400
Subject: [rabbitmq-discuss] PPA debs restart rabbit
Message-ID: <CAHiEoM5aurp4QxuDQ-+XbJ8W8HgMCDprNqQCzH8Cu_sv+3-SkA@mail.gmail.com>

We're using the PPA for rabbit but the current debian files are not
suitable for production deployments because they stop and restart the
process. I understand the desire to start the process if it was not already
running, but embedding the restart logic in the deb means that users have
no control over the process. As it is very common to use the PPA within the
context of a configuration management system (Salt, Chef, etc), it would be
best to leave that decision up to the user.

-- 
Aaron Westendorf
Lead Engineer | Agora Games
aaron at agoragames.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/e3795545/attachment.html>

From simon at rabbitmq.com  Tue Jun 17 17:27:26 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 17:27:26 +0100
Subject: [rabbitmq-discuss] Reliability and Publisher Confirms...
In-Reply-To: <5868caad-0580-4fc2-952b-37aca1944b2b@googlegroups.com>
References: <5868caad-0580-4fc2-952b-37aca1944b2b@googlegroups.com>
Message-ID: <53A06C6E.5070509@rabbitmq.com>

On 17/06/2014 3:23PM, Shadi Mari wrote:
> Speaking of persistent queues and reliability, I am aware that in order
> to increase rabbitmq reliability level, publisher confirms need to be
> enabled in order to tell exactly when messages are delivered/persisted.

Yes.

> However, am not sure of how rabbitmq behaves where there are outstanding
> confirms/acks not yet received by the publisher and the connection
> between the publisher and the broker is broken. I am under the
> assumption that rabbitmq does not redeliver the acks when the connection
> is available again

Yes.

> and it discards messages with undelivered acks to
> publisher,

No. The messages will not be discarded, the server may well have sent an 
ack to the publisher which is lost when the connection is lost, the 
server does not know what happens to acks after it has sent them. So it 
accepts the message anyway, the confirm is just to let you know.

> In case Yes, does this mean i
> will have to track in memory all outstanding publish requests with no
> confirmations and re-publish them when the connection is available? I am
> afraid this might create a reliability hole.

Your publisher needs to take responsibility for messages until they are 
acknowledged by the server, yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ktran0003 at gmail.com  Tue Jun 17 17:33:11 2014
From: ktran0003 at gmail.com (Kim Tran)
Date: Tue, 17 Jun 2014 09:33:11 -0700
Subject: [rabbitmq-discuss] rabbitmq-c TTL setting not working for me -
 please help
In-Reply-To: <etPan.539f94f2.643c9869.b262@mercurio.local>
References: <de6cd927-ff42-407f-98cc-80b6bd20db4e@googlegroups.com>
 <etPan.539f94f2.643c9869.b262@mercurio.local>
Message-ID: <53A06DC7.6020102@gmail.com>

Michael,
I tried to use the TTL attribute via management UI like this:
sudo rabbitmqctl set_policy TTL ".*" '{"message-ttl":4000}' --apply-to queue

And I still got all the messages. None of them was dropped.
The management UI shows for the queue:
Parameters | x-message-ttl: 2000
So my setting is recognized by the broker I guess.

Thanks,
-Kim

On 6/16/2014 6:07 PM, Michael Klishin wrote:
> On 17 June 2014 at 05:03:54, ktran0003 at gmail.com (ktran0003 at gmail.com) wrote:
>>> Then every time I consume a message, I sleep for 5 secs just to
>> delay the consuming rate.
>> I also have the producer send a message every 1 sec.
>>   
>> However, when I run the producer to produce 20 messages, the consumer
>> will get all 20 messages with 5 sec delay in between.
>> Should some messages not delivered because of TTL < 5 sec delay?
> They should. Do you use the TTL attribute being set for queues in the management UI?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ


From simon at rabbitmq.com  Tue Jun 17 17:39:55 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 17:39:55 +0100
Subject: [rabbitmq-discuss] rabbitmq-c TTL setting not working for me -
 please help
In-Reply-To: <53A06DC7.6020102@gmail.com>
References: <de6cd927-ff42-407f-98cc-80b6bd20db4e@googlegroups.com>
 <etPan.539f94f2.643c9869.b262@mercurio.local> <53A06DC7.6020102@gmail.com>
Message-ID: <53A06F5B.8040603@rabbitmq.com>

On 17/06/2014 5:33PM, Kim Tran wrote:
> And I still got all the messages. None of them was dropped.

Hang on. You originally said:

> Then every time I consume a message, I sleep for 5 secs just to delay
> the consuming rate.

That would mean the broker sent you all the messages straight away, but 
your app delayed reading them off the socket. The queue can't expire 
messages when they are out for delivery.

So if you want a slow consumer, set basic.qos to a low value (e.g. 1), 
that way the broker will only send you one message at a time as you 
acknowledge them (you are using acks, right?)

Then you should see the messages expire.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ktran0003 at gmail.com  Tue Jun 17 17:59:26 2014
From: ktran0003 at gmail.com (Kim Tran)
Date: Tue, 17 Jun 2014 09:59:26 -0700
Subject: [rabbitmq-discuss] rabbitmq-c TTL setting not working for me -
 please help
In-Reply-To: <53A06F5B.8040603@rabbitmq.com>
References: <de6cd927-ff42-407f-98cc-80b6bd20db4e@googlegroups.com>
 <etPan.539f94f2.643c9869.b262@mercurio.local> <53A06DC7.6020102@gmail.com>
 <53A06F5B.8040603@rabbitmq.com>
Message-ID: <53A073EE.4040808@gmail.com>

Simon,
Thanks for the hints.  I didn't have the basic.qos to receive one at a 
time. That's likely the reason.

So what would happen if I got all the messages straight away but slowly 
process them:  the queue would get bigger and bigger over time? and 
eventually crash with some socket error?

Thanks,
-Kim


On 6/17/2014 9:39 AM, Simon MacMullen wrote:
> On 17/06/2014 5:33PM, Kim Tran wrote:
>> And I still got all the messages. None of them was dropped.
>
> Hang on. You originally said:
>
>> Then every time I consume a message, I sleep for 5 secs just to delay
>> the consuming rate.
>
> That would mean the broker sent you all the messages straight away, 
> but your app delayed reading them off the socket. The queue can't 
> expire messages when they are out for delivery.
>
> So if you want a slow consumer, set basic.qos to a low value (e.g. 1), 
> that way the broker will only send you one message at a time as you 
> acknowledge them (you are using acks, right?)
>
> Then you should see the messages expire.
>
> Cheers, Simon
>


From simon at rabbitmq.com  Tue Jun 17 18:24:11 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jun 2014 18:24:11 +0100
Subject: [rabbitmq-discuss] Plugin startup behavior issue
In-Reply-To: <etPan.53a050df.6b8b4567.139b7@s826.ofc.lair>
References: <etPan.539fba68.6b8b4567.102e9@gmr-home.local>
 <539FF03C.2030203@rabbitmq.com> <etPan.53a050df.6b8b4567.139b7@s826.ofc.lair>
Message-ID: <53A079BB.6090209@rabbitmq.com>

On 17/06/2014 3:29PM, Gavin M. Roy wrote:
> As a first step I commented out (then removed) all logging from the plugin:
> Unfortunately I am still getting the same error. Any other ideas?

Ah.

I have replicated the problem now, and it's weirder (and a bit more 
awkward) than I initially thought.

The problem is actually that your pgsql_listen_supervisor starts a 
mirrored supervisor. This then writes its state to Mnesia before the 
empty_db_check happens. The empty_db_check will only create the default 
vhost etc if all tables are empty. Since the mirrored_supervisor table 
is not, we have no vhost and the logger explodes on startup (but it's 
not really anything to do with the logger, that's just the first thing 
to hit the problem).

So I wondered about working round this by setting 
pgsql_listen_supervisor to require empty_db_check. That works fine... as 
long as the management plugin isn't enabled. If it is, then 
load_definitions wants empty_db_check after recovery, which is after 
pgsql_listen_exchange and we have a cyclic dependency.

Probably the right solution is for the empty_db_check to only check for 
absent vhosts and exchanges. I'll file a bug for that.

But how can you work around this? I don't think you can tweak the boot 
steps required by your supervisor, but I think:

diff --git a/src/pgsql_listen_sup.erl b/src/pgsql_listen_sup.erl
index ea6a11f..fc293b0 100644
--- a/src/pgsql_listen_sup.erl
+++ b/src/pgsql_listen_sup.erl
@@ -25,6 +25,7 @@
  -include_lib("rabbit_common/include/rabbit.hrl").

  start_link() ->
+    rabbit:maybe_insert_default_data(),
     mirrored_supervisor:start_link(
       {local, ?MODULE}, ?MODULE,
       fun rabbit_misc:execute_mnesia_transaction/1,

is a reasonable workaround.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dburke at addictmud.org  Tue Jun 17 19:03:53 2014
From: dburke at addictmud.org (Daniel W. Burke)
Date: Tue, 17 Jun 2014 14:03:53 -0400
Subject: [rabbitmq-discuss] Unable to create exchange / queue binding
Message-ID: <CAH8FpAShVezEfu=51r5XMy-Dw+G_zJZCuZ42ZkAgnWQD68T=Rw@mail.gmail.com>

When trying to create the binding for a queue, we're hitting a frustrating
problem at the moment. (The names have been changed to protect the
innocent).

NOT_FOUND - no binding BINDING_NAME between exchange 'amq.direct' in vhost
'MYVHOST' and queue 'QUEUENAME' in vhost 'MYVHOST'

This should be a binding that already exists, but for this queue it
doesn't.  When trying to create it from the management UI we get the error
(or from the http api)... if we change just one character in the routing
key it works... that's not what we want, but it tells me there's something
deeper wrong.

This is our development cluster, so we can do whatever to it...

It's a three node cluster, each node on it's own VM.

Any help in resolving this would be great.  We're banging our head against
our desks on this one.

Thanks,
Dan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/7370c0b3/attachment.html>

From dburke at addictmud.org  Tue Jun 17 19:12:48 2014
From: dburke at addictmud.org (Daniel W. Burke)
Date: Tue, 17 Jun 2014 14:12:48 -0400
Subject: [rabbitmq-discuss] Unable to create exchange / queue binding
In-Reply-To: <CAH8FpAShVezEfu=51r5XMy-Dw+G_zJZCuZ42ZkAgnWQD68T=Rw@mail.gmail.com>
References: <CAH8FpAShVezEfu=51r5XMy-Dw+G_zJZCuZ42ZkAgnWQD68T=Rw@mail.gmail.com>
Message-ID: <CAH8FpATbMSH1PSmu3hzkXxvh_7wFO402jWHSF6-RZwz_Q6j0pQ@mail.gmail.com>

Sorry, I forgot to include that we're running version 3.3.2, erlang R16B03
on CentOS6.5

Dan.



On Tue, Jun 17, 2014 at 2:03 PM, Daniel W. Burke <dburke at addictmud.org>
wrote:

> When trying to create the binding for a queue, we're hitting a frustrating
> problem at the moment. (The names have been changed to protect the
> innocent).
>
> NOT_FOUND - no binding BINDING_NAME between exchange 'amq.direct' in vhost
> 'MYVHOST' and queue 'QUEUENAME' in vhost 'MYVHOST'
>
> This should be a binding that already exists, but for this queue it
> doesn't.  When trying to create it from the management UI we get the error
> (or from the http api)... if we change just one character in the routing
> key it works... that's not what we want, but it tells me there's something
> deeper wrong.
>
> This is our development cluster, so we can do whatever to it...
>
> It's a three node cluster, each node on it's own VM.
>
> Any help in resolving this would be great.  We're banging our head against
> our desks on this one.
>
> Thanks,
> Dan.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/1e5dfa0e/attachment.html>

From dburke at addictmud.org  Tue Jun 17 20:15:33 2014
From: dburke at addictmud.org (Daniel W. Burke)
Date: Tue, 17 Jun 2014 15:15:33 -0400
Subject: [rabbitmq-discuss] Unable to create exchange / queue binding
In-Reply-To: <CAH8FpATbMSH1PSmu3hzkXxvh_7wFO402jWHSF6-RZwz_Q6j0pQ@mail.gmail.com>
References: <CAH8FpAShVezEfu=51r5XMy-Dw+G_zJZCuZ42ZkAgnWQD68T=Rw@mail.gmail.com>
 <CAH8FpATbMSH1PSmu3hzkXxvh_7wFO402jWHSF6-RZwz_Q6j0pQ@mail.gmail.com>
Message-ID: <CAH8FpARgb=9S4QLRN+-Mq+-Yn3xPTL64fU7MxpwqwkXsfGhtaw@mail.gmail.com>

Well, we were keeping somebody from working, so we found an old thread that
recommended shutting down the entire cluster... that did the trick... when
it came back up everything was good again.

I'd still like to know if someone has any suggestions on what to look
for/at if it happens again.  We're getting ready to go live in production
hopefully this week with 4 RMQ clusters of 3 nodes each... a 5th cluster to
be added in a few weeks... makes me nervous that we might have to do that
in production.

Thanks,
Dan.



On Tue, Jun 17, 2014 at 2:12 PM, Daniel W. Burke <dburke at addictmud.org>
wrote:

> Sorry, I forgot to include that we're running version 3.3.2, erlang R16B03
> on CentOS6.5
>
> Dan.
>
>
>
> On Tue, Jun 17, 2014 at 2:03 PM, Daniel W. Burke <dburke at addictmud.org>
> wrote:
>
>> When trying to create the binding for a queue, we're hitting a
>> frustrating problem at the moment. (The names have been changed to protect
>> the innocent).
>>
>> NOT_FOUND - no binding BINDING_NAME between exchange 'amq.direct' in
>> vhost 'MYVHOST' and queue 'QUEUENAME' in vhost 'MYVHOST'
>>
>> This should be a binding that already exists, but for this queue it
>> doesn't.  When trying to create it from the management UI we get the error
>> (or from the http api)... if we change just one character in the routing
>> key it works... that's not what we want, but it tells me there's something
>> deeper wrong.
>>
>> This is our development cluster, so we can do whatever to it...
>>
>> It's a three node cluster, each node on it's own VM.
>>
>> Any help in resolving this would be great.  We're banging our head
>> against our desks on this one.
>>
>> Thanks,
>> Dan.
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/e92a2f13/attachment.html>

From manish.ranade at gmail.com  Tue Jun 17 20:55:44 2014
From: manish.ranade at gmail.com (Manish Ranade)
Date: Tue, 17 Jun 2014 12:55:44 -0700
Subject: [rabbitmq-discuss] Question about Scheduled Message Delivery
Message-ID: <CAHm3MGNw+Ey_x3ACE5WC4nqOAR1q6ybsiaC5Z3bGj+y4TRd5Fw@mail.gmail.com>

I have a situation where I am trying to decide if its the right use case to
use RabbitMQ. I have limited knowledge about Queues so my question might
sound too naive.

We have an application that allows users to submit a request that needs to
be processed on a specific time and date in the future. If there was no
constraint of time and date, we would have put the request in a queue and
have the consumer pick the request one by one and process them. However,
considering my scenario?

Is it possible to publish a message to be consumed at later stage?

-Manish
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/3e8cfbfa/attachment.html>

From Andrew.Miller at sentry.com  Tue Jun 17 22:01:34 2014
From: Andrew.Miller at sentry.com (Miller Andrew)
Date: Tue, 17 Jun 2014 16:01:34 -0500
Subject: [rabbitmq-discuss] TypeError: Cannot read property 'ram_msg_count'
	of undefined
Message-ID: <6DA47758DD70A84CAB1C2A6629FEC4D387927DA0@sho-p-excmbx-02.sentry.com>

Hello,

We have a two-node RabbitMQ cluster running on RabbitMQ 3.2.2, Erlang R16B03-1 on Windows servers.  We've had multiple issues over the past few days:
Sunday, 6/15/2014 - Network partition because of some planned network upgrade; restarted both nodes in sequence
Monday, 6/16/2014 - Rouge client created 5000+ concurrent connections to Rabbit; restarted both nodes in sequence and eventually tracked down and killed client

This question is primarily about the problem that occurred on Monday.  After the first node was restarted, the following messages were logged:

=INFO REPORT==== 16-Jun-2014::17:00:47 ===
Starting RabbitMQ 3.2.2 on Erlang R16B03-1
Copyright (C) 2007-2013 GoPivotal, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

...

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
Discarding message {'$gen_call',{<0.254.0>,#Ref<0.0.0.1304>},{add_on_right,{56,<0.254.0>}}} from <0.254.0> to <0.16165.62> in an old incarnation (1) of this node (2)

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
Discarding message {'$gen_call',{<0.256.0>,#Ref<0.0.0.1311>},{add_on_right,{56,<0.256.0>}}} from <0.256.0> to <0.16138.62> in an old incarnation (1) of this node (2)

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
Discarding message {'$gen_call',{<0.258.0>,#Ref<0.0.0.1511>},{add_on_right,{56,<0.258.0>}}} from <0.258.0> to <0.16190.62> in an old incarnation (1) of this node (2)

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
Discarding message {'$gen_call',{<0.260.0>,#Ref<0.0.0.1536>},{add_on_right,{29,<0.260.0>}}} from <0.260.0> to <0.16200.62> in an old incarnation (1) of this node (2)

=INFO REPORT==== 16-Jun-2014::17:00:49 ===
Adding mirror of queue 'SalesCenter.BPBilling_AccountDelinquent' in vhost 'eventing' on node 'rabbit at SHO-P-EVGAPP-02': <5578.16037.65>

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
** Generic server <0.250.0> terminating
** Last message in was {init,<0.185.0>}
** When Server state == {q,{amqqueue,
                               {resource,<<"eventing">>,queue,
                                   <<"SalesCenter.AMS_ErrorsAndOmissions30DayExpiration">>},
                               true,false,none,
                               [{<<"x-dead-letter-exchange">>,longstr,
                                 <<"EnterpriseEventDeadLetter">>},
                                {<<"x-dead-letter-routing-key">>,longstr,
                                 <<"SalesCenter.AMS_ErrorsAndOmissions30DayExpiration">>}],
                               <0.250.0>,[],[],
                               [{vhost,<<"eventing">>},
                                {name,<<"ha-all">>},
                                {pattern,<<"^.*">>},
                                {'apply-to',<<"queues">>},
                                {definition,
                                    [{<<"ha-mode">>,<<"all">>},
                                     {<<"ha-sync-mode">>,<<"automatic">>}]},
                                {priority,0}],
                               [],[]},
                           none,false,undefined,undefined,
                           {queue,[],[],0},
                           undefined,undefined,undefined,undefined,
                           {state,fine,5000,undefined},
                           {0,nil},
                           undefined,undefined,undefined,
                           {state,
                               {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                               delegate},
                           undefined,undefined,undefined,0,running}
** Reason for termination ==
** {{function_clause,
        [{rabbit_mirror_queue_slave,terminate,
             [{{badmatch,true},
               [{rabbit_queue_index,init,2,[]},
                {rabbit_variable_queue,init,5,[]},
                {rabbit_mirror_queue_slave,handle_go,1,[]},
                {rabbit_mirror_queue_slave,handle_call,3,[]},
                {gen_server2,handle_msg,2,[]},
                {proc_lib,init_p_do_apply,3,
                    [{file,"proc_lib.erl"},{line,239}]}]},
              {not_started,
                  {amqqueue,
                      {resource,<<"eventing">>,queue,
                          <<"SalesCenter.AMS_ErrorsAndOmissions30DayExpiration">>},
                      true,false,none,
                      [{<<"x-dead-letter-exchange">>,longstr,
                        <<"EnterpriseEventDeadLetter">>},
                       {<<"x-dead-letter-routing-key">>,longstr,
                        <<"SalesCenter.AMS_ErrorsAndOmissions30DayExpiration">>}],
                      <0.250.0>,[],[],
                      [{vhost,<<"eventing">>},
                       {name,<<"ha-all">>},
                       {pattern,<<"^.*">>},
                       {'apply-to',<<"queues">>},
                       {definition,
                           [{<<"ha-mode">>,<<"all">>},
                            {<<"ha-sync-mode">>,<<"automatic">>}]},
                       {priority,0}],
                      [{<0.256.0>,<0.250.0>}],
                      []}}],
             []},
        {gen_server2,terminate,3,[]},
         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},
    {gen_server2,call,[<5578.15838.65>,go,infinity]}}

After this, when going to the queue page (/#/queues/eventing/SalesCenter.AMS_ErrorsAndOmissions30DayExpiration) in the management console, I get TypeError: Cannot read property 'ram_msg_count' of undefined.  On the list of queues, this queue is listed as "Active" (most queues are listed as "Idle") and the Read/Unacked/Total messages for this queue shows question marks. The only way we were able to resolve was to stop the cluster entirely and start it back up.

Any thoughts on what went wrong, or how to avoid it in the future?

Thanks,
Andrew Miller

This e-mail is confidential.  If you are not the intended recipient, you must not disclose or use the information contained in it. If you have received this e-mail in error, please tell us immediately by return e-mail and delete the document. No recipient may use the information in this e-mail in violation of any civil or criminal statute. Sentry disclaims all liability for any unauthorized uses of this e-mail or its contents. Sentry accepts no liability or responsibility for any damage caused by any virus transmitted with this e-mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/b18e501e/attachment.html>

From mklishin at gopivotal.com  Tue Jun 17 23:40:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 02:40:09 +0400
Subject: [rabbitmq-discuss] Question about Scheduled Message Delivery
In-Reply-To: <CAHm3MGNw+Ey_x3ACE5WC4nqOAR1q6ybsiaC5Z3bGj+y4TRd5Fw@mail.gmail.com>
References: <CAHm3MGNw+Ey_x3ACE5WC4nqOAR1q6ybsiaC5Z3bGj+y4TRd5Fw@mail.gmail.com>
Message-ID: <etPan.53a0c3e4.6b8b4567.cdec@mercurio.local>

On 17 June 2014 at 23:58:00, Manish Ranade (manish.ranade at gmail.com) wrote:
> > We have an application that allows users to submit a request  
> that needs to be processed on a specific time and date in the future.  
> If there was no constraint of time and date, we would have put the  
> request in a queue and have the consumer pick the request one by  
> one and process them. However, considering my scenario?
>  
> Is it possible to publish a message to be consumed at later stage?  

RabbitMQ does not perform this kind of scheduling. It can be extended to do
this (by implementing a custom exchange in Erlang) but it remains to be seen
how good that approach will actually work.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From dburke at addictmud.org  Wed Jun 18 00:41:04 2014
From: dburke at addictmud.org (Daniel W. Burke)
Date: Tue, 17 Jun 2014 19:41:04 -0400
Subject: [rabbitmq-discuss] Question about Scheduled Message Delivery
In-Reply-To: <etPan.53a0c3e4.6b8b4567.cdec@mercurio.local>
References: <CAHm3MGNw+Ey_x3ACE5WC4nqOAR1q6ybsiaC5Z3bGj+y4TRd5Fw@mail.gmail.com>
 <etPan.53a0c3e4.6b8b4567.cdec@mercurio.local>
Message-ID: <CAH8FpARRLoPFtmO71KDpJOvAp3h6Ww9wjFah-zq=qr915vdBiA@mail.gmail.com>

We got around this by implementing a temporary queue that set its
x-dead-letter-routing-key to the queue we want it delivered to, and then
use a combination of x-expires and message-ttl to have the message
delivered to the "real" queue at the desired time, and then the queue
deletes itself effectively cleaning things up all nice and neat.

The downside is that you are really using one queue per message that is
delayed, it doesn't seem to be a problem for us, but YMMV.

We used perl, but here is where we got the idea...

http://www.javacodegeeks.com/2012/04/rabbitmq-scheduled-message-delivery.html

Dan.



On Tue, Jun 17, 2014 at 6:40 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 17 June 2014 at 23:58:00, Manish Ranade (manish.ranade at gmail.com)
> wrote:
> > > We have an application that allows users to submit a request
> > that needs to be processed on a specific time and date in the future.
> > If there was no constraint of time and date, we would have put the
> > request in a queue and have the consumer pick the request one by
> > one and process them. However, considering my scenario?
> >
> > Is it possible to publish a message to be consumed at later stage?
>
> RabbitMQ does not perform this kind of scheduling. It can be extended to do
> this (by implementing a custom exchange in Erlang) but it remains to be
> seen
> how good that approach will actually work.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/1e75b814/attachment.html>

From manish.ranade at gmail.com  Wed Jun 18 01:16:20 2014
From: manish.ranade at gmail.com (Manish Ranade)
Date: Tue, 17 Jun 2014 17:16:20 -0700
Subject: [rabbitmq-discuss] Question about Scheduled Message Delivery
In-Reply-To: <CAH8FpARRLoPFtmO71KDpJOvAp3h6Ww9wjFah-zq=qr915vdBiA@mail.gmail.com>
References: <CAHm3MGNw+Ey_x3ACE5WC4nqOAR1q6ybsiaC5Z3bGj+y4TRd5Fw@mail.gmail.com>
 <etPan.53a0c3e4.6b8b4567.cdec@mercurio.local>
 <CAH8FpARRLoPFtmO71KDpJOvAp3h6Ww9wjFah-zq=qr915vdBiA@mail.gmail.com>
Message-ID: <CAHm3MGPyxvVbtzmBhpRgsMM8pomkRhgeAYBeES_wQZPMaMNOdw@mail.gmail.com>

Dan and Michael,

Thanks for the reply. Do you know if there is any open source Message Queue
that supports this functionality?

If not, I'll have to go with the solution Dan outlined.

-Manish


On Tue, Jun 17, 2014 at 4:41 PM, Daniel W. Burke <dburke at addictmud.org>
wrote:

> We got around this by implementing a temporary queue that set its
> x-dead-letter-routing-key to the queue we want it delivered to, and then
> use a combination of x-expires and message-ttl to have the message
> delivered to the "real" queue at the desired time, and then the queue
> deletes itself effectively cleaning things up all nice and neat.
>
> The downside is that you are really using one queue per message that is
> delayed, it doesn't seem to be a problem for us, but YMMV.
>
> We used perl, but here is where we got the idea...
>
>
> http://www.javacodegeeks.com/2012/04/rabbitmq-scheduled-message-delivery.html
>
> Dan.
>
>
>
> On Tue, Jun 17, 2014 at 6:40 PM, Michael Klishin <mklishin at gopivotal.com>
> wrote:
>
>> On 17 June 2014 at 23:58:00, Manish Ranade (manish.ranade at gmail.com)
>> wrote:
>> > > We have an application that allows users to submit a request
>> > that needs to be processed on a specific time and date in the future.
>> > If there was no constraint of time and date, we would have put the
>> > request in a queue and have the consumer pick the request one by
>> > one and process them. However, considering my scenario?
>> >
>> > Is it possible to publish a message to be consumed at later stage?
>>
>> RabbitMQ does not perform this kind of scheduling. It can be extended to
>> do
>> this (by implementing a custom exchange in Erlang) but it remains to be
>> seen
>> how good that approach will actually work.
>> --
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Regards,
Manish Ranade
Phone: 408-596-6546
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/7b9a4e0d/attachment.html>

From kirk at stork.name  Wed Jun 18 01:51:40 2014
From: kirk at stork.name (kz)
Date: Wed, 18 Jun 2014 00:51:40 +0000 (UTC)
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
Message-ID: <loom.20140618T023106-104@post.gmane.org>

So I've followed the instructions for setting up SSL listener for web-stomp.

eg:

[
{rabbit, [{loopback_users, []}]},
{rabbitmq_web_stomp, [
  {ssl_config, [
    {port, 15671},
    {backlog, 1024},
    {cacertfile, "/etc/rabbitmq/certs/cacerts.pem"},
    {certfile, "/etc/rabbitmq/certs/server.pem"},
    {keyfile, "/etc/rabbitmq/certs/serverkey.pem"},
    {password, "changeme"}
    ]}]}
].


This results in the log stating there's an HTTPS listener on port 15671 -- 
check.

But local requests to that port result in an openssl error 111, and remote 
requests result in an  openssl error 61.

The certificate is a wildcard cert that is issued by a commercial vendor.  I've
 installed their 
intermediate certs in the cacerts.pem mentioned above.

My key file is signed with -des and functions when testing with openssl 
s_server and s_client

(however, that test does indicate error 19 (some certificate in the chain is 
self-signed).  This is 
false, but the warning is issued nonetheless.

The only log that indicates an error has occurred is the sasl log.

eg:

=CRASH REPORT==== 18-Jun-2014::00:22:07 ===
  crasher:
    initial call: supervisor:cowboy_acceptors_sup/1
    pid: <0.352.0>
    registered_name: []
    exception exit: {{case_clause,{error,{not_started,asn1}}},
                     [{cowboy_ssl_transport,require,1,[]},
                      {cowboy_ssl_transport,listen,1,[]},
                      {cowboy_acceptors_sup,init,1,[]},
                      {supervisor,init,1,[{file,"supervisor.erl"},{line,239}]},
                      {gen_server,init_it,6,
                                  [{file,"gen_server.erl"},{line,304}]},
                      {proc_lib,init_p_do_apply,3,
                                [{file,"proc_lib.erl"},{line,239}]}]}
      in function  gen_server:init_it/6 (gen_server.erl, line 328)
    ancestors: [<0.349.0>,cowboy_sup,<0.57.0>]
    messages: []
    links: [<0.349.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 610
    stack_size: 27
    reductions: 169
  neighbours:
root at ip-10-221-13-201:/var/log/rabbitmq#


Now, I'm not trying to challenge web requests with a certificate, and anyway 
this error shows up 
before any requests are made.

The other aspects of RabbitMQ appear to be operating normally.  AMQP 
connections  can be made, and the web interface can be reached over 
http on the normal port.  If I don't 
configure SSL for  web-stomp, then non-ssl http requests to the stomp
endpoint work as expected.

So my questions:

1. Is there ANY OTHER place in the setup that I have to configure 
certificates in addition to the  web-stomp plugin config?

2. Is the self-signed warning an indication that I need to place the ENTIRE
 certificate chain of trust 
into my cacerts file? (currently I only put the vendor's intermediate certs, 
per their instructions)

3. Can firewall rules cause this kind of startup error? (I'm running on AWS 
and I've only opened the 
ports I need for RabbitMQ and the web-related plugins for RabbitMQ.


This is ubuntu trusty 64 bit with Erlang R16B03 (erts-5.10.4) and 
 rabbitmq-server_3.3.3-1_all.deb 
package.







From gavinmroy at gmail.com  Wed Jun 18 02:36:27 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Tue, 17 Jun 2014 21:36:27 -0400
Subject: [rabbitmq-discuss] Plugin startup behavior issue
In-Reply-To: <53A079BB.6090209@rabbitmq.com>
References: <etPan.539fba68.6b8b4567.102e9@gmr-home.local>
 <539FF03C.2030203@rabbitmq.com>
 <etPan.53a050df.6b8b4567.139b7@s826.ofc.lair>
 <53A079BB.6090209@rabbitmq.com>
Message-ID: <etPan.53a0ed1b.643c9869.102e9@gmr-home.local>

On June 17, 2014 at?1:24:14 PM, Simon MacMullen (simon at rabbitmq.com) wrote:

Probably the right solution is for the empty_db_check to only check for?
absent vhosts and exchanges. I'll file a bug for that.?
Cool, makes sense.

But how can you work around this? I don't think you can tweak the boot?
steps required by your supervisor, but I think:?

start_link() ->?
+ rabbit:maybe_insert_default_data(),?
mirrored_supervisor:start_link(?
{local, ?MODULE}, ?MODULE,?
fun rabbit_misc:execute_mnesia_transaction/1,?

is a reasonable workaround.?
Thanks! Indeed that works fine. Thank you very much for investigating.

I ran into one other issue on startup, having to do with rabbit_direct_client being available. The solution I came up with was to use timers to defer the commands until rabbit_direct_client_sup exists. Does this seem like a sane approach?

https://github.com/aweber/pgsql-listen-exchange/commit/c60d6dcc982056978750fe218e9a1ae2bf895aa3

Thanks for all your help,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/f4e2b543/attachment.html>

From mklishin at gopivotal.com  Wed Jun 18 02:39:59 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 05:39:59 +0400
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <loom.20140618T023106-104@post.gmane.org>
References: <loom.20140618T023106-104@post.gmane.org>
Message-ID: <etPan.53a0ee09.19495cff.cdec@mercurio.local>



On 18 June 2014 at 04:56:28, kz (kirk at stork.name) wrote:
> > exception exit: {{case_clause,{error,{not_started,asn1}}},  
> [{cowboy_ssl_transport,require,1,[]},

This means a dependency of Web STOMP failed to start because its own
dependency (the asn1 app from OTP) failed to start.

What Erlang version do you run? This is a known problem that we work
around in other areas, should do the same for Web STOMP. It is Erlang/OTP-version
specific AFAIR.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From youpingl at sina.com  Wed Jun 18 02:50:30 2014
From: youpingl at sina.com (=?utf-8?B?eW91cGluZ2w=?=)
Date: Wed, 18 Jun 2014 09:50:30 +0800
Subject: [rabbitmq-discuss] =?utf-8?q?client=5Ftimeout_errors?=
References: <201406171713206107562@sina.com>
Message-ID: <201406180950296971069@sina.com>

1,The architecture of my application is: stomp clients(more than one thousand) + Java amqp servers(several)---haproxy---rabbitmq(cluster of two nodes)

2,The performace of rabbitmq dropped a lot when the client_timeout crash errors report frequently 

3,The stomp client creates a connection to rabbitmq long term at boot time, and it sends hearbeat frame per 10 seconds when no task of rpc, and it does not closing the connection explicitly when abort or exit. 

4,The client timeout param of haproxy set to 120 seconds, and the heartbeat param of rabbitmq set  to 580 seconds. 

How can I solve this problem?      

2014-06-18 09:11:28



youpingl




???? Michael Klishin 
????? 2014-06-17  17:28:29 
???? youpingl; Discussions about RabbitMQ 
??? 
??? Re: [rabbitmq-discuss] client_timeout errors 
On 17 June 2014 at 13:14:01, youpingl (youpingl at sina.com) wrote:
> > I used the delphi stomp client(v1.7) to connect the Rabbitmq  
> server(v3.3.2) for RPC. But the Rabbitmq server appears errors  
> report list below occasionally, what happens?
This means a STOMP client missed a heartbeat. Mind you, we should log
something more sensible here but ultimately it is a network connectivity
issue between your client and RabbitMQ node it connects to. 
--  
MK  
Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/cd436d9f/attachment.html>

From mklishin at gopivotal.com  Wed Jun 18 03:29:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 06:29:09 +0400
Subject: [rabbitmq-discuss] client_timeout errors
In-Reply-To: <201406180950296971069@sina.com>
References: <201406171713206107562@sina.com> <201406180950296971069@sina.com>
Message-ID: <etPan.53a0f98e.625558ec.cdec@mercurio.local>



On 18 June 2014 at 05:49:42, youpingl (youpingl at sina.com) wrote:
> > 3,The stomp client creates a connection to rabbitmq long term  
> at boot time, and it sends hearbeat frame per 10 seconds when no  
> task of rpc, and it does not closing the connection explicitly  
> when abort or exit.
>  
> 4,The client timeout param of haproxy set to 120 seconds, and  
> the heartbeat param of rabbitmq set to 580 seconds.
>  
> How can I solve this problem?

Disabling heartbeats for STOMP connections should help. In STOMP
you can configure heartbeats bi-directionally:

http://stomp.github.io/stomp-specification-1.2.html#Heart-beating

I'm investigating what exactly the issue is in the STOMP plugin.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 18 03:34:35 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 06:34:35 +0400
Subject: [rabbitmq-discuss] client_timeout errors
In-Reply-To: <etPan.53a0f98e.625558ec.cdec@mercurio.local>
References: <201406171713206107562@sina.com> <201406180950296971069@sina.com>
 <etPan.53a0f98e.625558ec.cdec@mercurio.local>
Message-ID: <etPan.53a0fad9.238e1f29.cdec@mercurio.local>



On 18 June 2014 at 06:30:57, Michael Klishin (mklishin at gopivotal.com) wrote:
> > I'm investigating what exactly the issue is in the STOMP plugin. 

Using a modified STOMP client that never sends heartbeat reproduces the
problem.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From youpingl at sina.com  Wed Jun 18 03:47:50 2014
From: youpingl at sina.com (=?utf-8?B?eW91cGluZ2w=?=)
Date: Wed, 18 Jun 2014 10:47:50 +0800
Subject: [rabbitmq-discuss] =?utf-8?q?client=5Ftimeout_errors?=
References: <201406171713206107562@sina.com>, <201406180950296971069@sina.com>,
 <etPan.53a0f98e.625558ec.cdec@mercurio.local>,
 <etPan.53a0fad9.238e1f29.cdec@mercurio.local>
Message-ID: <201406181045088842871@sina.com>

if I used a stomp client that never sends heartbeat, the haproxy should close the connection when client had no operations in 120 seconds.  


2014-06-18 10:42:19



???  ??????????????
????????????????3????????12??610041?
???13980648555
???liuyp2 at asiainfo-linkage.com  



???? Michael Klishin 
????? 2014-06-18  10:35:13 
???? youpingl; Discussions about RabbitMQ 
??? 
??? Re: [rabbitmq-discuss] client_timeout errors 
On 18 June 2014 at 06:30:57, Michael Klishin (mklishin at gopivotal.com) wrote:
> > I'm investigating what exactly the issue is in the STOMP plugin. 
Using a modified STOMP client that never sends heartbeat reproduces the
problem.
-- 
MK 
Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/e659f4f2/attachment.html>

From theonlyandrei at gmail.com  Wed Jun 18 04:43:14 2014
From: theonlyandrei at gmail.com (Andrei)
Date: Tue, 17 Jun 2014 23:43:14 -0400
Subject: [rabbitmq-discuss] Queue data recovery after master failure
Message-ID: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>

We have a 12 node cluster with dozens of mirrored queues (2 slaves per queue). 
Here's the scenario we're trying to understand how to recover from.

Say we have a complete power failure and when power is restored one of the nodes is dead. 
For at least one queue, that node used to be the master node. The queue is now unresponsive, which is somewhat expected (no failover happened before the crash so we now have 2 slaves). The queue data (messages) must be physically present on at least one slave (at least one of those is a disc node). However, we seem to have no way to recover the queue and keep that data. 
If we bring a new node up to replace the old one (we reset the old one to simulate a fresh node), the queue becomes available but it's now empty (we assume this to be the result of the - now empty - master synchronizing with the slaves, sort of in the "opposite direction" of what we'd like). 
Is there a way to either designate the slave that still has the data as a master for the troubled queue, or to push that queue data to the new (resurrected) node? 

Thanks is advance!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/7d8924df/attachment.html>

From Rohit.Patle at techmahindra.com  Wed Jun 18 07:28:06 2014
From: Rohit.Patle at techmahindra.com (Rohit Patle)
Date: Wed, 18 Jun 2014 06:28:06 +0000
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <etPan.53a00f9a.12200854.b262@mercurio.local>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00593.2eb141f2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a0081e.79e2a9e3.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CFF@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00bdc.5bd062c2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688D0C@BSDMSATMBX001.mahindrasatyam.ad>,
 <etPan.53a00f9a.12200854.b262@mercurio.local>
Message-ID: <27E054594442884E9A46DBCF9AE74081688D80@BSDMSATMBX001.mahindrasatyam.ad>

Hi Michael,

The outcome of openssl tool is different in different scenarios, when I assign the the client dynamic ip the outcome of : "openssl s_client -host ms501.xxxxx.com -port 5671 -quiet -state"  is as follows

SSL_connect:before/connect initialization
SSL_connect:unknown state
SSL_connect:SSLv3 read server hello A
depth=1 CN = xxxxxxxx
verify error:num=19:self signed certificate in certificate chain
verify return:0
SSL_connect:SSLv3 read server certificate A
SSL_connect:SSLv3 read server certificate request A
SSL_connect:SSLv3 read server done A
SSL_connect:SSLv3 write client certificate A
SSL_connect:SSLv3 write client key exchange A
SSL_connect:SSLv3 write change cipher spec A
SSL_connect:SSLv3 write finished A
SSL_connect:SSLv3 flush data
SSL3 alert read:fatal:handshake failure
SSL_connect:failed in SSLv3 read finished A
3074099400:error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure:s3_pkt.c:1260:SSL alert number 40
3074099400:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake failure:s23_lib.c:177:

And when I assigned static ip the outcome of openssl tool  for the command :"openssl s_client -host ms501.xxxxx.com -port 5671 -quiet -state" is as:

gethostbyname failure
connect : errno=11

In both cases communication happens as expected. But the issue comes when I use the single static ip for two consumers.

Please advise.

Thanks & Regards,
Rohit

________________________________________
From: Michael Klishin [mklishin at gopivotal.com]
Sent: Tuesday, June 17, 2014 3:20 PM
To: Rohit Patle
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case

 On 17 June 2014 at 13:47:26, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > I believe it is not SSL handshake issue, because the connection
> is getting establish successfully, for both the connection
> I am getting comments in Rabbitmq log as "accepting AMQP connection"
> for the same ip's, but after some time like in a minute I am getting
> "AMQP_STATUS_SSL_ERROR" in my clients.

AMQP_STATUS_SSL_ERROR is very generic and without getting
more info from OpenSSL it's not really possible to tell what the problem is:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-September/030459.html

Try openssl s_client, it usually produces better error messages
and displays more info than almost any other tool out there.
--
MK

Software Engineer, Pivotal/RabbitMQ

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.

From haster2004 at yandex.ru  Wed Jun 18 09:12:26 2014
From: haster2004 at yandex.ru (Haster)
Date: Wed, 18 Jun 2014 01:12:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages are read by consumer befor than sender
	get confirmation
Message-ID: <1403079146148-36301.post@n5.nabble.com>

Hi folks,

I have a sender, that sends messages to some exchange EX and after that
waits confirmation from RabbitMQ
(I use confirmation mode + mandatory bit)
And there is a consumer that reads messages from queue QU that is bind to
EX.

And I have a situation then consumer get messages before sender receive
confirmation from RabbitMQ.

can I change this behavior?

And one more problem that I have...
I wait confirmation from RabbitMQ for some time and I often  get timeout,
but messages were published successfully (so timeout happend during I'm
waiting for ACK or RETURN method).
So can I change this situation and delete message from queue if I receive
timeout?

I think no, but maybe =)







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-are-read-by-consumer-befor-than-sender-get-confirmation-tp36301.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From kirk at stork.name  Wed Jun 18 05:45:59 2014
From: kirk at stork.name (Kirk Stork)
Date: Tue, 17 Jun 2014 21:45:59 -0700
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <etPan.53a0ee09.19495cff.cdec@mercurio.local>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
Message-ID: <1403066822-64665.203418692.fs5I4k0el024488@rs143.luxsci.com>

Well, the erlang REPL says this

Erlang R16B03 (erts-5.10.4)

Its been a while, but I believe the erlang package was installed on ubuntu as a dependency of the rabbitmq package.

I don't have to run Ubuntu trusty for this --  happy to spin up any kind of EC2 image that's needed.  Is there a recommended linux that RabbitMQ works well on out of the box?



On Jun 17, 2014, at 6:39 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

> 
> 
> On 18 June 2014 at 04:56:28, kz (kirk at stork.name) wrote:
>>> exception exit: {{case_clause,{error,{not_started,asn1}}},  
>> [{cowboy_ssl_transport,require,1,[]},
> 
> This means a dependency of Web STOMP failed to start because its own
> dependency (the asn1 app from OTP) failed to start.
> 
> What Erlang version do you run? This is a known problem that we work
> around in other areas, should do the same for Web STOMP. It is Erlang/OTP-version
> specific AFAIR. 
> --  
> MK  
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 


From kirk at stork.name  Wed Jun 18 08:09:10 2014
From: kirk at stork.name (Kirk Stork)
Date: Wed, 18 Jun 2014 00:09:10 -0700
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <etPan.53a0ee09.19495cff.cdec@mercurio.local>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
Message-ID: <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>

Just did a fresh build of an Ubuntu 14 LTS AMI, 64bit

Followed the instructions for installing rabbit here:

http://www.rabbitmq.com/ec2.html

I went as far as running the shell script provided.  I did not install erlang or 
anything else, just ran the script there.

Basics seemed to be working, including web interface.


I then configured the certs and the web-stomp ssl config.

Same result:

=CRASH REPORT==== 18-Jun-2014::06:58:54 ===
  crasher:
    initial call: supervisor:cowboy_acceptors_sup/1
    pid: <0.346.0>
    registered_name: []
    exception exit: {{case_clause,{error,{not_started,asn1}}},
                     [{cowboy_ssl_transport,require,1,[]},
                      {cowboy_ssl_transport,listen,1,[]},
                      {cowboy_acceptors_sup,init,1,[]},
                      {supervisor,init,1,[{file,"supervisor.erl"},{line,239}]},
                      {gen_server,init_it,6,
                                  [{file,"gen_server.erl"},{line,304}]},
                      {proc_lib,init_p_do_apply,3,
                                [{file,"proc_lib.erl"},{line,239}]}]}
      in function  gen_server:init_it/6 (gen_server.erl, line 328)
    ancestors: [<0.343.0>,cowboy_sup,<0.57.0>]
    messages: []
    links: [<0.343.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 610
    stack_size: 27
    reductions: 169
  neighbours:


So if it is a dependency problem as you suggest, then I guess the script isn't doing
everything -- where are are the additional steps documented (I've been
reading everything and anything I can find on this topic)?

Running the erl command line gives this for Erlang version info

Erlang R16B03 (erts-5.10.4)


On Jun 17, 2014, at 6:39 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

> 
> 
> On 18 June 2014 at 04:56:28, kz (kirk at stork.name) wrote:
>>> exception exit: {{case_clause,{error,{not_started,asn1}}},  
>> [{cowboy_ssl_transport,require,1,[]},
> 
> This means a dependency of Web STOMP failed to start because its own
> dependency (the asn1 app from OTP) failed to start.
> 
> What Erlang version do you run? This is a known problem that we work
> around in other areas, should do the same for Web STOMP. It is Erlang/OTP-version
> specific AFAIR. 
> --  
> MK  
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/6f48b789/attachment.html>

From simon at rabbitmq.com  Wed Jun 18 09:35:35 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jun 2014 09:35:35 +0100
Subject: [rabbitmq-discuss] TypeError: Cannot read property
 'ram_msg_count' of undefined
In-Reply-To: <6DA47758DD70A84CAB1C2A6629FEC4D387927DA0@sho-p-excmbx-02.sentry.com>
References: <6DA47758DD70A84CAB1C2A6629FEC4D387927DA0@sho-p-excmbx-02.sentry.com>
Message-ID: <53A14F57.8020603@rabbitmq.com>

On 17/06/2014 22:01, Miller Andrew wrote:
> ** Reason for termination ==
> ** {{function_clause,
>          [{rabbit_mirror_queue_slave,terminate,
>               [{{badmatch,true},
>                 [{rabbit_queue_index,init,2,[]},
>                  {rabbit_variable_queue,init,5,[]},
>                  {rabbit_mirror_queue_slave,handle_go,1,[]},
>                  {rabbit_mirror_queue_slave,handle_call,3,[]},
>                  {gen_server2,handle_msg,2,[]},

That's bug 26117, fixed in 3.3.1.

Cheers, Simon

From simon at rabbitmq.com  Wed Jun 18 09:42:19 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jun 2014 09:42:19 +0100
Subject: [rabbitmq-discuss] Queue data recovery after master failure
In-Reply-To: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>
References: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>
Message-ID: <53A150EB.9050109@rabbitmq.com>

On 18/06/2014 04:43, Andrei wrote:
> Is there a way to either designate the slave that still has the data as
> a master for the troubled queue, or to push that queue data to the new
> (resurrected) node?

I'm afraid not. Really "rabbitmqctl forget_cluster_node" should be able 
to cause down slaves to come back as new masters, which would be the 
right solution to this. I'm hoping that we'll be able to do that for 
3.4.0, but it's a somewhat intrusive change. The bug number for this 
branch will be 26191, so you can keep an eye on it in future (currently 
there's nothing there).

Cheers, Simon

From simon at rabbitmq.com  Wed Jun 18 09:53:28 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jun 2014 09:53:28 +0100
Subject: [rabbitmq-discuss] Unable to create exchange / queue binding
In-Reply-To: <CAH8FpAShVezEfu=51r5XMy-Dw+G_zJZCuZ42ZkAgnWQD68T=Rw@mail.gmail.com>
References: <CAH8FpAShVezEfu=51r5XMy-Dw+G_zJZCuZ42ZkAgnWQD68T=Rw@mail.gmail.com>
Message-ID: <53A15388.3000800@rabbitmq.com>

On 17/06/2014 19:03, Daniel W. Burke wrote:
> NOT_FOUND - no binding BINDING_NAME between exchange 'amq.direct' in
> vhost 'MYVHOST' and queue 'QUEUENAME' in vhost 'MYVHOST'
>
> This should be a binding that already exists, but for this queue it
> doesn't.  When trying to create it from the management UI we get the
> error (or from the http api)... if we change just one character in the
> routing key it works... that's not what we want, but it tells me there's
> something deeper wrong.

This message means that you are trying to create an already known 
binding to a queue whih is currently down (i.e. unmirrored and on a down 
node, or mirrored but only to a ste of nodes all of which are down).

Does that sound like what's happening?

Cheers, Simon

From xeonmailinglist at gmail.com  Wed Jun 18 10:15:14 2014
From: xeonmailinglist at gmail.com (xeon Mailinglist)
Date: Wed, 18 Jun 2014 02:15:14 -0700 (PDT)
Subject: [rabbitmq-discuss] how prevent overlapped messages?
Message-ID: <b9447afb-c02d-4f34-9c5f-1d49ce63c516@googlegroups.com>

I have 4 hosts connected with 4 queues to the RabbitMQ service. I have 
multiple processes making calls to each host using the queues, but what 
happens is that messages overlap giving me errors of execution. What should 
I do to prevent the processes do not overlap messages with the MQ using 
celery?

host1 <--queue1 -|
host2 <--queue2 -|--> MQ
host3 <--queue3 -|
host4 <--queue4 -|


Error because messages are overlapping.
  File "/usr/local/lib/python2.7/dist-packages/amqp/connection.py", line 
526, in _close
    (class_id, method_id), ConnectionError)
UnexpectedFrame: Basic.publish: (505) UNEXPECTED_FRAME - expected content 
header for class 60, got non content header frame instead
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/f65c0b6d/attachment.html>

From mklishin at gopivotal.com  Wed Jun 18 11:15:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 14:15:29 +0400
Subject: [rabbitmq-discuss] client_timeout errors
In-Reply-To: <201406181045088842871@sina.com>
References: <201406171713206107562@sina.com> <201406180950296971069@sina.com>
 <etPan.53a0f98e.625558ec.cdec@mercurio.local>
 <etPan.53a0fad9.238e1f29.cdec@mercurio.local>
 <201406181045088842871@sina.com>
Message-ID: <etPan.53a166db.3d1b58ba.cdec@mercurio.local>

?On 18 June 2014 at 06:48:20, youpingl (youpingl at sina.com) wrote:
> > if I used a stomp client that never sends heartbeat, the haproxy  
> should close the connection when client had no operations in  
> 120 seconds.

If the server sends heartbeats (one-way heartbeats are possible in STOMP),
proxies should still consider the connection alive.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 18 11:28:16 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 14:28:16 +0400
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
 <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>
Message-ID: <etPan.53a169dc.2eb141f2.cdec@mercurio.local>

On 18 June 2014 at 11:10:21, Kirk Stork (kirk at stork.name) wrote:
> > Just did a fresh build of an Ubuntu 14 LTS AMI, 64bit

which uses R16B03:
http://packages.ubuntu.com/trusty/erlang

The asn1 start changes were introduced in R16B01.
We are looking into workarounds that can be quickly rolled out.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 18 13:37:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 16:37:10 +0400
Subject: [rabbitmq-discuss] client_timeout errors
In-Reply-To: <etPan.53a0fad9.238e1f29.cdec@mercurio.local>
References: <201406171713206107562@sina.com> <201406180950296971069@sina.com>
 <etPan.53a0f98e.625558ec.cdec@mercurio.local>
 <etPan.53a0fad9.238e1f29.cdec@mercurio.local>
Message-ID: <etPan.53a18814.6b8b4567.f14@mercurio.local>

On 18 June 2014 at 06:35:08, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Using a modified STOMP client that never sends heartbeat reproduces 
> the
> problem.

A fix should appear in nightly builds tomorrow and will be in 3.3.4.

You will see missed heartbeats logged properly , too.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 18 14:49:49 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 17:49:49 +0400
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <etPan.53a169dc.2eb141f2.cdec@mercurio.local>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
 <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>
 <etPan.53a169dc.2eb141f2.cdec@mercurio.local>
Message-ID: <etPan.53a19919.643c9869.f14@mercurio.local>

On 18 June 2014 at 14:29:58, Michael Klishin (mklishin at gopivotal.com) wrote:
> > The asn1 start changes were introduced in R16B01.
> We are looking into workarounds that can be quickly rolled out.  

Figured out a solution that can be included in a bug fix release (3.3.4).

Will update this thread when a fix is out.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 18 15:20:14 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 18:20:14 +0400
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <etPan.53a19919.643c9869.f14@mercurio.local>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
 <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>
 <etPan.53a169dc.2eb141f2.cdec@mercurio.local>
 <etPan.53a19919.643c9869.f14@mercurio.local>
Message-ID: <etPan.53a1a03c.74b0dc51.f14@mercurio.local>



On 18 June 2014 at 17:51:42, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Figured out a solution that can be included in a bug fix release 
> (3.3.4).
> 
> Will update this thread when a fix is out.

http://hg.rabbitmq.com/rabbitmq-web-stomp/rev/6d26ad85f65f

Will be in 3.3.4.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 18 15:48:04 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Jun 2014 18:48:04 +0400
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <etPan.53a1a03c.74b0dc51.f14@mercurio.local>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
 <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>
 <etPan.53a169dc.2eb141f2.cdec@mercurio.local>
 <etPan.53a19919.643c9869.f14@mercurio.local>
 <etPan.53a1a03c.74b0dc51.f14@mercurio.local>
Message-ID: <etPan.53a1a6c1.2ae8944a.f14@mercurio.local>



On 18 June 2014 at 18:20:46, Michael Klishin (mklishin at gopivotal.com) wrote:
> > http://hg.rabbitmq.com/rabbitmq-web-stomp/rev/6d26ad85f65f  
>  
> Will be in 3.3.4.

Also, while investigating and verifying a fix, I discovered a workaround:
add an SSL listener to your rabbitmq.config (even if you're not going to use
SSL with AMQP 0-9-1), that will start asn1 and other dependencies before
Web STOMP is even started.

So, the problem manifests itself only when you have Web STOMP configured to
use SSL but not AMQP 0-9-1.

HTH.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From sp345s at att.com  Wed Jun 18 16:05:55 2014
From: sp345s at att.com (PATAR, SAGAR)
Date: Wed, 18 Jun 2014 15:05:55 +0000
Subject: [rabbitmq-discuss] binding
Message-ID: <59BF56992750434F89F8EBE141E64B1D0222C7D0@GAALPA1MSGUSRAA.ITServices.sbc.com>


We have a requirement to have a binding on two header fields as below .. Not sure if we can do it in one binding instead of breaking into multiple bindings

srcGwyGuId=GGUID1 AND srcOId=OID1 or OID2 or OID3 .....


I guess We should be able to get it done with multiple bindings as below ...

Binding1: srcGwyGuId=GGUID1 AND srcOId=OID1
Binding2: srcGwyGuId=GGUID1 AND srcOId=OID2
Binding2: srcGwyGuId=GGUID1 AND srcOId=OID3


Please suggest if there is a better way .. If NOT we will end up creating thousands of bindings  and NOT sure how many does rabbit MQ support??

Appreciate all the help..

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/a2a1dccb/attachment.html>

From theonlyandrei at gmail.com  Wed Jun 18 16:21:01 2014
From: theonlyandrei at gmail.com (Andrei D.)
Date: Wed, 18 Jun 2014 08:21:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue data recovery after master failure
In-Reply-To: <53A150EB.9050109@rabbitmq.com>
References: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>
 <53A150EB.9050109@rabbitmq.com>
Message-ID: <1403104861818-36315.post@n5.nabble.com>

Thanks for the quick response Simon.
I assume there's no easy workaround? (such as manually extracting the queue
data from the slave and copying it to the new master before it rejoins the
cluster; I'm not familiar with the rabbit queue data storage format so I'm
not sure if that's feasible - probably not since you haven't mentioned it ;)
)
ps: couldn't access the 26191 in bugzilla, I assume it's private to
contributors? 

thanks, andrei



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Queue-data-recovery-after-master-failure-tp36298p36315.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Jun 18 16:22:13 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jun 2014 16:22:13 +0100
Subject: [rabbitmq-discuss] Messages are read by consumer befor than
 sender get confirmation
In-Reply-To: <1403079146148-36301.post@n5.nabble.com>
References: <1403079146148-36301.post@n5.nabble.com>
Message-ID: <53A1AEA5.7090504@rabbitmq.com>

On 18/06/14 09:12, Haster wrote:
> Hi folks,
>
> I have a sender, that sends messages to some exchange EX and after that
> waits confirmation from RabbitMQ
> (I use confirmation mode + mandatory bit)
> And there is a consumer that reads messages from queue QU that is bind to
> EX.
>
> And I have a situation then consumer get messages before sender receive
> confirmation from RabbitMQ.
>
> can I change this behavior?

No, that's an optimisation. When the message is persistent it can be 
delivered to the consumer before it's been written to disk, and thus 
before the publisher receives a confirm.

> And one more problem that I have...
> I wait confirmation from RabbitMQ for some time and I often  get timeout,
> but messages were published successfully (so timeout happend during I'm
> waiting for ACK or RETURN method).
> So can I change this situation and delete message from queue if I receive
> timeout?
>
> I think no, but maybe =)

I'm afraid not. Those timeouts are presumably implemented in your 
client, they're not a protocol-level thing. So the server never knows 
they've fired.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Jun 18 16:30:58 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jun 2014 16:30:58 +0100
Subject: [rabbitmq-discuss] binding
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0222C7D0@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0222C7D0@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <53A1B0B2.3030607@rabbitmq.com>

On 18/06/14 16:05, PATAR, SAGAR wrote:
> We have a requirement to have a binding on two header fields as below ..
> Not sure if we can do it in one binding instead of breaking into
> multiple bindings
>
> *srcGwyGuId=GGUID1 AND srcOId=OID1 or OID2 or OID3 ?..*

The headers exchange does not support arbitrary expressions like that. 
If any community members are feeling enthusiastic then such a thing 
might make a nifty plugin.

> I guess We should be able to get it done with multiple bindings as below ?
>
> Binding1: srcGwyGuId=GGUID1 AND srcOId=OID1
>
> Binding2: srcGwyGuId=GGUID1 AND srcOId=OID2
>
> Binding2: srcGwyGuId=GGUID1 AND srcOId=OID3
>
> Please suggest if there is a better way

If your pattern tends to be that you have a few different srcGwyGuIds 
but lots and lots of srcOIds then it might be easier to do it with an 
intermediate exchange for each srcGwyGuId value and then a single bindig 
with x-match=any for each set of srcOids.

> .. If NOT we will end up
> creating thousands of bindings  and NOT sure how many does rabbit MQ
> support??

You might keep an eye on how much memory is used by Mnesia in mgmt / 
"rabbitmqctl status" since all bindings have to live in memory, but I 
think thousands will be fine.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Jun 18 16:42:07 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jun 2014 16:42:07 +0100
Subject: [rabbitmq-discuss] Queue data recovery after master failure
In-Reply-To: <1403104861818-36315.post@n5.nabble.com>
References: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>
 <53A150EB.9050109@rabbitmq.com> <1403104861818-36315.post@n5.nabble.com>
Message-ID: <53A1B34F.60307@rabbitmq.com>

On 18/06/14 16:21, Andrei D. wrote:
> Thanks for the quick response Simon.
> I assume there's no easy workaround?

I can't think of an easy one. If I was desperate then I would try the 
following, assuming we start from a completely stopped cluster:

0) Back up Mnesia dirs on all machines, obviously.

1) Start a slave node with RABBITMQ_NODE_ONLY set. Make sure it is set, 
or the slave will start the rabbit app which will clear out the slave's 
persistent storage, and you restore from 0).

2) Run "rabbitmqctl forget_cluster_node --offline <dead-master>"

3) Start the mnesia app on the slave.

4) Update the rabbit_durable_queue records for queues that need 
recovering from this slave, moving the slave pid for the appropriate 
node() from the 'slave_pids' field to the 'pid' field.

5) Start the rabbit app on the slave.

I think that stands a decent chance of working, but obviously the 
usability of such a solution is exceptionally poor. Step 4) in 
particular would require some Erlang programming.

> (such as manually extracting the queue
> data from the slave and copying it to the new master before it rejoins the
> cluster; I'm not familiar with the rabbit queue data storage format so I'm
> not sure if that's feasible - probably not since you haven't mentioned it ;)

I'm not sure how well that would work, you'd have the problem that you 
need not just the individual queue's index files but also the files 
containing that queue's messages from the message store. I can't see 
that being fun to sort out.

> ps: couldn't access the 26191 in bugzilla, I assume it's private to
> contributors?

Yes. But you can look out for it in future release notes, and as a 
branch in hg.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From andrei002 at gmail.com  Wed Jun 18 16:51:56 2014
From: andrei002 at gmail.com (Andrei)
Date: Wed, 18 Jun 2014 18:51:56 +0300
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <etPan.539b7b20.643c9869.83e5@mercurio.local>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
 <etPan.539b3300.6b8b4567.50e9@mercurio.local>
 <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>
 <etPan.539b7b20.643c9869.83e5@mercurio.local>
Message-ID: <CANcm3vkc0JxpjosSiY43k-=wSL74CB-=ni+s4hNR3cuJ00hJyQ@mail.gmail.com>

Hi Michael,

Thanks for the feedback!

I have a few more questions:

1. Is there any possibility for this feature to be implemented in one of
the next releases, in order for Web-STOMP to be fully compatible with STOMP
plugin?

2. In case it is too complex to implement due to lack of client SSL
authentication mechanisms in Cowboy, could it be implemented in the
following way, as a workaround?

a. On Websocket session initiation handshake over HTTP, Cowboy will receive
a HTTP header containing the username/password string from the client
(which in reality will contain the CN field stripped from the client
certificate and appended to the HTTP request by Nginx)

b. This string should probably be extracted from the request somewhere here:
http://hg.rabbitmq.com/sockjs-erlang-wrapper/file/6be67ee815ff/0003-websocket-subprotocol

c. And then sent down the calls as a parameter up to the call of the
rabbitmq_stomp_processor here (
http://hg.rabbitmq.com/rabbitmq-web-stomp/file/c3e862675fac/src/rabbit_ws_client_sup.erl),
or maybe earlier, and replace the username/password arguments of the
CONNECT STOMP command.

Thus, some default username/password strings sent from client JS code will
be replaced with this additional handshake HTTP header which will be sent
by Nginx and contain the CN field of the client certificate.

Unfortunately I'm not an Erlang developer, so much of this is wild
guessing..

Please let me know of your opinion on this approach, and I'd be really
grateful for some assistance with implementing the sockjs-erlang-wrapper
and Web-STOMP part of this solution, in case it looks to be feasible to
you..

Thanks a lot for checking this out!

Best regards,
Andy.

P.S.: Although you have CCd rabbitmq-discuss group in the previous
messages, somehow these are not visible to me on the Rabbitmq-discuss
Google Group. Are there some viewing or access restrictions set up?


On Sat, Jun 14, 2014 at 1:28 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 14 June 2014 at 02:21:50, Andrei (andrei002 at gmail.com) wrote:
> > > The question is whether the Web-STOMP plugin also has an option
> > like this, i.e. something like:
> > {rabbitmq_web_stomp, [{ssl_cert_login, true}]}
>
> No, it's not currently supported in Web-STOMP .
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/e787957c/attachment.html>

From theonlyandrei at gmail.com  Wed Jun 18 17:05:41 2014
From: theonlyandrei at gmail.com (Andrei D.)
Date: Wed, 18 Jun 2014 09:05:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue data recovery after master failure
In-Reply-To: <53A1B34F.60307@rabbitmq.com>
References: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>
 <53A150EB.9050109@rabbitmq.com> <1403104861818-36315.post@n5.nabble.com>
 <53A1B34F.60307@rabbitmq.com>
Message-ID: <1403107541703-36320.post@n5.nabble.com>

makes sense, thanks again



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Queue-data-recovery-after-master-failure-tp36298p36320.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From haster2004 at yandex.ru  Wed Jun 18 20:11:54 2014
From: haster2004 at yandex.ru (Haster)
Date: Wed, 18 Jun 2014 12:11:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages are read by consumer befor than
 sender get confirmation
In-Reply-To: <53A1AEA5.7090504@rabbitmq.com>
References: <1403079146148-36301.post@n5.nabble.com>
 <53A1AEA5.7090504@rabbitmq.com>
Message-ID: <1403118714222-36322.post@n5.nabble.com>

Simon, 
thanks a lot for answer



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-are-read-by-consumer-befor-than-sender-get-confirmation-tp36301p36322.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From VP889X at att.com  Wed Jun 18 15:59:52 2014
From: VP889X at att.com (VIJAYA SAGAR, VIJAYA)
Date: Wed, 18 Jun 2014 14:59:52 +0000
Subject: [rabbitmq-discuss] binding
Message-ID: <032880CAF3213B42B1AF7A5CA0B1DB9C014BE50F@GAALPA1MSGUSRAF.ITServices.sbc.com>


We have a requirement to have a binding on two header fields as below .. Not sure if we can do it in one binding instead of breaking into multiple bindings

srcGwyGuId=GGUID1 AND srcOId=OID1 or OID2 or OID3 .....


I guess We should be able to get it done with multiple bindings as below ...

Binding1: srcGwyGuId=GGUID1 AND srcOId=OID1
Binding2: srcGwyGuId=GGUID1 AND srcOId=OID2
Binding2: srcGwyGuId=GGUID1 AND srcOId=OID3


Please suggest if there is a better way .. If NOT we will end up creating thousands of bindings  and NOT sure how many does rabbit MQ support??

Appreciate all the help..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/3581ba34/attachment.html>

From kirk at stork.name  Wed Jun 18 19:56:03 2014
From: kirk at stork.name (Kirk Stork)
Date: Wed, 18 Jun 2014 11:56:03 -0700
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <etPan.53a1a6c1.2ae8944a.f14@mercurio.local>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
 <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>
 <etPan.53a169dc.2eb141f2.cdec@mercurio.local>
 <etPan.53a19919.643c9869.f14@mercurio.local>
 <etPan.53a1a03c.74b0dc51.f14@mercurio.local>
 <etPan.53a1a6c1.2ae8944a.f14@mercurio.local>
Message-ID: <20C19AEF-07DB-4700-8915-F66E9724E61A@stork.name>

Great.

Thanks for the workaround and the fix!

> On Jun 18, 2014, at 7:48 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
> 
> 
> 
> On 18 June 2014 at 18:20:46, Michael Klishin (mklishin at gopivotal.com) wrote:
>>> http://hg.rabbitmq.com/rabbitmq-web-stomp/rev/6d26ad85f65f  
>> 
>> Will be in 3.3.4.
> 
> Also, while investigating and verifying a fix, I discovered a workaround:
> add an SSL listener to your rabbitmq.config (even if you're not going to use
> SSL with AMQP 0-9-1), that will start asn1 and other dependencies before
> Web STOMP is even started.
> 
> So, the problem manifests itself only when you have Web STOMP configured to
> use SSL but not AMQP 0-9-1.
> 
> HTH. 
> --  
> MK  
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 

From sp345s at att.com  Wed Jun 18 20:33:14 2014
From: sp345s at att.com (PATAR, SAGAR)
Date: Wed, 18 Jun 2014 19:33:14 +0000
Subject: [rabbitmq-discuss] multiple exchange routing key
Message-ID: <59BF56992750434F89F8EBE141E64B1D0222C8BA@GAALPA1MSGUSRAA.ITServices.sbc.com>


I have multiple HEADER exchange and queues defined

Binding1 : FROM - Exchange 1-->(BINDING KEY *)--> TO - Exchange 2
Binding2 : FROM - Exchange 1-->(BINDING KEY *)--> TO - Queue 1
Binding3 : FROM - Exchange 2-->(BINDING KEY *)--> TO - Queue 2

I see messages in Queue 1 but NOT in Queue 2 and don't see message rate in Exchange 2 .. NOT sure if the messages are forwarded to Exchange 2..

My understanding is that we should be able to forward messages between Exchanges as well right ..??


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/08259654/attachment.html>

From michael at rabbitmq.com  Wed Jun 18 21:01:20 2014
From: michael at rabbitmq.com (Michael Klishin)
Date: Thu, 19 Jun 2014 00:01:20 +0400
Subject: [rabbitmq-discuss] multiple exchange routing key
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0222C8BA@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0222C8BA@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <D05835A9-8930-421B-A94A-1F7B15DE6688@rabbitmq.com>

Check your bindings and the x-match setting used by header exchanges.

MK

> On 18/06/2014, at 23:33, "PATAR, SAGAR" <sp345s at att.com> wrote:
> 
>  
> I have multiple HEADER exchange and queues defined
>  
> Binding1 : FROM - Exchange 1?(BINDING KEY *)? TO ? Exchange 2
> Binding2 : FROM - Exchange 1?(BINDING KEY *)? TO ? Queue 1
> Binding3 : FROM - Exchange 2?(BINDING KEY *)? TO ? Queue 2
>  
> I see messages in Queue 1 but NOT in Queue 2 and don?t see message rate in Exchange 2 .. NOT sure if the messages are forwarded to Exchange 2..
>  
> My understanding is that we should be able to forward messages between Exchanges as well right ..??
>  
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/be7f3371/attachment.html>

From kirk at stork.name  Thu Jun 19 01:57:50 2014
From: kirk at stork.name (Kirk Stork)
Date: Wed, 18 Jun 2014 17:57:50 -0700
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <etPan.53a1a6c1.2ae8944a.f14@mercurio.local>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
 <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>
 <etPan.53a169dc.2eb141f2.cdec@mercurio.local>
 <etPan.53a19919.643c9869.f14@mercurio.local>
 <etPan.53a1a03c.74b0dc51.f14@mercurio.local>
 <etPan.53a1a6c1.2ae8944a.f14@mercurio.local>
Message-ID: <1403139482-6313762.94882622.fs5J0vpBf015575@rs143.luxsci.com>

So I've tried the workaround.

The good:  there's no crash

The less good:

I see the SSL listeners now at ports 5761 (amqp) and 0.0.0.0:15671 (web-stomp)

But web connections fail with ERR_SSL_CLIENT_AUTH_SIGNATURE_FAILED

I've tried

[
{rabbit, [
	{loopback_users, []},
	{ssl_listeners, [5761]},
	{ssl_options, [
                     {certfile,   "/etc/rabbitmq/certs/cert.pem"},
                     {keyfile,    "/etc/rabbitmq/certs/key.pem"},
                     {cacertfile, "/etc/rabbitmq/certs/cacerts.pem"},
		     {password,   "changeme"},
		     {verify, verify_none},
		     {fail_if_no_peer_cert, false}
		     ]
}]},
{rabbitmq_web_stomp,
      [{ssl_config, [{port,       15671},
                     {backlog,    1024},
                     {certfile,   "/etc/rabbitmq/certs/cert.pem"},
                     {keyfile,    "/etc/rabbitmq/certs/key.pem"},
                     {cacertfile, "/etc/rabbitmq/certs/cacerts.pem"},
                     {password,   "changeme"}
]}]}
].

and I've tried


[
{rabbit, [
	{loopback_users, []},
	{ssl_listeners, [5761]},
	{ssl_options, [
                     {certfile,   "/etc/rabbitmq/certs/cert.pem"},
                     {keyfile,    "/etc/rabbitmq/certs/key.pem"},
                     {cacertfile, "/etc/rabbitmq/certs/cacerts.pem"},
		     {password,   "changeme"},
		     {verify, verify_none},
		     {fail_if_no_peer_cert, false}
		     ]
}]},
{rabbitmq_web_stomp,
      [{ssl_config, [{port,       15671},
                     {backlog,    1024},
                     {certfile,   "/etc/rabbitmq/certs/cert.pem"},
                     {keyfile,    "/etc/rabbitmq/certs/key.pem"},
                     {cacertfile, "/etc/rabbitmq/certs/cacerts.pem"},
                     {password,   "changeme"},
		     {fail_if_no_peer_cert, false}
]}]}
].

and

[
{rabbit, [
	{loopback_users, []},
	{ssl_listeners, [5761]},
	{ssl_options, [
                     {certfile,   "/etc/rabbitmq/certs/cert.pem"},
                     {keyfile,    "/etc/rabbitmq/certs/key.pem"},
                     {cacertfile, "/etc/rabbitmq/certs/cacerts.pem"},
		     {password,   "changeme"},
		     {verify, verify_none},
		     {fail_if_no_peer_cert, false}
		     ]
}]},
{rabbitmq_web_stomp,
      [{ssl_config, [{port,       15671},
                     {backlog,    1024},
                     {certfile,   "/etc/rabbitmq/certs/cert.pem"},
                     {keyfile,    "/etc/rabbitmq/certs/key.pem"},
                     {cacertfile, "/etc/rabbitmq/certs/cacerts.pem"},
                     {password,   "changeme"},
		     {verify, verify_none},
		     {fail_if_no_peer_cert, false}
]}]}
].
Same result either way.

If I understand what's going on, rabbit wants the browser to present a certificate.  But I thought the {fail_if_no_peer_cert, false} was supposed to turn that off.




On Jun 18, 2014, at 7:48 AM, Michael Klishin <mklishin at gopivotal.com> wrote:

> 
> 
> On 18 June 2014 at 18:20:46, Michael Klishin (mklishin at gopivotal.com) wrote:
>>> http://hg.rabbitmq.com/rabbitmq-web-stomp/rev/6d26ad85f65f  
>> 
>> Will be in 3.3.4.
> 
> Also, while investigating and verifying a fix, I discovered a workaround:
> add an SSL listener to your rabbitmq.config (even if you're not going to use
> SSL with AMQP 0-9-1), that will start asn1 and other dependencies before
> Web STOMP is even started.
> 
> So, the problem manifests itself only when you have Web STOMP configured to
> use SSL but not AMQP 0-9-1.
> 
> HTH. 
> --  
> MK  
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/830b9f00/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 02:09:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 05:09:02 +0400
Subject: [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
In-Reply-To: <1403139482-6313762.94882622.fs5J0vpBf015575@rs143.luxsci.com>
References: <loom.20140618T023106-104@post.gmane.org>
 <etPan.53a0ee09.19495cff.cdec@mercurio.local>
 <1403075402-3764635.28186707.fs5I79B9c019638@rs143.luxsci.com>
 <etPan.53a169dc.2eb141f2.cdec@mercurio.local>
 <etPan.53a19919.643c9869.f14@mercurio.local>
 <etPan.53a1a03c.74b0dc51.f14@mercurio.local>
 <etPan.53a1a6c1.2ae8944a.f14@mercurio.local>
 <1403139482-6313762.94882622.fs5J0vpBf015575@rs143.luxsci.com>
Message-ID: <etPan.53a2384b.238e1f29.f14@mercurio.local>

On 19 June 2014 at 04:58:20, Kirk Stork (kirk at stork.name) wrote:
> > If I understand what's going on, rabbit wants the browser to  
> present a certificate. But I thought the {fail_if_no_peer_cert,  
> false} was supposed to turn that off.

Your understanding is correct but there can be many underlying issues
that cause?ERR_SSL_CLIENT_AUTH_SIGNATURE_FAILED, some are even OS-specific [1].

Try connecting with openssl s_client, it may produce a more detailed/meaningful
output than Chrome .

1.?https://code.google.com/p/chromium/issues/detail?id=278370
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 19 02:56:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 05:56:50 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.3.0 is released
Message-ID: <etPan.53a24380.507ed7ab.f14@mercurio.local>

Bunny [1] is a Ruby RabbitMQ client focused on ease of use.

1.3.0 is a minor feature release that also includes all the bug fixes
from 1.2.x series.

Release notes:?
http://blog.rubyrabbitmq.info/blog/2014/06/18/bunny-1-dot-3-0-is-released/

1. http://rubybunny.info
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From scott.kendall.mcfadden at gmail.com  Wed Jun 18 23:47:12 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Wed, 18 Jun 2014 15:47:12 -0700 (PDT)
Subject: [rabbitmq-discuss] SocketException when invoking model.BasicPublish
Message-ID: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>

We get a SocketException when RabbitMQClient::SocketFrameHandler tries to 
invoke SendHeader (IPV4).

I installed Rabbit MQ on our Win2008 dev server as my domain user.  It's 
configured to run as Windows Service / LocalSystem.

How should I troubleshoot this error?


Server = Rabbitmq_server-3.3.0 (Windows Server 2008, No Firewall)
Client = .NET /  RabbitMQ.Client 3.3.0.0


C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-3.3.0\sbin>rabbitmqctl.bat status

Status of node rabbit at DEVTEST01 ...
Error: unable to connect to node rabbit at DEVTEST01: nodedown

DIAGNOSTICS
===========

attempted to contact: [rabbit at DEVTEST01]

rabbit at DEVTEST01:
  * found rabbit (port 25672)
  * TCP connection succeeded
  * suggestion: hostname mismatch?
  * suggestion: is the cookie set correctly?

current node details:
- node name: rabbitmqctl2618644 at DEVTEST01
- home dir: C:\Windows\system32
- cookie hash: ZmgA84wX0aHnw48E/7gOGg==





thanks

scott





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/7c947d70/attachment.html>

From scott.kendall.mcfadden at gmail.com  Thu Jun 19 02:19:34 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Wed, 18 Jun 2014 18:19:34 -0700 (PDT)
Subject: [rabbitmq-discuss] SocketException when invoking
	model.BasicPublish
In-Reply-To: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
References: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
Message-ID: <865c7ac8-1b72-4bf2-8696-01818d37c4d6@googlegroups.com>

Got a little further.  Found the RabbitMQ server logs.  Here is the 
pertinent log piece:


=INFO REPORT==== 18-Jun-2014::20:17:08 ===
accepting AMQP connection <0.473.0> (172.17.9.14:53024 -> 172.17.9.24:5672)

=ERROR REPORT==== 18-Jun-2014::20:17:08 ===
AMQP connection <0.473.0> (running), channel 1 - error:
{amqp_error,unexpected_frame,
            "expected content header for class 60, got non content header 
frame instead",
            'basic.publish'}

=INFO REPORT==== 18-Jun-2014::20:17:08 ===
closing AMQP connection <0.473.0> (172.17.9.14:53024 -> 172.17.9.24:5672)




On Wednesday, June 18, 2014 5:47:12 PM UTC-5, Scott McFadden wrote:
>
> We get a SocketException when RabbitMQClient::SocketFrameHandler tries to 
> invoke SendHeader (IPV4).
>
> I installed Rabbit MQ on our Win2008 dev server as my domain user.  It's 
> configured to run as Windows Service / LocalSystem.
>
> How should I troubleshoot this error?
>
>
> Server = Rabbitmq_server-3.3.0 (Windows Server 2008, No Firewall)
> Client = .NET /  RabbitMQ.Client 3.3.0.0
>
>
> C:\Program Files (x86)\RabbitMQ 
> Server\rabbitmq_server-3.3.0\sbin>rabbitmqctl.bat status
>
> Status of node rabbit at DEVTEST01 ...
> Error: unable to connect to node rabbit at DEVTEST01: nodedown
>
> DIAGNOSTICS
> ===========
>
> attempted to contact: [rabbit at DEVTEST01]
>
> rabbit at DEVTEST01:
>   * found rabbit (port 25672)
>   * TCP connection succeeded
>   * suggestion: hostname mismatch?
>   * suggestion: is the cookie set correctly?
>
> current node details:
> - node name: rabbitmqctl2618644 at DEVTEST01
> - home dir: C:\Windows\system32
> - cookie hash: ZmgA84wX0aHnw48E/7gOGg==
>
>
>
>
>
> thanks
>
> scott
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/4086bc1f/attachment.html>

From scott.kendall.mcfadden at gmail.com  Thu Jun 19 02:27:58 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Wed, 18 Jun 2014 18:27:58 -0700 (PDT)
Subject: [rabbitmq-discuss] SocketException when invoking
	model.BasicPublish
In-Reply-To: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
References: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
Message-ID: <c8d9a8a9-57b6-403f-be16-9a166b35e649@googlegroups.com>

Forgot to list the client code.  Client dies when trying to publish 
(IOException - unable to read from transport):

private void PublishMessage(byte[] message, Type messageType, string 
contentType, string messageId)
        {
            var factory = new ConnectionFactory() {VirtualHost = 
this.VirtualHost, HostName = this.Host, UserName = this.User, Password = 
this.Password };
            using (var connection = factory.CreateConnection())
            using (var channel = connection.CreateModel())
            {
                IBasicProperties props = channel.CreateBasicProperties();
                props.SetPersistent(this.PersistMessages);                
                
                //Mime time
                props.ContentType = contentType;
                props.Type = messageType.FullName;
                props.MessageId = messageId;

                
//http://www.rabbitmq.com/tutorials/tutorial-three-dotnet.html
                
                //Note, may get AlreadyClosedException here if publishing 
to a incorrect exchange name
                channel.BasicPublish(this.ExchangeName, this.RoutingKey, 
props, message);
            }
        }


Server side error is this:

=ERROR REPORT==== 18-Jun-2014::20:24:03 ===
AMQP connection <0.286.0> (running), channel 1 - error:
{amqp_error,unexpected_frame,
            "expected content header for class 60, got non content header 
frame instead",
            'basic.publish'}

=INFO REPORT==== 18-Jun-2014::20:24:03 ===
closing AMQP connection <0.286.0> (172.17.9.14:53072 -> 172.17.9.24:5672)




On Wednesday, June 18, 2014 5:47:12 PM UTC-5, Scott McFadden wrote:
>
> We get a SocketException when RabbitMQClient::SocketFrameHandler tries to 
> invoke SendHeader (IPV4).
>
> I installed Rabbit MQ on our Win2008 dev server as my domain user.  It's 
> configured to run as Windows Service / LocalSystem.
>
> How should I troubleshoot this error?
>
>
> Server = Rabbitmq_server-3.3.0 (Windows Server 2008, No Firewall)
> Client = .NET /  RabbitMQ.Client 3.3.0.0
>
>
> C:\Program Files (x86)\RabbitMQ 
> Server\rabbitmq_server-3.3.0\sbin>rabbitmqctl.bat status
>
> Status of node rabbit at DEVTEST01 ...
> Error: unable to connect to node rabbit at DEVTEST01: nodedown
>
> DIAGNOSTICS
> ===========
>
> attempted to contact: [rabbit at DEVTEST01]
>
> rabbit at DEVTEST01:
>   * found rabbit (port 25672)
>   * TCP connection succeeded
>   * suggestion: hostname mismatch?
>   * suggestion: is the cookie set correctly?
>
> current node details:
> - node name: rabbitmqctl2618644 at DEVTEST01
> - home dir: C:\Windows\system32
> - cookie hash: ZmgA84wX0aHnw48E/7gOGg==
>
>
>
>
>
> thanks
>
> scott
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/9ac36bd4/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 03:04:43 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 06:04:43 +0400
Subject: [rabbitmq-discuss] SocketException when invoking
 model.BasicPublish
In-Reply-To: <865c7ac8-1b72-4bf2-8696-01818d37c4d6@googlegroups.com>
References: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
 <865c7ac8-1b72-4bf2-8696-01818d37c4d6@googlegroups.com>
Message-ID: <etPan.53a24557.41b71efb.f14@mercurio.local>

On 19 June 2014 at 06:02:28, Scott McFadden (scott.kendall.mcfadden at gmail.com) wrote:
> > =ERROR REPORT==== 18-Jun-2014(http://airmail.calendar/2014-06-18%2012:00:00%20GMT+4)::20:17:08  
> ===
> AMQP connection <0.473.0> (running), channel 1 - error:
> {amqp_error,unexpected_frame,
> "expected content header for class 60, got non content header  
> frame instead",
> 'basic.publish'}

This looks like a well known issue you'll run into if you share a channel (IModel) between
threads, in particular threads that publish messages. This is a connection-level error,
so after getting it RabbitMQ closes the connection and your get socket errors on any subsequent
operation in the client.

Can the cross-thread sharing be the case??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From gavinmroy at gmail.com  Thu Jun 19 03:14:12 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Wed, 18 Jun 2014 22:14:12 -0400
Subject: [rabbitmq-discuss] ANN: PostgreSQL Listen Exchange v0.2.0
Message-ID: <CAPnH5kq3=cHXbW8LT-4sZ8GzEjNaAdS12xjVo+G0TUEy9C3Ytg@mail.gmail.com>

Version 0.2.0 of the PostgreSQL Listen Exchange has been released.

This version is a bug-fix only release that addresses several startup
issues under various conditions.

The exchange allows for non-intrusive publishing from PostgreSQL versions
9.0 or higher by using Postgres?s built-in LISTEN/NOTIFY functionality and
should be considered experimental. PostgreSQL connection information can be
configured via policy or arguments when declaring the exchange.

Instructions and a pre-built binary download for RabbitMQ v3.3.x are
available at:

https://github.com/aweber/pgsql-listen-exchange#readme

Cheers,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/29d85d97/attachment.html>

From youpingl at sina.com  Thu Jun 19 03:20:34 2014
From: youpingl at sina.com (=?utf-8?B?eW91cGluZ2w=?=)
Date: Thu, 19 Jun 2014 10:20:34 +0800
Subject: [rabbitmq-discuss] =?utf-8?q?client=5Ftimeout_errors?=
References: <201406171713206107562@sina.com>, <201406180950296971069@sina.com>,
 <etPan.53a0f98e.625558ec.cdec@mercurio.local>,
 <etPan.53a0fad9.238e1f29.cdec@mercurio.local>
Message-ID: <201406191020329462643@sina.com>

Thanks!

I have already solved this question successfully.

My stomp client has a parameter named heart-beat valued "10000,0" which means it must send heartbeat frame in 10s, and it sends hearbeat frame per 10 seconds when no task of rpc. The client_timeout errors were never seen again by modifying this value string to "120000,0".


2014-06-19 10:07:05



???  ??????????????
????????????????3????????12??610041?
???13980648555
???liuyp2 at asiainfo-linkage.com  



???? Michael Klishin 
????? 2014-06-18  20:37:45 
???? youpingl; Discussions about RabbitMQ 
??? 
??? Re: [rabbitmq-discuss] client_timeout errors 
On 18 June 2014 at 06:35:08, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Using a modified STOMP client that never sends heartbeat reproduces 
> the
> problem.
A fix should appear in nightly builds tomorrow and will be in 3.3.4.
You will see missed heartbeats logged properly , too.
-- 
MK 
Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/c809d44c/attachment.html>

From scott.kendall.mcfadden at gmail.com  Thu Jun 19 04:00:04 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Wed, 18 Jun 2014 22:00:04 -0500
Subject: [rabbitmq-discuss] SocketException when invoking
	model.BasicPublish
In-Reply-To: <etPan.53a24557.41b71efb.f14@mercurio.local>
References: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
 <865c7ac8-1b72-4bf2-8696-01818d37c4d6@googlegroups.com>
 <etPan.53a24557.41b71efb.f14@mercurio.local>
Message-ID: <CAJGQrQC6ckw1r73H+Xv7GDDFZ0n5Rt21DwkAEvZTCeXEEuKa_Q@mail.gmail.com>

Thanks for the suggestion Michael.  I checked at there is no sharing of the
connection across the thread.  The connection is all self contained to this
method and this method is only invoked once on the thread.  The odd thing
is that this same client code used to work.  It quit working when our
rabbit mq server hyper-v image snapshot got rolled back and I had to
re-install reconfigure rabbit mq.  It makes me think I screwed up the
server side configuration when reinstalling.

private void PublishMessage(byte[] message, Type messageType, string
contentType, string messageId)
        {
            var factory = new ConnectionFactory() {VirtualHost =
this.VirtualHost, HostName = this.Host, UserName = this.User, Password =
this.Password };
            using (var connection = factory.CreateConnection())
            using (var channel = connection.CreateModel())
            {
                IBasicProperties props = channel.CreateBasicProperties();
                props.SetPersistent(this.PersistMessages);

                //Mime time
                props.ContentType = contentType;
                props.Type = messageType.FullName;
                props.MessageId = messageId;

                //
http://www.rabbitmq.com/tutorials/tutorial-three-dotnet.html

                //Note, may get AlreadyClosedException here if publishing
to a incorrect exchange name
                channel.BasicPublish(this.ExchangeName, this.RoutingKey,
props, message);
            }
        }


On Wed, Jun 18, 2014 at 9:04 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 19 June 2014 at 06:02:28, Scott McFadden (
> scott.kendall.mcfadden at gmail.com) wrote:
> > > =ERROR REPORT==== 18-Jun-2014(
> http://airmail.calendar/2014-06-18%2012:00:00%20GMT+4)::20:17:08
> > ===
> > AMQP connection <0.473.0> (running), channel 1 - error:
> > {amqp_error,unexpected_frame,
> > "expected content header for class 60, got non content header
> > frame instead",
> > 'basic.publish'}
>
> This looks like a well known issue you'll run into if you share a channel
> (IModel) between
> threads, in particular threads that publish messages. This is a
> connection-level error,
> so after getting it RabbitMQ closes the connection and your get socket
> errors on any subsequent
> operation in the client.
>
> Can the cross-thread sharing be the case?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/baa94e21/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 04:05:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 07:05:57 +0400
Subject: [rabbitmq-discuss] SocketException when invoking
 model.BasicPublish
In-Reply-To: <CAJGQrQC6ckw1r73H+Xv7GDDFZ0n5Rt21DwkAEvZTCeXEEuKa_Q@mail.gmail.com>
References: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
 <865c7ac8-1b72-4bf2-8696-01818d37c4d6@googlegroups.com>
 <etPan.53a24557.41b71efb.f14@mercurio.local>
 <CAJGQrQC6ckw1r73H+Xv7GDDFZ0n5Rt21DwkAEvZTCeXEEuKa_Q@mail.gmail.com>
Message-ID: <etPan.53a253b3.21f57e54.9b32@mercurio.local>

?On 19 June 2014 at 07:02:17, Scott McFadden (scott.kendall.mcfadden at gmail.com) wrote:
> > It makes me think I screwed up the server side configuration  
> when reinstalling.

There is no configuration that can affect framing/frame interleaving in the client.
This is also the kind of issues that we'd see reported constantly if it was a client
issue. Finally, it happens on a brand new connection.

I'd recommend doing two things:

?* Running a tracer proxy in front of RabbitMQ [1] to see what's being sent on the wire
?* Open a connection on app start if you can instead of opening a new one per channel

If the latter does not change anything, please post the output of the tracer.

1.?http://www.rabbitmq.com/java-tools.html, see Tracer
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From michael.justin at gmx.net  Thu Jun 19 08:01:17 2014
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 19 Jun 2014 09:01:17 +0200
Subject: [rabbitmq-discuss] STOMP error report: client_timeout
Message-ID: <lnu1rv$fpu$1@ger.gmane.org>

Hello! Will the RabbitMQ 3.3.2 server STOMP plugin log client_timeout 
errors like the one below when the client connection dies and the Stomp 
client-side heartbeat stops? A user of my Stomp library reports that 
this error message appears frequently in a RPC system.

The RPC architecture is:

* Stomp clients (1000+) + Java AMQP 
servers(several)---HAproxy---RabbitMQ (cluster of two nodes)

Further information I received from the user:

* client time-out parameter of HAproxy is set to 120 seconds
* heart-beat parameter of RabbitMQ is set to 580 seconds
* Stomp client-side heart-beat parameter 10 seconds, no server heart-beats

I can imagine that the server operating system will keep the Stomp 
connection in TIME_WAIT state for a while after a client crash and the 
server will detect missing Stomp heart-beats if there is no more pending 
data in the socket. Would this be a potential cause of this log message?

Regards

=ERROR REPORT==== 15-May-2014::08:32:20 ===
** Generic server <0.4515.272> terminating
** Last message in was {'$gen_cast',client_timeout}
** When Server state == 
{state,"session-aVUZrMRW4ccDAF85RFj53Q",<0.4509.272>,
                             <0.4523.272>,
                             {dict,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  []},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             "1.0",#Fun<rabbit_stomp_reader.1.84385891>,
                             undefined,
 
{stomp_configuration,"guest","guest",false,false},
                             {set,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  []},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {dict,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  []},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             #Fun<rabbit_stomp_util.trim_headers.1>,
                             {amqp_adapter_info,
                                 {0,0,0,0,0,65535,2672,9740},
                                 61613,
                                 {0,0,0,0,0,65535,2669,58582},
                                 50861,
                                 <<"10.109.228.214:50861 -> 
10.112.38.12:61613">>,
                                 {'STOMP',0},
                                 [{ssl,false}]},
                             #Fun<rabbit_stomp_reader.0.123360627>,none}
** Reason for termination ==
** client_timeout

2, erlang's report:

=CRASH REPORT==== 15-May-2014::08:32:20 ===
   crasher:
     initial call: gen:init_it/6
     pid: <0.4515.272>
     registered_name: []
     exception exit: client_timeout
       in function  gen_server2:terminate/3
     ancestors: [<0.4506.272>,rabbit_stomp_client_sup_sup,rabbit_stomp_sup,
                   <0.259.0>]
     messages: [{'EXIT',<0.4523.272>,{shutdown,normal}}]
     links: [<0.4506.272>]
     dictionary: [{guid_secure,{{4,rabbit at fqmq1,#Ref<0.0.314.394>},0}}]
     trap_exit: true
     status: running
     heap_size: 987
     stack_size: 27
     reductions: 1097
   neighbours:
=SUPERVISOR REPORT==== 15-May-2014::08:32:20 ===
      Supervisor: {<0.4506.272>,
                                            rabbit_stomp_client_sup}
      Context:    child_terminated
      Reason:     client_timeout
      Offender:   [{pid,<0.4515.272>},
                   {name,rabbit_stomp_processor},
                   {mfargs,
                       {rabbit_stomp_processor,start_link,
                           [{stomp_configuration,"guest","guest",false,
                                false}]}},
                   {restart_type,intrinsic},
                   {shutdown,4294967295},
                   {child_type,worker}]


From mklishin at gopivotal.com  Thu Jun 19 08:04:51 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 11:04:51 +0400
Subject: [rabbitmq-discuss] STOMP error report: client_timeout
In-Reply-To: <lnu1rv$fpu$1@ger.gmane.org>
References: <lnu1rv$fpu$1@ger.gmane.org>
Message-ID: <etPan.53a28bb0.3bcced8e.9b32@mercurio.local>



On 19 June 2014 at 11:02:56, Michael Justin (michael.justin at gmx.net) wrote:
> > Will the RabbitMQ 3.3.2 server STOMP plugin log client_timeout  
> errors like the one below when the client connection dies and  
> the Stomp
> client-side heartbeat stops? A user of my Stomp library reports  
> that
> this error message appears frequently in a RPC system.

See?http://markmail.org/thread/kglwnkr7446ffgu4 for the background
and a workaround. 3.3.4 will not consider client timeouts (process) "crashes"
and will log warnings instead.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 19 08:08:41 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 11:08:41 +0400
Subject: [rabbitmq-discuss] STOMP error report: client_timeout
In-Reply-To: <lnu1rv$fpu$1@ger.gmane.org>
References: <lnu1rv$fpu$1@ger.gmane.org>
Message-ID: <etPan.53a28c96.6e2ab3ed.9b32@mercurio.local>

?On 19 June 2014 at 11:02:56, Michael Justin (michael.justin at gmx.net) wrote:
> > The RPC architecture is:
>  
> * Stomp clients (1000+) + Java AMQP
> servers(several)---HAproxy---RabbitMQ (cluster of two nodes)  
>  
> Further information I received from the user:
>  
> * client time-out parameter of HAproxy is set to 120 seconds
> * heart-beat parameter of RabbitMQ is set to 580 seconds
> * Stomp client-side heart-beat parameter 10 seconds, no server  
> heart-beats

Sounds very much like the same person that reported this in
http://markmail.org/thread/kglwnkr7446ffgu4 ;)
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From snannuru at mirthcorp.com  Thu Jun 19 05:01:53 2014
From: snannuru at mirthcorp.com (Sujatha Nannuru)
Date: Wed, 18 Jun 2014 21:01:53 -0700 (PDT)
Subject: [rabbitmq-discuss] how to recover password  from RabitMq
Message-ID: <5ad5a4f6-f8f0-48d3-aed1-86b8e37396ec@googlegroups.com>

HI,
I changed the pass word of RabitMQ,I am not able to login with new pass 
word.Please help me for this.

Thanks,
Sujatha

-- 
CONFIDENTIALITY NOTICE: The information contained in this electronic 
transmission may be confidential. If you are not an intended recipient, be 
aware that any disclosure, copying, distribution or use of the information 
contained in this transmission is prohibited and may be unlawful. If you 
have received this transmission in error, please notify us by email reply 
and then erase it from your computer system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140618/26ce8216/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 08:15:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 11:15:30 +0400
Subject: [rabbitmq-discuss] how to recover password from RabitMq
In-Reply-To: <5ad5a4f6-f8f0-48d3-aed1-86b8e37396ec@googlegroups.com>
References: <5ad5a4f6-f8f0-48d3-aed1-86b8e37396ec@googlegroups.com>
Message-ID: <etPan.53a28e2f.5482c6e7.9b32@mercurio.local>

On 19 June 2014 at 11:11:59, Sujatha Nannuru (snannuru at mirthcorp.com) wrote:
> > I changed the pass word of RabitMQ,I am not able to login with  
> new pass word.Please help me for this.

You can change password for any user if you log in into the management UI
as an administrator, or using `rabbitmqctl?change_password`.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From michael.justin at gmx.net  Thu Jun 19 08:21:53 2014
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 19 Jun 2014 09:21:53 +0200
Subject: [rabbitmq-discuss] STOMP error report: client_timeout
In-Reply-To: <etPan.53a28c96.6e2ab3ed.9b32@mercurio.local>
References: <lnu1rv$fpu$1@ger.gmane.org>
 <etPan.53a28c96.6e2ab3ed.9b32@mercurio.local>
Message-ID: <lnu32i$sde$1@ger.gmane.org>

Am 19.06.2014 09:08, Michael Klishin wrote:

> Sounds very much like the same person that reported this in
> http://markmail.org/thread/kglwnkr7446ffgu4 ;)

It is - many thanks for the pointer to that thread, it saved my day :)

-- 
Michael Justin


From mklishin at gopivotal.com  Thu Jun 19 08:30:42 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 11:30:42 +0400
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <CANcm3vkc0JxpjosSiY43k-=wSL74CB-=ni+s4hNR3cuJ00hJyQ@mail.gmail.com>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
 <etPan.539b3300.6b8b4567.50e9@mercurio.local>
 <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>
 <etPan.539b7b20.643c9869.83e5@mercurio.local>
 <CANcm3vkc0JxpjosSiY43k-=wSL74CB-=ni+s4hNR3cuJ00hJyQ@mail.gmail.com>
Message-ID: <etPan.53a291bd.5b3ef282.9b32@mercurio.local>

On 18 June 2014 at 19:51:57, Andrei (andrei002 at gmail.com) wrote:
> > 1. Is there any possibility for this feature to be implemented  
> in one of the next releases, in order for Web-STOMP to be fully  
> compatible with STOMP plugin?
>  
> 2. In case it is too complex to implement due to lack of client SSL  
> authentication mechanisms in Cowboy, could it be implemented  
> in the following way, as a workaround?

It's possible to add SSL certificate authentication to Web STOMP
but it may involve upgrading Cowboy and SockJS first => not a trivial amount of work.

The workaround you suggest may work but

?* It will be hard to justify supporting such a homegrown authentication scheme
?* It may also run into limitations in SockJS

So I'd recommend combining HTTPS connection with credentials obtained from an HTTPS
endpoint in your JS application. This is not great but largely is the state of
the art in Web messaging authentication. Fairly big Web players recommend something
very similar [1].

1. https://devcenter.heroku.com/articles/websocket-security ?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From rom.t.cabral at gmail.com  Thu Jun 19 09:17:15 2014
From: rom.t.cabral at gmail.com (Rom Cabral)
Date: Thu, 19 Jun 2014 01:17:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Flexible routing keys for topic exchange
Message-ID: <3a2c7f1b-201d-4589-b5e9-84b3b7433d04@googlegroups.com>

Hi guys,

I would like to hear any suggestions to be able to design flexible routing 
keys. Below is my use case.

If I have 3 queues A, B, C connected to an exchange, I would like to
- send message to A,B,C (broadcast)
- send to any combination AB, BC, AC
- send only to A, B, C

I can accomplish this by assigning key for each combination. Unfortunately, 
it will grow as the number of queues grow. What i want is to "*" and "#" in 
my design.

Thanks,

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/d49439b0/attachment.html>

From videlalvaro at gmail.com  Thu Jun 19 09:23:48 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Jun 2014 10:23:48 +0200
Subject: [rabbitmq-discuss] Flexible routing keys for topic exchange
In-Reply-To: <3a2c7f1b-201d-4589-b5e9-84b3b7433d04@googlegroups.com>
References: <3a2c7f1b-201d-4589-b5e9-84b3b7433d04@googlegroups.com>
Message-ID: <CAMcAHLW6rj-7GfHMmFAnmiCvUiPVqs5PyU9A+08XSd9MDjtDiQ@mail.gmail.com>

Hi,

If you want to decide to which queues to send the message, but at
publishing time, then you might want to use the 'reverse topic exchange'

See more details on how to obtain the plugin here:
http://www.rabbitmq.com/community-plugins.html The plugin is called
'rabbitmq_rtopic_exchange' and also please carefully read the performance
details explained here
https://github.com/videlalvaro/rabbitmq-rtopic-exchange#performance

Regards,

Alvaro


On Thu, Jun 19, 2014 at 10:17 AM, Rom Cabral <rom.t.cabral at gmail.com> wrote:

> Hi guys,
>
> I would like to hear any suggestions to be able to design flexible routing
> keys. Below is my use case.
>
> If I have 3 queues A, B, C connected to an exchange, I would like to
> - send message to A,B,C (broadcast)
> - send to any combination AB, BC, AC
> - send only to A, B, C
>
> I can accomplish this by assigning key for each combination.
> Unfortunately, it will grow as the number of queues grow. What i want is to
> "*" and "#" in my design.
>
> Thanks,
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/a393cd1d/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 09:28:16 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 12:28:16 +0400
Subject: [rabbitmq-discuss] Flexible routing keys for topic exchange
In-Reply-To: <3a2c7f1b-201d-4589-b5e9-84b3b7433d04@googlegroups.com>
References: <3a2c7f1b-201d-4589-b5e9-84b3b7433d04@googlegroups.com>
Message-ID: <etPan.53a29f3e.20ca20c6.9b32@mercurio.local>

?On 19 June 2014 at 12:19:29, Rom Cabral (rom.t.cabral at gmail.com) wrote:
> > - send message to A,B,C (broadcast)

use a fanout

> - send to any combination AB, BC, AC

when a new queue is added, you'll have to list them in a consumer (or whatever app
declares them) and create multiple bindings, say

a.*, b.* and so on

> - send only to A, B, C

use the default exchange.

Topic exchange patterns cannot offer arbitrary permutations in (2) and are less than optimal
for (1) and (3).
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From rom.t.cabral at gmail.com  Thu Jun 19 09:06:10 2014
From: rom.t.cabral at gmail.com (Rom Cabral)
Date: Thu, 19 Jun 2014 16:06:10 +0800
Subject: [rabbitmq-discuss] Designing a flexible routing key
Message-ID: <CAPHm8N7o9Q76CStdoGnEiJ=_w=ZKAyb0YNfQBvW+Z6seqnqTJg@mail.gmail.com>

Hi guys,

I would like to come up with a flexible routing key to be able to
accomplish my use case.

I have have broker with 3 queues A, B, C, what i want to is to be able to
- send to all queues (broadcast)
- send to any combination AB, BC, AC (multicast)
- send to A, B, C

Right now, I assign key for all path but as the number of queues grows,
routing keys for each queue also grows.

Hope to hear from you guys.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/14f7ec6b/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 09:32:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 12:32:56 +0400
Subject: [rabbitmq-discuss] Flexible routing keys for topic exchange
In-Reply-To: <etPan.53a29f3e.20ca20c6.9b32@mercurio.local>
References: <3a2c7f1b-201d-4589-b5e9-84b3b7433d04@googlegroups.com>
 <etPan.53a29f3e.20ca20c6.9b32@mercurio.local>
Message-ID: <etPan.53a2a054.4dae35b3.9b32@mercurio.local>

On 19 June 2014 at 12:30:06, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Topic exchange patterns cannot offer arbitrary permutations  
> in (2

?without some effort on the application side, e.g. when new queues that need to
be permutated are created, that is?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Thu Jun 19 09:35:04 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jun 2014 09:35:04 +0100
Subject: [rabbitmq-discuss] Flexible routing keys for topic exchange
In-Reply-To: <etPan.53a29f3e.20ca20c6.9b32@mercurio.local>
References: <3a2c7f1b-201d-4589-b5e9-84b3b7433d04@googlegroups.com>
 <etPan.53a29f3e.20ca20c6.9b32@mercurio.local>
Message-ID: <53A2A0B8.8070701@rabbitmq.com>

On 19/06/14 09:28, Michael Klishin wrote:
> On 19 June 2014 at 12:19:29, Rom Cabral (rom.t.cabral at gmail.com)
>> - send to any combination AB, BC, AC
>
> when a new queue is added, you'll have to list them in a consumer (or
> whatever app declares them) and create multiple bindings, say
>
> a.*, b.* and so on

better: take advantage of http://www.rabbitmq.com/sender-selected.html, 
and use the default exchange.

Matthias.

From simon at rabbitmq.com  Thu Jun 19 11:19:06 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jun 2014 11:19:06 +0100
Subject: [rabbitmq-discuss] multiple exchange routing key
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0222C8BA@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0222C8BA@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <53A2B91A.6090309@rabbitmq.com>

On 18/06/14 20:33, PATAR, SAGAR wrote:
> don?t see message rate in Exchange 2

Just to clarify this point - the message rates shown for exchanges in 
mgmt are message rates published directly to that exchange - they don't 
show anything for messages passing "through" that exchange as part of a 
more complex binding.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jun 19 11:20:59 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jun 2014 11:20:59 +0100
Subject: [rabbitmq-discuss] Designing a flexible routing key
In-Reply-To: <CAPHm8N7o9Q76CStdoGnEiJ=_w=ZKAyb0YNfQBvW+Z6seqnqTJg@mail.gmail.com>
References: <CAPHm8N7o9Q76CStdoGnEiJ=_w=ZKAyb0YNfQBvW+Z6seqnqTJg@mail.gmail.com>
Message-ID: <53A2B98B.7020402@rabbitmq.com>

On 19/06/14 09:06, Rom Cabral wrote:
> I have have broker with 3 queues A, B, C, what i want to is to be able to
> - send to all queues (broadcast)
> - send to any combination AB, BC, AC (multicast)
> - send to A, B, C

I don't know if this is the answer for you, but if you are thinking in 
terms of the publisher knowing which queues it wants to send to you can 
use http://www.rabbitmq.com/sender-selected.html.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jun 19 11:23:35 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jun 2014 11:23:35 +0100
Subject: [rabbitmq-discuss] how to recover password from RabitMq
In-Reply-To: <etPan.53a28e2f.5482c6e7.9b32@mercurio.local>
References: <5ad5a4f6-f8f0-48d3-aed1-86b8e37396ec@googlegroups.com>
 <etPan.53a28e2f.5482c6e7.9b32@mercurio.local>
Message-ID: <53A2BA27.9080603@rabbitmq.com>

On 19/06/14 08:15, Michael Klishin wrote:
> On 19 June 2014 at 11:11:59, Sujatha Nannuru (snannuru at mirthcorp.com) wrote:
>>> > >I changed the pass word of RabitMQ,I am not able to login with
>> >new pass word.Please help me for this.
> You can change password for any user if you log in into the management UI
> as an administrator, or using `rabbitmqctl change_password`.

And just to add clarity here: `rabbitmqctl change_password` does not 
require that you know an existing password, so it's the only way if you 
are locked out completely. Obviously you need shell access to the box in 
that case.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Rohit.Patle at techmahindra.com  Thu Jun 19 13:29:50 2014
From: Rohit.Patle at techmahindra.com (Rohit Patle)
Date: Thu, 19 Jun 2014 12:29:50 +0000
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <27E054594442884E9A46DBCF9AE74081688D80@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00593.2eb141f2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a0081e.79e2a9e3.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CFF@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00bdc.5bd062c2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688D0C@BSDMSATMBX001.mahindrasatyam.ad>,
 <etPan.53a00f9a.12200854.b262@mercurio.local>,
 <27E054594442884E9A46DBCF9AE74081688D80@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <27E054594442884E9A46DBCF9AE74081688F04@BSDMSATMBX001.mahindrasatyam.ad>

Hi Michael,

Is there any clue on below issue.

Thanks,
Rohit

________________________________________
From: Rohit Patle
Sent: Wednesday, June 18, 2014 11:58 AM
To: Michael Klishin
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case

Hi Michael,

The outcome of openssl tool is different in different scenarios, when I assign the the client dynamic ip the outcome of : "openssl s_client -host ms501.xxxxx.com -port 5671 -quiet -state"  is as follows

SSL_connect:before/connect initialization
SSL_connect:unknown state
SSL_connect:SSLv3 read server hello A
depth=1 CN = xxxxxxxx
verify error:num=19:self signed certificate in certificate chain
verify return:0
SSL_connect:SSLv3 read server certificate A
SSL_connect:SSLv3 read server certificate request A
SSL_connect:SSLv3 read server done A
SSL_connect:SSLv3 write client certificate A
SSL_connect:SSLv3 write client key exchange A
SSL_connect:SSLv3 write change cipher spec A
SSL_connect:SSLv3 write finished A
SSL_connect:SSLv3 flush data
SSL3 alert read:fatal:handshake failure
SSL_connect:failed in SSLv3 read finished A
3074099400:error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure:s3_pkt.c:1260:SSL alert number 40
3074099400:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake failure:s23_lib.c:177:

And when I assigned static ip the outcome of openssl tool  for the command :"openssl s_client -host ms501.xxxxx.com -port 5671 -quiet -state" is as:

gethostbyname failure
connect : errno=11

In both cases communication happens as expected. But the issue comes when I use the single static ip for two consumers.

Please advise.

Thanks & Regards,
Rohit

________________________________________
From: Michael Klishin [mklishin at gopivotal.com]
Sent: Tuesday, June 17, 2014 3:20 PM
To: Rohit Patle
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case

 On 17 June 2014 at 13:47:26, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > I believe it is not SSL handshake issue, because the connection
> is getting establish successfully, for both the connection
> I am getting comments in Rabbitmq log as "accepting AMQP connection"
> for the same ip's, but after some time like in a minute I am getting
> "AMQP_STATUS_SSL_ERROR" in my clients.

AMQP_STATUS_SSL_ERROR is very generic and without getting
more info from OpenSSL it's not really possible to tell what the problem is:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-September/030459.html

Try openssl s_client, it usually produces better error messages
and displays more info than almost any other tool out there.
--
MK

Software Engineer, Pivotal/RabbitMQ

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.

From mklishin at gopivotal.com  Thu Jun 19 13:32:52 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 16:32:52 +0400
Subject: [rabbitmq-discuss] mazy behavior of rabbitmq-c in same ip case
In-Reply-To: <27E054594442884E9A46DBCF9AE74081688F04@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081688CE1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00593.2eb141f2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CF1@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a0081e.79e2a9e3.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688CFF@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00bdc.5bd062c2.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688D0C@BSDMSATMBX001.mahindrasatyam.ad>
 <etPan.53a00f9a.12200854.b262@mercurio.local>
 <27E054594442884E9A46DBCF9AE74081688D80@BSDMSATMBX001.mahindrasatyam.ad>
 <27E054594442884E9A46DBCF9AE74081688F04@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <etPan.53a2d892.6b8b4567.172@mercurio.local>

?On 19 June 2014 at 16:29:59, Rohit Patle (rohit.patle at techmahindra.com) wrote:
> > Is there any clue on below issue.

I don't know what may be going on, but as you can see, openssl s_client is also
confused.

Sorry, the best solution would be to reconfigure your network to not have two
machines on different subnets have the same IP. It's a setup asking for trouble,
with any server.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From andrei002 at gmail.com  Thu Jun 19 16:47:28 2014
From: andrei002 at gmail.com (Andrei)
Date: Thu, 19 Jun 2014 18:47:28 +0300
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <etPan.53a291bd.5b3ef282.9b32@mercurio.local>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
 <etPan.539b3300.6b8b4567.50e9@mercurio.local>
 <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>
 <etPan.539b7b20.643c9869.83e5@mercurio.local>
 <CANcm3vkc0JxpjosSiY43k-=wSL74CB-=ni+s4hNR3cuJ00hJyQ@mail.gmail.com>
 <etPan.53a291bd.5b3ef282.9b32@mercurio.local>
Message-ID: <CANcm3vkrrEs5mx3CaN=iduadcBbDvkRA6V4+n3ikDK_=6ymgvQ@mail.gmail.com>

Hi Michael,

 * It will be hard to justify supporting such a homegrown authentication
> scheme
>

Well it won't need that much support as the changes are minimal and impact
just a few lines of code in two source files, and also it'll be just a
temporary solution till proper support for SSL client auth will be
implemented :)

 * It may also run into limitations in SockJS
>

What kind of limitations do you mean here?

So I'd recommend combining HTTPS connection with credentials obtained from
> an HTTPS endpoint in your JS application.
>

We have considered this approach, however the problem is that the JS code
initiating the websocket connection runs in the user's web browser, and
this makes such kind of solutions rather insecure.
On the other side using client certificate data for authentication is both
secure and happens completely transparently to the end-user.

So, I'd be very grateful if you could take a closer look at the solution
I've previously suggested and provide some hints on which changes should be
applied to the sockjs-erlang-wrapper and web-stomp source in order to
implement it.. unfortunately I'm having a bit of a hard time figuring out
where exactly to add that additional HTTP header processing code..

Another issue I ran into playing with this is an error showing up when
trying to compile the original web-stomp plugin from the
rabbitmq-public-umbrella:

../cowboy-wrapper/cowboy-git/src/cowboy_clock.erl: undefined parse
transform 'eunit_autoexport'
make: *** [../cowboy-wrapper/ebin/cowboy_clock.beam] Error 1

Could you please shed some light on this? I've checked out the latest
rabbitmq-public-umbrella and my Erlang version is R16B02.

Also, maybe you missed my last question from last time:

P.S.: Although you have CCd rabbitmq-discuss group in the previous
> messages, somehow these are not visible to me on the Rabbitmq-discuss
> Google Group. Are there some viewing or access restrictions set up?
>

Thank you!

Best regards,
Andy.

On Thu, Jun 19, 2014 at 10:30 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 18 June 2014 at 19:51:57, Andrei (andrei002 at gmail.com) wrote:
> > > 1. Is there any possibility for this feature to be implemented
> > in one of the next releases, in order for Web-STOMP to be fully
> > compatible with STOMP plugin?
> >
> > 2. In case it is too complex to implement due to lack of client SSL
> > authentication mechanisms in Cowboy, could it be implemented
> > in the following way, as a workaround?
>
> It's possible to add SSL certificate authentication to Web STOMP
> but it may involve upgrading Cowboy and SockJS first => not a trivial
> amount of work.
>
> The workaround you suggest may work but
>
>  * It will be hard to justify supporting such a homegrown authentication
> scheme
>  * It may also run into limitations in SockJS
>
> So I'd recommend combining HTTPS connection with credentials obtained from
> an HTTPS
> endpoint in your JS application. This is not great but largely is the
> state of
> the art in Web messaging authentication. Fairly big Web players recommend
> something
> very similar [1].
>
> 1. https://devcenter.heroku.com/articles/websocket-security
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/7c1ee3fa/attachment.html>

From dmitry.andrianov at alertme.com  Thu Jun 19 17:50:09 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Thu, 19 Jun 2014 17:50:09 +0100
Subject: [rabbitmq-discuss] debug logging
Message-ID: <53A314C1.6050603@alertme.com>

Hi.
I already asked this question some time ago, but I hope something might 
have changed since then )

I could not find an "official" way to do any kind of logging in RabbitMQ 
plug-in in a way so I can have it on on development box but turn it off 
on a live server.

I used rabbit_log:info for that. And now I am checking what other people 
do (on the github). And it looks like everyone is using io:format which 
they comment out before making the final build. So the deployed version 
does not have any logging in it and if something goes wrong, you cannot 
just enable debug and collect the evidences.

Doesn't it make sense to introduce a more flexible logging facilities 
everyone could use?

Cheers
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mklishin at gopivotal.com  Thu Jun 19 20:02:23 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 23:02:23 +0400
Subject: [rabbitmq-discuss] debug logging
In-Reply-To: <53A314C1.6050603@alertme.com>
References: <53A314C1.6050603@alertme.com>
Message-ID: <etPan.53a333d8.327b23c6.172@mercurio.local>

On 19 June 2014 at 20:51:25, Dmitry Andrianov (dmitry.andrianov at alertme.com) wrote:
> > Doesn't it make sense to introduce a more flexible logging facilities  
> everyone could use?

The only dynamically adjustable logging right now is tracing, which is of limited
use to plugins but still may be sufficient.

Having a way to change log level at runtime temporary sounds like a nice
feature to look into. Feel free to investigate what potential issues can there
be, it will save the tiny RabbitMQ engineering team some time. And may even
lead to your patch being accepted ;)?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 19 20:03:46 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 23:03:46 +0400
Subject: [rabbitmq-discuss] debug logging
In-Reply-To: <etPan.53a333db.643c9869.172@mercurio.local>
References: <53A314C1.6050603@alertme.com>
 <etPan.53a333db.643c9869.172@mercurio.local>
Message-ID: <etPan.53a3342c.66334873.172@mercurio.local>

?On 19 June 2014 at 23:02:54, Michael Klishin (michael at rabbitmq.com) wrote:
> > The only dynamically adjustable logging right now is tracing,  
> which is of limited
> use to plugins but still may be sufficient.

Forgot to include the links:

?*?http://www.rabbitmq.com/firehose.html
?*?https://github.com/rabbitmq/rabbitmq-tracing
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 19 20:12:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 23:12:39 +0400
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <CANcm3vkrrEs5mx3CaN=iduadcBbDvkRA6V4+n3ikDK_=6ymgvQ@mail.gmail.com>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
 <etPan.539b3300.6b8b4567.50e9@mercurio.local>
 <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>
 <etPan.539b7b20.643c9869.83e5@mercurio.local>
 <CANcm3vkc0JxpjosSiY43k-=wSL74CB-=ni+s4hNR3cuJ00hJyQ@mail.gmail.com>
 <etPan.53a291bd.5b3ef282.9b32@mercurio.local>
 <CANcm3vkrrEs5mx3CaN=iduadcBbDvkRA6V4+n3ikDK_=6ymgvQ@mail.gmail.com>
Message-ID: <etPan.53a33641.19495cff.172@mercurio.local>



On 19 June 2014 at 19:47:28, Andrei (andrei002 at gmail.com) wrote:
> > Well it won't need that much support as the changes are minimal  
> and impact just a few lines of code in two source files, and also  
> it'll be just a temporary solution till proper support for SSL  
> client auth will be implemented :)

There is nothing more permanent than temporary solutions in software.
We cannot later tell our commercial customers "you know guys, that feature
that your app is built on, it was temporary. Good luck with upgrading!"

> > * It may also run into limitations in SockJS
>  
> What kind of limitations do you mean here?

I can't name any specific one without trying to implement the thing but
I assure you APIs don't always provide exactly what you want :)

> > So I'd recommend combining HTTPS connection with credentials  
> obtained from an HTTPS endpoint in your JS application.
>  
> We have considered this approach, however the problem is that  
> the JS code initiating the websocket connection runs in the user's  
> web browser, and this makes such kind of solutions rather insecure.  
> On the other side using client certificate data for authentication  
> is both secure and happens completely transparently to the end-user.  

HTTPS should give you a reasonable protection from tampering and MITM.
Making your credentials user-specific and "tokens" that you use to obtain
"real" credentials ephemeral should protect reasonably well from malicious
users.

> So, I'd be very grateful if you could take a closer look at the solution  
> I've previously suggested and provide some hints on which changes  
> should be applied to the sockjs-erlang-wrapper and web-stomp  
> source in order to implement it.. unfortunately I'm having a  
> bit of a hard time figuring out where exactly to add that additional  
> HTTP header processing code..

Your plan involves using basic HTTP authentication. How is this really
more secure than using temporary tokens to programmatically obtain a pair
of credentials??

> Another issue I ran into playing with this is an error showing  
> up when trying to compile the original web-stomp plugin from  
> the rabbitmq-public-umbrella:
>  
> ../cowboy-wrapper/cowboy-git/src/cowboy_clock.erl: undefined  
> parse transform 'eunit_autoexport'
> make: *** [../cowboy-wrapper/ebin/cowboy_clock.beam] Error  
> 1
>  
> Could you please shed some light on this? I've checked out the  
> latest rabbitmq-public-umbrella and my Erlang version is R16B02.  

What were the exact steps you performed? R16B02 should be plenty sufficient
for Cowboy and Rabbit. To build web-stomp, clone the umbrella, `make up` in it,
then cd rabbitmq-web-stomp and run `make`.

> > P.S.: Although you have CCd rabbitmq-discuss group in the previous  
> messages, somehow these are not visible to me on the Rabbitmq-discuss  
> Google Group. Are there some viewing or access restrictions  
> set up?

The Google group is just a way for start a conversation
w/o signing up. Join rabbitmq-discuss proper.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From isskjj at gmail.com  Thu Jun 19 20:40:44 2014
From: isskjj at gmail.com (Karl Jackson)
Date: Thu, 19 Jun 2014 13:40:44 -0600
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server failing
	to start
Message-ID: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>

I upgraded from 3.1.5 to 3.3.3 and when I try to start rabbitmq, I get the
following message:

Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
_err}

rabbitmq-server.


startup_log contains:

{"init terminating in do_boot",badarg}

                                     [FAILED]

startup_err contains:


Crash dump was written to: erl_crash.dump

init terminating in do_boot (badarg)


Thank you,

Karl Jackson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/de1cbe5f/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 20:43:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 23:43:47 +0400
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
Message-ID: <etPan.53a33d8c.238e1f29.172@mercurio.local>

On 19 June 2014 at 23:42:59, Karl Jackson (isskjj at gmail.com) wrote:
> > startup_log contains:
> {"init terminating in do_boot",badarg}
>  
> [FAILED]

Karl,

is this really everything there is in both logs??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From isskjj at gmail.com  Thu Jun 19 20:52:08 2014
From: isskjj at gmail.com (Karl Jackson)
Date: Thu, 19 Jun 2014 13:52:08 -0600
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <etPan.53a33d8c.238e1f29.172@mercurio.local>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
Message-ID: <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>

MK,

Yes, that is it. The startup_log is only 68 byes. It does have a
erl_crash.dump, but I don't know if it contains anything useful.

Karl

On Thu, Jun 19, 2014 at 1:43 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 19 June 2014 at 23:42:59, Karl Jackson (isskjj at gmail.com) wrote:
> > > startup_log contains:
> > {"init terminating in do_boot",badarg}
> >
> > [FAILED]
>
> Karl,
>
> is this really everything there is in both logs?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/a8d04970/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 20:52:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 19 Jun 2014 23:52:53 +0400
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
Message-ID: <etPan.53a33fb3.3d1b58ba.172@mercurio.local>

On 19 June 2014 at 23:52:09, Karl Jackson (isskjj at gmail.com) wrote:
> > Yes, that is it. The startup_log is only 68 byes. It does have  
> a erl_crash.dump, but I don't know if it contains anything useful.  

How large is the dump? Can you send it to me off-list??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From brett.r.cameron at gmail.com  Thu Jun 19 20:56:36 2014
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 20 Jun 2014 07:56:36 +1200
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
Message-ID: <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>

What happens if you do "rabbitmq-server" interactively ("$ sudo
rabbitmq-server", or whatever)? Any interesting output?



On Fri, Jun 20, 2014 at 7:52 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 19 June 2014 at 23:52:09, Karl Jackson (isskjj at gmail.com) wrote:
> > > Yes, that is it. The startup_log is only 68 byes. It does have
> > a erl_crash.dump, but I don't know if it contains anything useful.
>
> How large is the dump? Can you send it to me off-list?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/9dc2a71f/attachment.html>

From isskjj at gmail.com  Thu Jun 19 21:03:39 2014
From: isskjj at gmail.com (Karl Jackson)
Date: Thu, 19 Jun 2014 14:03:39 -0600
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
Message-ID: <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>

The output is comparable to what is in the startup-log and startup-err:

{"init terminating in do_boot",badarg}


Crash dump was written to: erl_crash.dump

init terminating in do_boot (badarg)

Thank you,

Karl Jackson


On Thu, Jun 19, 2014 at 1:56 PM, Brett Cameron <brett.r.cameron at gmail.com>
wrote:

> What happens if you do "rabbitmq-server" interactively ("$ sudo
> rabbitmq-server", or whatever)? Any interesting output?
>
>
rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/4415d807/attachment.html>

From bjoernhaeuser at gmail.com  Thu Jun 19 21:09:03 2014
From: bjoernhaeuser at gmail.com (=?iso-8859-1?Q?Bj=F6rn_H=E4user?=)
Date: Thu, 19 Jun 2014 22:09:03 +0200
Subject: [rabbitmq-discuss] amq.rabbitmq.log
Message-ID: <459E4B42-645C-4EA9-AA8F-ADF45D136BF0@gmail.com>

Hey List,

how does amq.rabbitmq.log behave in a clustered environment?

I created a queue in the cluster (Policy: ha-all-syncd).

What would be the easiest way to gather the logs on all nodes in the cluster? 

Thanks
Bj?rn

From bjoernhaeuser at gmail.com  Thu Jun 19 21:11:02 2014
From: bjoernhaeuser at gmail.com (=?iso-8859-1?Q?Bj=F6rn_H=E4user?=)
Date: Thu, 19 Jun 2014 22:11:02 +0200
Subject: [rabbitmq-discuss] 3.2.4: Segfaults with HiPe enabled
In-Reply-To: <53569EF7.8050108@rabbitmq.com>
References: <B0F66769-8F03-4CC6-997A-2428AB224D90@gmail.com>
 <5354CB95.2040201@rabbitmq.com>
 <47148C41-E224-4733-8FF1-442F433CECEA@gmail.com>
 <53569EF7.8050108@rabbitmq.com>
Message-ID: <8B7282C5-89B1-4D8C-8105-DF0B0FD529C2@gmail.com>

Hi,

On 22.04.2014, at 18:55, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 22/04/14 17:45, Bj?rn H?user wrote:
>> We will upgrade to newest RabbitMQ. We are also running R16B03.
>> Should we also go for R17?
> 
> Yes.
> 
> (I knew you were running R16B03 from the crash dump)
> 

We upgraded to 3.3.1 and Erlang 17 and everything is now running fine!

Thanks
Bj?rn

From mklishin at gopivotal.com  Thu Jun 19 21:13:48 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 00:13:48 +0400
Subject: [rabbitmq-discuss] amq.rabbitmq.log
In-Reply-To: <459E4B42-645C-4EA9-AA8F-ADF45D136BF0@gmail.com>
References: <459E4B42-645C-4EA9-AA8F-ADF45D136BF0@gmail.com>
Message-ID: <etPan.53a3449a.507ed7ab.172@mercurio.local>

?On 20 June 2014 at 00:11:17, Bj?rn H?user (bjoernhaeuser at gmail.com) wrote:
> > how does amq.rabbitmq.log behave in a clustered environment?

As far as using it goes, ?exactly the same as with a single node.

> What would be the easiest way to gather the logs on all nodes in  
> the cluster?

amq.rabbitmq.log should include events for all cluster nodes, if this is
what you're asking.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 19 21:18:13 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 00:18:13 +0400
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>
Message-ID: <etPan.53a345a0.79e2a9e3.172@mercurio.local>



On 20 June 2014 at 00:05:49, Karl Jackson (isskjj at gmail.com) wrote:
> > The output is comparable to what is in the startup-log and startup-err:  
>  
> {"init terminating in do_boot",badarg}
>  
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot (badarg)

the crash dump suggests the VM is running with odd startup flags:

[async-threads:0] [kernel-poll:false]

0 I/O threads sounds problematic. Can something be overriding
RABBITMQ_SERVER_ERL_ARGS? Did you mean to append flags to it?

Please run printenv?RABBITMQ_SERVER_ERL_ARGS as effective RabbitMQ
user and post the output.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From paul.knight at oasis-open.org  Thu Jun 19 21:09:39 2014
From: paul.knight at oasis-open.org (Paul Knight)
Date: Thu, 19 Jun 2014 16:09:39 -0400
Subject: [rabbitmq-discuss] 30-day Public Review for Advanced Message
 Queuing Protocol (AMQP) WebSocket Binding (WSB) Version 1.0 - ends July
 19th
Message-ID: <CADgeAH_RHTx82YiuQF17-=MK-mVGiJDn3g0mP749X8quudm18g@mail.gmail.com>

OASIS members and other interested stakeholders,

The OASIS Advanced Message Queuing Protocol (AMQP) Bindings and Mappings
(AMQP-BINDMAP) TC [1] members have recently approved a Committee
Specification Draft (CSD) and submitted it for 30-day public review:

Advanced Message Queuing Protocol (AMQP) WebSocket Binding (WSB) Version
1.0
Committee Specification Draft 01 / Public Review Draft 01
10 June 2014

Overview:

The AMQP WebSocket Binding specification defines a mechanism for tunneling
an AMQP connection over a WebSocket transport. It is applicable as an
approach for general firewall tunneling and for Web browser messaging
scenarios.

TC Description:

The purpose of the AMQP Bindings and Mappings (AMQP-BINDMAP) TC is to
define bindings of AMQP 1.0 core protocol to underlying transports other
than TCP, to define mappings of the AMQP 1.0 core protocol to existing
well-known programming APIs, and to define representations of the AMQP 1.0
message format in existing well-known languages.

For more information, see the TC Charter and FAQ.

Public Review Period:

The public review starts 20 June 2014 at 00:00 GMT and ends 19 July 2014 at
23:59 GMT.

This is an open invitation to comment. OASIS solicits feedback from
potential users, developers and others, whether OASIS members or not, for
the sake of improving the interoperability and quality of its technical
work.

URIs:

The prose specification document and related files are available here:

Editable source (Authoritative):
http://docs.oasis-open.org/amqp-bindmap/amqp-wsb/v1.0/csprd01/amqp-wsb-v1.0-csprd01.doc

HTML:
http://docs.oasis-open.org/amqp-bindmap/amqp-wsb/v1.0/csprd01/amqp-wsb-v1.0-csprd01.html


PDF:
http://docs.oasis-open.org/amqp-bindmap/amqp-wsb/v1.0/csprd01/amqp-wsb-v1.0-csprd01.pdf

ZIP distribution file (complete):

For your convenience, OASIS provides a complete package of the prose
document and related files in a ZIP distribution file. You can download the
ZIP file here:

http://docs.oasis-open.org/amqp-bindmap/amqp-wsb/v1.0/csprd01/amqp-wsb-v1.0-csprd01.zip

Additional information about the specification and the OASIS Advanced
Message Queuing Protocol (AMQP) Bindings and Mappings (AMQP-BINDMAP) TC can
be found at the TC's public home page:

https://www.oasis-open.org/committees/amqp-bindmap/

Comments may be submitted to the TC by any person through the use of the
OASIS TC Comment Facility which can be used by following the instructions
on the TC's "Send A Comment" page, or directly at:

https://www.oasis-open.org/committees/comments/index.php?wg_abbrev=amqp-bindmap

Comments submitted by TC non-members for this work and for other work of
this TC are publicly archived and can be viewed at:

https://lists.oasis-open.org/archives/amqp-bindmap-comment/

All comments submitted to OASIS are subject to the OASIS Feedback License,
which ensures that the feedback you provide carries the same obligations at
least as the obligations of the TC members. In connection with this public
review of "Advanced Message Queuing Protocol (AMQP) WebSocket Binding (WSB)
Version 1.0", we call your attention to the OASIS IPR Policy [2] applicable
especially [3] to the work of this Technical Committee. All members of the
TC should be familiar with this document, which may create obligations
regarding the disclosure and availability of a member's patent, copyright,
trademark and license rights that read on an approved OASIS specification.

OASIS invites any persons who know of any such claims to disclose these if
they may be essential to the implementation of the above specification, so
that notice of them may be posted to the notice page for this TC's work.

========== Additional references:

[1] OASIS Advanced Message Queuing Protocol (AMQP) Bindings and Mappings
(AMQP-BINDMAP) TC
https://www.oasis-open.org/committees/amqp-bindmap/

[2] https://www.oasis-open.org/who/intellectualproperty.php

[3] https://www.oasis-open.org/committees/amqp-bindmap/ipr.php
https://www.oasis-open.org/policies-guidelines/ipr#s10.2.2
RF on RAND Mode

-- 
Paul Knight <paul.knight at oasis-open.org>  - Tel: +1 781-861-1013
OASIS <https://www.oasis-open.org/> - Advancing open standards for the
information society
Document Process Analyst
<https://www.oasis-open.org/people/staff/paul-knight>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/b2f819b6/attachment.html>

From isskjj at gmail.com  Thu Jun 19 21:24:57 2014
From: isskjj at gmail.com (Karl Jackson)
Date: Thu, 19 Jun 2014 14:24:57 -0600
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <etPan.53a345a0.79e2a9e3.172@mercurio.local>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>
 <etPan.53a345a0.79e2a9e3.172@mercurio.local>
Message-ID: <CAKmc4PbUZEqQKeQteF5uKFiKApT9E8_ghp69fEG7AhiqQB6wxQ@mail.gmail.com>

It did not produce any output. It looks like RABBITMQ_SERVER_ERL_ARGS is
not set. Here is what I did


[root at habu1 tmp]# su - rabbitmq

Last password change : Aug 22, 2013

Password expires : never

Password inactive : never

Account expires : never

Minimum number of days between password change : -1

Maximum number of days between password change : -1

Number of days of warning before password expires : -1

-bash-4.1$ printenv RABBITMQ_SERVER_ERL_ARGS

-bash-4.1$

Thank you,

Karl Jackson


On Thu, Jun 19, 2014 at 2:18 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>
>
> On 20 June 2014 at 00:05:49, Karl Jackson (isskjj at gmail.com) wrote:
> > > The output is comparable to what is in the startup-log and startup-err:
> >
> > {"init terminating in do_boot",badarg}
> >
> > Crash dump was written to: erl_crash.dump
> > init terminating in do_boot (badarg)
>
> the crash dump suggests the VM is running with odd startup flags:
>
> [async-threads:0] [kernel-poll:false]
>
> 0 I/O threads sounds problematic. Can something be overriding
> RABBITMQ_SERVER_ERL_ARGS? Did you mean to append flags to it?
>
> Please run printenv RABBITMQ_SERVER_ERL_ARGS as effective RabbitMQ
> user and post the output.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/8a0296c2/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 21:25:51 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 00:25:51 +0400
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
Message-ID: <etPan.53a3476c.515f007c.172@mercurio.local>

On 19 June 2014 at 23:58:50, Brett Cameron (brett.r.cameron at gmail.com) wrote:
> > What happens if you do "rabbitmq-server" interactively ("$  
> sudo rabbitmq-server", or whatever)? Any interesting output?  

I'm also curious if `erl` (Erlang shell) starts at all.

The VM seems to exit before it can even start ?the error logger.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 19 21:29:36 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 00:29:36 +0400
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CAKmc4PbUZEqQKeQteF5uKFiKApT9E8_ghp69fEG7AhiqQB6wxQ@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>
 <etPan.53a345a0.79e2a9e3.172@mercurio.local>
 <CAKmc4PbUZEqQKeQteF5uKFiKApT9E8_ghp69fEG7AhiqQB6wxQ@mail.gmail.com>
Message-ID: <etPan.53a3484e.12200854.172@mercurio.local>

?On 20 June 2014 at 00:24:58, Karl Jackson (isskjj at gmail.com) wrote:
> > It did not produce any output. It looks like RABBITMQ_SERVER_ERL_ARGS  
> is not set

Can you set it to?

"+K true +A30 +P 1048576 -kernel inet_default_connect_options [{nodelay,true}]"

and try again?

http://www.rabbitmq.com/configure.html explains how to do it.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From isskjj at gmail.com  Thu Jun 19 21:31:00 2014
From: isskjj at gmail.com (Karl Jackson)
Date: Thu, 19 Jun 2014 14:31:00 -0600
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <etPan.53a3476c.515f007c.172@mercurio.local>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <etPan.53a3476c.515f007c.172@mercurio.local>
Message-ID: <CAKmc4Pa4cwYSrnrMCT+owhV0MoZ+7p8zxHM9DTZ8sYez9JSikQ@mail.gmail.com>

Typing 'erl' from the command line as rabbitmq shows

erl

Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2]
[async-threads:0] [kernel-poll:false]


Eshell V5.8.5  (abort with ^G)

1>

Thank you,

Karl Jackson


On Thu, Jun 19, 2014 at 2:25 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 19 June 2014 at 23:58:50, Brett Cameron (brett.r.cameron at gmail.com)
> wrote:
> > > What happens if you do "rabbitmq-server" interactively ("$
> > sudo rabbitmq-server", or whatever)? Any interesting output?
>
> I'm also curious if `erl` (Erlang shell) starts at all.
>
> The VM seems to exit before it can even start  the error logger.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/0beaa08d/attachment.html>

From mklishin at gopivotal.com  Thu Jun 19 21:34:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 00:34:10 +0400
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CAKmc4Pa4cwYSrnrMCT+owhV0MoZ+7p8zxHM9DTZ8sYez9JSikQ@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <etPan.53a3476c.515f007c.172@mercurio.local>
 <CAKmc4Pa4cwYSrnrMCT+owhV0MoZ+7p8zxHM9DTZ8sYez9JSikQ@mail.gmail.com>
Message-ID: <etPan.53a3495c.4db127f8.172@mercurio.local>

On 20 June 2014 at 00:31:01, Karl Jackson (isskjj at gmail.com) wrote:
> > Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2]  
> [async-threads:0] [kernel-poll:false]

Very odd. You have 2 CPU cores but Erlang VM decides to use 2 schedulers
(that run code) and 0 I/O threads (which are needed for schedulers to not
be blocked by I/O operations).

Is upgrading Erlang to R16B03 an option for you? You can find packages
for various platforms ?here:

https://www.erlang-solutions.com/downloads/download-erlang-otp
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From james.gardner at noaa.gov  Thu Jun 19 21:37:07 2014
From: james.gardner at noaa.gov (James Gardner)
Date: Thu, 19 Jun 2014 15:37:07 -0500
Subject: [rabbitmq-discuss] Connection and channel age
Message-ID: <53A349F3.6010102@noaa.gov>


Hi,

Is there any way to find the age/time of a connection or channel using 
the web management interface?
It would be useful information for us; how long a client has stayed 
connected, or when they did. And if there are multiple connections from 
the same app piling up for some reason, it would be useful to see how 
those connections were made over time, as well as be able to kick the 
oldest connections instead of the more recent ones.
If there isn't a way, please consider this a feature request :) In the 
web interface, I would even settle for that info being displayed in a 
mouse hover-over somewhere, as well as through the command line tools.
Thanks,

James Gardner (NIDS - NOAA)


From mklishin at gopivotal.com  Thu Jun 19 21:43:12 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 00:43:12 +0400
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CAKmc4PaKk16+mdKzi=LsO081c9nBC6UKQ3EbT7SAGqPa7Oat4A@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>
 <etPan.53a345a0.79e2a9e3.172@mercurio.local>
 <CAKmc4PbUZEqQKeQteF5uKFiKApT9E8_ghp69fEG7AhiqQB6wxQ@mail.gmail.com>
 <etPan.53a3484e.12200854.172@mercurio.local>
 <CAKmc4PaKk16+mdKzi=LsO081c9nBC6UKQ3EbT7SAGqPa7Oat4A@mail.gmail.com>
Message-ID: <etPan.53a34b7a.216231b.172@mercurio.local>

+ rabbitmq-discuss?

On 20 June 2014 at 00:39:14, Karl Jackson (isskjj at gmail.com) wrote:
> > I added set the environment variable in /etc/rabbitmq/rabbitmq-env.conf.  
> The file now looks like
>  
> #example rabbitmq-env.con file entries
> #set the port address
> NODE_PORT=55672
> RABBITMQ_SERVER_ERL_ARGS="+K true +A30 +P 1048576(tel://1048576)  
> -kernel inet_default_connect_options [{nodelay,true}]"  
>  
>  
> I then tried starting rabbitmq-server, but I got the same error.  

Some research suggests it may be a version-specific problem
where VM needs to report an issue early on start:

http://erlang.org/pipermail/erlang-questions/2010-July/052540.html

Please try with R17 or R16B03. Sorry.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 19 21:45:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 00:45:10 +0400
Subject: [rabbitmq-discuss] Connection and channel age
In-Reply-To: <53A349F3.6010102@noaa.gov>
References: <53A349F3.6010102@noaa.gov>
Message-ID: <etPan.53a34bf0.1f16e9e8.172@mercurio.local>

?On 20 June 2014 at 00:38:13, James Gardner (james.gardner at noaa.gov) wrote:
> > Is there any way to find the age/time of a connection or channel  
> using
> the web management interface?
> It would be useful information for us; how long a client has stayed  
> connected, or when they did. And if there are multiple connections  
> from
> the same app piling up for some reason, it would be useful to see  
> how
> those connections were made over time, as well as be able to kick  
> the
> oldest connections instead of the more recent ones.
> If there isn't a way, please consider this a feature request :)?

The only way to do this right now is to correlate connection names
(e.g. "127.0.0.1:62051 -> 127.0.0.1:5672") with log entries like

=INFO REPORT==== 20-Jun-2014::10:43:21 ===
accepting AMQP connection <0.613.0> (127.0.0.1:62051 -> 127.0.0.1:5672)

This feature makes sense, we will consider it!
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From scott.kendall.mcfadden at gmail.com  Fri Jun 20 03:39:57 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Thu, 19 Jun 2014 21:39:57 -0500
Subject: [rabbitmq-discuss] SocketException when invoking
	model.BasicPublish
In-Reply-To: <etPan.53a253b3.21f57e54.9b32@mercurio.local>
References: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
 <865c7ac8-1b72-4bf2-8696-01818d37c4d6@googlegroups.com>
 <etPan.53a24557.41b71efb.f14@mercurio.local>
 <CAJGQrQC6ckw1r73H+Xv7GDDFZ0n5Rt21DwkAEvZTCeXEEuKa_Q@mail.gmail.com>
 <etPan.53a253b3.21f57e54.9b32@mercurio.local>
Message-ID: <CAJGQrQBjqa0uL23qduuVR4TvGk2FbhEmt9fc+sqkn=2C1vsRqQ@mail.gmail.com>

Hello Michael, per your suggestion I put the open connection logic in the
class initializer (it only happens once right after construction).  Getting
the connection works fine.  However basic publish still encounters an
error.  However, the error is slightly different this time around.  I
invoked the java tracing proxy so you can see the wire data.

Client side error when invoking basic publish:

System.ArgumentNullException: String reference not set to an instance of a
String.
Parameter name: s
   at System.Text.Encoding.GetBytes(String s)
   at RabbitMQ.Client.Impl.WireFormatting.WriteShortstr(NetworkBinaryWriter
writer, String val)
   at RabbitMQ.Client.Impl.ContentHeaderPropertyWriter.WriteShortstr(String
val)
   at
RabbitMQ.Client.Framing.v0_9_1.BasicProperties.WritePropertiesTo(ContentHeaderPropertyWriter
writer)
   at RabbitMQ.Client.Impl.ContentHeaderBase.WriteTo(NetworkBinaryWriter
writer, UInt64 bodySize)
   at RabbitMQ.Client.Impl.Command.Transmit(Int32 channelNumber,
ConnectionBase connection)
   at RabbitMQ.Client.Impl.SessionBase.Transmit(Command cmd)
   at RabbitMQ.Client.Impl.ModelBase.ModelSend(MethodBase method,
ContentHeaderBase header, Byte[] body)
   at
RabbitMQ.Client.Framing.Impl.v0_9_1.Model._Private_BasicPublish(String
exchange, String routingKey, Boolean mandatory, Boolean immediate,
IBasicProperties basicProperties, Byte[] body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, Boolean mandatory, Boolean immediate, IBasicProperties
basicProperties, Byte[] body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, Boolean mandatory, IBasicProperties basicProperties, Byte[]
body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, IBasicProperties basicProperties, Byte[] body)


Tracer output:

Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
   Serially traces connections on the <listenport>, logging
   frames received and passing them to the connect host and port.
Invoked as: Tracer 5672 devtest01 5672
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
com.rabbitmq.tools.Tracer.SUPPRESS_COMMAND_BODIES = false
1403231368956: <Tracer-0> ch#0 <-
{#method<connection.start>(version-major=0, v
rsion-minor=9, server-properties={product=RabbitMQ,
cluster_name=rabbit at DEVTEST
1.criticaltech.com, information=Licensed under the MPL.  See
http://www.rabbitm
.com/, platform=Erlang/OTP, capabilities={exchange_exchange_bindings=true,
auth
ntication_failure_close=true, consumer_priorities=true,
consumer_cancel_notify=
rue, basic.nack=true, publisher_confirms=true, connection.blocked=true},
copyri
ht=Copyright (C) 2007-2013 GoPivotal, Inc., version=3.3.0},
mechanisms=AMQPLAIN
PLAIN, locales=en_US), null, ""}
1403231368956: <Tracer-0> ch#0 ->
{#method<connection.start-ok>(client-properti
s={product=RabbitMQ, platform=.NET, information=Licensed under the MPL.
 See ht
p://www.rabbitmq.com/, copyright=Copyright (C) 2007-2013 GoPivotal, Inc.,
capab
lities={exchange_exchange_bindings=true, authentication_failure_close=true,
con
umer_cancel_notify=true, basic.nack=true, publisher_confirms=true,
connection.b
ocked=true}, version=3.3.0.0}, mechanism=PLAIN, response= logmanager
rfc1945, l
cale=en_US), null, ""}
1403231369155: <Tracer-0> ch#0 <- {#method<connection.tune>(channel-max=0,
fram
-max=131072, heartbeat=580), null, ""}
1403231369159: <Tracer-0> ch#0 ->
{#method<connection.tune-ok>(channel-max=0, f
ame-max=131072, heartbeat=580), null, ""}
1403231369161: <Tracer-0> ch#0 -> {#method<connection.open>(virtual-host=/,
cap
bilities=, insist=false), null, ""}
1403231369374: <Tracer-0> ch#0 <-
{#method<connection.open-ok>(known-hosts=), n
ll, ""}
1403231383444: <Tracer-0> ch#1 -> {#method<channel.open>(out-of-band=),
null, "
}
1403231383668: <Tracer-0> ch#1 <- {#method<channel.open-ok>(channel-id=),
null,
""}
Exception in thread "Thread-2" com.rabbitmq.client.UnexpectedFrameError:
Receiv
d frame: Frame(type=1, channel=1, 18 bytes of payload), expected type
2Stopped.

        at
com.rabbitmq.client.impl.CommandAssembler.consumeHeaderFrame(Command
ssembler.java:106)
        at
com.rabbitmq.client.impl.CommandAssembler.handleFrame(CommandAssembl
r.java:159)
        at
com.rabbitmq.client.impl.AMQCommand.handleFrame(AMQCommand.java:87)
        at
com.rabbitmq.tools.Tracer$DirectionHandler.doFrame(Tracer.java:331)
        at com.rabbitmq.tools.Tracer$DirectionHandler.run(Tracer.java:343)
        at java.lang.Thread.run(Unknown Source)


Server output

=INFO REPORT==== 19-Jun-2014::21:29:29 ===
accepting AMQP connection <0.646.0> (172.17.9.14:57049 -> 172.17.9.24:5672)

=ERROR REPORT==== 19-Jun-2014::21:29:47 ===
AMQP connection <0.646.0> (running), channel 1 - error:
{amqp_error,unexpected_frame,
            "expected content header for class 60, got non content header
frame instead",
            'basic.publish'}

=INFO REPORT==== 19-Jun-2014::21:29:47 ===
closing AMQP connection <0.646.0> (172.17.9.14:57049 -> 172.17.9.24:5672)


This client code use to work before we had to restore an old VM snapshot of
the RabitMQ server.  We had to re-install / re-configure our RabbitMQ on
the vm image.  Not sure what I have done to foul it up.

Please advise.


thanks

Scott McFadden




On Wed, Jun 18, 2014 at 10:05 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 19 June 2014 at 07:02:17, Scott McFadden (
> scott.kendall.mcfadden at gmail.com) wrote:
> > > It makes me think I screwed up the server side configuration
> > when reinstalling.
>
> There is no configuration that can affect framing/frame interleaving in
> the client.
> This is also the kind of issues that we'd see reported constantly if it
> was a client
> issue. Finally, it happens on a brand new connection.
>
> I'd recommend doing two things:
>
>  * Running a tracer proxy in front of RabbitMQ [1] to see what's being
> sent on the wire
>  * Open a connection on app start if you can instead of opening a new one
> per channel
>
> If the latter does not change anything, please post the output of the
> tracer.
>
> 1. http://www.rabbitmq.com/java-tools.html, see Tracer
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/b927aeec/attachment.html>

From mklishin at gopivotal.com  Fri Jun 20 04:50:59 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 07:50:59 +0400
Subject: [rabbitmq-discuss] SocketException when invoking
 model.BasicPublish
In-Reply-To: <CAJGQrQBjqa0uL23qduuVR4TvGk2FbhEmt9fc+sqkn=2C1vsRqQ@mail.gmail.com>
References: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
 <865c7ac8-1b72-4bf2-8696-01818d37c4d6@googlegroups.com>
 <etPan.53a24557.41b71efb.f14@mercurio.local>
 <CAJGQrQC6ckw1r73H+Xv7GDDFZ0n5Rt21DwkAEvZTCeXEEuKa_Q@mail.gmail.com>
 <etPan.53a253b3.21f57e54.9b32@mercurio.local>
 <CAJGQrQBjqa0uL23qduuVR4TvGk2FbhEmt9fc+sqkn=2C1vsRqQ@mail.gmail.com>
Message-ID: <etPan.53a3afc0.6b8b4567.56f5@mercurio.local>



On 20 June 2014 at 06:39:58, Scott McFadden (scott.kendall.mcfadden at gmail.com) wrote:
> > System.ArgumentNullException: String reference not set  
> to an instance of a String.
> Parameter name: s
> at System.Text.Encoding.GetBytes(String s)
> at RabbitMQ.Client.Impl.WireFormatting.WriteShortstr(NetworkBinaryWriter  
> writer, String val)
> at RabbitMQ.Client.Impl.ContentHeaderPropertyWriter.WriteShortstr(String  
> val)
> at RabbitMQ.Client.Framing.v0_9_1.BasicProperties.WritePropertiesTo(ContentHeaderPropertyWriter  
> writer)
> at RabbitMQ.Client.Impl.ContentHeaderBase.WriteTo(NetworkBinaryWriter  
> writer, UInt64 bodySize)
> at RabbitMQ.Client.Impl.Command.Transmit(Int32 channelNumber,  

?

> Exception in thread "Thread-2" com.rabbitmq.client.UnexpectedFrameError:  
> Receiv
> d frame: Frame(type=1, channel=1, 18 bytes of payload), expected  
> type 2Stopped.
>  
> at com.rabbitmq.client.impl.CommandAssembler.consumeHeaderFrame(Command  
> ssembler.java:106)
> at com.rabbitmq.client.impl.CommandAssembler.handleFrame(CommandAssembl  
> r.java:159)
> at com.rabbitmq.client.impl.AMQCommand.handleFrame(AMQCommand.java:87)  

Scott,

This suggests that one of the message properties that is expected to be a string
is not set to a string. In your code, you do

props.SetPersistent(this.PersistMessages); ? ? ? ? ? ? ? ?
props.ContentType = contentType;
props.Type = messageType.FullName;
props.MessageId = messageId;

Can you please try identifying which property it is by elimination and
send me (off-list if there's something confidential) what its value
is at runtime?

Both RabbitMQ and Tracer cannot decode what the client sends over the wire,
I suspect this is a genuine .NET client issue: it doesn't reject the inputs
it should.

Also, what encoding does the system use by default and what OS and .NET version
do you run??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ranjithavshet09 at gmail.com  Fri Jun 20 07:16:13 2014
From: ranjithavshet09 at gmail.com (Ranjitha Shet)
Date: Fri, 20 Jun 2014 11:46:13 +0530
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <etPan.5396bcb1.2ae8944a.9b84@mercurio.local>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
 <etPan.53906b45.6b8b4567.166c0@mercurio.local>
 <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>
 <etPan.5396b764.74b0dc51.9b84@mercurio.local>
 <CAP2+pdysviMg8q7HqY3_Fwwr3ZOhARO-7A4+AiMfJ9Q5iX=S+Q@mail.gmail.com>
 <etPan.5396bcb1.2ae8944a.9b84@mercurio.local>
Message-ID: <CAP2+pdy0Y6bNFPTXb_hd6FJEXtCxrCwHFc84XNoSEzg+MK=DeA@mail.gmail.com>

>
>  Hi,
>


*>> when I disconnect the network cable, say it gets disconnected when both
receiving and publishing takes place.. (Message published and received are
different messages(same exchange))  ----> say the name is exchange1
published from server side*

Connections, channels, exchange, queue, binding all can be viewed  in
Management plugin after reconnecting the network cable. From this can i
assume that reconnection is successful?
But if from server side there is a publish to same exchange (exchange1)
 after reconnecting (say the server publish some message after 5mins of
reconnection) , then i still get this error.

DefaultExceptionHandler: Consumer
com.rabbitmq.client.QueueingConsumer at 5edcf5
(amq.ctag-AcMX2m0FBSPePzrjNqDi7Z) method handleDelivery for channel
AMQChannel(amqp://guest at localhost:5672/,1) threw an exception for channel
AMQChannel(amqp://guest at localhost:5672/,1):
com.rabbitmq.client.ShutdownSignalException: connection error
at
com.rabbitmq.client.QueueingConsumer.checkShutdown(QueueingConsumer.java:172)
at
com.rabbitmq.client.QueueingConsumer.handleDelivery(QueueingConsumer.java:124)
at
com.rabbitmq.client.impl.ConsumerDispatcher$5.run(ConsumerDispatcher.java:140)
at
com.rabbitmq.client.impl.ConsumerWorkService$WorkPoolRunnable.run(ConsumerWorkService.java:85)
at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
at java.lang.Thread.run(Thread.java:619)
Caused by: java.net.SocketException: Software caused connection abort: recv
failed
at java.net.SocketInputStream.socketRead0(Native Method)
at java.net.SocketInputStream.read(SocketInputStream.java:129)
at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:139)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:532)
... 1 more


I am not getting how to solve this..
When checked in Management plugin, after getting this exception, Channel
and Queue is no more available.

to receive message what I do is -->

while(true){

try{

QueueingConsumer.Delivery delivery = consumer.nextDelivery();
..
..
}
catch (ShutdownSignalException sse) {

// notify client about network disconnection
// check if connection and channel is open... if its open then this current
thread is delayed for some time so that exchange, queue, binding and
consumer are restored..

} catch (java.io.IOException ioe) {

}


} // end of while
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/febaa8a1/attachment.html>

From mklishin at gopivotal.com  Fri Jun 20 07:23:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 10:23:10 +0400
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <CAP2+pdy0Y6bNFPTXb_hd6FJEXtCxrCwHFc84XNoSEzg+MK=DeA@mail.gmail.com>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
 <etPan.53906b45.6b8b4567.166c0@mercurio.local>
 <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>
 <etPan.5396b764.74b0dc51.9b84@mercurio.local>
 <CAP2+pdysviMg8q7HqY3_Fwwr3ZOhARO-7A4+AiMfJ9Q5iX=S+Q@mail.gmail.com>
 <etPan.5396bcb1.2ae8944a.9b84@mercurio.local>
 <CAP2+pdy0Y6bNFPTXb_hd6FJEXtCxrCwHFc84XNoSEzg+MK=DeA@mail.gmail.com>
Message-ID: <etPan.53a3d367.643c9869.56f5@mercurio.local>



On 20 June 2014 at 10:16:14, Ranjitha Shet (ranjithavshet09 at gmail.com) wrote:
> > to receive message what I do is -->
>  
> while(true){
>  
> try{
>  
> QueueingConsumer.Delivery delivery = consumer.nextDelivery();  
> ..
> ..
> }
> catch (ShutdownSignalException sse) {
>  
> // notify client about network disconnection
> // check if connection and channel is open... if its open then  
> this current thread is delayed for some time so that exchange,  
> queue, binding and consumer are restored..
>  
> } catch (java.io.IOException ioe) {
>  
> }
>  
>  
> } // end of while

QueueingConsumers currently cannot be recovered: on shutdown,
they modify their internal state in a way that marks them as "done".
Think of them as Iterators which have a logical end.

You have two options:

?* Use a "regular" consumer (recommended)
?* Add a recovery listener and re-create the queueing consumer

Automatic connection recovery simply re-adds the consumer(s) you previously
had, without knowing anything about their implementation and if they can "self terminate"
like the QueueingConsumer does.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From jharna.sharma at aricent.com  Fri Jun 20 09:25:01 2014
From: jharna.sharma at aricent.com (Jharna Sharma)
Date: Fri, 20 Jun 2014 13:55:01 +0530
Subject: [rabbitmq-discuss] listing producers
Message-ID: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>

How can I get information about producers per exchange connection..??

Please help...
Thank you


"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/c22926e9/attachment.html>

From mklishin at gopivotal.com  Fri Jun 20 09:27:28 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 12:27:28 +0400
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <etPan.53a3f08e.66334873.56f5@mercurio.local>

?On 20 June 2014 at 12:26:29, Jharna Sharma (jharna.sharma at aricent.com) wrote:
> > How can I get information about producers per exchange connection..??  

What can of information are you looking for?

Sorry, I do not understand "per exchange connection".
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From wuaner at gmail.com  Fri Jun 20 09:32:12 2014
From: wuaner at gmail.com (RabbitMqUser)
Date: Fri, 20 Jun 2014 01:32:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Delete a long-time-empty queue?
Message-ID: <1f32e6fa-e648-4a28-9c30-3e8926e6cd13@googlegroups.com>

I noticed that:

auto-delete will delete queue when count of consumers decrease to 0;
Queue TTL will delete queue when non-consumed time exceed TTL;

Even though the queue that been deleted is not empty! 
So my question is, Is there any chance we lost messages when use 
auto-delete or Queue TTL? 
How can I delete a queue based on time of it's empty since, other that time 
of non-consumed?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/49fe68a9/attachment.html>

From mklishin at gopivotal.com  Fri Jun 20 09:35:31 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 12:35:31 +0400
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <etPan.53a3f271.19495cff.56f5@mercurio.local>

+ rabbitmq-discuss

On 20 June 2014 at 12:33:56, Jharna Sharma (jharna.sharma at aricent.com) wrote:
> > With respect to an exchange, there will be many producers whose 
> messages are dispatched to it. I want to get the information of 
> producers.
> Like "list_consumers" lists the information about consumers. 

Unlike with consumers, there is no concept of "producer".

Do you need a list of connections that publish messages to
a specific exchange?
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jun 20 09:37:26 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 12:37:26 +0400
Subject: [rabbitmq-discuss] Delete a long-time-empty queue?
In-Reply-To: <1f32e6fa-e648-4a28-9c30-3e8926e6cd13@googlegroups.com>
References: <1f32e6fa-e648-4a28-9c30-3e8926e6cd13@googlegroups.com>
Message-ID: <etPan.53a3f2e1.2ae8944a.56f5@mercurio.local>

On 20 June 2014 at 12:34:26, RabbitMqUser (wuaner at gmail.com) wrote:
> > How can I delete a queue based on time of it's empty since, other  
> that time of non-consumed?

There is no way to do this at the moment. We have a bug open for that.

You can try exclusive queues: they are deleted when the connection that declared
them is closed. So if your consumers can detect a period of ?inactivity and disconnect,
it will be deleted.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From jharna.sharma at aricent.com  Fri Jun 20 09:38:01 2014
From: jharna.sharma at aricent.com (Jharna Sharma)
Date: Fri, 20 Jun 2014 14:08:01 +0530
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <etPan.53a3f271.19495cff.56f5@mercurio.local>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f271.19495cff.56f5@mercurio.local>
Message-ID: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>

Yes, how to get a list of such connections..??

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com]
Sent: Friday, June 20, 2014 2:06 PM
To: Jharna Sharma
Cc: Discussions about RabbitMQ
Subject: RE: [rabbitmq-discuss] listing producers

+ rabbitmq-discuss

On 20 June 2014 at 12:33:56, Jharna Sharma (jharna.sharma at aricent.com) wrote:
> > With respect to an exchange, there will be many producers whose
> messages are dispatched to it. I want to get the information of
> producers.
> Like "list_consumers" lists the information about consumers.

Unlike with consumers, there is no concept of "producer".

Do you need a list of connections that publish messages to
a specific exchange?
--
MK

Software Engineer, Pivotal/RabbitMQ


"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."

From mklishin at gopivotal.com  Fri Jun 20 09:43:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 12:43:53 +0400
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f271.19495cff.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <etPan.53a3f467.238e1f29.56f5@mercurio.local>

On 20 June 2014 at 12:38:10, Jharna Sharma (jharna.sharma at aricent.com) wrote:
> > Yes, how to get a list of such connections..??

You can get a list connections that publish messages by listing channels,
filtering out those with 0 message rates, and accessing?connection_details
for the channels with positive message rates.

There is no way to correlate exchanges to channels, though.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From wuaner at gmail.com  Fri Jun 20 10:02:37 2014
From: wuaner at gmail.com (Sigmund Lee)
Date: Fri, 20 Jun 2014 17:02:37 +0800
Subject: [rabbitmq-discuss] Delete a long-time-empty queue?
In-Reply-To: <etPan.53a3f2e1.2ae8944a.56f5@mercurio.local>
References: <1f32e6fa-e648-4a28-9c30-3e8926e6cd13@googlegroups.com>
 <etPan.53a3f2e1.2ae8944a.56f5@mercurio.local>
Message-ID: <CALQDGEDYMbox6mUw94cSLrmZFF+RQX6Rni94Vu_NHSn-mtu53A@mail.gmail.com>

Hi MK,
Thanks so much for your prompt response.

My queue declaration is on the Producer side, so exclusive is probably not
a solution.

Since the deletion of auto-delete and Queue TTL is based on actual
consumption, without regard to queue's depth, so we will have the risk that
lost the messsges reside it when queue has been deleted?

Do your guys have any plane to fix this bug in the near release?



On Fri, Jun 20, 2014 at 4:37 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 20 June 2014 at 12:34:26, RabbitMqUser (wuaner at gmail.com) wrote:
> > > How can I delete a queue based on time of it's empty since, other
> > that time of non-consumed?
>
> There is no way to do this at the moment. We have a bug open for that.
>
> You can try exclusive queues: they are deleted when the connection that
> declared
> them is closed. So if your consumers can detect a period of  inactivity
> and disconnect,
> it will be deleted.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/17a912f7/attachment.html>

From wuaner at gmail.com  Fri Jun 20 10:03:39 2014
From: wuaner at gmail.com (Sigmund Lee)
Date: Fri, 20 Jun 2014 17:03:39 +0800
Subject: [rabbitmq-discuss] Delete a long-time-empty queue?
In-Reply-To: <CALQDGEDYMbox6mUw94cSLrmZFF+RQX6Rni94Vu_NHSn-mtu53A@mail.gmail.com>
References: <1f32e6fa-e648-4a28-9c30-3e8926e6cd13@googlegroups.com>
 <etPan.53a3f2e1.2ae8944a.56f5@mercurio.local>
 <CALQDGEDYMbox6mUw94cSLrmZFF+RQX6Rni94Vu_NHSn-mtu53A@mail.gmail.com>
Message-ID: <CALQDGEDnBjEwoD8Wyh=hhV_Ay7+dzHfBE0Qf+4sORug=B-qa9w@mail.gmail.com>

Hi MK,
Thanks so much for your prompt response.

My queue declaration is on the Producer side, so exclusive is probably not
a solution.

Since the deletion of auto-delete and Queue TTL is based on actual
consumption, without regard to queue's depth, so we will have the risk that
lost the messsges reside it when queue has been deleted?

Do your guys have any plane to fix this bug in the near release?


Regards.
-- Sig


On Fri, Jun 20, 2014 at 5:02 PM, Sigmund Lee <wuaner at gmail.com> wrote:

> Hi MK,
> Thanks so much for your prompt response.
>
> My queue declaration is on the Producer side, so exclusive is probably
> not a solution.
>
> Since the deletion of auto-delete and Queue TTL is based on actual
> consumption, without regard to queue's depth, so we will have the risk that
> lost the messsges reside it when queue has been deleted?
>
> Do your guys have any plane to fix this bug in the near release?
>
>
>
> On Fri, Jun 20, 2014 at 4:37 PM, Michael Klishin <mklishin at gopivotal.com>
> wrote:
>
>> On 20 June 2014 at 12:34:26, RabbitMqUser (wuaner at gmail.com) wrote:
>> > > How can I delete a queue based on time of it's empty since, other
>> > that time of non-consumed?
>>
>> There is no way to do this at the moment. We have a bug open for that.
>>
>> You can try exclusive queues: they are deleted when the connection that
>> declared
>> them is closed. So if your consumers can detect a period of  inactivity
>> and disconnect,
>> it will be deleted.
>> --
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/9367ac6c/attachment.html>

From mklishin at gopivotal.com  Fri Jun 20 10:07:43 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 13:07:43 +0400
Subject: [rabbitmq-discuss] Delete a long-time-empty queue?
In-Reply-To: <CALQDGEDYMbox6mUw94cSLrmZFF+RQX6Rni94Vu_NHSn-mtu53A@mail.gmail.com>
References: <1f32e6fa-e648-4a28-9c30-3e8926e6cd13@googlegroups.com>
 <etPan.53a3f2e1.2ae8944a.56f5@mercurio.local>
 <CALQDGEDYMbox6mUw94cSLrmZFF+RQX6Rni94Vu_NHSn-mtu53A@mail.gmail.com>
Message-ID: <etPan.53a3f9fd.46e87ccd.56f5@mercurio.local>

On 20 June 2014 at 13:04:51, Sigmund Lee (wuaner at gmail.com) wrote:
> > Since the deletion of auto-delete and Queue TTL is based on actual 
> consumption, without regard to queue's depth, so we will have 
> the risk that lost the messsges reside it when queue has been deleted? 

Yes, setting TTL on queues should be done with care and consideration.

> Do your guys have any plane to fix this bug in the near release? 

There is no consensus on how exactly this feature should work so far.
No promises.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From jharna.sharma at aricent.com  Fri Jun 20 10:12:25 2014
From: jharna.sharma at aricent.com (Jharna Sharma)
Date: Fri, 20 Jun 2014 14:42:25 +0530
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <etPan.53a3f467.238e1f29.56f5@mercurio.local>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f271.19495cff.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f467.238e1f29.56f5@mercurio.local>
Message-ID: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF834BA@GUREXMB01.ASIAN.AD.ARICENT.COM>

Is there any way to get message rate through rabbitmqctl..??
Because I can know connection for a channel by "rabbitmqctl list_channels pid connection" and I am not being able to get it through rabbitmqadmin.

Sorry for asking same question again & again, I am new on rabbitMQ and not much clear about channel.

Thank you...

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com]
Sent: Friday, June 20, 2014 2:14 PM
To: Jharna Sharma
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] listing producers

On 20 June 2014 at 12:38:10, Jharna Sharma (jharna.sharma at aricent.com) wrote:
> > Yes, how to get a list of such connections..??

You can get a list connections that publish messages by listing channels,
filtering out those with 0 message rates, and accessing connection_details
for the channels with positive message rates.

There is no way to correlate exchanges to channels, though.
--
MK

Software Engineer, Pivotal/RabbitMQ


"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."

From mklishin at gopivotal.com  Fri Jun 20 10:16:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 13:16:19 +0400
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF834BA@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f271.19495cff.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f467.238e1f29.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF834BA@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <etPan.53a3fc01.507ed7ab.56f5@mercurio.local>

?On 20 June 2014 at 13:14:42, Jharna Sharma (jharna.sharma at aricent.com) wrote:
> > Is there any way to get message rate through rabbitmqctl..??  
> Because I can know connection for a channel by "rabbitmqctl list_channels  
> pid connection" and I am not being able to get it through rabbitmqadmin.  

Note. You have to use HTTP API which ships with the management plugin:

http://www.rabbitmq.com/management.html
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_3/priv/www/api/index.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From zbian at tibco-support.com  Fri Jun 20 10:10:38 2014
From: zbian at tibco-support.com (Bian Zhouyong)
Date: Fri, 20 Jun 2014 17:10:38 +0800
Subject: [rabbitmq-discuss] message filter for Rabbit MQ
Message-ID: <53a3fa8b.a2c5440a.1691.4150@mx.google.com>

Hi all:

I have a problem with the exchange type of amq.topic. I create a queue named
hello and bind it with amq.topic with routingkey(hello) and
arguments(area:us), I want to put all the message with the property area=us
into this queue, but it seems the arguments doesn't filter the messages. But
the header properties with exchange type of amq.headers works well on
message filter. So I wander to know whether the exchange type of amq.topic
doesn't support message filter with the binding arguments?

 

Thanks

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/34757eec/attachment.html>

From mklishin at gopivotal.com  Fri Jun 20 10:35:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 20 Jun 2014 13:35:38 +0400
Subject: [rabbitmq-discuss] message filter for Rabbit MQ
In-Reply-To: <53a3fa8b.a2c5440a.1691.4150@mx.google.com>
References: <53a3fa8b.a2c5440a.1691.4150@mx.google.com>
Message-ID: <etPan.53a40087.2eb141f2.56f5@mercurio.local>

?On 20 June 2014 at 13:34:56, Bian Zhouyong (zbian at tibco-support.com) wrote:
> > I have a problem with the exchange type of amq.topic. I create  
> a queue named hello and bind it with amq.topic with routingkey(hello)  
> and arguments(area:us), I want to put all the message with the  
> property area=us into this queue, but it seems the arguments  
> doesn?t filter the messages. But the header properties with  
> exchange type of amq.headers works well on message filter. So  
> I wander to know whether the exchange type of amq.topic doesn?t  
> support message filter with the binding arguments?

Topic exchanges route messages based on the routing key, see tutorial 5:
http://www.rabbitmq.com/getstarted.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Fri Jun 20 11:01:06 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jun 2014 11:01:06 +0100
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <etPan.53a3f467.238e1f29.56f5@mercurio.local>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f271.19495cff.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f467.238e1f29.56f5@mercurio.local>
Message-ID: <53A40662.6050104@rabbitmq.com>

On 20/06/14 09:43, Michael Klishin wrote:
> There is no way to correlate exchanges to channels, though.

Yes there is, see "Detailed message stats objects" at 
http://hg.rabbitmq.com/rabbitmq-management/raw-file/stable/priv/www/doc/stats.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 20 11:08:59 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jun 2014 11:08:59 +0100
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF834BA@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f271.19495cff.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f467.238e1f29.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF834BA@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <53A4083B.1070101@rabbitmq.com>

On 20/06/14 10:12, Jharna Sharma wrote:
> Is there any way to get message rate through rabbitmqctl..??

No, message rates are aggregated through the management plugin.

> Because I can know connection for a channel by "rabbitmqctl
> list_channels pid connection" and I am not being able to get it
> through rabbitmqadmin.

The HTTP API (and thus rabbitmqadmin) does not identify connections and 
channels by pid but by their generated name. So you could use something 
like:

$ rabbitmqadmin list channels connection_details.name number 
message_stats.publish_details.rate

Tip: use "rabbitmqadmin -f pretty_json list channels" to see what's 
available in the output.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jharna.sharma at aricent.com  Fri Jun 20 11:42:45 2014
From: jharna.sharma at aricent.com (Jharna Sharma)
Date: Fri, 20 Jun 2014 16:12:45 +0530
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <53A40662.6050104@rabbitmq.com>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f271.19495cff.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f467.238e1f29.56f5@mercurio.local> <53A40662.6050104@rabbitmq.com>
Message-ID: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83524@GUREXMB01.ASIAN.AD.ARICENT.COM>

How to use "Detailed message stats objects"..??
like we can use "message_stats objects" by "rabbitmqadmin list queues name messages message_stats.publish_details.rate"...
I tried few things but it's not working.

Please give any example which shows how to use "Detailed message stats objects"

Thank you

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: Friday, June 20, 2014 3:31 PM
To: Discussions about RabbitMQ; Jharna Sharma; Michael Klishin
Subject: Re: [rabbitmq-discuss] listing producers

On 20/06/14 09:43, Michael Klishin wrote:
> There is no way to correlate exchanges to channels, though.

Yes there is, see "Detailed message stats objects" at
http://hg.rabbitmq.com/rabbitmq-management/raw-file/stable/priv/www/doc/stats.html

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal


"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."

From simon at rabbitmq.com  Fri Jun 20 11:45:00 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jun 2014 11:45:00 +0100
Subject: [rabbitmq-discuss] listing producers
In-Reply-To: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83524@GUREXMB01.ASIAN.AD.ARICENT.COM>
References: <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83495@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f08e.66334873.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349A@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f271.19495cff.56f5@mercurio.local>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF8349F@GUREXMB01.ASIAN.AD.ARICENT.COM>
 <etPan.53a3f467.238e1f29.56f5@mercurio.local> <53A40662.6050104@rabbitmq.com>
 <DCBD8D06FFAF7A4DB28F21A60EE81A6A488EF83524@GUREXMB01.ASIAN.AD.ARICENT.COM>
Message-ID: <53A410AC.1020205@rabbitmq.com>

 From the docs:

> As this possibly constitutes a large quantity of data, it is only returned when querying a single channel, queue or exchange rather than a list.

Unfortunately rabbitmqadmin only allows you to request lists rather than 
querying a single object. So you can't get these stats from 
rabbitmqadmin, only the web UI or querying the HTTP API directly.

Cheers, Simon

On 20/06/14 11:42, Jharna Sharma wrote:
> How to use "Detailed message stats objects"..??
> like we can use "message_stats objects" by "rabbitmqadmin list queues name messages message_stats.publish_details.rate"...
> I tried few things but it's not working.
>
> Please give any example which shows how to use "Detailed message stats objects"
>
> Thank you
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Friday, June 20, 2014 3:31 PM
> To: Discussions about RabbitMQ; Jharna Sharma; Michael Klishin
> Subject: Re: [rabbitmq-discuss] listing producers
>
> On 20/06/14 09:43, Michael Klishin wrote:
>> There is no way to correlate exchanges to channels, though.
>
> Yes there is, see "Detailed message stats objects" at
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/stable/priv/www/doc/stats.html
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
>
> "DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From ranjithavshet09 at gmail.com  Fri Jun 20 12:28:45 2014
From: ranjithavshet09 at gmail.com (Ranjitha Shet)
Date: Fri, 20 Jun 2014 16:58:45 +0530
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <etPan.53a3d367.643c9869.56f5@mercurio.local>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
 <etPan.53906b45.6b8b4567.166c0@mercurio.local>
 <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>
 <etPan.5396b764.74b0dc51.9b84@mercurio.local>
 <CAP2+pdysviMg8q7HqY3_Fwwr3ZOhARO-7A4+AiMfJ9Q5iX=S+Q@mail.gmail.com>
 <etPan.5396bcb1.2ae8944a.9b84@mercurio.local>
 <CAP2+pdy0Y6bNFPTXb_hd6FJEXtCxrCwHFc84XNoSEzg+MK=DeA@mail.gmail.com>
 <etPan.53a3d367.643c9869.56f5@mercurio.local>
Message-ID: <CAP2+pdwyK3wsn8otU6dSZyVxPGANHqK9rupuOSZOqQ4YCC1SUQ@mail.gmail.com>

Hi,

 * Use a "regular" consumer (recommended)
 * Add a recovery listener and re-create the queueing consumer


I din get what u meant by "regular" consumer.. Should use DefaultConsumer?




On Fri, Jun 20, 2014 at 11:53 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>
>
> On 20 June 2014 at 10:16:14, Ranjitha Shet (ranjithavshet09 at gmail.com)
> wrote:
> > > to receive message what I do is -->
> >
> > while(true){
> >
> > try{
> >
> > QueueingConsumer.Delivery delivery = consumer.nextDelivery();
> > ..
> > ..
> > }
> > catch (ShutdownSignalException sse) {
> >
> > // notify client about network disconnection
> > // check if connection and channel is open... if its open then
> > this current thread is delayed for some time so that exchange,
> > queue, binding and consumer are restored..
> >
> > } catch (java.io.IOException ioe) {
> >
> > }
> >
> >
> > } // end of while
>
> QueueingConsumers currently cannot be recovered: on shutdown,
> they modify their internal state in a way that marks them as "done".
> Think of them as Iterators which have a logical end.
>
> You have two options:
>
>  * Use a "regular" consumer (recommended)
>  * Add a recovery listener and re-create the queueing consumer
>
> Automatic connection recovery simply re-adds the consumer(s) you previously
> had, without knowing anything about their implementation and if they can
> "self terminate"
> like the QueueingConsumer does.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/58159b6c/attachment.html>

From andrei002 at gmail.com  Fri Jun 20 14:09:57 2014
From: andrei002 at gmail.com (Andrei)
Date: Fri, 20 Jun 2014 16:09:57 +0300
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <etPan.53a33641.19495cff.172@mercurio.local>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
 <etPan.539b3300.6b8b4567.50e9@mercurio.local>
 <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>
 <etPan.539b7b20.643c9869.83e5@mercurio.local>
 <CANcm3vkc0JxpjosSiY43k-=wSL74CB-=ni+s4hNR3cuJ00hJyQ@mail.gmail.com>
 <etPan.53a291bd.5b3ef282.9b32@mercurio.local>
 <CANcm3vkrrEs5mx3CaN=iduadcBbDvkRA6V4+n3ikDK_=6ymgvQ@mail.gmail.com>
 <etPan.53a33641.19495cff.172@mercurio.local>
Message-ID: <CANcm3vkys+B7eybxWhA+bk2LcAQWeUdqDPab5b0mqG4E3ayCRQ@mail.gmail.com>

Hello again!

There is nothing more permanent than temporary solutions in software.
> We cannot later tell our commercial customers "you know guys, that feature
> that your app is built on, it was temporary. Good luck with upgrading!"
>

Okay, agreed, now let me rephrase it then: this solution could be made
permanent and marketed as an additional feature, so besides authenticating
using the Websocket connect function, basic authentication via HTTP headers
will also be available. :)

HTTPS should give you a reasonable protection from tampering and MITM.
> Making your credentials user-specific and "tokens" that you use to obtain
> "real" credentials ephemeral should protect reasonably well from malicious
> users.
>

The thing that I don't like about this scheme is that a malicious end-user
has the possibility of brute-forcing the rabbitmq user database by
tampering with the client JS code running in his browser, as currently it's
the only entry point where "real" credentials can be introduced.

Another issue with this approach is that a whole new server module is
needed for handling ticketing, token generation, user access determination
based on pulling data from rabbitmq user database or from LDAP, all of this
adding unnecessary overhead to the entire design, and still not assuring
proper security.

Your plan involves using basic HTTP authentication. How is this really
> more secure than using temporary tokens to programmatically obtain a pair
> of credentials?
>

In the design that I suggest, the weaknesses of the HTTP basic auth are
irrelevant as the rabbitmq instance running Cowboy will be invisible to the
outside world, and also the end-user has no direct access to the entry
point where "real" credentials are introduced:

1. From client JS code any user/password can be introduced in the SockJS
connect string, the exact values are totally irrelevant as these will be
later overwritten, with no end-user possibility of influencing the process
overwriting them;

2. The websocket HTTP handshake request reaches Nginx, which then takes the
CN field from the client certificate, attaches it as a HTTP header to the
request and forwards it to an internal rabbitmq instance, which is hidden
from the outside world.

3. The Web-STOMP plugin overwrites the user-supplied values with those from
the header before forwarding them to the STOMP processor for final
authentication on rabbitmq.

4. ???????

5. PROFIT!!
Authentication takes place completely transparently to the user.

What were the exact steps you performed? R16B02 should be plenty sufficient
> for Cowboy and Rabbit. To build web-stomp, clone the umbrella, `make up` in
> it, then cd rabbitmq-web-stomp and run `make`.
>

That's exactly what I did. Just tried it again, and still the same outcome:

../cowboy-wrapper/cowboy-git/src/cowboy_clock.erl: undefined parse
transform 'eunit_autoexport'
make: *** [../cowboy-wrapper/ebin/cowboy_clock.beam] Error 1

The Google group is just a way for start a conversation
> w/o signing up. Join rabbitmq-discuss proper.
>

The problem seems to be that I joined the group from the Google Groups, and
not from Rabbitmq site. I have now registered there, too, so hopefully this
message will show up properly.

Thanks!
Andy.

On Thu, Jun 19, 2014 at 10:12 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>
>
> On 19 June 2014 at 19:47:28, Andrei (andrei002 at gmail.com) wrote:
> > > Well it won't need that much support as the changes are minimal
> > and impact just a few lines of code in two source files, and also
> > it'll be just a temporary solution till proper support for SSL
> > client auth will be implemented :)
>
> There is nothing more permanent than temporary solutions in software.
> We cannot later tell our commercial customers "you know guys, that feature
> that your app is built on, it was temporary. Good luck with upgrading!"
>
> > > * It may also run into limitations in SockJS
> >
> > What kind of limitations do you mean here?
>
> I can't name any specific one without trying to implement the thing but
> I assure you APIs don't always provide exactly what you want :)
>
> > > So I'd recommend combining HTTPS connection with credentials
> > obtained from an HTTPS endpoint in your JS application.
> >
> > We have considered this approach, however the problem is that
> > the JS code initiating the websocket connection runs in the user's
> > web browser, and this makes such kind of solutions rather insecure.
> > On the other side using client certificate data for authentication
> > is both secure and happens completely transparently to the end-user.
>
> HTTPS should give you a reasonable protection from tampering and MITM.
> Making your credentials user-specific and "tokens" that you use to obtain
> "real" credentials ephemeral should protect reasonably well from malicious
> users.
>
> > So, I'd be very grateful if you could take a closer look at the solution
> > I've previously suggested and provide some hints on which changes
> > should be applied to the sockjs-erlang-wrapper and web-stomp
> > source in order to implement it.. unfortunately I'm having a
> > bit of a hard time figuring out where exactly to add that additional
> > HTTP header processing code..
>
> Your plan involves using basic HTTP authentication. How is this really
> more secure than using temporary tokens to programmatically obtain a pair
> of credentials?
>
> > Another issue I ran into playing with this is an error showing
> > up when trying to compile the original web-stomp plugin from
> > the rabbitmq-public-umbrella:
> >
> > ../cowboy-wrapper/cowboy-git/src/cowboy_clock.erl: undefined
> > parse transform 'eunit_autoexport'
> > make: *** [../cowboy-wrapper/ebin/cowboy_clock.beam] Error
> > 1
> >
> > Could you please shed some light on this? I've checked out the
> > latest rabbitmq-public-umbrella and my Erlang version is R16B02.
>
> What were the exact steps you performed? R16B02 should be plenty sufficient
> for Cowboy and Rabbit. To build web-stomp, clone the umbrella, `make up`
> in it,
> then cd rabbitmq-web-stomp and run `make`.
>
> > > P.S.: Although you have CCd rabbitmq-discuss group in the previous
> > messages, somehow these are not visible to me on the Rabbitmq-discuss
> > Google Group. Are there some viewing or access restrictions
> > set up?
>
> The Google group is just a way for start a conversation
> w/o signing up. Join rabbitmq-discuss proper.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/bdb381ee/attachment.html>

From simon at rabbitmq.com  Fri Jun 20 14:20:21 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jun 2014 14:20:21 +0100
Subject: [rabbitmq-discuss] Queue data recovery after master failure
In-Reply-To: <53A150EB.9050109@rabbitmq.com>
References: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>
 <53A150EB.9050109@rabbitmq.com>
Message-ID: <53A43515.7010201@rabbitmq.com>

On 18/06/14 09:42, Simon MacMullen wrote:
> I'm afraid not. Really "rabbitmqctl forget_cluster_node" should be able
> to cause down slaves to come back as new masters, which would be the
> right solution to this. I'm hoping that we'll be able to do that for
> 3.4.0, but it's a somewhat intrusive change. The bug number for this
> branch will be 26191, so you can keep an eye on it in future (currently
> there's nothing there).

To follow on:

This turns out to be easy if we can assume that there will be a slave to 
promote that is also down (quite likely since you tend to encounter this 
while your cluster is down), so I've done that as a first pass at the 
problem. See:

http://next.rabbitmq.com/ha.html#promotion-while-down

for documentation of how it will be in tonight's nightly build.

26191 is still reserved for the more thorny case of how to do this when 
the rest of the cluster has come back up - there are a lot of issues 
there so it might not happen soon.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dmitry.andrianov at alertme.com  Fri Jun 20 15:21:34 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Fri, 20 Jun 2014 15:21:34 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
Message-ID: <53A4436E.4090407@alertme.com>

Hi.
can a custom exchange plugin access record of the user that sent the 
message?
when I am dumping (with io::format) what came into exchange's route 
function,
I do not see anything that auth backend check_login put into user it 
returned.
There is a user id (CN=xxxyyy, because we are using SSL), but not the 
extra fields auth backend put into impl:

           {ok, #user{username     = Username,
                      tags         = [],
                      auth_backend = ?MODULE,
                      impl         = #impl{first_name  = 
list_to_binary(FirstName)}}}

I would like to access that first_name of the user who posted the 
message if possible...

Thanks

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From simon at rabbitmq.com  Fri Jun 20 15:28:03 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jun 2014 15:28:03 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53A4436E.4090407@alertme.com>
References: <53A4436E.4090407@alertme.com>
Message-ID: <53A444F3.10608@rabbitmq.com>

On 20/06/14 15:21, Dmitry Andrianov wrote:
> can a custom exchange plugin access record of the user that sent the
> message?

It can't, I'm afraid.

What are you trying to do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dmitry.andrianov at alertme.com  Fri Jun 20 15:45:27 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Fri, 20 Jun 2014 15:45:27 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53A444F3.10608@rabbitmq.com>
References: <53A4436E.4090407@alertme.com> <53A444F3.10608@rabbitmq.com>
Message-ID: <53A44907.5090908@alertme.com>

Uh, oh. You will criticize my idea :)

So there is a custom auth backend that extract something from client's 
SSL certificate and puts it into user's impl.
Client is obliged to also provide the same information in AMQP headers.
This is done because our server app also needs that data and by the time 
message reaches it, there is no SSL anymore.

Since client may put whatever it likes in the header, I want that 
RabbitMQ that accepts the message did the validation - compare that 
value in the header and the value from user.impl (extracted from SSL 
cert) are the same or reject the message otherwise.

So we do not trust AMQP headers we receive from the client but we do 
trust the SSL certificate and we do trust AQMP headers after the message 
came through the first Rabbit and was verified.


A am also thinking of relaxing the requirements for the client to add 
that header in the first place - the custom exchange can add it if it is 
missing.
I do understand that it violates AMQP specs but it does not look that 
serious.

Thanks


On 20/06/14 15:28, Simon MacMullen wrote:
> On 20/06/14 15:21, Dmitry Andrianov wrote:
>> can a custom exchange plugin access record of the user that sent the
>> message?
>
> It can't, I'm afraid.
>
> What are you trying to do?
>
> Cheers, Simon
>

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From scott.kendall.mcfadden at gmail.com  Fri Jun 20 16:27:28 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Fri, 20 Jun 2014 10:27:28 -0500
Subject: [rabbitmq-discuss] SocketException when invoking
	model.BasicPublish
In-Reply-To: <etPan.53a253b3.21f57e54.9b32@mercurio.local>
References: <7def7674-34f3-404b-9ac4-ef8ef8677703@googlegroups.com>
 <865c7ac8-1b72-4bf2-8696-01818d37c4d6@googlegroups.com>
 <etPan.53a24557.41b71efb.f14@mercurio.local>
 <CAJGQrQC6ckw1r73H+Xv7GDDFZ0n5Rt21DwkAEvZTCeXEEuKa_Q@mail.gmail.com>
 <etPan.53a253b3.21f57e54.9b32@mercurio.local>
Message-ID: <CAJGQrQDOMbs2HkUk=MS8O6a-sVhhFJP9AfYBvdQpHjaw+syfBg@mail.gmail.com>

Hi Michael, had to decompile RabbitMQ.Client assembly and step through to
find the issue.  Apparently, my code doesn't always pass a non-null
messageId.  Setting a null messageId on the basicproperties is allowed but
the writing of a null messageId on the wire will cause an error inside
of RabbitMQ.Client.  So moral of the story is don't ever set a
basicproperties property unless it's non null (at least as of
RabbitMQ.Client 3.3.0).

I put connection and channel logic back in the same method and it works
great.   Here is new working version.

private void PublishMessage(byte[] message, Type messageType, string
contentType, string messageId)
        {
            if (message == null || message.Length == 0)
            {
                throw new ArgumentNullException("message");
            }
            if (messageType == null)
            {
                throw new ArgumentNullException("messageType");
            }
            if (String.IsNullOrEmpty(contentType))
            {
                throw new ArgumentNullException("contentType");
            }
 //            if (String.IsNullOrEmpty(messageId))
//            {
//                throw new ArgumentNullException("messageId");
//            }
            var factory = new ConnectionFactory() {VirtualHost =
this.VirtualHost, HostName = this.Host, UserName = this.User, Password =
this.Password };
            using (var connection = factory.CreateConnection())
            using (var channel = connection.CreateModel())
            {
                IBasicProperties props = channel.CreateBasicProperties();
                props.SetPersistent(this.PersistMessages);

                //Mime time
                props.ContentType = contentType;
                props.Type = messageType.FullName;
                if (!String.IsNullOrEmpty(messageId))
                {
                    //Must be careful not to set IBasicProperties with
possible null value as this will cause serialization errors downstream
(RabbitMQ.Client 3.3.0)
                    props.MessageId = messageId;
                }
                //Note, may get AlreadyClosedException here if publishing
to a incorrect exchange name
                channel.BasicPublish(this.ExchangeName, this.RoutingKey,
props, message);
            }
        }

thanks for the help.

scott


On Wed, Jun 18, 2014 at 10:05 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 19 June 2014 at 07:02:17, Scott McFadden (
> scott.kendall.mcfadden at gmail.com) wrote:
> > > It makes me think I screwed up the server side configuration
> > when reinstalling.
>
> There is no configuration that can affect framing/frame interleaving in
> the client.
> This is also the kind of issues that we'd see reported constantly if it
> was a client
> issue. Finally, it happens on a brand new connection.
>
> I'd recommend doing two things:
>
>  * Running a tracer proxy in front of RabbitMQ [1] to see what's being
> sent on the wire
>  * Open a connection on app start if you can instead of opening a new one
> per channel
>
> If the latter does not change anything, please post the output of the
> tracer.
>
> 1. http://www.rabbitmq.com/java-tools.html, see Tracer
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/88e2af97/attachment.html>

From ben.hsu at criticalmedia.com  Fri Jun 20 16:55:05 2014
From: ben.hsu at criticalmedia.com (Ben Hsu)
Date: Fri, 20 Jun 2014 11:55:05 -0400
Subject: [rabbitmq-discuss] can't restart rabbit cluster after power outage
Message-ID: <etPan.53a45959.74b0dc51.7a2@Administrators-MacBook-Pro-5.local>

Hello, our rabbitmq cluster suffered a power outage, and we?re having trouble bringing it back up.

our cluster has 2 disk backed nodes (node1 and node2) and 1 ram backed node (node3). I first tried to restart the disk backed nodes, and they both gave me an error, saying??timeout_waiting_for_tables? on the other two nodes. Googled around, and it sounded like the ram node was the last one to go out.?

So I tried restarting the ram backed node, and it started fine. But when I tried to start the disk backed node, it gave me a different error, basically saying??inconsistent_cluster, thinks its clustered with node3, but node3 disagrees?.

What I would love to do is take one of the disk nodes, start it as the master, and tell the other nodes to join its cluster. Is that possible? Right now I cannot even run ?rabbitmqctl cluster_status? because the node won?t start

meta question: is having a mix of disk and RAM based nodes in the same cluster a Bad Idea that needs to be fixed?

--?
Ben Hsu
Sent with Airmail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/3cb75845/attachment.html>

From simon at rabbitmq.com  Fri Jun 20 17:45:05 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jun 2014 17:45:05 +0100
Subject: [rabbitmq-discuss] can't restart rabbit cluster after power
	outage
In-Reply-To: <etPan.53a45959.74b0dc51.7a2@Administrators-MacBook-Pro-5.local>
References: <etPan.53a45959.74b0dc51.7a2@Administrators-MacBook-Pro-5.local>
Message-ID: <53A46511.70403@rabbitmq.com>

On 20/06/14 16:55, Ben Hsu wrote:
> Hello, our rabbitmq cluster suffered a power outage, and we?re having
> trouble bringing it back up.
>
> our cluster has 2 disk backed nodes (node1 and node2) and 1 ram backed
> node (node3). I first tried to restart the disk backed nodes, and they
> both gave me an error, saying ?timeout_waiting_for_tables? on the other
> two nodes. Googled around, and it sounded like the ram node was the last
> one to go out.

Nodes attempt to remember if they were the last to shut down, and try to 
enforce the idea that the last to shut down should be the first back up. 
However, RAM nodes don't count for that, only disc.

If the whole thing suffered a power outage, it's possible that no node 
saw any other node die before it died itself, and so each disc node 
wants to wait for the other.

> So I tried restarting the ram backed node, and it started fine. But when
> I tried to start the disk backed node, it gave me a different error,
> basically saying ?inconsistent_cluster, thinks its clustered with node3,
> but node3 disagrees?.

The ram node should have refused to start alone. We had a bug where it 
would start in older versions and then get confused - which RabbitMQ 
version are you running?

> What I would love to do is take one of the disk nodes, start it as the
> master, and tell the other nodes to join its cluster. Is that possible?
> Right now I cannot even run ?rabbitmqctl cluster_status? because the
> node won?t start

What you want is "rabbitmqctl forget_cluster_node --offline". This will:

1) Allow you to tell node1 or node2 that node3 has left the cluster 
(you'll need to re-add it later).

2) Reset node1 or node2's idea of which nodes were the last to shut 
down, allowing the cluster to start again.

"rabbitmqctl forget_cluster_node --offline" is currently a bit of a pain 
to use, since you have to start an Erlang node without booting RabbitMQ.

You can do this by adding "NODE_ONLY=true" to 
/etc/rabbitmq/rabbitmq-env.conf on node1 or node2. Attempting to start 
RabbitMQ in whatever's the normal way for you will get an Erlang node 
started without RabbitMQ (i.e. as if you'd successfully booted the 
server then invoked "rabbitmqctl stop_app").

You can now invoke "rabbitmqctl forget_cluster_node --offline node3"

Once you've done that, you can stop your node, remove NODE_ONLY=true and 
it should start correctly. The other disc node should then be able to 
start up and join the cluster without further fiddling.

> meta question: is having a mix of disk and RAM based nodes in the same
> cluster a Bad Idea that needs to be fixed?

It didn't cause this problem. But overall RAM nodes are quite a special 
thing, they exist to speed up queue / exchange / binding declarations in 
large clusters. Most clusters don't need them.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 20 18:06:33 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jun 2014 18:06:33 +0100
Subject: [rabbitmq-discuss] PPA debs restart rabbit
In-Reply-To: <CAHiEoM5aurp4QxuDQ-+XbJ8W8HgMCDprNqQCzH8Cu_sv+3-SkA@mail.gmail.com>
References: <CAHiEoM5aurp4QxuDQ-+XbJ8W8HgMCDprNqQCzH8Cu_sv+3-SkA@mail.gmail.com>
Message-ID: <53A46A19.4090108@rabbitmq.com>

On 17/06/14 15:54, Aaron Westendorf wrote:
> We're using the PPA for rabbit but the current debian files are not
> suitable for production deployments because they stop and restart the
> process. I understand the desire to start the process if it was not
> already running, but embedding the restart logic in the deb means that
> users have no control over the process. As it is very common to use the
> PPA within the context of a configuration management system (Salt, Chef,
> etc), it would be best to leave that decision up to the user.

What do you mean by "restart logic"?

I could see the point in adding some START_THE_SERVER variable to 
/etc/default/rabbitmq-server, would that help?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From james.gardner at noaa.gov  Fri Jun 20 18:08:53 2014
From: james.gardner at noaa.gov (James Gardner)
Date: Fri, 20 Jun 2014 12:08:53 -0500
Subject: [rabbitmq-discuss] Connection and channel age
In-Reply-To: <etPan.53a34bf0.1f16e9e8.172@mercurio.local>
References: <53A349F3.6010102@noaa.gov>
 <etPan.53a34bf0.1f16e9e8.172@mercurio.local>
Message-ID: <53A46AA5.8000908@noaa.gov>


Thanks!


On 06/19/2014 03:45 PM, Michael Klishin wrote:
>   On 20 June 2014 at 00:38:13, James Gardner (james.gardner at noaa.gov) wrote:
>>> Is there any way to find the age/time of a connection or channel
>> using
>> the web management interface?
>> It would be useful information for us; how long a client has stayed
>> connected, or when they did. And if there are multiple connections
>> from
>> the same app piling up for some reason, it would be useful to see
>> how
>> those connections were made over time, as well as be able to kick
>> the
>> oldest connections instead of the more recent ones.
>> If there isn't a way, please consider this a feature request :)
> The only way to do this right now is to correlate connection names
> (e.g. "127.0.0.1:62051 -> 127.0.0.1:5672") with log entries like
>
> =INFO REPORT==== 20-Jun-2014::10:43:21 ===
> accepting AMQP connection <0.613.0> (127.0.0.1:62051 -> 127.0.0.1:5672)
>
> This feature makes sense, we will consider it!
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ


From isskjj at gmail.com  Fri Jun 20 18:15:32 2014
From: isskjj at gmail.com (Karl Jackson)
Date: Fri, 20 Jun 2014 11:15:32 -0600
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <etPan.53a34b7a.216231b.172@mercurio.local>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>
 <etPan.53a345a0.79e2a9e3.172@mercurio.local>
 <CAKmc4PbUZEqQKeQteF5uKFiKApT9E8_ghp69fEG7AhiqQB6wxQ@mail.gmail.com>
 <etPan.53a3484e.12200854.172@mercurio.local>
 <CAKmc4PaKk16+mdKzi=LsO081c9nBC6UKQ3EbT7SAGqPa7Oat4A@mail.gmail.com>
 <etPan.53a34b7a.216231b.172@mercurio.local>
Message-ID: <CAKmc4PZRn7DaKvcLzsaB3bzd4Vf-zDxtRsSxTgrcPunPKFKGXw@mail.gmail.com>

After upgrading to erlang R17 I am still getting the same error. This is
the process I followed.

I tired to upgrade to R17, but I was getting the following file conflict
errors:

Transaction Check Error:

  file /usr/bin/epmd from install of esl-erlang-17.0-1.x86_64 conflicts
with file from package erlang-erts-R14B-04.3.el6.x86_64

  file /usr/bin/erl from install of esl-erlang-17.0-1.x86_64 conflicts with
file from package erlang-erts-R14B-04.3.el6.x86_64

  file /usr/bin/erlc from install of esl-erlang-17.0-1.x86_64 conflicts
with file from package erlang-erts-R14B-04.3.el6.x86_64

  file /usr/bin/escript from install of esl-erlang-17.0-1.x86_64 conflicts
with file from package erlang-erts-R14B-04.3.el6.x86_64

  file /usr/bin/run_erl from install of esl-erlang-17.0-1.x86_64 conflicts
with file from package erlang-erts-R14B-04.3.el6.x86_64

  file /usr/bin/run_test from install of esl-erlang-17.0-1.x86_64 conflicts
with file from package erlang-erts-R14B-04.3.el6.x86_64

  file /usr/bin/to_erl from install of esl-erlang-17.0-1.x86_64 conflicts
with file from package erlang-erts-R14B-04.3.el6.x86_64

  file /usr/bin/dialyzer from install of esl-erlang-17.0-1.x86_64 conflicts
with file from package erlang-dialyzer-R14B-04.3.el6.x86_64

  file /usr/bin/typer from install of esl-erlang-17.0-1.x86_64 conflicts
with file from package erlang-typer-R14B-04.3.el6.x86_64


I installed R17 using the --replacefiles option of rpm.

rpm -i --replacefiles esl-erlang_17.0-1~centos~6_amd64.rpm

Erlang OTP 17.0 installed


I then verified I was using the new version or erlang

-bash-4.1$ erl

Erlang/OTP 17 [erts-6.0] [source-07b8f44] [64-bit] [smp:2:2]
[async-threads:10] [hipe] [kernel-poll:false]


Eshell V6.0  (abort with ^G)

1>

When I tried to start rabbitmq, I got the same error.

su - rabbitmq

Last password change : Aug 22, 2013

Password expires : never

Password inactive : never

Account expires : never

Minimum number of days between password change : -1

Maximum number of days between password change : -1

Number of days of warning before password expires : -1

-bash-4.1$ rabbitmq-server start

{"init terminating in do_boot",badarg}


Crash dump was written to: erl_crash.dump

init terminating in do_boot (badarg)


Thank you,

Karl Jackson



On Thu, Jun 19, 2014 at 2:43 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> + rabbitmq-discuss
>
> On 20 June 2014 at 00:39:14, Karl Jackson (isskjj at gmail.com) wrote:
> > > I added set the environment variable in
> /etc/rabbitmq/rabbitmq-env.conf.
> > The file now looks like
> >
> > #example rabbitmq-env.con file entries
> > #set the port address
> > NODE_PORT=55672
> > RABBITMQ_SERVER_ERL_ARGS="+K true +A30 +P 1048576(tel://1048576)
> > -kernel inet_default_connect_options [{nodelay,true}]"
> >
> >
> > I then tried starting rabbitmq-server, but I got the same error.
>
> Some research suggests it may be a version-specific problem
> where VM needs to report an issue early on start:
>
> http://erlang.org/pipermail/erlang-questions/2010-July/052540.html
>
> Please try with R17 or R16B03. Sorry.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/111a917a/attachment.html>

From ben.hsu at criticalmedia.com  Fri Jun 20 19:00:53 2014
From: ben.hsu at criticalmedia.com (Ben Hsu)
Date: Fri, 20 Jun 2014 14:00:53 -0400
Subject: [rabbitmq-discuss] can't restart rabbit cluster after power
	outage
In-Reply-To: <53A46511.70403@rabbitmq.com>
References: <etPan.53a45959.74b0dc51.7a2@Administrators-MacBook-Pro-5.local>
 <53A46511.70403@rabbitmq.com>
Message-ID: <CA+vhsuvSVDXkPpG8puQV-6dAG+sjr7T_qU2E+HMNE52yxVELDA@mail.gmail.com>

Hello Simon,


On Fri, Jun 20, 2014 at 12:45 PM, Simon MacMullen <simon at rabbitmq.com>
wrote:

> On 20/06/14 16:55, Ben Hsu wrote:
>
>>
>>  So I tried restarting the ram backed node, and it started fine. But when
>> I tried to start the disk backed node, it gave me a different error,
>> basically saying ?inconsistent_cluster, thinks its clustered with node3,
>> but node3 disagrees?.
>>
>
> The ram node should have refused to start alone. We had a bug where it
> would start in older versions and then get confused - which RabbitMQ
> version are you running?
>
>
That's interesting. It looks like an older version of rabbitmq

      {rabbit,"RabbitMQ","3.0.0"},


>  What I would love to do is take one of the disk nodes, start it as the
>> master, and tell the other nodes to join its cluster. Is that possible?
>> Right now I cannot even run ?rabbitmqctl cluster_status? because the
>> node won?t start
>>
>
> What you want is "rabbitmqctl forget_cluster_node --offline". This will:
>
> 1) Allow you to tell node1 or node2 that node3 has left the cluster
> (you'll need to re-add it later).
>
> 2) Reset node1 or node2's idea of which nodes were the last to shut down,
> allowing the cluster to start again.
>
> "rabbitmqctl forget_cluster_node --offline" is currently a bit of a pain
> to use, since you have to start an Erlang node without booting RabbitMQ.
>
> You can do this by adding "NODE_ONLY=true" to /etc/rabbitmq/rabbitmq-env.conf
> on node1 or node2. Attempting to start RabbitMQ in whatever's the normal
> way for you will get an Erlang node started without RabbitMQ (i.e. as if
> you'd successfully booted the server then invoked "rabbitmqctl stop_app").
>
> You can now invoke "rabbitmqctl forget_cluster_node --offline node3"
>
> Once you've done that, you can stop your node, remove NODE_ONLY=true and
> it should start correctly. The other disc node should then be able to start
> up and join the cluster without further fiddling.
>
>
Now thats interesting! Having an erlang node up without having to start up
rabbit sounds very useful. I tried doing forgetting the cluster node and
got this:

sudo rabbitmqctl forget_cluster_node --offline rabbit at node3

Error: not_last_node_to_go_down: The node you are trying to remove from was
not the last to go down (excluding the node you are removing). Please use
the the last node to go down to remove nodes when the cluster is offline.

I got the same error when I tried the same command with each of the other
nodes. So it looks like rabbit has no idea which node was the last to die.
Is it possible to ask rabbit for this information, possibly by groveling
around mnesia with "rabbitmqctl eval"?

I'm also okay with a drastic solution like "blow away the mnesia database
and recover the data in some other way". Part of the reason I'm asking all
these questions is because I want to learn more about rabbitmq
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/60a4523f/attachment.html>

From brandon.munroe at gmail.com  Fri Jun 20 21:16:28 2014
From: brandon.munroe at gmail.com (Brandon Munroe)
Date: Fri, 20 Jun 2014 14:16:28 -0600
Subject: [rabbitmq-discuss] Cannot Log In to Management UI After Importing
	Broker Definitions
Message-ID: <CACsJ2H5TEtOxssenjyqJz_Lc0bpy1jbyztoLjpnCHLQ4FJgQ+Q@mail.gmail.com>

I've been having some trouble with logging in to the management UI after
importing broker definitions.  After importing the definitions, I'm taken
back to the login page (good), but when I enter the new, imported
credentials, I'm getting a "Login Failed" message.  I've verified the
credentials by hitting the HTTP API directly with the same credentials, and
am getting back good responses.  When I check the logs, I see periodic
messages reading:

webmachine error: path="/api/exchanges"
"Unauthorized"

Plus, when I attempt to log in, I get the following:

webmachine error: path="/api/whoami"
"Unauthorized"

Does anyone have any ideas on how to fix this?

I'm using RabbitMQ 3.2.4 on CentOS 6.5, with Erlang R16B03-0.2

Thanks!

-Brandon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/fad08020/attachment.html>

From gavinmroy at gmail.com  Fri Jun 20 23:38:59 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Fri, 20 Jun 2014 18:38:59 -0400
Subject: [rabbitmq-discuss] PPA debs restart rabbit
In-Reply-To: <53A46A19.4090108@rabbitmq.com>
References: <CAHiEoM5aurp4QxuDQ-+XbJ8W8HgMCDprNqQCzH8Cu_sv+3-SkA@mail.gmail.com>
 <53A46A19.4090108@rabbitmq.com>
Message-ID: <etPan.53a4b803.643c9869.7a81@gmr-home.local>

I believe he?s saying that when you install the deb (or upgrade it) it automatically starts or restarts rabbitmq-server, causing less than desirable behavior.

From:?Simon MacMullen simon at rabbitmq.com
Reply:?Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
Date:?June 20, 2014 at 1:07:33 PM
To:?Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com, Aaron Westendorf aaron at agoragames.com
Subject:? Re: [rabbitmq-discuss] PPA debs restart rabbit  

On 17/06/14 15:54, Aaron Westendorf wrote:  
> We're using the PPA for rabbit but the current debian files are not  
> suitable for production deployments because they stop and restart the  
> process. I understand the desire to start the process if it was not  
> already running, but embedding the restart logic in the deb means that  
> users have no control over the process. As it is very common to use the  
> PPA within the context of a configuration management system (Salt, Chef,  
> etc), it would be best to leave that decision up to the user.  

What do you mean by "restart logic"?  

I could see the point in adding some START_THE_SERVER variable to  
/etc/default/rabbitmq-server, would that help?  

Cheers, Simon  

--  
Simon MacMullen  
RabbitMQ, Pivotal  
_______________________________________________  
rabbitmq-discuss mailing list  
rabbitmq-discuss at lists.rabbitmq.com  
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/bdeef1bc/attachment.html>

From matthias at rabbitmq.com  Fri Jun 20 23:53:53 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Jun 2014 23:53:53 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53A44907.5090908@alertme.com>
References: <53A4436E.4090407@alertme.com> <53A444F3.10608@rabbitmq.com>
 <53A44907.5090908@alertme.com>
Message-ID: <53A4BB81.5050509@rabbitmq.com>

On 20/06/14 15:45, Dmitry Andrianov wrote:
> So we do not trust AMQP headers we receive from the client but we do
> trust the SSL certificate and we do trust AQMP headers after the message
> came through the first Rabbit and was verified.

Would https://www.rabbitmq.com/validated-user-id.html help, perhaps?

Matthias.


From scott.kendall.mcfadden at gmail.com  Sat Jun 21 00:02:10 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Fri, 20 Jun 2014 16:02:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq.client 3.3.0 oddity (.NET)
Message-ID: <9da80042-07f4-4be5-8747-82fa78a5e845@googlegroups.com>

Whe using IModel.BasicPublish to an invalid exchange you get the following 
wonky error message:

The AMQP operation was interrupted: AMQP close-reason, initiated by 
Application, code =200, text="Goodbye", class=0, methodId=0

Took me a while but finally realized, I was attemping to publish to an 
exchange that didn't exist (typo in exchange name).  Fixed the exchange 
name and it works great now.

Any way we could get a more helpful error message?



scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140620/04b5d2cd/attachment.html>

From prasadbchaure at gmail.com  Sat Jun 21 20:06:12 2014
From: prasadbchaure at gmail.com (prasadbchaure at gmail.com)
Date: Sat, 21 Jun 2014 14:06:12 -0500
Subject: [rabbitmq-discuss] prasadbchaure@gmail.com has indicated you're a
	friend. Accept?
Message-ID: <0.0.6C.C38.1CF8D8383C3584C.2828@mail8.info-emailer.com>

Hi,

prasadbchaure at gmail.com wants to follow you.

****** Is prasadbchaure at gmail.com you friend? ******
If Yes please follow the link below:
http://invites.info-emailer.com/signup_e.html?fullname=Prasadbchaure&amp;email=rabbitmq-discuss at lists.rabbitmq.com&amp;invitername=prasadbchaure at gmail.com&amp;inviterid=29269621&amp;userid=0&amp;token=0&amp;emailmasterid=4f790d59-16d8-4857-a83c-67606a360d6f&amp;from=prasadbchaure at gmail.com&src=txt_yes

If No please follow the link below:
http://invites.info-emailer.com/signup_e.html?fullname=Prasadbchaure&amp;email=rabbitmq-discuss at lists.rabbitmq.com&amp;invitername=prasadbchaure at gmail.com&amp;inviterid=29269621&amp;userid=0&amp;token=0&amp;emailmasterid=4f790d59-16d8-4857-a83c-67606a360d6f&amp;from=prasadbchaure at gmail.com&src=txt_no


Follow the link below to remove yourself from all such emails
http://invites.info-emailer.com/uns_inviter.jsp?email=rabbitmq-discuss at lists.rabbitmq.com&amp;iid=4f790d59-16d8-4857-a83c-67606a360d6f&amp;from=prasadbchaure at gmail.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140621/7920f164/attachment.html>

From mklishin at gopivotal.com  Sun Jun 22 02:48:32 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 22 Jun 2014 05:48:32 +0400
Subject: [rabbitmq-discuss] [ruby-amqp] Re: ANN DO NOT use amqp gem
	unless you already use EventMachine
In-Reply-To: <d451bd9a-1174-4699-acb1-7f6151b19e66@googlegroups.com>
References: <etPan.5348f507.19495cff.92ed@mercurio.local>
 <d451bd9a-1174-4699-acb1-7f6151b19e66@googlegroups.com>
Message-ID: <ACBC8AFC-B134-4263-A35C-2611F569CF62@gopivotal.com>

I can't think of anything.

MK

> On 22/06/2014, at 00:29, Brian Marick <brian at getset.com> wrote:
> 
> If you *do* use EventMachine, but only because you're running on top of Thin, is there reason not to switch from the AMQP gem to Bunny?
> 
>> On Saturday, April 12, 2014 3:10:17 AM UTC-5, mklishin wrote:
>> I?ve been meaning to suggest this in amqp gem README for a long time 
>> and finally it?s time to do so: if you don?t use EventMachine, avoid 
>> amqp gem. There is no reason to use it over Bunny or March Hare.
> 
> -- 
> Bunny: http://rubybunny.info
> March Hare: http://rubymarchhare.info
> amqp gem: http://rubyamqp.info
>  
> IRC: #rabbitmq on irc.freenode.net
>  
> Post to the group: ruby-amqp at googlegroups.com | unsubscribe: ruby-amqp+unsubscribe at googlegroups.com
> --- 
> You received this message because you are subscribed to the Google Groups "Ruby RabbitMQ libraries" group.
> To unsubscribe from this group and stop receiving emails from it, send an email to ruby-amqp+unsubscribe at googlegroups.com.
> For more options, visit https://groups.google.com/d/optout.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140622/b712287c/attachment.html>

From brian at getset.com  Sat Jun 21 21:29:57 2014
From: brian at getset.com (Brian Marick)
Date: Sat, 21 Jun 2014 13:29:57 -0700 (PDT)
Subject: [rabbitmq-discuss] ANN DO NOT use amqp gem unless you already
	use EventMachine
In-Reply-To: <etPan.5348f507.19495cff.92ed@mercurio.local>
References: <etPan.5348f507.19495cff.92ed@mercurio.local>
Message-ID: <d451bd9a-1174-4699-acb1-7f6151b19e66@googlegroups.com>

If you *do* use EventMachine, but only because you're running on top of 
Thin, is there reason not to switch from the AMQP gem to Bunny?

On Saturday, April 12, 2014 3:10:17 AM UTC-5, mklishin wrote:
>
> I?ve been meaning to suggest this in amqp gem README for a long time 
> and finally it?s time to do so: if you don?t use EventMachine, avoid 
> amqp gem. There is no reason to use it over Bunny or March Hare. 
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140621/40447386/attachment.html>

From seanmjoyce at gmail.com  Sun Jun 22 01:16:28 2014
From: seanmjoyce at gmail.com (Sean Joyce)
Date: Sat, 21 Jun 2014 20:16:28 -0400
Subject: [rabbitmq-discuss] Routing via user id
Message-ID: <CAO7e3YEapmHudDYophBkrWR2sUNJYnm4Kun1XSNpgLiEk0oaTw@mail.gmail.com>

I have a scenario where one producer publishes a stream of messages to an
exchange. The exchange has 10 queues (there is an upper limit to the amount
of parallel work that can be done - e.g. Database bottleneck) that it
routes messages to. The messages can really go to any queue with one
exception: only one message with a given user id can be processed at a
time.

All messages with that user id should be routed to the same queue. If there
was no database bottleneck I would create a new queue for each user id but
I can really only process ten messages at a time.

I had thought of partitioning the user ids across ten queues but there is
no guarantee the incoming messages would be evenly distributed even with
different user ids. Thus I could have queues 1,4 and 8 with a backlog while
the rest are idle resources.

Any tips on a defined pattern that solves this type of problem so that any
message for a given user id can go to any queue but messages with the same
user id always go to the same queue?

-Sean
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140621/3e16206c/attachment.html>

From kenneth.loafman at gmail.com  Sun Jun 22 18:18:54 2014
From: kenneth.loafman at gmail.com (Kenneth Loafman)
Date: Sun, 22 Jun 2014 10:18:54 -0700 (PDT)
Subject: [rabbitmq-discuss] New clustering format confusion
Message-ID: <21b3dc29-9f10-49ac-a954-b0b5ed1f7176@googlegroups.com>

Hi,

I'm trying to set up rabbitmq.config to automatically cluster, however, an 
error message shows up and startup fails.

>From the node forge-d1, I'm getting:

Converting legacy 'cluster_nodes' configuration
    [['rabbit at forge-m1','rabbit at forge-d2'],disc]
to
    {[['rabbit at forge-m1','rabbit at forge-d2'],disc],ram}.

Please update the configuration to the new format {Nodes, NodeType}, where 
Nodes contains the nodes that the node will try to cluster with, and 
NodeType is either 'disc' or 'ram'

As far as I can tell from the verbiage above, my config was in the correct 
format.  It has Nodes == ['rabbit at forge-m1','rabbit at forge-d2'] and NodeType 
== disc, which is correct.  forge-d1 is supposed to cluster with forge-m1 
and forge-d2, the other two nodes in the cluster.  What's with the ",ram" 
at the end?  forge-d1 is specified as a disc node in NodeType.  I'm getting 
similar issues on the other configs:

forge-m1:
            {cluster_nodes, {
                [
                'rabbit at forge-d1','rabbit at forge-d2'
                ],
                ram
            }}

forge-d1:
            {cluster_nodes, {
                [
                'rabbit at forge-m1','rabbit at forge-d2'
                ],
                disc
            }}
       ]}

forge-d2:
          {cluster_nodes, {
                [
                'rabbit at forge-m1','rabbit at forge-d1'
                ],
                disc
            }}
       ]}

So, what's the error with the new format?  How should I correct this?

...Thanks,
...Ken

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140622/2fbd89cd/attachment.html>

From alexander.clifton at gmail.com  Mon Jun 23 01:42:32 2014
From: alexander.clifton at gmail.com (Alex Clifton)
Date: Sun, 22 Jun 2014 17:42:32 -0700 (PDT)
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
Message-ID: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>

I installed rabbitmg on os x 10.9.3 using brew.

No matter what rabbitmq command I use i get nothing returned and no output.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140622/0c7f82eb/attachment.html>

From mklishin at gopivotal.com  Mon Jun 23 07:39:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 23 Jun 2014 10:39:22 +0400
Subject: [rabbitmq-discuss] Routing via user id
In-Reply-To: <CAO7e3YEapmHudDYophBkrWR2sUNJYnm4Kun1XSNpgLiEk0oaTw@mail.gmail.com>
References: <CAO7e3YEapmHudDYophBkrWR2sUNJYnm4Kun1XSNpgLiEk0oaTw@mail.gmail.com>
Message-ID: <etPan.53a7cbb8.6b8b4567.13612@mercurio.local>

On 23 June 2014 at 10:23:47, Sean Joyce (seanmjoyce at gmail.com) wrote:
> > I have a scenario where one producer publishes a stream of messages  
> to an exchange. The exchange has 10 queues (there is an upper limit  
> to the amount of parallel work that can be done - e.g. Database  
> bottleneck) that it routes messages to. The messages can really  
> go to any queue with one exception: only one message with a given  
> user id can be processed at a time.
>  
> All messages with that user id should be routed to the same queue.  
> If there was no database bottleneck I would create a new queue  
> for each user id but I can really only process ten messages at a  
> time.
> I had thought of partitioning the user ids across ten queues but?
> there is no guarantee the incoming messages would be evenly distributed  
> even with different user ids. Thus I could have queues 1,4 and  
> 8 with a backlog while the rest are idle resources.

Consistent hash exchange [1] and one queue per user (named accordingly) sounds
like a pretty close solution.?

As for the 1 message at a time requirement, while you can use RabbitMQ to imitate
a distributed lock of a kind [2], I'd recommend using ZooKeeper, etcd, or Redis
for this.

1.?http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v3_3_3/README.md
2.?https://www.rabbitmq.com/blog/2014/02/19/distributed-semaphores-with-rabbitmq/
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun 23 07:46:48 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 23 Jun 2014 10:46:48 +0400
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
In-Reply-To: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
References: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
Message-ID: <etPan.53a7cd74.643c9869.13612@mercurio.local>

?On 23 June 2014 at 10:27:49, Alex Clifton (alexander.clifton at gmail.com) wrote:
> > I installed rabbitmg on os x 10.9.3 using brew.
>  
> No matter what rabbitmq command I use i get nothing returned and  
> no output.

What commands specifically have you tried? Anything in

?*?/usr/local/var/log/rabbitmq/rabbit at localhost.log
?*?/usr/local/var/log/rabbitmq/rabbit at localhost-sasl.log

Does RabbitMQ server start when you run it in foreground with
/usr/local/Cellar/rabbitmq/3.3.2/sbin/rabbitmq-server?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From paszczak000 at gmail.com  Mon Jun 23 08:18:02 2014
From: paszczak000 at gmail.com (=?UTF-8?Q?Kamil_Porembi=C5=84ski?=)
Date: Mon, 23 Jun 2014 00:18:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.3 not starting on CentOS 6.5
Message-ID: <e5bfda36-30bf-4517-a437-1c1ff3b1bf6e@googlegroups.com>

Hello,

right now I have RabbitMQ 3.3.2 on CentOS 6.5 (2.6.32-431.17.1.el6.x86_64). 
Eralang: esl-erlang-17.0-1.x86_64. It is working fine on current settings.

After upgrading to 3.3.3 it is not working. I don't have any info in logs. 
Only:

[07:16:30] [root at rabbit-cluster1 ~]# /etc/init.d/rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_\{log, 
_err\}
rabbitmq-server.
[07:16:33] [root at rabbit-cluster1 ~]# cat /var/log/rabbitmq/*
[07:16:36] [root at rabbit-cluster1 ~]#                       [FAILED]

I have checked clean installation and have the same results on CentOS and 
Red Hat.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/aa47a9b6/attachment.html>

From simon at rabbitmq.com  Mon Jun 23 09:10:25 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jun 2014 09:10:25 +0100
Subject: [rabbitmq-discuss] can't restart rabbit cluster after power
	outage
In-Reply-To: <CA+vhsuvSVDXkPpG8puQV-6dAG+sjr7T_qU2E+HMNE52yxVELDA@mail.gmail.com>
References: <etPan.53a45959.74b0dc51.7a2@Administrators-MacBook-Pro-5.local>
 <53A46511.70403@rabbitmq.com>
 <CA+vhsuvSVDXkPpG8puQV-6dAG+sjr7T_qU2E+HMNE52yxVELDA@mail.gmail.com>
Message-ID: <53A7E0F1.5030800@rabbitmq.com>

On 20/06/2014 19:00, Ben Hsu wrote:
> That's interesting. It looks like an older version of rabbitmq
>        {rabbit,"RabbitMQ","3.0.0"},

> Now thats interesting! Having an erlang node up without having to start
> up rabbit sounds very useful. I tried doing forgetting the cluster node
> and got this:
>
> sudo rabbitmqctl forget_cluster_node --offline rabbit at node3
>
> Error: not_last_node_to_go_down: The node you are trying to remove from
> was not the last to go down (excluding the node you are removing).
> Please use the the last node to go down to remove nodes when the cluster
> is offline.

Ah. Yes, that used to be a constraint for forget_cluster_node; it was 
removed in 3.1.4.

> I got the same error when I tried the same command with each of the
> other nodes. So it looks like rabbit has no idea which node was the last
> to die. Is it possible to ask rabbit for this information, possibly by
> groveling around mnesia with "rabbitmqctl eval"?

I think on 3.0.0 you might be able to get away with:

1) Start with NODE_ONLY
2) rabbitmqctl eval 'application:start(mnesia).'
3) rabbitmqctl eval 'rabbit_table:force_load().'
4) rabbitmqctl eval 'rabbit_table:wait_for_replicated().'
5) rabbitmqctl eval 'application:stop(mnesia).'

Then stop, remove NODE_ONLY and start again. That won't have removed 
node3 from the cluster so you'll need to do that with 
forget_cluster_node separately afterwards - but you can do that online 
once node1 and node2 are running.

> I'm also okay with a drastic solution like "blow away the mnesia
> database and recover the data in some other way". Part of the reason I'm
> asking all these questions is because I want to learn more about rabbitmq

There's no real way to recover from deleting the database other than to 
start from scratch.

Cheers, Simon

From simon at rabbitmq.com  Mon Jun 23 09:13:34 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jun 2014 09:13:34 +0100
Subject: [rabbitmq-discuss] New clustering format confusion
In-Reply-To: <21b3dc29-9f10-49ac-a954-b0b5ed1f7176@googlegroups.com>
References: <21b3dc29-9f10-49ac-a954-b0b5ed1f7176@googlegroups.com>
Message-ID: <53A7E1AE.2040404@rabbitmq.com>

On 22/06/2014 18:18, Kenneth Loafman wrote:
> Hi,
>
> I'm trying to set up rabbitmq.config to automatically cluster, however,
> an error message shows up and startup fails.
>
>  From the node forge-d1, I'm getting:
>
> Converting legacy 'cluster_nodes' configuration
>      [['rabbit at forge-m1','rabbit at forge-d2'],disc]
> to
>      {[['rabbit at forge-m1','rabbit at forge-d2'],disc],ram}.
>
> Please update the configuration to the new format {Nodes, NodeType},
> where Nodes contains the nodes that the node will try to cluster with,
> and NodeType is either 'disc' or 'ram'
>
> As far as I can tell from the verbiage above, my config was in the
> correct format.

It should be

{['rabbit at forge-m1','rabbit at forge-d2'],disc}

not

[['rabbit at forge-m1','rabbit at forge-d2'],disc]

But I think the automatic config format conversion thing is causing more 
problems than it solves right now, we should probably take it out.

Cheers, Simon


From dmitry.andrianov at alertme.com  Mon Jun 23 09:37:29 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Mon, 23 Jun 2014 09:37:29 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53A4BB81.5050509@rabbitmq.com>
References: <53A4436E.4090407@alertme.com> <53A444F3.10608@rabbitmq.com>
 <53A44907.5090908@alertme.com> <53A4BB81.5050509@rabbitmq.com>
Message-ID: <53A7E749.6060009@alertme.com>

Matthias,
we actually using that thing already - client sets the user ID property 
and server rejects a message if it does not match the actual auth user.
However, I did read it as that setUserId call being optional - it is up 
to the client to set it. And if client does not set it, no validation is 
performed.
So how do I prevent messages without an user id from being accepted?
If I need a custom exchange type or exchange decorator - it does not 
really makes life much easier.

Also, as I said, there was an idea to automatically add a header with 
client's IP address to each incoming message.
However after playing with custom exchange, I can see that its route 
call is not the place for it anyway, so we are back to square one with 
this specific idea.

Thanks


On 20/06/14 23:53, Matthias Radestock wrote:
> On 20/06/14 15:45, Dmitry Andrianov wrote:
>> So we do not trust AMQP headers we receive from the client but we do
>> trust the SSL certificate and we do trust AQMP headers after the message
>> came through the first Rabbit and was verified.
>
> Would https://www.rabbitmq.com/validated-user-id.html help, perhaps?
>
> Matthias.
>

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From simon at rabbitmq.com  Mon Jun 23 11:19:53 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jun 2014 11:19:53 +0100
Subject: [rabbitmq-discuss] Cannot Log In to Management UI After
 Importing Broker Definitions
In-Reply-To: <CACsJ2H5TEtOxssenjyqJz_Lc0bpy1jbyztoLjpnCHLQ4FJgQ+Q@mail.gmail.com>
References: <CACsJ2H5TEtOxssenjyqJz_Lc0bpy1jbyztoLjpnCHLQ4FJgQ+Q@mail.gmail.com>
Message-ID: <53A7FF49.8010107@rabbitmq.com>

Does the new user have an appropriate tag? ('management' at least). Does 
it have permissions to access any vhost?

Cheers, Simon

On 20/06/2014 9:16PM, Brandon Munroe wrote:
> I've been having some trouble with logging in to the management UI after
> importing broker definitions.  After importing the definitions, I'm
> taken back to the login page (good), but when I enter the new, imported
> credentials, I'm getting a "Login Failed" message.  I've verified the
> credentials by hitting the HTTP API directly with the same credentials,
> and am getting back good responses.  When I check the logs, I see
> periodic messages reading:
>
> webmachine error: path="/api/exchanges"
> "Unauthorized"
>
> Plus, when I attempt to log in, I get the following:
>
> webmachine error: path="/api/whoami"
> "Unauthorized"
>
> Does anyone have any ideas on how to fix this?
>
> I'm using RabbitMQ 3.2.4 on CentOS 6.5, with Erlang R16B03-0.2
>
> Thanks!
>
> -Brandon
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From lepolac at gmail.com  Mon Jun 23 12:18:33 2014
From: lepolac at gmail.com (lepolac)
Date: Mon, 23 Jun 2014 04:18:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Message Stats in /api/overview
Message-ID: <1403522313822-36437.post@n5.nabble.com>

Hi,

I'm trying to parse the JSON document returned by the overview method of the
API.
Sometimes the field message_stats is empty :
message_stats: { },

I checked and those nodes contain the management statistics database.
Any reason why this is empty ?
Values appear as soon as there is traffic though.
Shouldn't it be displaying 0 in all its field (publish_details,
deliver_details, etc) instead of being empty ?
Would make it a lot easier to sanitize.







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Message-Stats-in-api-overview-tp36437.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.laing at nytimes.com  Mon Jun 23 12:29:21 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Mon, 23 Jun 2014 07:29:21 -0400
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
In-Reply-To: <etPan.53a7cd74.643c9869.13612@mercurio.local>
References: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
 <etPan.53a7cd74.643c9869.13612@mercurio.local>
Message-ID: <CAKgmDnHhExa0PBry2Yjs9X3ZOvz2nMKy6geW4m+iT73125+UAQ@mail.gmail.com>

Workaround: remove -e from the 1st line of the rabbitmq-server script.


On Mon, Jun 23, 2014 at 2:46 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 23 June 2014 at 10:27:49, Alex Clifton (alexander.clifton at gmail.com)
> wrote:
> > > I installed rabbitmg on os x 10.9.3 using brew.
> >
> > No matter what rabbitmq command I use i get nothing returned and
> > no output.
>
> What commands specifically have you tried? Anything in
>
>  * /usr/local/var/log/rabbitmq/rabbit at localhost.log
>  * /usr/local/var/log/rabbitmq/rabbit at localhost-sasl.log
>
> Does RabbitMQ server start when you run it in foreground with
> /usr/local/Cellar/rabbitmq/3.3.2/sbin/rabbitmq-server?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/f244d482/attachment.html>

From simon at rabbitmq.com  Mon Jun 23 13:03:19 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jun 2014 13:03:19 +0100
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
In-Reply-To: <CAKgmDnHhExa0PBry2Yjs9X3ZOvz2nMKy6geW4m+iT73125+UAQ@mail.gmail.com>
References: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
 <etPan.53a7cd74.643c9869.13612@mercurio.local>
 <CAKgmDnHhExa0PBry2Yjs9X3ZOvz2nMKy6geW4m+iT73125+UAQ@mail.gmail.com>
Message-ID: <53A81787.4010607@rabbitmq.com>

On 23/06/2014 12:29PM, Laing, Michael wrote:
> Workaround: remove -e from the 1st line of the rabbitmq-server script.

Note that this should only be necessary if you have inet_dist_listen_min 
/ inet_dist_listen_max defined in your rabbitmq.config - there's a known 
bug in that case. And even so it should not break anything other than 
rabbitmq-server; the OP said all commands fail.

We will of course be fixing this bug in 3.3.4 but we want to keep "-e" 
for obvious reasons - if things are failing in the startup scripts we 
should not just soldier blindly on.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 23 13:07:15 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jun 2014 13:07:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.3 not starting on CentOS 6.5
In-Reply-To: <e5bfda36-30bf-4517-a437-1c1ff3b1bf6e@googlegroups.com>
References: <e5bfda36-30bf-4517-a437-1c1ff3b1bf6e@googlegroups.com>
Message-ID: <53A81873.6090207@rabbitmq.com>

On 23/06/2014 8:18AM, Kamil Porembi?ski wrote:
> After upgrading to 3.3.3 it is not working. I don't have any info in
> logs. Only:
>
> [07:16:30] [root at rabbit-cluster1 ~]# /etc/init.d/rabbitmq-server start
> Starting rabbitmq-server: FAILED - check
> /var/log/rabbitmq/startup_\{log, _err\}
> rabbitmq-server.
> [07:16:33] [root at rabbit-cluster1 ~]# cat /var/log/rabbitmq/*
> [07:16:36] [root at rabbit-cluster1 ~]#                       [FAILED]
>
> I have checked clean installation and have the same results on CentOS
> and Red Hat.

Hi Kamil. There is a bug in 3.3.3 causing the the rabbitmq-server script 
to terminate early if you have inet_dist_listen_min / 
inet_dist_listen_max defined in your rabbitmq.config. This will be fixed 
in 3.3.4 but for the time being you can remove the "-e" from the first 
line of /usr/lib/rabbitmq/lib/rabbitmq_server-3.3.3/sbin/rabbitmq-server 
or switch to using RABBITMQ_DIST_PORT instead.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From blue.ndt at gmail.com  Mon Jun 23 13:06:47 2014
From: blue.ndt at gmail.com (Thinh Nguyen Duc)
Date: Mon, 23 Jun 2014 05:06:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Login rabbitmq with Active Directory Child and
	Parent domain
Message-ID: <b85ba3cd-dcf1-43fb-bb5e-eaef5ac58063@googlegroups.com>

Hello
I have a problem. My Active Directory include Parent and Child domain. How 
to login rabbitmq with user in both domain?
Can i have 2 user_dn_pattern?
Plz hep!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/e860ad0f/attachment.html>

From simon at rabbitmq.com  Mon Jun 23 14:09:04 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jun 2014 14:09:04 +0100
Subject: [rabbitmq-discuss] Login rabbitmq with Active Directory Child
 and Parent domain
In-Reply-To: <b85ba3cd-dcf1-43fb-bb5e-eaef5ac58063@googlegroups.com>
References: <b85ba3cd-dcf1-43fb-bb5e-eaef5ac58063@googlegroups.com>
Message-ID: <53A826F0.9050407@rabbitmq.com>

On 23/06/2014 1:06PM, Thinh Nguyen Duc wrote:
> Hello
> I have a problem. My Active Directory include Parent and Child domain.
> How to login rabbitmq with user in both domain?
> Can i have 2 user_dn_pattern?

No, you can't.

People usually tackle this using dn_lookup_attribute / dn_lookup_base / 
dn_lookup_bind, looking up the DN from the username through LDAP.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 23 14:11:43 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jun 2014 14:11:43 +0100
Subject: [rabbitmq-discuss] Message Stats in /api/overview
In-Reply-To: <1403522313822-36437.post@n5.nabble.com>
References: <1403522313822-36437.post@n5.nabble.com>
Message-ID: <53A8278F.5030704@rabbitmq.com>

Yes, we only show stats for which there is traffic. This does get asked 
about with some frequency though, so we might change it in future.

Cheers, Simon

On 23/06/2014 12:18PM, lepolac wrote:
> Hi,
>
> I'm trying to parse the JSON document returned by the overview method of the
> API.
> Sometimes the field message_stats is empty :
> message_stats: { },
>
> I checked and those nodes contain the management statistics database.
> Any reason why this is empty ?
> Values appear as soon as there is traffic though.
> Shouldn't it be displaying 0 in all its field (publish_details,
> deliver_details, etc) instead of being empty ?
> Would make it a lot easier to sanitize.
>
>
>
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Message-Stats-in-api-overview-tp36437.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 23 14:17:21 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jun 2014 14:17:21 +0100
Subject: [rabbitmq-discuss] Plugin startup behavior issue
In-Reply-To: <etPan.53a0ed1b.643c9869.102e9@gmr-home.local>
References: <etPan.539fba68.6b8b4567.102e9@gmr-home.local>
 <539FF03C.2030203@rabbitmq.com> <etPan.53a050df.6b8b4567.139b7@s826.ofc.lair>
 <53A079BB.6090209@rabbitmq.com>
 <etPan.53a0ed1b.643c9869.102e9@gmr-home.local>
Message-ID: <53A828E1.20605@rabbitmq.com>

On 18/06/2014 2:36AM, Gavin M. Roy wrote:
> I ran into one other issue on startup, having to do with
> rabbit_direct_client being available. The solution I came up with was to
> use timers to defer the commands until rabbit_direct_client_sup exists.
> Does this seem like a sane approach?

Yeah, I guess so. federation has to do something similar - in theory you 
could delay the worker startup but inherently the direct client doesn't 
want to start until all exchanges / queues are available, so your 
exchange requiring it implies a circular dependency.

In federation we queue up bind / unbind commands. I am not sure your 
approach will maintain the ordering correctly. But ordering of bindings 
is a big deal for federation; it might not be for you.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From paszczak000 at gmail.com  Mon Jun 23 14:09:22 2014
From: paszczak000 at gmail.com (=?UTF-8?Q?Kamil_Porembi=C5=84ski?=)
Date: Mon, 23 Jun 2014 15:09:22 +0200
Subject: [rabbitmq-discuss] RabbitMQ 3.3.3 not starting on CentOS 6.5
In-Reply-To: <53A81873.6090207@rabbitmq.com>
References: <e5bfda36-30bf-4517-a437-1c1ff3b1bf6e@googlegroups.com>
 <53A81873.6090207@rabbitmq.com>
Message-ID: <CAEWEmK=DWptOWFMzJoL3NUXjrvXgEUiW84T-+XjYXUnraknoNQ@mail.gmail.com>

Thanks!

I will wait.


2014-06-23 14:07 GMT+02:00 Simon MacMullen <simon at rabbitmq.com>:

> On 23/06/2014 8:18AM, Kamil Porembi?ski wrote:
>
>> After upgrading to 3.3.3 it is not working. I don't have any info in
>> logs. Only:
>>
>> [07:16:30] [root at rabbit-cluster1 ~]# /etc/init.d/rabbitmq-server start
>> Starting rabbitmq-server: FAILED - check
>> /var/log/rabbitmq/startup_\{log, _err\}
>> rabbitmq-server.
>> [07:16:33] [root at rabbit-cluster1 ~]# cat /var/log/rabbitmq/*
>> [07:16:36] [root at rabbit-cluster1 ~]#                       [FAILED]
>>
>> I have checked clean installation and have the same results on CentOS
>> and Red Hat.
>>
>
> Hi Kamil. There is a bug in 3.3.3 causing the the rabbitmq-server script
> to terminate early if you have inet_dist_listen_min / inet_dist_listen_max
> defined in your rabbitmq.config. This will be fixed in 3.3.4 but for the
> time being you can remove the "-e" from the first line of
> /usr/lib/rabbitmq/lib/rabbitmq_server-3.3.3/sbin/rabbitmq-server or
> switch to using RABBITMQ_DIST_PORT instead.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/6659984c/attachment.html>

From alexander.clifton at gmail.com  Mon Jun 23 14:50:57 2014
From: alexander.clifton at gmail.com (Alex Clifton)
Date: Mon, 23 Jun 2014 09:50:57 -0400
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
In-Reply-To: <etPan.53a7cd74.643c9869.13612@mercurio.local>
References: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
 <etPan.53a7cd74.643c9869.13612@mercurio.local>
Message-ID: <CAJczUGYgXFctwB1pmPD-7GmWv2Hf3d=uUrXMG44OP0444abLVQ@mail.gmail.com>

sudo rabbitmq-server
sudo rabbitmqctl status
sudo rabbitmq-server -detached

I eventually used macPorts to install it and it works now.



On Mon, Jun 23, 2014 at 2:46 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 23 June 2014 at 10:27:49, Alex Clifton (alexander.clifton at gmail.com)
> wrote:
> > > I installed rabbitmg on os x 10.9.3 using brew.
> >
> > No matter what rabbitmq command I use i get nothing returned and
> > no output.
>
> What commands specifically have you tried? Anything in
>
>  * /usr/local/var/log/rabbitmq/rabbit at localhost.log
>  * /usr/local/var/log/rabbitmq/rabbit at localhost-sasl.log
>
> Does RabbitMQ server start when you run it in foreground with
> /usr/local/Cellar/rabbitmq/3.3.2/sbin/rabbitmq-server?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>



-- 
? ? ? ?
Alexander Clifton
alexander.clifton at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/0fdf525e/attachment.html>

From alexander.clifton at gmail.com  Mon Jun 23 14:58:46 2014
From: alexander.clifton at gmail.com (Alex Clifton)
Date: Mon, 23 Jun 2014 09:58:46 -0400
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
In-Reply-To: <53A81787.4010607@rabbitmq.com>
References: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
 <etPan.53a7cd74.643c9869.13612@mercurio.local>
 <CAKgmDnHhExa0PBry2Yjs9X3ZOvz2nMKy6geW4m+iT73125+UAQ@mail.gmail.com>
 <53A81787.4010607@rabbitmq.com>
Message-ID: <CAJczUGZS5ZWxDv1=ebysUzVyeQf_fZ8UBkK3=Q64=Q8CLujuOA@mail.gmail.com>

I got it working by installing it with macPorts.

I'll keep the -e in mind next time I try to set it up.

Thank you!

:-)



On Mon, Jun 23, 2014 at 8:03 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 23/06/2014 12:29PM, Laing, Michael wrote:
>
>> Workaround: remove -e from the 1st line of the rabbitmq-server script.
>>
>
> Note that this should only be necessary if you have inet_dist_listen_min /
> inet_dist_listen_max defined in your rabbitmq.config - there's a known bug
> in that case. And even so it should not break anything other than
> rabbitmq-server; the OP said all commands fail.
>
> We will of course be fixing this bug in 3.3.4 but we want to keep "-e" for
> obvious reasons - if things are failing in the startup scripts we should
> not just soldier blindly on.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
? ? ? ?
Alexander Clifton
alexander.clifton at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/4afb74fa/attachment.html>

From mklishin at gopivotal.com  Mon Jun 23 15:05:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 23 Jun 2014 18:05:38 +0400
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
In-Reply-To: <CAJczUGZS5ZWxDv1=ebysUzVyeQf_fZ8UBkK3=Q64=Q8CLujuOA@mail.gmail.com>
References: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
 <etPan.53a7cd74.643c9869.13612@mercurio.local>
 <CAKgmDnHhExa0PBry2Yjs9X3ZOvz2nMKy6geW4m+iT73125+UAQ@mail.gmail.com>
 <53A81787.4010607@rabbitmq.com>
 <CAJczUGZS5ZWxDv1=ebysUzVyeQf_fZ8UBkK3=Q64=Q8CLujuOA@mail.gmail.com>
Message-ID: <etPan.53a8344d.2ae8944a.13612@mercurio.local>

On 23 June 2014 at 18:01:45, Alex Clifton (alexander.clifton at gmail.com) wrote:
> > I'll keep the -e in mind next time I try to set it up.

Also keep in mind that Homebrew generally does not require using sudo for anything:
the Cellar directory is supposed to be owned by a non-privileged user.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun 23 15:51:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 23 Jun 2014 18:51:00 +0400
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
In-Reply-To: <etPan.53a8344d.2ae8944a.13612@mercurio.local>
References: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
 <etPan.53a7cd74.643c9869.13612@mercurio.local>
 <CAKgmDnHhExa0PBry2Yjs9X3ZOvz2nMKy6geW4m+iT73125+UAQ@mail.gmail.com>
 <53A81787.4010607@rabbitmq.com>
 <CAJczUGZS5ZWxDv1=ebysUzVyeQf_fZ8UBkK3=Q64=Q8CLujuOA@mail.gmail.com>
 <etPan.53a8344d.2ae8944a.13612@mercurio.local>
Message-ID: <etPan.53a83eef.238e1f29.13612@mercurio.local>

?On 23 June 2014 at 18:07:56, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Also keep in mind that Homebrew generally does not require using  
> sudo for anything:
> the Cellar directory is supposed to be owned by a non-privileged  
> user.

We've discovered one more issue with the use of -e in 3.3.3 scripts
which affected Homebrew. A fix should be in 3.3.4.

For now, removing the -e from rabbitmq-server shebang should help.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From brandon.munroe at gmail.com  Mon Jun 23 16:00:53 2014
From: brandon.munroe at gmail.com (Brandon Munroe)
Date: Mon, 23 Jun 2014 09:00:53 -0600
Subject: [rabbitmq-discuss] Cannot Log In to Management UI After
 Importing Broker Definitions
In-Reply-To: <53A7FF49.8010107@rabbitmq.com>
References: <CACsJ2H5TEtOxssenjyqJz_Lc0bpy1jbyztoLjpnCHLQ4FJgQ+Q@mail.gmail.com>
 <53A7FF49.8010107@rabbitmq.com>
Message-ID: <CACsJ2H6CZd6YZPz_mT-OGkDdQx95evBDC25n=eaSFZ1djHrR7w@mail.gmail.com>

The user has the administrator tag, and has access to the default virtual
host:

curl -u admin:***** http://10.74.103.20:15672/api/permissions
[{"user":"admin","vhost":"/","configure":".*","write":".*","read":".*"},{"user":"guest","vhost":"/","configure":".*","write":".*","read":".*"}]
curl -u admin:***** http://10.74.103.20:15672/api/users/admin
{"name":"admin","password_hash":"*****","tags":"administrator"}


On Mon, Jun 23, 2014 at 4:19 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Does the new user have an appropriate tag? ('management' at least). Does
> it have permissions to access any vhost?
>
> Cheers, Simon
>
>
> On 20/06/2014 9:16PM, Brandon Munroe wrote:
>
>> I've been having some trouble with logging in to the management UI after
>> importing broker definitions.  After importing the definitions, I'm
>> taken back to the login page (good), but when I enter the new, imported
>> credentials, I'm getting a "Login Failed" message.  I've verified the
>> credentials by hitting the HTTP API directly with the same credentials,
>> and am getting back good responses.  When I check the logs, I see
>> periodic messages reading:
>>
>> webmachine error: path="/api/exchanges"
>> "Unauthorized"
>>
>> Plus, when I attempt to log in, I get the following:
>>
>> webmachine error: path="/api/whoami"
>> "Unauthorized"
>>
>> Does anyone have any ideas on how to fix this?
>>
>> I'm using RabbitMQ 3.2.4 on CentOS 6.5, with Erlang R16B03-0.2
>>
>> Thanks!
>>
>> -Brandon
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/f86f8415/attachment.html>

From gavinmroy at gmail.com  Mon Jun 23 19:40:30 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Mon, 23 Jun 2014 14:40:30 -0400
Subject: [rabbitmq-discuss] ANN: InfluxDB Storage Exchange v0.1.0
Message-ID: <CAPnH5kpnrADXH0qV6o4BwXmh=8eUEnvLZDMCiXVYX+Pn-rkrFQ@mail.gmail.com>

Version 0.1.0 of the InfluxDB Storage Exchange has been released.

The InfluxDB Storage Exchange stores messages that are routed through it as
events in InfluxDB and should be considered experimental. InfluxDB
connection
information can be configured via policy or arguments when declaring the
exchange.

Instructions and pre-built binaries download for RabbitMQ v3.3.x are
available at:

https://github.com/aweber/influxdb-storage-exchange#readme

Cheers,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/5bc93bf4/attachment.html>

From be_strew at yahoo.co.uk  Mon Jun 23 17:08:04 2014
From: be_strew at yahoo.co.uk (Justin McCartney)
Date: Mon, 23 Jun 2014 17:08:04 +0100
Subject: [rabbitmq-discuss] RabbitMq 3.2.4 Failure on Windows
Message-ID: <1403539684.43559.YahooMailNeo@web172505.mail.ir2.yahoo.com>

Hi,

the following crash log was seen in the sasl file on Windows, due to RabbitMq being unable to delete a file by the looks of it:

=ERROR REPORT==== 22-Jun-2014::13:32:28 ===
** Generic server <0.266.0> terminating
** Last message in was {'$gen_cast',{delete,241}}
** When Server state == {state,
? ? ? ? ? ? ? ? ? ? ? ? ? ? {dict,0,16,16,8,80,48,
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[]},
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]}}},
? ? ? ? ? ? ? ? ? ? ? ? ? ? [],
? ? ? ? ? ? ? ? ? ? ? ? ? ? {gc_state,
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? "c:/Documents and Settings/All Users/Application Data/RabbitMQ/db/rabbit at xxxx-mnesia/msg_store_persistent",
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? rabbit_msg_store_ets_index,
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {state,360523,
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? "c:/Documents and Settings/All Users/Application Data/RabbitMQ/db/rabbit at xxxx-mnesia/msg_store_persistent"},
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 356426,364620,<0.261.0>}}
** Reason for termination ==
** {{badmatch,{error,eacces}},
? ? [{rabbit_msg_store,safe_file_delete,3,[]},
? ? ?{rabbit_msg_store_gc,'-attempt_action/3-fun-0-',1,[]},
? ? ?{lists,'-filter/2-lc$^0/1-0-',2,[{file,"lists.erl"},{line,1271}]},
? ? ?{rabbit_msg_store_gc,attempt_action,3,[]},
? ? ?{rabbit_msg_store_gc,handle_cast,2,[]},
? ? ?{gen_server2,handle_msg,2,[]},
? ? ?{proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

After this outage RabbitMq was not available and the slave did not promote itself for all of our virtual hosts. ?In the case of such a problem as above should the?erlsrv.exe not exit? ?In our case Erlang was still running. ?If the process had exited it could of been automatically restarted by the Windows service manager.


Thanks,

Justin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/17b6031d/attachment.html>

From avarnon at rightpoint.com  Mon Jun 23 20:51:01 2014
From: avarnon at rightpoint.com (Andrew Varnon)
Date: Mon, 23 Jun 2014 19:51:01 +0000
Subject: [rabbitmq-discuss] MQTT client queues are not persistent
Message-ID: <e3f8f7a4bbf14bd882b4a0e47d91f86f@BY2PR03MB556.namprd03.prod.outlook.com>

Dear RabbitMQ Community,

We are using RabbitMQ with the MQTT plugin and are having issues with MQTT subscriber queues. A queue is created when our client application subscribes to a topic over MQTT but the auto-delete flag is set to true. Furthermore, if I manually create the client queue through the GUI and add a topic binding the auto-delete flag is toggled when the client connects. I have looked through our client libraries and in the MQTT plug-in's config documentation but I see no way to set auto-delete. We require that our MQTT client subscriber queues and topics persist across connects and disconnects.

Is there a way to configure our queues to maintain an auto-delete: false setting even when an MQTT client connects or to have the MQTT subscriptions create a queue with auto-delete: false?

Sincerely,

- -
Andrew Varnon
avarnon at rightpoint.com<mailto:avarnon at rightpoint.com>
312.462.9924 Direct

[unknown.png]

29 North Wacker Drive, 4th Floor | Chicago, Illinois 60606
312.920.8383 Office | 312.920.8384 Fax | rightpoint.com

[Pasted Graphic 7.tiff]<http://www.linkedin.com/company/202545?trk=vsrp_companies_res_name&trkInfo=VSRPsearchId%3A309930471377292377432%2CVSRPtargetId%3A202545%2CVSRPcmpt%3Aprimary>  [Pasted Graphic 8.tiff] <https://twitter.com/rightpoint>   [Pasted Graphic 9.tiff] <https://www.facebook.com/rightpointfan>

[cid:image005.png at 01CF21A2.444784B0]<http://www.rightpoint.com/thinking-doing/news/forbes-names-rightpoint-one-of-the-most-promising-companies-in-america>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/8782e408/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 6473 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/8782e408/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 3692 bytes
Desc: image002.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/8782e408/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 3694 bytes
Desc: image003.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/8782e408/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 3654 bytes
Desc: image004.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/8782e408/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 8454 bytes
Desc: image005.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/8782e408/attachment-0004.png>

From andrew at andrewloe.com  Tue Jun 24 00:41:46 2014
From: andrew at andrewloe.com (W. Andrew Loe III)
Date: Mon, 23 Jun 2014 16:41:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Copy Messages across Virtual Hosts
Message-ID: <6bb1769f-ac0b-4e07-a18d-68e22abc363b@googlegroups.com>

I have 3 applications that communicate with the same RabbitMQ broker but 
are walled off from each other by virtual hosts. I have a special use case 
where I need to infrequently publish a message from one application to the 
other two. This worked in a previous design when all the application shared 
the same virtual host, I could have 3 queues and each app could message the 
2 queues not associated with it. Ideally I'd like to have a shovel on a 
queue on each application virtual host and it would publish once to each 
other application, however I cannot seem to achieve this with the existing 
shovel options. Maybe I need to use a fanout/topic exchange with two 
shovels per virtual host, but this seems very complicated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140623/8254d1cd/attachment.html>

From mklishin at gopivotal.com  Tue Jun 24 02:05:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 05:05:09 +0400
Subject: [rabbitmq-discuss] RabbitMq 3.2.4 Failure on Windows
In-Reply-To: <1403539684.43559.YahooMailNeo@web172505.mail.ir2.yahoo.com>
References: <1403539684.43559.YahooMailNeo@web172505.mail.ir2.yahoo.com>
Message-ID: <etPan.53a8cee2.327b23c6.176eb@mercurio.local>

?On 24 June 2014 at 05:00:04, Justin McCartney (be_strew at yahoo.co.uk) wrote:
> > {badmatch,{error,eacces}

This means RabbitMQ message store was unable to delete a file.
Possible reasons range from insufficient permissions to hardware
issues.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jun 24 02:48:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 05:48:57 +0400
Subject: [rabbitmq-discuss] MQTT client queues are not persistent
In-Reply-To: <e3f8f7a4bbf14bd882b4a0e47d91f86f@BY2PR03MB556.namprd03.prod.outlook.com>
References: <e3f8f7a4bbf14bd882b4a0e47d91f86f@BY2PR03MB556.namprd03.prod.outlook.com>
Message-ID: <etPan.53a8d925.66334873.176eb@mercurio.local>

On 24 June 2014 at 05:00:54, Andrew Varnon (avarnon at rightpoint.com) wrote:
> > Is there a way to configure our queues to maintain an auto-delete:  
> false setting even when an MQTT client connects or to have the  
> MQTT subscriptions create a queue with auto-delete: false?  

There is no. I think what you expect is perfectly reasonable. We'll
look into only using auto-delete queues for QoS 0 subscriptions. Would
that be sufficient for your case?

(note that any improvements in this area will be in 3.4.0 and not 3.3.x releases)?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jun 24 02:53:40 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 05:53:40 +0400
Subject: [rabbitmq-discuss] MQTT client queues are not persistent
In-Reply-To: <etPan.53a8d925.66334873.176eb@mercurio.local>
References: <e3f8f7a4bbf14bd882b4a0e47d91f86f@BY2PR03MB556.namprd03.prod.outlook.com>
 <etPan.53a8d925.66334873.176eb@mercurio.local>
Message-ID: <etPan.53a8da3e.19495cff.176eb@mercurio.local>

On 24 June 2014 at 05:50:43, Michael Klishin (mklishin at gopivotal.com) wrote:
> > There is no. I think what you expect is perfectly reasonable. 
> We'll
> look into only using auto-delete queues for QoS 0 subscriptions. 

FTR, queues declared for QoS 1 subscriptions are declared as durable but auto-delete
(and queue name generation) get in the way .
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jun 24 03:08:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 06:08:54 +0400
Subject: [rabbitmq-discuss] MQTT client queues are not persistent
In-Reply-To: <etPan.53a8d925.66334873.176eb@mercurio.local>
References: <e3f8f7a4bbf14bd882b4a0e47d91f86f@BY2PR03MB556.namprd03.prod.outlook.com>
 <etPan.53a8d925.66334873.176eb@mercurio.local>
 <etPan.53a8d925.66334873.176eb@mercurio.local>
Message-ID: <etPan.53a8ddd1.625558ec.176eb@mercurio.local>

?On 24 June 2014 at 05:50:43, Michael Klishin (mklishin at gopivotal.com) wrote:
> > There is no.

It turns out, there is but it can be confusing with some MQTT client defaults.

If you use QoS 1 and set clean session to false (most clients default to true),
you will get a durable, non-auto-delete queue. If MQTT plugin's?subscription_ttl
setting is set, queue TTL [1] will be used for the queue.

1.?https://www.rabbitmq.com/ttl.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jun 24 03:14:03 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 06:14:03 +0400
Subject: [rabbitmq-discuss] MQTT client queues are not persistent
In-Reply-To: <etPan.53a8ddd4.238e1f29.176eb@mercurio.local>
References: <e3f8f7a4bbf14bd882b4a0e47d91f86f@BY2PR03MB556.namprd03.prod.outlook.com>
 <etPan.53a8d925.66334873.176eb@mercurio.local>
 <etPan.53a8d925.66334873.176eb@mercurio.local>
 <etPan.53a8ddd4.238e1f29.176eb@mercurio.local>
Message-ID: <etPan.53a8df09.46e87ccd.176eb@mercurio.local>



On 24 June 2014 at 06:09:25, Michael Klishin (michael at rabbitmq.com) wrote:
> > MQTT plugin's subscription_ttl
> setting is set, queue TTL [1] will be used for the queue.

?and it is set by default to?1800000 ms (30 minutes). So setting it to undefined,
using non-clean sessions and QoS1 will give you the behavior you want.

All of this ?needs to be made more clear in the docs, of course.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jun 24 06:11:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 09:11:20 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.4.0 is released
Message-ID: <etPan.53a90894.625558ec.3d27@mercurio.local>

amqp gem [1] is an EventMachine-based RabbitMQ Ruby client.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/06/24/amqp-gem-1-dot-4-0-is-released/?

1. http://rubyamqp.info
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mr.bahiraee at gmail.com  Tue Jun 24 06:06:37 2014
From: mr.bahiraee at gmail.com (Amin Bahiraei)
Date: Tue, 24 Jun 2014 09:36:37 +0430
Subject: [rabbitmq-discuss] Alternative for gcm using Rabbitmq
Message-ID: <CADC3UoQWvNdqnF3skhUbHeFNpOk_7rzbuxzUXzhmOmV9O-U1cA@mail.gmail.com>

Hi all

recently i was knowing sweaty rabbitmq and it's great features ,now i want
implementing a private push notification server for my company and after
googling i fount that rabbitmq support mqtt and it's suitable for push . am
i right?!is it best solution and any alternative ?!


Best Regard
bigoloo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/c6ce79b7/attachment.html>

From mklishin at gopivotal.com  Tue Jun 24 08:36:46 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 11:36:46 +0400
Subject: [rabbitmq-discuss] Alternative for gcm using Rabbitmq
In-Reply-To: <CADC3UoQWvNdqnF3skhUbHeFNpOk_7rzbuxzUXzhmOmV9O-U1cA@mail.gmail.com>
References: <CADC3UoQWvNdqnF3skhUbHeFNpOk_7rzbuxzUXzhmOmV9O-U1cA@mail.gmail.com>
Message-ID: <etPan.53a92aab.238e1f29.3d27@mercurio.local>

?On 24 June 2014 at 11:30:15, Amin Bahiraei (mr.bahiraee at gmail.com) wrote:
> > recently i was knowing sweaty rabbitmq and it's great features  
> ,now i want implementing a private push notification server  
> for my company and after googling i fount that rabbitmq support  
> mqtt and it's suitable for push . am i right?!is it best solution  
> and any alternative ?!

MQTT is suitable for low-power devices. Some [1] use it as an alternative to
Google Cloud Messaging (which uses HTTP or XMPP), and RabbitMQ indeed
has MQTT support [2].

1.?http://ollieparsley.com/2013/05/20/using-mqtt-as-a-gcm-replacement-for-android-push-notifications/
2.?http://www.rabbitmq.com/mqtt.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue Jun 24 09:08:17 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jun 2014 09:08:17 +0100
Subject: [rabbitmq-discuss] RabbitMq 3.2.4 Failure on Windows
In-Reply-To: <etPan.53a8cee2.327b23c6.176eb@mercurio.local>
References: <1403539684.43559.YahooMailNeo@web172505.mail.ir2.yahoo.com>
 <etPan.53a8cee2.327b23c6.176eb@mercurio.local>
Message-ID: <53A931F1.4040101@rabbitmq.com>

On 24/06/2014 02:05, Michael Klishin wrote:
>   On 24 June 2014 at 05:00:04, Justin McCartney (be_strew at yahoo.co.uk) wrote:
>>> {badmatch,{error,eacces}
>
> This means RabbitMQ message store was unable to delete a file.
> Possible reasons range from insufficient permissions to hardware
> issues.

On Windows a plausible culprit is virus scanners, some can end up 
locking files as they scan.

Unfortunately there's not much we can do to recover from inability to 
access the file system.

Cheers, Simon


From mklishin at gopivotal.com  Tue Jun 24 09:14:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 12:14:07 +0400
Subject: [rabbitmq-discuss] RabbitMq 3.2.4 Failure on Windows
In-Reply-To: <1403597412.1621.YahooMailNeo@web172504.mail.ir2.yahoo.com>
References: <1403539684.43559.YahooMailNeo@web172505.mail.ir2.yahoo.com>
 <etPan.53a8cee2.327b23c6.176eb@mercurio.local>
 <1403597412.1621.YahooMailNeo@web172504.mail.ir2.yahoo.com>
Message-ID: <etPan.53a9336e.3d1b58ba.3d27@mercurio.local>

+ rabbitmq-discuss

On 24 June 2014 at 12:10:13, Justin McCartney (be_strew at yahoo.co.uk) wrote:
> > thanks for the info. I am aware that the error was caused by the 
> inability to delete a file. My question more revolves around 
> why the Erlang process is still running after this critical error? 
> 
> If the error had caused the Erlang process to stop, then Windows 
> could have automatically restarted the service, which in our 
> case would of resolved the problem.

I assume you mean "the Erlang VM OS process". "Erlang process" in RabbitMQ means
something else ;)

One reason is that such issues can be intermittent. We don't want to bring RabbitMQ
down immediately. It's true that there is no sensible way to recover from some issues.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From carl.hoerberg at gmail.com  Tue Jun 24 09:49:48 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 24 Jun 2014 01:49:48 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmqctl in os x
Message-ID: <1403599788303-36466.post@n5.nabble.com>

readlink differs between BSD and Linux and thus rabbitmqctl (in 3.3.3)
doesn't work (if symlinked) on OS X.

this is the problematic line: 
http://hg.rabbitmq.com/rabbitmq-server/file/cc68f1cb6c48/scripts/rabbitmq-env#l22

possible way to solve it: http://stackoverflow.com/a/1116890/80589



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmqctl-in-os-x-tp36466.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Jun 24 09:51:48 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 12:51:48 +0400
Subject: [rabbitmq-discuss] rabbitmqctl in os x
In-Reply-To: <1403599788303-36466.post@n5.nabble.com>
References: <1403599788303-36466.post@n5.nabble.com>
Message-ID: <etPan.53a93c3f.507ed7ab.3d27@mercurio.local>



On 24 June 2014 at 12:50:56, carlhoerberg (carl.hoerberg at gmail.com) wrote:
> > readlink differs between BSD and Linux and thus rabbitmqctl  
> (in 3.3.3)
> doesn't work (if symlinked) on OS X.
>  
> this is the problematic line:
> http://hg.rabbitmq.com/rabbitmq-server/file/cc68f1cb6c48/scripts/rabbitmq-env#l22  
>  
> possible way to solve it: http://stackoverflow.com/a/1116890/80589  

http://hg.rabbitmq.com/rabbitmq-server/rev/9ec028f18a5b?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From carl.hoerberg at gmail.com  Tue Jun 24 09:58:28 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 24 Jun 2014 01:58:28 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmqctl in os x
In-Reply-To: <etPan.53a93c3f.507ed7ab.3d27@mercurio.local>
References: <1403599788303-36466.post@n5.nabble.com>
 <etPan.53a93c3f.507ed7ab.3d27@mercurio.local>
Message-ID: <1403600308928-36469.post@n5.nabble.com>

Ok, thanks ;) 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmqctl-in-os-x-tp36466p36469.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Tue Jun 24 09:55:04 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 24 Jun 2014 01:55:04 -0700 (PDT)
Subject: [rabbitmq-discuss] os x brew install of rabbitmq fails silently
In-Reply-To: <etPan.53a83eef.238e1f29.13612@mercurio.local>
References: <a68404b8-0549-4963-8886-6a7468edad68@googlegroups.com>
 <etPan.53a7cd74.643c9869.13612@mercurio.local>
 <CAKgmDnHhExa0PBry2Yjs9X3ZOvz2nMKy6geW4m+iT73125+UAQ@mail.gmail.com>
 <53A81787.4010607@rabbitmq.com>
 <CAJczUGZS5ZWxDv1=ebysUzVyeQf_fZ8UBkK3=Q64=Q8CLujuOA@mail.gmail.com>
 <etPan.53a8344d.2ae8944a.13612@mercurio.local>
 <etPan.53a83eef.238e1f29.13612@mercurio.local>
Message-ID: <1403600104588-36467.post@n5.nabble.com>

It fails on "readlink -f" which differs from linux's "readlink".. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/os-x-brew-install-of-rabbitmq-fails-silently-tp36428p36467.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From rom.t.cabral at gmail.com  Tue Jun 24 10:32:47 2014
From: rom.t.cabral at gmail.com (Rom Cabral)
Date: Tue, 24 Jun 2014 02:32:47 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitManagement from Berico - Technologies is
	not working
Message-ID: <881c44e8-1607-4c29-8c3b-4d3547359a71@googlegroups.com>

Hi guys,

Just asking if anyone here tried using the library from Berico Technologies 
from https://github.com/Berico-Technologies/RabbidManagement. I tried using 
it but encounters the error below. It seems to me that there is null 
pointer exception somewhere. I tried to call the initialize explicitly but 
still got the error. Do I need to add on my project other than dependency 
and repositories on my pom.xml?

   test code:
   RabbitMgmtService service = RabbitMgmtService.builder().build();
        //service.initialize();
        service.queues().create(new Queue("test-queue"));
        Assert.assertEquals("test-queue", 
service.queues().get("test-queue").get().getName());

Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.169 sec 
<<< FAILURE! - in com.transport.implementation.ManagementClientTest
QueueUsageTest(com.trendmicro.grid.transport.implementation.ManagementClientTest) 
 Time elapsed: 0.14 sec  <<< ERROR!
java.lang.ExceptionInInitializerError: null
at java.net.URLClassLoader$1.run(URLClassLoader.java:366)
at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
at java.security.AccessController.doPrivileged(Native Method)
at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
at java.lang.ClassLoader.loadClass(ClassLoader.java:423)
at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
at java.lang.ClassLoader.loadClass(ClassLoader.java:356)
at java.lang.Class.forName0(Native Method)
at java.lang.Class.forName(Class.java:188)
at javax.ws.rs.ext.FactoryFinder.newInstance(FactoryFinder.java:114)
at javax.ws.rs.ext.FactoryFinder.find(FactoryFinder.java:207)
at javax.ws.rs.ext.RuntimeDelegate.findDelegate(RuntimeDelegate.java:135)
at javax.ws.rs.ext.RuntimeDelegate.getInstance(RuntimeDelegate.java:120)
at javax.ws.rs.core.MediaType.valueOf(MediaType.java:179)
at com.sun.jersey.core.header.MediaTypes.<clinit>(MediaTypes.java:65)
at 
com.sun.jersey.core.spi.factory.MessageBodyFactory.initReaders(MessageBodyFactory.java:182)
at 
com.sun.jersey.core.spi.factory.MessageBodyFactory.initReaders(MessageBodyFactory.java:175)
at 
com.sun.jersey.core.spi.factory.MessageBodyFactory.init(MessageBodyFactory.java:162)
at com.sun.jersey.api.client.Client.init(Client.java:343)
at com.sun.jersey.api.client.Client.access$000(Client.java:119)
at com.sun.jersey.api.client.Client$1.f(Client.java:192)
at com.sun.jersey.api.client.Client$1.f(Client.java:188)
at com.sun.jersey.spi.inject.Errors.processWithErrors(Errors.java:193)
at com.sun.jersey.api.client.Client.<init>(Client.java:188)
at com.sun.jersey.api.client.Client.<init>(Client.java:171)
at com.sun.jersey.api.client.Client.create(Client.java:683)
at 
rabbitmq.httpclient.BasicAuthHttpClientProvider.getClient(BasicAuthHttpClientProvider.java:25)
at rabbitmq.mgmt.RabbitMgmtService.initialize(RabbitMgmtService.java:51)
at 
rabbitmq.mgmt.RabbitMgmtService.checkInitialize(RabbitMgmtService.java:229)
at rabbitmq.mgmt.RabbitMgmtService.queues(RabbitMgmtService.java:133)
at 
com.transport.implementation.ManagementClientTest.QueueUsageTest(ManagementClientTest.java:62)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/e3d055ff/attachment.html>

From mklishin at gopivotal.com  Tue Jun 24 10:38:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 13:38:10 +0400
Subject: [rabbitmq-discuss] RabbitManagement from Berico - Technologies
 is not working
In-Reply-To: <881c44e8-1607-4c29-8c3b-4d3547359a71@googlegroups.com>
References: <881c44e8-1607-4c29-8c3b-4d3547359a71@googlegroups.com>
Message-ID: <etPan.53a94720.41b71efb.3d27@mercurio.local>

On 24 June 2014 at 13:35:03, Rom Cabral (rom.t.cabral at gmail.com) wrote:
> > test code:
> RabbitMgmtService service = RabbitMgmtService.builder().build();  
> //service.initialize();
> service.queues().create(new Queue("test-queue"));
> Assert.assertEquals("test-queue", service.queues().get("test-queue").get().getName());  
>  
>  
> Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed:  
> 0.169 sec <<< FAILURE! - in com.transport.implementation.ManagementClientTest  
> QueueUsageTest(com.trendmicro.grid.transport.implementation.ManagementClientTest)  
> Time elapsed: 0.14 sec <<< ERROR!
> java.lang.ExceptionInInitializerError: null
> at java.net.URLClassLoader$1.run(URLClassLoader.java:366)  
> at java.net.URLClassLoader$1.run(URLClassLoader.java:355)  
> at java.security.AccessController.doPrivileged(Native  
> Method)
> at java.net.URLClassLoader.findClass(URLClassLoader.java:354)  

??

> at rabbitmq.httpclient.BasicAuthHttpClientProvider.getClient(BasicAuthHttpClientProvider.java:25)  

My guess is that you did not specify a valid pair of credentials to
BasicAuthHttpClientProvider.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From avarnon at rightpoint.com  Tue Jun 24 10:50:49 2014
From: avarnon at rightpoint.com (Andrew Varnon)
Date: Tue, 24 Jun 2014 09:50:49 +0000
Subject: [rabbitmq-discuss] MQTT client queues are not persistent
In-Reply-To: <etPan.53a8df09.46e87ccd.176eb@mercurio.local>
References: <e3f8f7a4bbf14bd882b4a0e47d91f86f@BY2PR03MB556.namprd03.prod.outlook.com>
 <etPan.53a8d925.66334873.176eb@mercurio.local>
 <etPan.53a8d925.66334873.176eb@mercurio.local>
 <etPan.53a8ddd4.238e1f29.176eb@mercurio.local>,
 <etPan.53a8df09.46e87ccd.176eb@mercurio.local>
Message-ID: <13197a7df590407188f28fa6202da572@BY2PR03MB556.namprd03.prod.outlook.com>

Thanks! This is just what we need.

--
Andrew Varnon
avarnon at rightpoint.com

----- Reply message -----
From: "Michael Klishin" <mklishin at gopivotal.com>
To: "Andrew Varnon" <avarnon at rightpoint.com>, "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "Rotteveel, Ruben" <ruben.rotteveel at chamberlain.com>, "Tim Chantome" <tchantome at rightpoint.com>
Subject: [rabbitmq-discuss] MQTT client queues are not persistent
Date: Mon, Jun 23, 2014 9:14 PM



On 24 June 2014 at 06:09:25, Michael Klishin (michael at rabbitmq.com) wrote:
> > MQTT plugin's subscription_ttl
> setting is set, queue TTL [1] will be used for the queue.

?and it is set by default to 1800000 ms (30 minutes). So setting it to undefined,
using non-clean sessions and QoS1 will give you the behavior you want.

All of this  needs to be made more clear in the docs, of course.
--
MK

Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/f41eb273/attachment.html>

From rom.t.cabral at gmail.com  Tue Jun 24 11:14:59 2014
From: rom.t.cabral at gmail.com (Rom Cabral)
Date: Tue, 24 Jun 2014 03:14:59 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitManagement from Berico - Technologies
	is not working
In-Reply-To: <881c44e8-1607-4c29-8c3b-4d3547359a71@googlegroups.com>
References: <881c44e8-1607-4c29-8c3b-4d3547359a71@googlegroups.com>
Message-ID: <c765d165-8ca1-4c5d-89bd-252bbaba25c6@googlegroups.com>

tried to re-compile the berico library and add as system path, but still 
got the same error.

On Tuesday, June 24, 2014 5:32:47 PM UTC+8, Rom Cabral wrote:
>
> Hi guys,
>
> Just asking if anyone here tried using the library from Berico 
> Technologies from https://github.com/Berico-Technologies/RabbidManagement. 
> I tried using it but encounters the error below. It seems to me that there 
> is null pointer exception somewhere. I tried to call the initialize 
> explicitly but still got the error. Do I need to add on my project other 
> than dependency and repositories on my pom.xml?
>
>    test code:
>    RabbitMgmtService service = RabbitMgmtService.builder().build();
>         //service.initialize();
>         service.queues().create(new Queue("test-queue"));
>         Assert.assertEquals("test-queue", 
> service.queues().get("test-queue").get().getName());
>
> Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.169 sec 
> <<< FAILURE! - in com.transport.implementation.ManagementClientTest
> QueueUsageTest(com.trendmicro.grid.transport.implementation.ManagementClientTest) 
>  Time elapsed: 0.14 sec  <<< ERROR!
> java.lang.ExceptionInInitializerError: null
> at java.net.URLClassLoader$1.run(URLClassLoader.java:366)
> at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
> at java.security.AccessController.doPrivileged(Native Method)
> at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
> at java.lang.ClassLoader.loadClass(ClassLoader.java:423)
> at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
> at java.lang.ClassLoader.loadClass(ClassLoader.java:356)
> at java.lang.Class.forName0(Native Method)
> at java.lang.Class.forName(Class.java:188)
> at javax.ws.rs.ext.FactoryFinder.newInstance(FactoryFinder.java:114)
> at javax.ws.rs.ext.FactoryFinder.find(FactoryFinder.java:207)
> at javax.ws.rs.ext.RuntimeDelegate.findDelegate(RuntimeDelegate.java:135)
> at javax.ws.rs.ext.RuntimeDelegate.getInstance(RuntimeDelegate.java:120)
> at javax.ws.rs.core.MediaType.valueOf(MediaType.java:179)
> at com.sun.jersey.core.header.MediaTypes.<clinit>(MediaTypes.java:65)
> at 
> com.sun.jersey.core.spi.factory.MessageBodyFactory.initReaders(MessageBodyFactory.java:182)
> at 
> com.sun.jersey.core.spi.factory.MessageBodyFactory.initReaders(MessageBodyFactory.java:175)
> at 
> com.sun.jersey.core.spi.factory.MessageBodyFactory.init(MessageBodyFactory.java:162)
> at com.sun.jersey.api.client.Client.init(Client.java:343)
> at com.sun.jersey.api.client.Client.access$000(Client.java:119)
> at com.sun.jersey.api.client.Client$1.f(Client.java:192)
> at com.sun.jersey.api.client.Client$1.f(Client.java:188)
> at com.sun.jersey.spi.inject.Errors.processWithErrors(Errors.java:193)
> at com.sun.jersey.api.client.Client.<init>(Client.java:188)
> at com.sun.jersey.api.client.Client.<init>(Client.java:171)
> at com.sun.jersey.api.client.Client.create(Client.java:683)
> at 
> rabbitmq.httpclient.BasicAuthHttpClientProvider.getClient(BasicAuthHttpClientProvider.java:25)
> at rabbitmq.mgmt.RabbitMgmtService.initialize(RabbitMgmtService.java:51)
> at 
> rabbitmq.mgmt.RabbitMgmtService.checkInitialize(RabbitMgmtService.java:229)
> at rabbitmq.mgmt.RabbitMgmtService.queues(RabbitMgmtService.java:133)
> at 
> com.transport.implementation.ManagementClientTest.QueueUsageTest(ManagementClientTest.java:62)
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/528fe8b8/attachment.html>

From cjbhaines at gmail.com  Tue Jun 24 13:53:47 2014
From: cjbhaines at gmail.com (Chris Haines)
Date: Tue, 24 Jun 2014 05:53:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Feature Request: Copy Bindings To Another Queue
	In Management UI
Message-ID: <2a781459-aa3d-457d-b0eb-cee2e5d1b8ce@googlegroups.com>

Hi All,

I would like to request a small feature in the Management UI to be able to 
copy all of the bindings from one queue to another queue. This is useful if 
I have a live queue that I want to inspect is receiving the correct 
messages, I can just clone its bindings to a test queue and see what it is 
reviving. This can be a bit tedious/slow in live support scenarios when 
time is of the essence. I hope you agree this is useful!

Cheers,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/4e8c9a3b/attachment.html>

From simon at rabbitmq.com  Tue Jun 24 14:00:13 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jun 2014 14:00:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.4 released
Message-ID: <53A9765D.7050602@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.3.4.

This release fixes a small number of bugs in 3.3.3 and earlier versions. 
In particular it fixes a bug introduced in 3.3.3 which could cause 
startup to fail under some circumstances.

See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.3.4.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                       The RabbitMQ Team
                       (http://www.rabbitmq.com)

From david at artisongs.com  Tue Jun 24 13:12:38 2014
From: david at artisongs.com (dkent)
Date: Tue, 24 Jun 2014 05:12:38 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)
In-Reply-To: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>
References: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>
Message-ID: <1403611958898-36474.post@n5.nabble.com>

I know exactly why this happens (after a long troubleshooting session.)  it's
line 91 of rabbit_prelaunch.erl:
-> rabbit_misc:quit(?DIST_PORT_CONFIGURED)
If the script detects inet_dist_listen_min and inet_dist_listen_max are set,
it will exit with DIST_PORT_CONFIGURED, which has a value of 2.  In fact,
you can cause the crash and immediately perform "echo $?" from the command
line and you'll see the proper code being returned.  In the case of a 0
value, -e (errfail) is not invoked and the rabbitmq-server script may
continue. However, that will cause the port to be set to 25672 by
rabbitmq-server. You can confirm this with "epmd -names".  In short,
rabbit_prelaunch.erl will disrupt rabbitmq-server on any non-zero exit code.

One way to fix this and still keep -e is to add " && :" to the end of the
call to ${ERL_DIR}erl on line 98 of rabbitmq-server.  This is one of the
operator expressions that will defeat errfail and the exit code will
survive.  This is how I have my script running now.  I want to be able to
set this inter-node port and keep my firewall ports grouped by value and
consistent.

If this is truly a deprecated option, please let us know.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-server-won-t-run-3-3-3-tp36270p36474.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Jun 24 14:07:48 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 24 Jun 2014 17:07:48 +0400
Subject: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)
In-Reply-To: <1403611958898-36474.post@n5.nabble.com>
References: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>
 <1403611958898-36474.post@n5.nabble.com>
Message-ID: <etPan.53a97840.6b8b4567.1148c@mercurio.local>

?On 24 June 2014 at 17:06:55, dkent (david at artisongs.com) wrote:
> > One way to fix this and still keep -e is to add " && :" to the end of  
> the
> call to ${ERL_DIR}erl on line 98 of rabbitmq-server. This is  
> one of the
> operator expressions that will defeat errfail and the exit code  
> will
> survive. This is how I have my script running now. I want to be able  
> to
> set this inter-node port and keep my firewall ports grouped by  
> value and
> consistent.

This and one more similar issue were fixed in 3.3.4.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From proy at netzary.com  Tue Jun 24 15:10:41 2014
From: proy at netzary.com (Priyadarsan Roy)
Date: Tue, 24 Jun 2014 19:40:41 +0530
Subject: [rabbitmq-discuss] rabbitmq-plugins not working
Message-ID: <1403619041.2647.8.camel@pdlaptop>

Hi,

I have a Centos 5 running rabbitmq-server which I installed via yum.
rabbitmq is running fine but when I execute to enable a plugin it says
that the plugin is not found.

root at us-s27 rabbitmq]# rabbitmq-plugins enable rabbitmq_management
Error: "The following plugins could not be found:\n  rabbitmq_management
\n\n"


But in /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/plugins I can see
that the plugins are available. 

[root at us-s27 rabbitmq]#
cd /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/plugins
[root at us-s27 plugins]# ls
amqp_client-2.7.1.ez
rabbitmq_consistent_hash_exchange-2.7.1.ez
rabbitmq_management_agent-2.7.1.ez       rabbitmq_tracing-2.7.1.ez
eldap-2.7.1-git.ez                    rabbitmq_federation-2.7.1.ez
rabbitmq_management_visualiser-2.7.1.ez  README
erlando-2.7.1.ez                      rabbitmq_jsonrpc-2.7.1.ez
rabbitmq_mochiweb-2.7.1.ez               rfc4627_jsonrpc-2.7.1-git.ez
mochiweb-1.3-rmq2.7.1-git.ez          rabbitmq_jsonrpc_channel-2.7.1.ez
rabbitmq_shovel-2.7.1.ez                 webmachine-1.7.0-rmq2.7.1-hg.ez
rabbitmq_auth_backend_ldap-2.7.1.ez
rabbitmq_jsonrpc_channel_examples-2.7.1.ez
rabbitmq_shovel_management-2.7.1.ez
rabbitmq_auth_mechanism_ssl-2.7.1.ez  rabbitmq_management-2.7.1.ez
rabbitmq_stomp-2.7.1.ez

What could I be doing wrong ?

Regards,
Priyadarsan Roy


-- 
Netzary InfoDynamics
"Making IT to Work for You"

website		: http://www.netzary.com
hand Phone	: +91 8088503811
telephone	: +91 80 41738665
fax		: +91 80 22075212


From andrei002 at gmail.com  Tue Jun 24 15:23:58 2014
From: andrei002 at gmail.com (Andrei)
Date: Tue, 24 Jun 2014 17:23:58 +0300
Subject: [rabbitmq-discuss] rabbitmq-plugins not working
In-Reply-To: <1403619041.2647.8.camel@pdlaptop>
References: <1403619041.2647.8.camel@pdlaptop>
Message-ID: <CANcm3vmE8e7u7vt_z8C-rUGHEhLq+XK+bFOtrtjfj4WP16UX4g@mail.gmail.com>

Hi!

Do a 'rabbitmq-plugins list' and afterwards enter the name of the desired
plugin exactly as it appears in the output of the list command.

Regards,
Andy.


On Tue, Jun 24, 2014 at 5:10 PM, Priyadarsan Roy <proy at netzary.com> wrote:

> Hi,
>
> I have a Centos 5 running rabbitmq-server which I installed via yum.
> rabbitmq is running fine but when I execute to enable a plugin it says
> that the plugin is not found.
>
> root at us-s27 rabbitmq]# rabbitmq-plugins enable rabbitmq_management
> Error: "The following plugins could not be found:\n  rabbitmq_management
> \n\n"
>
>
> But in /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/plugins I can see
> that the plugins are available.
>
> [root at us-s27 rabbitmq]#
> cd /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/plugins
> [root at us-s27 plugins]# ls
> amqp_client-2.7.1.ez
> rabbitmq_consistent_hash_exchange-2.7.1.ez
> rabbitmq_management_agent-2.7.1.ez       rabbitmq_tracing-2.7.1.ez
> eldap-2.7.1-git.ez                    rabbitmq_federation-2.7.1.ez
> rabbitmq_management_visualiser-2.7.1.ez  README
> erlando-2.7.1.ez                      rabbitmq_jsonrpc-2.7.1.ez
> rabbitmq_mochiweb-2.7.1.ez               rfc4627_jsonrpc-2.7.1-git.ez
> mochiweb-1.3-rmq2.7.1-git.ez          rabbitmq_jsonrpc_channel-2.7.1.ez
> rabbitmq_shovel-2.7.1.ez                 webmachine-1.7.0-rmq2.7.1-hg.ez
> rabbitmq_auth_backend_ldap-2.7.1.ez
> rabbitmq_jsonrpc_channel_examples-2.7.1.ez
> rabbitmq_shovel_management-2.7.1.ez
> rabbitmq_auth_mechanism_ssl-2.7.1.ez  rabbitmq_management-2.7.1.ez
> rabbitmq_stomp-2.7.1.ez
>
> What could I be doing wrong ?
>
> Regards,
> Priyadarsan Roy
>
>
> --
> Netzary InfoDynamics
> "Making IT to Work for You"
>
> website         : http://www.netzary.com
> hand Phone      : +91 8088503811
> telephone       : +91 80 41738665
> fax             : +91 80 22075212
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/d5fdee7a/attachment.html>

From proy at netzary.com  Tue Jun 24 15:32:55 2014
From: proy at netzary.com (Priyadarsan Roy)
Date: Tue, 24 Jun 2014 20:02:55 +0530
Subject: [rabbitmq-discuss] rabbitmq-plugins not working
In-Reply-To: <CANcm3vmE8e7u7vt_z8C-rUGHEhLq+XK+bFOtrtjfj4WP16UX4g@mail.gmail.com>
References: <1403619041.2647.8.camel@pdlaptop>
 <CANcm3vmE8e7u7vt_z8C-rUGHEhLq+XK+bFOtrtjfj4WP16UX4g@mail.gmail.com>
Message-ID: <1403620375.2647.11.camel@pdlaptop>

Hi Andy,

It is not giving any output.  Just blanks.

[root at us-s27 ~]# rabbitmq-plugins list rabbitmq_management-2.7.1
[root at us-s27 ~]# rabbitmq-plugins list rabbitmq_management
[root at us-s27 ~]# rabbitmq-plugins list rabbitmq_management-2.7.1.ez

Regards,
Priyadarsan Roy



On Tue, 2014-06-24 at 17:23 +0300, Andrei wrote:
> rabbitmq_management-2.7.1

-- 
Netzary InfoDynamics
"Making IT to Work for You"

website		: http://www.netzary.com
hand Phone	: +91 8088503811
telephone	: +91 80 41738665
fax		: +91 80 22075212


From simon at rabbitmq.com  Tue Jun 24 15:45:13 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jun 2014 15:45:13 +0100
Subject: [rabbitmq-discuss] rabbitmq-plugins not working
In-Reply-To: <1403620375.2647.11.camel@pdlaptop>
References: <1403619041.2647.8.camel@pdlaptop>
 <CANcm3vmE8e7u7vt_z8C-rUGHEhLq+XK+bFOtrtjfj4WP16UX4g@mail.gmail.com>
 <1403620375.2647.11.camel@pdlaptop>
Message-ID: <53A98EF9.2030503@rabbitmq.com>

On 24/06/2014 3:32PM, Priyadarsan Roy wrote:
> Hi Andy,
>
> It is not giving any output.  Just blanks.
>
> [root at us-s27 ~]# rabbitmq-plugins list rabbitmq_management-2.7.1
> [root at us-s27 ~]# rabbitmq-plugins list rabbitmq_management
> [root at us-s27 ~]# rabbitmq-plugins list rabbitmq_management-2.7.1.ez

rabbitmq-plugins list does not take any arguments, it should just print 
a list of plugins. But it looks like your plugins dir (as considered by 
rabbitmq-plugins) does not contain anything.

The RPM install should set this up for you - but I wonder if you have 
some messed up install somehow? Did you just install from RPM, nothing else?

And are you actually running 2.7.1? Is that what the logs say? 2.7.1 is 
very old. Did you install 2.7.1 today or has it been there for three years?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From kenneth.loafman at gmail.com  Tue Jun 24 16:26:14 2014
From: kenneth.loafman at gmail.com (Kenneth Loafman)
Date: Tue, 24 Jun 2014 08:26:14 -0700 (PDT)
Subject: [rabbitmq-discuss] New clustering format confusion
In-Reply-To: <21b3dc29-9f10-49ac-a954-b0b5ed1f7176@googlegroups.com>
References: <21b3dc29-9f10-49ac-a954-b0b5ed1f7176@googlegroups.com>
Message-ID: <0a963a96-d1da-4466-a470-f3cec837263f@googlegroups.com>

Could someone point me to a working, complete, cluster configuration?  I'd 
really appreciate it.

...Thanks,
...Ken

On Sunday, June 22, 2014 12:18:54 PM UTC-5, Kenneth Loafman wrote:
>
> Hi,
>
> I'm trying to set up rabbitmq.config to automatically cluster, however, an 
> error message shows up and startup fails.
>
> From the node forge-d1, I'm getting:
>
> Converting legacy 'cluster_nodes' configuration
>     [['rabbit at forge-m1','rabbit at forge-d2'],disc]
> to
>     {[['rabbit at forge-m1','rabbit at forge-d2'],disc],ram}.
>
> Please update the configuration to the new format {Nodes, NodeType}, where 
> Nodes contains the nodes that the node will try to cluster with, and 
> NodeType is either 'disc' or 'ram'
>
> As far as I can tell from the verbiage above, my config was in the correct 
> format.  It has Nodes == ['rabbit at forge-m1','rabbit at forge-d2'] and NodeType 
> == disc, which is correct.  forge-d1 is supposed to cluster with forge-m1 
> and forge-d2, the other two nodes in the cluster.  What's with the ",ram" 
> at the end?  forge-d1 is specified as a disc node in NodeType.  I'm getting 
> similar issues on the other configs:
>
> forge-m1:
>             {cluster_nodes, {
>                 [
>                 'rabbit at forge-d1','rabbit at forge-d2'
>                 ],
>                 ram
>             }}
>
> forge-d1:
>             {cluster_nodes, {
>                 [
>                 'rabbit at forge-m1','rabbit at forge-d2'
>                 ],
>                 disc
>             }}
>        ]}
>
> forge-d2:
>           {cluster_nodes, {
>                 [
>                 'rabbit at forge-m1','rabbit at forge-d1'
>                 ],
>                 disc
>             }}
>        ]}
>
> So, what's the error with the new format?  How should I correct this?
>
> ...Thanks,
> ...Ken
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/5d881aed/attachment.html>

From aaron at agoragames.com  Tue Jun 24 16:28:28 2014
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 24 Jun 2014 11:28:28 -0400
Subject: [rabbitmq-discuss] PPA debs restart rabbit
In-Reply-To: <etPan.53a4b803.643c9869.7a81@gmr-home.local>
References: <CAHiEoM5aurp4QxuDQ-+XbJ8W8HgMCDprNqQCzH8Cu_sv+3-SkA@mail.gmail.com>
 <53A46A19.4090108@rabbitmq.com>
 <etPan.53a4b803.643c9869.7a81@gmr-home.local>
Message-ID: <CAHiEoM5qk8u1O45a0PY5KW2J46qLqBUJiaiT5eR-4-yUQ+L1FQ@mail.gmail.com>

Yeah, that's what I'm getting at. Even "start on first install" has
problems in that there may be other preconditions yet to be set, though it
is less problematic than automatically restarting.

For now, I've changed our Salt states to freeze to a specific version so
that we won't be surprised by a process restart.


On Fri, Jun 20, 2014 at 6:38 PM, Gavin M. Roy <gavinmroy at gmail.com> wrote:

> I believe he's saying that when you install the deb (or upgrade it) it
> automatically starts or restarts rabbitmq-server, causing less than
> desirable behavior.
>
> From: Simon MacMullen simon at rabbitmq.com
> Reply: Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
> Date: June 20, 2014 at 1:07:33 PM
> To: Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com, Aaron
> Westendorf aaron at agoragames.com
> Subject:  Re: [rabbitmq-discuss] PPA debs restart rabbit
>
> On 17/06/14 15:54, Aaron Westendorf wrote:
> > We're using the PPA for rabbit but the current debian files are not
> > suitable for production deployments because they stop and restart the
> > process. I understand the desire to start the process if it was not
> > already running, but embedding the restart logic in the deb means that
> > users have no control over the process. As it is very common to use the
> > PPA within the context of a configuration management system (Salt, Chef,
> > etc), it would be best to leave that decision up to the user.
>
> What do you mean by "restart logic"?
>
> I could see the point in adding some START_THE_SERVER variable to
> /etc/default/rabbitmq-server, would that help?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Aaron Westendorf
Lead Engineer | Agora Games
aaron at agoragames.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/2a03944f/attachment.html>

From dburke at addictmud.org  Tue Jun 24 17:12:32 2014
From: dburke at addictmud.org (Daniel W. Burke)
Date: Tue, 24 Jun 2014 12:12:32 -0400
Subject: [rabbitmq-discuss] Fwd: Unable to create exchange / queue binding
In-Reply-To: <CAH8FpAS=9-EfpRn5=zo2XJr2O-bv1F03o6BwENe4e9PKF7BaOQ@mail.gmail.com>
References: <CAH8FpAShVezEfu=51r5XMy-Dw+G_zJZCuZ42ZkAgnWQD68T=Rw@mail.gmail.com>
 <53A15388.3000800@rabbitmq.com>
 <CAH8FpASsjkb=349WFm4mvmzZUmCeAD3aawyUVdXVyWh+Gef8uw@mail.gmail.com>
 <CAH8FpAS=9-EfpRn5=zo2XJr2O-bv1F03o6BwENe4e9PKF7BaOQ@mail.gmail.com>
Message-ID: <CAH8FpASHhk8CCQLPeGy-w7+b8otREJ5Pp20+e5OtNOSFPB7zOg@mail.gmail.com>

I just realized my last two messages went to Simon directly instead of to
the mailing list... my mistake...

---------- Forwarded message ----------
From: Daniel W. Burke <dburke at addictmud.org>
Date: Tue, Jun 24, 2014 at 12:10 PM
Subject: Re: [rabbitmq-discuss] Unable to create exchange / queue binding
To: Simon MacMullen <simon at rabbitmq.com>


We have this happening again in our dev environment.  This is alarming, as
we're going to go live with rabbitmq in production in two days (with four
clusters of three nodes each), and so far the only way we know to get past
it is to down the entire cluster.

Nothing is showing up in the logs for the error, so I don't have any
additional information to provide.  We'll leave it as-is for as long as
possible in the hopes that someone can provide some commands to help
troubleshoot, since its not currently preventing anyone from working.

Help!

Thanks,
Dan.



On Wed, Jun 18, 2014 at 6:13 AM, Daniel W. Burke <dburke at addictmud.org>
wrote:

> That does not seem like the case to me. All three nodes in the cluster had
> been up a few days, and queues are mirrored to all nodes in the cluster.
>
> Another potential item of note is that the nodes were restarted last to
> upgrade from 3.3.1 to 3.3.2.  They were restarted one at a time instead of
> bringing the whole cluster down.
>
> Also, logging seemed to have been stopped until the entire cluster was
> brought down to fix this error, but I see there's a related fix to that in
> 3.3.3 now.
>
> Dan.
>  On Jun 18, 2014 4:54 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>
>> On 17/06/2014 19:03, Daniel W. Burke wrote:
>>
>>> NOT_FOUND - no binding BINDING_NAME between exchange 'amq.direct' in
>>> vhost 'MYVHOST' and queue 'QUEUENAME' in vhost 'MYVHOST'
>>>
>>> This should be a binding that already exists, but for this queue it
>>> doesn't.  When trying to create it from the management UI we get the
>>> error (or from the http api)... if we change just one character in the
>>> routing key it works... that's not what we want, but it tells me there's
>>> something deeper wrong.
>>>
>>
>> This message means that you are trying to create an already known binding
>> to a queue whih is currently down (i.e. unmirrored and on a down node, or
>> mirrored but only to a ste of nodes all of which are down).
>>
>> Does that sound like what's happening?
>>
>> Cheers, Simon
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/162e07f3/attachment.html>

From simon at rabbitmq.com  Tue Jun 24 17:55:34 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jun 2014 17:55:34 +0100
Subject: [rabbitmq-discuss] New clustering format confusion
In-Reply-To: <0a963a96-d1da-4466-a470-f3cec837263f@googlegroups.com>
References: <21b3dc29-9f10-49ac-a954-b0b5ed1f7176@googlegroups.com>
 <0a963a96-d1da-4466-a470-f3cec837263f@googlegroups.com>
Message-ID: <53A9AD86.2020305@rabbitmq.com>

On 24/06/2014 4:26PM, Kenneth Loafman wrote:
> Could someone point me to a working, complete, cluster configuration?
>   I'd really appreciate it.

Did you see my response here?

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2014-June/036823.html

Also: there are some examples at 
http://www.rabbitmq.com/clustering.html#auto-config. Have you seen those?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jun 24 18:36:03 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jun 2014 18:36:03 +0100
Subject: [rabbitmq-discuss] Copy Messages across Virtual Hosts
In-Reply-To: <6bb1769f-ac0b-4e07-a18d-68e22abc363b@googlegroups.com>
References: <6bb1769f-ac0b-4e07-a18d-68e22abc363b@googlegroups.com>
Message-ID: <53A9B703.1030601@rabbitmq.com>

That would work. There isn't some special way to cross the barrier 
between virtual hosts, if that's what you were asking; you need shovel 
or federation. Or get all the apps to also access a fourth shared vhost.

Cheers, Simon

On 24/06/2014 12:41AM, W. Andrew Loe III wrote:
> I have 3 applications that communicate with the same RabbitMQ broker but
> are walled off from each other by virtual hosts. I have a special use
> case where I need to infrequently publish a message from one application
> to the other two. This worked in a previous design when all the
> application shared the same virtual host, I could have 3 queues and each
> app could message the 2 queues not associated with it. Ideally I'd like
> to have a shovel on a queue on each application virtual host and it
> would publish once to each other application, however I cannot seem to
> achieve this with the existing shovel options. Maybe I need to use a
> fanout/topic exchange with two shovels per virtual host, but this seems
> very complicated.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From cwstorm at gmail.com  Tue Jun 24 19:51:08 2014
From: cwstorm at gmail.com (cw storm)
Date: Tue, 24 Jun 2014 14:51:08 -0400
Subject: [rabbitmq-discuss] How close all open connections/channels
Message-ID: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>

Today, I have open connections/channels for consumers link to the queues.
 I'm manually closing the connections/channels via the RabbitMQ console.  I
would like to make this easier for our support folks so they don't have to
do this for each of the queues.  Just checking the community if anyone has
coded this on the client side to close the connections/channels for each of
the queue consumers.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/96204eb5/attachment.html>

From dburke at addictmud.org  Tue Jun 24 19:57:22 2014
From: dburke at addictmud.org (Daniel W. Burke)
Date: Tue, 24 Jun 2014 14:57:22 -0400
Subject: [rabbitmq-discuss] Unable to create exchange / queue binding
In-Reply-To: <CAH8FpASHhk8CCQLPeGy-w7+b8otREJ5Pp20+e5OtNOSFPB7zOg@mail.gmail.com>
References: <CAH8FpAShVezEfu=51r5XMy-Dw+G_zJZCuZ42ZkAgnWQD68T=Rw@mail.gmail.com>
 <53A15388.3000800@rabbitmq.com>
 <CAH8FpASsjkb=349WFm4mvmzZUmCeAD3aawyUVdXVyWh+Gef8uw@mail.gmail.com>
 <CAH8FpAS=9-EfpRn5=zo2XJr2O-bv1F03o6BwENe4e9PKF7BaOQ@mail.gmail.com>
 <CAH8FpASHhk8CCQLPeGy-w7+b8otREJ5Pp20+e5OtNOSFPB7zOg@mail.gmail.com>
Message-ID: <CAH8FpAS_45oT01whpASFUD3LxcJ1Qv3X83i1KuoztXkca_ejoQ@mail.gmail.com>

While experimenting, I just found that deleting the virtual host and
recreating it fixed the problem.

It's still not ideal in a production scenario :(  but I suppose its more
manageable than bringing down the whole cluster...


On Tue, Jun 24, 2014 at 12:12 PM, Daniel W. Burke <dburke at addictmud.org>
wrote:

> I just realized my last two messages went to Simon directly instead of to
> the mailing list... my mistake...
>
>
> ---------- Forwarded message ----------
> From: Daniel W. Burke <dburke at addictmud.org>
> Date: Tue, Jun 24, 2014 at 12:10 PM
> Subject: Re: [rabbitmq-discuss] Unable to create exchange / queue binding
> To: Simon MacMullen <simon at rabbitmq.com>
>
>
> We have this happening again in our dev environment.  This is alarming, as
> we're going to go live with rabbitmq in production in two days (with four
> clusters of three nodes each), and so far the only way we know to get past
> it is to down the entire cluster.
>
> Nothing is showing up in the logs for the error, so I don't have any
> additional information to provide.  We'll leave it as-is for as long as
> possible in the hopes that someone can provide some commands to help
> troubleshoot, since its not currently preventing anyone from working.
>
> Help!
>
> Thanks,
> Dan.
>
>
>
> On Wed, Jun 18, 2014 at 6:13 AM, Daniel W. Burke <dburke at addictmud.org>
> wrote:
>
>> That does not seem like the case to me. All three nodes in the cluster
>> had been up a few days, and queues are mirrored to all nodes in the cluster.
>>
>> Another potential item of note is that the nodes were restarted last to
>> upgrade from 3.3.1 to 3.3.2.  They were restarted one at a time instead of
>> bringing the whole cluster down.
>>
>> Also, logging seemed to have been stopped until the entire cluster was
>> brought down to fix this error, but I see there's a related fix to that in
>> 3.3.3 now.
>>
>> Dan.
>>  On Jun 18, 2014 4:54 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>>
>>> On 17/06/2014 19:03, Daniel W. Burke wrote:
>>>
>>>> NOT_FOUND - no binding BINDING_NAME between exchange 'amq.direct' in
>>>> vhost 'MYVHOST' and queue 'QUEUENAME' in vhost 'MYVHOST'
>>>>
>>>> This should be a binding that already exists, but for this queue it
>>>> doesn't.  When trying to create it from the management UI we get the
>>>> error (or from the http api)... if we change just one character in the
>>>> routing key it works... that's not what we want, but it tells me there's
>>>> something deeper wrong.
>>>>
>>>
>>> This message means that you are trying to create an already known
>>> binding to a queue whih is currently down (i.e. unmirrored and on a down
>>> node, or mirrored but only to a ste of nodes all of which are down).
>>>
>>> Does that sound like what's happening?
>>>
>>> Cheers, Simon
>>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/c732dc41/attachment.html>

From cwstorm at gmail.com  Tue Jun 24 20:26:33 2014
From: cwstorm at gmail.com (cw storm)
Date: Tue, 24 Jun 2014 15:26:33 -0400
Subject: [rabbitmq-discuss] How close all open connections/channels
In-Reply-To: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>
References: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>
Message-ID: <CAETr1H8XHNN5RY4nxQnu_nX-F202qsrq5N-3byi4L-uyPzaQvw@mail.gmail.com>

I suppose I could loop through each of the queue and issue
"channel.basicCancel" since I know the consumerTag.


On Tue, Jun 24, 2014 at 2:51 PM, cw storm <cwstorm at gmail.com> wrote:

> Today, I have open connections/channels for consumers link to the queues.
>  I'm manually closing the connections/channels via the RabbitMQ console.  I
> would like to make this easier for our support folks so they don't have to
> do this for each of the queues.  Just checking the community if anyone has
> coded this on the client side to close the connections/channels for each of
> the queue consumers.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/9adbaf41/attachment.html>

From prasadbchaure at gmail.com  Tue Jun 24 21:05:52 2014
From: prasadbchaure at gmail.com (prasadbchaure at gmail.com)
Date: Tue, 24 Jun 2014 15:05:52 -0500
Subject: [rabbitmq-discuss] You still haven't accepted
	prasadbchaure@gmail.com's friend request. Accept?
Message-ID: <0.0.158.C46.1CF8FE757AD9572.2834@mail6.info-emailer.com>

Hi,

prasadbchaure at gmail.com wants to follow you.

****** Is prasadbchaure at gmail.com you friend? ******
If Yes please follow the link below:
http://invites.info-emailer.com/signup_e.html?fullname=Prasadbchaure&amp;email=rabbitmq-discuss at lists.rabbitmq.com&amp;invitername=prasadbchaure at gmail.com&amp;inviterid=29269621&amp;userid=0&amp;token=0&amp;emailmasterid=da0ee217-4f3a-40ab-963f-8d1c66562abd&amp;from=prasadbchaure at gmail.com&src=txt_yes

If No please follow the link below:
http://invites.info-emailer.com/signup_e.html?fullname=Prasadbchaure&amp;email=rabbitmq-discuss at lists.rabbitmq.com&amp;invitername=prasadbchaure at gmail.com&amp;inviterid=29269621&amp;userid=0&amp;token=0&amp;emailmasterid=da0ee217-4f3a-40ab-963f-8d1c66562abd&amp;from=prasadbchaure at gmail.com&src=txt_no


Follow the link below to remove yourself from all such emails
http://invites.info-emailer.com/uns_inviter.jsp?email=rabbitmq-discuss at lists.rabbitmq.com&amp;iid=da0ee217-4f3a-40ab-963f-8d1c66562abd&amp;from=prasadbchaure at gmail.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/49cbb2ca/attachment.html>

From sean.joyce at patientco.com  Tue Jun 24 21:41:59 2014
From: sean.joyce at patientco.com (Sean Joyce)
Date: Tue, 24 Jun 2014 16:41:59 -0400
Subject: [rabbitmq-discuss] TTL on Consumers in PHP
Message-ID: <CAP1nU1Fspa9SK-xH+bjtYC9kEu0QawG5DRCc+r4nJMQwwouRmQ@mail.gmail.com>

I've got a pretty basic consumer running on an exchange that routes various
different messages to client-specific queues. To better manage resources,
I'd like for the consumers to expire after not receiving a message for a
period of time (low-usage clients).

I've been trying to figure out where to call basic_cancel in this code, but
not finding the right solution. Any tips on how to refactor and get what I
want?

  public function consume() {
    $callback = function($msg) {
      $pMsg = new ProcessorMessage();
      $pMsg->onMessage($msg->body);

$msg->delivery_info['channel']->basic_ack($msg->delivery_info['delivery_tag']);
    };

    $this->channel->basic_qos(null, 1, null);
    $this->channel->basic_consume($queue_name, '', false, false, false,
false, $callback);

    while(count($this->channel->callbacks)) {
        $this->channel->wait();
    }

  }

-- 
*Sean M. Joyce*
Director of Product Engineering | Patientco
sean.joyce at patientco.com
888.747.2455 x412


<http://info.patientco.com/himss>
<http://info.patientco.com/happy-providers>

-- 


As a friendly reminder, never send Protected Health Information (PHI) via 
email. 

 

CONFIDENTIALITY NOTICE:  The information contained in this email message 
may be privileged, confidential, and protected from disclosure. 
Any unauthorized use, printing, copying, disclosure, dissemination of or 
reliance upon this communication by persons other than the intended 
recipient may be subject to legal restriction or sanction. If you are not 
the intended recipient, you are hereby notified that you are not authorized 
to read, print, retain, copy, or disseminate this message, any part of it, 
or any attachments.  If you think that you have received this email 
message in error, please reply to the sender and delete this email and any 
attachments and all copies thereof from your system without reading the 
content and destroy any printouts of the e-mail or attachments promptly. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/b51f22ed/attachment.html>

From david at artisongs.com  Tue Jun 24 18:03:51 2014
From: david at artisongs.com (David Kent)
Date: Tue, 24 Jun 2014 10:03:51 -0700
Subject: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)
In-Reply-To: <etPan.53a97840.6b8b4567.1148c@mercurio.local>
References: <2108692889.14935.1403011307767.JavaMail.zimbra@0b10.mx>
 <1403611958898-36474.post@n5.nabble.com>
 <etPan.53a97840.6b8b4567.1148c@mercurio.local>
Message-ID: <eba88a13cc3f695d76b1521655f8ff46@mail.gmail.com>

Great, thanks! (It works, btw)

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com]
Sent: Tuesday, June 24, 2014 6:08 AM
To: dkent; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] rabbitmq-server won't run (3.3.3)

 On 24 June 2014 at 17:06:55, dkent (david at artisongs.com) wrote:
> > One way to fix this and still keep -e is to add " && :" to the end
> > of
> the
> call to ${ERL_DIR}erl on line 98 of rabbitmq-server. This is one of
> the operator expressions that will defeat errfail and the exit code
> will survive. This is how I have my script running now. I want to be
> able to set this inter-node port and keep my firewall ports grouped by
> value and consistent.

This and one more similar issue were fixed in 3.3.4.
--
MK

Staff Software Engineer, Pivotal/RabbitMQ

From dgalewsky at gmail.com  Tue Jun 24 22:44:07 2014
From: dgalewsky at gmail.com (Dan Galewsky)
Date: Tue, 24 Jun 2014 14:44:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Debugging problems with federation plug in.
Message-ID: <983f170d-6d60-4dd2-a03a-160b309f40f0@googlegroups.com>

We have a federation with 4 nodes. 

We are continually fighting problems with messages making it to some nodes 
in the exchange and not to others.

Current situation is that I can drop a message into the federated exchange 
and all three downstream nodes see my message.

Messages can be sent to me from two of the nodes but not the third.

They put a message into the federated exchange and the other two nodes see 
the message and my node does not.

Something I have noticed is that on the Queues tab - in the Parameters 
column of the Rabbit webapp - I see "D ARGS" for the nodes that can talk to 
me and only "D" on the node that is unable to talk to me.

And if I hover over the ARGS string in the UI - I get a hover label that 
says "x-internal-purpose: federation" which makes me think that somehow the 
other node and I are not federated (even though I can send them messages 
through the federated exchange).

So - I am stumped. 

We are running "RabbitMQ 3.3.3, Erlang R14B04" on Solaris. The other nodes 
are running various other operating systems and other versions of Rabbit 

Any debugging tips - most appreciated.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/12b41e36/attachment.html>

From senthil.kumarasamy at gmail.com  Wed Jun 25 00:37:03 2014
From: senthil.kumarasamy at gmail.com (senthil.kumarasamy at gmail.com)
Date: Tue, 24 Jun 2014 16:37:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Some messages are going to error queue directly
Message-ID: <5ba63a6a-2130-4215-97ff-52c6e788a0ca@googlegroups.com>

Hi,
I am seeing this problem on my local machine, where i send 20 or 30 
messages at a time and anywhere between 1-5 messages will go to error queue 
without going to consumer. 

I am not seeing anything unusual in RMQ log,  I am using RabbitMQ 3.3.3 and 
Masstransit version for 2.9.5 for client.

Thanks
Senthil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140624/5e948ce7/attachment.html>

From mklishin at gopivotal.com  Wed Jun 25 04:21:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 07:21:22 +0400
Subject: [rabbitmq-discuss] Some messages are going to error queue
 directly
In-Reply-To: <5ba63a6a-2130-4215-97ff-52c6e788a0ca@googlegroups.com>
References: <5ba63a6a-2130-4215-97ff-52c6e788a0ca@googlegroups.com>
Message-ID: <etPan.53aa404f.6b8b4567.143a2@mercurio.local>

On 25 June 2014 at 03:39:18, senthil.kumarasamy at gmail.com (senthil.kumarasamy at gmail.com) wrote:
> > I am seeing this problem on my local machine, where i send 20 or  
> 30 messages at a time and anywhere between 1-5 messages will go  
> to error queue without going to consumer.
>  
> I am not seeing anything unusual in RMQ log, I am using RabbitMQ  
> 3.3.3 and Masstransit version for 2.9.5 for client.

This is a MassTransit-specific question. RabbitMQ doesn't have a concept
of error queue (only dead-letter exchanges).

Please ask on their mailing list:
https://groups.google.com/forum/#!forum/masstransit-discuss?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 25 04:31:51 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 07:31:51 +0400
Subject: [rabbitmq-discuss] TTL on Consumers in PHP
In-Reply-To: <CAP1nU1Fspa9SK-xH+bjtYC9kEu0QawG5DRCc+r4nJMQwwouRmQ@mail.gmail.com>
References: <CAP1nU1Fspa9SK-xH+bjtYC9kEu0QawG5DRCc+r4nJMQwwouRmQ@mail.gmail.com>
Message-ID: <etPan.53aa42c0.66334873.143a2@mercurio.local>

On 25 June 2014 at 00:43:15, Sean Joyce (sean.joyce at patientco.com) wrote:
> > I've been trying to figure out where to call basic_cancel in  
> this code, but not finding the right solution. Any tips on how  
> to refactor and get what I want?
>  
> public function consume() {
> $callback = function($msg) {
> $pMsg = new ProcessorMessage();
> $pMsg->onMessage($msg->body);
> $msg->delivery_info['channel']->basic_ack($msg->delivery_info['delivery_tag']);  
> };
>  
> $this->channel->basic_qos(null, 1, null);
> $this->channel->basic_consume($queue_name, '', false,  
> false, false, false, $callback);
>  
> while(count($this->channel->callbacks)) {
> $this->channel->wait();
> }
>  
> }

Sean,

Take a look at the following 2 examples:

https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer_non_blocking.php
https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php#L52-54?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 25 04:35:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 07:35:22 +0400
Subject: [rabbitmq-discuss] How close all open connections/channels
In-Reply-To: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>
References: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>
Message-ID: <etPan.53aa4395.19495cff.143a2@mercurio.local>

On 24 June 2014 at 22:53:18, cw storm (cwstorm at gmail.com) wrote:
> > Today, I have open connections/channels for consumers link  
> to the queues. I'm manually closing the connections/channels  
> via the RabbitMQ console. I would like to make this easier for  
> our support folks so they don't have to do this for each of the queues.  
> Just checking the community if anyone has coded this on the client  
> side to close the connections/channels for each of the queue  
> consumers.

You can both list connections via HTTP API and close them. This is what
some client test suites do to test connection recovery:

https://github.com/ruby-amqp/bunny/blob/master/spec/higher_level_api/integration/connection_recovery_spec.rb#L9-13
https://github.com/michaelklishin/langohr/blob/master/test/langohr/test/recovery_test.clj#L39-41

See HTTP API docs for more info.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 25 04:46:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 07:46:38 +0400
Subject: [rabbitmq-discuss] How close all open connections/channels
In-Reply-To: <etPan.53aa4395.19495cff.143a2@mercurio.local>
References: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>
 <etPan.53aa4395.19495cff.143a2@mercurio.local>
Message-ID: <etPan.53aa463a.625558ec.143a2@mercurio.local>

?On 25 June 2014 at 07:37:06, Michael Klishin (mklishin at gopivotal.com) wrote:
> > You can both list connections via HTTP API and close them.

?as well as rabbitmqctl, of course.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Wed Jun 25 08:13:07 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jun 2014 08:13:07 +0100
Subject: [rabbitmq-discuss] Debugging problems with federation plug in.
In-Reply-To: <983f170d-6d60-4dd2-a03a-160b309f40f0@googlegroups.com>
References: <983f170d-6d60-4dd2-a03a-160b309f40f0@googlegroups.com>
Message-ID: <53AA7683.5080107@rabbitmq.com>

On 24/06/2014 22:44, Dan Galewsky wrote:
> We have a federation with 4 nodes.
>
> We are continually fighting problems with messages making it to some
> nodes in the exchange and not to others.
>
> Current situation is that I can drop a message into the federated
> exchange and all three downstream nodes see my message.
>
> Messages can be sent to me from two of the nodes but not the third.
>
> They put a message into the federated exchange and the other two nodes
> see the message and my node does not.

What does the link status at your end say? You should have a link for 
every (federated exchange, upstream) pair. Federation works on a pull 
model so your node is responsible for getting messages from the upstream.

http://www.rabbitmq.com/federation-reference.html#status

> Something I have noticed is that on the Queues tab - in the Parameters
> column of the Rabbit webapp - I see "D ARGS" for the nodes that can talk
> to me and only "D" on the node that is unable to talk to me.

The difference is one of version, recent versions of the federation 
plugin set x-internal-purpose: federation so you can identify 
federation-internal things. It should just mean that node is running an 
older RabbitMQ, it should still work.

> And if I hover over the ARGS string in the UI - I get a hover label that
> says "x-internal-purpose: federation" which makes me think that somehow
> the other node and I are not federated (even though I can send them
> messages through the federated exchange).

Note that each federation link is unidirectional, for bidirectional 
federation you have two links. So it can be working one way and broken 
the other.

Cheers, Simon

From ankur.ju at gmail.com  Wed Jun 25 09:20:21 2014
From: ankur.ju at gmail.com (ankur.ju at gmail.com)
Date: Wed, 25 Jun 2014 01:20:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
	version : 3.1.3
Message-ID: <36738173-3a52-42e6-81e4-49cc46db2439@googlegroups.com>

Hi ,

I am trying to enable the MQTT plugin in my rabbit mq(version 3.1.3) . When 
I check /usr/lib/rabbitmq/lib/rabbitmq_server-3.1.3/plugins directory I 
have found  rabbitmq_mqtt-3.1.3.ez , but when I restart the rabbitmq server 
I find the following message in the rabbitmq logs : 

=INFO REPORT==== 25-Jun-2014::12:57:48 ===
Error description:
   {could_not_start,rabbitmq_mqtt,{badmatch,{error,shutdown}}}

Please comment on this . I followed the same steps as mentioned in 
http://www.rabbitmq.com/blog/2012/09/12/mqtt-adapter/.

The only difference is the rabbitmq version . In the above link it is 
mentioned version rabbitmq-server 2.8.6 
<http://www.rabbitmq.com/download.html> but I am using 
rabbitmq_server-3.1.3.

Can any one please help me in this regard.

Thanks in advance.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/ac30e658/attachment.html>

From ranmizrachi at gmail.com  Wed Jun 25 10:14:13 2014
From: ranmizrachi at gmail.com (ran mizrachi)
Date: Wed, 25 Jun 2014 02:14:13 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ ** WARNING ** Mnesia is overloaded
Message-ID: <bf2e9427-2649-4174-a616-c123632beeb3@googlegroups.com>

RabbieMQ Cluster is not accepting new connections!
number of sockets connected are low, the only message in Rabbitmq log is : 
"** WARNING ** Mnesia is overloaded:" 

what does it means ? how can I solve it ?


please help asap.

Thanks,
Ran.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/296f0afb/attachment.html>

From ankur5.c at tcs.com  Wed Jun 25 10:16:25 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Wed, 25 Jun 2014 14:46:25 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
	version : 3.1.3.
Message-ID: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>

Hi ,

I am trying to enable the MQTT plugin in my rabbit mq(version 3.1.3) . 
When I check /usr/lib/rabbitmq/lib/rabbitmq_server-3.1.3/plugins directory 
I have found  rabbitmq_mqtt-3.1.3.ez , but when I restart the rabbitmq 
server I find the following message in the rabbitmq logs : 

=INFO REPORT==== 25-Jun-2014::12:57:48 ===
Error description:
   {could_not_start,rabbitmq_mqtt,{badmatch,{error,shutdown}}}

Please comment on this . I followed the same steps as mentioned in 
http://www.rabbitmq.com/blog/2012/09/12/mqtt-adapter/.

The only difference is the rabbitmq version . In the above link it is 
mentioned version rabbitmq-server 2.8.6 but I am using 
rabbitmq_server-3.1.3.

Can any one please help me in this regard.

Thanks in advance.

Thanks and Regards,
Ankur Chakraborty
Tata Consultancy Services
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/507ccb7e/attachment.html>

From mklishin at gopivotal.com  Wed Jun 25 10:52:58 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 13:52:58 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3
In-Reply-To: <36738173-3a52-42e6-81e4-49cc46db2439@googlegroups.com>
References: <36738173-3a52-42e6-81e4-49cc46db2439@googlegroups.com>
Message-ID: <etPan.53aa9c14.5bd062c2.143a2@mercurio.local>

?On 25 June 2014 at 13:50:28, ankur.ju at gmail.com (ankur.ju at gmail.com) wrote:
> ===
> Error description:
> {could_not_start,rabbitmq_mqtt,{badmatch,{error,shutdown}}}  
>  
> Please comment on this . I followed the same steps as mentioned  
> in http://www.rabbitmq.com/blog/2012/09/12/mqtt-adapter/.  
>  
> The only difference is the rabbitmq version . In the above link  
> it is mentioned version rabbitmq-server 2.8.6(http://www.rabbitmq.com/download.html)  
> but I am using rabbitmq_server-3.1.3.

I suspect you tried installing the 2.8.6 plugin into 3.1.3 version. That won't work.
There is no need to download the .ez file any more, simply enable the plugin
and restart RabbitMQ.

If you did download the 2.8.6 .ez file, remove it first. Then follow the docs:
http://www.rabbitmq.com/mqtt.html

Also, moving to 3.3.4 is not a bad idea ;)
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ranmizrachi at gmail.com  Wed Jun 25 10:53:33 2014
From: ranmizrachi at gmail.com (ran mizrachi)
Date: Wed, 25 Jun 2014 02:53:33 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ ** WARNING ** Mnesia is overloaded
Message-ID: <20d48e7d-4560-4d07-8c56-31235fd45683@googlegroups.com>

RabbieMQ Cluster is not accepting new connections!
number of sockets connected are low, the only message in Rabbitmq log is : 
** WARNING ** Mnesia is overloaded 

what does it means ? how can I solve it ?


please help asap.

Thanks,
Ran.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/9cf62cba/attachment.html>

From mklishin at gopivotal.com  Wed Jun 25 10:56:58 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 13:56:58 +0400
Subject: [rabbitmq-discuss] RabbitMQ ** WARNING ** Mnesia is overloaded
In-Reply-To: <bf2e9427-2649-4174-a616-c123632beeb3@googlegroups.com>
References: <bf2e9427-2649-4174-a616-c123632beeb3@googlegroups.com>
Message-ID: <etPan.53aa9d04.4db127f8.143a2@mercurio.local>

On 25 June 2014 at 13:52:26, ran mizrachi (ranmizrachi at gmail.com) wrote:
> > RabbieMQ Cluster is not accepting new connections!
> number of sockets connected are low, the only message in Rabbitmq  
> log is : "** WARNING ** Mnesia is overloaded:"
>  
> what does it means ? how can I solve it ?

I think the warning is a red herring. The real issue is that RabbitMQ is running
out of file descriptors (in which case it won't accept connections by design), presumably
because you have many connections to the node.

To verify, visit the Overview page in RabbitMQ management UI. How to increase the
number of available file descriptors:
see "Changing the limit" and subsequent sections on [1].

1.?http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 25 10:57:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 13:57:25 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
Message-ID: <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>

?On 25 June 2014 at 13:53:28, Ankur5 C (ankur5.c at tcs.com) wrote:
> > =INFO REPORT==== 25-Jun-2014(http://airmail.calendar/2014-06-25%2012:00:00%20GMT+4)::12:57:48  
> ===
> Error description:
> {could_not_start,rabbitmq_mqtt,{badmatch,{error,shutdown}}}  
>  
> Please comment on this . I followed the same steps as mentioned  
> in http://www.rabbitmq.com/blog/2012/09/12/mqtt-adapter/.  
>  
> The only difference is the rabbitmq version . In the above link  
> it is mentioned version rabbitmq-server 2.8.6(http://www.rabbitmq.com/download.html)  
> but I am using rabbitmq_server-3.1.3.

I suspect you tried installing the 2.8.6 plugin into 3.1.3 version. That won't work.?
There is no need to download the .ez file any more, simply enable the plugin?
and restart RabbitMQ.?

If you did download the 2.8.6 .ez file, remove it first. Then follow the docs:?
http://www.rabbitmq.com/mqtt.html?

Also, moving to 3.3.4 is not a bad idea ;)?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From robert.wysocki at unity.pl  Wed Jun 25 11:41:58 2014
From: robert.wysocki at unity.pl (Robert Wysocki)
Date: Wed, 25 Jun 2014 12:41:58 +0200
Subject: [rabbitmq-discuss] 3.3.4, web_stomp and ssl
Message-ID: <1403692918.7113.5.camel@s-rwysocki>

Hi there,

I'm having an issue which was discussed here before, but there was no
conclusive answer yet.
The problem is that after configuring ssl for web_stomp plugin in a
proper manner rabbitmq says in logs that it's listening on the
configured port but actually isn't listening. It listens though on
non-ssl port.

Had this issue before with 3.3.0, just upgraded to 3.3.4 and it's still
the same.

Any suggestions?

Regards,
-- 
Robert M. Wysocki
administrator system?w linuksowych, administrator baz danych
Grupa Unity | ul. Przedmiejska 6-10, 54-201 Wroc?aw
ul. Conrada 55B, 31-357 Krak?w | ul. Z?ota 59, 00-120 Warszawa




From mklishin at gopivotal.com  Wed Jun 25 11:44:43 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 14:44:43 +0400
Subject: [rabbitmq-discuss] 3.3.4, web_stomp and ssl
In-Reply-To: <1403692918.7113.5.camel@s-rwysocki>
References: <1403692918.7113.5.camel@s-rwysocki>
Message-ID: <etPan.53aaa835.66ef438d.143a2@mercurio.local>

On 25 June 2014 at 14:43:23, Robert Wysocki (robert.wysocki at unity.pl) wrote:
> > I'm having an issue which was discussed here before, but there  
> was no
> conclusive answer yet.
> The problem is that after configuring ssl for web_stomp plugin  
> in a
> proper manner rabbitmq says in logs that it's listening on the  
> configured port but actually isn't listening. It listens though  
> on
> non-ssl port.
>  
> Had this issue before with 3.3.0, just upgraded to 3.3.4 and it's  
> still
> the same.
>  
> Any suggestions?

Please post your config file.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From robert.wysocki at unity.pl  Wed Jun 25 11:55:49 2014
From: robert.wysocki at unity.pl (Robert Wysocki)
Date: Wed, 25 Jun 2014 12:55:49 +0200
Subject: [rabbitmq-discuss] 3.3.4, web_stomp and ssl
In-Reply-To: <etPan.53aaa835.66ef438d.143a2@mercurio.local>
References: <1403692918.7113.5.camel@s-rwysocki>
 <etPan.53aaa835.66ef438d.143a2@mercurio.local>
Message-ID: <1403693749.7113.10.camel@s-rwysocki>

Dnia 2014-06-25, ?ro o godzinie 14:44 +0400, Michael Klishin pisze:
> On 25 June 2014 at 14:43:23, Robert Wysocki (robert.wysocki at unity.pl) wrote:
> > > I'm having an issue which was discussed here before, but there  
> > was no
> > conclusive answer yet.
> > The problem is that after configuring ssl for web_stomp plugin  
> > in a
> > proper manner rabbitmq says in logs that it's listening on the  
> > configured port but actually isn't listening. It listens though  
> > on
> > non-ssl port.
> >  
> > Had this issue before with 3.3.0, just upgraded to 3.3.4 and it's  
> > still
> > the same.
> >  
> > Any suggestions?
> 
> Please post your config file. 

[
 {rabbit,
  [%%
   {tcp_listeners, [5672]},
   {reverse_dns_lookups, false},
   {auth_mechanisms, ['PLAIN', 'AMQPLAIN']},
   {default_vhost,       <<"/">>},
   {default_user,        <<"guest">>},
   {default_pass,        <<"guest">>},
   {default_permissions, [<<".*">>, <<".*">>, <<".*">>]},
   {default_user_tags, [administrator]},
   {loopback_users, []}
  ]},
 {kernel,
  [%% Sets the net_kernel tick time.
  ]},
 {rabbitmq_management,
  [%% Pre-Load schema definitions from the following JSON file. See
   {listener, [{port,     55672},
               {ip,       "ipaddr"},
               {ssl,      false}
                            ]}
  ]},
 {rabbitmq_management_agent,
  [%% Misc/Advanced Options
  ]},
 {rabbitmq_shovel,
  [{shovels,
    [%% A named shovel worker.
    ]}
  ]},
 {rabbitmq_stomp,
  [%% Network Configuration - the format is generally the same as for the broker
   {tcp_listeners, [{"ipaddr", 61613}
                    ]},
   {default_user, [{login,    "login"},
                   {passcode, "pass"}]}
  ]},
 {rabbitmq_mqtt,
  [%% Set the default user name and password. Will be used as the default login
  ]},
 {rabbitmq_amqp1_0,
  [%% Connections that are not authenticated with SASL will connect as this
  ]},
 {rabbitmq_auth_backend_ldap,
  [%%
  ]},
  {rabbitmq_web_stomp,
      [{ssl_config, [{port,       15671},
                     {backlog,    1024},
                     {certfile,   "/etc/ssl/certs/hostname.pl.pem"},
                     {keyfile,    "/etc/ssl/private/hostname.pl.key"},
                     {cacertfile, "/etc/ssl/certs/cacert.pem"}
                    ]
      }]
  }
].

-- 
Robert M. Wysocki
administrator system?w linuksowych, administrator baz danych
Grupa Unity | ul. Przedmiejska 6-10, 54-201 Wroc?aw
ul. Conrada 55B, 31-357 Krak?w | ul. Z?ota 59, 00-120 Warszawa




From huitrouge at googlemail.com  Wed Jun 25 12:51:25 2014
From: huitrouge at googlemail.com (Malte Hurrelmann)
Date: Wed, 25 Jun 2014 13:51:25 +0200
Subject: [rabbitmq-discuss] RabbitMQ sometimes does not show messages_ready
Message-ID: <1403697085.4502.13.camel@malte-VGN-CR21S-L>

Hi there,

I recently came across a strange behaviour when asking RabbitMQ (version
3.1.5) for the number of messages in each queue.

Normally it all works fine and the usual ways: 
- REST-api's key 'messages_ready'
- management-console's 'ready'-column and
- 'rabbitmqctl list_queues' 

all return the expected number of messages for each queue.
But every now and then this information is just missing for most of the
queues. It will return after some time by itself (I saw times up to one
hour, but it may be even more) but as I wrote some scripts that depend
on the REST-api, this behaviour is somewhat annoying.

Is this a known issue? I looked through the bugfix-sections of each
newer release but could not find an entry where this issue was fixed.

Best regards,
Malte.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screenshot from 2014-06-25 13:23:44.png
Type: image/png
Size: 52608 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/3291e1bb/attachment.png>

From simon at rabbitmq.com  Wed Jun 25 13:05:56 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jun 2014 13:05:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ sometimes does not show
	messages_ready
In-Reply-To: <1403697085.4502.13.camel@malte-VGN-CR21S-L>
References: <1403697085.4502.13.camel@malte-VGN-CR21S-L>
Message-ID: <53AABB24.4080001@rabbitmq.com>

Hmmm, that does sound like

25872 prevent empty queues from showing length as '?' after going idle
       (since 3.1.0)

from http://www.rabbitmq.com/release-notes/README-3.2.2.txt

...although it doesn't seem to be showing '?' in your case.

If it is that bug then the queues will stop showing lengths if they a) 
are empty and b) haven't done anything in an hour.

"anything" there is quite strictly defined - even replying to 
"rabbitmqctl list_queues" will wake them enough to untrigger the bug. So 
you could try that too.

Cheers, Simon

On 25/06/14 12:51, Malte Hurrelmann wrote:
> Hi there,
>
> I recently came across a strange behaviour when asking RabbitMQ (version
> 3.1.5) for the number of messages in each queue.
>
> Normally it all works fine and the usual ways:
> - REST-api's key 'messages_ready'
> - management-console's 'ready'-column and
> - 'rabbitmqctl list_queues'
>
> all return the expected number of messages for each queue.
> But every now and then this information is just missing for most of the
> queues. It will return after some time by itself (I saw times up to one
> hour, but it may be even more) but as I wrote some scripts that depend
> on the REST-api, this behaviour is somewhat annoying.
>
> Is this a known issue? I looked through the bugfix-sections of each
> newer release but could not find an entry where this issue was fixed.
>
> Best regards,
> Malte.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From huitrouge at googlemail.com  Wed Jun 25 13:17:34 2014
From: huitrouge at googlemail.com (Malte Hurrelmann)
Date: Wed, 25 Jun 2014 14:17:34 +0200
Subject: [rabbitmq-discuss] RabbitMQ sometimes does not show
 messages_ready
In-Reply-To: <53AABB24.4080001@rabbitmq.com>
References: <1403697085.4502.13.camel@malte-VGN-CR21S-L>
 <53AABB24.4080001@rabbitmq.com>
Message-ID: <1403698654.4502.19.camel@malte-VGN-CR21S-L>

The queues can in fact be idle for some time.
Ok, so I guess it's time for us to upgrade to a more recent version and
try again.

Thanks for the support.

Malte.

On Mi, 2014-06-25 at 13:05 +0100, Simon MacMullen wrote:
> Hmmm, that does sound like
> 
> 25872 prevent empty queues from showing length as '?' after going idle
>        (since 3.1.0)
> 
> from http://www.rabbitmq.com/release-notes/README-3.2.2.txt
> 
> ...although it doesn't seem to be showing '?' in your case.
> 
> If it is that bug then the queues will stop showing lengths if they a) 
> are empty and b) haven't done anything in an hour.
> 
> "anything" there is quite strictly defined - even replying to 
> "rabbitmqctl list_queues" will wake them enough to untrigger the bug. So 
> you could try that too.
> 
> Cheers, Simon
> 
> On 25/06/14 12:51, Malte Hurrelmann wrote:
> > Hi there,
> >
> > I recently came across a strange behaviour when asking RabbitMQ (version
> > 3.1.5) for the number of messages in each queue.
> >
> > Normally it all works fine and the usual ways:
> > - REST-api's key 'messages_ready'
> > - management-console's 'ready'-column and
> > - 'rabbitmqctl list_queues'
> >
> > all return the expected number of messages for each queue.
> > But every now and then this information is just missing for most of the
> > queues. It will return after some time by itself (I saw times up to one
> > hour, but it may be even more) but as I wrote some scripts that depend
> > on the REST-api, this behaviour is somewhat annoying.
> >
> > Is this a known issue? I looked through the bugfix-sections of each
> > newer release but could not find an entry where this issue was fixed.
> >
> > Best regards,
> > Malte.
> >
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> 
> 



From sean.joyce at patientco.com  Wed Jun 25 14:16:47 2014
From: sean.joyce at patientco.com (Sean Joyce)
Date: Wed, 25 Jun 2014 09:16:47 -0400
Subject: [rabbitmq-discuss] TTL on Consumers in PHP
In-Reply-To: <etPan.53aa42c0.66334873.143a2@mercurio.local>
References: <CAP1nU1Fspa9SK-xH+bjtYC9kEu0QawG5DRCc+r4nJMQwwouRmQ@mail.gmail.com>
 <etPan.53aa42c0.66334873.143a2@mercurio.local>
Message-ID: <CAP1nU1E9ZjtV=W18A3EVFOJaBCJmYr+TO6iv0q4b7uhhnKz+mA@mail.gmail.com>

Michael -

Apologies for asking you to be pedantic, but I'm still a little hazy on how
I would implement my desired behavior.

I actually have the 'quit' functionality embedded in my callback, though I
stripped it out for my example for simplicity. With or without though, when
I run my consumer, my code hits the '$this->channel->wait();' line and
doesn't exit until an external event (new message) enters the queue. My
preference is that a Consumer itself knows when it has sat idle long enough
to terminate itself rather than having an external process monitor it.

Should this be done by subclassing AMQPChannel? Like I said, I'm still a
little hazy.

-Sean


On Tue, Jun 24, 2014 at 11:31 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 25 June 2014 at 00:43:15, Sean Joyce (sean.joyce at patientco.com) wrote:
> > > I've been trying to figure out where to call basic_cancel in
> > this code, but not finding the right solution. Any tips on how
> > to refactor and get what I want?
> >
> > public function consume() {
> > $callback = function($msg) {
> > $pMsg = new ProcessorMessage();
> > $pMsg->onMessage($msg->body);
> >
> $msg->delivery_info['channel']->basic_ack($msg->delivery_info['delivery_tag']);
> > };
> >
> > $this->channel->basic_qos(null, 1, null);
> > $this->channel->basic_consume($queue_name, '', false,
> > false, false, false, $callback);
> >
> > while(count($this->channel->callbacks)) {
> > $this->channel->wait();
> > }
> >
> > }
>
> Sean,
>
> Take a look at the following 2 examples:
>
>
> https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer_non_blocking.php
>
> https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php#L52-54
>
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>



-- 
*Sean M. Joyce*
Director of Product Engineering | Patientco
sean.joyce at patientco.com
888.747.2455 x412


<http://info.patientco.com/himss>
<http://info.patientco.com/happy-providers>

-- 


As a friendly reminder, never send Protected Health Information (PHI) via 
email. 

 

CONFIDENTIALITY NOTICE:  The information contained in this email message 
may be privileged, confidential, and protected from disclosure. 
Any unauthorized use, printing, copying, disclosure, dissemination of or 
reliance upon this communication by persons other than the intended 
recipient may be subject to legal restriction or sanction. If you are not 
the intended recipient, you are hereby notified that you are not authorized 
to read, print, retain, copy, or disseminate this message, any part of it, 
or any attachments.  If you think that you have received this email 
message in error, please reply to the sender and delete this email and any 
attachments and all copies thereof from your system without reading the 
content and destroy any printouts of the e-mail or attachments promptly. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/0989aedc/attachment.html>

From huitrouge at googlemail.com  Wed Jun 25 15:23:58 2014
From: huitrouge at googlemail.com (Malte Hurrelmann)
Date: Wed, 25 Jun 2014 16:23:58 +0200
Subject: [rabbitmq-discuss] RabbitMQ sometimes does not show
 messages_ready
In-Reply-To: <1403698654.4502.19.camel@malte-VGN-CR21S-L>
References: <1403697085.4502.13.camel@malte-VGN-CR21S-L>
 <53AABB24.4080001@rabbitmq.com>
 <1403698654.4502.19.camel@malte-VGN-CR21S-L>
Message-ID: <1403706238.4502.22.camel@malte-VGN-CR21S-L>

Just to let you know: it IS that bug, 'rabbitmqctl list_queues' will
indeed "fix" it.
We will now prepare for version upgrade.

Greetings,
Malte.

On Mi, 2014-06-25 at 14:17 +0200, Malte Hurrelmann wrote:
> The queues can in fact be idle for some time.
> Ok, so I guess it's time for us to upgrade to a more recent version and
> try again.
> 
> Thanks for the support.
> 
> Malte.
> 
> On Mi, 2014-06-25 at 13:05 +0100, Simon MacMullen wrote:
> > Hmmm, that does sound like
> > 
> > 25872 prevent empty queues from showing length as '?' after going idle
> >        (since 3.1.0)
> > 
> > from http://www.rabbitmq.com/release-notes/README-3.2.2.txt
> > 
> > ...although it doesn't seem to be showing '?' in your case.
> > 
> > If it is that bug then the queues will stop showing lengths if they a) 
> > are empty and b) haven't done anything in an hour.
> > 
> > "anything" there is quite strictly defined - even replying to 
> > "rabbitmqctl list_queues" will wake them enough to untrigger the bug. So 
> > you could try that too.
> > 
> > Cheers, Simon
> > 
> > On 25/06/14 12:51, Malte Hurrelmann wrote:
> > > Hi there,
> > >
> > > I recently came across a strange behaviour when asking RabbitMQ (version
> > > 3.1.5) for the number of messages in each queue.
> > >
> > > Normally it all works fine and the usual ways:
> > > - REST-api's key 'messages_ready'
> > > - management-console's 'ready'-column and
> > > - 'rabbitmqctl list_queues'
> > >
> > > all return the expected number of messages for each queue.
> > > But every now and then this information is just missing for most of the
> > > queues. It will return after some time by itself (I saw times up to one
> > > hour, but it may be even more) but as I wrote some scripts that depend
> > > on the REST-api, this behaviour is somewhat annoying.
> > >
> > > Is this a known issue? I looked through the bugfix-sections of each
> > > newer release but could not find an entry where this issue was fixed.
> > >
> > > Best regards,
> > > Malte.
> > >
> > >
> > >
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > 
> > 
> 
> 



From mklishin at gopivotal.com  Wed Jun 25 15:25:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 18:25:38 +0400
Subject: [rabbitmq-discuss] ANN RabbitMQ mailing list is moving to Google
	Groups
Message-ID: <etPan.53aadc00.327b23c6.ac56@mercurio.local>

On behalf of the RabbitMQ team, I'd like to ask all rabbitmq-discuss
members to join our new mailing list: rabbitmq-users

https://groups.google.com/forum/#!forum/rabbitmq-users

Why the move? It's been increasingly obvious that many of our users
expect the rabbitmq-discuss Google group to be the primary list and
not a mirror. It's easier to Google, easier to use for some, and
will relieve our tiny team from having to host and maintain mailing list
software.

Now, you may wonder why we did not just announce the rabbitmq-discuss
Google group to be the new official list. That would be the most natural
thing to do but unfortunately, none of the RabbitMQ team members are owners
of that list. It was created by someone many years ago and Google won't let
us own it. So we had to create the new group.

For the next few months, any questions that are posted to the existing list
will be answered as usual. However, we will ask people to post all the new questions
to the new list. If you find this list useful and care about RabbitMQ, please
join?https://groups.google.com/forum/#!forum/rabbitmq-users as soon as you
have a moment, and post your future questions/issue reports/announcements
there.

Thank you.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From marco.varagnolo at gmail.com  Wed Jun 25 13:56:46 2014
From: marco.varagnolo at gmail.com (Marco Varagnolo)
Date: Wed, 25 Jun 2014 05:56:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ ** WARNING ** Mnesia is overloaded
In-Reply-To: <20d48e7d-4560-4d07-8c56-31235fd45683@googlegroups.com>
References: <20d48e7d-4560-4d07-8c56-31235fd45683@googlegroups.com>
Message-ID: <503e0d8f-2b02-4fd3-ab7e-9203401d3e8a@googlegroups.com>

Hi Ran,

         you can try:

   - use sync transaction
      - increase dump_log_write_threshold (rabbitmq.config)
   
         but how many write at once?

         

         regards, Marco       

Il giorno mercoled? 25 giugno 2014 11:53:34 UTC+2, ran mizrachi ha scritto:
>
> RabbieMQ Cluster is not accepting new connections!
> number of sockets connected are low, the only message in Rabbitmq log is : 
> ** WARNING ** Mnesia is overloaded 
>
> what does it means ? how can I solve it ?
>
>
> please help asap.
>
> Thanks,
> Ran.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/67985d69/attachment.html>

From videlalvaro at gmail.com  Wed Jun 25 15:52:46 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 25 Jun 2014 16:52:46 +0200
Subject: [rabbitmq-discuss] TTL on Consumers in PHP
In-Reply-To: <CAP1nU1E9ZjtV=W18A3EVFOJaBCJmYr+TO6iv0q4b7uhhnKz+mA@mail.gmail.com>
References: <CAP1nU1Fspa9SK-xH+bjtYC9kEu0QawG5DRCc+r4nJMQwwouRmQ@mail.gmail.com>
 <etPan.53aa42c0.66334873.143a2@mercurio.local>
 <CAP1nU1E9ZjtV=W18A3EVFOJaBCJmYr+TO6iv0q4b7uhhnKz+mA@mail.gmail.com>
Message-ID: <CAMcAHLWH4On4YWL9cWAMD3veQ-RCcLuJHrbjoj8b=nZVRNGvUw@mail.gmail.com>

Hi Sean,

As you probably know, the code in the php library is blocking, so unless an
external event comes, there's no way to escape form the while loop that's
reading from the channel. The wait method supports a timeout tho.

Regards,

Alvaro




On Wed, Jun 25, 2014 at 3:16 PM, Sean Joyce <sean.joyce at patientco.com>
wrote:

> Michael -
>
> Apologies for asking you to be pedantic, but I'm still a little hazy on
> how I would implement my desired behavior.
>
> I actually have the 'quit' functionality embedded in my callback, though I
> stripped it out for my example for simplicity. With or without though, when
> I run my consumer, my code hits the '$this->channel->wait();' line and
> doesn't exit until an external event (new message) enters the queue. My
> preference is that a Consumer itself knows when it has sat idle long enough
> to terminate itself rather than having an external process monitor it.
>
> Should this be done by subclassing AMQPChannel? Like I said, I'm still a
> little hazy.
>
> -Sean
>
>
> On Tue, Jun 24, 2014 at 11:31 PM, Michael Klishin <mklishin at gopivotal.com>
> wrote:
>
>> On 25 June 2014 at 00:43:15, Sean Joyce (sean.joyce at patientco.com) wrote:
>> > > I've been trying to figure out where to call basic_cancel in
>> > this code, but not finding the right solution. Any tips on how
>> > to refactor and get what I want?
>> >
>> > public function consume() {
>> > $callback = function($msg) {
>> > $pMsg = new ProcessorMessage();
>> > $pMsg->onMessage($msg->body);
>> >
>> $msg->delivery_info['channel']->basic_ack($msg->delivery_info['delivery_tag']);
>> > };
>> >
>> > $this->channel->basic_qos(null, 1, null);
>> > $this->channel->basic_consume($queue_name, '', false,
>> > false, false, false, $callback);
>> >
>> > while(count($this->channel->callbacks)) {
>> > $this->channel->wait();
>> > }
>> >
>> > }
>>
>> Sean,
>>
>> Take a look at the following 2 examples:
>>
>>
>> https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer_non_blocking.php
>>
>> https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php#L52-54
>>
>> --
>> MK
>>
>> Staff Software Engineer, Pivotal/RabbitMQ
>>
>
>
>
> --
> *Sean M. Joyce*
> Director of Product Engineering | Patientco
> sean.joyce at patientco.com
> 888.747.2455 x412
>
>
> <http://info.patientco.com/himss>
> <http://info.patientco.com/happy-providers>
>
> As a friendly reminder, never send Protected Health Information (PHI) via
> email.
>
>
>
> CONFIDENTIALITY NOTICE:  The information contained in this email message
> may be privileged, confidential, and protected from disclosure.
> Any unauthorized use, printing, copying, disclosure, dissemination of or
> reliance upon this communication by persons other than the intended
> recipient may be subject to legal restriction or sanction. If you are not
> the intended recipient, you are hereby notified that you are not authorized
> to read, print, retain, copy, or disseminate this message, any part of it,
> or any attachments.  If you think that you have received this email
> message in error, please reply to the sender and delete this email and
> any attachments and all copies thereof from your system without reading the
> content and destroy any printouts of the e-mail or attachments promptly.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/c122ee5e/attachment.html>

From el.spectrumero at gmail.com  Wed Jun 25 16:51:23 2014
From: el.spectrumero at gmail.com (Dylan Smith)
Date: Wed, 25 Jun 2014 08:51:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't send payloads above 80kB to a RabbitMQ
	server ?
In-Reply-To: <e3149223-a940-479f-9979-0072a4dfe6af@googlegroups.com>
References: <e3149223-a940-479f-9979-0072a4dfe6af@googlegroups.com>
Message-ID: <6a319623-573f-462e-9b62-e94ef61e9045@googlegroups.com>

El s?bado, 12 de abril de 2014 04:13:47 UTC+1, Maxime Montinet escribi?:
>
> Hi,
>
> I'm trying to send base64 encoded chunks of data through a RabbitMQ 
> server, from a Python client.
>
> It goes perfectly fine for payloads in the 1 to ~80kB range, but anything 
> above that and I get a connection reset, with an error saying Resource 
> temporarily unavailable.
>
>
I've sent multi-hundred-megabyte messages without any problems. Perhaps 
it's worth trying a different client (e.g. Java) to see if it's not a 
problem you're having with the python client. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/6d2db8ea/attachment.html>

From ed.tramell at gmail.com  Wed Jun 25 17:28:42 2014
From: ed.tramell at gmail.com (ed.tramell at gmail.com)
Date: Wed, 25 Jun 2014 09:28:42 -0700 (PDT)
Subject: [rabbitmq-discuss] TUTORIAL FEEDBACK: Queue binding could use a
 little more clarification?
Message-ID: <900b0de2-66c0-4d1b-baad-f67b842fd7ce@googlegroups.com>

Hi,

First, my point of view:  I am a complete message queuing noob.  Others in 
my organization have worked with RabbitMQ before, but they have moved on 
and I have inherited their work.

I found the tutorials (e.g. 
http://www.rabbitmq.com/tutorials/tutorial-four-java.html) to be a 
tremendous help.  However, as a noob, I found myself very confused about 
queue binding.  The examples (like orange/black/green) made sense 
logically, but I wasted (er, invested) a lot of time trying to understand 
how one would bind an exchange to a queue with a routing key *from the 
producer side*.  Eventually, the light bulb came on for me and now it is 
obvious to me that the binding happens on the consumer side, not the 
producer side (duh!).  But at the time, the diagrams seemed to show the 
bindings on the producer side, so that's where I kept thinking they'd get 
created.  And of course, that made no sense.

I'm not sure exactly how you could prevent this mental block for others in 
the future.  One possibility is to add a subtle clue to your images:  just 
a simple vertical dotted line just to the right of the dark blue exchange 
oval (see attached example).  It's hard to know now that I understand it, 
but that subtle separation might have been enough to make it more 
immediately obvious for me.  Or maybe just a sentence somewhere like, 
"Binding happens on the consumer side, not the producer side" somewhere 
prominent (maybe you already say that somewhere, but if so, I missed it).

Maybe I'm the only one that was tripped up by this, but maybe not.  Just 
some feedback for you.

Thanks,
Ed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/e490c135/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: direct-exchange.png
Type: image/png
Size: 10386 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/e490c135/attachment.png>

From mklishin at gopivotal.com  Wed Jun 25 18:13:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 21:13:25 +0400
Subject: [rabbitmq-discuss] Can't send payloads above 80kB to a RabbitMQ
 server ?
In-Reply-To: <6a319623-573f-462e-9b62-e94ef61e9045@googlegroups.com>
References: <e3149223-a940-479f-9979-0072a4dfe6af@googlegroups.com>
 <6a319623-573f-462e-9b62-e94ef61e9045@googlegroups.com>
Message-ID: <etPan.53ab034f.6b8b4567.b4e5@mercurio.local>

On 25 June 2014 at 21:11:24, Dylan Smith (el.spectrumero at gmail.com) wrote:
> > I've sent multi-hundred-megabyte messages without any problems.  
> Perhaps it's worth trying a different client (e.g. Java) to see  
> if it's not a problem you're having with the python client.

Or that you are not hitting flow control due to RAM watermark.

By the way, RabbitMQ mailing list has a new home:
https://groups.google.com/group/rabbitmq-users

Please post your future questions and bug reports there :)?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jun 25 18:17:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 25 Jun 2014 21:17:54 +0400
Subject: [rabbitmq-discuss] TUTORIAL FEEDBACK: Queue binding could use a
 little more clarification?
In-Reply-To: <900b0de2-66c0-4d1b-baad-f67b842fd7ce@googlegroups.com>
References: <900b0de2-66c0-4d1b-baad-f67b842fd7ce@googlegroups.com>
Message-ID: <etPan.53ab045e.66334873.b4e5@mercurio.local>

On 25 June 2014 at 21:13:28, ed.tramell at gmail.com (ed.tramell at gmail.com) wrote:
> > I'm not sure exactly how you could prevent this mental block  
> for others in the future. One possibility is to add a subtle clue  
> to your images: just a simple vertical dotted line just to the  
> right of the dark blue exchange oval (see attached example).  
> It's hard to know now that I understand it, but that subtle separation  
> might have been enough to make it more immediately obvious for  
> me. Or maybe just a sentence somewhere like, "Binding happens  
> on the consumer side, not the producer side" somewhere prominent  
> (maybe you already say that somewhere, but if so, I missed it).  

We have a similar image on
http://www.rabbitmq.com/tutorials/amqp-concepts.html

I honestly don't think it will make it any clearer w.r.t. bindings.
Also, technically it's not necessary that a consumer does the binding.
Any app can do it, it's just that the code that consumes messages has more
information about queues. We may mention that it is more common for
consuming services to do the binding.?

By the way, RabbitMQ mailing list has a new home:
https://groups.google.com/group/rabbitmq-users

Please post your future questions and bug reports there :)
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From aaron at agoragames.com  Wed Jun 25 19:23:38 2014
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 25 Jun 2014 14:23:38 -0400
Subject: [rabbitmq-discuss] PPA debs restart rabbit
In-Reply-To: <CAHiEoM5qk8u1O45a0PY5KW2J46qLqBUJiaiT5eR-4-yUQ+L1FQ@mail.gmail.com>
References: <CAHiEoM5aurp4QxuDQ-+XbJ8W8HgMCDprNqQCzH8Cu_sv+3-SkA@mail.gmail.com>
 <53A46A19.4090108@rabbitmq.com>
 <etPan.53a4b803.643c9869.7a81@gmr-home.local>
 <CAHiEoM5qk8u1O45a0PY5KW2J46qLqBUJiaiT5eR-4-yUQ+L1FQ@mail.gmail.com>
Message-ID: <CAHiEoM5aCMB7KckR3dB+De78TKN2mZ-vs2w6Vo=x23+Rwm5u1g@mail.gmail.com>

We just discovered today that this is further complicated because the PPA
is only hosting the current version, so Salt fails when trying to apply the
ruleset and ensure the version we froze is installed.


On Tue, Jun 24, 2014 at 11:28 AM, Aaron Westendorf <aaron at agoragames.com>
wrote:

> Yeah, that's what I'm getting at. Even "start on first install" has
> problems in that there may be other preconditions yet to be set, though it
> is less problematic than automatically restarting.
>
> For now, I've changed our Salt states to freeze to a specific version so
> that we won't be surprised by a process restart.
>
>
> On Fri, Jun 20, 2014 at 6:38 PM, Gavin M. Roy <gavinmroy at gmail.com> wrote:
>
>> I believe he's saying that when you install the deb (or upgrade it) it
>> automatically starts or restarts rabbitmq-server, causing less than
>> desirable behavior.
>>
>> From: Simon MacMullen simon at rabbitmq.com
>> Reply: Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
>> Date: June 20, 2014 at 1:07:33 PM
>> To: Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com, Aaron
>> Westendorf aaron at agoragames.com
>> Subject:  Re: [rabbitmq-discuss] PPA debs restart rabbit
>>
>> On 17/06/14 15:54, Aaron Westendorf wrote:
>> > We're using the PPA for rabbit but the current debian files are not
>> > suitable for production deployments because they stop and restart the
>> > process. I understand the desire to start the process if it was not
>> > already running, but embedding the restart logic in the deb means that
>> > users have no control over the process. As it is very common to use the
>> > PPA within the context of a configuration management system (Salt,
>> Chef,
>> > etc), it would be best to leave that decision up to the user.
>>
>> What do you mean by "restart logic"?
>>
>> I could see the point in adding some START_THE_SERVER variable to
>> /etc/default/rabbitmq-server, would that help?
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Aaron Westendorf
> Lead Engineer | Agora Games
> aaron at agoragames.com
>



-- 
Aaron Westendorf
Lead Engineer | Agora Games
aaron at agoragames.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/2fd6f85e/attachment.html>

From cwstorm at gmail.com  Wed Jun 25 20:25:02 2014
From: cwstorm at gmail.com (cw storm)
Date: Wed, 25 Jun 2014 15:25:02 -0400
Subject: [rabbitmq-discuss] How close all open connections/channels
In-Reply-To: <etPan.53aa463a.625558ec.143a2@mercurio.local>
References: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>
 <etPan.53aa4395.19495cff.143a2@mercurio.local>
 <etPan.53aa463a.625558ec.143a2@mercurio.local>
Message-ID: <CAETr1H9dUWY5bm7=mgzPs30ahJXhfq6eZM9emt4dn3P3EGnZdw@mail.gmail.com>

I was hoping to use "channel.basicCancel" but that's not going to work
since I'm establishing a new conn/channel.

So, I guess I have to fully rely on the HTTP API method in order to easily
close all connections that I'm interested in?  The goal is to provide
operation support to easily close all connections/channels for a mask of
consumers.  Today, he/she uses the rabbitmq console to force the close
connection.


On Tue, Jun 24, 2014 at 11:46 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 25 June 2014 at 07:37:06, Michael Klishin (mklishin at gopivotal.com)
> wrote:
> > > You can both list connections via HTTP API and close them.
>
> ?as well as rabbitmqctl, of course.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/123ae9cc/attachment.html>

From cwstorm at gmail.com  Wed Jun 25 21:11:46 2014
From: cwstorm at gmail.com (cw storm)
Date: Wed, 25 Jun 2014 16:11:46 -0400
Subject: [rabbitmq-discuss] How close all open connections/channels
In-Reply-To: <CAETr1H9dUWY5bm7=mgzPs30ahJXhfq6eZM9emt4dn3P3EGnZdw@mail.gmail.com>
References: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>
 <etPan.53aa4395.19495cff.143a2@mercurio.local>
 <etPan.53aa463a.625558ec.143a2@mercurio.local>
 <CAETr1H9dUWY5bm7=mgzPs30ahJXhfq6eZM9emt4dn3P3EGnZdw@mail.gmail.com>
Message-ID: <CAETr1H8YcAO1RHQjXzoGCnXYYavnc7YHQpTXLmZ1_eyyzS4iCw@mail.gmail.com>

I'm considering of using rabbitmqctl to close connections based on certain
consumerTags.  Is this possible?


On Wed, Jun 25, 2014 at 3:25 PM, cw storm <cwstorm at gmail.com> wrote:

> I was hoping to use "channel.basicCancel" but that's not going to work
> since I'm establishing a new conn/channel.
>
> So, I guess I have to fully rely on the HTTP API method in order to easily
> close all connections that I'm interested in?  The goal is to provide
> operation support to easily close all connections/channels for a mask of
> consumers.  Today, he/she uses the rabbitmq console to force the close
> connection.
>
>
> On Tue, Jun 24, 2014 at 11:46 PM, Michael Klishin <mklishin at gopivotal.com>
> wrote:
>
>>  On 25 June 2014 at 07:37:06, Michael Klishin (mklishin at gopivotal.com)
>> wrote:
>> > > You can both list connections via HTTP API and close them.
>>
>> ?as well as rabbitmqctl, of course.
>> --
>> MK
>>
>> Staff Software Engineer, Pivotal/RabbitMQ
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/5028442e/attachment.html>

From mklishin at gopivotal.com  Thu Jun 26 04:41:06 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 26 Jun 2014 07:41:06 +0400
Subject: [rabbitmq-discuss] How close all open connections/channels
In-Reply-To: <CAETr1H9dUWY5bm7=mgzPs30ahJXhfq6eZM9emt4dn3P3EGnZdw@mail.gmail.com>
References: <CAETr1H87X2fPqrU_paTSzS20+5oph9MzTGN1a7kQr17nE-d1Ug@mail.gmail.com>
 <etPan.53aa4395.19495cff.143a2@mercurio.local>
 <etPan.53aa463a.625558ec.143a2@mercurio.local>
 <CAETr1H9dUWY5bm7=mgzPs30ahJXhfq6eZM9emt4dn3P3EGnZdw@mail.gmail.com>
Message-ID: <etPan.53ab9670.6b8b4567.e951@mercurio.local>

On 25 June 2014 at 23:27:17, cw storm (cwstorm at gmail.com) wrote:
> > I was hoping to use "channel.basicCancel" but that's not going 
> to work since I'm establishing a new conn/channel.

Sorry, why do you expect basic.cancel to close connections? It cancels
consumers (terminates subscriptions, if you will) and does not affect
connections in any way.

> So, I guess I have to fully rely on the HTTP API method in order to 
> easily close all connections that I'm interested in? The goal 
> is to provide operation support to easily close all connections/channels 
> for a mask of consumers. Today, he/she uses the rabbitmq console 
> to force the close connection.

HTTP API was created for the cases like yours. rabbitmqctl can work just as well
but I find parsing standard output to be a more fragile solution than parsing a JSON response.

By the way, RabbitMQ mailing list has a new home:
https://groups.google.com/group/rabbitmq-users

Please post your future questions and bug reports there :)
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From ye.wang.at.bookspan at gmail.com  Wed Jun 25 23:09:57 2014
From: ye.wang.at.bookspan at gmail.com (Ye Wang)
Date: Wed, 25 Jun 2014 15:09:57 -0700 (PDT)
Subject: [rabbitmq-discuss] How to configure exchange + queue so that
 messages get removed after the last consumer retrieves the message.
Message-ID: <fa2ffa69-094e-4ec2-b41e-03ddfe2d7529@googlegroups.com>

I am a newbie to RabbitMQ and AMQP protocol. Is that that even possible? I 
noticed that there is a message TTL I can play with but if the message can 
be removed in the queue when all the consumers retrieved the message, that 
will be great. Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/9fc69e39/attachment.html>

From mklishin at gopivotal.com  Thu Jun 26 04:53:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 26 Jun 2014 07:53:30 +0400
Subject: [rabbitmq-discuss] How to configure exchange + queue so that
 messages get removed after the last consumer retrieves the message.
In-Reply-To: <fa2ffa69-094e-4ec2-b41e-03ddfe2d7529@googlegroups.com>
References: <fa2ffa69-094e-4ec2-b41e-03ddfe2d7529@googlegroups.com>
Message-ID: <etPan.53ab9958.643c9869.e951@mercurio.local>

On 26 June 2014 at 07:47:00, Ye Wang (ye.wang.at.bookspan at gmail.com) wrote:
> > I am a newbie to RabbitMQ and AMQP protocol. Is that that even  
> possible? I noticed that there is a message TTL I can play with  
> but if the message can be removed in the queue when all the consumers  
> retrieved the message, that will be great.

A single message is never delivered to multiple consumers. Messages are distributed
at *routing* stage (exchange => one or more queues), not delivery. See
http://www.rabbitmq.com/tutorials/amqp-concepts.html.

?So sounds like what you want is a fanout exchange, one queue per consumer
with auto-delete attribute set to true.

By the way, RabbitMQ mailing list has a new home:
https://groups.google.com/group/rabbitmq-users

Please post your future questions and bug reports there :)
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 26 05:49:11 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 26 Jun 2014 08:49:11 +0400
Subject: [rabbitmq-discuss] ANN Ruby RabbitMQ HTTP API client 1.2.0 is
	released
Message-ID: <etPan.53aba665.19495cff.e951@mercurio.local>

Ruby RabbitMQ HTTP API client 1.2.0 is released:
http://blog.rubyrabbitmq.info/blog/2014/06/26/rabbitmq-http-api-client-1-dot-2-0-is-released/

Project repository:
https://github.com/ruby-amqp/rabbitmq_http_api_client?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From dimuthu.jayamanna at gmail.com  Thu Jun 26 06:57:32 2014
From: dimuthu.jayamanna at gmail.com (Dimuthu)
Date: Thu, 26 Jun 2014 05:57:32 +0000 (UTC)
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
	Ubuntu (potential all Debian-likes)
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
 <504A17C2.3090207@rabbitmq.com> <504A1B18.3090408@nine.ch>
Message-ID: <loom.20140626T075626-773@post.gmane.org>

The hostname resolution works!




From ankur5.c at tcs.com  Thu Jun 26 09:56:43 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Thu, 26 Jun 2014 14:26:43 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
Message-ID: <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>

Hi ,

I am trying connect rabbit mq over ssl and using rabbit mq as an mqtt 
broker.

I am using PAHO client. I have configured ssl at the rabbitmq side as per 
http://www.rabbitmq.com/ssl.html.

Bu when I am trying to connect to the broker I am getting the following 
exception
.MqttException (0) - javax.net.ssl.SSLHandshakeException: Remote host 
closed connection during handshake
        at 
org.eclipse.paho.client.mqttv3.internal.ExceptionHelper.createMqttException(
ExceptionHelper.java:34)
        at 
org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(
ClientComms.java:553)
        at java.lang.Thread.run(Thread.java:722)
Caused by: javax.net.ssl.SSLHandshakeException: Remote host closed 
connection during handshake
        at sun.security.ssl.SSLSocketImpl.readRecord(
SSLSocketImpl.java:946)
        at sun.security.ssl.SSLSocketImpl.performInitialHandshake(
SSLSocketImpl.java:1328)
        at sun.security.ssl.SSLSocketImpl.startHandshake(
SSLSocketImpl.java:1355)
        at sun.security.ssl.SSLSocketImpl.startHandshake(
SSLSocketImpl.java:1339)
        at org.eclipse.paho.client.mqttv3.internal.SSLNetworkModule.start(
SSLNetworkModule.java:84)
        at 
org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(
ClientComms.java:538)
        ... 1 more
Caused by: java.io.EOFException: SSL peer shut down incorrectly
        at sun.security.ssl.InputRecord.read(InputRecord.java:352)
        at sun.security.ssl.SSLSocketImpl.readRecord(
SSLSocketImpl.java:927)
        ... 6 more

Any help is appreciated.

Thanks and Regards,
Ankur Chakraborty


From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>, Discussions about RabbitMQ 
<rabbitmq-discuss at lists.rabbitmq.com>
Date:   25-06-2014 15:28
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



 On 25 June 2014 at 13:53:28, Ankur5 C (ankur5.c at tcs.com) wrote:
> > =INFO REPORT==== 25-Jun-2014(
http://airmail.calendar/2014-06-25%2012:00:00%20GMT+4)::12:57:48 
> ===
> Error description:
> {could_not_start,rabbitmq_mqtt,{badmatch,{error,shutdown}}} 
> 
> Please comment on this . I followed the same steps as mentioned 
> in http://www.rabbitmq.com/blog/2012/09/12/mqtt-adapter/. 
> 
> The only difference is the rabbitmq version . In the above link 
> it is mentioned version rabbitmq-server 2.8.6(
http://www.rabbitmq.com/download.html) 
> but I am using rabbitmq_server-3.1.3.

I suspect you tried installing the 2.8.6 plugin into 3.1.3 version. That 
won't work. 
There is no need to download the .ez file any more, simply enable the 
plugin 
and restart RabbitMQ. 

If you did download the 2.8.6 .ez file, remove it first. Then follow the 
docs: 
http://www.rabbitmq.com/mqtt.html 

Also, moving to 3.3.4 is not a bad idea ;) 
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140626/cf637a40/attachment.html>

From mklishin at gopivotal.com  Thu Jun 26 10:05:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 26 Jun 2014 13:05:24 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
Message-ID: <etPan.53abe271.643c9869.1688@mercurio.local>

?On 26 June 2014 at 12:56:49, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Bu when I am trying to connect to the broker I am getting the following  
> exception
> .MqttException(0) - javax.net.ssl.SSLHandshakeException:  
> Remote host closed connection during handshake
> at org.eclipse.paho.client.mqttv3.internal.ExceptionHelper.createMqttException(ExceptionHelper.java:34)  
> at org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:553)  
> at java.lang.Thread.run(Thread.java:722)
> Caused by: javax.net.ssl.SSLHandshakeException: Remote  
> host closed connection during handshake
> at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:946)  
> at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1328)  
> at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1355)  
> at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1339)  
> at org.eclipse.paho.client.mqttv3.internal.SSLNetworkModule.start(SSLNetworkModule.java:84)  
> at org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:538)  
> ... 1 more
> Caused by: java.io.EOFException: SSL peer shut down incorrectly  
> at sun.security.ssl.InputRecord.read(InputRecord.java:352)  
> at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:927)  
> ... 6 more
>  
> Any help is appreciated.

Take a look at RabbitMQ log, there should be some hints at what may be
going on. I suspect peer verification fails.

See SSL Troubleshooting guide:
http://www.rabbitmq.com/troubleshooting-ssl.html
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jun 26 10:35:14 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 26 Jun 2014 13:35:14 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
Message-ID: <etPan.53abe970.66334873.1688@mercurio.local>

+rabbitmq-discuss

On 26 June 2014 at 13:33:15, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Thanx , I went through http://www.rabbitmq.com/troubleshooting-ssl.html. 
> 
> I executed openssl s_client -connect localhost:5671 -cert 
> client/cert.pem -key client/key.pem -CAfile testca/cacert.pem. 
> 
> Getting everything ok , no error .
> 
> But using the same set of certificates when I try to connect using 
> the PAHO client I get the following exception as found in the logs 
> .
> 
> ** Reason for termination ==
> ** {function_clause,[{rabbit_mqtt_frame,parse_utf,[<<1,0,149>>]}, 
> {rabbit_mqtt_frame,parse_frame,3},
> {rabbit_mqtt_reader,process_received_bytes,2},
> {gen_server2,handle_msg,2},
> {proc_lib,wake_up,3}]}
> 
> Please suggest on this.

Please try a different client. This may be a RabbitMQ issue but also
a Paho Java client one.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From jaroslav at kamenik.cz  Thu Jun 26 11:05:18 2014
From: jaroslav at kamenik.cz (=?UTF-8?Q?Jaroslav_Kamen=C3=ADk?=)
Date: Thu, 26 Jun 2014 03:05:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Scheduled message delivery (again:)
Message-ID: <31f0dbb3-270a-4781-9bba-fe26fb6a4c82@googlegroups.com>

Hi,

i'd like to ask, if there is something new about this topic? It is 
appearing repetitively in mailing list years back...


Jaroslav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140626/80eb8979/attachment.html>

From mklishin at gopivotal.com  Thu Jun 26 13:04:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 26 Jun 2014 16:04:09 +0400
Subject: [rabbitmq-discuss] Scheduled message delivery (again:)
In-Reply-To: <31f0dbb3-270a-4781-9bba-fe26fb6a4c82@googlegroups.com>
References: <31f0dbb3-270a-4781-9bba-fe26fb6a4c82@googlegroups.com>
Message-ID: <etPan.53ac0c54.74b0dc51.1688@mercurio.local>

?On 26 June 2014 at 15:49:27, Jaroslav Kamen?k (jaroslav at kamenik.cz) wrote:
> > i'd like to ask, if there is something new about this topic? It  
> is appearing repetitively in mailing list years back...

No news. It is an interesting feature that can be implemented as a custom exchange
plugin but nobody so far has stepped up to do it.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Thu Jun 26 18:00:09 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Jun 2014 18:00:09 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53A7E749.6060009@alertme.com>
References: <53A4436E.4090407@alertme.com> <53A444F3.10608@rabbitmq.com>
 <53A44907.5090908@alertme.com> <53A4BB81.5050509@rabbitmq.com>
 <53A7E749.6060009@alertme.com>
Message-ID: <53AC5199.3020702@rabbitmq.com>

Dmitry,

On 23/06/14 09:37, Dmitry Andrianov wrote:
> we actually using that thing already - client sets the user ID property
> and server rejects a message if it does not match the actual auth user.
> However, I did read it as that setUserId call being optional - it is up
> to the client to set it. And if client does not set it, no validation is
> performed.
> So how do I prevent messages without an user id from being accepted?

You can't, though your consuming applications could drop such messages.

> If I need a custom exchange type or exchange decorator - it does not
> really makes life much easier.

It would be quite straightforward to write an exchange type or decorator 
that drops messages which do not have the user-id header. Or rejects 
them with some amqp error.

That may not be the ideal solution but can be done now, without 
requiring any changes to rabbit's APIs.

Matthias.

From matthias at rabbitmq.com  Thu Jun 26 18:04:27 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Jun 2014 18:04:27 +0100
Subject: [rabbitmq-discuss] rabbitmq-c TTL setting not working for me -
 please help
In-Reply-To: <53A073EE.4040808@gmail.com>
References: <de6cd927-ff42-407f-98cc-80b6bd20db4e@googlegroups.com>
 <etPan.539f94f2.643c9869.b262@mercurio.local> <53A06DC7.6020102@gmail.com>
 <53A06F5B.8040603@rabbitmq.com> <53A073EE.4040808@gmail.com>
Message-ID: <53AC529B.1020900@rabbitmq.com>

On 17/06/14 17:59, Kim Tran wrote:
> So what would happen if I got all the messages straight away but slowly
> process them:  the queue would get bigger and bigger over time? and
> eventually crash with some socket error?

No, the 'queue' (if by that you mean the RabbitMQ broker) won't crash. 
See http://www.rabbitmq.com/memory.html

Matthias.

From matthias at rabbitmq.com  Thu Jun 26 18:06:29 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Jun 2014 18:06:29 +0100
Subject: [rabbitmq-discuss] how prevent overlapped messages?
In-Reply-To: <b9447afb-c02d-4f34-9c5f-1d49ce63c516@googlegroups.com>
References: <b9447afb-c02d-4f34-9c5f-1d49ce63c516@googlegroups.com>
Message-ID: <53AC5315.7010000@rabbitmq.com>

On 18/06/14 10:15, xeon Mailinglist wrote:
> I have 4 hosts connected with 4 queues to the RabbitMQ service. I have
> multiple processes making calls to each host using the queues, but what
> happens is that messages overlap giving me errors of execution. What
> should I do to prevent the processes do not overlap messages with the MQ
> using celery?

You may want to ask this on 
https://groups.google.com/forum/#!forum/celery-users

Matthias.

From dmitry.andrianov at alertme.com  Thu Jun 26 18:10:17 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Thu, 26 Jun 2014 18:10:17 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53AC5199.3020702@rabbitmq.com>
References: <53A4436E.4090407@alertme.com> <53A444F3.10608@rabbitmq.com>
 <53A44907.5090908@alertme.com> <53A4BB81.5050509@rabbitmq.com>
 <53A7E749.6060009@alertme.com> <53AC5199.3020702@rabbitmq.com>
Message-ID: <53AC53F9.9000400@alertme.com>

Matthias,
we did not want to do that kind of tests in the consuming applications 
because more consumers can be created later and copying that kind of 
check into each of them is error prone and is easy to be forgotten, 
especially by new team members. So we opted for the custom exchange type 
that just does not allow these messages into the system. And I do 
confirm no API changes were required :) - there are a few examples of 
custom exchanges on the internet. My only problem was Erlang :)

While we are there given that we have our custom exchange - how can we 
"enrich" a message with some data like client's IP?
(I know we are not supposed to touch the message according to AMQP 
standard, but we are not very standard already given three custom plugins)

Thank you.

On 26/06/14 18:00, Matthias Radestock wrote:
> Dmitry,
>
> On 23/06/14 09:37, Dmitry Andrianov wrote:
>> we actually using that thing already - client sets the user ID property
>> and server rejects a message if it does not match the actual auth user.
>> However, I did read it as that setUserId call being optional - it is up
>> to the client to set it. And if client does not set it, no validation is
>> performed.
>> So how do I prevent messages without an user id from being accepted?
>
> You can't, though your consuming applications could drop such messages.
>
>> If I need a custom exchange type or exchange decorator - it does not
>> really makes life much easier.
>
> It would be quite straightforward to write an exchange type or 
> decorator that drops messages which do not have the user-id header. Or 
> rejects them with some amqp error.
>
> That may not be the ideal solution but can be done now, without 
> requiring any changes to rabbit's APIs.
>
> Matthias.

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From matthias at rabbitmq.com  Thu Jun 26 18:11:31 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Jun 2014 18:11:31 +0100
Subject: [rabbitmq-discuss] Autorecovery Issue
In-Reply-To: <CAP2+pdwyK3wsn8otU6dSZyVxPGANHqK9rupuOSZOqQ4YCC1SUQ@mail.gmail.com>
References: <CAP2+pdzXfz9pD+UxNmXH_c5f-t_=LpygcXND=oAJ1GR4Ky4w2w@mail.gmail.com>
 <etPan.538f0502.6b68079a.e723@mercurio.local>
 <CAP2+pdz5-E6VzkgTN6Wpc+0qObhAQ5Mr0q6RywXuq5uoUB=0Aw@mail.gmail.com>
 <etPan.538f1058.431bd7b7.e723@mercurio.local>
 <etPan.53906b45.6b8b4567.166c0@mercurio.local>
 <CAP2+pdyNoK3ZhFWN+cq02VOC0_6qFQuvN6D5m-SbvqAXt6JKyA@mail.gmail.com>
 <etPan.5396b764.74b0dc51.9b84@mercurio.local>
 <CAP2+pdysviMg8q7HqY3_Fwwr3ZOhARO-7A4+AiMfJ9Q5iX=S+Q@mail.gmail.com>
 <etPan.5396bcb1.2ae8944a.9b84@mercurio.local>
 <CAP2+pdy0Y6bNFPTXb_hd6FJEXtCxrCwHFc84XNoSEzg+MK=DeA@mail.gmail.com>
 <etPan.53a3d367.643c9869.56f5@mercurio.local>
 <CAP2+pdwyK3wsn8otU6dSZyVxPGANHqK9rupuOSZOqQ4YCC1SUQ@mail.gmail.com>
Message-ID: <53AC5443.3000505@rabbitmq.com>

On 20/06/14 12:28, Ranjitha Shet wrote:
> I din get what u meant by "regular" consumer.. Should use DefaultConsumer?

Yes, as per http://www.rabbitmq.com/api-guide.html#consuming

Matthias.

From matthias at rabbitmq.com  Thu Jun 26 18:13:58 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Jun 2014 18:13:58 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53AC53F9.9000400@alertme.com>
References: <53A4436E.4090407@alertme.com> <53A444F3.10608@rabbitmq.com>
 <53A44907.5090908@alertme.com> <53A4BB81.5050509@rabbitmq.com>
 <53A7E749.6060009@alertme.com> <53AC5199.3020702@rabbitmq.com>
 <53AC53F9.9000400@alertme.com>
Message-ID: <53AC54D6.60406@rabbitmq.com>

On 26/06/14 18:10, Dmitry Andrianov wrote:
> While we are there given that we have our custom exchange - how can we
> "enrich" a message with some data like client's IP?

you can't. That *would* require changes to APIs. And breaking some 
significant assumptions on the way.

Matthias.

From mklishin at gopivotal.com  Thu Jun 26 18:22:04 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 26 Jun 2014 21:22:04 +0400
Subject: [rabbitmq-discuss] Web-STOMP plugin - Authentication with SSL
 Client Certificates
In-Reply-To: <CANcm3vkys+B7eybxWhA+bk2LcAQWeUdqDPab5b0mqG4E3ayCRQ@mail.gmail.com>
References: <4f7a3dbb-8633-4361-b042-aa79cff5ce69@googlegroups.com>
 <etPan.539b3300.6b8b4567.50e9@mercurio.local>
 <CANcm3v=+NcNxue75cnzbLiLFYML3MYBCsKGEDbznaN8pQHwi6w@mail.gmail.com>
 <etPan.539b7b20.643c9869.83e5@mercurio.local>
 <CANcm3vkc0JxpjosSiY43k-=wSL74CB-=ni+s4hNR3cuJ00hJyQ@mail.gmail.com>
 <etPan.53a291bd.5b3ef282.9b32@mercurio.local>
 <CANcm3vkrrEs5mx3CaN=iduadcBbDvkRA6V4+n3ikDK_=6ymgvQ@mail.gmail.com>
 <etPan.53a33641.19495cff.172@mercurio.local>
 <CANcm3vkys+B7eybxWhA+bk2LcAQWeUdqDPab5b0mqG4E3ayCRQ@mail.gmail.com>
Message-ID: <etPan.53ac56d5.74b0dc51.ad22@mercurio.local>

?On 20 June 2014 at 17:12:12, Andrei (andrei002 at gmail.com) wrote:
> > ../cowboy-wrapper/cowboy-git/src/cowboy_clock.erl:  
> undefined parse transform 'eunit_autoexport'
> make: *** [../cowboy-wrapper/ebin/cowboy_clock.beam] Error  
> 1

You need to install the eunit package, e.g. erlang-eunit. It's fairly common
for Debian derivative distros to slice and dice runtimes into tiny packages.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Fri Jun 27 00:27:18 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Thu, 26 Jun 2014 23:27:18 +0000
Subject: [rabbitmq-discuss] federation Issues
Message-ID: <6DB033025329784B9280ABD9516177FCA2D0A8F1@USEPX2PMXMBX12.corp.altegrity.com>

Hi all,



We just upgraded from 3.2.1 to 3.3.4 and federation died on us.  Looking at the cluster, it appears some... overenthusiastic dev renamed the cluster, and now when federation creates new linkages, it creates them as clustername:vHost:queue, rather than usertoken:vHost:queue.  Also, on the federation upstreams, the parameter field seems to have vanished, so I can't update the user tokens for specific vHosts.  I've been going through the patch notes - is this intentional, or is something else going on?  And can I just remove the cluster name?  I've tried deleting the old dynamically created fed stuff so that it gets recreated, but the new stuff just doesn't seem to work.  Any help is appreciated.



Kale Ganann
This communication contains information that is confidential,
proprietary in nature, and may also be attorney-client privileged
and/or work product privileged. It is for the exclusive use of the
intended recipient(s). If you are not the intended recipient(s) or
the person responsible for delivering it to the intended
recipient(s), please note that any form of dissemination,
distribution or copying of this communication is strictly
prohibited and may be unlawful. If you have received this
communication in error, please immediately notify the sender by replying
to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees
or agents accept liability for any errors, omissions or damages
caused by delays of receipt or by any virus infection in this
message or its attachments, or which may otherwise arise as a
result of this e-mail transmission.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140626/23746d70/attachment.html>

From samlaw350 at gmail.com  Fri Jun 27 00:43:28 2014
From: samlaw350 at gmail.com (Sam Lawrence)
Date: Thu, 26 Jun 2014 16:43:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Bug: Messages lost on server restart with
	dead-letter and TTL queue
Message-ID: <943da3ac-eb8a-46bc-bca8-9727d4572880@googlegroups.com>

Hi,

The following URL from 2012 described a bug where if the rabbitmq server 
was stopped and started again after a period of time which is greater than 
a queues TTL, the messages would be lost rather than being dead-lettered.

http://rabbitmq.1065348.n5.nabble.com/Lost-messages-on-dead-letter-ttl-queue-while-process-is-restarted-td23004.html

In the thread, Matthias said this was a bug and would be fixed in a future 
release.  

I am running v3.3.1 and am seeing this behaviour which suggests the bug has 
not been fixed, this would be strange considering this bug was identified 
~1.5 years ago.   

Can anyone confirm if this was fixed, or if their is some other caveat to 
this issue?


Thanks,
Sam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140626/42b692fe/attachment.html>

From mklishin at gopivotal.com  Fri Jun 27 06:05:44 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 09:05:44 +0400
Subject: [rabbitmq-discuss] Bug: Messages lost on server restart with
 dead-letter and TTL queue
In-Reply-To: <943da3ac-eb8a-46bc-bca8-9727d4572880@googlegroups.com>
References: <943da3ac-eb8a-46bc-bca8-9727d4572880@googlegroups.com>
Message-ID: <etPan.53acfbc2.46e87ccd.e552@mercurio.local>

On 27 June 2014 at 08:21:42, Sam Lawrence (samlaw350 at gmail.com) wrote:
> > Can anyone confirm if this was fixed, or if their is some other  
> caveat to this issue?

I could not find a bug for this (there are some that look like they are related).

Will file a new one.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jun 27 06:17:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 09:17:09 +0400
Subject: [rabbitmq-discuss] Bug: Messages lost on server restart with
 dead-letter and TTL queue
In-Reply-To: <etPan.53acfbc2.46e87ccd.e552@mercurio.local>
References: <943da3ac-eb8a-46bc-bca8-9727d4572880@googlegroups.com>
 <etPan.53acfbc2.46e87ccd.e552@mercurio.local>
Message-ID: <etPan.53acfe72.507ed7ab.e552@mercurio.local>

On 27 June 2014 at 09:07:33, Michael Klishin (mklishin at gopivotal.com) wrote:
> > I could not find a bug for this (there are some that look like they  
> are related).

It was fixed in 3.0:
http://www.rabbitmq.com/release-notes/README-3.0.0.txt, bug?25260

So what I'd check if the messages are published as persistent and if there
may be an incorrect dead-lettering routing key in play.

Let us know about how to reproduce the issue with 3.3 if you are sure
it's still present.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From gmlexx at gmail.com  Fri Jun 27 07:06:32 2014
From: gmlexx at gmail.com (Alexey)
Date: Thu, 26 Jun 2014 23:06:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Subscription close may hang
Message-ID: <dd38cc9e-98d8-468d-8f3b-67bf52371834@googlegroups.com>

Hello,

With .NET rabbitmq client v3.3.2 subscription close may hang forever.

Connection open code:

var cf = new ConnectionFactory
{
HostName = replica.EndPoint.Address,
Port = replica.EndPoint.Port,
UserName = mqUsername,
Password = mqPassword,
RequestedHeartbeat = 5
};
var connection = cf.CreateConnection();
Channel = connection.CreateModel();
connection.AutoClose = true;
Subscription = new Subscription(Channel, queueName, false);

Connection close code:

Subscription.Close(); // <----  May hang forever

Is it a bug, or we doing something wrong?

Kind regards,
Alexey
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140626/07f3f1ca/attachment.html>

From ankur5.c at tcs.com  Fri Jun 27 07:13:59 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 11:43:59 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53abe970.66334873.1688@mercurio.local>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
Message-ID: <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>

Hi,

In which port does MQTT ssl option listens in rabbitmq.

I have enabled ssl options in rabbit mq 3.3.1 . When I restart the broker 
I get the log message as .

=INFO REPORT==== 27-Jun-2014::11:49:52 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 27-Jun-2014::11:49:53 ===
started SSL Listener on [::]:5671

=INFO REPORT==== 27-Jun-2014::11:49:53 ===
started MQTT TCP Listener on [::]:1883

=INFO REPORT==== 27-Jun-2014::11:49:53 ===
Management plugin started. Port: 15672

=INFO REPORT==== 27-Jun-2014::11:49:53 ===
Statistics database started.

=INFO REPORT==== 27-Jun-2014::11:49:53 ===
Server startup complete; 7 plugins started.
 * amqp_client
 * mochiweb
 * rabbitmq_management
 * rabbitmq_management_agent
 * rabbitmq_mqtt
 * rabbitmq_web_dispatch
 * webmachine

I can connect to MQTT port 1883 over no SSL but I doubt how the MQTT ssl 
can be accessed ?

The ssl port registered for MQTT against rabbitmq is 8883 . 

Should not there be something in the log that MQTT ssl has started 
listening on port 8883?

Please clarify . Also please let me know how I can verify using a client 
by which one can connect rabbitmq MQTT ssl.

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   26-06-2014 15:05
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



+rabbitmq-discuss

On 26 June 2014 at 13:33:15, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Thanx , I went through 
http://www.rabbitmq.com/troubleshooting-ssl.html. 
> 
> I executed openssl s_client -connect localhost:5671 -cert 
> client/cert.pem -key client/key.pem -CAfile testca/cacert.pem. 
> 
> Getting everything ok , no error .
> 
> But using the same set of certificates when I try to connect using 
> the PAHO client I get the following exception as found in the logs 
> .
> 
> ** Reason for termination ==
> ** {function_clause,[{rabbit_mqtt_frame,parse_utf,[<<1,0,149>>]}, 
> {rabbit_mqtt_frame,parse_frame,3},
> {rabbit_mqtt_reader,process_received_bytes,2},
> {gen_server2,handle_msg,2},
> {proc_lib,wake_up,3}]}
> 
> Please suggest on this.

Please try a different client. This may be a RabbitMQ issue but also
a Paho Java client one.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/85c6bbfd/attachment.html>

From mklishin at gopivotal.com  Fri Jun 27 07:14:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 10:14:39 +0400
Subject: [rabbitmq-discuss] Subscription close may hang
In-Reply-To: <dd38cc9e-98d8-468d-8f3b-67bf52371834@googlegroups.com>
References: <dd38cc9e-98d8-468d-8f3b-67bf52371834@googlegroups.com>
Message-ID: <etPan.53ad0be9.41b71efb.e552@mercurio.local>

On 27 June 2014 at 10:08:49, Alexey (gmlexx at gmail.com) wrote:
> > Subscription.Close(); // <---- May hang forever
>  
> Is it a bug, or we doing something wrong?

The only thing that blocks in Subscription#Close is IModel#BasicCancel,
which only waits for a server response. Can there be a network connection
loss involved??

Please post a thread dump (e.g. see "Create Dump File" in Task Manager).
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jun 27 07:24:35 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 10:24:35 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
Message-ID: <etPan.53ad0e3f.7545e146.e552@mercurio.local>

On 27 June 2014 at 10:15:20, Ankur5 C (ankur5.c at tcs.com) wrote:
> > I can connect to MQTT port 1883 over no SSL but I doubt how the MQTT  
> ssl can be accessed ?
>  
> The ssl port registered for MQTT against rabbitmq is 8883 .
>  
> Should not there be something in the log that MQTT ssl has started  
> listening on port 8883?
>  
> Please clarify . Also please let me know how I can verify using  
> a client by which one can connect rabbitmq MQTT ssl.

You choose the port using?ssl_listeners (see Plugin Configuration on
http://www.rabbitmq.com/mqtt.html, and specify the port you want
instead of an empty list).

MQTT with SSL port is typically 8883 (this is mentioned in our docs)
but it can be any port you want.
It is *not* common to use MQTT with SSL on port 1883, unless you must
disable non-SSL connections entirely.?

You can verify SSL connectivity using openssl s_client or an MQTT
client that makes it easy to configure SSL. See
http://www.rabbitmq.com/troubleshooting-ssl.html.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jun 27 08:02:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 11:02:19 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad0e3f.7545e146.e552@mercurio.local>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
Message-ID: <etPan.53ad1717.5bd062c2.e552@mercurio.local>

On 27 June 2014 at 10:26:18, Michael Klishin (mklishin at gopivotal.com) wrote:
> > You choose the port using ssl_listeners (see Plugin Configuration  
> on
> http://www.rabbitmq.com/mqtt.html, and specify the port  
> you want
> instead of an empty list).
>  
> MQTT with SSL port is typically 8883 (this is mentioned in our  
> docs)
> but it can be any port you want.
> It is *not* common to use MQTT with SSL on port 1883, unless you  
> must
> disable non-SSL connections entirely.

We've added an example config that provides MQTT with SSL on port 8883
to the docs, see the TLS/SSL section on ?http://www.rabbitmq.com/mqtt.html.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jun 27 10:16:03 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 14:46:03 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad1717.5bd062c2.e552@mercurio.local>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
 <etPan.53ad1717.5bd062c2.e552@mercurio.local>
Message-ID: <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>

Thanks. Did all the configurations and getting the message that MQTT SSL 
listens on port 8883 , but still I am unable to connect MQTT SSL using the 
paho java client.

I visited the logs and got the following error :

=ERROR REPORT==== 27-Jun-2014::14:55:49 ===
** Generic server <0.422.0> terminating
** Last message in was 
{go,#Port<0.14656>,#Fun<rabbit_networking.1.24135120>}
** When Server state == undefined
** Reason for termination ==
** {{badmatch,{error,{ssl_upgrade_error,timeout}}},
    [{rabbit_mqtt_reader,handle_call,3},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}

Is this due to any network related issues ? or anything else?

Thanks and Regards,
Ankur Chakraborty



From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   27-06-2014 12:32
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



On 27 June 2014 at 10:26:18, Michael Klishin (mklishin at gopivotal.com) 
wrote:
> > You choose the port using ssl_listeners (see Plugin Configuration 
> on
> http://www.rabbitmq.com/mqtt.html, and specify the port 
> you want
> instead of an empty list).
> 
> MQTT with SSL port is typically 8883 (this is mentioned in our 
> docs)
> but it can be any port you want.
> It is *not* common to use MQTT with SSL on port 1883, unless you 
> must
> disable non-SSL connections entirely.

We've added an example config that provides MQTT with SSL on port 8883
to the docs, see the TLS/SSL section on  http://www.rabbitmq.com/mqtt.html
.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/936c6ac1/attachment.html>

From mklishin at gopivotal.com  Fri Jun 27 10:20:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 13:20:07 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
 <etPan.53ad1717.5bd062c2.e552@mercurio.local>
 <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>
Message-ID: <etPan.53ad3760.1f16e9e8.e552@mercurio.local>

?On 27 June 2014 at 13:16:09, Ankur5 C (ankur5.c at tcs.com) wrote:
> > ** Reason for termination ==
> ** {{badmatch,{error,{ssl_upgrade_error,timeout}}},
> [{rabbit_mqtt_reader,handle_call,3},
> {gen_server2,handle_msg,2},
> {proc_lib,init_p_do_apply,3}]}
>  
> Is this due to any network related issues ? or anything else?

SSL upgrade never finished because (a guess) the client wasn't
actually configured to use SSL.

How did you configure the client?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jun 27 10:26:13 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 14:56:13 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad3760.1f16e9e8.e552@mercurio.local>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
 <etPan.53ad1717.5bd062c2.e552@mercurio.local>
 <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>
 <etPan.53ad3760.1f16e9e8.e552@mercurio.local>
Message-ID: <OFD8BAEFA5.DFB30B72-ON65257D04.003375D0-65257D04.0033D72C@tcs.com>

I have used Paho java client.

I have built a sample java project and is trying to connect .

MqttClient client = new MqttClient("ssl://192.168.161.208:8883", 
"rabbitmq");

                        MqttConnectOptions options = new 
MqttConnectOptions();
                        options.setConnectionTimeout(60);
                        options.setKeepAliveInterval(60);
 
                        options.setSocketFactory(SslUtil.getSocketFactory(
"C:/Users/397886/Desktop/HBase/workspacetrunk/TestMQTT/certificates/cacert.pem"
,
                                        
"C:/Users/397886/Desktop/HBase/workspacetrunk/TestMQTT/certificates/cert.pem"
, 
                                        
"C:/Users/397886/Desktop/HBase/workspacetrunk/TestMQTT/certificates/key.pem"
, "MySecretPassword"));


                        client.connect(options);




Thanks and Regards,
Ankur Chakraborty



From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   27-06-2014 14:50
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



 On 27 June 2014 at 13:16:09, Ankur5 C (ankur5.c at tcs.com) wrote:
> > ** Reason for termination ==
> ** {{badmatch,{error,{ssl_upgrade_error,timeout}}},
> [{rabbit_mqtt_reader,handle_call,3},
> {gen_server2,handle_msg,2},
> {proc_lib,init_p_do_apply,3}]}
> 
> Is this due to any network related issues ? or anything else?

SSL upgrade never finished because (a guess) the client wasn't
actually configured to use SSL.

How did you configure the client?
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/52f0a5c8/attachment.html>

From samlaw350 at gmail.com  Fri Jun 27 10:48:57 2014
From: samlaw350 at gmail.com (Sam Lawrence)
Date: Fri, 27 Jun 2014 02:48:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Bug: Messages lost on server restart with
 dead-letter and TTL queue
In-Reply-To: <etPan.53acfe72.507ed7ab.e552@mercurio.local>
References: <943da3ac-eb8a-46bc-bca8-9727d4572880@googlegroups.com>
 <etPan.53acfbc2.46e87ccd.e552@mercurio.local>
 <etPan.53acfe72.507ed7ab.e552@mercurio.local>
Message-ID: <2d805d4c-436b-4f90-979c-7e73873f48ea@googlegroups.com>

Hi Michael,

I can confirm the messages are persistent and have written a test case here 
https://github.com/swdee/rabbitmq-test-case

Let me know your thoughts?

Regards,
Sam



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/33b45c77/attachment.html>

From mklishin at gopivotal.com  Fri Jun 27 10:52:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 13:52:09 +0400
Subject: [rabbitmq-discuss] Bug: Messages lost on server restart with
 dead-letter and TTL queue
In-Reply-To: <2d805d4c-436b-4f90-979c-7e73873f48ea@googlegroups.com>
References: <943da3ac-eb8a-46bc-bca8-9727d4572880@googlegroups.com>
 <etPan.53acfbc2.46e87ccd.e552@mercurio.local>
 <etPan.53acfe72.507ed7ab.e552@mercurio.local>
 <2d805d4c-436b-4f90-979c-7e73873f48ea@googlegroups.com>
Message-ID: <etPan.53ad3ee7.1190cde7.e552@mercurio.local>

On 27 June 2014 at 13:51:10, Sam Lawrence (samlaw350 at gmail.com) wrote:
> > I can confirm the messages are persistent and have written a 
> test case here https://github.com/swdee/rabbitmq-test-case 
> 
> Let me know your thoughts?

Thank you, Sam. We will try reproducing it.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jun 27 11:22:09 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 15:52:09 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OFD8BAEFA5.DFB30B72-ON65257D04.003375D0-65257D04.0033CFAA@LocalDomain>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
 <etPan.53ad1717.5bd062c2.e552@mercurio.local>
 <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>
 <etPan.53ad3760.1f16e9e8.e552@mercurio.local>
 <OFD8BAEFA5.DFB30B72-ON65257D04.003375D0-65257D04.0033CFAA@LocalDomain>
Message-ID: <OF15BEC543.459A8435-ON65257D04.0038DE02-65257D04.0038F5C3@tcs.com>

Also if any mqtt ssl client available , please let me know.

Is this a bug in rabbitmq ssl support for MQTT ?

Thanks and Regards,
Ankur Chakraborty




From:	Ankur5 C/KOL/TCS
To:	Michael Klishin <mklishin at gopivotal.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	27-06-2014 14:55
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.


I have used Paho java client.

I have built a sample java project and is trying to connect .

MqttClient client = new MqttClient("ssl://192.168.161.208:8883", "rabbitmq"
);

			MqttConnectOptions options = new MqttConnectOptions();
			options.setConnectionTimeout(60);
			options.setKeepAliveInterval(60);

			options.setSocketFactory(SslUtil.getSocketFactory(
"C:/Users/397886/Desktop/HBase/workspacetrunk/TestMQTT/certificates/cacert.pem"
,

"C:/Users/397886/Desktop/HBase/workspacetrunk/TestMQTT/certificates/cert.pem"
,

"C:/Users/397886/Desktop/HBase/workspacetrunk/TestMQTT/certificates/key.pem"
, "MySecretPassword"));


			client.connect(options);




Thanks and Regards,
Ankur Chakraborty




From:	Michael Klishin <mklishin at gopivotal.com>
To:	Ankur5 C <ankur5.c at tcs.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	27-06-2014 14:50
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.



?On 27 June 2014 at 13:16:09, Ankur5 C (ankur5.c at tcs.com) wrote:
> > ** Reason for termination ==
> ** {{badmatch,{error,{ssl_upgrade_error,timeout}}},
> [{rabbit_mqtt_reader,handle_call,3},
> {gen_server2,handle_msg,2},
> {proc_lib,init_p_do_apply,3}]}
>
> Is this due to any network related issues ? or anything else?

SSL upgrade never finished because (a guess) the client wasn't
actually configured to use SSL.

How did you configure the client?
--
MK

Staff Software Engineer, Pivotal/RabbitMQ


=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you




From mklishin at gopivotal.com  Fri Jun 27 11:27:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 14:27:00 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF15BEC543.459A8435-ON65257D04.0038DE02-65257D04.00391F1A@tcs.com>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
 <etPan.53ad1717.5bd062c2.e552@mercurio.local>
 <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>
 <etPan.53ad3760.1f16e9e8.e552@mercurio.local>
 <OFD8BAEFA5.DFB30B72-ON65257D04.003375D0-65257D04.0033CFAA@LocalDomain>
 <OF15BEC543.459A8435-ON65257D04.0038DE02-65257D04.00391F1A@tcs.com>
Message-ID: <etPan.53ad470e.140e0f76.e552@mercurio.local>

On 27 June 2014 at 14:24:01, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Is this a bug in rabbitmq ssl support for MQTT ?

We need to investigate before we can tell. The MQTT plugin test suite uses
Paho but there are no SSL-enabled tests as far as I can see.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur.ju at gmail.com  Fri Jun 27 11:49:55 2014
From: ankur.ju at gmail.com (ankur.ju at gmail.com)
Date: Fri, 27 Jun 2014 03:49:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Does RabbitMQ supports MQTT SSL plugin?
Message-ID: <c098dede-270c-47ee-b90a-3ba5d59c3f97@googlegroups.com>

Hi ,

I have been trying to connect to RabbitMQ as an MQTT broker on SSL port 
8883 using Paho java client.

However every time I am getting the following error .

=ERROR REPORT==== 27-Jun-2014::14:55:49 ===
** Generic server <0.422.0> terminating
** Last message in was 
{go,#Port<0.14656>,#Fun<rabbit_networking.1.24135120>}
** When Server state == undefined
** Reason for termination ==
** {{badmatch,{error,{ssl_upgrade_error,timeout}}},
    [{rabbit_mqtt_reader,handle_call,3},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}

But SSL connections are ok , I have verified using OpenSSL command line 
tool.

Thanks in advance.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/0fd0867a/attachment.html>

From ankur5.c at tcs.com  Fri Jun 27 11:52:28 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 16:22:28 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad470e.140e0f76.e552@mercurio.local>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
 <etPan.53ad1717.5bd062c2.e552@mercurio.local>
 <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>
 <etPan.53ad3760.1f16e9e8.e552@mercurio.local>
 <OFD8BAEFA5.DFB30B72-ON65257D04.003375D0-65257D04.0033CFAA@LocalDomain>
 <OF15BEC543.459A8435-ON65257D04.0038DE02-65257D04.00391F1A@tcs.com>
 <etPan.53ad470e.140e0f76.e552@mercurio.local>
Message-ID: <OF217C7E92.B1AA734B-ON65257D04.003B9CD2-65257D04.003BBCA6@tcs.com>

Thanks . Please let us know when you get any information / result in this 
regard.

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   27-06-2014 15:59
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



On 27 June 2014 at 14:24:01, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Is this a bug in rabbitmq ssl support for MQTT ?

We need to investigate before we can tell. The MQTT plugin test suite uses
Paho but there are no SSL-enabled tests as far as I can see. 
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/466dbca1/attachment.html>

From simon at rabbitmq.com  Fri Jun 27 12:11:21 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jun 2014 12:11:21 +0100
Subject: [rabbitmq-discuss] federation Issues
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D0A8F1@USEPX2PMXMBX12.corp.altegrity.com>
References: <6DB033025329784B9280ABD9516177FCA2D0A8F1@USEPX2PMXMBX12.corp.altegrity.com>
Message-ID: <53AD5159.9050008@rabbitmq.com>

On 27/06/14 00:27, Ganann, Kale wrote:
> We just upgraded from 3.2.1 to 3.3.4 and federation died on us.  Looking
> at the cluster, it appears some... overenthusiastic dev renamed the
> cluster

That should not be a problem.

 From 3.2.x to 3.3.x we changed from having the federation plugin give 
the cluster a name through the local_nodename parameter, to having a 
broker-wide cluster name that can be used by the federation plugin.

But the cluster name doesn't matter that much. It's used to name the 
queues which federation uses internally, and it shows up in transmitted 
bindings and messages so the plugin (and sysadmins) know where message 
have been. But it's not something you should have to get "correct" for 
things to work - there's no correct value.

> and now when federation creates new linkages, it creates them
> as clustername:vHost:queue, rather than usertoken:vHost:queue.

I really do not understand any of this.

What do you mean by "linkages"? Bindings? Federation links (as shown in 
the status)? Something else?

Also, what do you mean by usertoken?

> Also, on
> the federation upstreams, the parameter field seems to have vanished, so
> I can't update the user tokens for specific vHosts.

I guess you are saying something about the local_username or 
local_nodename fields here? local_username is gone, there is no need to 
configure it at all any more. local_nodename is replaced by the cluster 
name.

> I've been going
> through the patch notes - is this intentional, or is something else
> going on?

The removal of local_username and local_nodename was intentional.

> And can I just remove the cluster name?

Clusters always have a name.

>  I've tried deleting
> the old dynamically created fed stuff so that it gets recreated, but the
> new stuff just doesn't seem to work.  Any help is appreciated.

What does the link status look like?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 27 12:28:56 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jun 2014 12:28:56 +0100
Subject: [rabbitmq-discuss] Bug: Messages lost on server restart with
 dead-letter and TTL queue
In-Reply-To: <2d805d4c-436b-4f90-979c-7e73873f48ea@googlegroups.com>
References: <943da3ac-eb8a-46bc-bca8-9727d4572880@googlegroups.com>
 <etPan.53acfbc2.46e87ccd.e552@mercurio.local>
 <etPan.53acfe72.507ed7ab.e552@mercurio.local>
 <2d805d4c-436b-4f90-979c-7e73873f48ea@googlegroups.com>
Message-ID: <53AD5578.7020902@rabbitmq.com>

On 27/06/14 10:48, Sam Lawrence wrote:
> I can confirm the messages are persistent and have written a test case
> here https://github.com/swdee/rabbitmq-test-case

The messages are persistent, the queues are durable... but the exchanges 
are not durable, so they get wiped out when the broker restarts. The 
messages are dead-lettered to an exchange which does not exist, and are 
thus dropped.

Could that explain what you're seeing?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Fri Jun 27 12:48:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 15:48:24 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad470e.140e0f76.e552@mercurio.local>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <etPan.53aa9d1f.1f16e9e8.143a2@mercurio.local>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
 <etPan.53ad1717.5bd062c2.e552@mercurio.local>
 <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>
 <etPan.53ad3760.1f16e9e8.e552@mercurio.local>
 <OFD8BAEFA5.DFB30B72-ON65257D04.003375D0-65257D04.0033CFAA@LocalDomain>
 <OF15BEC543.459A8435-ON65257D04.0038DE02-65257D04.00391F1A@tcs.com>
 <etPan.53ad470e.140e0f76.e552@mercurio.local>
Message-ID: <etPan.53ad5a23.ded7263.e552@mercurio.local>

On 27 June 2014 at 14:28:44, Michael Klishin (mklishin at gopivotal.com) wrote:
> > We need to investigate before we can tell. The MQTT plugin test 
> suite uses
> Paho but there are no SSL-enabled tests as far as I can see.

So I can reproduce the error report you see in the log when there is something
wrong about the CA certificate/client certificate I use. That's something
we should report properly as a warning. However, I am able to connect
using Ruby and Python clients with SSL.

Will try with Paho next .
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jun 27 12:53:25 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 17:23:25 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad5a23.ded7263.e552@mercurio.local>
References: <OFCC802791.DE781762-ON65257D02.0032D8A2-65257D02.0032F19F@tcs.com>
 <OF622DC644.284A7395-ON65257D03.0030ADF3-65257D03.00312457@tcs.com>
 <etPan.53abe271.643c9869.1688@mercurio.local>
 <OF57DA6D45.9B0C83E4-ON65257D03.0033F183-65257D03.003479DB@tcs.com>
 <etPan.53abe970.66334873.1688@mercurio.local>
 <OF010D33AA.3DB8A6CE-ON65257D04.0021B716-65257D04.00223DC9@tcs.com>
 <etPan.53ad0e3f.7545e146.e552@mercurio.local>
 <etPan.53ad1717.5bd062c2.e552@mercurio.local>
 <OFBB04FAB3.F92E7344-ON65257D04.0032A38B-65257D04.0032E8D6@tcs.com>
 <etPan.53ad3760.1f16e9e8.e552@mercurio.local>
 <OFD8BAEFA5.DFB30B72-ON65257D04.003375D0-65257D04.0033CFAA@LocalDomain>
 <OF15BEC543.459A8435-ON65257D04.0038DE02-65257D04.00391F1A@tcs.com>
 <etPan.53ad470e.140e0f76.e552@mercurio.lo
 <etPan.53ad5a23.ded7263.e552@mercurio.local>
Message-ID: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>

Thanks , will be great if you come up with some example codes.

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   27-06-2014 17:19
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



On 27 June 2014 at 14:28:44, Michael Klishin (mklishin at gopivotal.com) 
wrote:
> > We need to investigate before we can tell. The MQTT plugin test 
> suite uses
> Paho but there are no SSL-enabled tests as far as I can see.

So I can reproduce the error report you see in the log when there is 
something
wrong about the CA certificate/client certificate I use. That's something
we should report properly as a warning. However, I am able to connect
using Ruby and Python clients with SSL.

Will try with Paho next .
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/0db47328/attachment.html>

From mklishin at gopivotal.com  Fri Jun 27 12:58:52 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 15:58:52 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
Message-ID: <etPan.53ad5c98.1befd79f.e552@mercurio.local>

On 27 June 2014 at 15:53:30, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Thanks , will be great if you come up with some example codes.  

I use the certificates and keys that tls-gen generates:
https://github.com/ruby-amqp/tls-gen

It only requires make and openssl installed to get running.

My Ruby example comes from the Ruby MQTT client:
https://gist.github.com/michaelklishin/dc3f8c44e081a26a2f3d?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jun 27 13:03:35 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 17:33:35 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad5c98.1befd79f.e552@mercurio.local>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
Message-ID: <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>

That is ok , but my requirement is PAHO client ssl connectivity to 
RabbitMQ broker. Please let me know the examples and results of your 
testing with PAHO client via ssl with rabbitmq MQTT.

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   27-06-2014 17:29
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



On 27 June 2014 at 15:53:30, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Thanks , will be great if you come up with some example codes. 

I use the certificates and keys that tls-gen generates:
https://github.com/ruby-amqp/tls-gen

It only requires make and openssl installed to get running.

My Ruby example comes from the Ruby MQTT client:
https://gist.github.com/michaelklishin/dc3f8c44e081a26a2f3d 
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/7abfd0aa/attachment.html>

From mklishin at gopivotal.com  Fri Jun 27 13:06:16 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 16:06:16 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
Message-ID: <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>

On 27 June 2014 at 16:05:03, Ankur5 C (ankur5.c at tcs.com) wrote:
> > That is ok , but my requirement is PAHO client ssl connectivity 
> to RabbitMQ broker. Please let me know the examples and results 
> of your testing with PAHO client via ssl with rabbitmq MQTT. 

My point was that so far it seems to be an environment-specific issue
or a Paho one but not RabbitMQ's. Try for yourself with any other client.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jun 27 13:09:40 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 17:39:40 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
Message-ID: <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>

As per I know PAHO is the best one for MQTT java client.

Could you please suggest any other java client which can connect to 
RabbitMQ MQTT over ssl?

Thanks and Regards,
Ankur Chakraborty



From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   27-06-2014 17:36
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



On 27 June 2014 at 16:05:03, Ankur5 C (ankur5.c at tcs.com) wrote:
> > That is ok , but my requirement is PAHO client ssl connectivity 
> to RabbitMQ broker. Please let me know the examples and results 
> of your testing with PAHO client via ssl with rabbitmq MQTT. 

My point was that so far it seems to be an environment-specific issue
or a Paho one but not RabbitMQ's. Try for yourself with any other client.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/202a47d1/attachment.html>

From mklishin at gopivotal.com  Fri Jun 27 13:12:36 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 16:12:36 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
Message-ID: <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>

On 27 June 2014 at 16:09:49, Ankur5 C (ankur5.c at tcs.com) wrote:
> > As per I know PAHO is the best one for MQTT java client.
>  
> Could you please suggest any other java client which can connect  
> to RabbitMQ MQTT over ssl?

Well there is one from FuseSource [1] but Paho Java is pretty
much the only game in town when it comes to widely used Java clients.?

Hang on, we still have to try with Paho (may happen only on Monday, though).

1.?https://github.com/fusesource/mqtt-client
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jun 27 13:19:49 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 27 Jun 2014 17:49:49 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
Message-ID: <OFC66E8E56.4787A670-ON65257D04.004394EF-65257D04.0043BC05@tcs.com>

Thanks , will wait till Monday. 

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   27-06-2014 17:43
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



On 27 June 2014 at 16:09:49, Ankur5 C (ankur5.c at tcs.com) wrote:
> > As per I know PAHO is the best one for MQTT java client.
> 
> Could you please suggest any other java client which can connect 
> to RabbitMQ MQTT over ssl?

Well there is one from FuseSource [1] but Paho Java is pretty
much the only game in town when it comes to widely used Java clients. 

Hang on, we still have to try with Paho (may happen only on Monday, 
though).

1. https://github.com/fusesource/mqtt-client
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/ed07e5a2/attachment.html>

From mklishin at gopivotal.com  Fri Jun 27 13:36:32 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 16:36:32 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad5c98.1befd79f.e552@mercurio.local>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
Message-ID: <etPan.53ad656d.25e45d32.e552@mercurio.local>

?On 27 June 2014 at 16:00:34, Michael Klishin (mklishin at gopivotal.com) wrote:
> > My Ruby example comes from the Ruby MQTT client:
> https://gist.github.com/michaelklishin/dc3f8c44e081a26a2f3d  

FTR, here's the Python one using Paho Python:
https://gist.github.com/michaelklishin/51a40e9560391b89ad0a
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jun 27 14:55:11 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 27 Jun 2014 17:55:11 +0400
Subject: [rabbitmq-discuss] Connection and channel age
In-Reply-To: <53A46AA5.8000908@noaa.gov>
References: <53A349F3.6010102@noaa.gov>
 <etPan.53a34bf0.1f16e9e8.172@mercurio.local> <53A46AA5.8000908@noaa.gov>
Message-ID: <etPan.53ad77dc.6b8b4567.17e64@mercurio.local>

?On 20 June 2014 at 21:09:56, James Gardner (james.gardner at noaa.gov) wrote:
> > Thanks!

This feature was added and will be in 3.4.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Fri Jun 27 15:10:51 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Fri, 27 Jun 2014 14:10:51 +0000
Subject: [rabbitmq-discuss] federation Issues
In-Reply-To: <53AD5159.9050008@rabbitmq.com>
References: <6DB033025329784B9280ABD9516177FCA2D0A8F1@USEPX2PMXMBX12.corp.altegrity.com>
 <53AD5159.9050008@rabbitmq.com>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D0B277@USEPX2PMXMBX12.corp.altegrity.com>

To your first question:

In production, federation links (specifically, x-federation-upstream under exchnages) show as: vHost | federation: e.fed.topic -> sharedfederationid:fed:e.fed.topic B, for example.  The sharedfederationid is used in the old parameters section as an explicit identity for a local user, hence, a user token.  I believe below you're calling this local_username, sorry for the confusion.  The dynamically created queues look much the same.

Now in dev, where we did the upgrade, a similar link would show as: vHost | federation: e.fed.topic -> ClusterName:fed:e.fed.topic B.  From what you're saying below, this is due to the change in the authentication manner - the local_username no longer need be applied.  There were some artifacts of the old federation style links, and when we've had fed problems in the past, they were resolved by deleting the x-federation-upstreams in fed and the affected vHost, as well as the related queues.  On deleting the dynamic queues, they would recreate and recreate the x-federation-upstreams, and everything would work.  That isn't happening this time.  If I publish to the e.fed.topic exchange in one vHost, it should publish to the queues in other vHosts that are bound to e.fed.topic with the same routing key, but right now the messages are vanishing - I'm having no luck tracing them.

All link statuses are Running.  Fed has an upstream to each vHost, and each vHost has an upstream to fed.

If I change the cluster name, will I have to delete all the dynamic streams again to get them to use the new name?

Thanks,
Kale


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Friday, June 27, 2014 6:11 AM
To: Legacy list about RabbitMQ; Ganann, Kale
Subject: Re: [rabbitmq-discuss] federation Issues

On 27/06/14 00:27, Ganann, Kale wrote:
> We just upgraded from 3.2.1 to 3.3.4 and federation died on us.  
> Looking at the cluster, it appears some... overenthusiastic dev 
> renamed the cluster

That should not be a problem.

 From 3.2.x to 3.3.x we changed from having the federation plugin give the cluster a name through the local_nodename parameter, to having a broker-wide cluster name that can be used by the federation plugin.

But the cluster name doesn't matter that much. It's used to name the queues which federation uses internally, and it shows up in transmitted bindings and messages so the plugin (and sysadmins) know where message have been. But it's not something you should have to get "correct" for things to work - there's no correct value.

> and now when federation creates new linkages, it creates them as 
> clustername:vHost:queue, rather than usertoken:vHost:queue.

I really do not understand any of this.

What do you mean by "linkages"? Bindings? Federation links (as shown in the status)? Something else?

Also, what do you mean by usertoken?

> Also, on
> the federation upstreams, the parameter field seems to have vanished, 
> so I can't update the user tokens for specific vHosts.

I guess you are saying something about the local_username or local_nodename fields here? local_username is gone, there is no need to configure it at all any more. local_nodename is replaced by the cluster name.

> I've been going
> through the patch notes - is this intentional, or is something else 
> going on?

The removal of local_username and local_nodename was intentional.

> And can I just remove the cluster name?

Clusters always have a name.

>  I've tried deleting
> the old dynamically created fed stuff so that it gets recreated, but 
> the new stuff just doesn't seem to work.  Any help is appreciated.

What does the link status look like?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal
This communication contains information that is confidential,
proprietary in nature, and may also be attorney-client privileged
and/or work product privileged. It is for the exclusive use of the
intended recipient(s). If you are not the intended recipient(s) or
the person responsible for delivering it to the intended
recipient(s), please note that any form of dissemination,
distribution or copying of this communication is strictly
prohibited and may be unlawful. If you have received this
communication in error, please immediately notify the sender by replying
to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees
or agents accept liability for any errors, omissions or damages
caused by delays of receipt or by any virus infection in this
message or its attachments, or which may otherwise arise as a
result of this e-mail transmission.


From KGanann at kroll.com  Fri Jun 27 17:23:21 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Fri, 27 Jun 2014 16:23:21 +0000
Subject: [rabbitmq-discuss] federation Issues
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D0B277@USEPX2PMXMBX12.corp.altegrity.com>
References: <6DB033025329784B9280ABD9516177FCA2D0A8F1@USEPX2PMXMBX12.corp.altegrity.com>
 <53AD5159.9050008@rabbitmq.com>
 <6DB033025329784B9280ABD9516177FCA2D0B277@USEPX2PMXMBX12.corp.altegrity.com>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D0B4DE@USEPX2PMXMBX12.corp.altegrity.com>

Update - we renamed the cluster to something meaningful and deleted all the dynamic objects so there were absolutely no artifacts left over.  We've got three vHosts with queues bound to e.fed.topic and the same routing key.  If I publish to the e.fed.topic on fed with that key, all three get it.  If I publish on vHost a, vHost b sometimes gets it, but not everytime, vHost c does not.  Similarly, we can publish to b, and sometimes a gets it, c does not.  Nothing published to c shows up anywhere else.

Thanks,
Kale


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ganann, Kale
Sent: Friday, June 27, 2014 9:11 AM
To: 'Simon MacMullen'; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] federation Issues

To your first question:

In production, federation links (specifically, x-federation-upstream under exchnages) show as: vHost | federation: e.fed.topic -> sharedfederationid:fed:e.fed.topic B, for example.  The sharedfederationid is used in the old parameters section as an explicit identity for a local user, hence, a user token.  I believe below you're calling this local_username, sorry for the confusion.  The dynamically created queues look much the same.

Now in dev, where we did the upgrade, a similar link would show as: vHost | federation: e.fed.topic -> ClusterName:fed:e.fed.topic B.  From what you're saying below, this is due to the change in the authentication manner - the local_username no longer need be applied.  There were some artifacts of the old federation style links, and when we've had fed problems in the past, they were resolved by deleting the x-federation-upstreams in fed and the affected vHost, as well as the related queues.  On deleting the dynamic queues, they would recreate and recreate the x-federation-upstreams, and everything would work.  That isn't happening this time.  If I publish to the e.fed.topic exchange in one vHost, it should publish to the queues in other vHosts that are bound to e.fed.topic with the same routing key, but right now the messages are vanishing - I'm having no luck tracing them.

All link statuses are Running.  Fed has an upstream to each vHost, and each vHost has an upstream to fed.

If I change the cluster name, will I have to delete all the dynamic streams again to get them to use the new name?

Thanks,
Kale


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: Friday, June 27, 2014 6:11 AM
To: Legacy list about RabbitMQ; Ganann, Kale
Subject: Re: [rabbitmq-discuss] federation Issues

On 27/06/14 00:27, Ganann, Kale wrote:
> We just upgraded from 3.2.1 to 3.3.4 and federation died on us.  
> Looking at the cluster, it appears some... overenthusiastic dev 
> renamed the cluster

That should not be a problem.

 From 3.2.x to 3.3.x we changed from having the federation plugin give the cluster a name through the local_nodename parameter, to having a broker-wide cluster name that can be used by the federation plugin.

But the cluster name doesn't matter that much. It's used to name the queues which federation uses internally, and it shows up in transmitted bindings and messages so the plugin (and sysadmins) know where message have been. But it's not something you should have to get "correct" for things to work - there's no correct value.

> and now when federation creates new linkages, it creates them as 
> clustername:vHost:queue, rather than usertoken:vHost:queue.

I really do not understand any of this.

What do you mean by "linkages"? Bindings? Federation links (as shown in the status)? Something else?

Also, what do you mean by usertoken?

> Also, on
> the federation upstreams, the parameter field seems to have vanished, 
> so I can't update the user tokens for specific vHosts.

I guess you are saying something about the local_username or local_nodename fields here? local_username is gone, there is no need to configure it at all any more. local_nodename is replaced by the cluster name.

> I've been going
> through the patch notes - is this intentional, or is something else 
> going on?

The removal of local_username and local_nodename was intentional.

> And can I just remove the cluster name?

Clusters always have a name.

>  I've tried deleting
> the old dynamically created fed stuff so that it gets recreated, but 
> the new stuff just doesn't seem to work.  Any help is appreciated.

What does the link status look like?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal
This communication contains information that is confidential, proprietary in nature, and may also be attorney-client privileged and/or work product privileged. It is for the exclusive use of the intended recipient(s). If you are not the intended recipient(s) or the person responsible for delivering it to the intended recipient(s), please note that any form of dissemination, distribution or copying of this communication is strictly prohibited and may be unlawful. If you have received this communication in error, please immediately notify the sender by replying to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees or agents accept liability for any errors, omissions or damages caused by delays of receipt or by any virus infection in this message or its attachments, or which may otherwise arise as a result of this e-mail transmission.

_______________________________________________
rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
please subscribe to the new list!

rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From KGanann at kroll.com  Fri Jun 27 21:13:12 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Fri, 27 Jun 2014 20:13:12 +0000
Subject: [rabbitmq-discuss] federation Issues
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D0B4DE@USEPX2PMXMBX12.corp.altegrity.com>
References: <6DB033025329784B9280ABD9516177FCA2D0A8F1@USEPX2PMXMBX12.corp.altegrity.com>
 <53AD5159.9050008@rabbitmq.com>
 <6DB033025329784B9280ABD9516177FCA2D0B277@USEPX2PMXMBX12.corp.altegrity.com>
 <6DB033025329784B9280ABD9516177FCA2D0B4DE@USEPX2PMXMBX12.corp.altegrity.com>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D0B858@USEPX2PMXMBX12.corp.altegrity.com>

Just tried rolling back one of the boxes to 3.2 - 3.2 is not liking whatever changes 3.3 made along the way, and is terminating on init.

Thanks,
Kale


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ganann, Kale
Sent: Friday, June 27, 2014 11:23 AM
To: Legacy list about RabbitMQ; 'Simon MacMullen'
Subject: Re: [rabbitmq-discuss] federation Issues

Update - we renamed the cluster to something meaningful and deleted all the dynamic objects so there were absolutely no artifacts left over.  We've got three vHosts with queues bound to e.fed.topic and the same routing key.  If I publish to the e.fed.topic on fed with that key, all three get it.  If I publish on vHost a, vHost b sometimes gets it, but not everytime, vHost c does not.  Similarly, we can publish to b, and sometimes a gets it, c does not.  Nothing published to c shows up anywhere else.

Thanks,
Kale


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ganann, Kale
Sent: Friday, June 27, 2014 9:11 AM
To: 'Simon MacMullen'; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] federation Issues

To your first question:

In production, federation links (specifically, x-federation-upstream under exchnages) show as: vHost | federation: e.fed.topic -> sharedfederationid:fed:e.fed.topic B, for example.  The sharedfederationid is used in the old parameters section as an explicit identity for a local user, hence, a user token.  I believe below you're calling this local_username, sorry for the confusion.  The dynamically created queues look much the same.

Now in dev, where we did the upgrade, a similar link would show as: vHost | federation: e.fed.topic -> ClusterName:fed:e.fed.topic B.  From what you're saying below, this is due to the change in the authentication manner - the local_username no longer need be applied.  There were some artifacts of the old federation style links, and when we've had fed problems in the past, they were resolved by deleting the x-federation-upstreams in fed and the affected vHost, as well as the related queues.  On deleting the dynamic queues, they would recreate and recreate the x-federation-upstreams, and everything would work.  That isn't happening this time.  If I publish to the e.fed.topic exchange in one vHost, it should publish to the queues in other vHosts that are bound to e.fed.topic with the same routing key, but right now the messages are vanishing - I'm having no luck tracing them.

All link statuses are Running.  Fed has an upstream to each vHost, and each vHost has an upstream to fed.

If I change the cluster name, will I have to delete all the dynamic streams again to get them to use the new name?

Thanks,
Kale


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: Friday, June 27, 2014 6:11 AM
To: Legacy list about RabbitMQ; Ganann, Kale
Subject: Re: [rabbitmq-discuss] federation Issues

On 27/06/14 00:27, Ganann, Kale wrote:
> We just upgraded from 3.2.1 to 3.3.4 and federation died on us.  
> Looking at the cluster, it appears some... overenthusiastic dev 
> renamed the cluster

That should not be a problem.

 From 3.2.x to 3.3.x we changed from having the federation plugin give the cluster a name through the local_nodename parameter, to having a broker-wide cluster name that can be used by the federation plugin.

But the cluster name doesn't matter that much. It's used to name the queues which federation uses internally, and it shows up in transmitted bindings and messages so the plugin (and sysadmins) know where message have been. But it's not something you should have to get "correct" for things to work - there's no correct value.

> and now when federation creates new linkages, it creates them as 
> clustername:vHost:queue, rather than usertoken:vHost:queue.

I really do not understand any of this.

What do you mean by "linkages"? Bindings? Federation links (as shown in the status)? Something else?

Also, what do you mean by usertoken?

> Also, on
> the federation upstreams, the parameter field seems to have vanished, 
> so I can't update the user tokens for specific vHosts.

I guess you are saying something about the local_username or local_nodename fields here? local_username is gone, there is no need to configure it at all any more. local_nodename is replaced by the cluster name.

> I've been going
> through the patch notes - is this intentional, or is something else 
> going on?

The removal of local_username and local_nodename was intentional.

> And can I just remove the cluster name?

Clusters always have a name.

>  I've tried deleting
> the old dynamically created fed stuff so that it gets recreated, but 
> the new stuff just doesn't seem to work.  Any help is appreciated.

What does the link status look like?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal
This communication contains information that is confidential, proprietary in nature, and may also be attorney-client privileged and/or work product privileged. It is for the exclusive use of the intended recipient(s). If you are not the intended recipient(s) or the person responsible for delivering it to the intended recipient(s), please note that any form of dissemination, distribution or copying of this communication is strictly prohibited and may be unlawful. If you have received this communication in error, please immediately notify the sender by replying to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees or agents accept liability for any errors, omissions or damages caused by delays of receipt or by any virus infection in this message or its attachments, or which may otherwise arise as a result of this e-mail transmission.

_______________________________________________
rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
please subscribe to the new list!

rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
please subscribe to the new list!

rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mklishin at gopivotal.com  Fri Jun 27 22:16:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 28 Jun 2014 01:16:38 +0400
Subject: [rabbitmq-discuss] federation Issues
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D0B858@USEPX2PMXMBX12.corp.altegrity.com>
References: <6DB033025329784B9280ABD9516177FCA2D0A8F1@USEPX2PMXMBX12.corp.altegrity.com>
 <53AD5159.9050008@rabbitmq.com>
 <6DB033025329784B9280ABD9516177FCA2D0B277@USEPX2PMXMBX12.corp.altegrity.com>
 <6DB033025329784B9280ABD9516177FCA2D0B4DE@USEPX2PMXMBX12.corp.altegrity.com>
 <6DB033025329784B9280ABD9516177FCA2D0B858@USEPX2PMXMBX12.corp.altegrity.com>
Message-ID: <etPan.53addf55.643c9869.5658@mercurio.local>

On 28 June 2014 at 00:14:27, Ganann, Kale (kganann at kroll.com) wrote:
> > Just tried rolling back one of the boxes to 3.2 - 3.2 is not liking 
> whatever changes 3.3 made along the way, and is terminating on 
> init.

Database migrations are one way: you need to back up RabbitMQ's database
directory if you intend to go back to an earlier version.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From jaishreegn at gmail.com  Fri Jun 27 22:44:22 2014
From: jaishreegn at gmail.com (jayashree gn)
Date: Fri, 27 Jun 2014 15:44:22 -0600
Subject: [rabbitmq-discuss] rabbitmq crash
Message-ID: <CAMzJFOSuGC0gYOx8AV2dARVYQ3pwh7ughkgjS6MCexrGrpnK8Q@mail.gmail.com>

Hi All,

Anybody can help what this crash means? 3 instances in a cluster (version
3.3.1) all crashed at the same time.
But surprisingly on one instance even if the service was down, the port
5672 was still active. which kept the health check active.

Any help on this is appreciated.  Thanks!


=CRASH REPORT==== 27-Jun-2014::20:04:05 ===
  crasher:
    initial call: mochiweb_acceptor:init/3
    pid: <0.21001.388>
    registered_name: []
    exception exit: {error,accept_failed}
      in function  mochiweb_acceptor:init/3
    ancestors: [rabbit_web_dispatch_sup_15672,rabbit_web_dispatch_sup,
                  <0.1519.0>]
    messages: []
    links: [<0.1526.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 610
    stack_size: 24
    reductions: 4329
  neighbours:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/1f46c617/attachment.html>

From particlesquirrel at gmail.com  Fri Jun 27 20:55:33 2014
From: particlesquirrel at gmail.com (Daniel Burke)
Date: Fri, 27 Jun 2014 12:55:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster hung on node death
Message-ID: <f09a0300-52e1-489a-9da8-8d887b519ebd@googlegroups.com>

Today we had the physical machine of a dedicated node kernel panic (linux 
centos 6)... when that happened the other two nodes in the cluster seemed 
to choke, and not respond at all.

"rabbitmqctl cluster_status" on either of the other nodes would hang.

The web management UI didn't respond.  I could get a login page to come up 
but after that it would go back to not responding.

When the crashed machine came back up, without starting rabbitmq on it, 
once networking was responding, the other two nodes seemed to free up and 
start operating normally again.

After the rest of the cluster was operating normally again, we brought down 
the crashed machine to do a memtest, and we didn't experience the cluster 
freeze again (rabbitmq was not ever started back up on the failed node).

This cluster (we went live with multiple clusters yesterday), is running 3 
physical dedicated machines.  All of them are on centos 6.  RabbitMQ v 
3.3.2.  All nodes are disc nodes.  All queues are durable and mirrored. 
 This cluster has one queue, plus 1000's of dynamic shovels (which of 
course includes their own queues on this cluster) connecting to queues on 3 
other clusters with similar setups.  Each node has about 7gig of disk free 
on the relevant partition, and 48gig of ram with the high_water_mark set to 
0.9, but even at diminished capacity right now, the most ram used is 1.2gig 
on one node and 600meg on the other (these boxes were way over built with 
short-term growth in mind).

Sadly, there was nothing in the logs.  We realized this might be related to 
the logging bug fixed in 3.3.3, so we just upgraded our dev environment to 
start the process to deal with that.

Any thoughts on what the cause of this freeze up could have been?  And how 
to mitigate it?  Or any troubleshooting / information gathering we could do 
if it happens again?  It's a scary thing now to have happen on a friday 
afternoon.  We were counting on three node clusters getting us through if 
there was an outage of a node during the weekend... but now we're all 
afraid to go home for the weekend!

Thanks!
Dan.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/bf44396b/attachment.html>

From mr.xchang at gmail.com  Sat Jun 28 00:24:02 2014
From: mr.xchang at gmail.com (Xicheng Chang)
Date: Fri, 27 Jun 2014 16:24:02 -0700
Subject: [rabbitmq-discuss] inet_dist_listen port range for cluster firewall
	config
Message-ID: <CAG-Y8sct1dg2Ei9QnUq4MfY_am2edHSoVTRA0PvsvWbJa=Lgnw@mail.gmail.com>

Hi All,

I have been trying to understand below config in
/etc/rabbitmq/rabbitmq.config:
{inet_dist_listen_min, 9100},
{inet_dist_listen_max, 9105},

I understand that one port has to be open from firewall for rabbit
distributed nodes to talk to each other. But I have difficulties
understanding the benefit of configuring more than one node. Also in what
scenario will epmd invoke second node in that range?

Thanks

-- 
*-Xicheng Chang*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/05d72e92/attachment.html>

From mr.xchang at gmail.com  Sat Jun 28 02:07:48 2014
From: mr.xchang at gmail.com (Xicheng Chang)
Date: Fri, 27 Jun 2014 18:07:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Sequencing
Message-ID: <41fa731f-763e-4763-b265-46c1bc8574ef@googlegroups.com>

Greetings,

I have a 2 node mq cluster that is configured as active/active for HA 
purposes. How does the cluster ensure that all the messages(in different 
queues) get delivered to the receiver in the same order they were sent to 
the queue cluster?

Thanks!

Chang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/52e4fac2/attachment.html>

From mklishin at gopivotal.com  Sat Jun 28 06:27:28 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 28 Jun 2014 09:27:28 +0400
Subject: [rabbitmq-discuss] rabbitmq crash
In-Reply-To: <CAMzJFOSuGC0gYOx8AV2dARVYQ3pwh7ughkgjS6MCexrGrpnK8Q@mail.gmail.com>
References: <CAMzJFOSuGC0gYOx8AV2dARVYQ3pwh7ughkgjS6MCexrGrpnK8Q@mail.gmail.com>
Message-ID: <etPan.53ae525f.6b8b4567.5866@mercurio.local>

On 28 June 2014 at 01:46:34, jayashree gn (jaishreegn at gmail.com) wrote:
> > =CRASH REPORT==== 27-Jun-2014(http://airmail.calendar/2014-06-27%2012:00:00%20GMT+4)::20:04:05 
> === crasher: initial call: mochiweb_acceptor:init/3 pid: 
> <0.21001.388> registered_name: [] exception exit: {error,accept_failed} 
> in function mochiweb_acceptor:init/3 ancestors: [rabbit_web_dispatch_sup_15672,rabbit_web_dispatch_sup, 
> 

This particular error means accept(2) failed for an HTTP connection.
It should not prevent RabbitMQ from running, only the management plugin
can be affected ("crash" here means Erlang process crash, not VM crash).

Are you sure there's nothing else in the log? and that OS processes terminated
(as opposed to e.g. rejecting connections)?
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Sat Jun 28 06:30:43 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 28 Jun 2014 09:30:43 +0400
Subject: [rabbitmq-discuss] Cluster Sequencing
In-Reply-To: <41fa731f-763e-4763-b265-46c1bc8574ef@googlegroups.com>
References: <41fa731f-763e-4763-b265-46c1bc8574ef@googlegroups.com>
Message-ID: <etPan.53ae5320.66334873.5866@mercurio.local>

On 28 June 2014 at 05:10:02, Xicheng Chang (mr.xchang at gmail.com) wrote:
> > How does the cluster ensure that all the messages(in different  
> queues) get delivered to the receiver in the same order they were  
> sent to the queue cluster?

Every queue in a cluster has a master node (the node where it was declared).
All messages routed to that queue go through it (even if publishers and consumers
using it connect to other cluster nodes). So, the queue master basically performs
coordination.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From tamer_hat at hotmail.com  Sat Jun 28 08:03:22 2014
From: tamer_hat at hotmail.com (tamer hatoum)
Date: Sat, 28 Jun 2014 07:03:22 +0000
Subject: [rabbitmq-discuss] rabbitMQ with Asp.net
Message-ID: <DUB124-W370943985EC5C99C00F083821A0@phx.gbl>

I am using RabbitMQ to get real time data. I make the connection and am getting data successfully. I am able to print it in the Debug line, but its not updating my Label.here is my code:private void InitRabbit()
{

    factory.UserName = this.user;
    factory.Password = this.password;
    factory.HostName = this.host;
    factory.VirtualHost = "/";

    try
    {
        using (IConnection connection = factory.CreateConnection())
        {
            using (IModel channel = connection.CreateModel())
            {
                channel.ExchangeDeclare(realTimeExchange, "topic");
                string queueName = channel.QueueDeclare();
                StringBuilder sb = new StringBuilder();
                sb.Append("QEH").Append(".").Append("QEH").Append(".*");
                channel.QueueBind(queueName, realTimeExchange, sb.ToString());
                Console.WriteLine("Waiting for messages");
                QueueingBasicConsumer consumer = new QueueingBasicConsumer(channel);
                channel.BasicConsume(queueName, true, consumer);
                while (true)
                {
                    BasicDeliverEventArgs e = (BasicDeliverEventArgs)consumer.Queue.Dequeue();
                    Console.WriteLine(Encoding.ASCII.GetString(e.Body));
                    string msg = Encoding.ASCII.GetString(e.Body);
                    JavaScriptSerializer ser = new JavaScriptSerializer();
                    Alerts alert = ser.Deserialize<Alerts>(msg);
                    updatealert(alert); //for getting the Alerts which is my internal class
                }
            }
            rabbitrunning = true;
        }
    }
    catch (Exception ex)
    {
        System.Diagnostics.Debug.WriteLine("Rabbit not running : " + ex.Message);
    }
}Here is my updatealert function:private void updatealert(Alerts alert)
{
    alertext.Text = "Count " + alert.CarName;
    System.Diagnostics.Debug.WriteLine("publish : " + alert.CarName);//its writting the message correctly but its not updating my Alertext label. 
}Here is the update panel structure:<asp:ScriptManager ID="ScriptManager1"  runat="server">
</asp:ScriptManager>
<asp:UpdatePanel ID="UpdatePanel1" runat="server" UpdateMode="Always" ChildrenAsTriggers="true">
    <ContentTemplate>
        <legend>UpdatePanel</legend>
         <asp:Label ID="alertext" runat="server" Text="change" ></asp:Label>
         <asp:Label ID="Label1" runat="server" Text="change" ></asp:Label>
    </ContentTemplate>
    <Triggers>
        <asp:AsyncPostBackTrigger ControlID="Button1" EventName="Click" />
    </Triggers>
</asp:UpdatePanel>
<asp:Button ID="Button1" runat="server" onclick="Button1_Click" Text="Get Real Data" />How do I change the label text while rabbitMQ is updating the content?UPDATES : After Long Trail and error I found that the rabbit is sending a lot of messages per second so the Update panel is not updating fast , so I tried to put the Update panel job in other thread but I have not succeeded , is there any advice how to update the panel with handling very fast process ?Regards. 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140628/38c9b084/attachment.html>

From tamer84hatoum at gmail.com  Sat Jun 28 07:23:05 2014
From: tamer84hatoum at gmail.com (tamer hatoum)
Date: Fri, 27 Jun 2014 23:23:05 -0700 (PDT)
Subject: [rabbitmq-discuss] able to get Msg in debug line but Cannot Get it
	to Asp.net Page
Message-ID: <15d84b0c-822b-489d-8a91-ce7220850d5d@googlegroups.com>



I am using RabbitMQ to get real time data. I make the connection and am 
getting data successfully. I am able to print it in the Debug line, but its 
not updating my Label.

here is my code:

private void InitRabbit(){

    factory.UserName = this.user;
    factory.Password = this.password;
    factory.HostName = this.host;
    factory.VirtualHost = "/";

    try
    {
        using (IConnection connection = factory.CreateConnection())
        {
            using (IModel channel = connection.CreateModel())
            {
                channel.ExchangeDeclare(realTimeExchange, "topic");
                string queueName = channel.QueueDeclare();
                StringBuilder sb = new StringBuilder();
                sb.Append("QEH").Append(".").Append("QEH").Append(".*");
                channel.QueueBind(queueName, realTimeExchange, sb.ToString());
                Console.WriteLine("Waiting for messages");
                QueueingBasicConsumer consumer = new QueueingBasicConsumer(channel);
                channel.BasicConsume(queueName, true, consumer);
                while (true)
                {
                    BasicDeliverEventArgs e = (BasicDeliverEventArgs)consumer.Queue.Dequeue();
                    Console.WriteLine(Encoding.ASCII.GetString(e.Body));
                    string msg = Encoding.ASCII.GetString(e.Body);
                    JavaScriptSerializer ser = new JavaScriptSerializer();
                    Alerts alert = ser.Deserialize<Alerts>(msg);
                    updatealert(alert); //for getting the Alerts which is my internal class
                }
            }
            rabbitrunning = true;
        }
    }
    catch (Exception ex)
    {
        System.Diagnostics.Debug.WriteLine("Rabbit not running : " + ex.Message);
    }}

Here is my updatealert function:

private void updatealert(Alerts alert){
    alertext.Text = "Count " + alert.CarName;
    System.Diagnostics.Debug.WriteLine("publish : " + alert.CarName);//its writting the message correctly but its not updating my Alertext label. }

Here is the update panel structure:

<asp:ScriptManager ID="ScriptManager1"  runat="server"></asp:ScriptManager><asp:UpdatePanel ID="UpdatePanel1" runat="server" UpdateMode="Always" ChildrenAsTriggers="true">
    <ContentTemplate>
        <legend>UpdatePanel</legend>
         <asp:Label ID="alertext" runat="server" Text="change" ></asp:Label>
         <asp:Label ID="Label1" runat="server" Text="change" ></asp:Label>
    </ContentTemplate>
    <Triggers>
        <asp:AsyncPostBackTrigger ControlID="Button1" EventName="Click" />
    </Triggers></asp:UpdatePanel><asp:Button ID="Button1" runat="server" onclick="Button1_Click" Text="Get Real Data" />

How do I change the label text while rabbitMQ is updating the content?

*UPDATES : After Long Trail and error I found that the rabbit is sending a 
lot of messages per second so the Update panel is not updating fast , so I 
tried to put the Update panel job in other thread but I have not succeeded 
, is there any advice how to update the panel with handling very fast 
process ?*

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140627/3e9b2602/attachment.html>

From 37714275 at qq.com  Mon Jun 30 04:26:42 2014
From: 37714275 at qq.com (=?utf-8?B?emFuZQ==?=)
Date: Mon, 30 Jun 2014 11:26:42 +0800
Subject: [rabbitmq-discuss] No timeout and sockets not closed for Stomp
Message-ID: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>

Dear RabbitMQ:
    we use stomp plugin. when we have many users to sub/pub. we found the sockets not closed.
and no timeout. our socket descriptors will be full after sometime. so can you help me? thanks lots.


Best Regards
?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/57ade1a1/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 06:22:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 09:22:54 +0400
Subject: [rabbitmq-discuss] No timeout and sockets not closed for Stomp
In-Reply-To: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
References: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
Message-ID: <etPan.53b0f44c.625558ec.107eb@mercurio.local>

?On 30 June 2014 at 07:28:03, zane (37714275 at qq.com) wrote:
> > we use stomp plugin. when we have many users to sub/pub. we found  
> the sockets not closed.
> and no timeout. our socket descriptors will be full after sometime.  
> so can you help me?

Can you be more specific about what exactly happens?

Detecting unreachable peer with TCP can take a while and the timeout
can be configured OS-wide.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun 30 07:17:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 10:17:29 +0400
Subject: [rabbitmq-discuss] rabbitMQ with Asp.net
In-Reply-To: <DUB124-W370943985EC5C99C00F083821A0@phx.gbl>
References: <DUB124-W370943985EC5C99C00F083821A0@phx.gbl>
Message-ID: <etPan.53b10115.507ed7ab.107eb@mercurio.local>

On 28 June 2014 at 11:04:40, tamer hatoum (tamer_hat at hotmail.com) wrote:
> > I am using RabbitMQ to get real time data. I make the connection  
> and am getting data successfully. I am able to print it in the Debug  
> line, but its not updating my Label.

This is an ASP.NET question. Keep in mind that deliveries with RabbitMQ arrive
asynchronously while a lot of Web app requests follow the request/response pattern.
This means you need to find a way to update UI elements based on events that are
not tied to HTTP requests, the problem is not ?RabbitMQ-specific.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From 37714275 at qq.com  Mon Jun 30 07:19:21 2014
From: 37714275 at qq.com (=?utf-8?B?emFuZQ==?=)
Date: Mon, 30 Jun 2014 14:19:21 +0800
Subject: [rabbitmq-discuss] =?utf-8?b?5Zue5aSN77yaICBObyB0aW1lb3V0IGFuZCBz?=
 =?utf-8?q?ockets_not_closed_forStomp?=
In-Reply-To: <etPan.53b0f44c.625558ec.107eb@mercurio.local>
References: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
 <etPan.53b0f44c.625558ec.107eb@mercurio.local>
Message-ID: <tencent_7248F6C26623F1F55B67146E@qq.com>

My OS:
[www at 10-9-15-42 ~]$ uname -a
Linux 10-9-15-42 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux?



we use stomp plugin for send message between users. we didn't configure queues. our business is on line transaction.
our connections are increasing, but we know that connections should not be so high in morning. and we found no timeout
for connections. so can you tell me how the timeout be configured OS-wide? thanks lot.
??

------------------ ???? ------------------
???: "Michael Klishin";<mklishin at gopivotal.com>;
????: 2014?6?30?(???) ??1:22
???: "zane"<37714275 at qq.com>; "Legacy list about RabbitMQ"<rabbitmq-discuss at lists.rabbitmq.com>; 

??: Re: [rabbitmq-discuss] No timeout and sockets not closed forStomp



 On 30 June 2014 at 07:28:03, zane (37714275 at qq.com) wrote:
> > we use stomp plugin. when we have many users to sub/pub. we found  
> the sockets not closed.
> and no timeout. our socket descriptors will be full after sometime.  
> so can you help me?

Can you be more specific about what exactly happens?

Detecting unreachable peer with TCP can take a while and the timeout
can be configured OS-wide.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/d4087aa2/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 07:24:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 10:24:57 +0400
Subject: [rabbitmq-discuss] =?utf-8?Q?=E5=9B=9E=E5=A4=8D=EF=BC=9A__?=No
 timeout and sockets not closed forStomp
In-Reply-To: <tencent_7248F6C26623F1F55B67146E@qq.com>
References: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
 <etPan.53b0f44c.625558ec.107eb@mercurio.local>
 <tencent_7248F6C26623F1F55B67146E@qq.com>
Message-ID: <etPan.53b102d2.41b71efb.107eb@mercurio.local>

On 30 June 2014 at 10:20:27, zane (37714275 at qq.com) wrote:
> > our connections are increasing, but we know that connections  
> should not be so high in morning. and we found no timeout
> for connections.?

Are you sure your apps properly close the connections they no longer need?
Have you tried enabling STOMP heartbeats? [1]?

> so can you tell me how the timeout be configured  
> OS-wide?

[2], [3]

1.?http://stomp.github.io/stomp-specification-1.2.html#Heart-beating
2.?http://en.wikipedia.org/wiki/Keepalive#TCP_keepalive
3.?http://www.cyberciti.biz/tips/linux-increasing-or-decreasing-tcp-sockets-timeouts.html
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From 37714275 at qq.com  Mon Jun 30 07:27:31 2014
From: 37714275 at qq.com (=?utf-8?B?emFuZQ==?=)
Date: Mon, 30 Jun 2014 14:27:31 +0800
Subject: [rabbitmq-discuss] =?utf-8?b?5Zue5aSN77yaIOWbnuWkje+8miAgTm8gdGlt?=
 =?utf-8?q?eout_and_sockets_notclosed_forStomp?=
In-Reply-To: <etPan.53b102d2.41b71efb.107eb@mercurio.local>
References: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
 <etPan.53b0f44c.625558ec.107eb@mercurio.local>
 <tencent_7248F6C26623F1F55B67146E@qq.com>
 <etPan.53b102d2.41b71efb.107eb@mercurio.local>
Message-ID: <tencent_6D1773092DFEFC8C187EAD4B@qq.com>

I think we start heartbeat. this is rabbitmq.config?
	{rabbitmq_stomp,[ 
                {tcp_listeners, [61613]},
		{heartbeat,200}
         ]}?





------------------ ???? ------------------
???: "Michael Klishin";<mklishin at gopivotal.com>;
????: 2014?6?30?(???) ??2:24
???: "zane"<37714275 at qq.com>; "Legacy list about RabbitMQ"<rabbitmq-discuss at lists.rabbitmq.com>; 

??: Re: [rabbitmq-discuss]???  No timeout and sockets notclosed forStomp



On 30 June 2014 at 10:20:27, zane (37714275 at qq.com) wrote:
> > our connections are increasing, but we know that connections  
> should not be so high in morning. and we found no timeout
> for connections. 

Are you sure your apps properly close the connections they no longer need?
Have you tried enabling STOMP heartbeats? [1] 

> so can you tell me how the timeout be configured  
> OS-wide?

[2], [3]

1. http://stomp.github.io/stomp-specification-1.2.html#Heart-beating
2. http://en.wikipedia.org/wiki/Keepalive#TCP_keepalive
3. http://www.cyberciti.biz/tips/linux-increasing-or-decreasing-tcp-sockets-timeouts.html
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/f6668858/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 07:28:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 10:28:00 +0400
Subject: [rabbitmq-discuss] =?utf-8?Q?=E5=9B=9E=E5=A4=8D=EF=BC=9A__?=No
 timeout and sockets not closed forStomp
In-Reply-To: <etPan.53b102d2.41b71efb.107eb@mercurio.local>
References: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
 <etPan.53b0f44c.625558ec.107eb@mercurio.local>
 <tencent_7248F6C26623F1F55B67146E@qq.com>
 <etPan.53b102d2.41b71efb.107eb@mercurio.local>
Message-ID: <etPan.53b1038e.7545e146.107eb@mercurio.local>

On 30 June 2014 at 10:26:35, Michael Klishin (mklishin at gopivotal.com) wrote:
> > [2], [3]

?as well as

http://www.sekuda.com/overriding_the_default_linux_kernel_20_second_tcp_socket_connect_timeout
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun 30 07:34:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 10:34:57 +0400
Subject: [rabbitmq-discuss]
 =?utf-8?Q?=E5=9B=9E=E5=A4=8D=EF=BC=9A_=5Brabbitmq-discuss=5D=E5=9B=9E=E5=A4=8D=EF=BC=9A__?=No
 timeout and sockets notclosed forStomp
In-Reply-To: <tencent_6D1773092DFEFC8C187EAD4B@qq.com>
References: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
 <etPan.53b0f44c.625558ec.107eb@mercurio.local>
 <tencent_7248F6C26623F1F55B67146E@qq.com>
 <etPan.53b102d2.41b71efb.107eb@mercurio.local>
 <tencent_6D1773092DFEFC8C187EAD4B@qq.com>
Message-ID: <etPan.53b1052f.5bd062c2.107eb@mercurio.local>

On 30 June 2014 at 10:27:34, zane (37714275 at qq.com) wrote:
> > I think we start heartbeat. this is rabbitmq.config
> {rabbitmq_stomp,[
> {tcp_listeners, [61613]},
> {heartbeat,200}
> ]}

Heartbeats in STOMP are bi-directional and are specified by clients on connection
using the "heart-beat" header.

RabbitMQ assumes 0,0 (no heartbeats) by default. Currently there is no way
to configure default server heartbeat. Perhaps there should be but
you want to configure *client* heartbeats, too .

See?http://stomp.github.io/stomp-specification-1.2.html#Heart-beating
and your STOMP client documentation. A good default is 10-20 seconds, symmetric,
e.g. "15,15".
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From 37714275 at qq.com  Mon Jun 30 07:39:46 2014
From: 37714275 at qq.com (=?utf-8?B?emFuZQ==?=)
Date: Mon, 30 Jun 2014 14:39:46 +0800
Subject: [rabbitmq-discuss] =?utf-8?b?5Zue5aSN77yaIOWbnuWkje+8miAgTm90aW1l?=
 =?utf-8?q?out_and_sockets_notclosed_forStomp?=
In-Reply-To: <etPan.53b1052f.5bd062c2.107eb@mercurio.local>
References: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
 <etPan.53b0f44c.625558ec.107eb@mercurio.local>
 <tencent_7248F6C26623F1F55B67146E@qq.com>
 <etPan.53b102d2.41b71efb.107eb@mercurio.local>
 <tencent_6D1773092DFEFC8C187EAD4B@qq.com>
 <etPan.53b1052f.5bd062c2.107eb@mercurio.local>
Message-ID: <tencent_5DF2FD160F3E74461521B917@qq.com>

thanks lot.
In the feature,  will RabbitMQ stomp can ?configure default server heartbeat??
you know stomp 1.0 can't ?configure ?heartbeat. thanks lot.?




------------------ ???? ------------------
???: "Michael Klishin";<mklishin at gopivotal.com>;
????: 2014?6?30?(???) ??2:34
???: "zane"<37714275 at qq.com>; "rabbitmq-discuss"<rabbitmq-discuss at lists.rabbitmq.com>; 

??: Re:??? [rabbitmq-discuss]???  Notimeout and sockets notclosed forStomp



On 30 June 2014 at 10:27:34, zane (37714275 at qq.com) wrote:
> > I think we start heartbeat. this is rabbitmq.config
> {rabbitmq_stomp,[
> {tcp_listeners, [61613]},
> {heartbeat,200}
> ]}

Heartbeats in STOMP are bi-directional and are specified by clients on connection
using the "heart-beat" header.

RabbitMQ assumes 0,0 (no heartbeats) by default. Currently there is no way
to configure default server heartbeat. Perhaps there should be but
you want to configure *client* heartbeats, too .

See http://stomp.github.io/stomp-specification-1.2.html#Heart-beating
and your STOMP client documentation. A good default is 10-20 seconds, symmetric,
e.g. "15,15".
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/0c6ac5db/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 07:40:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 10:40:47 +0400
Subject: [rabbitmq-discuss]
 =?utf-8?Q?=E5=9B=9E=E5=A4=8D=EF=BC=9A_=5Brabbitmq-discuss=5D=E5=9B=9E=E5=A4=8D=EF=BC=9A__?=Notimeout
 and sockets notclosed forStomp
In-Reply-To: <tencent_5DF2FD160F3E74461521B917@qq.com>
References: <tencent_39F0DDDC19EFBFC87F9C1BE0@qq.com>
 <etPan.53b0f44c.625558ec.107eb@mercurio.local>
 <tencent_7248F6C26623F1F55B67146E@qq.com>
 <etPan.53b102d2.41b71efb.107eb@mercurio.local>
 <tencent_6D1773092DFEFC8C187EAD4B@qq.com>
 <etPan.53b1052f.5bd062c2.107eb@mercurio.local>
 <tencent_5DF2FD160F3E74461521B917@qq.com>
Message-ID: <etPan.53b1068c.12200854.107eb@mercurio.local>

On 30 June 2014 at 10:39:54, zane (37714275 at qq.com) wrote:
> > In the feature, will RabbitMQ stomp can configure default server  
> heartbeat?
> you know stomp 1.0 can't configure heartbeat. thanks lot.  

This is a very ?reasonable feature request, I will file a bug.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From loganathan.ms at gmail.com  Mon Jun 30 07:44:02 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Mon, 30 Jun 2014 12:14:02 +0530
Subject: [rabbitmq-discuss] [RUBY-AMQP GEM] How to enable hostname
	verification in auth ssl
Message-ID: <CAD_i5MEfpDX2Ss7niqENcUtzH3o2ABX8MmbonO-uZc4j0iJSrg@mail.gmail.com>

Hi All,

Currently I am connecting to the RMQ Server from my Rails app using SSL
authentication mechanism. This is working fine, but I want to enable the
hostname verification while accepting SSL connection from RMQ, what is the
proper way to achieve this.

regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/c9972c5f/attachment.html>

From ankur5.c at tcs.com  Mon Jun 30 08:40:50 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Mon, 30 Jun 2014 13:10:50 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
Message-ID: <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>

Hi Michael,

Just wanted to know of any update on using PAHO for RabbitMQ MQTT over SSL 
?

Thanks and Regards,
Ankur Chakraborty



From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   27-06-2014 17:43
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



On 27 June 2014 at 16:09:49, Ankur5 C (ankur5.c at tcs.com) wrote:
> > As per I know PAHO is the best one for MQTT java client.
> 
> Could you please suggest any other java client which can connect 
> to RabbitMQ MQTT over ssl?

Well there is one from FuseSource [1] but Paho Java is pretty
much the only game in town when it comes to widely used Java clients. 

Hang on, we still have to try with Paho (may happen only on Monday, 
though).

1. https://github.com/fusesource/mqtt-client
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/692921f8/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 09:53:01 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 12:53:01 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
 <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
Message-ID: <etPan.53b12587.6b8b4567.1759a@mercurio.local>

On 30 June 2014 at 11:42:03, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Just wanted to know of any update on using PAHO for RabbitMQ MQTT  
> over SSL ?

It works just like Paho Python and Ruby clients.

Here's my basic example:
https://gist.github.com/michaelklishin/5d8c9279c0c11352a2c8

I generated a CA, client and server key/certificate using?https://github.com/ruby-amqp/tls-gen
and PASSWORD=bunnies, imported them into a Java key store with

keytool -importcert -alias rmq-server -file /path/to/result/server_certificate.pem -keystore /path/to/result/jvm_keystore

rabbitmq.config (/path/to/result above for me is "/Users/antares/Tools/rabbitmq/tls")

https://gist.github.com/michaelklishin/4b4785884dcf279039a8

and voil?:?

=INFO REPORT==== 30-Jun-2014::12:46:44 ===
accepting MQTT connection (127.0.0.1:60338 -> 127.0.0.1:8883)
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun 30 09:57:48 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 12:57:48 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53b12587.6b8b4567.1759a@mercurio.local>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
 <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
 <etPan.53b12587.6b8b4567.1759a@mercurio.local>
Message-ID: <etPan.53b126a6.643c9869.1759a@mercurio.local>

?On 30 June 2014 at 12:53:28, Michael Klishin (mklishin at gopivotal.com) wrote:
> > It works just like Paho Python and Ruby clients.

I've pushed all 3 examples I've used to GitHub:

https://github.com/michaelklishin/mqtt-tls-playground
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From rom.t.cabral at gmail.com  Mon Jun 30 10:14:01 2014
From: rom.t.cabral at gmail.com (Rom Cabral)
Date: Mon, 30 Jun 2014 02:14:01 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ HA - Good Practices
Message-ID: <05402958-7cb3-442b-a5fe-5955cbe73932@googlegroups.com>

Hi guys,

Just finished reading articles about clustering and HA from the links 
below. I would like to clarify things before I start doing some experiment.

https://www.rabbitmq.com/clustering.html
https://www.rabbitmq.com/ha.html

- I have configured 3 nodes within a cluster, do I need to have a load 
balancer to ensure it is HA? or setting the exchange & queues to be 
mirrored enough? what is the good practice.
- Do I need to set all queues to be mirrored?

- Any other things consideration?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/48ad7300/attachment.html>

From joey.jiaojg at gmail.com  Mon Jun 30 10:15:48 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 30 Jun 2014 17:15:48 +0800
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
Message-ID: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>

Hi,
I'm trying to setup a rabbitmq with only ldap auth but I cannot login in
from web 15672. I followed exactly http://www.rabbitmq.com/ldap.html
Any idea or other link?

=WARNING REPORT==== 30-Jun-2014::17:11:41 ===
HTTP access denied: user 'jiangenj' - invalid credentials

=ERROR REPORT==== 30-Jun-2014::17:11:41 ===
webmachine error: path="/api/whoami"
"Unauthorized"

-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/451087e1/attachment.html>

From 1006798382 at qq.com  Mon Jun 30 10:16:43 2014
From: 1006798382 at qq.com (=?utf-8?B?5qSw6aOO?=)
Date: Mon, 30 Jun 2014 17:16:43 +0800
Subject: [rabbitmq-discuss] Core down when invoking
	amqp_destroy_connection() of rabbitmq-c-0.5.0 stable version
In-Reply-To: <mailman.1.1403953201.3365.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1403953201.3365.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <tencent_7DD5E40E4E0765EE06FFC0BD@qq.com>

It looks like the pool num_blocks (=1342177400) ?and blocklist(0x7fb850000bb0) members of pages? is incorrect.
refer to,
$7 = {pagesize = 132577, pages = {num_blocks = 1342177400, blocklist = 0x7fb850000bb0}, large_blocks = {num_blocks = 0, blocklist = 0x0}, next_page = 0, alloc_block = 0x0, alloc_used = 0}?


platform: Centos 6.3 x86_64bits


std output:
[push at zwjf-jpush-conn09-247115 conn_v1]$ *** glibc detected *** /opt/push/bin/conn/conn_v1/tcp_interface_srv_v1: free(): invalid pointer: 0x00007fb8500214f8 ***
======= Backtrace: =========
/lib64/libc.so.6[0x35dd676166]
/opt/push/lib64/librabbitmq.so.1(+0xf45d)[0x7fb8804a145d]
/opt/push/lib64/librabbitmq.so.1(empty_amqp_pool+0x28)[0x7fb8804a150a]
/opt/push/lib64/librabbitmq.so.1(amqp_destroy_connection+0x53)[0x7fb8804a082f]?


more detail:
#4 0x00007fb8804a145d in empty_blocklist (x=0x7fb850000e20) at /home/push/source/jim/jpush-server/server/external/src/rabbitmq-c-0.5.0/librabbitmq/amqp_mem.c:79
79	 free(x->blocklist[i]);
(gdb) l
74	static void empty_blocklist(amqp_pool_blocklist_t *x)
75	{
76	 int i;
77	
78	 for (i = 0; i < x->num_blocks; i++) { 79	 free(x->blocklist[i]); 80	 }
81	 if (x->blocklist != NULL) { 82	 free(x->blocklist); 83	 }
(gdb) p *x
$5 = {num_blocks = 1342177400, blocklist = 0x7fb850000bb0}
(gdb) f 5
#5 0x00007fb8804a150a in empty_amqp_pool (pool=0x7fb850000e18) at /home/push/source/jim/jpush-server/server/external/src/rabbitmq-c-0.5.0/librabbitmq/amqp_mem.c:99
99	 empty_blocklist(&pool->pages);
(gdb) l
94	}
95	
96	void empty_amqp_pool(amqp_pool_t *pool)
97	{ 98	 recycle_amqp_pool(pool); 99	 empty_blocklist(&pool->pages); 100	}
101	
102	/* Returns 1 on success, 0 on failure */
103	static int record_pool_block(amqp_pool_blocklist_t *x, void *block)
(gdb) p pool->pages
$6 = {num_blocks = 1342177400, blocklist = 0x7fb850000bb0}
(gdb) p *pool
$7 = {pagesize = 132577, pages = {num_blocks = 1342177400, blocklist = 0x7fb850000bb0}, large_blocks = {num_blocks = 0, blocklist = 0x0}, next_page = 0, alloc_block = 0x0, alloc_used = 0}
(gdb)?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/5b8dadd6/attachment.html>

From mariusz.wojcik at hotmail.co.uk  Mon Jun 30 10:25:11 2014
From: mariusz.wojcik at hotmail.co.uk (Mariusz Wojcik)
Date: Mon, 30 Jun 2014 02:25:11 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ HA - Good Practices
In-Reply-To: <05402958-7cb3-442b-a5fe-5955cbe73932@googlegroups.com>
References: <05402958-7cb3-442b-a5fe-5955cbe73932@googlegroups.com>
Message-ID: <a92b1e80-c076-4a59-a3dd-fedf635ae78d@googlegroups.com>



Hi Rom,

The load balancer is advisable - definitely do not bake in node 
hostnames/IP in your code. Read the last section, ?Connecting to Clusters 
from Clients? at the bottom of the first article 
<https://www.rabbitmq.com/clustering.html>.

No, you do not need to set all queues to be mirrored. It all depends on 
your scenarios. Just bear in mind that mirrored queues have less 
performance than non-mirrored ones.

Cheers,

Mariusz
On Monday, 30 June 2014 10:14:01 UTC+1, Rom Cabral wrote:

Hi guys,
>
> Just finished reading articles about clustering and HA from the links 
> below. I would like to clarify things before I start doing some experiment.
>
> https://www.rabbitmq.com/clustering.html
> https://www.rabbitmq.com/ha.html
>
> - I have configured 3 nodes within a cluster, do I need to have a load 
> balancer to ensure it is HA? or setting the exchange & queues to be 
> mirrored enough? what is the good practice.
> - Do I need to set all queues to be mirrored?
>
> - Any other things consideration?
>
>
> ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/c846f12b/attachment.html>

From ankur5.c at tcs.com  Mon Jun 30 10:31:45 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Mon, 30 Jun 2014 15:01:45 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <etPan.53b126a6.643c9869.1759a@mercurio.local>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
 <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
 <etPan.53b12587.6b8b4567.1759a@mercurio.local>
 <etPan.53b126a6.643c9869.1759a@mercurio.local>
Message-ID: <OF74C79851.CFCF803F-ON65257D07.00341ECF-65257D07.003459F8@tcs.com>

Thanks so much , will try the same and let you know the updates.

Thanks and Regards,
Ankur Chakraborty



From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   30-06-2014 14:28
Subject:        Re: [rabbitmq-discuss] Unable to establish MQTT plugin in 
rabbitmq version : 3.1.3.



 On 30 June 2014 at 12:53:28, Michael Klishin (mklishin at gopivotal.com) 
wrote:
> > It works just like Paho Python and Ruby clients.

I've pushed all 3 examples I've used to GitHub:

https://github.com/michaelklishin/mqtt-tls-playground
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/fd0db074/attachment.html>

From simon at rabbitmq.com  Mon Jun 30 10:34:56 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 10:34:56 +0100
Subject: [rabbitmq-discuss] able to get Msg in debug line but Cannot Get
 it to Asp.net Page
In-Reply-To: <15d84b0c-822b-489d-8a91-ce7220850d5d@googlegroups.com>
References: <15d84b0c-822b-489d-8a91-ce7220850d5d@googlegroups.com>
Message-ID: <53B12F40.9040301@rabbitmq.com>

On 28/06/14 07:23, tamer hatoum wrote:
> I am able to print it in the Debug line, but its not updating my Label.

This sounds like a question about asp.net web development. How is it 
anything to do with RabbitMQ?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 30 10:36:45 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 10:36:45 +0100
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
Message-ID: <53B12FAD.9080604@rabbitmq.com>

On 30/06/14 10:15, Joey Jiao wrote:
> I'm trying to setup a rabbitmq with only ldap auth but I cannot login in
> from web 15672. I followed exactly http://www.rabbitmq.com/ldap.html
> Any idea or other link?

Turn on {log, true} in your LDAP config (see 
http://www.rabbitmq.com/ldap.html#basic). This will log all the 
decisions the LDAP plugin is making and help you see where it's going wrong.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From marco.varagnolo at gmail.com  Mon Jun 30 10:54:44 2014
From: marco.varagnolo at gmail.com (Marco Varagnolo)
Date: Mon, 30 Jun 2014 02:54:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Disable PUT or GET from publisher/consumer
Message-ID: <4a8e100c-16e4-44fa-8313-e220728bb7e2@googlegroups.com>

Hi,

        is possible to stop PUT or GET of messages on queue from client ?! 
        Exists something like websphere MQ command: GET(DISABLED) ?!

        Thanks, best regards
        Marco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/1eeb07c5/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 10:58:41 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 13:58:41 +0400
Subject: [rabbitmq-discuss] Disable PUT or GET from publisher/consumer
In-Reply-To: <4a8e100c-16e4-44fa-8313-e220728bb7e2@googlegroups.com>
References: <4a8e100c-16e4-44fa-8313-e220728bb7e2@googlegroups.com>
Message-ID: <etPan.53b134ef.66334873.1759a@mercurio.local>

On 30 June 2014 at 13:57:00, Marco Varagnolo (marco.varagnolo at gmail.com) wrote:
> > is possible to stop PUT or GET of messages on queue from client 
> ?!
> Exists something like websphere MQ command: GET(DISABLED) 
> ?!

You can put Nginx or similar in front of RabbitMQ (it is a good idea anyway)
and disable certain paths or methods by configuring it.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun 30 11:02:44 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 14:02:44 +0400
Subject: [rabbitmq-discuss] Disable PUT or GET from publisher/consumer
In-Reply-To: <etPan.53b134ef.66334873.1759a@mercurio.local>
References: <4a8e100c-16e4-44fa-8313-e220728bb7e2@googlegroups.com>
 <etPan.53b134ef.66334873.1759a@mercurio.local>
Message-ID: <etPan.53b135e2.19495cff.1759a@mercurio.local>

On 30 June 2014 at 14:00:30, Michael Klishin (mklishin at gopivotal.com) wrote:
> > You can put Nginx or similar in front of RabbitMQ (it is a good 
> idea anyway)
> and disable certain paths or methods by configuring it.

Also, access controls apply even when you publish over HTTP API:

http://www.rabbitmq.com/access-control.html
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From joey.jiaojg at gmail.com  Mon Jun 30 11:05:19 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 30 Jun 2014 18:05:19 +0800
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <53B12FAD.9080604@rabbitmq.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
Message-ID: <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>

Yes, I tried log to true and network.

Possible this cause?
=WARNING REPORT==== 30-Jun-2014::18:02:38 ===
LDAP plugin loaded, but rabbit_auth_backend_ldap is not in the list of
auth_backends. LDAP auth will not work.


My config is:
[
  {rabbit, [
    {reverse_dns_lookups, true},
    {auth_backends, [rabbit_auth_backend_ldap]}
  ]},
  {rabbitmq_auth_backend_ldap, [
    {servers, ["ldap.qualcomm.com"]},
    {user_dn_pattern, "uid=${username},ou=people,o=xxx"},
    {use_ssl, false},
    {port, 389},
    {log, network},
    {vhost_access_query, {exists, "uid=${username},ou=people,o=xxx"}},
    {resource_access_query, {
      {for, [{resource, exchange, {for, [{permission, configure, {constant,
true}},{permission, write, {constant, true}}, {permission, read, {constant,
true}}]}},
             {resource, queue, {constant, true}}]}
    }},
    {tag_queries, [{administrator, {constant, true}},
                   {management, {constant, true}}]}
  ]}
].


2014-06-30 17:36 GMT+08:00 Simon MacMullen <simon at rabbitmq.com>:

> On 30/06/14 10:15, Joey Jiao wrote:
>
>> I'm trying to setup a rabbitmq with only ldap auth but I cannot login in
>> from web 15672. I followed exactly http://www.rabbitmq.com/ldap.html
>> Any idea or other link?
>>
>
> Turn on {log, true} in your LDAP config (see http://www.rabbitmq.com/ldap.
> html#basic). This will log all the decisions the LDAP plugin is making
> and help you see where it's going wrong.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/ba0559e2/attachment.html>

From simon at rabbitmq.com  Mon Jun 30 11:09:41 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 11:09:41 +0100
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
Message-ID: <53B13765.4010306@rabbitmq.com>

On 30/06/14 11:05, Joey Jiao wrote:
> Possible this cause?
> =WARNING REPORT==== 30-Jun-2014::18:02:38 ===
> LDAP plugin loaded, but rabbit_auth_backend_ldap is not in the list of
> auth_backends. LDAP auth will not work.

That's certainly a bad sign!

Your config looks reasonable (at least to get as far as using the 
plugin). So:

* Have you restarted the broker after changing the config file?
* Are you editing the config file in the right place? (The log file 
should tell you where the config is being read from.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 30 11:12:23 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 11:12:23 +0100
Subject: [rabbitmq-discuss] federation Issues
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D0B4DE@USEPX2PMXMBX12.corp.altegrity.com>
References: <6DB033025329784B9280ABD9516177FCA2D0A8F1@USEPX2PMXMBX12.corp.altegrity.com>
 <53AD5159.9050008@rabbitmq.com>
 <6DB033025329784B9280ABD9516177FCA2D0B277@USEPX2PMXMBX12.corp.altegrity.com>
 <6DB033025329784B9280ABD9516177FCA2D0B4DE@USEPX2PMXMBX12.corp.altegrity.com>
Message-ID: <53B13807.7050500@rabbitmq.com>

On 27/06/14 17:23, Ganann, Kale wrote:
> Update - we renamed the cluster to something meaningful and deleted
> all the dynamic objects so there were absolutely no artifacts left
> over.  We've got three vHosts with queues bound to e.fed.topic and
> the same routing key.  If I publish to the e.fed.topic on fed with
> that key, all three get it.  If I publish on vHost a, vHost b
> sometimes gets it, but not everytime, vHost c does not.  Similarly,
> we can publish to b, and sometimes a gets it, c does not.  Nothing
> published to c shows up anywhere else.

This certainly should work.

However, it's notable that changes to the cluster name are not picked up 
by federation until the server is restarted. That's not ideal; I'll file 
a bug to fix that.

If that is not the cause of your issue, then please post (or send me) 
the output of "rabbitmqctl report" and I'll see if I can spot any config 
issues.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From joey.jiaojg at gmail.com  Mon Jun 30 11:13:47 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 30 Jun 2014 18:13:47 +0800
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <53B13765.4010306@rabbitmq.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
Message-ID: <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>

Yes, it's under /etc/rabbitmq/ and I'm installed 3.3.4 from deb pkg.
A restart has been done after each config modification.


2014-06-30 18:09 GMT+08:00 Simon MacMullen <simon at rabbitmq.com>:

> On 30/06/14 11:05, Joey Jiao wrote:
>
>> Possible this cause?
>> =WARNING REPORT==== 30-Jun-2014::18:02:38 ===
>> LDAP plugin loaded, but rabbit_auth_backend_ldap is not in the list of
>> auth_backends. LDAP auth will not work.
>>
>
> That's certainly a bad sign!
>
> Your config looks reasonable (at least to get as far as using the plugin).
> So:
>
> * Have you restarted the broker after changing the config file?
> * Are you editing the config file in the right place? (The log file should
> tell you where the config is being read from.)
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/361a464a/attachment.html>

From simon at rabbitmq.com  Mon Jun 30 11:15:31 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 11:15:31 +0100
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
Message-ID: <53B138C3.4060307@rabbitmq.com>

On 30/06/14 11:13, Joey Jiao wrote:
> Yes, it's under /etc/rabbitmq/ and I'm installed 3.3.4 from deb pkg.
> A restart has been done after each config modification.

But please confirm it is actually being read - what does the log file 
say when the broker is restarted?

What does "rabbitmqctl environment" say?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From joey.jiaojg at gmail.com  Mon Jun 30 11:14:45 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 30 Jun 2014 18:14:45 +0800
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
Message-ID: <CAKOmCvoPnp7qWPdrwju9i3guzctSUg=G1zhkLUOzqRv3qcn1WA@mail.gmail.com>

I'm trying to login into management UI. It says Login failed.



=WARNING REPORT==== 30-Jun-2014::18:12:31 ===
LDAP plugin loaded, but rabbit_auth_backend_ldap is not in the list of
auth_backends. LDAP auth will not work.

=INFO REPORT==== 30-Jun-2014::18:12:31 ===
Management plugin started. Port: 15672

=INFO REPORT==== 30-Jun-2014::18:12:31 ===
Statistics database started.

=INFO REPORT==== 30-Jun-2014::18:12:31 ===
Server startup complete; 7 plugins started.
 * amqp_client
 * mochiweb
 * rabbitmq_auth_backend_ldap
 * rabbitmq_management
 * rabbitmq_management_agent
 * rabbitmq_web_dispatch
 * webmachine



2014-06-30 18:13 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com>:

> Yes, it's under /etc/rabbitmq/ and I'm installed 3.3.4 from deb pkg.
> A restart has been done after each config modification.
>
>
> 2014-06-30 18:09 GMT+08:00 Simon MacMullen <simon at rabbitmq.com>:
>
> On 30/06/14 11:05, Joey Jiao wrote:
>>
>>> Possible this cause?
>>> =WARNING REPORT==== 30-Jun-2014::18:02:38 ===
>>> LDAP plugin loaded, but rabbit_auth_backend_ldap is not in the list of
>>> auth_backends. LDAP auth will not work.
>>>
>>
>> That's certainly a bad sign!
>>
>> Your config looks reasonable (at least to get as far as using the
>> plugin). So:
>>
>> * Have you restarted the broker after changing the config file?
>> * Are you editing the config file in the right place? (The log file
>> should tell you where the config is being read from.)
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>>
>
>
>
> --
> -Joey Jiao
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/e69e1ba0/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 11:21:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 14:21:53 +0400
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvoPnp7qWPdrwju9i3guzctSUg=G1zhkLUOzqRv3qcn1WA@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
 <CAKOmCvoPnp7qWPdrwju9i3guzctSUg=G1zhkLUOzqRv3qcn1WA@mail.gmail.com>
Message-ID: <etPan.53b13a5a.625558ec.1759a@mercurio.local>

?On 30 June 2014 at 14:19:46, Joey Jiao (joey.jiaojg at gmail.com) wrote:
> > =WARNING REPORT==== 30-Jun-2014(http://airmail.calendar/2014-06-30%2012:00:00%20GMT+4)::18:12:31  
> ===
> LDAP plugin loaded, but rabbit_auth_backend_ldap is not in  
> the list of auth_backends. LDAP auth will not work.

I'm not a LDAP integration expert but the warning above sounds like
a likely cause.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Mon Jun 30 11:23:19 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 11:23:19 +0100
Subject: [rabbitmq-discuss] Cluster hung on node death
In-Reply-To: <f09a0300-52e1-489a-9da8-8d887b519ebd@googlegroups.com>
References: <f09a0300-52e1-489a-9da8-8d887b519ebd@googlegroups.com>
Message-ID: <53B13A97.5040305@rabbitmq.com>

On 27/06/14 20:55, Daniel Burke wrote:
> Today we had the physical machine of a dedicated node kernel panic
> (linux centos 6)... when that happened the other two nodes in the
> cluster seemed to choke, and not respond at all.
>
> "rabbitmqctl cluster_status" on either of the other nodes would hang.
>
> The web management UI didn't respond.  I could get a login page to come
> up but after that it would go back to not responding.

The management UI and "rabbitmqctl cluster_status" can hang for a short 
while, while the live nodes attempt to contact the crashed node but 
haven't got an answer from it. Once the live nodes decide that the dead 
node is in fact dead, the UI and rabbitmqctl will become responsive 
again. This time period is defined by net_ticktime (see 
http://www.rabbitmq.com/nettick.html).

* Have you changed this setting?
* Did messages about the node being down get logged by the other nodes? 
When?

Cheers, Simon

> When the crashed machine came back up, without starting rabbitmq on it,
> once networking was responding, the other two nodes seemed to free up
> and start operating normally again.
>
> After the rest of the cluster was operating normally again, we brought
> down the crashed machine to do a memtest, and we didn't experience the
> cluster freeze again (rabbitmq was not ever started back up on the
> failed node).
>
> This cluster (we went live with multiple clusters yesterday), is running
> 3 physical dedicated machines.  All of them are on centos 6.  RabbitMQ v
> 3.3.2.  All nodes are disc nodes.  All queues are durable and mirrored.
>   This cluster has one queue, plus 1000's of dynamic shovels (which of
> course includes their own queues on this cluster) connecting to queues
> on 3 other clusters with similar setups.  Each node has about 7gig of
> disk free on the relevant partition, and 48gig of ram with the
> high_water_mark set to 0.9, but even at diminished capacity right now,
> the most ram used is 1.2gig on one node and 600meg on the other (these
> boxes were way over built with short-term growth in mind).
>
> Sadly, there was nothing in the logs.  We realized this might be related
> to the logging bug fixed in 3.3.3, so we just upgraded our dev
> environment to start the process to deal with that.
>
> Any thoughts on what the cause of this freeze up could have been?  And
> how to mitigate it?  Or any troubleshooting / information gathering we
> could do if it happens again?  It's a scary thing now to have happen on
> a friday afternoon.  We were counting on three node clusters getting us
> through if there was an outage of a node during the weekend... but now
> we're all afraid to go home for the weekend!
>
> Thanks!
> Dan.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From joey.jiaojg at gmail.com  Mon Jun 30 11:25:36 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 30 Jun 2014 18:25:36 +0800
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <53B138C3.4060307@rabbitmq.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
 <53B138C3.4060307@rabbitmq.com>
Message-ID: <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>

I have set CONFIG_FILE=/etc/rabbitmq/rabbitmq in
/etc/rabbitmq/rabbitmq-env.conf


$ sudo rabbitmqctl environment
Application environment of node 'rabbit at jiangenj-pro' ...
[{auth_backends,[*rabbit_auth_backend_internal]*},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {channel_max,0},
 {cluster_nodes,{[],disc}},
 {cluster_partition_handling,ignore},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,50000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at jiangenj-pro.log"}},
 {frame_max,131072},
 {halt_on_upgrade_failure,true},
 {heartbeat,580},
 {hipe_compile,false},
 {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
                rabbit_basic,rabbit_event,lists,queue,priority_queue,
                rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
                rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
                rabbit_amqqueue_process,rabbit_variable_queue,

rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
                sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,

rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
                file_handle_cache,rabbit_msg_store,array,
                rabbit_msg_store_ets_index,rabbit_msg_file,

rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,

mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
                ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
                ssl]},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {loopback_users,[<<"guest">>]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.4/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at jiangenj-pro-plugins-expand
"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at jiangenj-pro-sasl.log
"}},
 {server_properties,[]},
 {ssl_apps,[asn1,crypto,public_key,ssl]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_high_watermark_paging_ratio,0.5}]
...done.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/9f22db2c/attachment.html>

From joey.jiaojg at gmail.com  Mon Jun 30 11:27:55 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 30 Jun 2014 18:27:55 +0800
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
 <53B138C3.4060307@rabbitmq.com>
 <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
Message-ID: <CAKOmCvpBbbrrD4xBzPd+2M+w-rc2hVRhvPWm0CyCbR-KL6YYNQ@mail.gmail.com>

process info
auth_backends still is internal

rabbitmq 15686  4.9  0.1 2373968 51244 ?       Sl   18:23   0:08
/usr/lib/erlang/erts-5.10.4/bin/beam.smp -W w -K true -A30 -P 1048576 --
-root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.4/sbin/../ebin -noshell -noinput
-s rabbit boot -sname rabbit at jiangenj-pro -boot start_sasl -kernel
inet_default_connect_options [{nodelay,true}] -sasl errlog_type error -sasl
sasl_error_logger false -rabbit error_logger
{file,"/var/log/rabbitmq/rabbit at jiangenj-pro.log"} -rabbit
sasl_error_logger {file,"/var/log/rabbitmq/rabbit at jiangenj-pro-sasl.log"}
-rabbit enabled_plugins_file "/etc/rabbitmq/enabled_plugins" -rabbit
plugins_dir "/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.4/sbin/../plugins"
-rabbit plugins_expand_dir
"/var/lib/rabbitmq/mnesia/rabbit at jiangenj-pro-plugins-expand" -os_mon
start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup false
-mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at jiangenj-pro" -kernel
inet_dist_listen_min 25672 -kernel inet_dist_listen_max 25672



2014-06-30 18:25 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com>:

> I have set CONFIG_FILE=/etc/rabbitmq/rabbitmq in
> /etc/rabbitmq/rabbitmq-env.conf
>
>
> $ sudo rabbitmqctl environment
> Application environment of node 'rabbit at jiangenj-pro' ...
> [{auth_backends,[*rabbit_auth_backend_internal]*},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {channel_max,0},
>  {cluster_nodes,{[],disc}},
>  {cluster_partition_handling,ignore},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {disk_free_limit,50000000},
>  {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at jiangenj-pro.log"}},
>  {frame_max,131072},
>  {halt_on_upgrade_failure,true},
>  {heartbeat,580},
>  {hipe_compile,false},
>  {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
>                 rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
>                 rabbit_basic,rabbit_event,lists,queue,priority_queue,
>
> rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
>                 rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
>                 rabbit_amqqueue_process,rabbit_variable_queue,
>
> rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
>                 sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
>
> rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
>                 file_handle_cache,rabbit_msg_store,array,
>                 rabbit_msg_store_ets_index,rabbit_msg_file,
>
> rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
>
> mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
>
> ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
>                 ssl]},
>  {included_applications,[]},
>  {log_levels,[{connection,info}]},
>  {loopback_users,[<<"guest">>]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>
>  {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.4/sbin/../plugins"},
>
>  {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at jiangenj-pro-plugins-expand
> "},
>  {queue_index_max_journal_entries,65536},
>  {reverse_dns_lookups,false},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at jiangenj-pro-sasl.log
> "}},
>  {server_properties,[]},
>  {ssl_apps,[asn1,crypto,public_key,ssl]},
>  {ssl_cert_login_from,distinguished_name},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[5672]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.4},
>  {vm_memory_high_watermark_paging_ratio,0.5}]
> ...done.
>
>


-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/ce375e5f/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 11:29:51 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 14:29:51 +0400
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
 <53B138C3.4060307@rabbitmq.com>
 <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
Message-ID: <etPan.53b13c3a.46e87ccd.1759a@mercurio.local>

?On 30 June 2014 at 14:28:12, Joey Jiao (joey.jiaojg at gmail.com) wrote:
> > {auth_backends,[rabbit_auth_backend_internal]}

This confirms the warning. There is no?rabbit_auth_backend_ldap on the list ;)
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Mon Jun 30 11:30:40 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 11:30:40 +0100
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
 <53B138C3.4060307@rabbitmq.com>
 <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
Message-ID: <53B13C50.7060108@rabbitmq.com>

Your config file is not being read.

As I've said twice before, the log file will tell you where the server 
looked for the config file. Please check that.

If it is looking in the right place but still says "not found", you 
might have a permissions issue - the config file must be readable by the 
rabbitmq user.

Cheers, Simon

On 30/06/14 11:25, Joey Jiao wrote:
> I have set CONFIG_FILE=/etc/rabbitmq/rabbitmq in
> /etc/rabbitmq/rabbitmq-env.conf
>
>
> $ sudo rabbitmqctl environment
> Application environment of node 'rabbit at jiangenj-pro' ...
> [{auth_backends,[*rabbit_auth_backend_internal]*},
>   {auth_mechanisms,['PLAIN','AMQPLAIN']},
>   {backing_queue_module,rabbit_variable_queue},
>   {channel_max,0},
>   {cluster_nodes,{[],disc}},
>   {cluster_partition_handling,ignore},
>   {collect_statistics,fine},
>   {collect_statistics_interval,5000},
>   {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>   {default_user,<<"guest">>},
>   {default_user_tags,[administrator]},
>   {default_vhost,<<"/">>},
>   {delegate_count,16},
>   {disk_free_limit,50000000},
>   {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>   {error_logger,{file,"/var/log/rabbitmq/rabbit at jiangenj-pro.log"}},
>   {frame_max,131072},
>   {halt_on_upgrade_failure,true},
>   {heartbeat,580},
>   {hipe_compile,false},
>   {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
>                  rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
>                  rabbit_basic,rabbit_event,lists,queue,priority_queue,
>
> rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
>                  rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
>                  rabbit_amqqueue_process,rabbit_variable_queue,
>
> rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
>                  sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
>
> rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
>                  file_handle_cache,rabbit_msg_store,array,
>                  rabbit_msg_store_ets_index,rabbit_msg_file,
>
> rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
>
> mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
>
> ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
>                  ssl]},
>   {included_applications,[]},
>   {log_levels,[{connection,info}]},
>   {loopback_users,[<<"guest">>]},
>   {msg_store_file_size_limit,16777216},
>   {msg_store_index_module,rabbit_msg_store_ets_index},
>   {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.4/sbin/../plugins"},
>   {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at jiangenj-pro-plugins-expand"},
>   {queue_index_max_journal_entries,65536},
>   {reverse_dns_lookups,false},
>   {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at jiangenj-pro-sasl.log"}},
>   {server_properties,[]},
>   {ssl_apps,[asn1,crypto,public_key,ssl]},
>   {ssl_cert_login_from,distinguished_name},
>   {ssl_listeners,[]},
>   {ssl_options,[]},
>   {tcp_listen_options,[binary,
>                        {packet,raw},
>                        {reuseaddr,true},
>                        {backlog,128},
>                        {nodelay,true},
>                        {linger,{true,0}},
>                        {exit_on_close,false}]},
>   {tcp_listeners,[5672]},
>   {trace_vhosts,[]},
>   {vm_memory_high_watermark,0.4},
>   {vm_memory_high_watermark_paging_ratio,0.5}]
> ...done.
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From joey.jiaojg at gmail.com  Mon Jun 30 11:34:25 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 30 Jun 2014 18:34:25 +0800
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <53B13C50.7060108@rabbitmq.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
 <53B138C3.4060307@rabbitmq.com>
 <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
 <53B13C50.7060108@rabbitmq.com>
Message-ID: <CAKOmCvojK09J=190tuxr=8-1fen4tx32kzDNgJpUr1Nrv9Vi4w@mail.gmail.com>

It's actually readable with 644 permission.
How can I know where it read from the config file

$ ll /etc/rabbitmq/
??? 28
drwxr-xr-x   2 root root  4096  6? 30 18:25 ./
drwxr-xr-x 155 root root 12288  6? 30 16:17 ../
-rw-r--r--   1 root root    67  6? 30 18:20 enabled_plugins
-rw-r--r--   1 root root   549  6? 30 18:19 rabbitmq.conf
-rw-r--r--   1 root root    35  6? 30 18:23 rabbitmq-env.conf



2014-06-30 18:30 GMT+08:00 Simon MacMullen <simon at rabbitmq.com>:

> Your config file is not being read.
>
> As I've said twice before, the log file will tell you where the server
> looked for the config file. Please check that.
>
> If it is looking in the right place but still says "not found", you might
> have a permissions issue - the config file must be readable by the rabbitmq
> user.
>
> Cheers, Simon
>
>
> On 30/06/14 11:25, Joey Jiao wrote:
>
>> I have set CONFIG_FILE=/etc/rabbitmq/rabbitmq in
>> /etc/rabbitmq/rabbitmq-env.conf
>>
>>
>> $ sudo rabbitmqctl environment
>> Application environment of node 'rabbit at jiangenj-pro' ...
>> [{auth_backends,[*rabbit_auth_backend_internal]*},
>>
>>   {auth_mechanisms,['PLAIN','AMQPLAIN']},
>>   {backing_queue_module,rabbit_variable_queue},
>>   {channel_max,0},
>>   {cluster_nodes,{[],disc}},
>>   {cluster_partition_handling,ignore},
>>   {collect_statistics,fine},
>>   {collect_statistics_interval,5000},
>>   {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>>   {default_user,<<"guest">>},
>>   {default_user_tags,[administrator]},
>>   {default_vhost,<<"/">>},
>>   {delegate_count,16},
>>   {disk_free_limit,50000000},
>>   {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>>   {error_logger,{file,"/var/log/rabbitmq/rabbit at jiangenj-pro.log"}},
>>   {frame_max,131072},
>>   {halt_on_upgrade_failure,true},
>>   {heartbeat,580},
>>   {hipe_compile,false},
>>   {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,
>> rabbit_exchange,
>>                  rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
>>                  rabbit_basic,rabbit_event,lists,queue,priority_queue,
>>
>> rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
>>                  rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
>>                  rabbit_amqqueue_process,rabbit_variable_queue,
>>
>> rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
>>                  sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
>>
>> rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
>>                  file_handle_cache,rabbit_msg_store,array,
>>                  rabbit_msg_store_ets_index,rabbit_msg_file,
>>
>> rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
>>
>> mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
>>
>> ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
>>                  ssl]},
>>   {included_applications,[]},
>>   {log_levels,[{connection,info}]},
>>   {loopback_users,[<<"guest">>]},
>>   {msg_store_file_size_limit,16777216},
>>   {msg_store_index_module,rabbit_msg_store_ets_index},
>>   {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-
>> 3.3.4/sbin/../plugins"},
>>   {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit@
>> jiangenj-pro-plugins-expand"},
>>   {queue_index_max_journal_entries,65536},
>>   {reverse_dns_lookups,false},
>>   {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit@
>> jiangenj-pro-sasl.log"}},
>>   {server_properties,[]},
>>   {ssl_apps,[asn1,crypto,public_key,ssl]},
>>   {ssl_cert_login_from,distinguished_name},
>>   {ssl_listeners,[]},
>>   {ssl_options,[]},
>>   {tcp_listen_options,[binary,
>>                        {packet,raw},
>>                        {reuseaddr,true},
>>                        {backlog,128},
>>                        {nodelay,true},
>>                        {linger,{true,0}},
>>                        {exit_on_close,false}]},
>>   {tcp_listeners,[5672]},
>>   {trace_vhosts,[]},
>>   {vm_memory_high_watermark,0.4},
>>   {vm_memory_high_watermark_paging_ratio,0.5}]
>> ...done.
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/b4ad5e55/attachment.html>

From simon at rabbitmq.com  Mon Jun 30 11:37:45 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 11:37:45 +0100
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <CAKOmCvojK09J=190tuxr=8-1fen4tx32kzDNgJpUr1Nrv9Vi4w@mail.gmail.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
 <53B138C3.4060307@rabbitmq.com>
 <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
 <53B13C50.7060108@rabbitmq.com>
 <CAKOmCvojK09J=190tuxr=8-1fen4tx32kzDNgJpUr1Nrv9Vi4w@mail.gmail.com>
Message-ID: <53B13DF9.6000302@rabbitmq.com>

On 30/06/14 11:34, Joey Jiao wrote:
> It's actually readable with 644 permission.
> How can I know where it read from the config file

It is in the log file. (For the fourth time!)

Example:

=INFO REPORT==== 27-Jun-2014::16:30:00 ===
node           : rabbit at smacmullen
home dir       : /home/simon
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : BigcLqsHkDEWyvCp2e4gvA==
log            : /tmp/rabbit at smacmullen.log
sasl log       : /tmp/rabbit at smacmullen-sasl.log
database dir   : /tmp/rabbitmq-rabbit-mnesia


Note that the file is called rabbitmq.config, not rabbitmq.conf.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From elim.projects at gmail.com  Mon Jun 30 11:45:02 2014
From: elim.projects at gmail.com (Eli)
Date: Mon, 30 Jun 2014 13:45:02 +0300
Subject: [rabbitmq-discuss] cannot open channel for publishing,
	the broker is not connected
In-Reply-To: <50A5517F-F8EE-4773-9B19-7A5DC0F0A419@gmail.com>
References: <50A5517F-F8EE-4773-9B19-7A5DC0F0A419@gmail.com>
Message-ID: <5ACC6DEE-5A5F-415C-88A3-1A6BBD030EAE@gmail.com>


> hi,
> 
> After first intstalation.
> We made client server simple example.
> we succseeded sending messagese between client server locally and after configure rabbitmq config file on remote server it works also.
> Now locally connecting localhost it do not work
> i recieve :
> "cannot open channel for publishing,the broker is not connected"
>   
> when try to send any message.
> remotly it ids working(working on lan between 2 pc)
> 
> please advice,
> thank u
> eli
> 
> 
> 
> 
> 
> 
>  
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/0e654c0b/attachment.html>

From elim.projects at gmail.com  Mon Jun 30 11:58:23 2014
From: elim.projects at gmail.com (Eli)
Date: Mon, 30 Jun 2014 13:58:23 +0300
Subject: [rabbitmq-discuss] windows could not start the rabbitmq service on
	local computer
Message-ID: <AD9FCEC1-D351-417D-9D0F-D11ECF4C8D3B@gmail.com>

hi,

stop and start rabbitmq service failed on :
"windows could not start the rabbitmq service on local computer"

error 1067 the proccess terminated inexpetedly.
working on windows 8


Eli


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/ae50a70e/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 12:07:35 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 15:07:35 +0400
Subject: [rabbitmq-discuss] windows could not start the rabbitmq service
 on local computer
In-Reply-To: <AD9FCEC1-D351-417D-9D0F-D11ECF4C8D3B@gmail.com>
References: <AD9FCEC1-D351-417D-9D0F-D11ECF4C8D3B@gmail.com>
Message-ID: <etPan.53b14513.507ed7ab.1759a@mercurio.local>

On 30 June 2014 at 15:00:42, Eli (elim.projects at gmail.com) wrote:
> > stop and start rabbitmq service failed on :
> "windows could not start the rabbitmq service on local computer"  
>  
> error 1067 the proccess terminated inexpetedly.
> working on windows 8

There can be many reasons that prevent RabbitMQ service from starting, see ?http://www.rabbitmq.com/windows-quirks.html
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From elim.projects at gmail.com  Mon Jun 30 12:24:03 2014
From: elim.projects at gmail.com (Eli)
Date: Mon, 30 Jun 2014 14:24:03 +0300
Subject: [rabbitmq-discuss] windows could not start the rabbitmq service
	on local computer
In-Reply-To: <etPan.53b14513.507ed7ab.1759a@mercurio.local>
References: <AD9FCEC1-D351-417D-9D0F-D11ECF4C8D3B@gmail.com>
 <etPan.53b14513.507ed7ab.1759a@mercurio.local>
Message-ID: <0A1BF928-9131-40B2-91A4-BCF278FA6D24@gmail.com>

Thank u,

i found out that if rabbitmq service is working on another pc in lan (and u did a connection to it before) then it disturb another broker,
does it make sense?

thanks,
eli




??-30 ???? 2014, ???? 14:07, ?Michael Klishin <mklishin at gopivotal.com> ???/?:?

> On 30 June 2014 at 15:00:42, Eli (elim.projects at gmail.com) wrote:
>>> stop and start rabbitmq service failed on :
>> "windows could not start the rabbitmq service on local computer"  
>> 
>> error 1067 the proccess terminated inexpetedly.
>> working on windows 8
> 
> There can be many reasons that prevent RabbitMQ service from starting, see  http://www.rabbitmq.com/windows-quirks.html
> --  
> MK  
> 
> Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/821a9fd4/attachment.html>

From mklishin at gopivotal.com  Mon Jun 30 12:54:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 15:54:29 +0400
Subject: [rabbitmq-discuss] windows could not start the rabbitmq service
 on local computer
In-Reply-To: <0A1BF928-9131-40B2-91A4-BCF278FA6D24@gmail.com>
References: <AD9FCEC1-D351-417D-9D0F-D11ECF4C8D3B@gmail.com>
 <etPan.53b14513.507ed7ab.1759a@mercurio.local>
 <0A1BF928-9131-40B2-91A4-BCF278FA6D24@gmail.com>
Message-ID: <etPan.53b15011.41b71efb.1759a@mercurio.local>

On 30 June 2014 at 15:24:12, Eli (elim.projects at gmail.com) wrote:
> > i found out that if rabbitmq service is working on another pc  
> in lan (and u did a connection to it before) then it disturb another  
> broker,
> does it make sense?

Unclustered nodes on different hosts cannot interfere with each other
unless you explicitly make them use the same node name ?(highly unlikely).?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From alan.antonuk at gmail.com  Mon Jun 30 16:52:44 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 30 Jun 2014 08:52:44 -0700
Subject: [rabbitmq-discuss] Core down when invoking
 amqp_destroy_connection() of rabbitmq-c-0.5.0 stable version
In-Reply-To: <tencent_7DD5E40E4E0765EE06FFC0BD@qq.com>
References: <mailman.1.1403953201.3365.rabbitmq-discuss@lists.rabbitmq.com>
 <tencent_7DD5E40E4E0765EE06FFC0BD@qq.com>
Message-ID: <CAAt2poKiwzgR4GztG85=dseCqBrwYYVn6vYVcRwEeCb8RJjzfQ@mail.gmail.com>

Looks like something has incorrectly written to the amqp_pool_t memory pool
(probably contained in the amqp_connection_state_t object). Without further
information about the program I cannot help you much further.

-Alan


On Mon, Jun 30, 2014 at 2:16 AM, ?? <1006798382 at qq.com> wrote:

> It looks like the pool num_blocks (=1342177400) ?and blocklist(0x7fb850000bb0)
> members of pages? is incorrect.
> refer to,
> $7 = {pagesize = 132577, pages = {num_blocks = 1342177400, blocklist =
> 0x7fb850000bb0}, large_blocks = {num_blocks = 0, blocklist = 0x0},
> next_page = 0, alloc_block = 0x0, alloc_used = 0}?
>
> platform: Centos 6.3 x86_64bits
>
> std output:
> [push at zwjf-jpush-conn09-247115 conn_v1]$ *** glibc detected ***
> /opt/push/bin/conn/conn_v1/tcp_interface_srv_v1: free(): invalid pointer:
> 0x00007fb8500214f8 ***
> ======= Backtrace: =========
> /lib64/libc.so.6[0x35dd676166]
> /opt/push/lib64/librabbitmq.so.1(+0xf45d)[0x7fb8804a145d]
> /opt/push/lib64/librabbitmq.so.1(empty_amqp_pool+0x28)[0x7fb8804a150a]
> /opt/push/lib64/librabbitmq.so.1(amqp_destroy_connection+0x53)
> [0x7fb8804a082f]?
>
> more detail:
> #4 0x00007fb8804a145d in empty_blocklist (x=0x7fb850000e20) at
> /home/push/source/jim/jpush-server/server/external/src/rabbitmq-c-0.5.0/librabbitmq/amqp_mem.c:79
> 79 free(x->blocklist[i]);
> (gdb) l
> 74 static void empty_blocklist(amqp_pool_blocklist_t *x)
> 75 {
> 76 int i;
> 77
> 78 for (i = 0; i < x->num_blocks; i++) { 79 free(x->blocklist[i]); 80 }
> 81 if (x->blocklist != NULL) { 82 free(x->blocklist); 83 }
> (gdb) p *x
> $5 = {num_blocks = 1342177400, blocklist = 0x7fb850000bb0}
> (gdb) f 5
> #5 0x00007fb8804a150a in empty_amqp_pool (pool=0x7fb850000e18) at
> /home/push/source/jim/jpush-server/server/external/src/rabbitmq-c-0.5.0/librabbitmq/amqp_mem.c:99
> 99 empty_blocklist(&pool->pages);
> (gdb) l
> 94 }
> 95
> 96 void empty_amqp_pool(amqp_pool_t *pool)
> 97 { 98 recycle_amqp_pool(pool); 99 empty_blocklist(&pool->pages); 100 }
> 101
> 102 /* Returns 1 on success, 0 on failure */
> 103 static int record_pool_block(amqp_pool_blocklist_t *x, void *block)
> (gdb) p pool->pages
> $6 = {num_blocks = 1342177400, blocklist = 0x7fb850000bb0}
> (gdb) p *pool
> $7 = {pagesize = 132577, pages = {num_blocks = 1342177400, blocklist =
> 0x7fb850000bb0}, large_blocks = {num_blocks = 0, blocklist = 0x0},
> next_page = 0, alloc_block = 0x0, alloc_used = 0}
> (gdb)?
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/3d4cd1d3/attachment.html>

From mr.xchang at gmail.com  Mon Jun 30 17:34:46 2014
From: mr.xchang at gmail.com (Xicheng Chang)
Date: Mon, 30 Jun 2014 09:34:46 -0700
Subject: [rabbitmq-discuss] Cluster Sequencing
In-Reply-To: <etPan.53ae5320.66334873.5866@mercurio.local>
References: <41fa731f-763e-4763-b265-46c1bc8574ef@googlegroups.com>
 <etPan.53ae5320.66334873.5866@mercurio.local>
Message-ID: <CAG-Y8sfJW9yQGNRvXhQ7GjtoPpdEZ4NDk_FpL_k6+pMdrJnueA@mail.gmail.com>

Thanks, Michael.


On Fri, Jun 27, 2014 at 10:30 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 28 June 2014 at 05:10:02, Xicheng Chang (mr.xchang at gmail.com) wrote:
> > > How does the cluster ensure that all the messages(in different
> > queues) get delivered to the receiver in the same order they were
> > sent to the queue cluster?
>
> Every queue in a cluster has a master node (the node where it was
> declared).
> All messages routed to that queue go through it (even if publishers and
> consumers
> using it connect to other cluster nodes). So, the queue master basically
> performs
> coordination.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>



-- 
*-Xicheng Chang*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/3182b21c/attachment.html>

From eli.menachem at gmail.com  Mon Jun 30 11:42:44 2014
From: eli.menachem at gmail.com (Eli Menachem)
Date: Mon, 30 Jun 2014 13:42:44 +0300
Subject: [rabbitmq-discuss] cannot open channel for publishing,
	the broker is not connected
Message-ID: <50A5517F-F8EE-4773-9B19-7A5DC0F0A419@gmail.com>

hi,

After first intstalation.
We made client server simple example.
we succseeded sending messagese between client server locally and after configure rabbitmq config file on remote server it works also.
Now locally connecting localhost it do not work
i recieve :
"cannot open channel for publishing,the broker is not connected"
  
when try to send any message.
remotly it ids working(working on lan between 2 pc)

please advice,
thank u
eli






 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/caf578dd/attachment.html>

From particlesquirrel at gmail.com  Mon Jun 30 12:11:18 2014
From: particlesquirrel at gmail.com (Daniel Burke)
Date: Mon, 30 Jun 2014 07:11:18 -0400
Subject: [rabbitmq-discuss] Cluster hung on node death
In-Reply-To: <53B13A97.5040305@rabbitmq.com>
References: <f09a0300-52e1-489a-9da8-8d887b519ebd@googlegroups.com>
 <53B13A97.5040305@rabbitmq.com>
Message-ID: <CAH8FpAQTTzgp76_31nn+GtYOt4tLMmWaZTTEYGOwSMKXH5RwDw@mail.gmail.com>

We did not change netticktime, and the other nodes in the cluster were
frozen for about an hour by the time networking was active again on the
node that crashed.

Frustratingly there was nothing in the logs, but I think that's because of
the bug fixed in 3.3.3 and we went live with 3.3.2 :(  we started upgrading
on Friday to fix that...

Dan.
On Jun 30, 2014 6:23 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

> On 27/06/14 20:55, Daniel Burke wrote:
>
>> Today we had the physical machine of a dedicated node kernel panic
>> (linux centos 6)... when that happened the other two nodes in the
>> cluster seemed to choke, and not respond at all.
>>
>> "rabbitmqctl cluster_status" on either of the other nodes would hang.
>>
>> The web management UI didn't respond.  I could get a login page to come
>> up but after that it would go back to not responding.
>>
>
> The management UI and "rabbitmqctl cluster_status" can hang for a short
> while, while the live nodes attempt to contact the crashed node but haven't
> got an answer from it. Once the live nodes decide that the dead node is in
> fact dead, the UI and rabbitmqctl will become responsive again. This time
> period is defined by net_ticktime (see http://www.rabbitmq.com/
> nettick.html).
>
> * Have you changed this setting?
> * Did messages about the node being down get logged by the other nodes?
> When?
>
> Cheers, Simon
>
>  When the crashed machine came back up, without starting rabbitmq on it,
>> once networking was responding, the other two nodes seemed to free up
>> and start operating normally again.
>>
>> After the rest of the cluster was operating normally again, we brought
>> down the crashed machine to do a memtest, and we didn't experience the
>> cluster freeze again (rabbitmq was not ever started back up on the
>> failed node).
>>
>> This cluster (we went live with multiple clusters yesterday), is running
>> 3 physical dedicated machines.  All of them are on centos 6.  RabbitMQ v
>> 3.3.2.  All nodes are disc nodes.  All queues are durable and mirrored.
>>   This cluster has one queue, plus 1000's of dynamic shovels (which of
>> course includes their own queues on this cluster) connecting to queues
>> on 3 other clusters with similar setups.  Each node has about 7gig of
>> disk free on the relevant partition, and 48gig of ram with the
>> high_water_mark set to 0.9, but even at diminished capacity right now,
>> the most ram used is 1.2gig on one node and 600meg on the other (these
>> boxes were way over built with short-term growth in mind).
>>
>> Sadly, there was nothing in the logs.  We realized this might be related
>> to the logging bug fixed in 3.3.3, so we just upgraded our dev
>> environment to start the process to deal with that.
>>
>> Any thoughts on what the cause of this freeze up could have been?  And
>> how to mitigate it?  Or any troubleshooting / information gathering we
>> could do if it happens again?  It's a scary thing now to have happen on
>> a friday afternoon.  We were counting on three node clusters getting us
>> through if there was an outage of a node during the weekend... but now
>> we're all afraid to go home for the weekend!
>>
>> Thanks!
>> Dan.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list has moved to https://groups.google.com/
>> forum/#!forum/rabbitmq-users,
>> please subscribe to the new list!
>>
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/a90ea39f/attachment.html>

From pimenta at inatel.br  Mon Jun 30 15:05:03 2014
From: pimenta at inatel.br (Rodrigo Pimenta Carvalho)
Date: Mon, 30 Jun 2014 11:05:03 -0300
Subject: [rabbitmq-discuss] How to avoid handshake_timout while attempting a
 SSL connection to the RabbitMQ broker?
Message-ID: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E74582794@socrates.local.inatel.br>

Hi.

I had installed the RabbitMQ and used it as a serve (not sevice)r in my Windows 7. My java client application send and get messages from the broker?s queues very well. No issues.

After that, i also had configured such broker to uses SSL and exchanges certificates with a java client. According to the SSL Troubleshooting web page (http://www.rabbitmq.com/troubleshooting-ssl.html) almost everything is ok with my broker and all configuration I had set. That is, I had tested every single step from this troubleshooting page and I have found just one issue:

When I attempt a SSL connection to broker, using the command "openssl s_client -connect localhost:5671 -cert client/cert.pem -key client/key.pem -CAfile testca/cacert.pem"  , it presents the message ?Verify return code: 0 (ok)?. However, after an instant, it closes and presents ?Closed?. 

In the log I got:

=INFO REPORT==== 30-Jun-2014::10:47:09 ===
accepting AMQP connection <0.306.0> (127.0.0.1:63913 -> 127.0.0.1:5671)

=ERROR REPORT==== 30-Jun-2014::10:47:19 ===
closing AMQP connection <0.306.0> (127.0.0.1:63913 -> 127.0.0.1:5671):
{handshake_timeout,handshake}

What should I configure in RabbitMQ to avoid such kind of timeout issue? 
Any hint will be very helpful! 
Thanks a lot.



RODRIGO PIMENTA CARVALHO
Inatel Competence Center
Software
Ph: +55 35 3471 9979

From mklishin at gopivotal.com  Mon Jun 30 20:11:03 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 23:11:03 +0400
Subject: [rabbitmq-discuss] cannot open channel for publishing,
 the broker is not connected
In-Reply-To: <50A5517F-F8EE-4773-9B19-7A5DC0F0A419@gmail.com>
References: <50A5517F-F8EE-4773-9B19-7A5DC0F0A419@gmail.com>
Message-ID: <etPan.53b1b662.6b8b4567.1fa9@mercurio.local>

On 30 June 2014 at 23:09:35, Eli Menachem (eli.menachem at gmail.com) wrote:
> > Now locally connecting localhost it do not work
> i recieve :
> "cannot open channel for publishing,the broker is not connected"  

If RabbitMQ is actually running on localhost, see its log, it should
reveal if there are incoming connections and why they may be closed.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun 30 20:15:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 23:15:07 +0400
Subject: [rabbitmq-discuss] How to avoid handshake_timout while
 attempting a SSL connection to the RabbitMQ broker?
In-Reply-To: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E74582794@socrates.local.inatel.br>
References: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E74582794@socrates.local.inatel.br>
Message-ID: <etPan.53b1b758.643c9869.1fa9@mercurio.local>

?On 30 June 2014 at 23:12:41, Rodrigo Pimenta Carvalho (pimenta at inatel.br) wrote:
> > =ERROR REPORT==== 30-Jun-2014(http://airmail.calendar/2014-06-30%2012:00:00%20GMT+4)::10:47:19  
> ===
> closing AMQP connection <0.306.0> (127.0.0.1:63913 -> 127.0.0.1:5671):  
> {handshake_timeout,handshake}

Do you configure ConnectionFactory to use SSL? If a client not configured to use SSL
connects to RabbitMQ on SSL port, it will not perform SSL connection upgrade RabbitMQ
expects and you will get exactly this error.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jun 30 20:23:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 30 Jun 2014 23:23:22 +0400
Subject: [rabbitmq-discuss] How to avoid handshake_timout while
 attempting a SSL connection to the RabbitMQ broker?
In-Reply-To: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E74582794@socrates.local.inatel.br>
References: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E74582794@socrates.local.inatel.br>
Message-ID: <etPan.53b1b944.74b0dc51.1fa9@mercurio.local>

On 30 June 2014 at 23:12:41, Rodrigo Pimenta Carvalho (pimenta at inatel.br) wrote:
> > When I attempt a SSL connection to broker, using the command  
> "openssl s_client -connect localhost:5671 -cert client/cert.pem  
> -key client/key.pem -CAfile testca/cacert.pem" , it presents  
> the message ?Verify return code: 0 (ok)?. However, after an instant,  
> it closes and presents ?Closed?.
>  
> In the log I got:
>  
> =INFO REPORT==== 30-Jun-2014(http://airmail.calendar/2014-06-30%2012:00:00%20GMT+4)::10:47:09  
> ===
> accepting AMQP connection <0.306.0> (127.0.0.1:63913 -> 127.0.0.1:5671)  
>  
> =ERROR REPORT==== 30-Jun-2014(http://airmail.calendar/2014-06-30%2012:00:00%20GMT+4)::10:47:19  
> ===
> closing AMQP connection <0.306.0> (127.0.0.1:63913 -> 127.0.0.1:5671):  
> {handshake_timeout,handshake}
>  
> What should I configure in RabbitMQ to avoid such kind of timeout  
> issue?

Right, so I misunderstood what happens. When you connect with openssl s_client,
RabbitMQ expects the client to perform AMQP 0-9-1 handshake and openssl s_client,
of course, doesn't do that.

So this error is expected with s_client. Use a real RabbitMQ client, which will
perform the handshake.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From isskjj at gmail.com  Mon Jun 30 20:34:28 2014
From: isskjj at gmail.com (Karl Jackson)
Date: Mon, 30 Jun 2014 13:34:28 -0600
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CAKmc4PZRn7DaKvcLzsaB3bzd4Vf-zDxtRsSxTgrcPunPKFKGXw@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>
 <etPan.53a345a0.79e2a9e3.172@mercurio.local>
 <CAKmc4PbUZEqQKeQteF5uKFiKApT9E8_ghp69fEG7AhiqQB6wxQ@mail.gmail.com>
 <etPan.53a3484e.12200854.172@mercurio.local>
 <CAKmc4PaKk16+mdKzi=LsO081c9nBC6UKQ3EbT7SAGqPa7Oat4A@mail.gmail.com>
 <etPan.53a34b7a.216231b.172@mercurio.local>
 <CAKmc4PZRn7DaKvcLzsaB3bzd4Vf-zDxtRsSxTgrcPunPKFKGXw@mail.gmail.com>
Message-ID: <CAKmc4Pbr4Xd25asb2A=_CLnXd00K8DS8zV4EpETpmdRZRwv10w@mail.gmail.com>

I tried upgrading to 3.3.4, but I am still getting the following errors:

{"init terminating in do_boot",badarg}


Crash dump was written to: erl_crash.dump

init terminating in do_boot (badarg)

I have verified I am running Erlang R17.

Any idea where to go from here?

Thank you,

Karl Jackson, CISSP
Security Engineer
Office of Information Technology - Engineering
Office: 801-422-3973
email: karl_jackson at byu.edu



>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/77727cbb/attachment.html>

From simon at rabbitmq.com  Mon Jun 30 20:44:51 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jun 2014 20:44:51 +0100
Subject: [rabbitmq-discuss] After upgrade to 3.3.3 rabbitmq-server
 failing to start
In-Reply-To: <CAKmc4Pbr4Xd25asb2A=_CLnXd00K8DS8zV4EpETpmdRZRwv10w@mail.gmail.com>
References: <CAKmc4PYHJq2Au=rC11LB4w-YrrOjH5hHDW8bKwCj0pCeQ7QeSg@mail.gmail.com>
 <etPan.53a33d8c.238e1f29.172@mercurio.local>
 <CAKmc4PYwR8Kcd5LObBihmo2Jr-GdB+DL1xHxFLansxgkBxEmgg@mail.gmail.com>
 <etPan.53a33fb3.3d1b58ba.172@mercurio.local>
 <CALPqkiqO+oyWMYppV9YuyR-BaROXd71UGHmTR17F0Exj3t2G5Q@mail.gmail.com>
 <CAKmc4Pbr8UBfUpPdLgs=g6Lh1uxTUTqMsNmzRS_ac8TeOZnG2g@mail.gmail.com>
 <etPan.53a345a0.79e2a9e3.172@mercurio.local>
 <CAKmc4PbUZEqQKeQteF5uKFiKApT9E8_ghp69fEG7AhiqQB6wxQ@mail.gmail.com>
 <etPan.53a3484e.12200854.172@mercurio.local>
 <CAKmc4PaKk16+mdKzi=LsO081c9nBC6UKQ3EbT7SAGqPa7Oat4A@mail.gmail.com>
 <etPan.53a34b7a.216231b.172@mercurio.local>
 <CAKmc4PZRn7DaKvcLzsaB3bzd4Vf-zDxtRsSxTgrcPunPKFKGXw@mail.gmail.com>
 <CAKmc4Pbr4Xd25asb2A=_CLnXd00K8DS8zV4EpETpmdRZRwv10w@mail.gmail.com>
Message-ID: <53B1BE33.70602@rabbitmq.com>

On 30/06/2014 20:34, Karl Jackson wrote:
> I tried upgrading to 3.3.4, but I am still getting the following errors:
>
> {"init terminating in do_boot",badarg}


I don't think you ever said (or were ever asked) - is there anything in 
the main or sasl logs? (/var/log/rabbitmq/rabbit@(hostname).log and 
-sasl.log)

Cheers, Simon

From mklishin at gopivotal.com  Mon Jun 30 22:19:58 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 1 Jul 2014 01:19:58 +0400
Subject: [rabbitmq-discuss] RES: How to avoid handshake_timout while
 attempting a SSL connection to the RabbitMQ broker?
In-Reply-To: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E74582797@socrates.local.inatel.br>
References: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E74582794@socrates.local.inatel.br>
 <etPan.53b1b944.74b0dc51.1fa9@mercurio.local>
 <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E74582797@socrates.local.inatel.br>
Message-ID: <etPan.53b1d49a.6b8b4567.2949@mercurio.local>

+rabbitmq-discuss

On 1 July 2014 at 01:16:45, Rodrigo Pimenta Carvalho (pimenta at inatel.br) wrote:
> > 4. =ERROR REPORT==== 27-Jun-2014(http://airmail.calendar/2014-06-27%2012:00:00%20GMT+4)::13:44:56  
> ===
> 5. SSL: certify: ssl_handshake.erl:1358:Fatal error: handshake  
> failure
> 6.
> 7. =ERROR REPORT==== 27-Jun-2014(http://airmail.calendar/2014-06-27%2012:00:00%20GMT+4)::13:45:01  
> ===
> 8. error on AMQP connection <0.301.0>:
> 9. {ssl_upgrade_error,{tls_alert,"handshake failure"}}  

?This looks like a plain TCP connection on TLS port. It's not possible to
say much else without seeing your connection code.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

