<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq cluster failover for persistent	queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbitmq%20cluster%20failover%20for%20persistent%0A%09queues&In-Reply-To=167204d20907261351x6d524fcej96c57a86af9597cc%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004236.html">
   <LINK REL="Next"  HREF="004237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq cluster failover for persistent	queues</H1>
    <B>charles woerner</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbitmq%20cluster%20failover%20for%20persistent%0A%09queues&In-Reply-To=167204d20907261351x6d524fcej96c57a86af9597cc%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] rabbitmq cluster failover for persistent	queues">charleswoerner.lists at gmail.com
       </A><BR>
    <I>Mon Jul 27 01:00:56 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004236.html">[rabbitmq-discuss] rabbitmq cluster failover for persistent	queues
</A></li>
        <LI>Next message: <A HREF="004237.html">[rabbitmq-discuss] rabbitmq cluster failover for persistent	queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4238">[ date ]</a>
              <a href="thread.html#4238">[ thread ]</a>
              <a href="subject.html#4238">[ subject ]</a>
              <a href="author.html#4238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alexis,

Can you clarify what you mean by &quot;failover of session state&quot; please?
&gt;<i> I am assuming you mean that when a node dies, then another node can
</I>&gt;<i> 'take over' from it, without loss of any state that the first node has
</I>&gt;<i> committed (to some other node and/or persistent store), and that the
</I>&gt;<i> second node can 'take over' in some sense 'faster' than recovery by
</I>&gt;<i> restarting the first node from disk would.
</I>

More or less.  I'm personally not that concerned with the timeliness of
recovery for committed messages.  I'm mostly concerned with any messages
being dropped by the system because no bindings matching a particular
message's routing key existed in the exchange at the time of the enqueue
command (because the one node which contained the queue which matched that
routing key has suffered a disaster).  To go further I really want the
ability to define something like &quot;failover bindings&quot; (e.g. create queue Q on
node A as master and node B for failover)  in the exchange such that if
delivery to to a queue &quot;Q&quot; on node &quot;A&quot; fails then the exchange will declare
that node &quot;B&quot; is the new master for queue &quot;Q&quot; and all subsequent routing
will be adjusted.  It seems that if the persister were using mnesia to
record session state (queue data) and one could define &quot;failover bindings&quot;
like I mentioned above then the exchange could failover a queue to a
secondary node transparently to all producers and consumers in the system,
save for the ones that were directly connected to the node which suffered
the disaster.


&gt;<i>  I ask because this case is
</I>&gt;<i> not quite the same as 'exactly once' delivery.
</I>

Yes, I was just referring to my belief that if I want to eliminate this
single point of failure I would need to create redundant queues on separate
nodes and have some kind of out-of-band mechanism to guard against duplicate
processing (or that I would need to make sure that all downstream operations
were idempotent).


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> alexis
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sun, Jul 26, 2009 at 6:45 PM, charles
</I>&gt;<i> woerner&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">charleswoerner.lists at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Thanks Arvind.  That seems to confirm our belief that rabbitmq doesn't
</I>&gt;<i> &gt; handle failover of session state at the moment.  So in the case of
</I>&gt;<i> competing
</I>&gt;<i> &gt; consumers taking messages from a rabbitmq broker cluster it sounds like
</I>&gt;<i> &gt; once-and-only-once delivery is somewhat up to the application to
</I>&gt;<i> implement
</I>&gt;<i> &gt; by arranging for each message to be delivered to redundant queues (ie. 2
</I>&gt;<i> &gt; separate queues with similar bindings residing on different hosts), then
</I>&gt;<i> &gt; coordinate among your consumers to ensure once-and-only-once delivery
</I>&gt;<i> using
</I>&gt;<i> &gt; a database or simply to make your workflow idempotent with respect to the
</I>&gt;<i> &gt; duplicate messages.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Ideally, I'd like my broker cluster to handle this.  I'm looking into
</I>&gt;<i> apache
</I>&gt;<i> &gt; qpid as it seems to be more mature with respect to availability.  The
</I>&gt;<i> main
</I>&gt;<i> &gt; downside with rabbitmq for me right now is the lack of at least an option
</I>&gt;<i> &gt; for session state replication.  It sounds like a future release of
</I>&gt;<i> rabbitmq
</I>&gt;<i> &gt; with pluggable persisters will make distributed session state possible
</I>&gt;<i> via
</I>&gt;<i> &gt; mnesia.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090726/c09eb7be/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090726/c09eb7be/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004236.html">[rabbitmq-discuss] rabbitmq cluster failover for persistent	queues
</A></li>
	<LI>Next message: <A HREF="004237.html">[rabbitmq-discuss] rabbitmq cluster failover for persistent	queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4238">[ date ]</a>
              <a href="thread.html#4238">[ thread ]</a>
              <a href="subject.html#4238">[ subject ]</a>
              <a href="author.html#4238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
