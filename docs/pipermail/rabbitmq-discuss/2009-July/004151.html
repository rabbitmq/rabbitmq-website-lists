<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20tcp%20-%3E%20rabbitmq%20gives%20emfile%20%2B%20541&In-Reply-To=407fa4640907010914w73941cf1rc0688d079d68d8bb%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003969.html">
   <LINK REL="Next"  HREF="004169.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20tcp%20-%3E%20rabbitmq%20gives%20emfile%20%2B%20541&In-Reply-To=407fa4640907010914w73941cf1rc0688d079d68d8bb%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541">matthew at lshift.net
       </A><BR>
    <I>Fri Jul 17 15:52:12 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003969.html">[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
</A></li>
        <LI>Next message: <A HREF="004169.html">[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4151">[ date ]</a>
              <a href="thread.html#4151">[ thread ]</a>
              <a href="subject.html#4151">[ subject ]</a>
              <a href="author.html#4151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Michael,

Sorry for the delay getting back to you. We're all pretty swamped here.

On Wed, Jul 01, 2009 at 05:14:05PM +0100, Michael Nacos wrote:
&gt;<i> could you offer a rule of thumb for calculating the AMQP message size? I am
</I>&gt;<i> sending lists of 5-10 ASCII characters.
</I>
Well on the wire, it's pretty efficient - probably only a dozen bytes or
so for AMQP headers (but then, yeah you've got TCP and IP etc as
normal). In memory Erlang won't be quite as efficient, but we keep the
message payload as a binary blob so that won't be expanded. I'd say a
reasonable guess is 100 bytes plus the size of the payload.

However, if the payload is under 64 bytes then Erlang will permit
multiple copies of it to exist in memory at the same time which could in
this case (because the messages, at least as far as v1.6 and before are
concerned) are stored in several places, so you can get duplication of
data. This has been trimmed back somewhat for the new disk queue stuff
so you may well see in the future that for small message sizes, there is
greater efficiency in use of memory.

&gt;<i> Judging from the disk space consumed
</I>&gt;<i> by the mnesia directory, however, I think it's possible we are exhausting
</I>&gt;<i> the RAM, if all messages are also kept in memory. And yes, just before the
</I>&gt;<i> vm crashes, free shows little memory left (~150Mb), there is a little bit of
</I>&gt;<i> lag between reaching this amount and the crash, it's a little hard to tell
</I>&gt;<i> because rabbitmq runs on the database server and there are other programs
</I>&gt;<i> running as well.
</I>
Right. Yeah, exhausting RAM is pretty common problem really, and
something that the new disk queue really does address well. &quot;Stay tuned&quot;
is about the best I can offer at this stage. I'm tempted to say it
shouldn't be too much longer, but then I've thought that before and been
proved wrong...

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003969.html">[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
</A></li>
	<LI>Next message: <A HREF="004169.html">[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4151">[ date ]</a>
              <a href="thread.html#4151">[ thread ]</a>
              <a href="subject.html#4151">[ subject ]</a>
              <a href="author.html#4151">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
