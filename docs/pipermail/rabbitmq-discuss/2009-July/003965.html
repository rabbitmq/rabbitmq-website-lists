<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20tcp%20-%3E%20rabbitmq%20gives%20emfile%20%2B%20541&In-Reply-To=4A4B7619.8030702%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003955.html">
   <LINK REL="Next"  HREF="003967.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541</H1>
    <B>Michael Nacos</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20tcp%20-%3E%20rabbitmq%20gives%20emfile%20%2B%20541&In-Reply-To=4A4B7619.8030702%40lshift.net"
       TITLE="[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541">m.nacos at gmail.com
       </A><BR>
    <I>Wed Jul  1 16:31:53 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003955.html">[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
</A></li>
        <LI>Next message: <A HREF="003967.html">[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3965">[ date ]</a>
              <a href="thread.html#3965">[ thread ]</a>
              <a href="subject.html#3965">[ subject ]</a>
              <a href="author.html#3965">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Tony,

this is excellent news, I'll definitely give the new C client a try. This is
just a pilot project, we have got big messaging needs, and I'd like to
explore the possibility of Database --&gt; Messaging workflows much further.

In regards to the TCP server, I don't claim to be an expert in such things
but I am under the impression all sort of different resources consume file
descriptors in POSIX systems, including sockets, and while a socket is in
TIME_WAIT state a fd is still being used. (see e.g.
<A HREF="http://judystak.tistory.com/136">http://judystak.tistory.com/136</A>)

by raising the nofile ulimit for the right users, I think I have gone past
this problem and what happens now is that RabbitMQ crashes because all the
undelivered messages are written to disk (for persistence) but the whole set
stays in memory, which is eventually exhausted. I don't know if this is out
of date information, but see
<A HREF="http://www.nabble.com/RabbitMQ-memory-management-td19428592.html">http://www.nabble.com/RabbitMQ-memory-management-td19428592.html</A>

Now, I distinctly remember Matthew speaking about a mechanism which monitors
free memory and offloads to disk to the point of RabbitMQ working as long as
there is still room for a single message in RAM, but I don't remember if
this is already available or when it's going to be.

If I am right, attaching a fast enough consumer to the queue while running
my tests will probably take care of the crashes, I have only experienced
crashes when the number of undelivered messages exceeded 200000 messages.

overall, I am very happy with rabbitmq, I'm only complaining (not really)
because you have set the bar high :)

regards, Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090701/1d13a9e0/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090701/1d13a9e0/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003955.html">[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
</A></li>
	<LI>Next message: <A HREF="003967.html">[rabbitmq-discuss] tcp -&gt; rabbitmq gives emfile + 541
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3965">[ date ]</a>
              <a href="thread.html#3965">[ thread ]</a>
              <a href="subject.html#3965">[ subject ]</a>
              <a href="author.html#3965">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
