<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] queue_disappeared?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20queue_disappeared%3F&In-Reply-To=84fb38e30907071212k71b5ec28s9df63718b067a6e9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004033.html">
   <LINK REL="Next"  HREF="004037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] queue_disappeared?</H1>
    <B>tsuraan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20queue_disappeared%3F&In-Reply-To=84fb38e30907071212k71b5ec28s9df63718b067a6e9%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] queue_disappeared?">tsuraan at gmail.com
       </A><BR>
    <I>Tue Jul  7 20:38:51 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004033.html">[rabbitmq-discuss] queue_disappeared?
</A></li>
        <LI>Next message: <A HREF="004037.html">[rabbitmq-discuss] queue_disappeared?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4036">[ date ]</a>
              <a href="thread.html#4036">[ thread ]</a>
              <a href="subject.html#4036">[ subject ]</a>
              <a href="author.html#4036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> So I was running some tests of my system with Rabbit 1.5.3, and all of
</I>&gt;<i> a sudden the system died because a central queue &quot;disappeared&quot;.  The
</I>&gt;<i> error message in the rabbit.log is this:
</I>&gt;<i>
</I>&gt;<i> =ERROR REPORT==== 7-Jul-2009::14:03:53 ===
</I>&gt;<i> connection &lt;0.15624.1&gt; (running), channel 1 - error:
</I>&gt;<i> {amqp,internal_error,
</I>&gt;<i>       &quot;commit failed:
</I>&gt;<i> [{exit,{queue_disappeared,&lt;0.15429.1&gt;}}]&quot;,'tx.commit'}
</I>
Ok, so that was the first thing that I saw  from reading the log from
the bottom up.  Going from the top down is probably more useful.  The
full(-ish) log of what happened is:

=ERROR REPORT==== 7-Jul-2009::14:03:12 ===
** Generic server &lt;0.15604.1&gt; terminating
** Last message in was {commit,{{1,&lt;0.15636.1&gt;},14828}}
** When Server state == {q,{amqqueue,
                               {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;DocSearchEmails&quot;&gt;&gt;},
                               true,false,[],none},
                           none,none,true,3036,
                           {[],[]},
                           {[{&lt;0.15729.1&gt;,
                              {consumer,
                                  &lt;&lt;&quot;amq.ctag-ONnWMrwJlReM+3ObdgstOA==&quot;&gt;&gt;,
                                  true}}],
                            []}}
** Reason for termination ==
** {timeout,
       {gen_server,call,
           [rabbit_persister,
            {commit_transaction,
                {{{1,&lt;0.15636.1&gt;},14828},
                 {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;DocSearchEmails&quot;&gt;&gt;}}}]}}

=ERROR REPORT==== 7-Jul-2009::14:03:14 ===
connection &lt;0.6457.2&gt; (running), channel 1 - error:
{{timeout,{gen_server,call,[&lt;0.15508.1&gt;,{basic_get,&lt;0.6461.2&gt;,false}]}},
 [{gen_server,call,2},
  {rabbit_misc,with_exit_handler,2},
  {rabbit_channel,handle_method,3},
  {rabbit_channel,handle_message,2},
  {buffering_proxy,'-mainloop/4-fun-0-',3},
  {lists,foldl,3},
  {buffering_proxy,mainloop,4}]}

=WARNING REPORT==== 7-Jul-2009::14:03:14 ===
Non-AMQP exit reason '{{timeout,
                           {gen_server,call,
                               [&lt;0.15508.1&gt;,{basic_get,&lt;0.6461.2&gt;,false}]}},
                       [{gen_server,call,2},
                        {rabbit_misc,with_exit_handler,2},
                        {rabbit_channel,handle_method,3},
                        {rabbit_channel,handle_message,2},
                        {buffering_proxy,'-mainloop/4-fun-0-',3},
                        {lists,foldl,3},
                        {buffering_proxy,mainloop,4}]}'

=INFO REPORT==== 7-Jul-2009::14:03:14 ===
closing TCP connection &lt;0.6457.2&gt; from 127.0.0.1:55212

=ERROR REPORT==== 7-Jul-2009::14:03:14 ===
** Generic server &lt;0.15508.1&gt; terminating
** Last message in was {commit,{{1,&lt;0.15636.1&gt;},14828}}
** When Server state == {q,{amqqueue,{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;EmailCount&quot;&gt;&gt;},
                                     true,false,[],none},
                           none,none,false,4306,
                           {[],[]},
                           {[],[]}}
** Reason for termination ==
** {timeout,
       {gen_server,call,
           [rabbit_persister,
            {commit_transaction,
                {{{1,&lt;0.15636.1&gt;},14828},
                 {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;EmailCount&quot;&gt;&gt;}}}]}}

And then a few more dumps of queues that were _really_ huge.  They
appear to have every single message that was in each of the queues,
which I guess is what an erlang server state dump usually shows.  Not
all of my queues died, and neither of my largest queues died.  The
server was only using about 1GB of RAM when the queues started dieing,
so it shouldn't have been an out of memory condition.  It might have
been swapping though.  Could that cause the timeouts that then caused
the cascading process deaths?


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004033.html">[rabbitmq-discuss] queue_disappeared?
</A></li>
	<LI>Next message: <A HREF="004037.html">[rabbitmq-discuss] queue_disappeared?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4036">[ date ]</a>
              <a href="thread.html#4036">[ thread ]</a>
              <a href="subject.html#4036">[ subject ]</a>
              <a href="author.html#4036">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
