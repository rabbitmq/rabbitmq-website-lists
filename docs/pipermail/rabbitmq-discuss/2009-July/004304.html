<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Unique Messages in Queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Unique%20Messages%20in%20Queue&In-Reply-To=4e1b00700907310839r69f389c9yaf8cecc951a52fa4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004301.html">
   <LINK REL="Next"  HREF="004305.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Unique Messages in Queue</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Unique%20Messages%20in%20Queue&In-Reply-To=4e1b00700907310839r69f389c9yaf8cecc951a52fa4%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Unique Messages in Queue">matthias at lshift.net
       </A><BR>
    <I>Fri Jul 31 18:03:29 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004301.html">[rabbitmq-discuss] Unique Messages in Queue
</A></li>
        <LI>Next message: <A HREF="004305.html">[rabbitmq-discuss] Unique Messages in Queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4304">[ date ]</a>
              <a href="thread.html#4304">[ thread ]</a>
              <a href="subject.html#4304">[ subject ]</a>
              <a href="author.html#4304">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Vidit,

Vidit Drolia wrote:
&gt;<i> Is it possible to store unique messages in a queue? I have a message
</I>&gt;<i> source that may provide duplicate messages but I do not want the
</I>&gt;<i> message to be processed more than once.
</I>
As Darien pointed out, deduplicating messages at the client end isn't 
all that hard, and even easier than he described if, say, you can 
guarantee that message ids are monotonically increasing.

The really, really, hard part is ensuring that a message only gets 
*processed* once.

When can a message be considered to have been processed? Let's assume we 
have an app that pulls messages off a rabbit queue and calls a function 
process(msg) to process them. At what point then has the message been 
processed? At the exact point we call the function? At the exact point 
it returns? Somewhere inbetween? Whatever point you choose, you then 
still have to *record* the fact that the point has been reached, so that 
the message can be forgotten for good, or, alternatively, if the point 
hasn't been reached, replayed at a later point. That act of recording - 
whether it be by acknowledging the message in rabbit, or some other 
means - itself can fail, which will result in eventual resending and 
thus duplication.

The problem here is that the processing of the message itself, let alone 
the combination of it with the recording/acknowledging action are not 
atomic.

The only way to solve this is to either make everything - rabbit, your 
app, any apps it talks to, etc - part of a gigantic transaction - thus 
ensuring atomicity - or - and this is by far the easier and better 
option - construct your apps in such a way that messaging is idempotent.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004301.html">[rabbitmq-discuss] Unique Messages in Queue
</A></li>
	<LI>Next message: <A HREF="004305.html">[rabbitmq-discuss] Unique Messages in Queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4304">[ date ]</a>
              <a href="thread.html#4304">[ thread ]</a>
              <a href="subject.html#4304">[ subject ]</a>
              <a href="author.html#4304">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
