<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] fanout exchange that does not keep messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20fanout%20exchange%20that%20does%20not%20keep%20messages&In-Reply-To=dbd9700a0907210731t41498c02i63a38dc2b46cdc55%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004195.html">
   <LINK REL="Next"  HREF="004222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] fanout exchange that does not keep messages</H1>
    <B>majek04</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20fanout%20exchange%20that%20does%20not%20keep%20messages&In-Reply-To=dbd9700a0907210731t41498c02i63a38dc2b46cdc55%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] fanout exchange that does not keep messages">majek04 at gmail.com
       </A><BR>
    <I>Tue Jul 21 16:14:10 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004195.html">[rabbitmq-discuss] fanout exchange that does not keep messages
</A></li>
        <LI>Next message: <A HREF="004222.html">[rabbitmq-discuss] fanout exchange that does not keep messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4198">[ date ]</a>
              <a href="thread.html#4198">[ thread ]</a>
              <a href="subject.html#4198">[ subject ]</a>
              <a href="author.html#4198">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Jul 21, 2009 at 15:31, Brian Whitman&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">brian at echonest.com</A>&gt; wrote:
&gt;<i> If you want to see the mem growth, use the code (I've updated it) in my blog
</I>&gt;<i> post but just add immediate=True to the basic_publish command. Then I just
</I>&gt;<i> did
</I>&gt;<i> b = Producer()
</I>&gt;<i> for x in xrange(1000000):
</I>&gt;<i> &#160;&#160; &#160;b.message({&quot;message&quot;:&quot;a long message&quot;, &quot;id&quot;:str(x)})
</I>&gt;<i> and you can just watch the mem increase, whether you have consumers or not.
</I>&gt;<i> (only if immediate=True is on)
</I>
I can confirm that. Indeed, when you send 'immediate=True' messages
from python  the memory is growing in a rabbit process.

We even found a source of a problem - it's a python amqp client library.
You see, when an 'immediate' message is not delivered, it's returned to the
sender. But the python library is not reading anything from the socket,
Rabbit is still trying to return messages, but after a while buffers on
network socket are filled and Erlang memory footprint starts to grow.

This is an output from netstat -n:
Active Internet connections (w/o servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp    73440      0 127.0.0.1:47121         127.0.0.1:5672          ESTABLISHED
tcp        0  24864 127.0.0.1:5672          127.0.0.1:47121         ESTABLISHED

As you see the buffers are full.

Hope that helps.

Marek Majkowski


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004195.html">[rabbitmq-discuss] fanout exchange that does not keep messages
</A></li>
	<LI>Next message: <A HREF="004222.html">[rabbitmq-discuss] fanout exchange that does not keep messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4198">[ date ]</a>
              <a href="thread.html#4198">[ thread ]</a>
              <a href="subject.html#4198">[ subject ]</a>
              <a href="author.html#4198">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
