<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Durable queues and high availability	(broker failage)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Durable%20queues%20and%20high%20availability%09%28broker%0A%20failage%29&In-Reply-To=4A6F9904.5070209%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004255.html">
   <LINK REL="Next"  HREF="004259.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Durable queues and high availability	(broker failage)</H1>
    <B>Wilson Ke</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Durable%20queues%20and%20high%20availability%09%28broker%0A%20failage%29&In-Reply-To=4A6F9904.5070209%40lshift.net"
       TITLE="[rabbitmq-discuss] Durable queues and high availability	(broker failage)">wilson.ke at wealthcraft.com
       </A><BR>
    <I>Wed Jul 29 02:51:55 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004255.html">[rabbitmq-discuss] Durable queues and high availability	(broker failage)
</A></li>
        <LI>Next message: <A HREF="004259.html">[rabbitmq-discuss] Durable queues and high availability	(broker failage)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4258">[ date ]</a>
              <a href="thread.html#4258">[ thread ]</a>
              <a href="subject.html#4258">[ subject ]</a>
              <a href="author.html#4258">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthias,

I declare exchange and queue are durable, and met all what you said. Now I post my code lines to below,

and the attachment is the wrapper class of rabbit API, if you have some ideas in my code lines. Please let me know.

Thanks.





//declare exchange

rabbitmqWrapper.ExchangeDeclare(Exchange.ExchangeName, ExchangeType.Topic, false, true, false, false, false, null);



//declare queue

rabbitmqWrapper.QueueDeclare(Queue.QueueName, false, true, false, false, false, null);



//bind queue

rabbitmqWrapper.QueueBind(quename, exchangename,&quot;test&quot;,false,null);



//send message

private void SendMessage()

{

    string xml = GetXml();

    RabbitmqWrapper wrapper =new RabbitmqWrapper();

    wrapper.PublishMessage(&quot;wslinboundexchange&quot;,wslinboundque,&quot;test&quot;,xml);

}

//function of RabbitmqWrapper class

public void PublishMessage(string exchangeName,string queueName,string returnKey,string xml)

{

IConnection conn = new ConnectionFactory().CreateConnection(this.rabbitmqHost);    using (IModel ch = conn.CreateModel())

    {

        IBasicProperties props = ch.CreateBasicProperties();

        props.ContentType = &quot;text/plain&quot;;



        props.DeliveryMode = 2;

        IStreamMessageBuilder b = new StreamMessageBuilder(ch);

        byte[] byptes = Encoding.UTF8.GetBytes(xml);

        b.WriteBytes(byptes);

        ch.BasicPublish(exchangeName, returnKey,null,byptes);

    }

}

-----Original Message-----
From: Matthias Radestock [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>]
Sent: 2009&#24180;7&#26376;29&#26085; 8:34
To: Wilson Ke
Cc: '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>'
Subject: Re: [rabbitmq-discuss] Durable queues and high availability (broker failage)



Wilson,



Wilson Ke wrote:

&gt;<i> When I restart rabbitmq server,the durable queue had purge all
</I>
&gt;<i> messages. I want to remain these messages in the durable queue after
</I>
&gt;<i> restart rabbitmq server,how can I do? Btw,I use
</I>
&gt;<i> deliverymode=2(persistent) to send messages to the queue.
</I>


As long as the queues are marked as durable, are not exclusive or

auto-delete, and the messages are marked as persistent, then the queues

and messages should survive a broker restart.



If all these conditions are met in your setup and the messages still

disappear then please post the code that creates the queues and the code

that sends the messages.



Regards,



Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/4be3c927/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/4be3c927/attachment.htm</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: RabbitmqWrapper.cs
Url: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/4be3c927/attachment.txt">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/4be3c927/attachment.txt</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004255.html">[rabbitmq-discuss] Durable queues and high availability	(broker failage)
</A></li>
	<LI>Next message: <A HREF="004259.html">[rabbitmq-discuss] Durable queues and high availability	(broker failage)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4258">[ date ]</a>
              <a href="thread.html#4258">[ thread ]</a>
              <a href="subject.html#4258">[ subject ]</a>
              <a href="author.html#4258">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
