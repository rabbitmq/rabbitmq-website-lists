<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Consumer Error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20Consumer%20Error&In-Reply-To=167204d20907170402m4f128024q625cdba187bbc07c%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004128.html">
   <LINK REL="Next"  HREF="004129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Consumer Error</H1>
    <B>Lynton Grice</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20Consumer%20Error&In-Reply-To=167204d20907170402m4f128024q625cdba187bbc07c%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ Consumer Error">lynton.grice at logosworld.com
       </A><BR>
    <I>Fri Jul 17 15:09:10 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004128.html">[rabbitmq-discuss] RabbitMQ Consumer Error
</A></li>
        <LI>Next message: <A HREF="004129.html">[rabbitmq-discuss] Can I generate SNMP traps on Connection events?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4147">[ date ]</a>
              <a href="thread.html#4147">[ thread ]</a>
              <a href="subject.html#4147">[ subject ]</a>
              <a href="author.html#4147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alexis,

I will drop the Carrot guys the message ;-)

Chat later

Lynton

-----Original Message-----
From: Alexis Richardson [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at gmail.com</A>] 
Sent: 17 July 2009 01:02 PM
To: Lynton Grice
Cc: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] RabbitMQ Consumer Error

Excellent - have you mentioned this to the Carrot folks?


On Mon, Jul 13, 2009 at 6:31 AM, Lynton
Grice&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lynton.grice at logosworld.com</A>&gt; wrote:
&gt;<i> Hi there,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I seemed to have solved the issue....it all had to do with the
</I>&gt;<i> &#147;content_encoding&#148;....so I replaced this:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Content = #content{class_id = 60,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; properties = amqp_util:basic_properties(),
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; properties = Properties,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; properties_bin = none,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; payload_fragments_rev = [Payload]
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160; },
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> With this:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Properties = #'P_basic'{content_type = &lt;&lt;&quot;application/octet-stream&quot;&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160; content_encoding = &lt;&lt;&quot;binary&quot;&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;delivery_mode = 1,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;priority = 0},
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Content = #content{class_id = 60,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; properties = Properties,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; properties_bin = none,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; payload_fragments_rev = [Payload]
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160; },
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Now my Python consumer in CARROT is working 100% ;-)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Chat later
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Lynton
</I>&gt;<i>
</I>&gt;<i> From: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>
</I>&gt;<i> [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Lynton
</I>&gt;<i> Grice
</I>&gt;<i> Sent: 12 July 2009 07:13 PM
</I>&gt;<i> To: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Subject: [rabbitmq-discuss] RabbitMQ Consumer Error
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi there,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I wonder if someone can help me on this one. I am building the following
</I>&gt;<i> scenario:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Client -&gt; Mochiweb -&gt; RabbitMQ (via Erlang RabbitMQ Client code) -&gt; Python
</I>&gt;<i> consumer (using the Python CARROT AMQP library)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have everything working right until the Python consumer picks up the
</I>&gt;<i> message. I get the following error:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &quot;No JSON object could be decoded&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160;Let me step back a second.....here is an example of the BINARY sent from
</I>&gt;<i> the Erlang client (inside Mochiweb) to RabbitMQ:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> NOTE: I have simplified the call by just making a binary called &#147;Hello
</I>&gt;<i> World&#148; for &#147;Payload&#148;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Payload = &lt;&lt;&quot;Hello World&quot;&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Content = #content{class_id = 60,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; properties = amqp_util:basic_properties(),
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; properties_bin = none,
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; payload_fragments_rev = [Payload]
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160; },
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; amqp_channel:cast(Channel, BasicPublish, Content),
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> When the Python JSON library (decoder.py) receives this I can see the
</I>&gt;<i> message is formatted like:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#145;Hello World&#146;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> But if I send to RabbitMQ like follows using PYTHON..
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> from carrot.messaging import Publisher
</I>&gt;<i>
</I>&gt;<i> from carrot.connection import AMQPConnection
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> amqpconn = AMQPConnection(hostname=&quot;localhost&quot;, port=5672, userid=&quot;guest&quot;,
</I>&gt;<i> password=&quot;guest&quot;,vhost=&quot;/&quot;)
</I>&gt;<i>
</I>&gt;<i> publisher = Publisher(connection=amqpconn, exchange=&quot;amq.direct&quot;,
</I>&gt;<i> routing_key=&quot;a.b.c.*&quot;)
</I>&gt;<i>
</I>&gt;<i> publisher.send('Hello World')
</I>&gt;<i>
</I>&gt;<i> publisher.close()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I get the following for the message in the Python JSON library
</I>(decoder.py):
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#145;&#148;Hello World&#148;&#146;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> NOTE the subtle different between the two.....the first one is &#145;Hello
</I>World&#146;
&gt;<i> (from Erlang) and the second (from Python) is &#145;&#148;Hello World&#148;&#146;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I am just wondering if this is a &#147;Unicode&#148; thing or do I need to do
</I>&gt;<i> something to the Erlang BINARY before sending it to RabbitMQ?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I think this could also have to do with the BUILT IN JSON library in
</I>Python
&gt;<i> 2.6......I will look into that.....
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for the help....much appreciated ;-)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Lynton
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004128.html">[rabbitmq-discuss] RabbitMQ Consumer Error
</A></li>
	<LI>Next message: <A HREF="004129.html">[rabbitmq-discuss] Can I generate SNMP traps on Connection events?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4147">[ date ]</a>
              <a href="thread.html#4147">[ thread ]</a>
              <a href="subject.html#4147">[ subject ]</a>
              <a href="author.html#4147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
