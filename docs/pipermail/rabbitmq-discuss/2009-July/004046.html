<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] AMQP authentication with RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20AMQP%20authentication%20with%20RabbitMQ&In-Reply-To=cedc0c090907080957x6a043b12o11e665300bd86fc3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004045.html">
   <LINK REL="Next"  HREF="004047.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] AMQP authentication with RabbitMQ</H1>
    <B>Darien Kindlund</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20AMQP%20authentication%20with%20RabbitMQ&In-Reply-To=cedc0c090907080957x6a043b12o11e665300bd86fc3%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] AMQP authentication with RabbitMQ">darien at kindlund.com
       </A><BR>
    <I>Wed Jul  8 18:04:17 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004045.html">[rabbitmq-discuss] AMQP authentication with RabbitMQ
</A></li>
        <LI>Next message: <A HREF="004047.html">[rabbitmq-discuss] AMQP authentication with RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4046">[ date ]</a>
              <a href="thread.html#4046">[ thread ]</a>
              <a href="subject.html#4046">[ subject ]</a>
              <a href="author.html#4046">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Laurens,

I'm not an OpenSSL nor RabbitMQ expert, but I got the impression that
stunnel (which uses OpenSSL) somehow populates certificate information
after the connection is established via environment variables.  See
this URL for more information about the types of environment variables
available:
<A HREF="http://httpd.apache.org/docs/2.2/mod/mod_ssl.html">http://httpd.apache.org/docs/2.2/mod/mod_ssl.html</A>

Again, I'm not sure if 'mod_ssl' had to do anything with OpenSSL in
order to expose these variables to apache, but I'm guessing it _can_
be done with stunnel.

Hope this helps,
-- Darien

On Wed, Jul 8, 2009 at 12:57 PM, Laurens Van Houtven&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lvh at laurensvh.be</A>&gt; wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> Hi :-)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm wondering about encryption and authentication within AMQP (using RabbitMQ).
</I>&gt;<i>
</I>&gt;<i> I'm porting existing code that did not have a messaging component.
</I>&gt;<i> This code used per-client (in AMQP these would be producers)
</I>&gt;<i> pre-shared certificates to do authentication. The problem in porting
</I>&gt;<i> it (as I see it at least), is that with RabbitMQ+stunnel, the servers
</I>&gt;<i> (= AMQP consumers) never get to see the SSL'ed data coming from the
</I>&gt;<i> clients, so they cannot see the client certificate, so I can't use it
</I>&gt;<i> to do authentication.
</I>&gt;<i>
</I>&gt;<i> I'm trying to find a solution to this problem. I'd like to keep using
</I>&gt;<i> SSL, but just using SSL with pre-shared certificates only guarantees
</I>&gt;<i> my consumers that the producer is *a* known user -- my consumers don't
</I>&gt;<i> know *who* the producer is. For example, given two registered users
</I>&gt;<i> (with pre shared SSL certs) Alice and Mallory (the latter being up to
</I>&gt;<i> no good), I want to prevent that Mallory logs in with his SSL cert and
</I>&gt;<i> his username, but then pretends to be Alice in the actual message
</I>&gt;<i> contents.
</I>&gt;<i>
</I>&gt;<i> I'm not yet intricately familiar with the way RabbitMQ ACL's work, but
</I>&gt;<i> I think that it could be solved by using SSL (with stunnel), together
</I>&gt;<i> with a username and a password, and then have one vhost per user and
</I>&gt;<i> per consumer role. I'm not entirely sure how well RabbitMQ is designed
</I>&gt;<i> to scale as the number of vhosts increase, since this would result in
</I>&gt;<i> N*M queues (with M the number of services and N the number of uesrs).
</I>&gt;<i> Also, I think this means I also need one queue per user and per
</I>&gt;<i> service, since otherwise my consumers still don't know anything about
</I>&gt;<i> the user identity. I think this (unfortunately) means that my
</I>&gt;<i> consumers will need to be reconfigured every time a new user is added,
</I>&gt;<i> which obviously sucks pretty bad.
</I>&gt;<i>
</I>&gt;<i> Am I better off putting authentication in my message contents?
</I>&gt;<i>
</I>&gt;<i> Thanks in advance
</I>&gt;<i> Laurens
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v1.4.9 (GNU/Linux)
</I>&gt;<i> Comment: Use GnuPG with Firefox : <A HREF="http://getfiregpg.org">http://getfiregpg.org</A> (Version: 0.7.6)
</I>&gt;<i>
</I>&gt;<i> iEYEARECAAYFAkpUz+4ACgkQT5v5zGkvKT7VjQCfRxz/PD00FieuaEhQ3aAsjOFB
</I>&gt;<i> zyYAoLwdWb8pd34zaHCldzGUFnrD70yh
</I>&gt;<i> =wttN
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004045.html">[rabbitmq-discuss] AMQP authentication with RabbitMQ
</A></li>
	<LI>Next message: <A HREF="004047.html">[rabbitmq-discuss] AMQP authentication with RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4046">[ date ]</a>
              <a href="thread.html#4046">[ thread ]</a>
              <a href="subject.html#4046">[ subject ]</a>
              <a href="author.html#4046">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
