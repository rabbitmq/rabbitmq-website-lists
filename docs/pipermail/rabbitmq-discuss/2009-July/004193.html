<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] fanout exchange that does not keep messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20fanout%20exchange%20that%20does%20not%20keep%20messages&In-Reply-To=dbd9700a0907210625k7afabafeked2750299779731e%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004192.html">
   <LINK REL="Next"  HREF="004194.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] fanout exchange that does not keep messages</H1>
    <B>Brian Whitman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20fanout%20exchange%20that%20does%20not%20keep%20messages&In-Reply-To=dbd9700a0907210625k7afabafeked2750299779731e%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] fanout exchange that does not keep messages">brian at echonest.com
       </A><BR>
    <I>Tue Jul 21 14:44:03 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004192.html">[rabbitmq-discuss] fanout exchange that does not keep messages
</A></li>
        <LI>Next message: <A HREF="004194.html">[rabbitmq-discuss] fanout exchange that does not keep messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4193">[ date ]</a>
              <a href="thread.html#4193">[ thread ]</a>
              <a href="subject.html#4193">[ subject ]</a>
              <a href="author.html#4193">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I can confirm that the same behavior happens in 1.6.0 -- the &quot;logger&quot; queue
appears with no consumers, and also the memory increases with messages sent
to the fanout queue (whether there's consumers or not) until an eventual
crash.

On Tue, Jul 21, 2009 at 9:25 AM, Brian Whitman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">brian at echonest.com</A>&gt; wrote:

&gt;<i> Matthias -- I'm not sure how I'm seeing them in the queue list when there
</I>&gt;<i> are no consumers. And relatedly perhaps, the broker will crash after 20
</I>&gt;<i> hours or so when it runs out of memory, which confuses me as the queue
</I>&gt;<i> lengths are always 0.
</I>&gt;<i> Here's my steps using the following code:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://notes.variogr.am/post/143623387/broadcasting-your-logs-with-rabbitmq-and-python">http://notes.variogr.am/post/143623387/broadcasting-your-logs-with-rabbitmq-and-python</A>
</I>&gt;<i>
</I>&gt;<i> 1) Declare a Producer() and start sending messages
</I>&gt;<i>  - this does a channel access request, declares the fanout exchange w/
</I>&gt;<i> auto_delete=True, then declares the &quot;logger&quot; queue with exclusive False and
</I>&gt;<i> auto_delete as True, then binds the exchange and the queue
</I>&gt;<i>
</I>&gt;<i> At this point logger shows up in list_queues with 0 messages. There are
</I>&gt;<i> about 8 machines all writing messages to the queue (using immediate=True on
</I>&gt;<i> basic_publish.) There are no consumers at this point but the queue &quot;logger&quot;
</I>&gt;<i> is in the list.
</I>&gt;<i>
</I>&gt;<i> 2) Declare a few Consumers()
</I>&gt;<i>  - this does the same channel access request, declare, bind as the
</I>&gt;<i> Producer() -- same auto_delete and etc except the queue name is now
</I>&gt;<i> &quot;logger-randomUUID&quot; per Conusmer
</I>&gt;<i>
</I>&gt;<i> At this point logger and any logger-randomUUID show up in the list_queues.
</I>&gt;<i> Each has 0 messages, always. Everything works as it should... consumers get
</I>&gt;<i> messages from the Producers, queue size stays 0.
</I>&gt;<i>
</I>&gt;<i> But...
</I>&gt;<i>
</I>&gt;<i> Memory keeps going
</I>&gt;<i> up -- and eventually the broker will crash. Yesterday it lasted about 20 hours. I booted it again this a.m. and am testing with abnormal message loads (sending millions of messages.) Right
</I>&gt;<i> now memory is at 3.9% and increasing after only running 30m.
</I>&gt;<i>
</I>&gt;<i> I am using a newer version on the server, yes, and I will do a test on the
</I>&gt;<i> release version to see if that behavior changes. But my guess is I am doing
</I>&gt;<i> something else wrong in my queue setup.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090721/d732aca6/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090721/d732aca6/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004192.html">[rabbitmq-discuss] fanout exchange that does not keep messages
</A></li>
	<LI>Next message: <A HREF="004194.html">[rabbitmq-discuss] fanout exchange that does not keep messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4193">[ date ]</a>
              <a href="thread.html#4193">[ thread ]</a>
              <a href="subject.html#4193">[ subject ]</a>
              <a href="author.html#4193">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
