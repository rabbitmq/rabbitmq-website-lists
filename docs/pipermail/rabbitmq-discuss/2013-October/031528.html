<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High Availability RabbitMQ Client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5BANNOUNCEMENT%5D%20Introducing%20Lyra%3A%20A%20High%0A%20Availability%20RabbitMQ%20Client&In-Reply-To=%3C52718C27.8020905%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031304.html">
   <LINK REL="Next"  HREF="031529.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High Availability RabbitMQ Client</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5BANNOUNCEMENT%5D%20Introducing%20Lyra%3A%20A%20High%0A%20Availability%20RabbitMQ%20Client&In-Reply-To=%3C52718C27.8020905%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High Availability RabbitMQ Client">matthias at rabbitmq.com
       </A><BR>
    <I>Wed Oct 30 22:45:59 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031304.html">[rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High Availability RabbitMQ Client
</A></li>
        <LI>Next message: <A HREF="031529.html">[rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High	Availability RabbitMQ Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31528">[ date ]</a>
              <a href="thread.html#31528">[ thread ]</a>
              <a href="subject.html#31528">[ subject ]</a>
              <a href="author.html#31528">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jonathan,

On 24/10/13 04:14, Jonathan Halterman wrote:
&gt;<i> Lyra distinguishes between recovery and retries. If an invocation
</I>&gt;<i> such as Channel.basicConsume fails due to an unexpected (not user
</I>&gt;<i> initiated) channel closure, the channel is automatically recovered,
</I>&gt;<i> along with any consumers, according to the configured recovery policy.
</I>
one of the trickier aspects of implementing transparent recovery of AMQP 
channels/connections is what to do about acks for messages received on a 
previous incarnation of a channel. E.g. say a client has set up a 
consumer and the server has sent a bunch of messages to the client. Then 
some event - e.g. a 'publish' to an unknown exchange - occurs that 
causes the server to close the channel with an error. Now, say the 
recovery logic is transparently creating a new channel. Concurrently 
though, the consumer code is still happily processing the messages it 
received before the error, and attempting to ack them.

If these acks go to the replacement channel, one of the following will 
happen:
a) a 'precondition_failed' error is raised by the server, complaining 
about an unknown delivery tag, or
b) the wrong message is acknowledged, i.e. a message sent on the 
replacement channel which happens to have the same delivery tag as the 
messsage sent on the original channel

How does Lyra deal with this scenario?

One way to handle this is to simply discard these acks. But that 
requires the client/app to hold extra state, so it can identify them.

Regards,

Matthias.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031304.html">[rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High Availability RabbitMQ Client
</A></li>
	<LI>Next message: <A HREF="031529.html">[rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High	Availability RabbitMQ Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31528">[ date ]</a>
              <a href="thread.html#31528">[ thread ]</a>
              <a href="subject.html#31528">[ subject ]</a>
              <a href="author.html#31528">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
