<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Wrong number of messages_ready shown in queue when using message-ttl with federation.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Wrong%20number%20of%20messages_ready%20shown%20in%0A%20queue%20when%20using%20message-ttl%20with%20federation.&In-Reply-To=%3C1381428667.2456.24.camel%40malte-VGN-CR21S-L%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030900.html">
   <LINK REL="Next"  HREF="030901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Wrong number of messages_ready shown in queue when using message-ttl with federation.</H1>
    <B>Malte Hurrelmann</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Wrong%20number%20of%20messages_ready%20shown%20in%0A%20queue%20when%20using%20message-ttl%20with%20federation.&In-Reply-To=%3C1381428667.2456.24.camel%40malte-VGN-CR21S-L%3E"
       TITLE="[rabbitmq-discuss] Wrong number of messages_ready shown in queue when using message-ttl with federation.">huitrouge at googlemail.com
       </A><BR>
    <I>Thu Oct 10 19:11:07 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030900.html">[rabbitmq-discuss] Wrong number of messages_ready shown in queue when using message-ttl with federation.
</A></li>
        <LI>Next message: <A HREF="030901.html">[rabbitmq-discuss] Wrong number of messages_ready shown in queue when using message-ttl with federation.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30902">[ date ]</a>
              <a href="thread.html#30902">[ thread ]</a>
              <a href="subject.html#30902">[ subject ]</a>
              <a href="author.html#30902">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, so if a message without or with a longer TTL is at the head of the
queue this will &quot;block&quot; all other messages to expire until they are at
head of queue themselves.

In our case however, all messages are always enqueued with the same TTL
(72hours), so they should all expire?
So I take it this is something different?

BTW. We are running RMQ 3.1.4.

Regards,
Malte.

On Do, 2013-10-10 at 15:16 +0100, Simon MacMullen wrote:
&gt;<i> Have you read <A HREF="http://www.rabbitmq.com/ttl.html#per-message-ttl-caveats?">http://www.rabbitmq.com/ttl.html#per-message-ttl-caveats?</A>
</I>&gt;<i> 
</I>&gt;<i> If messages expire while in the middle of a queue, they will not be 
</I>&gt;<i> removed until they reach the head of the queue. That sounds like what 
</I>&gt;<i> you're seeing.
</I>&gt;<i> 
</I>&gt;<i> Cheers, Simon
</I>&gt;<i> 
</I>&gt;<i> On 10/10/13 14:51, Malte Hurrelmann wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; we're using a two broker setup, connected by the federation-plugin to
</I>&gt;<i> &gt; ensure the consumers have a broker to fail over to, if the primary
</I>&gt;<i> &gt; broker should become unreachable.
</I>&gt;<i> &gt; Messages are published to an exchange in the master-broker with a
</I>&gt;<i> &gt; message-ttl on them, so that they don't pile up endlessly on the main
</I>&gt;<i> &gt; and backup broker.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I noticed in some rare cases the number of &quot;messages_ready&quot; in a queue
</I>&gt;<i> &gt; as shown in management_plugin / REST-API / &quot;rabbitmqctl list_queues&quot; is
</I>&gt;<i> &gt; not correct and increases to grow until I do a GET on that queue.
</I>&gt;<i> &gt; For example it shows 1000 messages and after I get 1 message of that
</I>&gt;<i> &gt; queue next time it shows 500 messages remaining. After that the
</I>&gt;<i> &gt; message-count is correct again.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm planning to do some monitoring on that info, so it would be nice to
</I>&gt;<i> &gt; have reliable info on the number of message left in the queues.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Any ideas on how to fix this issue or where to get the correct amount of
</I>&gt;<i> &gt; messages_ready elsewhere?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Best regards,
</I>&gt;<i> &gt; Malte.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030900.html">[rabbitmq-discuss] Wrong number of messages_ready shown in queue when using message-ttl with federation.
</A></li>
	<LI>Next message: <A HREF="030901.html">[rabbitmq-discuss] Wrong number of messages_ready shown in queue when using message-ttl with federation.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30902">[ date ]</a>
              <a href="thread.html#30902">[ thread ]</a>
              <a href="subject.html#30902">[ subject ]</a>
              <a href="author.html#30902">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
