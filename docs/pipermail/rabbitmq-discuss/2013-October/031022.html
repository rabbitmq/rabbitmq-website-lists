<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] time to live on a durable message
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20time%20to%20live%20on%20a%20durable%20message&In-Reply-To=%3C98E767B9-E1BD-45B6-8848-7F5AAC844019%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031023.html">
   <LINK REL="Next"  HREF="031024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] time to live on a durable message</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20time%20to%20live%20on%20a%20durable%20message&In-Reply-To=%3C98E767B9-E1BD-45B6-8848-7F5AAC844019%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] time to live on a durable message">watson.timothy at gmail.com
       </A><BR>
    <I>Wed Oct 16 08:52:36 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031023.html">[rabbitmq-discuss] time to live on a durable message
</A></li>
        <LI>Next message: <A HREF="031024.html">[rabbitmq-discuss] Redeliver limit?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31022">[ date ]</a>
              <a href="thread.html#31022">[ thread ]</a>
              <a href="subject.html#31022">[ subject ]</a>
              <a href="author.html#31022">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

On 15 Oct 2013, at 18:58, &quot;PATAR, SAGAR&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sp345s at att.com</A>&gt; wrote:

&gt;<i> Is there a way we can define time to live on a message published to a durable exchange ..
</I>
Not really, because exchanges don't hold messages, only queues do.

&gt;<i>  
</I>&gt;<i> What happens when a message binding key doesn&#8217;t matches any binding .. does it stay in the durable exchange till the time to live is expired ..
</I>
No. When messages are unroutable, they're discarded (and possibly returned to the sender, depending on how they were published).

&gt;<i>  
</I>&gt;<i> Scenario 1:
</I>&gt;<i> Let&#8217;s say we have a time to live of 2 hr for a message and its published to a durable exchange with no binding Key match (ex: binding key = NoMatch) &#8230; after 1 hr let&#8217;s say a  client subscribes for messages with bindingKey =&#8221;NoMatch&#8221; on that exchange .. will the message be delivered to the client ??
</I>&gt;<i>  
</I>
To do this, you might create a catch all binding to a queue on which you've set a 1hr TTL and configure a dead-letter-exchange to republish if necessary.

When subscribing, consume from both the catch all queue and the queue you're actually interested in. But of course the message will be routed to both queues so you'll see it twice if it matches the 'real' binding.

You might be able to work around this with some crazy complex topology, but I doubt it. You can de-duplicate based on correlation-id, though of course this puts storage requirements onto your application.

Personally, I'd try to re-design the system to avoid this scenario, perhaps by handling unroutable messages on the sender instead, or by attaching a housekeeper to the catch all queue that republishes periodically. Bear in mind that if your &quot;client subscribes to messages with a binding key &quot;NoMatch&quot; - I assume this means they create a temporary queue and bind it tot the exchange - then just having the TTL plus setting the dead letter exchange might work, though once a cycle is detected you'll loose the message iirc.

&gt;<i> Scenario 2:
</I>&gt;<i> Let&#8217;s say we have a time to live of 2 hr for a message and its published to a durable exchange with a binding key match (ex: binding key = match)  and the message will be routed to a queue and is consumed by a client .. After 1 hr If a new client subscribes for the messages with bindingKey =&#8221;match&#8221; by creating a new Queue ..will the new client get the  same message
</I>&gt;<i> 
</I>
That won't work, since once a message is delivered it will be removed from the queue. You could try doing the thing above (with TTL and DLX) an use a fanout exchange to simulate this, but there are probably lots of corner cases that wont work as expected.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131016/91c0e2fa/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131016/91c0e2fa/attachment.htm</A>&gt;
</PRE>































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031023.html">[rabbitmq-discuss] time to live on a durable message
</A></li>
	<LI>Next message: <A HREF="031024.html">[rabbitmq-discuss] Redeliver limit?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31022">[ date ]</a>
              <a href="thread.html#31022">[ thread ]</a>
              <a href="subject.html#31022">[ subject ]</a>
              <a href="author.html#31022">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
