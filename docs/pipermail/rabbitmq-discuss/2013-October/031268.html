<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] AlreadyClosedException always sets hardError	and initiatedByApplication to true
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20AlreadyClosedException%20always%20sets%20hardError%0A%09and%20initiatedByApplication%20to%20true&In-Reply-To=%3C7495FFDC-5C6B-4BE3-AD68-79C3AF96F82D%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031234.html">
   <LINK REL="Next"  HREF="031299.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] AlreadyClosedException always sets hardError	and initiatedByApplication to true</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20AlreadyClosedException%20always%20sets%20hardError%0A%09and%20initiatedByApplication%20to%20true&In-Reply-To=%3C7495FFDC-5C6B-4BE3-AD68-79C3AF96F82D%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] AlreadyClosedException always sets hardError	and initiatedByApplication to true">steve at rabbitmq.com
       </A><BR>
    <I>Wed Oct 23 11:24:48 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031234.html">[rabbitmq-discuss] AlreadyClosedException always sets hardError and initiatedByApplication to true
</A></li>
        <LI>Next message: <A HREF="031299.html">[rabbitmq-discuss] AlreadyClosedException always sets hardError and initiatedByApplication to true
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31268">[ date ]</a>
              <a href="thread.html#31268">[ thread ]</a>
              <a href="subject.html#31268">[ subject ]</a>
              <a href="author.html#31268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jonathan,
There are some subtleties here. Comments in-line:

On 22 Oct 2013, at 17:07, Jonathan Halterman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jhalterman at gmail.com</A>&gt; wrote:

&gt;<i> if you're doing rapid basicPublish calls to a non-existent exchange. Eventually basicPublish fails with an AlreadyClosedException, but this often occurs before the Channel's ShutdownListener is called. So the client has no fair way of avoiding the AlreadyClosedException.
</I>Let's get one thing out of the way first of all.

Basic.Publish is an asynchronous call. Therefore, if the channel is known and open as far as the client is concerned, there is no good reason for the Basic.Publish to fail (or know anything about the exchange's existence) and no way for the client to prevent subsequent Basic.Publish calls until there are replies back from the server.  Nor is there any way to stop previously queued consumer actions on that channel from running. Consumers will be driven (eventually) with a handleShutdownSignal() as their last action. Any channel ShutdownListener will also be driven with the ShutdownSignalException passed to it, but asynchronously. Ordering of action and listener call is not enforced by the client.

If a subsequent action on a closed channel is executed, you will get an AlreadyClosedException (sometimes&#8212;ought this to be always?) and this is due to an application initiated action (!), and has a channel reference.  (It is represented as a hard error, which is probably wrong.) 

Given the channel reference you can get the ShutdownSignalException which closed that channel with Channel.getCloseReason().
This also works on Connections.

&gt;<i> So from my perspective, there are a few things I'd prefer to see out of all this:
</I>&gt;<i> 
</I>&gt;<i> - That AlreadyClosedExceptions be allowed to represent channels that were already closed (as seems to be the case with the reference being set to a Channel).
</I>On Channel method calls it does that already, but has hardError set to true, which is sometimes misleading.

&gt;<i> - That an invocation against a Channel that has already been closed does not result in the Connection being closed (as seems to be the case).
</I>It depends on what you mean by 'already closed'. If the client knows it has closed, then yes, I agree with you. If it doesn't (yet) know it has closed (as in the case for a little while after a publish to a non-existent exchange) then it may not be able to throw an exception (yet).  It may, though, because some actions are synchronous with server interaction, which means we can tell from the response if something went wrong.

&gt;<i> - That AlreadyClosedExceptions include the Method that originally cased the closure as the shutdown reason (if any), such as 404. This would allow me to determine why a basicPublish fails.
</I>See above: given the object that has closed, you should be able to get the ShutdownSignalException and determine why it closed.

Steve Powell  [Cell: +44-7815-838-558] [RabbitMQ, Pivotal]
&#8220;L&#8217;enfer, c&#8217;est les autres.&#8221; Sartre

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131023/71d970f7/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131023/71d970f7/attachment.htm</A>&gt;
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031234.html">[rabbitmq-discuss] AlreadyClosedException always sets hardError and initiatedByApplication to true
</A></li>
	<LI>Next message: <A HREF="031299.html">[rabbitmq-discuss] AlreadyClosedException always sets hardError and initiatedByApplication to true
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31268">[ date ]</a>
              <a href="thread.html#31268">[ thread ]</a>
              <a href="subject.html#31268">[ subject ]</a>
              <a href="author.html#31268">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
