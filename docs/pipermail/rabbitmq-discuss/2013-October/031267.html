<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] unable to join the cluster node ..
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20unable%20to%20join%20the%20cluster%20node%20..&In-Reply-To=%3CE051274D-B448-4E78-8B94-34734525149F%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031011.html">
   <LINK REL="Next"  HREF="031013.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] unable to join the cluster node ..</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20unable%20to%20join%20the%20cluster%20node%20..&In-Reply-To=%3CE051274D-B448-4E78-8B94-34734525149F%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] unable to join the cluster node ..">watson.timothy at gmail.com
       </A><BR>
    <I>Wed Oct 23 10:50:39 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031011.html">[rabbitmq-discuss] unable to join the cluster node ..
</A></li>
        <LI>Next message: <A HREF="031013.html">[rabbitmq-discuss] Reminder: help us test Bunny 1.0 RCs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31267">[ date ]</a>
              <a href="thread.html#31267">[ thread ]</a>
              <a href="subject.html#31267">[ subject ]</a>
              <a href="author.html#31267">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

First off, sorry it took so long to get to this - your question managed o slip through he cracks somehow.

On 15 Oct 2013, at 16:58, sagu prf &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sagu.prf1 at gmail.com</A>&gt; wrote:

&gt;<i> while stoping the Ram node as master unable to fail over to
</I>&gt;<i> disk which alive more day than ram node and surprisingly it's why this
</I>&gt;<i> disc node not take over as master ( which uptime was higher than ram
</I>&gt;<i> node)
</I>
It's not abundantly clear to me why has actually gone wrong here. What exactly does your cluster look like and which commands were applied to which nodes in order to produce the errors below. Did these error logs appear on the node that was stopped (or removed from the cluster), at which point did they appear and how did you detect that the operation failed? Did the command return any additional error information or messages?

&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 14-Oct-2013::10:57:01 ===
</I>&gt;<i> Mnesia('<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv05</A>'): ** ERROR ** (core dumped to file:
</I>&gt;<i> &quot;/var/lib/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">MnesiaCore.rabbit at linuxserv05_1381_809421_158007</A>&quot;)
</I>&gt;<i> ** FATAL ** Failed to merge schema: Bad cookie in table definition
</I>&gt;<i> rabbit_user_permission: '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv05</A>' =
</I>&gt;<i> {cstruct,rabbit_user_permission,set,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv01</A>'],['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv06</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv05</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv04</A>']
</I>&gt;<i> ,[],0,read_write,false,[],[],false,user_permission,[user_vhost,permission],[],[],[],{{1376,164084,168369},'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv04</A>'},
</I>&gt;<i> {{4,2},{'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv05</A>',{1381,784616,463441}}}},
</I>&gt;<i> '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv01</A>' =
</I>&gt;<i> {cstruct,rabbit_user_permission,set,[],['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv01</A>'],
</I>&gt;<i> [],0,read_write,false,[],[],false,user_permission,[user_vhost,permission],[],[],[],{{1381,794520,133541},'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv01</A>'},{{2,0},[]}}
</I>&gt;<i> 
</I>
What version of rabbit are you running? And what version of erlang? Are all nodes running the same versions of both?

&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 14-Oct-2013::10:57:11 ===
</I>&gt;<i> ** Generic server mnesia_monitor terminating
</I>&gt;<i> ** Last message in was {'EXIT',&lt;0.46.0&gt;,killed}
</I>&gt;<i> ** When Server state == {state,&lt;0.46.0&gt;,[],[],true,[],undefined,[]}
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** killed
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 14-Oct-2013::10:57:11 ===
</I>&gt;<i> ** Generic server mnesia_recover terminating
</I>&gt;<i> ** Last message in was {'EXIT',&lt;0.46.0&gt;,killed}
</I>&gt;<i> ** When Server state == {state,&lt;0.46.0&gt;,undefined,undefined,undefined,0,false,
</I>&gt;<i>                               true,[]}
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** killed
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 14-Oct-2013::10:57:11 ===
</I>&gt;<i> ** Generic server mnesia_subscr terminating
</I>&gt;<i> ** Last message in was {'EXIT',&lt;0.46.0&gt;,killed}
</I>&gt;<i> ** When Server state == {state,&lt;0.46.0&gt;,20502}
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** killed
</I>&gt;<i> 
</I>&gt;<i> =INFO REPORT==== 14-Oct-2013::10:57:11 ===
</I>&gt;<i>    application: mnesia
</I>&gt;<i>    exited: {shutdown,{mnesia_sup,start,[normal,[]]}}
</I>&gt;<i>    type: permanent
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 14-Oct-2013::10:57:11 ===
</I>&gt;<i> ** Generic server mnesia_snmp_sup terminating
</I>&gt;<i> ** Last message in was {'EXIT',&lt;0.46.0&gt;,killed}
</I>&gt;<i> ** When Server state == {state,
</I>&gt;<i>                            {local,mnesia_snmp_sup},
</I>&gt;<i>                            simple_one_for_one,
</I>&gt;<i>                            [{child,undefined,mnesia_snmp_sup,
</I>&gt;<i>                                 {mnesia_snmp_hook,start,[]},
</I>&gt;<i>                                 transient,3000,worker,
</I>&gt;<i>                                 [mnesia_snmp_sup,mnesia_snmp_hook,
</I>&gt;<i>                                  supervisor]}],
</I>&gt;<i>                            undefined,0,86400000,[],mnesia_snmp_sup,[]}
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** killed
</I>&gt;<i> 
</I>&gt;<i> i have tried the
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv04</A>% rabbitmqctl -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv01</A> stop_app
</I>
At which point did you do that?

&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv04</A>% rabbitmqctl -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv01</A> reset
</I>&gt;<i> it lost all Queue informations ..
</I>
That is what reset does...

&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at linuxserv04</A>%
</I>&gt;<i> failing to join the cluster ..
</I>&gt;<i> 
</I>&gt;<i> linuxserv05%rabbitmq-server -detached failed to  join .
</I>&gt;<i> 
</I>&gt;<i> even i tired with manually but it was failed ..
</I>&gt;<i> 
</I>
Seems like the cluster nodes have a different view of the world. Did you experience any network partitions during this time?

&gt;<i> is there any other method to remove this linuxserv01 from cluster and
</I>&gt;<i> bring back another node into cluster (linuxserv05) ? without shutdown
</I>&gt;<i> entire
</I>&gt;<i> cluster .
</I>
I don't think so. It looks to me (and perhaps one of the other developers is better versed in this and will correct me) as though your nodes are very confused about cluster membership.

You could've tried starting the failing node with RABBITMQ_NODE_ONLY=1 and then running leave_cluster or some such, but now that you've reset it I don't think that will work.

Tim
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031011.html">[rabbitmq-discuss] unable to join the cluster node ..
</A></li>
	<LI>Next message: <A HREF="031013.html">[rabbitmq-discuss] Reminder: help us test Bunny 1.0 RCs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31267">[ date ]</a>
              <a href="thread.html#31267">[ thread ]</a>
              <a href="subject.html#31267">[ subject ]</a>
              <a href="author.html#31267">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
