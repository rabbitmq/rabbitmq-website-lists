<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ and Clustering on Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20Clustering%20on%20Windows&In-Reply-To=%3C0B8CD6850421B745BE39BC5C76019232A682701F%40DDCEP50016.na.corp.mckesson.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030944.html">
   <LINK REL="Next"  HREF="030915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ and Clustering on Windows</H1>
    <B>Cordell, Ron</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20Clustering%20on%20Windows&In-Reply-To=%3C0B8CD6850421B745BE39BC5C76019232A682701F%40DDCEP50016.na.corp.mckesson.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ and Clustering on Windows">Ron.Cordell at RelayHealth.com
       </A><BR>
    <I>Fri Oct 11 00:30:18 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030944.html">[rabbitmq-discuss] Disappearing Durable Queues
</A></li>
        <LI>Next message: <A HREF="030915.html">[rabbitmq-discuss] RabbitMQ and Clustering on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30903">[ date ]</a>
              <a href="thread.html#30903">[ thread ]</a>
              <a href="subject.html#30903">[ subject ]</a>
              <a href="author.html#30903">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

We've been trying to run RabbitMQ as a cluster on Windows Server 2008 R2 for some time now and are having stability issues &#8211; namely the cluster will partition spontaneously.

The cluster originally consists of 5 RabbitMQ &quot;nodes&quot;, each running on a separate VMWare ESX server.

Each instance is separated from another instance by at most two switch hops and no routers in the same cage in the data center. So while each instance is on a separate ESX physical host and in separate racks/power/etc, the network is such that there is no routing between Rabbit cluster nodes and all nodes are in the same VLAN. The racks are physically next to each other.

The cluster itself is behind an F5 load balancer which provides a VIP to the application servers. The F5 round robbins to the Rabbit nodes in the cluster. The F5 attempts to connect to each node in the cluster to determine if the node is up and adds/removes from the load balancing pool automatically.

All of the queues on this cluster are on the same vHost, and most of the queues are mirrored/HA queues.

The version of Rabbit is 3.1.5 and Erlang 16B01, 64 bit Windows.

On every environment from PERFORMANCE, STAGE, INTEGRATION and PRODUCTION we see the cluster partition. It can happen 15 minutes after starting the cluster to a number of days.

Network latency is sub-millisecond between cluster nodes.

We have dropped the cluster size down to 3, then 2.
We have moved all nodes on the cluster to the same VMWare ESX server, which removes all of the physical networking.
We have upgraded from ESX 4.5.x to ESX 5.1.
We've tried every configuration we can think of but still see the cluster partition after some time.
We have one environment up and running for 18 days, another for 12 days, the rest have reached, at most, 2-3 days.
Network monitors show no disruptions or latency in network traffic.
It doesn't matter if the application is running against the cluster or not.

And yet we continue to experience these network partitions.

Unfortunately I'm not able to test on a set of Linux machines in this environment.

I've sent logs in previous posts and Simon has said that we have to fix our network partition problem, but as far as we can tell we don't have one.

My questions are:


  *   is this expected behavior?
  *   Is this a Erlang on Windows problem? Is anyone running an HA cluster of similar configuration successfully on the equivalent Rabbit/Erlang versions?
  *   Is there anything that I should be checking that we might have missed?

All ideas are welcome!

Cheers,

Ron


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131010/bef6abdb/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131010/bef6abdb/attachment.htm</A>&gt;
</PRE>









































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030944.html">[rabbitmq-discuss] Disappearing Durable Queues
</A></li>
	<LI>Next message: <A HREF="030915.html">[rabbitmq-discuss] RabbitMQ and Clustering on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30903">[ date ]</a>
              <a href="thread.html#30903">[ thread ]</a>
              <a href="subject.html#30903">[ subject ]</a>
              <a href="author.html#30903">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
