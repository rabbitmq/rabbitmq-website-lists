<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Determining Cause of Flow-Control Invocation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Determining%20Cause%20of%20Flow-Control%20Invocation&In-Reply-To=%3CCAO%3D6ox9ecdFKpohy0J8PrVZcSM1C1V-JxPLhN0P%3D3jdPCPaFLQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030699.html">
   <LINK REL="Next"  HREF="030704.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Determining Cause of Flow-Control Invocation</H1>
    <B>Richard Raseley</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Determining%20Cause%20of%20Flow-Control%20Invocation&In-Reply-To=%3CCAO%3D6ox9ecdFKpohy0J8PrVZcSM1C1V-JxPLhN0P%3D3jdPCPaFLQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Determining Cause of Flow-Control Invocation">richard at raseley.com
       </A><BR>
    <I>Fri Oct  4 15:40:45 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030699.html">[rabbitmq-discuss] mirrored queue cluster
</A></li>
        <LI>Next message: <A HREF="030704.html">[rabbitmq-discuss] Determining Cause of Flow-Control Invocation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30698">[ date ]</a>
              <a href="thread.html#30698">[ thread ]</a>
              <a href="subject.html#30698">[ subject ]</a>
              <a href="author.html#30698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We currently use RabbitMQ as a broker for a subset of our overall logging
platform. Recently, we attempted to add an additional category of logging
that would result in additional load of approximately 2,000 msg/sec with an
average message size of approximately 2KB.

Upon adding this additional category of logging, we noticed a couple things:

(1) Our consumers were not able to keep up with the flow of messages, so
they began to build up in the queue (our developers are working on fixing
this).

(2) We began to see RabbitMQ invoke flow-control in the form of TCP
back-pressure on our producers.

My initial thought was that since we were using durable queues with
persistent messages that when the consumers weren't immediately picking up
the messages, RabbitMQ was attempting to persist them to disk in order to
satisfy the persistence &amp; durability requirements and it couldn't keep up.

But in following up with my developers this morning it seems that they are
in fact no publishing the messages as persistent and being that (based on
my understanding) a non-persistent message published to a durable queue is
not written to disk, this threw my initial theory out the windows (I still
have to verify their claim of non-persistence).

So, my question is - what other things can I look at to determine the cause
of the invocation of flow control. Additional relevant information is as
follows:

(*) 2x RabbitMQ Nodes Running 3.1.3 in a clustered configuration.
(*) Each node has 8x 2GHzCPU cores and 4GB of RAM.
(*) At no time during the window in question did CPU utilization reach &gt;15%
(*) At no time during the window in question did memory utilization reach
&gt;<i>50%
</I>(*) In looking at the logs during the window in question I can see events
which I think are associated with the various publishers disconnecting (I
am not sure if our producer code is handling flow-control gracefully) but
nothing that seems to indicate why this happened.

Any help would be greatly appreciated.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131004/4bd978e7/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131004/4bd978e7/attachment.htm</A>&gt;
</PRE>









































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030699.html">[rabbitmq-discuss] mirrored queue cluster
</A></li>
	<LI>Next message: <A HREF="030704.html">[rabbitmq-discuss] Determining Cause of Flow-Control Invocation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30698">[ date ]</a>
              <a href="thread.html#30698">[ thread ]</a>
              <a href="subject.html#30698">[ subject ]</a>
              <a href="author.html#30698">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
