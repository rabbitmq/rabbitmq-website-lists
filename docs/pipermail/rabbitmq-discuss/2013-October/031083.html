<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Unexpected Behavior When Using the	&quot;X-Consistent-Hash&quot; Exchange Type
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unexpected%20Behavior%20When%20Using%20the%0A%09%22X-Consistent-Hash%22%20Exchange%20Type&In-Reply-To=%3C7C92AF06-FFDE-4729-A0C6-AD7EDDBBFBD8%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031081.html">
   <LINK REL="Next"  HREF="031084.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Unexpected Behavior When Using the	&quot;X-Consistent-Hash&quot; Exchange Type</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unexpected%20Behavior%20When%20Using%20the%0A%09%22X-Consistent-Hash%22%20Exchange%20Type&In-Reply-To=%3C7C92AF06-FFDE-4729-A0C6-AD7EDDBBFBD8%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Unexpected Behavior When Using the	&quot;X-Consistent-Hash&quot; Exchange Type">mklishin at gopivotal.com
       </A><BR>
    <I>Wed Oct 16 22:43:23 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031081.html">[rabbitmq-discuss] Unexpected Behavior When Using the	&quot;X-Consistent-Hash&quot; Exchange Type
</A></li>
        <LI>Next message: <A HREF="031084.html">[rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31083">[ date ]</a>
              <a href="thread.html#31083">[ thread ]</a>
              <a href="subject.html#31083">[ subject ]</a>
              <a href="author.html#31083">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On oct 16, 2013, at 11:58 p.m., Richard Raseley &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">richard at raseley.com</A>&gt; wrote:

&gt;<i> 1) Why am I seeing such uneven distribution of messages between the queues bound to the x-consistent-hash exchange?
</I>&gt;<i> 
</I>&gt;<i> 2) What can I do to ensure the most even distribution of messages as possible across the queues bound to the x-consistent-has exchange?
</I>
Consistent hash exchange requires routing keys to be integers *as strings* (yes,
this is unfortunate, but routing keys have to be strings in the protocol).

My guess is that when you use UUIDs, implicit conversion happens and those
that happen to have digits as initial characters result in messages being routed
but others are voided. You can try publishing the messages as mandatory
and see if any of them are returned.

This requirement is mentioned in README:

<A HREF="http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v3_1_5/README.md#l99">http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v3_1_5/README.md#l99</A>

See <A HREF="https://github.com/ruby-amqp/bunny/blob/master/spec/higher_level_api/integration/consistent_hash_exchange_spec.rb">https://github.com/ruby-amqp/bunny/blob/master/spec/higher_level_api/integration/consistent_hash_exchange_spec.rb</A>
for example (not in Python but hopefully demonstrative enough).

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131017/ebf66447/attachment.pgp">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131017/ebf66447/attachment.pgp</A>&gt;
</PRE>








































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031081.html">[rabbitmq-discuss] Unexpected Behavior When Using the	&quot;X-Consistent-Hash&quot; Exchange Type
</A></li>
	<LI>Next message: <A HREF="031084.html">[rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31083">[ date ]</a>
              <a href="thread.html#31083">[ thread ]</a>
              <a href="subject.html#31083">[ subject ]</a>
              <a href="author.html#31083">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
