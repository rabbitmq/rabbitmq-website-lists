<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] SSL Certificate Verfitcation failures
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20SSL%20Certificate%20Verfitcation%20failures&In-Reply-To=%3Cde4c3289-6f9f-4501-b8e7-2eec56f09781%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031398.html">
   <LINK REL="Next"  HREF="031402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] SSL Certificate Verfitcation failures</H1>
    <B>Daniel Mitchell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20SSL%20Certificate%20Verfitcation%20failures&In-Reply-To=%3Cde4c3289-6f9f-4501-b8e7-2eec56f09781%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] SSL Certificate Verfitcation failures">daniel.mitchell at gmail.com
       </A><BR>
    <I>Mon Oct 28 12:59:14 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031398.html">[rabbitmq-discuss] SSL Certification Verification Fail
</A></li>
        <LI>Next message: <A HREF="031402.html">[rabbitmq-discuss] SSL Certificate Verfitcation failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31399">[ date ]</a>
              <a href="thread.html#31399">[ thread ]</a>
              <a href="subject.html#31399">[ subject ]</a>
              <a href="author.html#31399">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I've been trying to get mosquitto_sub to connect to RabbitMQ, when I 
perform a test using test.mosquitto.org and their certificate it works fine 
and when I connect to my RabbitMQ using OpenSSL s_client and I supply the 
CAfile it performs the handshake correctly. However this fails when sending 
the CAfile via mosquitto_sub

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vagrant at precise32</A>:/opt/data$ ./mosquitto-1.2.2/client/
mosquitto_sub -h **.***.***.** -p 8883 -t &quot;#&quot; -d --cafile DigiCertEA.pem 
--tls-version tlsv1
Client mosqsub/3530-precise32 sending CONNECT
OpenSSL Error: error:14090086:SSL 
routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed
Error: Protocol error

RabbitMQ = 3.2.0
OpenSSL = 1.0.1
Erlang = R16B

This is the detail from my log in RabbitMQ. The CAfiles have slightly 
different names but using openssl x509 -in -text -noout gives the same 
serial number

=ERROR REPORT==== 28-Oct-2013::12:52:02 ===
SSL: certify: tls_connection.erl:2286:Fatal error: certificate unknown

=ERROR REPORT==== 28-Oct-2013::12:52:07 ===
** Generic server &lt;0.594.0&gt; terminating 
** Last message in was {inet_async,#Port&lt;0.14157&gt;,35762,{ok,#Port&lt;0.15830&gt;}}
** When Server state == {state,
                            {rabbit_mqtt_sup,start_ssl_client,
                                
[[{cacertfile,&quot;/etc/ssl/certs/DigiCertCA.pem&quot;},
                                  {certfile,
                                      
&quot;/etc/ssl/certs/star_*****_****_net_chain.pem&quot;},
                                  {keyfile,
                                      
&quot;/etc/ssl/private/*****.****.net.key&quot;},
                                  {verify,verify_none},
                                  {fail_if_no_peer_cert,false}]]},
                            #Port&lt;0.14157&gt;,35762}
** Reason for termination == 
** {timeout,{gen_server2,call,
                         [&lt;0.596.0&gt;,
                          {go,#Port&lt;0.15830&gt;,
                              #Fun&lt;rabbit_networking.2.65720357&gt;}]}}

=ERROR REPORT==== 28-Oct-2013::12:52:07 ===
** Generic server &lt;0.596.0&gt; terminating
** Last message in was 
{go,#Port&lt;0.15830&gt;,#Fun&lt;rabbit_networking.2.65720357&gt;}
** When Server state == undefined
** Reason for termination == 
** {{badmatch,{error,{ssl_upgrade_error,{tls_alert,&quot;certificate 
unknown&quot;}}}},
    [{rabbit_mqtt_reader,handle_call,3,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]}

Is this a problem with RabbitMQ or perhaps the mosquitto_sub client? If it 
belongs to the latter I guess I should redirect my question :)

Cheers,
Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131028/3ceb28e4/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131028/3ceb28e4/attachment.htm</A>&gt;
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031398.html">[rabbitmq-discuss] SSL Certification Verification Fail
</A></li>
	<LI>Next message: <A HREF="031402.html">[rabbitmq-discuss] SSL Certificate Verfitcation failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31399">[ date ]</a>
              <a href="thread.html#31399">[ thread ]</a>
              <a href="subject.html#31399">[ subject ]</a>
              <a href="author.html#31399">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
