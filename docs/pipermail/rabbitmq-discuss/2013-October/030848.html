<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Long timeout if server host becomes	unreachable
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Long%20timeout%20if%20server%20host%20becomes%0A%09unreachable&In-Reply-To=%3CCAOQRttoPNUy624XDb%3DKZzmZJ%3DLGzrqx6kzK_ZHjj_wYQrUczUg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030842.html">
   <LINK REL="Next"  HREF="030778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Long timeout if server host becomes	unreachable</H1>
    <B>Oleg Lyalikov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Long%20timeout%20if%20server%20host%20becomes%0A%09unreachable&In-Reply-To=%3CCAOQRttoPNUy624XDb%3DKZzmZJ%3DLGzrqx6kzK_ZHjj_wYQrUczUg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Long timeout if server host becomes	unreachable">oleg.lyalikov at gmail.com
       </A><BR>
    <I>Tue Oct  8 16:39:06 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030842.html">[rabbitmq-discuss] Long timeout if server host becomes	unreachable
</A></li>
        <LI>Next message: <A HREF="030778.html">[rabbitmq-discuss] ETS memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30848">[ date ]</a>
              <a href="thread.html#30848">[ thread ]</a>
              <a href="subject.html#30848">[ subject ]</a>
              <a href="author.html#30848">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i> &gt; If &quot;_socket&quot; field is not private in SocketFrameHandler I could try
</I>&gt;<i> overriding &quot;close&quot; method and invoke just _socket.close() - maybe that
</I>&gt;<i> would help. But the field is private (maybe we can copy/paste the class and
</I>&gt;<i> instantiate our new one but it does not look good - it would be better to
</I>&gt;<i> just enhance existing functionality not to replace - there could be some
</I>&gt;<i> problems with compatibility with newer versions of RabbitMQ client lib,
</I>&gt;<i> RabbitMQ tests should be run regularly as our own tests, etc).
</I>&gt;<i>
</I>&gt;<i> I understand the desire to avoid deploying a fork. However, it's already
</I>&gt;<i> clear that the client
</I>&gt;<i> needs to be modified somehow and you have a way to reliably reproduce the
</I>&gt;<i> problem (is this correct?)
</I>&gt;<i>
</I>&gt;<i> Perhaps the fastest turnaround time would be for you to make some changes
</I>&gt;<i> and try them out.
</I>&gt;<i> Once a solution that works is found, we will see if it can be incorporated
</I>&gt;<i> into the mainline.
</I>&gt;<i>
</I>
Reproducing is not too hard - we have 2 virtual machines and just turn
network off on the one machine when needed (maybe there is a better way but
that was pretty enough).
There is also possibility to not make copy/paste of SocketFrameHandler - we
managed to get Socket object through the reflection and invoking
socket.close() really caused the &quot;socketWrite&quot; method to throw an Exception
- what was desired. The last thing to do is registering write start time
and whether write is occurring right now - and separate thread can
successfully close socket when timeout expires.

We also have another specific solution - actually the problem appeared in
our HA configuration and components connected always to the &quot;primary&quot;
RabbitMQ host (with possibility to switch to backup and vice versa). When
primary host is shutdowned we observe this behavior. So now we want to try
to connect to &quot;localhost&quot; RabbitMQ first, we have an HA configuration
between RabbitMQ servers though we didn't do much tests with it but we hope
that solution can solve the problem for the majority of the cases. But
still blocked write can arise in some cases.

So we keep first solution in mind but for now it's unknown if we will make
fix. If we do we will share it so that it can help faster incorporating
into the library.


&gt;<i> &gt; Both workarounds require careful testing and time, we will think about
</I>&gt;<i> it. But I'm hoping RabbitMQ library will provide functionality to set
</I>&gt;<i> socket write timeout in the future.
</I>&gt;<i>
</I>&gt;<i> You can help with that. Contributing does involve submitting a CLA but
</I>&gt;<i> digital ones
</I>&gt;<i> are accepted.
</I>&gt;<i>
</I>&gt;<i> &gt; Could you provide some ticket link so that we can monitor its status?
</I>&gt;<i>
</I>&gt;<i> rabbitmq bug tracker is not public but we accept issues that are filed on
</I>&gt;<i> github, so I filed
</I>&gt;<i> one you can watch:
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://github.com/rabbitmq/rabbitmq-java-client/issues/11">https://github.com/rabbitmq/rabbitmq-java-client/issues/11</A>
</I>&gt;<i>
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i>
</I>Thank you very much for all your help,
Oleg




--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Long-timeout-if-server-host-becomes-unreachable-tp30275p30344.html">http://rabbitmq.1065348.n5.nabble.com/Long-timeout-if-server-host-becomes-unreachable-tp30275p30344.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131008/be379243/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131008/be379243/attachment.htm</A>&gt;
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030842.html">[rabbitmq-discuss] Long timeout if server host becomes	unreachable
</A></li>
	<LI>Next message: <A HREF="030778.html">[rabbitmq-discuss] ETS memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30848">[ date ]</a>
              <a href="thread.html#30848">[ thread ]</a>
              <a href="subject.html#30848">[ subject ]</a>
              <a href="author.html#30848">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
