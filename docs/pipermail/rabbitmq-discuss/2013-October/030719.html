<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Determining Cause of Flow-Control Invocation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Determining%20Cause%20of%20Flow-Control%20Invocation&In-Reply-To=%3CCAO%3D6ox-9sCp3FN9C1axyePwL%2Bepdj6eY4ZG09_eF%2BiLqDQCCKA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030706.html">
   <LINK REL="Next"  HREF="030720.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Determining Cause of Flow-Control Invocation</H1>
    <B>Richard Raseley</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Determining%20Cause%20of%20Flow-Control%20Invocation&In-Reply-To=%3CCAO%3D6ox-9sCp3FN9C1axyePwL%2Bepdj6eY4ZG09_eF%2BiLqDQCCKA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Determining Cause of Flow-Control Invocation">richard at raseley.com
       </A><BR>
    <I>Fri Oct  4 18:37:48 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030706.html">[rabbitmq-discuss] Determining Cause of Flow-Control Invocation
</A></li>
        <LI>Next message: <A HREF="030720.html">[rabbitmq-discuss] Determining Cause of Flow-Control Invocation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30719">[ date ]</a>
              <a href="thread.html#30719">[ thread ]</a>
              <a href="subject.html#30719">[ subject ]</a>
              <a href="author.html#30719">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Michael and Simon,

Thank you for taking the time to respond to my question. Yes, I was talking
about the per-connection flow-control.

The thing that stands out to me is Simon's statement that each queue can
only use 100% of one core. Looking back at our logging, it does seem that
one core was getting close to 100% during this time period (I need to get
more granular data to be sure if it hit it or not) - so this would explain
what we were seeing.

If that is the case, the obvious solution is to separate the load across
multiple queues. I will have to think on that a while, as our current
configuration was 1:1 mapping of queue to error type. Some questions:

(*) When a RabbitMQ broker has multiple queues, will it automatically
disperse them across the available cores? For example if I have 8 queues on
a broker with 8 cores, will it automatically ensure a 1:1 mapping of
queues:cores?

(*) In the situation where I have been using one queue that mapped well to
a logical construct (e.g 1 queue for info, 1 queue for warning, 1 queue for
errors) can you share your own personal opinions on the best way to divide
that up to ensure distribution across all cores (e.g. one queue per type
per core, one queue per producer per type, etc.)?

I have a little more digging to do.

Regards,

Richard



On Fri, Oct 4, 2013 at 8:00 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 04/10/2013 3:54PM, Michael Klishin wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> &gt;So, my question is - what other things can I look at to determine the
</I>&gt;&gt;&gt;<i> cause of the invocation of flow control
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> There are 3 cases when RabbitMQ will block publishers (until the
</I>&gt;&gt;<i> underlying problem
</I>&gt;&gt;<i> is resolved):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   * It consumes more RAM than vm_high_memory_watermark
</I>&gt;&gt;<i>   * Node has less disk space left than the configured minimum limit
</I>&gt;&gt;<i>   * RabbitMQ process is out of available file descriptors (ulimit -n)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I think the OP was talking about this:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/**memory.html#per-connection&lt;http://www.rabbitmq.com/memory.html#per-connection">http://www.rabbitmq.com/**memory.html#per-connection&lt;http://www.rabbitmq.com/memory.html#per-connection</A>&gt;
</I>&gt;<i>
</I>&gt;<i> not this:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/**memory.html#memsup&lt;http://www.rabbitmq.com/memory.html#memsup">http://www.rabbitmq.com/**memory.html#memsup&lt;http://www.rabbitmq.com/memory.html#memsup</A>&gt;
</I>&gt;<i>
</I>&gt;<i> I think so, anyway.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131004/02dfa02b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131004/02dfa02b/attachment.htm</A>&gt;
</PRE>



























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030706.html">[rabbitmq-discuss] Determining Cause of Flow-Control Invocation
</A></li>
	<LI>Next message: <A HREF="030720.html">[rabbitmq-discuss] Determining Cause of Flow-Control Invocation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30719">[ date ]</a>
              <a href="thread.html#30719">[ thread ]</a>
              <a href="subject.html#30719">[ subject ]</a>
              <a href="author.html#30719">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
