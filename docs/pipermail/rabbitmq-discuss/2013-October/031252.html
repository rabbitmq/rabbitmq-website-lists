<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ / Erlang not running on all cores?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20/%20Erlang%20not%20running%20on%20all%20cores%3F&In-Reply-To=%3CCACLE7izR1PerzQ6p6BD%3DCHhP0KqwZmzv3EggfF7kjmV_rg_vzw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031250.html">
   <LINK REL="Next"  HREF="031254.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ / Erlang not running on all cores?</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20/%20Erlang%20not%20running%20on%20all%20cores%3F&In-Reply-To=%3CCACLE7izR1PerzQ6p6BD%3DCHhP0KqwZmzv3EggfF7kjmV_rg_vzw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ / Erlang not running on all cores?">mpietrek at skytap.com
       </A><BR>
    <I>Tue Oct 22 23:44:36 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031250.html">[rabbitmq-discuss] RabbitMQ / Erlang not running on all cores?
</A></li>
        <LI>Next message: <A HREF="031254.html">[rabbitmq-discuss] RabbitMQ / Erlang not running on all cores?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31252">[ date ]</a>
              <a href="thread.html#31252">[ thread ]</a>
              <a href="subject.html#31252">[ subject ]</a>
              <a href="author.html#31252">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthias,

The load on our box (it's in production) has dropped a little bit, but core
0 is still running nearly flat out.

Here's the output you asked for:

22:39 PROD <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">user at host</A>:rabbitmqctl.py eval 'erlang:statistics(run_queue).'
0
...done.

Which per your comment, doesn't look like a promising lead.

Are there other useful &quot;eval&quot; commands that I could use to ferret out
what's happening? This is a box in production and we have an upcoming
release that's only going to add more load on this box.

Also, we are running this in a cluster with another box, with all queues in
HA mode. I imagine that would have some overall CPU impact, but don't see
why it would concentrate everything on one core. The slave node CPU
utilization is much lower, but also shows most activity on one CPU.

Thanks,

Matt




On Tue, Oct 22, 2013 at 2:55 PM, Matthias Radestock
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt;wrote:

&gt;<i> Matt,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 22/10/13 22:31, Matt Pietrek wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Thanks Zhibo. We actually have hundreds of queues. Two of them are
</I>&gt;&gt;<i> processing several hundred messages/second. The remaining queues are
</I>&gt;&gt;<i> processing 1 or 2 messages second.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Could be an Erlang scheduler thing. Give the latest Erlang release a try,
</I>&gt;<i> since multi-core scheduling is definitely an area that has undergone
</I>&gt;<i> considerable changes in recent releases.
</I>&gt;<i>
</I>&gt;<i> Also, try running
</I>&gt;<i>
</I>&gt;<i>  rabbitmqctl eval 'erlang:statistics(run_queue).**'
</I>&gt;<i>
</I>&gt;<i> if this is &gt;0 then there are runnable processes waiting for execution,
</I>&gt;<i> which would indicate some scheduler anomaly.
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i>
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131022/9520445a/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131022/9520445a/attachment.htm</A>&gt;
</PRE>
























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031250.html">[rabbitmq-discuss] RabbitMQ / Erlang not running on all cores?
</A></li>
	<LI>Next message: <A HREF="031254.html">[rabbitmq-discuss] RabbitMQ / Erlang not running on all cores?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31252">[ date ]</a>
              <a href="thread.html#31252">[ thread ]</a>
              <a href="subject.html#31252">[ subject ]</a>
              <a href="author.html#31252">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
