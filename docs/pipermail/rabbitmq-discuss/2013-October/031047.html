<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] AlreadyClosedException always sets hardError	and initiatedByApplication to true
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20AlreadyClosedException%20always%20sets%20hardError%0A%09and%20initiatedByApplication%20to%20true&In-Reply-To=%3CE81748E6-CA87-4988-88D0-6DEF693A2A7F%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031019.html">
   <LINK REL="Next"  HREF="031186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] AlreadyClosedException always sets hardError	and initiatedByApplication to true</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20AlreadyClosedException%20always%20sets%20hardError%0A%09and%20initiatedByApplication%20to%20true&In-Reply-To=%3CE81748E6-CA87-4988-88D0-6DEF693A2A7F%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] AlreadyClosedException always sets hardError	and initiatedByApplication to true">steve at rabbitmq.com
       </A><BR>
    <I>Wed Oct 16 15:47:36 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031019.html">[rabbitmq-discuss] AlreadyClosedException always sets hardError and initiatedByApplication to true
</A></li>
        <LI>Next message: <A HREF="031186.html">[rabbitmq-discuss] AlreadyClosedException always sets hardError and initiatedByApplication to true
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31047">[ date ]</a>
              <a href="thread.html#31047">[ thread ]</a>
              <a href="subject.html#31047">[ subject ]</a>
              <a href="author.html#31047">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jonathan,

I think it is not a bug but working as designed:

The second invocation on the channel is an invocation on a closed channel, and this is a hard error, because it closes the connection. Furthermore this was initiated by an application call rather than arriving out of the blue from the server.

There is no reason to expect that the 'flags' on the AlreadyClosedException have anything to do with the event which closed the channel/connection.

As to the problem about recovery, it is the first exception (the IOException) which you need to catch; its cause will be the ShutdownSignalException, which tells you what the circumstances of the shutdown are (application?, hard?).

Is this enough to help you recover correctly?

Steve Powell  [Cell: +44-7815-838-558]
Links: Pivotal, SpringSource, VMware, Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, and aesthetic;
   is understandable, unobtrusive, and honest;
   is long-lasting, thorough, and environmentally friendly;
   and is as little design as possible.
(c) Dieter Rams, amended 2003; 2009; 2012

On 15 Oct 2013, at 23:56, Jonathan Halterman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jhalterman at gmail.com</A>&gt; wrote:

&gt;<i> Hey Michael,
</I>&gt;<i> 
</I>&gt;<i> Yea, you can reproduce both items by attempting to declare a consumer on a non-existent queue twice in a row. The first invocation closes the channel and throws an IOException. The second invocation throws an AlreadyClosedException, though the hardError and initiatedByApplication flags don't match those from the initial failure.
</I>&gt;<i> 
</I>&gt;<i> - jonathan
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Tue, Oct 15, 2013 at 3:45 PM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt; wrote:
</I>&gt;<i> On oct 16, 2013, at 1:24 a.m., Jonathan Halterman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jhalterman at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; I noticed that AlreadyClosedException always sets hardError and initiatedByApplication to true, even if the error was not hard (only the channel was closed) and the channel was not closed by the application. This makes it more difficult to properly recover a closed resource if I can't easily determine which resource was closed and why. Could this be fixed?
</I>&gt;<i> 
</I>&gt;<i> Jonathan,
</I>&gt;<i> 
</I>&gt;<i> This indeed sounds like a bug.
</I>&gt;<i> 
</I>&gt;<i> How can we reproduce it? Simply attempt an operation on a closed channel?
</I>&gt;<i> Does it matter how exactly the channel was closed?
</I>&gt;<i> 
</I>&gt;<i> MK
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131016/493d6a90/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131016/493d6a90/attachment.htm</A>&gt;
</PRE>






























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031019.html">[rabbitmq-discuss] AlreadyClosedException always sets hardError and initiatedByApplication to true
</A></li>
	<LI>Next message: <A HREF="031186.html">[rabbitmq-discuss] AlreadyClosedException always sets hardError and initiatedByApplication to true
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31047">[ date ]</a>
              <a href="thread.html#31047">[ thread ]</a>
              <a href="subject.html#31047">[ subject ]</a>
              <a href="author.html#31047">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
