<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Architectuaral Problem - What exchange type to	choose?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Architectuaral%20Problem%20-%20What%20exchange%20type%20to%0A%09choose%3F&In-Reply-To=%3C66F4FA72-DFAA-4A73-B570-CB1590E16B45%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031384.html">
   <LINK REL="Next"  HREF="031394.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Architectuaral Problem - What exchange type to	choose?</H1>
    <B>Jan Wedel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Architectuaral%20Problem%20-%20What%20exchange%20type%20to%0A%09choose%3F&In-Reply-To=%3C66F4FA72-DFAA-4A73-B570-CB1590E16B45%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Architectuaral Problem - What exchange type to	choose?">jan.wedel at googlemail.com
       </A><BR>
    <I>Sun Oct 27 11:30:33 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031384.html">[rabbitmq-discuss] Unable to access management portal after upgarding erlang and RabbitMQ
</A></li>
        <LI>Next message: <A HREF="031394.html">[rabbitmq-discuss] Architectuaral Problem - What exchange type to choose?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31392">[ date ]</a>
              <a href="thread.html#31392">[ thread ]</a>
              <a href="subject.html#31392">[ subject ]</a>
              <a href="author.html#31392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

we are currently using ActiveMQ with message selectors which are in fact discouraged and having weird results (like blocked consumers) and bad performance. Since I&#8217;m about to rewrite parts of the server in Erlang, I&#8217;m also evaluating Rabbit as the new MQ system. I&#8217;ve read the tutorials and parts of the other docs and trying to figure out how I could solve our problems with Rabbit. Since I couldn&#8217;t, I&#8217;m writing to you and you could point me in the right direction.

Just a small summary of what needs to be done, later I explain how I plan to realise it using rabbit:

Domain:
We have Devices, lets say D1, D2, D3, D4 etc.. which are grouped in device groups, lets say Group &#8220;GA&quot; has D1, D2 and D3 (devices are unique and can only belong to one group):

Group &#8220;GA&#8221;
- Device &#8220;D1&quot;
- Device &#8220;D2&quot;
- Device &#8220;D3&quot;
Group &#8220;GB&#8221;
- Device &#8220;D4&#8221;
(&#8230;)

* These devices are embedded devices and are not alway connected to the server. 
* A device may leave a message and/or retrieve pending messages when it is connected. 
* A group owner is also not connected to the server all the time and may connect to retrieve pending messages from a device or leave a message for a device.

Use Cases:
So we have the following use cases in short:
- D-&gt;G: Device &#8220;D1&quot; connects and leaves some messages M1, M2 and disconnects. 
- The owner of group &#8220;GA&#8221; connects, retrieves pending messages from &#8220;D1&#8221; (i.e. M1, M2).
- G-&gt;D: The owner of group &#8220;GA&#8221; leaves a message for device &#8220;D1&#8221;.
- D-&gt;D: Device &#8220;D2&#8221; connects and leaves a message for &#8220;D3&#8221;
- D-&gt;* : Device &#8220;D3&#8221; connects and leaves a message broadcasted to all devices of the group (i.e. D1 and D2)

Possible Implementation with Rabbit:
Each device has an in persistent queue, called &#8220;&lt;groupname&gt;.&lt;devicename&gt;.to&#8221;. 
The group owner has a persistent queue for each device &#8220;&lt;groupname&gt;.&lt;devicename&gt;.from&#8221;.
(Queue name may actually be exchange names)

- When a device connects and wants to leave a message for the group owner, it creates a producer for queue &#8220;G1.D1.from&#8221;  and publishes the message.
- When the group owner GA connects and wants to leave a message for D1, it creates a producer for queue &#8220;G1.D1.to&#8221;  and publishes the message.
- When a device connects and wants to retrieve pending message from the group owner, it creates a consumer for queue &#8220;G1.D1.to&#8221;  and consumes the messages.
- When the group owner GA connects and wants to retrieve pending messages from D1, it creates a consumer for queue &#8220;G1.D1.from&#8221;  and consumes the messages.
- When D1 wants to send a message to D3, it creates a producer for &#8220;G1.D3.to&#8221;
- When D3 wants to broadcast a message, it creates a producer for &#8220;G1.*.to&#8221;

Now, the first parts ok, the problem may arise when direct message sending and broadcasting is involved.
Intuitivly, I would be looking for an exchange to would support dynamic routing, so that I could use the routing keys with wildcards for a message &#8220;G1.*.to&#8221; which would route the message to all &#8220;to&#8221; queues from all devices in group G1. But the bindings and work the other way a round. You must have fixed routing keys for a message and wildcards in bindings.

Is there a way to achieve this with existing rabbit feature and exchange types or do I have to build my own exchange? May with an other architecture, e.g. not using named queues but more sophisticated exchanges etc.

Thanks a lot, especially when you&#8217;ve read the whole mail :)

Jan

</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031384.html">[rabbitmq-discuss] Unable to access management portal after upgarding erlang and RabbitMQ
</A></li>
	<LI>Next message: <A HREF="031394.html">[rabbitmq-discuss] Architectuaral Problem - What exchange type to choose?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31392">[ date ]</a>
              <a href="thread.html#31392">[ thread ]</a>
              <a href="subject.html#31392">[ subject ]</a>
              <a href="author.html#31392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
