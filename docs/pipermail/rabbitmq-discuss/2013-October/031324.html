<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Flow detection in the RabbitMQ Java Client in 3.2.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Flow%20detection%20in%20the%20RabbitMQ%20Java%20Client%0A%20in%203.2.0&In-Reply-To=%3C5268F153.7060501%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031320.html">
   <LINK REL="Next"  HREF="031326.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Flow detection in the RabbitMQ Java Client in 3.2.0</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Flow%20detection%20in%20the%20RabbitMQ%20Java%20Client%0A%20in%203.2.0&In-Reply-To=%3C5268F153.7060501%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Flow detection in the RabbitMQ Java Client in 3.2.0">simon at rabbitmq.com
       </A><BR>
    <I>Thu Oct 24 11:07:15 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031320.html">[rabbitmq-discuss] Flow detection in the RabbitMQ Java Client	in 3.2.0
</A></li>
        <LI>Next message: <A HREF="031326.html">[rabbitmq-discuss] Flow detection in the RabbitMQ Java Client	in 3.2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31324">[ date ]</a>
              <a href="thread.html#31324">[ thread ]</a>
              <a href="subject.html#31324">[ subject ]</a>
              <a href="author.html#31324">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/10/13 10:52, Michael Klishin wrote:
&gt;<i> On 24 Oct 2013, at 08:32, H&#233;ctor Veiga &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">kecok0 at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> 't sending the flag so the FlowListener was not working at all.
</I>&gt;<i>
</I>&gt;<i> Flow control is a deprecated feature.
</I>
Flow control *using the AMQP method channel.flow* is a deprecated 
feature. Or at least we stopped the server from doing that some time ago 
because it has severe limitations. So FlowListener is only useful when 
talking to ancient RabbitMQ versions or other non-RabbitMQ AMQP servers.

Flow control as a concept is alive and well!

&gt;<i> Instead, recent versions of
</I>&gt;<i> RabbitMQ will block publishers by not reading from the socket until
</I>&gt;<i> all alarms (used RAM, # of file available descriptors, disk space
</I>&gt;<i> available) clear.
</I>
Note that we block using TCP backpressure in two different cases:

1) Because some resource (memory / disk / file descriptors) is exhausted

(shows up as &quot;blocked&quot; in red in the management web UI)

2) Because the publisher is publishing faster than some component in the 
server (usually queue(s)) can accept messages.

(shows up as &quot;flow&quot; in yellow in the management web UI)

&gt;<i> Clients are notified about these events as of RabbitMQ 3.2 and only
</I>&gt;<i> if they indicate that they support connection.[un]blocked in
</I>&gt;<i> capabilities.
</I>
...but clients are only notified about 1) above, not 2).

Why is that?

Because we expect that in case 1) above we will typically block the 
client for a while (several seconds at the very least) until more 
resources become available. When disk space is exhausted we will block 
until more disk space appears - which could take an arbitrary amount of 
time.

However, in case 2) above we only expect to actually block the client 
for a matter of milliseconds - the client will flick between blocked and 
unblocked many times a second. All the client should see is that it is 
publishing at a slower rate than otherwise it might manage to. It's not 
obvious how to indicate that to the client - we certainly would not want 
to spam it with connection.blocked and connection.unblocked many times 
per second.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>





















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031320.html">[rabbitmq-discuss] Flow detection in the RabbitMQ Java Client	in 3.2.0
</A></li>
	<LI>Next message: <A HREF="031326.html">[rabbitmq-discuss] Flow detection in the RabbitMQ Java Client	in 3.2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31324">[ date ]</a>
              <a href="thread.html#31324">[ thread ]</a>
              <a href="subject.html#31324">[ subject ]</a>
              <a href="author.html#31324">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
