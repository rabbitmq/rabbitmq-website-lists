<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] if  stop RabbitMq Server Service,	the Server  try  to  create  'queues'  folder ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20if%20%20stop%20RabbitMq%20Server%20Service%2C%0A%09the%20Server%20%20try%20%20to%20%20create%20%20%27queues%27%20%20folder%20%3F&In-Reply-To=%3C60430DD3-D1AC-4A14-B881-17B5B02CE471%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031104.html">
   <LINK REL="Next"  HREF="031145.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] if  stop RabbitMq Server Service,	the Server  try  to  create  'queues'  folder ?</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20if%20%20stop%20RabbitMq%20Server%20Service%2C%0A%09the%20Server%20%20try%20%20to%20%20create%20%20%27queues%27%20%20folder%20%3F&In-Reply-To=%3C60430DD3-D1AC-4A14-B881-17B5B02CE471%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] if  stop RabbitMq Server Service,	the Server  try  to  create  'queues'  folder ?">tim at rabbitmq.com
       </A><BR>
    <I>Thu Oct 17 22:32:34 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031104.html">[rabbitmq-discuss] if  stop RabbitMq Server Service, the Server  try  to  create  'queues'  folder ?
</A></li>
        <LI>Next message: <A HREF="031145.html">[rabbitmq-discuss] if  stop RabbitMq Server Service, the Server  try  to  create  'queues'  folder ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31136">[ date ]</a>
              <a href="thread.html#31136">[ thread ]</a>
              <a href="subject.html#31136">[ subject ]</a>
              <a href="author.html#31136">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17 Oct 2013, at 13:34, Ceri Storey wrote:
&gt;&gt;<i> Is the creation of folders in the internal database causing you a problem? 
</I>&gt;<i> 
</I>&gt;<i> I'd infer that he's maybe referring to the fact that traditionally,
</I>&gt;<i> having lots of entires in a single directory will cause accesses to
</I>&gt;<i> items in that directory to perform very poorly (even to the point of
</I>&gt;<i> causing significant performance problems for the machine overall). If
</I>&gt;<i> you fancy seeing this in practice, try creating ~10,000,000-100,000,000
</I>&gt;<i> entries in a directory on ext4 (ideally on a sacraficial machine).
</I>&gt;<i> 
</I>
I see what you're saying. That wasn't what is causing slowness during shutdown in this case though - I can replicate the slow shutdown with only 5k durable queues, and its looks like it's down to an fsync. We've filed a bug and will be investigating.

&gt;<i> The usual solution (usually found in mail transport agents like Exim/
</I>&gt;<i> Postfix) to this is to use &quot;hashed&quot; directories, where instead of having
</I>&gt;<i> directories named as follows:
</I>&gt;<i> 
</I>&gt;<i> /somewhere/queues/0123456789ABCDEF/
</I>&gt;<i> 
</I>&gt;<i> You have:
</I>&gt;<i> 
</I>&gt;<i> /somewhere/queues/0/01/012/0124/0123456789ABCDEF/
</I>&gt;<i> 
</I>&gt;<i> So that the scan of each directory encounters far fewer items, making
</I>&gt;<i> the performance more logarithmic than linear.
</I>&gt;<i> 
</I>
Yeah, I've come across that before, but as you said, only in the context of having hundreds of thousands (or more) directories. Still, it's worth bearing that in mind too, so I'll add this point to bugzilla where it can hopefully engender further discussion.

Thanks for bringing this up!

Cheers,
Tim
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031104.html">[rabbitmq-discuss] if  stop RabbitMq Server Service, the Server  try  to  create  'queues'  folder ?
</A></li>
	<LI>Next message: <A HREF="031145.html">[rabbitmq-discuss] if  stop RabbitMq Server Service, the Server  try  to  create  'queues'  folder ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31136">[ date ]</a>
              <a href="thread.html#31136">[ thread ]</a>
              <a href="subject.html#31136">[ subject ]</a>
              <a href="author.html#31136">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
