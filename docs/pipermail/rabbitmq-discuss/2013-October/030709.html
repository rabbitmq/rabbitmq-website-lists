<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Question regarding setting up a shovel between	two clusters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20regarding%20setting%20up%20a%20shovel%20between%0A%09two%20clusters&In-Reply-To=%3C7997A3D0E2B05844BE50FD03B7ED709C151A1848%40C111WHRPMBX28.ERF.thomson.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030705.html">
   <LINK REL="Next"  HREF="030710.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Question regarding setting up a shovel between	two clusters</H1>
    <B>ron.jaeger at thomsonreuters.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20regarding%20setting%20up%20a%20shovel%20between%0A%09two%20clusters&In-Reply-To=%3C7997A3D0E2B05844BE50FD03B7ED709C151A1848%40C111WHRPMBX28.ERF.thomson.com%3E"
       TITLE="[rabbitmq-discuss] Question regarding setting up a shovel between	two clusters">ron.jaeger at thomsonreuters.com
       </A><BR>
    <I>Fri Oct  4 17:23:12 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030705.html">[rabbitmq-discuss] Determining Cause of Flow-Control Invocation
</A></li>
        <LI>Next message: <A HREF="030710.html">[rabbitmq-discuss] Question regarding setting up a shovel between two clusters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30709">[ date ]</a>
              <a href="thread.html#30709">[ thread ]</a>
              <a href="subject.html#30709">[ subject ]</a>
              <a href="author.html#30709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am looking for a little help setting up a shovel between two rabbitmq clusters.  We have an application that will need to send messages between two different datacenters.   Each datacenter will have a RabbitMQ cluster.   I have set up a shovel in our lab to verify that this will meet the applications requirements.  It is fairly straightforward to set up the shovel between standalone RabbitMQ nodes.  However,  I have ran into issues implementing  the shovel with RabbitMQ clusters.  The  shovel encounters an  error when trying to failover the shovel from one node to another within the source cluster.   The problem appears to be around the source queue the shovel is using.  The configuration I am testing with is as follows:

[
    {rabbitmq_shovel,
       [{shovels,
         [{test_shovel,
            [{sources, [{brokers,
                          [&quot;<A HREF="amqp://guest:guest@ron-rabbitmq:5672&quot;,">amqp://guest:guest@ron-rabbitmq:5672&quot;,</A>
                           &quot;<A HREF="amqp://guest:guest@ron-rabbitmq1:5672&quot;]">amqp://guest:guest@ron-rabbitmq1:5672&quot;]</A> },
                         {declarations,
                            [{'queue.declare',
                                    [{queue, &lt;&lt;&quot;shovel_out_queue&quot;&gt;&gt;},
                                      durable]},
                            {'exchange.declare',
                                    [{exchange, &lt;&lt;&quot;shovel_exchange&quot;&gt;&gt;},
                                     {type, &lt;&lt;&quot;direct&quot;&gt;&gt;},
                                     durable]},
                            {'queue.bind',
                              [{exchange, &lt;&lt;&quot;shovel_exchange&quot;&gt;&gt;},
                               {queue, &lt;&lt;&quot;shovel_out_queue&quot;&gt;&gt;},
                               {routing_key, &lt;&lt;&quot;shovel_rk&quot;&gt;&gt;}]}
                            ]}]},
            {destinations, [{broker, &quot;<A HREF="amqp://guest:guest@ron-rabbitmq2:5672&quot;},">amqp://guest:guest@ron-rabbitmq2:5672&quot;},</A>
                         {declarations,
                            [{'queue.declare',
                                    [{queue, &lt;&lt;&quot;shovel_in_queue&quot;&gt;&gt;},
                                      durable]},
                            {'exchange.declare',
                                    [{exchange, &lt;&lt;&quot;shovel_exchange&quot;&gt;&gt;},
                                     {type, &lt;&lt;&quot;direct&quot;&gt;&gt;},
                                      durable]},
                            {'queue.bind',
                                    [{exchange, &lt;&lt;&quot;shovel_exchange&quot;&gt;&gt;},
                                     {queue, &lt;&lt;&quot;shovel_in_queue&quot;&gt;&gt;},
                                     {routing_key, &lt;&lt;&quot;shovel_rk&quot;&gt;&gt;}]}
                            ]}]},
            {queue, &lt;&lt;&quot;shovel_out_queue&quot;&gt;&gt;},
            {ack_mode, no_ack},
            {publish_properties, [{delivery_mode, 2}]},
            {publish_fields, [{exchange, &lt;&lt;&quot;shovel_exchange&quot;&gt;&gt;},
                            {routing_key, &lt;&lt;&quot;shovel_rk&quot;&gt;&gt;}]},
            {reconnect_delay, 5}
            ]}
           ]
         }]
      }
].

The error I am enountering is:
** Reason for termination ==
** {{shutdown,
        {server_initiated_close,404,
            &lt;&lt;&quot;NOT_FOUND - home node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">RABBIT1 at ron-rabbitmq</A>' of durable queue 'shovel_out_queue' in vhost '/' is down or inaccessible&quot;&gt;&gt;}},

It seems that it can't access the queue because it doesn't exist on the source  cluster node it failed over to.   I have considered having the source queue be transient, but there is the potential to lose orphaned messages with that approach.  I have also thought about mirroring the queue, but additional overhead may be a concern due to the high volume of traffic.  Any thoughts or suggestions would be appreciated.

Ron Jaeger
Thomson Reuters
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131004/f2c35d79/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131004/f2c35d79/attachment.htm</A>&gt;
</PRE>








































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030705.html">[rabbitmq-discuss] Determining Cause of Flow-Control Invocation
</A></li>
	<LI>Next message: <A HREF="030710.html">[rabbitmq-discuss] Question regarding setting up a shovel between two clusters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30709">[ date ]</a>
              <a href="thread.html#30709">[ thread ]</a>
              <a href="subject.html#30709">[ subject ]</a>
              <a href="author.html#30709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
