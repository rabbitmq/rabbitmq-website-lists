<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq-C amqp_basic_publish crash on	connection loss
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq-C%20amqp_basic_publish%20crash%20on%0A%09connection%20loss&In-Reply-To=%3CDD7729D61B083D48A2CDCB66A27AD4C98C928C%40BSDMSATMBX001.mahindrasatyam.ad%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030877.html">
   <LINK REL="Next"  HREF="030891.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq-C amqp_basic_publish crash on	connection loss</H1>
    <B>Lothe Shashank</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq-C%20amqp_basic_publish%20crash%20on%0A%09connection%20loss&In-Reply-To=%3CDD7729D61B083D48A2CDCB66A27AD4C98C928C%40BSDMSATMBX001.mahindrasatyam.ad%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq-C amqp_basic_publish crash on	connection loss">Shashank.Lothe at techmahindra.com
       </A><BR>
    <I>Wed Oct  9 13:56:59 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030877.html">[rabbitmq-discuss] RabbitMQ node - unable to execute any command getting error
</A></li>
        <LI>Next message: <A HREF="030891.html">[rabbitmq-discuss] Rabbitmq-C amqp_basic_publish crash on connection loss
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30879">[ date ]</a>
              <a href="thread.html#30879">[ thread ]</a>
              <a href="subject.html#30879">[ subject ]</a>
              <a href="author.html#30879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alan,

Thanks for your earlier prompt replies. I am simulating a situation to test amqp_basic_publish. I modified the amqp_sendstring example to publish a message to the broker every 3 seconds. While the messages are getting published, I stop the broker using &quot;rabbitmqctl stop_app&quot;. As the broker is stopped, amqp_basic_publish is crashed.

Code snippet as follows.

while(1)
{
    amqp_basic_properties_t props;
    struct timeval t;
    int ret;

    t.tv_sec = 3;
    t.tv_usec = 0;
    select(0, NULL, NULL, NULL, &amp;t);

    props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG | AMQP_BASIC_DELIVERY_MODE_FLAG;
    props.content_type = amqp_cstring_bytes(&quot;text/plain&quot;);
    props.delivery_mode = 2; /* persistent delivery mode */
    printf(&quot;conn %u\n&quot;,conn);
    ret=amqp_basic_publish(conn,
                            1,
                            amqp_cstring_bytes(exchange),
                            amqp_cstring_bytes(routingkey),
                            1,
                            0,
                            &amp;props,
                            amqp_cstring_bytes(messagebody));
    printf(&quot;ret=%d\n&quot;,ret);
}

Program output:
conn 143663112
ret=0
conn 143663112
ret=0
conn 143663112

First 2 published happened properly. After that I stopped broker. The program terminated. Considering this scenario, I would like to understand
1. if there is a way to check the connection before I publish
2. if the connection value becomes NULL, as we stop the broker.

Thanks and regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131009/5e24cc19/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131009/5e24cc19/attachment.htm</A>&gt;
</PRE>





































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030877.html">[rabbitmq-discuss] RabbitMQ node - unable to execute any command getting error
</A></li>
	<LI>Next message: <A HREF="030891.html">[rabbitmq-discuss] Rabbitmq-C amqp_basic_publish crash on connection loss
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30879">[ date ]</a>
              <a href="thread.html#30879">[ thread ]</a>
              <a href="subject.html#30879">[ subject ]</a>
              <a href="author.html#30879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
