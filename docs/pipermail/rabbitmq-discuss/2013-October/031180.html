<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unexpected%20Behavior%20When%20Using%20the%0A%20%22X-Consistent-Hash%22%20Exchange%20Type&In-Reply-To=%3C526548A4.4090400%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031125.html">
   <LINK REL="Next"  HREF="031181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unexpected%20Behavior%20When%20Using%20the%0A%20%22X-Consistent-Hash%22%20Exchange%20Type&In-Reply-To=%3C526548A4.4090400%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type">simon at rabbitmq.com
       </A><BR>
    <I>Mon Oct 21 16:30:44 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031125.html">[rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type
</A></li>
        <LI>Next message: <A HREF="031181.html">[rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31180">[ date ]</a>
              <a href="thread.html#31180">[ thread ]</a>
              <a href="subject.html#31180">[ subject ]</a>
              <a href="author.html#31180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/10/2013 12:13AM, Richard Raseley wrote:
&gt;<i> This leaves me with the following questions:
</I>&gt;<i>
</I>&gt;<i> 1) Is it true to say that it is now just a matter of choosing what
</I>&gt;<i> tradeoff we want to make in terms of performance vs. uniformity of
</I>&gt;<i> distribution?
</I>
Yes.

&gt;<i> 2) Can anyone comment on Michael's previous comment on how using a
</I>&gt;<i> UUID would be handled as the value in the hashed header? The numbers
</I>&gt;<i> above don't seem to show a large difference between using a random
</I>&gt;<i> integer and a UUID.
</I>
No, they don't. The actual hashing is done by the Erlang function 
phash2, which will hash a UUID or an integer or any Erlang term.

&gt;<i> As a final question, can anyone on the engineering team provide a
</I>&gt;<i> recommendation as to the best way to generate a header value for
</I>&gt;<i> hashing use in terms of what will implicitly provide the most even
</I>&gt;<i> distribution?
</I>
It doesn't matter.

Yeah, this confused me too when I first started looking at the hashing 
exchange. As long as you use something that tends towards unique-ish 
values then any unevenness in the routing displayed by the CHX is caused 
by the distribution of the buckets in its routing table - this is 
influenced by the number of points each binding has (as you have already 
noted) *and nothing else*.

You can observe this easily - create some queues and bindings with 1 
point each. Then publish some messages with random integers as the 
routing keys. Observe the uneven distribution. Then purge all the queues 
(but don't delete and start again) and re-run the test with UUIDs or 
message sequence IDs or whatever. Not only will the distribution still 
be uneven, but it will be uneven in exactly the same way.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>


















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031125.html">[rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type
</A></li>
	<LI>Next message: <A HREF="031181.html">[rabbitmq-discuss] Unexpected Behavior When Using the &quot;X-Consistent-Hash&quot; Exchange Type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31180">[ date ]</a>
              <a href="thread.html#31180">[ thread ]</a>
              <a href="subject.html#31180">[ subject ]</a>
              <a href="author.html#31180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
