<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Lost messages after consumer crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lost%20messages%20after%20consumer%20crash&In-Reply-To=%3C20110214135853.GB2368%40dakota.doc.ic.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011236.html">
   <LINK REL="Next"  HREF="011242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Lost messages after consumer crash</H1>
    <B>Alexandru Scvortov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lost%20messages%20after%20consumer%20crash&In-Reply-To=%3C20110214135853.GB2368%40dakota.doc.ic.ac.uk%3E"
       TITLE="[rabbitmq-discuss] Lost messages after consumer crash">alexandru at rabbitmq.com
       </A><BR>
    <I>Mon Feb 14 13:58:53 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011236.html">[rabbitmq-discuss] Lost messages after consumer crash
</A></li>
        <LI>Next message: <A HREF="011242.html">[rabbitmq-discuss] Lost messages after consumer crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11238">[ date ]</a>
              <a href="thread.html#11238">[ thread ]</a>
              <a href="subject.html#11238">[ subject ]</a>
              <a href="author.html#11238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi again,

The confirm stuff is to get the server to take responsibility for the
messages (so, after you get the confirm for the message, you know it's
either been written to disk or sent to a consumer).

In general, the only way to see if a certain consumer has received a
message is to have that consumer publish an acknowledgement message to
some queue for the producer to see.


&gt;<i> &gt; I've noticed that if I crash (Ctrl+C) the consumer in the middle if
</I>&gt;<i> &gt; the message reception flow and then start it up again, there's a gap
</I>&gt;<i> &gt; in the messages delivered
</I>
Check if the messages aren't being sent at the end (if a consumer
consumes a messages and dies before ack'ing, the messages are requeued
at the end).

&gt;<i> &gt; Changing to ... manual ack didn't seem to help.
</I>
Make sure you're not in autoack mode.  If you are, it's possible that
the java client isn't flushing it's stdout buffer before dying.

Cheers,
Alex

On Mon, Feb 14, 2011 at 03:45:24PM +0200, Alexandru Scvor&#355;ov wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Have a look at this (only applies to 2.3.0):
</I>&gt;<i>   <A HREF="http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/">http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/</A>
</I>&gt;<i> 
</I>&gt;<i> If that doesn't help, could you post the code you're using?
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Alex
</I>&gt;<i> 
</I>&gt;<i> On Mon, Feb 14, 2011 at 09:50:47AM -0200, Fabio Margarido wrote:
</I>&gt;<i> &gt; Hi there.
</I>&gt;<i> &gt; I'm new to RabbitMQ and this list. I've searched the archives but
</I>&gt;<i> &gt; haven't found an answer for my question, sorry if it's been asked
</I>&gt;<i> &gt; before.
</I>&gt;<i> &gt; I've downloaded the server and Java client packages and started
</I>&gt;<i> &gt; playing around. I've slightly modified the example Java code so that
</I>&gt;<i> &gt; the producer sends 100000 messages in a loop. Each message contains a
</I>&gt;<i> &gt; sequential number.
</I>&gt;<i> &gt; I've noticed that if I crash (Ctrl+C) the consumer in the middle if
</I>&gt;<i> &gt; the message reception flow and then start it up again, there's a gap
</I>&gt;<i> &gt; in the messages delivered, i.e., the sequential numbers after the
</I>&gt;<i> &gt; restart don't pick up from where they stopped. I thought this might be
</I>&gt;<i> &gt; related to Java and only the printing of the messages, but some quick
</I>&gt;<i> &gt; analysis of the network traces showed that apparently the non printed
</I>&gt;<i> &gt; messages are missing from the transmission.
</I>&gt;<i> &gt; Changing to transaction mode and manual ack didn't seem to help.
</I>&gt;<i> &gt; Has anyone seen this behavior before? Am I missing something? How can
</I>&gt;<i> &gt; I guarantee that all the messages are delivered?
</I>&gt;<i> &gt; Thanks in advance.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Fabio
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011236.html">[rabbitmq-discuss] Lost messages after consumer crash
</A></li>
	<LI>Next message: <A HREF="011242.html">[rabbitmq-discuss] Lost messages after consumer crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11238">[ date ]</a>
              <a href="thread.html#11238">[ thread ]</a>
              <a href="subject.html#11238">[ subject ]</a>
              <a href="author.html#11238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
