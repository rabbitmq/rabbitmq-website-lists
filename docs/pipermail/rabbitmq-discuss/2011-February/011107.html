<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Strange Management Plugin Error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20Management%20Plugin%20Error&In-Reply-To=%3CA610E03AD50BFC4D95529A36D37FA55E169794BA70%40GEORGE.Emea.Arm.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011106.html">
   <LINK REL="Next"  HREF="011108.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Strange Management Plugin Error</H1>
    <B>Chris Hampson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20Management%20Plugin%20Error&In-Reply-To=%3CA610E03AD50BFC4D95529A36D37FA55E169794BA70%40GEORGE.Emea.Arm.com%3E"
       TITLE="[rabbitmq-discuss] Strange Management Plugin Error">Chris.Hampson at arm.com
       </A><BR>
    <I>Mon Feb  7 11:56:46 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011106.html">[rabbitmq-discuss] [ANN] RabbitMQ Grails Plugin version 0.3 released
</A></li>
        <LI>Next message: <A HREF="011108.html">[rabbitmq-discuss] Strange Management Plugin Error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11107">[ date ]</a>
              <a href="thread.html#11107">[ thread ]</a>
              <a href="subject.html#11107">[ subject ]</a>
              <a href="author.html#11107">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Guys,

I don't think this has been covered in the mailing list so far (apologies if it has, and I'll go squirrel further, hopefully it's a problem unique to use over here).

We're experiencing a strange problem with the Management Plugin. We quite regularly are greeted with a rather intimidating Erlang stack trace when loading pages of the plugin.

The output we're getting posted at the bottom of this message. Normally hitting refresh a few times seems to clear the message and let us at the interface, other than that our cluster seems to be operating ok.

I've posted below the error as it appears on the page, some entries from the logs, and the output of rabbitmqctl status.

This is the only real problem we've experienced so far with RabbitMQ, we've been very impressed, but if anyone's got any suggestions for fixing up this problem we'll be one step closer to perfection ;-)

Many thanks in advance, if you need any further debug/info I'm more than happy to provide it. :-)

Chris H



And now for the gory details:

&gt;<i>From the browser:
</I>
Got response code 500 with body

Internal Server Error
The server encountered an error while processing this request:

{error,{exit,{{undef,[{erlang,max,[0,1297079069756]},
                      {rabbit_mgmt_db,gs_update_add,3},
                      {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                      {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                      {lists,foldl,3},
                      {rabbit_mgmt_db,handle_call,3},
                      {gen_server,handle_msg,5},
                      {proc_lib,init_p_do_apply,3}]},
              {gen_server,call,
                          [{global,rabbit_mgmt_db},
                           {get_overview,all},
                           infinity]}},
             [{gen_server,call,3},
              {rabbit_mgmt_db,safe_call,2},
              {rabbit_mgmt_wm_overview,to_json,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1},
              {webmachine_decision_core,decision,1},
              {webmachine_decision_core,handle_request,2}]}}

&gt;<i>From rabbit\@site1-sasl.log
</I>
=CRASH REPORT==== 7-Feb-2011::11:44:29 ===
  crasher:
    pid: &lt;0.9277.47&gt;
    registered_name: []
    exception exit: {undef,[{erlang,max,[0,1297079069756]},
                            {rabbit_mgmt_db,gs_update_add,3},
                            {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                            {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                            {lists,foldl,3},
                            {rabbit_mgmt_db,handle_call,3},
                            {gen_server,handle_msg,5},
                            {proc_lib,init_p_do_apply,3}]}
      in function  gen_server:terminate/6
    initial call: rabbit_mgmt_db:init/1
    ancestors: [&lt;0.200.0&gt;,rabbit_sup,&lt;0.111.0&gt;]
    messages: []
    links: [&lt;0.200.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 2584
    stack_size: 23
    reductions: 242620
  neighbours:

=SUPERVISOR REPORT==== 7-Feb-2011::11:44:29 ===
     Supervisor: {global,rabbit_mgmt_global_sup}
     Context:    child_terminated
     Reason:     {undef,[{erlang,max,[0,1297079069756]},
                         {rabbit_mgmt_db,gs_update_add,3},
                         {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                         {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                         {lists,foldl,3},
                         {rabbit_mgmt_db,handle_call,3},
                         {gen_server,handle_msg,5},
                         {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,&lt;0.9277.47&gt;},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,5000},
                  {child_type,worker}]

&gt;<i>From rabbit\@site1.log
</I>
=ERROR REPORT==== 7-Feb-2011::11:44:29 ===
** Generic server rabbit_mgmt_db terminating
** Last message in was {get_overview,all}
** When Server state == {state,[{channel_exchange_stats,15294516},
                                {channel_queue_exchange_stats,15298613},
                                {channel_queue_stats,15290419},
                                {channel_stats,15282225},
                                {connection_stats,15278128},
                                {consumers,15286322},
                                {queue_stats,15274029}]}
** Reason for termination ==
** {'function not exported',[{erlang,max,[0,1297079069756]},
                             {rabbit_mgmt_db,gs_update_add,3},
                             {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                             {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                             {lists,foldl,3},
                             {rabbit_mgmt_db,handle_call,3},
                             {gen_server,handle_msg,5},
                             {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 7-Feb-2011::11:44:29 ===
webmachine error: path=&quot;/api/overview&quot;
{error,{exit,{{undef,[{erlang,max,[0,1297079069756]},
                      {rabbit_mgmt_db,gs_update_add,3},
                      {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                      {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                      {lists,foldl,3},
                      {rabbit_mgmt_db,handle_call,3},
                      {gen_server,handle_msg,5},
                      {proc_lib,init_p_do_apply,3}]},
              {gen_server,call,
                          [{global,rabbit_mgmt_db},
                           {get_overview,all},
                           infinity]}},
             [{gen_server,call,3},
              {rabbit_mgmt_db,safe_call,2},
              {rabbit_mgmt_wm_overview,to_json,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1},
              {webmachine_decision_core,decision,1},
              {webmachine_decision_core,handle_request,2}]}}

And finally rabbitmq status so you can see what we're running:

Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site1</A>' ...
[{running_applications,
     [{rabbit_jsonrpc_channel,&quot;RabbitMQ JSON-RPC Channels&quot;,&quot;2.3.1&quot;},
      {rabbit_management,&quot;RabbitMQ Management Console&quot;,&quot;2.3.1&quot;},
      {webmachine,&quot;webmachine&quot;,&quot;1.7.0&quot;},
      {rabbit_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;2.3.1&quot;},
      {rabbit_jsonrpc_channel_test,&quot;rabbit_jsonrpc_channel_test&quot;,&quot;0.01&quot;},
      {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;2.3.1&quot;},
      {rfc4627_jsonrpc,&quot;JSON RPC Service&quot;,&quot;0.01&quot;},
      {rabbit_jsonrpc,&quot;Rabbit JSON-RPC&quot;,&quot;2.3.1&quot;},
      {rabbit_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.3.1&quot;},
      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;1.3&quot;},
      {crypto,&quot;CRYPTO version 1&quot;,&quot;1.5.3&quot;},
      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.0.12&quot;},
      {rabbit_stomp,&quot;Embedded Rabbit Stomp Adapter&quot;,&quot;2.3.1&quot;},
      {rabbit,&quot;RabbitMQ&quot;,&quot;2.3.1&quot;},
      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.7&quot;},
      {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.1.8&quot;},
      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.5.4&quot;},
      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.15.5&quot;},
      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.12.5&quot;}]},
 {nodes,
     [{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site1</A>']},
      {ram,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site4</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site3</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site2</A>']}]},
 {running_nodes,
     ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site3</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site2</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site4</A>',
      '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at site1</A>']}]
...done.

-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.

</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011106.html">[rabbitmq-discuss] [ANN] RabbitMQ Grails Plugin version 0.3 released
</A></li>
	<LI>Next message: <A HREF="011108.html">[rabbitmq-discuss] Strange Management Plugin Error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11107">[ date ]</a>
              <a href="thread.html#11107">[ thread ]</a>
              <a href="subject.html#11107">[ subject ]</a>
              <a href="author.html#11107">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
