<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3C4D6BC078.8030600%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011494.html">
   <LINK REL="Next"  HREF="011497.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3C4D6BC078.8030600%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)">emile at rabbitmq.com
       </A><BR>
    <I>Mon Feb 28 15:34:16 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011494.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT	(Network address translation)
</A></li>
        <LI>Next message: <A HREF="011497.html">[rabbitmq-discuss] There are no messages in the msg_store_persistent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11511">[ date ]</a>
              <a href="thread.html#11511">[ thread ]</a>
              <a href="subject.html#11511">[ subject ]</a>
              <a href="author.html#11511">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

There is no reason why an AMQP connection won't work over NAT. This is 
equally for version 1.7.0 and 2.3.1. It is likely that the cause for 
this error is at the network layer.

Does the broker logfile contain any other relevant messages other than 
the one about the abrupt disconnection?

Can you get &quot;rabbitmqctl list_connections&quot; on the broker to list the 
connection from the client at any time?
Are you able to establish an AMQP channel and issue the basicConsume(), 
or does the error occur earlier during connection establishment?

Do you have any way of checking the state of the connection on the NAT 
device?

Establishing the AMQP connection via the AMQP Tracer ( 
<A HREF="http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html">http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html</A> ) might 
also provide useful diagnostic information.



-Emile




On 27/02/11 13:06, mysurf mail wrote:
&gt;<i> Hi ,
</I>&gt;<i> I am writing a new mail because my last issue was solved .
</I>&gt;<i> It is just that on a certain computer my application stopped working.
</I>&gt;<i> So it is a new issue and I will explain and paste the exception below.
</I>&gt;<i>
</I>&gt;<i> Basically, I did three things :
</I>&gt;<i> 1. I upgraded from 1.7.0 to 2.3.1 (installed a new erlang also)
</I>&gt;<i> 2. I upgraded the client jars
</I>&gt;<i> 3. changed the protocol to ack = true;
</I>&gt;<i>
</I>&gt;<i> channel.basicConsume(queueName, true, queueingConsumer);
</I>&gt;<i>
</I>&gt;<i> well, that certain computer is behind a firewall, and has a NAT (Network
</I>&gt;<i> Address Translation ).
</I>&gt;<i> It did work prior to the upgrade with the NAT (mySQL also handles it
</I>&gt;<i> pretty well).
</I>&gt;<i> with the same ports.
</I>&gt;<i> Maybe it is the bidirectional channel (since I added acking? I dont
</I>&gt;<i> think so...).
</I>&gt;<i>
</I>&gt;<i> what I can see is that.
</I>&gt;<i> when the client tries to connect it writes in the logs
</I>&gt;<i>
</I>&gt;<i> Connection closed abruptly
</I>&gt;<i>
</I>&gt;<i> And now, behold, the exception :
</I>
[...]
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011494.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT	(Network address translation)
</A></li>
	<LI>Next message: <A HREF="011497.html">[rabbitmq-discuss] There are no messages in the msg_store_persistent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11511">[ date ]</a>
              <a href="thread.html#11511">[ thread ]</a>
              <a href="subject.html#11511">[ subject ]</a>
              <a href="author.html#11511">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
