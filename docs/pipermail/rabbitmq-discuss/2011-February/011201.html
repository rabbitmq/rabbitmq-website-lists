<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-auth-mechanism-ssl plugin, TCP,	SASL EXTERNAL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-auth-mechanism-ssl%20plugin%2C%20TCP%2C%0A%09SASL%20EXTERNAL&In-Reply-To=%3C083D5377F8EC294D884D590409EFE70D7113956550%40MAIL02.austin.utexas.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011202.html">
   <LINK REL="Next"  HREF="011207.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-auth-mechanism-ssl plugin, TCP,	SASL EXTERNAL</H1>
    <B>Warren Smith</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-auth-mechanism-ssl%20plugin%2C%20TCP%2C%0A%09SASL%20EXTERNAL&In-Reply-To=%3C083D5377F8EC294D884D590409EFE70D7113956550%40MAIL02.austin.utexas.edu%3E"
       TITLE="[rabbitmq-discuss] rabbitmq-auth-mechanism-ssl plugin, TCP,	SASL EXTERNAL">wsmith at tacc.utexas.edu
       </A><BR>
    <I>Thu Feb 10 23:45:44 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011202.html">[rabbitmq-discuss] Synchronous publish with C client
</A></li>
        <LI>Next message: <A HREF="011207.html">[rabbitmq-discuss] rabbitmq-auth-mechanism-ssl plugin, TCP, SASL EXTERNAL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11201">[ date ]</a>
              <a href="thread.html#11201">[ thread ]</a>
              <a href="subject.html#11201">[ subject ]</a>
              <a href="author.html#11201">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
To make a long story short: Should RabbitMQ be offering SASL EXTERNAL when the client connects using TCP (without SSL)? Or is it doing this because I've made a configuration mistake?


I've been trying out the new rabbitmq-auth-mechanism-ssl plugin in RabbitMQ 2.3.1 (with erlang R14B01). I seem to have it working ok - clients connecting over SSL present a certificate and the CN is used as the RabbitMQ username.

When I use the RabbitMQ 2.3.1 Java client with just TCP and the default user/pass, it doesn't work out of the box. I get an exception:

Exception in thread &quot;main&quot; com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly caused by authentication failure
                at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:289)

The error in the rabbitmq log is:

=ERROR REPORT==== 10-Feb-2011::15:02:27 ===
exception on TCP connection &lt;0.209.0&gt; from xxx.xxx.xxx.xxx:33669
{channel0_error,starting,
                {amqp_error,access_refused,
                            &quot;EXTERNAL login refused: not SSL connection&quot;,
                            'connection.start_ok'}}

The rabbitmq.config has:

  [
    {rabbit, [
      {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
      {ssl_listeners, [{&quot;0.0.0.0&quot;,5671}]},
      {ssl_options, [{cacertfile,&quot;.../cacert.pem&quot;},
                     {certfile,&quot;.../cert.pem&quot;},
                     {keyfile,&quot;.../key.pem&quot;},
                     {verify,verify_peer},
                     {fail_if_no_peer_cert,true}]}
    ]}
  ].

I believe I need the 'EXTERNAL' so that the rabbitmq-auth-mechanism-ssl plugin gets used. However, that plugin won't work with a TCP connection and the Java client tries to use EXTERNAL, causing the error. I worked around this when using the Java client by creating a class that implements SaslConfig that only specifies PLAIN and setSaslConfig() to this on the ConnectionFactory.

It seems like RabbitMQ shouldn't be offering EXTERNAL in this situation when the available EXTERNAL mechanism doesn't work with TCP, but I'm not sure if it is doing this because that is how RabbitMQ works or because I made a mistake in my configuration...

Thanks,


Warren
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110210/1351eecf/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110210/1351eecf/attachment.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011202.html">[rabbitmq-discuss] Synchronous publish with C client
</A></li>
	<LI>Next message: <A HREF="011207.html">[rabbitmq-discuss] rabbitmq-auth-mechanism-ssl plugin, TCP, SASL EXTERNAL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11201">[ date ]</a>
              <a href="thread.html#11201">[ thread ]</a>
              <a href="subject.html#11201">[ subject ]</a>
              <a href="author.html#11201">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
