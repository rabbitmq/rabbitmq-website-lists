<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20have%20multiple%20consumers%20for%20a%20Queue%0A%09in%20Ruby&In-Reply-To=%3CAANLkTi%3DSkN9sGhEyJWoTo-_jigGw%3D2jx_Xz_iQ3Aj6gG%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011422.html">
   <LINK REL="Next"  HREF="011469.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby</H1>
    <B>Jakub &#352;&#357;astn&#253;</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20have%20multiple%20consumers%20for%20a%20Queue%0A%09in%20Ruby&In-Reply-To=%3CAANLkTi%3DSkN9sGhEyJWoTo-_jigGw%3D2jx_Xz_iQ3Aj6gG%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby">stastny at 101ideas.cz
       </A><BR>
    <I>Wed Feb 23 11:47:04 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011422.html">[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby
</A></li>
        <LI>Next message: <A HREF="011469.html">[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11433">[ date ]</a>
              <a href="thread.html#11433">[ thread ]</a>
              <a href="subject.html#11433">[ subject ]</a>
              <a href="author.html#11433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rajat,

about the second example, why more instances should be a problem? Having
more subscribers in the same process doesn't have much sense, in my opinion,
since the reactor pattern doesn't block -&gt; you don't have to wait -&gt; you
don't need to use threads for parallelisation. Threads can be an advantage,
but I don't think it'll be a big difference. Plus Ruby has GIL which means
threads are sort of useless anyway, well, especially if you use Ruby 1.8
which still has green threads. I'd say if you want to go this route, use
Kernel#fork, but then you have to be careful about consistency of state.
Breaking logic down sounds like a much better &amp; cleaner way to go in my
opinion.

Jakub

<A HREF="http://www.flickr.com/photos/jakub-stastny">http://www.flickr.com/photos/jakub-stastny</A>
<A HREF="http://twitter.com/botanicus">http://twitter.com/botanicus</A>



2011/2/23 Rajat Vig &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rajat.vig at gmail.com</A>&gt;

&gt;<i> Thanks for the suggestions. I'd the same thing in mind about being able to
</I>&gt;<i> start multiple of those processes.
</I>&gt;<i>
</I>&gt;<i> There are 2 different kinds of consumers
</I>&gt;<i> 1. Get the message and write it to a database or send it out to someplace
</I>&gt;<i> else.
</I>&gt;<i> Parallelizing this would be easy. Controlling would be more of a problem
</I>&gt;<i> here but manageable.
</I>&gt;<i>
</I>&gt;<i> 2. There's one large consumer which accepts different kinds of messages.
</I>&gt;<i> Like start/stop/abandon a game (which are always singular) and messages for
</I>&gt;<i> the game itself which are many.
</I>&gt;<i> I don't want to run this one many times since it might just run into
</I>&gt;<i> conflicts (though I can't see many currently - it does impose a rigid
</I>&gt;<i> discipline in the code).
</I>&gt;<i> The alternative that I'm thinking here is to internally re-route by
</I>&gt;<i> (generated) random keys and have multiple subscribers in the same
</I>&gt;<i> process. Would that work fine?
</I>&gt;<i> It not, I think breaking it further to a consumer for all admin messages
</I>&gt;<i> and multiple consumers for the game plays would be the way forward but it'll
</I>&gt;<i> be a significant refactor.
</I>&gt;<i>
</I>&gt;<i> -Rajat
</I>&gt;<i>
</I>&gt;<i> 2011/2/22 Jakub &#352;&#357;astn&#253; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">stastny at 101ideas.cz</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Hi Rajat, could you maybe provide some more info? In general I'd agree with
</I>&gt;&gt;<i> Jim, although it depends, there are probably other solutions as well (like
</I>&gt;&gt;<i> more queues -&gt; more granular design of the app with more consumers).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Jakub
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://www.flickr.com/photos/jakub-stastny">http://www.flickr.com/photos/jakub-stastny</A>
</I>&gt;&gt;<i> <A HREF="http://twitter.com/botanicus">http://twitter.com/botanicus</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 22 February 2011 17:43, Rajat Vig &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rajat.vig at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We've written an application using the amqp gem with RabbitMQ.
</I>&gt;&gt;&gt;<i> Currently the bottleneck we've run into is that if there are too many
</I>&gt;&gt;&gt;<i> message incoming then processing the queue takes long.
</I>&gt;&gt;&gt;<i> After reading some messages on the list, I think allowing multiple
</I>&gt;&gt;&gt;<i> consumers is the way forward.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> How do I do that? And are there any pitfalls/gotchas?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> -Rajat
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/972bb3b6/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/972bb3b6/attachment.htm</A>&gt;
</PRE>












































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011422.html">[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby
</A></li>
	<LI>Next message: <A HREF="011469.html">[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11433">[ date ]</a>
              <a href="thread.html#11433">[ thread ]</a>
              <a href="subject.html#11433">[ subject ]</a>
              <a href="author.html#11433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
