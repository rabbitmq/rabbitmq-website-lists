<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-stomp adapter tweaks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-stomp%20adapter%20tweaks&In-Reply-To=%3Ccd6a9c0f35decd2acab7355f8d9cbcc0%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011018.html">
   <LINK REL="Next"  HREF="011009.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-stomp adapter tweaks</H1>
    <B>Rob Harrop</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-stomp%20adapter%20tweaks&In-Reply-To=%3Ccd6a9c0f35decd2acab7355f8d9cbcc0%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq-stomp adapter tweaks">rob at rabbitmq.com
       </A><BR>
    <I>Fri Feb 11 13:16:25 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011018.html">[rabbitmq-discuss] rabbitmq-stomp adapter tweaks
</A></li>
        <LI>Next message: <A HREF="011009.html">[rabbitmq-discuss] librabbitmq strdup patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11214">[ date ]</a>
              <a href="thread.html#11214">[ thread ]</a>
              <a href="subject.html#11214">[ subject ]</a>
              <a href="author.html#11214">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The easiest way to do this is to tweak the reader so that it fires off
the CONNECT frame to the processor once the TCP connection is
established.

This means that changes to the processor internals won't affect your
patch. I got this working with the attached patch.

Hope this helps,

Rob

On Wed, 2 Feb 2011 01:48:04 -0800 (PST), SonicSNES &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dis1 at sonicsnes.net</A>&gt;
wrote:
&gt;<i> I've been moving around a bunch of code in rabbitmq-stomp to tailor it
</I>&gt;<i> specifically for my app, and hit one tiny roadblock which is
</I>&gt;<i> preventing me from finishing.
</I>&gt;<i> 
</I>&gt;<i> How would I go about bypassing the login sequence, so the client gets
</I>&gt;<i> a CONNECTED as soon as it connects? I'm trying to call do_login from
</I>&gt;<i> init, but my with limited erlang skills, all I can get it to do is
</I>&gt;<i> hang, time out, or catch on fire. I'd assume it's just a tiny bit of
</I>&gt;<i> code, but I'm stumped.
</I>&gt;<i> 
</I>&gt;<i> -- SS
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>-------------- next part --------------
diff -r 18a5ff568af9 src/rabbit_stomp_reader.erl
--- a/src/rabbit_stomp_reader.erl	Fri Feb 11 12:19:45 2011 +0000
+++ b/src/rabbit_stomp_reader.erl	Fri Feb 11 13:15:50 2011 +0000
@@ -49,6 +49,13 @@
             PeerAddressS = inet_parse:ntoa(PeerAddress),
             error_logger:info_msg(&quot;starting STOMP connection ~p from ~s:~p~n&quot;,
                                   [self(), PeerAddressS, PeerPort]),
+
+            %% Send CONNECT frame automatically
+            ConnectFrame = #stomp_frame{command = &quot;CONNECT&quot;,
+                                        headers = [{&quot;login&quot;, &quot;guest&quot;},
+                                                   {&quot;passcode&quot;, &quot;guest&quot;}]},
+            rabbit_stomp_processor:process_frame(ProcessorPid, ConnectFrame),
+
             ParseState = rabbit_stomp_frame:initial_state(),
             try
                 ?MODULE:mainloop(#reader_state{socket        = Sock,
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011018.html">[rabbitmq-discuss] rabbitmq-stomp adapter tweaks
</A></li>
	<LI>Next message: <A HREF="011009.html">[rabbitmq-discuss] librabbitmq strdup patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11214">[ date ]</a>
              <a href="thread.html#11214">[ thread ]</a>
              <a href="subject.html#11214">[ subject ]</a>
              <a href="author.html#11214">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
