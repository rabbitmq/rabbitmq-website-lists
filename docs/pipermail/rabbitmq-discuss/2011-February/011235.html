<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] AMQP basic_recover
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20AMQP%20basic_recover&In-Reply-To=%3CAANLkTikyod5ME8ctTmrSgmRLCs2J-0tOK0-cwLk%2BmGRp%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011232.html">
   <LINK REL="Next"  HREF="011261.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] AMQP basic_recover</H1>
    <B>Tomas Bartkus</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20AMQP%20basic_recover&In-Reply-To=%3CAANLkTikyod5ME8ctTmrSgmRLCs2J-0tOK0-cwLk%2BmGRp%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] AMQP basic_recover">to.bartkus at gmail.com
       </A><BR>
    <I>Mon Feb 14 13:22:02 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011232.html">[rabbitmq-discuss] Lost messages after consumer crash
</A></li>
        <LI>Next message: <A HREF="011261.html">[rabbitmq-discuss] AMQP basic_recover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11235">[ date ]</a>
              <a href="thread.html#11235">[ thread ]</a>
              <a href="subject.html#11235">[ subject ]</a>
              <a href="author.html#11235">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I have this is a piece of code to process a message:

public function processMessage($message)
{
    try{
         execute($message);
         $this-&gt;_queue-&gt;remove($message);
                  $this-&gt;_queue-&gt;commit();
    } catch (Exception $e) {
            $this-&gt;_queue-&gt;getChannel()-&gt;basic_reject($message-&gt;getId(),
true);
            //$this-&gt;_queue-&gt;getChannel()-&gt;basic_recover(true);
            $this-&gt;_queue-&gt;rollback();
    }
}

All I want to do is just to redeliver a message after some exception occurs.
But if I use basic_recover(true)I get an error - &quot;PRECONDITION_FAILED -
unknown delivery tag 2&quot;.

Then I have noticed for example when I ask to redeliver a message with
delivery tag [1] (because I have got an exception) I get a second message
with delivery tag [2] and once I try to commit it I get &quot;PRECONDITION_FAILED
- unknown delivery tag 2&quot;. Its like if X message fails and I ask to
redeliver it, next X+1 message that arrives, will fail witn an error
&quot;PRECONDITION_FAILED
- unknown delivery tag X+1&quot; when i will try to commit it.

Then I have tried to use basic_reject($message-&gt;getId(), true); and it
works, all messages are redelivered.

Perhaps I am doing something wrong here regarding basic_recover?

I am using RabbitMQ 2.3.1

Thank you for your answers!

Tomas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110214/2091d2bd/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110214/2091d2bd/attachment.htm</A>&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011232.html">[rabbitmq-discuss] Lost messages after consumer crash
</A></li>
	<LI>Next message: <A HREF="011261.html">[rabbitmq-discuss] AMQP basic_recover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11235">[ date ]</a>
              <a href="thread.html#11235">[ thread ]</a>
              <a href="subject.html#11235">[ subject ]</a>
              <a href="author.html#11235">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
