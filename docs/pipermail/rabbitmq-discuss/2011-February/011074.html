<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked%20connections%20on%20rabbitmq%202.2.0&In-Reply-To=%3C4D4C3024.5040008%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011073.html">
   <LINK REL="Next"  HREF="011057.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked%20connections%20on%20rabbitmq%202.2.0&In-Reply-To=%3C4D4C3024.5040008%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0">matthias at rabbitmq.com
       </A><BR>
    <I>Fri Feb  4 16:58:12 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011073.html">[rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
</A></li>
        <LI>Next message: <A HREF="011057.html">[rabbitmq-discuss] AMQP Java Client on	http://repo2.maven.org/maven2/com/rabbitmq/amqp-client/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11074">[ date ]</a>
              <a href="thread.html#11074">[ thread ]</a>
              <a href="subject.html#11074">[ subject ]</a>
              <a href="author.html#11074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ivan,

Ivan Sanchez wrote:
&gt;<i> Unfortunately when I tried to run 'rabbitmqctl list_queues memory' 
</I>&gt;<i> during the problem it would never bring a result.
</I>
You may be suffering from one (or more) of the bugs we fixed in the
recent 2.3.x releases. I strongly recommend you upgrade.

&gt;<i> But you're right, it's possible queues got big in that node (clients 
</I>&gt;<i> too slow, perhaps). If that's the case, is there a way to prevent the
</I>&gt;<i>  server from running out of memory?
</I>
The server isn't running out of memory as such. It detects it is under
memory pressure and stops accepting new messages. Well before then it
will have started paging messages to disk. That will continue until
enough memory has been freed to resume accepting new messages again.

&gt;<i> In my context I'd rather drop unacknowledged messages than making the
</I>&gt;<i> queue grow forever.
</I>
When consuming messages in noAck mode the server can forget about them 
as soon as it has sent them to the client. That creates the risk of 
losing potentially quite a lot of messages though in the event of a 
client or network failure, depending on how much buffering is taking 
place en route.

An alternative would be to configure per-queue message TTLs - see 
<A HREF="http://www.rabbitmq.com/extensions.html#queue-ttl">http://www.rabbitmq.com/extensions.html#queue-ttl</A>

Both of these assume though that memory is taken up by 
delivered-but-unacknowledged messages, which is by no means certain. So 
I suggest that before trying either approach you a) upgrade to 2.3.1, 
and b) if the problem repeats use 'rabbitmqctl list_queues name 
messages_ready messages_unacknowledged' (it shouldn't block anymore in 
2.3.1) to determine which queues, if any, have many messages ready or 
waiting for acknowledgement.


Regards,

Matthias.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011073.html">[rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
</A></li>
	<LI>Next message: <A HREF="011057.html">[rabbitmq-discuss] AMQP Java Client on	http://repo2.maven.org/maven2/com/rabbitmq/amqp-client/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11074">[ date ]</a>
              <a href="thread.html#11074">[ thread ]</a>
              <a href="subject.html#11074">[ subject ]</a>
              <a href="author.html#11074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
