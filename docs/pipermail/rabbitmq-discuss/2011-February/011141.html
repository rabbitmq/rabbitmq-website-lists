<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] disk space not released after persistent	messages are consumed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20disk%20space%20not%20released%20after%20persistent%0A%09messages%20are%20consumed&In-Reply-To=%3CAANLkTikfrhX3wWMfwzRDLn3GDq%2BErs%2B31tnuokONxT-i%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011138.html">
   <LINK REL="Next"  HREF="011204.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] disk space not released after persistent	messages are consumed</H1>
    <B>Jianing Hu</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20disk%20space%20not%20released%20after%20persistent%0A%09messages%20are%20consumed&In-Reply-To=%3CAANLkTikfrhX3wWMfwzRDLn3GDq%2BErs%2B31tnuokONxT-i%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] disk space not released after persistent	messages are consumed">hujn at polyvore.com
       </A><BR>
    <I>Tue Feb  8 01:27:07 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011138.html">[rabbitmq-discuss] New Open source AMQP implementation,	problems with integrating using different langauges
</A></li>
        <LI>Next message: <A HREF="011204.html">[rabbitmq-discuss] disk space not released after persistent messages are consumed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11141">[ date ]</a>
              <a href="thread.html#11141">[ thread ]</a>
              <a href="subject.html#11141">[ subject ]</a>
              <a href="author.html#11141">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

RabbitMQ newbie here so apologies in advance if what I'm doing is
obviously wrong.

I'm experimenting with RabbigMQ 2.1.1 and it seems my persistent
message storage file keeps growing despite of messages being consumed.
Here's the code I used for testing. I'm using perl with Net::RabbitMQ

    use Net::RabbitMQ;
    my $mq = Net::RabbitMQ-&gt;new();
    $mq-&gt;connect(&quot;localhost&quot;, {
        user =&gt; 'guest',
        password =&gt; 'guest'
    });
    $mq-&gt;channel_open(1);
    $mq-&gt;queue_declare(1, 'test', {
        passive =&gt; 0,
        durable =&gt; 1,
        exclusive =&gt; 0,
        auto_delete =&gt; 0
    });

    my $data = 'foobar' x 200;
    for (1..100000) {
        $mq-&gt;publish(1, 'test', $data, {}, { delivery_mode =&gt; 2});
    }

    $mq-&gt;consume(1, 'test', {
        no_ack =&gt; 0
    });
    for (1..100000) {
        my $msg = $mq-&gt;recv();
        $mq-&gt;ack(1, $msg-&gt;{delivery_tag});
    }

After running this code I end up with a 3MB file in the
msg_store_persistent directory, even though rabbitmqctl list_queues
shows 0 messages in the queue. After restarting RabbitMQ server that
file grew by another 800KB. Any advice is greatly appreciated.

Thanks,
- Jianing
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011138.html">[rabbitmq-discuss] New Open source AMQP implementation,	problems with integrating using different langauges
</A></li>
	<LI>Next message: <A HREF="011204.html">[rabbitmq-discuss] disk space not released after persistent messages are consumed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11141">[ date ]</a>
              <a href="thread.html#11141">[ thread ]</a>
              <a href="subject.html#11141">[ subject ]</a>
              <a href="author.html#11141">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
