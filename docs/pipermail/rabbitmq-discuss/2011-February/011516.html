<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering over a WAN
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20over%20a%20WAN&In-Reply-To=%3CA610E03AD50BFC4D95529A36D37FA55E1697F7B98B%40GEORGE.Emea.Arm.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011514.html">
   <LINK REL="Next"  HREF="011518.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering over a WAN</H1>
    <B>Chris Hampson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20over%20a%20WAN&In-Reply-To=%3CA610E03AD50BFC4D95529A36D37FA55E1697F7B98B%40GEORGE.Emea.Arm.com%3E"
       TITLE="[rabbitmq-discuss] Clustering over a WAN">Chris.Hampson at arm.com
       </A><BR>
    <I>Mon Feb 28 16:17:44 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011514.html">[rabbitmq-discuss] Clustering over a WAN
</A></li>
        <LI>Next message: <A HREF="011518.html">[rabbitmq-discuss] Clustering over a WAN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11516">[ date ]</a>
              <a href="thread.html#11516">[ thread ]</a>
              <a href="subject.html#11516">[ subject ]</a>
              <a href="author.html#11516">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Simon and Matthew for the quick responses.

I was beginning to figure that perhaps what we were trying to do was going to be problematic, which is a shame as it would've been a very neat solution to what we're trying to do.

In essence our use case is as follows:

We have groups of users and resources at each of the sites, each of these sites also have a compute cluster. We wanted a system whereby a user could essentially have a client that could subscribe to events in a site generated by the compute cluster, jobs starting/finishing, status updates, warnings etc. and act accordingly, be it automatically or through some kind of notification and then human interaction.

We also wanted to allow (very selectively) for a user at one site to subscribe for certain messages published to other sites (placing a ban on blanket subscriptions to minimise unnecessary bandwidth being wasted).

We figured this could be implemented with a cluster, all clients connecting to their local broker but publishing to a common exchange. In our tests this worked well, with users also being able to selectively get messages from other sites as well as their own (working out a scheme of users and permissions for this was fun, but we achieved it in the end).

This was essentially it, we then planned other applications on top of this base, it was shaping up nicely until we started experiencing the cluster break ups :-\

I've just looked into the shovel plugin further, and it looks as if it may not be quite dynamic enough for our use (we don't want to be re-tweaking config files every time we set up a new pattern) :-( it's beginning to look like the best way forward for now is separate brokers with custom clients acting as the shovels between sites, consuming on one, then publishing to another as necessary.

Any advice and/or tips are most welcome here, we're quite new to the world of messaging, and may be approaching this backwards (which would be a shame, as we thought we'd found a very nice solution). ;-)

Cheers,

Chris

&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:rabbitmq-
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Matthew Sackman
</I>&gt;<i> Sent: 28 February 2011 15:51
</I>&gt;<i> To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Clustering over a WAN
</I>&gt;<i>
</I>&gt;<i> On Mon, Feb 28, 2011 at 03:27:42PM +0000, Chris Hampson wrote:
</I>&gt;<i> &gt; We're currently attempting to maintain a RabbitMQ cluster over a WAN
</I>&gt;<i> between some of our sites, 2 in the US, one in the UK and another in
</I>&gt;<i> India.
</I>&gt;<i>
</I>&gt;<i> That's a bad idea.
</I>&gt;<i>
</I>&gt;<i> &gt; For the most part this seems to be working fine, but it seems a
</I>&gt;<i> little fragile and we can't seem to get it to recover from failures
</I>&gt;<i> very well.
</I>&gt;<i>
</I>&gt;<i> Correct. Mnesia, which Rabbit uses to store all sorts of data (though
</I>&gt;<i> not messages), copes poorly with network partitions.
</I>&gt;<i>
</I>&gt;<i> &gt; If anyone can provide any advice to aid our situation we'd be most
</I>&gt;<i> &gt; grateful (even if it is &quot;don't do that you loony, separate them out
</I>&gt;<i> &gt; and shovel messages between sites when necessary&quot;)
</I>&gt;<i>
</I>&gt;<i> Yeah, the latter's a fair summary of my advice on this ;) We do state
</I>&gt;<i> quite prominantly that clustering is not for HA, though I admit we
</I>&gt;<i> state
</I>&gt;<i> it on <A HREF="http://www.rabbitmq.com/pacemaker.html">http://www.rabbitmq.com/pacemaker.html</A> rather than
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A> which is not really as helpful
</I>&gt;<i> as it could be.
</I>&gt;<i>
</I>&gt;<i> The problem is that mnesia, and by extension Rabbit, goes for the
</I>&gt;<i> Consistency and Availability part of the CAP triangle, and so just does
</I>&gt;<i> not cope well with partitions ocurring.
</I>&gt;<i> <A HREF="http://en.wikipedia.org/wiki/CAP_theorem">http://en.wikipedia.org/wiki/CAP_theorem</A>
</I>&gt;<i>
</I>&gt;<i> We are working on solving some of these problems in a number of
</I>&gt;<i> different ways. If the shovel is a viable solution then I'd recommend
</I>&gt;<i> you use that, otherwise please let us know some more details of your
</I>&gt;<i> use
</I>&gt;<i> case and we should be able to advise further.
</I>&gt;<i>
</I>&gt;<i> Best wishes,
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011514.html">[rabbitmq-discuss] Clustering over a WAN
</A></li>
	<LI>Next message: <A HREF="011518.html">[rabbitmq-discuss] Clustering over a WAN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11516">[ date ]</a>
              <a href="thread.html#11516">[ thread ]</a>
              <a href="subject.html#11516">[ subject ]</a>
              <a href="author.html#11516">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
