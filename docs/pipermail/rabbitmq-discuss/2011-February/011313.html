<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss]  Losing messages, why?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%20Losing%20messages%2C%20why%3F&In-Reply-To=%3C30958766.post%40talk.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011323.html">
   <LINK REL="Next"  HREF="011335.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss]  Losing messages, why?</H1>
    <B>DOBRO</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%20Losing%20messages%2C%20why%3F&In-Reply-To=%3C30958766.post%40talk.nabble.com%3E"
       TITLE="[rabbitmq-discuss]  Losing messages, why?">vertolet666 at yandex.ru
       </A><BR>
    <I>Fri Feb 18 13:42:24 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011323.html">[rabbitmq-discuss] How can we check that rabbitMQ server is running using java code?
</A></li>
        <LI>Next message: <A HREF="011335.html">[rabbitmq-discuss] Losing messages, why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11313">[ date ]</a>
              <a href="thread.html#11313">[ thread ]</a>
              <a href="subject.html#11313">[ subject ]</a>
              <a href="author.html#11313">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

I've run into the issue of losing messages. I'm trying to figure out why
messages are lost, but can't understand yet.
I'm using RabbitMQ 2.3.1, Erlang R14B01.

Let me tell you how I organized messaging.

Several exchanges are declared:
all.fanout (type =&gt; 'fanout', passive =&gt; false, durable =&gt; false,
auto_delete =&gt; false);
main.direct (type =&gt; 'direct', passive =&gt; false, durable =&gt; false,
auto_delete =&gt; false);
board.direct (type =&gt; 'direct', passive =&gt; false, durable =&gt; false,
auto_delete =&gt; false);
boardchat.direct (type =&gt; 'direct', passive =&gt; false, durable =&gt; false,
auto_delete =&gt; false);

First client (Client1) connects to RabbitMQ and declares queue:
main_queue (passive =&gt; false, durable =&gt; false, exclusive =&gt; true,
auto_delete =&gt; false),
binds this main_queue to exchange main.direct with routing key &quot;mainKey&quot;
and starts to consume messages from main_queue with noAck = true.
This client is running on the server side.


Second client (Client2) (from other city or country) connects to RabbitMQ
and declares 4 queues (4 channels are opened: one channel per queue).
These 4 queues are:
all-queue-1 (passive =&gt; false, durable =&gt; false, exclusive =&gt; true,
auto_delete =&gt; false) is bound to exchange all.fanout,
board-queue-1 (passive =&gt; false, durable =&gt; false, exclusive =&gt; true,
auto_delete =&gt; false) is bound to exchange board.direct with routing key
&quot;1234&quot;,
boardchat-queue-1 (passive =&gt; false, durable =&gt; false, exclusive =&gt; true,
auto_delete =&gt; false) is bound to exchange boardchat.direct with routing key
&quot;1234&quot;,
Client2 starts consuming messages from queues all-queue-1, board-queue-1,
boardchat-queue-1 with noAck = true.

The third client (Client3) (from other city or country) connects to RabbitMQ
and declares 4 queues (4 channels are opened: one channel per queue).
These 4 queues are:
all-queue-2 (passive =&gt; false, durable =&gt; false, exclusive =&gt; true,
auto_delete =&gt; false) is bound to exchange all.fanout,
board-queue-2 (passive =&gt; false, durable =&gt; false, exclusive =&gt; true,
auto_delete =&gt; false) is bound to exchange board.direct with routing key
&quot;1234&quot;,
boardchat-queue-2 (passive =&gt; false, durable =&gt; false, exclusive =&gt; true,
auto_delete =&gt; false) is bound to exchange boardchat.direct with routing key
&quot;1234&quot;,
Client3 starts consuming messages from queues all-queue-2, board-queue-2,
boardchat-queue-2 with noAck = true.


Next, 
- Client2 publishes a message (message1) to exchange main.direct with
routing key &quot;mainKey&quot;,
- Client1 receives this message, processes it and publish another message
(message2) to exchange board.direct with routing key &quot;1234&quot;,
- Client2 and Client3 receive the message (message2) from Client1 and
process it,
- Client2 starts to publish message2 to exchange board.direct with routing
key &quot;1234&quot; every 10 seconds.

Sometimes Client3 stops to receive messages from Client1 and Client2 (from
queue board-queue-2) (even if Client2 publishes messages every 10 seconds).
However, Client3 receives messages from all other queues.

If Client3 
- deletes board-queue-2,
- closes the channel opened for this queue,
- opens another channel,
- declares queue board-queue-3 (passive =&gt; false, durable =&gt; false,
exclusive =&gt; true, auto_delete =&gt; false)
- binds the queue board-queue-3 to exchange board.direct with routing key
&quot;1234&quot;,
- starts consuming messages from queue board-queue-3 with noAck = true

the situation comes to normal again.

Now I'm coming to a question.
Why Client3 loses messages? Where should I find a reason?

Thanks a lot!
 
-- 
View this message in context: <A HREF="http://old.nabble.com/Losing-messages%2C-why--tp30958766p30958766.html">http://old.nabble.com/Losing-messages%2C-why--tp30958766p30958766.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011323.html">[rabbitmq-discuss] How can we check that rabbitMQ server is running using java code?
</A></li>
	<LI>Next message: <A HREF="011335.html">[rabbitmq-discuss] Losing messages, why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11313">[ date ]</a>
              <a href="thread.html#11313">[ thread ]</a>
              <a href="subject.html#11313">[ subject ]</a>
              <a href="author.html#11313">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
