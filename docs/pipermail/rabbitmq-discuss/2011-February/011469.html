<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20have%20multiple%20consumers%20for%20a%20Queue%0A%09in%20Ruby&In-Reply-To=%3CAANLkTinGE5dXDY8%3DsOuLkM3t-dEe-8tfPia7fhPwiLQf%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011433.html">
   <LINK REL="Next"  HREF="011415.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby</H1>
    <B>Rajat Vig</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20have%20multiple%20consumers%20for%20a%20Queue%0A%09in%20Ruby&In-Reply-To=%3CAANLkTinGE5dXDY8%3DsOuLkM3t-dEe-8tfPia7fhPwiLQf%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby">rajat.vig at gmail.com
       </A><BR>
    <I>Fri Feb 25 04:55:03 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011433.html">[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby
</A></li>
        <LI>Next message: <A HREF="011415.html">[rabbitmq-discuss] Help with my priority queue design
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11469">[ date ]</a>
              <a href="thread.html#11469">[ thread ]</a>
              <a href="subject.html#11469">[ subject ]</a>
              <a href="author.html#11469">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the ideas. I'll probably for now go with breaking down the logic
to consumers which need to be run once and consumers which could be many.
Threading inside the same consumer would be too troublesome and might not
get the same results.

We are using Ruby 1.9 but the GIL still exists.

-Rajat

2011/2/23 Jakub &#352;&#357;astn&#253; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">stastny at 101ideas.cz</A>&gt;

&gt;<i> Rajat,
</I>&gt;<i>
</I>&gt;<i> about the second example, why more instances should be a problem? Having
</I>&gt;<i> more subscribers in the same process doesn't have much sense, in my opinion,
</I>&gt;<i> since the reactor pattern doesn't block -&gt; you don't have to wait -&gt; you
</I>&gt;<i> don't need to use threads for parallelisation. Threads can be an advantage,
</I>&gt;<i> but I don't think it'll be a big difference. Plus Ruby has GIL which means
</I>&gt;<i> threads are sort of useless anyway, well, especially if you use Ruby 1.8
</I>&gt;<i> which still has green threads. I'd say if you want to go this route, use
</I>&gt;<i> Kernel#fork, but then you have to be careful about consistency of state.
</I>&gt;<i> Breaking logic down sounds like a much better &amp; cleaner way to go in my
</I>&gt;<i> opinion.
</I>&gt;<i>
</I>&gt;<i> Jakub
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.flickr.com/photos/jakub-stastny">http://www.flickr.com/photos/jakub-stastny</A>
</I>&gt;<i> <A HREF="http://twitter.com/botanicus">http://twitter.com/botanicus</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 2011/2/23 Rajat Vig &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rajat.vig at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Thanks for the suggestions. I'd the same thing in mind about being able to
</I>&gt;&gt;<i> start multiple of those processes.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There are 2 different kinds of consumers
</I>&gt;&gt;<i> 1. Get the message and write it to a database or send it out to someplace
</I>&gt;&gt;<i> else.
</I>&gt;&gt;<i> Parallelizing this would be easy. Controlling would be more of a problem
</I>&gt;&gt;<i> here but manageable.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2. There's one large consumer which accepts different kinds of messages.
</I>&gt;&gt;<i> Like start/stop/abandon a game (which are always singular) and messages
</I>&gt;&gt;<i> for the game itself which are many.
</I>&gt;&gt;<i> I don't want to run this one many times since it might just run into
</I>&gt;&gt;<i> conflicts (though I can't see many currently - it does impose a rigid
</I>&gt;&gt;<i> discipline in the code).
</I>&gt;&gt;<i> The alternative that I'm thinking here is to internally re-route by
</I>&gt;&gt;<i> (generated) random keys and have multiple subscribers in the same
</I>&gt;&gt;<i> process. Would that work fine?
</I>&gt;&gt;<i> It not, I think breaking it further to a consumer for all admin messages
</I>&gt;&gt;<i> and multiple consumers for the game plays would be the way forward but it'll
</I>&gt;&gt;<i> be a significant refactor.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Rajat
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2011/2/22 Jakub &#352;&#357;astn&#253; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">stastny at 101ideas.cz</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi Rajat, could you maybe provide some more info? In general I'd agree
</I>&gt;&gt;&gt;<i> with Jim, although it depends, there are probably other solutions as well
</I>&gt;&gt;&gt;<i> (like more queues -&gt; more granular design of the app with more consumers).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Jakub
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> <A HREF="http://www.flickr.com/photos/jakub-stastny">http://www.flickr.com/photos/jakub-stastny</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://twitter.com/botanicus">http://twitter.com/botanicus</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 22 February 2011 17:43, Rajat Vig &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rajat.vig at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Hi
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> We've written an application using the amqp gem with RabbitMQ.
</I>&gt;&gt;&gt;&gt;<i> Currently the bottleneck we've run into is that if there are too many
</I>&gt;&gt;&gt;&gt;<i> message incoming then processing the queue takes long.
</I>&gt;&gt;&gt;&gt;<i> After reading some messages on the list, I think allowing multiple
</I>&gt;&gt;&gt;&gt;<i> consumers is the way forward.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> How do I do that? And are there any pitfalls/gotchas?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> -Rajat
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110225/d7f0b9ea/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110225/d7f0b9ea/attachment.htm</A>&gt;
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011433.html">[rabbitmq-discuss] How to have multiple consumers for a Queue	in Ruby
</A></li>
	<LI>Next message: <A HREF="011415.html">[rabbitmq-discuss] Help with my priority queue design
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11469">[ date ]</a>
              <a href="thread.html#11469">[ thread ]</a>
              <a href="subject.html#11469">[ subject ]</a>
              <a href="author.html#11469">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
