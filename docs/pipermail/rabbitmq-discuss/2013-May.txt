From rev.chip at gmail.com  Wed May  1 05:16:30 2013
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Tue, 30 Apr 2013 21:16:30 -0700
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
Message-ID: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>

I've successfully used the optional server feature of sending a
basic.cancel when a consumed queue is deleted.  Great.  But a reasonable
thing to do at that point is to close the channel, right?  But when I send
a channel.close in that circumstance, RMQ 3.0.4 does not send a close-ok.
 It doesn't send anything.  This makes my app hang.  I have to cheat and
ass_u_me that the channel is closed in order to keep working.

Am I doing something wrong?  Is this a server bug?  Both?  :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130430/fc4e7ba1/attachment.htm>

From 0x6e6562 at gmail.com  Wed May  1 10:06:12 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 1 May 2013 10:06:12 +0100
Subject: [rabbitmq-discuss] Hanging connections in management interface
 (v3.0.4)
In-Reply-To: <51801CFF.5070108@reik.se>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
	<517F9271.4090906@rabbitmq.com>
	<CAO98qLZ7v1T6N=q27gonQ7ObHZMcz90nEej_6O4vLt5jWXXYLA@mail.gmail.com>
	<517FCF6C.5090105@rabbitmq.com> <51801CFF.5070108@reik.se>
Message-ID: <58EFBCA3C2A24082AFBCBFD71970723E@gmail.com>

Could this not be due to a TCP half close? 


On Tuesday, 30 April 2013 at 20:35, Maze wrote:

> I think we had a similar problem. Clients that died were still in the 
> list of connections. In our case this was slowing RabbitMQ (v2.6.x ? not 
> sure) down to a degree that we had to restart RabbitMQ.
> We solved the problem by implementing the heartbeat and we haven't seen 
> any such issues since then.
> 
> Cheers
> Maze
> 
> 
> 
> On 2013-04-30 16:04, Simon MacMullen wrote:
> > OK.
> > 
> > So you say "queues show hanging connections". Do you mean that the 
> > management plugin shows connections under the "Connections" tab, or 
> > consumers under queue details, or something else?
> > 
> > Do you see the same items in rabbitmqctl list_connections (or 
> > list_queues or similar)? If so can you send the output of "rabbitmqctl 
> > report"?
> > 
> > Also, do these items ever go away? Has the memory alarm / disk alarm 
> > gone off at any point?
> > 
> > Cheers, Simon
> > 
> > On 30/04/13 14:17, Allan Beaufour wrote:
> > > No, this is a single rabbitmq node.
> > > 
> > > 
> > > On Tue, Apr 30, 2013 at 5:44 AM, Simon MacMullen <simon at rabbitmq.com (mailto:simon at rabbitmq.com)
> > > <mailto:simon at rabbitmq.com>> wrote:
> > > 
> > > There is a known issue with connections / channels on a cluster node
> > > not being cleared out of mgmt if they were running when the node
> > > shuts down. That's not fixed in 3.0.4 but is fixed in nightlies /
> > > will be in 3.1.0. Does that sound like what you're seeing?
> > > 
> > > Cheers, Simon
> > > 
> > > On 29/04/13 16:23, Allan Beaufour wrote:
> > > 
> > > I've for a long time had an issue where queues show hanging
> > > connections
> > > in the management interface. The queues show a number of 
> > > perpetual
> > > unacked messages and even if I shut down all consumers, these
> > > remain.
> > > The ip+port for the consumers doesn't match any processes 
> > > either. Is
> > > this a known bug?
> > > 
> > > I've had this issues for a while. We were running v2.7.1
> > > perviously and
> > > was secretly hoping they would disappear in the upgrade :)
> > > 
> > > Thanks,
> > > 
> > > Allan
> > > 
> > > 
> > > _________________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.__rabbitmq.com (mailto:rabbitmq-discuss at lists.__rabbitmq.com)
> > > <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> > > https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
> > > <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
> > > 
> > > 
> > > 
> > > --
> > > Simon MacMullen
> > > RabbitMQ, VMware
> > > 
> > 
> > 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/7522d892/attachment.htm>

From steve at rabbitmq.com  Wed May  1 10:07:32 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 1 May 2013 10:07:32 +0100
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
	it doesn't acknowledge a channel close
In-Reply-To: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
Message-ID: <2318FD7E-EEDC-44F4-8842-464B51038B7B@rabbitmq.com>

Hi Chip,
If you are using the Java client, then it is possible that you are issuing the channel.close() from within the Consumer (in the code for the handleCancel() method).

In this case, the Consumer callback is being executed on a worker thread, and although you can issue channel commands from here, close() is a bit special, because it may involve waiting for callbacks to finish. This would explain why you hang in the client. (The server is probably sending the close-ok, but you aren't seeing it -- the client has hung already.)

We should document this properly in the Java client specs, but in the meantime, you should issue the close in the main app, rather than in the Consumer.

Does this explain your observed behaviour?

BTW: This is all speculation, and if I am off the mark, I apologise.  In reporting problems a little more context is helpful: which client you are using, more about how you are using it, and some diagnostic information [in this case, the stack frames during the hang, and/or a trace of the frames to/from Rabbit would have been perfect] can speed a satisfactory response.

Steve Powell  [Cell: +44-7815-838-558]
Links: Pivotal, SpringSource, VMware, Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, aesthetic;
   is understandable, unobtrusive, honest;
   is long-lasting, thorough, environmentally friendly;
   and is as little design as possible.
Copyright Dieter Rams, amended March 2003; October 2009; and August 2012

On 1 May 2013, at 05:16, Chip Salzenberg <rev.chip at gmail.com> wrote:

> I've successfully used the optional server feature of sending a basic.cancel when a consumed queue is deleted.  Great.  But a reasonable thing to do at that point is to close the channel, right?  But when I send a channel.close in that circumstance, RMQ 3.0.4 does not send a close-ok.  It doesn't send anything.  This makes my app hang.  I have to cheat and ass_u_me that the channel is closed in order to keep working.
> 
> Am I doing something wrong?  Is this a server bug?  Both?  :)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/0e045b39/attachment.htm>

From 0x6e6562 at gmail.com  Wed May  1 10:15:22 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 1 May 2013 10:15:22 +0100
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <A845D27F-9A45-48AF-A556-72EBC45D253D@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<A845D27F-9A45-48AF-A556-72EBC45D253D@rabbitmq.com>
Message-ID: <13FFBE49EF3A41698BB90CD8C223428A@gmail.com>

Hey Tim, 

I think the main thing is that if you can easily build the ez without having to set up another source tree and build process - the umbrella serves this purpose. I think if enough people actually start using it, you could then consider whether it is worth mainlining.

Cheers,

Ben 


On Monday, 29 April 2013 at 11:23, Tim Watson wrote:

> Folks - we have heard back from three of four people about this feature. Currently, that's not really what I'd call a 'critical mass' and certainly not enough for me to argue that we ought to provide lager support as part of the core broker ootb - Simon or Matthias may have a different opinion, but I wonder whether just providing this via a plugin is 'good enough' if it was included in the umbrella?
> 
> Thoughts on a postcard please - the more votes the more likely something will happen (one way or another).
> 
> Cheers,
> Tim
> 
> On 26 Mar 2013, at 19:53, Tim Watson wrote:
> 
> > I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
> > 
> > Cheers,
> > Tim
> > 
> > On 23 Mar 2013, at 23:06, Ben Hood wrote:
> > 
> > > Hey Tim,
> > > On Friday, 22 March 2013 at 07:55, Tim Watson wrote:
> > > 
> > > > Yeah with the current implementation you'd need to install your own log handler to make that work. In terms of changing the output format though, allowe to play devil's advocate for a moment...
> > > > 
> > > > The info/progress/error reports have a lot of data in them, process stats, stack traces, etc. are you wanting to see all that plonked on one single long line? Because I can see how that'd make parsing/aggregating easier, but not reading them. Does the lager output fit exactly with what you want (I've not looks at it or a couple of years)?
> > > I don't think that everything needs to fit on one line. Longer traces which provide good context should probably remain as multiline entries. However, info items, for example,
> > > 
> > > Mar 22 22:33:01 a rabbit3: =INFO REPORT==== 22-Mar-2013::22:33:01 === 
> > > Mar 22 22:33:01 a rabbit3: Setting permissions for 'guest' in '/' to '.*', '.*', '.*' 
> > > 
> > > need not get split up over two lines.
> > > 
> > > With regard to longer traces, it would be nice if they could be handled in such a way that the generic portion of the call stack were trimmed down to something nearer the actual call site, rather that the entire generic call trace. As inspiration, logback mitigates the default "root cause comes last" behavior in Java with the reverse depth layout modifier (rEx{depth}). Lot's of hand waving here though.
> > > 
> > > Finally, I do have to concur with Gavin on people's perception about Rabbit due to logging - I've have many conversations with people over the years who ask why Rabbit has such bizare logging - I've generally answered that this is an Erlang-ism, and though it is strange, the server kind of serves its primary function well (i.e. delivering messages), so just put up with it.
> > > 
> > > Cheers,
> > > 
> > > Ben
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > 
> > 
> > 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/2419e81e/attachment.htm>

From anjelinio at taxibeat.com  Wed May  1 10:11:33 2013
From: anjelinio at taxibeat.com (Angelos Karantzalis)
Date: Wed, 1 May 2013 02:11:33 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP AmqpLib,
	rabbit hangs after a few hundred messages ?
Message-ID: <18745ab5-775e-49b0-9006-d96b4fd52e8e@googlegroups.com>

Hi guys, I'm having a serious problem with rabbit and the PHP AMQPLib 
client. 

Our system is in essence a state workflow -> events are triggered when we 
change state in any of our open sessions. We wanted to push processing of 
those events away from our fron-facing web server, so decided on trying our 
rabbit to create a pub-sub architecture for async processing of those 
events. 

Now, those events are not a .. flood of events. We are getting around 10 - 
50 per minute, and they are really small in size. We're using a fanout 
exchange to push them to rabbit, and multi-process them using workers 
running in another machine. 

Yesterday was our first production test. We left it running for the whole 
day, until at around 21:00, after more or less 12 hours running ok, rabbit 
just stopped accepting messages. It was not dead, just not functional. 

As I said, we're using the PhpAmqpLib client. We've written a couple of 
helper classes, to create a Producer, a PubSubProducer ( the former uses a 
topic exchange, the latter a fanout one ) and the corresponding Consumers. 
Can anyone see something wrong in this ?

The source of the pub-sub producer is more or less this:

*public function __construct($exchange_name, $queue_name, $routing_key) *

{

    $this->_exchange = $exchange_name;

    $this->_queue    = $queue_name;

    $this->_routing_key = $routing_key;

}

*public function initialize()*

{

    $config = QueueConfig::instance();

     $this->_connection = new AMQPConnection($config->host, $config->port, 
$config->user, $config->pwd, $config->vhost);

    $this->_channel = $this->_connection->channel();

     if(null!=$this->_exchange)

    {

        //echo "Registering Exchange: " . $this->_exchange;

        $this->_channel->exchange_declare($this->_exchange, 'fanout');

    }

}

*public function publish($message, $routing_key = null, $correlation_id = 
null)*

{

    $r_key = (null != $routing_key)? $routing_key : $this->_routing_key;

     $properties = array('content_type' => 'text/plain', 'delivery_mode' => 
2);

    if(null != $correlation_id)

        $properties['correlation_id'] = $correlation_id;

     $msg = new AMQPMessage($message, $properties);

    $this->_channel->basic_publish($msg, $this->_exchange, $r_key);

}
Thanks so much for any help guys, very very very much appreciated ! 

Angel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/3536b008/attachment.htm>

From tim at rabbitmq.com  Wed May  1 10:36:41 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 1 May 2013 10:36:41 +0100
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <13FFBE49EF3A41698BB90CD8C223428A@gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<A845D27F-9A45-48AF-A556-72EBC45D253D@rabbitmq.com>
	<13FFBE49EF3A41698BB90CD8C223428A@gmail.com>
Message-ID: <B3AC982B-7D68-46B2-8A83-F662E2FBD37F@rabbitmq.com>

Hi Ben,

Yeah that's true enough. Part of the difficulty, of course, is figuring out whether people are using it or not. I guess for now if we leave it outside the umbrella, at least we'll get some feedback from those who're interested in using it when they ask for it to be included. :)

Cheers,
Tim

On 1 May 2013, at 10:15, Ben Hood wrote:

> Hey Tim,
> 
> I think the main thing is that if you can easily build the ez without having to set up another source tree and build process - the umbrella serves this purpose. I think if enough people actually start using it, you could then consider whether it is worth mainlining.
> 
> Cheers,
> 
> Ben
> On Monday, 29 April 2013 at 11:23, Tim Watson wrote:
> 
>> Folks - we have heard back from three of four people about this feature. Currently, that's not really what I'd call a 'critical mass' and certainly not enough for me to argue that we ought to provide lager support as part of the core broker ootb - Simon or Matthias may have a different opinion, but I wonder whether just providing this via a plugin is 'good enough' if it was included in the umbrella?
>> 
>> Thoughts on a postcard please - the more votes the more likely something will happen (one way or another).
>> 
>> Cheers,
>> Tim
>> 
>> On 26 Mar 2013, at 19:53, Tim Watson wrote:
>> 
>>> I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
>>> 
>>> Cheers,
>>> Tim
>>> 
>>> On 23 Mar 2013, at 23:06, Ben Hood wrote:
>>> 
>>>> Hey Tim,
>>>> On Friday, 22 March 2013 at 07:55, Tim Watson wrote:
>>>> 
>>>>> Yeah with the current implementation you'd need to install your own log handler to make that work. In terms of changing the output format though, allowe to play devil's advocate for a moment...
>>>>> 
>>>>> The info/progress/error reports have a lot of data in them, process stats, stack traces, etc. are you wanting to see all that plonked on one single long line? Because I can see how that'd make parsing/aggregating easier, but not reading them. Does the lager output fit exactly with what you want (I've not looks at it or a couple of years)?
>>>> I don't think that everything needs to fit on one line. Longer traces which provide good context should probably remain as multiline entries. However, info items, for example,
>>>> 
>>>> Mar 22 22:33:01 a rabbit3: =INFO REPORT==== 22-Mar-2013::22:33:01 ===
>>>> Mar 22 22:33:01 a rabbit3: Setting permissions for 'guest' in '/' to '.*', '.*', '.*'
>>>> 
>>>> need not get split up over two lines.
>>>> 
>>>> With regard to longer traces, it would be nice if they could be handled in such a way that the generic portion of the call stack were trimmed down to something nearer the actual call site, rather that the entire generic call trace. As inspiration, logback mitigates the default "root cause comes last" behavior in Java with the reverse depth layout modifier (rEx{depth}). Lot's of hand waving here though.
>>>> 
>>>> Finally, I do have to concur with Gavin on people's perception about Rabbit due to logging - I've have many conversations with people over the years who ask why Rabbit has such bizare logging - I've generally answered that this is an Erlang-ism, and though it is strange, the server kind of serves its primary function well (i.e. delivering messages), so just put up with it.
>>>> 
>>>> Cheers,
>>>> 
>>>> Ben
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/9b88bf9d/attachment.htm>

From michael.s.klishin at gmail.com  Wed May  1 10:39:45 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 1 May 2013 13:39:45 +0400
Subject: [rabbitmq-discuss] PHP AmqpLib,
 rabbit hangs after a few hundred messages ?
In-Reply-To: <18745ab5-775e-49b0-9006-d96b4fd52e8e@googlegroups.com>
References: <18745ab5-775e-49b0-9006-d96b4fd52e8e@googlegroups.com>
Message-ID: <CAE3HoVTiagB7UXbqV-c=Xy9Ghq+3hx6eNQms9FeawwcCuWSLUA@mail.gmail.com>

2013/5/1 Angelos Karantzalis <anjelinio at taxibeat.com>

> rabbit just stopped accepting messages. It was not dead, just not
> functional


Take a look at the log. Are there any messages about alarms?

If RabbitMQ RAM or disk usage goes above the limits, it will block
publishers.
You can tune these limits.

See http://www.rabbitmq.com/memory.html

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/b165e25b/attachment.htm>

From simon at rabbitmq.com  Wed May  1 10:58:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 01 May 2013 10:58:14 +0100
Subject: [rabbitmq-discuss] Repairing a crashed cluster - Obtaining
 persisted msgs from master
In-Reply-To: <1367341821112-26310.post@n5.nabble.com>
References: <1367341821112-26310.post@n5.nabble.com>
Message-ID: <5180E736.9050408@rabbitmq.com>

On 30/04/13 18:10, ranjitiyer wrote:
> Hello,
>
> Part of my question was answered here
> http://rabbitmq.1065348.n5.nabble.com/Repairing-a-a-crashed-cluster-td22466.html.
> I have a follow up question for the following scenario.
>
> Say, I have a master/slave cluster with mirrored persisted queues. Slave
> dies, messages m1, m2 are published to the master. Master dies. Slave comes
> up - it can't because master is dead. I realized am going to have to follow
> the instructions on the previous post to get erl.exe and eventually the
> rabbit running on the slave machine.

Note that since that message, RabbitMQ 3.0 was released, with 
"rabbitmqctl forget_cluster_node" - which might help you get the slave 
started if the master is gone.

> Good so far. I now also want the messages of the master to be brought over
> to the slave because I don't wanna lose m1 and m2 sitting on the master
> machine. I know that queue messages are persisted in the mnesia database
> located under c:\user\appdata\...\db\. Is there a way to export data from
> this db and import it into the db on the slave machine?

So the Mnesia database itself can't be moved - but the subdirectories 
"queues" "msg_store_transient" and "msg_store_persistent" probably can. 
You could try that - I would take backups of everything first though.

But what are you trying to do? If the master is still available and more 
up to date than the slave then why are you removing it?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Wed May  1 11:00:10 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 1 May 2013 11:00:10 +0100
Subject: [rabbitmq-discuss] Question about starting a node
In-Reply-To: <20130430223907.2454.qmail@hoster904.com>
References: <20130430223907.2454.qmail@hoster904.com>
Message-ID: <56AF2BF8-6455-42AF-A108-3EA755AA5665@rabbitmq.com>

Hi,

On 30 Apr 2013, at 23:39, srd wrote:

> I'm new to rabbitMQ.
> Having trouble getting connection to my RabbitMQ node:
> I start fresh (ps shows nothing running)
> I had no .erlang.cookie prior to starting because I deleted it.
> 

Erm, you need a cookie in order to do just about anything.

> I start the server (as rabbitmq user)
> -bash-4.1$ rabbitmqctl status
> Status of node rabbit at node1 ...
> Error: unable to connect to node rabbit at node1: nodedown
> 

If you've got no cookie, then rabbitmqctl won't be able to connect to your broker...

> DIAGNOSTICS
> 
> I've tried looking at the docs and this one puzzles me.
> 1) I could see why rabbit at node1 isn't able to connect because I just started it.  Is that what the error pertains to?

Yes. It's not rabbit at node1 connecting to itself. It's `rabbitmqctl2469 at node1` trying to connect to rabbit at node1. 

> 2) Why does it think my nodename is rabbitmqctl2469 at node1?
>   Why isn't it rabbit at node1 ?

That's the node name of the rabbitmqctl process, not the broker process. They need to be able to 'talk to one another', which requires them to share the same erlang cookie.

> On top of all the problems trying to connect with rabbit at node1, it appears the node name is now different
> 
> before it was: 
> node name: rabbitmqctl24649 at node1
> now its
> node name: rabbitmqctl24868 at node1
> 
> Would someone explain what is going on?   

That's completely normal. As I mentioned previously, the rabbitmqctl node is different to the broker node. Each time you launch rabbitmqctl, it'll choose a different node name, so that if you're trying to run multiple rabbitmqctl commands simultaneously, the node names don't clash.

HTH!

Cheers,
Tim



From cjbhaines at gmail.com  Wed May  1 11:31:11 2013
From: cjbhaines at gmail.com (Chris Haines)
Date: Wed, 1 May 2013 03:31:11 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client ConnectionFactory threading
	issues
In-Reply-To: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
References: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
Message-ID: <048dc2cd-6cd7-48fa-b9f3-34ad8e946a2b@googlegroups.com>



Hi All,

This had nothing to do with the actual ConnectionFactory. This was because 
our application was thread starved.

The .NET ThreadPool by default has a small number of threads available. The 
minimum number of available threads was set to 8. This means that once 8 
threads have been requested (and still being used) then the ThreadPool 
switches over to an algorithm to decide whether to create new threads in 
the pool or wait for a thread to become available. This algorithm is not 
very generous at creating new threads, so what we were seeing is that the 
connections were timing out on creation due to waiting for a thread to 
become available, not problems within the RabbitMQ client libraries.

You can get round this by setting the minimum number of threads available 
in the ThreadPool, which means that the number specified get created on 
your application start up:

ThreadPool.SetMinThreads(minWorkerThreads, minCompletionPortThreads);

Cheers,
Chris

On Thursday, 18 April 2013 12:37:40 UTC+1, Chris Haines wrote:
>
> Hi All,
>
> I have attached a .cs Nunit test fixture to demonstrate a problem I am 
> having with the ConnectionFactory. If I create 100 connections in a for 
> loop single threaded then I can create them all in about 2 seconds. If I 
> create them via a number of threads, in my test I am using 100 threads to 
> create a connection on each, then I get a lot of timeout exceptions (my 
> test bails out after 60 seconds). I have tried sharing an instance of the 
> ConnectionFactory between all threads and also giving each thread its own 
> instance but they both have the same result. I have also tried locking 
> around the call to CreateConnection but that also didn't help. 
>
> I find this behavior to be very strange. Has anyone else had similar 
> problems?
>
> Cheers,
> Chris
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/9a0f033b/attachment.htm>

From simon at rabbitmq.com  Wed May  1 12:06:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 01 May 2013 12:06:45 +0100
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
Message-ID: <5180F745.6090307@rabbitmq.com>

On 01/05/13 05:16, Chip Salzenberg wrote:
> I've successfully used the optional server feature of sending a
> basic.cancel when a consumed queue is deleted.  Great.  But a reasonable
> thing to do at that point is to close the channel, right?  But when I
> send a channel.close in that circumstance, RMQ 3.0.4 does not send a
> close-ok.  It doesn't send anything.  This makes my app hang.  I have to
> cheat and ass_u_me that the channel is closed in order to keep working.

Well that definitely sounds wrong.

(Bear in mind that the channel is not damaged by this, you don't have to 
close it if you don't want to. But I can see you might want to.)

> Am I doing something wrong?  Is this a server bug?  Both?  :)

I doubt it's a server bug; we have an automated test which closes a 
channel after receiving a cancel notification. But Steve points out the 
way in which the Java client could trip you up. In previous mails I 
think you mentioned using the Perl client; possibly it has a similar 
limitation in callbacks?

If not, please post some example code and I will look into it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dexterp37 at gmail.com  Wed May  1 11:22:13 2013
From: dexterp37 at gmail.com (Dexter)
Date: Wed, 1 May 2013 03:22:13 -0700 (PDT)
Subject: [rabbitmq-discuss] [Architecture] Real-time feed with RabbitMQ and
	NodeJS
Message-ID: <9f9a83c2-2db4-4a24-83b9-4a227d772819@googlegroups.com>

Hi,

I'm trying to design a system which allows for real time notifications 
(sms, email, browser) on some topics. I'm having some doubts about the 
architecture and on how I'm planning to use RabbitMQ. I'm sorry if the 
question is naive, but I'm a newbie of RabbitMQ!

==== Requirements ====
- User profiles are stored in a database. Each user profile contains the 
name of up to 2  topic of interest (i.e. Server1.CPU and 
Server3.RAM.Temperature).
- Topic name won't change often
- Agents can post messages to a certain topic of interest (i.e. post 
messages to Server1.CPU or to Server1, the latter should be received by 
everyone subscribed to Server1.CPU or Server1.SomethingElse)
- User get notified using based on their choice (SMS to the phone number 
stored in their profile or to the email address. Could also be to the 
twitter account)!
- The system should be both vertically and horizontally scalable.

==== Architecture ====

(1) Agents -> (2) Thin NodeJS RESTful API -> (3) CouchDB -> (4)_changes -> 
(5) CouchDB - RabbitMQ Bridge -> (6) Notifiers

1. Agents can be thought as services residing on a machine posting update 
messages to certain topics through the exposed API
2. The exposed API, which allows to add messages to the database (CouchDB) 
using a POST message call
3. CouchDB storing messages data, user data, etc.
4. A feed of changes coming from the DB which notifies (5) about new data 
in the DB
5. This point is a bit tricky and is where I'm having some doubts. 

I was thinking about using routing keys and topics ( 
http://www.rabbitmq.com/tutorials/tutorial-five-java.html ) and to let the 
CouchDB-RabbitMQ nodejs application publish the messages to the queue 
related to the topic of interest. Each queue acts as a task queue so that 
the load can be distributed among different instances of notifiers for EACH 
topic.

6. When a notifier consumes a messages, it gets the relevant data from the 
database (i.e. mobile phone number for the SMS or twitter account name) and 
notifies the user.

=== Questions ===
Is this a reasonable use case for RabbitMQ?
Is there any feature of RabbitMQ I'm misusing or not considering properly?
Is the queue organization in RabbitMQ correct? 

Thank you for your help,
Dexter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/8207c7f5/attachment.htm>

From srd at duneram.com  Wed May  1 14:15:01 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Wed, 01 May 2013 13:15:01 +0000
Subject: [rabbitmq-discuss] =?iso-8859-1?q?another_question_on_cookies__ve?=
	=?iso-8859-1?q?rsion_3=2E0=2E4?=
Message-ID: <20130501131501.12975.qmail@hoster904.com>

If I start the server with 

rabbitmq-server -setcookie vanilla

I find myself unable to stop the server with rabbitmqctl stop_app

I can't seem to pass the cookie  value to rabbitmqctl  so when it later tries to talk to it perhaps via 
rabbitmqctl status

it will tell me it cannot communicate with the server .

However if I start the server with no cookie (rabbitmq-server) , then I can do a rabbitmqctl status

so my questions are:
1) How does one normally start the server?
2) my reason for wanting to do cookies is I wanted to setup a multi node cluster (different servers)
    If I start a server (no parameters) on each server the cookie hash is different.
3) I have looked at the clustering guide but haven't succeeded in a setup using it.  How does one normally synchronize the cookies across servers?
4) where is the cookie file stored?   I found one on the rabbitmq user's root directory.   Is that where it is stored?
5) If I have to set a cookie value, is there a config file where it can be set (or env variable?) and what is the syntax to set it?

Thanks


From srd at duneram.com  Wed May  1 14:17:56 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Wed, 01 May 2013 13:17:56 +0000
Subject: [rabbitmq-discuss]
	=?iso-8859-1?q?Question_about_starting_a_node?=
Message-ID: <20130501131756.16525.qmail@hoster904.com>

Hi Tim,
Thank you for your help and clarification.  I will probably have more questions as I am just getting started with RabbitMQ.  

   	-------Original Message-------
 From: Tim Watson <tim at rabbitmq.com>
 To: srd <srd at duneram.com>, Discussions about RabbitMQ
<rabbitmq-discuss at lists.rabbitmq.com>
 Subject: Re: [rabbitmq-discuss] Question about starting a node
 Sent: 01 May '13 06:00

 Hi,

 On 30 Apr 2013, at 23:39, srd wrote:

 > I'm new to rabbitMQ.
 > Having trouble getting connection to my RabbitMQ node:
 > I start fresh (ps shows nothing running)
 > I had no .erlang.cookie prior to starting because I deleted it.
 >

 Erm, you need a cookie in order to do just about anything.

 > I start the server (as rabbitmq user)
 > -bash-4.1$ rabbitmqctl status
 > Status of node rabbit at node1 ...
 > Error: unable to connect to node rabbit at node1: nodedown
 >

 If you've got no cookie, then rabbitmqctl won't be able to connect to your
broker...

 > DIAGNOSTICS
 >
 > I've tried looking at the docs and this one puzzles me.
 > 1) I could see why rabbit at node1 isn't able to connect because I just
started it.  Is that what the error pertains to?

 Yes. It's not rabbit at node1 connecting to itself. It's
`rabbitmqctl2469 at node1` trying to connect to rabbit at node1.

 > 2) Why does it think my nodename is rabbitmqctl2469 at node1?
 >   Why isn't it rabbit at node1 ?

 That's the node name of the rabbitmqctl process, not the broker process.
They need to be able to 'talk to one another', which requires them to share
the same erlang cookie.

 > On top of all the problems trying to connect with rabbit at node1, it
appears the node name is now different
 >
 > before it was:
 > node name: rabbitmqctl24649 at node1
 > now its
 > node name: rabbitmqctl24868 at node1
 >
 > Would someone explain what is going on?

 That's completely normal. As I mentioned previously, the rabbitmqctl node
is different to the broker node. Each time you launch rabbitmqctl, it'll
choose a different node name, so that if you're trying to run multiple
rabbitmqctl commands simultaneously, the node names don't clash.

 HTH!

 Cheers,
 Tim

From tim at rabbitmq.com  Wed May  1 14:21:56 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 1 May 2013 14:21:56 +0100
Subject: [rabbitmq-discuss] another question on cookies  version 3.0.4
In-Reply-To: <20130501131501.12975.qmail@hoster904.com>
References: <20130501131501.12975.qmail@hoster904.com>
Message-ID: <860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>

Hi,

On 1 May 2013, at 14:15, srd wrote:

> so my questions are:
> 1) How does one normally start the server?

Depending on the platform, either /sbin/service rabbitmq-server start or via /etc/init.d/.

> 2) my reason for wanting to do cookies is I wanted to setup a multi node cluster (different servers)
>    If I start a server (no parameters) on each server the cookie hash is different.

You need to ensure that all the cookies are the same. You can do this by placing the .erlang.cookie file in the /home/rabbitmq directory on each server.

> 3) I have looked at the clustering guide but haven't succeeded in a setup using it.  How does one normally synchronize the cookies across servers?

That's up to you - rabbit doesn't provide anything out of the box to do this.

> 4) where is the cookie file stored?   I found one on the rabbitmq user's root directory.   Is that where it is stored?

That's correct.

> 5) If I have to set a cookie value, is there a config file where it can be set (or env variable?) and what is the syntax to set it?
> 

I would recommend just using the cookie stored in the rabbitmq user's home directory.

Cheers,
Tim

From srd at duneram.com  Wed May  1 14:26:35 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Wed, 01 May 2013 13:26:35 +0000
Subject: [rabbitmq-discuss]
	=?iso-8859-1?q?another_question_on_cookies_ver?=
	=?iso-8859-1?q?sion_3=2E0=2E4?=
In-Reply-To: <860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
References: <20130501131501.12975.qmail@hoster904.com>
	<860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
Message-ID: <20130501132635.27511.qmail@hoster904.com>

Thank you for your help.  I will give this a try.   

I've been starting it wrong all this time.

what is the best way to stop the server?  up until now I have found no good way to stop it except

ps -efwww | grep rabbit   
and then with that kill off the 4-6 associated jobs.

Dave


>  -------Original Message-------
>  From: Tim Watson <tim at rabbitmq.com>
>  To: srd <srd at duneram.com>, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  Subject: Re: [rabbitmq-discuss] another question on cookies version 3.0.4
>  Sent: 01 May '13 13:21
>  
>  Hi,
>  
>  On 1 May 2013, at 14:15, srd wrote:
>  
>  > so my questions are:
>  > 1) How does one normally start the server?
>  
>  Depending on the platform, either /sbin/service rabbitmq-server start or via /etc/init.d/.
>  
>  > 2) my reason for wanting to do cookies is I wanted to setup a multi node cluster (different servers)
>  >????If I start a server (no parameters) on each server the cookie hash is different.
>  
>  You need to ensure that all the cookies are the same. You can do this by placing the .erlang.cookie file in the /home/rabbitmq directory on each server.
>  
>  > 3) I have looked at the clustering guide but haven't succeeded in a setup using it.??How does one normally synchronize the cookies across servers?
>  
>  That's up to you - rabbit doesn't provide anything out of the box to do this.
>  
>  > 4) where is the cookie file stored??? I found one on the rabbitmq user's root directory.?? Is that where it is stored?
>  
>  That's correct.
>  
>  > 5) If I have to set a cookie value, is there a config file where it can be set (or env variable?) and what is the syntax to set it?
>  >
>  
>  I would recommend just using the cookie stored in the rabbitmq user's home directory.
>  
>  Cheers,
>  Tim

From simon at rabbitmq.com  Wed May  1 15:46:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 01 May 2013 15:46:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 released
Message-ID: <51812ABA.6020507@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.1.0.

This release introduces eager synchronisation of mirror queue slaves, 
automatic cluster partition healing, and improved statistics (including 
charts) in the management plugin. It also adds many smaller new 
features, bug fixes and performance improvements.

See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.1.0.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)

From ward.mark at gmail.com  Wed May  1 16:26:09 2013
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 1 May 2013 08:26:09 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 released
In-Reply-To: <51812ABA.6020507@rabbitmq.com>
References: <51812ABA.6020507@rabbitmq.com>
Message-ID: <1367421969069-26331.post@n5.nabble.com>

Hi RabbitMQ Team,

I am excited to explore the new enhancements in this release.  Although, I
have something to report.  I just upgraded my RabbitMQ server on ubuntu
server 12.04 using http://www.rabbitmq.com/debian testing/main repository.

After the upgrade the Overview page gives me the following error. 

ReferenceError: queue_length is not defined

These servers do not have queues declared or virtual hosts other than the
default "/" virtual host. 

-Mark



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-1-0-released-tp26330p26331.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed May  1 16:38:29 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 01 May 2013 16:38:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 released
In-Reply-To: <1367421969069-26331.post@n5.nabble.com>
References: <51812ABA.6020507@rabbitmq.com>
	<1367421969069-26331.post@n5.nabble.com>
Message-ID: <518136F5.6040709@rabbitmq.com>

On 01/05/13 16:26, Mark Ward wrote:
> After the upgrade the Overview page gives me the following error.
>
> ReferenceError: queue_length is not defined

This is symptomatic of stale entries in your browser's cache. Please 
empty the cache, restart the browser, press shift-F5, etc.

Browser caches are horrible...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From john.krukoff at pearson.com  Wed May  1 16:39:04 2013
From: john.krukoff at pearson.com (Krukoff, John)
Date: Wed, 1 May 2013 09:39:04 -0600
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 released
In-Reply-To: <1367421969069-26331.post@n5.nabble.com>
References: <51812ABA.6020507@rabbitmq.com>
	<1367421969069-26331.post@n5.nabble.com>
Message-ID: <CAJn0hOOh-zTx1qYA3YSbAzSjUwwPoXvSGN=TZGQ3S_O347ZgSQ@mail.gmail.com>

Yeah, I saw the same thing. Force reload, you're caching the old page.


On Wed, May 1, 2013 at 9:26 AM, Mark Ward <ward.mark at gmail.com> wrote:

> Hi RabbitMQ Team,
>
> I am excited to explore the new enhancements in this release.  Although, I
> have something to report.  I just upgraded my RabbitMQ server on ubuntu
> server 12.04 using http://www.rabbitmq.com/debian testing/main repository.
>
> After the upgrade the Overview page gives me the following error.
>
> ReferenceError: queue_length is not defined
>
> These servers do not have queues declared or virtual hosts other than the
> default "/" virtual host.
>
> -Mark
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-1-0-released-tp26330p26331.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
John Krukoff
john.krukoff at pearson.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/ca07754b/attachment.htm>

From ranjitiyer at gmail.com  Wed May  1 17:11:48 2013
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Wed, 1 May 2013 09:11:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Repairing a crashed cluster - Obtaining
 persisted msgs from master
In-Reply-To: <5180E736.9050408@rabbitmq.com>
References: <1367341821112-26310.post@n5.nabble.com>
	<5180E736.9050408@rabbitmq.com>
Message-ID: <1367424708045-26334.post@n5.nabble.com>

Hi Simon,

> Note that since that message, RabbitMQ 3.0 was released, with 
> "rabbitmqctl forget_cluster_node" - which might help you get the slave 
> started if the master is gone. 

But isn't this option available only after the rabbitmq server has started
(erl.exe) and I've noticed even erl.exe won't start on a slave machine if
its remote master is not available?

>But what are you trying to do? If the master is still available and more 
>up to date than the slave then why are you removing it? 

Perhaps my understanding is incomplete. When a newly added slave is yet to
be synchronized (http://www.rabbitmq.com/ha.html#unsynchronised-slaves) and
the master (with messages yet to be mirrored across to the slave) dies, does
the hitherto unsynchronized slave, become a fully synchronized master?

My concern was that if this didn't happen, then the newly appointed master
wouldn't have some messages because it wasn't fully synchronized and there
would need to be a way to pull those from the old master DB. (can assume
there is access to the master's db file).

Ranjit



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Repairing-a-crashed-cluster-Obtaining-persisted-msgs-from-master-tp26310p26334.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ranjitiyer at gmail.com  Wed May  1 17:23:08 2013
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Wed, 1 May 2013 09:23:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Repairing a crashed cluster - Obtaining
 persisted msgs from master
In-Reply-To: <1367424708045-26334.post@n5.nabble.com>
References: <1367341821112-26310.post@n5.nabble.com>
	<5180E736.9050408@rabbitmq.com>
	<1367424708045-26334.post@n5.nabble.com>
Message-ID: <1367425388584-26335.post@n5.nabble.com>

Hi Simon,

Please ignore my second question about unsynchronized slaves. This is a
newbie mistake. I reread the documentation and found this.

"Explicit synchronisation can be triggered in two ways: manually or
automatically. If a queue is set to automatically synchronise it will
synchronise whenever a new slave joins - becoming unresponsive until it has
done so."

Ranjit



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Repairing-a-crashed-cluster-Obtaining-persisted-msgs-from-master-tp26310p26335.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed May  1 17:27:20 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 01 May 2013 17:27:20 +0100
Subject: [rabbitmq-discuss] Repairing a crashed cluster - Obtaining
 persisted msgs from master
In-Reply-To: <1367425388584-26335.post@n5.nabble.com>
References: <1367341821112-26310.post@n5.nabble.com>
	<5180E736.9050408@rabbitmq.com>
	<1367424708045-26334.post@n5.nabble.com>
	<1367425388584-26335.post@n5.nabble.com>
Message-ID: <51814268.1010306@rabbitmq.com>

That documentation is only an hour or so old; the feature is new in 
RabbitMQ 3.1.0. So I'm not surprised you didn't notice it before :-)

Cheers, Simon

On 01/05/13 17:23, ranjitiyer wrote:
> Hi Simon,
>
> Please ignore my second question about unsynchronized slaves. This is a
> newbie mistake. I reread the documentation and found this.
>
> "Explicit synchronisation can be triggered in two ways: manually or
> automatically. If a queue is set to automatically synchronise it will
> synchronise whenever a new slave joins - becoming unresponsive until it has
> done so."
>
> Ranjit
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Repairing-a-crashed-cluster-Obtaining-persisted-msgs-from-master-tp26310p26335.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May  1 17:28:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 01 May 2013 17:28:56 +0100
Subject: [rabbitmq-discuss] Repairing a crashed cluster - Obtaining
 persisted msgs from master
In-Reply-To: <1367424708045-26334.post@n5.nabble.com>
References: <1367341821112-26310.post@n5.nabble.com>
	<5180E736.9050408@rabbitmq.com>
	<1367424708045-26334.post@n5.nabble.com>
Message-ID: <518142C8.1040906@rabbitmq.com>

On 01/05/13 17:11, ranjitiyer wrote:
> Hi Simon,
>
>> Note that since that message, RabbitMQ 3.0 was released, with
>> "rabbitmqctl forget_cluster_node" - which might help you get the slave
>> started if the master is gone.
>
> But isn't this option available only after the rabbitmq server has started
> (erl.exe) and I've noticed even erl.exe won't start on a slave machine if
> its remote master is not available?

It's worth noting that at the cluster level there are no "masters" and 
"slaves" (those terms only apply to the mirrors of individual queues).

But when restarting a stopped cluster, all other nodes wait for the last 
node that shut down to come back (since that node could know about 
things which happened that no other node has seen).

So if that last-node-to-shut-down is no longer available then you can 
recover with a combination of starting the second-to-last node with 
RABBITMQ_NODE_ONLY set, then invoking "rabbitmqctl forget_cluster_node 
--offline".

This could probably be better documented. It's a bit of an edge case 
though...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From allan at chartbeat.com  Wed May  1 17:35:16 2013
From: allan at chartbeat.com (Allan Beaufour)
Date: Wed, 1 May 2013 12:35:16 -0400
Subject: [rabbitmq-discuss] Hanging connections in management interface
	(v3.0.4)
In-Reply-To: <517FCF6C.5090105@rabbitmq.com>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
	<517F9271.4090906@rabbitmq.com>
	<CAO98qLZ7v1T6N=q27gonQ7ObHZMcz90nEej_6O4vLt5jWXXYLA@mail.gmail.com>
	<517FCF6C.5090105@rabbitmq.com>
Message-ID: <CAO98qLayjmgPQVRkNYiyEvLtTM_S-NE9zWF=WyNqt-jr29gdWA@mail.gmail.com>

On Tue, Apr 30, 2013 at 10:04 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
> So you say "queues show hanging connections". Do you mean that the
> management plugin shows connections under the "Connections" tab, or
> consumers under queue details, or something else?
>

It shows up under the consumers in queue details.


> Do you see the same items in rabbitmqctl list_connections (or list_queues
> or similar)?
>

Yes, it shows up there. I just forcefully closed one of the:
[[
# rabbitmqctl list_channels name connection | grep 44478
client:44478 -> server:5672 (1) <rabbit at rabbitmq02.2.10377.40>
# rabbitmqctl close_connection "<rabbit at rabbitmq02.2.10377.40>" "close
hanging connection"
Closing connection "<rabbit at rabbitmq02.2.10377.40>" ...
...done.
]]

This cleared that connection. The really weird thing is that lsof only
shows that connection on the server, not on the client. I.e. I could find
this on the server:
[[
beam.smp 29152    rabbitmq   19u  IPv6 523865701      0t0  TCP
server:5672->client:44478 (ESTABLISHED)
]]
but not on the client side. That it's IPv6 confuses me "a little".



> If so can you send the output of "rabbitmqctl report"?
>

I'll send that off list.

Also, do these items ever go away?
>

I can't say for sure, as I haven't checked to see if some of them go away,
and new ones "replace" them, but the number of hanging connections doesn't
ever seem to go down, no.


> Has the memory alarm / disk alarm gone off at any point?
>

No.

Allan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/604cef7a/attachment.htm>

From michael.s.klishin at gmail.com  Wed May  1 18:58:28 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 1 May 2013 21:58:28 +0400
Subject: [rabbitmq-discuss] How does x-max-length work in 3.1?
Message-ID: <CAE3HoVRfxM=35yj3uYU6hAYtkzB8YNgczM+ebC+FyxPy59LQnQ@mail.gmail.com>

I'm curious if there's any documentation about x-max-length in 3.1?

What would happen if I set queue size limit to 10 and then publish 15
messages
that are routed to that queue?

Thanks.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/b7a4afa8/attachment.htm>

From matthias at rabbitmq.com  Wed May  1 19:16:11 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 May 2013 19:16:11 +0100
Subject: [rabbitmq-discuss] How does x-max-length work in 3.1?
In-Reply-To: <CAE3HoVRfxM=35yj3uYU6hAYtkzB8YNgczM+ebC+FyxPy59LQnQ@mail.gmail.com>
References: <CAE3HoVRfxM=35yj3uYU6hAYtkzB8YNgczM+ebC+FyxPy59LQnQ@mail.gmail.com>
Message-ID: <51815BEB.5030905@rabbitmq.com>

On 01/05/13 18:58, Michael Klishin wrote:
> I'm curious if there's any documentation about x-max-length in 3.1?

http://www.rabbitmq.com/maxlength.html

Matthias.

From ranjitiyer at gmail.com  Wed May  1 19:34:50 2013
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Wed, 1 May 2013 11:34:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer acknowledgements for very long running
	tasks
Message-ID: <1367433290054-26341.post@n5.nabble.com>

Hello,

We are looking to incorporate RabbitMQ as a queuing system for our jobs
processing architecture. In our system, there is at least one job that can
potentially run for an extremely long amount of time (>30 days). A msg
corresponding to this job would be put into the queue, picked up and run for
a very long duration.

Is there a corner case in which because acks haven't been received for a
very long time, msgs are either automatically redelivered or 'considered
consumed'?

As I understand it none of the ttl (message ttl, queue ttl) constraints
apply to messages that have been read by a consumer but yet to be
acknowledged. And that a task working off of this message could run for as
long as it takes to complete. (Eventually though the consumer will ack the
msg).

Can someone please affirm/clarify?

Thanks,
Ranjit

PS - I am reading this
http://www.rabbitmq.com/tutorials/tutorial-two-java.html
"There aren't any message timeouts; RabbitMQ will redeliver the message only
when the worker connection dies. It's fine even if processing a message
takes a very, very long time."




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Consumer-acknowledgements-for-very-long-running-tasks-tp26341.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Wed May  1 20:33:25 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 1 May 2013 23:33:25 +0400
Subject: [rabbitmq-discuss] Consumer acknowledgements for very long
 running tasks
In-Reply-To: <1367433290054-26341.post@n5.nabble.com>
References: <1367433290054-26341.post@n5.nabble.com>
Message-ID: <CAE3HoVSOyAWWOuyVf7tKPZ1qcEbgNnht7adsQRpCjF84QRjgpw@mail.gmail.com>

2013/5/1 ranjitiyer <ranjitiyer at gmail.com>

> Is there a corner case in which because acks haven't been received for a
> very long time, msgs are either automatically redelivered or 'considered
> consumed'?
>

AFAIK there are no limitations on how long the broker will wait for acks,
but if you use queue TTL,
it may affect your case.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/06d4faa3/attachment.htm>

From videlalvaro at gmail.com  Wed May  1 20:35:34 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 1 May 2013 21:35:34 +0200
Subject: [rabbitmq-discuss] How does x-max-length work in 3.1?
In-Reply-To: <51815BEB.5030905@rabbitmq.com>
References: <CAE3HoVRfxM=35yj3uYU6hAYtkzB8YNgczM+ebC+FyxPy59LQnQ@mail.gmail.com>
	<51815BEB.5030905@rabbitmq.com>
Message-ID: <CAMcAHLXZc9-eY+ZDYqSuFXacwPUbtt+1mOaG4CHj2w3QQ7DE5A@mail.gmail.com>

Hi,

So if x-max-length is 0 and there's a consumer ready to accept messages,
the message will be delivered to that consumer or dropped?

Regards,

Alvaro


On Wed, May 1, 2013 at 8:16 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 01/05/13 18:58, Michael Klishin wrote:
>
>> I'm curious if there's any documentation about x-max-length in 3.1?
>>
>
> http://www.rabbitmq.com/**maxlength.html<http://www.rabbitmq.com/maxlength.html>
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/8b0455e4/attachment.htm>

From matthias at rabbitmq.com  Wed May  1 20:54:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 May 2013 20:54:42 +0100
Subject: [rabbitmq-discuss] How does x-max-length work in 3.1?
In-Reply-To: <CAMcAHLXZc9-eY+ZDYqSuFXacwPUbtt+1mOaG4CHj2w3QQ7DE5A@mail.gmail.com>
References: <CAE3HoVRfxM=35yj3uYU6hAYtkzB8YNgczM+ebC+FyxPy59LQnQ@mail.gmail.com>
	<51815BEB.5030905@rabbitmq.com>
	<CAMcAHLXZc9-eY+ZDYqSuFXacwPUbtt+1mOaG4CHj2w3QQ7DE5A@mail.gmail.com>
Message-ID: <51817302.8030106@rabbitmq.com>

On 01/05/13 20:35, Alvaro Videla wrote:
> So if x-max-length is 0 and there's a consumer ready to accept messages,
> the message will be delivered to that consumer or dropped?

The former. From http://www.rabbitmq.com/maxlength.html
<quote>
Queue length is a measure that takes into account ready messages, 
*ignoring unacknowledged messages*
</quote>

Matthias.

From srd at duneram.com  Wed May  1 21:17:30 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Wed, 01 May 2013 20:17:30 +0000
Subject: [rabbitmq-discuss]
	=?iso-8859-1?q?another_question_on_cookies_ver?=
	=?iso-8859-1?q?sion_3=2E0=2E4?=
In-Reply-To: <CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>
References: <20130501131501.12975.qmail@hoster904.com>
	<860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
	<20130501132635.27511.qmail@hoster904.com>
	<CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>
Message-ID: <20130501201730.21459.qmail@hoster904.com>

thanks for the reply.  I was killing it in the raw before.


>  -------Original Message-------
>  From: Gerald Kuch <jkuch at gopivotal.com>
>  To: srd <srd at duneram.com>, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  Subject: Re: [rabbitmq-discuss] another question on cookies version 3.0.4
>  Sent: 01 May '13 19:51
>  
>  Depends how you started it: ?Either /sbin/service/rabbitmq-server stop or
>  /etc/init.d/.
>  
>  
>  Of course 'kill' will stop it, but the cleanliness of doing the
>  former is preferable in non-emergency circumstances.
>  
>  
>  On Wed, May 1, 2013 at 6:26 AM, srd <[LINK: mailto:srd at duneram.com]
>  srd at duneram.com> wrote:
>  Thank you for your help. ?I will give this a try.
>  
>  I've been starting it wrong all this time.
>  
>  what is the best way to stop the server? ?up until now I have found no
>  good way to stop it except
>  
>  ps -efwww | grep rabbit
>  and then with that kill off the 4-6 associated jobs.
>  
>  Dave
>  
>  
>  > ?-------Original Message-------
>  > ?From: Tim Watson <[LINK: mailto:tim at rabbitmq.com] tim at rabbitmq.com>
>  > ?To: srd <[LINK: mailto:srd at duneram.com] srd at duneram.com>, Discussions
>  about RabbitMQ <[LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>  rabbitmq-discuss at lists.rabbitmq.com>
>  > ?Subject: Re: [rabbitmq-discuss] another question on cookies version
>  3.0.4
>  > ?Sent: 01 May '13 13:21
>  >
>  > ?Hi,
>  >
>  > ?On 1 May 2013, at 14:15, srd wrote:
>  >
>  > ?> so my questions are:
>  > ?> 1) How does one normally start the server?
>  >
>  > ?Depending on the platform, either /sbin/service rabbitmq-server start
>  or via /etc/init.d/.
>  >
>  > ?> 2) my reason for wanting to do cookies is I wanted to setup a multi
>  node cluster (different servers)
>  > ?>????If I start a server (no parameters) on each server the cookie
>  hash is different.
>  >
>  > ?You need to ensure that all the cookies are the same. You can do this
>  by placing the .erlang.cookie file in the /home/rabbitmq directory on each
>  server.
>  >
>  > ?> 3) I have looked at the clustering guide but haven't succeeded
>  in a setup using it.??How does one normally synchronize the cookies
>  across servers?
>  >
>  > ?That's up to you - rabbit doesn't provide anything out of the
>  box to do this.
>  >
>  > ?> 4) where is the cookie file stored??? I found one on the rabbitmq
>  user's root directory.?? Is that where it is stored?
>  >
>  > ?That's correct.
>  >
>  > ?> 5) If I have to set a cookie value, is there a config file where it
>  can be set (or env variable?) and what is the syntax to set it?
>  > ?>
>  >
>  > ?I would recommend just using the cookie stored in the rabbitmq
>  user's home directory.
>  >
>  > ?Cheers,
>  > ?Tim
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  [LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>  rabbitmq-discuss at lists.rabbitmq.com
>  [LINK:
>  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss]
>  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jkuch at gopivotal.com  Wed May  1 20:51:36 2013
From: jkuch at gopivotal.com (Gerald Kuch)
Date: Wed, 1 May 2013 12:51:36 -0700
Subject: [rabbitmq-discuss] another question on cookies version 3.0.4
In-Reply-To: <20130501132635.27511.qmail@hoster904.com>
References: <20130501131501.12975.qmail@hoster904.com>
	<860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
	<20130501132635.27511.qmail@hoster904.com>
Message-ID: <CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>

Depends how you started it:  Either /sbin/service/rabbitmq-server stop or
/etc/init.d/.

Of course 'kill' will stop it, but the cleanliness of doing the former is
preferable in non-emergency circumstances.



On Wed, May 1, 2013 at 6:26 AM, srd <srd at duneram.com> wrote:

> Thank you for your help.  I will give this a try.
>
> I've been starting it wrong all this time.
>
> what is the best way to stop the server?  up until now I have found no
> good way to stop it except
>
> ps -efwww | grep rabbit
> and then with that kill off the 4-6 associated jobs.
>
> Dave
>
>
> >  -------Original Message-------
> >  From: Tim Watson <tim at rabbitmq.com>
> >  To: srd <srd at duneram.com>, Discussions about RabbitMQ <
> rabbitmq-discuss at lists.rabbitmq.com>
> >  Subject: Re: [rabbitmq-discuss] another question on cookies version
> 3.0.4
> >  Sent: 01 May '13 13:21
> >
> >  Hi,
> >
> >  On 1 May 2013, at 14:15, srd wrote:
> >
> >  > so my questions are:
> >  > 1) How does one normally start the server?
> >
> >  Depending on the platform, either /sbin/service rabbitmq-server start
> or via /etc/init.d/.
> >
> >  > 2) my reason for wanting to do cookies is I wanted to setup a multi
> node cluster (different servers)
> >  >    If I start a server (no parameters) on each server the cookie hash
> is different.
> >
> >  You need to ensure that all the cookies are the same. You can do this
> by placing the .erlang.cookie file in the /home/rabbitmq directory on each
> server.
> >
> >  > 3) I have looked at the clustering guide but haven't succeeded in a
> setup using it.  How does one normally synchronize the cookies across
> servers?
> >
> >  That's up to you - rabbit doesn't provide anything out of the box to do
> this.
> >
> >  > 4) where is the cookie file stored?   I found one on the rabbitmq
> user's root directory.   Is that where it is stored?
> >
> >  That's correct.
> >
> >  > 5) If I have to set a cookie value, is there a config file where it
> can be set (or env variable?) and what is the syntax to set it?
> >  >
> >
> >  I would recommend just using the cookie stored in the rabbitmq user's
> home directory.
> >
> >  Cheers,
> >  Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/978a2e6e/attachment.htm>

From jkuch at gopivotal.com  Wed May  1 20:52:16 2013
From: jkuch at gopivotal.com (Gerald Kuch)
Date: Wed, 1 May 2013 12:52:16 -0700
Subject: [rabbitmq-discuss] another question on cookies version 3.0.4
In-Reply-To: <CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>
References: <20130501131501.12975.qmail@hoster904.com>
	<860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
	<20130501132635.27511.qmail@hoster904.com>
	<CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>
Message-ID: <CANOx8N=aQ4xyAq8+x3YxWebZ1EZm3ucx-PbQtONnrkqn-f_FjQ@mail.gmail.com>

Ooops, my fingers auto-completed the "/etc/init.d" on the end of the
sentence.  Forget about that part.



On Wed, May 1, 2013 at 12:51 PM, Gerald Kuch <jkuch at gopivotal.com> wrote:

> Depends how you started it:  Either /sbin/service/rabbitmq-server stop or
> /etc/init.d/.
>
> Of course 'kill' will stop it, but the cleanliness of doing the former is
> preferable in non-emergency circumstances.
>
>
>
> On Wed, May 1, 2013 at 6:26 AM, srd <srd at duneram.com> wrote:
>
>> Thank you for your help.  I will give this a try.
>>
>> I've been starting it wrong all this time.
>>
>> what is the best way to stop the server?  up until now I have found no
>> good way to stop it except
>>
>> ps -efwww | grep rabbit
>> and then with that kill off the 4-6 associated jobs.
>>
>> Dave
>>
>>
>> >  -------Original Message-------
>> >  From: Tim Watson <tim at rabbitmq.com>
>> >  To: srd <srd at duneram.com>, Discussions about RabbitMQ <
>> rabbitmq-discuss at lists.rabbitmq.com>
>> >  Subject: Re: [rabbitmq-discuss] another question on cookies version
>> 3.0.4
>> >  Sent: 01 May '13 13:21
>> >
>> >  Hi,
>> >
>> >  On 1 May 2013, at 14:15, srd wrote:
>> >
>> >  > so my questions are:
>> >  > 1) How does one normally start the server?
>> >
>> >  Depending on the platform, either /sbin/service rabbitmq-server start
>> or via /etc/init.d/.
>> >
>> >  > 2) my reason for wanting to do cookies is I wanted to setup a multi
>> node cluster (different servers)
>> >  >    If I start a server (no parameters) on each server the cookie
>> hash is different.
>> >
>> >  You need to ensure that all the cookies are the same. You can do this
>> by placing the .erlang.cookie file in the /home/rabbitmq directory on each
>> server.
>> >
>> >  > 3) I have looked at the clustering guide but haven't succeeded in a
>> setup using it.  How does one normally synchronize the cookies across
>> servers?
>> >
>> >  That's up to you - rabbit doesn't provide anything out of the box to
>> do this.
>> >
>> >  > 4) where is the cookie file stored?   I found one on the rabbitmq
>> user's root directory.   Is that where it is stored?
>> >
>> >  That's correct.
>> >
>> >  > 5) If I have to set a cookie value, is there a config file where it
>> can be set (or env variable?) and what is the syntax to set it?
>> >  >
>> >
>> >  I would recommend just using the cookie stored in the rabbitmq user's
>> home directory.
>> >
>> >  Cheers,
>> >  Tim
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/ecad2979/attachment.htm>

From matthieu.labour at gmail.com  Wed May  1 21:04:14 2013
From: matthieu.labour at gmail.com (Matthieu Labour)
Date: Wed, 1 May 2013 13:04:14 -0700 (PDT)
Subject: [rabbitmq-discuss] buffering messages and batch processing
Message-ID: <91d3ca31-7d06-4f53-a51d-4a214878330d@googlegroups.com>

Hi

There are posts related to my question such as the one below
http://tinyurl.com/cwntvbl

However i could not find one that exactly address my question. 
I apologize in advance if i missed it.

In the receiving callback, we are buffering the messages and then we 
process/handle them when we either reach N messages received or when a 
period of X minutes have elapsed

I was wondering if RabbitMQ does provide this ability natively. On other 
words, it is possible to tell RabbitMQ to deliver messages to the receiver 
when N messages are sitting in the queues and for when messages have been 
sitting in the queue for longer than T.

Thank you for your inputs
-matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/d99d9467/attachment.htm>

From srd at duneram.com  Wed May  1 21:31:17 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Wed, 01 May 2013 20:31:17 +0000
Subject: [rabbitmq-discuss] =?iso-8859-1?q?clustering___--_detached?=
In-Reply-To: <CANOx8N=aQ4xyAq8+x3YxWebZ1EZm3ucx-PbQtONnrkqn-f_FjQ@mail.gmail.com>
References: <20130501131501.12975.qmail@hoster904.com>
	<860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
	<20130501132635.27511.qmail@hoster904.com>
	<CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>
	<CANOx8N=aQ4xyAq8+x3YxWebZ1EZm3ucx-PbQtONnrkqn-f_FjQ@mail.gmail.com>
Message-ID: <20130501203117.7302.qmail@hoster904.com>

Now that I have my 2 servers setup with rabbitmq I am now attempting to cluster them.  When I got to the first step in the http://www.rabbitmq.com/clustering.html, it told me to start rabbitmq in the normal way:
rabbitmq-server -detached


From michael.s.klishin at gmail.com  Wed May  1 21:33:39 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 2 May 2013 00:33:39 +0400
Subject: [rabbitmq-discuss] buffering messages and batch processing
In-Reply-To: <91d3ca31-7d06-4f53-a51d-4a214878330d@googlegroups.com>
References: <91d3ca31-7d06-4f53-a51d-4a214878330d@googlegroups.com>
Message-ID: <CAE3HoVR6BwNSd6fJv8dxPd9fiJO-EepYuEsGsf2K0NvVG9C89Q@mail.gmail.com>

2013/5/2 Matthieu Labour <matthieu.labour at gmail.com>

> I was wondering if RabbitMQ does provide this ability natively. On other
> words, it is possible to tell RabbitMQ to deliver messages to the receiver
> when N messages are sitting in the queues and for when messages have been
> sitting in the queue for longer than T.


In a word: no.

The latter may be simulated via TTL and dead-lettering but it may end up
being a more complex solution
than doing this in your consumer.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/2f462315/attachment.htm>

From jerryk at rbcon.com  Wed May  1 21:37:27 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 1 May 2013 13:37:27 -0700
Subject: [rabbitmq-discuss] clustering   -- detached
In-Reply-To: <20130501203117.7302.qmail@hoster904.com>
References: <20130501131501.12975.qmail@hoster904.com>
	<860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
	<20130501132635.27511.qmail@hoster904.com>
	<CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>
	<CANOx8N=aQ4xyAq8+x3YxWebZ1EZm3ucx-PbQtONnrkqn-f_FjQ@mail.gmail.com>
	<20130501203117.7302.qmail@hoster904.com>
Message-ID: <C46BDAE3-0A7A-452E-9782-90B23A19E879@rbcon.com>

IIRC that tutorial isn't suggesting you need to start rabbit that way on your clustered nodes. If you have bona fide, separate machines running brokers, start them the recommended way for that platform. Make sure Erlang cookies are properly common to the user accounts the brokers run under and that the same cookie is used by the invoker of rabbitmqctl when you issue the clustering commands. 

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On May 1, 2013, at 1:31 PM, "srd" <srd at duneram.com> wrote:

> Now that I have my 2 servers setup with rabbitmq I am now attempting to cluster them.  When I got to the first step in the http://www.rabbitmq.com/clustering.html, it told me to start rabbitmq in the normal way:
> rabbitmq-server -detached
> 
> From what I can see, this isn't how its normally started if I am running in single node mode, as it behaves differently.
> 
> In order to get the service approach to work correctly, I modified rabbitmq-server in /etc/init.d as follows:
> [root at cluster1 init.d]# diff rabbitmq-server.20130501 rabbitmq-server
> 63c63
> <         RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON \
> ---
>>        RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
> [root at cluster1 init.d]#
> 
> I changed it there because DAEMON appears to be the rabbitmq-server
> 
> [root at cluster1 init.d]# grep DAEMON rabbitmq-server
> DAEMON=/usr/sbin/${NAME}
> test -x $DAEMON || exit 0
>        RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
> [root at cluster1 init.d]#
> 
> When I performed service rabbitmq-server start
> 
> It just hung and never came back with a prompt.
> 
> However in another window I confirmed the rabbitmq-server was running
> 
> I then killed the service console window and looked at the startup_err file:
> [root at cluster1 init.d]# more /var/log/rabbitmq/startup_err
> Warning: PID file not written; -detached was passed.
> 
> and then i had to separately kill the process(s) associated with rabbitmq.
> 
> so my questions are thus:
>   1) the documentation states this is how to normally start the server.  Is that normally for all modes or just for a clustered node approach?
>   2) What can I do to keep the command from hanging if started as a service?  
> 
> 
> 
>> -------Original Message-------
>> From: Gerald Kuch <jkuch at gopivotal.com>
>> To: srd <srd at duneram.com>, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Subject: Re: [rabbitmq-discuss] another question on cookies version 3.0.4
>> Sent: 01 May '13 19:52
>> 
>> Ooops, my fingers auto-completed the "/etc/init.d" on the end of the
>> sentence.  Forget about that part.
>> 
>> 
>> On Wed, May 1, 2013 at 12:51 PM, Gerald Kuch <[LINK:
>> mailto:jkuch at gopivotal.com] jkuch at gopivotal.com> wrote:
>> 
>> Depends how you started it:  Either /sbin/service/rabbitmq-server stop or
>> /etc/init.d/.
>> 
>> 
>> Of course 'kill' will stop it, but the cleanliness of doing the
>> former is preferable in non-emergency circumstances.
>> 
>> 
>> On Wed, May 1, 2013 at 6:26 AM, srd <[LINK: mailto:srd at duneram.com]
>> srd at duneram.com> wrote:
>> Thank you for your help.  I will give this a try.
>> 
>> I've been starting it wrong all this time.
>> 
>> what is the best way to stop the server?  up until now I have found no
>> good way to stop it except
>> 
>> ps -efwww | grep rabbit
>> and then with that kill off the 4-6 associated jobs.
>> 
>> Dave
>> 
>> 
>>>  -------Original Message-------
>>>  From: Tim Watson <[LINK: mailto:tim at rabbitmq.com] tim at rabbitmq.com>
>>>  To: srd <[LINK: mailto:srd at duneram.com] srd at duneram.com>, Discussions
>> about RabbitMQ <[LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>> rabbitmq-discuss at lists.rabbitmq.com>
>>>  Subject: Re: [rabbitmq-discuss] another question on cookies version
>> 3.0.4
>>>  Sent: 01 May '13 13:21
>>> 
>>>  Hi,
>>> 
>>>  On 1 May 2013, at 14:15, srd wrote:
>>> 
>>>  > so my questions are:
>>>  > 1) How does one normally start the server?
>>> 
>>>  Depending on the platform, either /sbin/service rabbitmq-server start
>> or via /etc/init.d/.
>>> 
>>>  > 2) my reason for wanting to do cookies is I wanted to setup a multi
>> node cluster (different servers)
>>>  >    If I start a server (no parameters) on each server the cookie
>> hash is different.
>>> 
>>>  You need to ensure that all the cookies are the same. You can do this
>> by placing the .erlang.cookie file in the /home/rabbitmq directory on each
>> server.
>>> 
>>>  > 3) I have looked at the clustering guide but haven't succeeded
>> in a setup using it.  How does one normally synchronize the cookies
>> across servers?
>>> 
>>>  That's up to you - rabbit doesn't provide anything out of the
>> box to do this.
>>> 
>>>  > 4) where is the cookie file stored?   I found one on the rabbitmq
>> user's root directory.   Is that where it is stored?
>>> 
>>>  That's correct.
>>> 
>>>  > 5) If I have to set a cookie value, is there a config file where it
>> can be set (or env variable?) and what is the syntax to set it?
>>>  >
>>> 
>>>  I would recommend just using the cookie stored in the rabbitmq
>> user's home directory.
>>> 
>>>  Cheers,
>>>  Tim
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> [LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>> rabbitmq-discuss at lists.rabbitmq.com
>> [LINK:
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss]
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From srd at duneram.com  Wed May  1 21:49:18 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Wed, 01 May 2013 20:49:18 +0000
Subject: [rabbitmq-discuss] =?iso-8859-1?q?clustering_--_detached?=
In-Reply-To: <C46BDAE3-0A7A-452E-9782-90B23A19E879@rbcon.com>
References: <20130501131501.12975.qmail@hoster904.com>
	<860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
	<20130501132635.27511.qmail@hoster904.com>
	<CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>
	<CANOx8N=aQ4xyAq8+x3YxWebZ1EZm3ucx-PbQtONnrkqn-f_FjQ@mail.gmail.com>
	<20130501203117.7302.qmail@hoster904.com>
	<C46BDAE3-0A7A-452E-9782-90B23A19E879@rbcon.com>
Message-ID: <20130501204918.26866.qmail@hoster904.com>

thanks I'll take a look.


>  -------Original Message-------
>  From: Jerry Kuch <jerryk at rbcon.com>
>  To: srd <srd at duneram.com>, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  Subject: Re: [rabbitmq-discuss] clustering -- detached
>  Sent: 01 May '13 20:37
>  
>  IIRC that tutorial isn't suggesting you need to start rabbit that way on your clustered nodes. If you have bona fide, separate machines running brokers, start them the recommended way for that platform. Make sure Erlang cookies are properly common to the user accounts the brokers run under and that the same cookie is used by the invoker of rabbitmqctl when you issue the clustering commands.
>  
>  Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).
>  
>  
>  On May 1, 2013, at 1:31 PM, "srd" <srd at duneram.com> wrote:
>  
>  > Now that I have my 2 servers setup with rabbitmq I am now attempting to cluster them.??When I got to the first step in the http://www.rabbitmq.com/clustering.html, it told me to start rabbitmq in the normal way:
>  > rabbitmq-server -detached
>  >
>  > From what I can see, this isn't how its normally started if I am running in single node mode, as it behaves differently.
>  >
>  > In order to get the service approach to work correctly, I modified rabbitmq-server in /etc/init.d as follows:
>  > [root at cluster1 init.d]# diff rabbitmq-server.20130501 rabbitmq-server
>  > 63c63
>  > <???????? RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON \
>  > ---
>  >>????????RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
>  > [root at cluster1 init.d]#
>  >
>  > I changed it there because DAEMON appears to be the rabbitmq-server
>  >
>  > [root at cluster1 init.d]# grep DAEMON rabbitmq-server
>  > DAEMON=/usr/sbin/${NAME}
>  > test -x $DAEMON || exit 0
>  >????????RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
>  > [root at cluster1 init.d]#
>  >
>  > When I performed service rabbitmq-server start
>  >
>  > It just hung and never came back with a prompt.
>  >
>  > However in another window I confirmed the rabbitmq-server was running
>  >
>  > I then killed the service console window and looked at the startup_err file:
>  > [root at cluster1 init.d]# more /var/log/rabbitmq/startup_err
>  > Warning: PID file not written; -detached was passed.
>  >
>  > and then i had to separately kill the process(s) associated with rabbitmq.
>  >
>  > so my questions are thus:
>  >?? 1) the documentation states this is how to normally start the server.??Is that normally for all modes or just for a clustered node approach?
>  >?? 2) What can I do to keep the command from hanging if started as a service???
>  >
>  >
>  >
>  >> -------Original Message-------
>  >> From: Gerald Kuch <jkuch at gopivotal.com>
>  >> To: srd <srd at duneram.com>, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  >> Subject: Re: [rabbitmq-discuss] another question on cookies version 3.0.4
>  >> Sent: 01 May '13 19:52
>  >>
>  >> Ooops, my fingers auto-completed the "/etc/init.d" on the end of the
>  >> sentence.??Forget about that part.
>  >>
>  >>
>  >> On Wed, May 1, 2013 at 12:51 PM, Gerald Kuch <[LINK:
>  >> mailto:jkuch at gopivotal.com] jkuch at gopivotal.com> wrote:
>  >>
>  >> Depends how you started it:??Either /sbin/service/rabbitmq-server stop or
>  >> /etc/init.d/.
>  >>
>  >>
>  >> Of course 'kill' will stop it, but the cleanliness of doing the
>  >> former is preferable in non-emergency circumstances.
>  >>
>  >>
>  >> On Wed, May 1, 2013 at 6:26 AM, srd <[LINK: mailto:srd at duneram.com]
>  >> srd at duneram.com> wrote:
>  >> Thank you for your help.??I will give this a try.
>  >>
>  >> I've been starting it wrong all this time.
>  >>
>  >> what is the best way to stop the server???up until now I have found no
>  >> good way to stop it except
>  >>
>  >> ps -efwww | grep rabbit
>  >> and then with that kill off the 4-6 associated jobs.
>  >>
>  >> Dave
>  >>
>  >>
>  >>>??-------Original Message-------
>  >>>??From: Tim Watson <[LINK: mailto:tim at rabbitmq.com] tim at rabbitmq.com>
>  >>>??To: srd <[LINK: mailto:srd at duneram.com] srd at duneram.com>, Discussions
>  >> about RabbitMQ <[LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>  >> rabbitmq-discuss at lists.rabbitmq.com>
>  >>>??Subject: Re: [rabbitmq-discuss] another question on cookies version
>  >> 3.0.4
>  >>>??Sent: 01 May '13 13:21
>  >>>
>  >>>??Hi,
>  >>>
>  >>>??On 1 May 2013, at 14:15, srd wrote:
>  >>>
>  >>>??> so my questions are:
>  >>>??> 1) How does one normally start the server?
>  >>>
>  >>>??Depending on the platform, either /sbin/service rabbitmq-server start
>  >> or via /etc/init.d/.
>  >>>
>  >>>??> 2) my reason for wanting to do cookies is I wanted to setup a multi
>  >> node cluster (different servers)
>  >>>??>????If I start a server (no parameters) on each server the cookie
>  >> hash is different.
>  >>>
>  >>>??You need to ensure that all the cookies are the same. You can do this
>  >> by placing the .erlang.cookie file in the /home/rabbitmq directory on each
>  >> server.
>  >>>
>  >>>??> 3) I have looked at the clustering guide but haven't succeeded
>  >> in a setup using it.??How does one normally synchronize the cookies
>  >> across servers?
>  >>>
>  >>>??That's up to you - rabbit doesn't provide anything out of the
>  >> box to do this.
>  >>>
>  >>>??> 4) where is the cookie file stored??? I found one on the rabbitmq
>  >> user's root directory.?? Is that where it is stored?
>  >>>
>  >>>??That's correct.
>  >>>
>  >>>??> 5) If I have to set a cookie value, is there a config file where it
>  >> can be set (or env variable?) and what is the syntax to set it?
>  >>>??>
>  >>>
>  >>>??I would recommend just using the cookie stored in the rabbitmq
>  >> user's home directory.
>  >>>
>  >>>??Cheers,
>  >>>??Tim
>  >> _______________________________________________
>  >> rabbitmq-discuss mailing list
>  >> [LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>  >> rabbitmq-discuss at lists.rabbitmq.com
>  >> [LINK:
>  >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss]
>  >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  > _______________________________________________
>  > rabbitmq-discuss mailing list
>  > rabbitmq-discuss at lists.rabbitmq.com
>  > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  

From srd at duneram.com  Wed May  1 21:49:18 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Wed, 01 May 2013 20:49:18 +0000
Subject: [rabbitmq-discuss] =?iso-8859-1?q?clustering_--_detached?=
In-Reply-To: <C46BDAE3-0A7A-452E-9782-90B23A19E879@rbcon.com>
References: <20130501131501.12975.qmail@hoster904.com>
	<860FC823-A128-4F08-82EF-10499A576BBF@rabbitmq.com>
	<20130501132635.27511.qmail@hoster904.com>
	<CANOx8Nmgop3RxNsQ3gpgT+R=Q-jurjAT=etqd2qTHd1DXWmxDw@mail.gmail.com>
	<CANOx8N=aQ4xyAq8+x3YxWebZ1EZm3ucx-PbQtONnrkqn-f_FjQ@mail.gmail.com>
	<20130501203117.7302.qmail@hoster904.com>
	<C46BDAE3-0A7A-452E-9782-90B23A19E879@rbcon.com>
Message-ID: <20130501204918.26866.qmail@hoster904.com>

thanks I'll take a look.


>  -------Original Message-------
>  From: Jerry Kuch <jerryk at rbcon.com>
>  To: srd <srd at duneram.com>, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  Subject: Re: [rabbitmq-discuss] clustering -- detached
>  Sent: 01 May '13 20:37
>  
>  IIRC that tutorial isn't suggesting you need to start rabbit that way on your clustered nodes. If you have bona fide, separate machines running brokers, start them the recommended way for that platform. Make sure Erlang cookies are properly common to the user accounts the brokers run under and that the same cookie is used by the invoker of rabbitmqctl when you issue the clustering commands.
>  
>  Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).
>  
>  
>  On May 1, 2013, at 1:31 PM, "srd" <srd at duneram.com> wrote:
>  
>  > Now that I have my 2 servers setup with rabbitmq I am now attempting to cluster them.??When I got to the first step in the http://www.rabbitmq.com/clustering.html, it told me to start rabbitmq in the normal way:
>  > rabbitmq-server -detached
>  >
>  > From what I can see, this isn't how its normally started if I am running in single node mode, as it behaves differently.
>  >
>  > In order to get the service approach to work correctly, I modified rabbitmq-server in /etc/init.d as follows:
>  > [root at cluster1 init.d]# diff rabbitmq-server.20130501 rabbitmq-server
>  > 63c63
>  > <???????? RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON \
>  > ---
>  >>????????RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
>  > [root at cluster1 init.d]#
>  >
>  > I changed it there because DAEMON appears to be the rabbitmq-server
>  >
>  > [root at cluster1 init.d]# grep DAEMON rabbitmq-server
>  > DAEMON=/usr/sbin/${NAME}
>  > test -x $DAEMON || exit 0
>  >????????RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
>  > [root at cluster1 init.d]#
>  >
>  > When I performed service rabbitmq-server start
>  >
>  > It just hung and never came back with a prompt.
>  >
>  > However in another window I confirmed the rabbitmq-server was running
>  >
>  > I then killed the service console window and looked at the startup_err file:
>  > [root at cluster1 init.d]# more /var/log/rabbitmq/startup_err
>  > Warning: PID file not written; -detached was passed.
>  >
>  > and then i had to separately kill the process(s) associated with rabbitmq.
>  >
>  > so my questions are thus:
>  >?? 1) the documentation states this is how to normally start the server.??Is that normally for all modes or just for a clustered node approach?
>  >?? 2) What can I do to keep the command from hanging if started as a service???
>  >
>  >
>  >
>  >> -------Original Message-------
>  >> From: Gerald Kuch <jkuch at gopivotal.com>
>  >> To: srd <srd at duneram.com>, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  >> Subject: Re: [rabbitmq-discuss] another question on cookies version 3.0.4
>  >> Sent: 01 May '13 19:52
>  >>
>  >> Ooops, my fingers auto-completed the "/etc/init.d" on the end of the
>  >> sentence.??Forget about that part.
>  >>
>  >>
>  >> On Wed, May 1, 2013 at 12:51 PM, Gerald Kuch <[LINK:
>  >> mailto:jkuch at gopivotal.com] jkuch at gopivotal.com> wrote:
>  >>
>  >> Depends how you started it:??Either /sbin/service/rabbitmq-server stop or
>  >> /etc/init.d/.
>  >>
>  >>
>  >> Of course 'kill' will stop it, but the cleanliness of doing the
>  >> former is preferable in non-emergency circumstances.
>  >>
>  >>
>  >> On Wed, May 1, 2013 at 6:26 AM, srd <[LINK: mailto:srd at duneram.com]
>  >> srd at duneram.com> wrote:
>  >> Thank you for your help.??I will give this a try.
>  >>
>  >> I've been starting it wrong all this time.
>  >>
>  >> what is the best way to stop the server???up until now I have found no
>  >> good way to stop it except
>  >>
>  >> ps -efwww | grep rabbit
>  >> and then with that kill off the 4-6 associated jobs.
>  >>
>  >> Dave
>  >>
>  >>
>  >>>??-------Original Message-------
>  >>>??From: Tim Watson <[LINK: mailto:tim at rabbitmq.com] tim at rabbitmq.com>
>  >>>??To: srd <[LINK: mailto:srd at duneram.com] srd at duneram.com>, Discussions
>  >> about RabbitMQ <[LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>  >> rabbitmq-discuss at lists.rabbitmq.com>
>  >>>??Subject: Re: [rabbitmq-discuss] another question on cookies version
>  >> 3.0.4
>  >>>??Sent: 01 May '13 13:21
>  >>>
>  >>>??Hi,
>  >>>
>  >>>??On 1 May 2013, at 14:15, srd wrote:
>  >>>
>  >>>??> so my questions are:
>  >>>??> 1) How does one normally start the server?
>  >>>
>  >>>??Depending on the platform, either /sbin/service rabbitmq-server start
>  >> or via /etc/init.d/.
>  >>>
>  >>>??> 2) my reason for wanting to do cookies is I wanted to setup a multi
>  >> node cluster (different servers)
>  >>>??>????If I start a server (no parameters) on each server the cookie
>  >> hash is different.
>  >>>
>  >>>??You need to ensure that all the cookies are the same. You can do this
>  >> by placing the .erlang.cookie file in the /home/rabbitmq directory on each
>  >> server.
>  >>>
>  >>>??> 3) I have looked at the clustering guide but haven't succeeded
>  >> in a setup using it.??How does one normally synchronize the cookies
>  >> across servers?
>  >>>
>  >>>??That's up to you - rabbit doesn't provide anything out of the
>  >> box to do this.
>  >>>
>  >>>??> 4) where is the cookie file stored??? I found one on the rabbitmq
>  >> user's root directory.?? Is that where it is stored?
>  >>>
>  >>>??That's correct.
>  >>>
>  >>>??> 5) If I have to set a cookie value, is there a config file where it
>  >> can be set (or env variable?) and what is the syntax to set it?
>  >>>??>
>  >>>
>  >>>??I would recommend just using the cookie stored in the rabbitmq
>  >> user's home directory.
>  >>>
>  >>>??Cheers,
>  >>>??Tim
>  >> _______________________________________________
>  >> rabbitmq-discuss mailing list
>  >> [LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>  >> rabbitmq-discuss at lists.rabbitmq.com
>  >> [LINK:
>  >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss]
>  >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  > _______________________________________________
>  > rabbitmq-discuss mailing list
>  > rabbitmq-discuss at lists.rabbitmq.com
>  > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  

From rev.chip at gmail.com  Wed May  1 23:40:40 2013
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Wed, 1 May 2013 15:40:40 -0700
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <5180F745.6090307@rabbitmq.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
	<5180F745.6090307@rabbitmq.com>
Message-ID: <CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>

I am using a modified AnyEvent::RabbitMQ Perl module (the standard one does
not advertise its willingness to receive channel cancellations).  The
module is event-driven; its input handler is not dependent on application
logic, and is where I'm getting my frame dumps; and the module continues to
send heartbeat frames even after other events stop.  Also, as an
experiment, I arranged to send a CancelOk and got an error response (which
was printed correctly).  So I do not believe the client is "hanging" in any
sense.

Does the Java automated test of close-after-cancel-notification expect a
CloseOk?  Does it get one?

How do you suggest dumping the frame traffic without depending on the
suspect client module?


On Wed, May 1, 2013 at 4:06 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 01/05/13 05:16, Chip Salzenberg wrote:
>
>> I've successfully used the optional server feature of sending a
>> basic.cancel when a consumed queue is deleted.  Great.  But a reasonable
>> thing to do at that point is to close the channel, right?  But when I
>> send a channel.close in that circumstance, RMQ 3.0.4 does not send a
>> close-ok.  It doesn't send anything.  This makes my app hang.  I have to
>> cheat and ass_u_me that the channel is closed in order to keep working.
>>
>
> Well that definitely sounds wrong.
>
> (Bear in mind that the channel is not damaged by this, you don't have to
> close it if you don't want to. But I can see you might want to.)
>
>
>  Am I doing something wrong?  Is this a server bug?  Both?  :)
>>
>
> I doubt it's a server bug; we have an automated test which closes a
> channel after receiving a cancel notification. But Steve points out the way
> in which the Java client could trip you up. In previous mails I think you
> mentioned using the Perl client; possibly it has a similar limitation in
> callbacks?
>
> If not, please post some example code and I will look into it.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/367f6a15/attachment.htm>

From rev.chip at gmail.com  Wed May  1 23:42:52 2013
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Wed, 1 May 2013 15:42:52 -0700
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
	<5180F745.6090307@rabbitmq.com>
	<CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
Message-ID: <CANSL5VEy8AppF6YE2bS366FRsV0MifpU3qD4Rf22jtmf_jqGHA@mail.gmail.com>

> (Bear in mind that the channel is not damaged by this, you don't have to
close it if you don't want to. But I can see you might want to.)

The decision to close the channel is for symmetry with the "consume"
method, which closes the channel if it fails.


On Wed, May 1, 2013 at 3:40 PM, Chip Salzenberg <rev.chip at gmail.com> wrote:

> I am using a modified AnyEvent::RabbitMQ Perl module (the standard one
> does not advertise its willingness to receive channel cancellations).  The
> module is event-driven; its input handler is not dependent on application
> logic, and is where I'm getting my frame dumps; and the module continues to
> send heartbeat frames even after other events stop.  Also, as an
> experiment, I arranged to send a CancelOk and got an error response (which
> was printed correctly).  So I do not believe the client is "hanging" in any
> sense.
>
> Does the Java automated test of close-after-cancel-notification expect a
> CloseOk?  Does it get one?
>
> How do you suggest dumping the frame traffic without depending on the
> suspect client module?
>
>
> On Wed, May 1, 2013 at 4:06 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 01/05/13 05:16, Chip Salzenberg wrote:
>>
>>> I've successfully used the optional server feature of sending a
>>> basic.cancel when a consumed queue is deleted.  Great.  But a reasonable
>>> thing to do at that point is to close the channel, right?  But when I
>>> send a channel.close in that circumstance, RMQ 3.0.4 does not send a
>>> close-ok.  It doesn't send anything.  This makes my app hang.  I have to
>>> cheat and ass_u_me that the channel is closed in order to keep working.
>>>
>>
>> Well that definitely sounds wrong.
>>
>> (Bear in mind that the channel is not damaged by this, you don't have to
>> close it if you don't want to. But I can see you might want to.)
>>
>>
>>  Am I doing something wrong?  Is this a server bug?  Both?  :)
>>>
>>
>> I doubt it's a server bug; we have an automated test which closes a
>> channel after receiving a cancel notification. But Steve points out the way
>> in which the Java client could trip you up. In previous mails I think you
>> mentioned using the Perl client; possibly it has a similar limitation in
>> callbacks?
>>
>> If not, please post some example code and I will look into it.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/f2f24d33/attachment.htm>

From doug at hacks.perl.sh  Thu May  2 03:08:10 2013
From: doug at hacks.perl.sh (Doug)
Date: Thu, 2 May 2013 10:08:10 +0800
Subject: [rabbitmq-discuss] create queues in the cluster
Message-ID: <CAJxbUuUCwzKxQBhSidTQ2nfDiW5e+-VTENWfJjOQgifXFaySkg@mail.gmail.com>

Hello,


From carl.hoerberg at gmail.com  Thu May  2 04:06:13 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 1 May 2013 20:06:13 -0700 (PDT)
Subject: [rabbitmq-discuss] STOMP default vhost
Message-ID: <1367463973020-26356.post@n5.nabble.com>

Feature request: I would like to be able to change the default vhost for the
STOMP plugin, in addition to default username/password. Today I think it
always default to / unless a host header is specified. 

Btw, any pointer in how to implement some kind of vhost rewriting, like for
instance I would like to support multiple vhosts with MQTT, possibly in the
way that all pub/sub has to start with the vhost name.. Same would be nice
for STOMP as the "host header" thing is kind of hackish for a lot of stomp
client libraries.. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/STOMP-default-vhost-tp26356.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Thu May  2 06:16:40 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 2 May 2013 09:16:40 +0400
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <CANSL5VEy8AppF6YE2bS366FRsV0MifpU3qD4Rf22jtmf_jqGHA@mail.gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
	<5180F745.6090307@rabbitmq.com>
	<CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
	<CANSL5VEy8AppF6YE2bS366FRsV0MifpU3qD4Rf22jtmf_jqGHA@mail.gmail.com>
Message-ID: <CAE3HoVQ8i5ife5N_FAbcDqq1JUzF9u50FKHB3ehKeok-W7fQKw@mail.gmail.com>

2013/5/2 Chip Salzenberg <rev.chip at gmail.com>

> The decision to close the channel is for symmetry with the "consume"
> method, which closes the channel if it fails.


When basic.consume fails, it is because you try to consume from a queue
that does not exist or the queue is exclusive
and owned by another connection. This raises a channel exception and that
causes the channel to be closed.

This is not specific to basic.consume but all channel exceptions. I
personally don't think making cancellation notifications
close a channel improves consistency. I'm not aware of other clients doing
this.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/cf2235f7/attachment.htm>

From theo at iconara.net  Thu May  2 06:44:51 2013
From: theo at iconara.net (Theo Hultberg)
Date: Thu, 2 May 2013 07:44:51 +0200
Subject: [rabbitmq-discuss] create queues in the cluster
In-Reply-To: <CAJxbUuUCwzKxQBhSidTQ2nfDiW5e+-VTENWfJjOQgifXFaySkg@mail.gmail.com>
References: <CAJxbUuUCwzKxQBhSidTQ2nfDiW5e+-VTENWfJjOQgifXFaySkg@mail.gmail.com>
Message-ID: <CAMR1f-eaGTw9ejhcBc01XLP01JPpD32GapMogOu8a7isVrTWRQ@mail.gmail.com>

Queues are created on the node you're connected to when you create the
queue.

T#


On Thu, May 2, 2013 at 4:08 AM, Doug <doug at hacks.perl.sh> wrote:

> Hello,
>
> From the rabbitmq in action book:
>
> The minute you join one node to another to form a cluster something
> dramatically changes: not every node has a full copy of every queue.
> In a single node setup all of the information about a queue (metadata,
> state, and contents) is fully stored in that node (Figure 5.1).
> However, in a cluster when you create queues, the cluster only creates
> the full information about the queue (metadata, state, contents) on a
> single node in the cluster rather than on all of them (the cluster
> tries to evenly distribute queue creation amongst the nodes). The
> result is that only the ?owner? node for a queue knows the full
> information about that queue. All of the ?non-owner? nodes only know
> the queue?s metadata and a pointer to the node where the queue
> actually lives. So when a cluster node dies that node?s queues and
> associated bindings disappear. Consumers attached to those queues lose
> their subscriptions, and any new messages that would have matched that
> queue?s bindings become blackholed.
>
>
> Does this mean, when a client create a queue in the cluster, this
> queue is created on a random(?) node of the cluster, not the connected
> node  for the client?
>
> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/4322f715/attachment.htm>

From michael.s.klishin at gmail.com  Thu May  2 08:24:51 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 2 May 2013 11:24:51 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.0.2 is released
Message-ID: <CAE3HoVSkB8PYq3y7jW4wBFFfP6wOoVPT4fvjb6qqgH8ddDmwWA@mail.gmail.com>

amqp gem 1.0.2 [1] is released to rubygems.org.

This is a bug fix release. Release notes:
http://blog.rubyrabbitmq.info/blog/2013/05/02/amqp-gem-1-dot-0-2-is-released/

1. https://rubygems.org/gems/amqp/versions/1.0.2
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/2ba0d628/attachment.htm>

From michael.s.klishin at gmail.com  Thu May  2 08:41:00 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 2 May 2013 11:41:00 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre10 is released
Message-ID: <CAE3HoVQmCP8AUYpA-M9-0+R7hTduG3dds1xwBMdVQGNPAqv7gg@mail.gmail.com>

Bunny 0.9.0.pre10 [1] is released to rubygems.org.

This is a stability improvements release that has **one breaking API
change**.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/05/02/bunny-0-dot-9-0-dot-pre10-is-released/

1. https://rubygems.org/gems/bunny/versions/0.9.0.pre10
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/8fd52944/attachment.htm>

From doug at hacks.perl.sh  Thu May  2 09:31:25 2013
From: doug at hacks.perl.sh (Doug)
Date: Thu, 2 May 2013 16:31:25 +0800
Subject: [rabbitmq-discuss] create queues in the cluster
In-Reply-To: <CAMR1f-eaGTw9ejhcBc01XLP01JPpD32GapMogOu8a7isVrTWRQ@mail.gmail.com>
References: <CAJxbUuUCwzKxQBhSidTQ2nfDiW5e+-VTENWfJjOQgifXFaySkg@mail.gmail.com>
	<CAMR1f-eaGTw9ejhcBc01XLP01JPpD32GapMogOu8a7isVrTWRQ@mail.gmail.com>
Message-ID: <CAJxbUuVZASv5xgEfhNXm58s_GavF5Ru-uDwhTTdWEme5WVge-w@mail.gmail.com>

But the book says:

the cluster tries to evenly distribute queue creation amongst the nodes

it seems the cluster creates the queue on a random node?

Thanks.

2013/5/2 Theo Hultberg <theo at iconara.net>:
> Queues are created on the node you're connected to when you create the
> queue.
>
> T#
>
>
> On Thu, May 2, 2013 at 4:08 AM, Doug <doug at hacks.perl.sh> wrote:
>>
>> Hello,
>>
>> From the rabbitmq in action book:
>>
>> The minute you join one node to another to form a cluster something
>> dramatically changes: not every node has a full copy of every queue.
>> In a single node setup all of the information about a queue (metadata,
>> state, and contents) is fully stored in that node (Figure 5.1).
>> However, in a cluster when you create queues, the cluster only creates
>> the full information about the queue (metadata, state, contents) on a
>> single node in the cluster rather than on all of them (the cluster
>> tries to evenly distribute queue creation amongst the nodes). The
>> result is that only the ?owner? node for a queue knows the full
>> information about that queue. All of the ?non-owner? nodes only know
>> the queue?s metadata and a pointer to the node where the queue
>> actually lives. So when a cluster node dies that node?s queues and
>> associated bindings disappear. Consumers attached to those queues lose
>> their subscriptions, and any new messages that would have matched that
>> queue?s bindings become blackholed.
>>
>>
>> Does this mean, when a client create a queue in the cluster, this
>> queue is created on a random(?) node of the cluster, not the connected
>> node  for the client?
>>
>> Thanks.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From doug at hacks.perl.sh  Thu May  2 09:35:22 2013
From: doug at hacks.perl.sh (Doug)
Date: Thu, 2 May 2013 16:35:22 +0800
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre10 is released
In-Reply-To: <CAE3HoVQmCP8AUYpA-M9-0+R7hTduG3dds1xwBMdVQGNPAqv7gg@mail.gmail.com>
References: <CAE3HoVQmCP8AUYpA-M9-0+R7hTduG3dds1xwBMdVQGNPAqv7gg@mail.gmail.com>
Message-ID: <CAJxbUuX7mY9iBtPgQ5X63PWveJn6TC9V=VLC1G4Q52RXfv7mZg@mail.gmail.com>

Thanks. I enjoy the bunny implement for MQ.

2013/5/2 Michael Klishin <michael.s.klishin at gmail.com>:
> Bunny 0.9.0.pre10 [1] is released to rubygems.org.
>
> This is a stability improvements release that has **one breaking API
> change**.
>
> Release notes:
> http://blog.rubyrabbitmq.info/blog/2013/05/02/bunny-0-dot-9-0-dot-pre10-is-released/
>
> 1. https://rubygems.org/gems/bunny/versions/0.9.0.pre10
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From yhpeng at orange.fr  Thu May  2 09:52:09 2013
From: yhpeng at orange.fr (Ken Peng)
Date: Thu, 02 May 2013 16:52:09 +0800
Subject: [rabbitmq-discuss] Queue increases too quickly
Message-ID: <51822939.5040409@orange.fr>

Hello,

We have the queue publisher and subscriber, the subscriber is going with 
multi-threads.

The problem is the queue has been increasing too quickly, the consumers 
can not follow the increment speed, as you see:

root at ubuntu:~#  for i in `seq 1 10`;do rabbitmqctl list_queues -p 
/actionlog;sleep 1;done
Listing queues ...
queue_storm_actionlog   12665787
...done.
Listing queues ...
queue_storm_actionlog   12670873
...done.
Listing queues ...
queue_storm_actionlog   12667975
...done.
Listing queues ...
queue_storm_actionlog   12672645
...done.


After one day or about, the queue size can be more than 20 millions, 
thus RabbitMQ becomes high load and the consuming process is very slow.

How to handle this? Thanks.

From michael.s.klishin at gmail.com  Thu May  2 09:58:14 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 2 May 2013 12:58:14 +0400
Subject: [rabbitmq-discuss] Queue increases too quickly
In-Reply-To: <51822939.5040409@orange.fr>
References: <51822939.5040409@orange.fr>
Message-ID: <CAE3HoVQ6Au9phE8ht6WTfm7h9pR5wsZtiJSqOUJZTVL27Qomwg@mail.gmail.com>

2013/5/2 Ken Peng <yhpeng at orange.fr>

> How to handle this? Thanks.


Increase # of throughput of consumers or reduce publishing rate. If
consumers cannot
catch up, hardware upgrades will only offset the moment when systems starts
running
low on resources.

If messages can be lost, 3.1 introduces a new feature, queue length limit:
http://www.rabbitmq.com/maxlength.html

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/61fcaf37/attachment.htm>

From tim at rabbitmq.com  Thu May  2 10:00:20 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 2 May 2013 10:00:20 +0100
Subject: [rabbitmq-discuss] Queue increases too quickly
In-Reply-To: <51822939.5040409@orange.fr>
References: <51822939.5040409@orange.fr>
Message-ID: <1F41E28B-FFCD-4071-AF44-133FC1B5E492@rabbitmq.com>

Hi,

On 2 May 2013, at 09:52, Ken Peng wrote:

> Hello,
> 
> We have the queue publisher and subscriber, the subscriber is going with multi-threads.
> 
> The problem is the queue has been increasing too quickly, the consumers can not follow the increment speed, as you see:
[snip]
> After one day or about, the queue size can be more than 20 millions, thus RabbitMQ becomes high load and the consuming process is very slow.
> 
> How to handle this? Thanks.
> ___

You'll need to consume faster. :)

Maybe using a prefetch count to take a block of messages in each consumer and would help a bit, although they're not going to actually 'disappear' from rabbit until they've been ACKed.

From emile at rabbitmq.com  Thu May  2 10:15:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 02 May 2013 10:15:40 +0100
Subject: [rabbitmq-discuss] Queue increases too quickly
In-Reply-To: <CAE3HoVQ6Au9phE8ht6WTfm7h9pR5wsZtiJSqOUJZTVL27Qomwg@mail.gmail.com>
References: <51822939.5040409@orange.fr>
	<CAE3HoVQ6Au9phE8ht6WTfm7h9pR5wsZtiJSqOUJZTVL27Qomwg@mail.gmail.com>
Message-ID: <51822EBC.5040806@rabbitmq.com>

On 02/05/13 09:58, Michael Klishin wrote:
> If messages can be lost, 3.1 introduces a new feature, queue length limit:
> http://www.rabbitmq.com/maxlength.html

Further to the suggestion of imposing a maximum queue length, you could
also consider imposing a maximum message age and instruct the broker to
discard messages that become stale: http://www.rabbitmq.com/ttl.html


-Emile






From simon at rabbitmq.com  Thu May  2 10:39:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 May 2013 10:39:30 +0100
Subject: [rabbitmq-discuss] STOMP default vhost
In-Reply-To: <1367463973020-26356.post@n5.nabble.com>
References: <1367463973020-26356.post@n5.nabble.com>
Message-ID: <51823452.7020301@rabbitmq.com>

On 02/05/13 04:06, carlhoerberg wrote:
> Feature request: I would like to be able to change the default vhost for the
> STOMP plugin, in addition to default username/password. Today I think it
> always default to / unless a host header is specified.

The STOMP adapter will read the 'default_vhost' configuration item from 
the 'rabbit' application, so you can override this.

> Btw, any pointer in how to implement some kind of vhost rewriting, like for
> instance I would like to support multiple vhosts with MQTT, possibly in the
> way that all pub/sub has to start with the vhost name.. Same would be nice
> for STOMP as the "host header" thing is kind of hackish for a lot of stomp
> client libraries..

Hmm. The trouble is that the vhost is really part of the login details. 
Not to say this is impossible, but it might be quite fiddly and weird 
acting. TBH I would rather the client libraries made it less hackish :)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From yhpeng at orange.fr  Thu May  2 10:42:52 2013
From: yhpeng at orange.fr (Ken Peng)
Date: Thu, 02 May 2013 17:42:52 +0800
Subject: [rabbitmq-discuss] Queue increases too quickly
In-Reply-To: <51822EBC.5040806@rabbitmq.com>
References: <51822939.5040409@orange.fr>
	<CAE3HoVQ6Au9phE8ht6WTfm7h9pR5wsZtiJSqOUJZTVL27Qomwg@mail.gmail.com>
	<51822EBC.5040806@rabbitmq.com>
Message-ID: <5182351C.9010408@orange.fr>

Thanks for all the kind helps.


> On 02/05/13 09:58, Michael Klishin wrote:
>> >If messages can be lost, 3.1 introduces a new feature, queue length limit:
>> >http://www.rabbitmq.com/maxlength.html
> Further to the suggestion of imposing a maximum queue length, you could
> also consider imposing a maximum message age and instruct the broker to
> discard messages that become stale:http://www.rabbitmq.com/ttl.html


From emile at rabbitmq.com  Thu May  2 10:42:07 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 02 May 2013 10:42:07 +0100
Subject: [rabbitmq-discuss] Consumer acknowledgements for very long
 running tasks
In-Reply-To: <CAE3HoVSOyAWWOuyVf7tKPZ1qcEbgNnht7adsQRpCjF84QRjgpw@mail.gmail.com>
References: <1367433290054-26341.post@n5.nabble.com>
	<CAE3HoVSOyAWWOuyVf7tKPZ1qcEbgNnht7adsQRpCjF84QRjgpw@mail.gmail.com>
Message-ID: <518234EF.7050502@rabbitmq.com>


On 01/05/13 20:33, Michael Klishin wrote:
> 2013/5/1 ranjitiyer <ranjitiyer at gmail.com <mailto:ranjitiyer at gmail.com>>
> 
>     Is there a corner case in which because acks haven't been received for a
>     very long time, msgs are either automatically redelivered or 'considered
>     consumed'?
> 
> AFAIK there are no limitations on how long the broker will wait for 
> acks, but if you use queue TTL, it may affect your case.

Further to what Michael says, queue TTL only applies when a queue is
unused. In this case a consumer will exist while the message remains
unacknowledged so the queue will not be unused and queue TTL does not
come into play.

http://www.rabbitmq.com/ttl.html#queue-ttl

Network interruptions will cause the unacknowledged message to be
returned to the queue. Over a period of a month this becomes a real
possibility.




-Emile








From simon at rabbitmq.com  Thu May  2 10:49:09 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 May 2013 10:49:09 +0100
Subject: [rabbitmq-discuss] create queues in the cluster
In-Reply-To: <CAJxbUuVZASv5xgEfhNXm58s_GavF5Ru-uDwhTTdWEme5WVge-w@mail.gmail.com>
References: <CAJxbUuUCwzKxQBhSidTQ2nfDiW5e+-VTENWfJjOQgifXFaySkg@mail.gmail.com>
	<CAMR1f-eaGTw9ejhcBc01XLP01JPpD32GapMogOu8a7isVrTWRQ@mail.gmail.com>
	<CAJxbUuVZASv5xgEfhNXm58s_GavF5Ru-uDwhTTdWEme5WVge-w@mail.gmail.com>
Message-ID: <51823695.1050608@rabbitmq.com>

On 02/05/13 09:31, Doug wrote:
> But the book says:
>
> the cluster tries to evenly distribute queue creation amongst the nodes
>
> it seems the cluster creates the queue on a random node?

No, the book is wrong (or at least misleading). The queue is created on 
the node the client is connected to[1]. I think what the book is trying 
to say is that the reason this happens is so that queues have a decent 
chance of being distributed, if you assume that clients connect randomly 
to cluster nodes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Thu May  2 11:09:43 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 May 2013 11:09:43 +0100
Subject: [rabbitmq-discuss] STOMP default vhost
In-Reply-To: <51823452.7020301@rabbitmq.com>
References: <1367463973020-26356.post@n5.nabble.com>
	<51823452.7020301@rabbitmq.com>
Message-ID: <51823B67.109@rabbitmq.com>

On 02/05/13 10:39, Simon MacMullen wrote:
> On 02/05/13 04:06, carlhoerberg wrote:
>> Feature request: I would like to be able to change the default
>> vhost for the STOMP plugin, in addition to default
>> username/password. Today I think it always default to / unless a
>> host header is specified.
>
> The STOMP adapter will read the 'default_vhost' configuration item from
> the 'rabbit' application, so you can override this.

Beware though, that value determines which vhost rabbit will create when 
it starts up for the first time / after the db has been wiped.

The default vhost for stomp connections should really be configurable 
separately. I have raised a bug for that.

Matthias.

From jon.bergli.heier at zisson.no  Thu May  2 11:29:42 2013
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Thu, 2 May 2013 10:29:42 +0000
Subject: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA85F36B94@osl02-exc-001>

Hello, after upgrading to RabbitMQ 3.1.0 my shovels doesn't seem to reconnect automatically. I don't have reconnect_delay set, so I'm assuming they should use the default, which is 5 seconds according to the shovel docs (http://www.rabbitmq.com/shovel.html). The shovels are on non-clustered brokers, connecting to a two-node cluster.

Jon

From simlu at su.se  Thu May  2 11:44:27 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Thu, 2 May 2013 12:44:27 +0200
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <517FCDAE.60407@rabbitmq.com>
References: <B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
	<20130215141243.GB2924@kaka.it.su.se>
	<5124F224.1090903@rabbitmq.com>
	<20130221134043.GK2924@kaka.it.su.se>
	<20130429112426.GC391@kaka.it.su.se>
	<517E958C.4030007@rabbitmq.com>
	<20130430085206.GD391@kaka.it.su.se>
	<20130430100709.GF391@kaka.it.su.se> <517FCDAE.60407@rabbitmq.com>
Message-ID: <20130502104427.GG391@kaka.it.su.se>

On Tue, 2013-04-30 at 14:57:02 +0100, Simon MacMullen wrote:
> On 30/04/13 11:07, Simon Lundstr?m wrote:
> >Hm, I'm experiencing some weirdness now that I didn't before. I'm sure
> >I'm to blame but I belive I have checked all configuration parameters.
> >
> >In rabbitmq.config I've made sure that RabbitMQ uses my plugin:
> >{auth_backends, [rabbit_auth_backend_kerberos, rabbit_auth_backend_internal]},
> 
> Are you absolutely sure about this? The broker really will just try
> the backends in order, and only the last module's {refused, _, _}
> will be returned.

The only thing I'm sure about is that I'm a moron. XP

I had misenterpreted the Erlang NIF documentation about binaries, see
<http://www.erlang.org/doc/man/erl_nif.html#id178259> headline Binaries.

"Both data and size are read-only and should only be written using calls
to API functions."

My interpretation: The pointers are pointing to a copy of the binaries
in Erlang and are thus read-only since they cannot change what the
actual value is in Erlang.

The correct interpretation: They are pointers to the actual data in
Erlang and should be handled as read-only but nothing enforces this (and
if you change them in your NIF they get changed in Erlang, so much for
immutable obejcts ; P).

So since rabbit_auth_backend_kerberos is always run before
rabbit_auth_backend_internal and my NIF code does this
<https://github.com/simmel/rabbitmq-auth-backend-kerberos/blob/71cffb/c_src/kinit.c#L59-L61>
and overwrites the password that exists in Erlang with NULLs when
rabbit_auth_backend_internal tries to authenticate the user with said
password, it doesn't match...

Thanks for your invaluable help, as always!

Br,
- Simon

From jesper.louis.andersen at gmail.com  Thu May  2 12:27:37 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Thu, 2 May 2013 13:27:37 +0200
Subject: [rabbitmq-discuss] Proposal: Change consumers Round-Robin behaviour
Message-ID: <CAGrdgiUUMXqOni+29xGu8QwcmQjUwg_1dbe25iroPKgB3UKOhQ@mail.gmail.com>

Hi,

Assume we have two hosts, red and green, each running 10 consumers on the
same queue. Inside `rabbit_amqqueue_process` these consumers will be placed
in a standard Erlang `queue` module and wait for jobs to arrive. If all the
20 consumers are busy all the time, there is no problems here at all. But
if there are more consumers than messages in the queue the consumers will
sit idle and wait.

There are a couple of reasons to have idle workers, the most important
being you want to handle sudden message spikes for instance. Now, we would
like the host consumers to be interleaved in the queue:

RGRGRGRG,...

But in practice, since it is a queue, this may not be the case. We could
have something along the lines of

RRRRRRRGGGGGGG,...

which means that if requests arrive slowly, they will only be processed by
the Red host for a while and then only be processed by the Green host for a
while. If the hosts are different in nature, it is very likely that over
time, there will be clusters formed in the queue like this.

A way to alleviate this is to check for the following conditions whenever
we have "run" the queue:

1. There are no more messages (queue is empty)
2. There are active consumers waiting (active_consumers is not empty)

When this happens, we pick a random consumer in the queue and move him to
the front. Over time, this "shuffles" the queue into a random order. It is
also not going to cost anything on the critical path since we only do it
when we have an empty queue and excess workers. And we are going to do very
little work unless the queue has a behaviour where it empties often in
which case you get full random distribution on the consumers with this
scheme.

The background for the proposal is that Round-robin distribution of
messages often tend to bad behaviour over time. By adding a bit of
randomness to the process, we automatically alleviate a number of
determinism-problems and get better distribution of messages over
consumers. One could also imagine different distribution schemes, but those
will be more expensive in practice compared to this proposal, which should
only have a cost when the queue is not under heavy load.

* Did I miss anything?
* Is this a good or bad idea? And why?
* Do we break any rules w.r.t. AMQP by implementing this?
* Is priority on the queue going to be harder to implement? (I don't think
so, but...)

-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/3c63c29e/attachment.htm>

From simon at rabbitmq.com  Thu May  2 12:53:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 May 2013 12:53:41 +0100
Subject: [rabbitmq-discuss] Proposal: Change consumers Round-Robin
	behaviour
In-Reply-To: <CAGrdgiUUMXqOni+29xGu8QwcmQjUwg_1dbe25iroPKgB3UKOhQ@mail.gmail.com>
References: <CAGrdgiUUMXqOni+29xGu8QwcmQjUwg_1dbe25iroPKgB3UKOhQ@mail.gmail.com>
Message-ID: <518253C5.3020309@rabbitmq.com>

On 02/05/13 12:27, Jesper Louis Andersen wrote:
> Hi,

Hi.

<snip>

> When this happens, we pick a random consumer in the queue and move him
> to the front. Over time, this "shuffles" the queue into a random order.
> It is also not going to cost anything on the critical path since we only
> do it when we have an empty queue and excess workers.

Bear in mind that the "empty queue and excess workers" case *is* on the 
critical path for straight-through messaging (i.e. where the queue is on 
average empty and we are streaming messages through it as fast as possible).

> And we are going
> to do very little work unless the queue has a behaviour where it empties
> often in which case you get full random distribution on the consumers
> with this scheme.

Again, this is a common case for some users.

Also: quite a lot of people *want* round-robin behaviour here.

> The background for the proposal is that Round-robin distribution of
> messages often tend to bad behaviour over time. By adding a bit of
> randomness to the process, we automatically alleviate a number of
> determinism-problems and get better distribution of messages over
> consumers. One could also imagine different distribution schemes, but
> those will be more expensive in practice compared to this proposal,
> which should only have a cost when the queue is not under heavy load.
>
> * Did I miss anything?
> * Is this a good or bad idea? And why?
> * Do we break any rules w.r.t. AMQP by implementing this?
> * Is priority on the queue going to be harder to implement? (I don't
> think so, but...)

So I am not (yet) convinced. This would not violate the spec or make 
priorities harder to implement but I'm not convinced that the majority 
of users would see it as a step forward.

Does anybody who currently depends on round-robin want to speak up?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dave at nexttolast.com  Thu May  2 13:43:03 2013
From: dave at nexttolast.com (David Goehrig)
Date: Thu, 2 May 2013 08:43:03 -0400
Subject: [rabbitmq-discuss] Proposal: Change consumers Round-Robin
	behaviour
In-Reply-To: <518253C5.3020309@rabbitmq.com>
References: <CAGrdgiUUMXqOni+29xGu8QwcmQjUwg_1dbe25iroPKgB3UKOhQ@mail.gmail.com>
	<518253C5.3020309@rabbitmq.com>
Message-ID: <EC5EB703-D107-4552-A7CE-19B6DD404A2D@nexttolast.com>


On May 2, 2013, at 7:53 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Does anybody who currently depends on round-robin want to speak up?

My apps don't currently strictly rely upon round-robin, but scale better with it. I have found that you can avoid the RRRRGGGG behavior by managing your prefetch size and not acking too soon. 

In our app, our cluster gets huge spikes of traffic on a fixed period, and we need to evenly distribute the load across the worker cluster to keep up with realtime requirements. Round-robin in this case spreads the load better than a random distribution, as random only guarantees even distribution in the long run, where the long run is demonstrably too long for our update frequency. Since we know the volume of data and the amount of processing on each node, we can tune very accurately for cost. 

I've only tested with 10s-100s of consumers on a single queue. So YMMV. Though

From Michael.Laing at nytimes.com  Thu May  2 13:43:53 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 2 May 2013 08:43:53 -0400
Subject: [rabbitmq-discuss] Proposal: Change consumers Round-Robin
 behaviour
In-Reply-To: <518253C5.3020309@rabbitmq.com>
Message-ID: <CDA7D018.94E1%Michael.Laing@nytimes.com>

We often have empty queues. In fact we strive for that state.

We like the current round robin because it predictably exercises each
consumer on the queue. We monitor the processing history (region,
availability zone, instance, service, etc) of each message through the
messaging pipeline. The pipelines may involve multiple clusters and
federated links. Typically we process multiple replicas of the same
message through alternate regional pipelines that ultimately 'fan-in'.
Because of the round robin predictability we can very quickly find 'holes'
and slowdowns by comparing the histories of replicas at resolution time -
then take appropriate action, e.g. Terminate low-performing instances so
auto-scaling will add/cluster new ones.

Additionally we use certain queues to hold mutex tokens. For any one
token, multiple processes subscribe w ack and one of them gets it and does
its work, maybe sleeps for a while, and then nacks - the next process gets
the token and so on. Predictable, exercises each process in turn, and if a
process fails the next one picks up immediately.

Michael

On 5/2/13 7:53 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 02/05/13 12:27, Jesper Louis Andersen wrote:
>> Hi,
>
>Hi.
>
><snip>
>
>> When this happens, we pick a random consumer in the queue and move him
>> to the front. Over time, this "shuffles" the queue into a random order.
>> It is also not going to cost anything on the critical path since we only
>> do it when we have an empty queue and excess workers.
>
>Bear in mind that the "empty queue and excess workers" case *is* on the
>critical path for straight-through messaging (i.e. where the queue is on
>average empty and we are streaming messages through it as fast as
>possible).
>
>> And we are going
>> to do very little work unless the queue has a behaviour where it empties
>> often in which case you get full random distribution on the consumers
>> with this scheme.
>
>Again, this is a common case for some users.
>
>Also: quite a lot of people *want* round-robin behaviour here.
>
>> The background for the proposal is that Round-robin distribution of
>> messages often tend to bad behaviour over time. By adding a bit of
>> randomness to the process, we automatically alleviate a number of
>> determinism-problems and get better distribution of messages over
>> consumers. One could also imagine different distribution schemes, but
>> those will be more expensive in practice compared to this proposal,
>> which should only have a cost when the queue is not under heavy load.
>>
>> * Did I miss anything?
>> * Is this a good or bad idea? And why?
>> * Do we break any rules w.r.t. AMQP by implementing this?
>> * Is priority on the queue going to be harder to implement? (I don't
>> think so, but...)
>
>So I am not (yet) convinced. This would not violate the spec or make
>priorities harder to implement but I'm not convinced that the majority
>of users would see it as a step forward.
>
>Does anybody who currently depends on round-robin want to speak up?
>
>Cheers, Simon
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From michael.s.klishin at gmail.com  Thu May  2 13:58:59 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 2 May 2013 16:58:59 +0400
Subject: [rabbitmq-discuss] Proposal: Change consumers Round-Robin
	behaviour
In-Reply-To: <518253C5.3020309@rabbitmq.com>
References: <CAGrdgiUUMXqOni+29xGu8QwcmQjUwg_1dbe25iroPKgB3UKOhQ@mail.gmail.com>
	<518253C5.3020309@rabbitmq.com>
Message-ID: <CAE3HoVQQuZniobgMDvbSNNYQgHfLwWDgxunJ7mwfM60edH_vcw@mail.gmail.com>

2013/5/2 Simon MacMullen <simon at rabbitmq.com>

> Again, this is a common case for some users.



From tim at rabbitmq.com  Thu May  2 14:56:02 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 2 May 2013 14:56:02 +0100
Subject: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA85F36B94@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA85F36B94@osl02-exc-001>
Message-ID: <F774E37D-E49D-4766-8991-912111B8044F@rabbitmq.com>

On 2 May 2013, at 11:29, Jon Bergli Heier wrote:

> Hello, after upgrading to RabbitMQ 3.1.0 my shovels doesn't seem to reconnect automatically. I don't have reconnect_delay set, so I'm assuming they should use the default, which is 5 seconds according to the shovel docs (http://www.rabbitmq.com/shovel.html).

I've just checked and the default reconnect delay is still set to 5 seconds.

> The shovels are on non-clustered brokers, connecting to a two-node cluster.


Hmn. If the shovels were clustered then it's possible a named shovel's configuration from one node could override the other (due to the way in which individual shovel workers fail-over in 3.1), but you say they're not clustered. Hmn. I'll have a quick go at reproducing this, but AFAICT there's no reason they shouldn't be attempting to reconnect. Unless the reconnect_delay is being overridden somewhere?

Cheers,
Tim

From jon.bergli.heier at zisson.no  Thu May  2 15:43:04 2013
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Thu, 2 May 2013 14:43:04 +0000
Subject: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0
In-Reply-To: <F774E37D-E49D-4766-8991-912111B8044F@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA85F36B94@osl02-exc-001>,
	<F774E37D-E49D-4766-8991-912111B8044F@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA85F37318@osl02-exc-001>

Hi, just did some testing here. If I leave reconnect_delay unset, the shovel does not reconnect. Setting reconnect_delay to 0 seems to have the same effect (as expected). Setting reconnect_delay to a nonzero value makes the shovel reconnect immediately (tested with 10 and 1000). I tested this by closing the shovel's connection from the management interface on the cluster.

Jon

________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Tim Watson [tim at rabbitmq.com]
Sent: Thursday, May 02, 2013 15:56
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0

On 2 May 2013, at 11:29, Jon Bergli Heier wrote:

> Hello, after upgrading to RabbitMQ 3.1.0 my shovels doesn't seem to reconnect automatically. I don't have reconnect_delay set, so I'm assuming they should use the default, which is 5 seconds according to the shovel docs (http://www.rabbitmq.com/shovel.html).

I've just checked and the default reconnect delay is still set to 5 seconds.

> The shovels are on non-clustered brokers, connecting to a two-node cluster.


Hmn. If the shovels were clustered then it's possible a named shovel's configuration from one node could override the other (due to the way in which individual shovel workers fail-over in 3.1), but you say they're not clustered. Hmn. I'll have a quick go at reproducing this, but AFAICT there's no reason they shouldn't be attempting to reconnect. Unless the reconnect_delay is being overridden somewhere?

Cheers,
Tim
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Michael.Laing at nytimes.com  Thu May  2 15:43:10 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 2 May 2013 10:43:10 -0400
Subject: [rabbitmq-discuss] Shovel failover
In-Reply-To: <F774E37D-E49D-4766-8991-912111B8044F@rabbitmq.com>
Message-ID: <CDA7F03B.9529%Michael.Laing@nytimes.com>

Is the new failover scheme described somewhere? Couldn't find it.

Some of my configurations rely on shovels being set up differently for
each node in a cluster and that the shovel will stick to the node on which
it is configured.

The reason for these configurations (backup strategy to compensate for
partitioning) may have become moot now?

However, I have gotten pretty used to the shovel just being a
straightforward, well-behaved application on a single node, driven by that
node's configuration. If it now jumps around among nodes in the cluster
automatically then it is no longer straightforward - let's hope it is
still well-behaved!

-ml

On 5/2/13 9:56 AM, "Tim Watson" <tim at rabbitmq.com> wrote:

>On 2 May 2013, at 11:29, Jon Bergli Heier wrote:
>
>> Hello, after upgrading to RabbitMQ 3.1.0 my shovels doesn't seem to
>>reconnect automatically. I don't have reconnect_delay set, so I'm
>>assuming they should use the default, which is 5 seconds according to
>>the shovel docs (http://www.rabbitmq.com/shovel.html).
>
>I've just checked and the default reconnect delay is still set to 5
>seconds.
>
>> The shovels are on non-clustered brokers, connecting to a two-node
>>cluster.
>
>
>Hmn. If the shovels were clustered then it's possible a named shovel's
>configuration from one node could override the other (due to the way in
>which individual shovel workers fail-over in 3.1), but you say they're
>not clustered. Hmn. I'll have a quick go at reproducing this, but AFAICT
>there's no reason they shouldn't be attempting to reconnect. Unless the
>reconnect_delay is being overridden somewhere?
>
>Cheers,
>Tim
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Thu May  2 16:02:46 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 2 May 2013 16:02:46 +0100
Subject: [rabbitmq-discuss] Shovel failover
In-Reply-To: <CDA7F03B.9529%Michael.Laing@nytimes.com>
References: <CDA7F03B.9529%Michael.Laing@nytimes.com>
Message-ID: <A65DCF26-A45C-433A-807A-3138BB954AC7@rabbitmq.com>

Hi,

On 2 May 2013, at 15:43, Laing, Michael P. wrote:

> Is the new failover scheme described somewhere? Couldn't find it.
> 

It's described briefly in the "Getting Started" section of http://www.rabbitmq.com/shovel.html.

> Some of my configurations rely on shovels being set up differently for
> each node in a cluster and that the shovel will stick to the node on which
> it is configured.
> 

I'd suggest taking a look at what it does now then. If the same (named) shovel is defined on two nodes that are clustered, it will run on only one of them.

> The reason for these configurations (backup strategy to compensate for
> partitioning) may have become moot now?
> 

Perhaps - please let us know if that's not the case. 

> However, I have gotten pretty used to the shovel just being a
> straightforward, well-behaved application on a single node, driven by that
> node's configuration. If it now jumps around among nodes in the cluster
> automatically then it is no longer straightforward - let's hope it is
> still well-behaved!
> 

Indeed. Sadly, it looks like we have broken the default reconnect_delay setting that was previously available. I've filed a bug to fix that. Thanks for bringing it to our attention.

Cheers,
Tim

From tim at rabbitmq.com  Thu May  2 16:07:50 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 2 May 2013 16:07:50 +0100
Subject: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA85F37318@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA85F36B94@osl02-exc-001>,
	<F774E37D-E49D-4766-8991-912111B8044F@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA85F37318@osl02-exc-001>
Message-ID: <3CBAE95C-966C-43AC-9D5E-62BECB9F8B51@rabbitmq.com>

Hi Jon,

Just to clarify. When I explicitly set the shovel to {reconnect_delay, N}, it restarts with the correct frequency.

Cheers,
Tim

On 2 May 2013, at 15:43, Jon Bergli Heier wrote:

> Hi, just did some testing here. If I leave reconnect_delay unset, the shovel does not reconnect. Setting reconnect_delay to 0 seems to have the same effect (as expected). Setting reconnect_delay to a nonzero value makes the shovel reconnect immediately (tested with 10 and 1000). I tested this by closing the shovel's connection from the management interface on the cluster.
> 
> Jon
> 
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Tim Watson [tim at rabbitmq.com]
> Sent: Thursday, May 02, 2013 15:56
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0
> 
> On 2 May 2013, at 11:29, Jon Bergli Heier wrote:
> 
>> Hello, after upgrading to RabbitMQ 3.1.0 my shovels doesn't seem to reconnect automatically. I don't have reconnect_delay set, so I'm assuming they should use the default, which is 5 seconds according to the shovel docs (http://www.rabbitmq.com/shovel.html).
> 
> I've just checked and the default reconnect delay is still set to 5 seconds.
> 
>> The shovels are on non-clustered brokers, connecting to a two-node cluster.
> 
> 
> Hmn. If the shovels were clustered then it's possible a named shovel's configuration from one node could override the other (due to the way in which individual shovel workers fail-over in 3.1), but you say they're not clustered. Hmn. I'll have a quick go at reproducing this, but AFAICT there's no reason they shouldn't be attempting to reconnect. Unless the reconnect_delay is being overridden somewhere?
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Thu May  2 16:08:44 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 2 May 2013 16:08:44 +0100
Subject: [rabbitmq-discuss] Shovel failover
In-Reply-To: <A65DCF26-A45C-433A-807A-3138BB954AC7@rabbitmq.com>
References: <CDA7F03B.9529%Michael.Laing@nytimes.com>
	<A65DCF26-A45C-433A-807A-3138BB954AC7@rabbitmq.com>
Message-ID: <6DB32450-D414-48BC-9883-4FD87C862867@rabbitmq.com>

One more thing...

On 2 May 2013, at 16:02, Tim Watson wrote:
> I'd suggest taking a look at what it does now then. If the same (named) shovel is defined on two nodes that are clustered, it will run on only one of them.
> 

Just for clarification though - if you give the shovels different names, this won't happen and they will exist independently - we're talking about individual shovel workers.

Cheers,
Tim

From xujinzheng at gmail.com  Thu May  2 16:00:20 2013
From: xujinzheng at gmail.com (Xujin Zheng)
Date: Thu, 2 May 2013 08:00:20 -0700 (PDT)
Subject: [rabbitmq-discuss] A new AMQP-Client wrapper with erlang
Message-ID: <afc2216a-c5de-4e50-b9ec-3fc8559baa18@googlegroups.com>

Hi ,

I developed a new amqp_client wrapper with erlang,I appreciate rabbitmq 
team can put the github link to the http://www.rabbitmq.com/devtools.html 
page ? we want to help more erlang developer to easily to use rabbitmq.

GitHub link:
https://github.com/erlang-china/rabbit_farms

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

rabbit_farms

Rabbit farms is a standalone service for publishing messages to RabbitMQ 
from other another erlang apps.
<https://github.com/erlang-china/rabbit_farms#this-is-a-beta-version>This 
is a beta version.<https://github.com/erlang-china/rabbit_farms#usage-scenario>Usage 
scenario
------------------------------

Other (external) erlang applications publish messages to RabbitMQ without 
needing to reference the amqp_client, using it just like the gen_server 
call/cast API.
<https://github.com/erlang-china/rabbit_farms#usage>Usage:
------------------------------

Configure the rabbit_famrs.app

    {env, [{rabbit_farms,[tracking]},
             {farm_tracking,[{username, <<"guest">>},
                                     {password, <<"V2pOV2JHTXpVVDA9">>}, %% triple_times_base64("guest")
                                     {virtual_host, <<"/">>},
                                     {host, "localhost"},
                                     {port, 5672},
                           {feeders,[
                                      [{channel_count,1},
                                       {exchange, <<"tracking.logs">>},
                                       {type, <<"topic">>}]
                                    ]}
                           ]}
    ]}

<https://github.com/erlang-china/rabbit_farms#publish>publish

    1>RabbitCarrot = #rabbit_carrot{farm_name = tracking, exchange = <<"tracking.logs">>, 
                     routing_key = <<"routing_key">>, 
                     message = <<"">>}.
      #rabbit_carrot{farm_name = tracking,
               exchange = <<"tracking.logs">>,
               routing_key = <<"routing_key">>,message = <<>>,
               content_type = undefined}

    2>rabbit_farms:publish(cast, RabbitCarrot). %%asynchronous
    3>rabbit_farms:publish(call, RabbitCarrot). %%synchronization

<https://github.com/erlang-china/rabbit_farms#batch-publish>batch publish

    1>Body1 = #rabbit_carrot_body{routing_key = <<"routing_key">>, message = <<"message1">>}.
      #rabbit_carrot_body{routing_key = <<"routing_key1">>,
                    message = <<"message1">>}

    2>Body2 = #rabbit_carrot_body{routing_key = <<"routing_key">>, message = <<"message2">>}.
      #rabbit_carrot_body{routing_key = <<"routing_key2">>,
                    message = <<"message2">>}

    3>RabbitCarrots = #rabbit_carrots{farm_name            = tracking,
                                      exchange             = <<"tracking.logs">>, 
                                      rabbit_carrot_bodies = [Body1,Body2]}.

      #rabbit_carrots{
                        farm_name = tracking,exchange = <<"tracking.logs">>,
                        rabbit_carrot_bodies = 
                            [#rabbit_carrot_body{
                                 routing_key = <<"routing_key">>,
                                 message = <<"message1">>},
                             #rabbit_carrot_body{
                                 routing_key = <<"routing_key">>,
                                 message = <<"message2">>}],
                        content_type = undefined}

    4>rabbit_farms:publish(cast, RabbitCarrots). %%asynchronous
    5>rabbit_farms:publish(call, RabbitCarrots). %%synchronization



Thanks
Xujin Zheng

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/1bfb82a7/attachment.htm>

From dmitry.andrianov at alertme.com  Thu May  2 16:19:12 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Thu, 02 May 2013 16:19:12 +0100
Subject: [rabbitmq-discuss] Key based access control
Message-ID: <518283F0.6000908@alertme.com>

Hello.

I amresearching how well RabbitMQ handles one scenario and need an 
advice on connecting LOTS of clients to the RabbitMQ.

Initially we planned to use single server=>client exhchage. The idea was 
that clients specify their ID
as binding key when binding to that server2client exchange and server 
will be using
client ID as a routing key when sending to it so each client only 
receives messages with its client ID.

Then the idea was to modify the auth backend so it won't allow clients 
to specify
other client's ID when binding a queue to the exchange (by comparing 
binging key to auth user id).
But as it turns out, the auth backend does not see the binding key at 
all - it only sees
the queue and exchange names.

I guess you probably expect me to create separate exchange for each 
client to solve
that issue (and this thread confirms it - 
http://rabbitmq.1065348.n5.nabble.com/Advanced-per-user-authorization-td23580.html)

My concerns are:
1. How will it work if we have say a million exchanges on a RabbitMQ 
server? Or even a few millions.
2. To distribute the load we could use multiple RabbitMQ server without 
building a cluster.
(Producers can be coded so they know to which RabbitMQ instance given 
client is connected).
But it looks to me that exchange is a persistent entity - it won't cease 
to exist even when client goes away
and its queue is destroyed. So if a client will be switching between our 
brokers, it will create same
exchange on every one and eventually all servers will have full 
collection of exchanges. So it is not very scalable.
Is there any way to automatically destroy unused exchanges?

Or is it actually possible to verify how exactly a client binds to a 
exchange in the auth backend or other plugin?

Maybe I'm just missing something and there is a better way to do what I 
am trying to do?

Many thanks.
Dmitry




This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From jon.bergli.heier at zisson.no  Thu May  2 16:24:04 2013
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Thu, 2 May 2013 15:24:04 +0000
Subject: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0
In-Reply-To: <3CBAE95C-966C-43AC-9D5E-62BECB9F8B51@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA85F36B94@osl02-exc-001>,
	<F774E37D-E49D-4766-8991-912111B8044F@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA85F37318@osl02-exc-001>,
	<3CBAE95C-966C-43AC-9D5E-62BECB9F8B51@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA85F373A2@osl02-exc-001>

Yes, that seems to be the case. When leaving it unset it seems to behave as if it was set to 0.
Manually setting it to 5 is a quick workaround I guess.

Jon

________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Tim Watson [tim at rabbitmq.com]
Sent: Thursday, May 02, 2013 17:07
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0

Hi Jon,

Just to clarify. When I explicitly set the shovel to {reconnect_delay, N}, it restarts with the correct frequency.

Cheers,
Tim

On 2 May 2013, at 15:43, Jon Bergli Heier wrote:

> Hi, just did some testing here. If I leave reconnect_delay unset, the shovel does not reconnect. Setting reconnect_delay to 0 seems to have the same effect (as expected). Setting reconnect_delay to a nonzero value makes the shovel reconnect immediately (tested with 10 and 1000). I tested this by closing the shovel's connection from the management interface on the cluster.
>
> Jon
>
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Tim Watson [tim at rabbitmq.com]
> Sent: Thursday, May 02, 2013 15:56
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Shovels not reconnecting with RabbitMQ 3.1.0
>
> On 2 May 2013, at 11:29, Jon Bergli Heier wrote:
>
>> Hello, after upgrading to RabbitMQ 3.1.0 my shovels doesn't seem to reconnect automatically. I don't have reconnect_delay set, so I'm assuming they should use the default, which is 5 seconds according to the shovel docs (http://www.rabbitmq.com/shovel.html).
>
> I've just checked and the default reconnect delay is still set to 5 seconds.
>
>> The shovels are on non-clustered brokers, connecting to a two-node cluster.
>
>
> Hmn. If the shovels were clustered then it's possible a named shovel's configuration from one node could override the other (due to the way in which individual shovel workers fail-over in 3.1), but you say they're not clustered. Hmn. I'll have a quick go at reproducing this, but AFAICT there's no reason they shouldn't be attempting to reconnect. Unless the reconnect_delay is being overridden somewhere?
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu May  2 16:37:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 May 2013 16:37:30 +0100
Subject: [rabbitmq-discuss] Key based access control
In-Reply-To: <518283F0.6000908@alertme.com>
References: <518283F0.6000908@alertme.com>
Message-ID: <5182883A.3060404@rabbitmq.com>

On 02/05/13 16:19, Dmitry Andrianov wrote:
> My concerns are:
> 1. How will it work if we have say a million exchanges on a RabbitMQ
> server? Or even a few millions.

A few million is definitely a lot - the database records for all of them 
have to live in memory. But note that that is true of bindings and 
queues as well. An exchange is no more expensive than a binding, and 
less expensive than a queue (exception: federated exchanges).

> 2. To distribute the load we could use multiple RabbitMQ server without
> building a cluster.
> (Producers can be coded so they know to which RabbitMQ instance given
> client is connected).
> But it looks to me that exchange is a persistent entity - it won't cease
> to exist even when client goes away
> and its queue is destroyed. So if a client will be switching between our
> brokers, it will create same
> exchange on every one and eventually all servers will have full
> collection of exchanges. So it is not very scalable.
> Is there any way to automatically destroy unused exchanges?

Yes; set the exchange's autodelete field to true. Then the exchange will 
delete itself when the last queue is unbound from it.

> Or is it actually possible to verify how exactly a client binds to a
> exchange in the auth backend or other plugin?

I'm afraid not.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From laurent.bernabe at gmail.com  Thu May  2 16:46:53 2013
From: laurent.bernabe at gmail.com (laurent bernabe)
Date: Thu, 2 May 2013 17:46:53 +0200
Subject: [rabbitmq-discuss] HelloWorld example : Connection refused to
	localhost
Message-ID: <CAH8mndL8MXFQ5n1c4jLia4ybuV-rppfkRZ2s3kwTwRJpgBjy0w@mail.gmail.com>

Hello everyone,

I can't run the HelloWorld tutorial in my computer.

I've downloaded rabbitmq-java-client-bin-3.1.0.
Then in Eclipse Juno for Java EE developpers (Release 2) in my Ubuntu 12.10
64 bits I :

   - imported the jars {commons-cli-1.1.jar, commons-io-1.2.jar,
   rabbitmq-client.jar} and added them to the build path (so they were in my
   project class path)
   - added the Send and Recv sources codes

But when I ran the Send class, I got a ConnectException.
I've attached the exception trace as well as the Send/Recv source file (in
order to match the line numbers given in the stack trace).

So, did I missed something or did I misunderstood a configuration setup ?

Regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/d7c62dd4/attachment.htm>
-------------- next part --------------
Exception in thread "main" java.net.ConnectException: Connexion refus?e
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:391)
	at java.net.Socket.connect(Socket.java:579)
	at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:445)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:504)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
	at Send.main(Send.java:14)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Recv.java
Type: application/octet-stream
Size: 986 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/d7c62dd4/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Send.java
Type: application/octet-stream
Size: 723 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/d7c62dd4/attachment-0001.obj>

From simon at rabbitmq.com  Thu May  2 16:56:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 May 2013 16:56:36 +0100
Subject: [rabbitmq-discuss] HelloWorld example : Connection refused to
 localhost
In-Reply-To: <CAH8mndL8MXFQ5n1c4jLia4ybuV-rppfkRZ2s3kwTwRJpgBjy0w@mail.gmail.com>
References: <CAH8mndL8MXFQ5n1c4jLia4ybuV-rppfkRZ2s3kwTwRJpgBjy0w@mail.gmail.com>
Message-ID: <51828CB4.3080501@rabbitmq.com>

On 02/05/13 16:46, laurent bernabe wrote:
> Exception in thread "main" java.net.ConnectException: Connexion refus?e

Is the server actually running?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Michael.Laing at nytimes.com  Thu May  2 16:58:02 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 2 May 2013 11:58:02 -0400
Subject: [rabbitmq-discuss] Shovel failover
In-Reply-To: <A65DCF26-A45C-433A-807A-3138BB954AC7@rabbitmq.com>
Message-ID: <CDA804A4.9555%Michael.Laing@nytimes.com>

Thanks!

So it looks like I can give my shovels distinct names and keep y current
setup (if I want).

If a shovel has a distinct name, is it guaranteed to be started only on
the node on which it is configured?

-ml

On 5/2/13 11:02 AM, "Tim Watson" <tim at rabbitmq.com> wrote:

>Hi,
>
>On 2 May 2013, at 15:43, Laing, Michael P. wrote:
>
>> Is the new failover scheme described somewhere? Couldn't find it.
>> 
>
>It's described briefly in the "Getting Started" section of
>http://www.rabbitmq.com/shovel.html.
>
>> Some of my configurations rely on shovels being set up differently for
>> each node in a cluster and that the shovel will stick to the node on
>>which
>> it is configured.
>> 
>
>I'd suggest taking a look at what it does now then. If the same (named)
>shovel is defined on two nodes that are clustered, it will run on only
>one of them.
>
>> The reason for these configurations (backup strategy to compensate for
>> partitioning) may have become moot now?
>> 
>
>Perhaps - please let us know if that's not the case.
>
>> However, I have gotten pretty used to the shovel just being a
>> straightforward, well-behaved application on a single node, driven by
>>that
>> node's configuration. If it now jumps around among nodes in the cluster
>> automatically then it is no longer straightforward - let's hope it is
>> still well-behaved!
>> 
>
>Indeed. Sadly, it looks like we have broken the default reconnect_delay
>setting that was previously available. I've filed a bug to fix that.
>Thanks for bringing it to our attention.
>
>Cheers,
>Tim
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu May  2 17:02:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 May 2013 17:02:07 +0100
Subject: [rabbitmq-discuss] Shovel failover
In-Reply-To: <CDA804A4.9555%Michael.Laing@nytimes.com>
References: <CDA804A4.9555%Michael.Laing@nytimes.com>
Message-ID: <51828DFF.4050606@rabbitmq.com>

On 02/05/13 16:58, Laing, Michael P. wrote:
> If a shovel has a distinct name, is it guaranteed to be started only on
> the node on which it is configured?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From niks at osic.rs  Thu May  2 16:44:59 2013
From: niks at osic.rs (Nikola)
Date: Thu, 2 May 2013 08:44:59 -0700 (PDT)
Subject: [rabbitmq-discuss] MySQL UDF or Storage Engine for RabbitMQ
Message-ID: <f56bf873-dc3f-4532-90eb-ac1a6607752c@googlegroups.com>

Hi all,

Does anyone know if there is some work being done on MySQL User Defined 
Function (UDF) or AMQP/RabbitMQ specific Storage Engine for MySQL, which 
would enable direct integration between MySQL and RabbitMQ.

Primary need we have is to be able to send AMQP messages directly from 
MySQL. This is required because some tables are updated by MySQL, without 
explicit request from web application (eg. by stored procedure or trigger). 
In this case we would like to emit AMQP message directly from MySQL, which 
would then be processed by PHP workers (eg. cache entries would be 
invalidated).

I assume that simplest way to do that would be to have UDF. Better way 
might be to have specific MySQL Storage Engine, like Sphinx has. Gearman 
has UDF available.

Looking forward to your comments.

Regards,
Nikola
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/080429df/attachment.htm>

From ranjitiyer at gmail.com  Fri May  3 00:19:37 2013
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Thu, 2 May 2013 16:19:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer acknowledgements for very long
	running tasks
In-Reply-To: <518234EF.7050502@rabbitmq.com>
References: <1367433290054-26341.post@n5.nabble.com>
	<CAE3HoVSOyAWWOuyVf7tKPZ1qcEbgNnht7adsQRpCjF84QRjgpw@mail.gmail.com>
	<518234EF.7050502@rabbitmq.com>
Message-ID: <1367536777736-26394.post@n5.nabble.com>

Thanks! That clarifies it. One more qs. Do unacknowledged durable messages
survive a server restart?

Ranjit



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Consumer-acknowledgements-for-very-long-running-tasks-tp26341p26394.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From rev.chip at gmail.com  Fri May  3 00:23:32 2013
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Thu, 2 May 2013 16:23:32 -0700
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <CAE3HoVQ8i5ife5N_FAbcDqq1JUzF9u50FKHB3ehKeok-W7fQKw@mail.gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
	<5180F745.6090307@rabbitmq.com>
	<CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
	<CANSL5VEy8AppF6YE2bS366FRsV0MifpU3qD4Rf22jtmf_jqGHA@mail.gmail.com>
	<CAE3HoVQ8i5ife5N_FAbcDqq1JUzF9u50FKHB3ehKeok-W7fQKw@mail.gmail.com>
Message-ID: <CANSL5VH8JgREodAYvVJX3bumRD9OGXPp+srfGUdepEuSHPYogg@mail.gmail.com>

Look closer and the inconsistency is clear.  In both cases the only problem
is that the client wants to consume from a queue, but the queue's
nonexistence makes that impossible.  Yet in one case the channel gets
closed; in the other, it doesn't.  Why should nonexistent queue at start be
a channel exception, but nonexistent queue later not be one?  Makes no
sense to me.  IMO neither case should be a channel exception.  Too late to
change it of course.

BTW the client code isn't general-purpose, so you need not worry that any
(other) users will be inconvenienced by my idiosyncrasy.


On Wed, May 1, 2013 at 10:16 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/5/2 Chip Salzenberg <rev.chip at gmail.com>
>
>> The decision to close the channel is for symmetry with the "consume"
>> method, which closes the channel if it fails.
>
>
> When basic.consume fails, it is because you try to consume from a queue
> that does not exist or the queue is exclusive
> and owned by another connection. This raises a channel exception and that
> causes the channel to be closed.
>
> This is not specific to basic.consume but all channel exceptions. I
> personally don't think making cancellation notifications
> close a channel improves consistency. I'm not aware of other clients doing
> this.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/341694cb/attachment.htm>

From jkuch at gopivotal.com  Thu May  2 20:30:30 2013
From: jkuch at gopivotal.com (Gerald Kuch)
Date: Thu, 2 May 2013 12:30:30 -0700
Subject: [rabbitmq-discuss] HelloWorld example : Connection refused to
	localhost
In-Reply-To: <CAH8mndL8MXFQ5n1c4jLia4ybuV-rppfkRZ2s3kwTwRJpgBjy0w@mail.gmail.com>
References: <CAH8mndL8MXFQ5n1c4jLia4ybuV-rppfkRZ2s3kwTwRJpgBjy0w@mail.gmail.com>
Message-ID: <CANOx8NnXKu81HnBsQVUGe00Q-z7d4u_HN=Yjpc7btM8NktCajg@mail.gmail.com>

If you telnet to port 5672 on localhost does something answer?  If
something seems to, and you bang out some gibberish do you get disconnected
with an AMQP error message?  Does netstat show anything  listening on the
AMQP port and, if so, is it actually a rabbit?




On Thu, May 2, 2013 at 8:46 AM, laurent bernabe
<laurent.bernabe at gmail.com>wrote:

> Hello everyone,
>
> I can't run the HelloWorld tutorial in my computer.
>
> I've downloaded rabbitmq-java-client-bin-3.1.0.
> Then in Eclipse Juno for Java EE developpers (Release 2) in my Ubuntu
> 12.10 64 bits I :
>
>    - imported the jars {commons-cli-1.1.jar, commons-io-1.2.jar,
>    rabbitmq-client.jar} and added them to the build path (so they were in my
>    project class path)
>    - added the Send and Recv sources codes
>
> But when I ran the Send class, I got a ConnectException.
> I've attached the exception trace as well as the Send/Recv source file (in
> order to match the line numbers given in the stack trace).
>
> So, did I missed something or did I misunderstood a configuration setup ?
>
> Regards
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/eef9c5ac/attachment.htm>

From jay.danziger at fantex.com  Fri May  3 01:29:40 2013
From: jay.danziger at fantex.com (JayD)
Date: Thu, 2 May 2013 17:29:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Single Consumer for Queues
Message-ID: <1711c276-a953-45b7-be14-db05dc9f1b58@googlegroups.com>

Is anyone aware of a way to force only one consumer of a queue.  I am not 
looking for an exclusive queue since that behavior deletes the queue when 
the channel is closed.  I need to allow only one consumer on the queue and 
have it not be deleted after disconnect.

Jay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/f49c7aea/attachment.htm>

From matthias at rabbitmq.com  Fri May  3 01:41:03 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 May 2013 01:41:03 +0100
Subject: [rabbitmq-discuss] Single Consumer for Queues
In-Reply-To: <1711c276-a953-45b7-be14-db05dc9f1b58@googlegroups.com>
References: <1711c276-a953-45b7-be14-db05dc9f1b58@googlegroups.com>
Message-ID: <5183079F.9060102@rabbitmq.com>

On 03/05/13 01:29, JayD wrote:
> Is anyone aware of a way to force only one consumer of a queue.  I am
> not looking for an exclusive queue since that behavior deletes the queue
> when the channel is closed.  I need to allow only one consumer on the
> queue and have it not be deleted after disconnect.

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.exclusive

Matthias.

From matthias at rabbitmq.com  Fri May  3 01:43:11 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 May 2013 01:43:11 +0100
Subject: [rabbitmq-discuss] Consumer acknowledgements for very long
 running tasks
In-Reply-To: <1367536777736-26394.post@n5.nabble.com>
References: <1367433290054-26341.post@n5.nabble.com>
	<CAE3HoVSOyAWWOuyVf7tKPZ1qcEbgNnht7adsQRpCjF84QRjgpw@mail.gmail.com>
	<518234EF.7050502@rabbitmq.com>
	<1367536777736-26394.post@n5.nabble.com>
Message-ID: <5183081F.6080500@rabbitmq.com>

On 03/05/13 00:19, ranjitiyer wrote:
> Do unacknowledged durable messages survive a server restart?

Unacknowledged persistent messages in durable queues do survive a server 
restart.

Matthias.

From michael.s.klishin at gmail.com  Fri May  3 07:07:37 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 3 May 2013 10:07:37 +0400
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <CANSL5VH8JgREodAYvVJX3bumRD9OGXPp+srfGUdepEuSHPYogg@mail.gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
	<5180F745.6090307@rabbitmq.com>
	<CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
	<CANSL5VEy8AppF6YE2bS366FRsV0MifpU3qD4Rf22jtmf_jqGHA@mail.gmail.com>
	<CAE3HoVQ8i5ife5N_FAbcDqq1JUzF9u50FKHB3ehKeok-W7fQKw@mail.gmail.com>
	<CANSL5VH8JgREodAYvVJX3bumRD9OGXPp+srfGUdepEuSHPYogg@mail.gmail.com>
Message-ID: <CAE3HoVRjjwkPUKFJGfdjnhQnPFCjLa=kuVONztfbvpxR-Oui8g@mail.gmail.com>

2013/5/3 Chip Salzenberg <rev.chip at gmail.com>

> Why should nonexistent queue at start be a channel exception, but
> nonexistent queue later not be one?  Makes no sense to me.


Because when you start consuming, you have a chance to recover from a queue
that does not exist. When the queue is deleted
later, you don't necessarily have an easy way to do so.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/858ff0eb/attachment.htm>

From neo20iitkgp at gmail.com  Fri May  3 09:19:40 2013
From: neo20iitkgp at gmail.com (subhankar biswas)
Date: Fri, 3 May 2013 01:19:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster not running - getting Error:
 {cannot_discover_cluster,
 "The nodes provided are either offline or not running" error
In-Reply-To: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
References: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
Message-ID: <90b4b897-8f59-4652-b6a0-e81a76b340c7@googlegroups.com>

@shankaralingegowda Singonahalli Chikkarevanna
how did you solved the problem????
i m facing d same problem

On Thursday, 28 February 2013 21:10:56 UTC+5:30, shankaralingegowda 
Singonahalli Chikkarevanna wrote:
>
> Hi,
> I am running Cluster setup of rabbitmq. 
> the single node at both the machines are running fine in the same network
>
> and I have enabled ssh entry for both master and slave
> slave can access master using ssh master
>
> after that I stopped rabbitmq slave machine
> and run join cluster command like join_cluster rabbitmq at master    ---{here 
> rabbitmq is master setup user name and I{p)
>
> but getting
> Error: {cannot_discover_cluster,"The nodes provided are either offline or 
> not running"
> error
> please help me to resolve the issue
>
> Thanks in advance
>
> shankarlaingegowda
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/f2606071/attachment.htm>

From laurent.bernabe at gmail.com  Fri May  3 09:36:30 2013
From: laurent.bernabe at gmail.com (laurent bernabe)
Date: Fri, 3 May 2013 10:36:30 +0200
Subject: [rabbitmq-discuss] HelloWorld example : Connection refused to
	localhost
In-Reply-To: <CANOx8NnXKu81HnBsQVUGe00Q-z7d4u_HN=Yjpc7btM8NktCajg@mail.gmail.com>
References: <CAH8mndL8MXFQ5n1c4jLia4ybuV-rppfkRZ2s3kwTwRJpgBjy0w@mail.gmail.com>
	<CANOx8NnXKu81HnBsQVUGe00Q-z7d4u_HN=Yjpc7btM8NktCajg@mail.gmail.com>
Message-ID: <CAH8mndLMxb2dLC=x1XcHksyzest6Z2Lrs+iiB2mvKdrh4kaffA@mail.gmail.com>

Hello, thank you for your suggestions.

In fact, I've been noticed on the mailing list that I forgot to launch the
rabbit server.

Anyway, thank you for your help.

Regards


2013/5/2 Gerald Kuch <jkuch at gopivotal.com>

> If you telnet to port 5672 on localhost does something answer?  If
> something seems to, and you bang out some gibberish do you get disconnected
> with an AMQP error message?  Does netstat show anything  listening on the
> AMQP port and, if so, is it actually a rabbit?
>
>
>
>
> On Thu, May 2, 2013 at 8:46 AM, laurent bernabe <laurent.bernabe at gmail.com
> > wrote:
>
>> Hello everyone,
>>
>> I can't run the HelloWorld tutorial in my computer.
>>
>> I've downloaded rabbitmq-java-client-bin-3.1.0.
>> Then in Eclipse Juno for Java EE developpers (Release 2) in my Ubuntu
>> 12.10 64 bits I :
>>
>>    - imported the jars {commons-cli-1.1.jar, commons-io-1.2.jar,
>>    rabbitmq-client.jar} and added them to the build path (so they were in my
>>    project class path)
>>    - added the Send and Recv sources codes
>>
>> But when I ran the Send class, I got a ConnectException.
>> I've attached the exception trace as well as the Send/Recv source file
>> (in order to match the line numbers given in the stack trace).
>>
>> So, did I missed something or did I misunderstood a configuration setup ?
>>
>> Regards
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/6bb2f524/attachment.htm>

From ashok.anand at gmail.com  Fri May  3 07:35:15 2013
From: ashok.anand at gmail.com (ashok)
Date: Thu, 2 May 2013 23:35:15 -0700 (PDT)
Subject: [rabbitmq-discuss] View messages in queue
Message-ID: <1367562914432-26401.post@n5.nabble.com>

I am looking at if we can see all messages in the queue.  Currently, I see
that using rabbitmqadmin, we can inspect head without reordering the queue:
"./rabbitmqadmin get queue=queuename requeue=true"
I am just wondering if there is some more capability,  in particular,
a) View all messages in the queue (not just head), while not destroying
order of messages in the queue
b) To be able to delete a message at a specific position: Currently I can
delete only head. This does defeat the meaning of queue, though in one of my
use case, it does seem useful to have such feature.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/View-messages-in-queue-tp26401.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From stefan.sedich at gmail.com  Fri May  3 02:56:41 2013
From: stefan.sedich at gmail.com (Stefan Sedich)
Date: Thu, 2 May 2013 18:56:41 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Management API possible bug?
Message-ID: <79f8e773-f069-4557-8d45-04ce65b86932@googlegroups.com>

I notice in my response from /queues I get a message_stats: [ ], where I am 
expecting it to be { } if it is empty, this was working fine before I 
upgraded to 3.1, did anyone else notice this?



Thanks
Stefan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130502/39928027/attachment.htm>

From michael.s.klishin at gmail.com  Fri May  3 09:42:14 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 3 May 2013 12:42:14 +0400
Subject: [rabbitmq-discuss] View messages in queue
In-Reply-To: <1367562914432-26401.post@n5.nabble.com>
References: <1367562914432-26401.post@n5.nabble.com>
Message-ID: <CAE3HoVQ7oCBOrAddBOVf8T5poFzXJH2NHV-goP0YsaYAMVGb2w@mail.gmail.com>

2013/5/3 ashok <ashok.anand at gmail.com>

> I am just wondering if there is some more capability,  in particular,
> a) View all messages in the queue (not just head), while not destroying
> order of messages in the queue
> b) To be able to delete a message at a specific position: Currently I can
> delete only head. This does defeat the meaning of queue, though in one of
> my
> use case, it does seem useful to have such feature.
>

There is no.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/26262177/attachment.htm>

From emile at rabbitmq.com  Fri May  3 09:51:10 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 May 2013 09:51:10 +0100
Subject: [rabbitmq-discuss] View messages in queue
In-Reply-To: <1367562914432-26401.post@n5.nabble.com>
References: <1367562914432-26401.post@n5.nabble.com>
Message-ID: <51837A7E.7080006@rabbitmq.com>


Hi,

On 03/05/13 07:35, ashok wrote:
> a) View all messages in the queue (not just head), while not destroying
> order of messages in the queue

This is possible since v2.7.0:
http://www.rabbitmq.com/semantics.html#ordering
You should be aware that the requeueing messages sets the redelivery
flag, so subsequent consumers will not get an identical message.

> b) To be able to delete a message at a specific position: Currently I can
> delete only head. This does defeat the meaning of queue, though in one of my
> use case, it does seem useful to have such feature.

This use-case may indicate that you will be better served by a database
than a message broker. Even so it is possible to selectively consume a
message by retrieving messages up to the position of interest. Then
acknowledge the message that you want to remove and requeue all the
messages ahead of it in the queue.

This is a relatively expensive operation compared to a database delete.
It also assumes that there is only one consumer. If there are multiple
consumers then it will be difficult to remove messages based on position.




-Emile







From tim at rabbitmq.com  Fri May  3 09:54:09 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 3 May 2013 09:54:09 +0100
Subject: [rabbitmq-discuss] View messages in queue
In-Reply-To: <CAE3HoVQ7oCBOrAddBOVf8T5poFzXJH2NHV-goP0YsaYAMVGb2w@mail.gmail.com>
References: <1367562914432-26401.post@n5.nabble.com>
	<CAE3HoVQ7oCBOrAddBOVf8T5poFzXJH2NHV-goP0YsaYAMVGb2w@mail.gmail.com>
Message-ID: <905954EB-1F32-4166-9748-0C7D984E2D13@rabbitmq.com>

On 3 May 2013, at 09:42, Michael Klishin wrote:

> 2013/5/3 ashok <ashok.anand at gmail.com>
> 
> There is no.

And for good reason in the case of (b)...

> 
> b) To be able to delete a message at a specific position: Currently I can
> delete only head. This does defeat the meaning of queue, though in one of my
> use case, it does seem useful to have such feature.

as the OP admits, that isn't the "correct" behaviour for a queue after all.

> I am just wondering if there is some more capability,  in particular,
> a) View all messages in the queue (not just head), while not destroying
> order of messages in the queue

There is an open bug to investigate the possibility of being able to browse queues, with some limitations and caveats (esp. around messages that have been paged to disk). I believe Simon has been chewing on this idea for a while, so this may be (partly) possible some time in the future.

Cheers,

Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/02ff3872/attachment.htm>

From emile at rabbitmq.com  Fri May  3 10:02:22 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 May 2013 10:02:22 +0100
Subject: [rabbitmq-discuss] Error queue handling
In-Reply-To: <CAAM=DsMNzDOn2VSiQVhsnCHNhhX1DNWHw5=cmc5RMCjkSUSAfw@mail.gmail.com>
References: <a99c566c-b84f-45e2-9d19-d2970c3b7593@googlegroups.com>
	<517E80F5.4030608@rabbitmq.com>
	<CAAM=DsMNzDOn2VSiQVhsnCHNhhX1DNWHw5=cmc5RMCjkSUSAfw@mail.gmail.com>
Message-ID: <51837D1E.1010901@rabbitmq.com>

On 03/05/13 05:34, Muhzin wrote:
> I'm sorry if I was not clear before. I don't want "automatically
> requeuing to the main queue." , As I mentioned it is supposed to be a
> manual process. So ,is there  any way I can achieve this?

If a consumer has a message that it wants to send to a particular queue
then it can republish the message to the default exchange with the queue
name as the routing key.




-Emile









From michael.s.klishin at gmail.com  Fri May  3 10:09:00 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 3 May 2013 13:09:00 +0400
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block operations
	other than basic.publish
Message-ID: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>

I'm observing something odd since upgrading to 3.1.

I'm adding various stress tests for Bunny and hit RAM alarms every
so often. After that happens, starting new consumers takes so long
that it times out in the client. Also, I've noticed in the management UI
that existing consumers do not drain queues.

Sometimes Rabbit stops responding altogether.

Steps to reproduce:

 * Start a "hello, world"-like consumer and producer
 * Make the producer publish large (tens of MBs) messages as fast as it can
 * See an alarm message in the log
 * Shut down the publisher

At this point, consumers receive no deliveries.

 * Shut down the consumer
 * Start the consumer again with log level = debug

The consumer seems completely blocked, receiving no methods from RabbitMQ.

 * Purge the queue

Now consumer can start, open a connection and register consumers
successfully.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/155fbd58/attachment.htm>

From ashok.anand at gmail.com  Fri May  3 10:15:57 2013
From: ashok.anand at gmail.com (Ashok Anand)
Date: Fri, 3 May 2013 14:45:57 +0530
Subject: [rabbitmq-discuss] View messages in queue
In-Reply-To: <51837A7E.7080006@rabbitmq.com>
References: <1367562914432-26401.post@n5.nabble.com>
	<51837A7E.7080006@rabbitmq.com>
Message-ID: <CALQsBOXX96GRH9p0mgSeGuTQqCSHED7mY46M4UNaomXvfq3p2g@mail.gmail.com>

Thanks for your reply.
For further clarification
1) what should I use to go through all messages in the queue,
currently, "./rabbitmqadmin get queue=qname requeue=true" gives only head.
does any such interface exists currently to get list of all messages in the
queue?
2) Just the re-delivery flag is set, right? so the consume should not
assume that it is a retrial of the same message?


On Fri, May 3, 2013 at 2:21 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 03/05/13 07:35, ashok wrote:
> > a) View all messages in the queue (not just head), while not destroying
> > order of messages in the queue
>
> This is possible since v2.7.0:
> http://www.rabbitmq.com/semantics.html#ordering
> You should be aware that the requeueing messages sets the redelivery
> flag, so subsequent consumers will not get an identical message.
>
> > b) To be able to delete a message at a specific position: Currently I can
> > delete only head. This does defeat the meaning of queue, though in one
> of my
> > use case, it does seem useful to have such feature.
>
> This use-case may indicate that you will be better served by a database
> than a message broker. Even so it is possible to selectively consume a
> message by retrieving messages up to the position of interest. Then
> acknowledge the message that you want to remove and requeue all the
> messages ahead of it in the queue.
>
> This is a relatively expensive operation compared to a database delete.
> It also assumes that there is only one consumer. If there are multiple
> consumers then it will be difficult to remove messages based on position.
>
>
>
>
> -Emile
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/8501d54a/attachment.htm>

From michael.s.klishin at gmail.com  Fri May  3 10:24:55 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 3 May 2013 13:24:55 +0400
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
Message-ID: <CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>

2013/5/3 Michael Klishin <michael.s.klishin at gmail.com>

> The consumer seems completely blocked, receiving no methods from RabbitMQ.


More investigation suggests that the connection succeeds, just very slowly
(up to a couple of minutes),
and queues are eventually drained. Lots of CPU time is spent in the kernel.

So I'll assume this is an OS X networking stack issue, which is easy to
overwhelm with large messages.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/9abbca04/attachment.htm>

From tim at rabbitmq.com  Fri May  3 10:34:46 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 3 May 2013 10:34:46 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
Message-ID: <03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>

Have you got a reproducible (ish) test that I can run on a linux box? If so, I'll poke around and make sure it's not showing up there too.

Cheers,
Tim

On 3 May 2013, at 10:24, Michael Klishin wrote:

> 
> 2013/5/3 Michael Klishin <michael.s.klishin at gmail.com>
> The consumer seems completely blocked, receiving no methods from RabbitMQ.
> 
> More investigation suggests that the connection succeeds, just very slowly (up to a couple of minutes),
> and queues are eventually drained. Lots of CPU time is spent in the kernel.
> 
> So I'll assume this is an OS X networking stack issue, which is easy to overwhelm with large messages.
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/7197597c/attachment.htm>

From emile at rabbitmq.com  Fri May  3 10:37:17 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 May 2013 10:37:17 +0100
Subject: [rabbitmq-discuss] View messages in queue
In-Reply-To: <CALQsBOXX96GRH9p0mgSeGuTQqCSHED7mY46M4UNaomXvfq3p2g@mail.gmail.com>
References: <1367562914432-26401.post@n5.nabble.com>
	<51837A7E.7080006@rabbitmq.com>
	<CALQsBOXX96GRH9p0mgSeGuTQqCSHED7mY46M4UNaomXvfq3p2g@mail.gmail.com>
Message-ID: <5183854D.4080609@rabbitmq.com>


On 03/05/13 10:15, Ashok Anand wrote:
> 1) what should I use to go through all messages in the queue,
> currently, "./rabbitmqadmin get queue=qname requeue=true" gives only
> head. does any such interface exists currently to get list of all
> messages in the queue?

You can retrieve more than one message by supplying the "count" parameter.

I would recommend using a client library and writing the software to
accomplish your goals. For your use-case b) all the operations (message
retrieval, selective acknowledgement and requeueing) will need to be
performed on the same channel, which precludes composing a sequence with
multiple invocations of a commandline utility.

> 2) Just the re-delivery flag is set, right? so the consume should not
> assume that it is a retrial of the same message?

The consumer can't distinguish between a message that was requeued due
to exceptional circumstances (e.g. network disconnection while a message
was unacknowledged) and a message that was explicitly requeued.




-Emile






From ashok.anand at gmail.com  Fri May  3 10:43:13 2013
From: ashok.anand at gmail.com (Ashok Anand)
Date: Fri, 3 May 2013 15:13:13 +0530
Subject: [rabbitmq-discuss] View messages in queue
In-Reply-To: <5183854D.4080609@rabbitmq.com>
References: <1367562914432-26401.post@n5.nabble.com>
	<51837A7E.7080006@rabbitmq.com>
	<CALQsBOXX96GRH9p0mgSeGuTQqCSHED7mY46M4UNaomXvfq3p2g@mail.gmail.com>
	<5183854D.4080609@rabbitmq.com>
Message-ID: <CALQsBOWfW-YZindHyoYhV2xBezfS27QrXtBVkJrWTXMYqxxt3w@mail.gmail.com>

Great! thanks, this was quite useful.


On Fri, May 3, 2013 at 3:07 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> On 03/05/13 10:15, Ashok Anand wrote:
> > 1) what should I use to go through all messages in the queue,
> > currently, "./rabbitmqadmin get queue=qname requeue=true" gives only
> > head. does any such interface exists currently to get list of all
> > messages in the queue?
>
> You can retrieve more than one message by supplying the "count" parameter.
>
> I would recommend using a client library and writing the software to
> accomplish your goals. For your use-case b) all the operations (message
> retrieval, selective acknowledgement and requeueing) will need to be
> performed on the same channel, which precludes composing a sequence with
> multiple invocations of a commandline utility.
>
> > 2) Just the re-delivery flag is set, right? so the consume should not
> > assume that it is a retrial of the same message?
>
> The consumer can't distinguish between a message that was requeued due
> to exceptional circumstances (e.g. network disconnection while a message
> was unacknowledged) and a message that was explicitly requeued.
>
>
>
>
> -Emile
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/453bb535/attachment.htm>

From michael.s.klishin at gmail.com  Fri May  3 10:45:35 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 3 May 2013 13:45:35 +0400
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
 operations other than basic.publish
In-Reply-To: <03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
Message-ID: <CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>

2013/5/3 Tim Watson <tim at rabbitmq.com>

> Have you got a reproducible (ish) test that I can run on a linux box? If
> so, I'll poke around and make sure it's not showing up there too.


https://gist.github.com/michaelklishin/cea9aff14506e95def59

You'll need Ruby and RubyGems available.

Put all 3 files in a directory, then do

 * [sudo] gem install bundler
 * bundle install
 * run bundle exec ruby ./consumer.rb and bundle exec ruby ./producer.rb in
two tabs

You can tweak message rates and size in publisher.rb. If you want to see
methods
received from rabbit, run the consumer with BUNNY_LOG_LEVEL=debug.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/45cfa233/attachment.htm>

From simon at rabbitmq.com  Fri May  3 10:56:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 03 May 2013 10:56:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ Management API possible bug?
In-Reply-To: <79f8e773-f069-4557-8d45-04ce65b86932@googlegroups.com>
References: <79f8e773-f069-4557-8d45-04ce65b86932@googlegroups.com>
Message-ID: <518389E5.9060307@rabbitmq.com>

On 03/05/13 02:56, Stefan Sedich wrote:
> I notice in my response from /queues I get a message_stats: [ ], where I
> am expecting it to be { } if it is empty, this was working fine before I
> upgraded to 3.1, did anyone else notice this?

Ah. Good point. We'll fix that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From watson.timothy at gmail.com  Fri May  3 11:40:24 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 3 May 2013 11:40:24 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
Message-ID: <AB557C10-8505-4DFE-B6F1-B1C675E9AD67@rabbitmq.com>

Great. I'll give this a try.

Thanks,
Tim

On 3 May 2013, at 10:45, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 2013/5/3 Tim Watson <tim at rabbitmq.com>
> Have you got a reproducible (ish) test that I can run on a linux box? If so, I'll poke around and make sure it's not showing up there too.
> 
> https://gist.github.com/michaelklishin/cea9aff14506e95def59
> 
> You'll need Ruby and RubyGems available.
> 
> Put all 3 files in a directory, then do
> 
>  * [sudo] gem install bundler
>  * bundle install
>  * run bundle exec ruby ./consumer.rb and bundle exec ruby ./producer.rb in two tabs
>  
> You can tweak message rates and size in publisher.rb. If you want to see methods
> received from rabbit, run the consumer with BUNNY_LOG_LEVEL=debug.
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/85986f34/attachment.htm>

From gobadiah at gmail.com  Fri May  3 12:50:31 2013
From: gobadiah at gmail.com (Michael Journo)
Date: Fri, 3 May 2013 13:50:31 +0200
Subject: [rabbitmq-discuss] Automatic clustering
Message-ID: <CAMv=6V53M3vquW7x-hDRKgB0q1K5XnccCGf0AkRPJfZ28Cnd5w@mail.gmail.com>

Hello,

I'm using the very last rabbitmq version (3.1.0), with 3 nodes and I have
trouble clustering them in an automatic way (using rabbit.config). I'm not
sure it matters but 2 of the nodes are running debian 6 and one is running
debian 7 (beta). But anyway this happens even with only the two squeezes.

In short, if I don't specify any rabbit.config, and do the following :
<node1>: rabbitmq-server -detached
<node2>: rabbitmq-server -detached
<node2>: rabbitmqctl stop_app
<node2>: rabbitmqctl join_cluster rabbit@<node1>
<node2>: rabbitmqctl start_app
<node3>: rabbitmq-server -detached
<node3>: rabbitmqctl stop_app
<node3>: rabbitmqctl join_cluster rabbit@<node1>
<node3>: rabbitmqctl start_app

The cluster works perfectly, BUT if I try to set it up in the rabbit.config
file like so :

           {cluster_nodes, {['rabbit@<node1>', 'rabbit@<node2>',
'rabbit@<node3>'],
 disk}},

The first node I start does fine, but the other two crash every time.

Here are a few logs :

> *startup_err*

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

> *startup_log*

              RabbitMQ 3.1.0. Copyright (C) 2007-2013 VMware, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /var/log/rabbitmq/rabbit@<node2>.log
  ######  ##        /var/log/rabbitmq/rabbit@<node2>-sasl.log
  ##########
              Starting broker...

BOOT FAILED
===========

Error description:
   function_clause

Log files (may contain more information):
   /var/log/rabbitmq/rabbit@<node2>.log
   /var/log/rabbitmq/rabbit@<node2>-sasl.log

Stack trace:
   [{rabbit_table,create_local_copy,[disk],[]},
    {rabbit_mnesia,init_db,3,[]},
    {rabbit_mnesia,init_db_and_upgrade,3,[]},
    {rabbit_mnesia,init_from_config,0,[]},
    {rabbit_mnesia,init,0,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]},
    {rabbit,'-start/2-lc$^0/1-0-',1,[]}]



BOOT FAILED
===========

Error description:
   {could_not_start,rabbit,
       {bad_return,
           {{rabbit,start,[normal,[]]},
            {'EXIT',{rabbit,failure_during_boot,function_clause}}}}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit@<node2>.log
   /var/log/rabbitmq/rabbit@<node2>-sasl.log

{"init terminating in
do_boot",{rabbit,failure_during_boot,{could_not_start,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot,function_clause}}}}}}}

> *rabbit@<node2>.log*

=INFO REPORT==== 3-May-2013::13:25:11 ===
Starting RabbitMQ 3.1.0 on Erlang R15B01
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 3-May-2013::13:25:11 ===
node           : rabbit@<node2>
home dir       : /var/lib/rabbitmq
cookie hash    : *************************
log            : /var/log/rabbitmq/rabbit@<node2>.log
sasl log       : /var/log/rabbitmq/rabbit@<node2>-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit@<node2>

=INFO REPORT==== 3-May-2013::13:25:11 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 3-May-2013::13:25:11 ===
Error description:
   function_clause

Log files (may contain more information):
   /var/log/rabbitmq/rabbit@<node2>.log
   /var/log/rabbitmq/rabbit@<node2>-sasl.log

Stack trace:
   [{rabbit_table,create_local_copy,[disk],[]},
    {rabbit_mnesia,init_db,3,[]},
    {rabbit_mnesia,init_db_and_upgrade,3,[]},
    {rabbit_mnesia,init_from_config,0,[]},
    {rabbit_mnesia,init,0,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]},
    {rabbit,'-start/2-lc$^0/1-0-',1,[]}]


=INFO REPORT==== 3-May-2013::13:25:12 ===
Error description:
   {could_not_start,rabbit,
       {bad_return,
           {{rabbit,start,[normal,[]]},
            {'EXIT',{rabbit,failure_during_boot,function_clause}}}}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit@<node2>.log
   /var/log/rabbitmq/rabbit@<node2>-sasl.log

> *rabbit@<node2>-sasl.log*

=CRASH REPORT==== 3-May-2013::13:25:12 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.70.0>
    registered_name: []
    exception exit: {bad_return,
                        {{rabbit,start,[normal,[]]},
                         {'EXIT',
                             {rabbit,failure_during_boot,function_clause}}}}
      in function  application_master:init/4 (application_master.erl, line
138)
    ancestors: [<0.69.0>]
    messages: [{'EXIT',<0.71.0>,normal}]
    links: [<0.69.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 206
  neighbours:

I'll trying differents things but any help would be appreciated.

Thanks !

-- 
michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/073346b4/attachment.htm>

From simon at rabbitmq.com  Fri May  3 12:53:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 03 May 2013 12:53:48 +0100
Subject: [rabbitmq-discuss] Automatic clustering
In-Reply-To: <CAMv=6V53M3vquW7x-hDRKgB0q1K5XnccCGf0AkRPJfZ28Cnd5w@mail.gmail.com>
References: <CAMv=6V53M3vquW7x-hDRKgB0q1K5XnccCGf0AkRPJfZ28Cnd5w@mail.gmail.com>
Message-ID: <5183A54C.1090808@rabbitmq.com>

On 03/05/13 12:50, Michael Journo wrote:
> disk

That should be 'disc'.

And we should be handling that better.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May  3 13:10:19 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 03 May 2013 13:10:19 +0100
Subject: [rabbitmq-discuss] Hanging connections in management interface
 (v3.0.4)
In-Reply-To: <CAO98qLayjmgPQVRkNYiyEvLtTM_S-NE9zWF=WyNqt-jr29gdWA@mail.gmail.com>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
	<517F9271.4090906@rabbitmq.com>
	<CAO98qLZ7v1T6N=q27gonQ7ObHZMcz90nEej_6O4vLt5jWXXYLA@mail.gmail.com>
	<517FCF6C.5090105@rabbitmq.com>
	<CAO98qLayjmgPQVRkNYiyEvLtTM_S-NE9zWF=WyNqt-jr29gdWA@mail.gmail.com>
Message-ID: <5183A92B.4080204@rabbitmq.com>

On 01/05/13 17:35, Allan Beaufour wrote:
> I'll send that off list.

Thanks.

> This cleared that connection. The really weird thing is that lsof only
> shows that connection on the server, not on the client. I.e. I could
> find this on the server:

Hmm. That's very suspicious.

So this is a very different scenario to the known issue I initially 
suggested. These connections really are there from the point of view of 
the server. If lsof is giving contradictory results on client vs server 
then that implies the problem is at a TCP level rather than AMQP.

Could there be a firewall or something which is interfering with the way 
TCP connections are torn down?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From gobadiah at gmail.com  Fri May  3 13:24:04 2013
From: gobadiah at gmail.com (Michael Journo)
Date: Fri, 3 May 2013 14:24:04 +0200
Subject: [rabbitmq-discuss] Automatic clustering
In-Reply-To: <5183A54C.1090808@rabbitmq.com>
References: <CAMv=6V53M3vquW7x-hDRKgB0q1K5XnccCGf0AkRPJfZ28Cnd5w@mail.gmail.com>
	<5183A54C.1090808@rabbitmq.com>
Message-ID: <CAMv=6V4h4YJb4c4YdEXuULDhY=RKd=e+oTy+sSRD=4-Gy2obqA@mail.gmail.com>

I do agree with but damn do I look like a fool..

Thanks !


2013/5/3 Simon MacMullen <simon at rabbitmq.com>

> On 03/05/13 12:50, Michael Journo wrote:
>
>> disk
>>
>
> That should be 'disc'.
>
> And we should be handling that better.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/1fac0dae/attachment.htm>

From allan at chartbeat.com  Fri May  3 13:25:08 2013
From: allan at chartbeat.com (Allan Beaufour)
Date: Fri, 3 May 2013 08:25:08 -0400
Subject: [rabbitmq-discuss] Hanging connections in management interface
	(v3.0.4)
In-Reply-To: <5183A92B.4080204@rabbitmq.com>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
	<517F9271.4090906@rabbitmq.com>
	<CAO98qLZ7v1T6N=q27gonQ7ObHZMcz90nEej_6O4vLt5jWXXYLA@mail.gmail.com>
	<517FCF6C.5090105@rabbitmq.com>
	<CAO98qLayjmgPQVRkNYiyEvLtTM_S-NE9zWF=WyNqt-jr29gdWA@mail.gmail.com>
	<5183A92B.4080204@rabbitmq.com>
Message-ID: <CAO98qLaXqF=c3SgKcC-09F5ocNSYP-MxJ17BBjRwHVdThpMJaQ@mail.gmail.com>

On Fri, May 3, 2013 at 8:10 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

>
>  This cleared that connection. The really weird thing is that lsof only
>> shows that connection on the server, not on the client. I.e. I could
>> find this on the server:
>>
>
> Hmm. That's very suspicious.
>
> So this is a very different scenario to the known issue I initially
> suggested. These connections really are there from the point of view of the
> server. If lsof is giving contradictory results on client vs server then
> that implies the problem is at a TCP level rather than AMQP.
>

Yes, they are indeed there on the server. It makes no sense to me how they
can be, while not being on the server. I find it hard to believe myself.


> Could there be a firewall or something which is interfering with the way
> TCP connections are torn down?


It's running on Amazon EC2, so who knows. But now that I think of it I
should probably take it up with them, maybe that's where the issue really
is. But since there's no IPv6 support on Amazon, we should probably just
disable it altogether and that might take care of the issue.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/8f4bd8be/attachment.htm>

From lionel.cons at cern.ch  Fri May  3 13:44:41 2013
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 3 May 2013 14:44:41 +0200
Subject: [rabbitmq-discuss] How to get the space used on disk?
Message-ID: <20130503143602.6fe3.abe10f7e5afbbb3a79ce619739541149@cern.ch>

In the management console/api, for most quantities, we get both the amount
used and the maximum. For instance:
 - File descriptors: fd_used=46 fd_total=131072
 - Erlang processes: proc_used=291 proc_total=1048576
 - ...

However, for the disk space, we can only get: disk_free and disk_free_limit.

Is there any way to get the disk used?

In case RabbitMQ shares its partition with other processes, what matters is
not really the disk free (in the partition) but rather the disk usage wrt
the maximum expected.

Cheers,

Lionel

From dave at performantsoftware.com  Fri May  3 13:59:15 2013
From: dave at performantsoftware.com (Dave Goldstein)
Date: Fri, 3 May 2013 08:59:15 -0400
Subject: [rabbitmq-discuss] Unexpected blocking in channel.basicGet()
Message-ID: <CAFCYt5NEoLMuCdi+=dBNZwG-7=Vbyx-Fto3-mOrJ6rHdTTaAZg@mail.gmail.com>

Folks,

I am seeing a periodic and unexpected block in the call to
channel.basicGet(). My understanding is that this is a non-blocking call
but in this case, the call never returns and no error is thrown.

I am specifying autoack on an autodelete queue. Am I doing something wrong
here?

Any input appreciated...

Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/a23b630d/attachment.htm>

From watson.timothy at gmail.com  Fri May  3 14:20:50 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 3 May 2013 14:20:50 +0100
Subject: [rabbitmq-discuss] Unexpected blocking in channel.basicGet()
In-Reply-To: <CAFCYt5NEoLMuCdi+=dBNZwG-7=Vbyx-Fto3-mOrJ6rHdTTaAZg@mail.gmail.com>
References: <CAFCYt5NEoLMuCdi+=dBNZwG-7=Vbyx-Fto3-mOrJ6rHdTTaAZg@mail.gmail.com>
Message-ID: <486972D8-E891-4398-B658-4A84295BC78A@rabbitmq.com>

On 3 May 2013, at 13:59, Dave Goldstein <dave at performantsoftware.com> wrote:

> Folks,
> 
> I am seeing a periodic and unexpected block in the call to channel.basicGet(). My understanding is that this is a non-blocking call

No, it's a synchronous dialogue, so the client will wait for get_ok | get_empty.

Cheers,
Tim

From matt at soupmatt.com  Fri May  3 16:19:20 2013
From: matt at soupmatt.com (Matt Campbell)
Date: Fri, 3 May 2013 08:19:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Bug/Behavior Change in binds to header exchanges
	in rabbitmq 3.1.0
Message-ID: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>

In rabbit 3.0.4 and 2.8.7, I was able to bind a queue to a headers exchange 
without specifying any bind arguments, which resulted in that queue 
receiving all the messages. In rabbit 3.1.0, when I make that same bind I 
get an error message telling me I must include the "x-match" header. While 
this is an irritation for clients that use AMQP or the HTTP API to create 
the binds (because they require a code change), I have some clients that 
bind queues to this exchange via STOMP and I am unaware of how to get that 
header set through a STOMP subscribe to that exchange.

Is this an intended behavior change going forward, or is this a bug in 
rabbitmq 3.1.0?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/bfc8a32a/attachment.htm>

From dave at performantsoftware.com  Fri May  3 16:53:10 2013
From: dave at performantsoftware.com (Dave Goldstein)
Date: Fri, 3 May 2013 11:53:10 -0400
Subject: [rabbitmq-discuss] Unexpected blocking in channel.basicGet()
In-Reply-To: <486972D8-E891-4398-B658-4A84295BC78A@rabbitmq.com>
References: <CAFCYt5NEoLMuCdi+=dBNZwG-7=Vbyx-Fto3-mOrJ6rHdTTaAZg@mail.gmail.com>
	<486972D8-E891-4398-B658-4A84295BC78A@rabbitmq.com>
Message-ID: <CAFCYt5MUVm6+zYVqEqQif8ViQbKJzA8fQUWQLsa5pqACNCjjrQ@mail.gmail.com>

Tim,

So if the call blocks indefinitely without erroring out, what does that
suggest and is there any way for me to recover from this beyond detecting
and killing the thread?

BTW, I was running client 3.0.1 and have just moved to 3.0.4 to see if the
behavior changes.

Thanks in advance...

Dave


On Fri, May 3, 2013 at 9:20 AM, Tim Watson <watson.timothy at gmail.com> wrote:

> On 3 May 2013, at 13:59, Dave Goldstein <dave at performantsoftware.com>
> wrote:
>
> > Folks,
> >
> > I am seeing a periodic and unexpected block in the call to
> channel.basicGet(). My understanding is that this is a non-blocking call
>
> No, it's a synchronous dialogue, so the client will wait for get_ok |
> get_empty.
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/aca871d7/attachment.htm>

From tim at rabbitmq.com  Fri May  3 17:19:02 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 3 May 2013 17:19:02 +0100
Subject: [rabbitmq-discuss] Unexpected blocking in channel.basicGet()
In-Reply-To: <CAFCYt5MUVm6+zYVqEqQif8ViQbKJzA8fQUWQLsa5pqACNCjjrQ@mail.gmail.com>
References: <CAFCYt5NEoLMuCdi+=dBNZwG-7=Vbyx-Fto3-mOrJ6rHdTTaAZg@mail.gmail.com>
	<486972D8-E891-4398-B658-4A84295BC78A@rabbitmq.com>
	<CAFCYt5MUVm6+zYVqEqQif8ViQbKJzA8fQUWQLsa5pqACNCjjrQ@mail.gmail.com>
Message-ID: <03BC24AE-9691-495B-9FF4-80B4E753B392@rabbitmq.com>

On 3 May 2013, at 16:53, Dave Goldstein wrote:

> So if the call blocks indefinitely without erroring out, what does that suggest 
> 

The usual suspect is a network connectivity problem, either due to an interruption in service, broker failure/crash/restart or intermediate network kit (such as firewalls). A typical TCP/IP stack can take quite a long time to "notice" the peer socket has "disappeared", while the client is sat waiting for a reply.

> and is there any way for me to recover from this beyond detecting and killing the thread?

Unfortunately there aren't any silver bullet solutions to this kind of problem. Detecting an idle worker (based on whatever your definition of "idle" happens to be) and killing it is certinaly the must common approach. Bear in mind that the OS networking stack is already trying to 'detect' the problem, and it's unlikely you'll be able to improve on what it is doing.

It might help if you enable AMQP heartbeats in your client, which would at least detect an unresponsive network connection in a timely fashion. These will do the job of killing the connection and any channels for you, so at least you don't have to home bake a solution based on killing threads. The other thing that might help is to consider turning on TCP keep-alives in your OS networking configuration. These perform a similar function, but at a much lower level, however they come with overheads and caveats that they might affect your application (and/or other network interactions taking place on the machine) in a wide variety of ways.

> BTW, I was running client 3.0.1 and have just moved to 3.0.4 to see if the behavior changes.
>  

This won't have changed between releases, if I've diagnosed it correctly at least.

Cheers,
Tim

From dave at performantsoftware.com  Fri May  3 18:06:53 2013
From: dave at performantsoftware.com (Dave Goldstein)
Date: Fri, 3 May 2013 13:06:53 -0400
Subject: [rabbitmq-discuss] Unexpected blocking in channel.basicGet()
In-Reply-To: <03BC24AE-9691-495B-9FF4-80B4E753B392@rabbitmq.com>
References: <CAFCYt5NEoLMuCdi+=dBNZwG-7=Vbyx-Fto3-mOrJ6rHdTTaAZg@mail.gmail.com>
	<486972D8-E891-4398-B658-4A84295BC78A@rabbitmq.com>
	<CAFCYt5MUVm6+zYVqEqQif8ViQbKJzA8fQUWQLsa5pqACNCjjrQ@mail.gmail.com>
	<03BC24AE-9691-495B-9FF4-80B4E753B392@rabbitmq.com>
Message-ID: <CAFCYt5Nvrx6RK3rpjV5XQ2zvZstKdJ3wZLDweKJfuHoi71MeJQ@mail.gmail.com>

Thanks for the informative response; I appreciate the insight.

Dave


On Fri, May 3, 2013 at 12:19 PM, Tim Watson <tim at rabbitmq.com> wrote:

> On 3 May 2013, at 16:53, Dave Goldstein wrote:
>
> > So if the call blocks indefinitely without erroring out, what does that
> suggest
> >
>
> The usual suspect is a network connectivity problem, either due to an
> interruption in service, broker failure/crash/restart or intermediate
> network kit (such as firewalls). A typical TCP/IP stack can take quite a
> long time to "notice" the peer socket has "disappeared", while the client
> is sat waiting for a reply.
>
> > and is there any way for me to recover from this beyond detecting and
> killing the thread?
>
> Unfortunately there aren't any silver bullet solutions to this kind of
> problem. Detecting an idle worker (based on whatever your definition of
> "idle" happens to be) and killing it is certinaly the must common approach.
> Bear in mind that the OS networking stack is already trying to 'detect' the
> problem, and it's unlikely you'll be able to improve on what it is doing.
>
> It might help if you enable AMQP heartbeats in your client, which would at
> least detect an unresponsive network connection in a timely fashion. These
> will do the job of killing the connection and any channels for you, so at
> least you don't have to home bake a solution based on killing threads. The
> other thing that might help is to consider turning on TCP keep-alives in
> your OS networking configuration. These perform a similar function, but at
> a much lower level, however they come with overheads and caveats that they
> might affect your application (and/or other network interactions taking
> place on the machine) in a wide variety of ways.
>
> > BTW, I was running client 3.0.1 and have just moved to 3.0.4 to see if
> the behavior changes.
> >
>
> This won't have changed between releases, if I've diagnosed it correctly
> at least.
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/f455c072/attachment.htm>

From mpietrek at skytap.com  Fri May  3 21:39:36 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 3 May 2013 13:39:36 -0700
Subject: [rabbitmq-discuss] Publish behavior during 3.1 eager
	synchronisation?
Message-ID: <CACLE7ixg-yUgWN0cBQw=iAWnZD2GLLB4z_729Oh_SVX-ZH6kTw@mail.gmail.com>

Perhaps this is answered from the docs, but if so I missed it.

The docs say "Since the queue becomes unresponsive while synchronisation is
occurring..."

Our clients use transactions to ensure our publishes are synchronous and
commited by the time the call returns. Will these publishes simply block,
possibly longer, if an eager sync is in progress? Or will the publish fail
for some reason.

I suspect the former, but just want to confirm to ease possible concerns by
others here.

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130503/34f2b199/attachment.htm>

From srd at duneram.com  Fri May  3 22:06:00 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Fri, 03 May 2013 21:06:00 +0000
Subject: [rabbitmq-discuss] =?iso-8859-1?q?rabbitmqctl=2C_rabbitmq-server?=
	=?iso-8859-1?q?=2C_rabbitmq-plugins_--_same_script=3F?=
In-Reply-To: <20130503143602.6fe3.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20130503143602.6fe3.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <20130503210600.26073.qmail@hoster904.com>


Hi,
I managed to get two nodes clustered together and am now working on my third node which for some reason isn't happening all that quickly.

However in the process of doing diffs I noticed the 3 scripts in the subject line are all identical.

Is this intended?   In the process of trying to get the first two nodes clustered, I tried putting in values into the rabbitmqctl and rabbitmq-server scripts but in the end ended up not making changes there. -- (which explains the date/time differences)

Here is what I found about these scripts:   (they appear to be identical)

[joe at test sbin]$  which rabbitmqctl
/usr/sbin/rabbitmqctl
[joe at test sbin]$  which rabbitmq-server
/usr/sbin/rabbitmq-server
[joe at test sbin]$  ls -altr rabbitmqctl rabbitmq-server rabbitmq-plugins
-rwxr-xr-x 1 root root 1423 Mar 12 13:07 rabbitmq-plugins
-rwxr-xr-x 1 root root 1423 May  1 11:42 rabbitmqctl
-rwxr-xr-x 1 root root 1423 May  1 15:13 rabbitmq-server
[joe at test sbin]$  diff rabbitmq-plugins rabbitmqctl
[joe at test sbin]$  diff rabbitmqctl rabbitmq-server
[joe at test sbin]$

From michael.s.klishin at gmail.com  Fri May  3 22:14:34 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 4 May 2013 01:14:34 +0400
Subject: [rabbitmq-discuss] rabbitmqctl, rabbitmq-server,
 rabbitmq-plugins -- same script?
In-Reply-To: <20130503210600.26073.qmail@hoster904.com>
References: <20130503143602.6fe3.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<20130503210600.26073.qmail@hoster904.com>
Message-ID: <CAE3HoVS5fEtoVBPct1sk-0iSrzCR8rOvCiXLduXz2z7dcQGf7g@mail.gmail.com>

2013/5/4 srd <srd at duneram.com>

> However in the process of doing diffs I noticed the 3 scripts in the
> subject line are all identical.
>
> Is this intended?
>

No, they are not supposed to be the same.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130504/3e6834ca/attachment.htm>

From vieuxtech at gmail.com  Fri May  3 21:15:52 2013
From: vieuxtech at gmail.com (Sam Roberts)
Date: Fri, 3 May 2013 13:15:52 -0700
Subject: [rabbitmq-discuss] while would a close/fin of a connection elicit a
	reset/rst by rabbitmq?
Message-ID: <CA+Sj9TnBSR6-7T7THcQGc--1TH2yjhuNL68LGSW3WwiwKBHG4g@mail.gmail.com>

Some of my rabbitmq servers don't do graceful closes, no idea why.
This is a localhost unit test, it is just opening a connection, then
closing it, and now the outgoing close is eliciting a reset.

The log doesn't say much, is there any way to increase its verbosity?

With rabbitmq 3.0.4, on debian, installed from the rmq apt repo.


=INFO REPORT==== 3-May-2013::19:24:52 ===
accepting AMQP connection <0.624.0> (127.0.0.1:37518 -> 127.0.0.1:5672)

=WARNING REPORT==== 3-May-2013::19:24:52 ===
closing AMQP connection <0.624.0> (127.0.0.1:37518 -> 127.0.0.1:5672):
connection_closed_abruptly



 % tshark -r rst.pcap
  1   0.000000    127.0.0.1 37490 127.0.0.1    5672 TCP 74 37490 >
amqp [SYN] Seq=0 Win=32792 Len=0 MSS=16396 SACK_PERM=1 TSval=187898
TSecr=0 WS=128
  2   0.000016    127.0.0.1 5672 127.0.0.1    37490 TCP 74 amqp >
37490 [SYN, ACK] Seq=0 Ack=1 Win=32768 Len=0 MSS=16396 SACK_PERM=1
TSval=187898 TSecr=187898 WS=128
  3   0.000029    127.0.0.1 37490 127.0.0.1    5672 TCP 66 37490 >
amqp [ACK] Seq=1 Ack=1 Win=32896 Len=0 TSval=187898 TSecr=187898
  4   0.001896    127.0.0.1 37490 127.0.0.1    5672 TCP 74 37490 >
amqp [PSH, ACK] Seq=1 Ack=1 Win=32896 Len=8 TSval=187898
TSecr=187898AMQP (unknown version)
  5   0.001907    127.0.0.1 5672 127.0.0.1    37490 TCP 66 amqp >
37490 [ACK] Seq=1 Ack=9 Win=32768 Len=0 TSval=187898 TSecr=187898
  6   0.002137    127.0.0.1 5672 127.0.0.1    37490 AMQP 401 Connection.Start
  7   0.002212    127.0.0.1 37490 127.0.0.1    5672 TCP 66 37490 >
amqp [ACK] Seq=9 Ack=336 Win=33920 Len=0 TSval=187898 TSecr=187898
  8   0.008035    127.0.0.1 37490 127.0.0.1    5672 AMQP 202 Connection.Start-Ok
  9   0.008179    127.0.0.1 5672 127.0.0.1    37490 AMQP 86 Connection.Tune
 10   0.009737    127.0.0.1 37490 127.0.0.1    5672 AMQP 86 Connection.Tune-Ok
 11   0.046865    127.0.0.1 5672 127.0.0.1    37490 TCP 66 amqp >
37490 [ACK] Seq=356 Ack=165 Win=33920 Len=0 TSval=187910 TSecr=187900
 12   0.046876    127.0.0.1 37490 127.0.0.1    5672 AMQP 82 Connection.Open
 13   0.046882    127.0.0.1 5672 127.0.0.1    37490 TCP 66 amqp >
37490 [ACK] Seq=356 Ack=181 Win=33920 Len=0 TSval=187910 TSecr=187910
 14   0.046977    127.0.0.1 5672 127.0.0.1    37490 AMQP 79 Connection.Open-Ok
 15   0.048131    127.0.0.1 37490 127.0.0.1    5672 TCP 66 37490 >
amqp [FIN, ACK] Seq=181 Ack=369 Win=33920 Len=0 TSval=187910
TSecr=187910
 16   0.048208    127.0.0.1 5672 127.0.0.1    37490 TCP 66 amqp >
37490 [RST, ACK] Seq=369 Ack=182 Win=33920 Len=0 TSval=187910
TSecr=187910

From matthias at rabbitmq.com  Fri May  3 23:19:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 May 2013 23:19:23 +0100
Subject: [rabbitmq-discuss] rabbitmqctl, rabbitmq-server,
 rabbitmq-plugins -- same script?
In-Reply-To: <CAE3HoVS5fEtoVBPct1sk-0iSrzCR8rOvCiXLduXz2z7dcQGf7g@mail.gmail.com>
References: <20130503143602.6fe3.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<20130503210600.26073.qmail@hoster904.com>
	<CAE3HoVS5fEtoVBPct1sk-0iSrzCR8rOvCiXLduXz2z7dcQGf7g@mail.gmail.com>
Message-ID: <518437EB.7020900@rabbitmq.com>

On 03/05/13 22:14, Michael Klishin wrote:
>
> 2013/5/4 srd <srd at duneram.com <mailto:srd at duneram.com>>
>
>     However in the process of doing diffs I noticed the 3 scripts in the
>     subject line are all identical.
>
>     Is this intended?
>
>
> No, they are not supposed to be the same.

Actually, they are...on package-installed rabbits. The scripts in 
/usr/sbin are just wrappers that execute the real scripts as the correct 
user. A little bit of shell magic going on there.

Matthias.

From rev.chip at gmail.com  Sun May  5 09:03:22 2013
From: rev.chip at gmail.com (Reverend Chip)
Date: Sun, 05 May 2013 01:03:22 -0700
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <CAE3HoVRjjwkPUKFJGfdjnhQnPFCjLa=kuVONztfbvpxR-Oui8g@mail.gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
	<5180F745.6090307@rabbitmq.com>
	<CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
	<CANSL5VEy8AppF6YE2bS366FRsV0MifpU3qD4Rf22jtmf_jqGHA@mail.gmail.com>
	<CAE3HoVQ8i5ife5N_FAbcDqq1JUzF9u50FKHB3ehKeok-W7fQKw@mail.gmail.com>
	<CANSL5VH8JgREodAYvVJX3bumRD9OGXPp+srfGUdepEuSHPYogg@mail.gmail.com>
	<CAE3HoVRjjwkPUKFJGfdjnhQnPFCjLa=kuVONztfbvpxR-Oui8g@mail.gmail.com>
Message-ID: <5186124A.10307@gmail.com>

On 5/2/2013 11:07 PM, Michael Klishin wrote:
> 2013/5/3 Chip Salzenberg <rev.chip at gmail.com <mailto:rev.chip at gmail.com>>
>
>     Why should nonexistent queue at start be a channel exception, but
>     nonexistent queue later not be one?  Makes no sense to me.
>
>
> Because when you start consuming, you have a chance to recover from a
> queue that does not exist. When the queue is deleted
> later, you don't necessarily have an easy way to do so.

Hm.  Doesn't seem to make any sense to me, still.  It means you can't
have more than one consume safely on a given channel.  Goofy.  No
matter, still.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130505/f38c30af/attachment.htm>

From michael.s.klishin at gmail.com  Sun May  5 10:49:02 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 5 May 2013 13:49:02 +0400
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <5186124A.10307@gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
	<5180F745.6090307@rabbitmq.com>
	<CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
	<CANSL5VEy8AppF6YE2bS366FRsV0MifpU3qD4Rf22jtmf_jqGHA@mail.gmail.com>
	<CAE3HoVQ8i5ife5N_FAbcDqq1JUzF9u50FKHB3ehKeok-W7fQKw@mail.gmail.com>
	<CANSL5VH8JgREodAYvVJX3bumRD9OGXPp+srfGUdepEuSHPYogg@mail.gmail.com>
	<CAE3HoVRjjwkPUKFJGfdjnhQnPFCjLa=kuVONztfbvpxR-Oui8g@mail.gmail.com>
	<5186124A.10307@gmail.com>
Message-ID: <CAE3HoVRkAW2hq94hWOba-Mq6YdFc8x9SBf70BnsN-pSfM_fmwg@mail.gmail.com>

2013/5/5 Reverend Chip <rev.chip at gmail.com>

> Hm.  Doesn't seem to make any sense to me, still.  It means you can't have
> more than one consume safely on a given channel.  Goofy.  No matter, still.


All it means is that when the client initiates an operation, it typically
has a context to recover from channel closure.
When the broker initiates cancellation, you often don't have sufficient
context to recover.

I can't see how that translates into "you can't have more than one consumer
safely on a given channel".

(resending to the list)
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130505/8101d9fc/attachment.htm>

From k.madnani84 at gmail.com  Sun May  5 09:34:59 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Sun, 5 May 2013 01:34:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Using Load balancer(HA Proxy) while Federating
	of clusters.
Message-ID: <1367742899428-26436.post@n5.nabble.com>

Hi,

I am having a configuration where in i have two different clusters(say C1 &
C2) and each with 3 nodes.
C1-N1,N2,N3
C2-N4,N5,N6.

If I want to federate cluster C1 to cluster C2 do i need to federate the
cluster C1 to each of the above node N4,N5,N6 ?

If suppose i want to implement load balancing along with federation what
changes do i need to make in the config file of my HAProxy?





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Using-Load-balancer-HA-Proxy-while-Federating-of-clusters-tp26436.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From reddylast at gmail.com  Mon May  6 07:42:22 2013
From: reddylast at gmail.com (reddylast)
Date: Sun, 5 May 2013 23:42:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RMQ clustering not working on Cloud servers.
Message-ID: <1367822541903-26438.post@n5.nabble.com>

Hi,

Recently I've started to setup RMQ clustering on my cloud severs
(http://www.rabbitmq.com/clustering.html).
When I'm trying to setup clustering between a dedicated server and a cloud
sever then it works fine. But, when I'm doing same between two cloud severs
then it does not work. Please note, all cloud severs can listen each other
on the necessary ports (5672 and 4369). I can telnet all severs
(clouds/dedicated) from one to another. Can anyone please help me to figure
out what could be the possible issue ?

Thanks
Reddy.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RMQ-clustering-not-working-on-Cloud-servers-tp26438.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Mon May  6 07:45:34 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 6 May 2013 10:45:34 +0400
Subject: [rabbitmq-discuss] RMQ clustering not working on Cloud servers.
In-Reply-To: <1367822541903-26438.post@n5.nabble.com>
References: <1367822541903-26438.post@n5.nabble.com>
Message-ID: <CAE3HoVR4ZyVeLaCHi-vwnvBjMrttov3uSCR74RFd5zoDqMnw=g@mail.gmail.com>

2013/5/6 reddylast <reddylast at gmail.com>

> But, when I'm doing same between two cloud severs
> then it does not work
>

Can you be more specific? Are there any error messages
in the log?

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/089d7960/attachment.htm>

From brett.r.cameron at gmail.com  Mon May  6 07:48:40 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Mon, 6 May 2013 18:48:40 +1200
Subject: [rabbitmq-discuss] RMQ clustering not working on Cloud servers.
In-Reply-To: <1367822541903-26438.post@n5.nabble.com>
References: <1367822541903-26438.post@n5.nabble.com>
Message-ID: <CALPqkirD+yKw0KVsQbmvNUvtBykApRfE=nEwba=pxK9vdN1e+A@mail.gmail.com>

Reddy,

You need more than just 5672 and 4367 open on the firewall. See comments
about inet_dist_listen_min and inet_dist_listen_max at
http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/.
May or may not be the problem - would need more info to say for sure.

Brett


On Mon, May 6, 2013 at 6:42 PM, reddylast <reddylast at gmail.com> wrote:

> Hi,
>
> Recently I've started to setup RMQ clustering on my cloud severs
> (http://www.rabbitmq.com/clustering.html).
> When I'm trying to setup clustering between a dedicated server and a cloud
> sever then it works fine. But, when I'm doing same between two cloud severs
> then it does not work. Please note, all cloud severs can listen each other
> on the necessary ports (5672 and 4369). I can telnet all severs
> (clouds/dedicated) from one to another. Can anyone please help me to figure
> out what could be the possible issue ?
>
> Thanks
> Reddy.
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/RMQ-clustering-not-working-on-Cloud-servers-tp26438.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/6e3ac289/attachment.htm>

From reddylast at gmail.com  Mon May  6 08:00:32 2013
From: reddylast at gmail.com (reddylast)
Date: Mon, 6 May 2013 00:00:32 -0700 (PDT)
Subject: [rabbitmq-discuss] RMQ clustering not working on Cloud servers.
In-Reply-To: <CAE3HoVR4ZyVeLaCHi-vwnvBjMrttov3uSCR74RFd5zoDqMnw=g@mail.gmail.com>
References: <1367822541903-26438.post@n5.nabble.com>
	<CAE3HoVR4ZyVeLaCHi-vwnvBjMrttov3uSCR74RFd5zoDqMnw=g@mail.gmail.com>
Message-ID: <1367823632669-26441.post@n5.nabble.com>

Hi MK,

Thanks for your quick response. Here is the logged error which I found in
cloud01 sever:


=ERROR REPORT==== 5-May-2013::04:02:30 ===
Mnesia(rabbit at cloud01): ** ERROR ** Mnesia on rabbit at cloud01 could not
connect to node(s) ['rabbit at cloud02-server']


Thanks,
Reddy






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RMQ-clustering-not-working-on-Cloud-servers-tp26438p26441.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From macmillan.josh09 at gmail.com  Sun May  5 23:48:47 2013
From: macmillan.josh09 at gmail.com (macmillan.josh09 at gmail.com)
Date: Sun, 5 May 2013 15:48:47 -0700 (PDT)
Subject: [rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
Message-ID: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>

My Node.js worker crashes (RECONDITION_FAILED - unknown delivery tag) if 
the following 2 conditions are met: 

1. I start it AFTER the queue have at least 2 messages. 
2. The q.shift() is in an async code.

http://pastebin.com/uMQJn0Fe   


   // index.js
   var amqp = require('amqp');
    
   var connection = null;
    
   connection = amqp.createConnection({ host: 'foo.com' });
    
   connection.on('ready', function () {
     connection.queue('loc', { durable: true, autoDelete: false}, function(q
   ) {
       q.bind('main', 'loc');
       q.subscribe({ack:true, prefetchCount: 0}, function (message, headers,deliveryInfo
   ) {
         console.log(message);
         setTimeout(function() { q.shift(); }, 100);
       });
     });
   });
    
   my worker crashes only I run it AFTER there are messages in the queue. ifI run the worker BEFORE
   , everything is ok.
    
   I use ab to add 2 messages to the queue:
   ab -k -n 2 -c 1 -p post-data -T 'application/json' foo-api.com/publish
    
   And now run my worker - node index.js
   here is the outputs:
    
   { topic: 'loc',
     sourceCode: 'LOC',
     sourceRecordID: '690599224',
     sourceField: 'Phone',
     sourceFieldValue: '7572007395',
     actionCode: 'DISP',
     actionDescription: 'Disconnected Phone Number' 
   }
   { topic: 'loc',
     sourceCode: 'LOC',
     sourceRecordID: '690599224',
     sourceField: 'Phone',
     sourceFieldValue: '7572007395',
     actionCode: 'DISP',
     actionDescription: 'Disconnected Phone Number' 
   }
    
   events.js:72
           throw er; // Unhandled 'error' event
                 ^
   Error: PRECONDITION_FAILED - unknown delivery tag 2
       at Queue._onMethod (/Users/ogolan/projects/quai-loc/worker/
   node_modules/amqp/amqp.js:1979:15)
       at Queue.Channel._onChannelMethod (/Users/ogolan/projects/quai-loc/
   worker/node_modules/amqp/amqp.js:1557:14)
       at Connection._onMethod (/Users/ogolan/projects/quai-loc/worker/
   node_modules/amqp/amqp.js:1088:28)
       at AMQPParser.parser.onMethod (/Users/ogolan/projects/quai-loc/worker
   /node_modules/amqp/amqp.js:897:12)
       at AMQPParser._parseMethodFrame (/Users/ogolan/projects/quai-loc/
   worker/node_modules/amqp/amqp.js:451:10)
       at frameEnd (/Users/ogolan/projects/quai-loc/worker/node_modules/amqp
   /amqp.js:192:16)
       at frame (/Users/ogolan/projects/quai-loc/worker/node_modules/amqp/
   amqp.js:177:14)
       at AMQPParser.header [as parse] (/Users/ogolan/projects/quai-loc/
   worker/node_modules/amqp/amqp.js:163:14)
       at AMQPParser.execute (/Users/ogolan/projects/quai-loc/worker/
   node_modules/amqp/amqp.js:236:21)
       at Connection.<anonymous> (/Users/ogolan/projects/quai-loc/worker/
   node_modules/amqp/amqp.js:935:14)
   



any ideas?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130505/72dc5e16/attachment.htm>

From macmillan.josh09 at gmail.com  Sun May  5 23:54:02 2013
From: macmillan.josh09 at gmail.com (macmillan.josh09 at gmail.com)
Date: Sun, 5 May 2013 15:54:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
In-Reply-To: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>
References: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>
Message-ID: <07dcbb48-01c1-4dc6-848f-faf7696d94f4@googlegroups.com>

btw, this is how my API is publishing to the queue:

exchange = connection.exchange('main', { durable: true });
exchange.publish('loc' , { some data in json format }, {deliveryMode: 2});

On Sunday, May 5, 2013 3:48:47 PM UTC-7, macmilla... at gmail.com wrote:
>
> My Node.js worker crashes (RECONDITION_FAILED - unknown delivery tag) if 
> the following 2 conditions are met: 
>
> 1. I start it AFTER the queue have at least 2 messages. 
> 2. The q.shift() is in an async code.
>
> http://pastebin.com/uMQJn0Fe   
>
>
>    // index.js
>    var amqp = require('amqp');
>     
>    var connection = null;
>     
>    connection = amqp.createConnection({ host: 'foo.com' });
>     
>    connection.on('ready', function () {
>      connection.queue('loc', { durable: true, autoDelete: false}, function
>    (q) {
>        q.bind('main', 'loc');
>        q.subscribe({ack:true, prefetchCount: 0}, function (message,headers
>    , deliveryInfo) {
>          console.log(message);
>          setTimeout(function() { q.shift(); }, 100);
>        });
>      });
>    });
>     
>    my worker crashes only I run it AFTER there are messages in the queue. 
>    if I run the worker BEFORE, everything is ok.
>     
>    I use ab to add 2 messages to the queue:
>    ab -k -n 2 -c 1 -p post-data -T 'application/json' foo-api.com/publish
>     
>    And now run my worker - node index.js
>    here is the outputs:
>     
>    { topic: 'loc',
>      sourceCode: 'LOC',
>      sourceRecordID: '690599224',
>      sourceField: 'Phone',
>      sourceFieldValue: '7572007395',
>      actionCode: 'DISP',
>      actionDescription: 'Disconnected Phone Number' 
>    }
>    { topic: 'loc',
>      sourceCode: 'LOC',
>      sourceRecordID: '690599224',
>      sourceField: 'Phone',
>      sourceFieldValue: '7572007395',
>      actionCode: 'DISP',
>      actionDescription: 'Disconnected Phone Number' 
>    }
>     
>    events.js:72
>            throw er; // Unhandled 'error' event
>                  ^
>    Error: PRECONDITION_FAILED - unknown delivery tag 2
>        at Queue._onMethod (/Users/ogolan/projects/quai-loc/worker/
>    node_modules/amqp/amqp.js:1979:15)
>        at Queue.Channel._onChannelMethod (/Users/ogolan/projects/quai-loc/
>    worker/node_modules/amqp/amqp.js:1557:14)
>        at Connection._onMethod (/Users/ogolan/projects/quai-loc/worker/
>    node_modules/amqp/amqp.js:1088:28)
>        at AMQPParser.parser.onMethod (/Users/ogolan/projects/quai-loc/
>    worker/node_modules/amqp/amqp.js:897:12)
>        at AMQPParser._parseMethodFrame (/Users/ogolan/projects/quai-loc/
>    worker/node_modules/amqp/amqp.js:451:10)
>        at frameEnd (/Users/ogolan/projects/quai-loc/worker/node_modules/
>    amqp/amqp.js:192:16)
>        at frame (/Users/ogolan/projects/quai-loc/worker/node_modules/amqp/
>    amqp.js:177:14)
>        at AMQPParser.header [as parse] (/Users/ogolan/projects/quai-loc/
>    worker/node_modules/amqp/amqp.js:163:14)
>        at AMQPParser.execute (/Users/ogolan/projects/quai-loc/worker/
>    node_modules/amqp/amqp.js:236:21)
>        at Connection.<anonymous> (/Users/ogolan/projects/quai-loc/worker/
>    node_modules/amqp/amqp.js:935:14)
>    
>
>
>
> any ideas?
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130505/33dc9c42/attachment.htm>

From macmillan.josh09 at gmail.com  Mon May  6 00:06:39 2013
From: macmillan.josh09 at gmail.com (macmillan.josh09 at gmail.com)
Date: Sun, 5 May 2013 16:06:39 -0700 (PDT)
Subject: [rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
In-Reply-To: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>
References: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>
Message-ID: <04673e8e-e593-497f-8282-50e40f99ca3c@googlegroups.com>

prefetchCount:1 fixes this issue, but i want to pop items in parallel if 
possible.

On Sunday, May 5, 2013 3:48:47 PM UTC-7, macmilla... at gmail.com wrote:
>
> My Node.js worker crashes (RECONDITION_FAILED - unknown delivery tag) if 
> the following 2 conditions are met: 
>
> 1. I start it AFTER the queue have at least 2 messages. 
> 2. The q.shift() is in an async code.
>
> http://pastebin.com/uMQJn0Fe   
>
>
>    // index.js
>    var amqp = require('amqp');
>     
>    var connection = null;
>     
>    connection = amqp.createConnection({ host: 'foo.com' });
>     
>    connection.on('ready', function () {
>      connection.queue('loc', { durable: true, autoDelete: false}, function
>    (q) {
>        q.bind('main', 'loc');
>        q.subscribe({ack:true, prefetchCount: 0}, function (message,headers
>    , deliveryInfo) {
>          console.log(message);
>          setTimeout(function() { q.shift(); }, 100);
>        });
>      });
>    });
>     
>    my worker crashes only I run it AFTER there are messages in the queue. 
>    if I run the worker BEFORE, everything is ok.
>     
>    I use ab to add 2 messages to the queue:
>    ab -k -n 2 -c 1 -p post-data -T 'application/json' foo-api.com/publish
>     
>    And now run my worker - node index.js
>    here is the outputs:
>     
>    { topic: 'loc',
>      sourceCode: 'LOC',
>      sourceRecordID: '690599224',
>      sourceField: 'Phone',
>      sourceFieldValue: '7572007395',
>      actionCode: 'DISP',
>      actionDescription: 'Disconnected Phone Number' 
>    }
>    { topic: 'loc',
>      sourceCode: 'LOC',
>      sourceRecordID: '690599224',
>      sourceField: 'Phone',
>      sourceFieldValue: '7572007395',
>      actionCode: 'DISP',
>      actionDescription: 'Disconnected Phone Number' 
>    }
>     
>    events.js:72
>            throw er; // Unhandled 'error' event
>                  ^
>    Error: PRECONDITION_FAILED - unknown delivery tag 2
>        at Queue._onMethod (/Users/ogolan/projects/quai-loc/worker/
>    node_modules/amqp/amqp.js:1979:15)
>        at Queue.Channel._onChannelMethod (/Users/ogolan/projects/quai-loc/
>    worker/node_modules/amqp/amqp.js:1557:14)
>        at Connection._onMethod (/Users/ogolan/projects/quai-loc/worker/
>    node_modules/amqp/amqp.js:1088:28)
>        at AMQPParser.parser.onMethod (/Users/ogolan/projects/quai-loc/
>    worker/node_modules/amqp/amqp.js:897:12)
>        at AMQPParser._parseMethodFrame (/Users/ogolan/projects/quai-loc/
>    worker/node_modules/amqp/amqp.js:451:10)
>        at frameEnd (/Users/ogolan/projects/quai-loc/worker/node_modules/
>    amqp/amqp.js:192:16)
>        at frame (/Users/ogolan/projects/quai-loc/worker/node_modules/amqp/
>    amqp.js:177:14)
>        at AMQPParser.header [as parse] (/Users/ogolan/projects/quai-loc/
>    worker/node_modules/amqp/amqp.js:163:14)
>        at AMQPParser.execute (/Users/ogolan/projects/quai-loc/worker/
>    node_modules/amqp/amqp.js:236:21)
>        at Connection.<anonymous> (/Users/ogolan/projects/quai-loc/worker/
>    node_modules/amqp/amqp.js:935:14)
>    
>
>
>
> any ideas?
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130505/1aa2449b/attachment.htm>

From yhpeng at orange.fr  Mon May  6 09:22:49 2013
From: yhpeng at orange.fr (Ken Peng)
Date: Mon, 06 May 2013 16:22:49 +0800
Subject: [rabbitmq-discuss] RMQ clustering not working on Cloud servers.
In-Reply-To: <1367823632669-26441.post@n5.nabble.com>
References: <1367822541903-26438.post@n5.nabble.com>
	<CAE3HoVR4ZyVeLaCHi-vwnvBjMrttov3uSCR74RFd5zoDqMnw=g@mail.gmail.com>
	<1367823632669-26441.post@n5.nabble.com>
Message-ID: <51876859.4010801@orange.fr>

? 2013-5-6 15:00, reddylast ??:
> Thanks for your quick response. Here is the logged error which I found in
> cloud01 sever:
>
>
> =ERROR REPORT==== 5-May-2013::04:02:30 ===
> Mnesia(rabbit at cloud01): ** ERROR ** Mnesia on rabbit at cloud01 could not
> connect to node(s) ['rabbit at cloud02-server']
>
>
> Thanks,
> Reddy


You need to specify the nodename with IP address in /etc/hosts file.
rabbitmq uses the "hostname -s" for its nodename.

From matthias at rabbitmq.com  Mon May  6 10:09:08 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 06 May 2013 10:09:08 +0100
Subject: [rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
In-Reply-To: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>
References: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>
Message-ID: <51877334.4060303@rabbitmq.com>

On 05/05/13 23:48, macmillan.josh09 at gmail.com wrote:
> My Node.js worker crashes (RECONDITION_FAILED - unknown delivery tag) if
> the following 2 conditions are met:
>
> 1. I start it AFTER the queue have at least 2 messages.
> 2. The q.shift() is in an async code.
>
> http://pastebin.com/uMQJn0Fe

Looking at the amqp.js code, q.shift() acknowledges the last message 
that was received. So with your code...

>          q.subscribe({ack:true, prefetchCount: 0}, function (message,
>     headers, deliveryInfo) {
>            console.log(message);
>            setTimeout(function() { q.shift(); }, 100);
>     });
>     });

due to the delayed execution, when two messages arrive in quick 
succession then the first to arrive won't be acknowledged at all and the 
second will be acknowledged twice. Rabbit is complaining about the latter.

I've never used node-amqp, so I don't know what the correct approach is 
for accomplishing what you want to do. You may want to ask the node-amqp 
developers.

Matthias


From woqimingweipeng at gmail.com  Mon May  6 11:08:41 2013
From: woqimingweipeng at gmail.com (Xie Yunpeng)
Date: Mon, 6 May 2013 18:08:41 +0800
Subject: [rabbitmq-discuss] consumer get messages from one queue sometimes
	disorder
Message-ID: <CAAjbVJC2Sie+bAusdENY5bJaGASqqy=SR89f7pyiMoeDHCuMnQ@mail.gmail.com>

I create a queue as this:
exchange: smart
routingkey: smart_2
queue: smart_2
I use 4 publisher sending messages to this queue and 1 consumer to receive
the messages.the consumer when connect to the rabbitmq server , first it
declare the queue "smart_2" to:
exchange: smart_2
routingkey: smart_2
queue: smart_2
then it get messages from queue smart_2

is this delcare affect the message order?

i find it receive messages disorder sometimes, just like: first receive
messges in current time and then receive messages several hour ago, the
interval is not regular.

os: rhel 6.3
erlang: R16B
rabbitmq: 3.0.2
pyhon client: kombu

i want to know the exact reason that the messages in disorder. this situation
appears occasionally so it not easy to find the exact reason.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/7399c345/attachment.htm>

From psl88506 at gmail.com  Mon May  6 11:46:50 2013
From: psl88506 at gmail.com (PSL 88506)
Date: Mon, 6 May 2013 16:16:50 +0530
Subject: [rabbitmq-discuss] [rabbitmq_discuss]more time to publish
Message-ID: <CANPBPZnKTJMAZw0s62Rz0O9KdtPsTssH27CCymMeMGdoXOZ3Kg@mail.gmail.com>

Hi,

We r trying to publish 256 bytes of messages and there are 500 consumers
consuming(bindedto an exchange).

It is observed that time taken to publish for 500 consumers is  mo're than
the time taken to publish for 1 consume.

Could you please let us know why this discrepancy happening and how to
improve the performance.

Someone please help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/2e5e337c/attachment.htm>

From abbiya at gmail.com  Mon May  6 12:24:38 2013
From: abbiya at gmail.com (Seshachalam Malisetti)
Date: Mon, 6 May 2013 04:24:38 -0700 (PDT)
Subject: [rabbitmq-discuss] how to find the number of subscribers to a
 durable queue in rabbitmq?
Message-ID: <c9c1141a-052e-4c79-87a4-03cd0721c447@googlegroups.com>


  
In my android app I need to find offline/online status of user. the user 
connects to rabbitmq, creates a durable queue with his name and binds to a 
durable exchange with queue name as routing key. when the user disconnects 
from rabbitmq, if any other user asked my LAMP server the status of 
previous user, how can i find it. How can i use rabbitmq http api to do 
this ?

will " /api/queues/vhost/queue/bindings A list of all bindings on a given 
queue. " this help me ?


Thanks,

Seshu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/89ab494a/attachment.htm>

From reddylast at gmail.com  Mon May  6 12:30:49 2013
From: reddylast at gmail.com (reddylast)
Date: Mon, 6 May 2013 04:30:49 -0700 (PDT)
Subject: [rabbitmq-discuss] RMQ clustering not working on Cloud servers.
In-Reply-To: <CALPqkirD+yKw0KVsQbmvNUvtBykApRfE=nEwba=pxK9vdN1e+A@mail.gmail.com>
References: <1367822541903-26438.post@n5.nabble.com>
	<CALPqkirD+yKw0KVsQbmvNUvtBykApRfE=nEwba=pxK9vdN1e+A@mail.gmail.com>
Message-ID: <1367839849024-26450.post@n5.nabble.com>

Excellent ! it works. Thanks, Brett.

Reddy 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RMQ-clustering-not-working-on-Cloud-servers-tp26438p26450.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Mon May  6 14:26:41 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 6 May 2013 17:26:41 +0400
Subject: [rabbitmq-discuss] how to find the number of subscribers to a
 durable queue in rabbitmq?
In-Reply-To: <c9c1141a-052e-4c79-87a4-03cd0721c447@googlegroups.com>
References: <c9c1141a-052e-4c79-87a4-03cd0721c447@googlegroups.com>
Message-ID: <CAE3HoVRrm3qex52bbJ65edTGMfeo_nd_RSZxnGkqrQirPVJtdQ@mail.gmail.com>

2013/5/6 Seshachalam Malisetti <abbiya at gmail.com>

> How can i use rabbitmq http api to do this ?
>
> will " /api/queues/vhost/queue/bindings A list of all bindings on a given
> queue. " this help me ?
>

That will list bindings, not consumers. The learn the difference, take a
look at

http://www.rabbitmq.com/tutorials/amqp-concepts.html

To get the # of consumers, either use AMQP's queue.declare method with
passive set to true,
or use

GET /api/queues/{{vhost}}/{{queue}}

Both will include consumer count among other things.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/6b0392c3/attachment.htm>

From michael.s.klishin at gmail.com  Mon May  6 14:28:50 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 6 May 2013 17:28:50 +0400
Subject: [rabbitmq-discuss] [rabbitmq_discuss]more time to publish
In-Reply-To: <CANPBPZnKTJMAZw0s62Rz0O9KdtPsTssH27CCymMeMGdoXOZ3Kg@mail.gmail.com>
References: <CANPBPZnKTJMAZw0s62Rz0O9KdtPsTssH27CCymMeMGdoXOZ3Kg@mail.gmail.com>
Message-ID: <CAE3HoVTymZQ2QZpoff80STc37E4ViBfmGKjniQgQvO95BGkRMQ@mail.gmail.com>

2013/5/6 PSL 88506 <psl88506 at gmail.com>

> Could you please let us know why this discrepancy happening and how to
> improve the performance.


If you have 500 queues bound to an exchange, and routing is set up such
that they all get a copy (e.g.
it is a fanout exchange), RabbitMQ has to do more work than in the case of
just 1 queue.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/72e3b42e/attachment.htm>

From vieuxtech at gmail.com  Mon May  6 16:46:25 2013
From: vieuxtech at gmail.com (Sam Roberts)
Date: Mon, 6 May 2013 08:46:25 -0700
Subject: [rabbitmq-discuss] What does connection_closed_abruptly mean in log
	files?
Message-ID: <CA+Sj9TngkU5-n+57RYU0kBzndBHUkbeXzTGfnRk7wVfBedFAeA@mail.gmail.com>

I thought I'd ask again, since we're completely mystified, under what
conditions does rabbit log connection_closed_abruptly?

Does it mean that its doing this to the client, does it mean it
doesn't think the client did a clean close? Are there any docs for
this, anywhere?

=WARNING REPORT==== 3-May-2013::19:24:52 ===
closing AMQP connection <0.624.0> (127.0.0.1:37518 -> 127.0.0.1:5672):
connection_closed_abruptly



---------- Forwarded message ----------
From: Sam Roberts <vieuxtech at gmail.com>
Date: Fri, May 3, 2013 at 1:15 PM
Subject: while would a close/fin of a connection elicit a reset/rst by rabbitmq?
To: rabbitmq-discuss at lists.rabbitmq.com


Some of my rabbitmq servers don't do graceful closes, no idea why.
This is a localhost unit test, it is just opening a connection, then
closing it, and now the outgoing close is eliciting a reset.

The log doesn't say much, is there any way to increase its verbosity?

With rabbitmq 3.0.4, on debian, installed from the rmq apt repo.


=INFO REPORT==== 3-May-2013::19:24:52 ===
accepting AMQP connection <0.624.0> (127.0.0.1:37518 -> 127.0.0.1:5672)

=WARNING REPORT==== 3-May-2013::19:24:52 ===
closing AMQP connection <0.624.0> (127.0.0.1:37518 -> 127.0.0.1:5672):
connection_closed_abruptly



 % tshark -r rst.pcap
  1   0.000000    127.0.0.1 37490 127.0.0.1    5672 TCP 74 37490 >
amqp [SYN] Seq=0 Win=32792 Len=0 MSS=16396 SACK_PERM=1 TSval=187898
TSecr=0 WS=128
  2   0.000016    127.0.0.1 5672 127.0.0.1    37490 TCP 74 amqp >
37490 [SYN, ACK] Seq=0 Ack=1 Win=32768 Len=0 MSS=16396 SACK_PERM=1
TSval=187898 TSecr=187898 WS=128
  3   0.000029    127.0.0.1 37490 127.0.0.1    5672 TCP 66 37490 >
amqp [ACK] Seq=1 Ack=1 Win=32896 Len=0 TSval=187898 TSecr=187898
  4   0.001896    127.0.0.1 37490 127.0.0.1    5672 TCP 74 37490 >
amqp [PSH, ACK] Seq=1 Ack=1 Win=32896 Len=8 TSval=187898
TSecr=187898AMQP (unknown version)
  5   0.001907    127.0.0.1 5672 127.0.0.1    37490 TCP 66 amqp >
37490 [ACK] Seq=1 Ack=9 Win=32768 Len=0 TSval=187898 TSecr=187898
  6   0.002137    127.0.0.1 5672 127.0.0.1    37490 AMQP 401 Connection.Start
  7   0.002212    127.0.0.1 37490 127.0.0.1    5672 TCP 66 37490 >
amqp [ACK] Seq=9 Ack=336 Win=33920 Len=0 TSval=187898 TSecr=187898
  8   0.008035    127.0.0.1 37490 127.0.0.1    5672 AMQP 202 Connection.Start-Ok
  9   0.008179    127.0.0.1 5672 127.0.0.1    37490 AMQP 86 Connection.Tune
 10   0.009737    127.0.0.1 37490 127.0.0.1    5672 AMQP 86 Connection.Tune-Ok
 11   0.046865    127.0.0.1 5672 127.0.0.1    37490 TCP 66 amqp >
37490 [ACK] Seq=356 Ack=165 Win=33920 Len=0 TSval=187910 TSecr=187900
 12   0.046876    127.0.0.1 37490 127.0.0.1    5672 AMQP 82 Connection.Open
 13   0.046882    127.0.0.1 5672 127.0.0.1    37490 TCP 66 amqp >
37490 [ACK] Seq=356 Ack=181 Win=33920 Len=0 TSval=187910 TSecr=187910
 14   0.046977    127.0.0.1 5672 127.0.0.1    37490 AMQP 79 Connection.Open-Ok
 15   0.048131    127.0.0.1 37490 127.0.0.1    5672 TCP 66 37490 >
amqp [FIN, ACK] Seq=181 Ack=369 Win=33920 Len=0 TSval=187910
TSecr=187910
 16   0.048208    127.0.0.1 5672 127.0.0.1    37490 TCP 66 amqp >
37490 [RST, ACK] Seq=369 Ack=182 Win=33920 Len=0 TSval=187910
TSecr=187910

From michael.s.klishin at gmail.com  Mon May  6 16:52:57 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 6 May 2013 19:52:57 +0400
Subject: [rabbitmq-discuss] What does connection_closed_abruptly mean in
 log files?
In-Reply-To: <CA+Sj9TngkU5-n+57RYU0kBzndBHUkbeXzTGfnRk7wVfBedFAeA@mail.gmail.com>
References: <CA+Sj9TngkU5-n+57RYU0kBzndBHUkbeXzTGfnRk7wVfBedFAeA@mail.gmail.com>
Message-ID: <CAE3HoVToRZ+zRX8p7FFheP8QZ03tXKK61XYcdw0eLeob6u4B1Q@mail.gmail.com>

2013/5/6 Sam Roberts <vieuxtech at gmail.com>

> I thought I'd ask again, since we're completely mystified, under what
> conditions does rabbit log connection_closed_abruptly?
>
> Does it mean that its doing this to the client, does it mean it
> doesn't think the client did a clean close? Are there any docs for
> this, anywhere?
>

It means that the client did not go through the proper connection
termination
process and instead just closed the underlying TCP connection.

It is harmless and very common e.g. in unit tests, where it may be hard
to track down every single connection at close it properly at the end.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/1ee98a2f/attachment.htm>

From matthias at rabbitmq.com  Mon May  6 17:59:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 06 May 2013 17:59:21 +0100
Subject: [rabbitmq-discuss] How to get the space used on disk?
In-Reply-To: <20130503143602.6fe3.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20130503143602.6fe3.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <5187E169.50500@rabbitmq.com>

Lionel,

On 03/05/13 13:44, Lionel Cons wrote:
> for the disk space, we can only get: disk_free and disk_free_limit.
>
> Is there any way to get the disk used?

Nope.

> In case RabbitMQ shares its partition with other processes, what matters is
> not really the disk free (in the partition) but rather the disk usage wrt
> the maximum expected.

Well, the disk space monitoring is there to prevent rabbit from falling 
over due to running out of disk space. So it really *is* the free space 
that matters. If you want to set an upper bound on the disk space rabbit 
is using, I suggest you configure a separate partition for it.

Matthias.

From dan.horsey at broadruntech.com  Mon May  6 18:00:44 2013
From: dan.horsey at broadruntech.com (Daniel Horsey)
Date: Mon, 6 May 2013 13:00:44 -0400
Subject: [rabbitmq-discuss] C library request/reply
Message-ID: <E7DA2B134D354F9A993F1BFCD29965CD@broadruntech.com>

Making my way through the RabbitMQ C api, and so far, so good, but I'm
having trouble implementing the "RPC" model.  I can see how the "reply_to"
value gets set in the requests, but having trouble finding it on the
consumer side so I can use it to respond to.  Looked at the
rpc_sendstring_client example, but I don't see where it executes the
consumer code to extract the data.

 

Where do I find this value?

 

Thanks in advance!

 

            -dan

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/216d2378/attachment.htm>

From matthias at rabbitmq.com  Mon May  6 18:02:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 06 May 2013 18:02:27 +0100
Subject: [rabbitmq-discuss] Cluster not running - getting Error:
 {cannot_discover_cluster,
 "The nodes provided are either offline or not running" error
In-Reply-To: <90b4b897-8f59-4652-b6a0-e81a76b340c7@googlegroups.com>
References: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
	<90b4b897-8f59-4652-b6a0-e81a76b340c7@googlegroups.com>
Message-ID: <5187E223.2060306@rabbitmq.com>

On 03/05/13 09:19, subhankar biswas wrote:
> @shankaralingegowda Singonahalli Chikkarevanna
> how did you solved the problem????
> i m facing d same problem

What exactly are you trying to do? And what error are you seeing? If you 
are trying to cluster rabbits across firewalls, please take note of 
http://www.rabbitmq.com/clustering.html#firewall.

Matthias.

From matthias at rabbitmq.com  Mon May  6 18:20:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 06 May 2013 18:20:45 +0100
Subject: [rabbitmq-discuss] Bug/Behavior Change in binds to header
 exchanges in rabbitmq 3.1.0
In-Reply-To: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>
References: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>
Message-ID: <5187E66D.6030102@rabbitmq.com>

Matt,

On 03/05/13 16:19, Matt Campbell wrote:
> In rabbit 3.0.4 and 2.8.7, I was able to bind a queue to a headers
> exchange without specifying any bind arguments, which resulted in that
> queue receiving all the messages. In rabbit 3.1.0, when I make that same
> bind I get an error message telling me I must include the "x-match"
> header. While this is an irritation for clients that use AMQP or the
> HTTP API to create the binds (because they require a code change), I
> have some clients that bind queues to this exchange via STOMP and I am
> unaware of how to get that header set through a STOMP subscribe to that
> exchange.
>
> Is this an intended behavior change going forward, or is this a bug in
> rabbitmq 3.1.0?

We introduced validation of the x-match header in 3.1 - a change that 
unfortunately didn't get mentioned in the release notes.

As part of that, bindings with no x-match header are now rejected 
whereas previously they would be treated as 'all' matches.

The spec is vague in this regard; it neither says that x-match must be 
present nor what should happen when it isn't.

I have filed a bug to explore whether we should revert to the original 
behaviour, though given the spec vagueness it is probably best not to 
depend on that in applications.

As an alternative to changing the bindings in your code, you could 
introduce an intermediate fanout exchange, either

a) in front of the headers exchange, with publishers publishing to that 
instead of the headers exchange, or

b) behind the headers exchange, bound to it with x-match=all, so that 
selected queues can bind to that w/o having to set a header

Regards,

Matthias.

From alan.antonuk at gmail.com  Mon May  6 19:59:52 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 6 May 2013 11:59:52 -0700
Subject: [rabbitmq-discuss] C library request/reply
In-Reply-To: <E7DA2B134D354F9A993F1BFCD29965CD@broadruntech.com>
References: <E7DA2B134D354F9A993F1BFCD29965CD@broadruntech.com>
Message-ID: <CAAt2po++g-rc=m8pwBULBS2r4NTS-tUDUNTzgabF5kNdrS9vWw@mail.gmail.com>

Starting from the amqp_listen.c example:
https://github.com/alanxz/rabbitmq-c/blob/master/examples/amqp_listen.c#L149

That amqp_basic_properties_t* struct is what you're looking for.

You'll have to consult the _flags field to make sure the field is set

amqp_boolean_t is_set = p->_flags & AMQP_BASIC_REPLYTO_FLAG;

Then the reply-to value is stored in the reply_to member.

HTH
-Alan


On Mon, May 6, 2013 at 10:00 AM, Daniel Horsey
<dan.horsey at broadruntech.com>wrote:

>  Making my way through the RabbitMQ C api, and so far, so good, but I?m
> having trouble implementing the ?RPC? model.  I can see how the ?reply_to?
> value gets set in the requests, but having trouble finding it on the
> consumer side so I can use it to respond to.  Looked at the
> rpc_sendstring_client example, but I don?t see where it executes the
> consumer code to extract the data.****
>
> ** **
>
> Where do I find this value?****
>
> ** **
>
> Thanks in advance!****
>
> ** **
>
>             -dan****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/1520376f/attachment.htm>

From dan.horsey at broadruntech.com  Mon May  6 21:10:41 2013
From: dan.horsey at broadruntech.com (Daniel Horsey)
Date: Mon, 6 May 2013 16:10:41 -0400
Subject: [rabbitmq-discuss] C library request/reply
In-Reply-To: <CAAt2po++g-rc=m8pwBULBS2r4NTS-tUDUNTzgabF5kNdrS9vWw@mail.gmail.com>
References: <E7DA2B134D354F9A993F1BFCD29965CD@broadruntech.com>
	<CAAt2po++g-rc=m8pwBULBS2r4NTS-tUDUNTzgabF5kNdrS9vWw@mail.gmail.com>
Message-ID: <DD749852CA1D4FA1820A96DF5D46881D@broadruntech.com>

Yup!  That's what I was looking for.

 

Thanks much!

 

-dan

 

 

  _____  

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alan
Antonuk
Sent: Monday, May 06, 2013 3:00 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] C library request/reply

 

Starting from the amqp_listen.c example:

https://github.com/alanxz/rabbitmq-c/blob/master/examples/amqp_listen.c#L149

 

That amqp_basic_properties_t* struct is what you're looking for.  

 

You'll have to consult the _flags field to make sure the field is set

 

amqp_boolean_t is_set = p->_flags & AMQP_BASIC_REPLYTO_FLAG;

 

Then the reply-to value is stored in the reply_to member.

 

HTH

-Alan

 

On Mon, May 6, 2013 at 10:00 AM, Daniel Horsey <dan.horsey at broadruntech.com>
wrote:

Making my way through the RabbitMQ C api, and so far, so good, but I'm
having trouble implementing the "RPC" model.  I can see how the "reply_to"
value gets set in the requests, but having trouble finding it on the
consumer side so I can use it to respond to.  Looked at the
rpc_sendstring_client example, but I don't see where it executes the
consumer code to extract the data.

 

Where do I find this value?

 

Thanks in advance!

 

            -dan

 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/109df0a9/attachment.htm>

From lists at bitfaeule.net  Tue May  7 00:39:45 2013
From: lists at bitfaeule.net (lists at bitfaeule.net)
Date: Tue, 7 May 2013 01:39:45 +0200 (CEST)
Subject: [rabbitmq-discuss] Can Rabbit MQ consume Tibco JMS messages?
Message-ID: <1140778309.219503.1367883586096.open-xchange@ox-webdesk.1und1.de>

Hi there I'm a newb to RabbitMQ, hence please excuse if this equation has an
obvious answer.



I need to build a jerkins build trigger that will kick off builds when JMS
messages are received. I found the Jenkins plugin fro Rabbit MQ (
https://wiki.jenkins-ci.org/display/JENKINS/RabbitMQ+Consumer+Plugin
<https://wiki.jenkins-ci.org/display/JENKINS/RabbitMQ+Consumer+Plugin>  ) which
seems to be headed in the right direction. I now wonder if I can get RabbitMQ to
consume message from the Tibco JMS broker that I'm forced to use due to the
companies' messaging infrastructure that I work for.



Thank you.



Couz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/6562e5f1/attachment.htm>

From goyalk at vmware.com  Tue May  7 00:58:51 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Mon, 6 May 2013 16:58:51 -0700 (PDT)
Subject: [rabbitmq-discuss] How to use separate connections for sending and
	receiving data in Spring-RabbitMQ?
Message-ID: <0db09e4b.000002c0.0000009d@KAPILPC.vmware.com>

Hi,

 

While exploring flow-control in RabbitMQ, I found this:

 

"The intent here is to introduce a flow control mechanism that throttles
producers but lets consumers continue unaffected. However, since AMQP
permits producers and consumers to operate on the same channel, and on
different channels of a single connection, this logic is necessarily
imperfect. In practice that does not pose any problems for most
applications since the throttling is observable merely as a delay.
Nevertheless, other design considerations permitting, it is advisable to
only use individual AMQP connections for either producing or consuming."

 

I am using Spring Integration in my web-application to send/receive data
to/from RabbitMQ broker. I declare connection-factory, amqp-template,
rabbit-admin, channels and inbound/outbound adapters using XML. What is
the recommended way to ensure separate connections are used for sending
and receiving? My observation is that by default, both sending and
receiving are done on the same connection but on different channels.

 

Thanks

Kapil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/ddfe5861/attachment.htm>

From grussell at gopivotal.com  Tue May  7 03:50:24 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Mon, 6 May 2013 22:50:24 -0400
Subject: [rabbitmq-discuss] Can Rabbit MQ consume Tibco JMS messages?
In-Reply-To: <1140778309.219503.1367883586096.open-xchange@ox-webdesk.1und1.de>
References: <1140778309.219503.1367883586096.open-xchange@ox-webdesk.1und1.de>
Message-ID: <CADtU9_unhgAoC-Z2S4LQWMQ4WC_Fh5BSrT5Tje8KxFpJW+MUQw@mail.gmail.com>

You could use a very simple Spring Integration application to consume
messages from Tibco (use an <int-jms:message-driven-adapter/> ->
<int:channel/> -> <int-amqp:outbound-channel-adapter/>).

http://static.springsource.org/spring-integration/reference/html/

http://www.springsource.org/spring-integration/


On Mon, May 6, 2013 at 7:39 PM, lists at bitfaeule.net <lists at bitfaeule.net>wrote:

> **
>
> Hi there I'm a newb to RabbitMQ, hence please excuse if this equation has
> an obvious answer.
>
>
>
> I need to build a jerkins build trigger that will kick off builds when JMS
> messages are received. I found the Jenkins plugin fro Rabbit MQ (
> https://wiki.jenkins-ci.org/display/JENKINS/RabbitMQ+Consumer+Plugin )
> which seems to be headed in the right direction. I now wonder if I can get
> RabbitMQ to consume message from the Tibco JMS broker that I'm forced to
> use due to the companies' messaging infrastructure that I work for.
>
>
>
> Thank you.
>
>
>
> Couz
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/e8d44fd1/attachment.htm>

From carl.hoerberg at gmail.com  Tue May  7 04:32:49 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 6 May 2013 20:32:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Java client: closed connection doesn't raise
	exception immediately
Message-ID: <1367897569560-26465.post@n5.nabble.com>

It looks like the rabbitmq java client doesn't raise an exception as soon as
a connection fails, eg. due to network cable disconnection. 

The following code will continue to run for 2 minutes after the
disconnection, and first then raise an exception. 
 
        ConnectionFactory connectionFactory = new ConnectionFactory();
        connectionFactory.setUri("MyUri");
        connection = connectionFactory.newConnection();
        channel = connection.createChannel();
        channel.exchangeDeclare("messagesExchange", "direct", true);
        channel.queueDeclare("messagesQueue", true, false, false, null);
        channel.queueBind("messagesQueue", "messagesExchange",
"messagesRK");
        for (int i = 0;i<10000;i++){
          try {
            channel.basicPublish("messagesExchange",
"messagesRK",MessageProperties.PERSISTENT_TEXT_PLAIN, "My
message".getBytes());
           } catch (IOException ioe) {
             //I would expect that this exception will throw on network
failure but nothing happens
            System.out.println("Error enqueueing message " + ioe);
         }
       }




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Java-client-closed-connection-doesn-t-raise-exception-immediately-tp26465.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From lionel.cons at cern.ch  Tue May  7 06:35:56 2013
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 7 May 2013 07:35:56 +0200
Subject: [rabbitmq-discuss] How to get the space used on disk?
In-Reply-To: <5187E169.50500@rabbitmq.com>
References: <20130503143602.6fe3.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<5187E169.50500@rabbitmq.com>
Message-ID: <20872.37564.656389.575171@mail.cern.ch>

Matthias Radestock writes:
 > > In case RabbitMQ shares its partition with other processes, what matters is
 > > not really the disk free (in the partition) but rather the disk usage wrt
 > > the maximum expected.
 > 
 > Well, the disk space monitoring is there to prevent rabbit from falling 
 > over due to running out of disk space. So it really *is* the free space 
 > that matters.


From MJeffery at fnb.co.za  Tue May  7 07:10:25 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Tue, 7 May 2013 06:10:25 +0000
Subject: [rabbitmq-discuss] Client vs Server version
Message-ID: <06536F18C0038E489237EEE3CA9BF2D014023842@FRGR1D2MX07.services.firstrand.net>

Hello

Do the Java client versions need to align to the server versions ?
Can a client run with 2.8.6 client against a 3.1.0 server ?

We are upgrading from 2.8.6 to 3.1.0.

Thanks

Jeff

To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/25b77b40/attachment.htm>

From psdc1978 at gmail.com  Tue May  7 07:35:58 2013
From: psdc1978 at gmail.com (=?ISO-8859-1?Q?Pedro_S=E1_da_Costa?=)
Date: Tue, 7 May 2013 08:35:58 +0200
Subject: [rabbitmq-discuss] "AMQPLAIN login refused: user 'celeryuser' -
	invalid credentials"
Message-ID: <CAJ8VZfUfTSZhyhe=JYTS+M_MC08vezBuz5z6iiafb7GKj4otgw@mail.gmail.com>

Hi all,

I am trying to run the my example with celery, but I get problems with the
configuration of rabbitmq. I added user, vhost and permissions, but I have
invalid credentials. The error is below. Any help to fix this error?

# logging
closing AMQP connection <0.4783.0> (127.0.0.1:42097 -> 127.0.0.1:5672):
{handshake_error,starting,0, {amqp_error,access_refused, "AMQPLAIN login
refused: user 'celeryuser' - invalid credentials", 'connection.start_ok'}}
# set vars $ rabbitmqctl add_user celeryuser celery $ rabbitmqctl add_vhost
celeryvhost $ rabbitmqctl set_permissions -p celeryvhost celeryuser ".*"
".*" ".*" Setting permissions for user "celeryuser" in vhost "celeryvhost"
... ...done. # list vars $ rabbitmqctl list_users Listing users ...
celeryuser [] guest [administrator] $ rabbitmqctl list_vhosts Listing
vhosts ... / celeryvhost ...done. $ rabbitmqctl list_permissions Listing
permissions in vhost "/" ... guest .* .* .* ...done.

-- 
Best regards,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/0d38466c/attachment.htm>

From tim at rabbitmq.com  Tue May  7 07:46:30 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 7 May 2013 07:46:30 +0100
Subject: [rabbitmq-discuss] How to use separate connections for sending
	and receiving data in Spring-RabbitMQ?
In-Reply-To: <0db09e4b.000002c0.0000009d@KAPILPC.vmware.com>
References: <0db09e4b.000002c0.0000009d@KAPILPC.vmware.com>
Message-ID: <61C733AA-3D50-4F00-99AF-1377F4EE4834@rabbitmq.com>

Hi,

According to the spring-amqp docs, the CachingConnectionFactory will create a proxy to a single connection only, so you'll either need to have two connection factory beans in your configuration or inherit AbstractConnectionFactory and create your own using Rabbit's own client APIs. You might also want to consider using a MessageListenerContainer bean to consume asynchronously, but even if you stick with AmqpTemplate, you'll need to configure another bean for consuming so that it will use another (different) connection factory bean and thereby ensure a second connection is used.

I'd suggest asking on a spring-amqp forum or mailing list if you need more detailed assistance.

Cheers,
Tim

On 7 May 2013, at 00:58, Kapil Goyal wrote:

> Hi,
>  
> While exploring flow-control in RabbitMQ, I found this:
>  
> ?The intent here is to introduce a flow control mechanism that throttles producers but lets consumers continue unaffected. However, since AMQP permits producers and consumers to operate on the same channel, and on different channels of a single connection, this logic is necessarily imperfect. In practice that does not pose any problems for most applications since the throttling is observable merely as a delay. Nevertheless, other design considerations permitting, it is advisable to only use individual AMQP connections for either producing or consuming.?
>  
> I am using Spring Integration in my web-application to send/receive data to/from RabbitMQ broker. I declare connection-factory, amqp-template, rabbit-admin, channels and inbound/outbound adapters using XML. What is the recommended way to ensure separate connections are used for sending and receiving? My observation is that by default, both sending and receiving are done on the same connection but on different channels.
>  
> Thanks
> Kapil
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/779f1f8f/attachment.htm>

From tim at rabbitmq.com  Tue May  7 07:55:48 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 7 May 2013 07:55:48 +0100
Subject: [rabbitmq-discuss] Java client: closed connection doesn't raise
	exception immediately
In-Reply-To: <1367897569560-26465.post@n5.nabble.com>
References: <1367897569560-26465.post@n5.nabble.com>
Message-ID: <773F6685-2286-4FE6-ACC8-49042C5EF122@rabbitmq.com>

Hi,

On 7 May 2013, at 04:32, carlhoerberg wrote:

> It looks like the rabbitmq java client doesn't raise an exception as soon as
> a connection fails, eg. due to network cable disconnection. 
> 
> The following code will continue to run for 2 minutes after the
> disconnection, and first then raise an exception. 
> 

That's perfectly normal, for a network driven application. It is not RabbitMQ's client library that wait's to throw an exception, but rather it is the operating system's network stack that takes time to determine that a peer socket is no longer available. This can take many minutes, even when you're connecting via the loopback interface (i.e., localhost) for testing.

On most unices, the relevant bits of `man tcp` are:

    "When  a  network  error  occurs, TCP tries to resend the packet.  If it
     doesn't succeed after some time, either ETIMEDOUT or the last received
     error on this connection is reported."

In that second sentence, "after some time" is determined by the OS kernel configured limits, viz tcp_retries1 (defaults to 3 on linux) and tcp_retries2, and the configured retransmission timeout. Of course there are doubtless other parameters that interact with this behaviour. So you're quite lucky because it's a producer application that's trying to send - those time out much faster. For network consumer applications, this problem is quite a tricky on because the default settings on linux for example, mean delays of between 10 and 30 minutes before the OS networking layer "notices" the connection has timed out.

This problem is, of course, not specific to RabbitMQ.

Cheers,
Tim

From tim at rabbitmq.com  Tue May  7 07:58:49 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 7 May 2013 07:58:49 +0100
Subject: [rabbitmq-discuss] Client vs Server version
In-Reply-To: <06536F18C0038E489237EEE3CA9BF2D014023842@FRGR1D2MX07.services.firstrand.net>
References: <06536F18C0038E489237EEE3CA9BF2D014023842@FRGR1D2MX07.services.firstrand.net>
Message-ID: <4DE87C66-DD42-433D-91DE-D55BA4EA74CD@rabbitmq.com>

Hi

On 7 May 2013, at 07:10, Jeffery, Mark wrote:

> Do the Java client versions need to align to the server versions ?
> Can a client run with 2.8.6 client against a 3.1.0 server ?
>  

Technically it is possible to run disparate versions (the AMQP 0.9.1 protocol hasn't changed between them after all), but I would strongly advise you to use the latest version with the latest server. Not only have important bug fixes been introduced in the client libraries between releases, but it's possible in some cases that non-standard features (i.e., enhancements to or divergence from the AMQP specification) have been added to (or deprecated from) the broker and the client might need to be aware of these. Lack of support for the IMMEDIATE flag in later versions of RabbitMQ is one such example.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/d422c364/attachment.htm>

From MJeffery at fnb.co.za  Tue May  7 08:01:55 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Tue, 7 May 2013 07:01:55 +0000
Subject: [rabbitmq-discuss] Client vs Server version
In-Reply-To: <4DE87C66-DD42-433D-91DE-D55BA4EA74CD@rabbitmq.com>
References: <06536F18C0038E489237EEE3CA9BF2D014023842@FRGR1D2MX07.services.firstrand.net>
	<4DE87C66-DD42-433D-91DE-D55BA4EA74CD@rabbitmq.com>
Message-ID: <06536F18C0038E489237EEE3CA9BF2D014023A30@FRGR1D2MX07.services.firstrand.net>

Perfect.

Thanks for the prompt response. It is appreciated.

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: Tuesday, May 07, 2013 8:59 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Client vs Server version

Hi

On 7 May 2013, at 07:10, Jeffery, Mark wrote:


Do the Java client versions need to align to the server versions ?
Can a client run with 2.8.6 client against a 3.1.0 server ?


Technically it is possible to run disparate versions (the AMQP 0.9.1 protocol hasn't changed between them after all), but I would strongly advise you to use the latest version with the latest server. Not only have important bug fixes been introduced in the client libraries between releases, but it's possible in some cases that non-standard features (i.e., enhancements to or divergence from the AMQP specification) have been added to (or deprecated from) the broker and the client might need to be aware of these. Lack of support for the IMMEDIATE flag in later versions of RabbitMQ is one such example.

Cheers,
Tim


To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/09ef587d/attachment.htm>

From psdc1978 at gmail.com  Tue May  7 08:02:02 2013
From: psdc1978 at gmail.com (=?ISO-8859-1?Q?Pedro_S=E1_da_Costa?=)
Date: Tue, 7 May 2013 09:02:02 +0200
Subject: [rabbitmq-discuss] "AMQPLAIN login refused: user 'celeryuser' -
	invalid credentials"
In-Reply-To: <CAJ8VZfUfTSZhyhe=JYTS+M_MC08vezBuz5z6iiafb7GKj4otgw@mail.gmail.com>
References: <CAJ8VZfUfTSZhyhe=JYTS+M_MC08vezBuz5z6iiafb7GKj4otgw@mail.gmail.com>
Message-ID: <CAJ8VZfW_ZGg_Czh7192EaUmDfqKNdLF47wpvF4kL9H7sJd9qAQ@mail.gmail.com>

I got the problem

Instead of using
BROKER_URL = "amqp://celeryuser at localhost:5672/celeryvhost"

I must use

BROKER_HOST = "localhost"
BROKER_PORT = 5672
BROKER_USER = "celeryuser"
BROKER_PASSWORD = "celery"
BROKER_VHOST = "celeryvhost"



On 7 May 2013 08:35, Pedro S? da Costa <psdc1978 at gmail.com> wrote:

> Hi all,
>
> I am trying to run the my example with celery, but I get problems with the
> configuration of rabbitmq. I added user, vhost and permissions, but I have
> invalid credentials. The error is below. Any help to fix this error?
>
> # logging
> closing AMQP connection <0.4783.0> (127.0.0.1:42097 -> 127.0.0.1:5672):
> {handshake_error,starting,0, {amqp_error,access_refused, "AMQPLAIN login
> refused: user 'celeryuser' - invalid credentials", 'connection.start_ok'}}
> # set vars $ rabbitmqctl add_user celeryuser celery $ rabbitmqctl add_vhost
> celeryvhost $ rabbitmqctl set_permissions -p celeryvhost celeryuser ".*"
> ".*" ".*" Setting permissions for user "celeryuser" in vhost "celeryvhost"
> ... ...done. # list vars $ rabbitmqctl list_users Listing users ...
> celeryuser [] guest [administrator] $ rabbitmqctl list_vhosts Listing
> vhosts ... / celeryvhost ...done. $ rabbitmqctl list_permissions Listing
> permissions in vhost "/" ... guest .* .* .* ...done.
>
> --
> Best regards,
>



-- 
Best regards,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/b9306d0f/attachment.htm>

From carl.hoerberg at gmail.com  Tue May  7 08:04:26 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 7 May 2013 00:04:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Java client: closed connection doesn't raise
 exception immediately
In-Reply-To: <773F6685-2286-4FE6-ACC8-49042C5EF122@rabbitmq.com>
References: <1367897569560-26465.post@n5.nabble.com>
	<773F6685-2286-4FE6-ACC8-49042C5EF122@rabbitmq.com>
Message-ID: <56648C651EBA4DF89FDB4D1A703A73C9@gmail.com>

Ok, yes, suspected it had with to do with the underlaying TCP stack, thank you for the detailed explanation! 



On Tuesday 7 May 2013 at 14:58, Tim Watson-6 [via RabbitMQ] wrote:

> Hi, 
> 
> On 7 May 2013, at 04:32, carlhoerberg wrote: 
> 
> > It looks like the rabbitmq java client doesn't raise an exception as soon as 
> > a connection fails, eg. due to network cable disconnection. 
> > 
> > The following code will continue to run for 2 minutes after the 
> > disconnection, and first then raise an exception. 
> 
> 
> That's perfectly normal, for a network driven application. It is not RabbitMQ's client library that wait's to throw an exception, but rather it is the operating system's network stack that takes time to determine that a peer socket is no longer available. This can take many minutes, even when you're connecting via the loopback interface (i.e., localhost) for testing. 
> 
> On most unices, the relevant bits of `man tcp` are: 
> 
> "When a network error occurs, TCP tries to resend the packet. If it 
> doesn't succeed after some time, either ETIMEDOUT or the last received 
> error on this connection is reported." 
> 
> In that second sentence, "after some time" is determined by the OS kernel configured limits, viz tcp_retries1 (defaults to 3 on linux) and tcp_retries2, and the configured retransmission timeout. Of course there are doubtless other parameters that interact with this behaviour. So you're quite lucky because it's a producer application that's trying to send - those time out much faster. For network consumer applications, this problem is quite a tricky on because the default settings on linux for example, mean delays of between 10 and 30 minutes before the OS networking layer "notices" the connection has timed out. 
> 
> This problem is, of course, not specific to RabbitMQ. 
> 
> Cheers, 
> Tim 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=26470&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Java-client-closed-connection-doesn-t-raise-exception-immediately-tp26465p26470.html 
> To unsubscribe from Java client: closed connection doesn't raise exception immediately, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=26465&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjY0NjV8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Java-client-closed-connection-doesn-t-raise-exception-immediately-tp26465p26472.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/0d5b61d1/attachment.htm>

From matthias at rabbitmq.com  Tue May  7 08:17:13 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 07 May 2013 08:17:13 +0100
Subject: [rabbitmq-discuss] Client vs Server version
In-Reply-To: <4DE87C66-DD42-433D-91DE-D55BA4EA74CD@rabbitmq.com>
References: <06536F18C0038E489237EEE3CA9BF2D014023842@FRGR1D2MX07.services.firstrand.net>
	<4DE87C66-DD42-433D-91DE-D55BA4EA74CD@rabbitmq.com>
Message-ID: <5188AA79.2030904@rabbitmq.com>

On 07/05/13 07:58, Tim Watson wrote:
> Technically it is possible to run disparate versions (the AMQP 0.9.1
> protocol hasn't changed between them after all), but I would strongly
> advise you to use the latest version with the latest server.

Actually, there really is no compelling reason to run the same versions. 
The fact that client and server can be upgraded independently is one of 
the strengths of AMQP.

> Not only have important bug fixes been introduced in the client
> libraries between releases

...which is a good incentive to run recent version. But they don't have 
to be the same as the server. E.g. it is perfectly ok to run the latest 
clients against an old server (as long as it's >=2.0.0 and hence speaks 
AMQP 0-9-1) if, say, the latter is harder to upgrade for operational 
reasons.

> but it's possible in some cases that non-standard
> features (i.e., enhancements to or divergence from the AMQP
> specification) have been added to (or deprecated from) the broker and
> the client might need to be aware of these.

None of these changes affect client library compatibility per se, though 
they may - in some very rare circumstances, e.g. the removal of the 
'immediate' flag you mention - affect applications. But in those cases 
it's really the applications that need updating.

Matthias.

From watson.timothy at gmail.com  Tue May  7 08:32:38 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 7 May 2013 08:32:38 +0100
Subject: [rabbitmq-discuss] Java client: closed connection doesn't raise
	exception immediately
In-Reply-To: <56648C651EBA4DF89FDB4D1A703A73C9@gmail.com>
References: <1367897569560-26465.post@n5.nabble.com>
	<773F6685-2286-4FE6-ACC8-49042C5EF122@rabbitmq.com>
	<56648C651EBA4DF89FDB4D1A703A73C9@gmail.com>
Message-ID: <B0C3C3DD-3F79-4D98-8B8D-18A1A10CCDA0@rabbitmq.com>

No problem - if you need to alleviate this then AMQP heartbeats can ensure client and broker notice a downed peer in a more timely fashion.

Cheers,
Tim

On 7 May 2013, at 08:04, carlhoerberg <carl.hoerberg at gmail.com> wrote:

> Ok, yes, suspected it had with to do with the underlaying TCP stack, thank you for the detailed explanation! 
> 
> 
> 
> On Tuesday 7 May 2013 at 14:58, Tim Watson-6 [via RabbitMQ] wrote: 
> 
> > Hi, 
> > 
> > On 7 May 2013, at 04:32, carlhoerberg wrote: 
> > 
> > > It looks like the rabbitmq java client doesn't raise an exception as soon as 
> > > a connection fails, eg. due to network cable disconnection. 
> > > 
> > > The following code will continue to run for 2 minutes after the 
> > > disconnection, and first then raise an exception. 
> > 
> > 
> > That's perfectly normal, for a network driven application. It is not RabbitMQ's client library that wait's to throw an exception, but rather it is the operating system's network stack that takes time to determine that a peer socket is no longer available. This can take many minutes, even when you're connecting via the loopback interface (i.e., localhost) for testing. 
> > 
> > On most unices, the relevant bits of `man tcp` are: 
> > 
> > "When a network error occurs, TCP tries to resend the packet. If it 
> > doesn't succeed after some time, either ETIMEDOUT or the last received  
> > error on this connection is reported." 
> > 
> > In that second sentence, "after some time" is determined by the OS kernel configured limits, viz tcp_retries1 (defaults to 3 on linux) and tcp_retries2, and the configured retransmission timeout. Of course there are doubtless other parameters that interact with this behaviour. So you're quite lucky because it's a producer application that's trying to send - those time out much faster. For network consumer applications, this problem is quite a tricky on because the default settings on linux for example, mean delays of between 10 and 30 minutes before the OS networking layer "notices" the connection has timed out. 
> > 
> > This problem is, of course, not specific to RabbitMQ. 
> > 
> > Cheers, 
> > Tim 
> > _______________________________________________ 
> > rabbitmq-discuss mailing list 
> > [hidden email] (/user/SendEmail.jtp?type=node&node=26470&i=0) 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> > If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Java-client-closed-connection-doesn-t-raise-exception-immediately-tp26465p26470.html  
> > To unsubscribe from Java client: closed connection doesn't raise exception immediately, click here ( 
> > NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml)
> 
> 
> 
> 
> View this message in context: Re: Java client: closed connection doesn't raise exception immediately
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/f21318a8/attachment.htm>

From elad at centunosolutions.com  Mon May  6 21:46:13 2013
From: elad at centunosolutions.com (elad)
Date: Mon, 6 May 2013 13:46:13 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
	upgrade to 3.1
Message-ID: <1367873173429-26461.post@n5.nabble.com>

Hi,

After upgrade to rabbitmq server 3.1.0 I started getting an error in rabbit
server logs:

=INFO REPORT==== 6-May-2013::17:32:46 ===
accepting AMQP connection <0.861.0> (127.0.0.1:42505 -> 127.0.0.1:5672)

=ERROR REPORT==== 6-May-2013::17:32:46 ===
** Generic server <0.865.0> terminating
** Last message in was {limit_prefetch,1,1}
** When Server state == {lim,1,<0.866.0>,false,[],0}
** Reason for termination == 
** {{badmatch,false},
 ? ?[{rabbit_limiter,handle_call,3,[]},
 ? ? {gen_server2,handle_msg,2,[]},
 ? ? {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 6-May-2013::17:32:46 ===
** Generic server <0.866.0> terminating
** Last message in was {'$gen_cast',
 ? ? ? ? ? ? ? ? ? ? ? ? ? {method,{'basic.qos',0,1,false},none,noflow}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.861.0>,
 ? ? ? ? ? ? ? ? ? ? ? ? <0.864.0>,<0.861.0>,
 ? ? ? ? ? ? ? ? ? ? ? ? <<"127.0.0.1:42505 -> 127.0.0.1:5672">>,
 ? ? ? ? ? ? ? ? ? ? ? ? {lstate,<0.865.0>,true,false},
 ? ? ? ? ? ? ? ? ? ? ? ? none,2,
 ? ? ? ? ? ? ? ? ? ? ? ? {[{1,none,{<0.223.0>,1}}],[]},
 ? ? ? ? ? ? ? ? ? ? ? ? {user,<<"guest">>,
 ? ? ? ? ? ? ? ? ? ? ? ? ?[administrator],
 ? ? ? ? ? ? ? ? ? ? ? ? ?rabbit_auth_backend_internal,
 ? ? ? ? ? ? ? ? ? ? ? ? ?{internal_user,<<"guest">>,
 ? ? ? ? ? ? ? ? ? ? ? ? ?
<<201,30,197,226,95,20,78,121,138,139,102,239,4,79,
 ? ? ? ? ? ? ? ? ? ? ? ? ? ? 110,36,250,20,90,249>>,
 ? ? ? ? ? ? ? ? ? ? ? ? ? [administrator]}},
 ? ? ? ? ? ? ? ? ? ? ? ? <<"/">>,<<"app_event">>,
 ? ? ? ? ? ? ? ? ? ? ? ? {dict,1,16,16,8,80,48,
 ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
 ? ? ? ? ? ? ? ? ? ? ? ? ? ?[[<0.223.0>|
 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{resource,<<"/">>,queue,<<"app_event">>}]]}}},
 ? ? ? ? ? ? ? ? ? ? ? ? {dict,1,16,16,8,80,48,
 ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
 ? ? ? ? ? ? ? ? ? ? ? ? ? ?[[<0.223.0>|#Ref<0.0.0.54323>]]}}},
 ? ? ? ? ? ? ? ? ? ? ? ? {dict,0,16,16,8,80,48,
 ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 ? ? ? ? ? ? ? ? ? ? ? ?
?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
 ? ? ? ? ? ? ? ? ? ? ? ? {set,0,16,16,8,80,48,
 ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 ? ? ? ? ? ? ? ? ? ? ? ?
?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
 ? ? ? ? ? ? ? ? ? ? ? ? {dict,0,16,16,8,80,48,
 ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 ? ? ? ? ? ? ? ? ? ? ? ?
?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
 ? ? ? ? ? ? ? ? ? ? ? ? {set,1,16,16,8,80,48,
 ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
 ? ? ? ? ? ? ? ? ? ? ? ? ? ?[<0.223.0>]}}},
 ? ? ? ? ? ? ? ? ? ? ? ? <0.860.0>,
 ? ? ? ? ? ? ? ? ? ? ? ? {state,fine,5000,#Ref<0.0.0.54313>},
 ? ? ? ? ? ? ? ? ? ? ? ? false,1,
 ? ? ? ? ? ? ? ? ? ? ? ? {{0,nil},{0,nil}},
 ? ? ? ? ? ? ? ? ? ? ? ? [],[],none}
** Reason for termination == 
** {noproc,{gen_server,call,[<0.865.0>,get_prefetch_limit]}}
** In 'terminate' callback with reason ==
** {{{{badmatch,false},
 ? ? ?[{rabbit_limiter,handle_call,3,[]},
 ? ? ? {gen_server2,handle_msg,2,[]},
 ? ? ? {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]},
 ? ? {gen_server,call,[<0.865.0>,{limit_prefetch,1,1}]}},
 ? ?[{gen_server,call,2,[{file,"gen_server.erl"},{line,180}]},
 ? ? {rabbit_limiter,limit_prefetch,3,[]},
 ? ? {rabbit_channel,handle_method,3,[]},
 ? ? {rabbit_channel,handle_cast,2,[]},
 ? ? {gen_server2,handle_msg,2,[]},
 ? ? {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 6-May-2013::17:32:46 ===
AMQP connection <0.861.0> (running), channel 1 - error:
{noproc,{gen_server,call,[<0.865.0>,get_prefetch_limit]}}

=WARNING REPORT==== 6-May-2013::17:32:46 ===
Non-AMQP exit reason '{noproc,
 ? ? ? ? ? ? ? ? ? ? ? ? ?{gen_server,call,[<0.865.0>,get_prefetch_limit]}}'


any ideas why it happens ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/PHP-amqp-0-9-1-breaks-after-rabbitmq-server-upgrade-to-3-1-tp26461.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From andrew.miller at sentry.com  Mon May  6 21:56:53 2013
From: andrew.miller at sentry.com (Andrew Miller)
Date: Mon, 6 May 2013 13:56:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Bug/Behavior Change in binds to header
 exchanges in rabbitmq 3.1.0
In-Reply-To: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>
References: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>
Message-ID: <0a8be3ad-5667-452c-80d2-e99ca26837c1@googlegroups.com>

I also ran into this behavior when updating my brokers today.  However, the 
change was a little more mysterious, as I had persistent queues setup with 
existing bindings from 3.0.2.  Instead of seeing any information about 
requiring x-match header on the queue bindings, I instead just received the 
following client error when trying to publish to the exchange:
 
RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP 
operation was interrupted: AMQP close-reason, initiated by Peer, code=541, 
text="INTERNAL_ERROR", classId=0, methodId=0, cause=
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply()
   at RabbitMQ.Client.Impl.ModelBase.ModelRpc(MethodBase method, 
ContentHeaderBase header, Byte[] body)
   at RabbitMQ.Client.Framing.Impl.v0_9_1.Model.TxCommit()
 
and on the broker, saw the following:
 
=ERROR REPORT==== 6-May-2013::15:33:54 ===
** Generic server <0.445.0> terminating
** Last message in was {'$gen_cast',
...
** Reason for termination == 
** {{{badmatch,undefined},
     [{rabbit_exchange_type_headers,headers_match,2,[]},
      {rabbit_router,'-match_bindings/2-fun-1-',10,[]},
      {qlc,collect,1,[{file,"qlc.erl"},{line,1328}]},
      {qlc,eval,2,[{file,"qlc.erl"},{line,296}]},
      {mnesia_tm,non_transaction,5,[{file,"mnesia_tm.erl"},{line,734}]},
      {rabbit_exchange,route1,3,[]},
      {rabbit_exchange,route,2,[]},
      {rabbit_channel,handle_method,3,[]}]},
    [{mnesia_tm,non_transaction,5,[{file,"mnesia_tm.erl"},{line,747}]},
     {rabbit_exchange,route1,3,[]},
     {rabbit_exchange,route,2,[]},
     {rabbit_channel,handle_method,3,[]},
     {rabbit_channel,handle_cast,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
 
I saw nothing in the release notes to indicate that this was an intended 
change.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130506/90d15887/attachment.htm>

From lariverosc at gmail.com  Tue May  7 02:09:37 2013
From: lariverosc at gmail.com (lariverosc)
Date: Mon, 6 May 2013 18:09:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Question about java client
Message-ID: <1367888977883-26464.post@n5.nabble.com>

I have a question related with a particular use case, that I need to
implement using the java client and the cloudamqp service, the scenario is
the following:

I want to send some messages to a queue, in the case of a connection
failure, I need to be notified immediately, in order to manage and recover
from the fault.

My client code looks like this:

        ConnectionFactory connectionFactory = new ConnectionFactory();
        connectionFactory.setUri("MyUri");
        connection = connectionFactory.newConnection();
        channel = connection.createChannel();
        channel.exchangeDeclare("messagesExchange", "direct", true);
        channel.queueDeclare("messagesQueue", true, false, false, null);
        channel.queueBind("messagesQueue", "messagesExchange",
"messagesRK");
        for (int i = 0;i<10000;i++){ 
          try {
            channel.basicPublish("messagesExchange",
"messagesRK",MessageProperties.PERSISTENT_TEXT_PLAIN, "My
message".getBytes());
           } catch (IOException ioe) {
             //I would expect that this exception will throw on network
failure but nothing happens 
            System.out.println("Error enqueueing message " + ioe);
         }
}

And currently I can view how the messages are received, however, when I
abruptly disconnect from the network nothing happens in the first two
minutes (Maybe a timeout setting?), and the sending process continues
without show any error.

My question is ?How I can get immediate feedback of the connection failure?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Question-about-java-client-tp26464.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue May  7 09:26:26 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 May 2013 09:26:26 +0100
Subject: [rabbitmq-discuss] consumer get messages from one queue
 sometimes disorder
In-Reply-To: <CAAjbVJC2Sie+bAusdENY5bJaGASqqy=SR89f7pyiMoeDHCuMnQ@mail.gmail.com>
References: <CAAjbVJC2Sie+bAusdENY5bJaGASqqy=SR89f7pyiMoeDHCuMnQ@mail.gmail.com>
Message-ID: <5188BAB2.4090303@rabbitmq.com>


Hi,

On 06/05/13 11:08, Xie Yunpeng wrote:

> I use 4 publisher sending messages to this queue and 1 consumer to
> receive the messages.the consumer when connect to the rabbitmq server ,

> i find it receive messages disorder sometimes, just like: first receive
> messges in current time and then receive messages several hour ago, the
> interval is not regular.


You can find the ordering guarantees here:
http://www.rabbitmq.com/semantics.html#ordering
In particular, there is no ordering guarantee if you involve multiple
publishers.



-Emile





From watson.timothy at gmail.com  Tue May  7 09:28:18 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 7 May 2013 09:28:18 +0100
Subject: [rabbitmq-discuss] Question about java client
In-Reply-To: <1367888977883-26464.post@n5.nabble.com>
References: <1367888977883-26464.post@n5.nabble.com>
Message-ID: <96E2D192-4269-48A6-8FB1-5E7DE847D273@rabbitmq.com>

On 7 May 2013, at 02:09, lariverosc <lariverosc at gmail.com> wrote:

> My question is ?How I can get immediate feedback of the connection failure?
> 

Turn on AMQP heartbeats. The error report won't be immediate, but it can be configured to notice peer removal faster than the os network stack.

Cheers,
Tim

From michael.s.klishin at gmail.com  Tue May  7 10:34:12 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 7 May 2013 13:34:12 +0400
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
 upgrade to 3.1
In-Reply-To: <1367873173429-26461.post@n5.nabble.com>
References: <1367873173429-26461.post@n5.nabble.com>
Message-ID: <CAE3HoVR1Xb-4Fn-kR5+ADw-4yzCYH_qsS5BZjV7XX0sT7WkrEA@mail.gmail.com>

2013/5/7 elad <elad at centunosolutions.com>

> any ideas why it happens ?


Can you please post your code that uses basic.qos?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/c8ba5aa0/attachment.htm>

From simon at rabbitmq.com  Tue May  7 10:36:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 May 2013 10:36:00 +0100
Subject: [rabbitmq-discuss] Publish behavior during 3.1 eager
	synchronisation?
In-Reply-To: <CACLE7ixg-yUgWN0cBQw=iAWnZD2GLLB4z_729Oh_SVX-ZH6kTw@mail.gmail.com>
References: <CACLE7ixg-yUgWN0cBQw=iAWnZD2GLLB4z_729Oh_SVX-ZH6kTw@mail.gmail.com>
Message-ID: <5188CB00.9070703@rabbitmq.com>

The publish (or rather, the tx.commit) will block, not fail.

Cheers, Simon

On 03/05/2013 21:39, Matt Pietrek wrote:
> Perhaps this is answered from the docs, but if so I missed it.
>
> The docs say "Since the queue becomes unresponsive while synchronisation
> is occurring..."
>
> Our clients use transactions to ensure our publishes are synchronous and
> commited by the time the call returns. Will these publishes simply
> block, possibly longer, if an eager sync is in progress? Or will the
> publish fail for some reason.
>
> I suspect the former, but just want to confirm to ease possible concerns
> by others here.
>
> Thanks,
>
> Matt
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From matthias at rabbitmq.com  Tue May  7 10:48:22 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 07 May 2013 10:48:22 +0100
Subject: [rabbitmq-discuss] Bug/Behavior Change in binds to header
 exchanges in rabbitmq 3.1.0
In-Reply-To: <0a8be3ad-5667-452c-80d2-e99ca26837c1@googlegroups.com>
References: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>
	<0a8be3ad-5667-452c-80d2-e99ca26837c1@googlegroups.com>
Message-ID: <5188CDE6.40300@rabbitmq.com>

Andrew,

On 06/05/13 21:56, Andrew Miller wrote:
> I also ran into this behavior when updating my brokers today.  However,
> the change was a little more mysterious, as I had persistent queues
> setup with existing bindings from 3.0.2.  Instead of seeing any
> information about requiring x-match header on the queue bindings, I
> instead just received the following client error when trying to publish
> to the exchange:

Ah yes. We forgot to consider upgrades. Sorry. Have filed a bug to look 
into that.

Matthias.

From woqimingweipeng at gmail.com  Tue May  7 10:51:20 2013
From: woqimingweipeng at gmail.com (Xie Yunpeng)
Date: Tue, 7 May 2013 17:51:20 +0800
Subject: [rabbitmq-discuss] consumer get messages from one queue
	sometimes disorder
In-Reply-To: <5188BAB2.4090303@rabbitmq.com>
References: <CAAjbVJC2Sie+bAusdENY5bJaGASqqy=SR89f7pyiMoeDHCuMnQ@mail.gmail.com>
	<5188BAB2.4090303@rabbitmq.com>
Message-ID: <CAAjbVJA=2g_9K84-wLbyEa0bcR0LjsXJsP85dtvx0busR22FDg@mail.gmail.com>

it is not just messages in disorder, sometimes it cosume all the messages
in the queue (in fact not all messages been consumed, some messages in the
queue NOT been consumed, but when you check the queue it is empty) ,then
after a while when the publisher send message to the queue the consumer
will receive not just new messages but some messages several hours ago.

i think the case is declare queue with different args, but i doubt why it
not return failed when declare the queue


2013/5/7 Emile Joubert <emile at rabbitmq.com>

>
> Hi,
>
> On 06/05/13 11:08, Xie Yunpeng wrote:
>
> > I use 4 publisher sending messages to this queue and 1 consumer to
> > receive the messages.the consumer when connect to the rabbitmq server ,
>
> > i find it receive messages disorder sometimes, just like: first receive
> > messges in current time and then receive messages several hour ago, the
> > interval is not regular.
>
>
> You can find the ordering guarantees here:
> http://www.rabbitmq.com/semantics.html#ordering
> In particular, there is no ordering guarantee if you involve multiple
> publishers.
>
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/bf578c60/attachment.htm>

From tim at rabbitmq.com  Tue May  7 10:51:52 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 7 May 2013 10:51:52 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
Message-ID: <01FEE5CD-9DF8-4D4C-8801-9ED927F8C8BB@rabbitmq.com>

Hi Michael,

On 3 May 2013, at 10:45, Michael Klishin wrote:

> You'll need Ruby and RubyGems available.

>> /Users/t4/.bundler/ruby/1.8/bunny-78993f04f332/lib/bunny/socket.rb:42:in `read_fully': uninitialized constant IO::WaitReadable (NameError)

Caveats - you'll need Rubu 1.9.x right? This blows up with 1.8.7 on my mac (trying to reproduce the slowness) - I guess that's a kinda ancient ruby anyway, but I didn't install rvm on this laptop yet. Still, I'll do on CentOS with 1.9. Will let you know how I get on.

Ta,
Tim

From simon at rabbitmq.com  Tue May  7 10:54:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 May 2013 10:54:52 +0100
Subject: [rabbitmq-discuss] consumer get messages from one queue
 sometimes disorder
In-Reply-To: <5188BAB2.4090303@rabbitmq.com>
References: <CAAjbVJC2Sie+bAusdENY5bJaGASqqy=SR89f7pyiMoeDHCuMnQ@mail.gmail.com>
	<5188BAB2.4090303@rabbitmq.com>
Message-ID: <5188CF6C.6070602@rabbitmq.com>

On 07/05/2013 09:26, Emile Joubert wrote:
> On 06/05/13 11:08, Xie Yunpeng wrote:
>
>> I use 4 publisher sending messages to this queue and 1 consumer to
>> receive the messages.the consumer when connect to the rabbitmq server ,
>
>> i find it receive messages disorder sometimes, just like: first receive
>> messges in current time and then receive messages several hour ago, the
>> interval is not regular.
>
>
> You can find the ordering guarantees here:
> http://www.rabbitmq.com/semantics.html#ordering
> In particular, there is no ordering guarantee if you involve multiple
> publishers.

Well, there's still exactly the same ordering guarantee as there is with 
a single publisher: messages from each publishing channel won't get 
reordered with respect to each other. We just don't guarantee anything 
about ordering between channels. And indeed it's hard to see how we could.

To the OP: either something weird is happening in your publishers 
causing them to buffer messages for hours before sending to RabbitMQ 
(unlikely I guess but I should mention it) or messages are not being 
acknowledged by your consumers and are then being requeued once the 
consumer disconnects. In the latter case all the "late" messages should 
have the "redelivered" flag set.

Cheers, Simon

From simon at rabbitmq.com  Tue May  7 10:56:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 May 2013 10:56:30 +0100
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
 upgrade to 3.1
In-Reply-To: <CAE3HoVR1Xb-4Fn-kR5+ADw-4yzCYH_qsS5BZjV7XX0sT7WkrEA@mail.gmail.com>
References: <1367873173429-26461.post@n5.nabble.com>
	<CAE3HoVR1Xb-4Fn-kR5+ADw-4yzCYH_qsS5BZjV7XX0sT7WkrEA@mail.gmail.com>
Message-ID: <5188CFCE.8000409@rabbitmq.com>

On 07/05/2013 10:34, Michael Klishin wrote:
> 2013/5/7 elad <elad at centunosolutions.com <mailto:elad at centunosolutions.com>>
>
>     any ideas why it happens ?
>
>
> Can you please post your code that uses basic.qos?

I second this. That's an assertion failure you're seeing, so I am very 
interested in replicating it!

Cheers, Simon


From woqimingweipeng at gmail.com  Tue May  7 11:26:32 2013
From: woqimingweipeng at gmail.com (Xie Yunpeng)
Date: Tue, 7 May 2013 18:26:32 +0800
Subject: [rabbitmq-discuss] consumer get messages from one queue
	sometimes disorder
In-Reply-To: <5188CF6C.6070602@rabbitmq.com>
References: <CAAjbVJC2Sie+bAusdENY5bJaGASqqy=SR89f7pyiMoeDHCuMnQ@mail.gmail.com>
	<5188BAB2.4090303@rabbitmq.com> <5188CF6C.6070602@rabbitmq.com>
Message-ID: <CAAjbVJCYkNA0QPb=D8mn2+c=A4K-nLme_BM=6t=4mH+k27_E3A@mail.gmail.com>

thx, i will do some test and analyse log to verify the second condition.i
think it is the real reason.


2013/5/7 Simon MacMullen <simon at rabbitmq.com>

> On 07/05/2013 09:26, Emile Joubert wrote:
>
>> On 06/05/13 11:08, Xie Yunpeng wrote:
>>
>>  I use 4 publisher sending messages to this queue and 1 consumer to
>>> receive the messages.the consumer when connect to the rabbitmq server ,
>>>
>>
>>  i find it receive messages disorder sometimes, just like: first receive
>>> messges in current time and then receive messages several hour ago, the
>>> interval is not regular.
>>>
>>
>>
>> You can find the ordering guarantees here:
>> http://www.rabbitmq.com/**semantics.html#ordering<http://www.rabbitmq.com/semantics.html#ordering>
>> In particular, there is no ordering guarantee if you involve multiple
>> publishers.
>>
>
> Well, there's still exactly the same ordering guarantee as there is with a
> single publisher: messages from each publishing channel won't get reordered
> with respect to each other. We just don't guarantee anything about ordering
> between channels. And indeed it's hard to see how we could.
>
> To the OP: either something weird is happening in your publishers causing
> them to buffer messages for hours before sending to RabbitMQ (unlikely I
> guess but I should mention it) or messages are not being acknowledged by
> your consumers and are then being requeued once the consumer disconnects.
> In the latter case all the "late" messages should have the "redelivered"
> flag set.
>
> Cheers, Simon
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/d04e34dc/attachment.htm>

From matthias at rabbitmq.com  Tue May  7 11:27:17 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 07 May 2013 11:27:17 +0100
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
 upgrade to 3.1
In-Reply-To: <5188CFCE.8000409@rabbitmq.com>
References: <1367873173429-26461.post@n5.nabble.com>
	<CAE3HoVR1Xb-4Fn-kR5+ADw-4yzCYH_qsS5BZjV7XX0sT7WkrEA@mail.gmail.com>
	<5188CFCE.8000409@rabbitmq.com>
Message-ID: <5188D705.9060005@rabbitmq.com>

On 07/05/13 10:56, Simon MacMullen wrote:
> On 07/05/2013 10:34, Michael Klishin wrote:
>> 2013/5/7 elad <elad at centunosolutions.com
>> <mailto:elad at centunosolutions.com>>
>>
>>     any ideas why it happens ?
>>
>>
>> Can you please post your code that uses basic.qos?
>
> I second this. That's an assertion failure you're seeing, so I am very
> interested in replicating it!

No need to. It's a bug and I've reproduced it.

The conditions to trigger it require setting the basic.qos prefetch 
count multiple times on the same channel, while there are active 
consumers. That is quite an unusual setup; more commonly the prefetch 
count is only set once, before consumers are created.

To the OP: you may want to look into that; basic.qos calls are 
synchronous and expensive, so applications should only issue them when 
the prefetch_count settings need changing.

Regards,

Matthias.


From moonstorm at gmail.com  Tue May  7 12:24:08 2013
From: moonstorm at gmail.com (MoonStorm)
Date: Tue, 7 May 2013 04:24:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Queues no longer expire in RabbitMq 3.1.0
Message-ID: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>

Declaring a queue with "x-expires" set to a valid value has no effect after 
the consumers disconnect. The admin interface reports the queue being idle 
with no consumers present.

They used to expire in earlier versions. Are there additional requirements 
now to achieve the same behavior?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/283d1e1c/attachment.htm>

From chenyalong1988 at gmail.com  Tue May  7 12:39:29 2013
From: chenyalong1988 at gmail.com (yaLong Chen)
Date: Tue, 7 May 2013 04:39:29 -0700 (PDT)
Subject: [rabbitmq-discuss] topic for rabbitmq
Message-ID: <e41d7f32-0639-4ed4-b966-f0d59ab34a3f@googlegroups.com>

Hi,all,

  Background: now client produces many messages of different 
labels.Consumers may subscribe some labels of them(different consumer need 
different labels's msgs).
  Now method: I used direct exchange in *rabbitmq*, consumer declared queue 
for itself, exchange distribute msgs to these queues.
  Problem: there exsit many redundant msgs in queues which effects the 
performance. 

  A topic type in *activemq* supports user a method to distribute a msg to 
many subscribers, which need not creates large number queues for 
subscribers.
Does exsit a method in rabbitmq, or some suggestions to solve the problem?



Thanks,
Yalong
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/fcf6ffad/attachment.htm>

From chads.finishing.strong at gmail.com  Tue May  7 14:08:16 2013
From: chads.finishing.strong at gmail.com (chads.finishing.strong at gmail.com)
Date: Tue, 7 May 2013 06:08:16 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 : LDAP Plugin
Message-ID: <6a990cb4-62bb-45f0-a80c-08f486618d52@googlegroups.com>


I'm unable to get the ldap plugin to log any debug information.

Current configuration:

<snip>
{servers, ["ldap.example.com"]},
{dn_lookup_attribute, "sAMAccountName"},
{dn_lookup_base, "DC=example,DC=com"},
{other_bind, {"example\\\ldapadmin", "mypasswd"}},
{use_ssl, false},
{port, 389},
{log, network},
{tag_queries, [
   {administrator, {constant, true}},
   {management,    {constant, true}},
   {monitoring,    {constant, true}}
]}
<snip>

Thoughts?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/3ffd7dc7/attachment.htm>

From wsmith at tacc.utexas.edu  Tue May  7 15:58:50 2013
From: wsmith at tacc.utexas.edu (Warren Smith)
Date: Tue, 7 May 2013 14:58:50 +0000
Subject: [rabbitmq-discuss] client cert & user/pass authentication
Message-ID: <4B5D885B77E8CC43852B8F0315AD03BA41BE87B7@EXMBX01.austin.utexas.edu>


I'm using the rabbitmq-auth-mechanism-ssl plugin to authenticate clients using certificates that the clients present. This is working well, but for convenience, I'd also like to allow a few users to authenticate using a username/password over an ssl connection.

rabbitmq-auth-mechanism-ssl requires that the ssl_options in the the rabbitmq.config include {fail_if_no_peer_cert,true}, so user/pass authentication can't be performed. If I try to set it to false, the client certificate seems to be ignored.

I have {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']} in the rabbitmq.config and users can authenticate over tcp with a user/pass, but I'd prefer that they use ssl. Is there a configuration that would allow me to support both client certificate and username/password authentication over ssl?


Thanks,


Warren


From matthias at rabbitmq.com  Tue May  7 17:20:53 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 07 May 2013 17:20:53 +0100
Subject: [rabbitmq-discuss] After server notifies of canceled consume,
 it doesn't acknowledge a channel close
In-Reply-To: <CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
References: <CANSL5VFUDfxM0R59wMECsCYYc+u6jxvV_DbeaTEUY4YaVvvTSw@mail.gmail.com>
	<5180F745.6090307@rabbitmq.com>
	<CANSL5VGtebae76ENYcGpzhGYX-HMyC+ekDe47g9D1PqCSMtW=w@mail.gmail.com>
Message-ID: <518929E5.3050804@rabbitmq.com>

On 01/05/13 23:40, Chip Salzenberg wrote:
> Does the Java automated test of close-after-cancel-notification expect a
> CloseOk?  Does it get one?

Yes.

> How do you suggest dumping the frame traffic without depending on the
> suspect client module?

You could run your connection through the AMQP tracer - 
http://www.rabbitmq.com/api-guide.html#tracer

Or capture the network traffic with wireshark.

Regards,

Matthias.

From nathan at nkbrown.us  Tue May  7 17:34:06 2013
From: nathan at nkbrown.us (Nathan Brown)
Date: Tue, 7 May 2013 09:34:06 -0700
Subject: [rabbitmq-discuss] Porting .NET client to WinRT API (Windows 8).
Message-ID: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>

Hello,

I am working on a project that involves a client interface on a Windows 8
tablet.  The backend is using RabbitMQ and I am trying to get the .NET
client working in the Windows 8 Modern UI.

.NET applications using Modern UI (and the WinRT API) can use most of the
.NET namespace, but some things are depreciated.  For example, non-generic
collections (ArrayList, Hastable, SortedList, etc.) are no longer present.

I know these collections were in the RabbitMQ client codebase for .NET 1.1
compatibility, but I noticed that several years ago in this mailing list
that .NET 1.1 compatibility was no longer considered a necessity.  I have a
branch where I have only made the changes required to use the generic
collections.  I have posted it to BitBucket:

https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/commits/branch/depreciate1_1

Can you guys review these changes and consider incorporating them into the
mainline codebase?

The networking area is another area of change in WinRT.  It will have to
involve a separate project because System.Net.Sockets has been removed and
Windows.Networking.Sockets has been added.  I am still working on porting
the networking code to the WinRT API, but that will hit far fewer files
than the non-generic to generic collection conversion.

Thanks,

Nathan Brown
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/58687414/attachment.htm>

From lists at bitfaeule.net  Tue May  7 17:55:30 2013
From: lists at bitfaeule.net (lists at bitfaeule.net)
Date: Tue, 7 May 2013 18:55:30 +0200 (CEST)
Subject: [rabbitmq-discuss] Can Rabbit MQ consume Tibco JMS messages?
In-Reply-To: <CADtU9_unhgAoC-Z2S4LQWMQ4WC_Fh5BSrT5Tje8KxFpJW+MUQw@mail.gmail.com>
References: <1140778309.219503.1367883586096.open-xchange@ox-webdesk.1und1.de>
	<CADtU9_unhgAoC-Z2S4LQWMQ4WC_Fh5BSrT5Tje8KxFpJW+MUQw@mail.gmail.com>
Message-ID: <1155244506.59686.1367945730399.open-xchange@ox-webdesk.1und1.de>

Thank you Gary. That makes sense and it should be straight forward since I
already have a spring JMS template based consumer for tibco.

Couz


> Gary Russell <grussell at gopivotal.com> hat am 7. Mai 2013 um 04:50 geschrieben:
> 
>  You could use a very simple Spring Integration application to consume
> messages from Tibco (use an <int-jms:message-driven-adapter/> ->
> <int:channel/> -> <int-amqp:outbound-channel-adapter/>).
>   <http://static.springsource.org/spring-integration/reference/html/>
>   <http://www.springsource.org/spring-integration/>
> 
> 
>  On Mon, May 6, 2013 at 7:39 PM, lists at bitfaeule.net
> <mailto:lists at bitfaeule.net> <lists at bitfaeule.net <mailto:lists at bitfaeule.net>
> > wrote:
>    > > 
> >    Hi there I'm a newb to RabbitMQ, hence please excuse if this equation has
> > an obvious answer.
> > 
> > 
> > 
> >    I need to build a jerkins build trigger that will kick off builds when
> > JMS messages are received. I found the Jenkins plugin fro Rabbit MQ (
> > https://wiki.jenkins-ci.org/display/JENKINS/RabbitMQ+Consumer+Plugin
> > <https://wiki.jenkins-ci.org/display/JENKINS/RabbitMQ+Consumer+Plugin>  )
> > which seems to be headed in the right direction. I now wonder if I can get
> > RabbitMQ to consume message from the Tibco JMS broker that I'm forced to use
> > due to the companies' messaging infrastructure that I work for.
> > 
> > 
> > 
> >    Thank you.
> > 
> > 
> > 
> >    Couz
> > 
> > 
> >    _______________________________________________
> >    rabbitmq-discuss mailing list
> >    rabbitmq-discuss at lists.rabbitmq.com
> > <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> >    <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
> > 
> >  > 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/02b85778/attachment.htm>

From prazzee at gmail.com  Tue May  7 18:43:19 2013
From: prazzee at gmail.com (Prazzy)
Date: Tue, 7 May 2013 10:43:19 -0700
Subject: [rabbitmq-discuss] How to check if the consumer application is
 processing a message? for how long?
Message-ID: <CAN5oP9XxHHjfybqeOA0a5UV8jpLjpg1dPopp52oGTC=5jSANyg@mail.gmail.com>

How do we check if the consumer application is processing a message? for
how long? We are interested to check if consumer application has been
running for some amount of time. If it exceeds a configured limit, it
should generate an alert.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/fe0dcf5c/attachment.htm>

From nathannis at gmail.com  Tue May  7 19:05:02 2013
From: nathannis at gmail.com (Nathan Shirlberg)
Date: Tue, 7 May 2013 11:05:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Hanging connections in management interface
	(v3.0.4)
In-Reply-To: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
Message-ID: <6f64815a-8b31-4a9b-ba40-3865e1580cdb@googlegroups.com>

We are running  RabbitMQ *2.8.7* on Erlang *R14B04 and see similar 
behavior.  Usually around the same time as network glitches.  We use an F5 
load balancer that we believe is keeping the connection open even though 
the client was (sometimes forcefully) severed.  We either Force the 
connection closed through API, or just let it sit long enough that the 
connections drop, the conumsers disappear, and the messages get requeued.*

On Monday, April 29, 2013 10:23:43 AM UTC-5, Allan Beaufour wrote:
>
> I've for a long time had an issue where queues show hanging connections in 
> the management interface. The queues show a number of perpetual unacked 
> messages and even if I shut down all consumers, these remain. The ip+port 
> for the consumers doesn't match any processes either. Is this a known bug?
>
> I've had this issues for a while. We were running v2.7.1 perviously and 
> was secretly hoping they would disappear in the upgrade :)
>
> Thanks,
>
> Allan
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/1363d8f4/attachment.htm>

From calvin at segment.io  Tue May  7 20:55:40 2013
From: calvin at segment.io (Calvin French-Owen)
Date: Tue, 7 May 2013 12:55:40 -0700
Subject: [rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
In-Reply-To: <51877334.4060303@rabbitmq.com>
References: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>
	<51877334.4060303@rabbitmq.com>
Message-ID: <CABWW-1Wa=74vUQ03U6Q6KKr9+-wWewdKvbwdw6pmBKe1iAqRKw@mail.gmail.com>

We use node-amqp to prefetch multiple messages and then ack them one at a
time. It looks a bit like this:


function subscribe(queue) {
  queue.bind('ingestion', '#');

  var options = { ack : true, prefetchCount : 1000 };

  queue.subscribe(options, function (payload, headers, deliveryInfo, message) {
    importer.log(payload, function (err) {
      try {
        if (err) message.reject(true); // requeue the message
        else message.acknowledge(false); // acknowledge only this message
      } catch (e) {
        logger.error('Error acknowledging queue message', { err : e });
      }
    });
  });
}

Cheers,
-Calvin




On Mon, May 6, 2013 at 2:09 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 05/05/13 23:48, macmillan.josh09 at gmail.com wrote:
>
>> My Node.js worker crashes (RECONDITION_FAILED - unknown delivery tag) if
>> the following 2 conditions are met:
>>
>> 1. I start it AFTER the queue have at least 2 messages.
>> 2. The q.shift() is in an async code.
>>
>> http://pastebin.com/uMQJn0Fe
>>
>
> Looking at the amqp.js code, q.shift() acknowledges the last message that
> was received. So with your code...
>
>
>           q.subscribe({ack:true, prefetchCount: 0}, function (message,
>>     headers, deliveryInfo) {
>>            console.log(message);
>>            setTimeout(function() { q.shift(); }, 100);
>>     });
>>     });
>>
>
> due to the delayed execution, when two messages arrive in quick succession
> then the first to arrive won't be acknowledged at all and the second will
> be acknowledged twice. Rabbit is complaining about the latter.
>
> I've never used node-amqp, so I don't know what the correct approach is
> for accomplishing what you want to do. You may want to ask the node-amqp
> developers.
>
> Matthias
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/19bcd5c7/attachment.htm>

From elad at centunosolutions.com  Wed May  8 02:57:47 2013
From: elad at centunosolutions.com (elad)
Date: Tue, 7 May 2013 18:57:47 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
	upgrade to 3.1
In-Reply-To: <1367873173429-26461.post@n5.nabble.com>
References: <1367873173429-26461.post@n5.nabble.com>
Message-ID: <1367978267359-26499.post@n5.nabble.com>

hey guys, here is the code I use:
        $conn_args = array('host' => '127.0.0.1', 'port' => '5672', 'login'
=> 'Administrator', 'password' => 'admin');
        $cnn = new AMQPConnection($conn_args);
        $cnn->connect();

        $ch = new AMQPChannel($cnn);
        $ch->setPrefetchCount(1);

        $q = new AMQPQueue($ch);
        $q->setName('app_event');
        $q->setFlags(AMQP_DURABLE);
        $q->declare();

while($message = $q->get()) {
        echo("Message #".$message->getDeliveryTag()."
'".$message->getBody()."'");
}


It get stuck and I get an exception that the connection closed unexpectedly.

if I set         $ch->setPrefetchCount(1) to 0, then everything works.

The funny thing is that with rabbitmq 3.0 (previous version) all worked
perfect and I didnt change the amqp lib.

any ideas ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/PHP-amqp-0-9-1-breaks-after-rabbitmq-server-upgrade-to-3-1-tp26461p26499.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed May  8 06:00:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 May 2013 06:00:16 +0100
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
 upgrade to 3.1
In-Reply-To: <1367978267359-26499.post@n5.nabble.com>
References: <1367873173429-26461.post@n5.nabble.com>
	<1367978267359-26499.post@n5.nabble.com>
Message-ID: <5189DBE0.3040207@rabbitmq.com>

On 08/05/13 02:57, elad wrote:
> hey guys, here is the code I use:
>          $conn_args = array('host' => '127.0.0.1', 'port' => '5672', 'login'
> => 'Administrator', 'password' => 'admin');
>          $cnn = new AMQPConnection($conn_args);
>          $cnn->connect();
>
>          $ch = new AMQPChannel($cnn);
>          $ch->setPrefetchCount(1);
>
>          $q = new AMQPQueue($ch);
>          $q->setName('app_event');
>          $q->setFlags(AMQP_DURABLE);
>          $q->declare();
>
> while($message = $q->get()) {
>          echo("Message #".$message->getDeliveryTag()."
> '".$message->getBody()."'");
> }
>
>
> It get stuck and I get an exception that the connection closed unexpectedly.
>
> if I set         $ch->setPrefetchCount(1) to 0, then everything works.
>
> The funny thing is that with rabbitmq 3.0 (previous version) all worked
> perfect and I didnt change the amqp lib.
>
> any ideas ?

As I noted yesterday - 
http://rabbitmq.1065348.n5.nabble.com/PHP-amqp-0-9-1-breaks-after-rabbitmq-server-upgrade-to-3-1-tp26461p26488.html 
- this is a (new) bug.

Btw, setting the prefetch in the above code is actually pointless. You 
are retrieving messages with basic.get, which is not subject to prefetch 
counts since it fetches one message at a time anyway.

Matthias.

From milosgajdos83 at gmail.com  Wed May  8 03:01:10 2013
From: milosgajdos83 at gmail.com (Milos Gajdos)
Date: Tue, 7 May 2013 19:01:10 -0700 (PDT)
Subject: [rabbitmq-discuss] ha-sync-mode policy is NOT recognized
Message-ID: <9477e749-8c75-4f5a-bb2b-79701bb70db1@googlegroups.com>

Hi there.
I'm trying to set up auto synching on my RabbitMQ cluster with mirrored 
queues however when running particular command as per documetation 
(http://www.rabbitmq.com/ha.html) I'm getting the error that this policy is 
NOT recognized:

$ sudo rabbitmqctl set_policy -p my_vhost HA '^(?!amq.).*' '{"ha-mode": "all", "ha-sync-mode": "automatic"}'

Setting policy "HA" for pattern "^(?!amq.).*" to "{\"ha-mode\": \"all\", \"ha-sync-mode\": \"automatic\"}" ...
Error: Validation failed
 
[{<<"ha-sync-mode">>,<<"automatic">>}] are not recognised policy settings
$

I tried the same via management interface ie  via WebUI but the result is the same.
The version of rabbit I'm using is 3.1 but I noticed the same problem on 3.0
Anyone knows how to get this working IF possible ?
Thanks

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/b7511aa8/attachment.htm>

From matthias at rabbitmq.com  Wed May  8 06:29:01 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 May 2013 06:29:01 +0100
Subject: [rabbitmq-discuss] ha-sync-mode policy is NOT recognized
In-Reply-To: <9477e749-8c75-4f5a-bb2b-79701bb70db1@googlegroups.com>
References: <9477e749-8c75-4f5a-bb2b-79701bb70db1@googlegroups.com>
Message-ID: <5189E29D.304@rabbitmq.com>

On 08/05/13 03:01, Milos Gajdos wrote:
> $ sudo rabbitmqctl set_policy -p my_vhost HA '^(?!amq.).*' '{"ha-mode":
> "all", "ha-sync-mode": "automatic"}'
>
> Setting policy "HA" for pattern "^(?!amq.).*" to "{\"ha-mode\": \"all\",
> \"ha-sync-mode\": \"automatic\"}" ...
> Error: Validation failed
> [{<<"ha-sync-mode">>,<<"automatic">>}] are not recognised policy settings
> $
>
> I tried the same via management interface ie via WebUI but the result is
> the same.
> The version of rabbit I'm using is 3.1 but I noticed the same problem on 3.0
> Anyone knows how to get this working IF possible ?

The above works fine for me.

ha-sync-mode is a new feature in 3.1. Are you sure you are running the 
latest broker version? Check with 'rabbitmqctl status'.

Matthias.

From brett.r.cameron at gmail.com  Wed May  8 06:32:11 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 8 May 2013 17:32:11 +1200
Subject: [rabbitmq-discuss] ha-sync-mode policy is NOT recognized
In-Reply-To: <5189E29D.304@rabbitmq.com>
References: <9477e749-8c75-4f5a-bb2b-79701bb70db1@googlegroups.com>
	<5189E29D.304@rabbitmq.com>
Message-ID: <CALPqkipi2f7n9cApDN+CQsh8MmckazdbkBXiM=XZQai1_h0tWw@mail.gmail.com>

Work fine for me too (using 3.1.0 via web UI)



On Wed, May 8, 2013 at 5:29 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 08/05/13 03:01, Milos Gajdos wrote:
>
>> $ sudo rabbitmqctl set_policy -p my_vhost HA '^(?!amq.).*' '{"ha-mode":
>> "all", "ha-sync-mode": "automatic"}'
>>
>> Setting policy "HA" for pattern "^(?!amq.).*" to "{\"ha-mode\": \"all\",
>> \"ha-sync-mode\": \"automatic\"}" ...
>> Error: Validation failed
>> [{<<"ha-sync-mode">>,<<"**automatic">>}] are not recognised policy
>> settings
>> $
>>
>> I tried the same via management interface ie via WebUI but the result is
>> the same.
>> The version of rabbit I'm using is 3.1 but I noticed the same problem on
>> 3.0
>> Anyone knows how to get this working IF possible ?
>>
>
> The above works fine for me.
>
> ha-sync-mode is a new feature in 3.1. Are you sure you are running the
> latest broker version? Check with 'rabbitmqctl status'.
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/a1515198/attachment.htm>

From erik.ward at findwise.com  Wed May  8 07:45:41 2013
From: erik.ward at findwise.com (Erik Ward)
Date: Wed, 8 May 2013 06:45:41 +0000
Subject: [rabbitmq-discuss]  Stop rabbit qeues from writing to disk
Message-ID: <222D0B2E7B21844793E858BC30706921131A52AE@AMXPRD0510MB352.eurprd05.prod.outlook.com>

Hello!

I am wondering if there is a way to stop rabbit queues from paging to disk?

Could this be done in configuration? Replacing the backing store?

Best,
Erik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/66c1bc95/attachment.htm>

From fearsome.lucidity at gmail.com  Wed May  8 08:27:49 2013
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Wed, 8 May 2013 09:27:49 +0200
Subject: [rabbitmq-discuss] Internode cluster statistics
Message-ID: <CAFDmHdOrtpzLPVp-9SB7uKsdN13cVobowef5V8Z_WDioTqg9Hg@mail.gmail.com>

We are designing a system using RMQ that we would like to be capable to
scale to very high message rates.  To do so, we are planning on introducing
publisher and consumer node affinity to whatever node is currently the
master node of the HA queues we plan on using.

It would be useful in noticing when this system is not working if RMQ
exposed statistics on internode message traffic.  In particular, it would
be nice to have statistics on when a message is received by a queue from a
publisher in a different node, or when a message is consumer from a queue
by a consumer in a different node.  Essentially, stats for whenever a
message has to be forwarded to a different node except for messages
forwarded to HA queue slaves.

Thoughts?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/6c5d3034/attachment.htm>

From emile at rabbitmq.com  Wed May  8 08:43:14 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 08 May 2013 08:43:14 +0100
Subject: [rabbitmq-discuss] Stop rabbit qeues from writing to disk
In-Reply-To: <222D0B2E7B21844793E858BC30706921131A52AE@AMXPRD0510MB352.eurprd05.prod.outlook.com>
References: <222D0B2E7B21844793E858BC30706921131A52AE@AMXPRD0510MB352.eurprd05.prod.outlook.com>
Message-ID: <518A0212.4000001@rabbitmq.com>


Hi Erik,

On 08/05/13 07:45, Erik Ward wrote:
> I am wondering if there is a way to stop rabbit queues from paging to disk?

Not at the moment. The broker may decide to send messages to disk when
even a small fraction of memory is used.

> Could this be done in configuration? Replacing the backing store?

There is no configuration that prevents messages from being saved to
disk. You may be able to achieve this by providing your own queue
implementation or by configuring the broker to persist messages on a RAM
disk.

Can you provide the motivation behind your question? What should happen
when the broker runs out of memory?






-Emile








From mtlotfizad at gmail.com  Wed May  8 09:33:42 2013
From: mtlotfizad at gmail.com (Mohsen Lotfizad)
Date: Wed, 8 May 2013 13:03:42 +0430
Subject: [rabbitmq-discuss] does client caches messages?
Message-ID: <CAJzgYrDYMVby2tb8PJs_ia5VyNk0nHEVpX6rSJO2t5VanrjQpg@mail.gmail.com>

Hello everybody,

I have a subscriber that consumes from server but doesn't ACK immediately
because message processing involves database operation. If database
operations goes well, then ACK will be sent, otherwise message save in db
and then ACK will send.

suddenly I saw in rabbitMQ UI management that my consumer takes 200 message
and ACK them one by one!
Is it seems OK? or one of my setting do this?



-- 
Sincerely
*ML*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/6c7b062d/attachment.htm>

From tim at rabbitmq.com  Wed May  8 10:26:10 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 8 May 2013 10:26:10 +0100
Subject: [rabbitmq-discuss] does client caches messages?
In-Reply-To: <CAJzgYrDYMVby2tb8PJs_ia5VyNk0nHEVpX6rSJO2t5VanrjQpg@mail.gmail.com>
References: <CAJzgYrDYMVby2tb8PJs_ia5VyNk0nHEVpX6rSJO2t5VanrjQpg@mail.gmail.com>
Message-ID: <1746F344-A2D6-4DCE-9328-36EEA5379374@rabbitmq.com>

Hi,

On 8 May 2013, at 09:33, Mohsen Lotfizad wrote:

> I have a subscriber that consumes from server but doesn't ACK immediately because message processing involves database operation. If database operations goes well, then ACK will be sent, otherwise message save in db and then ACK will send.
> 

That sounds fine.

> suddenly I saw in rabbitMQ UI management that my consumer takes 200 message and ACK them one by one!
> Is it seems OK? or one of my setting do this? 
> 

What seems wrong about that to you?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/b28b40be/attachment.htm>

From justinwoolich at gmail.com  Wed May  8 06:33:04 2013
From: justinwoolich at gmail.com (Justin Woolich)
Date: Tue, 7 May 2013 22:33:04 -0700 (PDT)
Subject: [rabbitmq-discuss] using Rabbit MQ to send messages directly from
	Oracle 10g Database
Message-ID: <883d5bd2-00d3-4cd7-bf95-6cc953ef9d3d@googlegroups.com>

I have a requirement to send messages to a rabbit mq queue directly from an 
oracle 10g database. The database uses v1.4 of the Java VM and i am having 
troubles loading the rabbit mq client into the Oracle JVM. I am using v2.2 
for java 1.4 of the Rabbit Client.

The errors i am getting when using the loadjava command in oracle are 
around referenced object could not be resolved

e.g. ORA-29534: referenced object 
SYS.edu/emory/mathcs/backport/java/util/concurrent/helpers/WaitQueue$WaitNode 
could not be resolved

the following is the batch file i am running to load the jar files

C:\oracle\product\BIN\loadjava -f -force -oracleresolver -resolve -verbose 
-oci8 -u sys/local at local 
 "C:\Downloads\rabbitmq-java-client-java1.4bin-2.2.0\junit.jar" 
"C:\\Downloads\rabbitmq-java-client-java1.4bin-2.2.0\commons-cli-1.1.jar" 
"C:\Downloads\rabbitmq-java-client-java1.4bin-2.2.0\commons-io-1.2.jar" 
"C:\Downloads\rabbitmq-java-client-java1.4bin-2.2.0\backport-util-concurrent-3.0.jar" 
"C:\Downloads\rabbitmq-java-client-java1.4bin-2.2.0\retrotranslator-runtime-1.2.1.jar" 
"C:\Downloads\rabbitmq-java-client-java1.4bin-2.2.0\rabbitmq-client.jar" 
"C:\Downloads\rabbitmq-java-client-java1.4bin-2.2.0\rabbitmq-client-tests.jar"

would anyone be able to give me any guidance, i realize this is a bit of an 
obscure requirement but it makes sense in the context of what we are trying 
to do.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130507/c792e2c2/attachment.htm>

From simon at rabbitmq.com  Wed May  8 11:18:59 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 11:18:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 : LDAP Plugin
In-Reply-To: <6a990cb4-62bb-45f0-a80c-08f486618d52@googlegroups.com>
References: <6a990cb4-62bb-45f0-a80c-08f486618d52@googlegroups.com>
Message-ID: <518A2693.3030604@rabbitmq.com>

That looks sensible. You have put that under rabbitmq_auth_backend_ldap 
in your config file? Can you post the complete file?

Cheers, Simon

On 07/05/13 14:08, chads.finishing.strong at gmail.com wrote:
>
> I'm unable to get the ldap plugin to log any debug information.
>
> Current configuration:
>
> <snip>
> {servers, ["ldap.example.com"]},
> {dn_lookup_attribute, "sAMAccountName"},
> {dn_lookup_base, "DC=example,DC=com"},
> {other_bind, {"example\\\ldapadmin", "mypasswd"}},
> {use_ssl, false},
> {port, 389},
> {log, network},
> {tag_queries, [
>     {administrator, {constant, true}},
>     {management,    {constant, true}},
>     {monitoring,    {constant, true}}
> ]}
> <snip>
>
> Thoughts?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed May  8 11:22:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 11:22:05 +0100
Subject: [rabbitmq-discuss] topic for rabbitmq
In-Reply-To: <e41d7f32-0639-4ed4-b966-f0d59ab34a3f@googlegroups.com>
References: <e41d7f32-0639-4ed4-b966-f0d59ab34a3f@googlegroups.com>
Message-ID: <518A274D.8030309@rabbitmq.com>

The RabbitMQ model is that if a consumer wants its own copy of a message 
it should declare its own queues. Queues are fairly lightweight objects.

RabbitMQ will ensure that if there are multiple copies of messages in 
the broker, only one message body will exist in memory or on disc at any 
time.

So when you say "which effects the performance", what performance issue 
do you have?

Cheers, Simon

On 07/05/13 12:39, yaLong Chen wrote:
> Hi,all,
>
>    Background: now client produces many messages of different
> labels.Consumers may subscribe some labels of them(different consumer
> need different labels's msgs).
>    Now method: I used direct exchange in *rabbitmq*, consumer declared
> queue for itself, exchange distribute msgs to these queues.
>    Problem: there exsit many redundant msgs in queues which effects the
> performance.
>
>    A topic type in *activemq* supports user a method to distribute a msg
> to many subscribers, which need not creates large number queues for
> subscribers.
> Does exsit a method in rabbitmq, or some suggestions to solve the problem?
>
>
>
> Thanks,
> Yalong
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From laurent.bernabe at gmail.com  Wed May  8 11:28:19 2013
From: laurent.bernabe at gmail.com (laurent bernabe)
Date: Wed, 8 May 2013 12:28:19 +0200
Subject: [rabbitmq-discuss] Can we launch hello world tutorial from two
 different machines (foreign consumer and producer) ?
Message-ID: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>

Hello everyone,

In the Hello World tutorial, it is said that the producer, the consumer,
and the broker don't have to be on the same machine.

I tried this feature without success, here is how :
1) I slightly modified Receiver and Producer in order to make them as GUI
applications. (Files attached)
2) From Eclipse IDE, I exported the application as a runnable jar file by
choosing the Producer class as main class for this application : Let's call
it RabbitMQProducer
3) I did the same thing for the receiver class : Let's call this
application RabbitMQReceiver
4) I installed the last RabbitMQ server on both machines (which are both
Ubuntu Linux machines, though versions are differents)
5) I started an instance of the Producer on one machine and an instance of
the Receiver on the other machine : but sending a message on the producer
is without any effect on the Receiver.

I've read all tutorials, but I still have not noticed what the main
difference between the RPC tutorial (tutorial 6) and the HelloWorld
tutorial (tutorial 1).

So, how should I modify my codes ?

Regards
 RecvGraphical.java<https://docs.google.com/file/d/0B9y2qdSglhCpblkzam1oakFsZUk/edit?usp=drive_web>

 SendGraphical.java<https://docs.google.com/file/d/0B9y2qdSglhCpLUYwOEw5VGJWTzQ/edit?usp=drive_web>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/9ccff529/attachment.htm>

From simon at rabbitmq.com  Wed May  8 11:32:16 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 11:32:16 +0100
Subject: [rabbitmq-discuss] Queues no longer expire in RabbitMq 3.1.0
In-Reply-To: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>
References: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>
Message-ID: <518A29B0.1040701@rabbitmq.com>

On 07/05/13 12:24, MoonStorm wrote:
> Declaring a queue with "x-expires" set to a valid value has no effect
> after the consumers disconnect. The admin interface reports the queue
> being idle with no consumers present.
>
> They used to expire in earlier versions. Are there additional
> requirements now to achieve the same behavior?

Damn, you're right. They now only expire if there has been no consumer. 
We'll fix this soon.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, Pivotal

From watson.timothy at gmail.com  Wed May  8 11:33:44 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 8 May 2013 11:33:44 +0100
Subject: [rabbitmq-discuss] Can we launch hello world tutorial from two
	different machines (foreign consumer and producer) ?
In-Reply-To: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
References: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
Message-ID: <2C282EF2-8C08-4491-8BBC-B7DCAD92B142@rabbitmq.com>

Hi,

The producer sends messages to a broker and he consumer receives them from the same broker (or a clustered peer). Sounds like you're publishing to a local broker which has nothing to do with the other broker that you're trying to consume from. The broker is an intermediary between the two clients.

Cheers
Tim

On 8 May 2013, at 11:28, laurent bernabe <laurent.bernabe at gmail.com> wrote:

> Hello everyone,
> 
> In the Hello World tutorial, it is said that the producer, the consumer, and the broker don't have to be on the same machine.
> 
> I tried this feature without success, here is how :
> 1) I slightly modified Receiver and Producer in order to make them as GUI applications. (Files attached)
> 2) From Eclipse IDE, I exported the application as a runnable jar file by choosing the Producer class as main class for this application : Let's call it RabbitMQProducer
> 3) I did the same thing for the receiver class : Let's call this application RabbitMQReceiver
> 4) I installed the last RabbitMQ server on both machines (which are both Ubuntu Linux machines, though versions are differents)
> 5) I started an instance of the Producer on one machine and an instance of the Receiver on the other machine : but sending a message on the producer is without any effect on the Receiver.
> 
> I've read all tutorials, but I still have not noticed what the main difference between the RPC tutorial (tutorial 6) and the HelloWorld tutorial (tutorial 1).
> 
> So, how should I modify my codes ?
> 
> Regards
>  RecvGraphical.java
> 
>  SendGraphical.java
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/9582c491/attachment.htm>

From laurent.bernabe at gmail.com  Wed May  8 11:35:28 2013
From: laurent.bernabe at gmail.com (laurent bernabe)
Date: Wed, 8 May 2013 12:35:28 +0200
Subject: [rabbitmq-discuss] Can we launch hello world tutorial from two
 different machines (foreign consumer and producer) ?
In-Reply-To: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
References: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
Message-ID: <CAH8mnd+-efaESX+PAjYHp28DWf6cb388g7x+mAKh12-P5ddLvQ@mail.gmail.com>

Hello again,

I think that my error came from the fact that I did not set the
correlation_id for the queues.
Am i right ?

Regards


2013/5/8 laurent bernabe <laurent.bernabe at gmail.com>

> Hello everyone,
>
> In the Hello World tutorial, it is said that the producer, the consumer,
> and the broker don't have to be on the same machine.
>
> I tried this feature without success, here is how :
> 1) I slightly modified Receiver and Producer in order to make them as GUI
> applications. (Files attached)
> 2) From Eclipse IDE, I exported the application as a runnable jar file by
> choosing the Producer class as main class for this application : Let's call
> it RabbitMQProducer
> 3) I did the same thing for the receiver class : Let's call this
> application RabbitMQReceiver
> 4) I installed the last RabbitMQ server on both machines (which are both
> Ubuntu Linux machines, though versions are differents)
> 5) I started an instance of the Producer on one machine and an instance of
> the Receiver on the other machine : but sending a message on the producer
> is without any effect on the Receiver.
>
> I've read all tutorials, but I still have not noticed what the main
> difference between the RPC tutorial (tutorial 6) and the HelloWorld
> tutorial (tutorial 1).
>
> So, how should I modify my codes ?
>
> Regards
>  RecvGraphical.java<https://docs.google.com/file/d/0B9y2qdSglhCpblkzam1oakFsZUk/edit?usp=drive_web>
>
>  SendGraphical.java<https://docs.google.com/file/d/0B9y2qdSglhCpLUYwOEw5VGJWTzQ/edit?usp=drive_web>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/8ffea4e0/attachment.htm>

From laurent.bernabe at gmail.com  Wed May  8 11:37:31 2013
From: laurent.bernabe at gmail.com (laurent bernabe)
Date: Wed, 8 May 2013 12:37:31 +0200
Subject: [rabbitmq-discuss] Can we launch hello world tutorial from two
 different machines (foreign consumer and producer) ?
In-Reply-To: <2C282EF2-8C08-4491-8BBC-B7DCAD92B142@rabbitmq.com>
References: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
	<2C282EF2-8C08-4491-8BBC-B7DCAD92B142@rabbitmq.com>
Message-ID: <CAH8mnd+K6j8GL8ZgDn_EJMBdXq0a_KfOrT-Aesr0jFUtkUxgbQ@mail.gmail.com>

Hi,

should setting the correlation_id accordingly for both Producer and
Consumer enough ?

Regards

2013/5/8 Tim Watson <watson.timothy at gmail.com>

> Hi,
>
> The producer sends messages to a broker and he consumer receives them from
> the same broker (or a clustered peer). Sounds like you're publishing to a
> local broker which has nothing to do with the other broker that you're
> trying to consume from. The broker is an intermediary between the two
> clients.
>
> Cheers
> Tim
>
> On 8 May 2013, at 11:28, laurent bernabe <laurent.bernabe at gmail.com>
> wrote:
>
> Hello everyone,
>
> In the Hello World tutorial, it is said that the producer, the consumer,
> and the broker don't have to be on the same machine.
>
> I tried this feature without success, here is how :
> 1) I slightly modified Receiver and Producer in order to make them as GUI
> applications. (Files attached)
> 2) From Eclipse IDE, I exported the application as a runnable jar file by
> choosing the Producer class as main class for this application : Let's call
> it RabbitMQProducer
> 3) I did the same thing for the receiver class : Let's call this
> application RabbitMQReceiver
> 4) I installed the last RabbitMQ server on both machines (which are both
> Ubuntu Linux machines, though versions are differents)
> 5) I started an instance of the Producer on one machine and an instance of
> the Receiver on the other machine : but sending a message on the producer
> is without any effect on the Receiver.
>
> I've read all tutorials, but I still have not noticed what the main
> difference between the RPC tutorial (tutorial 6) and the HelloWorld
> tutorial (tutorial 1).
>
> So, how should I modify my codes ?
>
> Regards
>  RecvGraphical.java<https://docs.google.com/file/d/0B9y2qdSglhCpblkzam1oakFsZUk/edit?usp=drive_web>
>
>  SendGraphical.java<https://docs.google.com/file/d/0B9y2qdSglhCpLUYwOEw5VGJWTzQ/edit?usp=drive_web>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/1c81a3b2/attachment.htm>

From simon at rabbitmq.com  Wed May  8 11:41:47 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 11:41:47 +0100
Subject: [rabbitmq-discuss] client cert & user/pass authentication
In-Reply-To: <4B5D885B77E8CC43852B8F0315AD03BA41BE87B7@EXMBX01.austin.utexas.edu>
References: <4B5D885B77E8CC43852B8F0315AD03BA41BE87B7@EXMBX01.austin.utexas.edu>
Message-ID: <518A2BEB.2010204@rabbitmq.com>

I'm afraid that's not possible at the moment. I'm not sure whether the 
Erlang SSL API lets us determine programmatically whether there is a 
client cert and it has been verified. We'll look into this.

Cheers, Simon

On 07/05/13 15:58, Warren Smith wrote:
>
> I'm using the rabbitmq-auth-mechanism-ssl plugin to authenticate
> clients using certificates that the clients present. This is working
> well, but for convenience, I'd also like to allow a few users to
> authenticate using a username/password over an ssl connection.
>
> rabbitmq-auth-mechanism-ssl requires that the ssl_options in the the
> rabbitmq.config include {fail_if_no_peer_cert,true}, so user/pass
> authentication can't be performed. If I try to set it to false, the
> client certificate seems to be ignored.
>
> I have {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']} in the
> rabbitmq.config and users can authenticate over tcp with a user/pass,
> but I'd prefer that they use ssl. Is there a configuration that would
> allow me to support both client certificate and username/password
> authentication over ssl?
>
>
> Thanks,
>
>
> Warren
>
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed May  8 11:43:37 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 11:43:37 +0100
Subject: [rabbitmq-discuss] Internode cluster statistics
In-Reply-To: <CAFDmHdOrtpzLPVp-9SB7uKsdN13cVobowef5V8Z_WDioTqg9Hg@mail.gmail.com>
References: <CAFDmHdOrtpzLPVp-9SB7uKsdN13cVobowef5V8Z_WDioTqg9Hg@mail.gmail.com>
Message-ID: <518A2C59.3010506@rabbitmq.com>

Yes, that might be useful. I don't think it would be too horrific to 
implement. We'll investigate.

Cheers, Simon

On 08/05/13 08:27, Elias Levy wrote:
> We are designing a system using RMQ that we would like to be capable to
> scale to very high message rates.  To do so, we are planning on
> introducing publisher and consumer node affinity to whatever node is
> currently the master node of the HA queues we plan on using.
>
> It would be useful in noticing when this system is not working if RMQ
> exposed statistics on internode message traffic.  In particular, it
> would be nice to have statistics on when a message is received by a
> queue from a publisher in a different node, or when a message is
> consumer from a queue by a consumer in a different node.  Essentially,
> stats for whenever a message has to be forwarded to a different node
> except for messages forwarded to HA queue slaves.
>
> Thoughts?
>
> Elias Levy
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed May  8 11:51:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 11:51:32 +0100
Subject: [rabbitmq-discuss] using Rabbit MQ to send messages directly
 from Oracle 10g Database
In-Reply-To: <883d5bd2-00d3-4cd7-bf95-6cc953ef9d3d@googlegroups.com>
References: <883d5bd2-00d3-4cd7-bf95-6cc953ef9d3d@googlegroups.com>
Message-ID: <518A2E34.2090609@rabbitmq.com>

On 08/05/13 06:33, Justin Woolich wrote:
> e.g. ORA-29534: referenced object
> SYS.edu/emory/mathcs/backport/java/util/concurrent/helpers/WaitQueue$WaitNode
> could not be resolved

Hmm. That class is in backport-util-concurrent-3.0.jar. It looks like 
that's referenced in your loadjava command line, but I really have no 
idea how the Oracle classloader works.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From watson.timothy at gmail.com  Wed May  8 11:54:11 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 8 May 2013 11:54:11 +0100
Subject: [rabbitmq-discuss] Can we launch hello world tutorial from two
	different machines (foreign consumer and producer) ?
In-Reply-To: <CAH8mnd+K6j8GL8ZgDn_EJMBdXq0a_KfOrT-Aesr0jFUtkUxgbQ@mail.gmail.com>
References: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
	<2C282EF2-8C08-4491-8BBC-B7DCAD92B142@rabbitmq.com>
	<CAH8mnd+K6j8GL8ZgDn_EJMBdXq0a_KfOrT-Aesr0jFUtkUxgbQ@mail.gmail.com>
Message-ID: <916A86EC-2615-4FB3-8E41-C00DA69BD8D9@rabbitmq.com>

No, that's not the point I am making. You should have just one broker running and the two client applications need to connect to the same broker.

On 8 May 2013, at 11:37, laurent bernabe <laurent.bernabe at gmail.com> wrote:

> Hi,
> 
> should setting the correlation_id accordingly for both Producer and Consumer enough ?
> 
> Regards
> 
> 2013/5/8 Tim Watson <watson.timothy at gmail.com>
> Hi,
> 
> The producer sends messages to a broker and he consumer receives them from the same broker (or a clustered peer). Sounds like you're publishing to a local broker which has nothing to do with the other broker that you're trying to consume from. The broker is an intermediary between the two clients.
> 
> Cheers
> Tim
> 
> On 8 May 2013, at 11:28, laurent bernabe <laurent.bernabe at gmail.com> wrote:
> 
>> Hello everyone,
>> 
>> In the Hello World tutorial, it is said that the producer, the consumer, and the broker don't have to be on the same machine.
>> 
>> I tried this feature without success, here is how :
>> 1) I slightly modified Receiver and Producer in order to make them as GUI applications. (Files attached)
>> 2) From Eclipse IDE, I exported the application as a runnable jar file by choosing the Producer class as main class for this application : Let's call it RabbitMQProducer
>> 3) I did the same thing for the receiver class : Let's call this application RabbitMQReceiver
>> 4) I installed the last RabbitMQ server on both machines (which are both Ubuntu Linux machines, though versions are differents)
>> 5) I started an instance of the Producer on one machine and an instance of the Receiver on the other machine : but sending a message on the producer is without any effect on the Receiver.
>> 
>> I've read all tutorials, but I still have not noticed what the main difference between the RPC tutorial (tutorial 6) and the HelloWorld tutorial (tutorial 1).
>> 
>> So, how should I modify my codes ?
>> 
>> Regards
>>  RecvGraphical.java
>> 
>>  SendGraphical.java
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/8b54aa82/attachment.htm>

From laurent.bernabe at gmail.com  Wed May  8 12:28:07 2013
From: laurent.bernabe at gmail.com (laurent bernabe)
Date: Wed, 8 May 2013 13:28:07 +0200
Subject: [rabbitmq-discuss] Can we launch hello world tutorial from two
 different machines (foreign consumer and producer) ?
In-Reply-To: <916A86EC-2615-4FB3-8E41-C00DA69BD8D9@rabbitmq.com>
References: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
	<2C282EF2-8C08-4491-8BBC-B7DCAD92B142@rabbitmq.com>
	<CAH8mnd+K6j8GL8ZgDn_EJMBdXq0a_KfOrT-Aesr0jFUtkUxgbQ@mail.gmail.com>
	<916A86EC-2615-4FB3-8E41-C00DA69BD8D9@rabbitmq.com>
Message-ID: <CAH8mnd+4x13PA7kVMgPJbcX4=kTZAK-VXwF1DF31rV=cY9X2og@mail.gmail.com>

Thanks.

Is it possible just by giving an arbitrary name for the host, as I don't
know the other peer IP (and my future use of application won't know it in
advance) ?

I've tried by changing


------------------------------
factory.setHost("localhost");
------------------------------

by

--------------------------------
factory.setHost("myAppName");
--------------------------------

where factory is the ConnectionFactory instance, but I got an exception
(java.net.UnknownHostException).
Or must I make some configuration on the two peers before ?

Regards

2013/5/8 Tim Watson <watson.timothy at gmail.com>

> No, that's not the point I am making. You should have just one broker
> running and the two client applications need to connect to the same broker.
>
> On 8 May 2013, at 11:37, laurent bernabe <laurent.bernabe at gmail.com>
> wrote:
>
> Hi,
>
> should setting the correlation_id accordingly for both Producer and
> Consumer enough ?
>
> Regards
>
> 2013/5/8 Tim Watson <watson.timothy at gmail.com>
>
>> Hi,
>>
>> The producer sends messages to a broker and he consumer receives them
>> from the same broker (or a clustered peer). Sounds like you're publishing
>> to a local broker which has nothing to do with the other broker that you're
>> trying to consume from. The broker is an intermediary between the two
>> clients.
>>
>> Cheers
>> Tim
>>
>> On 8 May 2013, at 11:28, laurent bernabe <laurent.bernabe at gmail.com>
>> wrote:
>>
>> Hello everyone,
>>
>> In the Hello World tutorial, it is said that the producer, the consumer,
>> and the broker don't have to be on the same machine.
>>
>>  I tried this feature without success, here is how :
>> 1) I slightly modified Receiver and Producer in order to make them as GUI
>> applications. (Files attached)
>> 2) From Eclipse IDE, I exported the application as a runnable jar file by
>> choosing the Producer class as main class for this application : Let's call
>> it RabbitMQProducer
>> 3) I did the same thing for the receiver class : Let's call this
>> application RabbitMQReceiver
>> 4) I installed the last RabbitMQ server on both machines (which are both
>> Ubuntu Linux machines, though versions are differents)
>> 5) I started an instance of the Producer on one machine and an instance
>> of the Receiver on the other machine : but sending a message on the
>> producer is without any effect on the Receiver.
>>
>> I've read all tutorials, but I still have not noticed what the main
>> difference between the RPC tutorial (tutorial 6) and the HelloWorld
>> tutorial (tutorial 1).
>>
>> So, how should I modify my codes ?
>>
>> Regards
>>  RecvGraphical.java<https://docs.google.com/file/d/0B9y2qdSglhCpblkzam1oakFsZUk/edit?usp=drive_web>
>>
>>  SendGraphical.java<https://docs.google.com/file/d/0B9y2qdSglhCpLUYwOEw5VGJWTzQ/edit?usp=drive_web>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/7bd7f957/attachment.htm>

From tim at rabbitmq.com  Wed May  8 12:36:26 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 8 May 2013 12:36:26 +0100
Subject: [rabbitmq-discuss] Can we launch hello world tutorial from two
	different machines (foreign consumer and producer) ?
In-Reply-To: <CAH8mnd+4x13PA7kVMgPJbcX4=kTZAK-VXwF1DF31rV=cY9X2og@mail.gmail.com>
References: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
	<2C282EF2-8C08-4491-8BBC-B7DCAD92B142@rabbitmq.com>
	<CAH8mnd+K6j8GL8ZgDn_EJMBdXq0a_KfOrT-Aesr0jFUtkUxgbQ@mail.gmail.com>
	<916A86EC-2615-4FB3-8E41-C00DA69BD8D9@rabbitmq.com>
	<CAH8mnd+4x13PA7kVMgPJbcX4=kTZAK-VXwF1DF31rV=cY9X2og@mail.gmail.com>
Message-ID: <222D44D7-E120-463E-A08A-163E0B31C4C0@rabbitmq.com>

Hi,

On 8 May 2013, at 12:28, laurent bernabe wrote:
> where factory is the ConnectionFactory instance, but I got an exception (java.net.UnknownHostException).
> Or must I make some configuration on the two peers before ?
> 

You might get away with just adding the IP => HOSTNAME mapping to your /etc/hosts file. If not, consult google for *nix administration related stuff until `ping HOSTNAME` works on both machines (and the machine where the broker is running, if that is a third box).

Cheers,
Tim 

From laurent.bernabe at gmail.com  Wed May  8 12:53:16 2013
From: laurent.bernabe at gmail.com (laurent bernabe)
Date: Wed, 8 May 2013 13:53:16 +0200
Subject: [rabbitmq-discuss] Can we launch hello world tutorial from two
 different machines (foreign consumer and producer) ?
In-Reply-To: <222D44D7-E120-463E-A08A-163E0B31C4C0@rabbitmq.com>
References: <CAH8mnd+vahnXHPFtR9GcNkxesBy6nPQNAgpocf64y5xFtgiVDw@mail.gmail.com>
	<2C282EF2-8C08-4491-8BBC-B7DCAD92B142@rabbitmq.com>
	<CAH8mnd+K6j8GL8ZgDn_EJMBdXq0a_KfOrT-Aesr0jFUtkUxgbQ@mail.gmail.com>
	<916A86EC-2615-4FB3-8E41-C00DA69BD8D9@rabbitmq.com>
	<CAH8mnd+4x13PA7kVMgPJbcX4=kTZAK-VXwF1DF31rV=cY9X2og@mail.gmail.com>
	<222D44D7-E120-463E-A08A-163E0B31C4C0@rabbitmq.com>
Message-ID: <CAH8mndJ=Bhv09PyHB8_OET7ZLbePsZU_5tULvhL=bhM7e4dFgA@mail.gmail.com>

Thank you

I'll try to manage the differents /etc/hosts configuration of all posts.

Regards


2013/5/8 Tim Watson <tim at rabbitmq.com>

> Hi,
>
> On 8 May 2013, at 12:28, laurent bernabe wrote:
> > where factory is the ConnectionFactory instance, but I got an exception
> (java.net.UnknownHostException).
> > Or must I make some configuration on the two peers before ?
> >
>
> You might get away with just adding the IP => HOSTNAME mapping to your
> /etc/hosts file. If not, consult google for *nix administration related
> stuff until `ping HOSTNAME` works on both machines (and the machine where
> the broker is running, if that is a third box).
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/f3ea437e/attachment.htm>

From simon at rabbitmq.com  Wed May  8 13:26:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 13:26:36 +0100
Subject: [rabbitmq-discuss] Freely licensed specs
In-Reply-To: <20130425112112.12767.63104@bastian.jones.dk>
References: <20130424151641.12767.33111@bastian.jones.dk>
	<5177FCD8.2010407@rabbitmq.com>
	<20130424172708.12767.82135@bastian.jones.dk>
	<5178FDC5.7020802@rabbitmq.com>
	<20130425112112.12767.63104@bastian.jones.dk>
Message-ID: <518A447C.7030003@rabbitmq.com>

On 25/04/13 12:21, Jonas Smedegaard wrote:
> NB! I'll unsubscribe from this list now - would be great if you cc me on
> further progress on this.

We now have a BSD-licensed version of the extended XML up (and are 
mirroring the other stripped specs).

http://www.rabbitmq.com/protocol.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From elad at centunosolutions.com  Wed May  8 14:17:45 2013
From: elad at centunosolutions.com (elad)
Date: Wed, 8 May 2013 06:17:45 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
	upgrade to 3.1
In-Reply-To: <1367873173429-26461.post@n5.nabble.com>
References: <1367873173429-26461.post@n5.nabble.com>
Message-ID: <1368019065431-26525.post@n5.nabble.com>

ok, thank you.

Is there a place I should submit this bug so its fixed for next version ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/PHP-amqp-0-9-1-breaks-after-rabbitmq-server-upgrade-to-3-1-tp26461p26525.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed May  8 14:28:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 14:28:42 +0100
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
 upgrade to 3.1
In-Reply-To: <1368019065431-26525.post@n5.nabble.com>
References: <1367873173429-26461.post@n5.nabble.com>
	<1368019065431-26525.post@n5.nabble.com>
Message-ID: <518A530A.3060602@rabbitmq.com>

On 08/05/13 14:17, elad wrote:
> Is there a place I should submit this bug so its fixed for next version ?

No need, we're already working on it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From chads.finishing.strong at gmail.com  Wed May  8 14:50:38 2013
From: chads.finishing.strong at gmail.com (chads.finishing.strong at gmail.com)
Date: Wed, 8 May 2013 06:50:38 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 LDAP plugin help
Message-ID: <d5a5cbb8-5835-4c82-91bb-1074fac64995@googlegroups.com>

I'm trying to get the LDAP plugin to work.  At this point, it does not log 
when "log" is set to "true" or "network", so I've been using tcpdump.       
    
                                                                            
    
Anyways, I'm trying to take what I use in PHP/Zend 
(Zend_Auth_Adapter_Ldap):    
                                                                            
    
ldap.primary.host = 'ldap.example.com'                                     
     
ldap.primary.baseDn = 'dc=example,dc=com'                                   
    
ldap.primary.accountDomainName = 'example.com'                             
     
ldap.primary.accountDomainNameShort = 'example'                             
    
ldap.primary.username = 'example\ldapadmin'                                 
    
ldap.primary.password = 'mypasswd'                                         
     
ldap.primary.accountFilterFormat = 
'(&(objectClass=user)(sAMAccountName=%s))'   
                                                                            
    
and use that data to configure the rabbitmq ldap plugin:                   
     
                                                                            
    
<snip>                                                                     
     
{servers, ["ldap.example.com"]},                                           
     
{dn_lookup_attribute, "sAMAccountName"},                                   
     
{dn_lookup_base, "DC=example,DC=com"},                                     
     
{user_dn_pattern, "(sAMAccountName=${username}),DC=example,DC=com"}         
    
{other_bind, {"example\\\ldapadmin", "mypasswd"}},                         
     
{use_ssl, false},                                                           
    
{port, 389},                                                               
     
{log, network},                                                             
    
{vhost_access_query,{constant, true}},                                     
     
{resource_access_query, {constant, true}},                                 
     
{tag_queries, [                                                             
    
   {administrator, {constant, true}},                                       
    
   {management,    {constant, true}},                                       
    
   {monitoring,    {constant, true}}                                       
     
]}                                                                         
     
<snip>                                                                     
     
                                                                            
    
LDAP Entry snippet:                                                         
    
                                                                            
    
dn: CN=Blart\, Paul,OU=MallCops,DC=example,DC=com                           
    
cn: Blart, Paul                                                             
    
sAMAccountName: pblart                                                     
     
userPrincipalName: pblart at example.com                                       
    
                                                                            
    
At this point I've been unsuccessful.  It looks like my problem may be due 
to the "dn_lookup_*" and "user_dn_pattern" values?  Any help would be 
greatly appreciated.
                                                                            
    
Thanks                                                                     
     
C 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/71410b87/attachment.htm>

From simon at rabbitmq.com  Wed May  8 15:27:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 15:27:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 LDAP plugin help
In-Reply-To: <d5a5cbb8-5835-4c82-91bb-1074fac64995@googlegroups.com>
References: <d5a5cbb8-5835-4c82-91bb-1074fac64995@googlegroups.com>
Message-ID: <518A60C1.2000809@rabbitmq.com>

Hi. Did you see my response to your other mail here: 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-May/026993.html?

You also say "I've been unsuccessful". What is the actual problem?

Cheers, Simon

On 08/05/13 14:50, chads.finishing.strong at gmail.com wrote:
> I'm trying to get the LDAP plugin to work.  At this point, it does not
> log when "log" is set to "true" or "network", so I've been using tcpdump.
> Anyways, I'm trying to take what I use in PHP/Zend
> (Zend_Auth_Adapter_Ldap):
> ldap.primary.host = 'ldap.example.com'
> ldap.primary.baseDn = 'dc=example,dc=com'
> ldap.primary.accountDomainName = 'example.com'
> ldap.primary.accountDomainNameShort = 'example'
> ldap.primary.username = 'example\ldapadmin'
> ldap.primary.password = 'mypasswd'
> ldap.primary.accountFilterFormat =
> '(&(objectClass=user)(sAMAccountName=%s))'
> and use that data to configure the rabbitmq ldap plugin:
> <snip>
> {servers, ["ldap.example.com"]},
> {dn_lookup_attribute, "sAMAccountName"},
> {dn_lookup_base, "DC=example,DC=com"},
> {user_dn_pattern, "(sAMAccountName=${username}),DC=example,DC=com"}
> {other_bind, {"example\\\ldapadmin", "mypasswd"}},
> {use_ssl, false},
> {port, 389},
> {log, network},
> {vhost_access_query,{constant, true}},
> {resource_access_query, {constant, true}},
> {tag_queries, [
>     {administrator, {constant, true}},
>     {management,    {constant, true}},
>     {monitoring,    {constant, true}}
> ]}
> <snip>
> LDAP Entry snippet:
> dn: CN=Blart\, Paul,OU=MallCops,DC=example,DC=com
> cn: Blart, Paul
> sAMAccountName: pblart
> userPrincipalName: pblart at example.com
> At this point I've been unsuccessful.  It looks like my problem may be
> due to the "dn_lookup_*" and "user_dn_pattern" values?  Any help would
> be greatly appreciated.
> Thanks
> C
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From reddylast at gmail.com  Wed May  8 15:28:09 2013
From: reddylast at gmail.com (reddylast)
Date: Wed, 8 May 2013 07:28:09 -0700 (PDT)
Subject: [rabbitmq-discuss] RMQ Priority QUEUES
Message-ID: <1368023289784-26528.post@n5.nabble.com>

Hi,

I'm using rabbitmq in one of my project and according to the requirements
there can be messages with different priorities (regular, high and urgent).
I know with rabbitmq we can't assign priority at message level, so I started
to create different queues for different priority messages. I've multiple
consumers which consume those messages from the queues and before consuming
a message each consumer checks if there is/are message(s) in higher priority
queue ? then it stops current queue and start to consume messages from
higher priority queue. Till here everything works fine ..but, one thing
which is killing my system is the slow performance by the consumer. I'm also
aware that, this is because my consumer is checking higher priority queues
before consuming every message.

Just wanted to know has anyone ever came across same problem ? if yes then
what would be the possible solution.

Moreover, I'm using basic.get method which also slowing consumer
performance. I wanted to switch to basic.consume method but with that I can
never get to know if the queue is empty or not. Is there any way to know if
queue is empty or not (in basic.consume). ?


Thanks 
Reddy




 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RMQ-Priority-QUEUES-tp26528.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bsvancara at gmail.com  Wed May  8 16:50:52 2013
From: bsvancara at gmail.com (Bohuslav Svancara)
Date: Wed, 8 May 2013 17:50:52 +0200
Subject: [rabbitmq-discuss] RMQ Priority QUEUES
In-Reply-To: <1368023289784-26528.post@n5.nabble.com>
References: <1368023289784-26528.post@n5.nabble.com>
Message-ID: <CANJKu1AXsHayWycEGwJBYGVbKKOkHdHndii1gpB7Squ6wWe7kA@mail.gmail.com>

https://github.com/okeuday/pqueue


2013/5/8 reddylast <reddylast at gmail.com>

> Hi,
>
> I'm using rabbitmq in one of my project and according to the requirements
> there can be messages with different priorities (regular, high and urgent).
> I know with rabbitmq we can't assign priority at message level, so I
> started
> to create different queues for different priority messages. I've multiple
> consumers which consume those messages from the queues and before consuming
> a message each consumer checks if there is/are message(s) in higher
> priority
> queue ? then it stops current queue and start to consume messages from
> higher priority queue. Till here everything works fine ..but, one thing
> which is killing my system is the slow performance by the consumer. I'm
> also
> aware that, this is because my consumer is checking higher priority queues
> before consuming every message.
>
> Just wanted to know has anyone ever came across same problem ? if yes then
> what would be the possible solution.
>
> Moreover, I'm using basic.get method which also slowing consumer
> performance. I wanted to switch to basic.consume method but with that I can
> never get to know if the queue is empty or not. Is there any way to know if
> queue is empty or not (in basic.consume). ?
>
>
> Thanks
> Reddy
>
>
>
>
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/RMQ-Priority-QUEUES-tp26528.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/5a70e4fe/attachment.htm>

From chads.finishing.strong at gmail.com  Wed May  8 17:40:14 2013
From: chads.finishing.strong at gmail.com (chads.finishing.strong)
Date: Wed, 8 May 2013 11:40:14 -0500
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 LDAP plugin help
In-Reply-To: <518A60C1.2000809@rabbitmq.com>
References: <d5a5cbb8-5835-4c82-91bb-1074fac64995@googlegroups.com>
	<518A60C1.2000809@rabbitmq.com>
Message-ID: <CAOoq_UyXKgbccy5PmdjVr-RA5HuA9g+6EkE_ZveykBWFxBpbvA@mail.gmail.com>

Simon, I did get your response; thanks. The rabbitmq.config portion I
listed, is under
rabbitmq_auth_backend_ldap. The ldap plugin is enabled and loaded. A
tcpdump shows that
it is indeed communicating with the ldap server.

The issues are

(1) the plugin is not logging debug info; neither {log, true} or {log,
network} work
(2) I'm unable to authenticate via ldap



On Wed, May 8, 2013 at 9:27 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. Did you see my response to your other mail here:
> http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
> 2013-May/026993.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-May/026993.html>
> ?
>
> You also say "I've been unsuccessful". What is the actual problem?
>
> Cheers, Simon
>
> On 08/05/13 14:50, chads.finishing.strong at gmail.**com<chads.finishing.strong at gmail.com>wrote:
>
>> I'm trying to get the LDAP plugin to work.  At this point, it does not
>> log when "log" is set to "true" or "network", so I've been using tcpdump.
>> Anyways, I'm trying to take what I use in PHP/Zend
>> (Zend_Auth_Adapter_Ldap):
>> ldap.primary.host = 'ldap.example.com'
>> ldap.primary.baseDn = 'dc=example,dc=com'
>> ldap.primary.accountDomainName = 'example.com'
>> ldap.primary.**accountDomainNameShort = 'example'
>> ldap.primary.username = 'example\ldapadmin'
>> ldap.primary.password = 'mypasswd'
>> ldap.primary.**accountFilterFormat =
>> '(&(objectClass=user)(**sAMAccountName=%s))'
>> and use that data to configure the rabbitmq ldap plugin:
>> <snip>
>> {servers, ["ldap.example.com"]},
>> {dn_lookup_attribute, "sAMAccountName"},
>> {dn_lookup_base, "DC=example,DC=com"},
>> {user_dn_pattern, "(sAMAccountName=${username}),**DC=example,DC=com"}
>> {other_bind, {"example\\\ldapadmin", "mypasswd"}},
>> {use_ssl, false},
>> {port, 389},
>> {log, network},
>> {vhost_access_query,{constant, true}},
>> {resource_access_query, {constant, true}},
>> {tag_queries, [
>>     {administrator, {constant, true}},
>>     {management,    {constant, true}},
>>     {monitoring,    {constant, true}}
>> ]}
>> <snip>
>> LDAP Entry snippet:
>> dn: CN=Blart\, Paul,OU=MallCops,DC=example,**DC=com
>> cn: Blart, Paul
>> sAMAccountName: pblart
>> userPrincipalName: pblart at example.com
>> At this point I've been unsuccessful.  It looks like my problem may be
>> due to the "dn_lookup_*" and "user_dn_pattern" values?  Any help would
>> be greatly appreciated.
>> Thanks
>> C
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/408176f0/attachment.htm>

From dbuchko at gopivotal.com  Wed May  8 17:48:04 2013
From: dbuchko at gopivotal.com (Daniel Buchko)
Date: Wed, 8 May 2013 12:48:04 -0400
Subject: [rabbitmq-discuss] Fwd: Cluster upgrade failed
In-Reply-To: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>
References: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>
Message-ID: <CA+F3nVwr99CjX_PsY-i+5+Mj8UgyRu7dDqqK5H0Bu+-99MiG0w@mail.gmail.com>

Forwarding on behalf of Tracy....


---------- Forwarded message ----------
From: Tracy Dalzell <tracy at guisolutions.com>
Date: Wed, May 8, 2013 at 11:59 AM
Subject: Cluster upgrade failed
To: rabbitmq-discuss at lists.rabbitmq.com


Hello,****

I just upgraded a four node cluster from 3.0.4 -> 3.1.  I took them down
(stopped the rabbit server) in order 1,2,3,4.  Upgraded and restarted in
reverse order 4,3,2,1.  When everything came back up I could only login as
guest.  All users and vhosts are gone.  When I refresh the management UI I
see only nodes 2 and 3, then only 1, then only 4, etc?****

** **

TIA,****

Tracy****
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/31fce108/attachment.htm>

From tracy at guisolutions.com  Wed May  8 16:59:45 2013
From: tracy at guisolutions.com (Tracy Dalzell)
Date: Wed, 8 May 2013 11:59:45 -0400
Subject: [rabbitmq-discuss] Cluster upgrade failed
Message-ID: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>

Hello,

I just upgraded a four node cluster from 3.0.4 -> 3.1.  I took them down
(stopped the rabbit server) in order 1,2,3,4.  Upgraded and restarted in
reverse order 4,3,2,1.  When everything came back up I could only login
as guest.  All users and vhosts are gone.  When I refresh the management
UI I see only nodes 2 and 3, then only 1, then only 4, etc...

 

TIA,

Tracy

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/6569c133/attachment.htm>

From ehberg at gmail.com  Wed May  8 18:22:12 2013
From: ehberg at gmail.com (Eric Berg)
Date: Wed, 8 May 2013 13:22:12 -0400
Subject: [rabbitmq-discuss] Someone else with a nodedown error
Message-ID: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>

I have ready through many of these nodedown error emails and of course none
of them seem to be exactly what I am experiencing.

I have a 4 node cluster, and one of the nodes went offline according to the
cluster. This box has the following in the sasl log:

=SUPERVISOR REPORT==== 7-May-2013::14:37:22 ===
     Supervisor: {<0.11197.1096>,
                                           rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     noproc
     Offender:   [{pid,<0.11199.1096>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]

*Yet in the regular rabbit log i can see that it was still accepting
connections up until 2:22AM the next day:*

(last log entry)
=INFO REPORT==== 8-May-2013::02:22:26 ===
closing AMQP connection <0.18267.1145> (IPADDRESS:PORT -> IPADDRESS:PORT)

*Running rabbitmqctl status returns:*

[root at rabbit-box rabbitmq]# rabbitmqctl status
Status of node 'rabbit at rabbit-box' ...
Error: unable to connect to node 'rabbit at rabbit-box': nodedown

DIAGNOSTICS
===========

nodes in question: ['rabbit at rabbit-box']

hosts, their running nodes and ports:
- rabbit-box: [{rabbit,13957},{rabbitmqctl2301,16508}]

current node details:
- node name: 'rabbitmqctl2301 at rabbit-box'
- home dir: /var/lib/rabbitmq
- cookie hash: qQwyFW90ZNbbrFvX1AtrxQ==


A couple of notes:
- Looking for a process run by rabbit show that it appears to still be
running
- Erlang cookie is the same on all nodes of the cluster, the cookie hash is
the same as well
- A traffic spike occurred right around the time of the last entry in the
rabbit log
- I can find no other errors in any logs that relate to rabbit or erlang
- Up until this point the cluster has been running fine for over 40 days.
- telnet IP_ADDRESS 5672 times out
- I have not restarted the box, erlang node, or entire rabbitmq-server

Is there anywhere else I can go looking for errors? I am about to start
killing processs, but Im not sure that will solve anything.

Thanks!

Eric Berg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/4e72aa13/attachment.htm>

From gmr at meetme.com  Wed May  8 19:20:44 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 8 May 2013 14:20:44 -0400
Subject: [rabbitmq-discuss] Bug in message_stats from /api/queues?
Message-ID: <CAKwdTWcd-e7NtKd7JYvg8P9EBqccBQPTNoV0caat7BaTdx-d-w@mail.gmail.com>

I'm seeing what I think is a counter bug in the message_stats data
structure for queues in 3.1.0, going back as far as I've tested (2.8.5).

I am assuming this is a counter of deliveries via Basic.Get. Am I correct
in this assumption?

If so, It seems that the deliver_get counter is incremented for every
delivery of any type. As a generalization, I we do not use Basic.Get so we
were confused when we saw this # bubble up.

Notice the values directly mirror the deliver #'s for each example:

"message_stats": {
    "ack": 18,
    "ack_details": {
        "rate": 0.0
    },
    "deliver": 18,
    "deliver_details": {
        "rate": 0.0
    },
    "deliver_get": 18,
    "deliver_get_details": {
        "rate": 0.0
    },
    "publish": 18,
    "publish_details": {
        "rate": 0.0
    }
}

"message_stats": {
    "deliver_get": 1487430,
    "deliver_get_details": {
        "interval": 21632564,
        "last_event": 1368035461427,
        "rate": 0.6419989978358597
    },
    "deliver_no_ack": 1487430,
    "deliver_no_ack_details": {
        "interval": 21632564,
        "last_event": 1368035461427,
        "rate": 0.6419989978358597
    }
}

"message_stats": {
    "ack": 2412673,
    "ack_details": {
        "interval": 22354531,
        "last_event": 1368035461744,
        "rate": 0.3999437877321085
    },
    "deliver": 2412673,
    "deliver_details": {
        "interval": 22354531,
        "last_event": 1368035461744,
        "rate": 0.3999437877321085
    },
    "deliver_get": 2412673,
    "deliver_get_details": {
        "interval": 22354531,
        "last_event": 1368035461744,
        "rate": 0.3999437877321085
    },
    "publish": 480894,
    "publish_details": {
        "interval": 10504228,
        "last_event": 1368035452340,
        "rate": 0.47599880733738836
    }
}

Is this a bug that should be representing Basic.Get counts or a stat we can
discard?

Regards,

Gavin
-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/118d6d9a/attachment.htm>

From simon at rabbitmq.com  Wed May  8 20:53:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 May 2013 20:53:45 +0100
Subject: [rabbitmq-discuss] Bug in message_stats from /api/queues?
In-Reply-To: <CAKwdTWcd-e7NtKd7JYvg8P9EBqccBQPTNoV0caat7BaTdx-d-w@mail.gmail.com>
References: <CAKwdTWcd-e7NtKd7JYvg8P9EBqccBQPTNoV0caat7BaTdx-d-w@mail.gmail.com>
Message-ID: <518AAD49.3060307@rabbitmq.com>

On 08/05/2013 7:20PM, Gavin M. Roy wrote:
> I'm seeing what I think is a counter bug in the message_stats data
> structure for queues in 3.1.0, going back as far as I've tested (2.8.5).
>
> I am assuming this is a counter of deliveries via Basic.Get. Am I
> correct in this assumption?

No. It's the sum of all deliveries of any type (i.e. deliver + 
deliver_no_ack + get + get_no_ack).

So I don't think you're seeing a bug.

Cheers, Simon

> If so, It seems that the deliver_get counter is incremented for every
> delivery of any type. As a generalization, I we do not use Basic.Get so
> we were confused when we saw this # bubble up.
>
> Notice the values directly mirror the deliver #'s for each example:
>
> "message_stats": {
>      "ack": 18,
>      "ack_details": {
>          "rate": 0.0
>      },
>      "deliver": 18,
>      "deliver_details": {
>          "rate": 0.0
>      },
>      "deliver_get": 18,
>      "deliver_get_details": {
>          "rate": 0.0
>      },
>      "publish": 18,
>      "publish_details": {
>          "rate": 0.0
>      }
> }
>
> "message_stats": {
>      "deliver_get": 1487430,
>      "deliver_get_details": {
>          "interval": 21632564,
>          "last_event": 1368035461427,
>          "rate": 0.6419989978358597
>      },
>      "deliver_no_ack": 1487430,
>      "deliver_no_ack_details": {
>          "interval": 21632564,
>          "last_event": 1368035461427,
>          "rate": 0.6419989978358597
>      }
> }
>
> "message_stats": {
>      "ack": 2412673,
>      "ack_details": {
>          "interval": 22354531,
>          "last_event": 1368035461744,
>          "rate": 0.3999437877321085
>      },
>      "deliver": 2412673,
>      "deliver_details": {
>          "interval": 22354531,
>          "last_event": 1368035461744,
>          "rate": 0.3999437877321085
>      },
>      "deliver_get": 2412673,
>      "deliver_get_details": {
>          "interval": 22354531,
>          "last_event": 1368035461744,
>          "rate": 0.3999437877321085
>      },
>      "publish": 480894,
>      "publish_details": {
>          "interval": 10504228,
>          "last_event": 1368035452340,
>          "rate": 0.47599880733738836
>      }
> }
>
> Is this a bug that should be representing Basic.Get counts or a stat we
> can discard?
>
> Regards,
>
> Gavin
> --
>
> Gavin M. Roy
> Chief Technology Officer
>
> <http://www.meetme.com/>
> 100 Union Square Drive
> New Hope, PA 18938
> p. +1.215.862.1162 x263
> f. +1.215.862.0465
>
> <https://www.facebook.com/pages/MeetMe/21931227129><https://twitter.com/meetme><http://www.youtube.com/user/MeetMeVideos>
>
> The public market leader in social discovery. (NYSE MKT: MEET)
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From gmr at meetme.com  Wed May  8 21:32:35 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 8 May 2013 16:32:35 -0400
Subject: [rabbitmq-discuss] Bug in message_stats from /api/queues?
In-Reply-To: <518AAD49.3060307@rabbitmq.com>
References: <CAKwdTWcd-e7NtKd7JYvg8P9EBqccBQPTNoV0caat7BaTdx-d-w@mail.gmail.com>
	<518AAD49.3060307@rabbitmq.com>
Message-ID: <CAKwdTWfQkJWsOkWtTwyb386PRxCrbwe+rct4GBPePGUNvkNyPw@mail.gmail.com>

Thanks for clearing it up. I do see get/get_no_ack values, just was
confused on the nomenclature.

Is the value of deliver_get to reduce computation on the management UI?

On Wed, May 8, 2013 at 3:53 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 08/05/2013 7:20PM, Gavin M. Roy wrote:
>
>> I'm seeing what I think is a counter bug in the message_stats data
>> structure for queues in 3.1.0, going back as far as I've tested (2.8.5).
>>
>> I am assuming this is a counter of deliveries via Basic.Get. Am I
>> correct in this assumption?
>>
>
> No. It's the sum of all deliveries of any type (i.e. deliver +
> deliver_no_ack + get + get_no_ack).
>
> So I don't think you're seeing a bug.
>
> Cheers, Simon
>
>  If so, It seems that the deliver_get counter is incremented for every
>> delivery of any type. As a generalization, I we do not use Basic.Get so
>> we were confused when we saw this # bubble up.
>>
>> Notice the values directly mirror the deliver #'s for each example:
>>
>> "message_stats": {
>>      "ack": 18,
>>      "ack_details": {
>>          "rate": 0.0
>>      },
>>      "deliver": 18,
>>      "deliver_details": {
>>          "rate": 0.0
>>      },
>>      "deliver_get": 18,
>>      "deliver_get_details": {
>>          "rate": 0.0
>>      },
>>      "publish": 18,
>>      "publish_details": {
>>          "rate": 0.0
>>      }
>> }
>>
>> "message_stats": {
>>      "deliver_get": 1487430,
>>      "deliver_get_details": {
>>          "interval": 21632564,
>>          "last_event": 1368035461427,
>>          "rate": 0.6419989978358597
>>      },
>>      "deliver_no_ack": 1487430,
>>      "deliver_no_ack_details": {
>>          "interval": 21632564,
>>          "last_event": 1368035461427,
>>          "rate": 0.6419989978358597
>>      }
>> }
>>
>> "message_stats": {
>>      "ack": 2412673,
>>      "ack_details": {
>>          "interval": 22354531,
>>          "last_event": 1368035461744,
>>          "rate": 0.3999437877321085
>>      },
>>      "deliver": 2412673,
>>      "deliver_details": {
>>          "interval": 22354531,
>>          "last_event": 1368035461744,
>>          "rate": 0.3999437877321085
>>      },
>>      "deliver_get": 2412673,
>>      "deliver_get_details": {
>>          "interval": 22354531,
>>          "last_event": 1368035461744,
>>          "rate": 0.3999437877321085
>>      },
>>      "publish": 480894,
>>      "publish_details": {
>>          "interval": 10504228,
>>          "last_event": 1368035452340,
>>          "rate": 0.47599880733738836
>>      }
>> }
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/e07646ca/attachment.htm>

From tracy at guisolutions.com  Wed May  8 18:13:15 2013
From: tracy at guisolutions.com (Tracy Dalzell)
Date: Wed, 8 May 2013 13:13:15 -0400
Subject: [rabbitmq-discuss] Cluster upgrade failed
In-Reply-To: <CA+F3nVwr99CjX_PsY-i+5+Mj8UgyRu7dDqqK5H0Bu+-99MiG0w@mail.gmail.com>
References: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>
	<CA+F3nVwr99CjX_PsY-i+5+Mj8UgyRu7dDqqK5H0Bu+-99MiG0w@mail.gmail.com>
Message-ID: <42A58CC11C25A241AE9FC4C208C742C3521A5D@emsbs1.esteeinc.local>

Status reports attached

 

From: Daniel Buchko [mailto:dbuchko at gopivotal.com] 
Sent: Wednesday, May 08, 2013 12:48 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: Tracy Dalzell
Subject: Fwd: Cluster upgrade failed

 

Forwarding on behalf of Tracy....

 

---------- Forwarded message ----------
From: Tracy Dalzell <tracy at guisolutions.com>
Date: Wed, May 8, 2013 at 11:59 AM
Subject: Cluster upgrade failed
To: rabbitmq-discuss at lists.rabbitmq.com



Hello,

I just upgraded a four node cluster from 3.0.4 -> 3.1.  I took them down
(stopped the rabbit server) in order 1,2,3,4.  Upgraded and restarted in
reverse order 4,3,2,1.  When everything came back up I could only login
as guest.  All users and vhosts are gone.  When I refresh the management
UI I see only nodes 2 and 3, then only 1, then only 4, etc...

 

TIA,

Tracy

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/caca6d5a/attachment.htm>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: server_report-rabbit01.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/caca6d5a/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: server_report-rabbit02.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/caca6d5a/attachment-0001.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: server_report-rabbit03.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/caca6d5a/attachment-0002.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: server_report-rabbit04.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/caca6d5a/attachment-0003.txt>

From vralshah at gmail.com  Wed May  8 20:05:34 2013
From: vralshah at gmail.com (Viral Shah)
Date: Wed, 8 May 2013 12:05:34 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Flow Control Behavior Questions
Message-ID: <2c4a6d0e-8a64-46ce-841f-1df762d48884@googlegroups.com>

Hi,
 
     I am using  3.0.4 Java client library/RabbitMQ server and have some 
questions about RabbitMQ flow control behavior.

1. What is the recommended way of handling/detecting flow control 
invocations on the client side? Is it possible to detect that flow control 
has been invoked on the RabbitMQ server by adding FlowListener or any other 
method? Is it possible to detect that the connection is blocked on the 
client side thru the Java client library or by using some workaround so 
that we can stop sending messages and not get the threads stuck in some 
RabbitMQ method call until the server comes out of flow control (which may 
take longer in some cases).

2. Channel.close() method does not take a timeout value and the thread 
remains blocked in case the server is under flow control. Is there a reason 
for not having a timeout in the channel close method? If I use 
Connection.close() then it does take a timeout value. Is there a list of 
methods that get blocked during flow control and which ones are not 
affected.

Thanks,
Viral
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130508/a647b9c3/attachment.htm>

From justinwoolich at gmail.com  Wed May  8 23:42:37 2013
From: justinwoolich at gmail.com (-Justin Woolich.)
Date: Thu, 9 May 2013 08:42:37 +1000
Subject: [rabbitmq-discuss] using Rabbit MQ to send messages directly
 from Oracle 10g Database
In-Reply-To: <518A2E34.2090609@rabbitmq.com>
References: <883d5bd2-00d3-4cd7-bf95-6cc953ef9d3d@googlegroups.com>
	<518A2E34.2090609@rabbitmq.com>
Message-ID: <CAKg3knpGJ=SN671CovASMHmd7WwpJMFFmUAeb+WTY20zRDizgQ@mail.gmail.com>

Hi Simon

Thanks for responding, I have tried various options including remove thing
-resolve parameter which allowed the jar files to be loaded, but they were
still not in a valid state even when loaded into oracle. There are various
other errors that were displayed when attempting to use the loadjava
command but they are all similar could not be resolved type isses..


On Wed, May 8, 2013 at 8:51 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 08/05/13 06:33, Justin Woolich wrote:
>
>> e.g. ORA-29534: referenced object
>> SYS.edu/emory/mathcs/backport/**java/util/concurrent/helpers/**
>> WaitQueue$WaitNode
>> could not be resolved
>>
>
> Hmm. That class is in backport-util-concurrent-3.0.**jar. It looks like
> that's referenced in your loadjava command line, but I really have no idea
> how the Oracle classloader works.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/acf6075f/attachment.htm>

From simon at rabbitmq.com  Thu May  9 10:48:50 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 May 2013 10:48:50 +0100
Subject: [rabbitmq-discuss] Bug in message_stats from /api/queues?
In-Reply-To: <CAKwdTWfQkJWsOkWtTwyb386PRxCrbwe+rct4GBPePGUNvkNyPw@mail.gmail.com>
References: <CAKwdTWcd-e7NtKd7JYvg8P9EBqccBQPTNoV0caat7BaTdx-d-w@mail.gmail.com>
	<518AAD49.3060307@rabbitmq.com>
	<CAKwdTWfQkJWsOkWtTwyb386PRxCrbwe+rct4GBPePGUNvkNyPw@mail.gmail.com>
Message-ID: <518B7102.3000701@rabbitmq.com>

On 08/05/13 21:32, Gavin M. Roy wrote:
> Thanks for clearing it up. I do see get/get_no_ack values, just was
> confused on the nomenclature.
>
> Is the value of deliver_get to reduce computation on the management UI?

Yes. And make it easier for people who are writing scripts who just want 
to know the overall delivery rate.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  9 10:58:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 May 2013 10:58:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 LDAP plugin help
In-Reply-To: <CAOoq_UyXKgbccy5PmdjVr-RA5HuA9g+6EkE_ZveykBWFxBpbvA@mail.gmail.com>
References: <d5a5cbb8-5835-4c82-91bb-1074fac64995@googlegroups.com>
	<518A60C1.2000809@rabbitmq.com>
	<CAOoq_UyXKgbccy5PmdjVr-RA5HuA9g+6EkE_ZveykBWFxBpbvA@mail.gmail.com>
Message-ID: <518B733F.5020001@rabbitmq.com>

On 08/05/13 17:40, chads.finishing.strong wrote:
> Simon, I did get your response; thanks. The rabbitmq.config portion I
> listed, is under
> rabbitmq_auth_backend_ldap. The ldap plugin is enabled and loaded. A
> tcpdump shows that
> it is indeed communicating with the ldap server.
>
> The issues are
>
> (1) the plugin is not logging debug info; neither {log, true} or {log,
> network} work
> (2) I'm unable to authenticate via ldap

Hmm.

The log config item definitely works. What does "rabbitmqctl 
environment" say?

When you say "I'm unable to authenticate via ldap", what *does* show up 
in then logs?

Can you post your complete config?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From moonstorm at gmail.com  Thu May  9 10:46:07 2013
From: moonstorm at gmail.com (MoonStorm)
Date: Thu, 9 May 2013 02:46:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Queues no longer expire in RabbitMq 3.1.0
In-Reply-To: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>
References: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>
Message-ID: <3976cf10-7c02-48bf-8f8a-c24add00d924@googlegroups.com>


Here is a bit more info on the subject. Ran some tests and apparently the 
queues seem to expire if they've been declared as durable after all the 
consumers dropped. Apart from my initial report, the setting is also 
ignored if they've been declared as auto-delete, which sort of makes sense 
(in this case they get deleted immediately). 

Either way, the admin interface reports the setting as active, and this is 
a bug when the setting is actually being ignored. Besides, could we have a 
bit of validation for the settings please? Ignoring them when used in an 
unsupported context is simply wrong.

On Tuesday, May 7, 2013 12:24:08 PM UTC+1, MoonStorm wrote:
>
> Declaring a queue with "x-expires" set to a valid value has no effect 
> after the consumers disconnect. The admin interface reports the queue being 
> idle with no consumers present.
>
> They used to expire in earlier versions. Are there additional requirements 
> now to achieve the same behavior?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/c4886e8e/attachment.htm>

From tim at rabbitmq.com  Thu May  9 12:42:42 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 9 May 2013 12:42:42 +0100
Subject: [rabbitmq-discuss] MySQL UDF or Storage Engine for RabbitMQ
In-Reply-To: <f56bf873-dc3f-4532-90eb-ac1a6607752c@googlegroups.com>
References: <f56bf873-dc3f-4532-90eb-ac1a6607752c@googlegroups.com>
Message-ID: <CF0A0FF4-0EF7-4776-95F5-8AF65DDD43EC@rabbitmq.com>

Hi,

On 2 May 2013, at 16:44, Nikola wrote:
> Does anyone know if there is some work being done on MySQL User Defined Function (UDF) or AMQP/RabbitMQ specific Storage Engine for MySQL, which would enable direct integration between MySQL and RabbitMQ.
> 

I'm not aware of any active work on a UDF for sending AMQP messages from within MySQL. Some early work was done on using MySQL as a message store, but it was never brought to completion.

> I assume that simplest way to do that would be to have UDF. Better way might be to have specific MySQL Storage Engine, like Sphinx has. Gearman has UDF available.

I'm afraid I know very little about MySQL user defined functions, but I suspect that this would be possible using a mechanism similar to the one applied for integrating Gearman.

Cheers,
Tim 


From tim at rabbitmq.com  Thu May  9 12:53:32 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 9 May 2013 12:53:32 +0100
Subject: [rabbitmq-discuss] Using Load balancer(HA Proxy) while
	Federating of clusters.
In-Reply-To: <1367742899428-26436.post@n5.nabble.com>
References: <1367742899428-26436.post@n5.nabble.com>
Message-ID: <C87CF5D4-C43D-4FF7-B9C2-8D4E8DE6E98B@rabbitmq.com>

Hi,

On 5 May 2013, at 09:34, k.madnani84 wrote:

> I am having a configuration where in i have two different clusters(say C1 &
> C2) and each with 3 nodes.
> C1-N1,N2,N3
> C2-N4,N5,N6.
> 
> If I want to federate cluster C1 to cluster C2 do i need to federate the
> cluster C1 to each of the above node N4,N5,N6 ?
> 

It's entirely up to you how you federate your clusters. It's important to understand that what you're federating from the upstream is exchanges. You need to consider whether all the exchanges need federating or not. This is really an application dependent decision.

> If suppose i want to implement load balancing along with federation what
> changes do i need to make in the config file of my HAProxy?
> 

I have no idea what this means. What kind of load balancing are you think of implementing? Is the question whether the connections federation makes to upstream brokers need to be handled 'specially' if they access the upstream via HAProxy?

Cheers,
Tim

From chads.finishing.strong at gmail.com  Thu May  9 13:39:01 2013
From: chads.finishing.strong at gmail.com (chads.finishing.strong)
Date: Thu, 9 May 2013 07:39:01 -0500
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 LDAP plugin help
In-Reply-To: <518B733F.5020001@rabbitmq.com>
References: <d5a5cbb8-5835-4c82-91bb-1074fac64995@googlegroups.com>
	<518A60C1.2000809@rabbitmq.com>
	<CAOoq_UyXKgbccy5PmdjVr-RA5HuA9g+6EkE_ZveykBWFxBpbvA@mail.gmail.com>
	<518B733F.5020001@rabbitmq.com>
Message-ID: <CAOoq_Uw7yOKVS9bhkX=z-h_ivf5d64_r7RZYy2ds_jLWMDzuhQ@mail.gmail.com>

Tested on Fedora 17 and 18 (x86_64)

dev$ rabbitmqctl environment

Application environment of node 'rabbit at dev-1' ...
[{auth_backends,[rabbit_auth_backend_ldap,rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[],disc}},
 {cluster_partition_handling,ignore},
 {collect_statistics,fine},
 {collect_statistics_interval,10000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at dev-1.log"}},
 {frame_max,131072},
 {heartbeat,600},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.0/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at dev-1-plugins-expand
"},
 {queue_index_max_journal_entries,65536},
 {rabbitmq_auth_backend_ldap,
     [{servers,["sfcodc01.example.com"]},
      {dn_lookup_attribute,"sAMAccountName"},
      {dn_lookup_base,"DC=example,DC=com"},
      {user_dn_pattern,"example\\${username}"},
      {use_ssl,false},
      {port,389},
      {log,true},
      {vhost_access_query,{constant,true}},
      {resource_access_query,{constant,true}},
      {tag_queries,
          [{administrator,{constant,true}},
           {management,{constant,true}},
           {monitoring,{constant,true}}]}]},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at dev-1-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,
     [binary,
      {packet,raw},
      {reuseaddr,true},
      {backlog,128},
      {nodelay,true},
      {linger,{true,0}},
      {exit_on_close,false}]},
 {tcp_listeners,[{"127.0.0.1",5672}]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]
...done.

dev$ cat rabbitmq.config
[

   {rabbit, [

      {tcp_listeners, [{"127.0.0.1", 5672}]},

      {log_levels, [{connection, info}]},

      {collect_statistics_interval, 10000},

      {auth_backends, [
         rabbit_auth_backend_ldap, rabbit_auth_backend_internal
      ]},

      {rabbitmq_auth_backend_ldap, [

         {servers,    ["ldap.example.com"]},
         {other_bind, {"example\\\ptdldap", "mypasswd"}},
         {dn_lookup_attribute, "sAMAccountName"},
         {dn_lookup_base, "DC=example,DC=com"},
         {user_dn_pattern,
"(&(objectClass=user)(sAMAccountName=${username})),DC=example,DC=com"},
         {use_ssl, false},
         {port, 389},
         {log, true},
         {vhost_access_query,    {constant, true}},
         {resource_access_query, {constant, true}},
         {tag_queries, [
            {administrator, {constant, true}},
            {management,    {constant, true}},
            {monitoring,    {constant, true}}
         ]}

      ]}

   ]},

   {rabbitmq_management, [{listener, [{port, 9012}]}]},

   {rabbitmq_management_agent, [{force_fine_statistics, true}]}

].

I wouldn't put money on my dn_lookup_* or user_dn_pattern settings; I'm
reaching, trying to get this to work.

As far as the logs, **"nothing"** shows up; failed or otherwise.

dev$ cat *

=INFO REPORT==== 9-May-2013::07:35:23 ===
Starting RabbitMQ 3.1.0 on Erlang R15B03
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 9-May-2013::07:35:23 ===
node           : rabbit at dev-1
home dir       : /var/lib/rabbitmq
cookie hash    : eGWdsIswL6rcJkTG9w+ZDQ==
log            : /var/log/rabbitmq/rabbit at dev-1.log
sasl log       : /var/log/rabbitmq/rabbit at dev-1-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at dev-1

=INFO REPORT==== 9-May-2013::07:35:24 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 9-May-2013::07:35:24 ===
Memory limit set to 1582MB of 3955MB total.

=INFO REPORT==== 9-May-2013::07:35:24 ===
Disk free limit set to 1000MB

=INFO REPORT==== 9-May-2013::07:35:24 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 9-May-2013::07:35:24 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 9-May-2013::07:35:24 ===
started TCP Listener on 127.0.0.1:5672

=INFO REPORT==== 9-May-2013::07:35:24 ===
Management plugin started. Port: 8012

=INFO REPORT==== 9-May-2013::07:35:24 ===
Statistics database started.

=INFO REPORT==== 9-May-2013::07:35:24 ===
Server startup complete; 8 plugins started.
 * amqp_client
 * eldap
 * mochiweb
 * rabbitmq_auth_backend_ldap
 * rabbitmq_management
 * rabbitmq_management_agent
 * rabbitmq_web_dispatch
 * webmachine

              RabbitMQ 3.1.0. Copyright (C) 2007-2013 VMware, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /var/log/rabbitmq/rabbit at dev-1.log
  ######  ##        /var/log/rabbitmq/rabbit at dev-1-sasl.log
  ##########
              Starting broker... completed with 8 plugins.


On Thu, May 9, 2013 at 4:58 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 08/05/13 17:40, chads.finishing.strong wrote:
>
>> Simon, I did get your response; thanks. The rabbitmq.config portion I
>> listed, is under
>> rabbitmq_auth_backend_ldap. The ldap plugin is enabled and loaded. A
>> tcpdump shows that
>> it is indeed communicating with the ldap server.
>>
>> The issues are
>>
>> (1) the plugin is not logging debug info; neither {log, true} or {log,
>> network} work
>> (2) I'm unable to authenticate via ldap
>>
>
> Hmm.
>
> The log config item definitely works. What does "rabbitmqctl environment"
> say?
>
> When you say "I'm unable to authenticate via ldap", what *does* show up in
> then logs?
>
> Can you post your complete config?
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/1f3c1e82/attachment.htm>

From simon at rabbitmq.com  Thu May  9 13:51:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 May 2013 13:51:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 LDAP plugin help
In-Reply-To: <CAOoq_Uw7yOKVS9bhkX=z-h_ivf5d64_r7RZYy2ds_jLWMDzuhQ@mail.gmail.com>
References: <d5a5cbb8-5835-4c82-91bb-1074fac64995@googlegroups.com>
	<518A60C1.2000809@rabbitmq.com>
	<CAOoq_UyXKgbccy5PmdjVr-RA5HuA9g+6EkE_ZveykBWFxBpbvA@mail.gmail.com>
	<518B733F.5020001@rabbitmq.com>
	<CAOoq_Uw7yOKVS9bhkX=z-h_ivf5d64_r7RZYy2ds_jLWMDzuhQ@mail.gmail.com>
Message-ID: <518B9BC6.4060108@rabbitmq.com>

The rabbitmq_auth_backend_ldap element should not be nested within the 
rabbit element; it should be a peer of it like rabbitmq_management and 
rabbitmq_management_agent. Your whole LDAP config is being ignored.

Cheers, Simon

On 09/05/13 13:39, chads.finishing.strong wrote:
> Tested on Fedora 17 and 18 (x86_64)
>
> dev$ rabbitmqctl environment
>
> Application environment of node 'rabbit at dev-1' ...
> [{auth_backends,[rabbit_auth_backend_ldap,rabbit_auth_backend_internal]},
>   {auth_mechanisms,['PLAIN','AMQPLAIN']},
>   {backing_queue_module,rabbit_variable_queue},
>   {cluster_nodes,{[],disc}},
>   {cluster_partition_handling,ignore},
>   {collect_statistics,fine},
>   {collect_statistics_interval,10000},
>   {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>   {default_user,<<"guest">>},
>   {default_user_tags,[administrator]},
>   {default_vhost,<<"/">>},
>   {delegate_count,16},
>   {disk_free_limit,1000000000},
>   {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>   {error_logger,{file,"/var/log/rabbitmq/rabbit at dev-1.log"}},
>   {frame_max,131072},
>   {heartbeat,600},
>   {hipe_compile,false},
>   {included_applications,[]},
>   {log_levels,[{connection,info}]},
>   {msg_store_file_size_limit,16777216},
>   {msg_store_index_module,rabbit_msg_store_ets_index},
>   {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.0/sbin/../plugins"},
>   {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at dev-1-plugins-expand"},
>   {queue_index_max_journal_entries,65536},
>   {rabbitmq_auth_backend_ldap,
>       [{servers,["sfcodc01.example.com <http://sfcodc01.example.com>"]},
>        {dn_lookup_attribute,"sAMAccountName"},
>        {dn_lookup_base,"DC=example,DC=com"},
>        {user_dn_pattern,"example\\${username}"},
>        {use_ssl,false},
>        {port,389},
>        {log,true},
>        {vhost_access_query,{constant,true}},
>        {resource_access_query,{constant,true}},
>        {tag_queries,
>            [{administrator,{constant,true}},
>             {management,{constant,true}},
>             {monitoring,{constant,true}}]}]},
>   {reverse_dns_lookups,false},
>   {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at dev-1-sasl.log"}},
>   {server_properties,[]},
>   {ssl_cert_login_from,distinguished_name},
>   {ssl_listeners,[]},
>   {ssl_options,[]},
>   {tcp_listen_options,
>       [binary,
>        {packet,raw},
>        {reuseaddr,true},
>        {backlog,128},
>        {nodelay,true},
>        {linger,{true,0}},
>        {exit_on_close,false}]},
>   {tcp_listeners,[{"127.0.0.1",5672}]},
>   {trace_vhosts,[]},
>   {vm_memory_high_watermark,0.4}]
> ...done.
>
> dev$ cat rabbitmq.config
> [
>
>     {rabbit, [
>
>        {tcp_listeners, [{"127.0.0.1", 5672}]},
>
>        {log_levels, [{connection, info}]},
>
>        {collect_statistics_interval, 10000},
>
>        {auth_backends, [
>           rabbit_auth_backend_ldap, rabbit_auth_backend_internal
>        ]},
>
>        {rabbitmq_auth_backend_ldap, [
>
>           {servers,    ["ldap.example.com <http://ldap.example.com>"]},
>           {other_bind, {"example\\\ptdldap", "mypasswd"}},
>           {dn_lookup_attribute, "sAMAccountName"},
>           {dn_lookup_base, "DC=example,DC=com"},
>           {user_dn_pattern,
> "(&(objectClass=user)(sAMAccountName=${username})),DC=example,DC=com"},
>           {use_ssl, false},
>           {port, 389},
>           {log, true},
>           {vhost_access_query,    {constant, true}},
>           {resource_access_query, {constant, true}},
>           {tag_queries, [
>              {administrator, {constant, true}},
>              {management,    {constant, true}},
>              {monitoring,    {constant, true}}
>           ]}
>
>        ]}
>
>     ]},
>
>     {rabbitmq_management, [{listener, [{port, 9012}]}]},
>
>     {rabbitmq_management_agent, [{force_fine_statistics, true}]}
>
> ].
>
> I wouldn't put money on my dn_lookup_* or user_dn_pattern settings; I'm
> reaching, trying to get this to work.
>
> As far as the logs, **"nothing"** shows up; failed or otherwise.
>
> dev$ cat *
>
> =INFO REPORT==== 9-May-2013::07:35:23 ===
> Starting RabbitMQ 3.1.0 on Erlang R15B03
> Copyright (C) 2007-2013 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> =INFO REPORT==== 9-May-2013::07:35:23 ===
> node           : rabbit at dev-1
> home dir       : /var/lib/rabbitmq
> cookie hash    : eGWdsIswL6rcJkTG9w+ZDQ==
> log            : /var/log/rabbitmq/rabbit at dev-1.log
> sasl log       : /var/log/rabbitmq/rabbit at dev-1-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at dev-1
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> Memory limit set to 1582MB of 3955MB total.
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> Disk free limit set to 1000MB
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> started TCP Listener on 127.0.0.1:5672 <http://127.0.0.1:5672>
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> Management plugin started. Port: 8012
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> Statistics database started.
>
> =INFO REPORT==== 9-May-2013::07:35:24 ===
> Server startup complete; 8 plugins started.
>   * amqp_client
>   * eldap
>   * mochiweb
>   * rabbitmq_auth_backend_ldap
>   * rabbitmq_management
>   * rabbitmq_management_agent
>   * rabbitmq_web_dispatch
>   * webmachine
>
>                RabbitMQ 3.1.0. Copyright (C) 2007-2013 VMware, Inc.
>    ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>    ##  ##
>    ##########  Logs: /var/log/rabbitmq/rabbit at dev-1.log
>    ######  ##        /var/log/rabbitmq/rabbit at dev-1-sasl.log
>    ##########
>                Starting broker... completed with 8 plugins.
>
>
> On Thu, May 9, 2013 at 4:58 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 08/05/13 17:40, chads.finishing.strong wrote:
>
>         Simon, I did get your response; thanks. The rabbitmq.config
>         portion I
>         listed, is under
>         rabbitmq_auth_backend_ldap. The ldap plugin is enabled and loaded. A
>         tcpdump shows that
>         it is indeed communicating with the ldap server.
>
>         The issues are
>
>         (1) the plugin is not logging debug info; neither {log, true} or
>         {log,
>         network} work
>         (2) I'm unable to authenticate via ldap
>
>
>     Hmm.
>
>     The log config item definitely works. What does "rabbitmqctl
>     environment" say?
>
>     When you say "I'm unable to authenticate via ldap", what *does* show
>     up in then logs?
>
>     Can you post your complete config?
>
>     Cheers, Simon
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  9 14:05:16 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 May 2013 14:05:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ Flow Control Behavior Questions
In-Reply-To: <2c4a6d0e-8a64-46ce-841f-1df762d48884@googlegroups.com>
References: <2c4a6d0e-8a64-46ce-841f-1df762d48884@googlegroups.com>
Message-ID: <518B9F0C.4060401@rabbitmq.com>

On 08/05/13 20:05, Viral Shah wrote:
> Hi,
>       I am using  3.0.4 Java client library/RabbitMQ server and have
> some questions about RabbitMQ flow control behavior.
>
> 1. What is the recommended way of handling/detecting flow control
> invocations on the client side? Is it possible to detect that flow
> control has been invoked on the RabbitMQ server by adding FlowListener
> or any other method? Is it possible to detect that the connection is
> blocked on the client side thru the Java client library or by using some
> workaround so that we can stop sending messages and not get the threads
> stuck in some RabbitMQ method call until the server comes out of flow
> control (which may take longer in some cases).

I'm afraid there isn't one at the moment. The FlowListener interface 
allows the client to determine if the server has sent channel.flow{}. 
But we haven't had the server do that for many releases now 
(channel.flow doesn't work very well).

We are looking at how we can expose the memory / disc alarm state to the 
client in a future release; hopefully it might be in 3.2.

> 2. Channel.close() method does not take a timeout value and the thread
> remains blocked in case the server is under flow control. Is there a
> reason for not having a timeout in the channel close method? If I use
> Connection.close() then it does take a timeout value. Is there a list of
> methods that get blocked during flow control and which ones are not
> affected.

Everything gets blocked *once the connection has published something*.

Connection.close() can take a timeout since there's something the client 
can do unilaterally when the timeout occurs (close the socket). But the 
client can't really do anything in an AMQP sense (including closing a 
channel) if the server is not cooperating.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  9 14:42:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 May 2013 14:42:23 +0100
Subject: [rabbitmq-discuss] Cluster upgrade failed
In-Reply-To: <42A58CC11C25A241AE9FC4C208C742C3521A5D@emsbs1.esteeinc.local>
References: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>
	<CA+F3nVwr99CjX_PsY-i+5+Mj8UgyRu7dDqqK5H0Bu+-99MiG0w@mail.gmail.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A5D@emsbs1.esteeinc.local>
Message-ID: <518BA7BF.6000502@rabbitmq.com>

Hi. So this looks very much like each node was somehow reset during the 
upgrade process.

What exactly did you do for each upgrade?

Cheers, Simon

On 08/05/13 18:13, Tracy Dalzell wrote:
> Status reports attached
>
> *From:*Daniel Buchko [mailto:dbuchko at gopivotal.com]
> *Sent:* Wednesday, May 08, 2013 12:48 PM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Cc:* Tracy Dalzell
> *Subject:* Fwd: Cluster upgrade failed
>
> Forwarding on behalf of Tracy....
>
> ---------- Forwarded message ----------
> From: *Tracy Dalzell* <tracy at guisolutions.com
> <mailto:tracy at guisolutions.com>>
> Date: Wed, May 8, 2013 at 11:59 AM
> Subject: Cluster upgrade failed
> To: rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>
> Hello,
>
> I just upgraded a four node cluster from 3.0.4 -> 3.1.  I took them down
> (stopped the rabbit server) in order 1,2,3,4.  Upgraded and restarted in
> reverse order 4,3,2,1.  When everything came back up I could only login
> as guest.  All users and vhosts are gone.  When I refresh the management
> UI I see only nodes 2 and 3, then only 1, then only 4, etc?
>
> TIA,
>
> Tracy
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From tim at rabbitmq.com  Thu May  9 15:00:30 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 9 May 2013 15:00:30 +0100
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
Message-ID: <9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>

Hi,

On 8 May 2013, at 18:22, Eric Berg wrote:

> I have ready through many of these nodedown error emails and of course none of them seem to be exactly what I am experiencing.
> 
> I have a 4 node cluster, and one of the nodes went offline according to the cluster. This box has the following in the sasl log:
> 
> =SUPERVISOR REPORT==== 7-May-2013::14:37:22 ===
>      Supervisor: {<0.11197.1096>,
>                                            rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     noproc
>      Offender:   [{pid,<0.11199.1096>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
> 

This simply indicates that and error occurred whilst a supervised process was shutting down. It's not indicative of the whole node going down - Erlang allows processes to crash and be restarted whilst the system is running.

> Yet in the regular rabbit log i can see that it was still accepting connections up until 2:22AM the next day:
> 
> (last log entry)
> =INFO REPORT==== 8-May-2013::02:22:26 ===
> closing AMQP connection <0.18267.1145> (IPADDRESS:PORT -> IPADDRESS:PORT)
> 

So clearly that node didn't actually go offline. The 'nodedown' message in the other clustered broker's logs does not necessarily mean that the node in question crashed; This could, for example, be indicative of a net-split or other connectivity failure. 

> Running rabbitmqctl status returns:
> 
> [root at rabbit-box rabbitmq]# rabbitmqctl status
> Status of node 'rabbit at rabbit-box' ...
> Error: unable to connect to node 'rabbit at rabbit-box': nodedown
> 
> DIAGNOSTICS
> ===========
> 
> nodes in question: ['rabbit at rabbit-box']
> 
> hosts, their running nodes and ports:
> - rabbit-box: [{rabbit,13957},{rabbitmqctl2301,16508}]
> 
> current node details:
> - node name: 'rabbitmqctl2301 at rabbit-box'
> - home dir: /var/lib/rabbitmq
> - cookie hash: qQwyFW90ZNbbrFvX1AtrxQ==

Have you tried running this using `sudo' instead of as root? Is the rabbitmq user's account and home folder in a consistent state? The security cookie used for inter-node communications, which includes communication between the temporary `rabbitmqctl' node and the broker, has to be the same for all the peers.

> A couple of notes:
> - Looking for a process run by rabbit show that it appears to still be running

Yes - as I said, there's no indication that this node actually died from what you've said. However `rabbitmqctl` should be able to connect to rabbit at rabbit-box at the very least. 

> - Erlang cookie is the same on all nodes of the cluster, the cookie hash is the same as well

If it's not the cookies then....

> - A traffic spike occurred right around the time of the last entry in the rabbit log

It sounds like this could be a potential culprit. Can you provide any more information about what happened? It could be that whilst the network was saturated, the node in question got disconnected from the other nodes in the cluster because it exceeded the "net tick time" and subsequently things have started to go wrong. That shouldn't happen, viz the node should be able to re-establish connectivity, but it's possible that something's gone wrong here.

What that doesn't explain is why you can't connect from rabbitmqctl. If you `su rabbitmq', can you then run `erl -sname debug -remsh rabbit at rabbit-box' to establish a shell into the running broker? If that does work, then you can stop the rabbit application and then the node, as follows:

> rabbit:stop().
ok
> init:stop().

But before you do, it might be worth evaluating a couple of other things that might help us identify what's going on:

(rabbit at iske)1> whereis(rabbit).
<0.152.0>
(rabbit at iske)2> application:loaded_applications().
[{os_mon,"CPO  CXC 138 46","2.2.9"},
 {rabbitmq_management_agent,"RabbitMQ Management Agent",
                            "0.0.0"},
 {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
 etc ...
 ]
(rabbit at iske)3> application:which_applications(). 
[{rabbitmq_shovel_management,"Shovel Status","0.0.0"},
 etc ...
]
 
If during any of these you get stuck, CTRL-C (and press the key for 'abort') should get you back out again without incident.


> - I can find no other errors in any logs that relate to rabbit or erlang
> - Up until this point the cluster has been running fine for over 40 days.
> - telnet IP_ADDRESS 5672 times out

So the broker is no longer accepting new AMQP connections then. Something's clearly quite wrong with this node.

> - I have not restarted the box, erlang node, or entire rabbitmq-server
> 
> Is there anywhere else I can go looking for errors? I am about to start killing processs, but Im not sure that will solve anything.
> 

Did you do that in the end? If not, I would really like to get to the bottom of what's wrong with this node. I don't suppose it would be possible for you to give us access to this machine would it? If necessary, we may be able to get some kind of confidentiality agreement signed if that'd help.

Cheers,

Tim Watson
Staff Engineer
RabbitMQ



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/7373b798/attachment.htm>

From tracy at guisolutions.com  Thu May  9 15:52:35 2013
From: tracy at guisolutions.com (Tracy Dalzell)
Date: Thu, 9 May 2013 10:52:35 -0400
Subject: [rabbitmq-discuss] Cluster upgrade failed
In-Reply-To: <518BA7BF.6000502@rabbitmq.com>
References: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>
	<CA+F3nVwr99CjX_PsY-i+5+Mj8UgyRu7dDqqK5H0Bu+-99MiG0w@mail.gmail.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A5D@emsbs1.esteeinc.local>
	<518BA7BF.6000502@rabbitmq.com>
Message-ID: <42A58CC11C25A241AE9FC4C208C742C3521A61@emsbs1.esteeinc.local>

Hi Simon,
Here's what happened... I followed the cluster upgrade instructions by
taking down each server (service rabbitmg-server stop) in order 1,2,3,4.
Upgraded and restarted in reverse order 4,3,2,1.  When they came back up
I could only login as guest.  All users and vhosts are gone, 2 and 3
were clustered and 1 and 4 were standalone. They are behind an HAProxy
so when I would refresh the management UI I see only nodes 2 and 3
clustered, then only 1, then only 4, etc...

I recreated the cluster, join_cluster rabbit01 -> rabbit02 then rabbit04
-> rabbit02.  The cluster looked good but still no users or fabric.  It
did however, show that one of the nodes was using 16GB of disk and I
knew that was persistent messages that were in a queue when I took
everything down.  I started poking around on all the servers and all the
config and db files seemed to be in place .  I was just about to reset
everything when I found the problem....

The upgrade apparently created a new rabbitmq-env file and a new
symbolic link /usr/lib/rabbitmq/bin/rabbitmq-env ->
../lib/rabbitmq_server-3.1.0/sbin/rabbitmq-env.  Our 3.0.4 configuration
had the following entries in rabbitmq-env:

RABBITMQ_MNESIA_BASE=/mnt/data/rabbitmq/mnesia
export RABBITMQ_MNESIA_BASE

Those two entries were not in the new rabbitmq-env file so when rabbit
started after the upgrade the mnesia database was reinitialized in the
default location.  I took down all the servers, edited the file on each
server, brought them back up and then I had a big phat rabbit, just the
way I like it.

Tracy

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Thursday, May 09, 2013 9:42 AM
To: Discussions about RabbitMQ
Cc: Tracy Dalzell; Daniel Buchko
Subject: Re: [rabbitmq-discuss] Cluster upgrade failed

Hi. So this looks very much like each node was somehow reset during the
upgrade process.

What exactly did you do for each upgrade?

Cheers, Simon

On 08/05/13 18:13, Tracy Dalzell wrote:
> Status reports attached
>
> *From:*Daniel Buchko [mailto:dbuchko at gopivotal.com]
> *Sent:* Wednesday, May 08, 2013 12:48 PM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Cc:* Tracy Dalzell
> *Subject:* Fwd: Cluster upgrade failed
>
> Forwarding on behalf of Tracy....
>
> ---------- Forwarded message ----------
> From: *Tracy Dalzell* <tracy at guisolutions.com 
> <mailto:tracy at guisolutions.com>>
> Date: Wed, May 8, 2013 at 11:59 AM
> Subject: Cluster upgrade failed
> To: rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>
> Hello,
>
> I just upgraded a four node cluster from 3.0.4 -> 3.1.  I took them 
> down (stopped the rabbit server) in order 1,2,3,4.  Upgraded and 
> restarted in reverse order 4,3,2,1.  When everything came back up I 
> could only login as guest.  All users and vhosts are gone.  When I 
> refresh the management UI I see only nodes 2 and 3, then only 1, then 
> only 4, etc...
>
> TIA,
>
> Tracy
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  9 16:06:55 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 May 2013 16:06:55 +0100
Subject: [rabbitmq-discuss] Cluster upgrade failed
In-Reply-To: <42A58CC11C25A241AE9FC4C208C742C3521A61@emsbs1.esteeinc.local>
References: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>
	<CA+F3nVwr99CjX_PsY-i+5+Mj8UgyRu7dDqqK5H0Bu+-99MiG0w@mail.gmail.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A5D@emsbs1.esteeinc.local>
	<518BA7BF.6000502@rabbitmq.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A61@emsbs1.esteeinc.local>
Message-ID: <518BBB8F.5090901@rabbitmq.com>

On 09/05/13 15:52, Tracy Dalzell wrote:
<snip>
> The upgrade apparently created a new rabbitmq-env file and a new
> symbolic link /usr/lib/rabbitmq/bin/rabbitmq-env ->
> ../lib/rabbitmq_server-3.1.0/sbin/rabbitmq-env.  Our 3.0.4 configuration
> had the following entries in rabbitmq-env:
>
> RABBITMQ_MNESIA_BASE=/mnt/data/rabbitmq/mnesia
> export RABBITMQ_MNESIA_BASE
>
> Those two entries were not in the new rabbitmq-env file so when rabbit
> started after the upgrade the mnesia database was reinitialized in the
> default location.  I took down all the servers, edited the file on each
> server, brought them back up and then I had a big phat rabbit, just the
> way I like it.

Ah! Glad you sorted this out.

However, you might want to put this customisation into 
/etc/rabbitmq/rabbitmq-env.conf instead (in a slightly different form):

MNESIA_BASE=/mnt/data/rabbitmq/mnesia

See:

http://www.rabbitmq.com/man/rabbitmq-env.conf.5.man.html
http://www.rabbitmq.com/relocate.html

The reason is that the rabbitmq-env file you edited is part of the 
installation - so the next time you upgrade it will get overwritten 
again and things will break again...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From tracy at guisolutions.com  Thu May  9 16:20:06 2013
From: tracy at guisolutions.com (Tracy Dalzell)
Date: Thu, 9 May 2013 11:20:06 -0400
Subject: [rabbitmq-discuss] Cluster upgrade failed
In-Reply-To: <518BBB8F.5090901@rabbitmq.com>
References: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>
	<CA+F3nVwr99CjX_PsY-i+5+Mj8UgyRu7dDqqK5H0Bu+-99MiG0w@mail.gmail.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A5D@emsbs1.esteeinc.local>
	<518BA7BF.6000502@rabbitmq.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A61@emsbs1.esteeinc.local>
	<518BBB8F.5090901@rabbitmq.com>
Message-ID: <42A58CC11C25A241AE9FC4C208C742C3521A63@emsbs1.esteeinc.local>

That file does not currently exist.  Just create it?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Thursday, May 09, 2013 11:07 AM
To: Tracy Dalzell
Cc: Discussions about RabbitMQ; Daniel Buchko
Subject: Re: [rabbitmq-discuss] Cluster upgrade failed

On 09/05/13 15:52, Tracy Dalzell wrote:
<snip>
> The upgrade apparently created a new rabbitmq-env file and a new 
> symbolic link /usr/lib/rabbitmq/bin/rabbitmq-env -> 
> ../lib/rabbitmq_server-3.1.0/sbin/rabbitmq-env.  Our 3.0.4 
> configuration had the following entries in rabbitmq-env:
>
> RABBITMQ_MNESIA_BASE=/mnt/data/rabbitmq/mnesia
> export RABBITMQ_MNESIA_BASE
>
> Those two entries were not in the new rabbitmq-env file so when rabbit

> started after the upgrade the mnesia database was reinitialized in the

> default location.  I took down all the servers, edited the file on 
> each server, brought them back up and then I had a big phat rabbit, 
> just the way I like it.

Ah! Glad you sorted this out.

However, you might want to put this customisation into
/etc/rabbitmq/rabbitmq-env.conf instead (in a slightly different form):

MNESIA_BASE=/mnt/data/rabbitmq/mnesia

See:

http://www.rabbitmq.com/man/rabbitmq-env.conf.5.man.html
http://www.rabbitmq.com/relocate.html

The reason is that the rabbitmq-env file you edited is part of the
installation - so the next time you upgrade it will get overwritten
again and things will break again...

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  9 16:21:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 May 2013 16:21:02 +0100
Subject: [rabbitmq-discuss] Cluster upgrade failed
In-Reply-To: <42A58CC11C25A241AE9FC4C208C742C3521A63@emsbs1.esteeinc.local>
References: <42A58CC11C25A241AE9FC4C208C742C3521A56@emsbs1.esteeinc.local>
	<CA+F3nVwr99CjX_PsY-i+5+Mj8UgyRu7dDqqK5H0Bu+-99MiG0w@mail.gmail.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A5D@emsbs1.esteeinc.local>
	<518BA7BF.6000502@rabbitmq.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A61@emsbs1.esteeinc.local>
	<518BBB8F.5090901@rabbitmq.com>
	<42A58CC11C25A241AE9FC4C208C742C3521A63@emsbs1.esteeinc.local>
Message-ID: <518BBEDE.1080700@rabbitmq.com>

On 09/05/13 16:20, Tracy Dalzell wrote:
> That file does not currently exist.  Just create it?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From richard at raseley.com  Thu May  9 17:58:53 2013
From: richard at raseley.com (Richard Raseley)
Date: Thu, 9 May 2013 09:58:53 -0700
Subject: [rabbitmq-discuss] Guidance on Understanding API Output for
	Monitoring
Message-ID: <CAO=6ox_Yiisk18BeNHs6qO2aVxDow12XjJpAGiDmw5DSVAvi7g@mail.gmail.com>

I have attached a JSON document that is the output of the following query
against my RabbitMQ cluster:

http://cluster-vip:15672/api/exchanges/?sort=name

I was hoping that someone could point me towards some documentation that
would help me better understand what info surrounding the message stats,
publishing rates, etc. so that I might use them in monitoring the health
and throughput of the system.

This information doesn't seem to be in the official API document and I was
unable to turn up any other authoritative source.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/fcaf71c2/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: output.json
Type: application/json
Size: 3190 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/fcaf71c2/attachment.bin>

From k.madnani84 at gmail.com  Thu May  9 21:10:03 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Thu, 9 May 2013 13:10:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Using Load balancer(HA Proxy) while
	Federating of clusters.
In-Reply-To: <C87CF5D4-C43D-4FF7-B9C2-8D4E8DE6E98B@rabbitmq.com>
References: <1367742899428-26436.post@n5.nabble.com>
	<C87CF5D4-C43D-4FF7-B9C2-8D4E8DE6E98B@rabbitmq.com>
Message-ID: <1368130203269-26556.post@n5.nabble.com>

 Is the question whether the connections federation makes to upstream brokers
need to be handled 'specially' if they access the upstream via HAProxy?
Yes exactly i want to know how federation communicates with upstreams and
presence of HAProxy in between federation and upstream will make any
difference or we need to communicate as it is?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Using-Load-balancer-HA-Proxy-while-Federating-of-clusters-tp26436p26556.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Thu May  9 22:48:09 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 9 May 2013 22:48:09 +0100
Subject: [rabbitmq-discuss] Using Load balancer(HA Proxy) while
	Federating of clusters.
In-Reply-To: <1368130203269-26556.post@n5.nabble.com>
References: <1367742899428-26436.post@n5.nabble.com>
	<C87CF5D4-C43D-4FF7-B9C2-8D4E8DE6E98B@rabbitmq.com>
	<1368130203269-26556.post@n5.nabble.com>
Message-ID: <0A3436C9-2B52-47D6-B6BF-3CA6D7BB9ACF@rabbitmq.com>

Hi,

On 9 May 2013, at 21:10, k.madnani84 wrote:

> Is the question whether the connections federation makes to upstream brokers
> need to be handled 'specially' if they access the upstream via HAProxy?
> Yes exactly i want to know how federation communicates with upstreams and
> presence of HAProxy in between federation and upstream will make any
> difference or we need to communicate as it is?
> 

Federation uses ordinary AMQP connections to communicate with upstream nodes. For each upstream node, there will be a connection. Load balancing should not be a problem in theory, because RabbitMQ clusters share information about queues and federation uses a queue internally (on the upstream node) known as the upstream queue, which the downstream connections are consuming from. As per the reliability guide (http://www.rabbitmq.com/reliability.html):

"Federation will automatically distribute links across the downstream cluster and fail them over on failure of a downstream node. In order to connect to a new upstream when an upstream node fails you can specify multiple redundant URIs for an upstream, or connect via a TCP load balancer."

HTH

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/b3635c1a/attachment.htm>

From blaztoff at gmail.com  Thu May  9 23:55:17 2013
From: blaztoff at gmail.com (Johnny Costello)
Date: Thu, 9 May 2013 15:55:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Using a VIP address for Clients Connecting to
	3.1.0
Message-ID: <43a533c3-a517-4fa2-812f-309474e95145@googlegroups.com>

Hi I am setting up a Rabbit MQ installation for HA. I am using clustering 
 and  active/active mirroring for HA.

My Current Setup is two nodes that are set to mirror each other. I want to 
use a VIP address for my clients to connect to.

I am not clear on how to configure the VIP. To me it appears that prior to 
Active/Active setup you always had to point your clients to the Master and 
then fail over to the slave if the Master fails.

With Active/Active mirroring does this still apply or does it matter 
anymore?

Is there any command that can tell what server is the master anymore? I run 
cluster_status and nothing shows up saying which node is master. 

Is there a way to set up your configuration to always mirror queues instead 
of making the change on command line?

Thank you


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/7e91e5c0/attachment.htm>

From bhenerey at sittercity.com  Thu May  9 20:54:35 2013
From: bhenerey at sittercity.com (bhenerey at sittercity.com)
Date: Thu, 9 May 2013 12:54:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster not running - getting Error:
 {cannot_discover_cluster,
 "The nodes provided are either offline or not running" error
In-Reply-To: <90b4b897-8f59-4652-b6a0-e81a76b340c7@googlegroups.com>
References: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
	<90b4b897-8f59-4652-b6a0-e81a76b340c7@googlegroups.com>
Message-ID: <ed248c16-82db-43c0-a5c6-80be9cc61699@googlegroups.com>

if you can resolve the hostnames from node1<-->node2
and you can telnet between the two nodes to port 4369
then perhaps you forgot to set the erlang_cookie to the same value on both 
nodes

Hope this helps.

On Friday, May 3, 2013 3:19:40 AM UTC-5, subhankar biswas wrote:
>
> @shankaralingegowda Singonahalli Chikkarevanna
> how did you solved the problem????
> i m facing d same problem
>
> On Thursday, 28 February 2013 21:10:56 UTC+5:30, shankaralingegowda 
> Singonahalli Chikkarevanna wrote:
>>
>> Hi,
>> I am running Cluster setup of rabbitmq. 
>> the single node at both the machines are running fine in the same network
>>
>> and I have enabled ssh entry for both master and slave
>> slave can access master using ssh master
>>
>> after that I stopped rabbitmq slave machine
>> and run join cluster command like join_cluster rabbitmq at master    
>> ---{here rabbitmq is master setup user name and I{p)
>>
>> but getting
>> Error: {cannot_discover_cluster,"The nodes provided are either offline or 
>> not running"
>> error
>> please help me to resolve the issue
>>
>> Thanks in advance
>>
>> shankarlaingegowda
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/56227946/attachment.htm>

From davidlan at iii.org.tw  Fri May 10 03:58:38 2013
From: davidlan at iii.org.tw (=?UTF-8?B?IuiXjee0uee3ryAtIChkYXZpZCki?=)
Date: Fri, 10 May 2013 10:58:38 +0800
Subject: [rabbitmq-discuss] About the RabbitMQ Plugin JSONRPC
Message-ID: <518C625E.1030103@iii.org.tw>

Dear All:

How could I change the setting of timeout,

I use the JSONRPC sample  "test.js", try different timeout, but I see 
the /var/log/rabbitmq/rabbit.log

It always shows HTTP Channel started, timeout 5

because I want to send huge data through jsonrpc,  so how could I change 
the timeout setting?

Best Regards
David


From dave.chen80 at gmail.com  Fri May 10 02:17:11 2013
From: dave.chen80 at gmail.com (Dave Chen)
Date: Thu, 9 May 2013 18:17:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot start rabbitmq
Message-ID: <7b9c2edb-ebed-4d42-8144-63a623e6cb5a@googlegroups.com>

Hi,

I installed Rabbit OSX version of 3.1.0 and I am getting the following 
error when starting up the server:

$ ./rabbitmq-server 
usage: dirname path
./../erts-5.10.1/bin/erl: line 29: /../../erts-5.10.1/bin/erlexec: No such 
file or directory
./../erts-5.10.1/bin/erl: line 29: exec: /../../erts-5.10.1/bin/erlexec: 
cannot execute: No such file or directory

Anyone know how to fix it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/e97d516d/attachment.htm>

From bhenerey at sittercity.com  Thu May  9 20:54:35 2013
From: bhenerey at sittercity.com (bhenerey at sittercity.com)
Date: Thu, 9 May 2013 12:54:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster not running - getting Error:
 {cannot_discover_cluster,
 "The nodes provided are either offline or not running" error
In-Reply-To: <90b4b897-8f59-4652-b6a0-e81a76b340c7@googlegroups.com>
References: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
	<90b4b897-8f59-4652-b6a0-e81a76b340c7@googlegroups.com>
Message-ID: <ed248c16-82db-43c0-a5c6-80be9cc61699@googlegroups.com>

if you can resolve the hostnames from node1<-->node2
and you can telnet between the two nodes to port 4369
then perhaps you forgot to set the erlang_cookie to the same value on both 
nodes

Hope this helps.

On Friday, May 3, 2013 3:19:40 AM UTC-5, subhankar biswas wrote:
>
> @shankaralingegowda Singonahalli Chikkarevanna
> how did you solved the problem????
> i m facing d same problem
>
> On Thursday, 28 February 2013 21:10:56 UTC+5:30, shankaralingegowda 
> Singonahalli Chikkarevanna wrote:
>>
>> Hi,
>> I am running Cluster setup of rabbitmq. 
>> the single node at both the machines are running fine in the same network
>>
>> and I have enabled ssh entry for both master and slave
>> slave can access master using ssh master
>>
>> after that I stopped rabbitmq slave machine
>> and run join cluster command like join_cluster rabbitmq at master    
>> ---{here rabbitmq is master setup user name and I{p)
>>
>> but getting
>> Error: {cannot_discover_cluster,"The nodes provided are either offline or 
>> not running"
>> error
>> please help me to resolve the issue
>>
>> Thanks in advance
>>
>> shankarlaingegowda
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130509/56227946/attachment-0001.htm>

From Punit.Jain at emc.com  Fri May 10 09:19:45 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Fri, 10 May 2013 04:19:45 -0400
Subject: [rabbitmq-discuss] Regarding Federation Plugin Configuration
Message-ID: <DB14E94115BBC84E8960C12C176D06762BB0802D@MX25A.corp.emc.com>

Hi,
I have configured two brokers in federated mode, and both are running on version 2.8.2(I know it's outdated, but for some reasons I have to stick with it). I have configured both in bidirectional mode. You can see the configuration for one broker below. I am able to receive messages from upstream broker, but when connection between brokers is lost or if I close the connection deliberately, the messages are not persisted, i.e. the messages sent to upstream broker during that time span are lost, and they are not received after reestablishing the connection. How can I ensure that the messages are persisted on upstream exchange/queue while connection to federated broker is down or not established? Or is it the expected behavior? I will really appreciate if you can assist me in configuring it properly or provide some workaround.

I tried to find some documentation on federation plugin configuration for version 2.8.2, but I couldn't find anything useful. If you have some link or document for federation plugin configuration for version 2.8.2 or so, please paste it, I will really appreciate it.

[{rabbitmq_federation,
[
        { exchanges,[
                [
                      { exchange, "Cluster1" },
                      { type, "topic" },
                      { upstream_set, "my_upstream" }
                ]
        ]},
        { upstream_sets,
            [
                {"my_upstream",
                    [
                       [
                            { connection, "host040" },
                            { exchange, "Cluster1" }
                       ]
                    ]
                }
            ]
        },
        { connections,
            [

                {"host040",
                    [
                      { host, "XX.XX.XX.XX" }
                    ]
                }
            ]
        }
    ]
}].

Thanks,
Punit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/95528d43/attachment.htm>

From videlalvaro at gmail.com  Fri May 10 09:29:15 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 10 May 2013 10:29:15 +0200
Subject: [rabbitmq-discuss] Cannot start rabbitmq
In-Reply-To: <7b9c2edb-ebed-4d42-8144-63a623e6cb5a@googlegroups.com>
References: <7b9c2edb-ebed-4d42-8144-63a623e6cb5a@googlegroups.com>
Message-ID: <CAMcAHLW-J_KO8pFce1iAA+wuRxBtFubfiO6fE0v27guapsL19Q@mail.gmail.com>

What specific package are you using?


On Fri, May 10, 2013 at 3:17 AM, Dave Chen <dave.chen80 at gmail.com> wrote:

> Hi,
>
> I installed Rabbit OSX version of 3.1.0 and I am getting the following
> error when starting up the server:
>
> $ ./rabbitmq-server
> usage: dirname path
> ./../erts-5.10.1/bin/erl: line 29: /../../erts-5.10.1/bin/erlexec: No such
> file or directory
> ./../erts-5.10.1/bin/erl: line 29: exec: /../../erts-5.10.1/bin/erlexec:
> cannot execute: No such file or directory
>
> Anyone know how to fix it?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/2dec9e06/attachment.htm>

From liqusha at gmail.com  Fri May 10 09:48:54 2013
From: liqusha at gmail.com (Ahmet Akyol)
Date: Fri, 10 May 2013 01:48:54 -0700 (PDT)
Subject: [rabbitmq-discuss] [java-client] Is there a full working example of
 "DefaultConsumer" without *deprecated * QueueingConsumer ?
Message-ID: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>

Hi everyone,

I'm a RabbitMQ newbie. I try some code with the java client.  Offical site 
tutorial codes are just fine with QueueingConsumer. But then I saw this at 
javadoc:

QueueingConsumer is now deprecated in favour of implementing Consumer 
> directly or extending DefaultConsumer



Then I saw an example usage at api guide<http://www.rabbitmq.com/api-guide.html>

*boolean* autoAck = *false*;
> channel.basicConsume(queueName, autoAck, "myConsumerTag",
>      *new* DefaultConsumer(channel) {
>          @Override
>          *public* *void* handleDelivery(String consumerTag,
>                                     Envelope envelope,
>                                     AMQP.BasicProperties properties,
>                                     *byte*[] body)
>              *throws* IOException
>          {
>              String routingKey = envelope.getRoutingKey();
>              String contentType = properties.contentType;
>              *long* deliveryTag = envelope.getDeliveryTag();
>              *// (process the message components here ...)*
>              channel.basicAck(deliveryTag, *false*);
>          }
>      });
>
>

but it never worked for me. api guide says:

The Java client library distribution is shipped with a 
> rabbitmq-client-tests.jar, containing several small example programs for 
> exercising the functionality of the RabbitMQ server. The source code for 
> these examples is in the test/src folder in the source distribution. 


unfortunately, there isn't such example, all of the consumer codes uses 
QueueingConsume. 

So, is there a full working example of "DefaultConsumer"  or using 
QueueingConsumer is just fine?

Thanks in advance ...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/b2562a7d/attachment.htm>

From rse at open.ch  Fri May 10 10:01:21 2013
From: rse at open.ch (Raphael Seebacher)
Date: Fri, 10 May 2013 11:01:21 +0200
Subject: [rabbitmq-discuss] stomp adapter behaviour
Message-ID: <56CBEC10-B1A0-4BB9-867E-DD7739A0FC3E@open.ch>

hi all

i've just stumbled upon an interesting behaviour of the rabbitmq stomp adapter:
after having connected to a rabbitmq-server instance via stomp (e.g. using telnet), only the very first message to a destination is treated by the server (i.e. only the first SEND command succeeds). subsequent messages do not seem to be handled by the server (cf [1]). i have not found anything in the log files regarding that issue, nor in the documentation. when i close the connection and reconnect to the server again, i can again only submit one SEND command.

is that the intended behaviour of the adapter, have i forgotten to configure something, or may that indicate a bug?

thanks for your insights,
raphael


[1]
$ telnet 127.0.0.1 61614
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
CONNECT
accept-version:1.2

^@
CONNECTED
session:session-cAdfo6c8ju8X8tfKu7tgnA
heart-beat:0,0
server:RabbitMQ/3.1.0
version:1.2

SEND
destination:/queue/tmp
receipt:1

hello world
^@
RECEIPT
receipt-id:1

SEND
destination:/queue/tmp
receipt:2

hello world, again
^@

^]
telnet> quit
Connection closed.
$


[2] config file:
$ cat /etc/rabbitmq/rabbitmq.config
[
  {rabbitmq_stomp, [{tcp_listeners, [{"127.0.0.1", 61614}]},
                    {default_user, [{login, "guest"},
                                    {passcode, "guest"}]}]}
].



From emile at rabbitmq.com  Fri May 10 10:45:41 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 May 2013 10:45:41 +0100
Subject: [rabbitmq-discuss] Porting .NET client to WinRT API (Windows 8).
In-Reply-To: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>
References: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>
Message-ID: <518CC1C5.1060008@rabbitmq.com>


Hi Nathan,

On 07/05/13 17:34, Nathan Brown wrote:
> Can you guys review these changes and consider incorporating them into
> the mainline codebase?

Yes, and thanks! We'd like to make use of your contribution, but it will
take a while to review. May I request that you sign a contributor
agreement in the meantime? I'll contact you off-list.

> The networking area is another area of change in WinRT.  It will have to
> involve a separate project because System.Net.Sockets has been removed
> and Windows.Networking.Sockets has been added.  I am still working on
> porting the networking code to the WinRT API, but that will hit far
> fewer files than the non-generic to generic collection conversion.

Yes, Socket and SSL-related functionality is more localised.

We would be reluctant to relinquish the compatibility of the current
.net client with mono. I'm not sure whether that is necessarily the
implication, but it might be something to consider.




-Emile







From moonstorm at gmail.com  Fri May 10 10:49:25 2013
From: moonstorm at gmail.com (MoonStorm)
Date: Fri, 10 May 2013 02:49:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Queues no longer expire in RabbitMq 3.1.0
In-Reply-To: <3976cf10-7c02-48bf-8f8a-c24add00d924@googlegroups.com>
References: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>
	<3976cf10-7c02-48bf-8f8a-c24add00d924@googlegroups.com>
Message-ID: <b91d5073-56c7-4bb2-9ed0-545d75d272ae@googlegroups.com>

Nah, there is more there than meets the eye. I've got durable expirable 
queues, holding several messages, that don't want to go away. There is 
definitely something screwy there.

On Thursday, May 9, 2013 10:46:07 AM UTC+1, MoonStorm wrote:
>
>
> Here is a bit more info on the subject. Ran some tests and apparently the 
> queues seem to expire if they've been declared as durable after all the 
> consumers dropped. Apart from my initial report, the setting is also 
> ignored if they've been declared as auto-delete, which sort of makes sense 
> (in this case they get deleted immediately). 
>
> Either way, the admin interface reports the setting as active, and this is 
> a bug when the setting is actually being ignored. Besides, could we have a 
> bit of validation for the settings please? Ignoring them when used in an 
> unsupported context is simply wrong.
>
> On Tuesday, May 7, 2013 12:24:08 PM UTC+1, MoonStorm wrote:
>>
>> Declaring a queue with "x-expires" set to a valid value has no effect 
>> after the consumers disconnect. The admin interface reports the queue being 
>> idle with no consumers present.
>>
>> They used to expire in earlier versions. Are there additional 
>> requirements now to achieve the same behavior?
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/2749be39/attachment.htm>

From simon at rabbitmq.com  Fri May 10 10:55:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 May 2013 10:55:00 +0100
Subject: [rabbitmq-discuss] Queues no longer expire in RabbitMq 3.1.0
In-Reply-To: <b91d5073-56c7-4bb2-9ed0-545d75d272ae@googlegroups.com>
References: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>
	<3976cf10-7c02-48bf-8f8a-c24add00d924@googlegroups.com>
	<b91d5073-56c7-4bb2-9ed0-545d75d272ae@googlegroups.com>
Message-ID: <518CC3F4.5050805@rabbitmq.com>

The precise conditions for causing this bug are slightly fiddly to 
explain (it's timing-dependent); but we believe it fixed in last night's 
nightly build - you might want to give that a try:

http://www.rabbitmq.com/nightlies/rabbitmq-server/v3.1.0.40510/

Cheers, Simon

On 10/05/13 10:49, MoonStorm wrote:
> Nah, there is more there than meets the eye. I've got durable expirable
> queues, holding several messages, that don't want to go away. There is
> definitely something screwy there.
>
> On Thursday, May 9, 2013 10:46:07 AM UTC+1, MoonStorm wrote:
>
>
>     Here is a bit more info on the subject. Ran some tests and
>     apparently the queues seem to expire if they've been declared as
>     durable after all the consumers dropped. Apart from my initial
>     report, the setting is also ignored if they've been declared as
>     auto-delete, which sort of makes sense (in this case they get
>     deleted immediately).
>
>     Either way, the admin interface reports the setting as active, and
>     this is a bug when the setting is actually being ignored. Besides,
>     could we have a bit of validation for the settings please? Ignoring
>     them when used in an unsupported context is simply wrong.
>
>     On Tuesday, May 7, 2013 12:24:08 PM UTC+1, MoonStorm wrote:
>
>         Declaring a queue with "x-expires" set to a valid value has no
>         effect after the consumers disconnect. The admin interface
>         reports the queue being idle with no consumers present.
>
>         They used to expire in earlier versions. Are there additional
>         requirements now to achieve the same behavior?
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 10 11:06:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 May 2013 11:06:14 +0100
Subject: [rabbitmq-discuss] About the RabbitMQ Plugin JSONRPC
In-Reply-To: <518C625E.1030103@iii.org.tw>
References: <518C625E.1030103@iii.org.tw>
Message-ID: <518CC696.1070601@rabbitmq.com>

On 10/05/13 03:58, "??? - (david)" wrote:
> Dear All:
>
> How could I change the setting of timeout,
>
> I use the JSONRPC sample  "test.js", try different timeout, but I see
> the /var/log/rabbitmq/rabbit.log
>
> It always shows HTTP Channel started, timeout 5

Hmm. I just edited test.js:16 to change the value of channelTimeout and 
it works.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 10 11:18:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 May 2013 11:18:48 +0100
Subject: [rabbitmq-discuss] Regarding Federation Plugin Configuration
In-Reply-To: <DB14E94115BBC84E8960C12C176D06762BB0802D@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06762BB0802D@MX25A.corp.emc.com>
Message-ID: <518CC988.60605@rabbitmq.com>

On 10/05/13 09:19, Jain, Punit wrote:
> I have configured two brokers in federated mode, and both are running on
> version 2.8.2(I know it?s outdated, but for some reasons I have to stick
> with it). I have configured both in bidirectional mode. You can see the
> configuration for one broker below. I am able to receive messages from
> upstream broker, but when connection between brokers is lost or if I
> close the connection deliberately, the messages are not persisted, i.e.
> the messages sent to upstream broker during that time span are lost, and
> they are not received after reestablishing the connection. How can I
> ensure that the messages are persisted on upstream exchange/queue while
> connection to federated broker is down or not established? Or is it the
> expected behavior? I will really appreciate if you can assist me in
> configuring it properly or provide some workaround.

That's not expected behaviour (unless you set the connection's 'expires' 
and/or 'message_ttl' properties, in which case you get the behaviour you 
asked for).

Look at the upstream broker in mgmt / rabbitmqctl. It should contain 
queues with names like "federation: (exchange) -> (downstream)". 
Messages should back up in these queues while links are down. Do they?

> I tried to find some documentation on federation plugin configuration
> for version 2.8.2, but I couldn?t find anything useful. If you have some
> link or document for federation plugin configuration for version 2.8.2
> or so, please paste it, I will really appreciate it.

http://previous.rabbitmq.com/v2_8_x/federation.html

Technically this is the documentation for 2.8.7, but that's only some 
bug fixes away from 2.8.2.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Fri May 10 11:25:45 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 May 2013 11:25:45 +0100
Subject: [rabbitmq-discuss] stomp adapter behaviour
In-Reply-To: <56CBEC10-B1A0-4BB9-867E-DD7739A0FC3E@open.ch>
References: <56CBEC10-B1A0-4BB9-867E-DD7739A0FC3E@open.ch>
Message-ID: <518CCB29.30600@rabbitmq.com>


Hi Raphael,

On 10/05/13 10:01, Raphael Seebacher wrote:
> SEND
> destination:/queue/tmp
> receipt:2
> 
> hello world, again
> ^@
> 
> ^]
> telnet> quit

I'm not able to reproduce the problem. I get the expected reply
immediately after the second send:

 RECEIPT
 receipt-id:2

Can you replicate the problem with a regular STOMP client?
Can you replicate the problem with "telnet dev.rabbitmq.com 61613"
Is there anything unusual in the broker logfiles?
What does "rabbitmqctl list_queues" return after the failure?
Do you get the same result with STOMP version 1.0 and 1.1?



-Emile





From simon at rabbitmq.com  Fri May 10 11:31:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 May 2013 11:31:39 +0100
Subject: [rabbitmq-discuss] Using a VIP address for Clients Connecting
 to 3.1.0
In-Reply-To: <43a533c3-a517-4fa2-812f-309474e95145@googlegroups.com>
References: <43a533c3-a517-4fa2-812f-309474e95145@googlegroups.com>
Message-ID: <518CCC8B.8020904@rabbitmq.com>

On 09/05/13 23:55, Johnny Costello wrote:
> Hi I am setting up a Rabbit MQ installation for HA. I am using
> clustering  and  active/active mirroring for HA.
>
> My Current Setup is two nodes that are set to mirror each other. I want
> to use a VIP address for my clients to connect to.
>
> I am not clear on how to configure the VIP. To me it appears that prior
> to Active/Active setup you always had to point your clients to the
> Master and then fail over to the slave if the Master fails.

For active/passive mirroring a la http://www.rabbitmq.com/pacemaker.html 
this is true.

> With Active/Active mirroring does this still apply or does it matter
> anymore?

Not really.

> Is there any command that can tell what server is the master anymore? I
> run cluster_status and nothing shows up saying which node is master.

No server is the master in a cluster.

Each individual mirrored queue has a master, but there's no reason to 
believe all the queues will end up with their master on the same node. 
You can determine a queue's master node by looking at something like 
"rabbitmqctl list_queues name pid" or "rabbitmqadmin list queues name node".

But you don't need to have your producers and consumers connect to the 
queue master; the cluster will forward messages internally. You will cut 
down a bit on intra-cluster network traffic though if you connect to the 
master.

> Is there a way to set up your configuration to always mirror queues
> instead of making the change on command line?

You have to use the command line or web UI. But it only needs to be done 
once:

$ rabbitmqctl set_policy ha-all ".*" '{"ha-mode":"all"}'

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Michael.Laing at nytimes.com  Fri May 10 13:29:02 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 10 May 2013 08:29:02 -0400
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host error
 instead of seeking another host
Message-ID: <CDB2604E.9853%Michael.Laing@nytimes.com>

With 3.1.0 our shovel configurations, which worked well in 3.0.4 and prior, now fail due to unknown_host errors.

In these configurations, we put all possible hostnames (usually 6) in the sources / destinations lists. We do this as a convenience because we have automated deployments in AWS EC2 and we don't know ahead of time how many zones in a region will have instances nor exactly which zones ? but we can preallocate ip addresses in the VPC and set up a standard /etc/hosts file with all possible hosts. However there may not actually be an instance running at each IP.

Previously the shovel would always find one of the actual instances, or remain in the 'starting' state.

Now the shovel terminates if a host is not found.

We can smarten up our configuration but that doesn't address the real problem: if a host has failed, we want the shovel to always seek another host and not terminate.

Best regards,

Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/3bc496f6/attachment.htm>

From tim at rabbitmq.com  Fri May 10 13:39:00 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 10 May 2013 13:39:00 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <CDB2604E.9853%Michael.Laing@nytimes.com>
References: <CDB2604E.9853%Michael.Laing@nytimes.com>
Message-ID: <354BF793-B8F5-4E11-8942-78E366963146@rabbitmq.com>

Hi,

On 10 May 2013, at 13:29, Laing, Michael P. wrote:

> Previously the shovel would always find one of the actual instances, or remain in the 'starting' state.
> 
> Now the shovel terminates if a host is not found.
> 
> We can smarten up our configuration but that doesn't address the real problem: if a host has failed, we want the shovel to always seek another host and not terminate.
> 

Can you post your configuration (with scrubbed IP addresses if needed) please? This shouldn't happen, viz the shovel should attempt to reconnect. This could be a recurrence of http://rabbitmq.1065348.n5.nabble.com/Shovels-not-reconnecting-with-RabbitMQ-3-1-0-td26372.html, but I'd like to take a peek at your config and make sure. We've fixed that bug (see the nightly build) and the fix will out in 3.1.1 shortly (ish).

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/67e0d983/attachment.htm>

From Michael.Laing at nytimes.com  Fri May 10 13:56:55 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 10 May 2013 08:56:55 -0400
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
 error instead of seeking another host
In-Reply-To: <354BF793-B8F5-4E11-8942-78E366963146@rabbitmq.com>
Message-ID: <CDB26522.985A%Michael.Laing@nytimes.com>

Here's the config that is failing ? there are a lot of substitution parameters as you can see, but the hostnames are explicit.

[
    {rabbitmq_management,[
        {load_definitions, "/etc/rabbitmq/rabbitmq_defs.json"}
    ]},
    {rabbitmq_shovel, [
        {shovels, [
            {feeds_in, [
                {sources, [
                    {brokers, [
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_a/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_b/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_c/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_d/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_e/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_f/<META:product>.fabrik<META:environment_domain>.nytimes.com"
                    ]},
                    {declarations, [
                        {'queue.declare', [
                            {queue, <<"ha.<FABRIK:info.hostname>-<META:collection>-PULL">>},
                            {arguments, [{<<"x-expires">>, long, 3600000}]}
                        ]},
                        {'queue.bind', [
                            {exchange, <<"<META:collection>">>},
                            {queue, <<"ha.<FABRIK:info.hostname>-<META:collection>-PULL">>},
                            {routing_key, <<"#">>}
                        ]}
                    ]}
                ]},
                {destinations, [
                    {broker, "amqp://<META:amqp_login>:<META:amqp_password>@/<META:product>.fabrik<META:environment_domain>.nytimes.com"}
                ]},
                {queue, <<"ha.<FABRIK:info.hostname>-<META:collection>-PULL">>}
            ]},
            {postoffice_in, [
                {sources, [
                    {brokers, [
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_a/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_b/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_c/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_d/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_e/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_f/<META:product>.fabrik<META:environment_domain>.nytimes.com"
                    ]},
                    {declarations, [
                        {'queue.declare', [
                            {queue, <<"ha.<FABRIK:info.hostname>-postoffice-PULL">>},
                            {arguments, [{<<"x-expires">>, long, 3600000}]}
                        ]},
                        {'queue.bind', [
                            {exchange, <<"postoffice">>},
                            {queue, <<"ha.<FABRIK:info.hostname>-postoffice-PULL">>},
                            {routing_key, <<"*.*.*.*.*.*.<OPTION:region>.<META:product>.*.<AWS:INSTANCE_ID>.*">>}
                        ]}
                    ]}
                ]},
                {destinations, [
                    {broker, "amqp://<META:amqp_login>:<META:amqp_password>@/<META:product>.fabrik<META:environment_domain>.nytimes.com"}
                ]},
                {queue, <<"ha.<FABRIK:info.hostname>-postoffice-PULL">>}
            ]},
            {postoffice_out, [
                {sources, [
                    {broker, "amqp://<META:amqp_login>:<META:amqp_password>@/<META:product>.fabrik<META:environment_domain>.nytimes.com"}
                ]},
                {destinations, [
                    {brokers, [
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_a/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_b/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_c/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_d/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_e/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_f/<META:product>.fabrik<META:environment_domain>.nytimes.com"
                    ]}
                ]},
                {queue, <<"postoffice-PUSH">>}
            ]},
            {messagebus_in, [
                {sources, [
                    {brokers, [
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_a/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_b/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_c/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_d/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_e/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_f/<META:product>.fabrik<META:environment_domain>.nytimes.com"
                    ]},
                    {declarations, [
                        {'queue.declare', [
                            {queue, <<"ha.<FABRIK:info.hostname>-messagebus-PULL">>},
                            {arguments, [{<<"x-expires">>, long, 3600000}]}
                        ]},
                        {'queue.bind', [
                            {exchange, <<"messagebus">>},
                            {queue, <<"ha.<FABRIK:info.hostname>-messagebus-PULL">>},
                            {routing_key, <<"#">>}
                        ]}
                    ]}
                ]},
                {destinations, [
                    {broker, "amqp://<META:amqp_login>:<META:amqp_password>@/<META:product>.fabrik<META:environment_domain>.nytimes.com"}
                ]},
                {queue, <<"ha.<FABRIK:info.hostname>-messagebus-PULL">>}
            ]},
            {messagebus_out, [
                {sources, [
                    {broker, "amqp://<META:amqp_login>:<META:amqp_password>@/<META:product>.fabrik<META:environment_domain>.nytimes.com"}
                ]},
                {destinations, [
                    {brokers, [
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_a/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_b/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_c/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_d/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_e/<META:product>.fabrik<META:environment_domain>.nytimes.com",
                        "amqp://<META:amqp_login>:<META:amqp_password>@fabrik_br_f/<META:product>.fabrik<META:environment_domain>.nytimes.com"
                    ]}
                ]},
                {queue, <<"messagebus-PUSH">>}
            ]}
        ]}
    ]}
].


From: Tim Watson <tim at rabbitmq.com<mailto:tim at rabbitmq.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Friday, May 10, 2013 8:39 AM
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host error instead of seeking another host

Hi,

On 10 May 2013, at 13:29, Laing, Michael P. wrote:

Previously the shovel would always find one of the actual instances, or remain in the 'starting' state.

Now the shovel terminates if a host is not found.

We can smarten up our configuration but that doesn't address the real problem: if a host has failed, we want the shovel to always seek another host and not terminate.


Can you post your configuration (with scrubbed IP addresses if needed) please? This shouldn't happen, viz the shovel should attempt to reconnect. This could be a recurrence of http://rabbitmq.1065348.n5.nabble.com/Shovels-not-reconnecting-with-RabbitMQ-3-1-0-td26372.html, but I'd like to take a peek at your config and make sure. We've fixed that bug (see the nightly build) and the fix will out in 3.1.1 shortly (ish).

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/598fe842/attachment.htm>

From tim at rabbitmq.com  Fri May 10 14:42:40 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 10 May 2013 14:42:40 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <CDB26522.985A%Michael.Laing@nytimes.com>
References: <CDB26522.985A%Michael.Laing@nytimes.com>
Message-ID: <2FF29942-4596-48F1-83BE-7760516A8632@rabbitmq.com>

Hi,

On 10 May 2013, at 13:56, Laing, Michael P. wrote:

> Here's the config that is failing ? there are a lot of substitution parameters as you can see, but the hostnames are explicit.

Right - so this is indeed another instance of the problem reported at http://rabbitmq.1065348.n5.nabble.com/Shovels-not-reconnecting-with-RabbitMQ-3-1-0-td26372.html - because you don't set an explicit reconnect_delay, the shovel workers permanently halt once the first connection attempt fails, instead of restarting (after a slight delay) and trying again. As a temporary fix, you can add in the default reconnect_delay yourself, using {reconnect_delay, 5}. We will, as I said earlier, include the fix (which has already been merged) in the next service release.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/e6a0382e/attachment.htm>

From simon at rabbitmq.com  Fri May 10 14:51:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 May 2013 14:51:10 +0100
Subject: [rabbitmq-discuss] Guidance on Understanding API Output for
	Monitoring
In-Reply-To: <CAO=6ox_Yiisk18BeNHs6qO2aVxDow12XjJpAGiDmw5DSVAvi7g@mail.gmail.com>
References: <CAO=6ox_Yiisk18BeNHs6qO2aVxDow12XjJpAGiDmw5DSVAvi7g@mail.gmail.com>
Message-ID: <518CFB4E.20400@rabbitmq.com>

Sorry, there isn't any documentation yet.

It would help me to write some if you told me what information you were 
looking for.

Cheers, Simon

On 09/05/13 17:58, Richard Raseley wrote:
> I have attached a JSON document that is the output of the following
> query against my RabbitMQ cluster:
>
> http://cluster-vip:15672/api/exchanges/?sort=name
>
> I was hoping that someone could point me towards some documentation that
> would help me better understand what info surrounding the message stats,
> publishing rates, etc. so that I might use them in monitoring the health
> and throughput of the system.
>
> This information doesn't seem to be in the official API document and I
> was unable to turn up any other authoritative source.
>
> Regards,
>
> Richard
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From maria.garcia.aguirregomez at gmail.com  Fri May 10 13:32:12 2013
From: maria.garcia.aguirregomez at gmail.com (Maria Garcia)
Date: Fri, 10 May 2013 05:32:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem with rabbimq-server 3.1.0 and
	rabbitmq_web_stomp_examples
Message-ID: <2e0bc0a5-d5cf-4398-aa7b-21fb3e11af08@googlegroups.com>

Hi, 

I installed my rabbitmq-server without problems. I can enable or disable 
some pluglins, but when I enable rabbitmq_web_stomp_examples, I can restart 
my rabbitmq. When I try to restart, says fail. 

The logs files: 

*startup_log*

BOOT FAILED
===========

Error description:
   {error,{"no such file or directory","rabbitmq_mochiweb.app"}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at C.log
   /var/log/rabbitmq/rabbit at C-sasl.log

Stack trace:
   [{app_utils,load_applications,2,[]},
    {app_utils,load_applications,1,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[]},
    {init,start_em,1,[]}]

{"init terminating in do_boot",{rabbit,failure_during_boot,{error,{"no such 
file or directory","rabbitmq_mochiweb.app"}}}}


*startup_err*

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

Any idea?

Thanks very much.

Maria.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/5d0d78d5/attachment.htm>

From simon at rabbitmq.com  Fri May 10 15:18:29 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 May 2013 15:18:29 +0100
Subject: [rabbitmq-discuss] Problem with rabbimq-server 3.1.0 and
	rabbitmq_web_stomp_examples
In-Reply-To: <2e0bc0a5-d5cf-4398-aa7b-21fb3e11af08@googlegroups.com>
References: <2e0bc0a5-d5cf-4398-aa7b-21fb3e11af08@googlegroups.com>
Message-ID: <518D01B5.8080601@rabbitmq.com>

Hmm. rabbitmq_mochiweb is the old name for rabbitmq_web_dispatch - but 
all references to it are gone from 3.1.0.

How did you install 3.1.0? Do you have any self-compiled plugins around?

Cheers, Simon

On 10/05/13 13:32, Maria Garcia wrote:
> Hi,
>
> I installed my rabbitmq-server without problems. I can enable or disable
> some pluglins, but when I enable rabbitmq_web_stomp_examples, I can
> restart my rabbitmq. When I try to restart, says fail.
>
> The logs files:
>
> *startup_log*
>
> BOOT FAILED
> ===========
>
> Error description:
>     {error,{"no such file or directory","rabbitmq_mochiweb.app"}}
>
> Log files (may contain more information):
>     /var/log/rabbitmq/rabbit at C.log
>     /var/log/rabbitmq/rabbit at C-sasl.log
>
> Stack trace:
>     [{app_utils,load_applications,2,[]},
>      {app_utils,load_applications,1,[]},
>      {rabbit,'-boot/0-fun-1-',0,[]},
>      {rabbit,start_it,1,[]},
>      {init,start_it,1,[]},
>      {init,start_em,1,[]}]
>
> {"init terminating in do_boot",{rabbit,failure_during_boot,{error,{"no
> such file or directory","rabbitmq_mochiweb.app"}}}}
>
>
> *startup_err*
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
>
> Any idea?
>
> Thanks very much.
>
> Maria.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From moonstorm at gmail.com  Fri May 10 16:09:23 2013
From: moonstorm at gmail.com (MoonStorm)
Date: Fri, 10 May 2013 08:09:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Queues no longer expire in RabbitMq 3.1.0
In-Reply-To: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>
References: <fc085334-1ff3-4987-a8c4-3d1da1c04817@googlegroups.com>
Message-ID: <3be3fbfc-a465-4956-b12c-ee48ca1709bd@googlegroups.com>

As advised, I've just tested this in the nightly build 3.1.0.40510 on my 
OpenSuse box and the bug seems to be fixed. Thanks a lot guys.

On Tuesday, May 7, 2013 12:24:08 PM UTC+1, MoonStorm wrote:
>
> Declaring a queue with "x-expires" set to a valid value has no effect 
> after the consumers disconnect. The admin interface reports the queue being 
> idle with no consumers present.
>
> They used to expire in earlier versions. Are there additional requirements 
> now to achieve the same behavior?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/8790b468/attachment.htm>

From jkuch at gopivotal.com  Fri May 10 18:52:36 2013
From: jkuch at gopivotal.com (Gerald Kuch)
Date: Fri, 10 May 2013 10:52:36 -0700
Subject: [rabbitmq-discuss] Cannot start rabbitmq
In-Reply-To: <CAMcAHLW-J_KO8pFce1iAA+wuRxBtFubfiO6fE0v27guapsL19Q@mail.gmail.com>
References: <7b9c2edb-ebed-4d42-8144-63a623e6cb5a@googlegroups.com>
	<CAMcAHLW-J_KO8pFce1iAA+wuRxBtFubfiO6fE0v27guapsL19Q@mail.gmail.com>
Message-ID: <CANOx8NkT81Bj_SW=h0RvLrXpqE=iJEsGRouE7ypHH-T5++_8AA@mail.gmail.com>

And where did you OS X install fo Erlang come from?  Homebrew?  Ports?
 Built from source?  Something else?

Jerry

On Fri, May 10, 2013 at 1:29 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> What specific package are you using?
>
>
> On Fri, May 10, 2013 at 3:17 AM, Dave Chen <dave.chen80 at gmail.com> wrote:
>
>> Hi,
>>
>> I installed Rabbit OSX version of 3.1.0 and I am getting the following
>> error when starting up the server:
>>
>> $ ./rabbitmq-server
>> usage: dirname path
>> ./../erts-5.10.1/bin/erl: line 29: /../../erts-5.10.1/bin/erlexec: No
>> such file or directory
>> ./../erts-5.10.1/bin/erl: line 29: exec: /../../erts-5.10.1/bin/erlexec:
>> cannot execute: No such file or directory
>>
>> Anyone know how to fix it?
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/b4a2e3b6/attachment.htm>

From latorion at poczta.fm  Fri May 10 21:59:53 2013
From: latorion at poczta.fm (Artur Milewski)
Date: Fri, 10 May 2013 22:59:53 +0200
Subject: [rabbitmq-discuss] Problem running generic unix on FreeBSD
Message-ID: <jahfislzkclbdcovmidv@czbr>


Hi,
I have problem running generic unix version(3.1.0) on FreeBSD. By looking at the output I still don't get why it don't work. Thanks for any help. I have added as attachments output and dump. Thanks for any help
Best regards
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: erl_crash.dump
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/7f97342f/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/7f97342f/attachment.asc>

From videlalvaro at gmail.com  Fri May 10 22:09:28 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 10 May 2013 23:09:28 +0200
Subject: [rabbitmq-discuss] Problem running generic unix on FreeBSD
In-Reply-To: <jahfislzkclbdcovmidv@czbr>
References: <jahfislzkclbdcovmidv@czbr>
Message-ID: <CAMcAHLU5cAGnO_2g9Vmjb6BD0i=8mn1hUvTEsg73teMM8y7f2Q@mail.gmail.com>

Maybe you are running another version of rabbitmq on your machine? Try
running ps ax | grep rabbit and see the output.


On Fri, May 10, 2013 at 10:59 PM, Artur Milewski <latorion at poczta.fm> wrote:

>
> Hi,
> I have problem running generic unix version(3.1.0) on FreeBSD. By looking
> at the output I still don't get why it don't work. Thanks for any help. I
> have added as attachments output and dump. Thanks for any help
> Best regards
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130510/b267b6b3/attachment.htm>

From latorion at poczta.fm  Sat May 11 08:00:13 2013
From: latorion at poczta.fm (Artur Milewski)
Date: Sat, 11 May 2013 09:00:13 +0200
Subject: [rabbitmq-discuss] Problem running generic unix on FreeBSD
In-Reply-To: <CAMcAHLU5cAGnO_2g9Vmjb6BD0i=8mn1hUvTEsg73teMM8y7f2Q@mail.gmail.com>
References: <jahfislzkclbdcovmidv@czbr>
	<CAMcAHLU5cAGnO_2g9Vmjb6BD0i=8mn1hUvTEsg73teMM8y7f2Q@mail.gmail.com>
Message-ID: <ijmaxtcbngprmgwuicol@dmoe>

No I checked and there are no other instances running.Od: "Alvaro Videla" &lt;videlalvaro at gmail.com&gt;Do: "Discussions about RabbitMQ" &lt;rabbitmq-discuss at lists.rabbitmq.com&gt;; Wys?ane: 23:12 Pi?tek 2013-05-10Temat: Re: [rabbitmq-discuss] Problem running generic unix on FreeBSDMaybe you are running another version of rabbitmq on your machine? Try running ps ax | grep rabbit and see the output.On Fri, May 10, 2013 at 10:59 PM, Artur Milewski &lt;latorion at poczta.fm&gt; wrote:
Hi,
I have problem running generic unix version(3.1.0) on FreeBSD. By looking at the output I still don't get why it don't work. Thanks for any help. I have added as attachments output and dump. Thanks for any help

Best regards_______________________________________________
rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130511/05e2031d/attachment.htm>

From mtlotfizad at gmail.com  Sat May 11 08:36:19 2013
From: mtlotfizad at gmail.com (Mohsen Lotfizad)
Date: Sat, 11 May 2013 12:06:19 +0430
Subject: [rabbitmq-discuss] does client caches messages?
Message-ID: <CAJzgYrD05hw-oFJO3sQrwgdbqatT5zjYYHZT9j527aksmdAkug@mail.gmail.com>

> Message: 20
> Date: Wed, 8 May 2013 10:26:10 +0100
> From: Tim Watson <tim at rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] does client caches messages?
> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID: <1746F344-A2D6-4DCE-9328-36EEA5379374 at rabbitmq.com>
> Content-Type: text/plain; charset="iso-8859-1"
>
> Hi,
>
> On 8 May 2013, at 09:33, Mohsen Lotfizad wrote:
>
> > I have a subscriber that consumes from server but doesn't ACK
> immediately because message processing involves database operation. If
> database operations goes well, then ACK will be sent, otherwise message
> save in db and then ACK will send.
> >
>
> That sounds fine.
>


Hi,
In fact I just want to know when I set prefetch_cont=2, why my consumer try
to give about 700 messages?
I attached a copy of RabbitMQ Management here:

Channels

Details Channel Virtual host User name Mode (?) Prefetch Unacked Unconfirmed
Status 127.0.0.1:56137
(2)<http://127.0.0.1:15672/#/channels/127.0.0.1%3A56137%20-%3E%20127.0.0.1%3A5672%20(2)>/guest
2 700 0 Idle 127.0.0.1:56137
(3)<http://127.0.0.1:15672/#/channels/127.0.0.1%3A56137%20-%3E%20127.0.0.1%3A5672%20(3)>/guest
2 302 0 Idle
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130511/d7f840b8/attachment.htm>

From matthias at rabbitmq.com  Sat May 11 08:44:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 11 May 2013 08:44:44 +0100
Subject: [rabbitmq-discuss] does client caches messages?
In-Reply-To: <CAJzgYrD05hw-oFJO3sQrwgdbqatT5zjYYHZT9j527aksmdAkug@mail.gmail.com>
References: <CAJzgYrD05hw-oFJO3sQrwgdbqatT5zjYYHZT9j527aksmdAkug@mail.gmail.com>
Message-ID: <518DF6EC.3060300@rabbitmq.com>

On 11/05/13 08:36, Mohsen Lotfizad wrote:
> In fact I just want to know when I set prefetch_cont=2, why my consumer
> try to give about 700 messages?

How is your consumer consuming messages? With basic.consume or 
basic.get? Prefetch does not apply to the latter since the client is 
explicitly asking for the next message.

Matthias.

From Michael.Laing at nytimes.com  Sat May 11 12:41:09 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 11 May 2013 07:41:09 -0400
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
 error instead of seeking another host
In-Reply-To: <2FF29942-4596-48F1-83BE-7760516A8632@rabbitmq.com>
Message-ID: <CDB3A384.98D6%Michael.Laing@nytimes.com>

That temporary fix does not work. This is a different bug.

With the 'fix' it gives a bad_host error instead of unknown_host.

So we have updated our config generation to only provide the correct hosts.

However, this still means that the previously rugged and reliable shovel is less so.

ml

From: Tim Watson <tim at rabbitmq.com<mailto:tim at rabbitmq.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Friday, May 10, 2013 9:42 AM
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host error instead of seeking another host

Hi,

On 10 May 2013, at 13:56, Laing, Michael P. wrote:

Here's the config that is failing ? there are a lot of substitution parameters as you can see, but the hostnames are explicit.

Right - so this is indeed another instance of the problem reported at http://rabbitmq.1065348.n5.nabble.com/Shovels-not-reconnecting-with-RabbitMQ-3-1-0-td26372.html - because you don't set an explicit reconnect_delay, the shovel workers permanently halt once the first connection attempt fails, instead of restarting (after a slight delay) and trying again. As a temporary fix, you can add in the default reconnect_delay yourself, using {reconnect_delay, 5}. We will, as I said earlier, include the fix (which has already been merged) in the next service release.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130511/0bdc391f/attachment.htm>

From mtlotfizad at gmail.com  Sat May 11 12:42:30 2013
From: mtlotfizad at gmail.com (Mohsen Lotfizad)
Date: Sat, 11 May 2013 16:12:30 +0430
Subject: [rabbitmq-discuss] does client caches messages?
In-Reply-To: <518DF6EC.3060300@rabbitmq.com>
References: <CAJzgYrD05hw-oFJO3sQrwgdbqatT5zjYYHZT9j527aksmdAkug@mail.gmail.com>
	<518DF6EC.3060300@rabbitmq.com>
Message-ID: <CAJzgYrBtONTyyOxBCowgt4aZYO1T1zKQGzMcCDwE1No5NiEqBA@mail.gmail.com>

I download the Recv.java<http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/java/Recv.java>
and change some of its code to this:

*        ConnectionFactory factory = new ConnectionFactory();
         //factory.setHost("localhost");
        factory.setUri("amqp://guest:guest at 127.0.0.1:5672");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        channel.queueDeclarePassive(QUEUE_NAME);
        System.out.println(" [*] Waiting for messages. To exit press
CTRL+C");

        QueueingConsumer consumer = new QueueingConsumer(channel);
        channel.basicConsume(QUEUE_NAME, false, consumer);
        channel.basicQos(1);

**
*

On Sat, May 11, 2013 at 12:14 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 11/05/13 08:36, Mohsen Lotfizad wrote:
>
>> In fact I just want to know when I set prefetch_cont=2, why my consumer
>> try to give about 700 messages?
>>
>
> How is your consumer consuming messages? With basic.consume or basic.get?
> Prefetch does not apply to the latter since the client is explicitly asking
> for the next message.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130511/1cdf11d1/attachment.htm>

From matthias at rabbitmq.com  Sat May 11 14:51:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 11 May 2013 14:51:23 +0100
Subject: [rabbitmq-discuss] does client caches messages?
In-Reply-To: <CAJzgYrBtONTyyOxBCowgt4aZYO1T1zKQGzMcCDwE1No5NiEqBA@mail.gmail.com>
References: <CAJzgYrD05hw-oFJO3sQrwgdbqatT5zjYYHZT9j527aksmdAkug@mail.gmail.com>
	<518DF6EC.3060300@rabbitmq.com>
	<CAJzgYrBtONTyyOxBCowgt4aZYO1T1zKQGzMcCDwE1No5NiEqBA@mail.gmail.com>
Message-ID: <518E4CDB.7090106@rabbitmq.com>

On 11/05/13 12:42, Mohsen Lotfizad wrote:
>          channel.basicConsume(QUEUE_NAME, false, consumer);
>          channel.basicQos(1);

There's your problem.

As soon as the consumer is created, RabbitMQ will start delivering 
messages to it. By the time the prefetch is set, many messages may 
already be on their way to the client.

You should set the prefetch *before* consuming.

Matthias.

From watson.timothy at gmail.com  Sat May 11 15:35:06 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 11 May 2013 15:35:06 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <CDB3A384.98D6%Michael.Laing@nytimes.com>
References: <CDB3A384.98D6%Michael.Laing@nytimes.com>
Message-ID: <C92563A2-C961-445D-BE64-FD443BEBE7CD@rabbitmq.com>

Hi Michael,

On 11 May 2013, at 12:41, "Laing, Michael P." <Michael.Laing at nytimes.com> wrote:

> That temporary fix does not work. This is a different bug.
> 
> With the 'fix' it gives a bad_host error instead of unknown_host.
> 

You're saying that the error changes *and* the shovel worker terminates without trying to reconnect to another host?

From Michael.Laing at nytimes.com  Sat May 11 15:38:38 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 11 May 2013 10:38:38 -0400
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
 error instead of seeking another host
In-Reply-To: <C92563A2-C961-445D-BE64-FD443BEBE7CD@rabbitmq.com>
Message-ID: <CDB3D024.98F7%Michael.Laing@nytimes.com>

correct

On 5/11/13 10:35 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:

>Hi Michael,
>
>On 11 May 2013, at 12:41, "Laing, Michael P." <Michael.Laing at nytimes.com>
>wrote:
>
>> That temporary fix does not work. This is a different bug.
>> 
>> With the 'fix' it gives a bad_host error instead of unknown_host.
>> 
>
>You're saying that the error changes *and* the shovel worker terminates
>without trying to reconnect to another host?
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From watson.timothy at gmail.com  Sat May 11 16:06:33 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 11 May 2013 16:06:33 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <CDB3D024.98F7%Michael.Laing@nytimes.com>
References: <CDB3D024.98F7%Michael.Laing@nytimes.com>
Message-ID: <E90C67CA-B02C-4560-84A0-FD02C7F98ADF@rabbitmq.com>

Right, well that's another matter altogether. Once a reconnect delay is properly set, the worker should keep trying to restart (and in the process, choose a different random URL). Can you confirm how/where you set the reconnect delay please, and also what your shovel config looks like once all the substitution is done - you can replace all the IP digits with x using sed or somesuch.

This is top of my personal list to fix for 3.1.1 right now.

Cheers,
Tim

On 11 May 2013, at 15:38, "Laing, Michael P." <Michael.Laing at nytimes.com> wrote:

> correct
> 
> On 5/11/13 10:35 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:
> 
>> Hi Michael,
>> 
>> On 11 May 2013, at 12:41, "Laing, Michael P." <Michael.Laing at nytimes.com>
>> wrote:
>> 
>>> That temporary fix does not work. This is a different bug.
>>> 
>>> With the 'fix' it gives a bad_host error instead of unknown_host.
>>> 
>> 
>> You're saying that the error changes *and* the shovel worker terminates
>> without trying to reconnect to another host?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jurenovic at gmail.com  Sat May 11 13:08:20 2013
From: jurenovic at gmail.com (=?UTF-8?Q?Jure_Novi=C4=8D?=)
Date: Sat, 11 May 2013 05:08:20 -0700 (PDT)
Subject: [rabbitmq-discuss] persistent connections on rabbitmq-server when
 android client losses internet connection
Message-ID: <3824e27a-ccc4-4c73-8a0b-d0a9e111433c@googlegroups.com>

Hello

I have a question about about connections to server from java client. I'm 
developing a Android application using rabbitmq-java-client library. I 
followed the tutorials on the rabbitmq website, so I created a 
ConnectionFactory with my own ip address (without any timeout or 
heartbeat), then called newConnection(). Everything works fine, sending and 
receiving.

The problem arrises when I turn off network connection on an android 
device, the connection on rabbitmq-server is still there (for long time). 
If I want to achieve that the server clear my connection I have to use 
heartbeat. I also tried to create new *ConnectionFactory* class and 
override *configureSocket* and call socket.setKeepAlive(true). That neither 
helped. 

My colleague is developing an iOS application, and another one is 
developing an erlang client. They don't have this problem, if they kill the 
app or turn of network connection, the connections on rabbitmq-server are 
cleared immediately (2-4s). *They are not using any timeouts or heartbeats*.

And just another thing, on RabbitMQ Management webpage, under connections 
tab I noticed that my java client has a timeout value of 600s (when not 
setting heartbeat), when C-client or Erlang client doesn't have any value 
(blank) under timeout column. 

Hope anyone can help me.

Best,
Jure
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130511/9f04c6c2/attachment.htm>

From Michael.Laing at nytimes.com  Sat May 11 16:23:10 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 11 May 2013 11:23:10 -0400
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
 error instead of seeking another host
In-Reply-To: <E90C67CA-B02C-4560-84A0-FD02C7F98ADF@rabbitmq.com>
Message-ID: <CDB3D93E.9902%Michael.Laing@nytimes.com>

I'll get back to you as soon as I can but my human team is down for the
weekend.

So there may be some delay.

Best,
Michael

On 5/11/13 11:06 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:

>Right, well that's another matter altogether. Once a reconnect delay is
>properly set, the worker should keep trying to restart (and in the
>process, choose a different random URL). Can you confirm how/where you
>set the reconnect delay please, and also what your shovel config looks
>like once all the substitution is done - you can replace all the IP
>digits with x using sed or somesuch.
>
>This is top of my personal list to fix for 3.1.1 right now.
>
>Cheers,
>Tim
>
>On 11 May 2013, at 15:38, "Laing, Michael P." <Michael.Laing at nytimes.com>
>wrote:
>
>> correct
>> 
>> On 5/11/13 10:35 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:
>> 
>>> Hi Michael,
>>> 
>>> On 11 May 2013, at 12:41, "Laing, Michael P."
>>><Michael.Laing at nytimes.com>
>>> wrote:
>>> 
>>>> That temporary fix does not work. This is a different bug.
>>>> 
>>>> With the 'fix' it gives a bad_host error instead of unknown_host.
>>>> 
>>> 
>>> You're saying that the error changes *and* the shovel worker terminates
>>> without trying to reconnect to another host?
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From watson.timothy at gmail.com  Sat May 11 16:43:25 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 11 May 2013 16:43:25 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <CDB3D93E.9902%Michael.Laing@nytimes.com>
References: <CDB3D93E.9902%Michael.Laing@nytimes.com>
Message-ID: <DC755AE3-9B55-44AB-A361-C802ABE5C15E@rabbitmq.com>

Sure that's fine, I'll look into it properly on Monday anyway.

Cheers,
Tim

On 11 May 2013, at 16:23, "Laing, Michael P." <Michael.Laing at nytimes.com> wrote:

> I'll get back to you as soon as I can but my human team is down for the
> weekend.
> 
> So there may be some delay.
> 
> Best,
> Michael
> 
> On 5/11/13 11:06 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:
> 
>> Right, well that's another matter altogether. Once a reconnect delay is
>> properly set, the worker should keep trying to restart (and in the
>> process, choose a different random URL). Can you confirm how/where you
>> set the reconnect delay please, and also what your shovel config looks
>> like once all the substitution is done - you can replace all the IP
>> digits with x using sed or somesuch.
>> 
>> This is top of my personal list to fix for 3.1.1 right now.
>> 
>> Cheers,
>> Tim
>> 
>> On 11 May 2013, at 15:38, "Laing, Michael P." <Michael.Laing at nytimes.com>
>> wrote:
>> 
>>> correct
>>> 
>>> On 5/11/13 10:35 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:
>>> 
>>>> Hi Michael,
>>>> 
>>>> On 11 May 2013, at 12:41, "Laing, Michael P."
>>>> <Michael.Laing at nytimes.com>
>>>> wrote:
>>>> 
>>>>> That temporary fix does not work. This is a different bug.
>>>>> 
>>>>> With the 'fix' it gives a bad_host error instead of unknown_host.
>>>>> 
>>>> 
>>>> You're saying that the error changes *and* the shovel worker terminates
>>>> without trying to reconnect to another host?
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Punit.Jain at emc.com  Sat May 11 19:50:05 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Sat, 11 May 2013 14:50:05 -0400
Subject: [rabbitmq-discuss] Regarding Federation Plugin Configuration
In-Reply-To: <518CC988.60605@rabbitmq.com>
References: <DB14E94115BBC84E8960C12C176D06762BB0802D@MX25A.corp.emc.com>
	<518CC988.60605@rabbitmq.com>
Message-ID: <DB14E94115BBC84E8960C12C176D06762BB08061@MX25A.corp.emc.com>

Thanks Simon for prompt response and for the link. I verified the configuration according to my requirements, but messages are not being backed-up in upstream queue. Properties like expires and message_ttl are set to default. I couldn't figure out any plausible reason for this. Could it be related to exchange/queue publishing properties on upstream broker?

Thanks,
Punit

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Friday, May 10, 2013 3:49 PM
To: Discussions about RabbitMQ
Cc: Jain, Punit
Subject: Re: [rabbitmq-discuss] Regarding Federation Plugin Configuration

On 10/05/13 09:19, Jain, Punit wrote:
> I have configured two brokers in federated mode, and both are running 
> on version 2.8.2(I know it's outdated, but for some reasons I have to 
> stick with it). I have configured both in bidirectional mode. You can 
> see the configuration for one broker below. I am able to receive 
> messages from upstream broker, but when connection between brokers is 
> lost or if I close the connection deliberately, the messages are not persisted, i.e.
> the messages sent to upstream broker during that time span are lost, 
> and they are not received after reestablishing the connection. How can 
> I ensure that the messages are persisted on upstream exchange/queue 
> while connection to federated broker is down or not established? Or is 
> it the expected behavior? I will really appreciate if you can assist 
> me in configuring it properly or provide some workaround.

That's not expected behaviour (unless you set the connection's 'expires' 
and/or 'message_ttl' properties, in which case you get the behaviour you asked for).

Look at the upstream broker in mgmt / rabbitmqctl. It should contain queues with names like "federation: (exchange) -> (downstream)". 
Messages should back up in these queues while links are down. Do they?

> I tried to find some documentation on federation plugin configuration 
> for version 2.8.2, but I couldn't find anything useful. If you have 
> some link or document for federation plugin configuration for version 
> 2.8.2 or so, please paste it, I will really appreciate it.

http://previous.rabbitmq.com/v2_8_x/federation.html

Technically this is the documentation for 2.8.7, but that's only some bug fixes away from 2.8.2.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal


From nathan at nkbrown.us  Sat May 11 21:40:04 2013
From: nathan at nkbrown.us (Nathan Brown)
Date: Sat, 11 May 2013 13:40:04 -0700
Subject: [rabbitmq-discuss] Porting .NET client to WinRT API (Windows 8).
In-Reply-To: <518CC1C5.1060008@rabbitmq.com>
References: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>
	<518CC1C5.1060008@rabbitmq.com>
Message-ID: <CAFCmQSofOfwN5B2rdRsALXYfcv-EvcUOYBGorY7xZNyBjBhp9w@mail.gmail.com>

Hi Emile (and others),

I have the Windows 8 Modern UI (Windows Store) implementation basically
working.  I'm trying to polish up a sample project.

The thing with the Windows.Networking.Sockets is that it breaks
compatibility with every version of Windows before Windows 8 and Server
2012.  So support will have to swap in code as needed and compile separate
DLLs.  The SSL implementation is so different, that I'm not even sure if
there is the equivalent of having the application handle or know about its
certificates.  I'm also not familiar with setting up and testing SSL in
RabbitMQ.

The Generic changes should all work on Mono, so all of that can be shared.
 I do wonder if we want to move completely away from IDictionary to
IDictionary<string, object>.  Specifically look at the
WireFormatting.WriteTable() and MethodArgumentWriter.WriteTable() methods.
 With my current method of having both overloads, callers need to cast to
the specific interface they are using because the concrete Dictionary<,>
implements both.

Currently, I have the Windows Store project working with sharing most files
and having copies of some files. Since not many lines change compared to
the size of the files, it might be beneficial to use #if NETFX_CORE in the
main files and share everything.  What do you think?  The files that were
copied and not currently shared are:

"..\RabbitMQ.Client\src\util\**\XmlUtil.cs;..\RabbitMQ.Client\src\client\**\ConnectionFactory.cs;..\RabbitMQ.Client\src\client\**\ConnectionBase.cs;..\RabbitMQ.Client\src\client\**\Frame.cs;..\RabbitMQ.Client\src\client\**\SessionManager.cs;..\RabbitMQ.Client\src\client\**\SocketFrame*.cs;..\RabbitMQ.Client\src\client\**\SslHelper.cs;..\RabbitMQ.Client\src\client\**\SslOption.cs;..\RabbitMQ.Client\src\client\**\Protocols.cs"

Another area that was different was getting environment variables.  Windows
Store Apps don't have access to ConfigurationSettings,
ConfigurationManager, or Environment.GetEnvironmentVariable but instead
uses Windows.Storage.ApplicationData.  I'm not sure if it's a good idea to
have the library try to access those values (primarily the AMQP_PROTOCOL)
or just make it clear they have to be pragmatically set.  I don't think
there's an example of the protocol being pragmatically set though.

Having the library use Windows.Storage.ApplicationData keeps it from
running on the desktop because there is no Application Identity.  It also
keeps some of the tests from being runnable on NUnit.  Any thoughts on this?

Thanks,

Nathan Brown


On Fri, May 10, 2013 at 2:45 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Nathan,
>
> On 07/05/13 17:34, Nathan Brown wrote:
> > Can you guys review these changes and consider incorporating them into
> > the mainline codebase?
>
> Yes, and thanks! We'd like to make use of your contribution, but it will
> take a while to review. May I request that you sign a contributor
> agreement in the meantime? I'll contact you off-list.
>
> > The networking area is another area of change in WinRT.  It will have to
> > involve a separate project because System.Net.Sockets has been removed
> > and Windows.Networking.Sockets has been added.  I am still working on
> > porting the networking code to the WinRT API, but that will hit far
> > fewer files than the non-generic to generic collection conversion.
>
> Yes, Socket and SSL-related functionality is more localised.
>
> We would be reluctant to relinquish the compatibility of the current
> .net client with mono. I'm not sure whether that is necessarily the
> implication, but it might be something to consider.
>
>
>
>
> -Emile
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130511/9f8581d0/attachment.htm>

From michael.s.klishin at gmail.com  Sat May 11 22:05:39 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 12 May 2013 01:05:39 +0400
Subject: [rabbitmq-discuss] Porting .NET client to WinRT API (Windows 8).
In-Reply-To: <CAFCmQSofOfwN5B2rdRsALXYfcv-EvcUOYBGorY7xZNyBjBhp9w@mail.gmail.com>
References: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>
	<518CC1C5.1060008@rabbitmq.com>
	<CAFCmQSofOfwN5B2rdRsALXYfcv-EvcUOYBGorY7xZNyBjBhp9w@mail.gmail.com>
Message-ID: <CAE3HoVSsz-XAxjKqv4SPmzMm70fb5jenc305jUvWFy6GL4z1dA@mail.gmail.com>

2013/5/12 Nathan Brown <nathan at nkbrown.us>

>  I'm also not familiar with setting up and testing SSL in RabbitMQ.


Take a look at http://rabbitmq.com/ssl.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130512/c3a05925/attachment.htm>

From newsjimi at gmail.com  Sun May 12 16:16:30 2013
From: newsjimi at gmail.com (Jimi Riblei)
Date: Sun, 12 May 2013 15:16:30 +0000
Subject: [rabbitmq-discuss] WCF bind error VS 2010
Message-ID: <CAO6pa4QXqhKxTByiC9i5epo6YAvwzPjSdUfKkDMta-dWjTCi8g@mail.gmail.com>

Hello,
I'm trying to bind RabbtiMQ to WCF service library without success.
I have tried with :

"
To add a RabbitMQ binding to an existing (or new)
configuration file, open the service configuration
editor8
and expand the Advanced > Extensions >
binding extensions node. Click the ?new? button and
select the RabbitMQBindingSection type from the
RabbitMQ.ServiceModel.dll assembly. "

But when I choose  the DLL I get this error:
Could not load file or assembly file '' or one of its dependences.
Operation is not supported

My environment :
Windows 7
Visual studio 2010
Framework 4

Thank you!
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130512/ac4c24f4/attachment.htm>

From dev440 at gmail.com  Mon May 13 08:46:31 2013
From: dev440 at gmail.com (chetan dev)
Date: Mon, 13 May 2013 13:16:31 +0530
Subject: [rabbitmq-discuss] Queue Memory keep on increasing
Message-ID: <CAB0ZxM78ga8xEc9f8Qp8DfE5y_H4dh4n441xTMKi5QTA=GEXvQ@mail.gmail.com>

Hi,

I have a durable mirrored queue on two nodes .
initially when publishing and consumer activity started queue memory was
around 50 kB, now it is increasing day by day .currently it is around 3.9 MB

Can you help me to know causes of this and how can i control it?

pfa of management screen snapshot

Thanks

-- 
Cheten  Dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/e9e8202a/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rqmemory.png
Type: image/png
Size: 12873 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/e9e8202a/attachment.png>

From emile at rabbitmq.com  Mon May 13 09:32:55 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 13 May 2013 09:32:55 +0100
Subject: [rabbitmq-discuss] Problem running generic unix on FreeBSD
In-Reply-To: <jahfislzkclbdcovmidv@czbr>
References: <jahfislzkclbdcovmidv@czbr>
Message-ID: <5190A537.9030805@rabbitmq.com>


Hi

On 10/05/13 21:59, Artur Milewski wrote:
> badmatch,{error,econnrefused}},[{inet_tcp_dist,listen

Make sure the broker account has permission to listen on the default
interface and that the hostname is set up correctly. If permissions
cannot be granted then set the inet_dist_use_interface Erlang kernel
parameter: http://erlang.org/doc/man/kernel_app.html



-Emile



From rse at open.ch  Mon May 13 09:34:59 2013
From: rse at open.ch (Raphael Seebacher)
Date: Mon, 13 May 2013 10:34:59 +0200
Subject: [rabbitmq-discuss] stomp adapter behaviour
In-Reply-To: <518CCB29.30600@rabbitmq.com>
References: <56CBEC10-B1A0-4BB9-867E-DD7739A0FC3E@open.ch>
	<518CCB29.30600@rabbitmq.com>
Message-ID: <ADC39F45-3525-465D-B7A5-4D2AFF887928@open.ch>

Hi Emile

> Is there anything unusual in the broker logfiles?
Yes there was: A 'disk resource limit alarm' had been set and I was stupid enough to think it would not be related to my problem. Anyway, setting RABBITMQ_MNESIA_BASE to reside on some larger disk solved the problem.

Thanks a lot for your help.
-Raphael

From simon at rabbitmq.com  Mon May 13 10:25:37 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 May 2013 10:25:37 +0100
Subject: [rabbitmq-discuss] Regarding Federation Plugin Configuration
In-Reply-To: <DB14E94115BBC84E8960C12C176D06762BB08061@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06762BB0802D@MX25A.corp.emc.com>
	<518CC988.60605@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D06762BB08061@MX25A.corp.emc.com>
Message-ID: <5190B191.2070206@rabbitmq.com>

On 11/05/2013 19:50, Jain, Punit wrote:
> Thanks Simon for prompt response and for the link. I verified the
> configuration according to my requirements, but messages are not
> being backed-up in upstream queue. Properties like expires and
> message_ttl are set to default. I couldn't figure out any plausible
> reason for this. Could it be related to exchange/queue publishing
> properties on upstream broker?

I don't think so. On a more modern RabbitMQ you could publish with low 
per-message TTL, but 2.8.2 does not support that.

My expectation is still that you are doing something weird; keeping 
messages while the link is down is a fundamental property of federation; 
if it were broken in any release I would expect to have heard about it 
by now.

So to debug this, let's look at how it's meant to work:

The downstream broker declares the upstream queue named "federation 
(exchange) -> (node)" the first time the link goes up. This queue is 
durable and is not deleted at an point. The downstream broker then binds 
this queue to the upstream exchange (via an intermediate exchange) 
whenever a binding is declared downstream.

When a link is up, the messages from the upstream exchange are routed to 
this queue and consumed immediately by the downstream broker. When a 
link goes down the consuming stops but the bindings still exist, so 
messages back up in the queue. When the link comes back, the downstream 
broker deletes and recreates all the bindings (in case they have changed 
meanwhile) and starts consuming from the queue again.

So if that's how it's meant to work, what is going wrong in your case? 
Is the queue being deleted? Are the bindings to the queue being deleted? 
Something else?

Cheers, Simon

From natewang0425 at gmail.com  Mon May 13 10:25:57 2013
From: natewang0425 at gmail.com (Nate)
Date: Mon, 13 May 2013 02:25:57 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
Message-ID: <1368437157064-26603.post@n5.nabble.com>

I setup a 3 node rabbitmq cluster for online service and everything works
fine; however, after weekly log rotatation was done, I found that two
rabbitmq-servers still wrote the logs into rabbitmqX.log.1, not
rabbitmqX.log. At the meantime, I use the command "ps axjf" to check the
system and I got some following information.

 1905  8550  1905  1905 ?           -1 S        0   0:00  \_ crond
 8550  8567  8567  8567 ?           -1 Ss       0   0:00      \_ /bin/bash
/usr/bin/run-parts /etc/cron.daily
 8567  8942  8567  8567 ?           -1 S        0   0:00          \_ /bin/sh
/etc/cron.daily/logrotate
 8942  8943  8567  8567 ?           -1 S        0   0:00          |   \_
/usr/sbin/logrotate /etc/logrotate.conf
 8943  8944  8567  8567 ?           -1 S        0   0:00          |       \_
sh -c ?            /sbin/service rabbitmq-server rotate-logs > /dev/null? ?     
 8944  8946  8567  8567 ?           -1 S        0   0:00          |          
\_ /bin/sh /sbin/service rabbitmq-server rotate-logs
 8946  8951  8567  8567 ?           -1 S        0   0:00          |              
\_ /bin/sh /etc/init.d/rabbitmq-server rotate-logs
 8951  8954  8567  8567 ?           -1 S        0   0:00          |                  
\_ /bin/sh /usr/sbin/rabbitmqctl rotate_logs
 8954  8963  8567  8567 ?           -1 S        0   0:00          |                      
\_ su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "ro
 8963  8972  8972  8972 ?           -1 Ssl    101   0:00          |                          
\_ /usr/lib/erlang/erts-5.9/bin/beam.smp -- -root /usr/lib/erla

It seems like system is doing postrotate command "/sbin/service
rabbitmq-server rotate-logs > /dev/null", but system cannot finish the task.
 /var/log/rabbitmq/*.log {
        weekly
        missingok
        rotate 20
        compress
        delaycompress
        notifempty
        sharedscripts
        postrotate
            /sbin/service rabbitmq-server rotate-logs > /dev/null
        endscript
}

Rabbitmq still work fine for sending message, but log roatation is getting
stuck.  
I have no idea about this case and don't know how to recover the log without
stopping the system. I need a help..

Thanks in advance,

Nate






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26603.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon May 13 10:29:46 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 13 May 2013 10:29:46 +0100
Subject: [rabbitmq-discuss] How to check if the consumer application is
 processing a message? for how long?
In-Reply-To: <CAN5oP9XxHHjfybqeOA0a5UV8jpLjpg1dPopp52oGTC=5jSANyg@mail.gmail.com>
References: <CAN5oP9XxHHjfybqeOA0a5UV8jpLjpg1dPopp52oGTC=5jSANyg@mail.gmail.com>
Message-ID: <5190B28A.7050603@rabbitmq.com>

Hi,

On 07/05/13 18:43, Prazzy wrote:
> How do we check if the consumer application is processing a message? for
> how long? We are interested to check if consumer application has been
> running for some amount of time. If it exceeds a configured limit, it
> should generate an alert.


It is possible to obtain a count of how many messages in a queue are
unacknowledged by consumers. This typically corresponds to messages that
are being processed by consumers:

 rabbitmqctl list_queues name messages_unacknowledged

It is also possible to get a count of unacknowledged messages per channel:

 rabbitmqctl list_channels pid messages_unacknowledged


It is not possible for the broker to place a limit on how long messages
by remain unacknowledged or to trigger an alert based on this
information. I would suggest that this functionality would be better
placed in the client application.



-Emile








From natewang0425 at gmail.com  Mon May 13 10:31:52 2013
From: natewang0425 at gmail.com (Nate)
Date: Mon, 13 May 2013 02:31:52 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotation was done,
 the command rabbitmqctl rotate_logs cannot stop.
Message-ID: <1368437512574-26606.post@n5.nabble.com>

I setup a 3 node rabbitmq cluster for online service and everything works
fine; however, after weekly log rotation was done, I found that two
rabbitmq-servers still wrote the logs into rabbitmqX.log.1, not
rabbitmqX.log. At the meantime, I use the command "ps axjf" to check the
system and I got some following information. 

?1905 ?8550 ?1905 ?1905 ? ? ? ? ? ? -1 S ? ? ? ?0 ? 0:00 ?\_ crond 
?8550 ?8567 ?8567 ?8567 ? ? ? ? ? ? -1 Ss ? ? ? 0 ? 0:00 ? ? ?\_ /bin/bash
/usr/bin/run-parts /etc/cron.daily 
?8567 ?8942 ?8567 ?8567 ? ? ? ? ? ? -1 S ? ? ? ?0 ? 0:00 ? ? ? ? ?\_ /bin/sh
/etc/cron.daily/logrotate 
?8942 ?8943 ?8567 ?8567 ? ? ? ? ? ? -1 S ? ? ? ?0 ? 0:00 ? ? ? ? ?| ? \_
/usr/sbin/logrotate /etc/logrotate.conf 
?8943 ?8944 ?8567 ?8567 ? ? ? ? ? ? -1 S ? ? ? ?0 ? 0:00 ? ? ? ? ?| ? ? ? \_
sh -c ? ? ? ? ? ? ?/sbin/service rabbitmq-server rotate-logs > /dev/null? ?
? ? 
?8944 ?8946 ?8567 ?8567 ? ? ? ? ? ? -1 S ? ? ? ?0 ? 0:00 ? ? ? ? ?| ? ? ? ?
? \_ /bin/sh /sbin/service rabbitmq-server rotate-logs 
?8946 ?8951 ?8567 ?8567 ? ? ? ? ? ? -1 S ? ? ? ?0 ? 0:00 ? ? ? ? ?| ? ? ? ?
? ? ? \_ /bin/sh /etc/init.d/rabbitmq-server rotate-logs 
?8951 ?8954 ?8567 ?8567 ? ? ? ? ? ? -1 S ? ? ? ?0 ? 0:00 ? ? ? ? ?| ? ? ? ?
? ? ? ? ? \_ /bin/sh /usr/sbin/rabbitmqctl rotate_logs 
?8954 ?8963 ?8567 ?8567 ? ? ? ? ? ? -1 S ? ? ? ?0 ? 0:00 ? ? ? ? ?| ? ? ? ?
? ? ? ? ? ? ? \_ su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl
?"ro 
?8963 ?8972 ?8972 ?8972 ? ? ? ? ? ? -1 Ssl ? ?101 ? 0:00 ? ? ? ? ?| ? ? ? ?
? ? ? ? ? ? ? ? ? \_ /usr/lib/erlang/erts-5.9/bin/beam.smp -- -root
/usr/lib/erla 

It seems like system is doing postrotate command "/sbin/service
rabbitmq-server rotate-logs > /dev/null", but system cannot finish the task. 
?/var/log/rabbitmq/*.log { 
? ? ? ? weekly 
? ? ? ? missingok 
? ? ? ? rotate 20 
? ? ? ? compress 
? ? ? ? delaycompress 
? ? ? ? notifempty 
? ? ? ? sharedscripts 
? ? ? ? postrotate 
? ? ? ? ? ? /sbin/service rabbitmq-server rotate-logs > /dev/null 
? ? ? ? endscript 
} 

Rabbitmq still work fine for sending message, but log roatation is getting
stuck. ? 
I have no idea about this case and don't know how to recover the log without
stopping the system. I need a help.. 

Thanks in advance, 

Nate



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/After-weekly-log-rotation-was-done-the-command-rabbitmqctl-rotate-logs-cannot-stop-tp26606.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon May 13 10:32:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 May 2013 10:32:40 +0100
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <1368437157064-26603.post@n5.nabble.com>
References: <1368437157064-26603.post@n5.nabble.com>
Message-ID: <5190B338.9040206@rabbitmq.com>

Which version of RabbitMQ are you running? There are some bugs in log 
rotation in old versions.

Cheers, Simon

On 13/05/2013 10:25, Nate wrote:
> I setup a 3 node rabbitmq cluster for online service and everything works
> fine; however, after weekly log rotatation was done, I found that two
> rabbitmq-servers still wrote the logs into rabbitmqX.log.1, not
> rabbitmqX.log. At the meantime, I use the command "ps axjf" to check the
> system and I got some following information.
>
>   1905  8550  1905  1905 ?           -1 S        0   0:00  \_ crond
>   8550  8567  8567  8567 ?           -1 Ss       0   0:00      \_ /bin/bash
> /usr/bin/run-parts /etc/cron.daily
>   8567  8942  8567  8567 ?           -1 S        0   0:00          \_ /bin/sh
> /etc/cron.daily/logrotate
>   8942  8943  8567  8567 ?           -1 S        0   0:00          |   \_
> /usr/sbin/logrotate /etc/logrotate.conf
>   8943  8944  8567  8567 ?           -1 S        0   0:00          |       \_
> sh -c ?            /sbin/service rabbitmq-server rotate-logs > /dev/null? ?
>   8944  8946  8567  8567 ?           -1 S        0   0:00          |
> \_ /bin/sh /sbin/service rabbitmq-server rotate-logs
>   8946  8951  8567  8567 ?           -1 S        0   0:00          |
> \_ /bin/sh /etc/init.d/rabbitmq-server rotate-logs
>   8951  8954  8567  8567 ?           -1 S        0   0:00          |
> \_ /bin/sh /usr/sbin/rabbitmqctl rotate_logs
>   8954  8963  8567  8567 ?           -1 S        0   0:00          |
> \_ su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "ro
>   8963  8972  8972  8972 ?           -1 Ssl    101   0:00          |
> \_ /usr/lib/erlang/erts-5.9/bin/beam.smp -- -root /usr/lib/erla
>
> It seems like system is doing postrotate command "/sbin/service
> rabbitmq-server rotate-logs > /dev/null", but system cannot finish the task.
>   /var/log/rabbitmq/*.log {
>          weekly
>          missingok
>          rotate 20
>          compress
>          delaycompress
>          notifempty
>          sharedscripts
>          postrotate
>              /sbin/service rabbitmq-server rotate-logs > /dev/null
>          endscript
> }
>
> Rabbitmq still work fine for sending message, but log roatation is getting
> stuck.
> I have no idea about this case and don't know how to recover the log without
> stopping the system. I need a help..
>
> Thanks in advance,
>
> Nate
>
>
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26603.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From tim at rabbitmq.com  Mon May 13 10:39:49 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 13 May 2013 10:39:49 +0100
Subject: [rabbitmq-discuss] persistent connections on rabbitmq-server
	when android client losses internet connection
In-Reply-To: <3824e27a-ccc4-4c73-8a0b-d0a9e111433c@googlegroups.com>
References: <3824e27a-ccc4-4c73-8a0b-d0a9e111433c@googlegroups.com>
Message-ID: <AFB8E615-7EA0-4098-8939-36F82E21354A@rabbitmq.com>

Hi,

On 11 May 2013, at 13:08, Jure Novi? wrote:

> I have a question about about connections to server from java client. I'm developing a Android application using rabbitmq-java-client library. I followed the tutorials on the rabbitmq website, so I created a ConnectionFactory with my own ip address (without any timeout or heartbeat), then called newConnection(). Everything works fine, sending and receiving.
> 
> The problem arrises when I turn off network connection on an android device, the connection on rabbitmq-server is still there (for long time). If I want to achieve that the server clear my connection I have to use heartbeat. I also tried to create new ConnectionFactory class and override configureSocket and call socket.setKeepAlive(true). That neither helped. 

If I'm not mistaken, you'll need to enable TCP keep-alive at the OS level to take advantage of that. Check out `man tcp`, at which point you might want to consider 'tcp_retries1' and the RTO settings as well. Better still, get your network admin to look at these, since they'll have a much better idea of the impact any changes might have. 

> 
> My colleague is developing an iOS application, and another one is developing an erlang client. They don't have this problem, if they kill the app or turn of network connection, the connections on rabbitmq-server are cleared immediately (2-4s). They are not using any timeouts or heartbeats.

Perhaps that's true at the application level, but it's entirely possible that at the OS level (on either client or server) they have configured the network stack to detect connection failures in a timely fashion. This could be the case either because they've explicitly tuned the kernel's TCP parameters themselves, or that their chosen OS provides different defaults to yours. If this is not the case, it's also possible that intermediate network kit (such as routers, load balancers, proxies and firewalls) could be responsible for the timely detection of a closed socket.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/6e92671f/attachment.htm>

From natewang0425 at gmail.com  Mon May 13 10:42:08 2013
From: natewang0425 at gmail.com (Nate)
Date: Mon, 13 May 2013 02:42:08 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <5190B338.9040206@rabbitmq.com>
References: <5190B338.9040206@rabbitmq.com>
Message-ID: <1368438128561-26609.post@n5.nabble.com>

Hi Simon,

    Thanks your reply, I use 3.0.1 rabbitmq with erlang R15B.

Regards,
Nate



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26609.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon May 13 10:53:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 May 2013 10:53:02 +0100
Subject: [rabbitmq-discuss] Queue Memory keep on increasing
In-Reply-To: <CAB0ZxM78ga8xEc9f8Qp8DfE5y_H4dh4n441xTMKi5QTA=GEXvQ@mail.gmail.com>
References: <CAB0ZxM78ga8xEc9f8Qp8DfE5y_H4dh4n441xTMKi5QTA=GEXvQ@mail.gmail.com>
Message-ID: <5190B7FE.80005@rabbitmq.com>

On 13/05/2013 08:46, chetan dev wrote:
> I have a durable mirrored queue on two nodes .
> initially when publishing and consumer activity started queue memory was
> around 50 kB, now it is increasing day by day .currently it is around 3.9 MB

A slow moving process will only get garbage collected occasionally; to 
be honest I would consider ~3MB to be within the levels of GC noise here.

You could try something like:

rabbitmqctl eval '[{pid, Pid}] = 
rabbit_amqqueue:with(rabbit_misc:r(<<"/">>, queue, <<"test">>), fun(Q) 
-> rabbit_amqqueue:info(Q, [pid]) end), garbage_collect(Pid).'

to forcibly garbage-collect the queue and see if that cuts memory use.

But I would only worry if the memory use kept growing quite a long way 
past 3MB.

Cheers, Simon


From sabrina.kuehn90 at web.de  Mon May 13 11:06:39 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Mon, 13 May 2013 03:06:39 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
Message-ID: <1368439599833-26611.post@n5.nabble.com>

Hi,
I work now since 3 weeks with rabbitmq und I have my problems. Actualy I
want to mirror 3 vm's on 3 other vm's on one server. I'm not realy sure how
to do that but I try it.^^

I call my six clustered vm's rab1 - rab6

rab1 has a test-mirror-queue

<http://rabbitmq.1065348.n5.nabble.com/file/n26611/emit.png> 


rab2 abd rab3 are the consumer/receiver

<http://rabbitmq.1065348.n5.nabble.com/file/n26611/receive.png> 

the massage is sending and receiving

now to my problem:
I want that rab1-rab3 are mirrored from rab4-rab6 I don't now if my queue is
the right chose for that and if it is how I have to configure the policy.
The web UI is not able to create policies for ha-mode nodes so I tried to
write a command:

rabbitmqctl set_policy ha-mirror "^mirror\." \
> '{"ha-mode":"nodes","ha-params":"rabbit at rab5,rabbit at rab6","ha-sync-mode":"automatic"}'

But I've get an error msg:

Setting policy "ha-mirror" for pattern "^mirror\\." to
"{\"ha-mode\":\"nodes\",\"ha-params\":\"rabbit at rab5,rabbit at rab6\",\"ha-sync-mode\":\"automatic\"}"
...
Error: Validation failed

ha-mode="nodes" takes a list, <<"rabbit at rab5,rabbit at rab6">> given
Perhaps someone can help me by the command and I hope that someone can tell
if way to mirror my vm's is the right way.

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon May 13 11:10:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 May 2013 11:10:56 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1368439599833-26611.post@n5.nabble.com>
References: <1368439599833-26611.post@n5.nabble.com>
Message-ID: <5190BC30.2030006@rabbitmq.com>

On 13/05/2013 11:06, Slyth wrote:
> rabbitmqctl set_policy ha-mirror "^mirror\." \
>> '{"ha-mode":"nodes","ha-params":"rabbit at rab5,rabbit at rab6","ha-sync-mode":"automatic"}'

Try:

rabbitmqctl set_policy ha-mirror "^mirror\." \
 
'{"ha-mode":"nodes","ha-params":["rabbit at rab5","rabbit at rab6"],"ha-sync-mode":"automatic"}'

The nodes needs to be a list of strings.

Cheers, Simon

From sabrina.kuehn90 at web.de  Mon May 13 11:23:45 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Mon, 13 May 2013 03:23:45 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <5190BC30.2030006@rabbitmq.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
Message-ID: <1368440625413-26613.post@n5.nabble.com>

Thanks this works^^ and I had to now that.

But is it possible to mirror all 3 vm's with the other tree on my way?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26613.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Mon May 13 11:23:47 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 13 May 2013 11:23:47 +0100
Subject: [rabbitmq-discuss] [java-client] Is there a full working
 example of "DefaultConsumer" without *deprecated * QueueingConsumer ?
In-Reply-To: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
References: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
Message-ID: <5190BF33.1010902@rabbitmq.com>

On 10/05/13 09:48, Ahmet Akyol wrote:
> Then I saw an example usage at api guide
> <http://www.rabbitmq.com/api-guide.html>
>
>     *boolean*  autoAck =*false*;
>     channel.basicConsume(queueName, autoAck, "myConsumerTag",
>           *new*  DefaultConsumer(channel) {
>               @Override
>               *public*  *void*  handleDelivery(String consumerTag,
>                                          Envelope envelope,
>                                          AMQP.BasicProperties properties,
>                                          *byte*[] body)
>                   *throws*  IOException
>               {
>                   String routingKey = envelope.getRoutingKey();
>                   String contentType = properties.contentType;
>                   *long*  deliveryTag = envelope.getDeliveryTag();
>                   /// (process the message components here ...)/
>                   channel.basicAck(deliveryTag,*false*);
>               }
>           });
>
> but it never worked for me.

That *should* work. What problems did you encounter?

> So, is there a full working example of "DefaultConsumer"

https://github.com/rabbitmq/rabbitmq-java-client/blob/master/test/src/com/rabbitmq/examples/ConsumerMain.java#L232


Matthias.

From tim at rabbitmq.com  Mon May 13 11:50:12 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 13 May 2013 11:50:12 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <DC755AE3-9B55-44AB-A361-C802ABE5C15E@rabbitmq.com>
References: <CDB3D93E.9902%Michael.Laing@nytimes.com>
	<DC755AE3-9B55-44AB-A361-C802ABE5C15E@rabbitmq.com>
Message-ID: <6113876B-988F-42B1-AFDB-0BA9E2AE7439@rabbitmq.com>

Hi Michael,

The sooner I can take a look at that config, the sooner I'll be able to verify what's going on and if necessary, get a fix ready for the patch release going out in the next week(s). One more question for you as well, if that's ok - are you running the shovel workers inside a cluster here?

Cheers,
Tim

On 11 May 2013, at 16:43, Tim Watson wrote:

> Sure that's fine, I'll look into it properly on Monday anyway.
> 
> Cheers,
> Tim
> 
> On 11 May 2013, at 16:23, "Laing, Michael P." <Michael.Laing at nytimes.com> wrote:
> 
>> I'll get back to you as soon as I can but my human team is down for the
>> weekend.
>> 
>> So there may be some delay.
>> 
>> Best,
>> Michael
>> 
>> On 5/11/13 11:06 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:
>> 
>>> Right, well that's another matter altogether. Once a reconnect delay is
>>> properly set, the worker should keep trying to restart (and in the
>>> process, choose a different random URL). Can you confirm how/where you
>>> set the reconnect delay please, and also what your shovel config looks
>>> like once all the substitution is done - you can replace all the IP
>>> digits with x using sed or somesuch.
>>> 
>>> This is top of my personal list to fix for 3.1.1 right now.
>>> 
>>> Cheers,
>>> Tim
>>> 
>>> On 11 May 2013, at 15:38, "Laing, Michael P." <Michael.Laing at nytimes.com>
>>> wrote:
>>> 
>>>> correct
>>>> 
>>>> On 5/11/13 10:35 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:
>>>> 
>>>>> Hi Michael,
>>>>> 
>>>>> On 11 May 2013, at 12:41, "Laing, Michael P."
>>>>> <Michael.Laing at nytimes.com>
>>>>> wrote:
>>>>> 
>>>>>> That temporary fix does not work. This is a different bug.
>>>>>> 
>>>>>> With the 'fix' it gives a bad_host error instead of unknown_host.
>>>>>> 
>>>>> 
>>>>> You're saying that the error changes *and* the shovel worker terminates
>>>>> without trying to reconnect to another host?
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From sabrina.kuehn90 at web.de  Mon May 13 11:58:12 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Mon, 13 May 2013 03:58:12 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1368440625413-26613.post@n5.nabble.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
Message-ID: <1368442692955-26616.post@n5.nabble.com>

And my policy and queue don't see each other. There is no policy and mirror
entry in the web UI of my queue.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26616.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Mon May 13 12:21:14 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 13 May 2013 12:21:14 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <CDB3A384.98D6%Michael.Laing@nytimes.com>
References: <CDB3A384.98D6%Michael.Laing@nytimes.com>
Message-ID: <5CE5EC95-A4E8-4772-8CAB-5341DA8E2B4D@rabbitmq.com>

On 11 May 2013, at 12:41, Laing, Michael P. wrote:
> With the 'fix' it gives a bad_host error instead of unknown_host.
> 


Also also ... can you tell me more about this error. The `bad_host` seems a bit wayward to me - how did you determine that this was the error. Is there a log file I can take a look at, or a snippet from one?

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/5f063f0e/attachment.htm>

From Michael.Laing at nytimes.com  Mon May 13 12:23:50 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 13 May 2013 07:23:50 -0400
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
 error instead of seeking another host
In-Reply-To: <6113876B-988F-42B1-AFDB-0BA9E2AE7439@rabbitmq.com>
Message-ID: <CDB64132.9930%Michael.Laing@nytimes.com>

Hi Tim,

The guy who did the test won't be available for 3-4 hours yet.

And - I couldn't recreate his results manually?! I.e., setting
reconnect_delay worked for me.

So this may not be a new bug.

But I want to talk to him first before we close it out and see if he did
something subtly different.

Re cluster: the 5 shovels are configured and running in a non-clustered
node. The remote party is a cluster of 1 to 3 nodes with each remote node
reachable via one of 6 hostnames defined in each shovel.

Thanks,

Michael


On 5/13/13 6:50 AM, "Tim Watson" <tim at rabbitmq.com> wrote:

>Hi Michael,
>
>The sooner I can take a look at that config, the sooner I'll be able to
>verify what's going on and if necessary, get a fix ready for the patch
>release going out in the next week(s). One more question for you as well,
>if that's ok - are you running the shovel workers inside a cluster here?
>
>Cheers,
>Tim
>
>On 11 May 2013, at 16:43, Tim Watson wrote:
>
>> Sure that's fine, I'll look into it properly on Monday anyway.
>> 
>> Cheers,
>> Tim
>> 
>> On 11 May 2013, at 16:23, "Laing, Michael P."
>><Michael.Laing at nytimes.com> wrote:
>> 
>>> I'll get back to you as soon as I can but my human team is down for the
>>> weekend.
>>> 
>>> So there may be some delay.
>>> 
>>> Best,
>>> Michael
>>> 
>>> On 5/11/13 11:06 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:
>>> 
>>>> Right, well that's another matter altogether. Once a reconnect delay
>>>>is
>>>> properly set, the worker should keep trying to restart (and in the
>>>> process, choose a different random URL). Can you confirm how/where you
>>>> set the reconnect delay please, and also what your shovel config looks
>>>> like once all the substitution is done - you can replace all the IP
>>>> digits with x using sed or somesuch.
>>>> 
>>>> This is top of my personal list to fix for 3.1.1 right now.
>>>> 
>>>> Cheers,
>>>> Tim
>>>> 
>>>> On 11 May 2013, at 15:38, "Laing, Michael P."
>>>><Michael.Laing at nytimes.com>
>>>> wrote:
>>>> 
>>>>> correct
>>>>> 
>>>>> On 5/11/13 10:35 AM, "Tim Watson" <watson.timothy at gmail.com> wrote:
>>>>> 
>>>>>> Hi Michael,
>>>>>> 
>>>>>> On 11 May 2013, at 12:41, "Laing, Michael P."
>>>>>> <Michael.Laing at nytimes.com>
>>>>>> wrote:
>>>>>> 
>>>>>>> That temporary fix does not work. This is a different bug.
>>>>>>> 
>>>>>>> With the 'fix' it gives a bad_host error instead of unknown_host.
>>>>>>> 
>>>>>> 
>>>>>> You're saying that the error changes *and* the shovel worker
>>>>>>terminates
>>>>>> without trying to reconnect to another host?
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>> 
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Mon May 13 12:52:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 May 2013 12:52:31 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1368440625413-26613.post@n5.nabble.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
Message-ID: <5190D3FF.9040005@rabbitmq.com>

On 13/05/13 11:23, Slyth wrote:
> But is it possible to mirror all 3 vm's with the other tree on my way?

It's not really clear what you're asking here. Do you want to have all 6 
nodes in one cluster or something else? What is different about one 
group of 3 nodes vs the other?

> And my policy and queue don't see each other. There is no policy and mirror
> entry in the web UI of my queue.

You defined a policy that would apply to queues with names beginning 
with "mirror." - but your queue is named "mirror".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sabrina.kuehn90 at web.de  Mon May 13 13:31:02 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Mon, 13 May 2013 05:31:02 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <5190D3FF.9040005@rabbitmq.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
Message-ID: <1368448262051-26620.post@n5.nabble.com>

I have one cluster with 6 vm's and I want to mirror the first 3 on the other
3. That is everything I want to do, if you now an easier way as my try
please instruct me 

Ok now ich have a queue:

root at rab1:/home/rab1#  rabbitmqctl set_policy ha-mirrorq "mirrorq" \
> '{"ha-mode":"nodes","ha-params":["rabbit at rab4","rabbit at rab5","rabbit at rab6"],"ha-sync-mode":"automatic"}'

(I have to look how I configure my queue. If rab2 and rab3 should receive
the same msges or not and if I have to have one or two queues.)
But why mirror my queue only on rab5 and rab6. And work my 3 vm's allways
together or only rab2 and rab3 because rab1 is the sender?

I hope you understand my problem I'am a little bit confuse and I found no
examples in the internet.

Hope you can help me.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26620.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Mon May 13 13:53:54 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 13 May 2013 13:53:54 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <CDB64132.9930%Michael.Laing@nytimes.com>
References: <CDB64132.9930%Michael.Laing@nytimes.com>
Message-ID: <707AA010-26C6-48B9-A0D9-2BDCBDD43FEC@rabbitmq.com>

On 13 May 2013, at 12:23, Laing, Michael P. wrote:

> Hi Tim,
> 
> The guy who did the test won't be available for 3-4 hours yet.

Ok, no rush. I'm on leave Tue+Wed, but I can look at this later on tonight if needs be. I'd like to get to the bottom of it.

> 
> And - I couldn't recreate his results manually?! I.e., setting
> reconnect_delay worked for me.
> 
> So this may not be a new bug.
> 
> But I want to talk to him first before we close it out and see if he did
> something subtly different.
> 

That sounds sensible.

> Re cluster: the 5 shovels are configured and running in a non-clustered
> node. The remote party is a cluster of 1 to 3 nodes with each remote node
> reachable via one of 6 hostnames defined in each shovel.
> 

Ok fine, that rules out some of the explanations I might've had, but it's good we eliminate possibilities.

Cheers,
Tim

From francois at teksol.info  Mon May 13 14:02:04 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Mon, 13 May 2013 09:02:04 -0400
Subject: [rabbitmq-discuss] Workflow for optional data in HTTP server
	process?
Message-ID: <41B10089-6A9F-45B2-BC0E-089D8C9081FB@teksol.info>

Hi!

Let's say I have data which I'd like to return to an HTTP client (browser), but is optional. When the request hits the web server process, is it expected that it would open a channel, create a server-named queue and send the request, with reply-to set to the queue? Once all processing is completed, the web server process would poll the queue for N milliseconds and return ASAP. If the reply hasn't arrived, RabbitMQ would discard it since the queue would already be destroyed.

Because the data is optional, I would assume that this workflow is as optimal as possible?

For reference, I'm talking about using Bunny in a Ruby 1.9.3 Unicorn HTTP web server. Pseudo-code:

# Ruby / Sinatra
get "/widget/:id" do
  queue = nil
  begin
    queue = bunny.queue("")
    exchange.publish(params[:id], reply_to: queue.name)

    # database code - expected to take a couple milliseconds
    @widget = # fetch from database
    # more processing

    # hopefully, by this time, the data has made it only the queue
    # and we can get it - else, we won't care
    @optional = queue.get # returns nil if no message, does not block
  finally
    queue.close if queue
  end
end

With this code, the queue is expected to live for only a few milliseconds.

Bye!
Fran?ois

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/e387e04b/attachment.bin>

From sabrina.kuehn90 at web.de  Mon May 13 14:09:06 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Mon, 13 May 2013 06:09:06 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1368448262051-26620.post@n5.nabble.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
Message-ID: <1368450546378-26623.post@n5.nabble.com>

Some extra informations:

<http://rabbitmq.1065348.n5.nabble.com/file/n26623/queues.png> 
<http://rabbitmq.1065348.n5.nabble.com/file/n26623/mirrorq.png> 

What I realy don't undeerstand is why mirrorq take node rab4 and mirror on
rab5 and rab6



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26623.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From richard at raseley.com  Mon May 13 15:12:51 2013
From: richard at raseley.com (Richard Raseley)
Date: Mon, 13 May 2013 07:12:51 -0700
Subject: [rabbitmq-discuss] Guidance on Understanding API Output for
	Monitoring
In-Reply-To: <518CFB4E.20400@rabbitmq.com>
References: <CAO=6ox_Yiisk18BeNHs6qO2aVxDow12XjJpAGiDmw5DSVAvi7g@mail.gmail.com>
	<518CFB4E.20400@rabbitmq.com>
Message-ID: <CAO=6ox8fUcg_UrWgnN_XLQ8w0RGQPKpmskf+mO7v0urNO87i+Q@mail.gmail.com>

Simon,

Primarily I would like to get absolute message count and throughput
statistics on a specified exchange over a specified or at least known time
period.

If you look at the JSON attachment I sent it does show throughput (e.g.
100msg/s) but it doesn't tell me over what period that number is from.

Any help would be greatly appreciated.

Regards,

Richard


On Fri, May 10, 2013 at 6:51 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Sorry, there isn't any documentation yet.
>
> It would help me to write some if you told me what information you were
> looking for.
>
> Cheers, Simon
>
>
> On 09/05/13 17:58, Richard Raseley wrote:
>
>> I have attached a JSON document that is the output of the following
>> query against my RabbitMQ cluster:
>>
>> http://cluster-vip:15672/api/**exchanges/?sort=name<http://cluster-vip:15672/api/exchanges/?sort=name>
>>
>> I was hoping that someone could point me towards some documentation that
>> would help me better understand what info surrounding the message stats,
>> publishing rates, etc. so that I might use them in monitoring the health
>> and throughput of the system.
>>
>> This information doesn't seem to be in the official API document and I
>> was unable to turn up any other authoritative source.
>>
>> Regards,
>>
>> Richard
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/49b573f8/attachment.htm>

From Michael.Laing at nytimes.com  Mon May 13 16:23:28 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 13 May 2013 11:23:28 -0400
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
 error instead of seeking another host
In-Reply-To: <707AA010-26C6-48B9-A0D9-2BDCBDD43FEC@rabbitmq.com>
Message-ID: <CDB67CB3.99B1%Michael.Laing@nytimes.com>

Upon review, it was a mistake in his configuration. Sorry for the trouble.
-ml

On 5/13/13 8:53 AM, "Tim Watson" <tim at rabbitmq.com> wrote:

>On 13 May 2013, at 12:23, Laing, Michael P. wrote:
>
>> Hi Tim,
>> 
>> The guy who did the test won't be available for 3-4 hours yet.
>
>Ok, no rush. I'm on leave Tue+Wed, but I can look at this later on
>tonight if needs be. I'd like to get to the bottom of it.
>
>> 
>> And - I couldn't recreate his results manually?! I.e., setting
>> reconnect_delay worked for me.
>> 
>> So this may not be a new bug.
>> 
>> But I want to talk to him first before we close it out and see if he did
>> something subtly different.
>> 
>
>That sounds sensible.
>
>> Re cluster: the 5 shovels are configured and running in a non-clustered
>> node. The remote party is a cluster of 1 to 3 nodes with each remote
>>node
>> reachable via one of 6 hostnames defined in each shovel.
>> 
>
>Ok fine, that rules out some of the explanations I might've had, but it's
>good we eliminate possibilities.
>
>Cheers,
>Tim


From bison_art at o2.pl  Mon May 13 16:26:25 2013
From: bison_art at o2.pl (rabbit15)
Date: Mon, 13 May 2013 08:26:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
Message-ID: <1368458785228-26626.post@n5.nabble.com>

Hi i have question about very fast grow the memory used by RabbitMQ.  I have
apllication that need to store messages on the server, because sometimes the
producer publish messages faster than consumer read them. To get more
messages on the server, before flow control would cut the publishing I had
changed watermark to 100.0 and disc limit to 0. I saw the even if there is
messages which take about 1 GB size, the server takes a lot of memory which
crash the system (there is 92 GB RAM). What are correct values for that
setup ? Why the memory grows up so fast ?

Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Mon May 13 16:41:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 13 May 2013 16:41:21 +0100
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <1368438128561-26609.post@n5.nabble.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
Message-ID: <519109A1.1080301@rabbitmq.com>

On 13/05/13 10:42, Nate wrote:
>      Thanks your reply, I use 3.0.1 rabbitmq with erlang R15B.

Are there any "Rotating logs with suffix '...'" messages in the rabbit log?

Also, what does

   rabbitmqctl eval 'process_info(whereis(error_logger)).'

return?

Regards,

Matthias.

From tim at rabbitmq.com  Mon May 13 16:42:13 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 13 May 2013 16:42:13 +0100
Subject: [rabbitmq-discuss] Shovel 3.1.0 - terminates on unknown_host
	error instead of seeking another host
In-Reply-To: <CDB67CB3.99B1%Michael.Laing@nytimes.com>
References: <CDB67CB3.99B1%Michael.Laing@nytimes.com>
Message-ID: <4D041B02-5079-4F02-8198-7B0C5B87466E@rabbitmq.com>

On 13 May 2013, at 16:23, Laing, Michael P. wrote:

> Upon review, it was a mistake in his configuration. Sorry for the trouble.
> -ml
> 

Good! No trouble, just glad there's not a real bug we didn't know about. Will have the fix for default reconnect delays out shortly, and sorry for breaking that!

Cheers,
Tim


From tim at rabbitmq.com  Mon May 13 16:59:00 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 13 May 2013 16:59:00 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
Message-ID: <EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>

Hi Michael,

A couple of quick questions about this...

1. are you sure the queue is not empty by the time the consumer is restarted?
2. do you receive no methods at all in the consumer, not even connection negotiation?

I can't replicate this viz (1) for me the queue is always empty by the time the consumer is stopped and restarted and (2) I see the connection and basic.consume get going before the consumer gets stuck and it is in 'blocking' mode, which given that the queue is empty and the alarm still set, is apparently ok.

Cheers,
Tim

On 3 May 2013, at 10:45, Michael Klishin wrote:

> 2013/5/3 Tim Watson <tim at rabbitmq.com>
> Have you got a reproducible (ish) test that I can run on a linux box? If so, I'll poke around and make sure it's not showing up there too.
> 
> https://gist.github.com/michaelklishin/cea9aff14506e95def59
> 
> You'll need Ruby and RubyGems available.
> 
> Put all 3 files in a directory, then do
> 
>  * [sudo] gem install bundler
>  * bundle install
>  * run bundle exec ruby ./consumer.rb and bundle exec ruby ./producer.rb in two tabs
>  
> You can tweak message rates and size in publisher.rb. If you want to see methods
> received from rabbit, run the consumer with BUNNY_LOG_LEVEL=debug.
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/fb46e243/attachment.htm>

From michael.s.klishin at gmail.com  Mon May 13 17:02:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 13 May 2013 20:02:11 +0400
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
 operations other than basic.publish
In-Reply-To: <EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
Message-ID: <CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>

2013/5/13 Tim Watson <tim at rabbitmq.com>

> 1. are you sure the queue is not empty by the time the consumer is
> restarted?
>

I typically restart the publisher first, so yes, there are certainly
messages in the queue


> 2. do you receive no methods at all in the consumer, not even connection
> negotiation?
>

Correct. But it appears to be that any network activity almost locks up, I
blame the OS X kernel that's very easy to
overwhelm with flood publishing on localhost.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/f490996e/attachment.htm>

From tim at rabbitmq.com  Mon May 13 18:00:58 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 13 May 2013 18:00:58 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
Message-ID: <18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>

On 13 May 2013, at 17:02, Michael Klishin wrote:

> 2013/5/13 Tim Watson <tim at rabbitmq.com>
> 1. are you sure the queue is not empty by the time the consumer is restarted?
> 
> I typically restart the publisher first, so yes, there are certainly messages in the queue

I didn't try that, but it wouldn't make any difference if that alarm was still set, since the producer would get blocked immediately would it not?

>  
> 2. do you receive no methods at all in the consumer, not even connection negotiation?
> 
> Correct. But it appears to be that any network activity almost locks up, I blame the OS X kernel that's very easy to
> overwhelm with flood publishing on localhost.

I've certainly been unable to replicate this across two machines, and with just localhost on Snow Leopard, I never get the queue to be anything but empty, that is once the producer is blocked and the consumer is receiving no more messages, running `rabbitmqctl list_queues' shows a queue length of 0. How do you get more messages into the queue then, if a memory alarm is still set? I didn't think that was possible?

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/5f6910c1/attachment.htm>

From hackeron at gmail.com  Mon May 13 18:18:13 2013
From: hackeron at gmail.com (Roman Gaufman)
Date: Mon, 13 May 2013 18:18:13 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
Message-ID: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>

I want to have 20 or so clients reading/writing to a local rabbitmq which
will federate to a central server (in both directions). Each client has a
separate username, password and permissions.

Reason it is done this way is the servers are on very unstable connections
on the move.

Right now, when I try to connect more than 1 federation upstream, I
get:  ** {error,user_does_not_exist}

It seems all of these servers need to be forced to use the same username? -
Why is this? - Is there any way not to have a "local-username" but rather
to accept all usernames?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/db0fd26e/attachment.htm>

From michael.s.klishin at gmail.com  Mon May 13 18:21:32 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 13 May 2013 21:21:32 +0400
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
 operations other than basic.publish
In-Reply-To: <18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
	<18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
Message-ID: <CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>

2013/5/13 Tim Watson <tim at rabbitmq.com>

> I didn't try that, but it wouldn't make any difference if that alarm was
> still set, since the producer would get blocked immediately would it not?


I first clear the queue, then restart the producer, so no.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/1b436d49/attachment.htm>

From michael.s.klishin at gmail.com  Mon May 13 18:25:27 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 13 May 2013 21:25:27 +0400
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368458785228-26626.post@n5.nabble.com>
References: <1368458785228-26626.post@n5.nabble.com>
Message-ID: <CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>

2013/5/13 rabbit15 <bison_art at o2.pl>

> Why the memory grows up so fast ?


rabbitmqctl status will report a breakdown on what takes memory.

However, if you publish gigabyte-sized messages, it may be a better idea to
store them on the filesystem,
S3, Riak CS or similar, and only pass URIs or identifiers that lets
applications locate the file in your messages.

Messaging systems build on memory managed runtimes
are likely to not handle multi-gigabyte messages that are kept around for a
long time well.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/63f83cbe/attachment.htm>

From matthias at rabbitmq.com  Mon May 13 18:36:37 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 13 May 2013 18:36:37 +0100
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
Message-ID: <519124A5.805@rabbitmq.com>

On 13/05/13 18:25, Michael Klishin wrote:
> Messaging systems build on memory managed runtimes
> are likely to not handle multi-gigabyte messages that are kept around
> for a long time well.

Rabbit should actually handle that reasonably well, as long as the 
influx of these messages is relatively controlled, e.g. you don't have 
hundreds of producers all trying to publish multi-gigabyte messages 
concurrently.

Alas setting the memory watermark to 100%, as the OP did, is rarely a 
good idea.

Matthias.

From tim at rabbitmq.com  Mon May 13 18:45:33 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 13 May 2013 18:45:33 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
	<18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
	<CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>
Message-ID: <CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>

On 13 May 2013, at 18:21, Michael Klishin wrote:
> 
> 2013/5/13 Tim Watson <tim at rabbitmq.com>
> I didn't try that, but it wouldn't make any difference if that alarm was still set, since the producer would get blocked immediately would it not?
> 
> I first clear the queue, then restart the producer, so no.

Hmn, I can't get that to break, because I can't get the queue to be non-empty in the first place. Here's what I'm doing, perhaps you can point out the step I'm missing.

1. start the broker
2. start the producer
3. start the consumer
4. set the watermark very low using rabbitmqctl, e.g., 0.001
5. see the alarm in the logs
6. stop the producer

** at this point, the queue is always empty

7. stop the consumer
8. start the consumer

** but at this point, the exercise is moot, because the queue is empty so 'blocking' is the expected state. Sorry I didn't check on this with you sooner - I didn't realise I needed to look at that when I got started as I wasn't clear on the implication of "blocking" as the consumer state. The consumer stays in this state of course, since there are no messages in the queue.

So what am I doing wrong here?

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/2166aa62/attachment.htm>

From michael.s.klishin at gmail.com  Mon May 13 18:53:48 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 13 May 2013 21:53:48 +0400
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
 operations other than basic.publish
In-Reply-To: <CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
	<18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
	<CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>
	<CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>
Message-ID: <CAE3HoVRGNooZ-DzqJjL2Af-ZnPnA7PbMTWAZPPbhOzAkQk2kGQ@mail.gmail.com>

2013/5/13 Tim Watson <tim at rabbitmq.com>

> So what am I doing wrong here?


I don't set the watermark really low. Instead, I publish a lot of 2-16 MB
messages until the regular 40%
watermark is hit (so, a few hundreds megs total).

Then Rabbit basically stops deliveries and as I restart apps, connections
take a really long time (up to 2 minutes).
That said, the entire OS responsiveness is terrible.

Purging the queue helps with new connections but messages are still not
delivered to the consumer when I restart
the producer.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/2f40f41f/attachment.htm>

From matthias at rabbitmq.com  Mon May 13 18:58:20 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 13 May 2013 18:58:20 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
 operations other than basic.publish
In-Reply-To: <CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
	<18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
	<CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>
	<CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>
Message-ID: <519129BC.60000@rabbitmq.com>

On 13/05/13 18:45, Tim Watson wrote:
> ** but at this point, the exercise is moot, because the queue is empty
> so 'blocking' is the expected state. Sorry I didn't check on this with
> you sooner - I didn't realise I needed to look at that when I got
> started as I wasn't clear on the implication of "blocking" as the
> consumer state. The consumer stays in this state of course, since there
> are no messages in the queue.

As an aside, 'blocking' has nothing to do with the emptiness of queues. 
Or consuming. It indicates that the connection WILL be blocked (and 
transition to the 'blocked' state) IF/WHEN the client publishes on it.

Matthias.

From matthias at rabbitmq.com  Mon May 13 19:04:53 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 13 May 2013 19:04:53 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
 operations other than basic.publish
In-Reply-To: <CAE3HoVRGNooZ-DzqJjL2Af-ZnPnA7PbMTWAZPPbhOzAkQk2kGQ@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
	<18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
	<CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>
	<CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>
	<CAE3HoVRGNooZ-DzqJjL2Af-ZnPnA7PbMTWAZPPbhOzAkQk2kGQ@mail.gmail.com>
Message-ID: <51912B45.5060709@rabbitmq.com>

On 13/05/13 18:53, Michael Klishin wrote:
> I don't set the watermark really low. Instead, I publish a lot of 2-16
> MB messages until the regular 40% watermark is hit
>
> The entire OS responsiveness is terrible.

Is the O/S paging perhaps? If this is your regular "desktop" machine, 
plus you are running rabbit and the clients on it, then I'd image by the 
time rabbit hits the regular 40% watermark the O/S may well have started 
paging quite heavily. And at that point *everything* gets a lot slower, 
and large processes, like rabbit at that time, will suffer particularly 
badly.

The 40% is a reasonable default for machines that don't run much besides 
rabbit and/or on which rabbit isn't put under heavy load. If those 
conditions aren't met then lowering the threshold is advisable.

Matthias.

From watson.timothy at gmail.com  Mon May 13 19:07:49 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 13 May 2013 19:07:49 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVRGNooZ-DzqJjL2Af-ZnPnA7PbMTWAZPPbhOzAkQk2kGQ@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
	<18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
	<CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>
	<CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>
	<CAE3HoVRGNooZ-DzqJjL2Af-ZnPnA7PbMTWAZPPbhOzAkQk2kGQ@mail.gmail.com>
Message-ID: <E82DC032-5361-410A-B686-0B11E150D3DD@rabbitmq.com>

Right...

On 13 May 2013, at 18:53, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 
> 2013/5/13 Tim Watson <tim at rabbitmq.com>
> So what am I doing wrong here?
> 
> I don't set the watermark really low. Instead, I publish a lot of 2-16 MB messages until the regular 40%
> watermark is hit (so, a few hundreds megs total).
> 
> Then Rabbit basically stops deliveries and as I restart apps, connections take a really long time (up to 2 minutes).
> That said, the entire OS responsiveness is terrible.
> 

Hmm. How long did that take? I can kick off a run overnight an let it stew I suppose. How much memory has your machine got?

> Purging the queue helps with new connections but messages are still not delivered to the consumer when I restart
> the producer.

I didn't pick that up from the original post. Is this happening after the alarm has been unset?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/134db758/attachment.htm>

From michael.s.klishin at gmail.com  Mon May 13 19:13:05 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 13 May 2013 22:13:05 +0400
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
 operations other than basic.publish
In-Reply-To: <E82DC032-5361-410A-B686-0B11E150D3DD@rabbitmq.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
	<18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
	<CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>
	<CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>
	<CAE3HoVRGNooZ-DzqJjL2Af-ZnPnA7PbMTWAZPPbhOzAkQk2kGQ@mail.gmail.com>
	<E82DC032-5361-410A-B686-0B11E150D3DD@rabbitmq.com>
Message-ID: <CAE3HoVTfe7ZU3HJG0weeJQThmC47VDg-BdaghpHqEHzNjjKeqA@mail.gmail.com>

2013/5/13 Tim Watson <watson.timothy at gmail.com>

> Hmm. How long did that take? I can kick off a run overnight an let it stew
> I suppose. How much memory has your machine got?
>

4 GB. It's not a powerful machine, although it does have an SSD which
should offset the effect of paging somewhat.


>
> Purging the queue helps with new connections but messages are still not
> delivered to the consumer when I restart
> the producer.
>
>
> I didn't pick that up from the original post. Is this happening after the
> alarm has been unset?
>

As far as I can tell, yes.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/c3ce2d1a/attachment.htm>

From hackeron at gmail.com  Mon May 13 19:35:00 2013
From: hackeron at gmail.com (Roman Gaufman)
Date: Mon, 13 May 2013 19:35:00 +0100
Subject: [rabbitmq-discuss] Federating to a single upstream
Message-ID: <CAAs9BZOgS3ixuvLW-YKbNUPSFb-JeTGYRpA61B0Q1JSkq7qkDw@mail.gmail.com>

How do I set a policy to federate to a single upstream? - I have many
upstreams that I need to federate a different exchange to individually.

Do I need to create an "upstream_set" for every individual upstream? - It
seems messy to have a bunch of upstream "sets" that only have 1 upstream in
each.

Maybe an option like: federation-upstream":"upstream-name" or something
similar can be added?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/620b9bee/attachment.htm>

From watson.timothy at gmail.com  Mon May 13 20:26:02 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 13 May 2013 20:26:02 +0100
Subject: [rabbitmq-discuss] Resource alarms in 3.1 seems to block
	operations other than basic.publish
In-Reply-To: <CAE3HoVTfe7ZU3HJG0weeJQThmC47VDg-BdaghpHqEHzNjjKeqA@mail.gmail.com>
References: <CAE3HoVSaAZg5tppPnZoquazG0rXdeMpN0+WrYbwxLW5PaO2oAQ@mail.gmail.com>
	<CAE3HoVSzDkPA4k3yZ60dSrNLR3dswGx9cqcJYer+MEUtf60W3A@mail.gmail.com>
	<03C27B52-B777-4FD3-B3A5-0ED2494BF503@rabbitmq.com>
	<CAE3HoVSe3R29RPA+vr13veQZBDKVjk=rK0iLfxRNtmPPfO+F+g@mail.gmail.com>
	<EAF7B6FC-4AAF-46BC-B47C-8622821C735A@rabbitmq.com>
	<CAE3HoVTPjQAHFDf0kkbVr+DBji1b0YGy1hm_Xt4D=PvFAnmfxg@mail.gmail.com>
	<18C4F90A-520A-4300-84CC-9F2014641988@rabbitmq.com>
	<CAE3HoVQfsHWXc_ueyV9fjo05uGk8S3ojAPEGCrqGtYF0RKKZpw@mail.gmail.com>
	<CC6C8353-CFC6-4F69-9C1B-075AAF30D676@rabbitmq.com>
	<CAE3HoVRGNooZ-DzqJjL2Af-ZnPnA7PbMTWAZPPbhOzAkQk2kGQ@mail.gmail.com>
	<E82DC032-5361-410A-B686-0B11E150D3DD@rabbitmq.com>
	<CAE3HoVTfe7ZU3HJG0weeJQThmC47VDg-BdaghpHqEHzNjjKeqA@mail.gmail.com>
Message-ID: <88799E5B-A7C6-4526-9F39-779A3D896315@rabbitmq.com>

On 13 May 2013, at 19:13, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 
> 2013/5/13 Tim Watson <watson.timothy at gmail.com>
> Hmm. How long did that take? I can kick off a run overnight an let it stew I suppose. How much memory has your machine got?
> 
> 4 GB. It's not a powerful machine, although it does have an SSD which should offset the effect of paging somewhat.

Yeah, but I'm kinda with Matthias on this one. If the whole machine is grinding, it sounds a lot like you've exhausted the available resources and under those circumstances a whole bunch of things are going to crawl.

>  
> 
>> Purging the queue helps with new connections but messages are still not delivered to the consumer when I restart
>> the producer.
> 
> I didn't pick that up from the original post. Is this happening after the alarm has been unset?
> As far as I can tell, yes.

That's the key thing here. If the alarm isn't unset, the producer won't be able to proceed. It sounds a lot like (a) the whole os is jammed due to resource exhaustion and (b) the alarm could still be set.

If that weren't the case, I'd expect to be able to reproduce it with a much lower threshold and even if I'm wrong, it doesn't doesn't replicate for me (in terms of the queue being non-empty) even on a single host.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/d41f4848/attachment.htm>

From chadmichaeldavis at gmail.com  Mon May 13 21:43:54 2013
From: chadmichaeldavis at gmail.com (ChadDavis)
Date: Mon, 13 May 2013 14:43:54 -0600
Subject: [rabbitmq-discuss] newbie question about exchange declaration
Message-ID: <CABF62pkuB0vFf4KUbapBgZ7iFXgVNDNA-Qgi+n+SLr3oEiasUA@mail.gmail.com>

I'm going through the Java PubSub tutorial [1].  I don't quite
understand why the consumer side code ( ReceiveLogs.java ) has the
exchangeDeclaration method call.  Seems like that's the produced side
code.

        channel.exchangeDeclare(EXCHANGE_NAME, "fanout");


Is this just so that whoever get's there first, producer or consumer,
can create the exchange so they can move on to their other chores,
such as queuebinding in the case of the consumer?

1  http://www.rabbitmq.com/tutorials/tutorial-three-java.html

From michael.s.klishin at gmail.com  Mon May 13 22:17:59 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 14 May 2013 01:17:59 +0400
Subject: [rabbitmq-discuss] newbie question about exchange declaration
In-Reply-To: <CABF62pkuB0vFf4KUbapBgZ7iFXgVNDNA-Qgi+n+SLr3oEiasUA@mail.gmail.com>
References: <CABF62pkuB0vFf4KUbapBgZ7iFXgVNDNA-Qgi+n+SLr3oEiasUA@mail.gmail.com>
Message-ID: <CAE3HoVQX_RRw1Avk61vPkTHM3Z6SFedJuNM7qcphgazXK9gKFw@mail.gmail.com>

2013/5/14 ChadDavis <chadmichaeldavis at gmail.com>

> Is this just so that whoever get's there first, producer or consumer,
> can create the exchange so they can move on to their other chores,
> such as queuebinding in the case of the consumer?
>

Correct.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/f8e719ef/attachment.htm>

From john.beck at oracle.com  Mon May 13 22:29:13 2013
From: john.beck at oracle.com (John Beck)
Date: Mon, 13 May 2013 14:29:13 -0700
Subject: [rabbitmq-discuss] stability of on-disk formats
Message-ID: <201305132129.r4DLTDei002823@opal.us.oracle.com>

Greetings,

We are trying to determine the optimal paths for various on-disk storage
locations (e.g., message store, databases) of RabbitMQ on Solaris, and need
a key piece of information to make this decision.  That is whether the on-disk
formats are generally compatible across upgrades or not.

Background: Solaris supports Boot Environments (BEs; see beadm(1m) for
details).  These allow for easy fall-back if something goes wrong with an OS
upgrade or the system is otherwise damaged.  As such, one factor that needs
to be considered with most sub-systems that use persistent storage is whether
that storage should be in a path that is BE-dependent or BE-independent.
The key considerations are these:

* The time from when an old BE is cloned until a new BE is booted into
  represents a window of potential loss or duplication of messages if BE-
  dependent paths are used.
* For software with version incompatibilities across upgrades, a potential
  inability to handle older (or occasionally newer) message formats exists
  if BE-independent paths are used.

The former consideration generally presents a much greater risk than the
latter, especially for software that is relatively stable in terms of its
on-disk storage formats.

If, as we hope, and some mailing list search hits from 2011 suggested, the
on-disk formats used by RabbitMQ are generally compatible, then we can store
everything in paths that are BE-independent, as this would have the huge
advantage of not losing or duplicating data across upgrades.  In particular,
a message from Simon MacMullen in March 2011 (thread subject: "Rolling upgrade
of a cluster") suggested that upgrades from 2.1.1 onwards would be nearly
seamless if some simple steps were followed, which sounds hopeful that the
formats in question are relatively compatible, or at least easily manageable,
but it seems prudent to ask rather than risk misunderstanding.  So here I am
asking.  :-)

Thank you for your time...

-- John

http://blogs.oracle.com/jbeck/

From stefan.sedich at gmail.com  Tue May 14 05:52:08 2013
From: stefan.sedich at gmail.com (Stefan Sedich)
Date: Mon, 13 May 2013 21:52:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Production cluster fun,
 make that not so fun (production cluster setup guidance)!
Message-ID: <a9bb05f0-febb-4e1f-98ea-99aed190f9ea@googlegroups.com>

What is the ideal setup for our production cluster, currently we have two 
ABs with two nodes in each, after setting pause_minority today and having a 
partition where all nodes were paused, we changed to autoheal and restarted 
all nodes. In the midst of this something happened, and even rolling back 
to just 1 node apps were not able to connect to the node.

In the end my only fix was to completely trash the db/ of that one node and 
restart it which got things working again (no idea what got corrupted or 
how but something went bad). Now after this is would be good for some 
guidance on how to properly configure out cluster and how many nodes would 
be ideal and what recovery node to use (we seem to occasionally have 
a partition, even though it SHOULD be a stable link).



Thanks
Stefan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/bcdf7dad/attachment.htm>

From davidlan at iii.org.tw  Tue May 14 06:07:23 2013
From: davidlan at iii.org.tw (=?UTF-8?B?IuiXjee0uee3ryAtIChkYXZpZCki?=)
Date: Tue, 14 May 2013 13:07:23 +0800
Subject: [rabbitmq-discuss] About the JSonRPC data length limit?
Message-ID: <5191C68B.4030309@iii.org.tw>

Dear All:


I design a c++ program which runs http post to RabbitMQ JSonRPC?now I 
have a xml file data, translate it into json format?but when I send the 
http post with long json data, the RabbitMQ crashed?

I am sure the content all sent by my program.  If I send shorter length 
of data, it is ok, why?

I test a simple web to receive the post data, it is all OK.

and I use the jsonrpc example js to test, i want to change the timeout 
setting, but the log(/var/log/rabbitmq/rabbitmq.log) always shows HTTP 
Channel started, timeout 5.




From natewang0425 at gmail.com  Tue May 14 07:09:46 2013
From: natewang0425 at gmail.com (Nate)
Date: Mon, 13 May 2013 23:09:46 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <519109A1.1080301@rabbitmq.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
Message-ID: <CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>

Hi Matthias,

    Thanks for your reply, I check the logs and there is no any "rotating
logs with suffix '..' " words in log.
     rabbitmqctl eval 'process_info(whereis(error_**logger)).' return as
following,

[{registered_name,error_logger},

{current_function,{gen_event,fetch_msg,5}},

{initial_call,{proc_lib,init_p,5}},

{status,waiting},

{message_queue_len,0},

{messages,[]},

{links,[<5242.0.0>,<5242.29.0>]},

{dictionary,[{{xtype_to_module,topic},rabbit_exchange_type_topic},

              {'$ancestors',[<5242.2.0>]},

              {'$initial_call',{gen_event,init_it,6}},

              {guid,{{496409951,681863946,2858878647,2261331332},10687}}]},

{trap_exit,true},

{error_handler,error_handler},

{priority,normal},

{group_leader,<5242.29.0>},

{total_heap_size,610},

{heap_size,610},

{stack_size,8},

{reductions,11393485},

{garbage_collection,[{min_bin_vheap_size,46368},

                      {min_heap_size,233},

                      {fullsweep_after,65535},

                      {minor_gcs,0}]},

{suspending,[]}]

...done.


2013/5/13 Matthias Radestock-3 [via RabbitMQ] <
ml-node+s1065348n26627h2 at n5.nabble.com>

> On 13/05/13 10:42, Nate wrote:
> >      Thanks your reply, I use 3.0.1 rabbitmq with erlang R15B.
>
> Are there any "Rotating logs with suffix '...'" messages in the rabbit
> log?
>
> Also, what does
>
>    rabbitmqctl eval 'process_info(whereis(error_logger)).'
>
> return?
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=26627&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26627.html
>  To unsubscribe from Re: After weekly log rotatation was done, the command
> "rabbitmqctl rotate-logs" never stop, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=26607&code=bmF0ZXdhbmcwNDI1QGdtYWlsLmNvbXwyNjYwN3w0NTY2Njg2Njk=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26649.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/c78aa419/attachment.htm>

From bison_art at o2.pl  Tue May 14 07:34:37 2013
From: bison_art at o2.pl (rabbit15)
Date: Mon, 13 May 2013 23:34:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <519124A5.805@rabbitmq.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
Message-ID: <1368513277366-26650.post@n5.nabble.com>

Hi, thanks for the reply! I don't send 1 GB sized message, but all my stored
messages size was 1 GB. My message size is 609 bytes. I have 92 GB RAM on my
server, and after 600000 messages was stored there is a lot of memory taken
by the RabbitMQ.
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26650.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bison_art at o2.pl  Tue May 14 08:13:46 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 14 May 2013 00:13:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368513277366-26650.post@n5.nabble.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
Message-ID: <1368515626832-26651.post@n5.nabble.com>

This is my status output

./rabbitmqctl status
Status of node rabbit at katlabucs2 ...
[{pid,6225},
 {running_applications,
     [{rabbitmq_perfmon,"Embedded Rabbit Perfmon","0.0.0"},
      {rabbitmq_tracing,"RabbitMQ message logging / tracing","3.1.0"},
      {rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},
      {rabbit,"RabbitMQ","3.1.0"},
      {os_mon,"CPO  CXC 138 46","2.2.10"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
      {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.0-gitd541e9a"},
      {xmerl,"XML parser","1.3.2"},
      {inets,"INETS  CXC 138 49","5.9.1"},
      {mnesia,"MNESIA  CXC 138 12","4.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {stdlib,"ERTS  CXC 138 10","1.18.2"},
      {kernel,"ERTS  CXC 138 10","2.15.2"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B02 (erts-5.9.2) [source] [64-bit] [smp:24:24]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,31946238720},
      {connection_procs,526019096},
      {queue_procs,3060711792},
      {plugins,1325624},
      {other_proc,1414282513},
      {mnesia,820584},
      {mgmt_db,14060336},
      {msg_index,262032},
      {other_ets,3983176},
      {binary,26892354848},
      {code,18609290},
      {atom,703377},
      {other_system,13106052}]},
 {vm_memory_high_watermark,100.0},
 {vm_memory_limit,10152182579200},
 {disk_free_limit,0},
 {disk_free,1058472718336},
 {file_descriptors,
     [{total_limit,924},
      {total_used,491},
      {sockets_limit,829},
      {sockets_used,489}]},
 {processes,[{limit,1048576},{used,5847}]},
 {run_queue,214},
 {uptime,461}]
...done.


------------------
Cheers,
Artur




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26651.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Tue May 14 08:20:10 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 14 May 2013 11:20:10 +0400
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368513277366-26650.post@n5.nabble.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com> <1368513277366-26650.post@n5.nabble.com>
Message-ID: <CAE3HoVQAH5q7vHxGUUH12xJU022DnuRO2xOpz-rrEWqZkiv6Vw@mail.gmail.com>

2013/5/14 rabbit15 <bison_art at o2.pl>

> I have 92 GB RAM on my
> server, and after 600000 messages was stored there is a lot of memory taken
> by the RabbitMQ.
>

Use rabbitmqctl status
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/5719b7fa/attachment.htm>

From bison_art at o2.pl  Tue May 14 08:40:56 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 14 May 2013 00:40:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <CAE3HoVQAH5q7vHxGUUH12xJU022DnuRO2xOpz-rrEWqZkiv6Vw@mail.gmail.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<CAE3HoVQAH5q7vHxGUUH12xJU022DnuRO2xOpz-rrEWqZkiv6Vw@mail.gmail.com>
Message-ID: <1368517256209-26653.post@n5.nabble.com>

I had paste it.
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26653.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue May 14 10:10:09 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 14 May 2013 10:10:09 +0100
Subject: [rabbitmq-discuss] stability of on-disk formats
In-Reply-To: <201305132129.r4DLTDei002823@opal.us.oracle.com>
References: <201305132129.r4DLTDei002823@opal.us.oracle.com>
Message-ID: <5191FF71.9030905@rabbitmq.com>


Hi John,

On 13/05/13 22:29, John Beck wrote:
> That is whether the on-disk formats are generally compatible across
> upgrades or not.
Yes, the on-disk formats are generally stable across minor releases, and
whenever they do change brokers automatically upgrade the on-disk format
from as old as v2.1.1 when the broker starts up. One combination that
will not work is if an older broker (even post-v2.1.1) is booted with
the disk storage produced by a newer broker, where the disk storage
format of the newer broker is different.

In general the on-disk format is more likely to change across feature
releases (e.g. between v2.8.7 and v3.0.0) than minor releases (e.g.
v3.0.0 to v3.0.1)

You should take note of the clustering upgrade documentation in case of
a clustered environment:
http://www.rabbitmq.com/clustering.html#upgrading





-Emile

From balachandar.ra at gmail.com  Tue May 14 10:21:55 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Tue, 14 May 2013 14:51:55 +0530
Subject: [rabbitmq-discuss] New bie question
In-Reply-To: <CALEC75JCWvmznOUSfNqZVTC401U01-=uxUdstnR4V=OFJ_kmKQ@mail.gmail.com>
References: <CALEC75+oJL0x_fzTgRQODhcU=TteSoX1u+tH3RBZ9RwH5f7Q5w@mail.gmail.com>
	<CALEC75JCWvmznOUSfNqZVTC401U01-=uxUdstnR4V=OFJ_kmKQ@mail.gmail.com>
Message-ID: <CALEC75KD8Wjtbb6W1MY5N8tPVwg-Edf_aHdpOwnoDfGu9GEhQA@mail.gmail.com>

Hello

I have an application wherein I send group of mesages for processing by
remote consumers. I need to send another messages only after all the
previous messages are processed. Can anyone give me a hint here?
right now, I wait for a return message from the consumers and count the
number of return messages to the number of messages sent.anyother effective
way will be interesting

Balson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/e3c3887c/attachment.htm>

From michael.s.klishin at gmail.com  Tue May 14 10:59:39 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 14 May 2013 13:59:39 +0400
Subject: [rabbitmq-discuss] New bie question
In-Reply-To: <CALEC75KD8Wjtbb6W1MY5N8tPVwg-Edf_aHdpOwnoDfGu9GEhQA@mail.gmail.com>
References: <CALEC75+oJL0x_fzTgRQODhcU=TteSoX1u+tH3RBZ9RwH5f7Q5w@mail.gmail.com>
	<CALEC75JCWvmznOUSfNqZVTC401U01-=uxUdstnR4V=OFJ_kmKQ@mail.gmail.com>
	<CALEC75KD8Wjtbb6W1MY5N8tPVwg-Edf_aHdpOwnoDfGu9GEhQA@mail.gmail.com>
Message-ID: <CAE3HoVQKispEDbz_V3o8fq4wpubGt4nVPVNhm_ejX8z688jCYQ@mail.gmail.com>

2013/5/14 Balachandar R.A. <balachandar.ra at gmail.com>

> right now, I wait for a return message from the consumers and count the
> number of return messages to the number of messages sent


Given that consumers may fail, this is the only realistic way in my opinion.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/96eec27c/attachment.htm>

From simon at rabbitmq.com  Tue May 14 11:06:35 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 11:06:35 +0100
Subject: [rabbitmq-discuss] Federating to a single upstream
In-Reply-To: <CAAs9BZOgS3ixuvLW-YKbNUPSFb-JeTGYRpA61B0Q1JSkq7qkDw@mail.gmail.com>
References: <CAAs9BZOgS3ixuvLW-YKbNUPSFb-JeTGYRpA61B0Q1JSkq7qkDw@mail.gmail.com>
Message-ID: <51920CAB.3030406@rabbitmq.com>

On 13/05/13 19:35, Roman Gaufman wrote:
> How do I set a policy to federate to a single upstream? - I have many
> upstreams that I need to federate a different exchange to individually.
>
> Do I need to create an "upstream_set" for every individual upstream? -
> It seems messy to have a bunch of upstream "sets" that only have 1
> upstream in each.

Yeah, at the moment the assumption is that the average case is to 
federate a set of exchanges (more or less) many-to-many with a set of 
upstreams. The 1-1 case is assumed to be rarer.

> Maybe an option like: federation-upstream":"upstream-name" or something
> similar can be added?

Not an unreasonable request. I'll file a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue May 14 11:11:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 11:11:44 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
Message-ID: <51920DE0.8080503@rabbitmq.com>

On 13/05/13 18:18, Roman Gaufman wrote:
> I want to have 20 or so clients reading/writing to a local rabbitmq
> which will federate to a central server (in both directions). Each
> client has a separate username, password and permissions.
>
> Reason it is done this way is the servers are on very unstable
> connections on the move.
>
> Right now, when I try to connect more than 1 federation upstream, I
> get:  ** {error,user_does_not_exist}
>
> It seems all of these servers need to be forced to use the same
> username? - Why is this? - Is there any way not to have a
> "local-username" but rather to accept all usernames?

I am not sure I understand what you are saying. The "local-username" 
parameter is used by the federation mechanism as the local user as which 
to publish messages which have been received over federation. It doesn't 
have anything to do with the remote user (which is encoded in the 
upstream URL).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue May 14 11:16:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 11:16:53 +0100
Subject: [rabbitmq-discuss] stability of on-disk formats
In-Reply-To: <201305132129.r4DLTDei002823@opal.us.oracle.com>
References: <201305132129.r4DLTDei002823@opal.us.oracle.com>
Message-ID: <51920F15.6030308@rabbitmq.com>

On 13/05/13 22:29, John Beck wrote:
> If, as we hope, and some mailing list search hits from 2011 suggested, the
> on-disk formats used by RabbitMQ are generally compatible,

They are upgrade-compatible. If you have a 2.8.7 installation and 
upgrade to 3.1.0, RabbitMQ will upgrade the on-disk data from the 2.8.x 
format to the 3.1.x format the first time it boots, but you won't then 
be able to go back.

As Emile says, we guarantee that the format will not change from a.b.x 
to a.b.y, so you can upgrade / downgrade within a bugfix release series, 
but you can't (in general) go back to a previous feature release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue May 14 11:23:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 11:23:18 +0100
Subject: [rabbitmq-discuss] About the JSonRPC data length limit?
In-Reply-To: <5191C68B.4030309@iii.org.tw>
References: <5191C68B.4030309@iii.org.tw>
Message-ID: <51921096.90108@rabbitmq.com>

On 14/05/13 06:07, "??? - (david)" wrote:
> I design a c++ program which runs http post to RabbitMQ JSonRPC

I should warn you that the JSON-RPC plugin is not much loved any more. 
It was designed to support messaging to the browser in a world in which 
websockets did not exist; and as such it's full of oddness. If you are 
writing a standalone application then I cannot think of a good reason to 
use JSON-RPC.

> now I
> have a xml file data, translate it into json format?but when I send the
> http post with long json data, the RabbitMQ crashed?

Can you provide more information about the crash?

> and I use the jsonrpc example js to test, i want to change the timeout
> setting, but the log(/var/log/rabbitmq/rabbitmq.log) always shows HTTP
> Channel started, timeout 5.

As I said in my previous mail, I just edited test.js line 16 and it worked.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Tue May 14 11:23:52 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 14 May 2013 11:23:52 +0100
Subject: [rabbitmq-discuss] Proudly part of Pivotal
In-Reply-To: <51920954.9070604@rabbitmq.com>
References: <51920954.9070604@rabbitmq.com>
Message-ID: <519210B8.7060803@rabbitmq.com>


RabbitMQ v3.1.0 is significant because it introduces an important set of
new features, making Rabbit easier to use and manage. [1]

 - Eager synchronisation of mirror queue slaves
 - Automatic cluster partition healing
 - Improved statistics

V3.1.0 has significance for another reason: it is the first release made
under the banner of our new sponsor company, Pivotal.  Pivotal launched
earlier this year as a joint venture between VMware, EMC and with a
strategic partnership with General Electric Global Software.  Billed as
"A New Platform for a New Era", the Pivotal platform will unite data,
application, and cloud fabrics. [2] The Rabbit team members are excited
to be part of this bold new initiative driving open source innovation
and collaboration.

RabbitMQ will continue to be available under the open source Mozilla
Public License [3] or commercial terms. Commercial support, consulting
and both self-paced and Instructor-led training courses are still
available worldwide. The rabbitmq-discuss mailing list [4] will continue
to be the primary channel of communication about open-source RabbitMQ.
The release cycle is not expected to change as a result of the change of
ownership.

We invite all customers to continue with us on the journey to become the
most reliable, scalable and portable messaging system.


[1] https://www.rabbitmq.com/blog/2013/05/01/rabbitmq-3-1-0-in-images/
[2] http://gopivotal.com/
[3] http://www.rabbitmq.com/mpl.html
[4] http://www.rabbitmq.com/contact.html




-- 
Emile Joubert

RabbitMQ
Pivotal





From balachandar.ra at gmail.com  Tue May 14 11:26:43 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Tue, 14 May 2013 15:56:43 +0530
Subject: [rabbitmq-discuss] New bie question
In-Reply-To: <CAE3HoVQKispEDbz_V3o8fq4wpubGt4nVPVNhm_ejX8z688jCYQ@mail.gmail.com>
References: <CALEC75+oJL0x_fzTgRQODhcU=TteSoX1u+tH3RBZ9RwH5f7Q5w@mail.gmail.com>
	<CALEC75JCWvmznOUSfNqZVTC401U01-=uxUdstnR4V=OFJ_kmKQ@mail.gmail.com>
	<CALEC75KD8Wjtbb6W1MY5N8tPVwg-Edf_aHdpOwnoDfGu9GEhQA@mail.gmail.com>
	<CAE3HoVQKispEDbz_V3o8fq4wpubGt4nVPVNhm_ejX8z688jCYQ@mail.gmail.com>
Message-ID: <CALEC75JSJzD5bM6T9rOabiSj8nv78cHgsXBZ3cnSA6YzXS8CEQ@mail.gmail.com>

Thanks for the reply

Now, can someone give me a pointer on how to get the size of a queue?

Balson
On 14 May 2013 15:31, "Michael Klishin" <michael.s.klishin at gmail.com> wrote:

>
> 2013/5/14 Balachandar R.A. <balachandar.ra at gmail.com>
>
>> right now, I wait for a return message from the consumers and count the
>> number of return messages to the number of messages sent
>
>
> Given that consumers may fail, this is the only realistic way in my
> opinion.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/357288af/attachment.htm>

From michael.s.klishin at gmail.com  Tue May 14 11:42:33 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 14 May 2013 14:42:33 +0400
Subject: [rabbitmq-discuss] New bie question
In-Reply-To: <CALEC75JSJzD5bM6T9rOabiSj8nv78cHgsXBZ3cnSA6YzXS8CEQ@mail.gmail.com>
References: <CALEC75+oJL0x_fzTgRQODhcU=TteSoX1u+tH3RBZ9RwH5f7Q5w@mail.gmail.com>
	<CALEC75JCWvmznOUSfNqZVTC401U01-=uxUdstnR4V=OFJ_kmKQ@mail.gmail.com>
	<CALEC75KD8Wjtbb6W1MY5N8tPVwg-Edf_aHdpOwnoDfGu9GEhQA@mail.gmail.com>
	<CAE3HoVQKispEDbz_V3o8fq4wpubGt4nVPVNhm_ejX8z688jCYQ@mail.gmail.com>
	<CALEC75JSJzD5bM6T9rOabiSj8nv78cHgsXBZ3cnSA6YzXS8CEQ@mail.gmail.com>
Message-ID: <CAE3HoVSjjLmrAOm6=XBtZOV5CfGJ1ORpq3J6TsGRhG023haDfg@mail.gmail.com>

2013/5/14 Balachandar R.A. <balachandar.ra at gmail.com>

> Now, can someone give me a pointer on how to get the size of a queue?


Use queue.declare with passive = true. queue.declare-ok you get in response
will
contain the number of messages ready.

HTTP API can be used as well.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/b2fcaa90/attachment.htm>

From bison_art at o2.pl  Tue May 14 11:59:47 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 14 May 2013 03:59:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368517256209-26653.post@n5.nabble.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<CAE3HoVQAH5q7vHxGUUH12xJU022DnuRO2xOpz-rrEWqZkiv6Vw@mail.gmail.com>
	<1368517256209-26653.post@n5.nabble.com>
Message-ID: <1368529187230-26664.post@n5.nabble.com>

Do you have all necessary data ?
I had paste my output before.
Cheers,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26664.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From balachandar.ra at gmail.com  Tue May 14 12:12:00 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Tue, 14 May 2013 16:42:00 +0530
Subject: [rabbitmq-discuss] New bie question
In-Reply-To: <CAE3HoVSjjLmrAOm6=XBtZOV5CfGJ1ORpq3J6TsGRhG023haDfg@mail.gmail.com>
References: <CALEC75+oJL0x_fzTgRQODhcU=TteSoX1u+tH3RBZ9RwH5f7Q5w@mail.gmail.com>
	<CALEC75JCWvmznOUSfNqZVTC401U01-=uxUdstnR4V=OFJ_kmKQ@mail.gmail.com>
	<CALEC75KD8Wjtbb6W1MY5N8tPVwg-Edf_aHdpOwnoDfGu9GEhQA@mail.gmail.com>
	<CAE3HoVQKispEDbz_V3o8fq4wpubGt4nVPVNhm_ejX8z688jCYQ@mail.gmail.com>
	<CALEC75JSJzD5bM6T9rOabiSj8nv78cHgsXBZ3cnSA6YzXS8CEQ@mail.gmail.com>
	<CAE3HoVSjjLmrAOm6=XBtZOV5CfGJ1ORpq3J6TsGRhG023haDfg@mail.gmail.com>
Message-ID: <CALEC75LyNdbZjGUo_C-93MF9FQzv==GripyB9f-FbCi772OAyg@mail.gmail.com>

Thanks for the info!
On 14 May 2013 16:14, "Michael Klishin" <michael.s.klishin at gmail.com> wrote:

>
> 2013/5/14 Balachandar R.A. <balachandar.ra at gmail.com>
>
>> Now, can someone give me a pointer on how to get the size of a queue?
>
>
> Use queue.declare with passive = true. queue.declare-ok you get in
> response will
> contain the number of messages ready.
>
> HTTP API can be used as well.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/cd6cb145/attachment.htm>

From matthias at rabbitmq.com  Tue May 14 12:22:06 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 May 2013 12:22:06 +0100
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368515626832-26651.post@n5.nabble.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
Message-ID: <51921E5E.5000603@rabbitmq.com>

On 14/05/13 08:13, rabbit15 wrote:
> This is my status output
>
> ./rabbitmqctl status
> Status of node rabbit at katlabucs2 ...
> [{pid,6225},
>   {running_applications,
>       [{rabbitmq_perfmon,"Embedded Rabbit Perfmon","0.0.0"},

What is that? I suggest you remove it, in order to eliminate it as a 
potential source of the memory usage.

>        {rabbitmq_tracing,"RabbitMQ message logging / tracing","3.1.0"},
>        {rabbitmq_management,"RabbitMQ Management Console","3.1.0"},

I suggest you disable these two for testing.

>   {erlang_version,
>       "Erlang R15B02 (erts-5.9.2) [source] [64-bit] [smp:24:24]
> [async-threads:30] [hipe] [kernel-poll:true]\n"},

I suggest you upgrade to R16B.

>   {memory,
>       [{total,31946238720},
>        {connection_procs,526019096},
>        {queue_procs,3060711792},
>        {plugins,1325624},
>        {other_proc,1414282513},
>        {mnesia,820584},
>        {mgmt_db,14060336},
>        {msg_index,262032},
>        {other_ets,3983176},
>        {binary,26892354848},
>        {code,18609290},
>        {atom,703377},
>        {other_system,13106052}]},

That's a lot of memory for 600k messages of 609 bytes.

Here's what I'm seeing on my system:

$ rabbitmqctl list_queues -q
amq.gen-Gy2b_JHk7bMO3qi_4aSEkg	600000
$ rabbitmqctl status -q
[{pid,27026},
  {running_applications,[{rabbit,"RabbitMQ","%%VSN%%"},
                         {mnesia,"MNESIA  CXC 138 12","4.8"},
                         {os_mon,"CPO  CXC 138 46","2.2.11"},
                         {xmerl,"XML parser","1.3.3"},
                         {sasl,"SASL  CXC 138 11","2.3.1"},
                         {stdlib,"ERTS  CXC 138 10","1.19.1"},
                         {kernel,"ERTS  CXC 138 10","2.16.1"}]},
  {os,{unix,linux}},
  {erlang_version,"Erlang R16B (erts-5.10.1) [source] [64-bit] [smp:8:8] 
[async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,[{total,894421208},
           {connection_procs,48240},
           {queue_procs,441492368},
           {plugins,0},
           {other_proc,9551544},
           {mnesia,62344},
           {mgmt_db,0},
           {msg_index,39688},
           {other_ets,885912},
           {binary,420690720},
           {code,16465723},
           {atom,561761},
           {other_system,4622908}]},
  {vm_memory_high_watermark,0.4},
  {vm_memory_limit,5038887731},
  {disk_free_limit,1000000000},
  {disk_free,395367772160},
  {file_descriptors,[{total_limit,924},
                     {total_used,4},
                     {sockets_limit,829},
                     {sockets_used,2}]},
  {processes,[{limit,1048576},{used,143}]},
  {run_queue,0},
  {uptime,383}]

As you can see, that's using just ~900MB of memory.

I used the MulticastMain program that ships with the Java client for 
testing:

$ runjava.sh com.rabbitmq.examples.MulticastMain -q 1 -n 2 -s 609 -C 600000

You may want to try that too, in order to ascertain whether the results 
differ from your own test program.

Regards,

Matthias.

From hackeron at gmail.com  Tue May 14 12:37:26 2013
From: hackeron at gmail.com (Roman Gaufman)
Date: Tue, 14 May 2013 12:37:26 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <51920DE0.8080503@rabbitmq.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
	<51920DE0.8080503@rabbitmq.com>
Message-ID: <CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>

Maybe I'm misunderstanding how this is meant to work - I have 3 RabbitMQs:

Cloud (10.9.0.1)
London (10.9.0.2)
Moscow (10.9.0.3)

I want to federate messages from London and Moscow to Cloud. I create 2
username/passwords on the "Cloud" rabbitmq (with appropriate permissions):

london:password1
moscow:password2

I then add 1 upstream for the London and 1 upstream for the Moscow RabbitMQ:

London: amqp://london:password1 at 10.9.0.1/oracle
Moscow: amqp://moscow:password1 at 10.9.0.1/oracle

The upstreams point to the Cloud RabbitMQ IP which has the appropriate
usernames/passwords and permissions.

Now when I crate a federate-me policy, I get an error
"{error,user_does_not_exist}" unless I set a local-username on the Cloud
RabbitMQ with:

rabbitmqctl -p oracle set_parameter federation local-username '"London"'

Then the London RabbitMQ is able to connect, but Moscow still says
user_does_not_exist. My question is why is this and how do I accept both
usernames?

Roman


On 14 May 2013 11:11, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/05/13 18:18, Roman Gaufman wrote:
>
>> I want to have 20 or so clients reading/writing to a local rabbitmq
>> which will federate to a central server (in both directions). Each
>> client has a separate username, password and permissions.
>>
>> Reason it is done this way is the servers are on very unstable
>> connections on the move.
>>
>> Right now, when I try to connect more than 1 federation upstream, I
>> get:  ** {error,user_does_not_exist}
>>
>> It seems all of these servers need to be forced to use the same
>> username? - Why is this? - Is there any way not to have a
>> "local-username" but rather to accept all usernames?
>>
>
> I am not sure I understand what you are saying. The "local-username"
> parameter is used by the federation mechanism as the local user as which to
> publish messages which have been received over federation. It doesn't have
> anything to do with the remote user (which is encoded in the upstream URL).
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/c8ca4370/attachment.htm>

From simon at rabbitmq.com  Tue May 14 12:59:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 12:59:00 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
	<51920DE0.8080503@rabbitmq.com>
	<CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>
Message-ID: <51922704.6020105@rabbitmq.com>

On 14/05/13 12:37, Roman Gaufman wrote:
> Maybe I'm misunderstanding how this is meant to work - I have 3 RabbitMQs:
>
> Cloud (10.9.0.1)
> London (10.9.0.2)
> Moscow (10.9.0.3)
>
> I want to federate messages from London and Moscow to Cloud.

Meaning that messages published in London and Moscow can be consumed in 
Cloud.

> I create 2
> username/passwords on the "Cloud" rabbitmq (with appropriate permissions):
>
> london:password1
> moscow:password2
>
> I then add 1 upstream for the London and 1 upstream for the Moscow RabbitMQ:
>
> London: amqp://london:password1 at 10.9.0.1/oracle
> <http://london:password1 at 10.9.0.1/oracle>
> Moscow: amqp://moscow:password1 at 10.9.0.1/oracle
> <http://moscow:password1 at 10.9.0.1/oracle>

Did you do that on the Cloud machine? It sounds like you did - but here 
you're telling it to connect to itself?

I think what you want to do is:

* Create the London / Moscow users on the London / Moscow boxes
* Add upstreams for London / Moscow on Cloud, pointing to the London / 
Moscow machines
* Set the federation policy on Cloud
* If you have deleted / restricted the "guest" account on Cloud, then 
set "local-username" to another account that is able to publish messages

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Tue May 14 13:05:55 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 14 May 2013 16:05:55 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre11 is released
Message-ID: <CAE3HoVS1tWSnw3yW4Za=cpM0DPoHhUjNR=m2NVbHV=tD7KRS5g@mail.gmail.com>

Bunny 0.9.0.pre11 is released to rubygems.org [1].

This release includes minor features, stability and publishing
performance improvements.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/05/14/bunny-0-dot-9-0-dot-pre11-is-released/

1. http://rubygems.org/gems/bunny/versions/0.9.0.pre11
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/e6efe187/attachment.htm>

From emile at rabbitmq.com  Tue May 14 14:06:45 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 14 May 2013 14:06:45 +0100
Subject: [rabbitmq-discuss] WCF bind error VS 2010
In-Reply-To: <CAO6pa4QXqhKxTByiC9i5epo6YAvwzPjSdUfKkDMta-dWjTCi8g@mail.gmail.com>
References: <CAO6pa4QXqhKxTByiC9i5epo6YAvwzPjSdUfKkDMta-dWjTCi8g@mail.gmail.com>
Message-ID: <519236E5.4010906@rabbitmq.com>

Hi,

On 12/05/13 16:16, Jimi Riblei wrote:
> But when I choose  the DLL I get this error:
> Could not load file or assembly file '' or one of its dependences.
> Operation is not supported


I'm afraid I'm not able to reproduce the problem, after succeeding with
the service configuration editors included with Windows SDK v6 as well
as v7 on Windows XP and Windows 7. Make sure you have appropriate
permissions for the RabbitMQ ServiceModel assembly and all its dependencies.


-Emile







From hackeron at gmail.com  Tue May 14 14:24:11 2013
From: hackeron at gmail.com (Roman Gaufman)
Date: Tue, 14 May 2013 14:24:11 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <51922704.6020105@rabbitmq.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
	<51920DE0.8080503@rabbitmq.com>
	<CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>
	<51922704.6020105@rabbitmq.com>
Message-ID: <CAAs9BZPs+bH76uy0a06Q=XDsL2m8qK08S=hw3OfW_8pZ+4E9yw@mail.gmail.com>

>
>  Meaning that messages published in London and Moscow can be consumed in
>> Cloud.
>>
>
Yes but I want it biodirectional, I tried to simplify the example, but I
guess that wasn't helpful. What I want is:

   1. Cloud posts to local topic exchange "oracle.london" - this message is
   consumed by the London server.
   2. London posts to a local topic exchange  "oracle.london" - this
   message is consumed by the Cloud server.
   3. Moscow posts to a local topic exchange "oracle.moscow" - this message
   is consumed by the Cloud server.
   4. etc.

So Cloud consumes everything and the Local servers consume messages sent to
them by the Cloud - messages are not sent between servers otherwise. So
Cloud -> Local Servers and Local Servers -> Cloud (but not Local Server ->
Local Server).

 Did you do that on the Cloud machine? It sounds like you did - but here
>> you're telling it to connect to itself?
>>
>
No, the cloud is not connecting to itself, the Cloud is connecting to each
"Local" server (London and Moscow) and the "Local" servers connect to the
cloud.

Here are more details as to what I did (just with different
usernames/passwords) - I have 3 physical machines on the same VPN:

Cloud: 10.9.0.1
London: 10.9.0.2
Moscow: 10.9.0.3

They each have a RabbitMQ instance, on each one I do:

   1. Create vhost: oracle
   2. Create new users: moscow:password, london:password, cloud:password
   3. Set permissions for all users for the oracle vhost: .* .* .*
   4. Set local username and nodename
      1. Cloud: rabbitmqctl -p oracle set_parameter federation
      local-username '"Cloud"'
      2. London: rabbitmqctl -p oracle set_parameter federation
      local-nodename '"London"'
      3. Moscow: rabbitmqctl -p oracle set_parameter federation
      local-nodename '"Moscow"'
   5. Create a federation upstream
      1. Cloud - set London and Moscow as upstreams (with the appropriate
      user/pass)
         1. rabbitmqctl set_parameter federation-upstream London
         '{"uri":"amqp://london:password at 10.9.0.2/oracle"}'
         2. rabbitmqctl set_parameter federation-upstream
         Moscow '{"uri":"amqp://moscow:password at 10.9.0.3/oracle"}'
      2. Local Servers - Set Cloud as the upstream with unique user/pass
         1. London: rabbitmqctl set_parameter federation-upstream Cloud
         '{"uri":"amqp://london:password at 10.9.0.1/oracle"}'
         2. Moscow: rabbitmqctl set_parameter federation-upstream Cloud
         '{"uri":"amqp://moscow:password at 10.9.0.1/oracle"}'
      6. Create a federation upstream set
      1. Cloud:
         1. rabbitmqctl -p oracle set_parameter federation-upstream-set
         London '[{"upstream": "London"}]'
         2. rabbitmqctl -p oracle set_parameter federation-upstream-set
         Moscow '[{"upstream": "Moscow"}]'
      2. London: rabbitmqctl -p oracle set_parameter
      federation-upstream-set Cloud '[{"upstream": "Cloud"}]'
      3. Moscow: rabbitmqctl -p oracle set_parameter
      federation-upstream-set Cloud '[{"upstream": "Cloud"}]'
   7. Create a federation policy
      1. Cloud:
         1. rabbitmqctl -p oracle set_policy London "^oracle.london"
         '{"federation-upstream-set": "London"}'
         2. rabbitmqctl -p oracle set_policy Moscow "^oracle.moscow"
         '{"federation-upstream-set": "Moscow"}'
      2. London: rabbitmqctl -p oracle set_policy London "^oracle.london"
      '{"federation-upstream-set": "Cloud"}'
      3. Moscow: rabbitmqctl -p oracle set_policy Moscow "^oracle.moscow"
      '{"federation-upstream-set": "Cloud"}'

Now the problem comes when I set a federation upstream on the "Local"
servers (London and Moscow), I want to have a different username/password
on each. But it seems the "Cloud" upstream must always have the same
username/password? - Unless I am misunderstanding something?


>
> I think what you want to do is:
>
> * Create the London / Moscow users on the London / Moscow boxes
> * Add upstreams for London / Moscow on Cloud, pointing to the London /
> Moscow machines
> * Set the federation policy on Cloud
> * If you have deleted / restricted the "guest" account on Cloud, then set
> "local-username" to another account that is able to publish messages


Yes, I did all that, but I want to federate in both directions. If I do the
above, all messages I write to the Local servers (London, Moscow) I can
consume on the Cloud server, however if I write from the Cloud server, I
cannot consume the messages on the Local servers.

To do that, I need to add federation upstreams on the local servers:

rabbitmqctl set_parameter federation-upstream Cloud '{"uri":"amqp://
london:password at 10.9.0.1/oracle"}'
rabbitmqctl set_parameter federation-upstream Cloud '{"uri":"amqp://
moscow:password at 10.9.0.1/oracle"}'

But I cannot do that because RabbitMQ only accepts a single local-username
:( - Am I missing something?



>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/d97f7602/attachment.htm>

From simon at rabbitmq.com  Tue May 14 14:46:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 14:46:10 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <CAAs9BZPs+bH76uy0a06Q=XDsL2m8qK08S=hw3OfW_8pZ+4E9yw@mail.gmail.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
	<51920DE0.8080503@rabbitmq.com>
	<CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>
	<51922704.6020105@rabbitmq.com>
	<CAAs9BZPs+bH76uy0a06Q=XDsL2m8qK08S=hw3OfW_8pZ+4E9yw@mail.gmail.com>
Message-ID: <51924022.50005@rabbitmq.com>

On 14/05/13 14:24, Roman Gaufman wrote:
> Yes but I want it biodirectional, I tried to simplify the example, but I
> guess that wasn't helpful.

Ah, got it.

<snip>

> They each have a RabbitMQ instance, on each one I do:
>
>  1. Create vhost: oracle
>  2. Create new users: moscow:password, london:password, cloud:password
>  3. Set permissions for all users for the oracle vhost: .* .* .*
>  4. Set local username and nodename
>      1. Cloud: rabbitmqctl -p oracle set_parameter federation
>         local-username '"Cloud"'
>      2. London: rabbitmqctl -p oracle set_parameter federation
>         local-nodename '"London"'
>      3. Moscow: rabbitmqctl -p oracle set_parameter federation
>         local-nodename '"Moscow"'

So here you are setting the local-username to "Cloud", but 
local-nodename to "London" / "Moscow". Is that another simplification? 
Is that happening on the same machine?

<snip> the rest of the configuration looks reasonable.

> Now the problem comes when I set a federation upstream on the "Local"
> servers (London and Moscow), I want to have a different
> username/password on each. But it seems the "Cloud" upstream must always
> have the same username/password? - Unless I am misunderstanding something?

I'm afraid it's still not tremendously clear what you are asking here. 
If you want "London" to connect to "Cloud" using one username and 
"Moscow" to connect to "Cloud" with another, then you can do that - just 
set the usernames / passwords in the URLs differently.

> Yes, I did all that, but I want to federate in both directions. If I do
> the above, all messages I write to the Local servers (London, Moscow) I
> can consume on the Cloud server, however if I write from the Cloud
> server, I cannot consume the messages on the Local servers.
>
> To do that, I need to add federation upstreams on the local servers:
>
> rabbitmqctl set_parameter federation-upstream Cloud
> '{"uri":"amqp://london:password at 10.9.0.1/oracle
> <http://london:password at 10.9.0.1/oracle>"}'
> rabbitmqctl set_parameter federation-upstream Cloud
> '{"uri":"amqp://moscow:password at 10.9.0.1/oracle
> <http://moscow:password at 10.9.0.1/oracle>"}'
>
> But I cannot do that because RabbitMQ only accepts a single
> local-username :( - Am I missing something?

Ah - I think I understand what you are missing. Do you think 
local-username must correspond to the username set in another server's 
upstream URL? That's not the case.

The remote username(s) (i.e. the ones in the upstream URLs) need to be 
valid users in the upstream host. I think you have that right.

The local-username just needs to exist locally and be able to publish 
messages; it's used to republish messages that have been received from a 
remote host. *It does not need to correspond to anything else*.

The fact that you are seeing {error,user_does_not_exist} on a certain 
host means that you have set the local-username to the name of a user 
that does not exist on that host. Or that you have not set it, it;s 
defaulting to "guest", and "guest" does not exist.

Does this make sense?

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue May 14 15:30:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 15:30:43 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1368448262051-26620.post@n5.nabble.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
Message-ID: <51924A93.3090901@rabbitmq.com>

On 13/05/13 13:31, Slyth wrote:
> I have one cluster with 6 vm's and I want to mirror the first 3 on
> the other 3. That is everything I want to do, if you now an easier
> way as my try please instruct me

"mirror the first 3 on the other 3" is not really a concept that makes
sense in terms of RabbitMQ clustering. Cluster nodes are in general
equal, they're not matched up with each other.

> Ok now ich have a queue:
>
> root at rab1:/home/rab1#  rabbitmqctl set_policy ha-mirrorq "mirrorq" \
>> '{"ha-mode":"nodes","ha-params":["rabbit at rab4","rabbit at rab5","rabbit at rab6"],"ha-sync-mode":"automatic"}'
>
>>
>>
> (I have to look how I configure my queue. If rab2 and rab3 should
> receive the same msges or not and if I have to have one or two
> queues.) But why mirror my queue only on rab5 and rab6.

You have told this queue that it should reside on [rab4, rab5, rab6], so 
that's what it's doing.

> And work my
> 3 vm's allways together or only rab2 and rab3 because rab1 is the
> sender?

I don't understand this sentence.

> I hope you understand my problem I'am a little bit confuse and I
> found no examples in the internet.

I really don't, I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From maze at reik.se  Tue May 14 16:23:00 2013
From: maze at reik.se (Matthias Reik)
Date: Tue, 14 May 2013 17:23:00 +0200
Subject: [rabbitmq-discuss] Disable writing to disk
Message-ID: <519256D4.3080303@reik.se>

Hi all,

we have been using RabbitMQ for quite a while and are happy users of it, 
but now we got a new requirement to not write, the messages that are 
coming through a specific queue, to disk.

Does RabbitMQ support such a use case? I know that with ZeroMQ you can 
configure the per-queue "swap" and therefore set it to 0, but we would 
prefer to not switch technology.

One alternative would of course be to create a RamDisk and write the 
content to that one, but it was clear from this article
http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/
that this is not a good solution (even though it might be a solution for 
us).

If I understand it, RabbitMQ will only write things to disk if we start 
to run low on memory (when we hit the high-watermark?). At the same time 
we will also get into flow control, correct? Would be good to get some 
confirmation on this.

Ideally we would like that we get into flow-control _before_ we run out 
of memory (and therefore before we start writing things to disk). We 
would even prefer that the server "crashes" instead of writing the 
messages to disk (yeah, extreme approach). One "hacky" approach would of 
course observe the memory consumption of the server and just kill it 
once we get too close to our high watermark (or set the high watermark 
to 1.0?).

So what are the possibilities to fulfill such a (surely unusual) 
requirement? Any advice is very much appreciated.

Cheers
Maze


From emile at rabbitmq.com  Tue May 14 16:44:10 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 14 May 2013 16:44:10 +0100
Subject: [rabbitmq-discuss] Disable writing to disk
In-Reply-To: <519256D4.3080303@reik.se>
References: <519256D4.3080303@reik.se>
Message-ID: <51925BCA.7060707@rabbitmq.com>


Hi Matthias,

On 14/05/13 16:23, Matthias Reik wrote:
> we have been using RabbitMQ for quite a while and are happy users of it, 
> but now we got a new requirement to not write, the messages that are 
> coming through a specific queue, to disk.
> 
> Does RabbitMQ support such a use case?

Not at the moment.

> One alternative would of course be to create a RamDisk and write the 
> content to that one, but it was clear from this article
> http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/
> that this is not a good solution (even though it might be a solution for 
> us).


A RAM-disk will guarantee that messages don't reach secondary storage,
but I agree this is not a satisfactory solution. It will also affect all
the queues, while you may need finer control.

An alternative option would be to set the vm_memory_high_watermark to a
very large factor (e.g. 100). The broker will then behave as if it had
alot more memory than it really has (and therefore it runs the risk of
crashing with an out-of-memory error). At the moment the broker may
start sending messages to disk when as little as 5% of RAM is in use.
Setting the vm_memory_high_watermark high enough that this threshold is
never reached should avoid disk writes.

Can you explain why you want to avoid messages in disk? We have been
asked about this feature before, but the request has never been
accompanied by a strong motivating argument.



-Emile






From phillpafford at gmail.com  Tue May 14 17:10:31 2013
From: phillpafford at gmail.com (ppafford)
Date: Tue, 14 May 2013 09:10:31 -0700 (PDT)
Subject: [rabbitmq-discuss] smallest amount of work for a consumer
Message-ID: <1368547831300-26676.post@n5.nabble.com>

This question is about Architecture / Design:

I have a consumer that needs to perform x numbers of tasks, when should I
think about breaking the consumer up into smaller task and/or adding the
smaller tasks into their own consumer?

Example:

Consumer FooBarShipping does

adds database entry for reporting
adds database entry for account
adds database entry for shipping
generates shipping invoice ( PDF or other formats if needed )
creates notification for shipping
creates notification for account
So my question is, when would I break out the bullet points into smaller
consumers? The consumer as is runs fine but I feel it's getting too large
and needs to be refactored into smaller, more manageable processes.

Should each bullet point be it's own consumer? I can see breaking them up
into three consumers

database
pdf ( documents )
notifications
But what is the smallest unit of work a consumer should do? Do I really need
a consumer to run a sql statement?

I watched

https://www.youtube.com/watch?feature=player_embedded&v=E708csv4XgY
and to me the consumer looks to do basic tasks which kick off other basic
tasks.

StackOverflow:
http://stackoverflow.com/questions/16547240/message-queue-smallest-amount-of-work-for-a-consumer



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/smallest-amount-of-work-for-a-consumer-tp26676.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From maze at reik.se  Tue May 14 17:33:36 2013
From: maze at reik.se (Matthias Reik)
Date: Tue, 14 May 2013 18:33:36 +0200
Subject: [rabbitmq-discuss] Disable writing to disk
In-Reply-To: <51925BCA.7060707@rabbitmq.com>
References: <519256D4.3080303@reik.se> <51925BCA.7060707@rabbitmq.com>
Message-ID: <51926760.4020009@reik.se>


On 2013-05-14 17:44 , Emile Joubert wrote:
> Hi Matthias,
>
> On 14/05/13 16:23, Matthias Reik wrote:
>> we have been using RabbitMQ for quite a while and are happy users of it,
>> but now we got a new requirement to not write, the messages that are
>> coming through a specific queue, to disk.
>>
>> Does RabbitMQ support such a use case?
> Not at the moment.
>
>> One alternative would of course be to create a RamDisk and write the
>> content to that one, but it was clear from this article
>> http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/
>> that this is not a good solution (even though it might be a solution for
>> us).
>
> A RAM-disk will guarantee that messages don't reach secondary storage,
> but I agree this is not a satisfactory solution. It will also affect all
> the queues, while you may need finer control.
We have a RabbitMQ cluster, so we could make sure that the RamDisk would
be set up only on those servers that have those kind of queues.
>
> An alternative option would be to set the vm_memory_high_watermark to a
> very large factor (e.g. 100). The broker will then behave as if it had
> alot more memory than it really has (and therefore it runs the risk of
> crashing with an out-of-memory error). At the moment the broker may
> start sending messages to disk when as little as 5% of RAM is in use.
> Setting the vm_memory_high_watermark high enough that this threshold is
> never reached should avoid disk writes.
Cool. Thanks for the tips/info. For this cases the ZeroMQ approach sounds
quite attractive (at least on paper), that you can assign "swap" size on 
a per
queue level, see http://www.zeromq.org/whitepapers:design-v06
>
> Can you explain why you want to avoid messages in disk? We have been
> asked about this feature before, but the request has never been
> accompanied by a strong motivating argument.
The requirement comes from legal to not infringe Copyright laws (in
different countries). Apparently (and I'm not a legal person, so don't
really ask me any details), it's ok to keep the content in memory, but
not to "store it to disk". It is a bit unknown what the "store to disk"
really means, and therefore I think it's preferred to be on the safe side
and make sure (with reasonable effort) that the message is never
written to disk.
>
>
>
> -Emile
>
>
>
>
>


From michael.s.klishin at gmail.com  Tue May 14 17:34:47 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 14 May 2013 20:34:47 +0400
Subject: [rabbitmq-discuss] smallest amount of work for a consumer
In-Reply-To: <1368547831300-26676.post@n5.nabble.com>
References: <1368547831300-26676.post@n5.nabble.com>
Message-ID: <CAE3HoVQWbNgm_YWkFf0M_mSDatJKuMHaZtzpAqOZVOacPmoBHw@mail.gmail.com>

2013/5/14 ppafford <phillpafford at gmail.com>

> So my question is, when would I break out the bullet points into smaller
> consumers? The consumer as is runs fine but I feel it's getting too large
> and needs to be refactored into smaller, more manageable processes.
>
> Should each bullet point be it's own consumer? I can see breaking them up
> into three consumers
>

Do these steps have any interdependencies between them, e.g. C depends on A
being done?

How are your queues organized? Is there a single message that triggers all
these operations?

If these steps can be described as a single unit of work, you can use a
single consumer
with explicit acknowledgements and structure your code as a composed method
[1],
then acknowledge the message at the end.

If there are reasons to try to parallelize these steps, multiple queues and
consumers may help.

1. http://codebetter.com/jeremymiller/2006/12/03/composed-method-pattern/
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/056fea32/attachment.htm>

From michael.s.klishin at gmail.com  Tue May 14 17:48:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 14 May 2013 20:48:18 +0400
Subject: [rabbitmq-discuss] Disable writing to disk
In-Reply-To: <51926760.4020009@reik.se>
References: <519256D4.3080303@reik.se> <51925BCA.7060707@rabbitmq.com>
	<51926760.4020009@reik.se>
Message-ID: <CAE3HoVTqzZmKnJDohyHaf5MYxW6GPjA23+BSu2aiHNHOjn71zA@mail.gmail.com>

2013/5/14 Matthias Reik <maze at reik.se>

> We have a RabbitMQ cluster, so we could make sure that the RamDisk would
> be set up only on those servers that have those kind of queues.
>

Matthias,

Using RAM nodes for this queue sounds like the least painful and crash prone
solution to me.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/89d52d28/attachment.htm>

From simonthorogood at hotmail.com  Tue May 14 17:50:06 2013
From: simonthorogood at hotmail.com (SimonT)
Date: Tue, 14 May 2013 09:50:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Flow control issue when shovelling messages
	between data centres
Message-ID: <0cadcddc-2cc1-4fac-8eb4-a4bf97ba904f@googlegroups.com>

We have a rabbit cluster in our existing data centre (call it DC1). This 
cluster has messages (fairly large in size - around 100K) being published 
to it at a rate of between 500 to 1000/s. 

Recently, we introduced a new data centre with its own rabbit cluster 
(DC2). Our intention is to shovel messages that originate in DC1 to DC2 and 
vice versa. The DCs are connected by a fast (500Mb/s) line

We are finding that when we set up a queue in DC1 to shovel messages from 
DC1 to DC2 we are triggering 'flow control' back-pressure on many of the 
client connections, resulting in the production of messages in DC1 slowing 
down dramatically and becoming spiky and unreliable. Memory and CPU on all 
nodes in the cluster appear to be normal (i.e. well within high water-mark 
limits).

Can anybody suggest why the addition of this shovelling queue should cause 
such a dramatic change in cluster behavior.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/21e90504/attachment.htm>

From hackeron at gmail.com  Tue May 14 17:56:18 2013
From: hackeron at gmail.com (Roman Gaufman)
Date: Tue, 14 May 2013 17:56:18 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <51924022.50005@rabbitmq.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
	<51920DE0.8080503@rabbitmq.com>
	<CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>
	<51922704.6020105@rabbitmq.com>
	<CAAs9BZPs+bH76uy0a06Q=XDsL2m8qK08S=hw3OfW_8pZ+4E9yw@mail.gmail.com>
	<51924022.50005@rabbitmq.com>
Message-ID: <CAAs9BZPfbbXCmcLZx64ytn4CeuH9Z+OLFXEGFEoFzU8YDc2d_w@mail.gmail.com>

Oh you're right! - it broke because I removed the guest user, not because I
had a second username. I got confused as to what the username does, when I
changed it to anything other than what was used to connect (which was a
user on the system), it showed the user not found error.

Everything is working like I wanted with the commands bellow.

One question however, if I have a topic exchange and I bind a queue with a
routing key. Is the federation plugin able to determine and only federate
relevant messages? -- What I mean by that is if an exchange has no queues
that match a routing key, will the message still be federated?

---

On Cloud:
  # Sanity
  rabbitmqctl delete_user guest
  rabbitmqctl add_user portal password
  rabbitmqctl set_user_tags portal administrator

  # New Vhost
  rabbitmqctl add_vhost oracle

  # Federation details
  rabbitmqctl -p oracle set_permissions portal xanview.* xanview.* xanview.*
  rabbitmqctl -p oracle set_parameter federation local-username '"portal"'
  rabbitmqctl -p oracle set_parameter federation local-nodename '"portal"'
  rabbitmqctl -p oracle set_policy federate-me "^xanview"
'{"federation-upstream-set": "all"}'

  # Local server 1
  rabbitmqctl add_user welbeck-dvr1 password
  rabbitmqctl -p oracle set_permissions welbeck-dvr1 xanview.* xanview.*
xanview.*
  rabbitmqctl -p oracle set_parameter federation-upstream welbeck-dvr1 \
    '{"uri":"amqp://welbeck-dvr1:password at 10.9.0.2/oracle"}'

  # Local server 2
  rabbitmqctl add_user test-dvr2 password
  rabbitmqctl -p oracle set_permissions test-dvr2 xanview.* xanview.*
xanview.*
  rabbitmqctl -p oracle set_parameter federation-upstream test-dvr2 \
    '{"uri":"amqp://test-dvr2:password at 10.9.0.3/oracle"}'


On XanBox 1:
  # New Vhost
  rabbitmqctl delete_user guest # sanity
  rabbitmqctl add_vhost oracle

  # Federation details
  rabbitmqctl -p oracle set_parameter federation local-username
'"welbeck-dvr1"'
  rabbitmqctl -p oracle set_parameter federation local-nodename
'"welbeck-dvr1"'
  rabbitmqctl -p oracle set_policy federate-me "^xanview"
'{"federation-upstream-set": "all"}'

  # User & upstream
  rabbitmqctl add_user welbeck-dvr1 password
  rabbitmqctl -p oracle set_permissions welbeck-dvr1 xanview.* xanview.*
xanview.*
  rabbitmqctl -p oracle set_parameter federation-upstream Portal \
        '{"uri":"amqp://welbeck-dvr1:password at 10.9.0.1/oracle"}'


On XanBox 2:
  # New Vhost
  rabbitmqctl delete_user guest # Sanity
  rabbitmqctl add_vhost oracle

  # Federation details
  rabbitmqctl -p oracle set_parameter federation local-username
'"test-dvr2"'
  rabbitmqctl -p oracle set_parameter federation local-nodename
'"test-dvr2"'
  rabbitmqctl -p oracle set_policy federate-me "^xanview"
'{"federation-upstream-set": "all"}'

  # User & upstream
  rabbitmqctl add_user test-dvr2 password
  rabbitmqctl -p oracle set_permissions test-dvr2 xanview.* xanview.*
xanview.*
  rabbitmqctl -p oracle set_parameter federation-upstream Portal \
        '{"uri":"amqp://test-dvr2:password at 10.9.0.1/oracle"}'


On 14 May 2013 14:46, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/05/13 14:24, Roman Gaufman wrote:
>
>> Yes but I want it biodirectional, I tried to simplify the example, but I
>> guess that wasn't helpful.
>>
>
> Ah, got it.
>
> <snip>
>
>  They each have a RabbitMQ instance, on each one I do:
>>
>>  1. Create vhost: oracle
>>  2. Create new users: moscow:password, london:password, cloud:password
>>  3. Set permissions for all users for the oracle vhost: .* .* .*
>>  4. Set local username and nodename
>>      1. Cloud: rabbitmqctl -p oracle set_parameter federation
>>         local-username '"Cloud"'
>>      2. London: rabbitmqctl -p oracle set_parameter federation
>>         local-nodename '"London"'
>>      3. Moscow: rabbitmqctl -p oracle set_parameter federation
>>         local-nodename '"Moscow"'
>>
>
> So here you are setting the local-username to "Cloud", but local-nodename
> to "London" / "Moscow". Is that another simplification? Is that happening
> on the same machine?
>
> <snip> the rest of the configuration looks reasonable.
>
>
>  Now the problem comes when I set a federation upstream on the "Local"
>> servers (London and Moscow), I want to have a different
>> username/password on each. But it seems the "Cloud" upstream must always
>> have the same username/password? - Unless I am misunderstanding something?
>>
>
> I'm afraid it's still not tremendously clear what you are asking here. If
> you want "London" to connect to "Cloud" using one username and "Moscow" to
> connect to "Cloud" with another, then you can do that - just set the
> usernames / passwords in the URLs differently.
>
>  Yes, I did all that, but I want to federate in both directions. If I do
>> the above, all messages I write to the Local servers (London, Moscow) I
>> can consume on the Cloud server, however if I write from the Cloud
>> server, I cannot consume the messages on the Local servers.
>>
>> To do that, I need to add federation upstreams on the local servers:
>>
>> rabbitmqctl set_parameter federation-upstream Cloud
>> '{"uri":"amqp://london:**password at 10.9.0.1/oracle<http://london:password at 10.9.0.1/oracle>
>> <http://london:password at 10.9.**0.1/oracle<http://london:password at 10.9.0.1/oracle>
>> >"}'
>>
>> rabbitmqctl set_parameter federation-upstream Cloud
>> '{"uri":"amqp://moscow:**password at 10.9.0.1/oracle<http://moscow:password at 10.9.0.1/oracle>
>> <http://moscow:password at 10.9.**0.1/oracle<http://moscow:password at 10.9.0.1/oracle>
>> >"}'
>>
>>
>> But I cannot do that because RabbitMQ only accepts a single
>> local-username :( - Am I missing something?
>>
>
> Ah - I think I understand what you are missing. Do you think
> local-username must correspond to the username set in another server's
> upstream URL? That's not the case.
>
> The remote username(s) (i.e. the ones in the upstream URLs) need to be
> valid users in the upstream host. I think you have that right.
>
> The local-username just needs to exist locally and be able to publish
> messages; it's used to republish messages that have been received from a
> remote host. *It does not need to correspond to anything else*.
>
> The fact that you are seeing {error,user_does_not_exist} on a certain host
> means that you have set the local-username to the name of a user that does
> not exist on that host. Or that you have not set it, it;s defaulting to
> "guest", and "guest" does not exist.
>
> Does this make sense?
>
>
> Cheers, Simon
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/21bc6d41/attachment.htm>

From cjbhaines at gmail.com  Tue May 14 17:56:42 2013
From: cjbhaines at gmail.com (Chris Haines)
Date: Tue, 14 May 2013 09:56:42 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client Connection.CreateModel Possible
 Deadlock / Not Thread Safe?
Message-ID: <d396c1b3-a161-44f3-b806-8f25140b62e7@googlegroups.com>

Hi All,

Server version: 3.0.4
.NET client version: 3.0.4

I have had a problem on my Production servers this week where it looks like 
the call to CreateModel on IConnection is not thread safe, despite the 
documentation indicating that the entire IConnection should be thread safe. 
My application runs a single shared connection with somewhere in the region 
of 200-400 threads which will be creating models for at least 1 consumer 
and many publishers per thread. It looks like we had a small 
network hiccup and the connection reset, prompting all of the 
publishers/consumers to request new models at the same time. There is a 
very high chance that there will be threading clashes in this circumstance. 
The symptom after a threading clash is that all current requests for 
Connection.CreateModel() will throw an exception with the following error:

RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP 
operation was interrupted: AMQP close-reason, initiated by Peer, code=503, 
text="COMMAND_INVALID - second 'channel.open' seen", classId=20, 
methodId=10, cause=

And any subsequent requests to IConnection.CreateModel() on that connection 
instance indefinitely hang. I have managed to resolve this for now by 
adding locking around channel creation.

I have attached an NUnit test file which recreates this problem. The test 
case that uses locking will pass and the test without locking will 
indefinitely hang after it tries to create a channel on line 62 (at which 
point all of the threads are now hanging requesting a model).

Has anyone seen any problems like this before?

Cheers,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/124cd32f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MultiThreadedChannelCreationTest.cs
Type: text/x-csharp
Size: 3634 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/124cd32f/attachment.bin>

From maze at reik.se  Tue May 14 17:58:19 2013
From: maze at reik.se (Matthias Reik)
Date: Tue, 14 May 2013 18:58:19 +0200
Subject: [rabbitmq-discuss] Disable writing to disk
In-Reply-To: <CAE3HoVTqzZmKnJDohyHaf5MYxW6GPjA23+BSu2aiHNHOjn71zA@mail.gmail.com>
References: <519256D4.3080303@reik.se> <51925BCA.7060707@rabbitmq.com>
	<51926760.4020009@reik.se>
	<CAE3HoVTqzZmKnJDohyHaf5MYxW6GPjA23+BSu2aiHNHOjn71zA@mail.gmail.com>
Message-ID: <51926D2B.7010307@reik.se>


On 2013-05-14 18:48 , Michael Klishin wrote:
>
> 2013/5/14 Matthias Reik <maze at reik.se <mailto:maze at reik.se>>
>
>     We have a RabbitMQ cluster, so we could make sure that the RamDisk
>     would
>     be set up only on those servers that have those kind of queues.
>
>
> Matthias,
>
> Using RAM nodes for this queue sounds like the least painful and crash 
> prone
> solution to me.
But my understanding was that RAM node would not prevent the messages to 
touch
disk. But maybe my understanding of RAM nodes is wrong (would be happy 
to hear
that :-) )
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/482bd97c/attachment.htm>

From simon at rabbitmq.com  Tue May 14 18:01:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 18:01:51 +0100
Subject: [rabbitmq-discuss] Disable writing to disk
In-Reply-To: <CAE3HoVTqzZmKnJDohyHaf5MYxW6GPjA23+BSu2aiHNHOjn71zA@mail.gmail.com>
References: <519256D4.3080303@reik.se> <51925BCA.7060707@rabbitmq.com>
	<51926760.4020009@reik.se>
	<CAE3HoVTqzZmKnJDohyHaf5MYxW6GPjA23+BSu2aiHNHOjn71zA@mail.gmail.com>
Message-ID: <51926DFF.1080105@rabbitmq.com>

On 14/05/13 17:48, Michael Klishin wrote:
> Using RAM nodes for this queue sounds like the least painful and crash prone
> solution to me.

No no no.

Disc nodes vs RAM nodes *only* controls whether metadata (essentially 
queue / exchange / binding declarations) goes to disc or RAM. A RAM node 
can still store persistent messages and page messages out.

(Yeah, the names are confusing.Not sure what to do about that.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue May 14 18:02:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 May 2013 18:02:12 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <CAAs9BZPfbbXCmcLZx64ytn4CeuH9Z+OLFXEGFEoFzU8YDc2d_w@mail.gmail.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
	<51920DE0.8080503@rabbitmq.com>
	<CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>
	<51922704.6020105@rabbitmq.com>
	<CAAs9BZPs+bH76uy0a06Q=XDsL2m8qK08S=hw3OfW_8pZ+4E9yw@mail.gmail.com>
	<51924022.50005@rabbitmq.com>
	<CAAs9BZPfbbXCmcLZx64ytn4CeuH9Z+OLFXEGFEoFzU8YDc2d_w@mail.gmail.com>
Message-ID: <51926E14.8070604@rabbitmq.com>

On 14/05/13 17:56, Roman Gaufman wrote:
> Everything is working like I wanted with the commands bellow.

Cool!

> One question however, if I have a topic exchange and I bind a queue with
> a routing key. Is the federation plugin able to determine and only
> federate relevant messages? -- What I mean by that is if an exchange has
> no queues that match a routing key, will the message still be federated?

If there are no bindings that match a given routing key, that message 
will not be forwarded.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From hackeron at gmail.com  Tue May 14 18:05:40 2013
From: hackeron at gmail.com (Roman Gaufman)
Date: Tue, 14 May 2013 18:05:40 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <51926E14.8070604@rabbitmq.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
	<51920DE0.8080503@rabbitmq.com>
	<CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>
	<51922704.6020105@rabbitmq.com>
	<CAAs9BZPs+bH76uy0a06Q=XDsL2m8qK08S=hw3OfW_8pZ+4E9yw@mail.gmail.com>
	<51924022.50005@rabbitmq.com>
	<CAAs9BZPfbbXCmcLZx64ytn4CeuH9Z+OLFXEGFEoFzU8YDc2d_w@mail.gmail.com>
	<51926E14.8070604@rabbitmq.com>
Message-ID: <CAAs9BZP=_ozWxv=HTrykaH4HTrEB6XhiaSUOO5sZvZtOSNyvPw@mail.gmail.com>

That is fantastic! - Thanks a bunch for all your help, that is really
badass!


On 14 May 2013 18:02, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/05/13 17:56, Roman Gaufman wrote:
>
>> Everything is working like I wanted with the commands bellow.
>>
>
> Cool!
>
>
>  One question however, if I have a topic exchange and I bind a queue with
>> a routing key. Is the federation plugin able to determine and only
>> federate relevant messages? -- What I mean by that is if an exchange has
>> no queues that match a routing key, will the message still be federated?
>>
>
> If there are no bindings that match a given routing key, that message will
> not be forwarded.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/ba67d48e/attachment.htm>

From matthias at rabbitmq.com  Tue May 14 18:08:08 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 May 2013 18:08:08 +0100
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
Message-ID: <51926F78.20401@rabbitmq.com>

On 14/05/13 07:09, Nate wrote:
>      Thanks for your reply, I check the logs and there is no any
> "rotating logs with suffix '..' " words in log.
>       rabbitmqctl eval 'process_info(whereis(error___logger)).' return
> as following, [...]

Curious. What happens when you run

   rabbitmqctl rotate_logs

?

Matthias.

From matthias at rabbitmq.com  Tue May 14 18:17:55 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 May 2013 18:17:55 +0100
Subject: [rabbitmq-discuss] Multiple local-usernames for federation
In-Reply-To: <CAAs9BZPfbbXCmcLZx64ytn4CeuH9Z+OLFXEGFEoFzU8YDc2d_w@mail.gmail.com>
References: <CAAs9BZPEeHM_TE7GDg8L0PSL_8Zw5f7J=dG3=MLOusdkysJfAQ@mail.gmail.com>
	<51920DE0.8080503@rabbitmq.com>
	<CAAs9BZO6uZVF8_gg98O7AD_V8yZX33td4vwKSWVsGBQDeW3t=g@mail.gmail.com>
	<51922704.6020105@rabbitmq.com>
	<CAAs9BZPs+bH76uy0a06Q=XDsL2m8qK08S=hw3OfW_8pZ+4E9yw@mail.gmail.com>
	<51924022.50005@rabbitmq.com>
	<CAAs9BZPfbbXCmcLZx64ytn4CeuH9Z+OLFXEGFEoFzU8YDc2d_w@mail.gmail.com>
Message-ID: <519271C3.7000301@rabbitmq.com>

On 14/05/13 17:56, Roman Gaufman wrote:
> if I have a topic exchange and I bind a queue with
> a routing key. Is the federation plugin able to determine and only
> federate relevant messages? -- What I mean by that is if an exchange has
> no queues that match a routing key, will the message still be federated?

 From http://www.rabbitmq.com/federation.html

<quote>
  Are all messages copied?

     Only those messages that need to be copied are propagated.
</quote>

The detailed explanation is at 
http://www.rabbitmq.com/federation.html#details.


Matthias.

From phillpafford at gmail.com  Tue May 14 18:29:10 2013
From: phillpafford at gmail.com (ppafford)
Date: Tue, 14 May 2013 10:29:10 -0700 (PDT)
Subject: [rabbitmq-discuss] smallest amount of work for a consumer
In-Reply-To: <CAE3HoVQWbNgm_YWkFf0M_mSDatJKuMHaZtzpAqOZVOacPmoBHw@mail.gmail.com>
References: <1368547831300-26676.post@n5.nabble.com>
	<CAE3HoVQWbNgm_YWkFf0M_mSDatJKuMHaZtzpAqOZVOacPmoBHw@mail.gmail.com>
Message-ID: <1368552550543-26684.post@n5.nabble.com>

most of the database calls can happen at a later time, the PDF ( document )
needs to happen before the notification as it's an attachment.

I have two other related questions on stack if that helps?

 -
http://stackoverflow.com/questions/13861459/rabbitmq-wait-for-multiple-queues-to-finish
 - http://stackoverflow.com/questions/14594569/rabbitmq-implementation

I'm just trying to determine if I'm engineering this correctly. Thanks for
the link will read up on it.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/smallest-amount-of-work-for-a-consumer-tp26676p26684.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From newsjimi at gmail.com  Tue May 14 18:47:10 2013
From: newsjimi at gmail.com (Jimi Riblei)
Date: Tue, 14 May 2013 17:47:10 +0000
Subject: [rabbitmq-discuss] WCF Bind Exchange
Message-ID: <CAO6pa4StEbOSaHDXd6w4yhreOmwzKCAhSOVd+s74M5WoYpiLaA@mail.gmail.com>

Hello,
I solved the "WCF bind error VS 2010", using visual studio 2008.

But I have another question:
Is there a way to bind a different exchange using "soap.amqp://" (or
others)?
Because it always bind amp.direct.
I have read the doc, but I didn't understand If it's possible to bind a
different exchange.

I tried with soap.amqp://myfanoutex/ without success.

Thank you
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/6f0bfd58/attachment.htm>

From maze at reik.se  Tue May 14 21:00:08 2013
From: maze at reik.se (Matthias Reik)
Date: Tue, 14 May 2013 22:00:08 +0200
Subject: [rabbitmq-discuss] Disable writing to disk
In-Reply-To: <51926DFF.1080105@rabbitmq.com>
References: <519256D4.3080303@reik.se> <51925BCA.7060707@rabbitmq.com>
	<51926760.4020009@reik.se>
	<CAE3HoVTqzZmKnJDohyHaf5MYxW6GPjA23+BSu2aiHNHOjn71zA@mail.gmail.com>
	<51926DFF.1080105@rabbitmq.com>
Message-ID: <519297C8.7040806@reik.se>


On 2013-05-14 19:01 , Simon MacMullen wrote:
> On 14/05/13 17:48, Michael Klishin wrote:
>> Using RAM nodes for this queue sounds like the least painful and 
>> crash prone
>> solution to me.
>
> No no no.
>
> Disc nodes vs RAM nodes *only* controls whether metadata (essentially 
> queue / exchange / binding declarations) goes to disc or RAM. A RAM 
> node can still store persistent messages and page messages out.
Puhhh, thanks for the confirmation... my view has been restored :-)
>
> (Yeah, the names are confusing.Not sure what to do about that.)
>
> Cheers, Simon
>


From carl.hoerberg at gmail.com  Wed May 15 04:14:43 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 14 May 2013 20:14:43 -0700 (PDT)
Subject: [rabbitmq-discuss] /api/connections doesn't report interval in 3.1
Message-ID: <1368587682971-26692.post@n5.nabble.com>

Seems to be an undocumented change in the mgmt http api, 
/api/connections doesn't include the "interval" property under
"recv_oct_details" and "send_oct_details". Can I assume that it always is
5000000 (5 seconds)?  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/api-connections-doesn-t-report-interval-in-3-1-tp26692.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From natewang0425 at gmail.com  Wed May 15 07:52:22 2013
From: natewang0425 at gmail.com (Nate)
Date: Tue, 14 May 2013 23:52:22 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <51926F78.20401@rabbitmq.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
Message-ID: <1368600742183-26693.post@n5.nabble.com>

Hi Matthias,

    After doing the rabbitmqctl rotate_logs, rabbitmq.log.1 show the '
Rotating logs with suffix '' ' in the end of log file and rabbitmq start
writing the new logs to rabbitmq.log. However, the old rotate process were
still exist. BTW, my another 3-node cluster has same log rotate issue
today.....
  

*[Doing rotate_logs command]*
[root at rabbitmq1 rabbitmq]# rabbitmqctl rotate_logs
Reopening logs for node rabbit at rabbitmq1 ...
...done.


*[rotate process still get stuck ]*
root      8944  0.0  0.0   8668  1052 ?        S    May12   0:00 sh -c ?           
/sbin/service rabbitmq-server rotate-logs > /dev/null? ?           
/sbin/service rabbitmq-server rotate-logs > /dev/null?
/var/log/rabbitmq/*.log
root      8946  0.0  0.0   8804  1296 ?        S    May12   0:00 /bin/sh
/sbin/service rabbitmq-server rotate-logs
root      8951  0.0  0.0  10896  1392 ?        S    May12   0:00 /bin/sh
/etc/init.d/rabbitmq-server rotate-logs 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26693.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From normanpoon at sbcglobal.net  Wed May 15 05:17:13 2013
From: normanpoon at sbcglobal.net (Norman Poon)
Date: Tue, 14 May 2013 21:17:13 -0700
Subject: [rabbitmq-discuss] Symantec Endpoint Protection
Message-ID: <CDB85A59.1C8B4%normanpoon@sbcglobal.net>

I am having an issue with Symantec Endpoint Protection, it seems to be
blocking Rabbitmq from working.

Thanks,

Norm


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/cf793532/attachment.htm>

From thedaz at gmail.com  Wed May 15 03:32:24 2013
From: thedaz at gmail.com (Sungwon Jung)
Date: Tue, 14 May 2013 19:32:24 -0700 (PDT)
Subject: [rabbitmq-discuss] question about rabbitmq http api basic auth
Message-ID: <09fe60af-9109-4e14-af2f-ae49cc42d365@googlegroups.com>

Hello. I have a question about rabbitmq http api basic auth.

I use rabbitmq v3.1.0 and my code is below.

--
package com.foo.bar.controller;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URLEncoder;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.http.HttpHost;
import org.apache.http.HttpResponse;
import org.apache.http.auth.AuthScope;
import org.apache.http.auth.UsernamePasswordCredentials;
import org.apache.http.client.AuthCache;
import org.apache.http.client.methods.HttpPut;
import org.apache.http.client.protocol.ClientContext;
import org.apache.http.impl.auth.BasicScheme;
import org.apache.http.impl.client.BasicAuthCache;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.protocol.BasicHttpContext;
import org.apache.http.protocol.HTTP;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HealthCheckController {
private Log log = LogFactory.getLog(HealthCheckController.class);
 private final String IP = "000.000.000.000";
private final String OK = "ok";
 private String ID = "account";
private String PW = "passwd";

@RequestMapping({"/monitor/check"})
public void check(HttpServletRequest request, HttpServletResponse response) 
throws IOException {
        DefaultHttpClient httpclient = new DefaultHttpClient();
        HttpHost targetHost = new HttpHost(IP, 15672, "http");
        
        HttpPut rq = new HttpPut("/api/aliveness-test/%2ffoo%2fbar");
        
        try {
            httpclient.getCredentialsProvider().setCredentials(
                    new AuthScope(targetHost.getHostName(), 
targetHost.getPort()),
                    new UsernamePasswordCredentials(ID, 
URLEncoder.encode(PW, HTTP.UTF_8)));

            AuthCache authCache = new BasicAuthCache();
            BasicScheme basicAuth = new BasicScheme();
            authCache.put(targetHost, basicAuth);
            BasicHttpContext localcontext = new BasicHttpContext();
            localcontext.setAttribute(ClientContext.AUTH_CACHE, authCache);

            HttpResponse rp = httpclient.execute(targetHost, rq, 
localcontext);
            
            log.info("===================");
            log.info(rp);
            BufferedReader rd = new BufferedReader(new 
InputStreamReader(rp.getEntity().getContent()));
      String line = "";
            while ((line = rd.readLine()) != null) {
            log.info(line);
            } 
            log.info("===================");
        } finally {
            httpclient.getConnectionManager().shutdown();
        }
}
}
--

I call '/monitor/check' from web browser.
but...

11:21:08 [WARN ](DefaultRequestDirector.java:1095) Authentication error: 
basic authorization challenge expected, but not found
11:21:08 [INFO ](HealthCheckController.java:103) ===================
11:21:08 [INFO ](HealthCheckController.java:104) HTTP/1.1 401 Unauthorized 
[Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue), Date: 
Wed, 15 May 2013 02:21:08 GMT
, Content-Length: 50]
11:21:08 [INFO ](HealthCheckController.java:108) 
{"error":"not_authorised","reason":"Login failed"}
11:21:08 [INFO ](HealthCheckController.java:110) ===================


account, password, ip and api are all correct. but I cannot authorized.

What's wrong in my code?

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130514/dd36d031/attachment.htm>

From matthias at rabbitmq.com  Wed May 15 08:28:54 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 May 2013 08:28:54 +0100
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <1368600742183-26693.post@n5.nabble.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
Message-ID: <51933936.60008@rabbitmq.com>

On 15/05/13 07:52, Nate wrote:
>      After doing the rabbitmqctl rotate_logs, rabbitmq.log.1 show the '
> Rotating logs with suffix '' ' in the end of log file and rabbitmq start
> writing the new logs to rabbitmq.log.

Great. That's good to know. So it appears that everything is well with 
your server and that the problem is with the logrotate initiation.

> However, the old rotate process were
> still exist. BTW, my another 3-node cluster has same log rotate issue
> today.....

Did logs get rotated successfully in the past or did all log rotations 
get stuck?

> root      8944  0.0  0.0   8668  1052 ?        S    May12   0:00 sh -c ?
> /sbin/service rabbitmq-server rotate-logs > /dev/null? ?
> /sbin/service rabbitmq-server rotate-logs > /dev/null?
> /var/log/rabbitmq/*.log
> root      8946  0.0  0.0   8804  1296 ?        S    May12   0:00 /bin/sh
> /sbin/service rabbitmq-server rotate-logs
> root      8951  0.0  0.0  10896  1392 ?        S    May12   0:00 /bin/sh
> /etc/init.d/rabbitmq-server rotate-logs

Your initial report showed a few more processes, including a beam.smp 
process. Presumably that's still there too, right? If so, please post 
the complete command line for that.

You could just kill that process, but I am keen to get to the bottom of 
the problem so am hoping that we will be able to get that process to 
tell us where it's stuck.

Regards,

Matthias.

From emile at rabbitmq.com  Wed May 15 08:54:13 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 May 2013 08:54:13 +0100
Subject: [rabbitmq-discuss] Disable writing to disk
In-Reply-To: <51926760.4020009@reik.se>
References: <519256D4.3080303@reik.se> <51925BCA.7060707@rabbitmq.com>
	<51926760.4020009@reik.se>
Message-ID: <51933F25.2000300@rabbitmq.com>

On 14/05/13 17:33, Matthias Reik wrote:

> it's ok to keep the content in memory, but not to "store it to disk".

This presumably then precludes the use of swapfiles on your server as
well, because copyright material might end up on disk via this route.

I suggest you check whether any of the excepts made for transient copies
of copyright works already applies.




-Emile





From emile at rabbitmq.com  Wed May 15 08:59:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 May 2013 08:59:57 +0100
Subject: [rabbitmq-discuss] Symantec Endpoint Protection
In-Reply-To: <CDB85A59.1C8B4%normanpoon@sbcglobal.net>
References: <CDB85A59.1C8B4%normanpoon@sbcglobal.net>
Message-ID: <5193407D.9090004@rabbitmq.com>


Hi,

On 15/05/13 05:17, Norman Poon wrote:
> I am having an issue with Symantec Endpoint Protection, it seems to be
> blocking Rabbitmq from working.

Can you provide the text of the blocking message? If you are not able to
whitelist the broker application then I suggest contacting your Symantec
representative about this issue.




-Emile







From balachandar.ra at gmail.com  Wed May 15 09:09:47 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Wed, 15 May 2013 13:39:47 +0530
Subject: [rabbitmq-discuss] Problem when running second consumer
Message-ID: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>

Hello,

I have a problem with running my consumer. I have a machine A wherein I run
both my producer and consumer, and it is running fine. Now, I want to
launch one more consumer in another machine B. When I start my consumer in
B, I get the following error. Can someone tell where things are going
wrong?. The rabbitMQ is running in a virtual machine X. A is the head node
of a cluster and B is one of the computing nodes.



Caught: com.rabbitmq.client.PossibleAuthenticationFailureException:
Possibly caused by authentication failure
com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly caused
by authentication failure
        at
com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:289)
        at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:383)
        at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
        at com.rabbitmq.client.ConnectionFactory$newConnection.call(Unknown
Source)
        at Client.run(Client.groovy:560)
Caused by: com.rabbitmq.client.AlreadyClosedException: clean connection
shutdown; reason: Attempt to use closed channel
        at
com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
        at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:208)
        at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:194)
        at
com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:281)
        ... 4 more



With thanks and regards
Balachandar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/6960aa96/attachment.htm>

From umutcan at gamegos.com  Wed May 15 09:21:25 2013
From: umutcan at gamegos.com (Umutcan)
Date: Wed, 15 May 2013 11:21:25 +0300
Subject: [rabbitmq-discuss] What happens to Rabbit MQ Server If there is no
 queue for a routing key?
Message-ID: <51934585.3060507@gamegos.com>

Hi,

This is a problem that I did not understand. Last night due to some 
connection errors some of our consumers has failed. So, queues for some 
routing key could not be created. Since then cpu usage of server and 
socket descriptors are high.



From watson.timothy at gmail.com  Wed May 15 09:18:31 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 15 May 2013 09:18:31 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
Message-ID: <07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>

On 15 May 2013, at 09:09, "Balachandar R.A." <balachandar.ra at gmail.com> wrote
> Caught: com.rabbitmq.client.PossibleAuthenticationFailureException:
> 

Looks like an authentication failure!? How're you proving credentials from both clients? Do both users have relevant permissions?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/4169bd14/attachment.htm>

From matthias at rabbitmq.com  Wed May 15 09:26:29 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 May 2013 09:26:29 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
Message-ID: <519346B5.4000804@rabbitmq.com>

On 15/05/13 09:18, Tim Watson wrote:
> On 15 May 2013, at 09:09, "Balachandar R.A." <balachandar.ra at gmail.com
> <mailto:balachandar.ra at gmail.com>> wrote
>>
>> Caught: com.rabbitmq.client.PossibleAuthenticationFailureException:
>>
>
> Looks like an authentication failure!? How're you proving credentials
> from both clients? Do both users have relevant permissions?

It's also worth checking the server logs. They should contain more 
details on the reasons for any authentication failures.

Matthias.


From balachandar.ra at gmail.com  Wed May 15 09:32:09 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Wed, 15 May 2013 14:02:09 +0530
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
Message-ID: <CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>

I am not doing anything for authentication.

I have installed rabbitmq using apt get install...

I created simple hello world producer and consumer, and launched in A and B.

Do I need to any other config for the user? If so, how to do it?
On 15 May 2013 13:54, "Tim Watson" <watson.timothy at gmail.com> wrote:

> On 15 May 2013, at 09:09, "Balachandar R.A." <balachandar.ra at gmail.com>
> wrote
>
> Caught: com.rabbitmq.client.PossibleAuthenticationFailureException:
>
>
> Looks like an authentication failure!? How're you proving credentials from
> both clients? Do both users have relevant permissions?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/3022f0f1/attachment.htm>

From emile at rabbitmq.com  Wed May 15 09:32:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 May 2013 09:32:25 +0100
Subject: [rabbitmq-discuss] What happens to Rabbit MQ Server If there is
 no queue for a routing key?
In-Reply-To: <51934585.3060507@gamegos.com>
References: <51934585.3060507@gamegos.com>
Message-ID: <51934819.8060905@rabbitmq.com>

On 15/05/13 09:21, Umutcan wrote:

> This is a problem that I did not understand. Last night due to some 
> connection errors some of our consumers has failed. So, queues for some 
> routing key could not be created. Since then cpu usage of server and 
> socket descriptors are high.

You have not provided enough information to venture a diagnosis. Can you
please supply the output of "rabbitmqctl report" and any error log
entries from the regular and sasl logfiles from the time at or before
the failure? Does the high CPU use persist even when clients are
disconnected?


-Emile






From natewang0425 at gmail.com  Wed May 15 09:51:30 2013
From: natewang0425 at gmail.com (Nate)
Date: Wed, 15 May 2013 01:51:30 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <51933936.60008@rabbitmq.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
	<51933936.60008@rabbitmq.com>
Message-ID: <CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>

Hi Matthias,

1.  Did logs get rotated successfully in the past or did all log rotations get
stuck?
Only two of nodes in the cluster get stuck. And two clusters are in the
same situation.

2. Your initial report showed a few more processes, including a
beam.smp process.
Presumably that's still there too, right? If so, please post the complete
command line for that.

rabbitmq  8972  0.0  2.8 580024 510588 ?       Ssl  May12   0:00
/usr/lib/erlang/erts-5.9/bin/beam.smp -- -root /usr/lib/erlang -progname
erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/sbin/../ebin -noshell -noinput
-hidden -sname rabbitmqctl8972 -s rabbit_control_main -nodename
rabbit at rabbitmq1 -extra rotate_logs

3. I wanna know the root cause too! Therefore, I prefer to keeping the
process and let it telling us the reason.

Thanks for your help!

Regards,
Nate.


2013/5/15 Matthias Radestock-3 [via RabbitMQ] <
ml-node+s1065348n26696h41 at n5.nabble.com>

> On 15/05/13 07:52, Nate wrote:
> >      After doing the rabbitmqctl rotate_logs, rabbitmq.log.1 show the '
> > Rotating logs with suffix '' ' in the end of log file and rabbitmq start
> > writing the new logs to rabbitmq.log.
>
> Great. That's good to know. So it appears that everything is well with
> your server and that the problem is with the logrotate initiation.
>
> > However, the old rotate process were
> > still exist. BTW, my another 3-node cluster has same log rotate issue
> > today.....
>
> Did logs get rotated successfully in the past or did all log rotations
> get stuck?
>
> > root      8944  0.0  0.0   8668  1052 ?        S    May12   0:00 sh -c ?
> > /sbin/service rabbitmq-server rotate-logs > /dev/null? ?
> > /sbin/service rabbitmq-server rotate-logs > /dev/null?
> > /var/log/rabbitmq/*.log
> > root      8946  0.0  0.0   8804  1296 ?        S    May12   0:00 /bin/sh
> > /sbin/service rabbitmq-server rotate-logs
> > root      8951  0.0  0.0  10896  1392 ?        S    May12   0:00 /bin/sh
> > /etc/init.d/rabbitmq-server rotate-logs
>
> Your initial report showed a few more processes, including a beam.smp
> process. Presumably that's still there too, right? If so, please post
> the complete command line for that.
>
> You could just kill that process, but I am keen to get to the bottom of
> the problem so am hoping that we will be able to get that process to
> tell us where it's stuck.
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=26696&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26696.html
>  To unsubscribe from Re: After weekly log rotatation was done, the command
> "rabbitmqctl rotate-logs" never stop, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=26607&code=bmF0ZXdhbmcwNDI1QGdtYWlsLmNvbXwyNjYwN3w0NTY2Njg2Njk=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26705.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/9589a985/attachment.htm>

From matthias at rabbitmq.com  Wed May 15 10:22:26 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 May 2013 10:22:26 +0100
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
	<51933936.60008@rabbitmq.com>
	<CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>
Message-ID: <519353D2.4020400@rabbitmq.com>

Nate,

On 15/05/13 09:51, Nate wrote:
> 1.  Did logs get rotated successfully in the past or did all log
> rotations get stuck?
> Only two of nodes in the cluster get stuck. And two clusters are in the
> same situation.

My question was whether the logs on these nodes ever got rotated 
successfully in the past.

> 2. Your initial report showed a few more processes, including a
> beam.smpprocess. Presumably that's still there too, right? If so, please
> postthe complete command line for that.
>
> rabbitmq  8972  0.0  2.8 580024 510588 ?       Ssl  May12   0:00
> /usr/lib/erlang/erts-5.9/bin/beam.smp -- -root /usr/lib/erlang -progname
> erl -- -home /var/lib/rabbitmq -- -pa
> /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/sbin/../ebin -noshell
> -noinput -hidden -sname rabbitmqctl8972 -s rabbit_control_main -nodename
> rabbit at rabbitmq1 -extra rotate_logs
>
> 3. I wanna know the root cause too! Therefore, I prefer to keeping the
> process and let it telling us the reason.

Unfortunately the rabbitmqctl node is a hidden node, so we cannot 
connect to it. The best we can do is make it crash with

   kill -SIGUSR1 8972

That should produce an erl_crash.dump. Not sure where it will end up 
though. Possibly in the rabbitmq home dir. Anyway, I'm sure you'll 
manage to track it down. Stick that crash dump on something like dropbox 
and post a link.


Regards,

Matthias.

From emile at rabbitmq.com  Wed May 15 10:36:44 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 May 2013 10:36:44 +0100
Subject: [rabbitmq-discuss] WCF Bind Exchange
In-Reply-To: <CAO6pa4StEbOSaHDXd6w4yhreOmwzKCAhSOVd+s74M5WoYpiLaA@mail.gmail.com>
References: <CAO6pa4StEbOSaHDXd6w4yhreOmwzKCAhSOVd+s74M5WoYpiLaA@mail.gmail.com>
Message-ID: <5193572C.7010807@rabbitmq.com>

On 14/05/13 18:47, Jimi Riblei wrote:

> Because it always bind amp.direct.
> I have read the doc, but I didn't understand If it's possible to bind a
> different exchange.

It always binds to amq.direct. It is not possible to bind to another
exchange.



-Emile




From simonthorogood at hotmail.com  Wed May 15 10:48:43 2013
From: simonthorogood at hotmail.com (SimonT)
Date: Wed, 15 May 2013 02:48:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Flow control issue when shovelling messages
 between data centres
In-Reply-To: <0cadcddc-2cc1-4fac-8eb4-a4bf97ba904f@googlegroups.com>
References: <0cadcddc-2cc1-4fac-8eb4-a4bf97ba904f@googlegroups.com>
Message-ID: <65418637-67a4-469a-b18d-f6ef00f6ac2b@googlegroups.com>

It appears that part of the problem is that the shovel mechanism is slow to 
consume due to a load balancer issue which I won't go into here. 

I'd be interested though to understand better the relationship is between 
down-stream queue size / consumption rate and flow control. For example, if 
the consumer is not keeping up and the queue is growing, will this increase 
the chance of flow control at the publisher. Also what is the effect of TTL 
on the queue - e.g. will a shorter TTL result in less up-streamm flow 
control?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/ab4dca29/attachment.htm>

From luodaidong at sina.com  Wed May 15 13:03:57 2013
From: luodaidong at sina.com (luodaidong at sina.com)
Date: Wed, 15 May 2013 20:03:57 +0800 
Subject: [rabbitmq-discuss] about exchange to exchange binding
Message-ID: <20130515120358.04370117009D@webmail.sinamail.sina.com.cn>

 
can anybody tell me where can I find the document about exchange to exchange binding with http API?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/5970fe91/attachment.htm>

From aggarwalsandeep at optonline.net  Wed May 15 13:22:48 2013
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Wed, 15 May 2013 05:22:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Trace on specific queues
Message-ID: <6b698e13-bec7-4131-bacc-9aaaea61253a@googlegroups.com>

Hello - 
I'm trying to trace messages flowing through a set of queues in a given vhost. These queues start with a naming convention of app.module.xxx. I've tried different patterns suggested on the trace screen (web admin) but nothing except for "#" works. Could someone provide a pattern for setting up trace on queues matching the naming conv above? 

Thx!

From simon at rabbitmq.com  Wed May 15 13:24:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 May 2013 13:24:08 +0100
Subject: [rabbitmq-discuss] /api/connections doesn't report interval in
 3.1
In-Reply-To: <1368587682971-26692.post@n5.nabble.com>
References: <1368587682971-26692.post@n5.nabble.com>
Message-ID: <51937E68.9030400@rabbitmq.com>

On 15/05/13 04:14, carlhoerberg wrote:
> Seems to be an undocumented change in the mgmt http api,
> /api/connections doesn't include the "interval" property under
> "recv_oct_details" and "send_oct_details". Can I assume that it always is
> 5000000 (5 seconds)?

Unless you have changed collect_statistics_interval, yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed May 15 13:32:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 May 2013 13:32:46 +0100
Subject: [rabbitmq-discuss] about exchange to exchange binding
In-Reply-To: <20130515120358.04370117009D@webmail.sinamail.sina.com.cn>
References: <20130515120358.04370117009D@webmail.sinamail.sina.com.cn>
Message-ID: <5193806E.4030601@rabbitmq.com>

On 15/05/13 13:03, luodaidong at sina.com wrote:
> can anybody tell me where can I find the document about exchange to
> exchange binding with http API?

I was going to tell you to read the API documentation - but then I 
realised it didn't explicitly mention e2e. So I have added a couple of 
rows to it:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/4741fc9db1dd/priv/www/api/index.html

Does this make sense now?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed May 15 13:41:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 May 2013 13:41:43 +0100
Subject: [rabbitmq-discuss] Trace on specific queues
In-Reply-To: <6b698e13-bec7-4131-bacc-9aaaea61253a@googlegroups.com>
References: <6b698e13-bec7-4131-bacc-9aaaea61253a@googlegroups.com>
Message-ID: <51938287.1070702@rabbitmq.com>

On 15/05/13 13:22, Sandeep Aggarwal wrote:
> Hello - I'm trying to trace messages flowing through a set of queues
> in a given vhost. These queues start with a naming convention of
> app.module.xxx. I've tried different patterns suggested on the trace
> screen (web admin) but nothing except for "#" works. Could someone
> provide a pattern for setting up trace on queues matching the naming
> conv above?

See the reference to "Firehose notification format" at 
http://www.rabbitmq.com/firehose.html

So to trace messages delivered from queues called app.module.xxx, use 
"deliver.app.module.#".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed May 15 13:46:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 May 2013 13:46:22 +0100
Subject: [rabbitmq-discuss] Guidance on Understanding API Output for
	Monitoring
In-Reply-To: <CAO=6ox8fUcg_UrWgnN_XLQ8w0RGQPKpmskf+mO7v0urNO87i+Q@mail.gmail.com>
References: <CAO=6ox_Yiisk18BeNHs6qO2aVxDow12XjJpAGiDmw5DSVAvi7g@mail.gmail.com>
	<518CFB4E.20400@rabbitmq.com>
	<CAO=6ox8fUcg_UrWgnN_XLQ8w0RGQPKpmskf+mO7v0urNO87i+Q@mail.gmail.com>
Message-ID: <5193839E.6080005@rabbitmq.com>

On 13/05/13 15:12, Richard Raseley wrote:
> Simon,
>
> Primarily I would like to get absolute message count and throughput
> statistics on a specified exchange over a specified or at least known
> time period.
>
> If you look at the JSON attachment I sent it does show throughput (e.g.
> 100msg/s) but it doesn't tell me over what period that number is from.
>
> Any help would be greatly appreciated.

I think you are using < 3.1.0 - in which case the throughput is the 
current instantaneous rate, and the absolute counts are for all 
currently open channels (so they can go backward when a channel is closed).

In 3.1.0 this was rewritten. The absolute counts are now for all time 
(well, since the statistics database started) and you can specify 
sample_age and sample_incr parameters to get historical data - see

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_1_0/priv/www/api/index.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dpanchyrz at proximetry.pl  Wed May 15 13:07:43 2013
From: dpanchyrz at proximetry.pl (rabbit666)
Date: Wed, 15 May 2013 05:07:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <51921E5E.5000603@rabbitmq.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
Message-ID: <1368619663987-26710.post@n5.nabble.com>

Hello

ad 1. removing plugins - doesent work, rabbitmq still consume memory to
infinity
ad 2. rabbitmq under 5.10.1 - doesent work, rabbitmq still consume memory to
infinity

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26710.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From dpanchyrz at proximetry.pl  Wed May 15 13:28:27 2013
From: dpanchyrz at proximetry.pl (rabbit666)
Date: Wed, 15 May 2013 05:28:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368619663987-26710.post@n5.nabble.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
	<1368619663987-26710.post@n5.nabble.com>
Message-ID: <1368620907646-26713.post@n5.nabble.com>

./sbin/rabbitmqctl -q status
[{pid,2634},
 {running_applications,[{rabbit,"RabbitMQ","3.1.0"},
                        {os_mon,"CPO  CXC 138 46","2.2.11"},
                        {mnesia,"MNESIA  CXC 138 12","4.8"},
                        {xmerl,"XML parser","1.3.3"},
                        {sasl,"SASL  CXC 138 11","2.3.1"},
                        {stdlib,"ERTS  CXC 138 10","1.19.1"},
                        {kernel,"ERTS  CXC 138 10","2.16.1"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R16B (erts-5.10.1) [source] [64-bit] [smp:24:24]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,34687984},
          {connection_procs,2792},
          {queue_procs,5584},
          {plugins,0},
          {other_proc,10160780},
          {mnesia,60208},
          {mgmt_db,0},
          {msg_index,40528},
          {other_ets,844616},
          {binary,7400},
          {code,16226134},
          {atom,561761},
          {other_system,6778181}]},
 {vm_memory_high_watermark,100.0},
 {vm_memory_limit,10152182579200},
 {disk_free_limit,0},
 {disk_free,1058329174016},
 {file_descriptors,[{total_limit,924},
                    {total_used,3},
                    {sockets_limit,829},
                    {sockets_used,1}]},
 {processes,[{limit,1048576},{used,144}]},
 {run_queue,0},
 {uptime,2371}]



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26713.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed May 15 14:21:53 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 May 2013 14:21:53 +0100
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368620907646-26713.post@n5.nabble.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
	<1368619663987-26710.post@n5.nabble.com>
	<1368620907646-26713.post@n5.nabble.com>
Message-ID: <51938BF1.7070106@rabbitmq.com>

On 15/05/13 13:28, rabbit666 wrote:
> ad 1. removing plugins - doesent work, rabbitmq still consume memory to
> infinity
> ad 2. rabbitmq under 5.10.1 - doesent work, rabbitmq still consume memory to
> infinity

do you have a 'rabbitmqctl status' report for that?

The one below...

> ./sbin/rabbitmqctl -q status
> [{pid,2634},
>   {running_applications,[{rabbit,"RabbitMQ","3.1.0"},
>                          {os_mon,"CPO  CXC 138 46","2.2.11"},
>                          {mnesia,"MNESIA  CXC 138 12","4.8"},
>                          {xmerl,"XML parser","1.3.3"},
>                          {sasl,"SASL  CXC 138 11","2.3.1"},
>                          {stdlib,"ERTS  CXC 138 10","1.19.1"},
>                          {kernel,"ERTS  CXC 138 10","2.16.1"}]},
>   {os,{unix,linux}},
>   {erlang_version,"Erlang R16B (erts-5.10.1) [source] [64-bit] [smp:24:24]
> [async-threads:30] [hipe] [kernel-poll:true]\n"},
>   {memory,[{total,34687984},

...shows only 34MB, but judging by the other figures that is from an 
idle rabbit.

Also, as suggested previously, please run a test with MulticastMain in 
order to compare results.

Regards,

Matthias.

From simon at rabbitmq.com  Wed May 15 14:33:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 May 2013 14:33:06 +0100
Subject: [rabbitmq-discuss] question about rabbitmq http api basic auth
In-Reply-To: <09fe60af-9109-4e14-af2f-ae49cc42d365@googlegroups.com>
References: <09fe60af-9109-4e14-af2f-ae49cc42d365@googlegroups.com>
Message-ID: <51938E92.3040105@rabbitmq.com>

On 15/05/13 03:32, Sungwon Jung wrote:
> Hello. I have a question about rabbitmq http api basic auth.
>
> I use rabbitmq v3.1.0 and my code is below.

<snip code>

I ran your code successfully (once I changed the HttpPut to an HttpGet), 
and changed the user / password / hostname / vhost to point to my rabbit.

> 11:21:08 [WARN ](DefaultRequestDirector.java:1095) Authentication error:
> basic authorization challenge expected, but not found

I never saw this (using HttpClient 4.2.5).

> 11:21:08 [INFO ](HealthCheckController.java:103) ===================
> 11:21:08 [INFO ](HealthCheckController.java:104) HTTP/1.1 401
> Unauthorized [Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted
> it blue), Date: Wed, 15 May 2013 02:21:08 GMT
> , Content-Length: 50]
> 11:21:08 [INFO ](HealthCheckController.java:108)
> {"error":"not_authorised","reason":"Login failed"}

...and this really implies that your user is not authorised to connect. 
That's exactly what you would see if the username / password is wrong.

Cheers, Simon

> 11:21:08 [INFO ](HealthCheckController.java:110) ===================
>
>
> account, password, ip and api are all correct. but I cannot authorized.
>
> What's wrong in my code?
>
> Thank you.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From luodaidong at sina.com  Wed May 15 14:36:29 2013
From: luodaidong at sina.com (luodaidong at sina.com)
Date: Wed, 15 May 2013 21:36:29 +0800 
Subject: [rabbitmq-discuss] =?gbk?b?u9i4tKO6UmU6ICBhYm91dCBleGNoYW5nZSB0?=
	=?gbk?q?o_exchange_binding?=
Message-ID: <20130515133629.70D1D730001@webmail.sinamail.sina.com.cn>

 Thank you?I see?



----- ???? -----
????Simon MacMullen <simon at rabbitmq.com>
????luodaidong at sina.com, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
???Re: [rabbitmq-discuss] about exchange to exchange binding
???2013?05?15? 20?32?

On 15/05/13 13:03, luodaidong at sina.com wrote:
> can anybody tell me where can I find the document about exchange to
> exchange binding with http API?
I was going to tell you to read the API documentation - but then I 
realised it didn't explicitly mention e2e. So I have added a couple of 
rows to it:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/4741fc9db1dd/priv/www/api/index.html
Does this make sense now?
Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, Pivotal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/8b40fe4e/attachment.htm>

From dpanchyrz at proximetry.pl  Wed May 15 14:49:39 2013
From: dpanchyrz at proximetry.pl (rabbit666)
Date: Wed, 15 May 2013 06:49:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <51938BF1.7070106@rabbitmq.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
	<1368619663987-26710.post@n5.nabble.com>
	<1368620907646-26713.post@n5.nabble.com>
	<51938BF1.7070106@rabbitmq.com>
Message-ID: <1368625779575-26720.post@n5.nabble.com>

hey,

last rabbitmq status before the machine hang up included.


[{pid,4404},
 {running_applications,[{rabbit,"RabbitMQ","3.1.0"},
                        {os_mon,"CPO  CXC 138 46","2.2.11"},
                        {mnesia,"MNESIA  CXC 138 12","4.8"},
                        {xmerl,"XML parser","1.3.3"},
                        {sasl,"SASL  CXC 138 11","2.3.1"},
                        {stdlib,"ERTS  CXC 138 10","1.19.1"},
                        {kernel,"ERTS  CXC 138 10","2.16.1"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R16B (erts-5.10.1) [source] [64-bit] [smp:24:24]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,34566105872},
          {connection_procs,431644344},
          {queue_procs,2797310424},
          {plugins,0},
          {other_proc,1015285623},
          {mnesia,820216},
          {mgmt_db,0},
          {msg_index,262152},
          {other_ets,1675096},
          {binary,30285489264},
          {code,16226134},
          {atom,561761},
          {other_system,16830858}]},
 {vm_memory_high_watermark,100.0},
 {vm_memory_limit,10152182579200},
 {disk_free_limit,0},
 {disk_free,1058329022464},
 {file_descriptors,[{total_limit,924},
                    {total_used,491},
                    {sockets_limit,829},
                    {sockets_used,489}]},
 {processes,[{limit,1048576},{used,5771}]},
 {run_queue,148},
 {uptime,437}]
...done.
Status of node rabbit at katlabucs2 ...

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26720.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed May 15 14:58:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 May 2013 14:58:27 +0100
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368625779575-26720.post@n5.nabble.com>
References: <1368458785228-26626.post@n5.nabble.com>
	<CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
	<1368619663987-26710.post@n5.nabble.com>
	<1368620907646-26713.post@n5.nabble.com>
	<51938BF1.7070106@rabbitmq.com>
	<1368625779575-26720.post@n5.nabble.com>
Message-ID: <51939483.5020305@rabbitmq.com>

On 15/05/13 14:49, rabbit666 wrote:
> last rabbitmq status before the machine hang up included.
> [...]
>   {memory,[{total,34566105872},

right, so that's 34GB, which is indeed a lot.

As suggested previously please run the MulticastMain program that ships 
with the Java client:

$ runjava.sh com.rabbitmq.examples.MulticastMain -q 1 -n 2 -s 609 -C 600000

This replicates your test, namely publishing 600,000 messages of 609 bytes.

If you see excessive memory use with that then something weird is going 
on with rabbit. If not then your own tests are doing something different.

Regards,

Matthias.


From watson.timothy at gmail.com  Wed May 15 15:26:25 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 15 May 2013 15:26:25 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
Message-ID: <15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>

Please take a look at the server (i.e., RabbitMQ) log and see if the connection attempt is getting through, as per Matthias' suggestion.

Cheers,
Tim

On 15 May 2013, at 09:32, "Balachandar R.A." <balachandar.ra at gmail.com> wrote:

> I am not doing anything for authentication.
> 
> I have installed rabbitmq using apt get install...
> 
> I created simple hello world producer and consumer, and launched in A and B.
> 
> Do I need to any other config for the user? If so, how to do it?
> 
> On 15 May 2013 13:54, "Tim Watson" <watson.timothy at gmail.com> wrote:
> On 15 May 2013, at 09:09, "Balachandar R.A." <balachandar.ra at gmail.com> wrote
>> Caught: com.rabbitmq.client.PossibleAuthenticationFailureException:
>> 
> 
> Looks like an authentication failure!? How're you proving credentials from both clients? Do both users have relevant permissions?
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/1d2cfe67/attachment.htm>

From simon at rabbitmq.com  Wed May 15 15:37:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 May 2013 15:37:30 +0100
Subject: [rabbitmq-discuss] Flow control issue when shovelling messages
 between data centres
In-Reply-To: <65418637-67a4-469a-b18d-f6ef00f6ac2b@googlegroups.com>
References: <0cadcddc-2cc1-4fac-8eb4-a4bf97ba904f@googlegroups.com>
	<65418637-67a4-469a-b18d-f6ef00f6ac2b@googlegroups.com>
Message-ID: <51939DAA.4020706@rabbitmq.com>

On 15/05/13 10:48, SimonT wrote:
> I'd be interested though to understand better the relationship is
> between down-stream queue size / consumption rate and flow control.

A connection will go into flow control if it is trying to enqueue 
messages faster than the queue(s) can accept them....

> For
> example, if the consumer is not keeping up and the queue is growing,
> will this increase the chance of flow control at the publisher.

...and the amount of work done to accept a message is much higher if the 
message must go to disc. So if you're publishing persistent messages the 
cost should be constant, but if you're publishing transient messages 
there's a big step change in cost to accept a message when a queue gets 
big enough that RabbitMQ starts to page it out.

> Also
> what is the effect of TTL on the queue - e.g. will a shorter TTL result
> in less up-streamm flow control?

Only to the extent that it keeps such a queue shorter.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Wed May 15 15:37:41 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 15 May 2013 18:37:41 +0400
Subject: [rabbitmq-discuss] Workflow for optional data in HTTP server
	process?
In-Reply-To: <41B10089-6A9F-45B2-BC0E-089D8C9081FB@teksol.info>
References: <41B10089-6A9F-45B2-BC0E-089D8C9081FB@teksol.info>
Message-ID: <CAE3HoVRJMqGnNvRwfkHdoenXcmpHi4k2SHXvFOE64A_x+UXbcQ@mail.gmail.com>

2013/5/13 Fran?ois Beausoleil <francois at teksol.info>

> When the request hits the web server process, is it expected that it would
> open a channel, create a server-named queue and send the request, with
> reply-to set to the queue?


It doesn't have to open a new channel but it is fine if you do so (opening
a channel is a network roundtrip with a tiny payload).

Your thinking is basically correct. You can combine Ruby's Timeout and
while !(r = queue.get)
to get a response back in under N milliseconds.

This won't be a particularly efficient combination because Timeout starts a
new thread for every Timeout.timeout
call but there are no other straightforward options with Rails/Sinatra and
Bunny.

I'm not sure I understand the "optional data" part. Could you elaborate?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/39c87d44/attachment.htm>

From aviusexperience at gmail.com  Wed May 15 15:38:52 2013
From: aviusexperience at gmail.com (aviusexperience at gmail.com)
Date: Wed, 15 May 2013 07:38:52 -0700 (PDT)
Subject: [rabbitmq-discuss] HTTP API Callback
Message-ID: <e436f921-9cf5-42cd-9e4d-a501fe880e87@googlegroups.com>

Hi,

Just wondering if there is a way RabbitMQ can send messages to a rest based 
API, for example I have an application that publishes a message to RabbitMQ 
when a certain action is performed, would RabbitMQ then be able to 
automatically send that message to another endpoint e.g. 
http://localhost/api/receive?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/14381bc6/attachment.htm>

From francois at teksol.info  Wed May 15 16:19:41 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Wed, 15 May 2013 11:19:41 -0400
Subject: [rabbitmq-discuss] Workflow for optional data in HTTP server
	process?
In-Reply-To: <CAE3HoVRJMqGnNvRwfkHdoenXcmpHi4k2SHXvFOE64A_x+UXbcQ@mail.gmail.com>
References: <41B10089-6A9F-45B2-BC0E-089D8C9081FB@teksol.info>
	<CAE3HoVRJMqGnNvRwfkHdoenXcmpHi4k2SHXvFOE64A_x+UXbcQ@mail.gmail.com>
Message-ID: <32A4E583-D827-45D4-9CA4-5FB023B74E51@teksol.info>


Le 2013-05-15 ? 10:37, Michael Klishin a ?crit :

> 
> 2013/5/13 Fran?ois Beausoleil <francois at teksol.info>
> When the request hits the web server process, is it expected that it would open a channel, create a server-named queue and send the request, with reply-to set to the queue?
> 
> I'm not sure I understand the "optional data" part. Could you elaborate?

If the UI is missing that data, then it's no big deal. It's a best-effort.

Thanks for validating my reasoning. I'll probably skip the network round-trip for the channel, since that will give me a bit more time to do other, more important, work.

Bye!
Fran?ois
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/11e5fbb1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/11e5fbb1/attachment.bin>

From videlalvaro at gmail.com  Wed May 15 17:51:45 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 15 May 2013 18:51:45 +0200
Subject: [rabbitmq-discuss] [ANN] RabbitMQ workshop in Madrid
Message-ID: <CAMcAHLWewKDdW1PT2E_7oRkbbeXkTSm4iKan1pNn8+Oam_uM=A@mail.gmail.com>

Hi,

There will be a RabbitMQ workshop in Madrid.

It's free as in beer and in Spanish.

More details here: http://www.eventbrite.com/event/6710117141

Cheers,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/a4ab3723/attachment.htm>

From Ron.Cordell at RelayHealth.com  Wed May 15 20:02:49 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron L)
Date: Wed, 15 May 2013 19:02:49 +0000
Subject: [rabbitmq-discuss] Balancing Queues across nodes in a cluster
Message-ID: <0B8CD6850421B745BE39BC5C7601923271F66318@DDCEP50015.na.corp.mckesson.com>

We are using RabbitMQ 3.0.1 in a cluster behind an F5 load balancer.
The application works with RMQ through the VIP exposed by the F5.
The application is responsible for making sure that queues/exchanges are set up for the application. In other words, we don't use a separate mechanism to set up queues and exchanges.
As a result of this queues may end up on a random node once created.
Once queues are created they remain; they are not "torn down" and re-established periodically or anything like that.
Most queues are HA/mirrored queues.

My question is around balancing node resources. If a queue becomes somewhat busy, can I move make a different node master for that queue (assuming a mirrored queue)? I don't want to take down the node as I have other queues on that node; I just want to move the master for a particular queue, if possible.

Looking at past queries about this it appears that this might not be possible, so one answer may be that we should change how we create queues...

Cheers,

Ron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/7dc4fa67/attachment.htm>

From michael.s.klishin at gmail.com  Wed May 15 21:51:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 16 May 2013 00:51:18 +0400
Subject: [rabbitmq-discuss] Telling clean shutdown from an error-related one
Message-ID: <CAE3HoVSB_aoD94CqV18RjrK1+mS0KizKhs6q2b_fB6o7KYkOSA@mail.gmail.com>

I'm investigating an issue report for Langohr:
https://github.com/michaelklishin/langohr/issues/16#issuecomment-17964559

and not entirely sure when SignalShutdownException#isInitiatedByApplication
returns true and if it can really be used to tell a clean shutdown (e.g.
when you
voluntarily close channels).

http://www.rabbitmq.com/api-guide.html does not shed much light on this.

What's the recommended way to detect network errors, channel AND
consumer-level
exceptions vs clean termination?

Thanks.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/2428dd36/attachment.htm>

From billythethird at gmail.com  Thu May 16 01:17:30 2013
From: billythethird at gmail.com (Billy Hand)
Date: Wed, 15 May 2013 19:17:30 -0500
Subject: [rabbitmq-discuss] getting duplicated delivery
Message-ID: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>

Hi,

I'm somewhat new to RabbitMQ and have a problem.  I have implemented
workers that consume from one queue.  On the virtual server (single core,
slow) I'm developing on it works exactly as it should.

When I put it on my live server (16 cores, mostly idle, fast) a single
message gets consumed simultaneously by all the workers (duplicated).  I
had a hunch that I might not be ack-ing fast enough so I switched no_ack on
and that fixed the problem.  I'm fine with leaving no_ack on but I'm
concerned that I am misunderstanding something important.

Please advise.  Thanks!

--Billy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/bef50a62/attachment.htm>

From gmr at meetme.com  Thu May 16 01:27:07 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 15 May 2013 20:27:07 -0400
Subject: [rabbitmq-discuss] Pika 0.9.13 Released
Message-ID: <4E6AFD65818B40EF9008C9026D6035BF@meetme.com>

I have tagged and pushed 0.9.13 to pypi. 0.9.13 is primarily a bug fix release but contains several major changes, the most substantial of which is dropping support for Python 2.4 and Python 2.5. These versions have been broken in Pika for the past few releases and as of late I'm receiving more inquiries for Python 3 support than I have had for older versions.  

The documentation has received a bit of an overhaul as well: http://pika.readthedocs.org

**Major Changes**

- IPv6 Support with thanks to Alessandro Tagliapietra for initial prototype
- Officially remove support for <= Python 2.5 even though it was broken already
- Drop pika.simplebuffer.SimpleBuffer in favor of the Python stdlib collections.deque object
- New default object for receiving content is a "bytes" object which is a str wrapper in Python 2, but paves way for Python 3 support
- New "Raw" mode for frame decoding content frames (#334) addresses issues #331, #229 added by Garth Williamson
- Connection and Disconnection logic refactored, allowing for cleaner separation of protocol logic and socket handling logic as well as connection state management
- New "on_open_error_callback" argument in creating connection objects and new Connection.add_on_open_error_callback method
- New Connection.connect method to cleanly allow for reconnection code
- Support for all AMQP field types, using protocol specified signed/unsigned unpacking

**Backwards Incompatible Changes**

- Method signature for creating connection objects has new argument "on_open_error_callback" which is positionally before "on_close_callback"
- Internal callback variable names in connection.Connection have been renamed and constants used. If you relied on any of these callbacks outside of their internal use, make sure to check out the new constants.
- Connection._connect method, which was an internal only method is now deprecated and will raise a DeprecationWarning. If you relied on this method, your code needs to change.
- pika.simplebuffer has been removed

**Bugfixes**

- BlockingConnection consumer generator does not free buffer when exited (#328)
- Unicode body payloads in the blocking adapter raises exception (#333)
- Support "b" short-short-int AMQP data type (#318)
- Docstring type fix in adapters/select_connection (#316) fix by Rikard Hult?n
- IPv6 not supported (#309)
- Stop the HeartbeatChecker when connection is closed (#307)
- Unittest fix for SelectConnection (#336) fix by Erik Andersson
- Handle condition where no connection or socket exists but SelectConnection needs a timeout for retrying a connection (#322)
- TwistedAdapter lagging behind BaseConnection changes (#321) fix by Jan Urba?ski

**Other**

- Refactored documentation
- Added Twisted Adapter example (#314) by nolinksoft


As always, please report bugs or other issues at https://github.com/pika/pika/issues

Cheers,

Gavin  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/441ddad9/attachment.htm>

From francois at teksol.info  Thu May 16 01:52:42 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Wed, 15 May 2013 20:52:42 -0400
Subject: [rabbitmq-discuss] 700k msgs using 6.3 GiB?
Message-ID: <9C056A40-C6D5-470F-B3BB-FD32E2CC059E@teksol.info>

Hi all!

Attached are a report and screenshot showing my RabbitMQ instance using 6.3 GiB of RAM for a mere 700,000 3 KiB messages. I've had 17 million messages on that same machine three weeks ago. The machine is an 8 GiB virtual machine instance with 2 GiB swap. I had the high memory watermark set to 0.8, because I preferred to block less and I didn't expect to hit problems. My consumers are fast enough.

Looking at the report, I see 5.5 GiB of RAM used by binaries. Isn't that what's supposed to be paged out to disk?

The three queues with unconsumed messages are holding message of 3KiB or less. That's a maximum of 3 GiB.

I rebooted the machine after taking that report and screenshot, so I'm processing again now.

What did I do wrong?

Thank you for any enlightenment!
Fran?ois

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: report.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/c94bcd75/attachment.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ Management.jpeg
Type: image/jpg
Size: 44560 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/c94bcd75/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/c94bcd75/attachment.bin>

From matthias at rabbitmq.com  Thu May 16 03:44:35 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 May 2013 03:44:35 +0100
Subject: [rabbitmq-discuss] 700k msgs using 6.3 GiB?
In-Reply-To: <9C056A40-C6D5-470F-B3BB-FD32E2CC059E@teksol.info>
References: <9C056A40-C6D5-470F-B3BB-FD32E2CC059E@teksol.info>
Message-ID: <51944813.4040803@rabbitmq.com>

Fran?ois,

On 16/05/13 01:52, Fran?ois Beausoleil wrote:
> Attached are a report and screenshot showing my RabbitMQ instance
> using 6.3 GiB of RAM for a mere 700,000 3 KiB messages.
>
> What did I do wrong?

There are a number of empty queues with fairly high memory usage. 
Judging from the sequence numbers - several hundred million - and uptime 
(~3 weeks) they are probably moving at a reasonable pace under normal 
conditions, though obviously not much is moving at the time of the 
report since the producers were blocked.

Such active queues take up substantially more memory than idle queues. 
Much of that will be garbage that hasn't been collected yet. That 
garbage in turn may reference message payloads. That's how megs of queue 
memory can turn into gigs of binary memory since non-tiny message 
payloads are not counted towards queue memory but binary memory.

So I don't think there is anything unusual going on here. Having said 
that, it would really help our future investigation if you

1) ran the most recent rabbit version (3.1.0)
2) ran the most recent Erlang version (R16B)
3) disabled non-essential plug-ins

Thanks.

Matthias.

From francois at teksol.info  Thu May 16 05:01:24 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Thu, 16 May 2013 00:01:24 -0400
Subject: [rabbitmq-discuss] 700k msgs using 6.3 GiB?
In-Reply-To: <51944813.4040803@rabbitmq.com>
References: <9C056A40-C6D5-470F-B3BB-FD32E2CC059E@teksol.info>
	<51944813.4040803@rabbitmq.com>
Message-ID: <00FF009B-EF5E-40A0-9169-6C2CE14E4BC5@teksol.info>

Matthias,

Le 2013-05-15 ? 22:44, Matthias Radestock a ?crit :

> Fran?ois,
> 
> On 16/05/13 01:52, Fran?ois Beausoleil wrote:
>> Attached are a report and screenshot showing my RabbitMQ instance
>> using 6.3 GiB of RAM for a mere 700,000 3 KiB messages.
>> 
>> What did I do wrong?
> 
> There are a number of empty queues with fairly high memory usage. Judging from the sequence numbers - several hundred million - and uptime (~3 weeks) they are probably moving at a reasonable pace under normal conditions, though obviously not much is moving at the time of the report since the producers were blocked.

Yup, I move millions of messages per day, per queue. My normal rate is 5000 messages/s publish and acknowledge. The application is a processing pipeline: tweets on one end, analytics on the other.

> Such active queues take up substantially more memory than idle queues. Much of that will be garbage that hasn't been collected yet. That garbage in turn may reference message payloads. That's how megs of queue memory can turn into gigs of binary memory since non-tiny message payloads are not counted towards queue memory but binary memory.

Why would the garbage not have been collected yet? Any ideas? I don't want to schedule weekly server reboots to clean out garbage.

> So I don't think there is anything unusual going on here. Having said that, it would really help our future investigation if you
> 
> 1) ran the most recent rabbit version (3.1.0)
> 2) ran the most recent Erlang version (R16B)
> 3) disabled non-essential plug-ins

I'm waiting for the dust to settle on RabbitMQ 3.1.0 - 3.1.1 really (let other brave souls use the latest and greatest). I use the packaged versions of Erlang on Ubuntu 12.04. I only enable the plugins I need, namely the consistent hash exchange and management console.

Bye,
Fran?ois

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/b8941e7a/attachment.bin>

From balachandar.ra at gmail.com  Thu May 16 07:33:57 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Thu, 16 May 2013 12:03:57 +0530
Subject: [rabbitmq-discuss] Global variable
Message-ID: <CALEC75L1r1yVm_HtRTRX9uC2erOhpMW0a5c_er=8J7imsFsSvg@mail.gmail.com>

Hello

Can we have a global variable in rabbitMQ server which all the consumers
can access?

Regards
Balson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/1856932c/attachment.htm>

From natewang0425 at gmail.com  Thu May 16 07:36:26 2013
From: natewang0425 at gmail.com (Nate)
Date: Wed, 15 May 2013 23:36:26 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <519353D2.4020400@rabbitmq.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
	<51933936.60008@rabbitmq.com>
	<CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>
	<519353D2.4020400@rabbitmq.com>
Message-ID: <CAHqyxU0XU1K0imG-QwZiLS-_akkpnf7+0biN8sPR25WyyMx3sw@mail.gmail.com>

Hi Matthias,

    Bad news, I cannot get the dump file via command "kill -SIGUSR1 8972"
and process still exist. Are there any other method to get the dump file?
Btw, this is first time the rabbitmq-server did the log rotation.
Thanks a lot.

Best Regards,
Nate


2013/5/15 Matthias Radestock-3 [via RabbitMQ] <
ml-node+s1065348n26706h51 at n5.nabble.com>

> Nate,
>
> On 15/05/13 09:51, Nate wrote:
> > 1.  Did logs get rotated successfully in the past or did all log
> > rotations get stuck?
> > Only two of nodes in the cluster get stuck. And two clusters are in the
> > same situation.
>
> My question was whether the logs on these nodes ever got rotated
> successfully in the past.
>
> > 2. Your initial report showed a few more processes, including a
> > beam.smpprocess. Presumably that's still there too, right? If so, please
> > postthe complete command line for that.
> >
> > rabbitmq  8972  0.0  2.8 580024 510588 ?       Ssl  May12   0:00
> > /usr/lib/erlang/erts-5.9/bin/beam.smp -- -root /usr/lib/erlang -progname
> > erl -- -home /var/lib/rabbitmq -- -pa
> > /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/sbin/../ebin -noshell
> > -noinput -hidden -sname rabbitmqctl8972 -s rabbit_control_main -nodename
> > rabbit at rabbitmq1 -extra rotate_logs
> >
> > 3. I wanna know the root cause too! Therefore, I prefer to keeping the
> > process and let it telling us the reason.
>
> Unfortunately the rabbitmqctl node is a hidden node, so we cannot
> connect to it. The best we can do is make it crash with
>
>    kill -SIGUSR1 8972
>
> That should produce an erl_crash.dump. Not sure where it will end up
> though. Possibly in the rabbitmq home dir. Anyway, I'm sure you'll
> manage to track it down. Stick that crash dump on something like dropbox
> and post a link.
>
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=26706&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26706.html
>  To unsubscribe from Re: After weekly log rotatation was done, the command
> "rabbitmqctl rotate-logs" never stop, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=26607&code=bmF0ZXdhbmcwNDI1QGdtYWlsLmNvbXwyNjYwN3w0NTY2Njg2Njk=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26736.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130515/31648cd7/attachment.htm>

From watson.timothy at gmail.com  Thu May 16 08:03:44 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 16 May 2013 08:03:44 +0100
Subject: [rabbitmq-discuss] Global variable
In-Reply-To: <CALEC75L1r1yVm_HtRTRX9uC2erOhpMW0a5c_er=8J7imsFsSvg@mail.gmail.com>
References: <CALEC75L1r1yVm_HtRTRX9uC2erOhpMW0a5c_er=8J7imsFsSvg@mail.gmail.com>
Message-ID: <2AE27398-C71D-4751-8B7B-7A672671BBFD@rabbitmq.com>

On 16 May 2013, at 07:33, "Balachandar R.A." <balachandar.ra at gmail.com> wrote:

> Can we have a global variable in rabbitMQ server which all the consumers can access?
> 
No and I'm now aware of any messaging products that do either.

Cheers,
Tim


> _________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/8d461e41/attachment.htm>

From watson.timothy at gmail.com  Thu May 16 08:08:28 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 16 May 2013 08:08:28 +0100
Subject: [rabbitmq-discuss] getting duplicated delivery
In-Reply-To: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>
References: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>
Message-ID: <C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>

On 16 May 2013, at 01:17, Billy Hand <billythethird at gmail.com> wrote:

> When I put it on my live server (16 cores, mostly idle, fast) a single message gets consumed simultaneously by all the workers (duplicated).  

Are you sure about that? It's not just the same payload being sent repeatedly? What does your consumer code look like and how have you determined that this is taking place? Once a message is acked and delivered, a queue will not send it (i.e., the same message) to any further consumers. Are you checking the correlation-id to confirm the uniqueness of the message?

Cheers,
Tim

From matthias at rabbitmq.com  Thu May 16 08:54:38 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 May 2013 08:54:38 +0100
Subject: [rabbitmq-discuss] 700k msgs using 6.3 GiB?
In-Reply-To: <00FF009B-EF5E-40A0-9169-6C2CE14E4BC5@teksol.info>
References: <9C056A40-C6D5-470F-B3BB-FD32E2CC059E@teksol.info>
	<51944813.4040803@rabbitmq.com>
	<00FF009B-EF5E-40A0-9169-6C2CE14E4BC5@teksol.info>
Message-ID: <519490BE.60507@rabbitmq.com>

Fran?ois,

On 16/05/13 05:01, Fran?ois Beausoleil wrote:
> Why would the garbage not have been collected yet? Any ideas?

Garbage collectors generally don't collect garbage instantly.

However, pretty much all garbage should get collected when the system is 
idle. In particular, when there is no activity on a queue, or any other 
Erlang processes in the message processing pipeline, for a while then 
these processes are supposed to hibernate, which entails reclaiming all 
garbage.

That may not be happening in your system, i.e. either something is 
preventing idling, or processes don't hibernate despite being idle.

But to investigate that further we really need you on the latest 
versions of rabbit and erlang.

> I only enable the plugins I need, namely the consistent hash exchange
> and management console.

I am not suggesting that you run w/o plug-ins permanently, but in order 
to eliminate potential causes of the high memory use it would help to 
disable non-essential plug-ins temporarily.


Regards,

Matthias.

From tim at rabbitmq.com  Thu May 16 09:14:46 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 09:14:46 +0100
Subject: [rabbitmq-discuss] Telling clean shutdown from an error-related
	one
In-Reply-To: <CAE3HoVSB_aoD94CqV18RjrK1+mS0KizKhs6q2b_fB6o7KYkOSA@mail.gmail.com>
References: <CAE3HoVSB_aoD94CqV18RjrK1+mS0KizKhs6q2b_fB6o7KYkOSA@mail.gmail.com>
Message-ID: <6BB0CA55-F137-4BE1-A575-B55B07D8F6CF@rabbitmq.com>

Hi Michael,

On 15 May 2013, at 21:51, Michael Klishin wrote:

> I'm investigating an issue report for Langohr:
> https://github.com/michaelklishin/langohr/issues/16#issuecomment-17964559
> 
> and not entirely sure when SignalShutdownException#isInitiatedByApplication
> returns true and if it can really be used to tell a clean shutdown (e.g. when you
> voluntarily close channels).
> 

That property will evaluate to true whenever the source of the shutdown originated in the client application, whether by deliberate closure or application error. So I'm not sure that you can differentiate based on that properly alone. Certainly the property will always be set to true when a channel is deliberately closed by the application, via a call to #close() or #waitForConfirmsOrDie and so on. However the comment at https://github.com/michaelklishin/langohr/issues/16#issuecomment-17964103 is correct, in that an exception in the consumer code will still set #isInitiatedByApplication to true.

So IMO, even when #isInitiatedByApplication is true, we should probably make it easier to determine whether a channel close was a deliberate action or the result of an application error. I'll file a bug for that.

> What's the recommended way to detect network errors

For these, #isInitiatedByApplication will be false. You can also look at the exception tucked away in #getReason to determine this, at least to some extent.

> , channel AND consumer-level exceptions vs clean termination?

There is no clean way to do this atm afaict - I think Ian Eure's analysis is correct and the the only way to differentiate between the two right now would be to "go spelunking through the object tree looking for the text 'Closed due to exception'" in Exception#getMessage. As I said, we'll fix that.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/1be834b2/attachment.htm>

From matthias at rabbitmq.com  Thu May 16 09:20:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 May 2013 09:20:12 +0100
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <CAHqyxU0XU1K0imG-QwZiLS-_akkpnf7+0biN8sPR25WyyMx3sw@mail.gmail.com>
References: <5190B338.9040206@rabbitmq.com>
	<1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
	<51933936.60008@rabbitmq.com>
	<CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>
	<519353D2.4020400@rabbitmq.com>
	<CAHqyxU0XU1K0imG-QwZiLS-_akkpnf7+0biN8sPR25WyyMx3sw@mail.gmail.com>
Message-ID: <519496BC.2070604@rabbitmq.com>

On 16/05/13 07:36, Nate wrote:
>      Bad news, I cannot get the dump file via command "kill -SIGUSR1
> 8972" and process still exist.

Weird. Did it return / complain about anything? You may have to run it 
as root. What O/S is this on?

If we cannot get the process to react to SIGUSR1 then we are stuck.

Matthias.

From simonthorogood at hotmail.com  Thu May 16 09:44:05 2013
From: simonthorogood at hotmail.com (SimonT)
Date: Thu, 16 May 2013 01:44:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Flow control issue when shovelling messages
 between data centres
In-Reply-To: <51939DAA.4020706@rabbitmq.com>
References: <0cadcddc-2cc1-4fac-8eb4-a4bf97ba904f@googlegroups.com>
	<65418637-67a4-469a-b18d-f6ef00f6ac2b@googlegroups.com>
	<51939DAA.4020706@rabbitmq.com>
Message-ID: <1368693845599-26742.post@n5.nabble.com>

Thanks Simon, much appreciated. In our case, as far as we can tell, these
rabbit nodes have bags of available RAM when the flow control occurs - would
you still expect paging to disc of messages in that case?

Another thing to mention is that we are using a rather old version (RabbitMQ
2.8.2 on Erlang R14B04). Do you think this might be relevant?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Flow-control-issue-when-shovelling-messages-between-data-centres-tp26680p26742.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From balachandar.ra at gmail.com  Thu May 16 10:00:21 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Thu, 16 May 2013 14:30:21 +0530
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
Message-ID: <CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>

Hello

I do not see any error information in the logs found in /var/log/rabbitmq/
directory

Any help will very much helpful
On 15 May 2013 20:04, "Tim Watson" <watson.timothy at gmail.com> wrote:

> Please take a look at the server (i.e., RabbitMQ) log and see if the
> connection attempt is getting through, as per Matthias' suggestion.
>
> Cheers,
> Tim
>
> On 15 May 2013, at 09:32, "Balachandar R.A." <balachandar.ra at gmail.com>
> wrote:
>
> I am not doing anything for authentication.
>
> I have installed rabbitmq using apt get install...
>
> I created simple hello world producer and consumer, and launched in A and
> B.
>
> Do I need to any other config for the user? If so, how to do it?
> On 15 May 2013 13:54, "Tim Watson" <watson.timothy at gmail.com> wrote:
>
>> On 15 May 2013, at 09:09, "Balachandar R.A." <balachandar.ra at gmail.com>
>> wrote
>>
>>  Caught: com.rabbitmq.client.PossibleAuthenticationFailureException:
>>
>>
>> Looks like an authentication failure!? How're you proving credentials
>> from both clients? Do both users have relevant permissions?
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/8219edc4/attachment.htm>

From tim at rabbitmq.com  Thu May 16 10:05:37 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 10:05:37 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
	<CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
Message-ID: <04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>

On 16 May 2013, at 10:00, Balachandar R.A. wrote:
> I do not see any error information in the logs found in /var/log/rabbitmq/ directory
> 
If you see nothing in the logs pertaining to that connection attempt whatsoever, then clearly that consumer is unable to get connectivity to the broker at all. Is there any intermediate network kit between the two? Have you checked firewall setting (e.g., iptables, etc) on all the relevant hosts to ensure that connectivity is allowed? Can you telnet to the broker's host:port from each of the client machines?

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/96947dd2/attachment.htm>

From tim at rabbitmq.com  Thu May 16 10:09:22 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 10:09:22 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
	<CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
	<04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
Message-ID: <2D70B565-B719-43D8-B917-B3C470D959FC@rabbitmq.com>

Oh and one more thing.... You said...
> I am not doing anything for authentication.
> 
What exactly are you doing to make a connection from host A to host B - what does your URL look like?

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/3c1845e1/attachment.htm>

From matthias at rabbitmq.com  Thu May 16 10:10:17 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 May 2013 10:10:17 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
	<CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
	<04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
Message-ID: <5194A279.1070005@rabbitmq.com>

On 16/05/13 10:05, Tim Watson wrote:
> On 16 May 2013, at 10:00, Balachandar R.A. wrote:
>>
>> I do not see any error information in the logs found in
>> /var/log/rabbitmq/ directory
>>
> If you see nothing in the logs pertaining to that connection attempt
> whatsoever, then clearly that consumer is unable to get connectivity to
> the broker at all. Is there any intermediate network kit between the
> two? Have you checked firewall setting (e.g., iptables, etc) on all the
> relevant hosts to ensure that connectivity is allowed? Can you telnet to
> the broker's host:port from each of the client machines?

And, most importantly, you said "I have a machine A wherein I run both 
my producer and consumer, and it is running fine. Now, I want to launch 
one more consumer in another machine B." and "I am not doing anything 
for authentication." - how are you telling the consumer on B to connect 
to the broker on A? Are you setting the host/uri on the ConnectionFactory?

Matthias.

From balachandar.ra at gmail.com  Thu May 16 10:25:25 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Thu, 16 May 2013 14:55:25 +0530
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <2D70B565-B719-43D8-B917-B3C470D959FC@rabbitmq.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
	<CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
	<04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
	<2D70B565-B719-43D8-B917-B3C470D959FC@rabbitmq.com>
Message-ID: <CALEC75LSg24JqkBt0BpKt1Ccqiw9H+5bLQtYeH=9-hwvzwjtMg@mail.gmail.com>

I am able to do the following

telnet ip-of-server 15672

And I could connect to server from my consumer

I installed the server from debian repo. I did sudo apt-get install
rabbitmq..

I did not do any other config and started testing the code.

My code portion is below

ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("40.221.94.235");
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();

    channel.queueDeclare("Q", false, false, false, null);
    System.out.println(" [*] Waiting for messages. To exit press CTRL+C");
QueueingConsumer consumer = new QueueingConsumer(channel);
    channel.basicConsume("task_queue", true, consumer);

    while (true) {
      QueueingConsumer.Delivery delivery = consumer.nextDelivery();
      String message = new String(delivery.getBody());
      System.out.println(" [x] Received '" + message + "'");
    }

With thanks and regards
Balachandar



On 16 May 2013 14:41, "Tim Watson" <tim at rabbitmq.com> wrote:

> Oh and one more thing.... You said...
>
> I am not doing anything for authentication.
>
> What exactly are you doing to make a connection from host A to host B -
> what does your URL look like?
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/1487c1c0/attachment.htm>

From ponmuthu at omnesysindia.com  Thu May 16 10:45:17 2013
From: ponmuthu at omnesysindia.com (PONMUTHU M)
Date: Thu, 16 May 2013 15:15:17 +0530
Subject: [rabbitmq-discuss] problem in starting multi nodes in same
	management plugin 55672
Message-ID: <003a01ce521a$15096e50$3f1c4af0$@omnesysindia.com>

Hi,

Thanks in advance.

rabbitmq-server-3.1.0-1.noarch
Erlang R15B01 

am able to start & view mgmnt plugin using this version.

now my query is , i want to start multiple nodes in a single localhost .
but i can achieve this only disable rabbitmq_management/mochiweb plugin 

i want all nodes mgmnt console in 55672.



Starting with different mgmnt port for each node also fine (how can I change
that ports in ENV) & how can I view those all console in a single console ?


kindly help me !! Description: :)

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/32abeb07/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 675 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/32abeb07/attachment.gif>

From simon at rabbitmq.com  Thu May 16 10:50:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 10:50:12 +0100
Subject: [rabbitmq-discuss] problem in starting multi nodes in same
 management plugin 55672
In-Reply-To: <003a01ce521a$15096e50$3f1c4af0$@omnesysindia.com>
References: <003a01ce521a$15096e50$3f1c4af0$@omnesysindia.com>
Message-ID: <5194ABD4.8090605@rabbitmq.com>

See the second example under:

http://www.rabbitmq.com/clustering.html#single-machine

for how to set management to start on different ports for each node.

You can't get several nodes to open management on the same port - but 
management will show details of all cluster nodes on each port it is 
open on.

Cheers, Simon

On 16/05/13 10:45, PONMUTHU M wrote:
> Hi,
>
> Thanks in advance.
>
> rabbitmq-server-3.1.0-1.noarch
> Erlang R15B01
>
> am able to start & view mgmnt plugin using this version.
>
> now my query is , i want to start multiple nodes in a single localhost .
> but i can achieve this only disable rabbitmq_management/mochiweb plugin
>
> i want all nodes mgmnt console in 55672.
>
> *Starting with different mgmnt port for each node also fine (how can I
> change that ports in ENV) & how can I view those all console in a single
> console ?*
>
>
> kindly help me !! Description: :)
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May 16 10:53:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 10:53:15 +0100
Subject: [rabbitmq-discuss] getting duplicated delivery
In-Reply-To: <C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>
References: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>
	<C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>
Message-ID: <5194AC8B.2010801@rabbitmq.com>

On 16/05/13 08:08, Tim Watson wrote:
> Once a message is acked and
> delivered, a queue will not send it (i.e., the same message) to any
> further consumers.

This is the key point. It will also not redeliver it if the consumer 
just acks slowly.

But the fact that turning off acks solves the problem suggests that the 
messages *are* getting redelivered - so the OP should check the consumer 
code and make sure that messages are being acked before the connection 
or channel is closed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From balachandar.ra at gmail.com  Thu May 16 11:05:09 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Thu, 16 May 2013 15:35:09 +0530
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <CALEC75LSg24JqkBt0BpKt1Ccqiw9H+5bLQtYeH=9-hwvzwjtMg@mail.gmail.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
	<CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
	<04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
	<2D70B565-B719-43D8-B917-B3C470D959FC@rabbitmq.com>
	<CALEC75LSg24JqkBt0BpKt1Ccqiw9H+5bLQtYeH=9-hwvzwjtMg@mail.gmail.com>
Message-ID: <CALEC75JZropSQ_D5Nm16Njx4Jix6YKvLRsTfmJBqOOiYM0wTww@mail.gmail.com>

Any hint in my below issue?

Thanks a lot for ur help
On 16 May 2013 14:55, "Balachandar R.A." <balachandar.ra at gmail.com> wrote:

> I am able to do the following
>
> telnet ip-of-server 15672
>
> And I could connect to server from my consumer
>
> I installed the server from debian repo. I did sudo apt-get install
> rabbitmq..
>
> I did not do any other config and started testing the code.
>
> My code portion is below
>
> ConnectionFactory factory = new ConnectionFactory();
>     factory.setHost("40.221.94.235");
>     Connection connection = factory.newConnection();
>     Channel channel = connection.createChannel();
>
>     channel.queueDeclare("Q", false, false, false, null);
>     System.out.println(" [*] Waiting for messages. To exit press CTRL+C");
> QueueingConsumer consumer = new QueueingConsumer(channel);
>     channel.basicConsume("task_queue", true, consumer);
>
>     while (true) {
>       QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>       String message = new String(delivery.getBody());
>       System.out.println(" [x] Received '" + message + "'");
>     }
>
> With thanks and regards
> Balachandar
>
>
>
> On 16 May 2013 14:41, "Tim Watson" <tim at rabbitmq.com> wrote:
>
>> Oh and one more thing.... You said...
>>
>> I am not doing anything for authentication.
>>
>> What exactly are you doing to make a connection from host A to host B -
>> what does your URL look like?
>>
>> Cheers,
>> Tim
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/c944de95/attachment.htm>

From maze at reik.se  Thu May 16 11:16:35 2013
From: maze at reik.se (Matthias Reik)
Date: Thu, 16 May 2013 12:16:35 +0200
Subject: [rabbitmq-discuss] Disable writing to disk
In-Reply-To: <51933F25.2000300@rabbitmq.com>
References: <519256D4.3080303@reik.se> <51925BCA.7060707@rabbitmq.com>
	<51926760.4020009@reik.se> <51933F25.2000300@rabbitmq.com>
Message-ID: <5194B203.9000407@reik.se>

Thanks for your replies.


On 2013-05-15 9:54 , Emile Joubert wrote:
> On 14/05/13 17:33, Matthias Reik wrote:
>
>> it's ok to keep the content in memory, but not to "store it to disk".
> This presumably then precludes the use of swapfiles on your server as
> well, because copyright material might end up on disk via this route.
Correct
>
> I suggest you check whether any of the excepts made for transient copies
> of copyright works already applies.
In most countries this is not an issue, but for some it seems to be :-( But
as I said, I'm not a legal person :-(
>
>
>
>
> -Emile
>
>
>
>


From tim at rabbitmq.com  Thu May 16 11:24:02 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 11:24:02 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <CALEC75JZropSQ_D5Nm16Njx4Jix6YKvLRsTfmJBqOOiYM0wTww@mail.gmail.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
	<CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
	<04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
	<2D70B565-B719-43D8-B917-B3C470D959FC@rabbitmq.com>
	<CALEC75LSg24JqkBt0BpKt1Ccqiw9H+5bLQtYeH=9-hwvzwjtMg@mail.gmail.com>
	<CALEC75JZropSQ_D5Nm16Njx4Jix6YKvLRsTfmJBqOOiYM0wTww@mail.gmail.com>
Message-ID: <5194B3C2.9040406@rabbitmq.com>

On 05/16/2013 11:05 AM, Balachandar R.A. wrote:
> telnet ip-of-server 15672
>

That's the HTTP port, not the AMQP port. If you've not customised 
anything, then the broker will listen for AMQP connections on 5672. Can 
you telnet to *that* port?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/857c60a5/attachment.htm>

From tim at rabbitmq.com  Thu May 16 12:12:05 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 12:12:05 +0100
Subject: [rabbitmq-discuss] Fwd:  Problem when running second consumer
References: <7A0DA05D-C713-4E42-9D6A-FEEABE574F05@rabbitmq.com>
Message-ID: <6F3B056A-6BDF-4D74-824D-8A211375C6AD@rabbitmq.com>

Putting the list back on CC.

> 
> Right...
> 
> On 16 May 2013, at 11:42, Balachandar R.A. wrote:
> 
>> I did telnet to the host and port as below:-
>>  
>> telnet 40.221.94.235 5672
>> Trying 40.221.94.235...
>> Connected to 40.221.94.235.
>> Escape character is '^]'.
>> Connection closed by foreign host.
> 
> 
> So the network connectivity between your virtual machines seems ok.
> 
>> I can do ping all nodes between each other.
> 
> The ability to send ICMP packets between machines doesn't confirm that all other kinds of communication will work, though it's useful to know. The fact that you can telnet to the broker means that you ought to be able to connect from a regular AMQP client.
> 
>> I did not create any configuration file for rabbit mq.
>> The head node and compute node has only the client jars. (obtained from rabbitmq-java-client-bin-2.3.1)
> 
> Erm, where is the broker running exactly? On this HEAD node yes? Is *that* the machine with the IP address 40.221.94.235?
> 
> I note that in your producer code, you do not set the username or password, whereas in your consumer code you do. You should not need to set these explicitly, since "guest:guest" is the default.
> 
> Please consider running a network capture tool (such as wireshark) to confirm that AMQP frames are in fact being sent from the consumer's machine to the broker's machine correctly. If there is nothing in the rabbit.log or rabbit-sasl.log files, then the connection attempt *cannot* be getting through. If there *is* a connection being logged, then I need to know about it, even if there's nothing further in the logs about authentication failures or whatever.
> 
> Please confirm that you're not running any other AMQP brokers (e.g., OpenAMQ, etc) on any of your infrastructure, which the client might be erroneously connecting to. Please confirm that RabbitMQ is indeed running on the default port of 5672 - that seems to be the case, but I just want to make sure. 
> 
> Thanks,
> Tim
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/742798a5/attachment.htm>

From tim at rabbitmq.com  Thu May 16 12:14:03 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 12:14:03 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <5194B3C2.9040406@rabbitmq.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
	<CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
	<04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
	<2D70B565-B719-43D8-B917-B3C470D959FC@rabbitmq.com>
	<CALEC75LSg24JqkBt0BpKt1Ccqiw9H+5bLQtYeH=9-hwvzwjtMg@mail.gmail.com>
	<CALEC75JZropSQ_D5Nm16Njx4Jix6YKvLRsTfmJBqOOiYM0wTww@mail.gmail.com>
	<5194B3C2.9040406@rabbitmq.com>
Message-ID: <C0DAF8E3-03DE-4479-8CC6-F30D1AE90FB5@rabbitmq.com>

Urgh - this thread is getting very mixed up. 

Putting the list back on CC.

Right...

On 16 May 2013, at 11:42, Balachandar R.A. wrote:

> I did telnet to the host and port as below:-
>  
> telnet 40.221.94.235 5672
> Trying 40.221.94.235...
> Connected to 40.221.94.235.
> Escape character is '^]'.
> Connection closed by foreign host.


So the network connectivity between your virtual machines seems ok.

> I can do ping all nodes between each other.

The ability to send ICMP packets between machines doesn't confirm that all other kinds of communication will work, though it's useful to know. The fact that you can telnet to the broker means that you ought to be able to connect from a regular AMQP client.

> I did not create any configuration file for rabbit mq.
> The head node and compute node has only the client jars. (obtained from rabbitmq-java-client-bin-2.3.1)

Erm, where is the broker running exactly? On this HEAD node yes? Is *that* the machine with the IP address 40.221.94.235?

I note that in your producer code, you do not set the username or password, whereas in your consumer code you do. You should not need to set these explicitly, since "guest:guest" is the default.

Please consider running a network capture tool (such as wireshark) to confirm that AMQP frames are in fact being sent from the consumer's machine to the broker's machine correctly. If there is nothing in the rabbit.log or rabbit-sasl.log files, then the connection attempt *cannot* be getting through. If there *is* a connection being logged, then I need to know about it, even if there's nothing further in the logs about authentication failures or whatever.

Please confirm that you're not running any other AMQP brokers (e.g., OpenAMQ, etc) on any of your infrastructure, which the client might be erroneously connecting to. Please confirm that RabbitMQ is indeed running on the default port of 5672 - that seems to be the case, but I just want to make sure. 

Thanks,
Tim

On 16 May 2013, at 11:24, Tim Watson wrote:

> On 05/16/2013 11:05 AM, Balachandar R.A. wrote:
>> 
>> telnet ip-of-server 15672
> 
> That's the HTTP port, not the AMQP port. If you've not customised anything, then the broker will listen for AMQP connections on 5672. Can you telnet to *that* port?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/5d5b5b1e/attachment.htm>

From simon at rabbitmq.com  Thu May 16 12:21:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 12:21:36 +0100
Subject: [rabbitmq-discuss] Flow control issue when shovelling messages
 between data centres
In-Reply-To: <1368693845599-26742.post@n5.nabble.com>
References: <0cadcddc-2cc1-4fac-8eb4-a4bf97ba904f@googlegroups.com>
	<65418637-67a4-469a-b18d-f6ef00f6ac2b@googlegroups.com>
	<51939DAA.4020706@rabbitmq.com>
	<1368693845599-26742.post@n5.nabble.com>
Message-ID: <5194C140.4040600@rabbitmq.com>

On 16/05/13 09:44, SimonT wrote:
> Thanks Simon, much appreciated. In our case, as far as we can tell, these
> rabbit nodes have bags of available RAM when the flow control occurs - would
> you still expect paging to disc of messages in that case?

In an effort to try to smooth out performance and prevent you running 
into a wall when memory use gets high, Rabbit will start paging some 
stuff to disc at around ~5% memory use.

> Another thing to mention is that we are using a rather old version (RabbitMQ
> 2.8.2 on Erlang R14B04). Do you think this might be relevant?

Ah.

There was also a bug (fixed in 2.8.3) where queues that had lots of 
consumers and / or consumers with a small prefetch count could 
over-prioritise consuming, to the extent of refusing to accept publishes 
at all (and thus stick in flow control) until they emptied completely. 
Does that sound like what you are seeing?

It may be worth upgrading anyway of course.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From tim at rabbitmq.com  Thu May 16 12:27:50 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 12:27:50 +0100
Subject: [rabbitmq-discuss] Problem when running second consumer
In-Reply-To: <CALEC75KitMgk56a1UY=YjP8YBwDhpNNV6Hw2gYA1DJLcfPNXRQ@mail.gmail.com>
References: <CALEC75L-XHkqmLjCOV-HOyuRB9mpinBYyU6Nr4Aw38kEr=ESnA@mail.gmail.com>
	<07B691D8-33A0-400A-9886-C50CC3208FDD@rabbitmq.com>
	<CALEC75+OxM9Z=NJMWx2+=KDJ925g_LnzZMq_qRP7tg_6i8Zw9g@mail.gmail.com>
	<15850AC2-795C-4A3F-9A2A-B6ABAB394C04@rabbitmq.com>
	<CALEC75JXez6LEFzvZ0g8qJjsUX728MAar_XfyZ8TTJOM-rY9Qg@mail.gmail.com>
	<04380A68-D959-4675-92C0-050A04090850@rabbitmq.com>
	<2D70B565-B719-43D8-B917-B3C470D959FC@rabbitmq.com>
	<CALEC75LSg24JqkBt0BpKt1Ccqiw9H+5bLQtYeH=9-hwvzwjtMg@mail.gmail.com>
	<CALEC75JZropSQ_D5Nm16Njx4Jix6YKvLRsTfmJBqOOiYM0wTww@mail.gmail.com>
	<5194B3C2.9040406@rabbitmq.com>
	<CALEC75L7U3By1Lsd_Bt+8-yZkES=EV9Vbd7mm1eznvk3en8CoA@mail.gmail.com>
	<64E6F406-FA64-4228-B5C4-E47643BF6244@rabbitmq.com>
	<CALEC75KitMgk56a1UY=YjP8YBwDhpNNV6Hw2gYA1DJLcfPNXRQ@mail.gmail.com>
Message-ID: <4927B518-F35A-4501-ACC9-81EFD33F4A1E@rabbitmq.com>

Putting the list back on CC (again).

On 16 May 2013, at 12:24, Balachandar R.A. wrote:
> Yes, all these are correct. I shall try wireshark and see
> 
Thanks.

> On 16 May 2013 16:18, "Tim Watson" <tim at rabbitmq.com> wrote:
> Right. So, just to be clear then...
> 
> * you are running the broker on 40.221.94.235
> * you have not altered the permissions on this broker at all
> * you are running a client, attempting to connect to that broker, from some other host B
> * you can telnet from host B to 40.221.94.235 on port 5672
> * when your code (running on host B) calls ConnectionFactory#newConnection(), you get the com.rabbitmq.client.PossibleAuthenticationFailureException
> 
> Is that all correct? If so, please run a packet sniffer (such as wireshark) on both the broker and client host machines, to ensure that the network is transmitting information between the two hosts correctly. This is a very odd problem and not something that we've seen before.
> 
> Cheers,
> Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/da46ba54/attachment.htm>

From dpanchyrz at proximetry.pl  Thu May 16 12:28:57 2013
From: dpanchyrz at proximetry.pl (rabbit666)
Date: Thu, 16 May 2013 04:28:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <51939483.5020305@rabbitmq.com>
References: <CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
	<1368619663987-26710.post@n5.nabble.com>
	<1368620907646-26713.post@n5.nabble.com>
	<51938BF1.7070106@rabbitmq.com>
	<1368625779575-26720.post@n5.nabble.com>
	<51939483.5020305@rabbitmq.com>
Message-ID: <1368703737826-26757.post@n5.nabble.com>

Hi,

it seems that multicastmain and our test are different. as i suppose the mm
load broker exactly by 600000 messages. our test produce 600000 as a result
of differences beetwen producers and cosumers. 

our scenario assumes that for 32 queues 6*32 producers and 32 consumers.
producers produce more message that cosumers cosnsume.

Regars




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26757.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From natewang0425 at gmail.com  Thu May 16 12:36:42 2013
From: natewang0425 at gmail.com (Nate)
Date: Thu, 16 May 2013 04:36:42 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <519496BC.2070604@rabbitmq.com>
References: <1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
	<51933936.60008@rabbitmq.com>
	<CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>
	<519353D2.4020400@rabbitmq.com>
	<CAHqyxU0XU1K0imG-QwZiLS-_akkpnf7+0biN8sPR25WyyMx3sw@mail.gmail.com>
	<519496BC.2070604@rabbitmq.com>
Message-ID: <CAHqyxU0BpBCgj9GvCdruH-n9A6r3W9p7v=a92ZGic-XzdN3gpw@mail.gmail.com>

Dear Matthias,

       Yes, I ran it as root and nothing return to me.... However, when I
use SIGABRT the process will be deleted. My OS is centos 5.5.


Regards,
Nate


2013/5/16 Matthias Radestock-3 [via RabbitMQ] <
ml-node+s1065348n26741h36 at n5.nabble.com>

> On 16/05/13 07:36, Nate wrote:
> >      Bad news, I cannot get the dump file via command "kill -SIGUSR1
> > 8972" and process still exist.
>
> Weird. Did it return / complain about anything? You may have to run it
> as root. What O/S is this on?
>
> If we cannot get the process to react to SIGUSR1 then we are stuck.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=26741&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26741.html
>  To unsubscribe from Re: After weekly log rotatation was done, the command
> "rabbitmqctl rotate-logs" never stop, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=26607&code=bmF0ZXdhbmcwNDI1QGdtYWlsLmNvbXwyNjYwN3w0NTY2Njg2Njk=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26759.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/b4e0d6b0/attachment.htm>

From matthias at rabbitmq.com  Thu May 16 13:07:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 May 2013 13:07:57 +0100
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <CAHqyxU0BpBCgj9GvCdruH-n9A6r3W9p7v=a92ZGic-XzdN3gpw@mail.gmail.com>
References: <1368438128561-26609.post@n5.nabble.com>
	<519109A1.1080301@rabbitmq.com>
	<CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
	<51933936.60008@rabbitmq.com>
	<CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>
	<519353D2.4020400@rabbitmq.com>
	<CAHqyxU0XU1K0imG-QwZiLS-_akkpnf7+0biN8sPR25WyyMx3sw@mail.gmail.com>
	<519496BC.2070604@rabbitmq.com>
	<CAHqyxU0BpBCgj9GvCdruH-n9A6r3W9p7v=a92ZGic-XzdN3gpw@mail.gmail.com>
Message-ID: <5194CC1D.90201@rabbitmq.com>

Nate,

On 16/05/13 12:36, Nate wrote:
>         Yes, I ran it as root and nothing return to me.... However, when
> I use SIGABRT the process will be deleted. My OS is centos 5.5.

There must be something seriously wrong with that Erlang VM process if 
it is not reacting to SIGUSR1.

I suggest you "walk up the call stack" of the ps output you posted 
initially and manually run the log rotation commands, to check whether 
any of them get stuck, e.g.

/bin/sh /usr/sbin/rabbitmqctl rotate_logs
/bin/sh /etc/init.d/rabbitmq-server rotate-logs
/bin/sh /sbin/service rabbitmq-server rotate-logs
sh -c ? /sbin/service rabbitmq-server rotate-logs > /dev/null? ?
(hmm, what's with those question marks? are they placeholders for 
something?)
/usr/sbin/logrotate /etc/logrotate.conf
/bin/sh /etc/cron.daily/logrotate
/bin/bash /usr/bin/run-parts /etc/cron.daily

Matthias.

From emile at rabbitmq.com  Thu May 16 13:24:49 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 May 2013 13:24:49 +0100
Subject: [rabbitmq-discuss] .NET Client Connection.CreateModel Possible
 Deadlock / Not Thread Safe?
In-Reply-To: <d396c1b3-a161-44f3-b806-8f25140b62e7@googlegroups.com>
References: <d396c1b3-a161-44f3-b806-8f25140b62e7@googlegroups.com>
Message-ID: <5194D011.1080207@rabbitmq.com>


Hi Chris,

On 14/05/13 17:56, Chris Haines wrote:
> I have attached an NUnit test file which recreates this problem. The
> test case that uses locking will pass and the test without locking will
> indefinitely hang after it tries to create a channel on line 62 (at
> which point all of the threads are now hanging requesting a model).
> 
> Has anyone seen any problems like this before?
Thanks for supplying the test, I agree that it looks like a bug. I
suggest that you continue to wrap channel creation in a lock while we
work on a fix.




-Emile






From subramanian-v at hcl.com  Thu May 16 13:26:19 2013
From: subramanian-v at hcl.com (Subramanian Vaidhyanathan -ERS, HCL Tech)
Date: Thu, 16 May 2013 12:26:19 +0000
Subject: [rabbitmq-discuss] Rabbit MQ - Cant Start
Message-ID: <E6E06B50E2DEE842AD8DAB64E977F18B0693F16D@chn-hclt-mbs05.HCLT.CORP.HCL.IN>

Dear Team,
 I have installed Rabbit MQ for the first time in RHEL and created rabbitmq.config and rabbitmq-env file. When i started the server, following is the error.
Kindly help

Rabbitmq.config Snapshot

[{auth_backends,[rabbit_auth_backend_internal]},  
 {auth_mechanisms,['PLAIN','AMQPLAIN']},  
 {backing_queue_module,rabbit_variable_queue},  
 {cluster_nodes,[]},  
 {collect_statistics,fine},  
 {collect_statistics_interval,5000},  
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},  
 {default_user,<<"guest">>},  
 {default_user_tags,[administrator]},  
 {default_vhost,<<"/">>},  
 {delegate_count,16},  
 {frame_max,131072},  
 {hipe_compile,false},  
 {included_applications,[]},  
 {msg_store_file_size_limit,16777216},  
 {msg_store_index_module,rabbit_msg_store_ets_index},  
 {queue_index_max_journal_entries,262144},  
 {server_properties,[]},  
 {ssl_listeners,[]},  
 {ssl_options,[]},  
 {tcp_listen_options,    
	[binary,      
		{packet,raw},      
		{reuseaddr,true},      
		{backlog,128},      
		{nodelay,true},      
		{exit_on_close,false}]},  
 {tcp_listeners,[5672]},  
 {trace_vhosts,[<<"/">>]},  
 {vm_memory_high_watermark,0.4},
 {disk_free_limit,1000000000},
 {mnesia, [{dump_log_write_threshold, 1000}]}
] 

*************************************************************************
Server Start Error Message

[root at hclzenoss ~]# rabbitmq-server start   BOOT FAILED ===========  Error description:    {aborted,{aborted,{application_load_error,{bad_environment_value,"None"}}}}  Log files (may contain more information):    /usr/local/rabbitmq/var/log/rabbitmq/rabbit at localhost.log    /usr/local/rabbitmq/var/log/rabbitmq/rabbit at localhost-sasl.log  Stack trace:    [{mnesia,abort,1},     {rabbit_mnesia,ensure_mnesia_dir,0},     {rabbit_node_monitor,prepare_cluster_status_files,0},     {rabbit,'-boot/0-fun-1-',0},     {rabbit,start_it,1},     {init,start_it,1},     {init,start_em,1}]  {"init terminating in do_boot",{rabbit,failure_during_boot,{aborted,{aborted,{application_load_error,{bad_environment_value,"None"}}}}}}  Crash dump was written to: erl_crash.dump init terminating in do_boot ()

rabbitmqctl status _ output
Status of node rabbit at localhost ...
Error: unable to connect to node rabbit at localhost: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at localhost]

hosts, their running nodes and ports:
- localhost: [{rabbitmqctl13081,58278}]

current node details:
- node name: rabbitmqctl13081 at localhost
- home dir: /var/lib/rabbitmq
- cookie hash: uWTaxtEzHYG2pVzMhK41vw==

You have new mail in /var/spool/mail/root



Best Regards,
Subbu


::DISCLAIMER::
----------------------------------------------------------------------------------------------------------------------------------------------------

The contents of this e-mail and any attachment(s) are confidential and intended for the named recipient(s) only.
E-mail transmission is not guaranteed to be secure or error-free as information could be intercepted, corrupted,
lost, destroyed, arrive late or incomplete, or may contain viruses in transmission. The e mail and its contents
(with or without referred errors) shall therefore not attach any liability on the originator or HCL or its affiliates.
Views or opinions, if any, presented in this email are solely those of the author and may not necessarily reflect the
views or opinions of HCL or its affiliates. Any form of reproduction, dissemination, copying, disclosure, modification,
distribution and / or publication of this message without the prior written consent of authorized representative of
HCL is strictly prohibited. If you have received this email in error please delete it and notify the sender immediately.
Before opening any email and/or attachments, please check them for viruses and other defects.

----------------------------------------------------------------------------------------------------------------------------------------------------


From simon at rabbitmq.com  Thu May 16 13:34:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 13:34:49 +0100
Subject: [rabbitmq-discuss] Rabbit MQ - Cant Start
In-Reply-To: <E6E06B50E2DEE842AD8DAB64E977F18B0693F16D@chn-hclt-mbs05.HCLT.CORP.HCL.IN>
References: <E6E06B50E2DEE842AD8DAB64E977F18B0693F16D@chn-hclt-mbs05.HCLT.CORP.HCL.IN>
Message-ID: <5194D269.5020108@rabbitmq.com>

On 16/05/13 13:26, Subramanian Vaidhyanathan -ERS, HCL Tech wrote:
> Dear Team,
>   I have installed Rabbit MQ for the first time in RHEL and created rabbitmq.config and rabbitmq-env file. When i started the server, following is the error.
> Kindly help

That file contains several errors, of which the most notable is that all 
of the RabbitMQ config should be within a {rabbit, Env} tuple, e.g.:

[{rabbit, [{auth_backends,[rabbit_auth_backend_internal]}, ... etc

But almost all of those are defaults anyway. What are you trying to do?

Cheers, Simon

> Rabbitmq.config Snapshot
>
> [{auth_backends,[rabbit_auth_backend_internal]},
>   {auth_mechanisms,['PLAIN','AMQPLAIN']},
>   {backing_queue_module,rabbit_variable_queue},
>   {cluster_nodes,[]},
>   {collect_statistics,fine},
>   {collect_statistics_interval,5000},
>   {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>   {default_user,<<"guest">>},
>   {default_user_tags,[administrator]},
>   {default_vhost,<<"/">>},
>   {delegate_count,16},
>   {frame_max,131072},
>   {hipe_compile,false},
>   {included_applications,[]},
>   {msg_store_file_size_limit,16777216},
>   {msg_store_index_module,rabbit_msg_store_ets_index},
>   {queue_index_max_journal_entries,262144},
>   {server_properties,[]},
>   {ssl_listeners,[]},
>   {ssl_options,[]},
>   {tcp_listen_options,
> 	[binary,
> 		{packet,raw},
> 		{reuseaddr,true},
> 		{backlog,128},
> 		{nodelay,true},
> 		{exit_on_close,false}]},
>   {tcp_listeners,[5672]},
>   {trace_vhosts,[<<"/">>]},
>   {vm_memory_high_watermark,0.4},
>   {disk_free_limit,1000000000},
>   {mnesia, [{dump_log_write_threshold, 1000}]}
> ]
>
> *************************************************************************
> Server Start Error Message
>
> [root at hclzenoss ~]# rabbitmq-server start   BOOT FAILED ===========  Error description:    {aborted,{aborted,{application_load_error,{bad_environment_value,"None"}}}}  Log files (may contain more information):    /usr/local/rabbitmq/var/log/rabbitmq/rabbit at localhost.log    /usr/local/rabbitmq/var/log/rabbitmq/rabbit at localhost-sasl.log  Stack trace:    [{mnesia,abort,1},     {rabbit_mnesia,ensure_mnesia_dir,0},     {rabbit_node_monitor,prepare_cluster_status_files,0},     {rabbit,'-boot/0-fun-1-',0},     {rabbit,start_it,1},     {init,start_it,1},     {init,start_em,1}]  {"init terminating in do_boot",{rabbit,failure_during_boot,{aborted,{aborted,{application_load_error,{bad_environment_value,"None"}}}}}}  Crash dump was written to: erl_crash.dump init terminating in do_boot ()
>
> rabbitmqctl status _ output
> Status of node rabbit at localhost ...
> Error: unable to connect to node rabbit at localhost: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at localhost]
>
> hosts, their running nodes and ports:
> - localhost: [{rabbitmqctl13081,58278}]
>
> current node details:
> - node name: rabbitmqctl13081 at localhost
> - home dir: /var/lib/rabbitmq
> - cookie hash: uWTaxtEzHYG2pVzMhK41vw==
>
> You have new mail in /var/spool/mail/root
>
>
>
> Best Regards,
> Subbu
>
>
> ::DISCLAIMER::
> ----------------------------------------------------------------------------------------------------------------------------------------------------
>
> The contents of this e-mail and any attachment(s) are confidential and intended for the named recipient(s) only.
> E-mail transmission is not guaranteed to be secure or error-free as information could be intercepted, corrupted,
> lost, destroyed, arrive late or incomplete, or may contain viruses in transmission. The e mail and its contents
> (with or without referred errors) shall therefore not attach any liability on the originator or HCL or its affiliates.
> Views or opinions, if any, presented in this email are solely those of the author and may not necessarily reflect the
> views or opinions of HCL or its affiliates. Any form of reproduction, dissemination, copying, disclosure, modification,
> distribution and / or publication of this message without the prior written consent of authorized representative of
> HCL is strictly prohibited. If you have received this email in error please delete it and notify the sender immediately.
> Before opening any email and/or attachments, please check them for viruses and other defects.
>
> ----------------------------------------------------------------------------------------------------------------------------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May 16 13:45:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 13:45:40 +0100
Subject: [rabbitmq-discuss] Balancing Queues across nodes in a cluster
In-Reply-To: <0B8CD6850421B745BE39BC5C7601923271F66318@DDCEP50015.na.corp.mckesson.com>
References: <0B8CD6850421B745BE39BC5C7601923271F66318@DDCEP50015.na.corp.mckesson.com>
Message-ID: <5194D4F4.7060608@rabbitmq.com>

On 15/05/13 20:02, Cordell, Ron L wrote:
> We are using RabbitMQ 3.0.1 in a cluster behind an F5 load balancer.

<snip>

> My question is around balancing node resources. If a queue becomes
> somewhat busy, can I move make a different node master for that queue
> (assuming a mirrored queue)? I don?t want to take down the node as I
> have other queues on that node; I just want to move the master for a
> particular queue, if possible.

Not with 3.0.x. This was fixed in 3.1.x.

If you want to control exactly which nodes a queue is on, you need the 
"nodes" policy.

With 3.0.x if you set a "nodes" policy such that a queue should change 
masters, it won't. Any old slaves will go down, and new slaves will come 
up, but the master won't change. This is to avoid losing messages if the 
new master wasn't synchronised (or even a slave) before the change.

With 3.1.x we are a bit smarter. Now if you set a "nodes" policy such 
that the master should change, it will do so immediately if one of the 
new mirrors was previously a synchronised slave. If not, the old master 
will stick around until one of the new mirrors becomes synchronised, 
then it will vanish.

See '"nodes" policy and migrating masters' under 
http://www.rabbitmq.com/ha.html#genesis

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From subramanian-v at hcl.com  Thu May 16 13:48:06 2013
From: subramanian-v at hcl.com (Subramanian Vaidhyanathan -ERS, HCL Tech)
Date: Thu, 16 May 2013 12:48:06 +0000
Subject: [rabbitmq-discuss] Rabbit MQ - Cant Start
In-Reply-To: <5194D269.5020108@rabbitmq.com>
References: <E6E06B50E2DEE842AD8DAB64E977F18B0693F16D@chn-hclt-mbs05.HCLT.CORP.HCL.IN>,
	<5194D269.5020108@rabbitmq.com>
Message-ID: <E6E06B50E2DEE842AD8DAB64E977F18B069431C4@chn-hclt-mbs05.HCLT.CORP.HCL.IN>

Hi Simon,
  Thanks a lot for your quick update. I just need to start rabbitmq server since one of the application that we are going to test use Rabbit MQ. Since i am new to RabbitMQ, i took this config file from an example and updated.
All i need to do is start the rabbitMQ server for now with minimal option and i have updated the config file as below, but still getting the crash.

[
{mnesia, [{dump_log_write_threshold, 1000}]},
{rabbit, [{vm_memory_high_watermark, 2.0}]}
]
.

Best Regards,
Subbu
________________________________________
From: Simon MacMullen [simon at rabbitmq.com]
Sent: Thursday, May 16, 2013 6:04 PM
To: Discussions about RabbitMQ
Cc: Subramanian Vaidhyanathan -ERS, HCL Tech
Subject: Re: [rabbitmq-discuss] Rabbit MQ - Cant Start

On 16/05/13 13:26, Subramanian Vaidhyanathan -ERS, HCL Tech wrote:
> Dear Team,
>   I have installed Rabbit MQ for the first time in RHEL and created rabbitmq.config and rabbitmq-env file. When i started the server, following is the error.
> Kindly help

That file contains several errors, of which the most notable is that all
of the RabbitMQ config should be within a {rabbit, Env} tuple, e.g.:

[{rabbit, [{auth_backends,[rabbit_auth_backend_internal]}, ... etc

But almost all of those are defaults anyway. What are you trying to do?

Cheers, Simon

> Rabbitmq.config Snapshot
>
> [{auth_backends,[rabbit_auth_backend_internal]},
>   {auth_mechanisms,['PLAIN','AMQPLAIN']},
>   {backing_queue_module,rabbit_variable_queue},
>   {cluster_nodes,[]},
>   {collect_statistics,fine},
>   {collect_statistics_interval,5000},
>   {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>   {default_user,<<"guest">>},
>   {default_user_tags,[administrator]},
>   {default_vhost,<<"/">>},
>   {delegate_count,16},
>   {frame_max,131072},
>   {hipe_compile,false},
>   {included_applications,[]},
>   {msg_store_file_size_limit,16777216},
>   {msg_store_index_module,rabbit_msg_store_ets_index},
>   {queue_index_max_journal_entries,262144},
>   {server_properties,[]},
>   {ssl_listeners,[]},
>   {ssl_options,[]},
>   {tcp_listen_options,
>       [binary,
>               {packet,raw},
>               {reuseaddr,true},
>               {backlog,128},
>               {nodelay,true},
>               {exit_on_close,false}]},
>   {tcp_listeners,[5672]},
>   {trace_vhosts,[<<"/">>]},
>   {vm_memory_high_watermark,0.4},
>   {disk_free_limit,1000000000},
>   {mnesia, [{dump_log_write_threshold, 1000}]}
> ]
>
> *************************************************************************
> Server Start Error Message
>
> [root at hclzenoss ~]# rabbitmq-server start   BOOT FAILED ===========  Error description:    {aborted,{aborted,{application_load_error,{bad_environment_value,"None"}}}}  Log files (may contain more information):    /usr/local/rabbitmq/var/log/rabbitmq/rabbit at localhost.log    /usr/local/rabbitmq/var/log/rabbitmq/rabbit at localhost-sasl.log  Stack trace:    [{mnesia,abort,1},     {rabbit_mnesia,ensure_mnesia_dir,0},     {rabbit_node_monitor,prepare_cluster_status_files,0},     {rabbit,'-boot/0-fun-1-',0},     {rabbit,start_it,1},     {init,start_it,1},     {init,start_em,1}]  {"init terminating in do_boot",{rabbit,failure_during_boot,{aborted,{aborted,{application_load_error,{bad_environment_value,"None"}}}}}}  Crash dump was written to: erl_crash.dump init terminating in do_boot ()
>
> rabbitmqctl status _ output
> Status of node rabbit at localhost ...
> Error: unable to connect to node rabbit at localhost: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at localhost]
>
> hosts, their running nodes and ports:
> - localhost: [{rabbitmqctl13081,58278}]
>
> current node details:
> - node name: rabbitmqctl13081 at localhost
> - home dir: /var/lib/rabbitmq
> - cookie hash: uWTaxtEzHYG2pVzMhK41vw==
>
> You have new mail in /var/spool/mail/root
>
>
>
> Best Regards,
> Subbu
>
>
> ::DISCLAIMER::
> ----------------------------------------------------------------------------------------------------------------------------------------------------
>
> The contents of this e-mail and any attachment(s) are confidential and intended for the named recipient(s) only.
> E-mail transmission is not guaranteed to be secure or error-free as information could be intercepted, corrupted,
> lost, destroyed, arrive late or incomplete, or may contain viruses in transmission. The e mail and its contents
> (with or without referred errors) shall therefore not attach any liability on the originator or HCL or its affiliates.
> Views or opinions, if any, presented in this email are solely those of the author and may not necessarily reflect the
> views or opinions of HCL or its affiliates. Any form of reproduction, dissemination, copying, disclosure, modification,
> distribution and / or publication of this message without the prior written consent of authorized representative of
> HCL is strictly prohibited. If you have received this email in error please delete it and notify the sender immediately.
> Before opening any email and/or attachments, please check them for viruses and other defects.
>
> ----------------------------------------------------------------------------------------------------------------------------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May 16 13:52:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 13:52:10 +0100
Subject: [rabbitmq-discuss] Balancing Queues across nodes in a cluster
In-Reply-To: <5194D4F4.7060608@rabbitmq.com>
References: <0B8CD6850421B745BE39BC5C7601923271F66318@DDCEP50015.na.corp.mckesson.com>
	<5194D4F4.7060608@rabbitmq.com>
Message-ID: <5194D67A.8070009@rabbitmq.com>

On 16/05/13 13:45, Simon MacMullen wrote:
> If you want to control exactly which nodes a queue is on, you need the
> "nodes" policy.

Oh, and I should add: there's currently no way to explicitly say which 
node you want the master to be, it will just be chosen from the nodes 
you provide. In practice this is not too relevant, since the master and 
slaves do almost exactly the same amount of work for a given queue; it's 
much more important to spread mirrors (i.e. masters + slaves) about than 
just masters.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May 16 13:59:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 13:59:39 +0100
Subject: [rabbitmq-discuss] HTTP API Callback
In-Reply-To: <e436f921-9cf5-42cd-9e4d-a501fe880e87@googlegroups.com>
References: <e436f921-9cf5-42cd-9e4d-a501fe880e87@googlegroups.com>
Message-ID: <5194D83B.2060805@rabbitmq.com>

On 15/05/13 15:38, aviusexperience at gmail.com wrote:
> Just wondering if there is a way RabbitMQ can send messages to a rest
> based API, for example I have an application that publishes a message to
> RabbitMQ when a certain action is performed, would RabbitMQ then be able
> to automatically send that message to another endpoint e.g.
> http://localhost/api/receive?

I think the only thing that does this is 
https://github.com/tonyg/rabbithub - but that is rather unofficial.

We might add an official plugin in future, depending on demand etc.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May 16 14:06:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 14:06:00 +0100
Subject: [rabbitmq-discuss] Rabbit MQ - Cant Start
In-Reply-To: <E6E06B50E2DEE842AD8DAB64E977F18B069431C4@chn-hclt-mbs05.HCLT.CORP.HCL.IN>
References: <E6E06B50E2DEE842AD8DAB64E977F18B0693F16D@chn-hclt-mbs05.HCLT.CORP.HCL.IN>,
	<5194D269.5020108@rabbitmq.com>
	<E6E06B50E2DEE842AD8DAB64E977F18B069431C4@chn-hclt-mbs05.HCLT.CORP.HCL.IN>
Message-ID: <5194D9B8.2050707@rabbitmq.com>

I note that you error message contains:

   {bad_environment_value,"None"}

but your configuration file as posted does not contain the word "None". 
So are you sure you are editing the right file? Have you set that 
somehow in your rabbitmq-env file?

If you have installed the RPM, then RabbitMQ should start up happily 
without you needing to provide any configuration. You might want to 
start by doing that and then only make the configuration changes you 
actually need.

Cheers, Simon

On 16/05/13 13:48, Subramanian Vaidhyanathan -ERS, HCL Tech wrote:
> Hi Simon,
>    Thanks a lot for your quick update. I just need to start rabbitmq server since one of the application that we are going to test use Rabbit MQ. Since i am new to RabbitMQ, i took this config file from an example and updated.
> All i need to do is start the rabbitMQ server for now with minimal option and i have updated the config file as below, but still getting the crash.
>
> [
> {mnesia, [{dump_log_write_threshold, 1000}]},
> {rabbit, [{vm_memory_high_watermark, 2.0}]}
> ]
> .
>
> Best Regards,
> Subbu
> ________________________________________
> From: Simon MacMullen [simon at rabbitmq.com]
> Sent: Thursday, May 16, 2013 6:04 PM
> To: Discussions about RabbitMQ
> Cc: Subramanian Vaidhyanathan -ERS, HCL Tech
> Subject: Re: [rabbitmq-discuss] Rabbit MQ - Cant Start
>
> On 16/05/13 13:26, Subramanian Vaidhyanathan -ERS, HCL Tech wrote:
>> Dear Team,
>>    I have installed Rabbit MQ for the first time in RHEL and created rabbitmq.config and rabbitmq-env file. When i started the server, following is the error.
>> Kindly help
>
> That file contains several errors, of which the most notable is that all
> of the RabbitMQ config should be within a {rabbit, Env} tuple, e.g.:
>
> [{rabbit, [{auth_backends,[rabbit_auth_backend_internal]}, ... etc
>
> But almost all of those are defaults anyway. What are you trying to do?
>
> Cheers, Simon
>
>> Rabbitmq.config Snapshot
>>
>> [{auth_backends,[rabbit_auth_backend_internal]},
>>    {auth_mechanisms,['PLAIN','AMQPLAIN']},
>>    {backing_queue_module,rabbit_variable_queue},
>>    {cluster_nodes,[]},
>>    {collect_statistics,fine},
>>    {collect_statistics_interval,5000},
>>    {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>>    {default_user,<<"guest">>},
>>    {default_user_tags,[administrator]},
>>    {default_vhost,<<"/">>},
>>    {delegate_count,16},
>>    {frame_max,131072},
>>    {hipe_compile,false},
>>    {included_applications,[]},
>>    {msg_store_file_size_limit,16777216},
>>    {msg_store_index_module,rabbit_msg_store_ets_index},
>>    {queue_index_max_journal_entries,262144},
>>    {server_properties,[]},
>>    {ssl_listeners,[]},
>>    {ssl_options,[]},
>>    {tcp_listen_options,
>>        [binary,
>>                {packet,raw},
>>                {reuseaddr,true},
>>                {backlog,128},
>>                {nodelay,true},
>>                {exit_on_close,false}]},
>>    {tcp_listeners,[5672]},
>>    {trace_vhosts,[<<"/">>]},
>>    {vm_memory_high_watermark,0.4},
>>    {disk_free_limit,1000000000},
>>    {mnesia, [{dump_log_write_threshold, 1000}]}
>> ]
>>
>> *************************************************************************
>> Server Start Error Message
>>
>> [root at hclzenoss ~]# rabbitmq-server start   BOOT FAILED ===========  Error description:    {aborted,{aborted,{application_load_error,{bad_environment_value,"None"}}}}  Log files (may contain more information):    /usr/local/rabbitmq/var/log/rabbitmq/rabbit at localhost.log    /usr/local/rabbitmq/var/log/rabbitmq/rabbit at localhost-sasl.log  Stack trace:    [{mnesia,abort,1},     {rabbit_mnesia,ensure_mnesia_dir,0},     {rabbit_node_monitor,prepare_cluster_status_files,0},     {rabbit,'-boot/0-fun-1-',0},     {rabbit,start_it,1},     {init,start_it,1},     {init,start_em,1}]  {"init terminating in do_boot",{rabbit,failure_during_boot,{aborted,{aborted,{application_load_error,{bad_environment_value,"None"}}}}}}  Crash dump was written to: erl_crash.dump init terminating in do_boot ()
>>
>> rabbitmqctl status _ output
>> Status of node rabbit at localhost ...
>> Error: unable to connect to node rabbit at localhost: nodedown
>>
>> DIAGNOSTICS
>> ===========
>>
>> nodes in question: [rabbit at localhost]
>>
>> hosts, their running nodes and ports:
>> - localhost: [{rabbitmqctl13081,58278}]
>>
>> current node details:
>> - node name: rabbitmqctl13081 at localhost
>> - home dir: /var/lib/rabbitmq
>> - cookie hash: uWTaxtEzHYG2pVzMhK41vw==
>>
>> You have new mail in /var/spool/mail/root
>>
>>
>>
>> Best Regards,
>> Subbu
>>
>>
>> ::DISCLAIMER::
>> ----------------------------------------------------------------------------------------------------------------------------------------------------
>>
>> The contents of this e-mail and any attachment(s) are confidential and intended for the named recipient(s) only.
>> E-mail transmission is not guaranteed to be secure or error-free as information could be intercepted, corrupted,
>> lost, destroyed, arrive late or incomplete, or may contain viruses in transmission. The e mail and its contents
>> (with or without referred errors) shall therefore not attach any liability on the originator or HCL or its affiliates.
>> Views or opinions, if any, presented in this email are solely those of the author and may not necessarily reflect the
>> views or opinions of HCL or its affiliates. Any form of reproduction, dissemination, copying, disclosure, modification,
>> distribution and / or publication of this message without the prior written consent of authorized representative of
>> HCL is strictly prohibited. If you have received this email in error please delete it and notify the sender immediately.
>> Before opening any email and/or attachments, please check them for viruses and other defects.
>>
>> ----------------------------------------------------------------------------------------------------------------------------------------------------
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From dev440 at gmail.com  Thu May 16 14:54:35 2013
From: dev440 at gmail.com (chetan dev)
Date: Thu, 16 May 2013 19:24:35 +0530
Subject: [rabbitmq-discuss] Queue Memory keep on increasing
In-Reply-To: <5190B7FE.80005@rabbitmq.com>
References: <CAB0ZxM78ga8xEc9f8Qp8DfE5y_H4dh4n441xTMKi5QTA=GEXvQ@mail.gmail.com>
	<5190B7FE.80005@rabbitmq.com>
Message-ID: <CAB0ZxM4jbpXkeS+_c7c-H4BPtGiu-J62CLhYG4qkbLX0zy0ouw@mail.gmail.com>

Hi,

Now this memory has reached to 6.4 mb.
can you please tell me what does this memory signify exactly and the
possible cause of this problem .


Thanks


On Mon, May 13, 2013 at 3:23 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/05/2013 08:46, chetan dev wrote:
>
>> I have a durable mirrored queue on two nodes .
>> initially when publishing and consumer activity started queue memory was
>> around 50 kB, now it is increasing day by day .currently it is around 3.9
>> MB
>>
>
> A slow moving process will only get garbage collected occasionally; to be
> honest I would consider ~3MB to be within the levels of GC noise here.
>
> You could try something like:
>
> rabbitmqctl eval '[{pid, Pid}] = rabbit_amqqueue:with(rabbit_**misc:r(<<"/">>,
> queue, <<"test">>), fun(Q) -> rabbit_amqqueue:info(Q, [pid]) end),
> garbage_collect(Pid).'
>
> to forcibly garbage-collect the queue and see if that cuts memory use.
>
> But I would only worry if the memory use kept growing quite a long way
> past 3MB.
>
> Cheers, Simon
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/3ff93636/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Thu May 16 15:16:38 2013
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 16 May 2013 10:16:38 -0400
Subject: [rabbitmq-discuss] Global variable
In-Reply-To: <2AE27398-C71D-4751-8B7B-7A672671BBFD@rabbitmq.com>
References: <CALEC75L1r1yVm_HtRTRX9uC2erOhpMW0a5c_er=8J7imsFsSvg@mail.gmail.com>
	<2AE27398-C71D-4751-8B7B-7A672671BBFD@rabbitmq.com>
Message-ID: <CAM8fPiQQXmNZzwHGBUPc5ELp=7ZnZqgV7jY2uTe-tMnhZQzSDA@mail.gmail.com>

On 16 May 2013 03:03, Tim Watson <watson.timothy at gmail.com> wrote:

> On 16 May 2013, at 07:33, "Balachandar R.A." <balachandar.ra at gmail.com>
> wrote:
>
> Can we have a global variable in rabbitMQ server which all the consumers
> can access?
>
> No and I'm now aware of any messaging products that do either.
>

This is essentially what Redis does.

Cheers,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/287be5e3/attachment.htm>

From tim at rabbitmq.com  Thu May 16 15:13:42 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 15:13:42 +0100
Subject: [rabbitmq-discuss] Global variable
In-Reply-To: <CAM8fPiQQXmNZzwHGBUPc5ELp=7ZnZqgV7jY2uTe-tMnhZQzSDA@mail.gmail.com>
References: <CALEC75L1r1yVm_HtRTRX9uC2erOhpMW0a5c_er=8J7imsFsSvg@mail.gmail.com>
	<2AE27398-C71D-4751-8B7B-7A672671BBFD@rabbitmq.com>
	<CAM8fPiQQXmNZzwHGBUPc5ELp=7ZnZqgV7jY2uTe-tMnhZQzSDA@mail.gmail.com>
Message-ID: <5194E996.5010700@rabbitmq.com>

On 05/16/2013 03:16 PM, Tony Garnock-Jones wrote:
> On 16 May 2013 03:03, Tim Watson <watson.timothy at gmail.com 
> <mailto:watson.timothy at gmail.com>> wrote:
>
>     On 16 May 2013, at 07:33, "Balachandar R.A."
>     <balachandar.ra at gmail.com <mailto:balachandar.ra at gmail.com>> wrote:
>>
>>     Can we have a global variable in rabbitMQ server which all the
>>     consumers can access?
>>
>     No and I'm now aware of any messaging products that do either.
>
>
> This is essentially what Redis does.
>

Ah yes, of course. I tend not to remember redis, since I've not really 
used it before, but of course it's incredibly popular. I really should 
get around to having a play with it.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/68e39afb/attachment.htm>

From billythethird at gmail.com  Thu May 16 15:38:50 2013
From: billythethird at gmail.com (Billy Hand)
Date: Thu, 16 May 2013 09:38:50 -0500
Subject: [rabbitmq-discuss] getting duplicated delivery
In-Reply-To: <C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>
References: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>
	<C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>
Message-ID: <CAAef2CLMTwnmROuAjB-27FyrUHQeCzEHMxmLarcxnpRXZ2avQw@mail.gmail.com>

I'm using a short program I wrote that generates exactly one message.  I've
made sure of that by stopping the consumers and observing only one message
getting put in the queue.  I also log every message consumed and everyone
that is duplicated is identical (including the correlation ids).

If its meaningful at all I'm running RabbitMQ from the RPM on the main site
(3.1.0).


On Thu, May 16, 2013 at 2:08 AM, Tim Watson <watson.timothy at gmail.com>wrote:

> On 16 May 2013, at 01:17, Billy Hand <billythethird at gmail.com> wrote:
>
> > When I put it on my live server (16 cores, mostly idle, fast) a single
> message gets consumed simultaneously by all the workers (duplicated).
>
> Are you sure about that? It's not just the same payload being sent
> repeatedly? What does your consumer code look like and how have you
> determined that this is taking place? Once a message is acked and
> delivered, a queue will not send it (i.e., the same message) to any further
> consumers. Are you checking the correlation-id to confirm the uniqueness of
> the message?
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/f0a91945/attachment.htm>

From billythethird at gmail.com  Thu May 16 15:44:36 2013
From: billythethird at gmail.com (Billy Hand)
Date: Thu, 16 May 2013 09:44:36 -0500
Subject: [rabbitmq-discuss] getting duplicated delivery
In-Reply-To: <5194AC8B.2010801@rabbitmq.com>
References: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>
	<C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>
	<5194AC8B.2010801@rabbitmq.com>
Message-ID: <CAAef2CKzetVBxy-xvdjj6bm_ZBtz-iJfcgG2Rk=fN6fJGyYEoQ@mail.gmail.com>

I will do some more testing today based on your's and and Tim's suggestions.

For the record, the connection/channel never closes.  After processing one
message from the queue the consumers go back and look for more.  Once they
are idle again I can get all 30 consumers to respond to one message.

There is no delay in redelivery either.  The consumers all seem to get the
message at the exact same time.

Thanks for your quick responses.  I'll reply back when I have investigated
more.


On Thu, May 16, 2013 at 4:53 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/05/13 08:08, Tim Watson wrote:
>
>> Once a message is acked and
>> delivered, a queue will not send it (i.e., the same message) to any
>> further consumers.
>>
>
> This is the key point. It will also not redeliver it if the consumer just
> acks slowly.
>
> But the fact that turning off acks solves the problem suggests that the
> messages *are* getting redelivered - so the OP should check the consumer
> code and make sure that messages are being acked before the connection or
> channel is closed.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/09af69c4/attachment.htm>

From michael.s.klishin at gmail.com  Thu May 16 15:48:33 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 16 May 2013 18:48:33 +0400
Subject: [rabbitmq-discuss] getting duplicated delivery
In-Reply-To: <CAAef2CLMTwnmROuAjB-27FyrUHQeCzEHMxmLarcxnpRXZ2avQw@mail.gmail.com>
References: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>
	<C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>
	<CAAef2CLMTwnmROuAjB-27FyrUHQeCzEHMxmLarcxnpRXZ2avQw@mail.gmail.com>
Message-ID: <CAE3HoVQM=MhiNUpmmM3OnJ-Tgt=k6Lhkmob+V4451TtDLJ+75w@mail.gmail.com>

2013/5/16 Billy Hand <billythethird at gmail.com>

> I'm using a short program I wrote that generates exactly one message.


Can you post the code (of both the producer and consumers)?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/8e80b95b/attachment.htm>

From Ron.Cordell at RelayHealth.com  Thu May 16 17:14:12 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron L)
Date: Thu, 16 May 2013 16:14:12 +0000
Subject: [rabbitmq-discuss] Balancing Queues across nodes in a cluster
In-Reply-To: <5194D67A.8070009@rabbitmq.com>
References: <0B8CD6850421B745BE39BC5C7601923271F66318@DDCEP50015.na.corp.mckesson.com>
	<5194D4F4.7060608@rabbitmq.com> <5194D67A.8070009@rabbitmq.com>
Message-ID: <0B8CD6850421B745BE39BC5C7601923271F66CB8@DDCEP50015.na.corp.mckesson.com>

Thanks, Simon. I will dig into this feature on 3.1.

Cheers,

-ronc

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Thursday, May 16, 2013 5:52 AM
To: Discussions about RabbitMQ
Cc: Cordell, Ron L
Subject: Re: [rabbitmq-discuss] Balancing Queues across nodes in a cluster

On 16/05/13 13:45, Simon MacMullen wrote:
> If you want to control exactly which nodes a queue is on, you need the 
> "nodes" policy.

Oh, and I should add: there's currently no way to explicitly say which node you want the master to be, it will just be chosen from the nodes you provide. In practice this is not too relevant, since the master and slaves do almost exactly the same amount of work for a given queue; it's much more important to spread mirrors (i.e. masters + slaves) about than just masters.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

From krupal_patel1990 at yahoo.co.in  Thu May 16 12:55:32 2013
From: krupal_patel1990 at yahoo.co.in (krupal patel)
Date: Thu, 16 May 2013 19:55:32 +0800 (SGT)
Subject: [rabbitmq-discuss] Version.
Message-ID: <1368705332.46134.YahooMailNeo@web190203.mail.sg3.yahoo.com>

HI everyone,
How can i get the RabbitMQ version if the rabbitmq server is stopped . I used rabbitmqctl status but it works only when we start the server but if i didn't started the server then how can i get the version.Let me know if there are any files in which i can get the rabbitmq version.

?
Regards,
Krupal Patel,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/c51f7970/attachment.htm>

From simon at rabbitmq.com  Thu May 16 17:51:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 May 2013 17:51:06 +0100
Subject: [rabbitmq-discuss] Version.
In-Reply-To: <1368705332.46134.YahooMailNeo@web190203.mail.sg3.yahoo.com>
References: <1368705332.46134.YahooMailNeo@web190203.mail.sg3.yahoo.com>
Message-ID: <51950E7A.8020107@rabbitmq.com>

On 16/05/13 12:55, krupal patel wrote:
> HI everyone,
> How can i get the RabbitMQ version if the rabbitmq server is stopped . I
> used rabbitmqctl status but it works only when we start the server but
> if i didn't started the server then how can i get the version.Let me
> know if there are any files in which i can get the rabbitmq version.
> *Regards,
> Krupal Patel,

Hmm. Not sure if there's a great way to do this. Track down the 
rabbit.app file and grep for vsn?

$ locate rabbit.app | while read f ; do grep vsn $f ; done
      {vsn,"3.1.0"},

Or if you installed via a package manager, ask it:

$ dpkg -l rabbitmq-server
Desired=Unknown/Install/Remove/Purge/Hold
| 
Status=Not/Inst/Cfg-files/Unpacked/Failed-cfg/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
||/ Name           Version        Description
+++-==============-==============-============================================
ii  rabbitmq-serve 3.1.0-1        AMQP server written in Erlang

But that's probably cheating ;-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From billythethird at gmail.com  Thu May 16 17:53:49 2013
From: billythethird at gmail.com (Billy Hand)
Date: Thu, 16 May 2013 11:53:49 -0500
Subject: [rabbitmq-discuss] getting duplicated delivery
In-Reply-To: <CAE3HoVQM=MhiNUpmmM3OnJ-Tgt=k6Lhkmob+V4451TtDLJ+75w@mail.gmail.com>
References: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>
	<C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>
	<CAAef2CLMTwnmROuAjB-27FyrUHQeCzEHMxmLarcxnpRXZ2avQw@mail.gmail.com>
	<CAE3HoVQM=MhiNUpmmM3OnJ-Tgt=k6Lhkmob+V4451TtDLJ+75w@mail.gmail.com>
Message-ID: <CAAef2CJ-XEh8sCV8bHUFT6JPTRzYBeK8PEd1PkXjpWeb9=qNoA@mail.gmail.com>

Well I should add that I'm using PHP and the PECL bindings for the
rabbitmq-c library.  So I've been able to determine the exact repro steps.
1. get (no_ack off)
2. ack
3. get again, the connection drops, the message gets redelivered

The exact same code connecting to rabbitmq 3.0.4 does not have this problem
so I'm guessing something broke with the PHP bindings or rabbitmq-c between
versions.  I leave room for a misconfiguration of rabbitmq on my part but
other than setting up a user/password and giving it full access to the /
vhost I didn't do much configuration on either.  Here is the code I'm using:

Producer:
<?php

$co = new AMQPConnection();
$co->setLogin('user');
$co->setPassword('password');
$co->setTimeout(60);
$co->connect();

$ch = new AMQPChannel($co);

$ex_name = 'test_exchange';
$ex = new AMQPExchange($ch);
$ex->setName($ex_name);
$ex->setType(AMQP_EX_TYPE_DIRECT);
$ex->declare();

$q_name = 'test_queue';
$q = new AMQPQueue($ch);
$q->setName($q_name);
$q->setFlags(AMQP_DURABLE);
$q->declare();
$q->bind($ex_name, $q_name);

$ex->publish('test_message'.microtime(true), $q_name);

Consumer:
<?php

$co = new AMQPConnection();
$co->setLogin('user');
$co->setPassword('password');
$co->setTimeout(0);
$co->connect();

$ch = new AMQPChannel($co);

$ex_name = 'test_exchange';
$ex = new AMQPExchange($ch);
$ex->setName($ex_name);
$ex->setType(AMQP_EX_TYPE_DIRECT);
$ex->declare();

$q_name = 'test_queue';
$q = new AMQPQueue($ch);
$q->setName($q_name);
$q->setFlags(AMQP_DURABLE);
$q->declare();
$q->bind($ex_name, $q_name);

while (true) {
  //$envelope = $q->get(AMQP_AUTOACK);
  $envelope = $q->get();
  if ($envelope) {
    echo $envelope->getBody() ."\n";
    $q->ack($envelope->getDeliveryTag());
    $envelope = false;
  }
}


On Thu, May 16, 2013 at 9:48 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> 2013/5/16 Billy Hand <billythethird at gmail.com>
>
>> I'm using a short program I wrote that generates exactly one message.
>
>
> Can you post the code (of both the producer and consumers)?
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/5ca59a8f/attachment.htm>

From richard at raseley.com  Thu May 16 19:13:51 2013
From: richard at raseley.com (Richard Raseley)
Date: Thu, 16 May 2013 11:13:51 -0700
Subject: [rabbitmq-discuss] Guidance on Understanding API Output for
	Monitoring
In-Reply-To: <5193839E.6080005@rabbitmq.com>
References: <CAO=6ox_Yiisk18BeNHs6qO2aVxDow12XjJpAGiDmw5DSVAvi7g@mail.gmail.com>
	<518CFB4E.20400@rabbitmq.com>
	<CAO=6ox8fUcg_UrWgnN_XLQ8w0RGQPKpmskf+mO7v0urNO87i+Q@mail.gmail.com>
	<5193839E.6080005@rabbitmq.com>
Message-ID: <CAO=6ox-C=ZnpAmjgZMzJrvDmTs2rsk5L+MUGE6zs+brUx=2MGQ@mail.gmail.com>

Simon,

Thanks so much for the reply. It sounds like it would be beneficial for us
to upgrade to 3.1.0. I will run this by the relevant people and figure out
our path forward.

Regards,

Richard


On Wed, May 15, 2013 at 5:46 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/05/13 15:12, Richard Raseley wrote:
>
>> Simon,
>>
>> Primarily I would like to get absolute message count and throughput
>> statistics on a specified exchange over a specified or at least known
>> time period.
>>
>> If you look at the JSON attachment I sent it does show throughput (e.g.
>> 100msg/s) but it doesn't tell me over what period that number is from.
>>
>> Any help would be greatly appreciated.
>>
>
> I think you are using < 3.1.0 - in which case the throughput is the
> current instantaneous rate, and the absolute counts are for all currently
> open channels (so they can go backward when a channel is closed).
>
> In 3.1.0 this was rewritten. The absolute counts are now for all time
> (well, since the statistics database started) and you can specify
> sample_age and sample_incr parameters to get historical data - see
>
> http://hg.rabbitmq.com/**rabbitmq-management/raw-file/**
> rabbitmq_v3_1_0/priv/www/api/**index.html<http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_1_0/priv/www/api/index.html>
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/5eef527b/attachment.htm>

From matthias at rabbitmq.com  Thu May 16 19:43:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 May 2013 19:43:57 +0100
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1368703737826-26757.post@n5.nabble.com>
References: <CAE3HoVRxj40HN_FPGqdPwuzhxq5TXM9oHZSG5_pCdh1S8T3Mhw@mail.gmail.com>
	<519124A5.805@rabbitmq.com>
	<1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
	<1368619663987-26710.post@n5.nabble.com>
	<1368620907646-26713.post@n5.nabble.com>
	<51938BF1.7070106@rabbitmq.com>
	<1368625779575-26720.post@n5.nabble.com>
	<51939483.5020305@rabbitmq.com>
	<1368703737826-26757.post@n5.nabble.com>
Message-ID: <519528ED.5050205@rabbitmq.com>

On 16/05/13 12:28, rabbit666 wrote:
> it seems that multicastmain and our test are different. as i suppose the mm
> load broker exactly by 600000 messages. our test produce 600000 as a result
> of differences beetwen producers and cosumers.
>
> our scenario assumes that for 32 queues 6*32 producers and 32 consumers.
> producers produce more message that cosumers cosnsume.

So if I understand you correctly, you have 32 queues with six producers 
and one consumer each, and the 600k enqueued messages arise from the 
fact that consumers cannot keep up with producers?

Is it possible that a lot more messages (e.g. a few million) were 
enqueued at some point prior to settling on the 600k figure?

What else is going on in your system? The 'rabbitmqctl status' showed 
486 sockets in use, so clearly there must be more than 6*32+32=224 
connections.

Please post the output of 'rabbitmqctl report' while the system is using 
a lot of memory.

Matthias.

From eric.berg at pardot.com  Thu May 16 20:09:58 2013
From: eric.berg at pardot.com (Eric Berg)
Date: Thu, 16 May 2013 15:09:58 -0400
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
	<9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
Message-ID: <CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>

Thanks for the insight Tim. I ended up killing the the process before
receiving your email so I was unable to take advantage of your pro tips. We
subsequently upgraded our cluster to 3.1.0 on Erlang R15B03, and have run
into a slightly different problem. This appears to be unrelated, but I did
use your tips to gather as much information as possible.

Scenario:
A producer is sending messages to rabbit faster than they can be routed so
the connection goes under flow control. The flow control lasts long enough
so that our load balancer severs the connection. Before we understood that
the LB was our problem we would just retry socket write up to 10 times
before throwing an exception. In the end, our cluster now has 0 connections
yet it still has nearly 4000 channels (screen grab attached). Also, now I
am unable to stop_app on any node in the cluster without it hanging for, at
this point, over an hour.

Questions:
1. Should rabbit maintain channels without active connections? If not, has
anyone run into this before?
2. Is there any way to force kill these channels?
3. Is it a good practice for consumers to connect to rabbit via a load
balancer, or should that be for producers only? Are there any recommended
timeout settings?


Here are the results of some commands on the shell to the broker:


bash-4.1$ erl -sname debug -remsh rabbit at rabbit-box
{error_logger,{{2013,5,16},{14,44,36}},std_error,"File operation error:
eacces. Target: .. Function: read_file_info. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./beam_lib.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./ram_file.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./standard_error.beam. Function: get_file. Process:
code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./supervisor_bridge.beam. Function: get_file. Process:
code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./user_sup.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./user_drv.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./group.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./edlin.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./io_lib.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./proplists.beam. Function: get_file. Process:
code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./io_lib_format.beam. Function: get_file. Process:
code_server."}
Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:16:16]
[async-threads:0] [hipe] [kernel-poll:false]

{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./net.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./inet_gethost_native.beam. Function: get_file. Process:
code_server."}
{error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
eacces. Target: ./kernel_config.beam. Function: get_file. Process:
code_server."}

=ERROR REPORT==== 16-May-2013::10:44:36 ===
File operation error: eacces. Target: .. Function: read_file_info. Process:
code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
File operation error: eacces. Target: ./beam_lib.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
File operation error: eacces. Target: ./ram_file.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
File operation error: eacces. Target: ./standard_error.beam. Function:
get_file. Process: code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
File operation error: eacces. Target: ./supervisor_bridge.beam. Function:
get_file. Process: code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
File operation error: eacces. Target: ./user_sup.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
File operation error: eacces. Target: ./user_drv.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
File operation error: eacces. Target: ./group.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
File operation error: eacces. Target: ./edlin.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::10:44:37 ===
{lost_messages,6}

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./error_logger_tty_h.beam. Function:
get_file. Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./calendar.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./io_lib_pretty.beam. Function:
get_file. Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./io.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./erl_scan.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./c.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./erl_eval.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./orddict.beam. Function: get_file.
Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./file_io_server.beam. Function:
get_file. Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./erl_posix_msg.beam. Function:
get_file. Process: code_server.

=ERROR REPORT==== 16-May-2013::14:44:37 ===
file:path_eval([".","/var/lib/rabbitmq"],".erlang"): permission denied

=ERROR REPORT==== 16-May-2013::14:44:37 ===
File operation error: eacces. Target: ./dist_util.beam. Function: get_file.
Process: code_server.
Eshell V5.9.3.1  (abort with ^G)




-------------------------------------------------

(rabbit at rabbit-box)1> whereis(rabbit).
<0.251.0>


-------------------------------------------------

(rabbit at rabbit-box)2> application:loaded_applications().
[{public_key,"Public key infrastructure","0.17"},
 {rabbitmq_management_agent,"RabbitMQ Management Agent",
                            "3.1.0"},
 {os_mon,"CPO  CXC 138 46","2.2.10"},
 {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
 {mnesia,"MNESIA  CXC 138 12","4.7.1"},
 {rabbitmq_shovel,"Data Shovel for RabbitMQ","3.1.0"},
 {inets,"INETS  CXC 138 49","5.9.2"},
 {rabbitmq_federation,"RabbitMQ Federation","3.1.0"},
 {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
 {rabbitmq_federation_management,"RabbitMQ Federation Management",
                                 "3.1.0"},
 {rabbitmq_management_visualiser,"RabbitMQ Visualiser",
                                 "3.1.0"},
 {kernel,"ERTS  CXC 138 10","2.15.3"},
 {crypto,"CRYPTO version 2","2.2"},
 {ssl,"Erlang/OTP SSL application","5.1.2"},
 {sasl,"SASL  CXC 138 11","2.2.1"},
 {rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
 {mochiweb,"MochiMedia Web Server",
           "2.3.1-rmq3.1.0-gitd541e9a"},
 {xmerl,"XML parser","1.3.2"},
 {rabbit,"RabbitMQ","3.1.0"},
 {stdlib,"ERTS  CXC 138 10","1.18.3"},
 {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"}]


------------------------------------------------------------------------------------


(rabbit at rabbit-box)3> application:which_applications().
** exception exit: {timeout,{gen_server,call,

[application_controller,which_applications]}}
     in function  gen_server:call/2 (gen_server.erl, line 180)


-----------------------------------------------------------------------------------

(rabbit at rabbit-box)4> rabbit:stop().


-- This hangs indefinitely


------------------------------------------------------------------------------------

Perms on /var/lib/rabbitmq
drwxr-xr-x  3 rabbitmq rabbitmq 4096 May  1 07:15 rabbitmq




Thanks Tim et al.




On Thu, May 9, 2013 at 10:00 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi,
>
> On 8 May 2013, at 18:22, Eric Berg wrote:
>
> I have ready through many of these nodedown error emails and of course
> none of them seem to be exactly what I am experiencing.
>
> I have a 4 node cluster, and one of the nodes went offline according to
> the cluster. This box has the following in the sasl log:
>
> =SUPERVISOR REPORT==== 7-May-2013::14:37:22 ===
>      Supervisor: {<0.11197.1096>,
>                                            rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     noproc
>      Offender:   [{pid,<0.11199.1096>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
>
>
> This simply indicates that and error occurred whilst a supervised process
> was shutting down. It's not indicative of the whole node going down -
> Erlang allows processes to crash and be restarted whilst the system is
> running.
>
> *Yet in the regular rabbit log i can see that it was still accepting
> connections up until 2:22AM the next day:*
>
> (last log entry)
> =INFO REPORT==== 8-May-2013::02:22:26 ===
> closing AMQP connection <0.18267.1145> (IPADDRESS:PORT -> IPADDRESS:PORT)
>
>
> So clearly that node didn't actually go offline. The 'nodedown' message in
> the other clustered broker's logs does not necessarily mean that the node
> in question crashed; This could, for example, be indicative of a net-split
> or other connectivity failure.
>
> *Running rabbitmqctl status returns:*
>
> [root at rabbit-box rabbitmq]# rabbitmqctl status
> Status of node 'rabbit at rabbit-box' ...
> Error: unable to connect to node 'rabbit at rabbit-box': nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: ['rabbit at rabbit-box']
>
> hosts, their running nodes and ports:
> - rabbit-box: [{rabbit,13957},{rabbitmqctl2301,16508}]
>
> current node details:
> - node name: 'rabbitmqctl2301 at rabbit-box'
> - home dir: /var/lib/rabbitmq
> - cookie hash: qQwyFW90ZNbbrFvX1AtrxQ==
>
>
> Have you tried running this using `sudo' instead of as root? Is the
> rabbitmq user's account and home folder in a consistent state? The security
> cookie used for inter-node communications, which includes communication
> between the temporary `rabbitmqctl' node and the broker, has to be the same
> for all the peers.
>
> A couple of notes:
> - Looking for a process run by rabbit show that it appears to still be
> running
>
>
> Yes - as I said, there's no indication that this node actually died from
> what you've said. However `rabbitmqctl` should be able to connect to
> rabbit at rabbit-box at the very least.
>
> - Erlang cookie is the same on all nodes of the cluster, the cookie hash
> is the same as well
>
>
> If it's not the cookies then....
>
> - A traffic spike occurred right around the time of the last entry in the
> rabbit log
>
>
> It sounds like this could be a potential culprit. Can you provide any more
> information about what happened? It could be that whilst the network was
> saturated, the node in question got disconnected from the other nodes in
> the cluster because it exceeded the "net tick time" and subsequently things
> have started to go wrong. That shouldn't happen, viz the node should be
> able to re-establish connectivity, but it's possible that something's gone
> wrong here.
>
> What that doesn't explain is why you can't connect from rabbitmqctl. If
> you `su rabbitmq', can you then run `erl -sname debug -remsh
> rabbit at rabbit-box' to establish a shell into the running broker? If that
> does work, then you can stop the rabbit application and then the node, as
> follows:
>
> > rabbit:stop().
> ok
> > init:stop().
>
> But before you do, it might be worth evaluating a couple of other things
> that might help us identify what's going on:
>
> (rabbit at iske)1> whereis(rabbit).
> <0.152.0>
> (rabbit at iske)2> application:loaded_applications().
> [{os_mon,"CPO  CXC 138 46","2.2.9"},
>  {rabbitmq_management_agent,"RabbitMQ Management Agent",
>                             "0.0.0"},
>  {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
>  etc ...
>  ]
> (rabbit at iske)3> application:which_applications().
> [{rabbitmq_shovel_management,"Shovel Status","0.0.0"},
>  etc ...
> ]
>
> If during any of these you get stuck, CTRL-C (and press the key for
> 'abort') should get you back out again without incident.
>
>
> - I can find no other errors in any logs that relate to rabbit or erlang
> - Up until this point the cluster has been running fine for over 40 days.
>
> - telnet IP_ADDRESS 5672 times out
>
>
> So the broker is no longer accepting new AMQP connections then.
> Something's clearly quite wrong with this node.
>
> - I have not restarted the box, erlang node, or entire rabbitmq-server
>
> Is there anywhere else I can go looking for errors? I am about to start
> killing processs, but Im not sure that will solve anything.
>
>
> Did you do that in the end? If not, I would really like to get to the
> bottom of what's wrong with this node. I don't suppose it would be possible
> for you to give us access to this machine would it? If necessary, we may be
> able to get some kind of confidentiality agreement signed if that'd help.
>
> Cheers,
>
> Tim Watson
> Staff Engineer
> RabbitMQ
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/31b6b51a/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit-manychannels.png
Type: image/png
Size: 127694 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/31b6b51a/attachment.png>

From pacesysjosh at gmail.com  Thu May 16 20:25:34 2013
From: pacesysjosh at gmail.com (Josh Stone)
Date: Thu, 16 May 2013 12:25:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Channel versus Connection shutdown
Message-ID: <8cfecabd-9833-4918-a76b-240c1621a75f@googlegroups.com>

Are channels ever shutdown independent of connections? If so, what would 
cause a channel to be involuntarily shutdown while the connection remains? 
Is there any way to test for this scenario by forcefully closing a channel 
(I don't see anything on the server console)?

Thanks,
Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/8c87c877/attachment.htm>

From pacesysjosh at gmail.com  Thu May 16 20:26:40 2013
From: pacesysjosh at gmail.com (Josh Stone)
Date: Thu, 16 May 2013 12:26:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Channel versus Connection shutdown
Message-ID: <3cc920e3-a7bb-4cb7-96d9-8bf3481f5119@googlegroups.com>

Are channels ever shutdown independent of connections? If so, what would 
cause a channel to be involuntarily shutdown while the connection remains? 
Is there any way to test for this scenario by forcefully closing a channel 
(I don't see anything on the server console)?

Thanks,
Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/c352243c/attachment.htm>

From michael.s.klishin at gmail.com  Thu May 16 20:39:25 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 16 May 2013 23:39:25 +0400
Subject: [rabbitmq-discuss] Channel versus Connection shutdown
In-Reply-To: <8cfecabd-9833-4918-a76b-240c1621a75f@googlegroups.com>
References: <8cfecabd-9833-4918-a76b-240c1621a75f@googlegroups.com>
Message-ID: <CAE3HoVTEXG9DwS205Z+Qjf7szWtS54m_hFLP6H1cSstFEjowTg@mail.gmail.com>

2013/5/16 Josh Stone <pacesysjosh at gmail.com>

> Are channels ever shutdown independent of connections? If so, what would
> cause a channel to be involuntarily shutdown while the connection remains?


A channel-level exception.

For example, try binding a queue that does not exist to an exchange,
declare a queue that exists with different attributes,
ack an unknown delivery tag, etc.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/ba2b5baf/attachment.htm>

From brett.r.cameron at gmail.com  Thu May 16 20:57:58 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 17 May 2013 07:57:58 +1200
Subject: [rabbitmq-discuss] HTTP API Callback
In-Reply-To: <5194D83B.2060805@rabbitmq.com>
References: <e436f921-9cf5-42cd-9e4d-a501fe880e87@googlegroups.com>
	<5194D83B.2060805@rabbitmq.com>
Message-ID: <CALPqkipFHcRNPL5f29Ld4numLZZeMhE14uByJ+cq6tbKbjRQbw@mail.gmail.com>

I've recently updated this to work with RabbitMQ 3.1.0 (see
https://github.com/brc859844/rabbithub.git). Tony is going to merge the
changes back into his repo at some point.

I've stuck a binary on
https://region-a.geo-1.objects.hpcloudsvc.com:443/v1/66395568832599/RabbitHub/rabbithub-3.1.0.ez

Brett


On Fri, May 17, 2013 at 12:59 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 15/05/13 15:38, aviusexperience at gmail.com wrote:
>
>> Just wondering if there is a way RabbitMQ can send messages to a rest
>> based API, for example I have an application that publishes a message to
>> RabbitMQ when a certain action is performed, would RabbitMQ then be able
>> to automatically send that message to another endpoint e.g.
>> http://localhost/api/receive?
>>
>
> I think the only thing that does this is https://github.com/tonyg/**
> rabbithub <https://github.com/tonyg/rabbithub> - but that is rather
> unofficial.
>
> We might add an official plugin in future, depending on demand etc.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/230ff369/attachment.htm>

From mcintoshj at gmail.com  Thu May 16 21:07:15 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 16 May 2013 15:07:15 -0500
Subject: [rabbitmq-discuss] Server hanging on start, randomly dying
Message-ID: <CAD6m6fEs9t52iC3shi+As-HuA=xRESJtS52Naz6tocM_AKfv6g@mail.gmail.com>

So first, my environment:
RabbitMQ 3.0.4
Oracle linux 6.2
Cluster of 3 nodes, 2 disc, 1 ram.

The problem I'm hitting is I've got one of my nodes hanging and dying.  I
got it to start and about a minute later it dies again.  I have no reports
in any log files, and not a clue what the heck is going on.

At first, I thought it might be tied to some invalid commands, i.e.
rabbitmqctl list_status -p SomeNonExistentQueue (which seems to have
problems regardless).  That command though works on one of the other nodes.

Any advice here?  Nothing as state in the logs.  I've hung in various
places, for example:
-- rabbit boot start
starting file handle cache server
...done
starting worker pool
 ...done
starting database                                                     ...

I get here and things stop.  Other times the whole server starts but then
nothing is working.  This cluster has been in a good state for weeks and
all of a sudden has started doing this.  In non detached mode, by starting
rabbitmq-server AS root by hand, I have the process running.  Below is the
results after a rabbitmqctl status that I managed to get before the system
crashed, as well as the list of plugins.  The last thing in the log file is
"Management plugin started.  Port: 15672"

Thanks for any advice!
Jason

{erlang_version,
     "Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:24:24]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,39045064},
      {connection_procs,5664},
      {queue_procs,792848},
      {plugins,163256},
      {other_proc,11498766},
      {mnesia,404168},
      {mgmt_db,18304},
      {msg_index,94904},
      {other_ets,1224192},
      {binary,42552},
      {code,18246956},
      {atom,703377},
      {other_system,5850077}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,54118517964},
 {disk_free_limit,1000000000},
 {disk_free,840619569152},
 {file_descriptors,

 [{total_limit,924},{total_used,8},{sockets_limit,829},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,316}]},
 {run_queue,0},
 {uptime,14}]


HEre's a list of installed plugins:
[e] amqp_client                       3.0.4
[ ] cowboy                            0.5.0-rmq3.0.4-git4b93c2d
[ ] eldap                             3.0.4-gite309de4
[e] mochiweb                          2.3.1-rmq3.0.4-gitd541e9a
[ ] rabbitmq_auth_backend_ldap        3.0.4
[ ] rabbitmq_auth_mechanism_ssl       3.0.4
[ ] rabbitmq_consistent_hash_exchange 3.0.4
[E] rabbitmq_federation               3.0.4
[E] rabbitmq_federation_management    3.0.4
[ ] rabbitmq_jsonrpc                  3.0.4
[ ] rabbitmq_jsonrpc_channel          3.0.4
[ ] rabbitmq_jsonrpc_channel_examples 3.0.4
[E] rabbitmq_management               3.0.4
[E] rabbitmq_management_agent         3.0.4
[E] rabbitmq_management_visualiser    3.0.4
[ ] rabbitmq_mqtt                     3.0.4
[ ] rabbitmq_old_federation           3.0.4
[E] rabbitmq_shovel                   3.0.4
[E] rabbitmq_shovel_management        3.0.4
[ ] rabbitmq_stomp                    3.0.4
[ ] rabbitmq_tracing                  3.0.4
[e] rabbitmq_web_dispatch             3.0.4
[ ] rabbitmq_web_stomp                3.0.4
[ ] rabbitmq_web_stomp_examples       3.0.4
[ ] rfc4627_jsonrpc                   3.0.4-git7ab174b
[ ] sockjs                            0.3.4-rmq3.0.4-git3132eb9
[e] webmachine                        1.9.1-rmq3.0.4-git52e62bc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/061906da/attachment.htm>

From tim at rabbitmq.com  Thu May 16 21:54:13 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 16 May 2013 21:54:13 +0100
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
	<9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
	<CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
Message-ID: <EBF95E66-C42B-40D7-85DB-A7E21C436454@rabbitmq.com>

Hi Eric,

> Thanks for the insight Tim. I ended up killing the the process before receiving your email so I was unable to take advantage of your pro tips. We subsequently upgraded our cluster to 3.1.0 on Erlang R15B03, and have run into a slightly different problem. This appears to be unrelated, but I did use your tips to gather as much information as possible.
> 
> Scenario:
> A producer is sending messages to rabbit faster than they can be routed so the connection goes under flow control. The flow control lasts long enough so that our load balancer severs the connection. Before we understood that the LB was our problem we would just retry socket write up to 10 times before throwing an exception. In the end, our cluster now has 0 connections yet it still has nearly 4000 channels (screen grab attached). Also, now I am unable to stop_app on any node in the cluster without it hanging for, at this point, over an hour.


That looks and sounds like a seriously unhappy Rabbit - I'm very concerned, especially about those open channels, but it's quite late, so I'll need to get into this properly in the morning. For the time being though, it looks a lot like something has gone horribly wrong with your Erlang installation. What happens if you start up Erlang by itself, using `erl -sname test` - do you still see all those screwy warnings? It seems as though the emulator's code server is unable to read from the file system - this could be due to a change in permissions somewhere on the host's file system, *or* it could be that you're running the `erl -sname debug -remsh rabbit at rabbit-box` command from a user account with insufficient permissions.

Can you run `lsof` and let us know what the hosts use of file descriptors looks like please. A Rabbit should never have open channels that aren't tied to a connection. It looks to me like your rabbit is stuck either starting up or shutting down - that's why the application controller isn't responding to calls (or is timing out). In fact, general stats about the state of your OS would be really useful - file descriptor usage, current disk io, cpu and memory use would all help. If you've got historic data about these too, especially around the time of your traffic spike, all the better.

It would be *very* helpful if you'd be able to grant us ssh access to this machine - we might be able to sign some legal stuff if that helps. Without access to the machine, the diagnostic process is going to involve a fair bit of to-ing and fro-ing. We could make use of IM/IRC if that helps too. Drop me a note and let me know what's likely to work best for you.

To clarify

> Questions:
> 1. Should rabbit maintain channels without active connections? If not, has anyone run into this before?

No, never. I've not seen this one before, but I'll do some archeology in our bug tracker and the mailing list to see if there's anything that might help.

> 2. Is there any way to force kill these channels?

We might be able to find a way to do that, but TBH the state your rabbit is in, I think it'll need to be killed. BUT PLEASE don't do that. It's really important that we understand how your system got into this state, because it represents a really nasty bug that we should fix asap, and having a running Rabbit in this state represents our best chance at understanding what's going on..

> 3. Is it a good practice for consumers to connect to rabbit via a load balancer, or should that be for producers only? Are there any recommended timeout settings?


You should be able to use a LB for either kind of client, the choice of timeout should be application and infrastructure dependent - i.e., whatever makes sense for your use case - and doing so should *not* get you into this state, ever. We *will* find out what's gone on here and fix it, asap. The *only* caveat here is that, if something catastrophic has gone wrong with our host machine (e.g., the file system has bombed out, or something like that) then it might be that no application would stand any chance of surviving intact, but we need to understand what's gone on here either way. 

Cheers,
Tim

On 16 May 2013, at 20:09, Eric Berg wrote:

> 
> Here are the results of some commands on the shell to the broker:
> 
> 
> bash-4.1$ erl -sname debug -remsh rabbit at rabbit-box
> {error_logger,{{2013,5,16},{14,44,36}},std_error,"File operation error: eacces. Target: .. Function: read_file_info. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./beam_lib.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./ram_file.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./standard_error.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./supervisor_bridge.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./user_sup.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./user_drv.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./group.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./edlin.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./io_lib.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./proplists.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./io_lib_format.beam. Function: get_file. Process: code_server."}
> Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:16:16] [async-threads:0] [hipe] [kernel-poll:false]
> 
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./net.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./inet_gethost_native.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./kernel_config.beam. Function: get_file. Process: code_server."}
> 
> =ERROR REPORT==== 16-May-2013::10:44:36 ===
> File operation error: eacces. Target: .. Function: read_file_info. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./beam_lib.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./ram_file.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./standard_error.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./supervisor_bridge.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./user_sup.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./user_drv.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./group.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./edlin.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> {lost_messages,6}
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./error_logger_tty_h.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./calendar.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./io_lib_pretty.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./io.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./erl_scan.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./c.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./erl_eval.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./orddict.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./file_io_server.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./erl_posix_msg.beam. Function: get_file. Process: code_server.
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> file:path_eval([".","/var/lib/rabbitmq"],".erlang"): permission denied
> 
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./dist_util.beam. Function: get_file. Process: code_server.
> Eshell V5.9.3.1  (abort with ^G)
> 
> 
> 
> 
> -------------------------------------------------
> 
> (rabbit at rabbit-box)1> whereis(rabbit).
> <0.251.0>
> 
> 
> -------------------------------------------------
> 
> (rabbit at rabbit-box)2> application:loaded_applications().
> [{public_key,"Public key infrastructure","0.17"},
>  {rabbitmq_management_agent,"RabbitMQ Management Agent",
>                             "3.1.0"},
>  {os_mon,"CPO  CXC 138 46","2.2.10"},
>  {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
>  {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>  {rabbitmq_shovel,"Data Shovel for RabbitMQ","3.1.0"},
>  {inets,"INETS  CXC 138 49","5.9.2"},
>  {rabbitmq_federation,"RabbitMQ Federation","3.1.0"},
>  {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
>  {rabbitmq_federation_management,"RabbitMQ Federation Management",
>                                  "3.1.0"},
>  {rabbitmq_management_visualiser,"RabbitMQ Visualiser",
>                                  "3.1.0"},
>  {kernel,"ERTS  CXC 138 10","2.15.3"},
>  {crypto,"CRYPTO version 2","2.2"},
>  {ssl,"Erlang/OTP SSL application","5.1.2"},
>  {sasl,"SASL  CXC 138 11","2.2.1"},
>  {rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
>  {mochiweb,"MochiMedia Web Server",
>            "2.3.1-rmq3.1.0-gitd541e9a"},
>  {xmerl,"XML parser","1.3.2"},
>  {rabbit,"RabbitMQ","3.1.0"},
>  {stdlib,"ERTS  CXC 138 10","1.18.3"},
>  {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"}]
> 
> 
> ------------------------------------------------------------------------------------
> 
> 
> (rabbit at rabbit-box)3> application:which_applications(). 
> ** exception exit: {timeout,{gen_server,call,
>                                         [application_controller,which_applications]}}
>      in function  gen_server:call/2 (gen_server.erl, line 180)
> 
> 
> -----------------------------------------------------------------------------------
> 
> (rabbit at rabbit-box)4> rabbit:stop().
> 
> 
> -- This hangs indefinitely 
> 
> 
> ------------------------------------------------------------------------------------
> 
> Perms on /var/lib/rabbitmq
> drwxr-xr-x  3 rabbitmq rabbitmq 4096 May  1 07:15 rabbitmq
> 
> 
> 
> 
> Thanks Tim et al.
> 
> 
> 
> 
> On Thu, May 9, 2013 at 10:00 AM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi,
> 
> On 8 May 2013, at 18:22, Eric Berg wrote:
> 
>> I have ready through many of these nodedown error emails and of course none of them seem to be exactly what I am experiencing.
>> 
>> I have a 4 node cluster, and one of the nodes went offline according to the cluster. This box has the following in the sasl log:
>> 
>> =SUPERVISOR REPORT==== 7-May-2013::14:37:22 ===
>>      Supervisor: {<0.11197.1096>,
>>                                            rabbit_channel_sup_sup}
>>      Context:    shutdown_error
>>      Reason:     noproc
>>      Offender:   [{pid,<0.11199.1096>},
>>                   {name,channel_sup},
>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>                   {restart_type,temporary},
>>                   {shutdown,infinity},
>>                   {child_type,supervisor}]
>> 
> 
> This simply indicates that and error occurred whilst a supervised process was shutting down. It's not indicative of the whole node going down - Erlang allows processes to crash and be restarted whilst the system is running.
> 
>> Yet in the regular rabbit log i can see that it was still accepting connections up until 2:22AM the next day:
>> 
>> (last log entry)
>> =INFO REPORT==== 8-May-2013::02:22:26 ===
>> closing AMQP connection <0.18267.1145> (IPADDRESS:PORT -> IPADDRESS:PORT)
>> 
> 
> So clearly that node didn't actually go offline. The 'nodedown' message in the other clustered broker's logs does not necessarily mean that the node in question crashed; This could, for example, be indicative of a net-split or other connectivity failure. 
> 
>> Running rabbitmqctl status returns:
>> 
>> [root at rabbit-box rabbitmq]# rabbitmqctl status
>> Status of node 'rabbit at rabbit-box' ...
>> Error: unable to connect to node 'rabbit at rabbit-box': nodedown
>> 
>> DIAGNOSTICS
>> ===========
>> 
>> nodes in question: ['rabbit at rabbit-box']
>> 
>> hosts, their running nodes and ports:
>> - rabbit-box: [{rabbit,13957},{rabbitmqctl2301,16508}]
>> 
>> current node details:
>> - node name: 'rabbitmqctl2301 at rabbit-box'
>> - home dir: /var/lib/rabbitmq
>> - cookie hash: qQwyFW90ZNbbrFvX1AtrxQ==
> 
> Have you tried running this using `sudo' instead of as root? Is the rabbitmq user's account and home folder in a consistent state? The security cookie used for inter-node communications, which includes communication between the temporary `rabbitmqctl' node and the broker, has to be the same for all the peers.
> 
>> A couple of notes:
>> - Looking for a process run by rabbit show that it appears to still be running
> 
> Yes - as I said, there's no indication that this node actually died from what you've said. However `rabbitmqctl` should be able to connect to rabbit at rabbit-box at the very least. 
> 
>> - Erlang cookie is the same on all nodes of the cluster, the cookie hash is the same as well
> 
> If it's not the cookies then....
> 
>> - A traffic spike occurred right around the time of the last entry in the rabbit log
> 
> It sounds like this could be a potential culprit. Can you provide any more information about what happened? It could be that whilst the network was saturated, the node in question got disconnected from the other nodes in the cluster because it exceeded the "net tick time" and subsequently things have started to go wrong. That shouldn't happen, viz the node should be able to re-establish connectivity, but it's possible that something's gone wrong here.
> 
> What that doesn't explain is why you can't connect from rabbitmqctl. If you `su rabbitmq', can you then run `erl -sname debug -remsh rabbit at rabbit-box' to establish a shell into the running broker? If that does work, then you can stop the rabbit application and then the node, as follows:
> 
> > rabbit:stop().
> ok
> > init:stop().
> 
> But before you do, it might be worth evaluating a couple of other things that might help us identify what's going on:
> 
> (rabbit at iske)1> whereis(rabbit).
> <0.152.0>
> (rabbit at iske)2> application:loaded_applications().
> [{os_mon,"CPO  CXC 138 46","2.2.9"},
>  {rabbitmq_management_agent,"RabbitMQ Management Agent",
>                             "0.0.0"},
>  {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
>  etc ...
>  ]
> (rabbit at iske)3> application:which_applications(). 
> [{rabbitmq_shovel_management,"Shovel Status","0.0.0"},
>  etc ...
> ]
>  
> If during any of these you get stuck, CTRL-C (and press the key for 'abort') should get you back out again without incident.
> 
> 
>> - I can find no other errors in any logs that relate to rabbit or erlang
>> - Up until this point the cluster has been running fine for over 40 days.
>> - telnet IP_ADDRESS 5672 times out
> 
> So the broker is no longer accepting new AMQP connections then. Something's clearly quite wrong with this node.
> 
>> - I have not restarted the box, erlang node, or entire rabbitmq-server
>> 
>> Is there anywhere else I can go looking for errors? I am about to start killing processs, but Im not sure that will solve anything.
>> 
> 
> Did you do that in the end? If not, I would really like to get to the bottom of what's wrong with this node. I don't suppose it would be possible for you to give us access to this machine would it? If necessary, we may be able to get some kind of confidentiality agreement signed if that'd help.
> 
> Cheers,
> 
> Tim Watson
> Staff Engineer
> RabbitMQ
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> <rabbit-manychannels.png>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/1fdcc244/attachment.htm>

From honglilai at gmail.com  Thu May 16 22:25:26 2013
From: honglilai at gmail.com (Hongli Lai)
Date: Thu, 16 May 2013 14:25:26 -0700 (PDT)
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre11 is released
In-Reply-To: <CAE3HoVS1tWSnw3yW4Za=cpM0DPoHhUjNR=m2NVbHV=tD7KRS5g@mail.gmail.com>
References: <CAE3HoVS1tWSnw3yW4Za=cpM0DPoHhUjNR=m2NVbHV=tD7KRS5g@mail.gmail.com>
Message-ID: <e30163bd-1c65-43b8-8540-5538657f04c8@googlegroups.com>

I?ve taken a look at the latest Bunny release after not having worked with 
it for a while. I was blown away. Excellent documentation, excellent new 
features (connection auto recovery, etc). Good work!

On Tuesday, May 14, 2013 2:05:55 PM UTC+2, Michael Klishin wrote:
>
> Bunny 0.9.0.pre11 is released to rubygems.org [1].
>
> This release includes minor features, stability and publishing
> performance improvements.
>
> Release notes:
>
> http://blog.rubyrabbitmq.info/blog/2013/05/14/bunny-0-dot-9-0-dot-pre11-is-released/
>
> 1. http://rubygems.org/gems/bunny/versions/0.9.0.pre11
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/06cd6476/attachment.htm>

From john.beck at oracle.com  Thu May 16 22:41:56 2013
From: john.beck at oracle.com (John Beck)
Date: Thu, 16 May 2013 14:41:56 -0700
Subject: [rabbitmq-discuss] stability of on-disk formats
In-Reply-To: Your message of "Tue, 14 May 2013 11:16:53 BST."
	<51920F15.6030308@rabbitmq.com> 
References: <201305132129.r4DLTDei002823@opal.us.oracle.com>
	<51920F15.6030308@rabbitmq.com> 
Message-ID: <201305162141.r4GLfu1K023092@opal.us.oracle.com>

JBeck> If, as we hope, and some mailing list search hits from 2011 suggested,
JBeck> the on-disk formats used by RabbitMQ are generally compatible,

Simon> They are upgrade-compatible. If you have a 2.8.7 installation and
Simon> upgrade to 3.1.0, RabbitMQ will upgrade the on-disk data from the 2.8.x
Simon> format to the 3.1.x format the first time it boots, but you won't then
Simon> be able to go back.

Simon> As Emile says, we guarantee that the format will not change from a.b.x
Simon> to a.b.y, so you can upgrade / downgrade within a bugfix release
Simon> series, but you can't (in general) go back to a previous feature
Simon> release.

Very good; this is the sort of answer we were hoping for.  Thank you very
much!

-- John

http://blogs.oracle.com/jbeck/

From ponmuthu at omnesysindia.com  Fri May 17 05:57:55 2013
From: ponmuthu at omnesysindia.com (PONMUTHU M)
Date: Fri, 17 May 2013 10:27:55 +0530
Subject: [rabbitmq-discuss] problem in starting multi nodes in same
	management plugin 55672
In-Reply-To: <5194ABD4.8090605@rabbitmq.com>
References: <003a01ce521a$15096e50$3f1c4af0$@omnesysindia.com>
	<5194ABD4.8090605@rabbitmq.com>
Message-ID: <008a01ce52bb$1ad63150$508293f0$@omnesysindia.com>

Thanks for your reply !!.

Among 10 nodes , I want 5 nodes only management plugin with different port .
another 5 not required means how can I disable while starting that node ?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 16 May 2013 15:20
To: Discussions about RabbitMQ
Cc: PONMUTHU M
Subject: Re: [rabbitmq-discuss] problem in starting multi nodes in same
management plugin 55672

See the second example under:

http://www.rabbitmq.com/clustering.html#single-machine

for how to set management to start on different ports for each node.

You can't get several nodes to open management on the same port - but
management will show details of all cluster nodes on each port it is open
on.

Cheers, Simon

On 16/05/13 10:45, PONMUTHU M wrote:
> Hi,
>
> Thanks in advance.
>
> rabbitmq-server-3.1.0-1.noarch
> Erlang R15B01
>
> am able to start & view mgmnt plugin using this version.
>
> now my query is , i want to start multiple nodes in a single localhost .
> but i can achieve this only disable rabbitmq_management/mochiweb 
> plugin
>
> i want all nodes mgmnt console in 55672.
>
> *Starting with different mgmnt port for each node also fine (how can I 
> change that ports in ENV) & how can I view those all console in a 
> single console ?*
>
>
> kindly help me !! Description: :)
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal


From watson.timothy at gmail.com  Fri May 17 09:17:17 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 17 May 2013 09:17:17 +0100
Subject: [rabbitmq-discuss] problem in starting multi nodes in same
	management plugin 55672
In-Reply-To: <008a01ce52bb$1ad63150$508293f0$@omnesysindia.com>
References: <003a01ce521a$15096e50$3f1c4af0$@omnesysindia.com>
	<5194ABD4.8090605@rabbitmq.com>
	<008a01ce52bb$1ad63150$508293f0$@omnesysindia.com>
Message-ID: <1F531D6E-7DDF-4EAB-9DFC-C9BB9FA346FA@rabbitmq.com>

On 17 May 2013, at 05:57, "PONMUTHU M" <ponmuthu at omnesysindia.com> wrote:

> Among 10 nodes , I want 5 nodes only management plugin with different port .
> another 5 not required means how can I disable while starting that node ?
> 

You can't get management to ignore any nodes in the cluster, but it will only start on the nodes where you've explicitly configured it to do so.

Cheers,
Tim

> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com] 
> Sent: 16 May 2013 15:20
> To: Discussions about RabbitMQ
> Cc: PONMUTHU M
> Subject: Re: [rabbitmq-discuss] problem in starting multi nodes in same
> management plugin 55672
> 
> See the second example under:
> 
> http://www.rabbitmq.com/clustering.html#single-machine
> 
> for how to set management to start on different ports for each node.
> 
> You can't get several nodes to open management on the same port - but
> management will show details of all cluster nodes on each port it is open
> on.
> 
> Cheers, Simon
> 
> On 16/05/13 10:45, PONMUTHU M wrote:
>> Hi,
>> 
>> Thanks in advance.
>> 
>> rabbitmq-server-3.1.0-1.noarch
>> Erlang R15B01
>> 
>> am able to start & view mgmnt plugin using this version.
>> 
>> now my query is , i want to start multiple nodes in a single localhost .
>> but i can achieve this only disable rabbitmq_management/mochiweb 
>> plugin
>> 
>> i want all nodes mgmnt console in 55672.
>> 
>> *Starting with different mgmnt port for each node also fine (how can I 
>> change that ports in ENV) & how can I view those all console in a 
>> single console ?*
>> 
>> 
>> kindly help me !! Description: :)
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tim at rabbitmq.com  Fri May 17 09:34:05 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 17 May 2013 09:34:05 +0100
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <EBF95E66-C42B-40D7-85DB-A7E21C436454@rabbitmq.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
	<9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
	<CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
	<EBF95E66-C42B-40D7-85DB-A7E21C436454@rabbitmq.com>
Message-ID: <C7E8BA08-B835-46FA-8A56-762622AE90C1@rabbitmq.com>

Some more questions as well...

When you upgraded your cluster, what RabbitMQ version did you upgrade from and to, and did you upgrade Erlang as well and if so, which versions were involved?

Cheers,
Tim

On 16 May 2013, at 21:54, Tim Watson wrote:

> Hi Eric,
> 
>> Thanks for the insight Tim. I ended up killing the the process before receiving your email so I was unable to take advantage of your pro tips. We subsequently upgraded our cluster to 3.1.0 on Erlang R15B03, and have run into a slightly different problem. This appears to be unrelated, but I did use your tips to gather as much information as possible.
>> 
>> Scenario:
>> A producer is sending messages to rabbit faster than they can be routed so the connection goes under flow control. The flow control lasts long enough so that our load balancer severs the connection. Before we understood that the LB was our problem we would just retry socket write up to 10 times before throwing an exception. In the end, our cluster now has 0 connections yet it still has nearly 4000 channels (screen grab attached). Also, now I am unable to stop_app on any node in the cluster without it hanging for, at this point, over an hour.
> 
> 
> That looks and sounds like a seriously unhappy Rabbit - I'm very concerned, especially about those open channels, but it's quite late, so I'll need to get into this properly in the morning. For the time being though, it looks a lot like something has gone horribly wrong with your Erlang installation. What happens if you start up Erlang by itself, using `erl -sname test` - do you still see all those screwy warnings? It seems as though the emulator's code server is unable to read from the file system - this could be due to a change in permissions somewhere on the host's file system, *or* it could be that you're running the `erl -sname debug -remsh rabbit at rabbit-box` command from a user account with insufficient permissions.
> 
> Can you run `lsof` and let us know what the hosts use of file descriptors looks like please. A Rabbit should never have open channels that aren't tied to a connection. It looks to me like your rabbit is stuck either starting up or shutting down - that's why the application controller isn't responding to calls (or is timing out). In fact, general stats about the state of your OS would be really useful - file descriptor usage, current disk io, cpu and memory use would all help. If you've got historic data about these too, especially around the time of your traffic spike, all the better.
> 
> It would be *very* helpful if you'd be able to grant us ssh access to this machine - we might be able to sign some legal stuff if that helps. Without access to the machine, the diagnostic process is going to involve a fair bit of to-ing and fro-ing. We could make use of IM/IRC if that helps too. Drop me a note and let me know what's likely to work best for you.
> 
> To clarify
> 
>> Questions:
>> 1. Should rabbit maintain channels without active connections? If not, has anyone run into this before?
> 
> No, never. I've not seen this one before, but I'll do some archeology in our bug tracker and the mailing list to see if there's anything that might help.
> 
>> 2. Is there any way to force kill these channels?
> 
> We might be able to find a way to do that, but TBH the state your rabbit is in, I think it'll need to be killed. BUT PLEASE don't do that. It's really important that we understand how your system got into this state, because it represents a really nasty bug that we should fix asap, and having a running Rabbit in this state represents our best chance at understanding what's going on..
> 
>> 3. Is it a good practice for consumers to connect to rabbit via a load balancer, or should that be for producers only? Are there any recommended timeout settings?
> 
> 
> You should be able to use a LB for either kind of client, the choice of timeout should be application and infrastructure dependent - i.e., whatever makes sense for your use case - and doing so should *not* get you into this state, ever. We *will* find out what's gone on here and fix it, asap. The *only* caveat here is that, if something catastrophic has gone wrong with our host machine (e.g., the file system has bombed out, or something like that) then it might be that no application would stand any chance of surviving intact, but we need to understand what's gone on here either way. 
> 
> Cheers,
> Tim
> 
> On 16 May 2013, at 20:09, Eric Berg wrote:
> 
>> 
>> Here are the results of some commands on the shell to the broker:
>> 
>> 
>> bash-4.1$ erl -sname debug -remsh rabbit at rabbit-box
>> {error_logger,{{2013,5,16},{14,44,36}},std_error,"File operation error: eacces. Target: .. Function: read_file_info. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./beam_lib.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./ram_file.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./standard_error.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./supervisor_bridge.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./user_sup.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./user_drv.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./group.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./edlin.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./io_lib.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./proplists.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./io_lib_format.beam. Function: get_file. Process: code_server."}
>> Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:16:16] [async-threads:0] [hipe] [kernel-poll:false]
>> 
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./net.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./inet_gethost_native.beam. Function: get_file. Process: code_server."}
>> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error: eacces. Target: ./kernel_config.beam. Function: get_file. Process: code_server."}
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:36 ===
>> File operation error: eacces. Target: .. Function: read_file_info. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> File operation error: eacces. Target: ./beam_lib.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> File operation error: eacces. Target: ./ram_file.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> File operation error: eacces. Target: ./standard_error.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> File operation error: eacces. Target: ./supervisor_bridge.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> File operation error: eacces. Target: ./user_sup.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> File operation error: eacces. Target: ./user_drv.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> File operation error: eacces. Target: ./group.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> File operation error: eacces. Target: ./edlin.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::10:44:37 ===
>> {lost_messages,6}
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./error_logger_tty_h.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./calendar.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./io_lib_pretty.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./io.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./erl_scan.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./c.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./erl_eval.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./orddict.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./file_io_server.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./erl_posix_msg.beam. Function: get_file. Process: code_server.
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> file:path_eval([".","/var/lib/rabbitmq"],".erlang"): permission denied
>> 
>> =ERROR REPORT==== 16-May-2013::14:44:37 ===
>> File operation error: eacces. Target: ./dist_util.beam. Function: get_file. Process: code_server.
>> Eshell V5.9.3.1  (abort with ^G)
>> 
>> 
>> 
>> 
>> -------------------------------------------------
>> 
>> (rabbit at rabbit-box)1> whereis(rabbit).
>> <0.251.0>
>> 
>> 
>> -------------------------------------------------
>> 
>> (rabbit at rabbit-box)2> application:loaded_applications().
>> [{public_key,"Public key infrastructure","0.17"},
>>  {rabbitmq_management_agent,"RabbitMQ Management Agent",
>>                             "3.1.0"},
>>  {os_mon,"CPO  CXC 138 46","2.2.10"},
>>  {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
>>  {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>>  {rabbitmq_shovel,"Data Shovel for RabbitMQ","3.1.0"},
>>  {inets,"INETS  CXC 138 49","5.9.2"},
>>  {rabbitmq_federation,"RabbitMQ Federation","3.1.0"},
>>  {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
>>  {rabbitmq_federation_management,"RabbitMQ Federation Management",
>>                                  "3.1.0"},
>>  {rabbitmq_management_visualiser,"RabbitMQ Visualiser",
>>                                  "3.1.0"},
>>  {kernel,"ERTS  CXC 138 10","2.15.3"},
>>  {crypto,"CRYPTO version 2","2.2"},
>>  {ssl,"Erlang/OTP SSL application","5.1.2"},
>>  {sasl,"SASL  CXC 138 11","2.2.1"},
>>  {rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
>>  {mochiweb,"MochiMedia Web Server",
>>            "2.3.1-rmq3.1.0-gitd541e9a"},
>>  {xmerl,"XML parser","1.3.2"},
>>  {rabbit,"RabbitMQ","3.1.0"},
>>  {stdlib,"ERTS  CXC 138 10","1.18.3"},
>>  {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"}]
>> 
>> 
>> ------------------------------------------------------------------------------------
>> 
>> 
>> (rabbit at rabbit-box)3> application:which_applications(). 
>> ** exception exit: {timeout,{gen_server,call,
>>                                         [application_controller,which_applications]}}
>>      in function  gen_server:call/2 (gen_server.erl, line 180)
>> 
>> 
>> -----------------------------------------------------------------------------------
>> 
>> (rabbit at rabbit-box)4> rabbit:stop().
>> 
>> 
>> -- This hangs indefinitely 
>> 
>> 
>> ------------------------------------------------------------------------------------
>> 
>> Perms on /var/lib/rabbitmq
>> drwxr-xr-x  3 rabbitmq rabbitmq 4096 May  1 07:15 rabbitmq
>> 
>> 
>> 
>> 
>> Thanks Tim et al.
>> 
>> 
>> 
>> 
>> On Thu, May 9, 2013 at 10:00 AM, Tim Watson <tim at rabbitmq.com> wrote:
>> Hi,
>> 
>> On 8 May 2013, at 18:22, Eric Berg wrote:
>> 
>>> I have ready through many of these nodedown error emails and of course none of them seem to be exactly what I am experiencing.
>>> 
>>> I have a 4 node cluster, and one of the nodes went offline according to the cluster. This box has the following in the sasl log:
>>> 
>>> =SUPERVISOR REPORT==== 7-May-2013::14:37:22 ===
>>>      Supervisor: {<0.11197.1096>,
>>>                                            rabbit_channel_sup_sup}
>>>      Context:    shutdown_error
>>>      Reason:     noproc
>>>      Offender:   [{pid,<0.11199.1096>},
>>>                   {name,channel_sup},
>>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>>                   {restart_type,temporary},
>>>                   {shutdown,infinity},
>>>                   {child_type,supervisor}]
>>> 
>> 
>> This simply indicates that and error occurred whilst a supervised process was shutting down. It's not indicative of the whole node going down - Erlang allows processes to crash and be restarted whilst the system is running.
>> 
>>> Yet in the regular rabbit log i can see that it was still accepting connections up until 2:22AM the next day:
>>> 
>>> (last log entry)
>>> =INFO REPORT==== 8-May-2013::02:22:26 ===
>>> closing AMQP connection <0.18267.1145> (IPADDRESS:PORT -> IPADDRESS:PORT)
>>> 
>> 
>> So clearly that node didn't actually go offline. The 'nodedown' message in the other clustered broker's logs does not necessarily mean that the node in question crashed; This could, for example, be indicative of a net-split or other connectivity failure. 
>> 
>>> Running rabbitmqctl status returns:
>>> 
>>> [root at rabbit-box rabbitmq]# rabbitmqctl status
>>> Status of node 'rabbit at rabbit-box' ...
>>> Error: unable to connect to node 'rabbit at rabbit-box': nodedown
>>> 
>>> DIAGNOSTICS
>>> ===========
>>> 
>>> nodes in question: ['rabbit at rabbit-box']
>>> 
>>> hosts, their running nodes and ports:
>>> - rabbit-box: [{rabbit,13957},{rabbitmqctl2301,16508}]
>>> 
>>> current node details:
>>> - node name: 'rabbitmqctl2301 at rabbit-box'
>>> - home dir: /var/lib/rabbitmq
>>> - cookie hash: qQwyFW90ZNbbrFvX1AtrxQ==
>> 
>> Have you tried running this using `sudo' instead of as root? Is the rabbitmq user's account and home folder in a consistent state? The security cookie used for inter-node communications, which includes communication between the temporary `rabbitmqctl' node and the broker, has to be the same for all the peers.
>> 
>>> A couple of notes:
>>> - Looking for a process run by rabbit show that it appears to still be running
>> 
>> Yes - as I said, there's no indication that this node actually died from what you've said. However `rabbitmqctl` should be able to connect to rabbit at rabbit-box at the very least. 
>> 
>>> - Erlang cookie is the same on all nodes of the cluster, the cookie hash is the same as well
>> 
>> If it's not the cookies then....
>> 
>>> - A traffic spike occurred right around the time of the last entry in the rabbit log
>> 
>> It sounds like this could be a potential culprit. Can you provide any more information about what happened? It could be that whilst the network was saturated, the node in question got disconnected from the other nodes in the cluster because it exceeded the "net tick time" and subsequently things have started to go wrong. That shouldn't happen, viz the node should be able to re-establish connectivity, but it's possible that something's gone wrong here.
>> 
>> What that doesn't explain is why you can't connect from rabbitmqctl. If you `su rabbitmq', can you then run `erl -sname debug -remsh rabbit at rabbit-box' to establish a shell into the running broker? If that does work, then you can stop the rabbit application and then the node, as follows:
>> 
>> > rabbit:stop().
>> ok
>> > init:stop().
>> 
>> But before you do, it might be worth evaluating a couple of other things that might help us identify what's going on:
>> 
>> (rabbit at iske)1> whereis(rabbit).
>> <0.152.0>
>> (rabbit at iske)2> application:loaded_applications().
>> [{os_mon,"CPO  CXC 138 46","2.2.9"},
>>  {rabbitmq_management_agent,"RabbitMQ Management Agent",
>>                             "0.0.0"},
>>  {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
>>  etc ...
>>  ]
>> (rabbit at iske)3> application:which_applications(). 
>> [{rabbitmq_shovel_management,"Shovel Status","0.0.0"},
>>  etc ...
>> ]
>>  
>> If during any of these you get stuck, CTRL-C (and press the key for 'abort') should get you back out again without incident.
>> 
>> 
>>> - I can find no other errors in any logs that relate to rabbit or erlang
>>> - Up until this point the cluster has been running fine for over 40 days.
>>> - telnet IP_ADDRESS 5672 times out
>> 
>> So the broker is no longer accepting new AMQP connections then. Something's clearly quite wrong with this node.
>> 
>>> - I have not restarted the box, erlang node, or entire rabbitmq-server
>>> 
>>> Is there anywhere else I can go looking for errors? I am about to start killing processs, but Im not sure that will solve anything.
>>> 
>> 
>> Did you do that in the end? If not, I would really like to get to the bottom of what's wrong with this node. I don't suppose it would be possible for you to give us access to this machine would it? If necessary, we may be able to get some kind of confidentiality agreement signed if that'd help.
>> 
>> Cheers,
>> 
>> Tim Watson
>> Staff Engineer
>> RabbitMQ
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> <rabbit-manychannels.png>_______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/9e865760/attachment.htm>

From matthias at rabbitmq.com  Fri May 17 09:38:46 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 17 May 2013 09:38:46 +0100
Subject: [rabbitmq-discuss] problem in starting multi nodes in same
 management plugin 55672
In-Reply-To: <1F531D6E-7DDF-4EAB-9DFC-C9BB9FA346FA@rabbitmq.com>
References: <003a01ce521a$15096e50$3f1c4af0$@omnesysindia.com>
	<5194ABD4.8090605@rabbitmq.com>
	<008a01ce52bb$1ad63150$508293f0$@omnesysindia.com>
	<1F531D6E-7DDF-4EAB-9DFC-C9BB9FA346FA@rabbitmq.com>
Message-ID: <5195EC96.1090301@rabbitmq.com>

On 17/05/13 09:17, Tim Watson wrote:
> On 17 May 2013, at 05:57, "PONMUTHU M" <ponmuthu at omnesysindia.com>
> wrote:
>
>> Among 10 nodes , I want 5 nodes only management plugin with
>> different port . another 5 not required means how can I disable
>> while starting that node ?

Are these nodes clustered or not?

The management plug-in will report on all nodes in a cluster, assuming 
the rabbitmq-management-agent plug-in is enabled on them, but it cannot 
report on nodes across different clusters.

> You can't get management to ignore any nodes in the cluster, but it
> will only start on the nodes where you've explicitly configured it to
> do so.

The OP is running multiple nodes on a single machine. The default 
'enabled plugins' file location is 
${install_prefix}/etc/rabbitmq/enabled_plugins, which means it is 
*shared* between all nodes on that machine. The same goes for the 
rabbitmq.config file. So it's not immediately obvious how one would go 
about enabling/disabling the management plug-in for specific nodes in 
such a setup, or configure different ports for it.

One could possibly make the file locations node specific by construction 
a rabbitmq-env.conf file that sets CONFIG_FILE/ENABLED_PLUGINS_FILE 
based on the node name.


Matthias.

From watson.timothy at gmail.com  Fri May 17 09:41:37 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 17 May 2013 09:41:37 +0100
Subject: [rabbitmq-discuss] problem in starting multi nodes in same
	management plugin 55672
In-Reply-To: <5195EC96.1090301@rabbitmq.com>
References: <003a01ce521a$15096e50$3f1c4af0$@omnesysindia.com>
	<5194ABD4.8090605@rabbitmq.com>
	<008a01ce52bb$1ad63150$508293f0$@omnesysindia.com>
	<1F531D6E-7DDF-4EAB-9DFC-C9BB9FA346FA@rabbitmq.com>
	<5195EC96.1090301@rabbitmq.com>
Message-ID: <3D70E0E7-E989-4FB0-B678-CDB481C4CA40@gmail.com>


On 17 May 2013, at 09:38, Matthias Radestock wrote:
> 
> The OP is running multiple nodes on a single machine. The default 'enabled plugins' file location is ${install_prefix}/etc/rabbitmq/enabled_plugins, which means it is *shared* between all nodes on that machine.

Ah yes, good point. I'd missed that detail.

> The same goes for the rabbitmq.config file. So it's not immediately obvious how one would go about enabling/disabling the management plug-in for specific nodes in such a setup, or configure different ports for it.
> 
> One could possibly make the file locations node specific by construction a rabbitmq-env.conf file that sets CONFIG_FILE/ENABLED_PLUGINS_FILE based on the node name.
> 

Indeed.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/af40f33d/attachment.htm>

From emile at rabbitmq.com  Fri May 17 09:42:14 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 May 2013 09:42:14 +0100
Subject: [rabbitmq-discuss] Server hanging on start, randomly dying
In-Reply-To: <CAD6m6fEs9t52iC3shi+As-HuA=xRESJtS52Naz6tocM_AKfv6g@mail.gmail.com>
References: <CAD6m6fEs9t52iC3shi+As-HuA=xRESJtS52Naz6tocM_AKfv6g@mail.gmail.com>
Message-ID: <5195ED66.7030407@rabbitmq.com>


Hi Jason,

On 16/05/13 21:07, Jason McIntosh wrote:

> The problem I'm hitting is I've got one of my nodes hanging and dying.
>  I got it to start and about a minute later it dies again.  I have no
> reports in any log files, and not a clue what the heck is going on.  

What about the OS log?

> At first, I thought it might be tied to some invalid commands, i.e.
> rabbitmqctl list_status -p SomeNonExistentQueue (which seems to have
> problems regardless).  That command though works on one of the other nodes.

That command is invalid and won't work on any node.

> Any advice here?  Nothing as state in the logs.

Have you ruled out hardware failure?

Try to start the broker standalone without network access.

Is there any chance that the Erlang installation became corrupt? If so
try re-installing it.

Try starting the broker with fewer or no plugins enabled.

Does the broker produce an Erlang crashdump? What is the headline?




-Emile






From sabrina.kuehn90 at web.de  Fri May 17 10:11:32 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Fri, 17 May 2013 02:11:32 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <51924A93.3090901@rabbitmq.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
Message-ID: <1368781892415-26796.post@n5.nabble.com>

Sry I was ill the last days.
Ok I start from the beginning:
When you can't understand me I try to explaine you my situation perhaps
that's better. ^^
My boss told me that he want to use rabbitMQ to cluster, for example, 3 VM's
and this machines should be mirrored on 3 other VM's for High Availability.
I'm a trainee and this topic is really new for me.
I try my best to understand the documentations but I know nothing about
queues and policies and so on.

Thanks for your patience



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26796.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Fri May 17 11:17:05 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 17 May 2013 11:17:05 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1368781892415-26796.post@n5.nabble.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
Message-ID: <F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>

Hi,

On 17 May 2013, at 10:11, Slyth wrote:

> My boss told me that he want to use rabbitMQ to cluster, for example, 3 VM's
> and this machines should be mirrored on 3 other VM's for High Availability.

Right. Now RabbitMQ clustering is a separate thing from High Availability Mirrored Queues. If you want really specific guidance on how to set up clustering or mirroring to do a specific job, then you'll need to provide ? specific requirement. By the way, if you're a trainee, this is a good time for you to learn how to ensure your boss provides concrete requirements that you can work to without confusion! :) 

> I'm a trainee and this topic is really new for me.
> I try my best to understand the documentations but I know nothing about
> queues and policies and so on.
> 

Ok. Why do you need mirroring? You say it's because you need HA right? I still don't understand your topology, and frankly it sounds to me like you would really benefit from some training - which we are able to offer btw. But just to make sure you understand how all this works, here's a really simple guide.

Let's start with the basics - just one broker.

The RabbitMQ broker will run on exactly one machine. Client applications (written in any language which has a binding available) will send messages to the broker and receive messages from the broker. The broker does not need to run on the same machine as the clients which are sending to it and receiving from it. In this mode - 1 broker, shared by all the clients - there can be 1000s of producers and consumers, sending and receiving messages with one another.

Now let's add clustering. What does it do? You install the RabbitMQ broker on three nodes, and you cluster the three brokers together. What do you get from this?

Firstly, clients can connect to any of the three brokers to publish and consume messages. Now say a queue is created on NODE1, then a client to connect to NODE2 and publish to that queue (which actually resides on NODE1), and another client can connect to NODE3 and consume from that queue on NODE1. The clients do not have to care about which node the queue is actually running on, they can connect to any part of the cluster. Great, now you can handle lots more clients and balance the load of the system across multiple nodes, although you might want to make sure that the queues are not all running on just one node.

So what do you need HA/Mirroring for? Well, let's say that your queue is running on NODE1 and clients are connected to ALL the nodes, publishing to and consuming from this queue on NODE1. Now say NODE1 crashes, because of hardware failure or whatever. Ooops, all the messages in that queue on NODE1 are lost, even the persistent ones because the hard disk melted. Oh dear. It is THIS scenario that you need High Availability for. How does high availability work? For each queue that matches the policy (say `mirror.' which will match mirror.in, mirror.out, mirror.foo, etc), the contents of the queue will be continuously replicated on all the nodes you specify. So if you want every called called mirror.<something> to be replicated across three nodes, the you'll use the 'nodes' policy with [node1, node,2 node3] and that's what you'll get.

Now, let's just be 100% clear. What you said was "My boss told me that he want to use rabbitMQ to cluster, for example, 3 VM's and this machines should be mirrored on 3 other VM's for High Availability." Here's why that doesn't make any sense...

1. When you cluster RabbitMQ, you are clustering brokers not VMs

To clarify, when I say "broker", I mean 1 instance of the program, i.e., 1 operating system process. You can have multiple brokers running on a single host, or you can one broker per host. That's all up to you. When you cluster two running brokers - that is, two instances of RabbitMQ running at the same time, potentially on different machines - what you're doing is getting them to (a) know about one another, (b) share definitions of queues, exchanges, users, etc and (c) forward traffic to one another if appropriate (like above, where the queue is started by queue.declare from a client on NODE1, but then another client comes to NODE2 to publish to it. So when you say cluster VMs, that's almost meaningless and quite confusing. 

2. When you use Mirrors/HA in RabbitMQ, you are mirroring queues

You said "this [sic] machines should be mirrored on 3 other VM's for High Availability". Again, that's confusing. As I explained above - hopefully in a way that's understandable - when you set up a mirroring policy, it is the contents of any queue that matches the policy which are replicated across the chosen set of nodes. What do you mean by *machines should be mirrored* then? Do you mean that messages sent any queue with a name that start "mirror.<queue name>" should be replicated across NODE1, NODE2 and NODE3 as well, just in case one of them dies? That's that HA/Mirroring does. Or do you mean something else?

Cheers,
Tim


 

From sabrina.kuehn90 at web.de  Fri May 17 12:10:56 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Fri, 17 May 2013 04:10:56 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
Message-ID: <1368789056843-26798.post@n5.nabble.com>

First THANKS

Now I have to sort my considerations of the last days to give you concret
answers. So please be patient.^^

One sentence to my situation: I come from Germany and stay two monthes in
Madrid for a intership in a smal company. And I think that no one of my
colleagues has emploied hisself with rabbitmq before. They know what they
want to do with rabbitMQ but not how that works in detail. Because of that
and because of a language based comunication problem it's really difficult
to get concret requierments. :)
And I really want to finish that task before I leave spain in two weeks.
Give me please some moments for my answer. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26798.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From eric.berg at pardot.com  Fri May 17 13:45:57 2013
From: eric.berg at pardot.com (Eric Berg)
Date: Fri, 17 May 2013 08:45:57 -0400
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <C7E8BA08-B835-46FA-8A56-762622AE90C1@rabbitmq.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
	<9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
	<CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
	<EBF95E66-C42B-40D7-85DB-A7E21C436454@rabbitmq.com>
	<C7E8BA08-B835-46FA-8A56-762622AE90C1@rabbitmq.com>
Message-ID: <CACeek7Hxt4Pg5nb1YwJQvDCSSEXsRh44PnWiQQ3yog+1RPd1Mw@mail.gmail.com>

Thanks for your response Tim. If you would like SSH access to these boxes
let me know, we can work something out privately. Thanks!

Update from yesterday:
It looks like 2 of the 4 nodes in our cluster have finally shut down, all
channels are now gone. Another node in the cluster hangs on
> sudo rabbitmqctl status

and the final node in the cluster appears to be running just fine. It
however sees the unresponsive node in the cluster status as a running node,
as does the web UI.


*When you upgraded your cluster, what RabbitMQ version did you upgrade from
and to, and did you upgrade Erlang as well and if so, which versions were
involved?
*
- we upgraded from 3.0.4 to 3.1.0, we did not upgrade Erlang it was/is at
version R15B03. We did however install it via RPM with the --nodeps flag
because it did not detect the Erlang dependency correctly. We had
previously installed Erlang:

esl-erlang.x86_64    R15B03-2           @erlang-solutions

*
What happens if you start up Erlang by itself, using `erl -sname test` - do
you still see all those screwy warnings? *
All 4 of the nodes can run this without issue as my user, when I sudo su to
rabbitmq user I get errors on 2 of the 4 nodes as such:

{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: .. Function: read_file_info. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./beam_lib.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./ram_file.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./standard_error.beam. Function: get_file. Process:
code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./supervisor_bridge.beam. Function: get_file. Process:
code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./user_sup.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./user_drv.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./group.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./edlin.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./io_lib.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./proplists.beam. Function: get_file. Process:
code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./io_lib_format.beam. Function: get_file. Process:
code_server."}
Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:16:16]
[async-threads:0] [hipe] [kernel-poll:false]

{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./shell.beam. Function: get_file. Process: code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./user_default.beam. Function: get_file. Process:
code_server."}
{error_logger,{{2013,5,17},{8,32,39}},std_error,"File operation error:
eacces. Target: ./kernel_config.beam. Function: get_file. Process:
code_server."}

=ERROR REPORT==== 17-May-2013::04:32:39 ===
File operation error: eacces. Target: .. Function: read_file_info. Process:
code_server.


...............







On Fri, May 17, 2013 at 4:34 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Some more questions as well...
>
> When you upgraded your cluster, what RabbitMQ version did you upgrade from
> and to, and did you upgrade Erlang as well and if so, which versions were
> involved?
>
> Cheers,
> Tim
>
> On 16 May 2013, at 21:54, Tim Watson wrote:
>
> Hi Eric,
>
> Thanks for the insight Tim. I ended up killing the the process before
> receiving your email so I was unable to take advantage of your pro tips. We
> subsequently upgraded our cluster to 3.1.0 on Erlang R15B03, and have run
> into a slightly different problem. This appears to be unrelated, but I did
> use your tips to gather as much information as possible.
>
> Scenario:
> A producer is sending messages to rabbit faster than they can be routed so
> the connection goes under flow control. The flow control lasts long enough
> so that our load balancer severs the connection. Before we understood that
> the LB was our problem we would just retry socket write up to 10 times
> before throwing an exception. In the end, our cluster now has 0 connections
> yet it still has nearly 4000 channels (screen grab attached). Also, now I
> am unable to stop_app on any node in the cluster without it hanging for, at
> this point, over an hour.
>
>
> That looks and sounds like a seriously unhappy Rabbit - I'm very
> concerned, especially about those open channels, but it's quite late, so
> I'll need to get into this properly in the morning. For the time being
> though, it looks a lot like something has gone horribly wrong with your
> Erlang installation. What happens if you start up Erlang by itself, using
> `erl -sname test` - do you still see all those screwy warnings? It seems as
> though the emulator's code server is unable to read from the file system -
> this could be due to a change in permissions somewhere on the host's file
> system, *or* it could be that you're running the `erl -sname debug -remsh
> rabbit at rabbit-box` command from a user account with insufficient
> permissions.
>
> Can you run `lsof` and let us know what the hosts use of file descriptors
> looks like please. A Rabbit should never have open channels that aren't
> tied to a connection. It looks to me like your rabbit is stuck either
> starting up or shutting down - that's why the application controller isn't
> responding to calls (or is timing out). In fact, general stats about the
> state of your OS would be really useful - file descriptor usage, current
> disk io, cpu and memory use would all help. If you've got historic data
> about these too, especially around the time of your traffic spike, all the
> better.
>
> It would be *very* helpful if you'd be able to grant us ssh access to this
> machine - we might be able to sign some legal stuff if that helps. Without
> access to the machine, the diagnostic process is going to involve a fair
> bit of to-ing and fro-ing. We could make use of IM/IRC if that helps too.
> Drop me a note and let me know what's likely to work best for you.
>
> To clarify
>
> Questions:
> 1. Should rabbit maintain channels without active connections? If not, has
> anyone run into this before?
>
>
> No, never. I've not seen this one before, but I'll do some archeology in
> our bug tracker and the mailing list to see if there's anything that might
> help.
>
> 2. Is there any way to force kill these channels?
>
>
> We might be able to find a way to do that, but TBH the state your rabbit
> is in, I think it'll need to be killed. BUT PLEASE don't do that. It's
> really important that we understand how your system got into this state,
> because it represents a really nasty bug that we should fix asap, and
> having a running Rabbit in this state represents our best chance at
> understanding what's going on..
>
> 3. Is it a good practice for consumers to connect to rabbit via a load
> balancer, or should that be for producers only? Are there any recommended
> timeout settings?
>
>
> You should be able to use a LB for either kind of client, the choice of
> timeout should be application and infrastructure dependent - i.e., whatever
> makes sense for your use case - and doing so should *not* get you into this
> state, ever. We *will* find out what's gone on here and fix it, asap. The
> *only* caveat here is that, if something catastrophic has gone wrong with
> our host machine (e.g., the file system has bombed out, or something like
> that) then it might be that no application would stand any chance of
> surviving intact, but we need to understand what's gone on here either way.
>
> Cheers,
> Tim
>
> On 16 May 2013, at 20:09, Eric Berg wrote:
>
>
> Here are the results of some commands on the shell to the broker:
>
>
> bash-4.1$ erl -sname debug -remsh rabbit at rabbit-box
> {error_logger,{{2013,5,16},{14,44,36}},std_error,"File operation error:
> eacces. Target: .. Function: read_file_info. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./beam_lib.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./ram_file.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./standard_error.beam. Function: get_file. Process:
> code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./supervisor_bridge.beam. Function: get_file. Process:
> code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./user_sup.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./user_drv.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./group.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./edlin.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./io_lib.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./proplists.beam. Function: get_file. Process:
> code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./io_lib_format.beam. Function: get_file. Process:
> code_server."}
> Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:16:16]
> [async-threads:0] [hipe] [kernel-poll:false]
>
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./net.beam. Function: get_file. Process: code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./inet_gethost_native.beam. Function: get_file. Process:
> code_server."}
> {error_logger,{{2013,5,16},{14,44,37}},std_error,"File operation error:
> eacces. Target: ./kernel_config.beam. Function: get_file. Process:
> code_server."}
>
> =ERROR REPORT==== 16-May-2013::10:44:36 ===
> File operation error: eacces. Target: .. Function: read_file_info.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./beam_lib.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./ram_file.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./standard_error.beam. Function:
> get_file. Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./supervisor_bridge.beam. Function:
> get_file. Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./user_sup.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./user_drv.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./group.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> File operation error: eacces. Target: ./edlin.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::10:44:37 ===
> {lost_messages,6}
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./error_logger_tty_h.beam. Function:
> get_file. Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./calendar.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./io_lib_pretty.beam. Function:
> get_file. Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./io.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./erl_scan.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./c.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./erl_eval.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./orddict.beam. Function: get_file.
> Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./file_io_server.beam. Function:
> get_file. Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./erl_posix_msg.beam. Function:
> get_file. Process: code_server.
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> file:path_eval([".","/var/lib/rabbitmq"],".erlang"): permission denied
>
> =ERROR REPORT==== 16-May-2013::14:44:37 ===
> File operation error: eacces. Target: ./dist_util.beam. Function:
> get_file. Process: code_server.
> Eshell V5.9.3.1  (abort with ^G)
>
>
>
>
> -------------------------------------------------
>
> (rabbit at rabbit-box)1> whereis(rabbit).
> <0.251.0>
>
>
> -------------------------------------------------
>
> (rabbit at rabbit-box)2> application:loaded_applications().
> [{public_key,"Public key infrastructure","0.17"},
>  {rabbitmq_management_agent,"RabbitMQ Management Agent",
>                             "3.1.0"},
>  {os_mon,"CPO  CXC 138 46","2.2.10"},
>  {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
>  {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>  {rabbitmq_shovel,"Data Shovel for RabbitMQ","3.1.0"},
>  {inets,"INETS  CXC 138 49","5.9.2"},
>  {rabbitmq_federation,"RabbitMQ Federation","3.1.0"},
>  {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
>  {rabbitmq_federation_management,"RabbitMQ Federation Management",
>                                  "3.1.0"},
>  {rabbitmq_management_visualiser,"RabbitMQ Visualiser",
>                                  "3.1.0"},
>  {kernel,"ERTS  CXC 138 10","2.15.3"},
>  {crypto,"CRYPTO version 2","2.2"},
>  {ssl,"Erlang/OTP SSL application","5.1.2"},
>  {sasl,"SASL  CXC 138 11","2.2.1"},
>  {rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
>  {mochiweb,"MochiMedia Web Server",
>            "2.3.1-rmq3.1.0-gitd541e9a"},
>  {xmerl,"XML parser","1.3.2"},
>  {rabbit,"RabbitMQ","3.1.0"},
>  {stdlib,"ERTS  CXC 138 10","1.18.3"},
>  {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"}]
>
>
>
> ------------------------------------------------------------------------------------
>
>
> (rabbit at rabbit-box)3> application:which_applications().
> ** exception exit: {timeout,{gen_server,call,
>
> [application_controller,which_applications]}}
>      in function  gen_server:call/2 (gen_server.erl, line 180)
>
>
>
> -----------------------------------------------------------------------------------
>
> (rabbit at rabbit-box)4> rabbit:stop().
>
>
> -- This hangs indefinitely
>
>
>
> ------------------------------------------------------------------------------------
>
> Perms on /var/lib/rabbitmq
> drwxr-xr-x  3 rabbitmq rabbitmq 4096 May  1 07:15 rabbitmq
>
>
>
>
> Thanks Tim et al.
>
>
>
>
> On Thu, May 9, 2013 at 10:00 AM, Tim Watson <tim at rabbitmq.com> wrote:
>
>> Hi,
>>
>> On 8 May 2013, at 18:22, Eric Berg wrote:
>>
>> I have ready through many of these nodedown error emails and of course
>> none of them seem to be exactly what I am experiencing.
>>
>> I have a 4 node cluster, and one of the nodes went offline according to
>> the cluster. This box has the following in the sasl log:
>>
>> =SUPERVISOR REPORT==== 7-May-2013::14:37:22 ===
>>      Supervisor: {<0.11197.1096>,
>>                                            rabbit_channel_sup_sup}
>>      Context:    shutdown_error
>>      Reason:     noproc
>>      Offender:   [{pid,<0.11199.1096>},
>>                   {name,channel_sup},
>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>                   {restart_type,temporary},
>>                   {shutdown,infinity},
>>                   {child_type,supervisor}]
>>
>>
>> This simply indicates that and error occurred whilst a supervised process
>> was shutting down. It's not indicative of the whole node going down -
>> Erlang allows processes to crash and be restarted whilst the system is
>> running.
>>
>> *Yet in the regular rabbit log i can see that it was still accepting
>> connections up until 2:22AM the next day:*
>>
>> (last log entry)
>> =INFO REPORT==== 8-May-2013::02:22:26 ===
>> closing AMQP connection <0.18267.1145> (IPADDRESS:PORT -> IPADDRESS:PORT)
>>
>>
>> So clearly that node didn't actually go offline. The 'nodedown' message
>> in the other clustered broker's logs does not necessarily mean that the
>> node in question crashed; This could, for example, be indicative of a
>> net-split or other connectivity failure.
>>
>> *Running rabbitmqctl status returns:*
>>
>> [root at rabbit-box rabbitmq]# rabbitmqctl status
>> Status of node 'rabbit at rabbit-box' ...
>> Error: unable to connect to node 'rabbit at rabbit-box': nodedown
>>
>> DIAGNOSTICS
>> ===========
>>
>> nodes in question: ['rabbit at rabbit-box']
>>
>> hosts, their running nodes and ports:
>> - rabbit-box: [{rabbit,13957},{rabbitmqctl2301,16508}]
>>
>> current node details:
>> - node name: 'rabbitmqctl2301 at rabbit-box'
>> - home dir: /var/lib/rabbitmq
>> - cookie hash: qQwyFW90ZNbbrFvX1AtrxQ==
>>
>>
>> Have you tried running this using `sudo' instead of as root? Is the
>> rabbitmq user's account and home folder in a consistent state? The security
>> cookie used for inter-node communications, which includes communication
>> between the temporary `rabbitmqctl' node and the broker, has to be the same
>> for all the peers.
>>
>> A couple of notes:
>> - Looking for a process run by rabbit show that it appears to still be
>> running
>>
>>
>> Yes - as I said, there's no indication that this node actually died from
>> what you've said. However `rabbitmqctl` should be able to connect to
>> rabbit at rabbit-box at the very least.
>>
>> - Erlang cookie is the same on all nodes of the cluster, the cookie hash
>> is the same as well
>>
>>
>> If it's not the cookies then....
>>
>> - A traffic spike occurred right around the time of the last entry in the
>> rabbit log
>>
>>
>> It sounds like this could be a potential culprit. Can you provide any
>> more information about what happened? It could be that whilst the network
>> was saturated, the node in question got disconnected from the other nodes
>> in the cluster because it exceeded the "net tick time" and subsequently
>> things have started to go wrong. That shouldn't happen, viz the node should
>> be able to re-establish connectivity, but it's possible that something's
>> gone wrong here.
>>
>> What that doesn't explain is why you can't connect from rabbitmqctl. If
>> you `su rabbitmq', can you then run `erl -sname debug -remsh
>> rabbit at rabbit-box' to establish a shell into the running broker? If that
>> does work, then you can stop the rabbit application and then the node, as
>> follows:
>>
>> > rabbit:stop().
>> ok
>> > init:stop().
>>
>> But before you do, it might be worth evaluating a couple of other things
>> that might help us identify what's going on:
>>
>> (rabbit at iske)1> whereis(rabbit).
>> <0.152.0>
>> (rabbit at iske)2> application:loaded_applications().
>> [{os_mon,"CPO  CXC 138 46","2.2.9"},
>>  {rabbitmq_management_agent,"RabbitMQ Management Agent",
>>                             "0.0.0"},
>>  {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
>>  etc ...
>>  ]
>> (rabbit at iske)3> application:which_applications().
>> [{rabbitmq_shovel_management,"Shovel Status","0.0.0"},
>>  etc ...
>> ]
>>
>> If during any of these you get stuck, CTRL-C (and press the key for
>> 'abort') should get you back out again without incident.
>>
>>
>> - I can find no other errors in any logs that relate to rabbit or erlang
>> - Up until this point the cluster has been running fine for over 40 days.
>>
>> - telnet IP_ADDRESS 5672 times out
>>
>>
>> So the broker is no longer accepting new AMQP connections then.
>> Something's clearly quite wrong with this node.
>>
>> - I have not restarted the box, erlang node, or entire rabbitmq-server
>>
>> Is there anywhere else I can go looking for errors? I am about to start
>> killing processs, but Im not sure that will solve anything.
>>
>>
>> Did you do that in the end? If not, I would really like to get to the
>> bottom of what's wrong with this node. I don't suppose it would be possible
>> for you to give us access to this machine would it? If necessary, we may be
>> able to get some kind of confidentiality agreement signed if that'd help.
>>
>> Cheers,
>>
>> Tim Watson
>> Staff Engineer
>> RabbitMQ
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> <rabbit-manychannels.png>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/4d3e8a0a/attachment.htm>

From sabrina.kuehn90 at web.de  Fri May 17 13:52:22 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Fri, 17 May 2013 05:52:22 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1368789056843-26798.post@n5.nabble.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
Message-ID: <1368795142708-26800.post@n5.nabble.com>

Ok I spoke with my boss and now I have a little bit more informations:
<http://rabbitmq.1065348.n5.nabble.com/file/n26800/Grafic.png> 
He want a cluster eg 3 machines to exchange queues, exchanges...
informations. They are connected to the internet wire ldirector because they
have only one IP address in the moment.
The first machine should be the "master". On this one are all queues and so
on created and this is the one who is connected to the AMQP server and
perhaps some other services. Therefore this machine has to be safed by a
mirror (one or better two machines).

Is that a possible scenario? 
If it is, I would creat a cluster with 3 machines. And on the first I would
create queues with configurations we need. Then I would create on all tree
machines scripts for sending and receiving messages from the queues. And
then at least I have to create a policy for the mirror. By this step I'm
uncertain. Do I only need to create a policy with mode node and params 1a
und a pattern which contains all queue which are created on the first
machine? Or am I wrong? (I hope not with my hole explanation :) )



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26800.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Fri May 17 14:32:52 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 17 May 2013 14:32:52 +0100
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <CACeek7Hxt4Pg5nb1YwJQvDCSSEXsRh44PnWiQQ3yog+1RPd1Mw@mail.gmail.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
	<9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
	<CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
	<EBF95E66-C42B-40D7-85DB-A7E21C436454@rabbitmq.com>
	<C7E8BA08-B835-46FA-8A56-762622AE90C1@rabbitmq.com>
	<CACeek7Hxt4Pg5nb1YwJQvDCSSEXsRh44PnWiQQ3yog+1RPd1Mw@mail.gmail.com>
Message-ID: <E788DD53-008F-4BDE-8863-891EA94FB07D@rabbitmq.com>

Hmn

On 17 May 2013, at 13:45, Eric Berg wrote:

> Thanks for your response Tim. If you would like SSH access to these boxes let me know, we can work something out privately. Thanks!
> 

Ok, though first of all I'd like to know if you supply logs for the nodes in question? A private drop box would be fine.

> Update from yesterday:
> It looks like 2 of the 4 nodes in our cluster have finally shut down, all channels are now gone. Another node in the cluster hangs on
> > sudo rabbitmqctl status
> 
> and the final node in the cluster appears to be running just fine. It however sees the unresponsive node in the cluster status as a running node, as does the web UI.
> 

Right, so we've still got an unresponsive node. Do you have any mirrored queues, and if so, what synchronisation and/or recovery policies are you using?

> 
> When you upgraded your cluster, what RabbitMQ version did you upgrade from and to, and did you upgrade Erlang as well and if so, which versions were involved?
> - we upgraded from 3.0.4 to 3.1.0, we did not upgrade Erlang it was/is at version R15B03. We did however install it via RPM with the --nodeps flag because it did not detect the Erlang dependency correctly. We had previously installed Erlang:
> 
> esl-erlang.x86_64    R15B03-2           @erlang-solutions 
> 

Hmn, I suppose it's possible that this re-install went wrong somehow and is causing some of the things below.

> 
> What happens if you start up Erlang by itself, using `erl -sname test` - do you still see all those screwy warnings? 
> All 4 of the nodes can run this without issue as my user, when I sudo su to rabbitmq user I get errors on 2 of the 4 nodes as such:
> 

Well the nodes should always be running as the rabbitmq user, so how're you starting them as your user? That might be at the root of some of these problems, viz the rabbitmq-server (service) should always run as the rabbitmq user and when issuing rabbitmqctl commands and the like, you would normally do `$ sudo rabbitmqctl status` and so on. Log files would definitely help though.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/162874d0/attachment.htm>

From tim at rabbitmq.com  Fri May 17 14:55:13 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 17 May 2013 14:55:13 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1368795142708-26800.post@n5.nabble.com>
References: <1368439599833-26611.post@n5.nabble.com>
	<5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
Message-ID: <39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>

Hi,

On 17 May 2013, at 13:52, Slyth wrote:
> The first machine should be the "master". 

RabbitMQ has no concept of a master node. When queues are mirrored across multiple nodes, one of the nodes is chosen to be the "queue master" for a mirrored queue, but that node can freely die and one of the queue slaves will take over (as the master) on another node. The master node for one queue, might not be master for another queue. Not all queues have to be mirrored.

> On this one are all queues and so
> on created and this is the one who is connected to the AMQP server and
> perhaps some other services.

RabbitMQ *is* the AMQP server, so what do you mean "the one who is connected to the AMQP server" exactly? I'm really struggling to understand what you're trying to do.

> Therefore this machine has to be safed by a
> mirror (one or better two machines).


Well clustering two RabbitMQ servers will not mirror a whole machine. If you enable HA/mirror mode, then it will mirror "the contents of some queues", where 'some queues' means any queue matching the policy.

> Is that a possible scenario? 

It is still very unclear what you are trying to achieve. I do apologise if that's due to the language barrier. I'd really like to be able to help more, but I'm still struggling to understand the basic requirements. The picture you've sent over shows 1 node acting as a mirror for a cluster. That's not how active/mirror queues work at, nor does it represent a resilient architecture, which I'm guessing is what your boss is trying to achieve.

> If it is, I would creat a cluster with 3 machines. And on the first I would
> create queues with configurations we need. Then I would create on all tree
> machines scripts for sending and receiving messages from the queues.
[snip]
> And
> then at least I have to create a policy for the mirror.

I have no idea what your trying to do here. Why do you need to create scripts for sending messages around a cluster?

> By this step I'm uncertain.

You're not the only one. I have absolutely *no idea* what you're trying to achieve. I have this suspicion that the requirement your boss has given you is to replicate application data across multiple machines, using a message broker (like RabbitMQ) as the communications fabric. But that might not be it. You might be trying to design a messaging application and your boss wants to design it to avoid message loss. It's really not clear what the fundamental purpose is here. Where does the data come from? What are you trying to do with the data? What other applications are involved? Where does RabbitMQ (or any other messaging product) fit in to this?

What is very clear is that you're struggling with messaging concepts in general, as well as understanding clustering and HA. I would *very* strongly suggest that you consider contacting info at rabbitmq.com and discussing the possibility of getting a regional PSO representative on the phone, to talk about your requirements and whether or not the company you're working for would benefit from some short term consultancy. If you're after a messaging broker, then it's very likely indeed that RabbitMQ would be ideal for your needs, but I'm not sure I can offer any more help unless you're able to articulate the problem in way I can understand. 

Regards,
Tim Watson




From francois at teksol.info  Fri May 17 16:03:09 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Fri, 17 May 2013 11:03:09 -0400
Subject: [rabbitmq-discuss] 700k msgs using 6.3 GiB?
In-Reply-To: <519490BE.60507@rabbitmq.com>
References: <9C056A40-C6D5-470F-B3BB-FD32E2CC059E@teksol.info>
	<51944813.4040803@rabbitmq.com>
	<00FF009B-EF5E-40A0-9169-6C2CE14E4BC5@teksol.info>
	<519490BE.60507@rabbitmq.com>
Message-ID: <5D1BE82E-5AB3-4CA4-9E98-25A0E71973D9@teksol.info>

Hello Matthias,

Le 2013-05-16 ? 03:54, Matthias Radestock a ?crit :

> Garbage collectors generally don't collect garbage instantly.
> 
> However, pretty much all garbage should get collected when the system is idle. In particular, when there is no activity on a queue, or any other Erlang processes in the message processing pipeline, for a while then these processes are supposed to hibernate, which entails reclaiming all garbage.

Can you define "a while"? I have constant new interactions that come in. I can't really stop that to let garbage be collected.

> That may not be happening in your system, i.e. either something is preventing idling, or processes don't hibernate despite being idle.
> 
> But to investigate that further we really need you on the latest versions of rabbit and erlang.

If we could have clusters on different minor versions, it would already be a help. I'd boot a 3.1.0, cluster with 3.0.2, wait until the queues are synchronized, then shutdown 3.0.2. Not expecting that until a while, but that would really help with upgrades. RabbitMQ is the central nervous system in my application. Shutting it down means I lose all senses.

Bye,
Fran?ois
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/ac5a06db/attachment.bin>

From eric.berg at pardot.com  Fri May 17 16:05:27 2013
From: eric.berg at pardot.com (Eric Berg)
Date: Fri, 17 May 2013 11:05:27 -0400
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <E788DD53-008F-4BDE-8863-891EA94FB07D@rabbitmq.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
	<9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
	<CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
	<EBF95E66-C42B-40D7-85DB-A7E21C436454@rabbitmq.com>
	<C7E8BA08-B835-46FA-8A56-762622AE90C1@rabbitmq.com>
	<CACeek7Hxt4Pg5nb1YwJQvDCSSEXsRh44PnWiQQ3yog+1RPd1Mw@mail.gmail.com>
	<E788DD53-008F-4BDE-8863-891EA94FB07D@rabbitmq.com>
Message-ID: <CACeek7HJG_XxC+WB=wm=BUK5oD050JBwxPgU9yyZLJuFwRM8Jg@mail.gmail.com>

Thanks Tim, I will send you a link to the log files privately. We do have
mirrored queues, we setup an HA policy to mirror all queues to exactly 2
nodes of the 4, as of yet we have not made use of any synchronization
policy.

We start all rabbit nodes via:

sudo /etc/init.d/rabbit-server start

We do have chef managing this server and has since caused a restart on 2 of
our 4 nodes, it is now temporarily disabled. I will send you the log files
for all 4 nodes dating back several days. One thing I did notice in the log
file for 3 of the 4 nodes:

=ERROR REPORT==== 16-May-2013::23:27:20 ===
connection <0.25853.253>, channel 1 - soft error:
{amqp_error,not_found,
            "home node 'rabbit at rabbit-box' of durable queue 'my.queue.name'
in vhost '/' is down or inaccessible",
            'queue.declare'}


When looking at the log files you will notice many entries like:

=INFO REPORT==== 17-May-2013::09:15:42 ===
accepting AMQP connection <0.5117.0> (IP:55913 -> IP:5672)

=WARNING REPORT==== 17-May-2013::09:15:42 ===
closing AMQP connection <0.5117.0> (IP:55913 -> IP:5672):
connection_closed_abruptly

Those are our load balancers checking the node health, sorry for the log
spam.







On Fri, May 17, 2013 at 9:32 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hmn
>
> On 17 May 2013, at 13:45, Eric Berg wrote:
>
> Thanks for your response Tim. If you would like SSH access to these boxes
> let me know, we can work something out privately. Thanks!
>
>
> Ok, though first of all I'd like to know if you supply logs for the nodes
> in question? A private drop box would be fine.
>
> Update from yesterday:
> It looks like 2 of the 4 nodes in our cluster have finally shut down, all
> channels are now gone. Another node in the cluster hangs on
> > sudo rabbitmqctl status
>
> and the final node in the cluster appears to be running just fine. It
> however sees the unresponsive node in the cluster status as a running node,
> as does the web UI.
>
>
> Right, so we've still got an unresponsive node. Do you have any mirrored
> queues, and if so, what synchronisation and/or recovery policies are you
> using?
>
>
> *When you upgraded your cluster, what RabbitMQ version did you upgrade
> from and to, and did you upgrade Erlang as well and if so, which versions
> were involved?
> *
> - we upgraded from 3.0.4 to 3.1.0, we did not upgrade Erlang it was/is at
> version R15B03. We did however install it via RPM with the --nodeps flag
> because it did not detect the Erlang dependency correctly. We had
> previously installed Erlang:
>
> esl-erlang.x86_64    R15B03-2           @erlang-solutions
>
>
> Hmn, I suppose it's possible that this re-install went wrong somehow and
> is causing some of the things below.
>
> *
> What happens if you start up Erlang by itself, using `erl -sname test` -
> do you still see all those screwy warnings? *
> All 4 of the nodes can run this without issue as my user, when I sudo su
> to rabbitmq user I get errors on 2 of the 4 nodes as such:
>
>
> Well the nodes should always be running as the rabbitmq user, so how're
> you starting them as your user? That might be at the root of some of these
> problems, viz the rabbitmq-server (service) should always run as the
> rabbitmq user and when issuing rabbitmqctl commands and the like, you would
> normally do `$ sudo rabbitmqctl status` and so on. Log files would
> definitely help though.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/f28c8485/attachment.htm>

From kgoess at bepress.com  Fri May 17 16:38:01 2013
From: kgoess at bepress.com (Kevin Goess)
Date: Fri, 17 May 2013 08:38:01 -0700
Subject: [rabbitmq-discuss] new queue causes extremely poor disk IO
Message-ID: <CABZkbxja=AhfCUqcpttSU9zeRZr0SMzTQSrdYtffPGttVASQTA@mail.gmail.com>

Hi, we were hoping to get some pointers in looking into this problem.
 We're running rabbitmq 2.7.1-1 in a xen VM on debian 6 squeeze.

We generally process about 20 messages/sec, with occasional transient
spikes to 500.

We recently added a new queue and saw the disk utilization jump to 60-80%
and the iowait  to 40-60%. Read sectors/sec is around 0, and write
sectors/sec is about 1k, which is unchanged from before adding this new
queue.

The input and output on this new queue is only 1-10 per second.  The
messages in it are only 60-70 bytes.  We currently have a backlog of about
100,000 messages in the queue, we maxed out at 250,000.

The individual consumers of this new queue don't fetch that many
messages--the work they're associated with takes 1-30 seconds to perform.
 We're using STOMP as a message transport.

The problem is that every consumer we add to the queue seems to increase
disk activity by about 10%, and by the time we have 8 consumers, the
rabbitmq server is overloaded enough that other queues start falling behind
in their deliveries.

If we shut off all the consumers on the new queue, disk activity
immediately falls to easily sustainable levels (near zero iowait).

Is there anything we can look at to get further information on the problem?
 Any pointers you have would be helpful.  Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/046619ae/attachment.htm>

From csharp4me at gmail.com  Fri May 17 20:29:48 2013
From: csharp4me at gmail.com (Dave Gorman)
Date: Fri, 17 May 2013 14:29:48 -0500
Subject: [rabbitmq-discuss] 2.8.1 crash on Win2008
Message-ID: <CAEg60=rT_db=Wy+hwFpm9K-j-rW1v_k+ck-OE5Z2sFBd=jkakA@mail.gmail.com>

I had a vendor's rabbitmq instance just crash on me, wondering if I could
get some help understanding why from the experts...

Windows 2008 with Rabbit 2.8.1 I got a crash dump had:
Slogan: Kernel pid terminated (application_controller)
({application_terminated,rabbit,shutdown})
System version: Erlang R15B01 (erts-5.9.1) [64-bit] [smp:4:4]
[async-threads:30]
...
=proc:<0.3.0>
State: Waiting
Name: erl_prim_loader
Spawned as: erlang:apply/2
Spawned by: <0.2.0>
Started: Sat Apr 06 12:32:28 2013
Message queue length: 0
Number of heap fragments: 0
Heap fragment data: 0
Link list: [<0.0.0>, #Port<0.1>]
Reductions: 1385542
Stack+heap: 6765
OldHeap: 17711
Heap unused: 1985
OldHeap unused: 10676
Program counter: 0x0000000000fd2d20 (erl_prim_loader:loop/3 + 176)
CP: 0x0000000000000000 (invalid)
arity = 0
=proc:<0.6.0>
State: Waiting
Name: error_logger
Spawned as: proc_lib:init_p/5
Spawned by: <0.2.0>
Started: Sat Apr 06 12:32:28 2013
Message queue length: 0
Number of heap fragments: 0
Heap fragment data: 0
Link list: [<0.0.0>]
Reductions: 667825443
Stack+heap: 6419485
OldHeap: 47828850
Heap unused: 2612692
OldHeap unused: 35671810
Program counter: 0x0000000004ddeb00 (gen_event:fetch_msg/5 + 72)
CP: 0x0000000000000000 (invalid)
arity = 0
...
2EFD1C8:lI110|N
7619550:t9:A5:state,A5:efile,N,A4:none,p<0.1>,A8:infinity,A9:undefined,A4:true,H2EF92E0
2EF92E0:t4:AA:prim_state,A5:false,A9:undefined,A9:undefined
=proc_dictionary:<0.6.0>
H52180A50
H51D06CD0
H51D00578
H51D00590
=proc_stack:<0.6.0>
0x00000000123ca118:SReturn addr 0x4DF35D8 (proc_lib:init_p_do_apply/3 + 56)
y0:A5:false
y1:N
y2:H10FDB290
y3:AC:error_logger
y4:P<0.2.0>
0x00000000123ca148:SReturn addr 0xF4814688 (<terminate process normally>)
y0:SCatch 0x4DF35F8 (proc_lib:init_p_do_apply/3 + 88)
=proc_heap:<0.6.0>
10FDB290:lH10FDB138|H10FDB268
10FDB138:t5:A7:handler,A19:rabbit_sasl_report_file_h,A5:false,H10FD8688,A5:false
10FD8688:t3:P<0.36.0>,H51D00A70,A5:error

Any advice?

thanks!
Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/5d5d633c/attachment.htm>

From MaslinskiR at valassis.com  Fri May 17 20:38:05 2013
From: MaslinskiR at valassis.com (Maslinski, Ray)
Date: Fri, 17 May 2013 19:38:05 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
Message-ID: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>

Hello,

I've been experimenting with the new autoheal mode for handling cluster partitions and automatic synchronization for mirrored queues using servers hosted at Amazon EC2.  My test setup is a two node cluster, with queue policy set to ha-mode=all and ha-sync-mode=automatic.  The servers are also configured with cluster_partition_handling set to autoheal, and sit behind an ELB for client access.  The rest of the configuration is essentially the same as describe here http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/ with the main exception being that both of the RabbitMQ servers are in the same availability zone.  The servers are hosted on m1.small instances running Ubuntu Linux 12.04.2 LTS.

The client load is being generated from JMeter using a tunable number of client threads to send and receive messages at a steady rate to a mirrored queue.  With the load balancer in place, the tests are run with enough threads to ensure that both servers have active connections for both sending and receiving.  The test sequence verifies that all message sent without encountering an error are also received.

To simulate a network partition failure, I've been using iptables to temporarily block inbound and outbound access on one of the nodes to the single port configured for cluster communications through inet_dist_listen_min and inet_dist_listen_max settings (min = max).  Client access is not blocked during a simulated partition fault.

I've observed two anomalies during testing that I wasn't expecting based on the documentation I've read:


-          At a sufficiently high message rate, some number of messages will be lost during the fault sequence, with the number lost tending to increase with message rate.  No indication of a send error has been observed by the client program.  Based on results obtained from test logs and an independent monitor listening on trace messages from each node, it appears that as soon as the port is blocked, both nodes continue to accept published messages, but (temporarily) stop delivering messages until the cluster heartbeat failure is detected, at which point the cluster is partitioned and the slave promotes itself to become master.  In the sequences I've looked at, the messages that are lost all appear to be published to the original master (and final master after a winner is selected during autoheal).  Neither the start nor the end of the lost message window appear to line up with any events in the logs, other than the start occurring sometime after the port connection is blocked but before the cluster heartbeat failure is detected, and the end occurring sometime after the detection of the cluster heartbeat failure and before the detection of the partitioned cluster after the connection is unblocked.  Is message loss to be expected in this scenario?

-          Occasionally the autoheal loser node fails to rejoin the cluster after restart.  I don't have a lot of data points on this one since it's only happened a handful of times during overnight test iterations.  During one failure, the autoheal winner showed the log message below during recovery:


=ERROR REPORT==== 17-May-2013::02:40:36 ===
Mnesia('rabbit at oemsg-new-27b1524f'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at oemsg-new-29b15241'}

=INFO REPORT==== 17-May-2013::02:40:36 ===
Autoheal request received from 'rabbit at oemsg-new-29b15241'

=ERROR REPORT==== 17-May-2013::02:40:36 ===
** Generic server rabbit_node_monitor terminating
** Last message in was {autoheal_msg,
                           {request_start,'rabbit at oemsg-new-27b1524f'}}
** When Server state == {state,
                            {dict,1,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],
                                  [[{rabbit,'rabbit at oemsg-new-29b15241'}|
                                    #Ref<0.0.65.255337>]],
                                  [],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                            ['rabbit at oemsg-new-29b15241'],
                            {dict,1,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],
                                  [[<0.20953.18>|#Ref<0.0.65.232752>]],
                                  [],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                            undefined,
                            {winner_waiting,
                                ['rabbit at oemsg-new-29b15241'],
                                ['rabbit at oemsg-new-29b15241']}}
** Reason for termination ==
** {function_clause,
       [{rabbit_autoheal,handle_msg,
            [{request_start,'rabbit at oemsg-new-27b1524f'},
             {winner_waiting,
                 ['rabbit at oemsg-new-29b15241'],
                 ['rabbit at oemsg-new-29b15241']},
             ['rabbit at oemsg-new-29b15241']]},
        {rabbit_node_monitor,handle_info,2},
        {gen_server,handle_msg,5},
        {proc_lib,init_p_do_apply,3}]}

=INFO REPORT==== 17-May-2013::02:40:36 ===
Autoheal decision
  * Partitions: [['rabbit at oemsg-new-29b15241'],['rabbit at oemsg-new-27b1524f']]
  * Winner:     'rabbit at oemsg-new-27b1524f'
  * Losers:     ['rabbit at oemsg-new-29b15241']

=INFO REPORT==== 17-May-2013::02:40:36 ===
Autoheal request sent to 'rabbit at oemsg-new-27b1524f'

=INFO REPORT==== 17-May-2013::02:40:36 ===
Autoheal: I am the winner, waiting for ['rabbit at oemsg-new-29b15241'] to stop

However,  I've also seen at least one other instance where the message about the node monitor terminating appeared but did not coincide with an autoheal failure.  Comparing the two occurrences shows a somewhat different log sequence around server shutdown and startup:

No autoheal failure:

=WARNING REPORT==== 17-May-2013::01:58:36 ===
Non-AMQP exit reason 'shutdown'

=ERROR REPORT==== 17-May-2013::01:58:36 ===
Mnesia('rabbit at oemsg-new-29b15241'): ** ERROR ** mnesia_event got {inconsistent_database, starting_partitioned_network, 'rabbit at oemsg-new-27b1524f'}

=INFO REPORT==== 17-May-2013::01:58:36 ===
Starting RabbitMQ 3.1.0 on Erlang R14B04
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

Autoheal failure:

=WARNING REPORT==== 17-May-2013::02:40:36 ===
Non-AMQP exit reason 'shutdown'

=INFO REPORT==== 17-May-2013::02:44:51 ===
Starting RabbitMQ 3.1.0 on Erlang R14B04
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

Note that rabbitmq-server is started through an upstart job which attempts to respawn, so the long delay between shutdown and startup message may be related to multiple restart attempts of the process (nothing of interest in the startup/shutdown logs).

Any ideas around possible causes of this autoheal failure?

Ray Maslinski
Senior Software Developer, Engineering
Valassis / Digital Media
Cell: 585.330.2426
maslinskir at valassis.com
www.valassis.com<http://www.valassis.com/>

Creating the future of intelligent media delivery to drive your greatest success

_____________________________________________________________________________

This message may include proprietary or protected information. If you are not the intended
recipient, please notify me, delete this message and do not further communicate the information
contained herein without my express consent.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/ef7df685/attachment.htm>

From tim at rabbitmq.com  Fri May 17 20:38:11 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 17 May 2013 20:38:11 +0100
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <CACeek7HJG_XxC+WB=wm=BUK5oD050JBwxPgU9yyZLJuFwRM8Jg@mail.gmail.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
	<9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
	<CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
	<EBF95E66-C42B-40D7-85DB-A7E21C436454@rabbitmq.com>
	<C7E8BA08-B835-46FA-8A56-762622AE90C1@rabbitmq.com>
	<CACeek7Hxt4Pg5nb1YwJQvDCSSEXsRh44PnWiQQ3yog+1RPd1Mw@mail.gmail.com>
	<E788DD53-008F-4BDE-8863-891EA94FB07D@rabbitmq.com>
	<CACeek7HJG_XxC+WB=wm=BUK5oD050JBwxPgU9yyZLJuFwRM8Jg@mail.gmail.com>
Message-ID: <804BD8A7-02DD-4FAE-8074-821EEF4B65B4@rabbitmq.com>

Eric,

On 17 May 2013, at 16:05, Eric Berg wrote:
> We start all rabbit nodes via:
> 
> sudo /etc/init.d/rabbit-server start
> 

Ah. I've had problems on CentOS when doing that - it screwed up my permissions completely and I couldn't subsequently run the server. Re-installing and using `/sbin/service start rabbitmq-server` instead did the trick.  You're not on a redhat variant are you?

> We do have chef managing this server and has since caused a restart on 2 of our 4 nodes, it is now temporarily disabled.

That could cause a number of problems, especially if nodes are clustered, there is a netsplit and chef restarts them in the wrong order - though they should just fail to start, rather than melt down your data centre. :)

> I will send you the log files for all 4 nodes dating back several days.

Cool thanks. I'll spend some time looking through those.

> One thing I did notice in the log file for 3 of the 4 nodes:
> 
> =ERROR REPORT==== 16-May-2013::23:27:20 ===
> connection <0.25853.253>, channel 1 - soft error:
> {amqp_error,not_found,
>             "home node 'rabbit at rabbit-box' of durable queue 'my.queue.name' in vhost '/' is down or inaccessible",
>             'queue.declare'}
> 

Ah ok, that's probably nothing to worry about, though it may help with diagnosis.

> 
> When looking at the log files you will notice many entries like:
> 
> =INFO REPORT==== 17-May-2013::09:15:42 ===
> accepting AMQP connection <0.5117.0> (IP:55913 -> IP:5672)
> 
> =WARNING REPORT==== 17-May-2013::09:15:42 ===
> closing AMQP connection <0.5117.0> (IP:55913 -> IP:5672):
> connection_closed_abruptly
> 
> Those are our load balancers checking the node health, sorry for the log spam.
> 

Ok sure - I'll filter those out. :)

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/e1c8ebb5/attachment.htm>

From tim at rabbitmq.com  Fri May 17 20:45:38 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 17 May 2013 20:45:38 +0100
Subject: [rabbitmq-discuss] new queue causes extremely poor disk IO
In-Reply-To: <CABZkbxja=AhfCUqcpttSU9zeRZr0SMzTQSrdYtffPGttVASQTA@mail.gmail.com>
References: <CABZkbxja=AhfCUqcpttSU9zeRZr0SMzTQSrdYtffPGttVASQTA@mail.gmail.com>
Message-ID: <C6A2C7E0-77F6-4C31-A716-B3794D0052AA@rabbitmq.com>

Hi Kevin,

There have been innumerable bug fixes and performance improvements to rabbit since 2.7.1 - is upgrading a possibility?

Cheers,
Tim

On 17 May 2013, at 16:38, Kevin Goess wrote:

> Hi, we were hoping to get some pointers in looking into this problem.  We're running rabbitmq 2.7.1-1 in a xen VM on debian 6 squeeze.
> 
> We generally process about 20 messages/sec, with occasional transient spikes to 500.
> 
> We recently added a new queue and saw the disk utilization jump to 60-80% and the iowait  to 40-60%. Read sectors/sec is around 0, and write sectors/sec is about 1k, which is unchanged from before adding this new queue.
> 
> The input and output on this new queue is only 1-10 per second.  The messages in it are only 60-70 bytes.  We currently have a backlog of about 100,000 messages in the queue, we maxed out at 250,000.
> 
> The individual consumers of this new queue don't fetch that many messages--the work they're associated with takes 1-30 seconds to perform.  We're using STOMP as a message transport.
> 
> The problem is that every consumer we add to the queue seems to increase disk activity by about 10%, and by the time we have 8 consumers, the rabbitmq server is overloaded enough that other queues start falling behind in their deliveries.  
> 
> If we shut off all the consumers on the new queue, disk activity immediately falls to easily sustainable levels (near zero iowait).
> 
> Is there anything we can look at to get further information on the problem?  Any pointers you have would be helpful.  Thanks!
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From MaslinskiR at valassis.com  Fri May 17 21:03:36 2013
From: MaslinskiR at valassis.com (Maslinski, Ray)
Date: Fri, 17 May 2013 20:03:36 +0000
Subject: [rabbitmq-discuss] Amazon EC2 spurious cluster timeouts
Message-ID: <7F7BFE76D0F5234F9258D88C37C9EC6B151C3302@VALVCSMBX001PH.val.vlss.local>

Hello,

I've been working with several two node clusters running various versions of 3.0.x, hosted on m1.small instances on Ubuntu 12.04.2 LTS in EC2.  The setup is essentially as described here http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/ with the main exception being that both of the RabbitMQ servers are in the same availability zone.  A while back I observed a half dozen or so occurrences over the course of a week where the clusters would become partitioned, accompanied by a messages on each server such as:

=ERROR REPORT==== 17-May-2013::01:56:45 ===
** Node 'rabbit at oemsg-new-29b15241' not responding **
** Removing (timedout) connection **

=INFO REPORT==== 17-May-2013::01:56:45 ===
rabbit on node 'rabbit at oemsg-new-29b15241' down

Looking over the logs and EC2 metrics, I wasn't able to identify any other anomalies that coincided with these failures.  In particular, the load balancers in front of the cluster nodes did not report any health check failures connecting to the amqp port (on a 30 second interval), suggesting that network connectivity was otherwise healthy, and there didn't appear to be any unexpected spikes in resource consumption (such as excessive cpu/disk/network activity).  The rabbit servers were fairly lightly loaded with messaging traffic at the time, and running some load tests against the same servers afterwards didn't induce any further failures over the course of several days.  I tried increasing the net_ticktime to something like 5 or 10 minutes, but still observed a failure with the new value.

I left several clusters running over an extended period, most with little or no load, with one cluster running under an extended load test.  Several of the clusters experienced no failures over the course of a couple of months, while others became partitioned after a while (though they seemed to survive for at least a few weeks before partition).

Anyone experience anything similar in EC2, or have any ideas what else might be done to diagnose what's going on?

Ray Maslinski
Senior Software Developer, Engineering
Valassis / Digital Media
Cell: 585.330.2426
maslinskir at valassis.com
www.valassis.com<http://www.valassis.com/>

Creating the future of intelligent media delivery to drive your greatest success

_____________________________________________________________________________

This message may include proprietary or protected information. If you are not the intended
recipient, please notify me, delete this message and do not further communicate the information
contained herein without my express consent.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/5e89b817/attachment.htm>

From orengolan at gmail.com  Sat May 18 01:51:33 2013
From: orengolan at gmail.com (josh)
Date: Fri, 17 May 2013 17:51:33 -0700 (PDT)
Subject: [rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
In-Reply-To: <CABWW-1Wa=74vUQ03U6Q6KKr9+-wWewdKvbwdw6pmBKe1iAqRKw@mail.gmail.com>
References: <20a63230-f928-4376-b1d8-bf8b09afd02b@googlegroups.com>
	<51877334.4060303@rabbitmq.com>
	<CABWW-1Wa=74vUQ03U6Q6KKr9+-wWewdKvbwdw6pmBKe1iAqRKw@mail.gmail.com>
Message-ID: <1368838293073-26811.post@n5.nabble.com>

Thanks Matthias and Calvin, I solved it thanks to you guys.

I made 2 changes:
instead of queue.shift() I use message.acknowledge(false)
I changed  prefetchCount: 0 to 100.

Now it's working as expected. I have made another change, instead of
connection.publish I use exchange.publish but this is not related to the
issue I have. I just feels it's better to use the exchange.
Here is the working code, for anyone else using node-amqp:

var amqp = require('amqp');

var connection = null;
var exchange = null;

connection = amqp.createConnection({ host: 'foo.com' });

connection.on('ready', function () {
  exchange = connection.exchange('main', {type: 'topic', durable: 'true',
autodelete: 'false'}, function (exchange) {
    console.log('Exchange ' + exchange.name + ' is open');
    listen();
  });
});

function listen() {
  connection.queue('queue-a', { durable: true, autoDelete: false},
function(q) {
    q.bind('main', 'queue-a');
    q.subscribe({ack:true, prefetchCount: 100}, function (payload, headers,
deliveryInfo, message) {
      console.log(payload);
      setTimeout(function() { 
        exchange.publish('routing.key.for.some.queue', payload, {
deliveryMode: 2 });
        message.acknowledge(false);
      }, 100);
    });
  });
};




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RECONDITION-FAILED-unknown-delivery-tag-tp26442p26811.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From kgoess at bepress.com  Sat May 18 02:26:06 2013
From: kgoess at bepress.com (Kevin Goess)
Date: Fri, 17 May 2013 18:26:06 -0700
Subject: [rabbitmq-discuss] new queue causes extremely poor disk IO
Message-ID: <CABZkbxiU3W_2oDqE3nouedXkWzSq8Yf8-Y4Sw1vQ=x00khMLPg@mail.gmail.com>

We could try that. Is an upgrade between 2.7.1 expected to be transparent?
 The queues and exchanges will survive the upgrade?  Should we upgrade all
our shovelers as well, or can we leave them at 2.7.1?

> Hi Kevin,

> There have been innumerable bug fixes and performance improvements to
rabbit
> since 2.7.1 - is upgrading a possibility?


-- 
Kevin M. Goess
Software Engineer
Berkeley Electronic Press
kgoess at bepress.com

510-665-1200 x179
www.bepress.com

bepress: sustainable scholarly publishing
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/960dafe1/attachment.htm>

From karl.rieb at gmail.com  Sat May 18 04:20:01 2013
From: karl.rieb at gmail.com (Karl Rieb)
Date: Fri, 17 May 2013 20:20:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ 3.1.0-1
 (case_clause empty) on EC2
Message-ID: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>

Hi,

I am running a RabbitMQ cluster of 4 nodes in AWS EC2 on *c1.xlarge *instances 
using Ubuntu 12.04 LTS (kernel 3.2.0-38).  Periodically two of my nodes 
holding the largest queues will crash and require me to restart the 
rabbitmq-server service.  Looking at the logs, I'm at a loss as to why the 
crash is occurring.  I've have tried reproducing the crash manually by 
flooding my nodes with messages, but that doesn't seem to trigger the 
issue.  Below is output from various RabbitMQ logs:

# cat /var/log/rabbitmq/rabbit at ip-10-123-123-123-sasl.log
> =CRASH REPORT==== 18-May-2013::01:41:51 ===
>   crasher:
>     initial call: gen:init_it/6
>     pid: <0.301.0>
>     registered_name: []
>     exception exit: {{case_clause,{empty,{[],[]}}},
>                      [{rabbit_amqqueue_process,subtract_acks,3,[]},
>                       {rabbit_amqqueue_process,subtract_acks,4,[]},
>                       {rabbit_amqqueue_process,handle_cast,2,[]},
>                       {gen_server2,handle_msg,2,[]},
>                       {proc_lib,wake_up,3,
>                                 [{file,"proc_lib.erl"},{line,249}]}]}
>       in function  gen_server2:terminate/3
>     ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.207.0>]
>     messages: [{'$gen_cast',{resume,<0.676.0>}},
>                   {'$gen_cast',{ack,[27583,27606,27629,27652,27675,27698,
>                                      27721,27744,27767,27790,27813,27836,
>                                      27859,27882,27905,27928,27951,27974,
>                                      27997,28020,28043,28066,28089,28112,
>                                      28135,28158,28179,28200,28221,28242,
>                                      28263,28284,28305,28324,28342,28360,
>                                      28378,28396,28414,28432,28450,28468,
>                                      28486,28504,28522,28540,28558,28576,
>                                      28594,28612],
>                                     <0.737.0>}},
>                   {'$gen_cast',{resume,<0.737.0>}},
>                   {'$gen_cast',{ack,[27608,27631,27654,27677,27700,27723,
>                                      27746,27769,27792,27815,27838,27861,
>                                      27884,27907,27930,27953,27976,27999,
>                                      28022,28045,28068,28091,28114,28137,
>                                      28160,28181,28202,28223,28244,28265,
>                                      28286,28307,28326,28344,28362,28380,
>                                      28398,28416,28434,28452,28470,28488,
>                                      28506,28524,28542,28560,28578,28596,
>                                      28614],
>                                     <0.676.0>}},
>                   {'$gen_cast',{ack,[27578,27601,27624,27647,27670,27693,
>                                      27716,27739,27762,27785,27808,27831,
>                                      27854,27877,27900,27923,27946,27969,
>                                      27992,28015,28038,28061,28084,28107,
>                                      28130,28153,28174,28195,28216,28237,
>                                      28258,28279,28300,28321,28340,28358,
>                                      28376,28394,28412,28430,28448,28466,
>                                      28484,28502,28520,28538,28556,28574,
>                                      28592,28610],
>                                     <0.716.0>}},
>                   {'$gen_cast',{resume,<0.716.0>}},
>                   {'$gen_cast',{ack,[27582,27605,27628,27651,27674,27697,
>                                      27720,27743,27766,27789,27812,27835,
>                                      27858,27881,27904,27927,27950,27973,
>                                      27996,28019,28042,28065,28088,28111,
>                                      28134,28157,28178,28199,28220,28241,
>                                      28262,28283,28304,28323,28341,28359,
>                                      28377,28395,28413,28431,28449,28467,
>                                      28485,28503,28521,28539,28557,28575,
>                                      28593,28611],
>                                     <0.737.0>}}]
>     links: [<0.300.0>]
>     dictionary: [{{ch,<0.729.0>},
>                    {cr,<0.729.0>,#Ref<0.0.0.12296>,
>                        {[28715,28696,28677,28658,28639,28620,28602,28584,
>                          28566,28548,28530,28512,28494,28476,28458,28440,
>                          28422,28404,28386,28368,28350,28332,28313,28292,
>                          28271,28250,28229,28208,28187,28166,28143,28120,
>                          28097,28074,28051,28028,28005,27982,27959,27936,
>                          27913,27890,27867,27844,27821,27798,27775,27752,
>                          27729,27706,27683,27660,27637,27614],
>                         [27591]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.728.0>,active,{0,nil}},
>                        11}},
>                   {{credit_to,<7350.877.0>},22},
>                   {{ch,<0.608.0>},
>                    {cr,<0.608.0>,#Ref<0.0.0.9041>,
>                        {[28708,28689,28670,28651,28632,28607,28589,28571,
>                          28553,28535,28517,28499,28481,28463,28445,28427,
>                          28409,28391,28373,28355,28337,28318,28297,28276,
>                          28255,28234,28213,28192,28171,28150,28127,28104,
>                          28081,28058,28035,28012,27989,27966,27943,27920,
>                          27897,27874,27851,27828,27805,27782,27759,27736,
>                          27713,27690,27667,27644,27621,27598],
>                         [27575]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.607.0>,active,{0,nil}},
>                        38}},
>                   {{ch,<0.624.0>},
>                    {cr,<0.624.0>,#Ref<0.0.0.9436>,
>                        {[28722,28703,28684,28665,28646],[28627]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.623.0>,active,{0,nil}},
>                        36}},
>                   {{ch,<0.696.0>},
>                    {cr,<0.696.0>,#Ref<0.0.0.11414>,
>                        {[],[]},
>                        2,
>                        {[],[]},
>                        {qstate,<0.695.0>,active,{0,nil}},
>                        24}},
>                   {{ch,<0.564.0>},
>                    {cr,<0.564.0>,#Ref<0.0.0.7285>,
>                        {[28718,28699,28680,28661,28642],[28623]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.563.0>,active,{0,nil}},
>                        12}},
>                   {{ch,<0.644.0>},
>                    {cr,<0.644.0>,#Ref<0.0.0.10071>,
>                        {[28713,28694,28675,28656,28637,28618,28600,28582,
>                          28564,28546,28528,28510,28492,28474,28456,28438,
>                          28420,28402,28384,28366,28348,28330,28311,28290,
>                          28269,28248,28227,28206,28185,28164,28141,28118,
>                          28095,28072,28049,28026,28003,27980,27957,27934,
>                          27911,27888,27865,27842,27819,27796,27773,27750,
>                          27727,27704,27681,27658,27635,27612],
>                         [27589]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.643.0>,active,{0,nil}},
>                        11}},
>                   {{ch,<0.676.0>},
>                    {cr,<0.676.0>,#Ref<0.0.0.11309>,
>                        {[28614,28613,28596,28595,28578,28577,28560,28559,
>                          28542,28541,28524,28523,28506,28505,28488,28487,
>                          28470,28469,28452,28451,28434,28433,28416,28415,
>                          28398,28397,28380,28379,28362,28361,28344,28343,
>                          28326,28325,28307,28306,28286,28285,28265,28264,
>                          28244,28243,28223,28222,28202,28201,28181,28180,
>                          28160,28159,28137,28136,28114,28113,28091,28090,
>                          28068,28067,28045,28044,28022,28021,27999,27998,
>                          27976,27975,27953,27952,27930,27929,27907,27906,
>                          27884,27883,27861,27860,27838,27837,27815,27814,
>                          27792,27791,27769,27768,27746,27745,27723,27722,
>                          27700,27699,27677,27676,27654,27653,27631,27630,
>                          27608,27607,27585],
>                         [27584]},
>                        2,
>                        {[{<0.676.0>,
>                           {consumer,<<"amq.ctag-0cvDGmyaAbEW_j15AfhGHQ">>,
>                                     true}}],
>                         [{<0.676.0>,
>                           {consumer,<<"amq.ctag-YqU04SIfQv6P-QVueEjbRg">>,
>                                     true}}]},
>                        {qstate,<0.675.0>,suspended,{0,nil}},
>                        25}},
>                   {{xtype_to_module,direct},rabbit_exchange_type_direct},
>                   {{credit_to,<7350.833.0>},31},
>                   {{ch,<0.745.0>},
>                    {cr,<0.745.0>,#Ref<0.0.0.12674>,
>                        {[28716,28697,28678,28659,28640,28621,28603,28585,
>                          28567,28549,28531,28513,28495,28477,28459,28441,
>                          28423,28405,28387,28369,28351,28333,28314,28293,
>                          28272,28251,28230,28209,28188,28167,28144,28121,
>                          28098,28075,28052,28029,28006,27983,27960,27937,
>                          27914,27891,27868,27845,27822,27799,27776,27753,
>                          27730,27707,27684,27661,27638,27615],
>                         [27592]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.744.0>,active,{0,nil}},
>                        37}},
>                   {{ch,<0.660.0>},
>                    {cr,<0.660.0>,#Ref<0.0.0.10650>,
>                        {[28712,28693,28674,28655,28636,28617,28599,28581,
>                          28563,28545,28527,28509,28491,28473,28455,28437,
>                          28419,28401,28383,28365,28347,28329,28310,28289,
>                          28268,28247,28226,28205,28184,28163,28140,28117,
>                          28094,28071,28048,28025,28002,27979,27956,27933,
>                          27910,27887,27864,27841,27818,27795,27772,27749,
>                          27726,27703,27680,27657,27634,27611],
>                         [27588]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.659.0>,active,{0,nil}},
>                        11}},
>                   {{credit_to,<7350.837.0>},32},
>                   {{credit_to,<7350.881.0>},17},
>                   {{ch,<0.737.0>},
>                    {cr,<0.737.0>,#Ref<0.0.0.12429>,
>                        {[28612,28611,28594,28593,28576,28575,28558,28557,
>                          28540,28539,28522,28521,28504,28503,28486,28485,
>                          28468,28467,28450,28449,28432,28431,28414,28413,
>                          28396,28395,28378,28377,28360,28359,28342,28341,
>                          28324,28323,28305,28304,28284,28283,28263,28262,
>                          28242,28241,28221,28220,28200,28199,28179,28178,
>                          28158,28157,28135,28134,28112,28111,28089,28088,
>                          28066,28065,28043,28042,28020,28019,27997,27996,
>                          27974,27973,27951,27950,27928,27927,27905,27904,
>                          27882,27881,27859,27858,27836,27835,27813,27812,
>                          27790,27789,27767,27766,27744,27743,27721,27720,
>                          27698,27697,27675,27674,27652,27651,27629,27628,
>                          27606,27605,27583],
>                         [27582]},
>                        2,
>                        {[{<0.737.0>,
>                           {consumer,<<"amq.ctag-ITZqhulzHhUzx1uy1Eot3g">>,
>                                     true}}],
>                         [{<0.737.0>,
>                           {consumer,<<"amq.ctag-hpo5ejdoJRdLrT6JS42jGw">>,
>                                     true}}]},
>                        {qstate,<0.736.0>,suspended,{0,nil}},
>                        11}},
>                   {credit_blocked,[]},
>                   {{credit_to,<7350.854.0>},3},
>                   {{ch,<0.716.0>},
>                    {cr,<0.716.0>,#Ref<0.0.0.11820>,
>                        {[28610,28609,28592,28591,28574,28573,28556,28555,
>                          28538,28537,28520,28519,28502,28501,28484,28483,
>                          28466,28465,28448,28447,28430,28429,28412,28411,
>                          28394,28393,28376,28375,28358,28357,28340,28339,
>                          28321,28320,28300,28299,28279,28278,28258,28257,
>                          28237,28236,28216,28215,28195,28194,28174,28173,
>                          28153,28152,28130,28129,28107,28106,28084,28083,
>                          28061,28060,28038,28037,28015,28014,27992,27991,
>                          27969,27968,27946,27945,27923,27922,27900,27899,
>                          27877,27876,27854,27853,27831,27830,27808,27807,
>                          27785,27784,27762,27761,27739,27738,27716,27715,
>                          27693,27692,27670,27669,27647,27646,27624,27623,
>                          27601,27600,27578],
>                         [27577]},
>                        2,
>                        {[{<0.716.0>,
>                           {consumer,<<"amq.ctag-BTlS-GmbXNpcU-wUlMI60Q">>,
>                                     true}}],
>                         [{<0.716.0>,
>                           {consumer,<<"amq.ctag-loc5monF8M1pz_Bb8ypumw">>,
>                                     true}}]},
>                        {qstate,<0.715.0>,suspended,{0,nil}},
>                        44}},
>                   {{ch,<0.782.0>},
>                    {cr,<0.782.0>,#Ref<0.0.0.15649>,
>                        {[28714,28695,28676,28657,28638,28619,28601,28583,
>                          28565,28547,28529,28511,28493,28475,28457,28439,
>                          28421,28403,28385,28367,28349,28331,28312,28291,
>                          28270,28249,28228,28207,28186,28165,28142,28119,
>                          28096,28073,28050,28027,28004,27981,27958,27935,
>                          27912,27889,27866,27843,27820,27797,27774,27751,
>                          27728,27705,27682,27659,27636,27613],
>                         [27590]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.781.0>,active,{0,nil}},
>                        35}},
>                   {{credit_to,<7350.846.0>},22},
>                   {{ch,<0.684.0>},
>                    {cr,<0.684.0>,#Ref<0.0.0.11198>,
>                        {[28711,28692,28673,28654,28635,28616,28598,28580,
>                          28562,28544,28526,28508,28490,28472,28454,28436,
>                          28418,28400,28382,28364,28346,28328,28309,28288,
>                          28267,28246,28225,28204,28183,28162,28139,28116,
>                          28093,28070,28047,28024,28001,27978,27955,27932,
>                          27909,27886,27863,27840,27817,27794,27771,27748,
>                          27725,27702,27679,27656,27633,27610],
>                         [27587]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.683.0>,active,{0,nil}},
>                        11}},
>                   {{ch,<0.692.0>},
>                    {cr,<0.692.0>,#Ref<0.0.0.11088>,
>                        {[28710,28691,28672,28653,28634,28615,28597,28579,
>                          28561,28543,28525,28507,28489,28471,28453,28435,
>                          28417,28399,28381,28363,28345,28327,28308,28287,
>                          28266,28245,28224,28203,28182,28161,28138,28115,
>                          28092,28069,28046,28023,28000,27977,27954,27931,
>                          27908,27885,27862,27839,27816,27793,27770,27747,
>                          27724,27701,27678,27655,27632,27609],
>                         [27586]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.691.0>,active,{0,nil}},
>                        12}},
>                   {{ch,<0.648.0>},
>                    {cr,<0.648.0>,#Ref<0.0.0.10283>,
>                        {[28717,28698,28679,28660,28641],[28622]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.647.0>,active,{0,nil}},
>                        12}},
>                   {guid,{{2296174761,591959305,1562876388,1822892473},1}},
>                   {{ch,<0.720.0>},
>                    {cr,<0.720.0>,#Ref<0.0.0.12036>,
>                        {[28723,28704,28685,28666,28647],[28628]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.719.0>,active,{0,nil}},
>                        37}},
>                   {{credit_to,<7350.869.0>},39},
>                   {{ch,<0.636.0>},
>                    {cr,<0.636.0>,#Ref<0.0.0.9960>,
>                        {[28705,28686,28667,28648,28629,28604,28586,28568,
>                          28550,28532,28514,28496,28478,28460,28442,28424,
>                          28406,28388,28370,28352,28334,28315,28294,28273,
>                          28252,28231,28210,28189,28168,28147,28124,28101,
>                          28078,28055,28032,28009,27986,27963,27940,27917,
>                          27894,27871,27848,27825,27802,27779,27756,27733,
>                          27710,27687,27664,27641,27618,27595],
>                         [27572]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.635.0>,active,{0,nil}},
>                        15}},
>                   {{credit_to,<7350.850.0>},50},
>                   {{ch,<0.616.0>},
>                    {cr,<0.616.0>,#Ref<0.0.0.9300>,
>                        {[28719,28700,28681,28662,28643],[28624]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.615.0>,active,{0,nil}},
>                        12}},
>                   {{ch,<0.509.0>},
>                    {cr,<0.509.0>,#Ref<0.0.0.2243>,
>                        {[28302,28281,28260,28239,28218,28197,28176,28155,
>                          28132,28109,28086,28063,28040,28017,27994,27971],
>                         [27580,27603,27626,27649,27672,27695,27718,27741,
>                          27764,27787,27810,27833,27856,27879,27902,27925,
>                          27948]},
>                        3,
>                        {[],[]},
>                        {qstate,<0.508.0>,active,{0,nil}},
>                        36}},
>                   {{credit_to,<7350.873.0>},17},
>                   {{ch,<0.588.0>},
>                    {cr,<0.588.0>,#Ref<0.0.0.7808>,
>                        {[28721,28702,28683,28664,28645],[28626]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.587.0>,active,{0,nil}},
>                        12}},
>                   {{ch,<0.664.0>},
>                    {cr,<0.664.0>,#Ref<0.0.0.10772>,
>                        {[28720,28701,28682,28663,28644],[28625]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.663.0>,active,{0,nil}},
>                        13}},
>                   {fhc_age_tree,{0,nil}},
>                   {{ch,<0.708.0>},
>                    {cr,<0.708.0>,#Ref<0.0.0.11695>,
>                        {[28707,28688,28669,28650,28631,28606,28588,28570,
>                          28552,28534,28516,28498,28480,28462,28444,28426,
>                          28408,28390,28372,28354,28336,28317,28296,28275,
>                          28254,28233,28212,28191,28170,28149,28126,28103,
>                          28080,28057,28034,28011,27988,27965,27942,27919,
>                          27896,27873,27850,27827,27804,27781,27758,27735,
>                          27712,27689,27666,27643,27620,27597],
>                         [27574]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.707.0>,active,{0,nil}},
>                        35}},
>                   {{credit_to,<7350.829.0>},13},
>                   {{ch,<0.757.0>},
>                    {cr,<0.757.0>,#Ref<0.0.0.13150>,
>                        {[28706,28687,28668,28649,28630,28605,28587,28569,
>                          28551,28533,28515,28497,28479,28461,28443,28425,
>                          28407,28389,28371,28353,28335,28316,28295,28274,
>                          28253,28232,28211,28190,28169,28148,28125,28102,
>                          28079,28056,28033,28010,27987,27964,27941,27918,
>                          27895,27872,27849,27826,27803,27780,27757,27734,
>                          27711,27688,27665,27642,27619,27596],
>                         [27573]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.756.0>,active,{0,nil}},
>                        49}},
>                   {{ch,<0.572.0>},
>                    {cr,<0.572.0>,#Ref<0.0.0.7536>,
>                        {[28709,28690,28671,28652,28633,28608,28590,28572,
>                          28554,28536,28518,28500,28482,28464,28446,28428,
>                          28410,28392,28374,28356,28338,28319,28298,28277,
>                          28256,28235,28214,28193,28172,28151,28128,28105,
>                          28082,28059,28036,28013,27990,27967,27944,27921,
>                          27898,27875,27852,27829,27806,27783,27760,27737,
>                          27714,27691,27668,27645,27622,27599],
>                         [27576]},
>                        1,
>                        {[],[]},
>                        {qstate,<0.571.0>,active,{0,nil}},
>                        35}},
>                   {{credit_to,<7350.825.0>},2},
>                   {{credit_to,<7350.858.0>},3}]
>     trap_exit: true
>     status: running
>     heap_size: 121536
>     stack_size: 27
>     reductions: 9363545
>   neighbours:
>
> =SUPERVISOR REPORT==== 18-May-2013::01:41:51 ===
>      Supervisor: {local,rabbit_amqqueue_sup}
>      Context:    child_terminated
>      Reason:     {{case_clause,{empty,{[],[]}}},
>                   [{rabbit_amqqueue_process,subtract_acks,3,[]},
>                    {rabbit_amqqueue_process,subtract_acks,4,[]},
>                    {rabbit_amqqueue_process,handle_cast,2,[]},
>                    {gen_server2,handle_msg,2,[]},
>                   
>  {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>      Offender:   [{pid,<0.301.0>},
>                   {name,rabbit_amqqueue},
>                   {mfa,
>                       {rabbit_amqqueue_process,start_link,
>                           [{amqqueue,
>                                {resource,<<"/">>,queue,
>                                    <<"document_queue">>},
>                               
>  true,false,none,[],<0.7622.0>,[],[],undefined,
>                                []}]}},
>                   {restart_type,temporary},
>                   {shutdown,4294967295},
>                   {child_type,worker}]


Notice how the *case_clause *is *empty*.  The other rabbit log looks 
similar:

# cat /var/log/rabbitmq/rabbit at ip-10-123-123-123.log 

 

=ERROR REPORT==== 18-May-2013::01:41:48 ===

** Generic server <0.301.0> terminating

** Last message in was {'$gen_cast',

                           {ack,

                               [27585,27584,27607,27630,27653,27676,27699,

                                27722,27745,27768,27791,27814,27837,27860,

                                27883,27906,27929,27952,27975,27998,28021,

                                28044,28067,28090,28113,28136,28159,28180,

                                28201,28222,28243,28264,28285,28306,28325,

                                28343,28361,28379,28397,28415,28433,28451,

                                28469,28487,28505,28523,28541,28559,28577,

                                28595,28613],

                               <0.676.0>}}

** When Server state == {q,

                         {amqqueue,

                          {resource,<<"/">>,queue,

                           <<"document_queue">>},

                          true,false,none,[],<0.301.0>,[],[],undefined,[]},

                         none,true,rabbit_variable_queue,

                         {vqstate,

                          {0,{[],[]}},

                          {0,{[],[]}},

                          {delta,undefined,0,undefined},

                          {0,{[],[]}},

                          {0,{[],[]}}, 

*                          ... [ thousands of lines of state ] ... *

 

** Reason for termination ==

** {{case_clause,{empty,{[],[]}}},

    [{rabbit_amqqueue_process,subtract_acks,3,[]},

     {rabbit_amqqueue_process,subtract_acks,4,[]},

     {rabbit_amqqueue_process,handle_cast,2,[]},

     {gen_server2,handle_msg,2,[]},

     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}


> =ERROR REPORT==== 18-May-2013::01:41:51 ===

connection <0.430.0>, channel 22 - soft error:

{amqp_error,not_found,

            "no queue 'document_queue' in vhost '/'",

            'queue.declare'}


> =ERROR REPORT==== 18-May-2013::01:41:51 ===

connection <0.384.0>, channel 12 - soft error:

{amqp_error,not_found,

            "no queue 'document_queue' in vhost '/'",

            'queue.declare'}


> =ERROR REPORT==== 18-May-2013::01:41:51 ===

connection <0.384.0>, channel 15 - soft error:

{amqp_error,not_found,

            "no queue 'document_queue' in vhost '/'",

            'queue.declare'}


> =ERROR REPORT==== 18-May-2013::01:41:51 ===

connection <0.373.0>, channel 23 - soft error:

{amqp_error,not_found,

            "no queue 'document_queue' in vhost '/'",

            'queue.declare'} 

* ... [ repeated a bunch of times ] ...*


I also see this in my */var/log/syslog* with regards to *beam.smp*:

# cat /var/log/syslog
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176041] INFO: task 
> beam.smp:18971 blocked for more than 120 seconds.
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176053] "echo 0 > 
> /proc/sys/kernel/hung_task_timeout_secs" disables this message.
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176060] beam.smp       
>  D ffff8801bfd93700     0 18971  18962 0x00000000
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176065] 
>  ffff8801b11cdcb8 0000000000000282 0000000000000000 ffffffffffffffe0
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176070] 
>  ffff8801b11cdfd8 ffff8801b11cdfd8 ffff8801b11cdfd8 0000000000013700
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176075] 
>  ffff8801b3180000 ffff8801b35244a0 00007f500e2079e0 ffff8801b146bb80
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176079] Call Trace:
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176089] 
>  [<ffffffff8165434f>] schedule+0x3f/0x60
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176094] 
>  [<ffffffff8106aef5>] exit_mm+0x85/0x130
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176097] 
>  [<ffffffff8106b10e>] do_exit+0x16e/0x450
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176102] 
>  [<ffffffff810797aa>] ? __dequeue_signal+0x6a/0xb0
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176105] 
>  [<ffffffff8106b594>] do_group_exit+0x44/0xa0
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176108] 
>  [<ffffffff8107c36c>] get_signal_to_deliver+0x21c/0x420
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176113] 
>  [<ffffffff81014825>] do_signal+0x45/0x130
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176116] 
>  [<ffffffff8105539d>] ? set_next_entity+0xad/0xd0
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176120] 
>  [<ffffffff81014ad5>] do_notify_resume+0x65/0x80
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176124] 
>  [<ffffffff8165ea90>] int_signal+0x12/0x17
> *... [ repeated 9 more times with same timestamp ] ...*


There are no strange CPU spikes on my EC2 node based on AWS monitoring. The 
only thing that seems to stand out is that my writes to my EBS volume spike 
during the crash (~90 write OPs/sec, 4 MiB/sec write bandwidth, ~30ms/op 
write latency).

My team and I are completely stumped and would appreciate any insight you 
might have to the crash reports.  Is this a problem with writes hanging 
when going against the EBS volume since EBS volumes are essentially network 
mounted?  Is there a way to configure rabbit to be more tolerant of these 
delays?  


For debugging purposes, below is the status output of one of the nodes when 
it is healthy (so you can see the versions of everything i'm running):

# rabbitmqctl status
> Status of node 'rabbit at ip-10-123-123-123' ...
> [{pid,28978},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
>       {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"},
>       {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.0-gitd541e9a"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},
>       {rabbit,"RabbitMQ","3.1.0"},
>       {os_mon,"CPO  CXC 138 46","2.2.11"},
>       {inets,"INETS  CXC 138 49","5.9.4"},
>       {mnesia,"MNESIA  CXC 138 12","4.8"},
>       {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
>       {xmerl,"XML parser","1.3.3"},
>       {sasl,"SASL  CXC 138 11","2.3.1"},
>       {stdlib,"ERTS  CXC 138 10","1.19.1"},
>       {kernel,"ERTS  CXC 138 10","2.16.1"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R16B (erts-5.10.1) [source-05f1189] [64-bit] [smp:8:8] 
> [async-threads:30] [hipe] [kernel-poll:true]\n"},
>  {memory,
>      [{total,60179048},
>       {connection_procs,5274808},
>       {queue_procs,13107264},
>       {plugins,354272},
>       {other_proc,9741830},
>       {mnesia,150456},
>       {mgmt_db,12248},
>       {msg_index,34768},
>       {other_ets,1148248},
>       {binary,4905584},
>       {code,19565863},
>       {atom,703377},
>       {other_system,5180330}]},
>  {vm_memory_high_watermark,0.8},
>  {vm_memory_limit,5828434329},
>  {disk_free_limit,1000000000},
>  {disk_free,3953344512},
>  {file_descriptors,
>     
>  [{total_limit,924},{total_used,6},{sockets_limit,829},{sockets_used,4}]},
>  {processes,[{limit,1048576},{used,348}]},
>  {run_queue,0},
>  {uptime,3796}]
> ...done.


Note that I am using Erlang v16 from the Erlang Solutions repo (esl-erlang 
package).  I originally was using Erlang v14 from Ubuntu repos 
(erlang-base), but decided to upgrade hoping it would resolve the issue 
(which it did not).  I have also tried running RabbitMQ 3.0.4 without 
success.  This issue seems to affect both versions.

Thanks,
Karl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/864aab47/attachment.htm>

From brett.r.cameron at gmail.com  Sat May 18 04:48:10 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sat, 18 May 2013 15:48:10 +1200
Subject: [rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ
 3.1.0-1 (case_clause empty) on EC2
In-Reply-To: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
References: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
Message-ID: <CALPqkipk5DFLH5XwfR8fW=fTVd4tJWsC8XwC+qXctgaxW7vHCQ@mail.gmail.com>

Karl,

Wild speculation would be that messages have been consumed from a queue but
that queue (name = document_queue?) is for some reason missing in action
(gone, inaccessible, ...) when the consumer subsequently tries to ack the
message(s).

Brett



On Sat, May 18, 2013 at 3:20 PM, Karl Rieb <karl.rieb at gmail.com> wrote:

> Hi,
>
> I am running a RabbitMQ cluster of 4 nodes in AWS EC2 on *c1.xlarge *instances
> using Ubuntu 12.04 LTS (kernel 3.2.0-38).  Periodically two of my nodes
> holding the largest queues will crash and require me to restart the
> rabbitmq-server service.  Looking at the logs, I'm at a loss as to why the
> crash is occurring.  I've have tried reproducing the crash manually by
> flooding my nodes with messages, but that doesn't seem to trigger the
> issue.  Below is output from various RabbitMQ logs:
>
> # cat /var/log/rabbitmq/rabbit at ip-10-123-123-123-sasl.log
>> =CRASH REPORT==== 18-May-2013::01:41:51 ===
>>   crasher:
>>     initial call: gen:init_it/6
>>     pid: <0.301.0>
>>     registered_name: []
>>     exception exit: {{case_clause,{empty,{[],[]}}},
>>                      [{rabbit_amqqueue_process,subtract_acks,3,[]},
>>                       {rabbit_amqqueue_process,subtract_acks,4,[]},
>>                       {rabbit_amqqueue_process,handle_cast,2,[]},
>>                       {gen_server2,handle_msg,2,[]},
>>                       {proc_lib,wake_up,3,
>>                                 [{file,"proc_lib.erl"},{line,249}]}]}
>>       in function  gen_server2:terminate/3
>>     ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.207.0>]
>>     messages: [{'$gen_cast',{resume,<0.676.0>}},
>>                   {'$gen_cast',{ack,[27583,27606,27629,27652,27675,27698,
>>                                      27721,27744,27767,27790,27813,27836,
>>                                      27859,27882,27905,27928,27951,27974,
>>                                      27997,28020,28043,28066,28089,28112,
>>                                      28135,28158,28179,28200,28221,28242,
>>                                      28263,28284,28305,28324,28342,28360,
>>                                      28378,28396,28414,28432,28450,28468,
>>                                      28486,28504,28522,28540,28558,28576,
>>                                      28594,28612],
>>                                     <0.737.0>}},
>>                   {'$gen_cast',{resume,<0.737.0>}},
>>                   {'$gen_cast',{ack,[27608,27631,27654,27677,27700,27723,
>>                                      27746,27769,27792,27815,27838,27861,
>>                                      27884,27907,27930,27953,27976,27999,
>>                                      28022,28045,28068,28091,28114,28137,
>>                                      28160,28181,28202,28223,28244,28265,
>>                                      28286,28307,28326,28344,28362,28380,
>>                                      28398,28416,28434,28452,28470,28488,
>>                                      28506,28524,28542,28560,28578,28596,
>>                                      28614],
>>                                     <0.676.0>}},
>>                   {'$gen_cast',{ack,[27578,27601,27624,27647,27670,27693,
>>                                      27716,27739,27762,27785,27808,27831,
>>                                      27854,27877,27900,27923,27946,27969,
>>                                      27992,28015,28038,28061,28084,28107,
>>                                      28130,28153,28174,28195,28216,28237,
>>                                      28258,28279,28300,28321,28340,28358,
>>                                      28376,28394,28412,28430,28448,28466,
>>                                      28484,28502,28520,28538,28556,28574,
>>                                      28592,28610],
>>                                     <0.716.0>}},
>>                   {'$gen_cast',{resume,<0.716.0>}},
>>                   {'$gen_cast',{ack,[27582,27605,27628,27651,27674,27697,
>>                                      27720,27743,27766,27789,27812,27835,
>>                                      27858,27881,27904,27927,27950,27973,
>>                                      27996,28019,28042,28065,28088,28111,
>>                                      28134,28157,28178,28199,28220,28241,
>>                                      28262,28283,28304,28323,28341,28359,
>>                                      28377,28395,28413,28431,28449,28467,
>>                                      28485,28503,28521,28539,28557,28575,
>>                                      28593,28611],
>>                                     <0.737.0>}}]
>>     links: [<0.300.0>]
>>     dictionary: [{{ch,<0.729.0>},
>>                    {cr,<0.729.0>,#Ref<0.0.0.12296>,
>>                        {[28715,28696,28677,28658,28639,28620,28602,28584,
>>                          28566,28548,28530,28512,28494,28476,28458,28440,
>>                          28422,28404,28386,28368,28350,28332,28313,28292,
>>                          28271,28250,28229,28208,28187,28166,28143,28120,
>>                          28097,28074,28051,28028,28005,27982,27959,27936,
>>                          27913,27890,27867,27844,27821,27798,27775,27752,
>>                          27729,27706,27683,27660,27637,27614],
>>                         [27591]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.728.0>,active,{0,nil}},
>>                        11}},
>>                   {{credit_to,<7350.877.0>},22},
>>                   {{ch,<0.608.0>},
>>                    {cr,<0.608.0>,#Ref<0.0.0.9041>,
>>                        {[28708,28689,28670,28651,28632,28607,28589,28571,
>>                          28553,28535,28517,28499,28481,28463,28445,28427,
>>                          28409,28391,28373,28355,28337,28318,28297,28276,
>>                          28255,28234,28213,28192,28171,28150,28127,28104,
>>                          28081,28058,28035,28012,27989,27966,27943,27920,
>>                          27897,27874,27851,27828,27805,27782,27759,27736,
>>                          27713,27690,27667,27644,27621,27598],
>>                         [27575]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.607.0>,active,{0,nil}},
>>                        38}},
>>                   {{ch,<0.624.0>},
>>                    {cr,<0.624.0>,#Ref<0.0.0.9436>,
>>                        {[28722,28703,28684,28665,28646],[28627]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.623.0>,active,{0,nil}},
>>                        36}},
>>                   {{ch,<0.696.0>},
>>                    {cr,<0.696.0>,#Ref<0.0.0.11414>,
>>                        {[],[]},
>>                        2,
>>                        {[],[]},
>>                        {qstate,<0.695.0>,active,{0,nil}},
>>                        24}},
>>                   {{ch,<0.564.0>},
>>                    {cr,<0.564.0>,#Ref<0.0.0.7285>,
>>                        {[28718,28699,28680,28661,28642],[28623]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.563.0>,active,{0,nil}},
>>                        12}},
>>                   {{ch,<0.644.0>},
>>                    {cr,<0.644.0>,#Ref<0.0.0.10071>,
>>                        {[28713,28694,28675,28656,28637,28618,28600,28582,
>>                          28564,28546,28528,28510,28492,28474,28456,28438,
>>                          28420,28402,28384,28366,28348,28330,28311,28290,
>>                          28269,28248,28227,28206,28185,28164,28141,28118,
>>                          28095,28072,28049,28026,28003,27980,27957,27934,
>>                          27911,27888,27865,27842,27819,27796,27773,27750,
>>                          27727,27704,27681,27658,27635,27612],
>>                         [27589]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.643.0>,active,{0,nil}},
>>                        11}},
>>                   {{ch,<0.676.0>},
>>                    {cr,<0.676.0>,#Ref<0.0.0.11309>,
>>                        {[28614,28613,28596,28595,28578,28577,28560,28559,
>>                          28542,28541,28524,28523,28506,28505,28488,28487,
>>                          28470,28469,28452,28451,28434,28433,28416,28415,
>>                          28398,28397,28380,28379,28362,28361,28344,28343,
>>                          28326,28325,28307,28306,28286,28285,28265,28264,
>>                          28244,28243,28223,28222,28202,28201,28181,28180,
>>                          28160,28159,28137,28136,28114,28113,28091,28090,
>>                          28068,28067,28045,28044,28022,28021,27999,27998,
>>                          27976,27975,27953,27952,27930,27929,27907,27906,
>>                          27884,27883,27861,27860,27838,27837,27815,27814,
>>                          27792,27791,27769,27768,27746,27745,27723,27722,
>>                          27700,27699,27677,27676,27654,27653,27631,27630,
>>                          27608,27607,27585],
>>                         [27584]},
>>                        2,
>>                        {[{<0.676.0>,
>>                           {consumer,<<"amq.ctag-0cvDGmyaAbEW_j15AfhGHQ">>,
>>                                     true}}],
>>                         [{<0.676.0>,
>>                           {consumer,<<"amq.ctag-YqU04SIfQv6P-QVueEjbRg">>,
>>                                     true}}]},
>>                        {qstate,<0.675.0>,suspended,{0,nil}},
>>                        25}},
>>                   {{xtype_to_module,direct},rabbit_exchange_type_direct},
>>                   {{credit_to,<7350.833.0>},31},
>>                   {{ch,<0.745.0>},
>>                    {cr,<0.745.0>,#Ref<0.0.0.12674>,
>>                        {[28716,28697,28678,28659,28640,28621,28603,28585,
>>                          28567,28549,28531,28513,28495,28477,28459,28441,
>>                          28423,28405,28387,28369,28351,28333,28314,28293,
>>                          28272,28251,28230,28209,28188,28167,28144,28121,
>>                          28098,28075,28052,28029,28006,27983,27960,27937,
>>                          27914,27891,27868,27845,27822,27799,27776,27753,
>>                          27730,27707,27684,27661,27638,27615],
>>                         [27592]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.744.0>,active,{0,nil}},
>>                        37}},
>>                   {{ch,<0.660.0>},
>>                    {cr,<0.660.0>,#Ref<0.0.0.10650>,
>>                        {[28712,28693,28674,28655,28636,28617,28599,28581,
>>                          28563,28545,28527,28509,28491,28473,28455,28437,
>>                          28419,28401,28383,28365,28347,28329,28310,28289,
>>                          28268,28247,28226,28205,28184,28163,28140,28117,
>>                          28094,28071,28048,28025,28002,27979,27956,27933,
>>                          27910,27887,27864,27841,27818,27795,27772,27749,
>>                          27726,27703,27680,27657,27634,27611],
>>                         [27588]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.659.0>,active,{0,nil}},
>>                        11}},
>>                   {{credit_to,<7350.837.0>},32},
>>                   {{credit_to,<7350.881.0>},17},
>>                   {{ch,<0.737.0>},
>>                    {cr,<0.737.0>,#Ref<0.0.0.12429>,
>>                        {[28612,28611,28594,28593,28576,28575,28558,28557,
>>                          28540,28539,28522,28521,28504,28503,28486,28485,
>>                          28468,28467,28450,28449,28432,28431,28414,28413,
>>                          28396,28395,28378,28377,28360,28359,28342,28341,
>>                          28324,28323,28305,28304,28284,28283,28263,28262,
>>                          28242,28241,28221,28220,28200,28199,28179,28178,
>>                          28158,28157,28135,28134,28112,28111,28089,28088,
>>                          28066,28065,28043,28042,28020,28019,27997,27996,
>>                          27974,27973,27951,27950,27928,27927,27905,27904,
>>                          27882,27881,27859,27858,27836,27835,27813,27812,
>>                          27790,27789,27767,27766,27744,27743,27721,27720,
>>                          27698,27697,27675,27674,27652,27651,27629,27628,
>>                          27606,27605,27583],
>>                         [27582]},
>>                        2,
>>                        {[{<0.737.0>,
>>                           {consumer,<<"amq.ctag-ITZqhulzHhUzx1uy1Eot3g">>,
>>                                     true}}],
>>                         [{<0.737.0>,
>>                           {consumer,<<"amq.ctag-hpo5ejdoJRdLrT6JS42jGw">>,
>>                                     true}}]},
>>                        {qstate,<0.736.0>,suspended,{0,nil}},
>>                        11}},
>>                   {credit_blocked,[]},
>>                   {{credit_to,<7350.854.0>},3},
>>                   {{ch,<0.716.0>},
>>                    {cr,<0.716.0>,#Ref<0.0.0.11820>,
>>                        {[28610,28609,28592,28591,28574,28573,28556,28555,
>>                          28538,28537,28520,28519,28502,28501,28484,28483,
>>                          28466,28465,28448,28447,28430,28429,28412,28411,
>>                          28394,28393,28376,28375,28358,28357,28340,28339,
>>                          28321,28320,28300,28299,28279,28278,28258,28257,
>>                          28237,28236,28216,28215,28195,28194,28174,28173,
>>                          28153,28152,28130,28129,28107,28106,28084,28083,
>>                          28061,28060,28038,28037,28015,28014,27992,27991,
>>                          27969,27968,27946,27945,27923,27922,27900,27899,
>>                          27877,27876,27854,27853,27831,27830,27808,27807,
>>                          27785,27784,27762,27761,27739,27738,27716,27715,
>>                          27693,27692,27670,27669,27647,27646,27624,27623,
>>                          27601,27600,27578],
>>                         [27577]},
>>                        2,
>>                        {[{<0.716.0>,
>>                           {consumer,<<"amq.ctag-BTlS-GmbXNpcU-wUlMI60Q">>,
>>                                     true}}],
>>                         [{<0.716.0>,
>>                           {consumer,<<"amq.ctag-loc5monF8M1pz_Bb8ypumw">>,
>>                                     true}}]},
>>                        {qstate,<0.715.0>,suspended,{0,nil}},
>>                        44}},
>>                   {{ch,<0.782.0>},
>>                    {cr,<0.782.0>,#Ref<0.0.0.15649>,
>>                        {[28714,28695,28676,28657,28638,28619,28601,28583,
>>                          28565,28547,28529,28511,28493,28475,28457,28439,
>>                          28421,28403,28385,28367,28349,28331,28312,28291,
>>                          28270,28249,28228,28207,28186,28165,28142,28119,
>>                          28096,28073,28050,28027,28004,27981,27958,27935,
>>                          27912,27889,27866,27843,27820,27797,27774,27751,
>>                          27728,27705,27682,27659,27636,27613],
>>                         [27590]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.781.0>,active,{0,nil}},
>>                        35}},
>>                   {{credit_to,<7350.846.0>},22},
>>                   {{ch,<0.684.0>},
>>                    {cr,<0.684.0>,#Ref<0.0.0.11198>,
>>                        {[28711,28692,28673,28654,28635,28616,28598,28580,
>>                          28562,28544,28526,28508,28490,28472,28454,28436,
>>                          28418,28400,28382,28364,28346,28328,28309,28288,
>>                          28267,28246,28225,28204,28183,28162,28139,28116,
>>                          28093,28070,28047,28024,28001,27978,27955,27932,
>>                          27909,27886,27863,27840,27817,27794,27771,27748,
>>                          27725,27702,27679,27656,27633,27610],
>>                         [27587]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.683.0>,active,{0,nil}},
>>                        11}},
>>                   {{ch,<0.692.0>},
>>                    {cr,<0.692.0>,#Ref<0.0.0.11088>,
>>                        {[28710,28691,28672,28653,28634,28615,28597,28579,
>>                          28561,28543,28525,28507,28489,28471,28453,28435,
>>                          28417,28399,28381,28363,28345,28327,28308,28287,
>>                          28266,28245,28224,28203,28182,28161,28138,28115,
>>                          28092,28069,28046,28023,28000,27977,27954,27931,
>>                          27908,27885,27862,27839,27816,27793,27770,27747,
>>                          27724,27701,27678,27655,27632,27609],
>>                         [27586]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.691.0>,active,{0,nil}},
>>                        12}},
>>                   {{ch,<0.648.0>},
>>                    {cr,<0.648.0>,#Ref<0.0.0.10283>,
>>                        {[28717,28698,28679,28660,28641],[28622]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.647.0>,active,{0,nil}},
>>                        12}},
>>                   {guid,{{2296174761
>> ,591959305,1562876388,1822892473},1}},
>>                   {{ch,<0.720.0>},
>>                    {cr,<0.720.0>,#Ref<0.0.0.12036>,
>>                        {[28723,28704,28685,28666,28647],[28628]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.719.0>,active,{0,nil}},
>>                        37}},
>>                   {{credit_to,<7350.869.0>},39},
>>                   {{ch,<0.636.0>},
>>                    {cr,<0.636.0>,#Ref<0.0.0.9960>,
>>                        {[28705,28686,28667,28648,28629,28604,28586,28568,
>>                          28550,28532,28514,28496,28478,28460,28442,28424,
>>                          28406,28388,28370,28352,28334,28315,28294,28273,
>>                          28252,28231,28210,28189,28168,28147,28124,28101,
>>                          28078,28055,28032,28009,27986,27963,27940,27917,
>>                          27894,27871,27848,27825,27802,27779,27756,27733,
>>                          27710,27687,27664,27641,27618,27595],
>>                         [27572]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.635.0>,active,{0,nil}},
>>                        15}},
>>                   {{credit_to,<7350.850.0>},50},
>>                   {{ch,<0.616.0>},
>>                    {cr,<0.616.0>,#Ref<0.0.0.9300>,
>>                        {[28719,28700,28681,28662,28643],[28624]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.615.0>,active,{0,nil}},
>>                        12}},
>>                   {{ch,<0.509.0>},
>>                    {cr,<0.509.0>,#Ref<0.0.0.2243>,
>>                        {[28302,28281,28260,28239,28218,28197,28176,28155,
>>                          28132,28109,28086,28063,28040,28017,27994,27971],
>>                         [27580,27603,27626,27649,27672,27695,27718,27741,
>>                          27764,27787,27810,27833,27856,27879,27902,27925,
>>                          27948]},
>>                        3,
>>                        {[],[]},
>>                        {qstate,<0.508.0>,active,{0,nil}},
>>                        36}},
>>                   {{credit_to,<7350.873.0>},17},
>>                   {{ch,<0.588.0>},
>>                    {cr,<0.588.0>,#Ref<0.0.0.7808>,
>>                        {[28721,28702,28683,28664,28645],[28626]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.587.0>,active,{0,nil}},
>>                        12}},
>>                   {{ch,<0.664.0>},
>>                    {cr,<0.664.0>,#Ref<0.0.0.10772>,
>>                        {[28720,28701,28682,28663,28644],[28625]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.663.0>,active,{0,nil}},
>>                        13}},
>>                   {fhc_age_tree,{0,nil}},
>>                   {{ch,<0.708.0>},
>>                    {cr,<0.708.0>,#Ref<0.0.0.11695>,
>>                        {[28707,28688,28669,28650,28631,28606,28588,28570,
>>                          28552,28534,28516,28498,28480,28462,28444,28426,
>>                          28408,28390,28372,28354,28336,28317,28296,28275,
>>                          28254,28233,28212,28191,28170,28149,28126,28103,
>>                          28080,28057,28034,28011,27988,27965,27942,27919,
>>                          27896,27873,27850,27827,27804,27781,27758,27735,
>>                          27712,27689,27666,27643,27620,27597],
>>                         [27574]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.707.0>,active,{0,nil}},
>>                        35}},
>>                   {{credit_to,<7350.829.0>},13},
>>                   {{ch,<0.757.0>},
>>                    {cr,<0.757.0>,#Ref<0.0.0.13150>,
>>                        {[28706,28687,28668,28649,28630,28605,28587,28569,
>>                          28551,28533,28515,28497,28479,28461,28443,28425,
>>                          28407,28389,28371,28353,28335,28316,28295,28274,
>>                          28253,28232,28211,28190,28169,28148,28125,28102,
>>                          28079,28056,28033,28010,27987,27964,27941,27918,
>>                          27895,27872,27849,27826,27803,27780,27757,27734,
>>                          27711,27688,27665,27642,27619,27596],
>>                         [27573]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.756.0>,active,{0,nil}},
>>                        49}},
>>                   {{ch,<0.572.0>},
>>                    {cr,<0.572.0>,#Ref<0.0.0.7536>,
>>                        {[28709,28690,28671,28652,28633,28608,28590,28572,
>>                          28554,28536,28518,28500,28482,28464,28446,28428,
>>                          28410,28392,28374,28356,28338,28319,28298,28277,
>>                          28256,28235,28214,28193,28172,28151,28128,28105,
>>                          28082,28059,28036,28013,27990,27967,27944,27921,
>>                          27898,27875,27852,27829,27806,27783,27760,27737,
>>                          27714,27691,27668,27645,27622,27599],
>>                         [27576]},
>>                        1,
>>                        {[],[]},
>>                        {qstate,<0.571.0>,active,{0,nil}},
>>                        35}},
>>                   {{credit_to,<7350.825.0>},2},
>>                   {{credit_to,<7350.858.0>},3}]
>>     trap_exit: true
>>     status: running
>>     heap_size: 121536
>>     stack_size: 27
>>     reductions: 9363545
>>   neighbours:
>>
>> =SUPERVISOR REPORT==== 18-May-2013::01:41:51 ===
>>      Supervisor: {local,rabbit_amqqueue_sup}
>>      Context:    child_terminated
>>      Reason:     {{case_clause,{empty,{[],[]}}},
>>                   [{rabbit_amqqueue_process,subtract_acks,3,[]},
>>                    {rabbit_amqqueue_process,subtract_acks,4,[]},
>>                    {rabbit_amqqueue_process,handle_cast,2,[]},
>>                    {gen_server2,handle_msg,2,[]},
>>
>>  {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>>      Offender:   [{pid,<0.301.0>},
>>                   {name,rabbit_amqqueue},
>>                   {mfa,
>>                       {rabbit_amqqueue_process,start_link,
>>                           [{amqqueue,
>>                                {resource,<<"/">>,queue,
>>                                    <<"document_queue">>},
>>
>>  true,false,none,[],<0.7622.0>,[],[],undefined,
>>                                []}]}},
>>                   {restart_type,temporary},
>>                   {shutdown,4294967295},
>>                   {child_type,worker}]
>
>
> Notice how the *case_clause *is *empty*.  The other rabbit log looks
> similar:
>
> # cat /var/log/rabbitmq/rabbit at ip-10-123-123-123.log
>
>
>
> =ERROR REPORT==== 18-May-2013::01:41:48 ===
>
> ** Generic server <0.301.0> terminating
>
> ** Last message in was {'$gen_cast',
>
>                            {ack,
>
>                                [27585,27584,27607,27630,27653,27676,27699,
>
>                                 27722,27745,27768,27791,27814,27837,27860,
>
>                                 27883,27906,27929,27952,27975,27998,28021,
>
>                                 28044,28067,28090,28113,28136,28159,28180,
>
>                                 28201,28222,28243,28264,28285,28306,28325,
>
>                                 28343,28361,28379,28397,28415,28433,28451,
>
>                                 28469,28487,28505,28523,28541,28559,28577,
>
>                                 28595,28613],
>
>                                <0.676.0>}}
>
> ** When Server state == {q,
>
>                          {amqqueue,
>
>                           {resource,<<"/">>,queue,
>
>                            <<"document_queue">>},
>
>                           true,false,none,[],<0.301.0>,[],[],undefined,[]},
>
>                          none,true,rabbit_variable_queue,
>
>                          {vqstate,
>
>                           {0,{[],[]}},
>
>                           {0,{[],[]}},
>
>                           {delta,undefined,0,undefined},
>
>                           {0,{[],[]}},
>
>                           {0,{[],[]}},
>
> *                          ... [ thousands of lines of state ] ... *
>
>
>
> ** Reason for termination ==
>
> ** {{case_clause,{empty,{[],[]}}},
>
>     [{rabbit_amqqueue_process,subtract_acks,3,[]},
>
>      {rabbit_amqqueue_process,subtract_acks,4,[]},
>
>      {rabbit_amqqueue_process,handle_cast,2,[]},
>
>      {gen_server2,handle_msg,2,[]},
>
>      {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>
>
>> =ERROR REPORT==== 18-May-2013::01:41:51 ===
>
> connection <0.430.0>, channel 22 - soft error:
>
> {amqp_error,not_found,
>
>             "no queue 'document_queue' in vhost '/'",
>
>             'queue.declare'}
>
>
>> =ERROR REPORT==== 18-May-2013::01:41:51 ===
>
> connection <0.384.0>, channel 12 - soft error:
>
> {amqp_error,not_found,
>
>             "no queue 'document_queue' in vhost '/'",
>
>             'queue.declare'}
>
>
>> =ERROR REPORT==== 18-May-2013::01:41:51 ===
>
> connection <0.384.0>, channel 15 - soft error:
>
> {amqp_error,not_found,
>
>             "no queue 'document_queue' in vhost '/'",
>
>             'queue.declare'}
>
>
>> =ERROR REPORT==== 18-May-2013::01:41:51 ===
>
> connection <0.373.0>, channel 23 - soft error:
>
> {amqp_error,not_found,
>
>             "no queue 'document_queue' in vhost '/'",
>
>             'queue.declare'}
>
> * ... [ repeated a bunch of times ] ...*
>
>
> I also see this in my */var/log/syslog* with regards to *beam.smp*:
>
> # cat /var/log/syslog
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176041] INFO: task
>> beam.smp:18971 blocked for more than 120 seconds.
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176053] "echo 0 >
>> /proc/sys/kernel/hung_task_timeout_secs" disables this message.
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176060] beam.smp
>>  D ffff8801bfd93700     0 18971  18962 0x00000000
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176065]
>>  ffff8801b11cdcb8 0000000000000282 0000000000000000 ffffffffffffffe0
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176070]
>>  ffff8801b11cdfd8 ffff8801b11cdfd8 ffff8801b11cdfd8 0000000000013700
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176075]
>>  ffff8801b3180000 ffff8801b35244a0 00007f500e2079e0 ffff8801b146bb80
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176079] Call Trace:
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176089]
>>  [<ffffffff8165434f>] schedule+0x3f/0x60
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176094]
>>  [<ffffffff8106aef5>] exit_mm+0x85/0x130
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176097]
>>  [<ffffffff8106b10e>] do_exit+0x16e/0x450
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176102]
>>  [<ffffffff810797aa>] ? __dequeue_signal+0x6a/0xb0
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176105]
>>  [<ffffffff8106b594>] do_group_exit+0x44/0xa0
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176108]
>>  [<ffffffff8107c36c>] get_signal_to_deliver+0x21c/0x420
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176113]
>>  [<ffffffff81014825>] do_signal+0x45/0x130
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176116]
>>  [<ffffffff8105539d>] ? set_next_entity+0xad/0xd0
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176120]
>>  [<ffffffff81014ad5>] do_notify_resume+0x65/0x80
>> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176124]
>>  [<ffffffff8165ea90>] int_signal+0x12/0x17
>> *... [ repeated 9 more times with same timestamp ] ...*
>
>
> There are no strange CPU spikes on my EC2 node based on AWS monitoring.
> The only thing that seems to stand out is that my writes to my EBS volume
> spike during the crash (~90 write OPs/sec, 4 MiB/sec write bandwidth,
> ~30ms/op write latency).
>
> My team and I are completely stumped and would appreciate any insight you
> might have to the crash reports.  Is this a problem with writes hanging
> when going against the EBS volume since EBS volumes are essentially network
> mounted?  Is there a way to configure rabbit to be more tolerant of these
> delays?
>
>
> For debugging purposes, below is the status output of one of the nodes
> when it is healthy (so you can see the versions of everything i'm running):
>
> # rabbitmqctl status
>> Status of node 'rabbit at ip-10-123-123-123' ...
>> [{pid,28978},
>>  {running_applications,
>>      [{rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
>>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
>>       {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"},
>>       {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.0-gitd541e9a"},
>>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},
>>       {rabbit,"RabbitMQ","3.1.0"},
>>       {os_mon,"CPO  CXC 138 46","2.2.11"},
>>       {inets,"INETS  CXC 138 49","5.9.4"},
>>       {mnesia,"MNESIA  CXC 138 12","4.8"},
>>       {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
>>       {xmerl,"XML parser","1.3.3"},
>>       {sasl,"SASL  CXC 138 11","2.3.1"},
>>       {stdlib,"ERTS  CXC 138 10","1.19.1"},
>>       {kernel,"ERTS  CXC 138 10","2.16.1"}]},
>>  {os,{unix,linux}},
>>  {erlang_version,
>>      "Erlang R16B (erts-5.10.1) [source-05f1189] [64-bit] [smp:8:8]
>> [async-threads:30] [hipe] [kernel-poll:true]\n"},
>>  {memory,
>>      [{total,60179048},
>>       {connection_procs,5274808},
>>       {queue_procs,13107264},
>>       {plugins,354272},
>>       {other_proc,9741830},
>>       {mnesia,150456},
>>       {mgmt_db,12248},
>>       {msg_index,34768},
>>       {other_ets,1148248},
>>       {binary,4905584},
>>       {code,19565863},
>>       {atom,703377},
>>       {other_system,5180330}]},
>>  {vm_memory_high_watermark,0.8},
>>  {vm_memory_limit,5828434329},
>>  {disk_free_limit,1000000000},
>>  {disk_free,3953344512},
>>  {file_descriptors,
>>
>>  [{total_limit,924},{total_used,6},{sockets_limit,829},{sockets_used,4}]},
>>  {processes,[{limit,1048576},{used,348}]},
>>  {run_queue,0},
>>  {uptime,3796}]
>> ...done.
>
>
> Note that I am using Erlang v16 from the Erlang Solutions repo (esl-erlang
> package).  I originally was using Erlang v14 from Ubuntu repos
> (erlang-base), but decided to upgrade hoping it would resolve the issue
> (which it did not).  I have also tried running RabbitMQ 3.0.4 without
> success.  This issue seems to affect both versions.
>
> Thanks,
> Karl
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130518/0529f34a/attachment.htm>

From karl.rieb at gmail.com  Sat May 18 13:50:12 2013
From: karl.rieb at gmail.com (Karl Rieb)
Date: Sat, 18 May 2013 12:50:12 +0000 (UTC)
Subject: [rabbitmq-discuss] Amazon EC2 spurious cluster timeouts
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C3302@VALVCSMBX001PH.val.vlss.local>
Message-ID: <loom.20130518T144428-914@post.gmane.org>

Maslinski, Ray <MaslinskiR at ...> writes:

> 
> 
> 
> Hello,
> ?
> I?ve been working with several two node clusters running various versions 
of 3.0.x, hosted on m1.small instances on Ubuntu 12.04.2 LTS in EC2.? The 
setup is essentially as described here
> 
> http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-
amazon-ec2/ with the main exception being that both of the RabbitMQ servers 
are in the same availability zone.? A while back I observed a half dozen or 
so occurrences over the course
>  of a week where the clusters would become partitioned, accompanied by a 
messages on each server such as:
> ?
> =ERROR REPORT==== 17-May-2013::01:56:45 ===
> ** Node 'rabbit <at> oemsg-new-29b15241' not responding **
> ** Removing (timedout) connection **
> ?
> =INFO REPORT==== 17-May-2013::01:56:45 ===
> rabbit on node 'rabbit <at> oemsg-new-29b15241' down
> ?
> Looking over the logs and EC2 metrics, I wasn?t able to identify any other 
anomalies that coincided with these failures.? In particular, the load 
balancers in front of the cluster nodes did not report any health check 
failures connecting
>  to the amqp port (on a 30 second interval), suggesting that network 
connectivity was otherwise healthy, and there didn?t appear to be any 
unexpected spikes in resource consumption (such as excessive 
cpu/disk/network activity).? The rabbit servers were fairly
>  lightly loaded with messaging traffic at the time, and running some load 
tests against the same servers afterwards didn?t induce any further failures 
over the course of several days.? I tried increasing the net_ticktime to 
something like 5 or 10 minutes, but
>  still observed a failure with the new value.
> ?
> I left several clusters running over an extended period, most with little 
or no load, with one cluster running under an extended load test.? Several 
of the clusters experienced no failures over the course of a couple of 
months, while others
>  became partitioned after a while (though they seemed to survive for at 
least a few weeks before partition).
> ?
> Anyone experience anything similar in EC2, or have any ideas what else 
might be done to diagnose what?s going on?
> ?
> Ray Maslinski
> Senior Software Developer, Engineering
> Valassis / Digital Media
> Cell: 585.330.2426
> maslinskir at valassis.com
> www.valassis.com
> ?
> Creating the future of intelligent media delivery to drive your greatest 
success_____________________________________________________________________
________
> This message may include proprietary or protected information. If you are 
not the intended?
> recipient, please notify me, delete this message and do not further 
communicate the information?
> contained herein without my express consent.
> ?
> 
> 
> 
> <div>
> <div class="WordSection1">
> <p class="MsoNormal">Hello,<p></p></p>
> <p class="MsoNormal"><p>?</p></p>
> <p class="MsoNormal">I?ve been working with several two node 
clusters running various versions of 3.0.x, hosted on m1.small instances on 
Ubuntu 12.04.2 LTS in EC2.? The setup is essentially as described here
> <a href="http://karlgrz.com/rabbitmq-highly-available-queues-and-
clustering-using-amazon-ec2/">
> http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-
amazon-ec2/</a> with the main exception being that both of the RabbitMQ 
servers are in the same availability zone.? A while back I observed a 
half dozen or so occurrences over the course
>  of a week where the clusters would become partitioned, accompanied by a 
messages on each server such as:<p></p></p>
> <p class="MsoNormal"><p>?</p></p>
> <p class="MsoNormal">=ERROR REPORT==== 17-May-2013::01:56:45 ===<p></p>
</p>
> <p class="MsoNormal">** Node 'rabbit <at> oemsg-new-29b15241' not 
responding **?p></p></p>
> <p class="MsoNormal">** Removing (timedout) connection **?p></p></p>
> <p class="MsoNormal"><p>?</p></p>
> <p class="MsoNormal">=INFO REPORT==== 17-May-2013::01:56:45 ===<p></p></p>
> <p class="MsoNormal">rabbit on node 'rabbit <at> oemsg-new-29b15241' 
down<p></p></p>
> <p class="MsoNormal"><p>?</p></p>
> <p class="MsoNormal">Looking over the logs and EC2 metrics, I wasn?t 
able to identify any other anomalies that coincided with these 
failures.? In particular, the load balancers in front of the cluster 
nodes did not report any health check failures connecting
>  to the amqp port (on a 30 second interval), suggesting that network 
connectivity was otherwise healthy, and there didn?t appear to be any 
unexpected spikes in resource consumption (such as excessive 
cpu/disk/network activity).? The rabbit servers were fairly
>  lightly loaded with messaging traffic at the time, and running some load 
tests against the same servers afterwards didn?t induce any further 
failures over the course of several days.? I tried increasing the 
net_ticktime to something like 5 or 10 minutes, but
>  still observed a failure with the new value.<p></p></p>
> <p class="MsoNormal"><p>?</p></p>
> <p class="MsoNormal">I left several clusters running over an extended 
period, most with little or no load, with one cluster running under an 
extended load test.? Several of the clusters experienced no failures 
over the course of a couple of months, while others
>  became partitioned after a while (though they seemed to survive for at 
least a few weeks before partition).<p></p></p>
> <p class="MsoNormal"><p>?</p></p>
> <p class="MsoNormal">Anyone experience anything similar in EC2, or have 
any ideas what else might be done to diagnose what?s going on?<p></p>
</p>
> <p class="MsoNormal"><p>?</p></p>
> <p class="MsoNormal"><span>Ray Maslinski<p></p></span></p>
> <p class="MsoNormal"><span>Senior Software Developer, Engineering</span>
<p></p></p>
> <p class="MsoNormal"><span>Valassis / Digital Media</span><p></p></p>
> <p class="MsoNormal"><span>Cell: 585.330.2426</span><p></p></p>
> <p class="MsoNormal"><span>maslinskir at ...</span><p></p></p>
> <p class="MsoNormal"><a href="http://www.valassis.com/">
<span>www.valassis.com</span></a><span><p></p></span></p>
> <p class="MsoNormal"><span><p>?</p></span></p>
> <p class="MsoNormal"><span>Creating the future of intelligent media 
delivery to drive your greatest success<br></span><span><br></span>
<span>______________________________________________________________________
_______</span><span><br><br>
> This message may include proprietary or protected information. If you are 
not the intended?<p></p></span></p>
> <p class="MsoNormal"><span>recipient, please notify me, delete this 
message and do not further communicate the information?<br>
> contained herein without my express consent.<p></p></span></p>
> <p class="MsoNormal"><p>?</p></p>
> </div>
> </div>
> 


Hi Ray,

We used 3.0.4 and 3.1.0 versions of RabbitMQ in a cluster on Ubuntu 12.04 
LTS in EC2 on c1.xlarge instances.  We are in the us-east-1a availability 
zone and have noticed that periodically (seemingly at random times), there 
appears to be a network blip across most of our instances.  Every instance 
with a connection to our postgresql server will suddenly have their 
connections timeout (with socket timeout errors).  This is across all our 
instances!  At essentially the exact same time!  Then, we notice RabbitMQ do 
really strange things (notably, my recent post about RabbitMQ crashing 
during subtract_acks call because a queue just disappears).

We have been in contact with AWS support, but so far they aren't sure what 
is wrong.  For the most part our services can eventually recover from the 
network blip (eventually being like 30 minutes)... but we don't really 
survive the rabbit node crashing and never coming back up.  So far AWS has 
suggested we perform packet captures and send them the captures during one 
of the crashes.

Let me know if you guys figure out anything.

-Karl


From karl.rieb at gmail.com  Sat May 18 13:57:23 2013
From: karl.rieb at gmail.com (Karl Rieb)
Date: Sat, 18 May 2013 12:57:23 +0000 (UTC)
Subject: [rabbitmq-discuss]
	=?utf-8?q?Strange_subtract=5Facks_crash_in_Rab?=
	=?utf-8?q?bitMQ_3=2E1=2E0-1_=28case=5Fclause_empty=29_on_EC2?=
References: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
	<CALPqkipk5DFLH5XwfR8fW=fTVd4tJWsC8XwC+qXctgaxW7vHCQ@mail.gmail.com>
Message-ID: <loom.20130518T145120-367@post.gmane.org>

Brett Cameron <brett.r.cameron at ...> writes:

> 
> 
> 
> Karl,Wild speculation would be that messages have been consumed from a 
queue but that queue (name = document_queue?) is for some reason missing in 
action (gone, inaccessible, ...) when the consumer subsequently tries to ack 
the message(s). 
> Brett
> 
> 
> On Sat, May 18, 2013 at 3:20 PM, Karl Rieb <karl.rieb <at> gmail.com> 
wrote:Hi,
> I am running a RabbitMQ cluster of 4 nodes in AWS EC2 on c1.xlarge 
instances using Ubuntu 12.04 LTS (kernel 3.2.0-38). ?Periodically two of my 
nodes holding the largest queues will crash and require me to restart the 
rabbitmq-server service. ?Looking at the logs, I'm at a loss as to why the 
crash is occurring. ?I've have tried reproducing the crash manually by 
flooding my nodes with messages, but that doesn't seem to trigger the issue. 
?Below is output from various RabbitMQ logs:
> 
> # cat /var/log/rabbitmq/rabbit <at> ip-10-123-123-123-sasl.log
> =CRASH REPORT==== 18-May-2013::01:41:51 ===? crasher:? ? initial call: 
gen:init_it/6? ? pid: <0.301.0>? ? registered_name: []? ? exception exit: 
{{case_clause,{empty,{[],[]}}},? ? ? ? ? ? ? ? ? ? 
?[{rabbit_amqqueue_process,subtract_acks,3,[]},
> ? ? ? ? ? ? ? ? ? ? ? {rabbit_amqqueue_process,subtract_acks,4,[]},? ? ? ? 
? ? ? ? ? ? ? {rabbit_amqqueue_process,handle_cast,2,[]},? ? ? ? ? ? ? ? ? ? 
? {gen_server2,handle_msg,2,[]},? ? ? ? ? ? ? ? ? ? ? {proc_lib,wake_up,3,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [{file,"proc_lib.erl"},{line,249}]}]}? ? ? 
in function ?gen_server2:terminate/3? ? ancestors: 
[rabbit_amqqueue_sup,rabbit_sup,<0.207.0>]? ? messages: [{'$gen_cast',
{resume,<0.676.0>}},
> ? ? ? ? ? ? ? ? ? {'$gen_cast',{ack,[27583,27606,27629,27652,27675,27698,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27721,27744,27767,27790,27813,27836,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27859,27882,27905,27928,27951,27974,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27997,28020,28043,28066,28089,28112,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28135,28158,28179,28200,28221,28242,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28263,28284,28305,28324,28342,28360,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28378,28396,28414,28432,28450,28468,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28486,28504,28522,28540,28558,28576,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28594,28612],? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 
? ? <0.737.0>}},
> ? ? ? ? ? ? ? ? ? {'$gen_cast',{resume,<0.737.0>}},? ? ? ? ? ? ? ? ? 
{'$gen_cast',{ack,[27608,27631,27654,27677,27700,27723,? ? ? ? ? ? ? ? ? ? ? 
? ? ? ? ? ? ? ?27746,27769,27792,27815,27838,27861,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27884,27907,27930,27953,27976,27999,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28022,28045,28068,28091,28114,28137,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28160,28181,28202,28223,28244,28265,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28286,28307,28326,28344,28362,28380,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28398,28416,28434,28452,28470,28488,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28506,28524,28542,28560,28578,28596,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28614],? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 
? ? ? <0.676.0>}},? ? ? ? ? ? ? ? ? {'$gen_cast',{ack,
[27578,27601,27624,27647,27670,27693,? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 
?27716,27739,27762,27785,27808,27831,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27854,27877,27900,27923,27946,27969,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27992,28015,28038,28061,28084,28107,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28130,28153,28174,28195,28216,28237,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28258,28279,28300,28321,28340,28358,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28376,28394,28412,28430,28448,28466,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28484,28502,28520,28538,28556,28574,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28592,28610],? ? ? ? ? ? ? ? ? ? ? ? 
? ? ? ? ? ? <0.716.0>}},? ? ? ? ? ? ? ? ? {'$gen_cast',{resume,<0.716.0>}},? 
? ? ? ? ? ? ? ? {'$gen_cast',{ack,[27582,27605,27628,27651,27674,27697,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27720,27743,27766,27789,27812,27835,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27858,27881,27904,27927,27950,27973,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?27996,28019,28042,28065,28088,28111,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28134,28157,28178,28199,28220,28241,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28262,28283,28304,28323,28341,28359,? ? ? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28377,28395,28413,28431,28449,28467,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28485,28503,28521,28539,28557,28575,? 
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?28593,28611],? ? ? ? ? ? ? ? ? ? ? ? ? ? 
? ? ? ? <0.737.0>}}]? ? links: [<0.300.0>]
> ? ? dictionary: [{{ch,<0.729.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.729.0>,#Ref<0.0.0.12296>,? ? ? ? ? ? ? ? ? ? ? 
?{[28715,28696,28677,28658,28639,28620,28602,28584,? ? ? ? ? ? ? ? ? ? ? ? 
?28566,28548,28530,28512,28494,28476,28458,28440,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28422,28404,28386,28368,28350,28332,28313,28292,? 
? ? ? ? ? ? ? ? ? ? ? ?28271,28250,28229,28208,28187,28166,28143,28120,? ? ? 
? ? ? ? ? ? ? ? ? ?28097,28074,28051,28028,28005,27982,27959,27936,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27913,27890,27867,27844,27821,27798,27775,27752,? 
? ? ? ? ? ? ? ? ? ? ? ?27729,27706,27683,27660,27637,27614],? ? ? ? ? ? ? ? 
? ? ? ? [27591]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.728.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? 
? ? ?11}},? ? ? ? ? ? ? ? ? {{credit_to,<7350.877.0>},22},? ? ? ? ? ? ? ? ? 
{{ch,<0.608.0>},? ? ? ? ? ? ? ? ? ?{cr,<0.608.0>,#Ref<0.0.0.9041>,
> ? ? ? ? ? ? ? ? ? ? ? ?{[28708,28689,28670,28651,28632,28607,28589,28571,? 
? ? ? ? ? ? ? ? ? ? ? ?28553,28535,28517,28499,28481,28463,28445,28427,? ? ? 
? ? ? ? ? ? ? ? ? ?28409,28391,28373,28355,28337,28318,28297,28276,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28255,28234,28213,28192,28171,28150,28127,28104,? 
? ? ? ? ? ? ? ? ? ? ? ?28081,28058,28035,28012,27989,27966,27943,27920,? ? ? 
? ? ? ? ? ? ? ? ? ?27897,27874,27851,27828,27805,27782,27759,27736,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27713,27690,27667,27644,27621,27598],? ? ? ? ? ? 
? ? ? ? ? ? [27575]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],
[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.607.0>,active,{0,nil}},
> ? ? ? ? ? ? ? ? ? ? ? ?38}},? ? ? ? ? ? ? ? ? {{ch,<0.624.0>},? ? ? ? ? ? 
? ? ? ?{cr,<0.624.0>,#Ref<0.0.0.9436>,? ? ? ? ? ? ? ? ? ? ? 
?{[28722,28703,28684,28665,28646],[28627]},? ? ? ? ? ? ? ? ? ? ? ?1,
> ? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,
<0.623.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?36}},? ? ? ? ? ? ? ? ? 
{{ch,<0.696.0>},? ? ? ? ? ? ? ? ? ?{cr,<0.696.0>,#Ref<0.0.0.11414>,
> ? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? ? ? ?2,? ? ? ? ? ? ? ? ? 
? ? ?{[],[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.695.0>,active,{0,nil}},? ? ? 
? ? ? ? ? ? ? ? ?24}},? ? ? ? ? ? ? ? ? {{ch,<0.564.0>},
> ? ? ? ? ? ? ? ? ? ?{cr,<0.564.0>,#Ref<0.0.0.7285>,? ? ? ? ? ? ? ? ? ? ? 
?{[28718,28699,28680,28661,28642],[28623]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? 
? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.563.0>,active,
{0,nil}},
> ? ? ? ? ? ? ? ? ? ? ? ?12}},? ? ? ? ? ? ? ? ? {{ch,<0.644.0>},? ? ? ? ? ? 
? ? ? ?{cr,<0.644.0>,#Ref<0.0.0.10071>,? ? ? ? ? ? ? ? ? ? ? 
?{[28713,28694,28675,28656,28637,28618,28600,28582,? ? ? ? ? ? ? ? ? ? ? ? 
?28564,28546,28528,28510,28492,28474,28456,28438,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28420,28402,28384,28366,28348,28330,28311,28290,? 
? ? ? ? ? ? ? ? ? ? ? ?28269,28248,28227,28206,28185,28164,28141,28118,? ? ? 
? ? ? ? ? ? ? ? ? ?28095,28072,28049,28026,28003,27980,27957,27934,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27911,27888,27865,27842,27819,27796,27773,27750,? 
? ? ? ? ? ? ? ? ? ? ? ?27727,27704,27681,27658,27635,27612],? ? ? ? ? ? ? ? 
? ? ? ? [27589]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.643.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? 
? ? ?11}},? ? ? ? ? ? ? ? ? {{ch,<0.676.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.676.0>,#Ref<0.0.0.11309>,? ? ? ? ? ? ? ? ? ? ? 
?{[28614,28613,28596,28595,28578,28577,28560,28559,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28542,28541,28524,28523,28506,28505,28488,28487,? 
? ? ? ? ? ? ? ? ? ? ? ?28470,28469,28452,28451,28434,28433,28416,28415,? ? ? 
? ? ? ? ? ? ? ? ? ?28398,28397,28380,28379,28362,28361,28344,28343,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28326,28325,28307,28306,28286,28285,28265,28264,? 
? ? ? ? ? ? ? ? ? ? ? ?28244,28243,28223,28222,28202,28201,28181,28180,? ? ? 
? ? ? ? ? ? ? ? ? ?28160,28159,28137,28136,28114,28113,28091,28090,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28068,28067,28045,28044,28022,28021,27999,27998,? 
? ? ? ? ? ? ? ? ? ? ? ?27976,27975,27953,27952,27930,27929,27907,27906,? ? ? 
? ? ? ? ? ? ? ? ? ?27884,27883,27861,27860,27838,27837,27815,27814,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27792,27791,27769,27768,27746,27745,27723,27722,? 
? ? ? ? ? ? ? ? ? ? ? ?27700,27699,27677,27676,27654,27653,27631,27630,? ? ? 
? ? ? ? ? ? ? ? ? ?27608,27607,27585],? ? ? ? ? ? ? ? ? ? ? ? [27584]},
> ? ? ? ? ? ? ? ? ? ? ? ?2,? ? ? ? ? ? ? ? ? ? ? ?{[{<0.676.0>,? ? ? ? ? ? ? 
? ? ? ? ? ? {consumer,<<"amq.ctag-0cvDGmyaAbEW_j15AfhGHQ">>,? ? ? ? ? ? ? ? 
? ? ? ? ? ? ? ? ? ? true}}],
> ? ? ? ? ? ? ? ? ? ? ? ? [{<0.676.0>,? ? ? ? ? ? ? ? ? ? ? ? ? {consumer,
<<"amq.ctag-YqU04SIfQv6P-QVueEjbRg">>,? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 
true}}]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.675.0>,suspended,{0,nil}},
> ? ? ? ? ? ? ? ? ? ? ? ?25}},? ? ? ? ? ? ? ? ? 
{{xtype_to_module,direct},rabbit_exchange_type_direct},? ? ? ? ? ? ? ? ? 
{{credit_to,<7350.833.0>},31},? ? ? ? ? ? ? ? ? {{ch,<0.745.0>},? ? ? ? ? ? 
? ? ? ?{cr,<0.745.0>,#Ref<0.0.0.12674>,
> ? ? ? ? ? ? ? ? ? ? ? ?{[28716,28697,28678,28659,28640,28621,28603,28585,? 
? ? ? ? ? ? ? ? ? ? ? ?28567,28549,28531,28513,28495,28477,28459,28441,? ? ? 
? ? ? ? ? ? ? ? ? ?28423,28405,28387,28369,28351,28333,28314,28293,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28272,28251,28230,28209,28188,28167,28144,28121,? 
? ? ? ? ? ? ? ? ? ? ? ?28098,28075,28052,28029,28006,27983,27960,27937,? ? ? 
? ? ? ? ? ? ? ? ? ?27914,27891,27868,27845,27822,27799,27776,27753,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27730,27707,27684,27661,27638,27615],? ? ? ? ? ? 
? ? ? ? ? ? [27592]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],
[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.744.0>,active,{0,nil}},
> ? ? ? ? ? ? ? ? ? ? ? ?37}},? ? ? ? ? ? ? ? ? {{ch,<0.660.0>},? ? ? ? ? ? 
? ? ? ?{cr,<0.660.0>,#Ref<0.0.0.10650>,? ? ? ? ? ? ? ? ? ? ? 
?{[28712,28693,28674,28655,28636,28617,28599,28581,? ? ? ? ? ? ? ? ? ? ? ? 
?28563,28545,28527,28509,28491,28473,28455,28437,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28419,28401,28383,28365,28347,28329,28310,28289,? 
? ? ? ? ? ? ? ? ? ? ? ?28268,28247,28226,28205,28184,28163,28140,28117,? ? ? 
? ? ? ? ? ? ? ? ? ?28094,28071,28048,28025,28002,27979,27956,27933,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27910,27887,27864,27841,27818,27795,27772,27749,? 
? ? ? ? ? ? ? ? ? ? ? ?27726,27703,27680,27657,27634,27611],? ? ? ? ? ? ? ? 
? ? ? ? [27588]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.659.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? 
? ? ?11}},? ? ? ? ? ? ? ? ? {{credit_to,<7350.837.0>},32},? ? ? ? ? ? ? ? ? 
{{credit_to,<7350.881.0>},17},? ? ? ? ? ? ? ? ? {{ch,<0.737.0>},
> ? ? ? ? ? ? ? ? ? ?{cr,<0.737.0>,#Ref<0.0.0.12429>,? ? ? ? ? ? ? ? ? ? ? 
?{[28612,28611,28594,28593,28576,28575,28558,28557,? ? ? ? ? ? ? ? ? ? ? ? 
?28540,28539,28522,28521,28504,28503,28486,28485,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28468,28467,28450,28449,28432,28431,28414,28413,? 
? ? ? ? ? ? ? ? ? ? ? ?28396,28395,28378,28377,28360,28359,28342,28341,? ? ? 
? ? ? ? ? ? ? ? ? ?28324,28323,28305,28304,28284,28283,28263,28262,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28242,28241,28221,28220,28200,28199,28179,28178,? 
? ? ? ? ? ? ? ? ? ? ? ?28158,28157,28135,28134,28112,28111,28089,28088,? ? ? 
? ? ? ? ? ? ? ? ? ?28066,28065,28043,28042,28020,28019,27997,27996,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27974,27973,27951,27950,27928,27927,27905,27904,? 
? ? ? ? ? ? ? ? ? ? ? ?27882,27881,27859,27858,27836,27835,27813,27812,? ? ? 
? ? ? ? ? ? ? ? ? ?27790,27789,27767,27766,27744,27743,27721,27720,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27698,27697,27675,27674,27652,27651,27629,27628,? 
? ? ? ? ? ? ? ? ? ? ? ?27606,27605,27583],? ? ? ? ? ? ? ? ? ? ? ? [27582]},? 
? ? ? ? ? ? ? ? ? ? ?2,? ? ? ? ? ? ? ? ? ? ? ?{[{<0.737.0>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? {consumer,<<"amq.ctag-
ITZqhulzHhUzx1uy1Eot3g">>,? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? true}}],? ? ? 
? ? ? ? ? ? ? ? ? [{<0.737.0>,? ? ? ? ? ? ? ? ? ? ? ? ? {consumer,
<<"amq.ctag-hpo5ejdoJRdLrT6JS42jGw">>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? true}}]},? ? ? ? ? ? ? ? ? ? ? 
?{qstate,<0.736.0>,suspended,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?11}},? ? ? ? ? 
? ? ? ? {credit_blocked,[]},? ? ? ? ? ? ? ? ? {{credit_to,<7350.854.0>},3},
> ? ? ? ? ? ? ? ? ? {{ch,<0.716.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.716.0>,#Ref<0.0.0.11820>,? ? ? ? ? ? ? ? ? ? ? 
?{[28610,28609,28592,28591,28574,28573,28556,28555,? ? ? ? ? ? ? ? ? ? ? ? 
?28538,28537,28520,28519,28502,28501,28484,28483,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28466,28465,28448,28447,28430,28429,28412,28411,? 
? ? ? ? ? ? ? ? ? ? ? ?28394,28393,28376,28375,28358,28357,28340,28339,? ? ? 
? ? ? ? ? ? ? ? ? ?28321,28320,28300,28299,28279,28278,28258,28257,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28237,28236,28216,28215,28195,28194,28174,28173,? 
? ? ? ? ? ? ? ? ? ? ? ?28153,28152,28130,28129,28107,28106,28084,28083,? ? ? 
? ? ? ? ? ? ? ? ? ?28061,28060,28038,28037,28015,28014,27992,27991,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27969,27968,27946,27945,27923,27922,27900,27899,? 
? ? ? ? ? ? ? ? ? ? ? ?27877,27876,27854,27853,27831,27830,27808,27807,? ? ? 
? ? ? ? ? ? ? ? ? ?27785,27784,27762,27761,27739,27738,27716,27715,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27693,27692,27670,27669,27647,27646,27624,27623,? 
? ? ? ? ? ? ? ? ? ? ? ?27601,27600,27578],? ? ? ? ? ? ? ? ? ? ? ? [27577]},? 
? ? ? ? ? ? ? ? ? ? ?2,? ? ? ? ? ? ? ? ? ? ? ?{[{<0.716.0>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? {consumer,<<"amq.ctag-BTlS-GmbXNpcU-
wUlMI60Q">>,? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? true}}],? ? ? ? ? ? ? ? ? ? 
? ? [{<0.716.0>,? ? ? ? ? ? ? ? ? ? ? ? ? {consumer,<<"amq.ctag-
loc5monF8M1pz_Bb8ypumw">>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? true}}]},? ? ? ? ? ? ? ? ? ? ? 
?{qstate,<0.715.0>,suspended,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?44}},? ? ? ? ? 
? ? ? ? {{ch,<0.782.0>},? ? ? ? ? ? ? ? ? ?{cr,<0.782.0>,#Ref<0.0.0.15649>,
> ? ? ? ? ? ? ? ? ? ? ? ?{[28714,28695,28676,28657,28638,28619,28601,28583,? 
? ? ? ? ? ? ? ? ? ? ? ?28565,28547,28529,28511,28493,28475,28457,28439,? ? ? 
? ? ? ? ? ? ? ? ? ?28421,28403,28385,28367,28349,28331,28312,28291,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28270,28249,28228,28207,28186,28165,28142,28119,? 
? ? ? ? ? ? ? ? ? ? ? ?28096,28073,28050,28027,28004,27981,27958,27935,? ? ? 
? ? ? ? ? ? ? ? ? ?27912,27889,27866,27843,27820,27797,27774,27751,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27728,27705,27682,27659,27636,27613],? ? ? ? ? ? 
? ? ? ? ? ? [27590]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],
[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.781.0>,active,{0,nil}},
> ? ? ? ? ? ? ? ? ? ? ? ?35}},? ? ? ? ? ? ? ? ? {{credit_to,
<7350.846.0>},22},? ? ? ? ? ? ? ? ? {{ch,<0.684.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.684.0>,#Ref<0.0.0.11198>,? ? ? ? ? ? ? ? ? ? ? 
?{[28711,28692,28673,28654,28635,28616,28598,28580,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28562,28544,28526,28508,28490,28472,28454,28436,? 
? ? ? ? ? ? ? ? ? ? ? ?28418,28400,28382,28364,28346,28328,28309,28288,? ? ? 
? ? ? ? ? ? ? ? ? ?28267,28246,28225,28204,28183,28162,28139,28116,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28093,28070,28047,28024,28001,27978,27955,27932,? 
? ? ? ? ? ? ? ? ? ? ? ?27909,27886,27863,27840,27817,27794,27771,27748,? ? ? 
? ? ? ? ? ? ? ? ? ?27725,27702,27679,27656,27633,27610],? ? ? ? ? ? ? ? ? ? 
? ? [27587]},
> ? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? 
? ? ?{qstate,<0.683.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?11}},? ? ? ? ? 
? ? ? ? {{ch,<0.692.0>},? ? ? ? ? ? ? ? ? ?{cr,<0.692.0>,#Ref<0.0.0.11088>,
> ? ? ? ? ? ? ? ? ? ? ? ?{[28710,28691,28672,28653,28634,28615,28597,28579,? 
? ? ? ? ? ? ? ? ? ? ? ?28561,28543,28525,28507,28489,28471,28453,28435,? ? ? 
? ? ? ? ? ? ? ? ? ?28417,28399,28381,28363,28345,28327,28308,28287,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28266,28245,28224,28203,28182,28161,28138,28115,? 
? ? ? ? ? ? ? ? ? ? ? ?28092,28069,28046,28023,28000,27977,27954,27931,? ? ? 
? ? ? ? ? ? ? ? ? ?27908,27885,27862,27839,27816,27793,27770,27747,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27724,27701,27678,27655,27632,27609],? ? ? ? ? ? 
? ? ? ? ? ? [27586]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],
[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.691.0>,active,{0,nil}},
> ? ? ? ? ? ? ? ? ? ? ? ?12}},? ? ? ? ? ? ? ? ? {{ch,<0.648.0>},? ? ? ? ? ? 
? ? ? ?{cr,<0.648.0>,#Ref<0.0.0.10283>,? ? ? ? ? ? ? ? ? ? ? 
?{[28717,28698,28679,28660,28641],[28622]},? ? ? ? ? ? ? ? ? ? ? ?1,
> ? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,
<0.647.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?12}},? ? ? ? ? ? ? ? ? 
{guid,{{2296174761,591959305,1562876388,1822892473},1}},
> ? ? ? ? ? ? ? ? ? {{ch,<0.720.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.720.0>,#Ref<0.0.0.12036>,? ? ? ? ? ? ? ? ? ? ? 
?{[28723,28704,28685,28666,28647],[28628]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? 
? ? ? ? ? ? ? ?{[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.719.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? 
? ? ?37}},? ? ? ? ? ? ? ? ? {{credit_to,<7350.869.0>},39},? ? ? ? ? ? ? ? ? 
{{ch,<0.636.0>},? ? ? ? ? ? ? ? ? ?{cr,<0.636.0>,#Ref<0.0.0.9960>,
> ? ? ? ? ? ? ? ? ? ? ? ?{[28705,28686,28667,28648,28629,28604,28586,28568,? 
? ? ? ? ? ? ? ? ? ? ? ?28550,28532,28514,28496,28478,28460,28442,28424,? ? ? 
? ? ? ? ? ? ? ? ? ?28406,28388,28370,28352,28334,28315,28294,28273,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28252,28231,28210,28189,28168,28147,28124,28101,? 
? ? ? ? ? ? ? ? ? ? ? ?28078,28055,28032,28009,27986,27963,27940,27917,? ? ? 
? ? ? ? ? ? ? ? ? ?27894,27871,27848,27825,27802,27779,27756,27733,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27710,27687,27664,27641,27618,27595],? ? ? ? ? ? 
? ? ? ? ? ? [27572]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],
[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.635.0>,active,{0,nil}},
> ? ? ? ? ? ? ? ? ? ? ? ?15}},? ? ? ? ? ? ? ? ? {{credit_to,
<7350.850.0>},50},? ? ? ? ? ? ? ? ? {{ch,<0.616.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.616.0>,#Ref<0.0.0.9300>,? ? ? ? ? ? ? ? ? ? ? 
?{[28719,28700,28681,28662,28643],[28624]},
> ? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? 
? ? ?{qstate,<0.615.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?12}},? ? ? ? ? 
? ? ? ? {{ch,<0.509.0>},? ? ? ? ? ? ? ? ? ?{cr,<0.509.0>,#Ref<0.0.0.2243>,
> ? ? ? ? ? ? ? ? ? ? ? ?{[28302,28281,28260,28239,28218,28197,28176,28155,? 
? ? ? ? ? ? ? ? ? ? ? ?28132,28109,28086,28063,28040,28017,27994,27971],? ? 
? ? ? ? ? ? ? ? ? ? [27580,27603,27626,27649,27672,27695,27718,27741,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27764,27787,27810,27833,27856,27879,27902,27925,? 
? ? ? ? ? ? ? ? ? ? ? ?27948]},? ? ? ? ? ? ? ? ? ? ? ?3,? ? ? ? ? ? ? ? ? ? 
? ?{[],[]},? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.508.0>,active,{0,nil}},
> ? ? ? ? ? ? ? ? ? ? ? ?36}},? ? ? ? ? ? ? ? ? {{credit_to,
<7350.873.0>},17},? ? ? ? ? ? ? ? ? {{ch,<0.588.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.588.0>,#Ref<0.0.0.7808>,? ? ? ? ? ? ? ? ? ? ? 
?{[28721,28702,28683,28664,28645],[28626]},
> ? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? 
? ? ?{qstate,<0.587.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?12}},? ? ? ? ? 
? ? ? ? {{ch,<0.664.0>},? ? ? ? ? ? ? ? ? ?{cr,<0.664.0>,#Ref<0.0.0.10772>,
> ? ? ? ? ? ? ? ? ? ? ? ?{[28720,28701,28682,28663,28644],[28625]},? ? ? ? ? 
? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? ? ? 
?{qstate,<0.663.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?13}},
> ? ? ? ? ? ? ? ? ? {fhc_age_tree,{0,nil}},? ? ? ? ? ? ? ? ? {{ch,
<0.708.0>},? ? ? ? ? ? ? ? ? ?{cr,<0.708.0>,#Ref<0.0.0.11695>,? ? ? ? ? ? ? 
? ? ? ? ?{[28707,28688,28669,28650,28631,28606,28588,28570,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28552,28534,28516,28498,28480,28462,28444,28426,? 
? ? ? ? ? ? ? ? ? ? ? ?28408,28390,28372,28354,28336,28317,28296,28275,? ? ? 
? ? ? ? ? ? ? ? ? ?28254,28233,28212,28191,28170,28149,28126,28103,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28080,28057,28034,28011,27988,27965,27942,27919,? 
? ? ? ? ? ? ? ? ? ? ? ?27896,27873,27850,27827,27804,27781,27758,27735,? ? ? 
? ? ? ? ? ? ? ? ? ?27712,27689,27666,27643,27620,27597],? ? ? ? ? ? ? ? ? ? 
? ? [27574]},
> ? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? 
? ? ?{qstate,<0.707.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?35}},? ? ? ? ? 
? ? ? ? {{credit_to,<7350.829.0>},13},
> ? ? ? ? ? ? ? ? ? {{ch,<0.757.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.757.0>,#Ref<0.0.0.13150>,? ? ? ? ? ? ? ? ? ? ? 
?{[28706,28687,28668,28649,28630,28605,28587,28569,? ? ? ? ? ? ? ? ? ? ? ? 
?28551,28533,28515,28497,28479,28461,28443,28425,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28407,28389,28371,28353,28335,28316,28295,28274,? 
? ? ? ? ? ? ? ? ? ? ? ?28253,28232,28211,28190,28169,28148,28125,28102,? ? ? 
? ? ? ? ? ? ? ? ? ?28079,28056,28033,28010,27987,27964,27941,27918,
> ? ? ? ? ? ? ? ? ? ? ? ? ?27895,27872,27849,27826,27803,27780,27757,27734,? 
? ? ? ? ? ? ? ? ? ? ? ?27711,27688,27665,27642,27619,27596],? ? ? ? ? ? ? ? 
? ? ? ? [27573]},? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ?{qstate,<0.756.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? 
? ? ?49}},? ? ? ? ? ? ? ? ? {{ch,<0.572.0>},? ? ? ? ? ? ? ? ? ?{cr,
<0.572.0>,#Ref<0.0.0.7536>,? ? ? ? ? ? ? ? ? ? ? 
?{[28709,28690,28671,28652,28633,28608,28590,28572,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28554,28536,28518,28500,28482,28464,28446,28428,? 
? ? ? ? ? ? ? ? ? ? ? ?28410,28392,28374,28356,28338,28319,28298,28277,? ? ? 
? ? ? ? ? ? ? ? ? ?28256,28235,28214,28193,28172,28151,28128,28105,
> ? ? ? ? ? ? ? ? ? ? ? ? ?28082,28059,28036,28013,27990,27967,27944,27921,? 
? ? ? ? ? ? ? ? ? ? ? ?27898,27875,27852,27829,27806,27783,27760,27737,? ? ? 
? ? ? ? ? ? ? ? ? ?27714,27691,27668,27645,27622,27599],? ? ? ? ? ? ? ? ? ? 
? ? [27576]},
> ? ? ? ? ? ? ? ? ? ? ? ?1,? ? ? ? ? ? ? ? ? ? ? ?{[],[]},? ? ? ? ? ? ? ? ? 
? ? ?{qstate,<0.571.0>,active,{0,nil}},? ? ? ? ? ? ? ? ? ? ? ?35}},? ? ? ? ? 
? ? ? ? {{credit_to,<7350.825.0>},2},? ? ? ? ? ? ? ? ? {{credit_to,
<7350.858.0>},3}]
> ? ? trap_exit: true? ? status: running? ? heap_size: 121536? ? stack_size: 
27? ? reductions: 9363545? neighbours:=SUPERVISOR REPORT==== 18-May-
2013::01:41:51 ===? ? ?Supervisor: {local,rabbit_amqqueue_sup}
> ? ? ?Context: ? ?child_terminated? ? ?Reason: ? ? {{case_clause,{empty,
{[],[]}}},? ? ? ? ? ? ? ? ? [{rabbit_amqqueue_process,subtract_acks,3,[]},? 
? ? ? ? ? ? ? ? ?{rabbit_amqqueue_process,subtract_acks,4,[]},
> ? ? ? ? ? ? ? ? ? ?{rabbit_amqqueue_process,handle_cast,2,[]},? ? ? ? ? ? 
? ? ? ?{gen_server2,handle_msg,2,[]},? ? ? ? ? ? ? ? ? ?{proc_lib,wake_up,3,
[{file,"proc_lib.erl"},{line,249}]}]}? ? ?Offender: ? [{pid,<0.301.0>},
> ? ? ? ? ? ? ? ? ? {name,rabbit_amqqueue},? ? ? ? ? ? ? ? ? {mfa,? ? ? ? ? 
? ? ? ? ? ? {rabbit_amqqueue_process,start_link,? ? ? ? ? ? ? ? ? ? ? ? ? 
[{amqqueue,? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{resource,<<"/">>,queue,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"document_queue">>},? ? ? ? ? ? ? ? ? 
? ? ? ? ? ? ?true,false,none,[],<0.7622.0>,[],[],undefined,? ? ? ? ? ? ? ? ? 
? ? ? ? ? ? ?[]}]}},? ? ? ? ? ? ? ? ? {restart_type,temporary},
> ? ? ? ? ? ? ? ? ? {shutdown,4294967295},? ? ? ? ? ? ? ? ? 
{child_type,worker}]
> 
> Notice how the case_clause is empty. ?The other rabbit log looks similar:
> 
> # cat /var/log/rabbitmq/rabbit-
72dRMgatfUn5amjFlPYPZgfGRAsWV3w2 at public.gmane.org?
> ?
> 
> =ERROR REPORT==== 18-May-2013::01:41:48 ===
> ** Generic server <0.301.0> terminating
> ** Last message in was {'$gen_cast',
> 
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{ack,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[27585,27584,27607,27630,27653,27676,27699,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 27722,27745,27768,27791,27814,27837,27860,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 27883,27906,27929,27952,27975,27998,28021,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 28044,28067,28090,28113,28136,28159,28180,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 28201,28222,28243,28264,28285,28306,28325,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 28343,28361,28379,28397,28415,28433,28451,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 28469,28487,28505,28523,28541,28559,28577,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 28595,28613],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?<0.676.0>}}
> ** When Server state == {q,
> 
> ? ? ? ? ? ? ? ? ? ? ? ? ?{amqqueue,
> ? ? ? ? ? ? ? ? ? ? ? ? ? {resource,<<"/">>,queue,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"document_queue">>},
> ? ? ? ? ? ? ? ? ? ? ? ? ? true,false,none,[],<0.301.0>,[],[],undefined,
[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ?none,true,rabbit_variable_queue,
> ? ? ? ? ? ? ? ? ? ? ? ? ?{vqstate,
> 
> ? ? ? ? ? ? ? ? ? ? ? ? ? {0,{[],[]}},
> ? ? ? ? ? ? ? ? ? ? ? ? ? {0,{[],[]}},
> ? ? ? ? ? ? ? ? ? ? ? ? ? {delta,undefined,0,undefined},
> ? ? ? ? ? ? ? ? ? ? ? ? ? {0,{[],[]}},
> 
> ? ? ? ? ? ? ? ? ? ? ? ? ? {0,{[],[]}},?
> ? ? ? ? ? ? ? ? ? ? ? ? ? ... [ thousands of lines of state ] ...?
> ?
> 
> ** Reason for termination ==
> ** {{case_clause,{empty,{[],[]}}},
> ? ? [{rabbit_amqqueue_process,subtract_acks,3,[]},
> ? ? ?{rabbit_amqqueue_process,subtract_acks,4,[]},
> ? ? ?{rabbit_amqqueue_process,handle_cast,2,[]},
> ? ? ?{gen_server2,handle_msg,2,[]},
> 
> ? ? ?{proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
> 
> 
> 
> =ERROR REPORT==== 18-May-2013::01:41:51 ===
> connection <0.430.0>, channel 22 - soft error:
> {amqp_error,not_found,
> 
> ? ? ? ? ? ? "no queue 'document_queue' in vhost '/'",
> 
> ? ? ? ? ? ? 'queue.declare'}
> 
> =ERROR REPORT==== 18-May-2013::01:41:51 ===
> 
> connection <0.384.0>, channel 12 - soft error:
> 
> {amqp_error,not_found,
> ? ? ? ? ? ? "no queue 'document_queue' in vhost '/'",
> ? ? ? ? ? ? 'queue.declare'}
> 
> 
> 
> =ERROR REPORT==== 18-May-2013::01:41:51 ===
> connection <0.384.0>, channel 15 - soft error:
> {amqp_error,not_found,
> 
> ? ? ? ? ? ? "no queue 'document_queue' in vhost '/'",
> 
> ? ? ? ? ? ? 'queue.declare'}
> 
> =ERROR REPORT==== 18-May-2013::01:41:51 ===
> 
> connection <0.373.0>, channel 23 - soft error:
> 
> {amqp_error,not_found,
> ? ? ? ? ? ? "no queue 'document_queue' in vhost '/'",
> ? ? ? ? ? ? 'queue.declare'}?
> 
> ?... [ repeated a bunch of times ] ...
> 
> I also see this in my /var/log/syslog?with regards to beam.smp:
> 
> 
> # cat /var/log/syslogMay 17 22:46:23 ip-10-123-123-123 kernel: 
[244800.176041] INFO: task beam.smp:18971 blocked for more than 120 
seconds.May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176053] "echo 0 > 
/proc/sys/kernel/hung_task_timeout_secs" disables this message.
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176060] beam.smp ? ? ? 
?D ffff8801bfd93700 ? ? 0 18971 ?18962 0x00000000May 17 22:46:23 ip-10-123-
123-123 kernel: [244800.176065] ?ffff8801b11cdcb8 0000000000000282 
0000000000000000 ffffffffffffffe0
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176070] 
?ffff8801b11cdfd8 ffff8801b11cdfd8 ffff8801b11cdfd8 0000000000013700May 17 
22:46:23 ip-10-123-123-123 kernel: [244800.176075] ?ffff8801b3180000 
ffff8801b35244a0 00007f500e2079e0 ffff8801b146bb80
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176079] Call Trace:May 
17 22:46:23 ip-10-123-123-123 kernel: [244800.176089] ?[<ffffffff8165434f>] 
schedule+0x3f/0x60May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176094] 
?[<ffffffff8106aef5>] exit_mm+0x85/0x130
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176097] 
?[<ffffffff8106b10e>] do_exit+0x16e/0x450May 17 22:46:23 ip-10-123-123-123 
kernel: [244800.176102] ?[<ffffffff810797aa>] ? __dequeue_signal+0x6a/0xb0
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176105] 
?[<ffffffff8106b594>] do_group_exit+0x44/0xa0May 17 22:46:23 ip-10-123-123-
123 kernel: [244800.176108] ?[<ffffffff8107c36c>] 
get_signal_to_deliver+0x21c/0x420
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176113] 
?[<ffffffff81014825>] do_signal+0x45/0x130May 17 22:46:23 ip-10-123-123-123 
kernel: [244800.176116] ?[<ffffffff8105539d>] ? set_next_entity+0xad/0xd0
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176120] 
?[<ffffffff81014ad5>] do_notify_resume+0x65/0x80May 17 22:46:23 ip-10-123-
123-123 kernel: [244800.176124] ?[<ffffffff8165ea90>] 
int_signal+0x12/0x17... [ repeated 9 more times with same timestamp ] ...
> 
> There are no strange CPU spikes on my EC2 node based on AWS monitoring. 
The only thing that seems to stand out is that my writes to my EBS volume 
spike during the crash (~90 write OPs/sec, 4 MiB/sec write bandwidth, 
~30ms/op write latency).
> 
> My team and I are completely stumped and would appreciate any insight you 
might have to the crash reports. ?Is this a problem with writes hanging when 
going against the EBS volume since EBS volumes are essentially network 
mounted? ?Is there a way to configure rabbit to be more tolerant of these 
delays? ?
> 
> 
> For debugging purposes, below is the status output of one of the nodes 
when it is healthy (so you can see the versions of everything i'm running):
> 
> 
> 
> # rabbitmqctl statusStatus of node 'rabbit <at> ip-10-123-123-123' ...
[{pid,28978},?{running_applications,? ? ?[{rabbitmq_management,"RabbitMQ 
Management Console","3.1.0"},? ? ? {rabbitmq_web_dispatch,"RabbitMQ Web 
Dispatcher","3.1.0"},
> ? ? ? {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"},? ? ? 
{mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.0-gitd541e9a"},? ? ? 
{rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},
> ? ? ? {rabbit,"RabbitMQ","3.1.0"},? ? ? {os_mon,"CPO ?CXC 138 
46","2.2.11"},? ? ? {inets,"INETS ?CXC 138 49","5.9.4"},? ? ? 
{mnesia,"MNESIA ?CXC 138 12","4.8"},
> ? ? ? {amqp_client,"RabbitMQ AMQP Client","3.1.0"},? ? ? {xmerl,"XML 
parser","1.3.3"},? ? ? {sasl,"SASL ?CXC 138 11","2.3.1"},? ? ? {stdlib,"ERTS 
?CXC 138 10","1.19.1"},
> ? ? ? {kernel,"ERTS ?CXC 138 10","2.16.1"}]},?{os,
{unix,linux}},?{erlang_version,? ? ?"Erlang R16B (erts-5.10.1) [source-
05f1189] [64-bit] [smp:8:8] [async-threads:30] [hipe] [kernel-
poll:true]\n"},
> ?{memory,? ? ?[{total,60179048},? ? ? {connection_procs,5274808},? ? ? 
{queue_procs,13107264},? ? ? {plugins,354272},? ? ? {other_proc,9741830},
> ? ? ? {mnesia,150456},? ? ? {mgmt_db,12248},? ? ? {msg_index,34768},? ? ? 
{other_ets,1148248},? ? ? {binary,4905584},? ? ? {code,19565863},? ? ? 
{atom,703377},? ? ? {other_system,5180330}]},
> 
?{vm_memory_high_watermark,0.8},?{vm_memory_limit,5828434329},?{disk_free_li
mit,1000000000},?{disk_free,3953344512},?{file_descriptors,? ? 
?[{total_limit,924},{total_used,6},{sockets_limit,829},{sockets_used,4}]},
> ?{processes,[{limit,1048576},
{used,348}]},?{run_queue,0},?{uptime,3796}]...done.
> 
> Note that I am using Erlang v16 from the Erlang Solutions repo (esl-erlang 
package). ?I originally was using Erlang v14 from Ubuntu repos (erlang-
base), but decided to upgrade hoping it would resolve the issue (which it 
did not). ?I have also tried running RabbitMQ 3.0.4 without success. ?This 
issue seems to affect both versions.
> 
> Thanks,
> Karl
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss <at> 
lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-
bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> 
> 
> <div>
> <div dir="ltr">
> <div>Karl,<br><br>Wild speculation would be that messages have been 
consumed from a queue but that queue (name = document_queue?) is for some 
reason missing in action (gone, inaccessible, ...) when the consumer 
subsequently tries to ack the message(s). <br><br>
> </div>Brett<br><br>
> </div>
> <div class="gmail_extra">
> <br><br><div class="gmail_quote">On Sat, May 18, 2013 at 3:20 PM, Karl 
Rieb <span dir="ltr">&lt;<a href="mailto:karl.rieb at ..." 
target="_blank">karl.rieb <at> gmail.com</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote">Hi,<div><br></div>
> <div>I am running a RabbitMQ cluster of 4 nodes in AWS EC2 on c1.xlarge 
instances using Ubuntu 12.04 LTS (kernel 3.2.0-38). &nbsp;Periodically two 
of my nodes holding the largest queues will crash and require me to restart 
the rabbitmq-server service. &nbsp;Looking at the logs, I'm at a loss as to 
why the crash is occurring. &nbsp;I've have tried reproducing the crash 
manually by flooding my nodes with messages, but that doesn't seem to 
trigger the issue. &nbsp;Below is output from various RabbitMQ logs:</div>
> <div><br></div>
> <blockquote class="gmail_quote"># cat /var/log/rabbitmq/rabbit <at> ip-10-
123-123-123-sasl.log<br>
> =CRASH REPORT==== 18-May-2013::01:41:51 ===<br>&nbsp; crasher:<br>&nbsp; 
&nbsp; initial call: gen:init_it/6<br>&nbsp; &nbsp; pid: &lt;0.301.0&gt;
<br>&nbsp; &nbsp; registered_name: []<br>&nbsp; &nbsp; exception exit: 
{{case_clause,{empty,{[],[]}}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[{rabbit_amqqueue_process,subtract_acks,3,
[]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; {rabbit_amqqueue_process,subtract_acks,4,[]},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{rabbit_amqqueue_process,handle_cast,2,[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {gen_server2,handle_msg,2,
[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {proc_lib,wake_up,3,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{file,"proc_lib.erl"},
{line,249}]}]}<br>&nbsp; &nbsp; &nbsp; in function 
&nbsp;gen_server2:terminate/3<br>&nbsp; &nbsp; ancestors: 
[rabbit_amqqueue_sup,rabbit_sup,&lt;0.207.0&gt;]<br>&nbsp; &nbsp; messages: 
[{'$gen_cast',{resume,&lt;0.676.0&gt;}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{'$gen_cast',{ack,[27583,27606,27629,27652,27675,27698,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;27721,27744,27767,27790,27813,27836,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;27859,27882,27905,27928,27951,27974,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;27997,28020,28043,28066,28089,28112,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;28135,28158,28179,28200,28221,28242,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28263,28284,28305,28324,28342,28360,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28378,28396,28414,28432,28450,28468,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;28486,28504,28522,28540,28558,28576,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28594,28612],<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;0.737.0&gt;}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{'$gen_cast',{resume,&lt;0.737.0&gt;}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {'$gen_cast',{ack,
[27608,27631,27654,27677,27700,27723,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27746,27769,27792,27815,27838,27861,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;27884,27907,27930,27953,27976,27999,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;28022,28045,28068,28091,28114,28137,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28160,28181,28202,28223,28244,28265,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28286,28307,28326,28344,28362,28380,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;28398,28416,28434,28452,28470,28488,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28506,28524,28542,28560,28578,28596,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28614],
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;0.676.0&gt;}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{'$gen_cast',{ack,[27578,27601,27624,27647,27670,27693,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;27716,27739,27762,27785,27808,27831,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;27854,27877,27900,27923,27946,27969,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;27992,28015,28038,28061,28084,28107,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28130,28153,28174,28195,28216,28237,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28258,28279,28300,28321,28340,28358,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;28376,28394,28412,28430,28448,28466,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28484,28502,28520,28538,28556,28574,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28592,28610],
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;0.716.0&gt;}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{'$gen_cast',{resume,&lt;0.716.0&gt;}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {'$gen_cast',{ack,
[27582,27605,27628,27651,27674,27697,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;27720,27743,27766,27789,27812,27835,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;27858,27881,27904,27927,27950,27973,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;27996,28019,28042,28065,28088,28111,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28134,28157,28178,28199,28220,28241,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;28262,28283,28304,28323,28341,28359,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28377,28395,28413,28431,28449,28467,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28485,28503,28521,28539,28557,28575,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;28593,28611],<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &lt;0.737.0&gt;}}]<br>&nbsp; &nbsp; links: 
[&lt;0.300.0&gt;]<br>
> &nbsp; &nbsp; dictionary: [{{ch,&lt;0.729.0&gt;},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.729.0&gt;,#Ref&lt;0.0.0.12296&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28715,28696,28677,28658,28639,28620,28602,28584,<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28566,28548,28530,28512,28494,28476,28458,28440,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28422,28404,28386,28368,28350,28332,28313,28292,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28271,28250,28229,28208,28187,28166,28143,28120,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28097,28074,28051,28028,28005,27982,27959,27936,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27913,27890,27867,27844,27821,27798,27775,27752,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27729,27706,27683,27660,27637,27614],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27591]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{qstate,&lt;0.728.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{credit_to,&lt;7350.877.0&gt;},22},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.608.0&gt;},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.608.0&gt;,#Ref&lt;0.0.0.9041&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[28708,28689,28670,28651,28632,28607,28589,28571,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28553,28535,28517,28499,28481,28463,28445,28427,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28409,28391,28373,28355,28337,28318,28297,28276,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28255,28234,28213,28192,28171,28150,28127,28104,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28081,28058,28035,28012,27989,27966,27943,27920,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27897,27874,27851,27828,27805,27782,27759,27736,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27713,27690,27667,27644,27621,27598],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27575]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.607.0&gt;,active,{0,nil}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;38}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{ch,&lt;0.624.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.624.0&gt;,#Ref&lt;0.0.0.9436&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28722,28703,28684,28665,28646],[28627]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{qstate,&lt;0.623.0&gt;,active,{0,nil}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;36}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{ch,&lt;0.696.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.696.0&gt;,#Ref&lt;0.0.0.11414&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.695.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.564.0&gt;},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.564.0&gt;,#Ref&lt;0.0.0.7285&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28718,28699,28680,28661,28642],[28623]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],
[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{qstate,&lt;0.563.0&gt;,active,{0,nil}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;12}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{ch,&lt;0.644.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.644.0&gt;,#Ref&lt;0.0.0.10071&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28713,28694,28675,28656,28637,28618,28600,28582,<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28564,28546,28528,28510,28492,28474,28456,28438,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28420,28402,28384,28366,28348,28330,28311,28290,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28269,28248,28227,28206,28185,28164,28141,28118,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28095,28072,28049,28026,28003,27980,27957,27934,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27911,27888,27865,27842,27819,27796,27773,27750,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27727,27704,27681,27658,27635,27612],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27589]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{qstate,&lt;0.643.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.676.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.676.0&gt;,#Ref&lt;0.0.0.11309&gt;,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28614,28613,28596,28595,28578,28577,28560,28559,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28542,28541,28524,28523,28506,28505,28488,28487,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28470,28469,28452,28451,28434,28433,28416,28415,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28398,28397,28380,28379,28362,28361,28344,28343,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28326,28325,28307,28306,28286,28285,28265,28264,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28244,28243,28223,28222,28202,28201,28181,28180,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28160,28159,28137,28136,28114,28113,28091,28090,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28068,28067,28045,28044,28022,28021,27999,27998,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27976,27975,27953,27952,27930,27929,27907,27906,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27884,27883,27861,27860,27838,27837,27815,27814,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27792,27791,27769,27768,27746,27745,27723,27722,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27700,27699,27677,27676,27654,27653,27631,27630,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27608,27607,27585],<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [27584]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;{[{&lt;0.676.0&gt;,<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{consumer,&lt;&lt;"amq.ctag-0cvDGmyaAbEW_j15AfhGHQ"&gt;&gt;,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true}}],<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; [{&lt;0.676.0&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{consumer,&lt;&lt;"amq.ctag-YqU04SIfQv6P-QVueEjbRg"&gt;&gt;,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true}}]},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.675.0&gt;,suspended,{0,nil}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;25}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{xtype_to_module,direct},rabbit_exchange_type_direct},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{credit_to,&lt;7350.833.0&gt;},31},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.745.0&gt;},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.745.0&gt;,#Ref&lt;0.0.0.12674&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[28716,28697,28678,28659,28640,28621,28603,28585,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28567,28549,28531,28513,28495,28477,28459,28441,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28423,28405,28387,28369,28351,28333,28314,28293,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28272,28251,28230,28209,28188,28167,28144,28121,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28098,28075,28052,28029,28006,27983,27960,27937,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27914,27891,27868,27845,27822,27799,27776,27753,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27730,27707,27684,27661,27638,27615],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27592]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.744.0&gt;,active,{0,nil}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;37}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{ch,&lt;0.660.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.660.0&gt;,#Ref&lt;0.0.0.10650&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28712,28693,28674,28655,28636,28617,28599,28581,<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28563,28545,28527,28509,28491,28473,28455,28437,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28419,28401,28383,28365,28347,28329,28310,28289,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28268,28247,28226,28205,28184,28163,28140,28117,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28094,28071,28048,28025,28002,27979,27956,27933,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27910,27887,27864,27841,27818,27795,27772,27749,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27726,27703,27680,27657,27634,27611],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27588]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{qstate,&lt;0.659.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{credit_to,&lt;7350.837.0&gt;},32},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; {{credit_to,&lt;7350.881.0&gt;},17},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.737.0&gt;},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.737.0&gt;,#Ref&lt;0.0.0.12429&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28612,28611,28594,28593,28576,28575,28558,28557,<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28540,28539,28522,28521,28504,28503,28486,28485,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28468,28467,28450,28449,28432,28431,28414,28413,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28396,28395,28378,28377,28360,28359,28342,28341,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28324,28323,28305,28304,28284,28283,28263,28262,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28242,28241,28221,28220,28200,28199,28179,28178,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28158,28157,28135,28134,28112,28111,28089,28088,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28066,28065,28043,28042,28020,28019,27997,27996,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27974,27973,27951,27950,27928,27927,27905,27904,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27882,27881,27859,27858,27836,27835,27813,27812,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27790,27789,27767,27766,27744,27743,27721,27720,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27698,27697,27675,27674,27652,27651,27629,27628,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27606,27605,27583],<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [27582]},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{[{&lt;0.737.0&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; {consumer,&lt;&lt;"amq.ctag-
ITZqhulzHhUzx1uy1Eot3g"&gt;&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; true}}],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{&lt;0.737.0&gt;,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{consumer,&lt;&lt;"amq.ctag-hpo5ejdoJRdLrT6JS42jGw"&gt;&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true}}]},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.736.0&gt;,suspended,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {credit_blocked,[]},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{credit_to,&lt;7350.854.0&gt;},3},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.716.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.716.0&gt;,#Ref&lt;0.0.0.11820&gt;,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28610,28609,28592,28591,28574,28573,28556,28555,<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28538,28537,28520,28519,28502,28501,28484,28483,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28466,28465,28448,28447,28430,28429,28412,28411,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28394,28393,28376,28375,28358,28357,28340,28339,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28321,28320,28300,28299,28279,28278,28258,28257,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28237,28236,28216,28215,28195,28194,28174,28173,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28153,28152,28130,28129,28107,28106,28084,28083,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28061,28060,28038,28037,28015,28014,27992,27991,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27969,27968,27946,27945,27923,27922,27900,27899,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27877,27876,27854,27853,27831,27830,27808,27807,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27785,27784,27762,27761,27739,27738,27716,27715,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27693,27692,27670,27669,27647,27646,27624,27623,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27601,27600,27578],<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [27577]},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{[{&lt;0.716.0&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; {consumer,&lt;&lt;"amq.ctag-BTlS-GmbXNpcU-
wUlMI60Q"&gt;&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
true}}],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; [{&lt;0.716.0&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{consumer,&lt;&lt;"amq.ctag-loc5monF8M1pz_Bb8ypumw"&gt;&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true}}]},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.715.0&gt;,suspended,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;44}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.782.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.782.0&gt;,#Ref&lt;0.0.0.15649&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[28714,28695,28676,28657,28638,28619,28601,28583,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28565,28547,28529,28511,28493,28475,28457,28439,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28421,28403,28385,28367,28349,28331,28312,28291,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28270,28249,28228,28207,28186,28165,28142,28119,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28096,28073,28050,28027,28004,27981,27958,27935,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27912,27889,27866,27843,27820,27797,27774,27751,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27728,27705,27682,27659,27636,27613],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27590]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.781.0&gt;,active,{0,nil}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;35}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{credit_to,&lt;7350.846.0&gt;},22},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.684.0&gt;},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.684.0&gt;,#Ref&lt;0.0.0.11198&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28711,28692,28673,28654,28635,28616,28598,28580,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28562,28544,28526,28508,28490,28472,28454,28436,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28418,28400,28382,28364,28346,28328,28309,28288,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28267,28246,28225,28204,28183,28162,28139,28116,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28093,28070,28047,28024,28001,27978,27955,27932,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27909,27886,27863,27840,27817,27794,27771,27748,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27725,27702,27679,27656,27633,27610],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27587]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.683.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.692.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.692.0&gt;,#Ref&lt;0.0.0.11088&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[28710,28691,28672,28653,28634,28615,28597,28579,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28561,28543,28525,28507,28489,28471,28453,28435,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28417,28399,28381,28363,28345,28327,28308,28287,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28266,28245,28224,28203,28182,28161,28138,28115,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28092,28069,28046,28023,28000,27977,27954,27931,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27908,27885,27862,27839,27816,27793,27770,27747,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27724,27701,27678,27655,27632,27609],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27586]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.691.0&gt;,active,{0,nil}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;12}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{ch,&lt;0.648.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.648.0&gt;,#Ref&lt;0.0.0.10283&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28717,28698,28679,28660,28641],[28622]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{qstate,&lt;0.647.0&gt;,active,{0,nil}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;12}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {guid,{{<a href="tel:2296174761" value="+12296174761" 
target="_blank">2296174761</a>,591959305,1562876388,1822892473},1}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.720.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.720.0&gt;,#Ref&lt;0.0.0.12036&gt;,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28723,28704,28685,28666,28647],[28628]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],
[]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{qstate,&lt;0.719.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;37}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{credit_to,&lt;7350.869.0&gt;},39},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.636.0&gt;},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.636.0&gt;,#Ref&lt;0.0.0.9960&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[28705,28686,28667,28648,28629,28604,28586,28568,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28550,28532,28514,28496,28478,28460,28442,28424,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28406,28388,28370,28352,28334,28315,28294,28273,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28252,28231,28210,28189,28168,28147,28124,28101,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28078,28055,28032,28009,27986,27963,27940,27917,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27894,27871,27848,27825,27802,27779,27756,27733,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27710,27687,27664,27641,27618,27595],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27572]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.635.0&gt;,active,{0,nil}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;15}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{credit_to,&lt;7350.850.0&gt;},50},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.616.0&gt;},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.616.0&gt;,#Ref&lt;0.0.0.9300&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28719,28700,28681,28662,28643],[28624]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.615.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.509.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.509.0&gt;,#Ref&lt;0.0.0.2243&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[28302,28281,28260,28239,28218,28197,28176,28155,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28132,28109,28086,28063,28040,28017,27994,27971],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27580,27603,27626,27649,27672,27695,27718,27741,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27764,27787,27810,27833,27856,27879,27902,27925,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27948]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.508.0&gt;,active,{0,nil}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;36}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{credit_to,&lt;7350.873.0&gt;},17},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.588.0&gt;},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.588.0&gt;,#Ref&lt;0.0.0.7808&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28721,28702,28683,28664,28645],[28626]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.587.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.664.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.664.0&gt;,#Ref&lt;0.0.0.10772&gt;,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[28720,28701,28682,28663,28644],[28625]},<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{qstate,&lt;0.663.0&gt;,active,{0,nil}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;13}},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{fhc_age_tree,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {{ch,&lt;0.708.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{cr,&lt;0.708.0&gt;,#Ref&lt;0.0.0.11695&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28707,28688,28669,28650,28631,28606,28588,28570,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28552,28534,28516,28498,28480,28462,28444,28426,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28408,28390,28372,28354,28336,28317,28296,28275,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28254,28233,28212,28191,28170,28149,28126,28103,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28080,28057,28034,28011,27988,27965,27942,27919,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27896,27873,27850,27827,27804,27781,27758,27735,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27712,27689,27666,27643,27620,27597],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27574]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.707.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;35}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{credit_to,&lt;7350.829.0&gt;},13},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.757.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.757.0&gt;,#Ref&lt;0.0.0.13150&gt;,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28706,28687,28668,28649,28630,28605,28587,28569,<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;28551,28533,28515,28497,28479,28461,28443,28425,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28407,28389,28371,28353,28335,28316,28295,28274,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28253,28232,28211,28190,28169,28148,28125,28102,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28079,28056,28033,28010,27987,27964,27941,27918,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27895,27872,27849,27826,27803,27780,27757,27734,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27711,27688,27665,27642,27619,27596],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27573]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;{qstate,&lt;0.756.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;49}},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{ch,&lt;0.572.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{cr,&lt;0.572.0&gt;,#Ref&lt;0.0.0.7536&gt;,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{[28709,28690,28671,28652,28633,28608,28590,28572,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28554,28536,28518,28500,28482,28464,28446,28428,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28410,28392,28374,28356,28338,28319,28298,28277,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28256,28235,28214,28193,28172,28151,28128,28105,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;28082,28059,28036,28013,27990,27967,27944,27921,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27898,27875,27852,27829,27806,27783,27760,27737,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;27714,27691,27668,27645,27622,27599],<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[27576]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{qstate,&lt;0.571.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;35}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{{credit_to,&lt;7350.825.0&gt;},2},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; {{credit_to,&lt;7350.858.0&gt;},3}]<br>
> &nbsp; &nbsp; trap_exit: true<br>&nbsp; &nbsp; status: running<br>&nbsp; 
&nbsp; heap_size: 121536<br>&nbsp; &nbsp; stack_size: 27<br>&nbsp; &nbsp; 
reductions: 9363545<br>&nbsp; neighbours:<br><br>=SUPERVISOR REPORT==== 18-
May-2013::01:41:51 ===<br>&nbsp; &nbsp; &nbsp;Supervisor: 
{local,rabbit_amqqueue_sup}<br>
> &nbsp; &nbsp; &nbsp;Context: &nbsp; &nbsp;child_terminated<br>&nbsp; 
&nbsp; &nbsp;Reason: &nbsp; &nbsp; {{case_clause,{empty,{[],[]}}},<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[{rabbit_amqqueue_process,subtract_acks,3,[]},<br>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{rabbit_amqqueue_process,subtract_acks,4,[]},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{rabbit_amqqueue_process,handle_cast,2,[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{gen_server2,handle_msg,2,[]},
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}<br>&nbsp; &nbsp; 
&nbsp;Offender: &nbsp; [{pid,&lt;0.301.0&gt;},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{name,rabbit_amqqueue},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {mfa,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; {rabbit_amqqueue_process,start_link,<br>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; [{amqqueue,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
{resource,&lt;&lt;"/"&gt;&gt;,queue,<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;&lt;&lt;"document_queue"&gt;&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;true,false,none,[],&lt;0.7622.0&gt;,[],[],undefined,<br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;[]}]}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; {restart_type,temporary},<br>
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{shutdown,4294967295},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; {child_type,worker}]</blockquote>
> <div><br></div>
> <div>Notice how the case_clause is empty. &nbsp;The other rabbit log looks 
similar:</div>
> <div><br></div>
> <blockquote class="gmail_quote"># cat /var/log/rabbitmq/rabbit at ...&nbsp;
</blockquote>
> <blockquote class="gmail_quote">&nbsp;</blockquote>
> <blockquote class="gmail_quote">
> =ERROR REPORT==== 18-May-2013::01:41:48 ===</blockquote>
> <blockquote class="gmail_quote">** Generic server &lt;0.301.0&gt; 
terminating</blockquote>
> <blockquote class="gmail_quote">** Last message in was {'$gen_cast',
</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;{ack,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
[27585,27584,27607,27630,27653,27676,27699,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
27722,27745,27768,27791,27814,27837,27860,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
27883,27906,27929,27952,27975,27998,28021,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
28044,28067,28090,28113,28136,28159,28180,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
28201,28222,28243,28264,28285,28306,28325,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
28343,28361,28379,28397,28415,28433,28451,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
28469,28487,28505,28523,28541,28559,28577,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
28595,28613],</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;&lt;0.676.0&gt;}}</blockquote>
> <blockquote class="gmail_quote">** When Server state == {q,</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp;{amqqueue,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{resource,&lt;&lt;"/"&gt;&gt;,queue,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;&lt;&lt;"document_queue"&gt;&gt;},</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true,false,none,
[],&lt;0.301.0&gt;,[],[],undefined,[]},</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;none,true,rabbit_variable_queue,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{vqstate,</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; {0,{[],[]}},</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {0,{[],[]}},</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
{delta,undefined,0,undefined},</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {0,{[],[]}},</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; {0,{[],[]}},&nbsp;</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ... [ thousands of lines of 
state ] ...&nbsp;</blockquote>
> <blockquote class="gmail_quote">&nbsp;</blockquote>
> <blockquote class="gmail_quote">
> ** Reason for termination ==</blockquote>
> <blockquote class="gmail_quote">** {{case_clause,{empty,{[],[]}}},
</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; 
[{rabbit_amqqueue_process,subtract_acks,3,[]},</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp;
{rabbit_amqqueue_process,subtract_acks,4,[]},</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp;
{rabbit_amqqueue_process,handle_cast,2,[]},</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp;
{gen_server2,handle_msg,2,[]},</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp;{proc_lib,wake_up,3,[{file,"proc_lib.erl"},
{line,249}]}]}</blockquote>
> <blockquote class="gmail_quote">
> <br>
> </blockquote>
> <blockquote class="gmail_quote">=ERROR REPORT==== 18-May-2013::01:41:51 
===</blockquote>
> <blockquote class="gmail_quote">connection &lt;0.430.0&gt;, channel 22 - 
soft error:</blockquote>
> <blockquote class="gmail_quote">{amqp_error,not_found,</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "no queue 'document_queue' in 
vhost '/'",</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'queue.declare'}</blockquote>
> <blockquote class="gmail_quote"><br></blockquote>
> <blockquote class="gmail_quote">=ERROR REPORT==== 18-May-2013::01:41:51 
===</blockquote>
> <blockquote class="gmail_quote">
> connection &lt;0.384.0&gt;, channel 12 - soft error:</blockquote>
> <blockquote class="gmail_quote">
> {amqp_error,not_found,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
"no queue 'document_queue' in vhost '/'",</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
'queue.declare'}</blockquote>
> <blockquote class="gmail_quote">
> <br>
> </blockquote>
> <blockquote class="gmail_quote">=ERROR REPORT==== 18-May-2013::01:41:51 
===</blockquote>
> <blockquote class="gmail_quote">connection &lt;0.384.0&gt;, channel 15 - 
soft error:</blockquote>
> <blockquote class="gmail_quote">{amqp_error,not_found,</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "no queue 'document_queue' in 
vhost '/'",</blockquote>
> <blockquote class="gmail_quote">
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'queue.declare'}</blockquote>
> <blockquote class="gmail_quote"><br></blockquote>
> <blockquote class="gmail_quote">=ERROR REPORT==== 18-May-2013::01:41:51 
===</blockquote>
> <blockquote class="gmail_quote">
> connection &lt;0.373.0&gt;, channel 23 - soft error:</blockquote>
> <blockquote class="gmail_quote">
> {amqp_error,not_found,</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
"no queue 'document_queue' in vhost '/'",</blockquote>
> <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
'queue.declare'}&nbsp;</blockquote>
> <blockquote class="gmail_quote">
> &nbsp;... [ repeated a bunch of times ] ...</blockquote>
> <div><br></div>
> <div>I also see this in my /var/log/syslog&nbsp;with regards to beam.smp:
</div>
> <div><br></div>
> <blockquote class="gmail_quote">
> # cat /var/log/syslog<br>May 17 22:46:23 ip-10-123-123-123 kernel: 
[244800.176041] INFO: task beam.smp:18971 blocked for more than 120 seconds.
<br>May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176053] "echo 0 &gt; 
/proc/sys/kernel/hung_task_timeout_secs" disables this message.<br>
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176060] beam.smp &nbsp; 
&nbsp; &nbsp; &nbsp;D ffff8801bfd93700 &nbsp; &nbsp; 0 18971 &nbsp;18962 
0x00000000<br>May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176065] 
&nbsp;ffff8801b11cdcb8 0000000000000282 0000000000000000 
ffffffffffffffe0<br>
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176070] 
&nbsp;ffff8801b11cdfd8 ffff8801b11cdfd8 ffff8801b11cdfd8 
0000000000013700<br>May 17 22:46:23 ip-10-123-123-123 kernel: 
[244800.176075] &nbsp;ffff8801b3180000 ffff8801b35244a0 00007f500e2079e0 
ffff8801b146bb80<br>
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176079] Call Trace:
<br>May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176089] &nbsp;
[&lt;ffffffff8165434f&gt;] schedule+0x3f/0x60<br>May 17 22:46:23 ip-10-123-
123-123 kernel: [244800.176094] &nbsp;[&lt;ffffffff8106aef5&gt;] 
exit_mm+0x85/0x130<br>
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176097] &nbsp;
[&lt;ffffffff8106b10e&gt;] do_exit+0x16e/0x450<br>May 17 22:46:23 ip-10-123-
123-123 kernel: [244800.176102] &nbsp;[&lt;ffffffff810797aa&gt;] ? 
__dequeue_signal+0x6a/0xb0<br>
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176105] &nbsp;
[&lt;ffffffff8106b594&gt;] do_group_exit+0x44/0xa0<br>May 17 22:46:23 ip-10-
123-123-123 kernel: [244800.176108] &nbsp;[&lt;ffffffff8107c36c&gt;] 
get_signal_to_deliver+0x21c/0x420<br>
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176113] &nbsp;
[&lt;ffffffff81014825&gt;] do_signal+0x45/0x130<br>May 17 22:46:23 ip-10-
123-123-123 kernel: [244800.176116] &nbsp;[&lt;ffffffff8105539d&gt;] ? 
set_next_entity+0xad/0xd0<br>
> May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176120] &nbsp;
[&lt;ffffffff81014ad5&gt;] do_notify_resume+0x65/0x80<br>May 17 22:46:23 ip-
10-123-123-123 kernel: [244800.176124] &nbsp;[&lt;ffffffff8165ea90&gt;] 
int_signal+0x12/0x17<br>... [ repeated 9 more times with same timestamp ] 
...</blockquote>
> <div><br></div>
> <div>There are no strange CPU spikes on my EC2 node based on AWS 
monitoring. The only thing that seems to stand out is that my writes to my 
EBS volume spike during the crash (~90 write OPs/sec, 4 MiB/sec write 
bandwidth, ~30ms/op write latency).</div>
> <div><br></div>
> <div>My team and I are completely stumped and would appreciate any insight 
you might have to the crash reports. &nbsp;Is this a problem with writes 
hanging when going against the EBS volume since EBS volumes are essentially 
network mounted? &nbsp;Is there a way to configure rabbit to be more 
tolerant of these delays? &nbsp;</div>
> <div><br></div>
> <div><br></div>
> <div>For debugging purposes, below is the status output of one of the 
nodes when it is healthy (so you can see the versions of everything i'm 
running):<br>
> </div>
> <div><br></div>
> <blockquote class="gmail_quote">
> # rabbitmqctl status<br>Status of node 'rabbit <at> ip-10-123-123-123' ...
<br>[{pid,28978},<br>&nbsp;{running_applications,<br>&nbsp; &nbsp; &nbsp;
[{rabbitmq_management,"RabbitMQ Management Console","3.1.0"},<br>&nbsp; 
&nbsp; &nbsp; {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},<br>
> &nbsp; &nbsp; &nbsp; {webmachine,"webmachine","1.9.1-rmq3.1.0-
git52e62bc"},<br>&nbsp; &nbsp; &nbsp; {mochiweb,"MochiMedia Web 
Server","2.3.1-rmq3.1.0-gitd541e9a"},<br>&nbsp; &nbsp; &nbsp; 
{rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},<br>
> &nbsp; &nbsp; &nbsp; {rabbit,"RabbitMQ","3.1.0"},<br>&nbsp; &nbsp; &nbsp; 
{os_mon,"CPO &nbsp;CXC 138 46","2.2.11"},<br>&nbsp; &nbsp; &nbsp; 
{inets,"INETS &nbsp;CXC 138 49","5.9.4"},<br>&nbsp; &nbsp; &nbsp; 
{mnesia,"MNESIA &nbsp;CXC 138 12","4.8"},<br>
> &nbsp; &nbsp; &nbsp; {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
<br>&nbsp; &nbsp; &nbsp; {xmerl,"XML parser","1.3.3"},<br>&nbsp; &nbsp; 
&nbsp; {sasl,"SASL &nbsp;CXC 138 11","2.3.1"},<br>&nbsp; &nbsp; &nbsp; 
{stdlib,"ERTS &nbsp;CXC 138 10","1.19.1"},<br>
> &nbsp; &nbsp; &nbsp; {kernel,"ERTS &nbsp;CXC 138 10","2.16.1"}]},
<br>&nbsp;{os,{unix,linux}},<br>&nbsp;{erlang_version,<br>&nbsp; &nbsp; 
&nbsp;"Erlang R16B (erts-5.10.1) [source-05f1189] [64-bit] [smp:8:8] [async-
threads:30] [hipe] [kernel-poll:true]\n"},<br>
> &nbsp;{memory,<br>&nbsp; &nbsp; &nbsp;[{total,60179048},<br>&nbsp; &nbsp; 
&nbsp; {connection_procs,5274808},<br>&nbsp; &nbsp; &nbsp; {queue_procs,<a 
href="tel:13107264" value="+13107264" target="_blank">13107264</a>},
<br>&nbsp; &nbsp; &nbsp; {plugins,354272},<br>&nbsp; &nbsp; &nbsp; 
{other_proc,9741830},<br>
> &nbsp; &nbsp; &nbsp; {mnesia,150456},<br>&nbsp; &nbsp; &nbsp; 
{mgmt_db,12248},<br>&nbsp; &nbsp; &nbsp; {msg_index,34768},<br>&nbsp; &nbsp; 
&nbsp; {other_ets,1148248},<br>&nbsp; &nbsp; &nbsp; {binary,4905584},
<br>&nbsp; &nbsp; &nbsp; {code,19565863},<br>&nbsp; &nbsp; &nbsp; 
{atom,703377},<br>&nbsp; &nbsp; &nbsp; {other_system,5180330}]},<br>
> &nbsp;{vm_memory_high_watermark,0.8},<br>&nbsp;
{vm_memory_limit,5828434329},<br>&nbsp;{disk_free_limit,1000000000},
<br>&nbsp;{disk_free,3953344512},<br>&nbsp;{file_descriptors,<br>&nbsp; 
&nbsp; &nbsp;[{total_limit,924},{total_used,6},{sockets_limit,829},
{sockets_used,4}]},<br>
> &nbsp;{processes,[{limit,1048576},{used,348}]},<br>&nbsp;{run_queue,0},
<br>&nbsp;{uptime,3796}]<br>...done.</blockquote>
> <div><br></div>
> <div>Note that I am using Erlang v16 from the Erlang Solutions repo (esl-
erlang package). &nbsp;I originally was using Erlang v14 from Ubuntu repos 
(erlang-base), but decided to upgrade hoping it would resolve the issue 
(which it did not). &nbsp;I have also tried running RabbitMQ 3.0.4 without 
success. &nbsp;This issue seems to affect both versions.</div>
> <div><br></div>
> <div>Thanks,</div>
> <div>Karl</div>
> <br>_______________________________________________<br>
> rabbitmq-discuss mailing list<br><a href="mailto:rabbitmq-
discuss at ...">rabbitmq-discuss <at> lists.rabbitmq.com</a><br><a 
href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss" 
target="_blank">https://lists.rabbitmq.com/cgi-
bin/mailman/listinfo/rabbitmq-discuss</a><br><br>
> </blockquote>
> </div>
> <br>
> </div>
> </div>
> 

Hi Brett,

That would explain why all hell breaks lose when the acks are being 
subtracted, but I still don't understand what is causing the queue to 
disappear in the first place.  The only administrative actions performed on 
the queues in all our code base are declares or passive declares (to check 
for queue existence).  We are just using Spring AMQP's 
SimpleMessageListenerContainer (which, btw, the code for that class is 
anything but "Simple") for consumers, and I've scanned through that code and 
didn't find any place where it is dropping or destroying a queue or binding.

Is there are known bug where rabbit will cause a queue to disappear?  All my 
queues are durable and my messages are NOT persistent (we need high 
throughput and loosing a few messages is not a big deal).  I made the queue 
durable after we first started noticing the crashes so the queue would come 
back up on node restart.  But durability doesn't seem to protect it from 
disappearing.  

Any thoughts on this would be greatly, greatly appreciated. 

-Karl



From karl.rieb at gmail.com  Sat May 18 14:01:48 2013
From: karl.rieb at gmail.com (Karl Rieb)
Date: Sat, 18 May 2013 13:01:48 +0000 (UTC)
Subject: [rabbitmq-discuss] Amazon EC2 spurious cluster timeouts
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C3302@VALVCSMBX001PH.val.vlss.local>
Message-ID: <loom.20130518T150142-126@post.gmane.org>

Maslinski, Ray <MaslinskiR at ...> writes:

> 
> 
> 
> Hello,
> ?
> I?ve been working with several two node clusters running various versions 
of 3.0.x, hosted on m1.small instances on Ubuntu 12.04.2 LTS in EC2.? The 
setup is essentially as described here
> 
> http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-
amazon-ec2/ with the main exception being that both of the RabbitMQ servers 
are in the same availability zone.? A while back I observed a half dozen or 
so occurrences over the course
>  of a week where the clusters would become partitioned, accompanied by a 
messages on each server such as:
> ?
> =ERROR REPORT==== 17-May-2013::01:56:45 ===
> ** Node 'rabbit <at> oemsg-new-29b15241' not responding **
> ** Removing (timedout) connection **
> ?
> =INFO REPORT==== 17-May-2013::01:56:45 ===
> rabbit on node 'rabbit <at> oemsg-new-29b15241' down
> ?
> Looking over the logs and EC2 metrics, I wasn?t able to identify any other 
anomalies that coincided with these failures.? In particular, the load 
balancers in front of the cluster nodes did not report any health check 
failures connecting
>  to the amqp port (on a 30 second interval), suggesting that network 
connectivity was otherwise healthy, and there didn?t appear to be any 
unexpected spikes in resource consumption (such as excessive 
cpu/disk/network activity).? The rabbit servers were fairly
>  lightly loaded with messaging traffic at the time, and running some load 
tests against the same servers afterwards didn?t induce any further failures 
over the course of several days.? I tried increasing the net_ticktime to 
something like 5 or 10 minutes, but
>  still observed a failure with the new value.
> ?
> I left several clusters running over an extended period, most with little 
or no load, with one cluster running under an extended load test.? Several 
of the clusters experienced no failures over the course of a couple of 
months, while others
>  became partitioned after a while (though they seemed to survive for at 
least a few weeks before partition).
> ?
> Anyone experience anything similar in EC2, or have any ideas what else 
might be done to diagnose what?s going on?
> ?
> Ray Maslinski
> Senior Software Developer, Engineering
> Valassis / Digital Media
> Cell: 585.330.2426
> maslinskir at valassis.com
> www.valassis.com
> ?
> Creating the future of intelligent media delivery to drive your greatest 
success_____________________________________________________________________
________
> This message may include proprietary or protected information. If you are 
not the intended?
> recipient, please notify me, delete this message and do not further 
communicate the information?
> contained herein without my express consent.
> ?
> 
> 
> 
> <div>
> <div class="WordSection1">
> <p class="MsoNormal">Hello,<p></p></p>
> <p class="MsoNormal"><p>&nbsp;</p></p>
> <p class="MsoNormal">I&rsquo;ve been working with several two node 
clusters running various versions of 3.0.x, hosted on m1.small instances on 
Ubuntu 12.04.2 LTS in EC2.&nbsp; The setup is essentially as described here
> <a href="http://karlgrz.com/rabbitmq-highly-available-queues-and-
clustering-using-amazon-ec2/">
> http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-
amazon-ec2/</a> with the main exception being that both of the RabbitMQ 
servers are in the same availability zone.&nbsp; A while back I observed a 
half dozen or so occurrences over the course
>  of a week where the clusters would become partitioned, accompanied by a 
messages on each server such as:<p></p></p>
> <p class="MsoNormal"><p>&nbsp;</p></p>
> <p class="MsoNormal">=ERROR REPORT==== 17-May-2013::01:56:45 ===<p></p>
</p>
> <p class="MsoNormal">** Node 'rabbit <at> oemsg-new-29b15241' not 
responding **?p></p></p>
> <p class="MsoNormal">** Removing (timedout) connection **?p></p></p>
> <p class="MsoNormal"><p>&nbsp;</p></p>
> <p class="MsoNormal">=INFO REPORT==== 17-May-2013::01:56:45 ===<p></p></p>
> <p class="MsoNormal">rabbit on node 'rabbit <at> oemsg-new-29b15241' 
down<p></p></p>
> <p class="MsoNormal"><p>&nbsp;</p></p>
> <p class="MsoNormal">Looking over the logs and EC2 metrics, I wasn&rsquo;t 
able to identify any other anomalies that coincided with these 
failures.&nbsp; In particular, the load balancers in front of the cluster 
nodes did not report any health check failures connecting
>  to the amqp port (on a 30 second interval), suggesting that network 
connectivity was otherwise healthy, and there didn&rsquo;t appear to be any 
unexpected spikes in resource consumption (such as excessive 
cpu/disk/network activity).&nbsp; The rabbit servers were fairly
>  lightly loaded with messaging traffic at the time, and running some load 
tests against the same servers afterwards didn&rsquo;t induce any further 
failures over the course of several days.&nbsp; I tried increasing the 
net_ticktime to something like 5 or 10 minutes, but
>  still observed a failure with the new value.<p></p></p>
> <p class="MsoNormal"><p>&nbsp;</p></p>
> <p class="MsoNormal">I left several clusters running over an extended 
period, most with little or no load, with one cluster running under an 
extended load test.&nbsp; Several of the clusters experienced no failures 
over the course of a couple of months, while others
>  became partitioned after a while (though they seemed to survive for at 
least a few weeks before partition).<p></p></p>
> <p class="MsoNormal"><p>&nbsp;</p></p>
> <p class="MsoNormal">Anyone experience anything similar in EC2, or have 
any ideas what else might be done to diagnose what&rsquo;s going on?<p></p>
</p>
> <p class="MsoNormal"><p>&nbsp;</p></p>
> <p class="MsoNormal"><span>Ray Maslinski<p></p></span></p>
> <p class="MsoNormal"><span>Senior Software Developer, Engineering</span>
<p></p></p>
> <p class="MsoNormal"><span>Valassis / Digital Media</span><p></p></p>
> <p class="MsoNormal"><span>Cell: 585.330.2426</span><p></p></p>
> <p class="MsoNormal"><span>maslinskir at ...</span><p></p></p>
> <p class="MsoNormal"><a href="http://www.valassis.com/">
<span>www.valassis.com</span></a><span><p></p></span></p>
> <p class="MsoNormal"><span><p>&nbsp;</p></span></p>
> <p class="MsoNormal"><span>Creating the future of intelligent media 
delivery to drive your greatest success<br></span><span><br></span>
<span>______________________________________________________________________
_______</span><span><br><br>
> This message may include proprietary or protected information. If you are 
not the intended&nbsp;<p></p></span></p>
> <p class="MsoNormal"><span>recipient, please notify me, delete this 
message and do not further communicate the information&nbsp;<br>
> contained herein without my express consent.<p></p></span></p>
> <p class="MsoNormal"><p>&nbsp;</p></p>
> </div>
> </div>
> 

Hi Ray,

One last thing I forgot to mention:  we only experience this problem in the 
AWS public cloud with our own AMIs. Essentially we take a stock Ubuntu 12.04 
LTS AMI, set it up using Chef so it has all the appropriate users, packages, 
etc, then we stop that instance and create a new from it (we "bake" a new 
instance).  When we deploy, we use our newly baked instances.

We do a lot of staging and demo work in the AWS VPC, and we have never 
experienced the problems there.  In the VPC we don't use our baked AMIs and 
instead completely rely on Chef to bring up and prepare all our nodes.

Don't know if this helps at all to narrow down the possible issues.

-Karl



From michael.s.klishin at gmail.com  Sat May 18 15:41:38 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 18 May 2013 18:41:38 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.0.0-beta14 is released
Message-ID: <CAE3HoVTDj43ANK-KG_x1Qu_zS4UghZKkKHyQ3GvdzjD+LE0q0A@mail.gmail.com>

Langohr [1] is a Clojure client for RabbitMQ that embraces the AMQP 0.9.1
model.

Release notes for beta14:
http://blog.clojurewerkz.org/blog/2013/05/18/langohr-1-dot-0-0-beta14-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130518/d8d484a4/attachment.htm>

From michael.s.klishin at gmail.com  Sat May 18 15:54:23 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 18 May 2013 18:54:23 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre12 is released
Message-ID: <CAE3HoVR8TaLv+Msk5yp3doVztvQUZkLuhv9Xj4SX_NJaymLqOw@mail.gmail.com>

Bunny 0.9.0.pre12 is released to rubygems.org [1].

This release restores Ruby 1.8 compatibility.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/05/18/bunny-0-dot-9-0-dot-pre12-is-released/

1. http://rubygems.org/gems/bunny/versions/0.9.0.pre12
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130518/e2f2f820/attachment.htm>

From Michael.Laing at nytimes.com  Sat May 18 16:45:26 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 18 May 2013 11:45:26 -0400
Subject: [rabbitmq-discuss] Amazon EC2 spurious cluster timeouts
In-Reply-To: <7F7BFE76D0F5234F9258D88C37C9EC6B151C3302@VALVCSMBX001PH.val.vlss.local>
Message-ID: <CDBD1078.9AE5%Michael.Laing@nytimes.com>

Hi Ray,

We run several clusters at any one time and have not had problems such as you report ? yet :)

 *   3 nodes in a cluster / 3.04 or 3.10 / instance sizes vary
 *   Deployed within a VPC and with each node in a different availability zone.
 *   Amazon Linux and vFabric Erlang/OTP 15B02.
 *   CloudFormation for automated deployment/autoscaling/DNS (Route53)/etc

Like you, we do not use persistent messages. We persist in Cassandra and S3.

Things I have learned over the years re EC2 that may help:

 *   Avoid us-east-1: crowded, older infrastructure, bigger swings in capacity, meltdowns. My current favorite: us-west-2.
 *   Watch IO Wait on your instances: It seems to reflect the current network environment in which you are operating ? neighbor instance activity, snapshot activity, and your own IO. The partitions we have had have correlated with high IO Wait.
 *   If you have a problem with an instance, start a new one to replace it, then diagnose the old.
 *   Go multi-region. When a zone has big problems usually the regional control plane becomes compromised so resource changes fail. We typically run multi-headed in 3 regions to improve both availability and end user latency.

We also have a 'backup' deployment architecture that uses federation/shovels across zones similar to our multi-region architecture. So far we haven't needed it.

In general, our approach is to ensure that messages are delivered at least once, and that operations are idempotent. Resolvers de-duplicate messages and report message history. History patterns tell us in near real time where problems (missing messages, increased latencies) are occurring.

Michael
From: <Maslinski>, Ray <MaslinskiR at valassis.com<mailto:MaslinskiR at valassis.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Friday, May 17, 2013 4:03 PM
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] Amazon EC2 spurious cluster timeouts

Hello,

I?ve been working with several two node clusters running various versions of 3.0.x, hosted on m1.small instances on Ubuntu 12.04.2 LTS in EC2.  The setup is essentially as described here http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/ with the main exception being that both of the RabbitMQ servers are in the same availability zone.  A while back I observed a half dozen or so occurrences over the course of a week where the clusters would become partitioned, accompanied by a messages on each server such as:

=ERROR REPORT==== 17-May-2013::01:56:45 ===
** Node 'rabbit at oemsg-new-29b15241' not responding **
** Removing (timedout) connection **

=INFO REPORT==== 17-May-2013::01:56:45 ===
rabbit on node 'rabbit at oemsg-new-29b15241' down

Looking over the logs and EC2 metrics, I wasn?t able to identify any other anomalies that coincided with these failures.  In particular, the load balancers in front of the cluster nodes did not report any health check failures connecting to the amqp port (on a 30 second interval), suggesting that network connectivity was otherwise healthy, and there didn?t appear to be any unexpected spikes in resource consumption (such as excessive cpu/disk/network activity).  The rabbit servers were fairly lightly loaded with messaging traffic at the time, and running some load tests against the same servers afterwards didn?t induce any further failures over the course of several days.  I tried increasing the net_ticktime to something like 5 or 10 minutes, but still observed a failure with the new value.

I left several clusters running over an extended period, most with little or no load, with one cluster running under an extended load test.  Several of the clusters experienced no failures over the course of a couple of months, while others became partitioned after a while (though they seemed to survive for at least a few weeks before partition).

Anyone experience anything similar in EC2, or have any ideas what else might be done to diagnose what?s going on?

Ray Maslinski
Senior Software Developer, Engineering
Valassis / Digital Media
Cell: 585.330.2426
maslinskir at valassis.com<mailto:maslinskir at valassis.com>
www.valassis.com<http://www.valassis.com/>

Creating the future of intelligent media delivery to drive your greatest success

_____________________________________________________________________________

This message may include proprietary or protected information. If you are not the intended
recipient, please notify me, delete this message and do not further communicate the information
contained herein without my express consent.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130518/e88aaa76/attachment.htm>

From swinchen at gmail.com  Fri May 17 20:32:26 2013
From: swinchen at gmail.com (Sam Winchenbach)
Date: Fri, 17 May 2013 12:32:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Recovering an 3-node cluster after power failure
Message-ID: <606aa982-3175-4626-98f6-1d8fdc53426b@googlegroups.com>

Hi All,

I have a three node cluster running on VMs for testing purposes:
node1 (disk)
node2(disk)
node3(ram)

Today we had a power outage and all the nodes went down at once.  I am 
having a serious issue recovering from this because node1 thinks it belongs 
to a cluster but node3 disagrees.   I can not seem to do anything at all 
with rabbitmq on node1.   If I try running running "rabbitmqctl reset" it 
can not connect because node1 is down.  How can I recover from this 
gracefully?

Thanks,
Sam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/be92ec99/attachment.htm>

From niksav at osic.rs  Fri May 17 21:44:09 2013
From: niksav at osic.rs (nikolasavic77)
Date: Fri, 17 May 2013 13:44:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
Message-ID: <8b8de1da-f5a5-4dd0-bdfe-ad18e21ed681@googlegroups.com>

Hello,

What is expected value of consumed msg/s per CPU code running at 2.4GHz?

We're using 4 core VM running only RabbitMQ. When under load of about 
500msg/s, IDLE is only about 50%. This sounds like far away from high 
performance, since we're expecting much much more msg/s :(

There is enough RAM, about 30-35 connections are reported, 32 channels, 61 
queues.

Thanks,
Nikola
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/f530bf96/attachment.htm>

From bupt.aswmtjdsj at gmail.com  Sat May 18 06:26:18 2013
From: bupt.aswmtjdsj at gmail.com (Parlin)
Date: Fri, 17 May 2013 22:26:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
Message-ID: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>

*Hi, all,*

*I've been trying to install rabbitmq (ver 3.1.0) on my own vps ( linux 
distribution: debian, x86) for a long time, but I just failed again and 
again.*
*
*
*First, I'd like to show the error message I got:*

root at XXX:~/code# /etc/init.d/rabbitmq-server start
[warn] Starting message broker: rabbitmq-server[....] FAILED - check 
/var/log/rabbitmq/startup_\{log, _err\} ... (warning).
 failed!

root at XXX:~/code# rabbitmqctl status
{error_logger,{{2013,5,18},{13,21,20}},"Protocol: ~tp: register/listen 
error: ~tp~n",["inet_tcp",epmd_close]}
{error_logger,{{2013,5,18},{13,21,20}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.93>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,376},{stack_size,27},{reductions,785}],[]]}
{error_logger,{{2013,5,18},{13,21,20}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqctl12829,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2013,5,18},{13,21,20}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2013,5,18},{13,21,20}},crash_report,[[{initial_call,{application_master,init,['Argument__1','Argument__2','Argument__3','Argument__4']}},{pid,<0.9.0>},{registered_name,[]},{error_info,{exit,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}},{kernel,start,[normal,[]]}},[{application_master,init,4,[{file,"application_master.erl"},{line,138}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{ancestors,[<0.8.0>]},{messages,[{'EXIT',<0.10.0>,normal}]},{links,[<0.8.0>,<0.7.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,376},{stack_size,27},{reductions,117}],[]]}
{error_logger,{{2013,5,18},{13,21,20}},std_info,[{application,kernel},{exited,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}},{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid 
terminated",application_controller,"{application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}},{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}},{k

root at XXX:~/code# ps xua | grep epmd
rabbitmq 12470  0.0  0.1   2524   548 ?        S    13:15   0:00 
/usr/lib/erlang/erts-5.10.1/bin/epmd -daemon
root     12866  0.0  0.1   4428   804 pts/0    S+   13:21   0:00 grep 
--color=auto epmd

root at XXX:~/code# ps xua | grep rabbitmq
rabbitmq 12470  0.0  0.1   2524   548 ?        S    13:15   0:00 
/usr/lib/erlang/erts-5.10.1/bin/epmd -daemon
root     12868  0.0  0.1   4428   812 pts/0    S+   13:22   0:00 grep 
--color=auto rabbitmq

*And I've tried many solving methods I've googled, such as changing 
hostname and writing rabbitmq.conf, but none worked.*
*
*
*What's more, I even updated my Erlang, which is now R16B.*
*
*
*Still, nothing could be solved, and I turn to your for help.*
*
*
*Thank you in advance and I'm looking forward to your reply.*
*
*
*Xiang Yu*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/42402b9d/attachment.htm>

From niksav at osic.rs  Sat May 18 08:34:27 2013
From: niksav at osic.rs (nikolasavic77)
Date: Sat, 18 May 2013 00:34:27 -0700 (PDT)
Subject: [rabbitmq-discuss] More throughput using cluster
Message-ID: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>

Hi all,

In case we have 2 or more rabbitmq nodes connected in cluster and each with 
VIP assigned, would we get more throughput if messages are sent on all 
nodes (using round-robin method) and received by workers connected on each 
node.

If cluster is not goot way to get more throughput using additional rabbitmq 
nodes, what is solution?

Thanks,
Nikola
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130518/461bf6df/attachment.htm>

From jeremy at fluxlabs.net  Sat May 18 21:20:39 2013
From: jeremy at fluxlabs.net (Jeremy McSpadden)
Date: Sat, 18 May 2013 20:20:39 +0000
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
In-Reply-To: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
References: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
Message-ID: <2EC65DA7-D382-46B1-BF3B-B44968047C8F@fluxlabs.net>

FAILED - check /var/log/rabbitmq/startup_\{log, _err\} ...

--
Jeremy McSpadden
Flux Labs, Inc | http://www.fluxlabs.net<http://www.fluxlabs.net/> | Endless Solutions
Office : 850-250-5590x101<tel:850-250-5590;101> | Cell : 850-890-2543<tel:850-890-2543> | Fax : 850-254-2955<tel:850-254-2955>

On May 18, 2013, at 3:19 PM, "Parlin" <bupt.aswmtjdsj at gmail.com<mailto:bupt.aswmtjdsj at gmail.com>> wrote:

FAILED - check /var/log/rabbitmq/startup_\{log, _err\} ...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130518/17ce241e/attachment.htm>

From michael.s.klishin at gmail.com  Sat May 18 21:33:40 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 00:33:40 +0400
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <8b8de1da-f5a5-4dd0-bdfe-ad18e21ed681@googlegroups.com>
References: <8b8de1da-f5a5-4dd0-bdfe-ad18e21ed681@googlegroups.com>
Message-ID: <CAE3HoVTT_bgQkpe_=E=X+FHtgAWZr4=rkehEmMS+=MKk51a+bg@mail.gmail.com>

2013/5/18 nikolasavic77 <niksav at osic.rs>

> What is expected value of consumed msg/s per CPU code running at 2.4GHz?
>
> We're using 4 core VM running only RabbitMQ. When under load of about
> 500msg/s, IDLE is only about 50%. This sounds like far away from high
> performance, since we're expecting much much more msg/s :(
>

It depends on message size but 500 sounds way too low. However, consumer
throughput greatly depends on the client
and consumer code. Can you post any? What are your prefetch settings?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/95b91ca7/attachment.htm>

From michael.s.klishin at gmail.com  Sat May 18 21:36:19 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 00:36:19 +0400
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
Message-ID: <CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>

2013/5/18 nikolasavic77 <niksav at osic.rs>

> In case we have 2 or more rabbitmq nodes connected in cluster and each
> with VIP assigned, would we get more throughput if messages are sent on all
> nodes (using round-robin method) and received by workers connected on each
> node.


It's likely to be sufficient to simply spread message flow across N queues
and make different apps or instances
connect to different nodes.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/956744e0/attachment.htm>

From michael.s.klishin at gmail.com  Sat May 18 22:02:29 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 01:02:29 +0400
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
In-Reply-To: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
References: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
Message-ID: <CAE3HoVTtAP9JoUKnboqvTqsc-KD9BJnc8mRx9Z_LTwkt5SwKHQ@mail.gmail.com>

2013/5/18 Parlin <bupt.aswmtjdsj at gmail.com>

> {failed_to_start_child,net_kernel,{'EXIT',nodistribution}
>

This likely means that another node is running on the same port.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/cabeef50/attachment.htm>

From niks at osic.rs  Sun May 19 08:55:59 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 09:55:59 +0200
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <CAE3HoVTT_bgQkpe_=E=X+FHtgAWZr4=rkehEmMS+=MKk51a+bg@mail.gmail.com>
References: <8b8de1da-f5a5-4dd0-bdfe-ad18e21ed681@googlegroups.com>
	<CAE3HoVTT_bgQkpe_=E=X+FHtgAWZr4=rkehEmMS+=MKk51a+bg@mail.gmail.com>
Message-ID: <5198858F.3090807@osic.rs>


Hi,

Thank you for prompt reply!

Web application is coded in PHP. We tried both PHP AMQP extension and 
php-amqplib. We ended up using AMQP extension, because it works much 
faster, since php-amqplib took 80-100ms to connect and send single 
message (but that's different issue).

With every execution, PHP scripts connects to RabbitMQ and post 1-3 
messages. Since we're tracking banner displaying, additionally when 
displayed to user, each page generates 3-5 more messages.

So, on producer side, we have many connections being made and 1-3 short 
messages sent on single queue.

On consumer side we have worker PHP processes, which are connected once 
and receive messages. From time to time, we're sending ECHO (loopback 
messages) from producers to themselves, because we noticed that 
producers do not recognize RabbitMQ server has gone away or that VIP has 
switched to different server. With each ECHO message new connection is 
established.

Regards,
Nikola


On 05/18/2013 10:33 PM, Michael Klishin wrote:
> 2013/5/18 nikolasavic77 <niksav at osic.rs <mailto:niksav at osic.rs>>
>
>     What is expected value of consumed msg/s per CPU code running at
>     2.4GHz?
>
>     We're using 4 core VM running only RabbitMQ. When under load of
>     about 500msg/s, IDLE is only about 50%. This sounds like far away
>     from high performance, since we're expecting much much more msg/s :(
>
>
> It depends on message size but 500 sounds way too low. However, 
> consumer throughput greatly depends on the client
> and consumer code. Can you post any? What are your prefetch settings?
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/6efb4f77/attachment.htm>

From niks at osic.rs  Sun May 19 08:59:27 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 09:59:27 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
Message-ID: <5198865F.8000901@osic.rs>


Hi,

If I understand you well, we should have several queues (on same 
RabbitMQ node) which are used for same types of messages and selected by 
producers in round-robin way?

On consumer side we can have set of worker processes for each queue.

Or, are you suggesting we use queues on different RabbitMQ nodes?

Regards,
Nikola

On 05/18/2013 10:36 PM, Michael Klishin wrote:
> 2013/5/18 nikolasavic77 <niksav at osic.rs <mailto:niksav at osic.rs>>
>
>     In case we have 2 or more rabbitmq nodes connected in cluster and
>     each with VIP assigned, would we get more throughput if messages
>     are sent on all nodes (using round-robin method) and received by
>     workers connected on each node.
>
>
> It's likely to be sufficient to simply spread message flow across N 
> queues and make different apps or instances
> connect to different nodes.
>
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/2154a241/attachment.htm>

From rob at bsdsoftware.co.il  Sun May 19 10:03:46 2013
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Sun, 19 May 2013 12:03:46 +0300
Subject: [rabbitmq-discuss] feature request
Message-ID: <CAEuJcXOQvzUvTtaq6PxTwrb9wH8x1-O=KHZw_m1qp+upSh0Fmg@mail.gmail.com>

Multiple delete.
I often have many queues that I no longer need, especially in testing.
I would like to be able to select multiple queues for deletion from the
management web console.
Thanks

-- 
Rob Woolfson - CTO
mobile:+972-544904157
office:+972-3-5353751
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/e24c4142/attachment.htm>

From michael.justin at gmx.net  Sun May 19 11:32:41 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Sun, 19 May 2013 12:32:41 +0200
Subject: [rabbitmq-discuss] feature request
In-Reply-To: <CAEuJcXOQvzUvTtaq6PxTwrb9wH8x1-O=KHZw_m1qp+upSh0Fmg@mail.gmail.com>
References: <CAEuJcXOQvzUvTtaq6PxTwrb9wH8x1-O=KHZw_m1qp+upSh0Fmg@mail.gmail.com>
Message-ID: <kna9o8$qoe$1@ger.gmane.org>

Rob Woolfson wrote:

 > Multiple delete.
 > I often have many queues that I no longer need, especially in testing.
 > I would like to be able to select multiple queues for deletion from the
 > management web console.

If the queue names are not created randomly, using the REST API and a 
small shell script for this task could be a solution.

The API documentation is located at

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_1_0/priv/www/api/index.html

Hope this helps
-- 
Michael Justin


From tim at rabbitmq.com  Sun May 19 11:39:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Sun, 19 May 2013 11:39:29 +0100
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <5198858F.3090807@osic.rs>
References: <8b8de1da-f5a5-4dd0-bdfe-ad18e21ed681@googlegroups.com>
	<CAE3HoVTT_bgQkpe_=E=X+FHtgAWZr4=rkehEmMS+=MKk51a+bg@mail.gmail.com>
	<5198858F.3090807@osic.rs>
Message-ID: <EAEDD951-4438-4362-9DED-8B7C633E6DCC@rabbitmq.com>

Hi

On 19 May 2013, at 08:55, Nikola Savic wrote:

> With every execution, PHP scripts connects to RabbitMQ and post 1-3 messages. Since we're tracking banner displaying, additionally when displayed to user, each page generates 3-5 more messages. 
> 
> So, on producer side, we have many connections being made and 1-3 short messages sent on single queue.
> 
> On consumer side we have worker PHP processes, which are connected once and receive messages.

I know next to nothing about PHP and its rabbit bindings, but in general, I suspect that the performance is poor because, instead of maintaining a persistent connection in your application, you're trying to reconnect every time you wish to interact with the broker.

> From time to time, we're sending ECHO (loopback messages) from producers to themselves, because we noticed that producers do not recognize RabbitMQ server has gone away or that VIP has switched to different server. With each ECHO message new connection is established.
> 

That is what AMQP heartbeats are for, when you're using a persistent connection. Presumably there is some way to maintain a connection (or pool of connections) in your PHP application and reuse them, rather than creating a new connections each time you want to send or receive messages. It is channels that are lightweight and can be created and thrown away cheaply, for short winded interactions like yours. Connections however, cost more to set up and tear down. I'm surprised this isn't familiar territory, since the same principles (i.e., the need to pool/cache connections) is common to all remote services, including more obvious ones like relational databases.

Tim 

From niks at osic.rs  Sun May 19 11:51:09 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 12:51:09 +0200
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <EAEDD951-4438-4362-9DED-8B7C633E6DCC@rabbitmq.com>
References: <8b8de1da-f5a5-4dd0-bdfe-ad18e21ed681@googlegroups.com>
	<CAE3HoVTT_bgQkpe_=E=X+FHtgAWZr4=rkehEmMS+=MKk51a+bg@mail.gmail.com>
	<5198858F.3090807@osic.rs>
	<EAEDD951-4438-4362-9DED-8B7C633E6DCC@rabbitmq.com>
Message-ID: <5198AE9D.3060307@osic.rs>


Hi,

My conclusion was similar about cost of making new connection over and 
over again. However, PHP works so that I can not reuse resources between 
two runs :(

Some extensions, like MySQL, has support for persistent connections in 
itself. I didn't notice AMQP extension has anything like that :( Will 
look into it more.

The same goes for AMQP heartbeats, which I didn't notice in 
documentation :( Hopefully there is "hidden" option for turning it on. 
It's probably something client requests?

Thanks!
Nikola

On 05/19/2013 12:39 PM, Tim Watson wrote:
> Hi
>
> On 19 May 2013, at 08:55, Nikola Savic wrote:
>
>> With every execution, PHP scripts connects to RabbitMQ and post 1-3 messages. Since we're tracking banner displaying, additionally when displayed to user, each page generates 3-5 more messages.
>>
>> So, on producer side, we have many connections being made and 1-3 short messages sent on single queue.
>>
>> On consumer side we have worker PHP processes, which are connected once and receive messages.
> I know next to nothing about PHP and its rabbit bindings, but in general, I suspect that the performance is poor because, instead of maintaining a persistent connection in your application, you're trying to reconnect every time you wish to interact with the broker.
>
>>  From time to time, we're sending ECHO (loopback messages) from producers to themselves, because we noticed that producers do not recognize RabbitMQ server has gone away or that VIP has switched to different server. With each ECHO message new connection is established.
>>
> That is what AMQP heartbeats are for, when you're using a persistent connection. Presumably there is some way to maintain a connection (or pool of connections) in your PHP application and reuse them, rather than creating a new connections each time you want to send or receive messages. It is channels that are lightweight and can be created and thrown away cheaply, for short winded interactions like yours. Connections however, cost more to set up and tear down. I'm surprised this isn't familiar territory, since the same principles (i.e., the need to pool/cache connections) is common to all remote services, including more obvious ones like relational databases.
>
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From tim at rabbitmq.com  Sun May 19 11:59:35 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Sun, 19 May 2013 11:59:35 +0100
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <5198AE9D.3060307@osic.rs>
References: <8b8de1da-f5a5-4dd0-bdfe-ad18e21ed681@googlegroups.com>
	<CAE3HoVTT_bgQkpe_=E=X+FHtgAWZr4=rkehEmMS+=MKk51a+bg@mail.gmail.com>
	<5198858F.3090807@osic.rs>
	<EAEDD951-4438-4362-9DED-8B7C633E6DCC@rabbitmq.com>
	<5198AE9D.3060307@osic.rs>
Message-ID: <B03449DD-7EC1-4D6F-8FB4-79DF45A01CE5@rabbitmq.com>

Hi,

On 19 May 2013, at 11:51, Nikola Savic wrote:
> 
> My conclusion was similar about cost of making new connection over and over again. However, PHP works so that I can not reuse resources between two runs :(
> 

That is an unfortunate restriction and one I was not aware of.

> Some extensions, like MySQL, has support for persistent connections in itself. I didn't notice AMQP extension has anything like that :( Will look into it more.
> 

What about the other library that you mentioned?

> The same goes for AMQP heartbeats, which I didn't notice in documentation :( Hopefully there is "hidden" option for turning it on. It's probably something client requests?
> 

Heartbeats are negotiated with the server when the connection starts. I have no idea how this is configured in the various PHP clients though, nor whether it is even supported.

Tim

From michael.s.klishin at gmail.com  Sun May 19 12:35:38 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 15:35:38 +0400
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <5198865F.8000901@osic.rs>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
Message-ID: <CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>

2013/5/19 Nikola Savic <niks at osic.rs>

> Or, are you suggesting we use queues on different RabbitMQ nodes?


Simply try having different apps connect to different nodes and use
different queues first.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/19a37320/attachment.htm>

From michael.s.klishin at gmail.com  Sun May 19 12:40:21 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 15:40:21 +0400
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <5198858F.3090807@osic.rs>
References: <8b8de1da-f5a5-4dd0-bdfe-ad18e21ed681@googlegroups.com>
	<CAE3HoVTT_bgQkpe_=E=X+FHtgAWZr4=rkehEmMS+=MKk51a+bg@mail.gmail.com>
	<5198858F.3090807@osic.rs>
Message-ID: <CAE3HoVREwMak2TzwbLUk6ymLk+Ue7J2vOi7f=AFMh+b-GKFxVw@mail.gmail.com>

2013/5/19 Nikola Savic <niks at osic.rs>

> With every execution, PHP scripts connects to RabbitMQ and post 1-3
> messages


So the consumer apps are constantly being terminated, started, then they
connect and consume
messages (I assume using basic.get)? That's far from being very efficient,
RabbitMQ was
really built with long-running apps in mind.

Plus, with basic.get and immediate processing you get one message at a
time. With "push API"
consumers it can be multiple messages at once. See
http://www.rabbitmq.com/tutorials/tutorial-two-python.html,
for example.

I don't really know what to recommend besides at least not reconnecting all
the time. AFAIK php clients
only support basic.get and not "push" deliveries, neither a long-running
PHP process can offer any
way of concurrent processing.

You can try fetching multiple messages before you process them.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/2e855b5a/attachment.htm>

From emile at rabbitmq.com  Sun May 19 11:15:11 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Sun, 19 May 2013 11:15:11 +0100
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
In-Reply-To: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
References: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
Message-ID: <5198A62F.8010407@rabbitmq.com>

On 18/05/13 06:26, Parlin wrote:

> error: ~tp~n",["inet_tcp",epmd_close]}

> {'EXIT',nodistribution}


Can you start Erlang without the broker? You should get a prompt when
you run

 erl -sname foo

If that fails with a similar error then something is wrong with your
Erlang installation or permissions. Try restarting epmd in debug mode in
a separate terminal to get more diagnostics:

 epmd -kill
 epmd -debug




-Emile




From niks at osic.rs  Sun May 19 12:54:52 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 13:54:52 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
Message-ID: <5198BD8C.2090609@osic.rs>


It's single web app we have.

On 05/19/2013 01:35 PM, Michael Klishin wrote:
>
> 2013/5/19 Nikola Savic <niks at osic.rs <mailto:niks at osic.rs>>
>
>     Or, are you suggesting we use queues on different RabbitMQ nodes?
>
>
> Simply try having different apps connect to different nodes and use 
> different queues first.
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/b8f655f4/attachment.htm>

From bupt.aswmtjdsj at gmail.com  Sun May 19 13:21:06 2013
From: bupt.aswmtjdsj at gmail.com (Xiang Yu)
Date: Sun, 19 May 2013 20:21:06 +0800
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
In-Reply-To: <5198A62F.8010407@rabbitmq.com>
References: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
	<5198A62F.8010407@rabbitmq.com>
Message-ID: <CABa1P3k5shPXA-k=qWhDigRk7NNQ5F_Kz_CCEZorWAXRZr7g=Q@mail.gmail.com>

Hi Emile,

Thank your for replying to me!

Then I ran the command you suggested.

root at XXX:~#erl -sname foo
{error_logger,{{2013,5,19},{20,1,10}},"Protocol: ~tp: register/listen
error: ~tp~n",["inet_tcp",epmd_close]}
{error_logger,{{2013,5,19},{20,1,10}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.54>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,233},{stack_size,27},{reductions,733}],[]]}
{error_logger,{{2013,5,19},{20,1,10}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[foo,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2013,5,19},{20,1,10}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2013,5,19},{20,1,10}},crash_report,[[{initial_call,{application_master,init,['Argument__1','Argument__2','Argument__3','Argument__4']}},{pid,<0.9.0>},{registered_name,[]},{error_info,{exit,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}},{kernel,start,[normal,[]]}},[{application_master,init,4,[{file,"application_master.erl"},{line,138}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{ancestors,[<0.8.0>]},{messages,[{'EXIT',<0.10.0>,normal}]},{links,[<0.8.0>,<0.7.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,376},{stack_size,27},{reductions,117}],[]]}
{error_logger,{{2013,5,19},{20,1,10}},std_info,[{application,kernel},{exited,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}},{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}},{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}},{k

root at XXX:~#epmd -kill
epmd: local epmd responded with <>

root at XXX:~#epmd -debug
epmd: Sun May 19 20:12:06 2013: epmd running - daemon = 0
epmd: Sun May 19 20:12:06 2013: there is already a epmd running at port 4369

Then I ran erl -sname foo again, and it happened just the same as above.

As I'm unfamiliar with Erlang, I found it hard to analyse the problem, then
could you please help me in further steps? Thanks in advance...


Yours,
Xiang Yu,

Cell: +86-152-1063-2036
As an undergraduate,
in the major of Electrical Information Engineering,
School of Information and Communication Engineering,
Beijing University of Posts and Telecommunications.


2013/5/19 Emile Joubert <emile at rabbitmq.com>

> On 18/05/13 06:26, Parlin wrote:
>
> > error: ~tp~n",["inet_tcp",epmd_close]}
>
> > {'EXIT',nodistribution}
>
>
> Can you start Erlang without the broker? You should get a prompt when
> you run
>
>  erl -sname foo
>
> If that fails with a similar error then something is wrong with your
> Erlang installation or permissions. Try restarting epmd in debug mode in
> a separate terminal to get more diagnostics:
>
>  epmd -kill
>  epmd -debug
>
>
>
>
> -Emile
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/507c9490/attachment.htm>

From michael.s.klishin at gmail.com  Sun May 19 14:17:26 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 17:17:26 +0400
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <5198BD8C.2090609@osic.rs>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
Message-ID: <CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>

2013/5/19 Nikola Savic <niks at osic.rs>

> It's single web app we have.


I don't understand. So the app acts both as a producer and as a consumer?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/55fa91ee/attachment.htm>

From Michael.Laing at nytimes.com  Sun May 19 14:32:14 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sun, 19 May 2013 09:32:14 -0400
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <CAE3HoVREwMak2TzwbLUk6ymLk+Ue7J2vOi7f=AFMh+b-GKFxVw@mail.gmail.com>
Message-ID: <CDBE4A18.9B54%Michael.Laing@nytimes.com>

You could try statelessd, which is designed for this scenario: https://github.com/gmr/statelessd

"The goal is to allow for persistent connections to RabbitMQ for systems and languages that do not facilitate long-running persisted connections like PHP."

Or use FastCGI  for your PHP.

ml

From: Michael Klishin <michael.s.klishin at gmail.com<mailto:michael.s.klishin at gmail.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Sunday, May 19, 2013 7:40 AM
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Expected msg/s per CPU core


2013/5/19 Nikola Savic <niks at osic.rs<mailto:niks at osic.rs>>
With every execution, PHP scripts connects to RabbitMQ and post 1-3 messages

So the consumer apps are constantly being terminated, started, then they connect and consume
messages (I assume using basic.get)? That's far from being very efficient, RabbitMQ was
really built with long-running apps in mind.

Plus, with basic.get and immediate processing you get one message at a time. With "push API"
consumers it can be multiple messages at once. See http://www.rabbitmq.com/tutorials/tutorial-two-python.html,
for example.

I don't really know what to recommend besides at least not reconnecting all the time. AFAIK php clients
only support basic.get and not "push" deliveries, neither a long-running PHP process can offer any
way of concurrent processing.

You can try fetching multiple messages before you process them.
--
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/ab462b31/attachment.htm>

From niks at osic.rs  Sun May 19 15:03:24 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 16:03:24 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
Message-ID: <5198DBAC.7090901@osic.rs>


Yes ... it's the same app which postpones execution of some actions 
using MQ.

On 05/19/2013 03:17 PM, Michael Klishin wrote:
> 2013/5/19 Nikola Savic <niks at osic.rs <mailto:niks at osic.rs>>
>
>     It's single web app we have.
>
>
> I don't understand. So the app acts both as a producer and as a consumer?
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/37b472d9/attachment.htm>

From niks at osic.rs  Sun May 19 15:06:00 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 16:06:00 +0200
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <CDBE4A18.9B54%Michael.Laing@nytimes.com>
References: <CDBE4A18.9B54%Michael.Laing@nytimes.com>
Message-ID: <5198DC48.7080606@osic.rs>


Thanks ... this looks like interesting solution ... not sure how our 
admins will like to have one more layer of technology that needs 
monitoring and HA settings :(

Would STOMP be better approach to connect to RabbitMQ from PHP?

On 05/19/2013 03:32 PM, Laing, Michael P. wrote:
> You could try statelessd, which is designed for this scenario: 
> https://github.com/gmr/statelessd
>
>     "The goal is to allow for persistent connections to RabbitMQ for
>     systems and languages that do not facilitate long-running
>     persisted connections like PHP."
>
>
> Or use FastCGI  for your PHP.
>
> ml
>
> From: Michael Klishin <michael.s.klishin at gmail.com 
> <mailto:michael.s.klishin at gmail.com>>
> Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com 
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
> Date: Sunday, May 19, 2013 7:40 AM
> To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com 
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
> Subject: Re: [rabbitmq-discuss] Expected msg/s per CPU core
>
>
> 2013/5/19 Nikola Savic <niks at osic.rs <mailto:niks at osic.rs>>
>
>     With every execution, PHP scripts connects to RabbitMQ and post
>     1-3 messages
>
>
> So the consumer apps are constantly being terminated, started, then 
> they connect and consume
> messages (I assume using basic.get)? That's far from being very 
> efficient, RabbitMQ was
> really built with long-running apps in mind.
>
> Plus, with basic.get and immediate processing you get one message at a 
> time. With "push API"
> consumers it can be multiple messages at once. See 
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html,
> for example.
>
> I don't really know what to recommend besides at least not 
> reconnecting all the time. AFAIK php clients
> only support basic.get and not "push" deliveries, neither a 
> long-running PHP process can offer any
> way of concurrent processing.
>
> You can try fetching multiple messages before you process them.
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/5b1c6032/attachment.htm>

From michael.s.klishin at gmail.com  Sun May 19 15:08:50 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 18:08:50 +0400
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <5198DBAC.7090901@osic.rs>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
Message-ID: <CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>

2013/5/19 Nikola Savic <niks at osic.rs>

> Yes ... it's the same app which postpones execution of some actions using
> MQ.


Then cluster won't solve your problem because the issue is not node
delivery rate.

You need to avoid constant restarts and reconnections for your consumers or
simply
increase their number and/or throughput.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/8c17c1c0/attachment.htm>

From niks at osic.rs  Sun May 19 15:11:17 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 16:11:17 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
Message-ID: <5198DD85.1020101@osic.rs>


Consumers are not restarting ... producers are. Every page request is 
new execution of PHP script, which must open new connection when trying 
to send first message, and close it when it finishes.

On 05/19/2013 04:08 PM, Michael Klishin wrote:
>
> 2013/5/19 Nikola Savic <niks at osic.rs <mailto:niks at osic.rs>>
>
>     Yes ... it's the same app which postpones execution of some
>     actions using MQ.
>
>
> Then cluster won't solve your problem because the issue is not node 
> delivery rate.
>
> You need to avoid constant restarts and reconnections for your 
> consumers or simply
> increase their number and/or throughput.
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/b34f68d7/attachment.htm>

From michael.s.klishin at gmail.com  Sun May 19 15:14:51 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 18:14:51 +0400
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <5198DD85.1020101@osic.rs>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
	<5198DD85.1020101@osic.rs>
Message-ID: <CAE3HoVRyBOLeSZ_pcYMPf5OzwsStzA=5Cx7L+RzAGnCsd_PMbQ@mail.gmail.com>

2013/5/19 Nikola Savic <niks at osic.rs>

> Consumers are not restarting ... producers are


But consumers are long running PHP scripts?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/98417a39/attachment.htm>

From videlalvaro at gmail.com  Sun May 19 15:28:26 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 19 May 2013 16:28:26 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <5198DD85.1020101@osic.rs>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
	<5198DD85.1020101@osic.rs>
Message-ID: <CAMcAHLUmH2rrb6QuZX84Z-pvXwvVnixprKFGKevC3zXHso8AjA@mail.gmail.com>

Hi,

The php-amqplib from here https://github.com/videlalvaro/php-amqplib can
easily publish 4000 msgs in 1.5 seconds and it can consume them in about
the same time, using just 1 producer and 1 consumer.

Is worth noting that the consumers in the benchmark code are doing a
basic_consume on the queue and not a basic_get. The benchmark code can be
easily run if you check out the library form Github and run *make benchmark*
.

I think the problem you have on the producing side is the way PHP work,
where sharing resources is not so easy due to the script state being
cleaned after every request, thus the need of opening one connection per
request.

Regarding persisting connections with PHP, while the socket connection to
RabbitMQ could be persisted across requests, what do we do about channels
and the whole connection state? With PHP this is not so easy to solve.

If you need to achieve max speed from your publishing side I would consider
using a REST endpoint as someone suggested already.

On the other hand if your concern regarding publishing speed is to not make
the users wait for the request to finish, then keep in mind that php-fpm
has a function called fastcgi_finish_request. You can call it at the end of
your script and then send the messages to RabbitMQ.

Regards,

Alvaro



On Sun, May 19, 2013 at 4:11 PM, Nikola Savic <niks at osic.rs> wrote:

>
> Consumers are not restarting ... producers are. Every page request is new
> execution of PHP script, which must open new connection when trying to send
> first message, and close it when it finishes.
>
>
> On 05/19/2013 04:08 PM, Michael Klishin wrote:
>
>
> 2013/5/19 Nikola Savic <niks at osic.rs>
>
>> Yes ... it's the same app which postpones execution of some actions using
>> MQ.
>
>
> Then cluster won't solve your problem because the issue is not node
> delivery rate.
>
> You need to avoid constant restarts and reconnections for your consumers
> or simply
> increase their number and/or throughput.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/a24e1f49/attachment.htm>

From niks at osic.rs  Sun May 19 15:31:09 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 16:31:09 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <CAE3HoVRyBOLeSZ_pcYMPf5OzwsStzA=5Cx7L+RzAGnCsd_PMbQ@mail.gmail.com>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
	<5198DD85.1020101@osic.rs>
	<CAE3HoVRyBOLeSZ_pcYMPf5OzwsStzA=5Cx7L+RzAGnCsd_PMbQ@mail.gmail.com>
Message-ID: <5198E22D.3070101@osic.rs>


Yes, consumers are long running PHP scripts which connect to RabbitMQ 
only once and use that connection for long time (until terminated for 
some reason).

On 05/19/2013 04:14 PM, Michael Klishin wrote:
> 2013/5/19 Nikola Savic <niks at osic.rs <mailto:niks at osic.rs>>
>
>     Consumers are not restarting ... producers are
>
>
> But consumers are long running PHP scripts?
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/3d8eefc5/attachment.htm>

From michael.s.klishin at gmail.com  Sun May 19 15:37:08 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 18:37:08 +0400
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <5198E22D.3070101@osic.rs>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
	<5198DD85.1020101@osic.rs>
	<CAE3HoVRyBOLeSZ_pcYMPf5OzwsStzA=5Cx7L+RzAGnCsd_PMbQ@mail.gmail.com>
	<5198E22D.3070101@osic.rs>
Message-ID: <CAE3HoVSGUUOgcmQhopkTuOR1H_PC+mkFsfxD2=Et7F8uvrWJdw@mail.gmail.com>

2013/5/19 Nikola Savic <niks at osic.rs>

> Yes, consumers are long running PHP scripts which connect to RabbitMQ only
> once and use that connection for long time (until terminated for some
> reason).


Then my guess is that you need to switch to basic.consume and (if needed)
increase the number of consumers.

As for publishing, using the function ?lvaro has suggested sounds like a
good idea as well.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/887442b8/attachment.htm>

From niks at osic.rs  Sun May 19 16:19:38 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 17:19:38 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <CAMcAHLUmH2rrb6QuZX84Z-pvXwvVnixprKFGKevC3zXHso8AjA@mail.gmail.com>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
	<5198DD85.1020101@osic.rs>
	<CAMcAHLUmH2rrb6QuZX84Z-pvXwvVnixprKFGKevC3zXHso8AjA@mail.gmail.com>
Message-ID: <5198ED8A.2080909@osic.rs>


php-amqplib was first solution we used. However, we had to switch to 
AMQP extension because connecting was very slow :( It took minimum 50ms 
for php-amqplib to establish connection to RabbitMQ. Most of this time 
was spent on fread call. AMQP extension also uses a lot of time for 
connection, but much less than php-amqplib (up to 20ms).

We're not using basic_consume, since we must monitor two different 
channels/exchanges (one direct and one fannout). This is because workers 
must get messages (task related) by direct queue, and broadcasts over 
fannout. That's why we used code from one of examples:

/    while (count($ch->callbacks)) {//
//        $read   = array($conn->getSocket()); // add here other sockets 
that you need to attend//
//        $write  = null;//
//        $except = null;//
//        $num_changed_streams = stream_select($read, $write, $except, 
rand(10,15));//
//
//        ....//
//    }/

This is where php-amqplib is much better than AMQP extension :( Since 
AMQP extension doesn't have (or we didn't find example) that can wait on 
stream for predefined number of seconds, and then return control back to 
PHP script, like /stream_select /does.

So, on end, we ended up using AMQP extension for producers and 
php-amqplib for consumers ... crazy isn't it?

On 05/19/2013 04:28 PM, Alvaro Videla wrote:
> Hi,
>
> The php-amqplib from here https://github.com/videlalvaro/php-amqplib 
> can easily publish 4000 msgs in 1.5 seconds and it can consume them in 
> about the same time, using just 1 producer and 1 consumer.
>
> Is worth noting that the consumers in the benchmark code are doing a 
> basic_consume on the queue and not a basic_get. The benchmark code can 
> be easily run if you check out the library form Github and run *make 
> benchmark*.
>
> I think the problem you have on the producing side is the way PHP 
> work, where sharing resources is not so easy due to the script state 
> being cleaned after every request, thus the need of opening one 
> connection per request.
>
> Regarding persisting connections with PHP, while the socket connection 
> to RabbitMQ could be persisted across requests, what do we do about 
> channels and the whole connection state? With PHP this is not so easy 
> to solve.
>
> If you need to achieve max speed from your publishing side I would 
> consider using a REST endpoint as someone suggested already.
>
> On the other hand if your concern regarding publishing speed is to not 
> make the users wait for the request to finish, then keep in mind that 
> php-fpm has a function called fastcgi_finish_request. You can call it 
> at the end of your script and then send the messages to RabbitMQ.
>
> Regards,
>
> Alvaro
>
>
>
> On Sun, May 19, 2013 at 4:11 PM, Nikola Savic <niks at osic.rs 
> <mailto:niks at osic.rs>> wrote:
>
>
>     Consumers are not restarting ... producers are. Every page request
>     is new execution of PHP script, which must open new connection
>     when trying to send first message, and close it when it finishes.
>
>
>     On 05/19/2013 04:08 PM, Michael Klishin wrote:
>>
>>     2013/5/19 Nikola Savic <niks at osic.rs <mailto:niks at osic.rs>>
>>
>>         Yes ... it's the same app which postpones execution of some
>>         actions using MQ.
>>
>>
>>     Then cluster won't solve your problem because the issue is not
>>     node delivery rate.
>>
>>     You need to avoid constant restarts and reconnections for your
>>     consumers or simply
>>     increase their number and/or throughput.
>>     -- 
>>     MK
>>
>>     http://github.com/michaelklishin
>>     http://twitter.com/michaelklishin
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/744970d2/attachment.htm>

From michael.s.klishin at gmail.com  Sun May 19 16:26:29 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 May 2013 19:26:29 +0400
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <5198ED8A.2080909@osic.rs>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
	<5198DD85.1020101@osic.rs>
	<CAMcAHLUmH2rrb6QuZX84Z-pvXwvVnixprKFGKevC3zXHso8AjA@mail.gmail.com>
	<5198ED8A.2080909@osic.rs>
Message-ID: <CAE3HoVT6Lg-T0Li9qJhxPnhi3PZrvcmzfbuSWMmrrcutfX_E7A@mail.gmail.com>

2013/5/19 Nikola Savic <niks at osic.rs>

> We're not using basic_consume, since we must monitor two different
> channels/exchanges (one direct and one fannout). This is because workers
> must get messages (task related) by direct queue, and broadcasts over
> fannout


You should be able to do this easily with any client using basic.consume.

Also, sounds like a suitable use case for exchangeo-to-exchange bindings:

http://www.rabbitmq.com/e2e.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/8e8b1c7e/attachment.htm>

From niks at osic.rs  Sun May 19 16:35:13 2013
From: niks at osic.rs (Nikola Savic)
Date: Sun, 19 May 2013 17:35:13 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <CAE3HoVT6Lg-T0Li9qJhxPnhi3PZrvcmzfbuSWMmrrcutfX_E7A@mail.gmail.com>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
	<5198DD85.1020101@osic.rs>
	<CAMcAHLUmH2rrb6QuZX84Z-pvXwvVnixprKFGKevC3zXHso8AjA@mail.gmail.com>
	<5198ED8A.2080909@osic.rs>
	<CAE3HoVT6Lg-T0Li9qJhxPnhi3PZrvcmzfbuSWMmrrcutfX_E7A@mail.gmail.com>
Message-ID: <5198F131.8000706@osic.rs>


Hmm ... I'll look into using basic.consume with two channels like you 
suggest.

There is one more channel that we use :( Direct channel by which worker 
process (consumer) sends ECHO message to itself, because we couldn't 
make php-amqplib recognize that RabbitMQ has gone away.

Alvaro, is there support for AMQP heartbeat in php-amqplib? I was not 
being able to find and activate it :(

On 05/19/2013 05:26 PM, Michael Klishin wrote:
> 2013/5/19 Nikola Savic <niks at osic.rs <mailto:niks at osic.rs>>
>
>     We're not using basic_consume, since we must monitor two different
>     channels/exchanges (one direct and one fannout). This is because
>     workers must get messages (task related) by direct queue, and
>     broadcasts over fannout
>
>
> You should be able to do this easily with any client using basic.consume.
>
> Also, sounds like a suitable use case for exchangeo-to-exchange bindings:
>
> http://www.rabbitmq.com/e2e.html
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/b4dd9ac7/attachment.htm>

From emile at rabbitmq.com  Sun May 19 21:26:59 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Sun, 19 May 2013 21:26:59 +0100
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
In-Reply-To: <CABa1P3k5shPXA-k=qWhDigRk7NNQ5F_Kz_CCEZorWAXRZr7g=Q@mail.gmail.com>
References: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
	<5198A62F.8010407@rabbitmq.com>
	<CABa1P3k5shPXA-k=qWhDigRk7NNQ5F_Kz_CCEZorWAXRZr7g=Q@mail.gmail.com>
Message-ID: <51993593.8060803@rabbitmq.com>

On 19/05/13 13:21, Xiang Yu wrote:
> root at XXX:~#epmd -kill
> epmd: local epmd responded with <>


If that doesn't work then send the epmd process a kill signal. See the
'kill' or 'killall' commands.

From brett.r.cameron at gmail.com  Sun May 19 22:11:44 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Mon, 20 May 2013 09:11:44 +1200
Subject: [rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ
 3.1.0-1 (case_clause empty) on EC2
In-Reply-To: <loom.20130518T145120-367@post.gmane.org>
References: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
	<CALPqkipk5DFLH5XwfR8fW=fTVd4tJWsC8XwC+qXctgaxW7vHCQ@mail.gmail.com>
	<loom.20130518T145120-367@post.gmane.org>
Message-ID: <CALPqkirFsq4d_D0WhRdwwWzMFX_pZBsuOx-0ixwg6kaXxApn7w@mail.gmail.com>

Karl,

I am not aware of any known issues in this regard (queues strangely
disapearing). The fact that you get the problem with different versions of
Erlang and dofferent versions of RabbitMQ would make me suspect that it is
more likely to be something external to the broker environment.

The "INFO: task beam.smp:18971 blocked for more than 120 seconds." messages
in syslog are interesting. What I think is happening here is as follows: By
default Linux uses up to 40% of the available memory for file system
caching and if/when this threshold is reached the file system flushes all
outstanding cached data to disk, causing all following I/O's become
synchronous (until the flush completes). There is a default time limit of
120 seconds for the flush to complete. If you're EC2 VM's have a lot of RAM
and are processing heavy I/O-intensive workloads, it is possible that the
EBS volumes might sometimes not be able to keep up (or possibly there's
some spike in network activity and available bandwidth goes through the
floor). You have mentioned that your messages are not persistent, but
RabbitMQ's memory usage might be such that it is occasionally deciding to
flush a whole pile of stuff to disk. I notice that you have
{vm_memory_high_watermark,0.8}, and this could have something to do with
the problem - maybe try reducing this, and/or maybe set vm.dirty_ratio to
something less than 40% in /etc/sysctl.conf (this might increase the
frequency of flushes, but you'll be flushing less data). I'd possibly start
by reducing vm_memory_high_watermark. I can't really correlate this with
your queue disappearing, but if I/O's are getting messed up then all manner
of weird things could happen I guess. Hopefully others might have some more
tangible ideas!

Brett


On Sun, May 19, 2013 at 12:57 AM, Karl Rieb <karl.rieb at gmail.com> wrote:

> Brett Cameron <brett.r.cameron at ...> writes:
>
> >
> >
> >
> > Karl,Wild speculation would be that messages have been consumed from a
> queue but that queue (name = document_queue?) is for some reason missing in
> action (gone, inaccessible, ...) when the consumer subsequently tries to
> ack
> the message(s).
> > Brett
> >
> >
> > On Sat, May 18, 2013 at 3:20 PM, Karl Rieb <karl.rieb <at> gmail.com>
> wrote:Hi,
> > I am running a RabbitMQ cluster of 4 nodes in AWS EC2 on c1.xlarge
> instances using Ubuntu 12.04 LTS (kernel 3.2.0-38).  Periodically two of my
> nodes holding the largest queues will crash and require me to restart the
> rabbitmq-server service.  Looking at the logs, I'm at a loss as to why the
> crash is occurring.  I've have tried reproducing the crash manually by
> flooding my nodes with messages, but that doesn't seem to trigger the
> issue.
>  Below is output from various RabbitMQ logs:
> >
> > # cat /var/log/rabbitmq/rabbit <at> ip-10-123-123-123-sasl.log
> > =CRASH REPORT==== 18-May-2013::01:41:51 ===  crasher:    initial call:
> gen:init_it/6    pid: <0.301.0>    registered_name: []    exception exit:
> {{case_clause,{empty,{[],[]}}},
>  [{rabbit_amqqueue_process,subtract_acks,3,[]},
> >                       {rabbit_amqqueue_process,subtract_acks,4,[]},
>
>               {rabbit_amqqueue_process,handle_cast,2,[]},
>
>   {gen_server2,handle_msg,2,[]},                      {proc_lib,wake_up,3,
> >                                 [{file,"proc_lib.erl"},{line,249}]}]}
>
> in function  gen_server2:terminate/3    ancestors:
> [rabbit_amqqueue_sup,rabbit_sup,<0.207.0>]    messages: [{'$gen_cast',
> {resume,<0.676.0>}},
> >
> {'$gen_cast',{ack,[27583,27606,27629,27652,27675,27698,
>                                    27721,27744,27767,27790,27813,27836,
>
>                                27859,27882,27905,27928,27951,27974,
> >
>  27997,28020,28043,28066,28089,28112,
>                                    28135,28158,28179,28200,28221,28242,
>
>                                28263,28284,28305,28324,28342,28360,
> >
>  28378,28396,28414,28432,28450,28468,
>                                    28486,28504,28522,28540,28558,28576,
>
>                                28594,28612],
>     <0.737.0>}},
> >                   {'$gen_cast',{resume,<0.737.0>}},
> {'$gen_cast',{ack,[27608,27631,27654,27677,27700,27723,
>
>                27746,27769,27792,27815,27838,27861,
> >
>  27884,27907,27930,27953,27976,27999,
>                                    28022,28045,28068,28091,28114,28137,
>
>                                28160,28181,28202,28223,28244,28265,
> >
>  28286,28307,28326,28344,28362,28380,
>                                    28398,28416,28434,28452,28470,28488,
>
>                                28506,28524,28542,28560,28578,28596,
> >                                      28614],
>       <0.676.0>}},                  {'$gen_cast',{ack,
> [27578,27601,27624,27647,27670,27693,
>  27716,27739,27762,27785,27808,27831,
> >
>  27854,27877,27900,27923,27946,27969,
>                                    27992,28015,28038,28061,28084,28107,
>
>                                28130,28153,28174,28195,28216,28237,
> >
>  28258,28279,28300,28321,28340,28358,
>                                    28376,28394,28412,28430,28448,28466,
>
>                                28484,28502,28520,28538,28556,28574,
> >                                      28592,28610],
>             <0.716.0>}},
> {'$gen_cast',{resume,<0.716.0>}},
>                 {'$gen_cast',{ack,[27582,27605,27628,27651,27674,27697,
> >
>  27720,27743,27766,27789,27812,27835,
>                                    27858,27881,27904,27927,27950,27973,
>
>                                27996,28019,28042,28065,28088,28111,
> >
>  28134,28157,28178,28199,28220,28241,
>                                    28262,28283,28304,28323,28341,28359,
>
>                                28377,28395,28413,28431,28449,28467,
> >
>  28485,28503,28521,28539,28557,28575,
>                                    28593,28611],
>         <0.737.0>}}]    links: [<0.300.0>]
> >     dictionary: [{{ch,<0.729.0>},                   {cr,
> <0.729.0>,#Ref<0.0.0.12296>,
>  {[28715,28696,28677,28658,28639,28620,28602,28584,
>  28566,28548,28530,28512,28494,28476,28458,28440,
> >
>  28422,28404,28386,28368,28350,28332,28313,28292,
>                        28271,28250,28229,28208,28187,28166,28143,28120,
>
>                    28097,28074,28051,28028,28005,27982,27959,27936,
> >
>  27913,27890,27867,27844,27821,27798,27775,27752,
>                        27729,27706,27683,27660,27637,27614],
>         [27591]},                       1,                       {[],[]},
> >                        {qstate,<0.728.0>,active,{0,nil}},
>
>      11}},                  {{credit_to,<7350.877.0>},22},
> {{ch,<0.608.0>},                   {cr,<0.608.0>,#Ref<0.0.0.9041>,
> >
>  {[28708,28689,28670,28651,28632,28607,28589,28571,
>                        28553,28535,28517,28499,28481,28463,28445,28427,
>
>                    28409,28391,28373,28355,28337,28318,28297,28276,
> >
>  28255,28234,28213,28192,28171,28150,28127,28104,
>                        28081,28058,28035,28012,27989,27966,27943,27920,
>
>                    27897,27874,27851,27828,27805,27782,27759,27736,
> >                          27713,27690,27667,27644,27621,27598],
>             [27575]},                       1,                       {[],
> []},                       {qstate,<0.607.0>,active,{0,nil}},
> >                        38}},                  {{ch,<0.624.0>},
>        {cr,<0.624.0>,#Ref<0.0.0.9436>,
>  {[28722,28703,28684,28665,28646],[28627]},                       1,
> >                        {[],[]},                       {qstate,
> <0.623.0>,active,{0,nil}},                       36}},
> {{ch,<0.696.0>},                   {cr,<0.696.0>,#Ref<0.0.0.11414>,
> >                        {[],[]},                       2,
>      {[],[]},                       {qstate,<0.695.0>,active,{0,nil}},
>                  24}},                  {{ch,<0.564.0>},
> >                    {cr,<0.564.0>,#Ref<0.0.0.7285>,
>  {[28718,28699,28680,28661,28642],[28623]},                       1,
>                {[],[]},                       {qstate,<0.563.0>,active,
> {0,nil}},
> >                        12}},                  {{ch,<0.644.0>},
>        {cr,<0.644.0>,#Ref<0.0.0.10071>,
>  {[28713,28694,28675,28656,28637,28618,28600,28582,
>  28564,28546,28528,28510,28492,28474,28456,28438,
> >
>  28420,28402,28384,28366,28348,28330,28311,28290,
>                        28269,28248,28227,28206,28185,28164,28141,28118,
>
>                    28095,28072,28049,28026,28003,27980,27957,27934,
> >
>  27911,27888,27865,27842,27819,27796,27773,27750,
>                        27727,27704,27681,27658,27635,27612],
>         [27589]},                       1,                       {[],[]},
> >                        {qstate,<0.643.0>,active,{0,nil}},
>
>      11}},                  {{ch,<0.676.0>},                   {cr,
> <0.676.0>,#Ref<0.0.0.11309>,
>  {[28614,28613,28596,28595,28578,28577,28560,28559,
> >
>  28542,28541,28524,28523,28506,28505,28488,28487,
>                        28470,28469,28452,28451,28434,28433,28416,28415,
>
>                    28398,28397,28380,28379,28362,28361,28344,28343,
> >
>  28326,28325,28307,28306,28286,28285,28265,28264,
>                        28244,28243,28223,28222,28202,28201,28181,28180,
>
>                    28160,28159,28137,28136,28114,28113,28091,28090,
> >
>  28068,28067,28045,28044,28022,28021,27999,27998,
>                        27976,27975,27953,27952,27930,27929,27907,27906,
>
>                    27884,27883,27861,27860,27838,27837,27815,27814,
> >
>  27792,27791,27769,27768,27746,27745,27723,27722,
>                        27700,27699,27677,27676,27654,27653,27631,27630,
>
>                    27608,27607,27585],                        [27584]},
> >                        2,                       {[{<0.676.0>,
>
>             {consumer,<<"amq.ctag-0cvDGmyaAbEW_j15AfhGHQ">>,
>                     true}}],
> >                         [{<0.676.0>,                          {consumer,
> <<"amq.ctag-YqU04SIfQv6P-QVueEjbRg">>,
> true}}]},                       {qstate,<0.675.0>,suspended,{0,nil}},
> >                        25}},
> {{xtype_to_module,direct},rabbit_exchange_type_direct},
> {{credit_to,<7350.833.0>},31},                  {{ch,<0.745.0>},
>        {cr,<0.745.0>,#Ref<0.0.0.12674>,
> >
>  {[28716,28697,28678,28659,28640,28621,28603,28585,
>                        28567,28549,28531,28513,28495,28477,28459,28441,
>
>                    28423,28405,28387,28369,28351,28333,28314,28293,
> >
>  28272,28251,28230,28209,28188,28167,28144,28121,
>                        28098,28075,28052,28029,28006,27983,27960,27937,
>
>                    27914,27891,27868,27845,27822,27799,27776,27753,
> >                          27730,27707,27684,27661,27638,27615],
>             [27592]},                       1,                       {[],
> []},                       {qstate,<0.744.0>,active,{0,nil}},
> >                        37}},                  {{ch,<0.660.0>},
>        {cr,<0.660.0>,#Ref<0.0.0.10650>,
>  {[28712,28693,28674,28655,28636,28617,28599,28581,
>  28563,28545,28527,28509,28491,28473,28455,28437,
> >
>  28419,28401,28383,28365,28347,28329,28310,28289,
>                        28268,28247,28226,28205,28184,28163,28140,28117,
>
>                    28094,28071,28048,28025,28002,27979,27956,27933,
> >
>  27910,27887,27864,27841,27818,27795,27772,27749,
>                        27726,27703,27680,27657,27634,27611],
>         [27588]},                       1,                       {[],[]},
> >                        {qstate,<0.659.0>,active,{0,nil}},
>
>      11}},                  {{credit_to,<7350.837.0>},32},
> {{credit_to,<7350.881.0>},17},                  {{ch,<0.737.0>},
> >                    {cr,<0.737.0>,#Ref<0.0.0.12429>,
>  {[28612,28611,28594,28593,28576,28575,28558,28557,
>  28540,28539,28522,28521,28504,28503,28486,28485,
> >
>  28468,28467,28450,28449,28432,28431,28414,28413,
>                        28396,28395,28378,28377,28360,28359,28342,28341,
>
>                    28324,28323,28305,28304,28284,28283,28263,28262,
> >
>  28242,28241,28221,28220,28200,28199,28179,28178,
>                        28158,28157,28135,28134,28112,28111,28089,28088,
>
>                    28066,28065,28043,28042,28020,28019,27997,27996,
> >
>  27974,27973,27951,27950,27928,27927,27905,27904,
>                        27882,27881,27859,27858,27836,27835,27813,27812,
>
>                    27790,27789,27767,27766,27744,27743,27721,27720,
> >
>  27698,27697,27675,27674,27652,27651,27629,27628,
>                        27606,27605,27583],
> [27582]},
>                      2,                       {[{<0.737.0>,
> >                           {consumer,<<"amq.ctag-
> ITZqhulzHhUzx1uy1Eot3g">>,                                    true}}],
>                   [{<0.737.0>,                          {consumer,
> <<"amq.ctag-hpo5ejdoJRdLrT6JS42jGw">>,
> >                                     true}}]},
>  {qstate,<0.736.0>,suspended,{0,nil}},                       11}},
>         {credit_blocked,[]},                  {{credit_to,<7350.854.0>},3},
> >                   {{ch,<0.716.0>},                   {cr,
> <0.716.0>,#Ref<0.0.0.11820>,
>  {[28610,28609,28592,28591,28574,28573,28556,28555,
>  28538,28537,28520,28519,28502,28501,28484,28483,
> >
>  28466,28465,28448,28447,28430,28429,28412,28411,
>                        28394,28393,28376,28375,28358,28357,28340,28339,
>
>                    28321,28320,28300,28299,28279,28278,28258,28257,
> >
>  28237,28236,28216,28215,28195,28194,28174,28173,
>                        28153,28152,28130,28129,28107,28106,28084,28083,
>
>                    28061,28060,28038,28037,28015,28014,27992,27991,
> >
>  27969,27968,27946,27945,27923,27922,27900,27899,
>                        27877,27876,27854,27853,27831,27830,27808,27807,
>
>                    27785,27784,27762,27761,27739,27738,27716,27715,
> >
>  27693,27692,27670,27669,27647,27646,27624,27623,
>                        27601,27600,27578],
> [27577]},
>                      2,                       {[{<0.716.0>,
> >                           {consumer,<<"amq.ctag-BTlS-GmbXNpcU-
> wUlMI60Q">>,                                    true}}],
>     [{<0.716.0>,                          {consumer,<<"amq.ctag-
> loc5monF8M1pz_Bb8ypumw">>,
> >                                     true}}]},
>  {qstate,<0.715.0>,suspended,{0,nil}},                       44}},
>         {{ch,<0.782.0>},                   {cr,<0.782.0>,#Ref<0.0.0.15649>,
> >
>  {[28714,28695,28676,28657,28638,28619,28601,28583,
>                        28565,28547,28529,28511,28493,28475,28457,28439,
>
>                    28421,28403,28385,28367,28349,28331,28312,28291,
> >
>  28270,28249,28228,28207,28186,28165,28142,28119,
>                        28096,28073,28050,28027,28004,27981,27958,27935,
>
>                    27912,27889,27866,27843,27820,27797,27774,27751,
> >                          27728,27705,27682,27659,27636,27613],
>             [27590]},                       1,                       {[],
> []},                       {qstate,<0.781.0>,active,{0,nil}},
> >                        35}},                  {{credit_to,
> <7350.846.0>},22},                  {{ch,<0.684.0>},                   {cr,
> <0.684.0>,#Ref<0.0.0.11198>,
>  {[28711,28692,28673,28654,28635,28616,28598,28580,
> >
>  28562,28544,28526,28508,28490,28472,28454,28436,
>                        28418,28400,28382,28364,28346,28328,28309,28288,
>
>                    28267,28246,28225,28204,28183,28162,28139,28116,
> >
>  28093,28070,28047,28024,28001,27978,27955,27932,
>                        27909,27886,27863,27840,27817,27794,27771,27748,
>
>                    27725,27702,27679,27656,27633,27610],
>     [27587]},
> >                        1,                       {[],[]},
>      {qstate,<0.683.0>,active,{0,nil}},                       11}},
>
>         {{ch,<0.692.0>},                   {cr,<0.692.0>,#Ref<0.0.0.11088>,
> >
>  {[28710,28691,28672,28653,28634,28615,28597,28579,
>                        28561,28543,28525,28507,28489,28471,28453,28435,
>
>                    28417,28399,28381,28363,28345,28327,28308,28287,
> >
>  28266,28245,28224,28203,28182,28161,28138,28115,
>                        28092,28069,28046,28023,28000,27977,27954,27931,
>
>                    27908,27885,27862,27839,27816,27793,27770,27747,
> >                          27724,27701,27678,27655,27632,27609],
>             [27586]},                       1,                       {[],
> []},                       {qstate,<0.691.0>,active,{0,nil}},
> >                        12}},                  {{ch,<0.648.0>},
>        {cr,<0.648.0>,#Ref<0.0.0.10283>,
>  {[28717,28698,28679,28660,28641],[28622]},                       1,
> >                        {[],[]},                       {qstate,
> <0.647.0>,active,{0,nil}},                       12}},
> {guid,{{2296174761,591959305,1562876388,1822892473},1}},
> >                   {{ch,<0.720.0>},                   {cr,
> <0.720.0>,#Ref<0.0.0.12036>,
>  {[28723,28704,28685,28666,28647],[28628]},                       1,
>                {[],[]},
> >                        {qstate,<0.719.0>,active,{0,nil}},
>
>      37}},                  {{credit_to,<7350.869.0>},39},
> {{ch,<0.636.0>},                   {cr,<0.636.0>,#Ref<0.0.0.9960>,
> >
>  {[28705,28686,28667,28648,28629,28604,28586,28568,
>                        28550,28532,28514,28496,28478,28460,28442,28424,
>
>                    28406,28388,28370,28352,28334,28315,28294,28273,
> >
>  28252,28231,28210,28189,28168,28147,28124,28101,
>                        28078,28055,28032,28009,27986,27963,27940,27917,
>
>                    27894,27871,27848,27825,27802,27779,27756,27733,
> >                          27710,27687,27664,27641,27618,27595],
>             [27572]},                       1,                       {[],
> []},                       {qstate,<0.635.0>,active,{0,nil}},
> >                        15}},                  {{credit_to,
> <7350.850.0>},50},                  {{ch,<0.616.0>},                   {cr,
> <0.616.0>,#Ref<0.0.0.9300>,
>  {[28719,28700,28681,28662,28643],[28624]},
> >                        1,                       {[],[]},
>      {qstate,<0.615.0>,active,{0,nil}},                       12}},
>
>         {{ch,<0.509.0>},                   {cr,<0.509.0>,#Ref<0.0.0.2243>,
> >
>  {[28302,28281,28260,28239,28218,28197,28176,28155,
>                        28132,28109,28086,28063,28040,28017,27994,27971],
>                     [27580,27603,27626,27649,27672,27695,27718,27741,
> >
>  27764,27787,27810,27833,27856,27879,27902,27925,
>                        27948]},                       3,
>    {[],[]},                       {qstate,<0.508.0>,active,{0,nil}},
> >                        36}},                  {{credit_to,
> <7350.873.0>},17},                  {{ch,<0.588.0>},                   {cr,
> <0.588.0>,#Ref<0.0.0.7808>,
>  {[28721,28702,28683,28664,28645],[28626]},
> >                        1,                       {[],[]},
>      {qstate,<0.587.0>,active,{0,nil}},                       12}},
>
>         {{ch,<0.664.0>},                   {cr,<0.664.0>,#Ref<0.0.0.10772>,
> >                        {[28720,28701,28682,28663,28644],[28625]},
>
>              1,                       {[],[]},
>  {qstate,<0.663.0>,active,{0,nil}},                       13}},
> >                   {fhc_age_tree,{0,nil}},                  {{ch,
> <0.708.0>},                   {cr,<0.708.0>,#Ref<0.0.0.11695>,
>          {[28707,28688,28669,28650,28631,28606,28588,28570,
> >
>  28552,28534,28516,28498,28480,28462,28444,28426,
>                        28408,28390,28372,28354,28336,28317,28296,28275,
>
>                    28254,28233,28212,28191,28170,28149,28126,28103,
> >
>  28080,28057,28034,28011,27988,27965,27942,27919,
>                        27896,27873,27850,27827,27804,27781,27758,27735,
>
>                    27712,27689,27666,27643,27620,27597],
>     [27574]},
> >                        1,                       {[],[]},
>      {qstate,<0.707.0>,active,{0,nil}},                       35}},
>
>         {{credit_to,<7350.829.0>},13},
> >                   {{ch,<0.757.0>},                   {cr,
> <0.757.0>,#Ref<0.0.0.13150>,
>  {[28706,28687,28668,28649,28630,28605,28587,28569,
>  28551,28533,28515,28497,28479,28461,28443,28425,
> >
>  28407,28389,28371,28353,28335,28316,28295,28274,
>                        28253,28232,28211,28190,28169,28148,28125,28102,
>
>                    28079,28056,28033,28010,27987,27964,27941,27918,
> >
>  27895,27872,27849,27826,27803,27780,27757,27734,
>                        27711,27688,27665,27642,27619,27596],
>         [27573]},                       1,                       {[],[]},
> >                        {qstate,<0.756.0>,active,{0,nil}},
>
>      49}},                  {{ch,<0.572.0>},                   {cr,
> <0.572.0>,#Ref<0.0.0.7536>,
>  {[28709,28690,28671,28652,28633,28608,28590,28572,
> >
>  28554,28536,28518,28500,28482,28464,28446,28428,
>                        28410,28392,28374,28356,28338,28319,28298,28277,
>
>                    28256,28235,28214,28193,28172,28151,28128,28105,
> >
>  28082,28059,28036,28013,27990,27967,27944,27921,
>                        27898,27875,27852,27829,27806,27783,27760,27737,
>
>                    27714,27691,27668,27645,27622,27599],
>     [27576]},
> >                        1,                       {[],[]},
>      {qstate,<0.571.0>,active,{0,nil}},                       35}},
>
>         {{credit_to,<7350.825.0>},2},                  {{credit_to,
> <7350.858.0>},3}]
> >     trap_exit: true    status: running    heap_size: 121536
> stack_size:
> 27    reductions: 9363545  neighbours:=SUPERVISOR REPORT==== 18-May-
> 2013::01:41:51 ===     Supervisor: {local,rabbit_amqqueue_sup}
> >      Context:    child_terminated     Reason:     {{case_clause,{empty,
> {[],[]}}},                  [{rabbit_amqqueue_process,subtract_acks,3,[]},
>                  {rabbit_amqqueue_process,subtract_acks,4,[]},
> >                    {rabbit_amqqueue_process,handle_cast,2,[]},
>        {gen_server2,handle_msg,2,[]},
>  {proc_lib,wake_up,3,
> [{file,"proc_lib.erl"},{line,249}]}]}     Offender:   [{pid,<0.301.0>},
> >                   {name,rabbit_amqqueue},                  {mfa,
>             {rabbit_amqqueue_process,start_link,
> [{amqqueue,                               {resource,<<"/">>,queue,
> >                                    <<"document_queue">>},
>
>              true,false,none,[],<0.7622.0>,[],[],undefined,
>
>              []}]}},                  {restart_type,temporary},
> >                   {shutdown,4294967295},
> {child_type,worker}]
> >
> > Notice how the case_clause is empty.  The other rabbit log looks similar:
> >
> > # cat /var/log/rabbitmq/rabbit-
> 72dRMgatfUn5amjFlPYPZgfGRAsWV3w2 at public.gmane.org
> >
> >
> > =ERROR REPORT==== 18-May-2013::01:41:48 ===
> > ** Generic server <0.301.0> terminating
> > ** Last message in was {'$gen_cast',
> >
> >                            {ack,
> >
>  [27585,27584,27607,27630,27653,27676,27699,
> >
> 27722,27745,27768,27791,27814,27837,27860,
> >
> 27883,27906,27929,27952,27975,27998,28021,
> >
> 28044,28067,28090,28113,28136,28159,28180,
> >
> 28201,28222,28243,28264,28285,28306,28325,
> >
> 28343,28361,28379,28397,28415,28433,28451,
> >
> 28469,28487,28505,28523,28541,28559,28577,
> >                                 28595,28613],
> >                                <0.676.0>}}
> > ** When Server state == {q,
> >
> >                          {amqqueue,
> >                           {resource,<<"/">>,queue,
> >                            <<"document_queue">>},
> >                           true,false,none,[],<0.301.0>,[],[],undefined,
> []},
> >                          none,true,rabbit_variable_queue,
> >                          {vqstate,
> >
> >                           {0,{[],[]}},
> >                           {0,{[],[]}},
> >                           {delta,undefined,0,undefined},
> >                           {0,{[],[]}},
> >
> >                           {0,{[],[]}},
> >                           ... [ thousands of lines of state ] ...
> >
> >
> > ** Reason for termination ==
> > ** {{case_clause,{empty,{[],[]}}},
> >     [{rabbit_amqqueue_process,subtract_acks,3,[]},
> >      {rabbit_amqqueue_process,subtract_acks,4,[]},
> >      {rabbit_amqqueue_process,handle_cast,2,[]},
> >      {gen_server2,handle_msg,2,[]},
> >
> >      {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
> >
> >
> >
> > =ERROR REPORT==== 18-May-2013::01:41:51 ===
> > connection <0.430.0>, channel 22 - soft error:
> > {amqp_error,not_found,
> >
> >             "no queue 'document_queue' in vhost '/'",
> >
> >             'queue.declare'}
> >
> > =ERROR REPORT==== 18-May-2013::01:41:51 ===
> >
> > connection <0.384.0>, channel 12 - soft error:
> >
> > {amqp_error,not_found,
> >             "no queue 'document_queue' in vhost '/'",
> >             'queue.declare'}
> >
> >
> >
> > =ERROR REPORT==== 18-May-2013::01:41:51 ===
> > connection <0.384.0>, channel 15 - soft error:
> > {amqp_error,not_found,
> >
> >             "no queue 'document_queue' in vhost '/'",
> >
> >             'queue.declare'}
> >
> > =ERROR REPORT==== 18-May-2013::01:41:51 ===
> >
> > connection <0.373.0>, channel 23 - soft error:
> >
> > {amqp_error,not_found,
> >             "no queue 'document_queue' in vhost '/'",
> >             'queue.declare'}
> >
> >  ... [ repeated a bunch of times ] ...
> >
> > I also see this in my /var/log/syslog with regards to beam.smp:
> >
> >
> > # cat /var/log/syslogMay 17 22:46:23 ip-10-123-123-123 kernel:
> [244800.176041] INFO: task beam.smp:18971 blocked for more than 120
> seconds.May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176053] "echo 0 >
> /proc/sys/kernel/hung_task_timeout_secs" disables this message.
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176060] beam.smp
>  D ffff8801bfd93700     0 18971  18962 0x00000000May 17 22:46:23 ip-10-123-
> 123-123 kernel: [244800.176065]  ffff8801b11cdcb8 0000000000000282
> 0000000000000000 ffffffffffffffe0
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176070]
>  ffff8801b11cdfd8 ffff8801b11cdfd8 ffff8801b11cdfd8 0000000000013700May 17
> 22:46:23 ip-10-123-123-123 kernel: [244800.176075]  ffff8801b3180000
> ffff8801b35244a0 00007f500e2079e0 ffff8801b146bb80
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176079] Call Trace:May
> 17 22:46:23 ip-10-123-123-123 kernel: [244800.176089]  [<ffffffff8165434f>]
> schedule+0x3f/0x60May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176094]
>  [<ffffffff8106aef5>] exit_mm+0x85/0x130
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176097]
>  [<ffffffff8106b10e>] do_exit+0x16e/0x450May 17 22:46:23 ip-10-123-123-123
> kernel: [244800.176102]  [<ffffffff810797aa>] ? __dequeue_signal+0x6a/0xb0
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176105]
>  [<ffffffff8106b594>] do_group_exit+0x44/0xa0May 17 22:46:23 ip-10-123-123-
> 123 kernel: [244800.176108]  [<ffffffff8107c36c>]
> get_signal_to_deliver+0x21c/0x420
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176113]
>  [<ffffffff81014825>] do_signal+0x45/0x130May 17 22:46:23 ip-10-123-123-123
> kernel: [244800.176116]  [<ffffffff8105539d>] ? set_next_entity+0xad/0xd0
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176120]
>  [<ffffffff81014ad5>] do_notify_resume+0x65/0x80May 17 22:46:23 ip-10-123-
> 123-123 kernel: [244800.176124]  [<ffffffff8165ea90>]
> int_signal+0x12/0x17... [ repeated 9 more times with same timestamp ] ...
> >
> > There are no strange CPU spikes on my EC2 node based on AWS monitoring.
> The only thing that seems to stand out is that my writes to my EBS volume
> spike during the crash (~90 write OPs/sec, 4 MiB/sec write bandwidth,
> ~30ms/op write latency).
> >
> > My team and I are completely stumped and would appreciate any insight you
> might have to the crash reports.  Is this a problem with writes hanging
> when
> going against the EBS volume since EBS volumes are essentially network
> mounted?  Is there a way to configure rabbit to be more tolerant of these
> delays?
> >
> >
> > For debugging purposes, below is the status output of one of the nodes
> when it is healthy (so you can see the versions of everything i'm running):
> >
> >
> >
> > # rabbitmqctl statusStatus of node 'rabbit <at> ip-10-123-123-123' ...
> [{pid,28978}, {running_applications,     [{rabbitmq_management,"RabbitMQ
> Management Console","3.1.0"},      {rabbitmq_web_dispatch,"RabbitMQ Web
> Dispatcher","3.1.0"},
> >       {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"},
> {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.0-gitd541e9a"},
> {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},
> >       {rabbit,"RabbitMQ","3.1.0"},      {os_mon,"CPO  CXC 138
> 46","2.2.11"},      {inets,"INETS  CXC 138 49","5.9.4"},
> {mnesia,"MNESIA  CXC 138 12","4.8"},
> >       {amqp_client,"RabbitMQ AMQP Client","3.1.0"},      {xmerl,"XML
> parser","1.3.3"},      {sasl,"SASL  CXC 138 11","2.3.1"},
> {stdlib,"ERTS
>  CXC 138 10","1.19.1"},
> >       {kernel,"ERTS  CXC 138 10","2.16.1"}]}, {os,
> {unix,linux}}, {erlang_version,     "Erlang R16B (erts-5.10.1) [source-
> 05f1189] [64-bit] [smp:8:8] [async-threads:30] [hipe] [kernel-
> poll:true]\n"},
> >  {memory,     [{total,60179048},      {connection_procs,5274808},
> {queue_procs,13107264},      {plugins,354272},      {other_proc,9741830},
> >       {mnesia,150456},      {mgmt_db,12248},      {msg_index,34768},
> {other_ets,1148248},      {binary,4905584},      {code,19565863},
> {atom,703377},      {other_system,5180330}]},
> >
>
>  {vm_memory_high_watermark,0.8}, {vm_memory_limit,5828434329}, {disk_free_li
> mit,1000000000}, {disk_free,3953344512}, {file_descriptors,
>  [{total_limit,924},{total_used,6},{sockets_limit,829},{sockets_used,4}]},
> >  {processes,[{limit,1048576},
> {used,348}]}, {run_queue,0}, {uptime,3796}]...done.
> >
> > Note that I am using Erlang v16 from the Erlang Solutions repo
> (esl-erlang
> package).  I originally was using Erlang v14 from Ubuntu repos (erlang-
> base), but decided to upgrade hoping it would resolve the issue (which it
> did not).  I have also tried running RabbitMQ 3.0.4 without success.  This
> issue seems to affect both versions.
> >
> > Thanks,
> > Karl
> > _______________________________________________
> > rabbitmq-discuss mailing listrabbitmq-discuss <at>
> lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-
> bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> >
> >
> >
> > <div>
> > <div dir="ltr">
> > <div>Karl,<br><br>Wild speculation would be that messages have been
> consumed from a queue but that queue (name = document_queue?) is for some
> reason missing in action (gone, inaccessible, ...) when the consumer
> subsequently tries to ack the message(s). <br><br>
> > </div>Brett<br><br>
> > </div>
> > <div class="gmail_extra">
> > <br><br><div class="gmail_quote">On Sat, May 18, 2013 at 3:20 PM, Karl
> Rieb <span dir="ltr">&lt;<a href="mailto:karl.rieb at ..."
> target="_blank">karl.rieb <at> gmail.com</a>&gt;</span> wrote:<br>
> <blockquote class="gmail_quote">Hi,<div><br></div>
> > <div>I am running a RabbitMQ cluster of 4 nodes in AWS EC2 on c1.xlarge
> instances using Ubuntu 12.04 LTS (kernel 3.2.0-38). &nbsp;Periodically two
> of my nodes holding the largest queues will crash and require me to restart
> the rabbitmq-server service. &nbsp;Looking at the logs, I'm at a loss as to
> why the crash is occurring. &nbsp;I've have tried reproducing the crash
> manually by flooding my nodes with messages, but that doesn't seem to
> trigger the issue. &nbsp;Below is output from various RabbitMQ logs:</div>
> > <div><br></div>
> > <blockquote class="gmail_quote"># cat /var/log/rabbitmq/rabbit <at>
> ip-10-
> 123-123-123-sasl.log<br>
> > =CRASH REPORT==== 18-May-2013::01:41:51 ===<br>&nbsp; crasher:<br>&nbsp;
> &nbsp; initial call: gen:init_it/6<br>&nbsp; &nbsp; pid: &lt;0.301.0&gt;
> <br>&nbsp; &nbsp; registered_name: []<br>&nbsp; &nbsp; exception exit:
> {{case_clause,{empty,{[],[]}}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;[{rabbit_amqqueue_process,subtract_acks,3,
> []},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; {rabbit_amqqueue_process,subtract_acks,4,[]},<br>&nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {rabbit_amqqueue_process,handle_cast,2,[]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {gen_server2,handle_msg,2,
> []},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {proc_lib,wake_up,3,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{file,"proc_lib.erl"},
> {line,249}]}]}<br>&nbsp; &nbsp; &nbsp; in function
> &nbsp;gen_server2:terminate/3<br>&nbsp; &nbsp; ancestors:
> [rabbit_amqqueue_sup,rabbit_sup,&lt;0.207.0&gt;]<br>&nbsp; &nbsp; messages:
> [{'$gen_cast',{resume,&lt;0.676.0&gt;}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {'$gen_cast',{ack,[27583,27606,27629,27652,27675,27698,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;27721,27744,27767,27790,27813,27836,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;27859,27882,27905,27928,27951,27974,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;27997,28020,28043,28066,28089,28112,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;28135,28158,28179,28200,28221,28242,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28263,28284,28305,28324,28342,28360,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28378,28396,28414,28432,28450,28468,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;28486,28504,28522,28540,28558,28576,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28594,28612],<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;0.737.0&gt;}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {'$gen_cast',{resume,&lt;0.737.0&gt;}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {'$gen_cast',{ack,
> [27608,27631,27654,27677,27700,27723,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp;27746,27769,27792,27815,27838,27861,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;27884,27907,27930,27953,27976,27999,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;28022,28045,28068,28091,28114,28137,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28160,28181,28202,28223,28244,28265,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28286,28307,28326,28344,28362,28380,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;28398,28416,28434,28452,28470,28488,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28506,28524,28542,28560,28578,28596,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28614],
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;0.676.0&gt;}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {'$gen_cast',{ack,[27578,27601,27624,27647,27670,27693,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;27716,27739,27762,27785,27808,27831,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;27854,27877,27900,27923,27946,27969,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;27992,28015,28038,28061,28084,28107,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28130,28153,28174,28195,28216,28237,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28258,28279,28300,28321,28340,28358,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;28376,28394,28412,28430,28448,28466,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28484,28502,28520,28538,28556,28574,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28592,28610],
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;0.716.0&gt;}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {'$gen_cast',{resume,&lt;0.716.0&gt;}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {'$gen_cast',{ack,
> [27582,27605,27628,27651,27674,27697,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;27720,27743,27766,27789,27812,27835,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;27858,27881,27904,27927,27950,27973,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;27996,28019,28042,28065,28088,28111,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28134,28157,28178,28199,28220,28241,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;28262,28283,28304,28323,28341,28359,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28377,28395,28413,28431,28449,28467,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28485,28503,28521,28539,28557,28575,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;28593,28611],<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &lt;0.737.0&gt;}}]<br>&nbsp; &nbsp; links:
> [&lt;0.300.0&gt;]<br>
> > &nbsp; &nbsp; dictionary: [{{ch,&lt;0.729.0&gt;},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.729.0&gt;,#Ref&lt;0.0.0.12296&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28715,28696,28677,28658,28639,28620,28602,28584,<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28566,28548,28530,28512,28494,28476,28458,28440,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28422,28404,28386,28368,28350,28332,28313,28292,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28271,28250,28229,28208,28187,28166,28143,28120,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28097,28074,28051,28028,28005,27982,27959,27936,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27913,27890,27867,27844,27821,27798,27775,27752,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27729,27706,27683,27660,27637,27614],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27591]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{qstate,&lt;0.728.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{credit_to,&lt;7350.877.0&gt;},22},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.608.0&gt;},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.608.0&gt;,#Ref&lt;0.0.0.9041&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[28708,28689,28670,28651,28632,28607,28589,28571,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp;28553,28535,28517,28499,28481,28463,28445,28427,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28409,28391,28373,28355,28337,28318,28297,28276,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28255,28234,28213,28192,28171,28150,28127,28104,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28081,28058,28035,28012,27989,27966,27943,27920,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27897,27874,27851,27828,27805,27782,27759,27736,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27713,27690,27667,27644,27621,27598],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27575]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.607.0&gt;,active,{0,nil}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;38}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{ch,&lt;0.624.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.624.0&gt;,#Ref&lt;0.0.0.9436&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28722,28703,28684,28665,28646],[28627]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{qstate,&lt;0.623.0&gt;,active,{0,nil}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;36}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{ch,&lt;0.696.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.696.0&gt;,#Ref&lt;0.0.0.11414&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.695.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.564.0&gt;},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.564.0&gt;,#Ref&lt;0.0.0.7285&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28718,28699,28680,28661,28642],[28623]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],
> []},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{qstate,&lt;0.563.0&gt;,active,{0,nil}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;12}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{ch,&lt;0.644.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.644.0&gt;,#Ref&lt;0.0.0.10071&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28713,28694,28675,28656,28637,28618,28600,28582,<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28564,28546,28528,28510,28492,28474,28456,28438,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28420,28402,28384,28366,28348,28330,28311,28290,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28269,28248,28227,28206,28185,28164,28141,28118,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28095,28072,28049,28026,28003,27980,27957,27934,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27911,27888,27865,27842,27819,27796,27773,27750,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27727,27704,27681,27658,27635,27612],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27589]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{qstate,&lt;0.643.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.676.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.676.0&gt;,#Ref&lt;0.0.0.11309&gt;,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {[28614,28613,28596,28595,28578,28577,28560,28559,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28542,28541,28524,28523,28506,28505,28488,28487,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28470,28469,28452,28451,28434,28433,28416,28415,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28398,28397,28380,28379,28362,28361,28344,28343,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28326,28325,28307,28306,28286,28285,28265,28264,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28244,28243,28223,28222,28202,28201,28181,28180,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28160,28159,28137,28136,28114,28113,28091,28090,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28068,28067,28045,28044,28022,28021,27999,27998,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27976,27975,27953,27952,27930,27929,27907,27906,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27884,27883,27861,27860,27838,27837,27815,27814,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27792,27791,27769,27768,27746,27745,27723,27722,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27700,27699,27677,27676,27654,27653,27631,27630,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27608,27607,27585],<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [27584]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;{[{&lt;0.676.0&gt;,<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {consumer,&lt;&lt;"amq.ctag-0cvDGmyaAbEW_j15AfhGHQ"&gt;&gt;,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true}}],<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; [{&lt;0.676.0&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {consumer,&lt;&lt;"amq.ctag-YqU04SIfQv6P-QVueEjbRg"&gt;&gt;,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true}}]},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.675.0&gt;,suspended,{0,nil}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;25}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{xtype_to_module,direct},rabbit_exchange_type_direct},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{credit_to,&lt;7350.833.0&gt;},31},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.745.0&gt;},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.745.0&gt;,#Ref&lt;0.0.0.12674&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[28716,28697,28678,28659,28640,28621,28603,28585,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp;28567,28549,28531,28513,28495,28477,28459,28441,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28423,28405,28387,28369,28351,28333,28314,28293,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28272,28251,28230,28209,28188,28167,28144,28121,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28098,28075,28052,28029,28006,27983,27960,27937,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27914,27891,27868,27845,27822,27799,27776,27753,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27730,27707,27684,27661,27638,27615],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27592]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.744.0&gt;,active,{0,nil}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;37}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{ch,&lt;0.660.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.660.0&gt;,#Ref&lt;0.0.0.10650&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28712,28693,28674,28655,28636,28617,28599,28581,<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28563,28545,28527,28509,28491,28473,28455,28437,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28419,28401,28383,28365,28347,28329,28310,28289,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28268,28247,28226,28205,28184,28163,28140,28117,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28094,28071,28048,28025,28002,27979,27956,27933,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27910,27887,27864,27841,27818,27795,27772,27749,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27726,27703,27680,27657,27634,27611],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27588]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{qstate,&lt;0.659.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{credit_to,&lt;7350.837.0&gt;},32},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; {{credit_to,&lt;7350.881.0&gt;},17},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.737.0&gt;},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.737.0&gt;,#Ref&lt;0.0.0.12429&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28612,28611,28594,28593,28576,28575,28558,28557,<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28540,28539,28522,28521,28504,28503,28486,28485,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28468,28467,28450,28449,28432,28431,28414,28413,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28396,28395,28378,28377,28360,28359,28342,28341,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28324,28323,28305,28304,28284,28283,28263,28262,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28242,28241,28221,28220,28200,28199,28179,28178,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28158,28157,28135,28134,28112,28111,28089,28088,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28066,28065,28043,28042,28020,28019,27997,27996,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27974,27973,27951,27950,27928,27927,27905,27904,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27882,27881,27859,27858,27836,27835,27813,27812,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27790,27789,27767,27766,27744,27743,27721,27720,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27698,27697,27675,27674,27652,27651,27629,27628,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27606,27605,27583],<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [27582]},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{[{&lt;0.737.0&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; {consumer,&lt;&lt;"amq.ctag-
> ITZqhulzHhUzx1uy1Eot3g"&gt;&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; true}}],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{&lt;0.737.0&gt;,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {consumer,&lt;&lt;"amq.ctag-hpo5ejdoJRdLrT6JS42jGw"&gt;&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true}}]},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {qstate,&lt;0.736.0&gt;,suspended,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {credit_blocked,[]},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{credit_to,&lt;7350.854.0&gt;},3},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.716.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.716.0&gt;,#Ref&lt;0.0.0.11820&gt;,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {[28610,28609,28592,28591,28574,28573,28556,28555,<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28538,28537,28520,28519,28502,28501,28484,28483,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28466,28465,28448,28447,28430,28429,28412,28411,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28394,28393,28376,28375,28358,28357,28340,28339,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28321,28320,28300,28299,28279,28278,28258,28257,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28237,28236,28216,28215,28195,28194,28174,28173,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28153,28152,28130,28129,28107,28106,28084,28083,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28061,28060,28038,28037,28015,28014,27992,27991,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27969,27968,27946,27945,27923,27922,27900,27899,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27877,27876,27854,27853,27831,27830,27808,27807,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27785,27784,27762,27761,27739,27738,27716,27715,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27693,27692,27670,27669,27647,27646,27624,27623,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27601,27600,27578],<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [27577]},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{[{&lt;0.716.0&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; {consumer,&lt;&lt;"amq.ctag-BTlS-GmbXNpcU-
> wUlMI60Q"&gt;&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> true}}],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; [{&lt;0.716.0&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {consumer,&lt;&lt;"amq.ctag-loc5monF8M1pz_Bb8ypumw"&gt;&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true}}]},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {qstate,&lt;0.715.0&gt;,suspended,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;44}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.782.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.782.0&gt;,#Ref&lt;0.0.0.15649&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[28714,28695,28676,28657,28638,28619,28601,28583,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp;28565,28547,28529,28511,28493,28475,28457,28439,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28421,28403,28385,28367,28349,28331,28312,28291,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28270,28249,28228,28207,28186,28165,28142,28119,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28096,28073,28050,28027,28004,27981,27958,27935,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27912,27889,27866,27843,27820,27797,27774,27751,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27728,27705,27682,27659,27636,27613],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27590]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.781.0&gt;,active,{0,nil}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;35}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{credit_to,&lt;7350.846.0&gt;},22},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.684.0&gt;},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.684.0&gt;,#Ref&lt;0.0.0.11198&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28711,28692,28673,28654,28635,28616,28598,28580,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28562,28544,28526,28508,28490,28472,28454,28436,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28418,28400,28382,28364,28346,28328,28309,28288,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28267,28246,28225,28204,28183,28162,28139,28116,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28093,28070,28047,28024,28001,27978,27955,27932,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27909,27886,27863,27840,27817,27794,27771,27748,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27725,27702,27679,27656,27633,27610],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27587]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.683.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.692.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.692.0&gt;,#Ref&lt;0.0.0.11088&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[28710,28691,28672,28653,28634,28615,28597,28579,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp;28561,28543,28525,28507,28489,28471,28453,28435,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28417,28399,28381,28363,28345,28327,28308,28287,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28266,28245,28224,28203,28182,28161,28138,28115,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28092,28069,28046,28023,28000,27977,27954,27931,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27908,27885,27862,27839,27816,27793,27770,27747,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27724,27701,27678,27655,27632,27609],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27586]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.691.0&gt;,active,{0,nil}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;12}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{ch,&lt;0.648.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.648.0&gt;,#Ref&lt;0.0.0.10283&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28717,28698,28679,28660,28641],[28622]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{qstate,&lt;0.647.0&gt;,active,{0,nil}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;12}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {guid,{{<a href="tel:2296174761" value="+12296174761"
> target="_blank">2296174761</a>,591959305,1562876388,1822892473},1}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.720.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.720.0&gt;,#Ref&lt;0.0.0.12036&gt;,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {[28723,28704,28685,28666,28647],[28628]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],
> []},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{qstate,&lt;0.719.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;37}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{credit_to,&lt;7350.869.0&gt;},39},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.636.0&gt;},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.636.0&gt;,#Ref&lt;0.0.0.9960&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[28705,28686,28667,28648,28629,28604,28586,28568,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp;28550,28532,28514,28496,28478,28460,28442,28424,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28406,28388,28370,28352,28334,28315,28294,28273,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28252,28231,28210,28189,28168,28147,28124,28101,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28078,28055,28032,28009,27986,27963,27940,27917,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27894,27871,27848,27825,27802,27779,27756,27733,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27710,27687,27664,27641,27618,27595],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27572]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.635.0&gt;,active,{0,nil}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;15}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{credit_to,&lt;7350.850.0&gt;},50},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.616.0&gt;},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.616.0&gt;,#Ref&lt;0.0.0.9300&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28719,28700,28681,28662,28643],[28624]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.615.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.509.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.509.0&gt;,#Ref&lt;0.0.0.2243&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[28302,28281,28260,28239,28218,28197,28176,28155,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp;28132,28109,28086,28063,28040,28017,27994,27971],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27580,27603,27626,27649,27672,27695,27718,27741,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27764,27787,27810,27833,27856,27879,27902,27925,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27948]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {qstate,&lt;0.508.0&gt;,active,{0,nil}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;36}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{credit_to,&lt;7350.873.0&gt;},17},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {{ch,&lt;0.588.0&gt;},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.588.0&gt;,#Ref&lt;0.0.0.7808&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28721,28702,28683,28664,28645],[28626]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.587.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.664.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.664.0&gt;,#Ref&lt;0.0.0.10772&gt;,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[28720,28701,28682,28663,28644],[28625]},<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{qstate,&lt;0.663.0&gt;,active,{0,nil}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;13}},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {fhc_age_tree,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {{ch,&lt;0.708.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {cr,&lt;0.708.0&gt;,#Ref&lt;0.0.0.11695&gt;,<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {[28707,28688,28669,28650,28631,28606,28588,28570,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28552,28534,28516,28498,28480,28462,28444,28426,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28408,28390,28372,28354,28336,28317,28296,28275,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28254,28233,28212,28191,28170,28149,28126,28103,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28080,28057,28034,28011,27988,27965,27942,27919,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27896,27873,27850,27827,27804,27781,27758,27735,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27712,27689,27666,27643,27620,27597],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27574]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.707.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;35}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{credit_to,&lt;7350.829.0&gt;},13},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.757.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.757.0&gt;,#Ref&lt;0.0.0.13150&gt;,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {[28706,28687,28668,28649,28630,28605,28587,28569,<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;28551,28533,28515,28497,28479,28461,28443,28425,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28407,28389,28371,28353,28335,28316,28295,28274,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28253,28232,28211,28190,28169,28148,28125,28102,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28079,28056,28033,28010,27987,27964,27941,27918,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27895,27872,27849,27826,27803,27780,27757,27734,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27711,27688,27665,27642,27619,27596],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27573]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;{qstate,&lt;0.756.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;49}},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{ch,&lt;0.572.0&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{cr,&lt;0.572.0&gt;,#Ref&lt;0.0.0.7536&gt;,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> {[28709,28690,28671,28652,28633,28608,28590,28572,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28554,28536,28518,28500,28482,28464,28446,28428,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28410,28392,28374,28356,28338,28319,28298,28277,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28256,28235,28214,28193,28172,28151,28128,28105,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;28082,28059,28036,28013,27990,27967,27944,27921,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27898,27875,27852,27829,27806,27783,27760,27737,
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;27714,27691,27668,27645,27622,27599],<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27576]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp;1,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {qstate,&lt;0.571.0&gt;,active,{0,nil}},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;35}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {{credit_to,&lt;7350.825.0&gt;},2},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; {{credit_to,&lt;7350.858.0&gt;},3}]<br>
> > &nbsp; &nbsp; trap_exit: true<br>&nbsp; &nbsp; status: running<br>&nbsp;
> &nbsp; heap_size: 121536<br>&nbsp; &nbsp; stack_size: 27<br>&nbsp; &nbsp;
> reductions: 9363545<br>&nbsp; neighbours:<br><br>=SUPERVISOR REPORT==== 18-
> May-2013::01:41:51 ===<br>&nbsp; &nbsp; &nbsp;Supervisor:
> {local,rabbit_amqqueue_sup}<br>
> > &nbsp; &nbsp; &nbsp;Context: &nbsp; &nbsp;child_terminated<br>&nbsp;
> &nbsp; &nbsp;Reason: &nbsp; &nbsp;
> {{case_clause,{empty,{[],[]}}},<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [{rabbit_amqqueue_process,subtract_acks,3,[]},<br>&nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {rabbit_amqqueue_process,subtract_acks,4,[]},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {rabbit_amqqueue_process,handle_cast,2,[]},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{gen_server2,handle_msg,2,[]},
> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}<br>&nbsp; &nbsp;
> &nbsp;Offender: &nbsp; [{pid,&lt;0.301.0&gt;},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {name,rabbit_amqqueue},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {mfa,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; {rabbit_amqqueue_process,start_link,<br>&nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; [{amqqueue,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {resource,&lt;&lt;"/"&gt;&gt;,queue,<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;&lt;&lt;"document_queue"&gt;&gt;},<br>&nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp;true,false,none,[],&lt;0.7622.0&gt;,[],[],undefined,<br>&nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;
> &nbsp; &nbsp; &nbsp;[]}]}},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; {restart_type,temporary},<br>
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {shutdown,4294967295},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; {child_type,worker}]</blockquote>
> > <div><br></div>
> > <div>Notice how the case_clause is empty. &nbsp;The other rabbit log
> looks
> similar:</div>
> > <div><br></div>
> > <blockquote class="gmail_quote"># cat /var/log/rabbitmq/rabbit at ...&nbsp;
> </blockquote>
> > <blockquote class="gmail_quote">&nbsp;</blockquote>
> > <blockquote class="gmail_quote">
> > =ERROR REPORT==== 18-May-2013::01:41:48 ===</blockquote>
> > <blockquote class="gmail_quote">** Generic server &lt;0.301.0&gt;
> terminating</blockquote>
> > <blockquote class="gmail_quote">** Last message in was {'$gen_cast',
> </blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp;{ack,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> [27585,27584,27607,27630,27653,27676,27699,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 27722,27745,27768,27791,27814,27837,27860,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 27883,27906,27929,27952,27975,27998,28021,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 28044,28067,28090,28113,28136,28159,28180,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 28201,28222,28243,28264,28285,28306,28325,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 28343,28361,28379,28397,28415,28433,28451,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 28469,28487,28505,28523,28541,28559,28577,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 28595,28613],</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;&lt;0.676.0&gt;}}</blockquote>
> > <blockquote class="gmail_quote">** When Server state == {q,</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp;{amqqueue,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {resource,&lt;&lt;"/"&gt;&gt;,queue,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;&lt;&lt;"document_queue"&gt;&gt;},</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true,false,none,
> [],&lt;0.301.0&gt;,[],[],undefined,[]},</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp;none,true,rabbit_variable_queue,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{vqstate,</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; {0,{[],[]}},</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {0,{[],[]}},</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> {delta,undefined,0,undefined},</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {0,{[],[]}},</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; {0,{[],[]}},&nbsp;</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ... [ thousands of lines
> of
> state ] ...&nbsp;</blockquote>
> > <blockquote class="gmail_quote">&nbsp;</blockquote>
> > <blockquote class="gmail_quote">
> > ** Reason for termination ==</blockquote>
> > <blockquote class="gmail_quote">** {{case_clause,{empty,{[],[]}}},
> </blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp;
> [{rabbit_amqqueue_process,subtract_acks,3,[]},</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp;
> {rabbit_amqqueue_process,subtract_acks,4,[]},</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp;
> {rabbit_amqqueue_process,handle_cast,2,[]},</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp;
> {gen_server2,handle_msg,2,[]},</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp;{proc_lib,wake_up,3,[{file,"proc_lib.erl"},
> {line,249}]}]}</blockquote>
> > <blockquote class="gmail_quote">
> > <br>
> > </blockquote>
> > <blockquote class="gmail_quote">=ERROR REPORT==== 18-May-2013::01:41:51
> ===</blockquote>
> > <blockquote class="gmail_quote">connection &lt;0.430.0&gt;, channel 22 -
> soft error:</blockquote>
> > <blockquote class="gmail_quote">{amqp_error,not_found,</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "no queue 'document_queue' in
> vhost '/'",</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'queue.declare'}</blockquote>
> > <blockquote class="gmail_quote"><br></blockquote>
> > <blockquote class="gmail_quote">=ERROR REPORT==== 18-May-2013::01:41:51
> ===</blockquote>
> > <blockquote class="gmail_quote">
> > connection &lt;0.384.0&gt;, channel 12 - soft error:</blockquote>
> > <blockquote class="gmail_quote">
> > {amqp_error,not_found,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> "no queue 'document_queue' in vhost '/'",</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 'queue.declare'}</blockquote>
> > <blockquote class="gmail_quote">
> > <br>
> > </blockquote>
> > <blockquote class="gmail_quote">=ERROR REPORT==== 18-May-2013::01:41:51
> ===</blockquote>
> > <blockquote class="gmail_quote">connection &lt;0.384.0&gt;, channel 15 -
> soft error:</blockquote>
> > <blockquote class="gmail_quote">{amqp_error,not_found,</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "no queue 'document_queue' in
> vhost '/'",</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'queue.declare'}</blockquote>
> > <blockquote class="gmail_quote"><br></blockquote>
> > <blockquote class="gmail_quote">=ERROR REPORT==== 18-May-2013::01:41:51
> ===</blockquote>
> > <blockquote class="gmail_quote">
> > connection &lt;0.373.0&gt;, channel 23 - soft error:</blockquote>
> > <blockquote class="gmail_quote">
> > {amqp_error,not_found,</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> "no queue 'document_queue' in vhost '/'",</blockquote>
> > <blockquote class="gmail_quote">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
> 'queue.declare'}&nbsp;</blockquote>
> > <blockquote class="gmail_quote">
> > &nbsp;... [ repeated a bunch of times ] ...</blockquote>
> > <div><br></div>
> > <div>I also see this in my /var/log/syslog&nbsp;with regards to beam.smp:
> </div>
> > <div><br></div>
> > <blockquote class="gmail_quote">
> > # cat /var/log/syslog<br>May 17 22:46:23 ip-10-123-123-123 kernel:
> [244800.176041] INFO: task beam.smp:18971 blocked for more than 120
> seconds.
> <br>May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176053] "echo 0 &gt;
> /proc/sys/kernel/hung_task_timeout_secs" disables this message.<br>
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176060] beam.smp &nbsp;
> &nbsp; &nbsp; &nbsp;D ffff8801bfd93700 &nbsp; &nbsp; 0 18971 &nbsp;18962
> 0x00000000<br>May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176065]
> &nbsp;ffff8801b11cdcb8 0000000000000282 0000000000000000
> ffffffffffffffe0<br>
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176070]
> &nbsp;ffff8801b11cdfd8 ffff8801b11cdfd8 ffff8801b11cdfd8
> 0000000000013700<br>May 17 22:46:23 ip-10-123-123-123 kernel:
> [244800.176075] &nbsp;ffff8801b3180000 ffff8801b35244a0 00007f500e2079e0
> ffff8801b146bb80<br>
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176079] Call Trace:
> <br>May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176089] &nbsp;
> [&lt;ffffffff8165434f&gt;] schedule+0x3f/0x60<br>May 17 22:46:23 ip-10-123-
> 123-123 kernel: [244800.176094] &nbsp;[&lt;ffffffff8106aef5&gt;]
> exit_mm+0x85/0x130<br>
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176097] &nbsp;
> [&lt;ffffffff8106b10e&gt;] do_exit+0x16e/0x450<br>May 17 22:46:23
> ip-10-123-
> 123-123 kernel: [244800.176102] &nbsp;[&lt;ffffffff810797aa&gt;] ?
> __dequeue_signal+0x6a/0xb0<br>
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176105] &nbsp;
> [&lt;ffffffff8106b594&gt;] do_group_exit+0x44/0xa0<br>May 17 22:46:23
> ip-10-
> 123-123-123 kernel: [244800.176108] &nbsp;[&lt;ffffffff8107c36c&gt;]
> get_signal_to_deliver+0x21c/0x420<br>
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176113] &nbsp;
> [&lt;ffffffff81014825&gt;] do_signal+0x45/0x130<br>May 17 22:46:23 ip-10-
> 123-123-123 kernel: [244800.176116] &nbsp;[&lt;ffffffff8105539d&gt;] ?
> set_next_entity+0xad/0xd0<br>
> > May 17 22:46:23 ip-10-123-123-123 kernel: [244800.176120] &nbsp;
> [&lt;ffffffff81014ad5&gt;] do_notify_resume+0x65/0x80<br>May 17 22:46:23
> ip-
> 10-123-123-123 kernel: [244800.176124] &nbsp;[&lt;ffffffff8165ea90&gt;]
> int_signal+0x12/0x17<br>... [ repeated 9 more times with same timestamp ]
> ...</blockquote>
> > <div><br></div>
> > <div>There are no strange CPU spikes on my EC2 node based on AWS
> monitoring. The only thing that seems to stand out is that my writes to my
> EBS volume spike during the crash (~90 write OPs/sec, 4 MiB/sec write
> bandwidth, ~30ms/op write latency).</div>
> > <div><br></div>
> > <div>My team and I are completely stumped and would appreciate any
> insight
> you might have to the crash reports. &nbsp;Is this a problem with writes
> hanging when going against the EBS volume since EBS volumes are essentially
> network mounted? &nbsp;Is there a way to configure rabbit to be more
> tolerant of these delays? &nbsp;</div>
> > <div><br></div>
> > <div><br></div>
> > <div>For debugging purposes, below is the status output of one of the
> nodes when it is healthy (so you can see the versions of everything i'm
> running):<br>
> > </div>
> > <div><br></div>
> > <blockquote class="gmail_quote">
> > # rabbitmqctl status<br>Status of node 'rabbit <at> ip-10-123-123-123'
> ...
> <br>[{pid,28978},<br>&nbsp;{running_applications,<br>&nbsp; &nbsp; &nbsp;
> [{rabbitmq_management,"RabbitMQ Management Console","3.1.0"},<br>&nbsp;
> &nbsp; &nbsp; {rabbitmq_web_dispatch,"RabbitMQ Web
> Dispatcher","3.1.0"},<br>
> > &nbsp; &nbsp; &nbsp; {webmachine,"webmachine","1.9.1-rmq3.1.0-
> git52e62bc"},<br>&nbsp; &nbsp; &nbsp; {mochiweb,"MochiMedia Web
> Server","2.3.1-rmq3.1.0-gitd541e9a"},<br>&nbsp; &nbsp; &nbsp;
> {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},<br>
> > &nbsp; &nbsp; &nbsp; {rabbit,"RabbitMQ","3.1.0"},<br>&nbsp; &nbsp; &nbsp;
> {os_mon,"CPO &nbsp;CXC 138 46","2.2.11"},<br>&nbsp; &nbsp; &nbsp;
> {inets,"INETS &nbsp;CXC 138 49","5.9.4"},<br>&nbsp; &nbsp; &nbsp;
> {mnesia,"MNESIA &nbsp;CXC 138 12","4.8"},<br>
> > &nbsp; &nbsp; &nbsp; {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
> <br>&nbsp; &nbsp; &nbsp; {xmerl,"XML parser","1.3.3"},<br>&nbsp; &nbsp;
> &nbsp; {sasl,"SASL &nbsp;CXC 138 11","2.3.1"},<br>&nbsp; &nbsp; &nbsp;
> {stdlib,"ERTS &nbsp;CXC 138 10","1.19.1"},<br>
> > &nbsp; &nbsp; &nbsp; {kernel,"ERTS &nbsp;CXC 138 10","2.16.1"}]},
> <br>&nbsp;{os,{unix,linux}},<br>&nbsp;{erlang_version,<br>&nbsp; &nbsp;
> &nbsp;"Erlang R16B (erts-5.10.1) [source-05f1189] [64-bit] [smp:8:8]
> [async-
> threads:30] [hipe] [kernel-poll:true]\n"},<br>
> > &nbsp;{memory,<br>&nbsp; &nbsp; &nbsp;[{total,60179048},<br>&nbsp; &nbsp;
> &nbsp; {connection_procs,5274808},<br>&nbsp; &nbsp; &nbsp; {queue_procs,<a
> href="tel:13107264" value="+13107264" target="_blank">13107264</a>},
> <br>&nbsp; &nbsp; &nbsp; {plugins,354272},<br>&nbsp; &nbsp; &nbsp;
> {other_proc,9741830},<br>
> > &nbsp; &nbsp; &nbsp; {mnesia,150456},<br>&nbsp; &nbsp; &nbsp;
> {mgmt_db,12248},<br>&nbsp; &nbsp; &nbsp; {msg_index,34768},<br>&nbsp;
> &nbsp;
> &nbsp; {other_ets,1148248},<br>&nbsp; &nbsp; &nbsp; {binary,4905584},
> <br>&nbsp; &nbsp; &nbsp; {code,19565863},<br>&nbsp; &nbsp; &nbsp;
> {atom,703377},<br>&nbsp; &nbsp; &nbsp; {other_system,5180330}]},<br>
> > &nbsp;{vm_memory_high_watermark,0.8},<br>&nbsp;
> {vm_memory_limit,5828434329},<br>&nbsp;{disk_free_limit,1000000000},
> <br>&nbsp;{disk_free,3953344512},<br>&nbsp;{file_descriptors,<br>&nbsp;
> &nbsp; &nbsp;[{total_limit,924},{total_used,6},{sockets_limit,829},
> {sockets_used,4}]},<br>
> > &nbsp;{processes,[{limit,1048576},{used,348}]},<br>&nbsp;{run_queue,0},
> <br>&nbsp;{uptime,3796}]<br>...done.</blockquote>
> > <div><br></div>
> > <div>Note that I am using Erlang v16 from the Erlang Solutions repo (esl-
> erlang package). &nbsp;I originally was using Erlang v14 from Ubuntu repos
> (erlang-base), but decided to upgrade hoping it would resolve the issue
> (which it did not). &nbsp;I have also tried running RabbitMQ 3.0.4 without
> success. &nbsp;This issue seems to affect both versions.</div>
> > <div><br></div>
> > <div>Thanks,</div>
> > <div>Karl</div>
> > <br>_______________________________________________<br>
> > rabbitmq-discuss mailing list<br><a href="mailto:rabbitmq-
> discuss at ...">rabbitmq-discuss <at> lists.rabbitmq.com</a><br><a
> href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> "
> target="_blank">https://lists.rabbitmq.com/cgi-
> bin/mailman/listinfo/rabbitmq-discuss</a><br><br>
> > </blockquote>
> > </div>
> > <br>
> > </div>
> > </div>
> >
>
> Hi Brett,
>
> That would explain why all hell breaks lose when the acks are being
> subtracted, but I still don't understand what is causing the queue to
> disappear in the first place.  The only administrative actions performed on
> the queues in all our code base are declares or passive declares (to check
> for queue existence).  We are just using Spring AMQP's
> SimpleMessageListenerContainer (which, btw, the code for that class is
> anything but "Simple") for consumers, and I've scanned through that code
> and
> didn't find any place where it is dropping or destroying a queue or
> binding.
>
> Is there are known bug where rabbit will cause a queue to disappear?  All
> my
> queues are durable and my messages are NOT persistent (we need high
> throughput and loosing a few messages is not a big deal).  I made the queue
> durable after we first started noticing the crashes so the queue would come
> back up on node restart.  But durability doesn't seem to protect it from
> disappearing.
>
> Any thoughts on this would be greatly, greatly appreciated.
>
> -Karl
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/71043d8f/attachment.htm>

From matthias at rabbitmq.com  Sun May 19 22:56:03 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 19 May 2013 22:56:03 +0100
Subject: [rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ
 3.1.0-1 (case_clause empty) on EC2
In-Reply-To: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
References: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
Message-ID: <51994A73.3070409@rabbitmq.com>

Karl,

On 18/05/13 04:20, Karl Rieb wrote:
> I am running a RabbitMQ cluster of 4 nodes in AWS EC2 on *c1.xlarge
> *instances using Ubuntu 12.04 LTS (kernel 3.2.0-38).  Periodically two
> of my nodes holding the largest queues will crash and require me to
> restart the rabbitmq-server service. [...]
>          exception exit: {{case_clause,{empty,{[],[]}}},
>                           [{rabbit_amqqueue_process,subtract_acks,3,[]},
>                            {rabbit_amqqueue_process,subtract_acks,4,[]},
>                            {rabbit_amqqueue_process,handle_cast,2,[]},
>                            {gen_server2,handle_msg,2,[]},

That's a bug in rabbit. And because it happens in a queue the queue will 
disappear.

Getting past that shouldn't require a restart of rabbit though.

To help us track down the cause of the bug, it would be good to know 
whether your applications use AMQP transactions.

> There are no strange CPU spikes on my EC2 node based on AWS monitoring.

That is almost certainly an unrelated problem.


Matthias.

From bupt.aswmtjdsj at gmail.com  Mon May 20 04:11:57 2013
From: bupt.aswmtjdsj at gmail.com (Xiang Yu)
Date: Mon, 20 May 2013 11:11:57 +0800
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
In-Reply-To: <51993593.8060803@rabbitmq.com>
References: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
	<5198A62F.8010407@rabbitmq.com>
	<CABa1P3k5shPXA-k=qWhDigRk7NNQ5F_Kz_CCEZorWAXRZr7g=Q@mail.gmail.com>
	<51993593.8060803@rabbitmq.com>
Message-ID: <CABa1P3n9fWvpgANa_XSONQbQVYtN5=YxGDWeC4TYow2jk3OsYg@mail.gmail.com>

I originally thought "epmd -kill" differed from "killall epmd"....

then I ran "killl {pid}"( the pid of the running epmd).
and
#epmd -debug

in another tty:
#erl -sname foo

the error logger happened the same( as in the former email).
but in the debug screen, there was:

epmd: Mon May 20 11:07:54 2013: epmd running - daemon = 0
epmd: Mon May 20 11:08:12 2013: ** got ALIVE2_REQ
epmd: Mon May 20 11:08:12 2013: ALIVE2_REQ from non local address

got any idea?



Yours,
Xiang Yu,

Cell: +86-152-1063-2036
As an undergraduate,
in the major of Electrical Information Engineering,
School of Information and Communication Engineering,
Beijing University of Posts and Telecommunications.


2013/5/20 Emile Joubert <emile at rabbitmq.com>

> On 19/05/13 13:21, Xiang Yu wrote:
> > root at XXX:~#epmd -kill
> > epmd: local epmd responded with <>
>
>
> If that doesn't work then send the epmd process a kill signal. See the
> 'kill' or 'killall' commands.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/0a554d13/attachment.htm>

From michael.s.klishin at gmail.com  Mon May 20 04:23:12 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 20 May 2013 07:23:12 +0400
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
In-Reply-To: <CABa1P3n9fWvpgANa_XSONQbQVYtN5=YxGDWeC4TYow2jk3OsYg@mail.gmail.com>
References: <c77421e9-cfad-4734-a49b-9a55918f6603@googlegroups.com>
	<5198A62F.8010407@rabbitmq.com>
	<CABa1P3k5shPXA-k=qWhDigRk7NNQ5F_Kz_CCEZorWAXRZr7g=Q@mail.gmail.com>
	<51993593.8060803@rabbitmq.com>
	<CABa1P3n9fWvpgANa_XSONQbQVYtN5=YxGDWeC4TYow2jk3OsYg@mail.gmail.com>
Message-ID: <CAE3HoVTazTFeDJPPUzTbEQ1zOwuD9fswdyzAQukcN+TG=fm0JA@mail.gmail.com>

2013/5/20 Xiang Yu <bupt.aswmtjdsj at gmail.com>

> epmd: Mon May 20 11:08:12 2013: ALIVE2_REQ from non local address
>
> got any idea?
>

https://groups.google.com/forum/#!msg/erlang-programming/CpoN0w3GLzM/AAe7plipzqAJ
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/6d80379b/attachment.htm>

From guillaume.alleon at gmail.com  Mon May 20 05:17:00 2013
From: guillaume.alleon at gmail.com (tog)
Date: Sun, 19 May 2013 21:17:00 -0700 (PDT)
Subject: [rabbitmq-discuss] HTTP monitoring API
Message-ID: <1369023420148-26859.post@n5.nabble.com>

Hi

I want to use RabbitMQ to create a distributed task queues on aws. In order
to kill/start ec2 instances, i would need to access the moving average of
queued messages of the last 1/5 minutes. Since this is possible in the web
ui I would guess it is possible as well using the HTTP api.

After some extensive Googling and reading  RabbitMQ in Action I am still not
able to find how to retrieve this information. 

The best I can do is retrieve the following JSON - it might be in there but
I am not sure where :-)

Any idea ?
Thanks

Guillaume

    {
        "memory": 89664,
        "message_stats": {
            "ack": 44,
            "ack_details": {
                "rate": 0.0
            },
            "deliver": 45,
            "deliver_details": {
                "rate": 0.0
            },
            "deliver_get": 45,
            "deliver_get_details": {
                "rate": 0.0
            },
            "publish": 160,
            "publish_details": {
                "rate": 0.0
            }
        },
        "messages": 116,
        "messages_details": {
            "rate": 0.0
        },
        "messages_ready": 116,
        "messages_ready_details": {
            "rate": 0.0
        },
        "messages_unacknowledged": 0,
        "messages_unacknowledged_details": {
            "rate": 0.0
        },
        "idle_since": "2013-05-20 3:22:02",
        "policy": "",
        "exclusive_consumer_tag": "",
        "consumers": 0,
        "backing_queue_status": {
            "q1": 0,
            "q2": 0,
            "delta": [
                "delta",
                "undefined",
                0,
                "undefined"
            ],
            "q3": 0,
            "q4": 116,
            "len": 116,
            "pending_acks": 0,
            "target_ram_count": "infinity",
            "ram_msg_count": 116,
            "ram_ack_count": 0,
            "next_seq_id": 160,
            "persistent_count": 116,
            "avg_ingress_rate": 0.0,
            "avg_egress_rate": 0.0,
            "avg_ack_ingress_rate": 0.0,
            "avg_ack_egress_rate": 0.0
        },




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/HTTP-monitoring-API-tp26859.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon May 20 10:39:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 May 2013 10:39:25 +0100
Subject: [rabbitmq-discuss] feature request
In-Reply-To: <kna9o8$qoe$1@ger.gmane.org>
References: <CAEuJcXOQvzUvTtaq6PxTwrb9wH8x1-O=KHZw_m1qp+upSh0Fmg@mail.gmail.com>
	<kna9o8$qoe$1@ger.gmane.org>
Message-ID: <5199EF4D.3080408@rabbitmq.com>

On 19/05/13 11:32, Michael Justin wrote:
> Rob Woolfson wrote:
>
>  > Multiple delete.
>  > I often have many queues that I no longer need, especially in testing.
>  > I would like to be able to select multiple queues for deletion from the
>  > management web console.
>
> If the queue names are not created randomly, using the REST API and a
> small shell script for this task could be a solution.

Or rabbitmqadmin might be slightly easier:

http://www.rabbitmq.com/management-cli.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon May 20 10:42:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 May 2013 10:42:54 +0100
Subject: [rabbitmq-discuss] HTTP monitoring API
In-Reply-To: <1369023420148-26859.post@n5.nabble.com>
References: <1369023420148-26859.post@n5.nabble.com>
Message-ID: <5199F01E.50105@rabbitmq.com>

On 20/05/13 05:17, tog wrote:
> Hi
>
> I want to use RabbitMQ to create a distributed task queues on aws. In order
> to kill/start ec2 instances, i would need to access the moving average of
> queued messages of the last 1/5 minutes. Since this is possible in the web
> ui I would guess it is possible as well using the HTTP api.

Yes.

> After some extensive Googling and reading  RabbitMQ in Action I am still not
> able to find how to retrieve this information.

The moving average thing was only added in 3.1.0 - RabbitMQ in action is 
rather older.

Set sample_age and sample_incr as described in 
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_1_0/priv/www/api/index.html, 
and you should see an "avg_rate" appear in the JSON.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon May 20 11:08:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 May 2013 11:08:00 +0100
Subject: [rabbitmq-discuss] 2.8.1 crash on Win2008
In-Reply-To: <CAEg60=rT_db=Wy+hwFpm9K-j-rW1v_k+ck-OE5Z2sFBd=jkakA@mail.gmail.com>
References: <CAEg60=rT_db=Wy+hwFpm9K-j-rW1v_k+ck-OE5Z2sFBd=jkakA@mail.gmail.com>
Message-ID: <5199F600.9080501@rabbitmq.com>

Unfortunately the erl_crash.dump rarely contains anything very useful. 
Log files from the time of the crash are more likely to give us some 
clue what happened.

Cheers, Simon

On 17/05/13 20:29, Dave Gorman wrote:
> I had a vendor's rabbitmq instance just crash on me, wondering if I
> could get some help understanding why from the experts...
>
> Windows 2008 with Rabbit 2.8.1 I got a crash dump had:
> Slogan: Kernel pid terminated (application_controller)
> ({application_terminated,rabbit,shutdown})
> System version: Erlang R15B01 (erts-5.9.1) [64-bit] [smp:4:4]
> [async-threads:30]
> ...
> =proc:<0.3.0>
> State: Waiting
> Name: erl_prim_loader
> Spawned as: erlang:apply/2
> Spawned by: <0.2.0>
> Started: Sat Apr 06 12:32:28 2013
> Message queue length: 0
> Number of heap fragments: 0
> Heap fragment data: 0
> Link list: [<0.0.0>, #Port<0.1>]
> Reductions: 1385542
> Stack+heap: 6765
> OldHeap: 17711
> Heap unused: 1985
> OldHeap unused: 10676
> Program counter: 0x0000000000fd2d20 (erl_prim_loader:loop/3 + 176)
> CP: 0x0000000000000000 (invalid)
> arity = 0
> =proc:<0.6.0>
> State: Waiting
> Name: error_logger
> Spawned as: proc_lib:init_p/5
> Spawned by: <0.2.0>
> Started: Sat Apr 06 12:32:28 2013
> Message queue length: 0
> Number of heap fragments: 0
> Heap fragment data: 0
> Link list: [<0.0.0>]
> Reductions: 667825443
> Stack+heap: 6419485
> OldHeap: 47828850
> Heap unused: 2612692
> OldHeap unused: 35671810
> Program counter: 0x0000000004ddeb00 (gen_event:fetch_msg/5 + 72)
> CP: 0x0000000000000000 (invalid)
> arity = 0
> ...
> 2EFD1C8:lI110|N
> 7619550:t9:A5:state,A5:efile,N,A4:none,p<0.1>,A8:infinity,A9:undefined,A4:true,H2EF92E0
> 2EF92E0:t4:AA:prim_state,A5:false,A9:undefined,A9:undefined
> =proc_dictionary:<0.6.0>
> H52180A50
> H51D06CD0
> H51D00578
> H51D00590
> =proc_stack:<0.6.0>
> 0x00000000123ca118:SReturn addr 0x4DF35D8 (proc_lib:init_p_do_apply/3 + 56)
> y0:A5:false
> y1:N
> y2:H10FDB290
> y3:AC:error_logger
> y4:P<0.2.0>
> 0x00000000123ca148:SReturn addr 0xF4814688 (<terminate process normally>)
> y0:SCatch 0x4DF35F8 (proc_lib:init_p_do_apply/3 + 88)
> =proc_heap:<0.6.0>
> 10FDB290:lH10FDB138|H10FDB268
> 10FDB138:t5:A7:handler,A19:rabbit_sasl_report_file_h,A5:false,H10FD8688,A5:false
> 10FD8688:t3:P<0.36.0>,H51D00A70,A5:error
>
> Any advice?
>
> thanks!
> Dave
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon May 20 11:30:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 May 2013 11:30:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
Message-ID: <5199FB29.70306@rabbitmq.com>

On 17/05/13 20:38, Maslinski, Ray wrote:
> Hello,

Hi!

> To simulate a network partition failure, I?ve been using iptables to
> temporarily block inbound and outbound access on one of the nodes to the
> single port configured for cluster communications through
> inet_dist_listen_min and inet_dist_listen_max settings (min = max).
> Client access is not blocked during a simulated partition fault.

Sounds reasonable.

> I?ve observed two anomalies during testing that I wasn?t expecting based
> on the documentation I?ve read:
>
> -At a sufficiently high message rate, some number of messages will be
> lost during the fault sequence, with the number lost tending to increase
> with message rate.  No indication of a send error has been observed by
> the client program. Based on results obtained from test logs and an
> independent monitor listening on trace messages from each node, it
> appears that as soon as the port is blocked, both nodes continue to
> accept published messages, but (temporarily) stop delivering messages
> until the cluster heartbeat failure is detected, at which point the
> cluster is partitioned and the slave promotes itself to become master.
> In the sequences I?ve looked at, the messages that are lost all appear
> to be published to the original master (and final master after a winner
> is selected during autoheal).  Neither the start nor the end of the lost
> message window appear to line up with any events in the logs, other than
> the start occurring sometime after the port connection is blocked but
> before the cluster heartbeat failure is detected, and the end occurring
> sometime after the detection of the cluster heartbeat failure and before
> the detection of the partitioned cluster after the connection is
> unblocked.  Is message loss to be expected in this scenario?

I would expect to see message loss in a cluster heal scenario.

It's important to remember that a cluster partition is still a 
substantial problem, and the healing process involves throwing state 
away. Autoheal mode just means you get through this process faster, and 
hopefully spend much less time accepting messages that will end up being 
lost.

I would expect intuitively that only messages from the losing partitions 
would be lost. But I am not entirely surprised if messages from the 
winner are lost too; there is a period after the partitions have come 
back together but before autoheal kicks in during which we will have 
multiple masters for a queue, and behaviour can be unpredictable.

> -Occasionally the autoheal loser node fails to rejoin the cluster after
> restart.  I don?t have a lot of data points on this one since it?s only
> happened a handful of times during overnight test iterations.  During
> one failure, the autoheal winner showed the log message below during
> recovery:

Ah, that looks like a bug in autoheal. I think the stack trace you 
posted should contain enough information to fix it. Thanks.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From iain.hull at workday.com  Mon May 20 12:15:41 2013
From: iain.hull at workday.com (Iain Hull)
Date: Mon, 20 May 2013 12:15:41 +0100
Subject: [rabbitmq-discuss] Monitoring for busy_dist_port
Message-ID: <CANum3oXEbm6Xyy98-Jif09HbkEWB6bYGiwWN4ZNF55af9OJRtg@mail.gmail.com>

Hi,

We are in the process of deploying a Riak cluster, and are wondering if
some of the lessons we learned monitoring Erlang in Riak should be applied
to RabbitMQ.

During testing we noticed a lot of busy_dist_port in the logs, the root was
cause was a the Erlang kernel parameter zdbbl was set too low.  We have
adjusted the parameter and are now monitoring the logs for busy_dist_port
errors.

I have searched the RabbitMQ mailing list for cases of busy_dist_port or
zdbbl, but cannot find any.  I am wondering if RabbitMQ can suffer from
problems with busy_dist_port or if zdbbl should be set to any particular
value? Or I should I monitor the RabbitMQ logs for busy_dist_port?

Thanks,
Iain.

-- 
Iain Hull
Senior Software Engineer
iain.hull.workday (Skype)
iain.hull at workday.com

<http://www.workday.com/signature-uk>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/7cf138ae/attachment.htm>

From balachandar.ra at gmail.com  Mon May 20 12:22:09 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Mon, 20 May 2013 16:52:09 +0530
Subject: [rabbitmq-discuss] Possible causes for timeout in rabbitMQ
In-Reply-To: <11702_1369048439_519A0577_11702_1870_1_E6472BD072676843ADB8D37E50F4C88D0F2E60E3DF@DE0-MAILMBX-P21.res.airbus.corp>
References: <11702_1369048439_519A0577_11702_1870_1_E6472BD072676843ADB8D37E50F4C88D0F2E60E3DF@DE0-MAILMBX-P21.res.airbus.corp>
Message-ID: <CALEC75JkNMoziqEbpQzYqwpLxUkmCL96r2EsRoRkAsA3zaKLeA@mail.gmail.com>

Hello,

I have simple code like this to receive a message from a producer. I am
sure from the documentation that the consumer will wait for a message.
However, I would like to under what circumstances, the below code could
result in a timeout exception and stop waiting for any more messages? For
instance, the remote machine took some unreasonable time to send a response
message and that the code below in the client side throw the exception.
 (like firewall, network issue etc)


    ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("localhost");
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();

    channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);
    System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

    channel.basicQos(1);

    QueueingConsumer consumer = new QueueingConsumer(channel);
    channel.basicConsume(TASK_QUEUE_NAME, false, consumer);

    while (true) {
      QueueingConsumer.Delivery delivery = consumer.nextDelivery();
      String message = new String(delivery.getBody());

      System.out.println(" [x] Received '" + message + "'");
      doWork(message);
      System.out.println(" [x] Done" );

      channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
    }


With thanks and regards
Balachandar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/be494f9a/attachment.htm>

From simon at rabbitmq.com  Mon May 20 13:35:47 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 May 2013 13:35:47 +0100
Subject: [rabbitmq-discuss] Recovering an 3-node cluster after power
	failure
In-Reply-To: <606aa982-3175-4626-98f6-1d8fdc53426b@googlegroups.com>
References: <606aa982-3175-4626-98f6-1d8fdc53426b@googlegroups.com>
Message-ID: <519A18A3.6070101@rabbitmq.com>

Hi.

If you just want to do the equivalent of "rabbitmqctl reset" with a node 
down, then deleting the Mnesia directory (see RABBITMQ_MNESIA_BASE in 
http://www.rabbitmq.com/relocate.html for location) is the simplest 
thing to do.

If you want to remove a node from a cluster and the lack of that node is 
preventing you from starting the cluster, you can set RABBITMQ_NODE_ONLY 
for another node, and then invoke "rabbitmqctl forget_cluster_node" 
against that.

Cheers, Simon

On 17/05/13 20:32, Sam Winchenbach wrote:
> Hi All,
>
> I have a three node cluster running on VMs for testing purposes:
> node1 (disk)
> node2(disk)
> node3(ram)
>
> Today we had a power outage and all the nodes went down at once.  I am
> having a serious issue recovering from this because node1 thinks it
> belongs to a cluster but node3 disagrees.   I can not seem to do
> anything at all with rabbitmq on node1.   If I try running running
> "rabbitmqctl reset" it can not connect because node1 is down.  How can I
> recover from this gracefully?
>
> Thanks,
> Sam
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon May 20 13:38:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 May 2013 13:38:32 +0100
Subject: [rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ
 3.1.0-1 (case_clause empty) on EC2
In-Reply-To: <51994A73.3070409@rabbitmq.com>
References: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
	<51994A73.3070409@rabbitmq.com>
Message-ID: <519A1948.9090204@rabbitmq.com>

On 19/05/13 22:56, Matthias Radestock wrote:
> To help us track down the cause of the bug, it would be good to know
> whether your applications use AMQP transactions.

To expand this: we have replicated this issue when transactions are in 
use (and will have a fix in the next release). But if you can make this 
happen without using transactions, we'd really like to hear from you.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Mon May 20 13:46:29 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 20 May 2013 16:46:29 +0400
Subject: [rabbitmq-discuss] Possible causes for timeout in rabbitMQ
In-Reply-To: <CALEC75JkNMoziqEbpQzYqwpLxUkmCL96r2EsRoRkAsA3zaKLeA@mail.gmail.com>
References: <11702_1369048439_519A0577_11702_1870_1_E6472BD072676843ADB8D37E50F4C88D0F2E60E3DF@DE0-MAILMBX-P21.res.airbus.corp>
	<CALEC75JkNMoziqEbpQzYqwpLxUkmCL96r2EsRoRkAsA3zaKLeA@mail.gmail.com>
Message-ID: <CAE3HoVSUTy7L_f+G2hdNRMCUbCDQJnAqmWhVsSW+LuyOYCX=AA@mail.gmail.com>

2013/5/20 Balachandar R.A. <balachandar.ra at gmail.com>

> the below code could result in a timeout exception


Can you post the exact exception class name and maybe a stack trace?

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/abf6a14a/attachment.htm>

From csharp4me at gmail.com  Mon May 20 14:09:48 2013
From: csharp4me at gmail.com (Dave Gorman)
Date: Mon, 20 May 2013 08:09:48 -0500
Subject: [rabbitmq-discuss] 2.8.1 crash on Win2008
In-Reply-To: <5199F600.9080501@rabbitmq.com>
References: <CAEg60=rT_db=Wy+hwFpm9K-j-rW1v_k+ck-OE5Z2sFBd=jkakA@mail.gmail.com>
	<5199F600.9080501@rabbitmq.com>
Message-ID: <CAEg60=oNNt-bjdoy2+qRhq955XheHSMG8qdhbhtMKGbMvHoZDA@mail.gmail.com>

Thanks Simon for your response!
The SASL log has:
=CRASH REPORT==== 17-May-2013::14:00:06 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.213.0>
    registered_name: []
    exception exit: {{badmatch,{error,eacces}},
                     [{rabbit_msg_store,safe_file_delete,3,[]},
                      {rabbit_msg_store_gc,'-attempt_action/3-fun-0-',1,[]},
                      {lists,'-filter/2-lc$^0/1-0-',2,
                             [{file,"lists.erl"},{line,1220}]},
                      {rabbit_msg_store_gc,attempt_action,3,[]},
                      {rabbit_msg_store_gc,handle_cast,2,[]},
                      {gen_server2,handle_msg,2,[]},
                      {proc_lib,wake_up,3,
                                [{file,"proc_lib.erl"},{line,237}]}]}
      in function  gen_server2:terminate/3
    ancestors: [msg_store_persistent,rabbit_sup,<0.159.0>]
    messages: []
    links: [<0.208.0>]
    dictionary: [{fhc_age_tree,{0,nil}}]
    trap_exit: false
    status: running
    heap_size: 17711
    stack_size: 24
    reductions: 1150712551
  neighbours:

Does badmatch mean anything to you?


On Mon, May 20, 2013 at 5:08 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Unfortunately the erl_crash.dump rarely contains anything very useful. Log
> files from the time of the crash are more likely to give us some clue what
> happened.
>
> Cheers, Simon
>
>
> On 17/05/13 20:29, Dave Gorman wrote:
>
>> I had a vendor's rabbitmq instance just crash on me, wondering if I
>> could get some help understanding why from the experts...
>>
>> Windows 2008 with Rabbit 2.8.1 I got a crash dump had:
>> Slogan: Kernel pid terminated (application_controller)
>> ({application_terminated,**rabbit,shutdown})
>> System version: Erlang R15B01 (erts-5.9.1) [64-bit] [smp:4:4]
>> [async-threads:30]
>> ...
>> =proc:<0.3.0>
>> State: Waiting
>> Name: erl_prim_loader
>> Spawned as: erlang:apply/2
>> Spawned by: <0.2.0>
>> Started: Sat Apr 06 12:32:28 2013
>> Message queue length: 0
>> Number of heap fragments: 0
>> Heap fragment data: 0
>> Link list: [<0.0.0>, #Port<0.1>]
>> Reductions: 1385542
>> Stack+heap: 6765
>> OldHeap: 17711
>> Heap unused: 1985
>> OldHeap unused: 10676
>> Program counter: 0x0000000000fd2d20 (erl_prim_loader:loop/3 + 176)
>> CP: 0x0000000000000000 (invalid)
>> arity = 0
>> =proc:<0.6.0>
>> State: Waiting
>> Name: error_logger
>> Spawned as: proc_lib:init_p/5
>> Spawned by: <0.2.0>
>> Started: Sat Apr 06 12:32:28 2013
>> Message queue length: 0
>> Number of heap fragments: 0
>> Heap fragment data: 0
>> Link list: [<0.0.0>]
>> Reductions: 667825443
>> Stack+heap: 6419485
>> OldHeap: 47828850
>> Heap unused: 2612692
>> OldHeap unused: 35671810
>> Program counter: 0x0000000004ddeb00 (gen_event:fetch_msg/5 + 72)
>> CP: 0x0000000000000000 (invalid)
>> arity = 0
>> ...
>> 2EFD1C8:lI110|N
>> 7619550:t9:A5:state,A5:efile,**N,A4:none,p<0.1>,A8:infinity,**
>> A9:undefined,A4:true,H2EF92E0
>> 2EF92E0:t4:AA:prim_state,A5:**false,A9:undefined,A9:**undefined
>> =proc_dictionary:<0.6.0>
>> H52180A50
>> H51D06CD0
>> H51D00578
>> H51D00590
>> =proc_stack:<0.6.0>
>> 0x00000000123ca118:SReturn addr 0x4DF35D8 (proc_lib:init_p_do_apply/3 +
>> 56)
>> y0:A5:false
>> y1:N
>> y2:H10FDB290
>> y3:AC:error_logger
>> y4:P<0.2.0>
>> 0x00000000123ca148:SReturn addr 0xF4814688 (<terminate process normally>)
>> y0:SCatch 0x4DF35F8 (proc_lib:init_p_do_apply/3 + 88)
>> =proc_heap:<0.6.0>
>> 10FDB290:lH10FDB138|H10FDB268
>> 10FDB138:t5:A7:handler,A19:**rabbit_sasl_report_file_h,A5:**
>> false,H10FD8688,A5:false
>> 10FD8688:t3:P<0.36.0>,**H51D00A70,A5:error
>>
>> Any advice?
>>
>> thanks!
>> Dave
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/286e3ca5/attachment.htm>

From simon at rabbitmq.com  Mon May 20 14:17:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 May 2013 14:17:31 +0100
Subject: [rabbitmq-discuss] 2.8.1 crash on Win2008
In-Reply-To: <CAEg60=oNNt-bjdoy2+qRhq955XheHSMG8qdhbhtMKGbMvHoZDA@mail.gmail.com>
References: <CAEg60=rT_db=Wy+hwFpm9K-j-rW1v_k+ck-OE5Z2sFBd=jkakA@mail.gmail.com>
	<5199F600.9080501@rabbitmq.com>
	<CAEg60=oNNt-bjdoy2+qRhq955XheHSMG8qdhbhtMKGbMvHoZDA@mail.gmail.com>
Message-ID: <519A226B.4010607@rabbitmq.com>

On 20/05/13 14:09, Dave Gorman wrote:
> Thanks Simon for your response!
> The SASL log has:

>      exception exit: {{badmatch,{error,eacces}},
>                       [{rabbit_msg_store,safe_file_delete,3,[]},
>
> {rabbit_msg_store_gc,'-attempt_action/3-fun-0-',1,[]},

> Does badmatch mean anything to you?

badmatch just means we saw some result we weren't expecting - but the 
interesting bit is "{error,eacces}".

This looks like the message store was attempting to delete a file and 
was prevented from doing so by the OS. This is a hard problem to recover 
from - RabbitMQ assumes that it can modify and delete any file it has 
created; it's not clear what to do if it can't.

On Windows I guess there could be a badly written virus scanner or 
backup program which is taking exclusive access to RabbitMQ's files. 
Could something like that be happening?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Mon May 20 14:25:38 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 20 May 2013 17:25:38 +0400
Subject: [rabbitmq-discuss] 2.8.1 crash on Win2008
In-Reply-To: <CAEg60=oNNt-bjdoy2+qRhq955XheHSMG8qdhbhtMKGbMvHoZDA@mail.gmail.com>
References: <CAEg60=rT_db=Wy+hwFpm9K-j-rW1v_k+ck-OE5Z2sFBd=jkakA@mail.gmail.com>
	<5199F600.9080501@rabbitmq.com>
	<CAEg60=oNNt-bjdoy2+qRhq955XheHSMG8qdhbhtMKGbMvHoZDA@mail.gmail.com>
Message-ID: <CAE3HoVR6VWJAwTbvkse3Y-6isYL1dbJkqsgvtgdCrb884W6okg@mail.gmail.com>

2013/5/20 Dave Gorman <csharp4me at gmail.com>

>                  [{rabbit_msg_store,safe_file_delete,3,[]},


This suggests RabbitMQ tried to delete a file but could not due to
insufficient permissions
(or possibly missing file).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/4dd522b6/attachment.htm>

From gobadiah at gmail.com  Mon May 20 14:44:34 2013
From: gobadiah at gmail.com (=?iso-8859-1?Q?Micha=EBl_Journo?=)
Date: Mon, 20 May 2013 15:44:34 +0200
Subject: [rabbitmq-discuss] Queue declare doesn't return
Message-ID: <6F75DF31-45F0-44FC-9FB1-538E92B55617@gmail.com>

Hello,

I've came across a problem, but unfortunately I have very little information about it.

I use rabbitmq 2.8.4, along with clients such as pika (python side) and SimpleAmqpClient (c++ side). This issue was experienced in both those clients.

What happened is simply that DeclareQueue or queue_declare wouldn't return at all (I mean being blocked for days). 

When the incident started, I get a lot of 


=WARNING REPORT==== 18-May-2013::03:09:18 ===
closing AMQP connection <0.3256.1697> (127.0.0.1:46099 -> 127.0.0.1:5672):
connection_closed_abruptly

in the rabbitmq log, but nothing more.

I fixed this by ? restarting rabbitmq, but I'm kind of worry because I don't know how to detect this problem again (building a timeout mechanism on top of the clients is just not ok).

If anyone has any idea about what could cause this, it would be greatly appreciated.

michael

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/bd875be4/attachment.htm>

From simon at rabbitmq.com  Mon May 20 14:55:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 May 2013 14:55:34 +0100
Subject: [rabbitmq-discuss] Recovering an 3-node cluster after power
	failure
In-Reply-To: <CAK9s_NxH6R=M-=kZ9t70h=QPVtouFqGr1W5vj85APDH=3YtB+w@mail.gmail.com>
References: <606aa982-3175-4626-98f6-1d8fdc53426b@googlegroups.com>
	<519A18A3.6070101@rabbitmq.com>
	<CAK9s_NxH6R=M-=kZ9t70h=QPVtouFqGr1W5vj85APDH=3YtB+w@mail.gmail.com>
Message-ID: <519A2B56.20008@rabbitmq.com>

On 20/05/13 14:48, Samuel Winchenbach wrote:
> Thanks Simon,
>
> So deleting the mnesia directory effectively removes all of the cluster
> configuration correct (policies for example)?

Yes, it's exactly equivalent to "rabbitmqctl reset".

> I could use the second method you mentioned and remove the two nodes
> causing me issue, start and reset them, finally  cluster them to the
> only running node?

Also an option.

Cheers, Simon

>
> Thanks for the tips!
>
> Sam
>
>
> On Mon, May 20, 2013 at 8:35 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi.
>
>     If you just want to do the equivalent of "rabbitmqctl reset" with a
>     node down, then deleting the Mnesia directory (see
>     RABBITMQ_MNESIA_BASE in http://www.rabbitmq.com/__relocate.html
>     <http://www.rabbitmq.com/relocate.html> for location) is the
>     simplest thing to do.
>
>     If you want to remove a node from a cluster and the lack of that
>     node is preventing you from starting the cluster, you can set
>     RABBITMQ_NODE_ONLY for another node, and then invoke "rabbitmqctl
>     forget_cluster_node" against that.
>
>     Cheers, Simon
>
>
>     On 17/05/13 20:32, Sam Winchenbach wrote:
>
>         Hi All,
>
>         I have a three node cluster running on VMs for testing purposes:
>         node1 (disk)
>         node2(disk)
>         node3(ram)
>
>         Today we had a power outage and all the nodes went down at once.
>           I am
>         having a serious issue recovering from this because node1 thinks it
>         belongs to a cluster but node3 disagrees.   I can not seem to do
>         anything at all with rabbitmq on node1.   If I try running running
>         "rabbitmqctl reset" it can not connect because node1 is down.
>           How can I
>         recover from this gracefully?
>
>         Thanks,
>         Sam
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From kolchanov at gmail.com  Mon May 20 14:56:30 2013
From: kolchanov at gmail.com (Andrey Kolchanov)
Date: Mon, 20 May 2013 06:56:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Eager sync
Message-ID: <b883d5b0-aa4e-4a4b-8d03-ed57a66dc618@googlegroups.com>

There is a new feature in rabbitmq 3.1.0 - eager synchronization.  
What is this eager synchronization in detail?  
Should I explicitly set eager sync policy?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/900a231b/attachment.htm>

From karl.rieb at gmail.com  Mon May 20 15:10:23 2013
From: karl.rieb at gmail.com (Karl Rieb)
Date: Mon, 20 May 2013 14:10:23 +0000 (UTC)
Subject: [rabbitmq-discuss]
	=?utf-8?q?Strange_subtract=5Facks_crash_in_Rab?=
	=?utf-8?q?bitMQ_3=2E1=2E0-1_=28case=5Fclause_empty=29_on_EC2?=
References: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
	<51994A73.3070409@rabbitmq.com> <519A1948.9090204@rabbitmq.com>
Message-ID: <loom.20130520T160656-885@post.gmane.org>

Simon MacMullen <simon at ...> writes:

> 
> On 19/05/13 22:56, Matthias Radestock wrote:
> > To help us track down the cause of the bug, it would be good to know
> > whether your applications use AMQP transactions.
> 
> To expand this: we have replicated this issue when transactions are in 
> use (and will have a fix in the next release). But if you can make this 
> happen without using transactions, we'd really like to hear from you.
> 
> Cheers, Simon
> 

Hi Simon & Matthias,

We have only noticed the issue when transactions are enabled and we use 
transactions on all our queues.  I only really need to restart the node when 
I find the strange: 

  "INFO: task beam.smp:18971 blocked for more than 120 seconds."

logs in my /var/syslog (which seems to be another unrelated issue with 
flushing data in memory to disk on EC2).

Thanks a lot for replying so quickly and letting me know about the bug and 
future bug fix.  We really appreciate it!

Let me know if there is any other information you guys would like to help 
with the bug fix.

-Karl


From karl.rieb at gmail.com  Mon May 20 15:12:28 2013
From: karl.rieb at gmail.com (Karl Rieb)
Date: Mon, 20 May 2013 14:12:28 +0000 (UTC)
Subject: [rabbitmq-discuss]
	=?utf-8?q?Strange_subtract=5Facks_crash_in_Rab?=
	=?utf-8?q?bitMQ_3=2E1=2E0-1_=28case=5Fclause_empty=29_on_EC2?=
References: <85b960f0-ab2f-455b-ad25-d2638abd08f6@googlegroups.com>
	<CALPqkipk5DFLH5XwfR8fW=fTVd4tJWsC8XwC+qXctgaxW7vHCQ@mail.gmail.com>
	<loom.20130518T145120-367@post.gmane.org>
	<CALPqkirFsq4d_D0WhRdwwWzMFX_pZBsuOx-0ixwg6kaXxApn7w@mail.gmail.com>
Message-ID: <loom.20130520T161048-299@post.gmane.org>

Brett Cameron <brett.r.cameron at ...> writes:

> 
> 
> 
> Karl,I am not aware of any known issues in this regard (queues strangely 
disapearing). The fact that you get the problem with different versions of 
Erlang and dofferent versions of RabbitMQ would make me suspect that it is 
more likely to be something external to the broker environment. The "INFO: 
task beam.smp:18971 blocked for more than 120 seconds." messages in syslog 
are interesting. What I think is happening here is as follows: By default 
Linux uses up to 40% of the available memory for file system caching and 
if/when this threshold is reached the file system flushes all outstanding 
cached data to disk, causing all following I/O's become synchronous (until 
the flush completes). There is a default time limit of 120 seconds for the 
flush to complete. If you're EC2 VM's have a lot of RAM and are processing 
heavy I/O-intensive workloads, it is possible that the EBS volumes might 
sometimes not be able to keep up (or possibly there's some spike in network 
activity and available bandwidth goes through the floor). You have mentioned 
that your messages are not persistent, but RabbitMQ's memory usage might be 
such that it is occasionally deciding to flush a whole pile of stuff to 
disk. I notice that you have? {vm_memory_high_watermark,0.8}, and this could 
have something to do with the problem - maybe try reducing this, and/or 
maybe set vm.dirty_ratio to something less than 40% in /etc/sysctl.conf 
(this might increase the frequency of flushes, but you'll be flushing less 
data). I'd possibly start by reducing vm_memory_high_watermark. I can't 
really correlate this with your queue disappearing, but if I/O's are getting 
messed up then all manner of weird things could happen I guess. Hopefully 
others might have some more tangible ideas!
> 
> 
> Brett
> 

Hi Brett,

Thanks for the reply!  I will go ahead and reduce the watermark limit and 
configure the kernel to flush earlier to disk.  Hopefully this issue will go 
away after the changes.

-Karl






From gobadiah at gmail.com  Mon May 20 16:26:42 2013
From: gobadiah at gmail.com (Michael Journo)
Date: Mon, 20 May 2013 17:26:42 +0200
Subject: [rabbitmq-discuss] Queue declare doesn't return
Message-ID: <CAMv=6V7saw-P79crBMaOdKG5zv1Sbxj20ys1ktbGPG5mDaKH7w@mail.gmail.com>

Hello,


I've came across a problem, but unfortunately I have very little
information about it.


I use rabbitmq 2.8.4, along with clients such as pika (python side) and
SimpleAmqpClient (c++ side). This issue was experienced in both those
clients.


What happened is simply that DeclareQueue or queue_declare wouldn't return
at all (I mean being blocked for *days*).


When the incident started, I get a lot of



=WARNING REPORT==== 18-May-2013::03:09:18 ===

closing AMQP connection <0.3256.1697> (127.0.0.1:46099 -> 127.0.0.1:5672):

connection_closed_abruptly


in the rabbitmq log, but nothing more.


I fixed this by ? restarting rabbitmq, but I'm kind of worry because I
don't know how to detect this problem again (building a timeout mechanism
on top of the clients is just not ok).


If anyone has any idea about what could cause this, it would be greatly
appreciated.

-- 
michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/7bccc767/attachment.htm>

From balachandar.ra at gmail.com  Mon May 20 17:36:11 2013
From: balachandar.ra at gmail.com (Balachandar R.A.)
Date: Mon, 20 May 2013 22:06:11 +0530
Subject: [rabbitmq-discuss] Possible causes for timeout in rabbitMQ
In-Reply-To: <CAE3HoVSUTy7L_f+G2hdNRMCUbCDQJnAqmWhVsSW+LuyOYCX=AA@mail.gmail.com>
References: <11702_1369048439_519A0577_11702_1870_1_E6472BD072676843ADB8D37E50F4C88D0F2E60E3DF@DE0-MAILMBX-P21.res.airbus.corp>
	<CALEC75JkNMoziqEbpQzYqwpLxUkmCL96r2EsRoRkAsA3zaKLeA@mail.gmail.com>
	<CAE3HoVSUTy7L_f+G2hdNRMCUbCDQJnAqmWhVsSW+LuyOYCX=AA@mail.gmail.com>
Message-ID: <CALEC75JuaTG+aookjGKRjXtM5cbUNyaijYUke3Rk_07q18CyfQ@mail.gmail.com>

Hi,

Here is the exception we got:

Caught: com.rabbitmq.client.ShutdownSignalException: connection error;
reason: java.net.SocketException: Operation timed out
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.net.SocketException: Operation timed out
at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:162)
at
com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:176)
at com.rabbitmq.client.QueueingConsumer$nextDelivery.call(Unknown Source)
at pfcloud$_run_closure2.doCall(pfcloud.groovy:129)
at pfcloud.run(pfcloud.groovy:552)
Caused by: java.net.SocketException: Operation timed out
at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:104)
at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:141)
at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:402)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:430)

-- 
PGP KeyID: 2048R/EA31CFC9  subkeys.pgp.net
On 20 May 2013 18:19, "Michael Klishin" <michael.s.klishin at gmail.com> wrote:

>
> 2013/5/20 Balachandar R.A. <balachandar.ra at gmail.com>
>
>> the below code could result in a timeout exception
>
>
> Can you post the exact exception class name and maybe a stack trace?
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/1c18ec83/attachment.htm>

From watson.timothy at gmail.com  Mon May 20 19:38:02 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 20 May 2013 19:38:02 +0100
Subject: [rabbitmq-discuss] Queue declare doesn't return
In-Reply-To: <CAMv=6V7saw-P79crBMaOdKG5zv1Sbxj20ys1ktbGPG5mDaKH7w@mail.gmail.com>
References: <CAMv=6V7saw-P79crBMaOdKG5zv1Sbxj20ys1ktbGPG5mDaKH7w@mail.gmail.com>
Message-ID: <1A5BC5FB-2457-46E0-8F78-E5542C3BDAB2@rabbitmq.com>

This sounds a lot like the physical network connection has been severed, but the client isn't noticing for a very long time. What os are you using? Have you considered turning on heartbeats in your clients, be expedite detection of connection failures?

Cheers,
Tim

On 20 May 2013, at 16:26, Michael Journo <gobadiah at gmail.com> wrote:

> Hello,
> 
> 
> 
> I've came across a problem, but unfortunately I have very little information about it.
> 
> 
> 
> I use rabbitmq 2.8.4, along with clients such as pika (python side) and SimpleAmqpClient (c++ side). This issue was experienced in both those clients.
> 
> 
> 
> What happened is simply that DeclareQueue or queue_declare wouldn't return at all (I mean being blocked for days). 
> 
> 
> 
> When the incident started, I get a lot of 
> 
> 
> 
> 
> 
> =WARNING REPORT==== 18-May-2013::03:09:18 ===
> 
> closing AMQP connection <0.3256.1697> (127.0.0.1:46099 -> 127.0.0.1:5672):
> 
> connection_closed_abruptly
> 
> 
> 
> in the rabbitmq log, but nothing more.
> 
> 
> 
> I fixed this by ? restarting rabbitmq, but I'm kind of worry because I don't know how to detect this problem again (building a timeout mechanism on top of the clients is just not ok).
> 
> 
> 
> If anyone has any idea about what could cause this, it would be greatly appreciated.
> 
> 
> -- 
> michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/0ef31dd8/attachment.htm>

From watson.timothy at gmail.com  Mon May 20 19:42:48 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 20 May 2013 19:42:48 +0100
Subject: [rabbitmq-discuss] Eager sync
In-Reply-To: <b883d5b0-aa4e-4a4b-8d03-ed57a66dc618@googlegroups.com>
References: <b883d5b0-aa4e-4a4b-8d03-ed57a66dc618@googlegroups.com>
Message-ID: <10D0B3FB-E6BF-44AE-90AD-354D887743C2@rabbitmq.com>

On 20 May 2013, at 14:56, Andrey Kolchanov <kolchanov at gmail.com> wrote:

> There is a new feature in rabbitmq 3.1.0 - eager synchronization.  
> What is this eager synchronization in detail?  

With eager sync enabled, queues will block (i.e., become unresponsive) when a new mirror/slave joins, whilst the slave is synchronised.

> Should I explicitly set eager sync policy?

It will only happen if you *do* explicitly set ha-sync-mode to automatic, or manually call 'sync' via rabbitmqctl.

Cheers,
Tim

From watson.timothy at gmail.com  Mon May 20 19:46:14 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 20 May 2013 19:46:14 +0100
Subject: [rabbitmq-discuss] Possible causes for timeout in rabbitMQ
In-Reply-To: <CALEC75JuaTG+aookjGKRjXtM5cbUNyaijYUke3Rk_07q18CyfQ@mail.gmail.com>
References: <11702_1369048439_519A0577_11702_1870_1_E6472BD072676843ADB8D37E50F4C88D0F2E60E3DF@DE0-MAILMBX-P21.res.airbus.corp>
	<CALEC75JkNMoziqEbpQzYqwpLxUkmCL96r2EsRoRkAsA3zaKLeA@mail.gmail.com>
	<CAE3HoVSUTy7L_f+G2hdNRMCUbCDQJnAqmWhVsSW+LuyOYCX=AA@mail.gmail.com>
	<CALEC75JuaTG+aookjGKRjXtM5cbUNyaijYUke3Rk_07q18CyfQ@mail.gmail.com>
Message-ID: <B344EA2F-2031-420C-8C54-861C6097F802@rabbitmq.com>

If the network becomes unresponsive (due to one of the various conditions you've already noted), the operating system will eventually return ETIMEDOUT as the result of any socket operations (such as recv, send, etc). At this point, the client will notify your application code with an exception and call any registered shutdown listeners.

Cheers,
Tim

On 20 May 2013, at 17:36, "Balachandar R.A." <balachandar.ra at gmail.com> wrote:

> Hi,
> 
> Here is the exception we got:
> 
> Caught: com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.net.SocketException: Operation timed out
> com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.net.SocketException: Operation timed out
> at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:162)
> at com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:176)
> at com.rabbitmq.client.QueueingConsumer$nextDelivery.call(Unknown Source)
> at pfcloud$_run_closure2.doCall(pfcloud.groovy:129)
> at pfcloud.run(pfcloud.groovy:552)
> Caused by: java.net.SocketException: Operation timed out
> at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:104)
> at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:141)
> at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:402)
> at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:430)
> 
> -- 
> PGP KeyID: 2048R/EA31CFC9  subkeys.pgp.net
> 
> On 20 May 2013 18:19, "Michael Klishin" <michael.s.klishin at gmail.com> wrote:
> 
> 2013/5/20 Balachandar R.A. <balachandar.ra at gmail.com>
> the below code could result in a timeout exception
> 
> Can you post the exact exception class name and maybe a stack trace?
> 
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130520/8e938e29/attachment.htm>

From woqimingweipeng at gmail.com  Tue May 21 03:44:39 2013
From: woqimingweipeng at gmail.com (Xie Yunpeng)
Date: Tue, 21 May 2013 10:44:39 +0800
Subject: [rabbitmq-discuss] consumer get messages from one queue
	sometimes disorder
In-Reply-To: <CAAjbVJCYkNA0QPb=D8mn2+c=A4K-nLme_BM=6t=4mH+k27_E3A@mail.gmail.com>
References: <CAAjbVJC2Sie+bAusdENY5bJaGASqqy=SR89f7pyiMoeDHCuMnQ@mail.gmail.com>
	<5188BAB2.4090303@rabbitmq.com> <5188CF6C.6070602@rabbitmq.com>
	<CAAjbVJCYkNA0QPb=D8mn2+c=A4K-nLme_BM=6t=4mH+k27_E3A@mail.gmail.com>
Message-ID: <CAAjbVJDEXopt-dqNrpvEazcsxPwVW8jnHd2fv5wJoZ9-hAgueA@mail.gmail.com>

the second reason is right.it mybe a bug in kombu/amqp. in kombu it get
many message from rabbitmq in SimpleQueue.get method without ack and push
the messages into a collections.deque, but sometimes my server has poor
network and the client/server disconnected(or mybe a but in amqp lead to
the disconnection), then the kombu create a new connection/channel, the
messages in noack cannnot be received for a while and then goto ready .this
reason makes the messages disorder.


2013/5/7 Xie Yunpeng <woqimingweipeng at gmail.com>

> thx, i will do some test and analyse log to verify the second condition.i
> think it is the real reason.
>
>
> 2013/5/7 Simon MacMullen <simon at rabbitmq.com>
>
>> On 07/05/2013 09:26, Emile Joubert wrote:
>>
>>> On 06/05/13 11:08, Xie Yunpeng wrote:
>>>
>>>  I use 4 publisher sending messages to this queue and 1 consumer to
>>>> receive the messages.the consumer when connect to the rabbitmq server ,
>>>>
>>>
>>>  i find it receive messages disorder sometimes, just like: first receive
>>>> messges in current time and then receive messages several hour ago, the
>>>> interval is not regular.
>>>>
>>>
>>>
>>> You can find the ordering guarantees here:
>>> http://www.rabbitmq.com/**semantics.html#ordering<http://www.rabbitmq.com/semantics.html#ordering>
>>> In particular, there is no ordering guarantee if you involve multiple
>>> publishers.
>>>
>>
>> Well, there's still exactly the same ordering guarantee as there is with
>> a single publisher: messages from each publishing channel won't get
>> reordered with respect to each other. We just don't guarantee anything
>> about ordering between channels. And indeed it's hard to see how we could.
>>
>> To the OP: either something weird is happening in your publishers causing
>> them to buffer messages for hours before sending to RabbitMQ (unlikely I
>> guess but I should mention it) or messages are not being acknowledged by
>> your consumers and are then being requeued once the consumer disconnects.
>> In the latter case all the "late" messages should have the "redelivered"
>> flag set.
>>
>> Cheers, Simon
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/fa174b12/attachment.htm>

From simlu at su.se  Tue May 21 06:38:42 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Tue, 21 May 2013 07:38:42 +0200
Subject: [rabbitmq-discuss] [ANN] RabbitMQ Kerberos authentication plugin
Message-ID: <20130521053842.GE292@kaka.it.su.se>

I'm glad to be able to announce the Kerberos (note: not GSSAPI[1])
authentication plugin for RabbitMQ.

The plugin makes it possible to use Kerberos principals to login to
RabbitMQ 3.x both via AMQP and the management GUI.
Since Kerberos is an authentication protocol you still need a plugin to
provide authorization. By default that is done via
rabbit_auth_backend_internal.

The code is available from
<https://github.com/simmel/rabbitmq-auth-backend-kerberos> and is built
with help from the RabbitMQ plugin development guide
<https://www.rabbitmq.com/plugin-development.html>.
Code is licenced under the revised BSD license.

Configuration and install documentation is also available from the
above github page.

The plugin works with both Heimdal and MIT Kerberos libs.

I'd like to thank everyone who has helped this become a reality,
especially Simon and Tim from VMware and Linus and Klas, my former
co-workers.

Finally I'd like to thank my employer, IT Services at Stockholm
University, for giving me the opportunity to learn C (atleast, more
properly) and Erlang.

[1] While we would love to use GSSAPI instead of user/password via
Kerberos, we weren't that keen on implementing GSSAPI in all
RabbitMQ/AMQP libraries available.


Br,
- Simon

____________________________________

Simon Lundstr?m
Section for Infrastructure

IT Services
Stockholm University
SE-106 91 Stockholm, Sweden

www.su.se/it

____________________________________

From vikram.vis at gmail.com  Tue May 21 06:15:07 2013
From: vikram.vis at gmail.com (Vikram Viswanathan)
Date: Mon, 20 May 2013 22:15:07 -0700
Subject: [rabbitmq-discuss] Error while calling ExchangeBind()
Message-ID: <519B02DB.1090600@gmail.com>

Hi All,
     I have a very simple scenario. I create a queue, exchange and bind 
the queue to exchange.

     Code :
     String queueName = new 
StringBuilder("LP.DATA.").append("TESTACCOUNT").append(".").append("subLP").toString();
     channel.exchangeDeclare(ExchangeConstants.DATA_EXCG, "direct", true);
     channel.queueDeclare(queueName, true, false, false, null);
     channel.exchangeBind(queueName, ExchangeConstants.DATA_EXCG, 
queueName);

     I get the following error when exchangeBind() is called.

     com.rabbitmq.client.ShutdownSignalException: channel error; reason: 
{#method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no 
exchange 'LP.DATA.TESTACCOUNT.subLP' in vhost '/', class-id=40, 
method-id=30), null, ""}

     My ExchangeConstants.DATA_EXCG is "DATA_EXCG". Using RabbitMq admin 
I see that the exchange and queue are all created. From the exception I 
don't understant why is it looking for exchange with name 
"LP.DATA.TESTACCOUNT.subLP", this is a queuename.  It seems quite 
trivial, I am sure I am missing something.

     I am using java rabbitmq-client version 3.04.


Thanks,
Vikram





From taihock at gmail.com  Tue May 21 06:39:08 2013
From: taihock at gmail.com (thomas)
Date: Mon, 20 May 2013 22:39:08 -0700 (PDT)
Subject: [rabbitmq-discuss] All nodes in a cluster becomes unresponsive for
 a short period of time when any node goes down
Message-ID: <1369114748473-26883.post@n5.nabble.com>

I have 3 RabbitMQ nodes, namely rabbit at A, rabbit at b, rabbit at c in a cluster
with active-mirrored queues HA.
I am using RabbitMQ 3.1.0 with autoheal chosen for
"cluster_partition_handling" and "net_ticktime" set to 2. I tried to
shutdown the network interface instead of shutting down rabbitmq to observe
the behavior and realized that it results in the temporary unresponsiveness
of all the other available nodes for a short period of time. 

This was what I did:
1) All the 3 nodes are running as per normal
2) I shutdown the network interface for rabbit at B
3) The other 2 nodes become unresponsive for a short period of time and the
messages sent during that period were mostly lost.

I would like to find out if that is the intended behavior or possibly
something wrong with my setup. Thanks in advance.






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/All-nodes-in-a-cluster-becomes-unresponsive-for-a-short-period-of-time-when-any-node-goes-down-tp26883.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Tue May 21 09:00:47 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 21 May 2013 09:00:47 +0100
Subject: [rabbitmq-discuss] [ANN] RabbitMQ Kerberos authentication plugin
In-Reply-To: <20130521053842.GE292@kaka.it.su.se>
References: <20130521053842.GE292@kaka.it.su.se>
Message-ID: <31EC56C6-08CF-4714-BCD3-6C0531D8A871@rabbitmq.com>

Congratulations on the first release Simon! :)

On 21 May 2013, at 06:38, Simon Lundstr?m <simlu at su.se> wrote:

> I'm glad to be able to announce the Kerberos (note: not GSSAPI[1])
> authentication plugin for RabbitMQ.
> 
> The plugin makes it possible to use Kerberos principals to login to
> RabbitMQ 3.x both via AMQP and the management GUI.
> Since Kerberos is an authentication protocol you still need a plugin to
> provide authorization. By default that is done via
> rabbit_auth_backend_internal.
> 
> The code is available from
> <https://github.com/simmel/rabbitmq-auth-backend-kerberos> and is built
> with help from the RabbitMQ plugin development guide
> <https://www.rabbitmq.com/plugin-development.html>.
> Code is licenced under the revised BSD license.
> 
> Configuration and install documentation is also available from the
> above github page.
> 
> The plugin works with both Heimdal and MIT Kerberos libs.
> 
> I'd like to thank everyone who has helped this become a reality,
> especially Simon and Tim from VMware and Linus and Klas, my former
> co-workers.
> 
> Finally I'd like to thank my employer, IT Services at Stockholm
> University, for giving me the opportunity to learn C (atleast, more
> properly) and Erlang.
> 
> [1] While we would love to use GSSAPI instead of user/password via
> Kerberos, we weren't that keen on implementing GSSAPI in all
> RabbitMQ/AMQP libraries available.
> 
> 
> Br,
> - Simon
> 
> ____________________________________
> 
> Simon Lundstr?m
> Section for Infrastructure
> 
> IT Services
> Stockholm University
> SE-106 91 Stockholm, Sweden
> 
> www.su.se/it
> 
> ____________________________________
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue May 21 10:31:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 May 2013 10:31:11 +0100
Subject: [rabbitmq-discuss] Error while calling ExchangeBind()
In-Reply-To: <519B02DB.1090600@gmail.com>
References: <519B02DB.1090600@gmail.com>
Message-ID: <519B3EDF.5060001@rabbitmq.com>

On 21/05/13 06:15, Vikram Viswanathan wrote:
>      channel.exchangeBind(queueName, ExchangeConstants.DATA_EXCG,
> queueName);

Channel.exchangeBind() is for binding exchanges to other exchanges. Use 
Channel.queueBind() to bind a queue to an exchange.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Tue May 21 11:47:36 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 21 May 2013 11:47:36 +0100
Subject: [rabbitmq-discuss] 700k msgs using 6.3 GiB?
In-Reply-To: <5D1BE82E-5AB3-4CA4-9E98-25A0E71973D9@teksol.info>
References: <9C056A40-C6D5-470F-B3BB-FD32E2CC059E@teksol.info>
	<51944813.4040803@rabbitmq.com>
	<00FF009B-EF5E-40A0-9169-6C2CE14E4BC5@teksol.info>
	<519490BE.60507@rabbitmq.com>
	<5D1BE82E-5AB3-4CA4-9E98-25A0E71973D9@teksol.info>
Message-ID: <519B50C8.70105@rabbitmq.com>

Fran?ois,

On 17/05/13 16:03, Fran?ois Beausoleil wrote:
> Le 2013-05-16 ? 03:54, Matthias Radestock a ?crit :
>> However, pretty much all garbage should get collected when the
>> system is idle. In particular, when there is no activity on a
>> queue, or any other Erlang processes in the message processing
>> pipeline, for a while then these processes are supposed to
>> hibernate, which entails reclaiming all garbage.
>
> Can you define "a while"?

A few seconds.

Note that Erlang gc operates *per Erlang process*, so the overall system 
need not be idle for individual processes to hibernate.

> I have constant new interactions that come in. I can't really stop
> that to let garbage be collected.

You should not have to. Garbage collection still takes place on non-idle 
processes. But depending on the exact usage profile it is conceivable 
that a fair amount of garbage accumulates before a collection.

>> But to investigate that further we really need you on the latest
>> versions of rabbit and erlang.
>
> If we could have clusters on different minor versions, it would
> already be a help.

That ain't gonna happen, I'm afraid.


Regards,

Matthias.

From matthias at rabbitmq.com  Tue May 21 11:52:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 21 May 2013 11:52:57 +0100
Subject: [rabbitmq-discuss] Queue Memory keep on increasing
In-Reply-To: <CAB0ZxM4jbpXkeS+_c7c-H4BPtGiu-J62CLhYG4qkbLX0zy0ouw@mail.gmail.com>
References: <CAB0ZxM78ga8xEc9f8Qp8DfE5y_H4dh4n441xTMKi5QTA=GEXvQ@mail.gmail.com>
	<5190B7FE.80005@rabbitmq.com>
	<CAB0ZxM4jbpXkeS+_c7c-H4BPtGiu-J62CLhYG4qkbLX0zy0ouw@mail.gmail.com>
Message-ID: <519B5209.30206@rabbitmq.com>

On 16/05/13 14:54, chetan dev wrote:
> Now this memory has reached to 6.4 mb.
> can you please tell me what does this memory signify exactly and the
> possible cause of this problem .

Presumably you have way more memory available on your system than 6.4MB. 
As Simon said "I would only worry if the memory use kept growing *quite 
a long way past* 3MB".

Matthias.

From tim at rabbitmq.com  Tue May 21 11:55:23 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 21 May 2013 11:55:23 +0100
Subject: [rabbitmq-discuss] Monitoring for busy_dist_port
In-Reply-To: <CANum3oXEbm6Xyy98-Jif09HbkEWB6bYGiwWN4ZNF55af9OJRtg@mail.gmail.com>
References: <CANum3oXEbm6Xyy98-Jif09HbkEWB6bYGiwWN4ZNF55af9OJRtg@mail.gmail.com>
Message-ID: <C5703B15-35F0-43E2-AE72-5895CBB4296B@rabbitmq.com>

Hi Iain,

On 20 May 2013, at 12:15, Iain Hull wrote:

> I have searched the RabbitMQ mailing list for cases of busy_dist_port or zdbbl, but cannot find any.  I am wondering if RabbitMQ can suffer from problems with busy_dist_port or if zdbbl should be set to any particular value? Or I should I monitor the RabbitMQ logs for busy_dist_port?
> 

Rabbit doesn't log busy_dist_port at the moment, though we could do so. Most of what you're interested in monitoring in the rabbit logs will pertain to 'nodedown' and cluster membership changes. Feel free to try tweaking the buffer size, but we don't have any specific advice concerning this parameter, except perhaps the old adage "if it isn't broken...".

From matthias at rabbitmq.com  Tue May 21 11:57:50 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 21 May 2013 11:57:50 +0100
Subject: [rabbitmq-discuss] getting duplicated delivery
In-Reply-To: <CAAef2CJ-XEh8sCV8bHUFT6JPTRzYBeK8PEd1PkXjpWeb9=qNoA@mail.gmail.com>
References: <CAAef2C+k_TQPrcKem3rTjSYLPxc0sGZvMY=b82eQJtf8mafrOg@mail.gmail.com>
	<C68CD58D-E4B6-47FC-AE75-D1E3B6A57781@rabbitmq.com>
	<CAAef2CLMTwnmROuAjB-27FyrUHQeCzEHMxmLarcxnpRXZ2avQw@mail.gmail.com>
	<CAE3HoVQM=MhiNUpmmM3OnJ-Tgt=k6Lhkmob+V4451TtDLJ+75w@mail.gmail.com>
	<CAAef2CJ-XEh8sCV8bHUFT6JPTRzYBeK8PEd1PkXjpWeb9=qNoA@mail.gmail.com>
Message-ID: <519B532E.4090705@rabbitmq.com>

On 16/05/13 17:53, Billy Hand wrote:
> Well I should add that I'm using PHP and the PECL bindings for the
> rabbitmq-c library.  So I've been able to determine the exact repro steps.
> 1. get (no_ack off)
> 2. ack
> 3. get again, the connection drops, the message gets redelivered

That suggests there was an error. I have no idea how to grab the details 
of that in the PHP client, but the error should also appear in the 
server log, so go take a look there.

Matthias.

From tim at rabbitmq.com  Tue May 21 12:03:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 21 May 2013 12:03:07 +0100
Subject: [rabbitmq-discuss] Production cluster fun,
	make that not so fun (production cluster setup guidance)!
In-Reply-To: <a9bb05f0-febb-4e1f-98ea-99aed190f9ea@googlegroups.com>
References: <a9bb05f0-febb-4e1f-98ea-99aed190f9ea@googlegroups.com>
Message-ID: <90F4CD8F-0C39-43F1-B4AC-0135FAA05638@rabbitmq.com>

Hi Stefan,

Sorry for the delay in getting back to you...

On 14 May 2013, at 05:52, Stefan Sedich wrote:

> What is the ideal setup for our production cluster, currently we have two ABs with two nodes in each, after setting pause_minority today and having a partition where all nodes were paused, we changed to autoheal and restarted all nodes. In the midst of this something happened, and even rolling back to just 1 node apps were not able to connect to the node.

Sounds like the node got stuck during recovery.

> In the end my only fix was to completely trash the db/ of that one node and restart it which got things working again (no idea what got corrupted or how but something went bad). Now after this is would be good for some guidance on how to properly configure out cluster and how many nodes would be ideal and what recovery node to use (we seem to occasionally have a partition, even though it SHOULD be a stable link).

The pause_minority setting will cause nodes in the minority island to literally pause (with regards cluster membership) until they've seen the cluster recover - i.e., all the expected nodes come back online. As to "what recovery node to use", there is no answer to that because there is no concept of a 'special' node in a rabbit cluster. Or did you rather mean what recovery *mode* to use?

Please note that whilst the autoheal features are intended to simply the process of partition recovery, they're not a panacea and a partition can still result in states where manual intervention is required. It would be good to understand how your current cluster topology is used by clients, to get a feel for what the impact of the recovery process is likely to be.

Cheers,
Tim

From matthias at rabbitmq.com  Tue May 21 12:06:19 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 21 May 2013 12:06:19 +0100
Subject: [rabbitmq-discuss] new queue causes extremely poor disk IO
In-Reply-To: <CABZkbxiU3W_2oDqE3nouedXkWzSq8Yf8-Y4Sw1vQ=x00khMLPg@mail.gmail.com>
References: <CABZkbxiU3W_2oDqE3nouedXkWzSq8Yf8-Y4Sw1vQ=x00khMLPg@mail.gmail.com>
Message-ID: <519B552B.1060605@rabbitmq.com>

Kevin,

On 18/05/13 02:26, Kevin Goess wrote:
> We could try that. Is an upgrade between 2.7.1 expected to be
> transparent?  The queues and exchanges will survive the upgrade?

Yes. Yes.

> Should we upgrade all our shovelers as well, or can we leave them at
> 2.7.1?

Not sure what you mean by 'shovelers'. The rabbitmq-shovel plugin, like 
all plug-ins, must match the version of the broker; but that's generally 
the case anyway since the plug-in ships with the broker. If, otoh, your 
'shovelers' are AMQP client applications then it's ok to leave them 
alone, though obviously it is advisable to update the client libraries 
to the latest version at a later point, when convenient,

Regards,

Matthias.

From tim at rabbitmq.com  Tue May 21 12:15:11 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 21 May 2013 12:15:11 +0100
Subject: [rabbitmq-discuss] All nodes in a cluster becomes unresponsive
	for a short period of time when any node goes down
In-Reply-To: <1369114748473-26883.post@n5.nabble.com>
References: <1369114748473-26883.post@n5.nabble.com>
Message-ID: <04692AB3-F6D9-4E9E-8449-FAF398804B5C@rabbitmq.com>

Hi Thomas,

During autohealing, nodes will be restarted dynamically and during the downtime any clients will effectively be disconnected. Those clients may not, however, detect this disconnection in a timely fashion, so I would ask...

1. are you using AMQP heartbeats (to detect disconnections quickly)
2. are you using producer confirms (to clarify that sent message have indeed arrived at the target broker)
3. are you using consumer cancel notifications (to detect that in a clustered + ha setup, the node on which the queue is located has failed/stopped)

Cheers,
Tim

On 21 May 2013, at 06:39, thomas wrote:

> I have 3 RabbitMQ nodes, namely rabbit at A, rabbit at b, rabbit at c in a cluster
> with active-mirrored queues HA.
> I am using RabbitMQ 3.1.0 with autoheal chosen for
> "cluster_partition_handling" and "net_ticktime" set to 2. I tried to
> shutdown the network interface instead of shutting down rabbitmq to observe
> the behavior and realized that it results in the temporary unresponsiveness
> of all the other available nodes for a short period of time. 
> 
> This was what I did:
> 1) All the 3 nodes are running as per normal
> 2) I shutdown the network interface for rabbit at B
> 3) The other 2 nodes become unresponsive for a short period of time and the
> messages sent during that period were mostly lost.
> 
> I would like to find out if that is the intended behavior or possibly
> something wrong with my setup. Thanks in advance.
> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/All-nodes-in-a-cluster-becomes-unresponsive-for-a-short-period-of-time-when-any-node-goes-down-tp26883.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue May 21 14:34:31 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 21 May 2013 14:34:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.1 released
Message-ID: <869D442E-7CFA-4633-9E82-4A5A6832E655@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.1.1.

This release fixes a number of bugs in 3.1.0 and earlier versions.

See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.1.1.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                    The RabbitMQ Team
                    (http://www.rabbitmq.com)
_______________________________________________
rabbitmq-announce mailing list
rabbitmq-announce at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-announce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/44d826b8/attachment.htm>

From russell.jenkins at strategicdata.com.au  Tue May 21 13:53:44 2013
From: russell.jenkins at strategicdata.com.au (Russell Jenkins)
Date: Tue, 21 May 2013 22:53:44 +1000
Subject: [rabbitmq-discuss] reply-to header in STOMP frames causing
	"Processing Error"
Message-ID: <519B6E58.4010609@strategicdata.com.au>

Hi,

After reciently upgrading to RabbitMQ 3.1.0 we are now seeing a 
'Processing Error' when (some) STOMP frames contain a 'reply-to' header.
[ Sending the frame without a reply-to header, or using a /temp-queue as 
the reply-to queue both send successfully ]

Any ideas as to how to interpret the stack trace below, or hints suggest 
what I'm doing wrong would be most appreciated.


Here's a sample frame that  causes the error (the queue has been created 
in the admin interface):
===
SEND
destination:/amq/queue/test1
reply-to:/amq/queue/test1

Test message
===

The corresponding stack trace form the log is:
=ERROR REPORT==== 21-May-2013::22:21:07 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error"
Server private detail: {badarg,
                            [{erlang,list_to_binary,
[[84,95,47,116,101,109,112,45,113,117,101,117,
                                   101,47|none]],
                                 []},
                             {rabbit_stomp_util,internal_tag,1,[]},
{rabbit_stomp_processor,ensure_reply_queue,2,[]},
{rabbit_stomp_processor,ensure_reply_to,2,[]},
                             {rabbit_stomp_processor,do_send,4,[]},
{rabbit_stomp_processor,with_destination,4,[]},
{rabbit_stomp_processor,process_request,3,[]},
                             {gen_server2,handle_msg,2,[]}]}



Thanks in advance,
    Russell
--
Russell Jenkins
Programmer,
Strategic Data.


From simon at rabbitmq.com  Tue May 21 15:38:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 May 2013 15:38:32 +0100
Subject: [rabbitmq-discuss] Monitoring for busy_dist_port
In-Reply-To: <CANum3oXEbm6Xyy98-Jif09HbkEWB6bYGiwWN4ZNF55af9OJRtg@mail.gmail.com>
References: <CANum3oXEbm6Xyy98-Jif09HbkEWB6bYGiwWN4ZNF55af9OJRtg@mail.gmail.com>
Message-ID: <519B86E8.4020102@rabbitmq.com>

To add to what Tim said: I've run some tests with busy_dist_port 
monitoring patched into RabbitMQ and while I can certainly see 
busy_dist_port messages, I haven't been able to demonstrate any 
improvement in throughput by tweaking zdbbl until they went away - so I 
don't see the point in exposing them.

Out of interest, did you see a performance improvement in Riak after 
modifying zdbbl, or were you just trying to make the warnings go away? :-)

Cheers, Simon

On 20/05/13 12:15, Iain Hull wrote:
> We are in the process of deploying a Riak cluster, and are wondering if
> some of the lessons we learned monitoring Erlang in Riak should be
> applied to RabbitMQ.
>
> During testing we noticed a lot of busy_dist_port in the logs, the root
> was cause was a the Erlang kernel parameter zdbbl was set too low.  We
> have adjusted the parameter and are now monitoring the logs for
> busy_dist_port errors.
>
> I have searched the RabbitMQ mailing list for cases of busy_dist_port or
> zdbbl, but cannot find any.  I am wondering if RabbitMQ can suffer from
> problems with busy_dist_port or if zdbbl should be set to any particular
> value? Or I should I monitor the RabbitMQ logs for busy_dist_port?
>
> Thanks,
> Iain.
>
> --
> Iain Hull
> Senior Software Engineer
> iain.hull.workday (Skype)
> iain.hull at workday.com <mailto:iain.hull at workday.com>
>
> <http://www.workday.com/signature-uk>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue May 21 16:10:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 May 2013 16:10:10 +0100
Subject: [rabbitmq-discuss] reply-to header in STOMP frames causing
 "Processing Error"
In-Reply-To: <519B6E58.4010609@strategicdata.com.au>
References: <519B6E58.4010609@strategicdata.com.au>
Message-ID: <519B8E52.5050203@rabbitmq.com>

On 21/05/13 13:53, Russell Jenkins wrote:
> After reciently upgrading to RabbitMQ 3.1.0 we are now seeing a
> 'Processing Error' when (some) STOMP frames contain a 'reply-to' header.
> [ Sending the frame without a reply-to header, or using a /temp-queue as
> the reply-to queue both send successfully ]
>
> Any ideas as to how to interpret the stack trace below, or hints suggest
> what I'm doing wrong would be most appreciated.

Damn, you are quite right. Regression in 3.1.0. Can't believe our tests 
didn't catch that. Fix soon.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Ron.Cordell at RelayHealth.com  Tue May 21 17:24:10 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron L)
Date: Tue, 21 May 2013 16:24:10 +0000
Subject: [rabbitmq-discuss] F5 Load Balancer Pool Management
Message-ID: <0B8CD6850421B745BE39BC5C7601923271F697F0@DDCEP50015.na.corp.mckesson.com>

Has anyone implemented an automated means of removing RabbitMQ cluster nodes from an F5 load balancer pool?

If so, I'd be interested in how you did it...

Cheers,

-ronc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/f11a4392/attachment.htm>

From vikram.vis at gmail.com  Tue May 21 18:39:27 2013
From: vikram.vis at gmail.com (Vikram Viswanathan)
Date: Tue, 21 May 2013 10:39:27 -0700
Subject: [rabbitmq-discuss] Error while calling ExchangeBind()
In-Reply-To: <519B3EDF.5060001@rabbitmq.com>
References: <519B02DB.1090600@gmail.com> <519B3EDF.5060001@rabbitmq.com>
Message-ID: <519BB14F.4050700@gmail.com>

Thanks. Missed queueBind() completely.

-Vikram

On 05/21/2013 02:31 AM, Simon MacMullen wrote:
> On 21/05/13 06:15, Vikram Viswanathan wrote:
>>      channel.exchangeBind(queueName, ExchangeConstants.DATA_EXCG,
>> queueName);
>
> Channel.exchangeBind() is for binding exchanges to other exchanges. 
> Use Channel.queueBind() to bind a queue to an exchange.
>
> Cheers, Simon
>


From stuff at moesel.net  Tue May 21 21:04:59 2013
From: stuff at moesel.net (Chris)
Date: Tue, 21 May 2013 16:04:59 -0400
Subject: [rabbitmq-discuss] RabbitMQ 3.1.1 Management Console Issue
Message-ID: <CAHEpgBAWii95HBxZEpoyvHzMR8fJSPTtPdcGMW2Y8w4zgum7Bg@mail.gmail.com>

Hello,

I've just upgraded from RabbitMQ 3.0.2 to RabbitMQ 3.1.1.  When I went to
the web-based management console the first time, I saw the Overview page.
 Clicking through the tabs, however, I noticed that sometimes the UI didn't
update.

Now, whenever I try to go to the Overview page, the UI does not update, and
I see one or multiples of this error at the bottom of the page:
"ReferenceError:
queue_length is not defined".  Even after a server restart I cannot see the
overview page.

I am on RedHat 6.2 using Erlang R14B04 from EPEL.  There are no notable
errors in the logs.

Any thoughts?  Bug?

Thanks,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/4b4d7ad8/attachment.htm>

From stuff at moesel.net  Tue May 21 21:12:40 2013
From: stuff at moesel.net (Chris)
Date: Tue, 21 May 2013 16:12:40 -0400
Subject: [rabbitmq-discuss] RabbitMQ 3.1.1 Management Console Issue
In-Reply-To: <CAHEpgBAWii95HBxZEpoyvHzMR8fJSPTtPdcGMW2Y8w4zgum7Bg@mail.gmail.com>
References: <CAHEpgBAWii95HBxZEpoyvHzMR8fJSPTtPdcGMW2Y8w4zgum7Bg@mail.gmail.com>
Message-ID: <CAHEpgBA0GbaZPdb_OsJWsE60EE+bvFbBfTpst=AfCO7FNKPb1g@mail.gmail.com>

NEVERMIND.

If anyone else runs into this, it was a browser cache issue.  Once I
cleared my browser's cache, it worked as expected!  I did have to clear the
full cache though (just a hard refresh of the page did not work).  Sorry
for the false alarm.

BTW-- the new UI in the management console is really slick, and I'm very
much looking forward to taking advantage of all of the awesomeness in
RabbitMQ 3.1.x.  ;-)

Thanks for a great product,
Chris


On Tue, May 21, 2013 at 4:04 PM, Chris <stuff at moesel.net> wrote:

> Hello,
>
> I've just upgraded from RabbitMQ 3.0.2 to RabbitMQ 3.1.1.  When I went to
> the web-based management console the first time, I saw the Overview page.
>  Clicking through the tabs, however, I noticed that sometimes the UI didn't
> update.
>
> Now, whenever I try to go to the Overview page, the UI does not update,
> and I see one or multiples of this error at the bottom of the page: "ReferenceError:
> queue_length is not defined".  Even after a server restart I cannot see
> the overview page.
>
> I am on RedHat 6.2 using Erlang R14B04 from EPEL.  There are no notable
> errors in the logs.
>
> Any thoughts?  Bug?
>
> Thanks,
> Chris
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/6b51442d/attachment.htm>

From moshima at advent.com  Tue May 21 23:19:46 2013
From: moshima at advent.com (michi.oshima)
Date: Tue, 21 May 2013 15:19:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RDQ files filling the disk.
Message-ID: <1369174785991-26903.post@n5.nabble.com>

Hi,

We deploy a couple of RabbitMQ servers.  Say Rabbit1 and Rabbit2.  They are
linked with each other via the Shovel plug-in.  A client publishes messages
to Rabbit1 and another client consumes them from Rabbit2.  Each of these
clients connects to a durable queue.

We recently had an issue where Rabbit1 started taking up a lot of disk
space.  A directory called 'msg_store_transient' got up to some 20 GB,
filled with files with *.rdq extension.  They are about 16MB each in size. 
It almost filled up the disk (it's a small disk) and caused our application
(client to Rabbit1) to fail.

Meanwhile, Rabbit2 reportedly have been receiving the messages from Rabbit1. 
I also saw no shovel connection related errors in rabbit.log, etc.

Q1. Does this sound plausible?  If so, how could this happen?
Q2. I'm thinking the rdq files are meant to get deleted at some point.  What
would cause the files to *not* get deleted?

Thanks,

Michi Oshima




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RDQ-files-filling-the-disk-tp26903.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From moshima at advent.com  Wed May 22 00:31:16 2013
From: moshima at advent.com (michi.oshima)
Date: Tue, 21 May 2013 16:31:16 -0700 (PDT)
Subject: [rabbitmq-discuss] RDQ files filling the disk.
In-Reply-To: <1369174785991-26903.post@n5.nabble.com>
References: <1369174785991-26903.post@n5.nabble.com>
Message-ID: <1369179076617-26904.post@n5.nabble.com>

Forgot to add.  RabbitMQ servers are both on version 3.0.0.  




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RDQ-files-filling-the-disk-tp26903p26904.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From kgoess at bepress.com  Wed May 22 01:41:21 2013
From: kgoess at bepress.com (Kevin Goess)
Date: Tue, 21 May 2013 17:41:21 -0700
Subject: [rabbitmq-discuss] STOMP incompatibility upgrading 2.7 to 3.1:
	escaping colons in header values
Message-ID: <CABZkbxiS=ptT5mWV8KjRW6jfj83R2i-Uy+WBy7AGj0Y=4QDc5g@mail.gmail.com>

STOMP 1.0 allowed colons in header values, e.g.

bp_timestamp:2013-05-21T16:00:21-07:00

But this commit a couple months ago disallowed them in any stomp frame:
https://github.com/rabbitmq/rabbitmq-stomp/commit/4c20ec31d3de9129faeb97a5d95a9e74438bdc00

That seems like a mistake to me, but either way I'm calling it out here in
case anybody else is travelling down the same road.  They now have to be
escaped to "\c".
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/2fbe866c/attachment.htm>

From simlu at su.se  Wed May 22 06:47:37 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Wed, 22 May 2013 07:47:37 +0200
Subject: [rabbitmq-discuss] F5 Load Balancer Pool Management
In-Reply-To: <0B8CD6850421B745BE39BC5C7601923271F697F0@DDCEP50015.na.corp.mckesson.com>
References: <0B8CD6850421B745BE39BC5C7601923271F697F0@DDCEP50015.na.corp.mckesson.com>
Message-ID: <20130522054737.GG292@kaka.it.su.se>

Morning Ron!

We're just in the middle of implementing RabbitMQ cluster by using our
F5 BIG-IP loadbalancers.

The idea is to have two healthchecks:

1, One very simple which connects to the node and sees that the "path is
clear", i.e. that no firewall etc is blocking the connection to the
node. This is being done by sending eight random bytes to the AMQP port
(we're using SSL) and the server should respond with AMQP0091 (see,
<https://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf> section 4.2.2 Protocol
Header).

The problem with this is that it creates alot of log noise and I'm not
sure how to filter this out or how to generate a smart enough request
that RabbitMQ won't generate log noise.

2, The other health check is more complex and we want to check that a
node is really up and that it accepts messages. As BIG-IP doesn't
support AMQP OOTB we only found two other solutions:
* Write and compile a static C-binary which does the check and speaks
the AMQP protocol
* Put a Nagios NRPE check on the host which does the check and use the
BIG-IP to do a NRPE request to the node.

While the first solution seems ideal we don't want to complicate our
BIG-IP setup (i.e. put files on it) so we chose the latter.

I created a Perl-script <https://github.com/simmel/create_nrpe_request>
that can create the binary request that NRPE uses so it can be used in
the BIG-IP.

Healthcheck #2 is done but I'm still trying to make #1 smarter and not
create log noise.
Any ideas here from you or others?

Br,
- Simon

____________________________________

Simon Lundstr?m
Section for Infrastructure

IT Services
Stockholm University
SE-106 91 Stockholm, Sweden

www.su.se/it

____________________________________

From francois at seevibes.com  Tue May 21 18:25:56 2013
From: francois at seevibes.com (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Tue, 21 May 2013 13:25:56 -0400
Subject: [rabbitmq-discuss] Recovering a busted instance
Message-ID: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>

I have an instance which I tried upgrading from 3.0.2 to 3.1.0. Something broke during the upgrade and I booted a fresh new instance and connected my clients to it.

Now, I have valuable data in the 3.0.2 instance which I'd like to retrieve. If I could boot the instance, I'd shovel the data to the 3.1.0 instance.

I have attached the log files from the crashing instance.

Is there anything I can do to recuperate those messages?

Thanks,
Fran?ois Beausoleil

-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at rabbit104.log
Type: application/octet-stream
Size: 53604 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/b9dfc756/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at rabbit104-sasl.log
Type: application/octet-stream
Size: 22497 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/b9dfc756/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: startup_err
Type: application/octet-stream
Size: 77 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/b9dfc756/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: startup_log
Type: application/octet-stream
Size: 22167 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/b9dfc756/attachment-0003.obj>
-------------- next part --------------



From asarpeshkar at wgen.net  Tue May 21 19:21:45 2013
From: asarpeshkar at wgen.net (Adhiraj Sarpeshkar)
Date: Tue, 21 May 2013 14:21:45 -0400
Subject: [rabbitmq-discuss] Rabbit Persistence Store Documentation
Message-ID: <519BBB39.1020506@wgen.net>

It took me some digging to find out that Rabbit uses a Mnesia database 
for storage and that the store for a node is located under 
/var/lib/rabbitmq/mnesia/rabbit/<node_name>.   Not that this is terribly 
important information for most people, but maybe it could be featured 
more prominently in the docs?  Or I might be blind and it's already 
there--in which case a link would be much appreciated in case I need to 
revisit this in the future.

Regards,
Adhiraj Sarpeshkar

From paul.bowsher at gmail.com  Tue May 21 20:12:41 2013
From: paul.bowsher at gmail.com (Paul Bowsher)
Date: Tue, 21 May 2013 12:12:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Mirrored queue performance factors
Message-ID: <617811bf-68d9-4f86-94e4-8b411086031e@googlegroups.com>

Hi,

We operate two dual-node brokers, each broker having quite different queues 
and workloads. Each box has 24 cores (H/T) worth of Xeon E5645 @ 2.4GHz 
with 48GB RAM, connected by Gigabit LAN with ~150?s latency, running RHEL 
5.6, RabbitMQ 3.1, Erlang R16B with HiPE off. We've tried with HiPE on but 
it made no noticeable performance impact, and was very crashy.

We appear to have hit a ceiling for our message rates of between 1,000/s 
and 1,400/s both in and out. This is broker-wide, not per-queue. Adding 
more consumers doesn't improve throughput overall, just gives that 
particular queue a bigger slice of this apparent "pool" of resource.

Every queue is mirrored across the two nodes that make up the broker. Our 
publishers and consumers connect equally to both nodes in a persistant way. 
We notice an ADSL-like asymmetry in the rates too; if we manage to publish 
a high rate of messages the deliver rate drops to high double digits. 
Testing with an un-mirrored queue has much higher throughput, as expected. 
Queues and Exchanges are durable, messages are not persistent.

We'd like to know what we can do to improve the situation. The CPU on the 
box is fine, beam takes a core and a half for 1 process, then another 80% 
each of two cores for another couple of processes. The rest of the box is 
essentially idle. We are using ~20GB of RAM in userland with system cache 
filling the rest. IO rates are fine. Network is fine.

Is there any Erlang/OTP tuning we can do? delegate_count is the default 16, 
could someone explain what this does in a bit more detail please?

Any thoughts anyone has on this would be much appreciated.

Many thanks,

Paul Bowsher
Senior Software Engineer
Globaldev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/92795d18/attachment.htm>

From klindp at gmail.com  Wed May 22 00:02:59 2013
From: klindp at gmail.com (Kristian Lind)
Date: Tue, 21 May 2013 16:02:59 -0700 (PDT)
Subject: [rabbitmq-discuss] channel.basicCancel hangs
Message-ID: <1f44b643-c45d-4e49-9a5f-8c23c4dc8b87@googlegroups.com>

<dependency>
<groupId>com.rabbitmq</groupId>
<artifactId>amqp-client</artifactId>
<version>3.0.4</version>
</dependency>

RabbitMQ 3.0.2, Erlang R16A

I have a webpage that has a start button and a stop button. 
These to buttons should start and stop the consuming messages.

When the user presses start button the consuming starts... when the user 
presses the stop button the consuming stops
BUT.. the user cannot start the consuming again. 
While debugging the code, I see the method call channel.basicCancel 
hangs... and the debugger stops... 
When I stop the JBoss server where the application is deployd I see this 
exception coming in the catch when doing channel.basicCancel.
com.rabbitmq.client.ShutdownSignalException: clean channel shutdown; 
reason: #method<channel.close>(reply-code=200, reply-text=OK, class-id=0, 
method-id=0)

And in the method handleDelivery I see ShutdownSignalException...
com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; 
reason: Attempt to use closed channel

The call to basicCancel only hangs when consuming is going on.. if I start 
the consuming, but no messages are on the queue, I can stop it.. and start 
it again. 

@Override
protected final synchronized void service(final HttpServletRequest req, 
final HttpServletResponse resp) throws ServletException, IOException {
String task = req.getParameter("task");
        ...
if (StringUtils.isNotBlank(task) && task.equals("stop")) {
consuming = false;
try {
channel.basicCancel("MonitorConsumer");
} catch (Exception e) {
e.printStackTrace();
}
}
} else {
if (connection == null || channel == null) {
createRabbitConnection();
}
if (!consuming) {
channel.basicConsume(Configuration.QUEUE_JSI_TO_DASHBOARD, false, 
"MonitorConsumer", this);
consuming = true;
}
}
}

public synchronized void handleDelivery(String consumerTag, Envelope 
envelope, BasicProperties properties, byte[] body) throws IOException {
...
        try {
channel.basicAck(deliveryTag, false);
} catch (ShutdownSignalException e) {
e.printStackTrace();
}
}






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/a311f354/attachment.htm>

From klindp at gmail.com  Wed May 22 00:52:45 2013
From: klindp at gmail.com (Kristian Lind)
Date: Tue, 21 May 2013 16:52:45 -0700 (PDT)
Subject: [rabbitmq-discuss] channel.basicCancel hangs
In-Reply-To: <1f44b643-c45d-4e49-9a5f-8c23c4dc8b87@googlegroups.com>
References: <1f44b643-c45d-4e49-9a5f-8c23c4dc8b87@googlegroups.com>
Message-ID: <275b83e4-9954-43e9-80ab-861e26c6979b@googlegroups.com>

Updated to amqp-client 3.1.0 but still same problem.

Tried to close channel instead od basicCancel.. same problem. 



On Tuesday, May 21, 2013 4:02:59 PM UTC-7, Kristian Lind wrote:
>
> <dependency>
> <groupId>com.rabbitmq</groupId>
> <artifactId>amqp-client</artifactId>
> <version>3.0.4</version>
> </dependency>
>
> RabbitMQ 3.0.2, Erlang R16A
>
> I have a webpage that has a start button and a stop button. 
> These to buttons should start and stop the consuming messages.
>
> When the user presses start button the consuming starts... when the user 
> presses the stop button the consuming stops
> BUT.. the user cannot start the consuming again. 
> While debugging the code, I see the method call channel.basicCancel 
> hangs... and the debugger stops... 
> When I stop the JBoss server where the application is deployd I see this 
> exception coming in the catch when doing channel.basicCancel.
> com.rabbitmq.client.ShutdownSignalException: clean channel shutdown; 
> reason: #method<channel.close>(reply-code=200, reply-text=OK, class-id=0, 
> method-id=0)
>
> And in the method handleDelivery I see ShutdownSignalException...
> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; 
> reason: Attempt to use closed channel
>
> The call to basicCancel only hangs when consuming is going on.. if I 
> start the consuming, but no messages are on the queue, I can stop it.. and 
> start it again. 
>
> @Override
> protected final synchronized void service(final HttpServletRequest req, 
> final HttpServletResponse resp) throws ServletException, IOException {
> String task = req.getParameter("task");
>         ...
> if (StringUtils.isNotBlank(task) && task.equals("stop")) {
> consuming = false;
> try {
> channel.basicCancel("MonitorConsumer");
> } catch (Exception e) {
> e.printStackTrace();
> }
> }
> } else {
> if (connection == null || channel == null) {
> createRabbitConnection();
> }
> if (!consuming) {
> channel.basicConsume(Configuration.QUEUE_JSI_TO_DASHBOARD, false, 
> "MonitorConsumer", this);
> consuming = true;
> }
> }
> }
>
> public synchronized void handleDelivery(String consumerTag, Envelope 
> envelope, BasicProperties properties, byte[] body) throws IOException {
> ...
>         try {
> channel.basicAck(deliveryTag, false);
> } catch (ShutdownSignalException e) {
> e.printStackTrace();
> }
> }
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/35fa6643/attachment.htm>

From klindp at gmail.com  Wed May 22 02:19:36 2013
From: klindp at gmail.com (Kristian Lind)
Date: Tue, 21 May 2013 18:19:36 -0700 (PDT)
Subject: [rabbitmq-discuss] channel.basicCancel hangs
In-Reply-To: <275b83e4-9954-43e9-80ab-861e26c6979b@googlegroups.com>
References: <1f44b643-c45d-4e49-9a5f-8c23c4dc8b87@googlegroups.com>
	<275b83e4-9954-43e9-80ab-861e26c6979b@googlegroups.com>
Message-ID: <649af71e-95c7-452a-a524-755429215143@googlegroups.com>

I found the problem... I had a message that was not ack.. so now before 
closing the channel I ack the msg.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/291eaadb/attachment.htm>

From matthias at rabbitmq.com  Wed May 22 07:45:56 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 May 2013 07:45:56 +0100
Subject: [rabbitmq-discuss] Rabbit Persistence Store Documentation
In-Reply-To: <519BBB39.1020506@wgen.net>
References: <519BBB39.1020506@wgen.net>
Message-ID: <519C69A4.9050108@rabbitmq.com>

On 21/05/13 19:21, Adhiraj Sarpeshkar wrote:
> It took me some digging to find out that Rabbit uses a Mnesia database
> for storage and that the store for a node is located under
> /var/lib/rabbitmq/mnesia/rabbit/<node_name>.   Not that this is terribly
> important information for most people, but maybe it could be featured
> more prominently in the docs?  Or I might be blind and it's already
> there--in which case a link would be much appreciated in case I need to
> revisit this in the future.

See the setting for RABBITMQ_MNESIA_DIR in 
http://www.rabbitmq.com/relocate.html#unix, and the explanation above it...

<quote>
The directory where this RabbitMQ node's Mnesia database files are 
placed. (In addition to Mnesia files this location also contains message 
storage and index files as well as schema and cluster details.)
</quote>

So note that RabbitMQ isn't actually storing *messages* in mnesia. They 
are written to files under $RABBITMQ_MNESIA_DIR but they are not part of 
the mnesia database.

Matthias.

From simlu at su.se  Wed May 22 08:39:00 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Wed, 22 May 2013 09:39:00 +0200
Subject: [rabbitmq-discuss] F5 Load Balancer Pool Management
In-Reply-To: <20130522054737.GG292@kaka.it.su.se>
References: <0B8CD6850421B745BE39BC5C7601923271F697F0@DDCEP50015.na.corp.mckesson.com>
	<20130522054737.GG292@kaka.it.su.se>
Message-ID: <20130522073900.GI292@kaka.it.su.se>

On Wed, 2013-05-22 at 07:47:37 +0200, Simon Lundstr?m wrote:
> * Put a Nagios NRPE check on the host which does the check and use the
> BIG-IP to do a NRPE request to the node.

Oh, I forgot: I created and opensourced the Nagios NRPE check, see
<https://github.com/stockholmuniversity/nagios-plugin-check_amqp>.

Br,
- Simon

From watson.timothy at gmail.com  Wed May 22 09:38:19 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 22 May 2013 09:38:19 +0100
Subject: [rabbitmq-discuss] RDQ files filling the disk.
In-Reply-To: <1369174785991-26903.post@n5.nabble.com>
References: <1369174785991-26903.post@n5.nabble.com>
Message-ID: <6ADE8373-F46E-435C-BA32-96D47D85BB7B@rabbitmq.com>

On 21 May 2013, at 23:19, "michi.oshima" <moshima at advent.com> wrote:

> We recently had an issue where Rabbit1 started taking up a lot of disk
> space.  A directory called 'msg_store_transient' got up to some 20 GB,
> filled with files with *.rdq extension.  They are about 16MB each in size. 
> It almost filled up the disk (it's a small disk) and caused our application
> (client to Rabbit1) to fail.
> 

Rabbit will start paging transient (non-persistent) messages to disk if memory starts to get tight (i.e., close to the high watermark) and they'll end up in that file.

> Meanwhile, Rabbit2 reportedly have been receiving the messages from Rabbit1. 
> I also saw no shovel connection related errors in rabbit.log, etc.
> 
> Q1. Does this sound plausible?  If so, how could this happen?

Sounds like rabbit1 is paging due to memory pressure. Do you see a memory alarm in the logs? Even if you don't, it may be paging pre-emptively.

> Q2. I'm thinking the rdq files are meant to get deleted at some point.  What
> would cause the files to *not* get deleted?

The paged out messages will need to be delivered and acked and, at the same time, memory use will need to drop back so that eventually the broker stops paging deliberately. There are probably more specific indicators (I'm not looking at the source right now), but  first of all let's take a look at memory use on that box whilst the file is growing.

Cheers,
Tim

From sabrina.kuehn90 at web.de  Wed May 22 10:21:36 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Wed, 22 May 2013 02:21:36 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
References: <5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
	<39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
Message-ID: <1369214496452-26916.post@n5.nabble.com>

Hi after nobody understood me. I tried to realize my plan, the problem was
that my mirrornode was not in the cluster, so there was no communication
about the queue.
I changed the structure of my nodes:
<http://rabbitmq.1065348.n5.nabble.com/file/n26916/Grafic1.png> 
Now I have 4 machines which are clustered one queue with a policy for
mirroring all nodes and everything works fine.
Now I have only one more little question because of the queue. I used one of
the queues of the tutorial on the rabbitmq homepage. Is it important which I
use and when the node with the queue goes down do I have to restart the
queue?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26916.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed May 22 10:30:59 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 22 May 2013 10:30:59 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1369214496452-26916.post@n5.nabble.com>
References: <5190BC30.2030006@rabbitmq.com>
	<1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
	<39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
	<1369214496452-26916.post@n5.nabble.com>
Message-ID: <624D7A3B-508E-4971-9179-BBFF7D4F6869@rabbitmq.com>

Hi,

On 22 May 2013, at 10:21, Slyth wrote:

> Now I have 4 machines which are clustered one queue with a policy for
> mirroring all nodes and everything works fine.
> Now I have only one more little question because of the queue.
[snip]
> Is it important which I use and when the node with the queue goes down
> do I have to restart the queue?

The way mirroring works is that the queues is constantly replicated on all the nodes the policy dictates. So if you have a queue called 'foobarbaz' and the policy is set up to replicate that across all 4 nodes, then the queue will be running on all 4 nodes all the time. The HA system will decide that one of the nodes will host the 'master' version of the queue. The actual processing (i.e., enqueue and dequeue operations) will take place on the master - i.e., all messages will be routed to/from this node, regardless of which node(s) clients connect to - and the master will remain synchronised with the other (slave) nodes in real time. If the node where the master for that queue is running dies, one of the slaves will be promoted to become the new master and everything will continue running as normal.

Cheers,
Tim 

From sabrina.kuehn90 at web.de  Wed May 22 10:36:32 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Wed, 22 May 2013 02:36:32 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1369214496452-26916.post@n5.nabble.com>
References: <1368440625413-26613.post@n5.nabble.com>
	<5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
	<39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
	<1369214496452-26916.post@n5.nabble.com>
Message-ID: <1369215392532-26918.post@n5.nabble.com>

Certainly I take not the easiest or best way but I want to explain it to you,
perhaps you have a better solution for me.
I used the work queue
http://www.rabbitmq.com/tutorials/tutorial-two-python.html
I created on all four machines the new_task.py and the worker.py and I have
to start manual the worker.py on all machines. Without doing that the
information can't be mirrored on another one when the node with them goes
down. Yes I know that's logical but how can I automate this process
especially when a node goes down and my queue has to start up on another
node?






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26918.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed May 22 10:44:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 May 2013 10:44:54 +0100
Subject: [rabbitmq-discuss] Recovering a busted instance
In-Reply-To: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>
References: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>
Message-ID: <519C9396.20904@rabbitmq.com>

Hi Fran?ois.

The stack trace you're seeing is consistent with ones we've seen before 
after something causes a bunch of extra zeroes to be written to the end 
of the queue index.

Currently we're not absolutely sure what causes this but suspect the OS 
not completing a write during shutdown.

The good news is that we have a fix for reading queue indices in this 
state. The bad news is that it can't go into the 3.1.x series since it 
requires a change to the on disc format for the queue index.

However, this fix now is in the nightly releases (and will be in 3.2.0 
eventually). So I think you should be able to get a nightly build to 
boot with that data store. I'd take a backup first though :-) Once you 
do, you won't be able to go back to 3.1.x, but you should be able to get 
messages out to a 3.1.x broker with the shovel.

Hope this helps.

Cheers, Simon

On 21/05/13 18:25, Fran?ois Beausoleil wrote:
> I have an instance which I tried upgrading from 3.0.2 to 3.1.0.
> Something broke during the upgrade and I booted a fresh new instance
> and connected my clients to it.
>
> Now, I have valuable data in the 3.0.2 instance which I'd like to
> retrieve. If I could boot the instance, I'd shovel the data to the
> 3.1.0 instance.
>
> I have attached the log files from the crashing instance.
>
> Is there anything I can do to recuperate those messages?
>
> Thanks, Fran?ois Beausoleil
>
>
>
>
>
>
>
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From sabrina.kuehn90 at web.de  Wed May 22 10:50:27 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Wed, 22 May 2013 02:50:27 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1369215392532-26918.post@n5.nabble.com>
References: <5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
	<39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
	<1369214496452-26916.post@n5.nabble.com>
	<1369215392532-26918.post@n5.nabble.com>
Message-ID: <1369216227201-26920.post@n5.nabble.com>

I think the solution is not so dificult  perhaps a not permanently queue
which will be deleted and created when the node goes down and anothe one
take it's place.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26920.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed May 22 10:47:41 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 22 May 2013 10:47:41 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1369216227201-26920.post@n5.nabble.com>
References: <5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
	<39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
	<1369214496452-26916.post@n5.nabble.com>
	<1369215392532-26918.post@n5.nabble.com>
	<1369216227201-26920.post@n5.nabble.com>
Message-ID: <519C943D.2030705@rabbitmq.com>

On 05/22/2013 10:50 AM, Slyth wrote:
> I think the solution is not so dificult  perhaps a not permanently queue
> which will be deleted and created when the node goes down and anothe one
> take it's place.
>

I'm confused again. Can you please come onto the #rabbitmq IRC channel 
in freenode to discuss this further, as our conversation isn't very well 
suited to the mailing list at this point.

Cheers,
Tim

From tim at rabbitmq.com  Wed May 22 10:48:25 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 22 May 2013 10:48:25 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <519C943D.2030705@rabbitmq.com>
References: <5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
	<39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
	<1369214496452-26916.post@n5.nabble.com>
	<1369215392532-26918.post@n5.nabble.com>
	<1369216227201-26920.post@n5.nabble.com>
	<519C943D.2030705@rabbitmq.com>
Message-ID: <519C9469.1050904@rabbitmq.com>

PS: I'm "hyperthunk" on freenode.

Ta

On 05/22/2013 10:47 AM, Tim Watson wrote:
> On 05/22/2013 10:50 AM, Slyth wrote:
>> I think the solution is not so dificult  perhaps a not permanently queue
>> which will be deleted and created when the node goes down and anothe one
>> take it's place.
>>
>
> I'm confused again. Can you please come onto the #rabbitmq IRC channel 
> in freenode to discuss this further, as our conversation isn't very 
> well suited to the mailing list at this point.
>
> Cheers,
> Tim


From simon at rabbitmq.com  Wed May 22 10:56:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 May 2013 10:56:25 +0100
Subject: [rabbitmq-discuss] RDQ files filling the disk.
In-Reply-To: <6ADE8373-F46E-435C-BA32-96D47D85BB7B@rabbitmq.com>
References: <1369174785991-26903.post@n5.nabble.com>
	<6ADE8373-F46E-435C-BA32-96D47D85BB7B@rabbitmq.com>
Message-ID: <519C9649.1000404@rabbitmq.com>

On 22/05/13 09:38, Tim Watson wrote:
>>> Meanwhile, Rabbit2 reportedly have been receiving the messages
>>> from Rabbit1. I also saw no shovel connection related errors in
>>> rabbit.log, etc.
>>>
>>> Q1. Does this sound plausible?  If so, how could this happen?
> Sounds like rabbit1 is paging due to memory pressure. Do you see a
> memory alarm in the logs? Even if you don't, it may be paging
> pre-emptively.

The memory alarm is a bit of a red herring - the idea of preemptive 
paging is to prevent the memory alarm going off!

>>> Q2. I'm thinking the rdq files are meant to get deleted at some
>>> point.  What would cause the files to*not*  get deleted?
> The paged out messages will need to be delivered and acked and, at
> the same time, memory use will need to drop back so that eventually
> the broker stops paging deliberately.

Again, don't really look at memory use, but just look at the total 
number of messages in the broker...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sabrina.kuehn90 at web.de  Wed May 22 11:01:45 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Wed, 22 May 2013 03:01:45 -0700 (PDT)
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <624D7A3B-508E-4971-9179-BBFF7D4F6869@rabbitmq.com>
References: <5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
	<39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
	<1369214496452-26916.post@n5.nabble.com>
	<624D7A3B-508E-4971-9179-BBFF7D4F6869@rabbitmq.com>
Message-ID: <1369216905624-26924.post@n5.nabble.com>

But that's my problem when the node dies the consumers stop listening (my
receive scripts stop and) the web UI says consumers 0. For me means that,
that the queue is stop working.


Is that the right way that I wrote scripts and start them manualy to create
the queue and get consumers?

I wrote you that I do't know so much about that topic, perhaps you can say
me how the queue has to look like.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26924.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed May 22 10:57:49 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 22 May 2013 10:57:49 +0100
Subject: [rabbitmq-discuss] RDQ files filling the disk.
In-Reply-To: <519C9649.1000404@rabbitmq.com>
References: <1369174785991-26903.post@n5.nabble.com>
	<6ADE8373-F46E-435C-BA32-96D47D85BB7B@rabbitmq.com>
	<519C9649.1000404@rabbitmq.com>
Message-ID: <519C969D.5040102@rabbitmq.com>

On 05/22/2013 10:56 AM, Simon MacMullen wrote:
> On 22/05/13 09:38, Tim Watson wrote:
>>>> Meanwhile, Rabbit2 reportedly have been receiving the messages
>>>> from Rabbit1. I also saw no shovel connection related errors in
>>>> rabbit.log, etc.
>>>>
>>>> Q1. Does this sound plausible?  If so, how could this happen?
>> Sounds like rabbit1 is paging due to memory pressure. Do you see a
>> memory alarm in the logs? Even if you don't, it may be paging
>> pre-emptively.
>
> The memory alarm is a bit of a red herring - the idea of preemptive 
> paging is to prevent the memory alarm going off!
>

Good point - I wasn't thinking about that in quite the right terms there.

>>>> Q2. I'm thinking the rdq files are meant to get deleted at some
>>>> point.  What would cause the files to*not*  get deleted?
>> The paged out messages will need to be delivered and acked and, at
>> the same time, memory use will need to drop back so that eventually
>> the broker stops paging deliberately.
>
> Again, don't really look at memory use, but just look at the total 
> number of messages in the broker...
>
>

Makes sense. So once the # messages starts to drop, you'd expect the 
broker to stop paging and eventually (if everything fits nicely into 
memory) that file was become obsolete and get removed.

Cheers,
Tim


From tim at rabbitmq.com  Wed May 22 10:59:10 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 22 May 2013 10:59:10 +0100
Subject: [rabbitmq-discuss] create a policy for concrete nodes
In-Reply-To: <1369216905624-26924.post@n5.nabble.com>
References: <5190D3FF.9040005@rabbitmq.com>
	<1368448262051-26620.post@n5.nabble.com>
	<51924A93.3090901@rabbitmq.com>
	<1368781892415-26796.post@n5.nabble.com>
	<F3EAFA9D-B35C-445A-A2E6-74F84D896028@rabbitmq.com>
	<1368789056843-26798.post@n5.nabble.com>
	<1368795142708-26800.post@n5.nabble.com>
	<39996A0B-30A3-4739-950F-09A5DA29D077@rabbitmq.com>
	<1369214496452-26916.post@n5.nabble.com>
	<624D7A3B-508E-4971-9179-BBFF7D4F6869@rabbitmq.com>
	<1369216905624-26924.post@n5.nabble.com>
Message-ID: <519C96EE.9040108@rabbitmq.com>

Sabrina - come on IRC pls. I don't want to continue this discussion on 
the mailing list - it's taking too long to explain everything in emails.

Thanks

Tim


On 05/22/2013 11:01 AM, Slyth wrote:
> But that's my problem when the node dies the consumers stop listening (my
> receive scripts stop and) the web UI says consumers 0. For me means that,
> that the queue is stop working.
>
>
> Is that the right way that I wrote scripts and start them manualy to create
> the queue and get consumers?
>
> I wrote you that I do't know so much about that topic, perhaps you can say
> me how the queue has to look like.
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/create-a-policy-for-concrete-nodes-tp26611p26924.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Wed May 22 11:32:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 May 2013 11:32:49 +0100
Subject: [rabbitmq-discuss] Mirrored queue performance factors
In-Reply-To: <617811bf-68d9-4f86-94e4-8b411086031e@googlegroups.com>
References: <617811bf-68d9-4f86-94e4-8b411086031e@googlegroups.com>
Message-ID: <519C9ED1.7060301@rabbitmq.com>

On 21/05/13 20:12, Paul Bowsher wrote:
> Hi,

Hi.

> We operate two dual-node brokers, each broker having quite different
> queues and workloads. Each box has 24 cores (H/T) worth of Xeon E5645 @
> 2.4GHz with 48GB RAM, connected by Gigabit LAN with ~150?s latency,
> running RHEL 5.6, RabbitMQ 3.1, Erlang R16B with HiPE off. We've tried
> with HiPE on but it made no noticeable performance impact, and was very
> crashy.
>
> We appear to have hit a ceiling for our message rates of between 1,000/s
> and 1,400/s both in and out. This is broker-wide, not per-queue. Adding
> more consumers doesn't improve throughput overall, just gives that
> particular queue a bigger slice of this apparent "pool" of resource.
>
> Every queue is mirrored across the two nodes that make up the broker.
> Our publishers and consumers connect equally to both nodes in a
> persistant way. We notice an ADSL-like asymmetry in the rates too; if we
> manage to publish a high rate of messages the deliver rate drops to high
> double digits. Testing with an un-mirrored queue has much higher
> throughput, as expected. Queues and Exchanges are durable, messages are
> not persistent.

Just to check - how much faster is your unmirrored throughput?

But those performance figures sound wrong, I can go much faster than 
that on a less powerful machine.

How large are messages? Are you using acks / confirms?

Our Java client ships with a performance measuring tool. It would be 
good to test with that so that we are running the same tests. Can you 
grab the Java client tarball, unpack it and run:

$ ./runjava.sh com.rabbitmq.examples.MulticastMain -a -h 
amqp://<server-name>

and tell us what message rates you get? That command line should use 
tiny unpersistent / unacked / unconfimed messages, so it should give us 
a baseline to work with.

If not all queues are configured to be mirrored you might need to add 
"-u <name of a queue to create that will be mirrored>".

> Is there any Erlang/OTP tuning we can do? delegate_count is the default
> 16, could someone explain what this does in a bit more detail please?

delegate_count is not itself used by mirroring; it (approximately) 
provides an upper bound on the parallelism available for cross-cluster 
channel -> queue message routing. It's pretty rare to want to change it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Wed May 22 12:28:55 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 May 2013 12:28:55 +0100
Subject: [rabbitmq-discuss] STOMP incompatibility upgrading 2.7 to 3.1:
 escaping colons in header values
In-Reply-To: <CABZkbxiS=ptT5mWV8KjRW6jfj83R2i-Uy+WBy7AGj0Y=4QDc5g@mail.gmail.com>
References: <CABZkbxiS=ptT5mWV8KjRW6jfj83R2i-Uy+WBy7AGj0Y=4QDc5g@mail.gmail.com>
Message-ID: <519CABF7.2080202@rabbitmq.com>

Kevin,

On 22/05/13 01:41, Kevin Goess wrote:
> STOMP 1.0 allowed colons in header values, e.g.
>
> bp_timestamp:2013-05-21T16:00:21-07:00

...whereas the STOMP 1.1 spec explicitly forbids that.

> But this commit a couple months ago disallowed them in any stomp
> frame:
> https://github.com/rabbitmq/rabbitmq-stomp/commit/4c20ec31d3de9129faeb97a5d95a9e74438bdc00
>
>  That seems like a mistake to me, but either way I'm calling it out
> here in case anybody else is travelling down the same road.

We use a single parser to parse all versions of STOMP. We don't want to 
start parameterising the parser with the STOMP version - way too much 
complexity and hassle. So the question is whether we could construct a 
lenient parser that accepts unescaped colons in header values across all 
STOMP versions w/o introducing any breakages. I have filed a bug to look 
into that.

Regards,

Matthias.

From tim at rabbitmq.com  Wed May 22 13:51:21 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 22 May 2013 13:51:21 +0100
Subject: [rabbitmq-discuss] Someone else with a nodedown error
In-Reply-To: <CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
References: <CAL8idP2SeGhRvTiMk14Btx-RgyjmunQ8A963WxwmtieMvL+sYg@mail.gmail.com>
	<9C50D264-1E02-4997-982B-FFE42C4F927F@rabbitmq.com>
	<CACeek7FdaxzLoT365RhM=c8S_29023NGp_BN+9ZgBoPuNzm3Gg@mail.gmail.com>
Message-ID: <519CBF49.50606@rabbitmq.com>

Hi Eric,

On 05/16/2013 08:09 PM, Eric Berg wrote:
> Thanks for the insight Tim. I ended up killing the the process before 
> receiving your email so I was unable to take advantage of your pro 
> tips. We subsequently upgraded our cluster to 3.1.0 on Erlang R15B03, 
> and have run into a slightly different problem. This appears to be 
> unrelated, but I did use your tips to gather as much information as 
> possible.
>
Just to confirm - you did not see this error before upgrading, nor the 
previous error since?

Cheers,
Tim

From Chris.Nicel at 15below.com  Wed May 22 14:41:28 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Wed, 22 May 2013 08:41:28 -0500
Subject: [rabbitmq-discuss] Mirrored queue policies not applying.
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C88318DA9D56@AUSP01VMBX29.collaborationhost.net>

Hi All,

I am having trouble with some mirrored queue policies.

The set-up is a simple two node cluster. I am attempting to mirror the queues which currently exist on both nodes. I'd like to use the ha-mode exactly so I can add further nodes as performance requires later down the line.

This is the policy as shown in the admin web interface.

Virtual Host

Name

Pattern

Definition

Priority

zp

zp HA<http://rabbitmq.zorrillo.aws:15672/#/policies/zorrillo.platform/Zorrillo%20HA>

"*"

ha-mode:

exactly

ha-params:

2

ha-sync-mode:

automatic


0


But the queues are not showing as using the policy on the queues screen.

Overview

Messages

Message rates

Virtual host

Name

Node

Exclusive

Parameters

Policy

Status

Ready

Unacked

Total

incoming

deliver / get

ack

zp

control.mediator:control.commands/f907b124<http://rabbitmq.zorrillo.aws:15672/#/queues/zorrillo.platform/control.mediator%3Acontrol.commands%2Ff907b124>

rabbit at rabbitmq2

Owner<http://rabbitmq.zorrillo.aws:15672/#/connections/10.0.1.15%3A59042%20-%3E%2010.0.1.11%3A5672>

AD

Idle

0.00/s

0.00/s

zp

control.mediator:control.requests/f907b124<http://rabbitmq.zorrillo.aws:15672/#/queues/zorrillo.platform/control.mediator%3Acontrol.requests%2Ff907b124>

rabbit at rabbitmq2

Owner<http://rabbitmq.zorrillo.aws:15672/#/connections/10.0.1.15%3A59042%20-%3E%2010.0.1.11%3A5672>

AD

Idle

0.00/s

0.00/s


As I understand it, the ha policies can be changed and queues will update themselves accordingly. So in principle what I am attempting feels right...

Does anyone have any ideas where I may be going wrong?

Cheers

Chris Nicel
Senior Systems Engineer
15below ltd : 15below Australia pty. ltd.

t:        +44 1273 764230
e:       chris.nicel at 15below.com<mailto:chris.nicel at 15below.com>
w:      15below.com<http://www.15below.com/>
[cid:image001.png at 01CE56FA.716D8A20]       @15below_travel<https://twitter.com/#!/15below_travel>


15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130522/65734f71/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 808 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130522/65734f71/attachment.png>

From simon at rabbitmq.com  Wed May 22 14:52:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 May 2013 14:52:53 +0100
Subject: [rabbitmq-discuss] Mirrored queue policies not applying.
In-Reply-To: <A57B6B00637AF741A9FA2D006B40C3C88318DA9D56@AUSP01VMBX29.collaborationhost.net>
References: <A57B6B00637AF741A9FA2D006B40C3C88318DA9D56@AUSP01VMBX29.collaborationhost.net>
Message-ID: <519CCDB5.9060602@rabbitmq.com>

The pattern needs to be a regular expression that will match queue 
names. Your pattern appears to be "*" (including quotes). That won't 
match anything. If you want to match all queues, use .* (without quotes).

Cheers, Simon

On 22/05/13 14:41, Chris Nicel wrote:
> Hi All,
>
> I am having trouble with some mirrored queue policies.
>
> The set-up is a simple two node cluster. I am attempting to mirror the
> queues which currently exist on both nodes. I?d like to use the ha-mode
> exactly so I can add further nodes as performance requires later down
> the line.
>
> This is the policy as shown in the admin web interface.
>
> *Virtual Host***
>
> 	
>
> *Name***
>
> 	
>
> *Pattern***
>
> 	
>
> *Definition***
>
> 	
>
> *Priority***
>
> zp
>
> 	
>
> zp HA
> <http://rabbitmq.zorrillo.aws:15672/#/policies/zorrillo.platform/Zorrillo%20HA>
>
> 	
>
> "*"
>
> 	
>
> *ha-mode:***
>
> 	
>
> exactly
>
> *ha-params:***
>
> 	
>
> 2
>
> *ha-sync-mode:***
>
> 	
>
> automatic
>
> 	
>
> 0
>
> But the queues are not showing as using the policy on the queues screen.
>
> *Overview***
>
> 	
>
> *Messages***
>
> 	
>
> *Message rates***
>
> *Virtual host***
>
> 	
>
> *Name***
>
> 	
>
> *Node***
>
> 	
>
> *Exclusive***
>
> 	
>
> *Parameters***
>
> 	
>
> *Policy***
>
> 	
>
> *Status***
>
> 	
>
> *Ready***
>
> 	
>
> *Unacked***
>
> 	
>
> *Total***
>
> 	
>
> *incoming***
>
> 	
>
> *deliver / get * **
>
> 	
>
> *ack***
>
> zp
>
> 	
>
> control.mediator:control.commands/f907b124
> <http://rabbitmq.zorrillo.aws:15672/#/queues/zorrillo.platform/control.mediator%3Acontrol.commands%2Ff907b124>
>
> 	
>
> rabbit at rabbitmq2
>
> 	
>
> Owner
> <http://rabbitmq.zorrillo.aws:15672/#/connections/10.0.1.15%3A59042%20-%3E%2010.0.1.11%3A5672>
>
>
> 	
>
> AD
>
> 		
>
> Idle
>
> 				
>
> 0.00/s
>
> 	
>
> 0.00/s
>
> 	
>
> zp
>
> 	
>
> control.mediator:control.requests/f907b124
> <http://rabbitmq.zorrillo.aws:15672/#/queues/zorrillo.platform/control.mediator%3Acontrol.requests%2Ff907b124>
>
> 	
>
> rabbit at rabbitmq2
>
> 	
>
> Owner
> <http://rabbitmq.zorrillo.aws:15672/#/connections/10.0.1.15%3A59042%20-%3E%2010.0.1.11%3A5672>
>
>
> 	
>
> AD
>
> 		
>
> Idle
>
> 				
>
> 0.00/s
>
> 	
>
> 0.00/s
>
> 	
>
> As I understand it, the ha policies can be changed and queues will
> update themselves accordingly. So in principle what I am attempting
> feels right?
>
> Does anyone have any ideas where I may be going wrong?
>
> Cheers
>
> *Chris Nicel*
>
> Senior Systems Engineer
>
> 15below ltd : 15below Australia pty. ltd.
>
> *t:***+44 1273 764230
>
> *e*: chris.nicel at 15below.com <mailto:chris.nicel at 15below.com>
> *w:*15below.com <http://www.15below.com/>
>
> *@15below_travel <https://twitter.com/#!/15below_travel>
>
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
> United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379
> Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
> This email and any attachments may be confidential and/or legally
> privileged and are solely for the use of the intended recipient. If you
> have received this email in error please contact the sender. Any views
> or opinions expressed within this e-mail are solely those of the sender,
> and do not necessarily represent those of 15below unless otherwise
> specifically stated. Although 15below has taken every reasonable
> precaution to ensure that any attachment to this e-mail has been checked
> for viruses, it is strongly recommended that you carry out your own
> virus check before opening any attachment, as we cannot accept liability
> for any damage sustained as a result of software virus infection.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From Chris.Nicel at 15below.com  Wed May 22 15:01:22 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Wed, 22 May 2013 09:01:22 -0500
Subject: [rabbitmq-discuss] Mirrored queue policies not applying.
In-Reply-To: <519CCDB5.9060602@rabbitmq.com>
References: <A57B6B00637AF741A9FA2D006B40C3C88318DA9D56@AUSP01VMBX29.collaborationhost.net>
	<519CCDB5.9060602@rabbitmq.com>
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C88318DA9D9B@AUSP01VMBX29.collaborationhost.net>

Thanks Simon. That's fixed it...

I was attempting to solve a problem with regular expressions and found myself with two problems...

Cheers

Chris

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 22 May 2013 14:53
To: Discussions about RabbitMQ
Cc: Chris Nicel
Subject: Re: [rabbitmq-discuss] Mirrored queue policies not applying.

The pattern needs to be a regular expression that will match queue names. Your pattern appears to be "*" (including quotes). That won't match anything. If you want to match all queues, use .* (without quotes).

Cheers, Simon

On 22/05/13 14:41, Chris Nicel wrote:
> Hi All,
>
> I am having trouble with some mirrored queue policies.
>
> The set-up is a simple two node cluster. I am attempting to mirror the
> queues which currently exist on both nodes. I'd like to use the
> ha-mode exactly so I can add further nodes as performance requires
> later down the line.
>
> This is the policy as shown in the admin web interface.
>
> *Virtual Host***
>
>
>
> *Name***
>
>
>
> *Pattern***
>
>
>
> *Definition***
>
>
>
> *Priority***
>
> zp
>
>
>
> zp HA
> <http://rabbitmq.zorrillo.aws:15672/#/policies/zorrillo.platform/Zorri
> llo%20HA>
>
>
>
> "*"
>
>
>
> *ha-mode:***
>
>
>
> exactly
>
> *ha-params:***
>
>
>
> 2
>
> *ha-sync-mode:***
>
>
>
> automatic
>
>
>
> 0
>
> But the queues are not showing as using the policy on the queues screen.
>
> *Overview***
>
>
>
> *Messages***
>
>
>
> *Message rates***
>
> *Virtual host***
>
>
>
> *Name***
>
>
>
> *Node***
>
>
>
> *Exclusive***
>
>
>
> *Parameters***
>
>
>
> *Policy***
>
>
>
> *Status***
>
>
>
> *Ready***
>
>
>
> *Unacked***
>
>
>
> *Total***
>
>
>
> *incoming***
>
>
>
> *deliver / get * **
>
>
>
> *ack***
>
> zp
>
>
>
> control.mediator:control.commands/f907b124
> <http://rabbitmq.zorrillo.aws:15672/#/queues/zorrillo.platform/control
> .mediator%3Acontrol.commands%2Ff907b124>
>
>
>
> rabbit at rabbitmq2
>
>
>
> Owner
> <http://rabbitmq.zorrillo.aws:15672/#/connections/10.0.1.15%3A59042%20
> -%3E%2010.0.1.11%3A5672>
>
>
>
>
> AD
>
>
>
> Idle
>
>
>
> 0.00/s
>
>
>
> 0.00/s
>
>
>
> zp
>
>
>
> control.mediator:control.requests/f907b124
> <http://rabbitmq.zorrillo.aws:15672/#/queues/zorrillo.platform/control
> .mediator%3Acontrol.requests%2Ff907b124>
>
>
>
> rabbit at rabbitmq2
>
>
>
> Owner
> <http://rabbitmq.zorrillo.aws:15672/#/connections/10.0.1.15%3A59042%20
> -%3E%2010.0.1.11%3A5672>
>
>
>
>
> AD
>
>
>
> Idle
>
>
>
> 0.00/s
>
>
>
> 0.00/s
>
>
>
> As I understand it, the ha policies can be changed and queues will
> update themselves accordingly. So in principle what I am attempting
> feels right...
>
> Does anyone have any ideas where I may be going wrong?
>
> Cheers
>
> *Chris Nicel*
>
> Senior Systems Engineer
>
> 15below ltd : 15below Australia pty. ltd.
>
> *t:***+44 1273 764230
>
> *e*: chris.nicel at 15below.com <mailto:chris.nicel at 15below.com>
> *w:*15below.com <http://www.15below.com/>
>
> *@15below_travel <https://twitter.com/#!/15below_travel>
>
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
> United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120
> Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> **********************************************************************
> ** This email and any attachments may be confidential and/or legally
> privileged and are solely for the use of the intended recipient. If
> you have received this email in error please contact the sender. Any
> views or opinions expressed within this e-mail are solely those of the
> sender, and do not necessarily represent those of 15below unless
> otherwise specifically stated. Although 15below has taken every
> reasonable precaution to ensure that any attachment to this e-mail has
> been checked for viruses, it is strongly recommended that you carry
> out your own virus check before opening any attachment, as we cannot
> accept liability for any damage sustained as a result of software virus infection.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From matthias at rabbitmq.com  Wed May 22 15:14:18 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 May 2013 15:14:18 +0100
Subject: [rabbitmq-discuss] FW:  Rabbit Persistence Store Documentation
In-Reply-To: <9854296E08934B4180E1B980C0F1B66A8F33D0@WGEXCH06.wgenhq.net>
References: <519BBB39.1020506@wgen.net> <519C69A4.9050108@rabbitmq.com>,
	<519CCA06.5020305@wgen.net>
	<9854296E08934B4180E1B980C0F1B66A8F33D0@WGEXCH06.wgenhq.net>
Message-ID: <519CD2BA.2060005@rabbitmq.com>

On 22/05/13 15:08, Adhiraj Sarpeshkar wrote:
> I take it the actual message stores are under msg_store_transient and
> msg_store_persistent?   Is that documented somewhere as well (as well as
> when each store is used)?  If not, is it worthwhile to add a note
> somewhere explaining this?

This is getting quite deeply into the internals of RabbitMQ. When would 
this information would be useful to a rabbit user?

Matthias.

From asarpeshkar at wgen.net  Wed May 22 15:22:38 2013
From: asarpeshkar at wgen.net (Adhiraj Sarpeshkar)
Date: Wed, 22 May 2013 10:22:38 -0400
Subject: [rabbitmq-discuss] FW:  Rabbit Persistence Store Documentation
In-Reply-To: <519CD2BA.2060005@rabbitmq.com>
References: <519BBB39.1020506@wgen.net> <519C69A4.9050108@rabbitmq.com>,
	<519CCA06.5020305@wgen.net>
	<9854296E08934B4180E1B980C0F1B66A8F33D0@WGEXCH06.wgenhq.net>
	<519CD2BA.2060005@rabbitmq.com>
Message-ID: <519CD4AE.7010401@wgen.net>

In my case it was relevant to an internal security review we conducted 
(i.e setting file permissions on persisted data appropriately).  Whether 
the requirement was reasonable is another question.

On 05/22/2013 10:14 AM, Matthias Radestock wrote:
> On 22/05/13 15:08, Adhiraj Sarpeshkar wrote:
>> I take it the actual message stores are under msg_store_transient and
>> msg_store_persistent?   Is that documented somewhere as well (as well as
>> when each store is used)?  If not, is it worthwhile to add a note
>> somewhere explaining this?
>
> This is getting quite deeply into the internals of RabbitMQ. When 
> would this information would be useful to a rabbit user?
>
> Matthias.


From asarpeshkar at amplify.com  Wed May 22 15:08:55 2013
From: asarpeshkar at amplify.com (Adhiraj Sarpeshkar)
Date: Wed, 22 May 2013 14:08:55 +0000
Subject: [rabbitmq-discuss] FW:  Rabbit Persistence Store Documentation
In-Reply-To: <519CCA06.5020305@wgen.net>
References: <519BBB39.1020506@wgen.net>
	<519C69A4.9050108@rabbitmq.com>,<519CCA06.5020305@wgen.net>
Message-ID: <9854296E08934B4180E1B980C0F1B66A8F33D0@WGEXCH06.wgenhq.net>

I take it the actual message stores are under msg_store_transient and
msg_store_persistent?   Is that documented somewhere as well (as well as
when each store is used)?  If not, is it worthwhile to add a note
somewhere explaining this?

On 05/22/2013 02:45 AM, Matthias Radestock wrote:
> On 21/05/13 19:21, Adhiraj Sarpeshkar wrote:
>> It took me some digging to find out that Rabbit uses a Mnesia database
>> for storage and that the store for a node is located under
>> /var/lib/rabbitmq/mnesia/rabbit/<node_name>.   Not that this is terribly
>> important information for most people, but maybe it could be featured
>> more prominently in the docs?  Or I might be blind and it's already
>> there--in which case a link would be much appreciated in case I need to
>> revisit this in the future.
>
> See the setting for RABBITMQ_MNESIA_DIR in
> http://www.rabbitmq.com/relocate.html#unix, and the explanation above
> it...
>
> <quote>
> The directory where this RabbitMQ node's Mnesia database files are
> placed. (In addition to Mnesia files this location also contains
> message storage and index files as well as schema and cluster details.)
> </quote>
>
> So note that RabbitMQ isn't actually storing *messages* in mnesia.
> They are written to files under $RABBITMQ_MNESIA_DIR but they are not
> part of the mnesia database.
>
> Matthias.


From steve at rabbitmq.com  Wed May 22 15:42:22 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 22 May 2013 15:42:22 +0100
Subject: [rabbitmq-discuss] channel.basicCancel hangs
In-Reply-To: <649af71e-95c7-452a-a524-755429215143@googlegroups.com>
References: <1f44b643-c45d-4e49-9a5f-8c23c4dc8b87@googlegroups.com>
	<275b83e4-9954-43e9-80ab-861e26c6979b@googlegroups.com>
	<649af71e-95c7-452a-a524-755429215143@googlegroups.com>
Message-ID: <EB8A601A-0395-4162-B442-FF9A4CF00AFC@rabbitmq.com>

Hi Kristian,

This behaviour seems incorrect: you should not block forever waiting for
the Basic.CancelOk reply to come back. There could be a number of
reasons for this but you *shouldn't* have to acknowledge all messages
before being able to cancel a consumer.

I wonder if the consumer is executing other channel methods in its
callbacks? Possibly Ack, which should be ok; possibly other methods.

It is entirely possible for consumer callbacks
(handleDelivery/handleCancel/handleCancelOK etc.) to be called *after*
you have called the basicCancel() method.

There are two reasons for this -- one is that the communications with the
server are asynchronous: deliveries might continue to be made after
sending the Cancel frame and before getting the CancelOk reply.

The other reason is that requests to call the callbacks are queued, and
executed on their own thread in sequence for each channel. A number of
callbacks may be queued when the basicCancel() method is called. They
may not have finished executing even when the reply to the basic.cancel
is received (Basic.CancelOk). Only when the reply is received is the
call to handleCancelOk() put on the queue for execution, so that it is
the last callback to be executed.

For these reasons, you shouldn't consider the Consumer to be stopped
properly until the last callback (handleCancelOk() or handleCancel())
has been called.

If one of the callbacks being processed makes a blocking call, even this
shouldn't block the reply unless it blocks the channel somehow. So what
could? I don't know, unless you are issuing a channel.close() or
something in your consumer callback methods. There could be a bug here
we ought to know about.

If you have a stack dump at the point of the hang (jstack is probably
the easiest way to get this) we should be able to tell what the other
threads are doing, and then get a clue as to why you are blocked. The
main thread that is hung is likely to be uninteresting -- it is probably
waiting for the Basic.CancelOk frame to be received (on a getReply()
call).

So please could you tell us a little more about your application? In
particular, what is your Consumer like? Are the handleDelivery()
callbacks doing some unusual work with the channel, for instance?
Anything that would help us get to the bottom of this would be useful.

Steve Powell  [Cell: +44-7815-838-558]
Links: Pivotal, SpringSource, VMware, Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, aesthetic;
   is understandable, unobtrusive, honest;
   is long-lasting, thorough, environmentally friendly;
   and is as little design as possible.
Copyright Dieter Rams, amended March 2003; October 2009; and August 2012

On 22 May 2013, at 02:19, Kristian Lind <klindp at gmail.com> wrote:

> I found the problem... I had a message that was not ack.. so now before closing the channel I ack the msg._______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130522/0e66de5e/attachment.htm>

From francois at seevibes.com  Wed May 22 15:57:27 2013
From: francois at seevibes.com (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Wed, 22 May 2013 10:57:27 -0400
Subject: [rabbitmq-discuss] Recovering a busted instance
In-Reply-To: <519C9396.20904@rabbitmq.com>
References: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>
	<519C9396.20904@rabbitmq.com>
Message-ID: <C118B33D-010E-43CF-B7A0-8CD62CA20D65@seevibes.com>

Simon,

Le 2013-05-22 ? 05:44, Simon MacMullen a ?crit :

> However, this fix now is in the nightly releases (and will be in 3.2.0 eventually). So I think you should be able to get a nightly build to boot with that data store. I'd take a backup first though :-) Once you do, you won't be able to go back to 3.1.x, but you should be able to get messages out to a 3.1.x broker with the shovel.

You mean I should grab the latest from:

http://www.rabbitmq.com/nightlies/rabbitmq-server/current/

That still says "3.1.1".

Thanks,
Fran?ois


From simon at rabbitmq.com  Wed May 22 16:05:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 May 2013 16:05:00 +0100
Subject: [rabbitmq-discuss] Recovering a busted instance
In-Reply-To: <C118B33D-010E-43CF-B7A0-8CD62CA20D65@seevibes.com>
References: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>
	<519C9396.20904@rabbitmq.com>
	<C118B33D-010E-43CF-B7A0-8CD62CA20D65@seevibes.com>
Message-ID: <519CDE9C.50409@rabbitmq.com>

On 22/05/13 15:57, Fran?ois Beausoleil wrote:
> You mean I should grab the latest from:
>
> http://www.rabbitmq.com/nightlies/rabbitmq-server/current/

Yes.

> That still says "3.1.1".

Well, we make the nightly version number out of (last released 
version).(serial number) so the current nightly build is 3.1.1.40522. 
But that doesn't make it part of the 3.1.x. series. Yeah, maybe we 
should change this. Hmm.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From n16483 at cray.com  Wed May 22 16:22:47 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Wed, 22 May 2013 10:22:47 -0500
Subject: [rabbitmq-discuss] Error trying to configure
	rabbit_auth_backend_ldap
Message-ID: <519CE2C7.2020901@cray.com>

I am trying to configure rabbit_auth_backend_ldap as a backing auth for 
passwordless login using rabbitmq_auth_mechanism_ssl, but I am getting 
the following error. I've also included my rabbitmq.config file for 
reference.

Any help would be appreciated.
Thanks,
Eric

Logfile:

=ERROR REPORT==== 22-May-2013::09:32:37 ===
** Generic server rabbit_auth_backend_ldap terminating
** Last message in was {login,<<"O=client,CN=ecozzi-01">>}
** When Server state == {state,
                          ["192.168.252.5"],
                          
"cn=${username},ou=msgbus,dc=cray,dc=com",none,none,
                          as_user,
                          {in_group,
                           "ou=${vhost}-users,ou=vhosts,dc=cray,dc=com"},
                          {for,
                           [{permission,configure,
                             {in_group,"cn=admin,dc=cray,dc=com"}},
                            {permission,write,
                             {for,
                              [{resource,queue,
                                {in_group,"cn=admin,dc=cray,dc=com"}},
                               {resource,exchange,{constant,true}}]}},
                            {permission,read,
                             {for,
                              [{resource,exchange,
                                {in_group,"cn=admin,dc=cray,dc=com"}},
                               {resource,queue,{constant,true}}]}}]},
                          [{administrator,{constant,false}},
                           {management,{constant,true}}],
                          false,network,389}
** Reason for termination ==
** as_user_no_password

=INFO REPORT==== 22-May-2013::09:32:37 ===
LDAP CHECK: passwordless login for O=client,CN=ecozzi-01

=ERROR REPORT==== 22-May-2013::09:32:40 ===
closing AMQP connection <0.4824.0> (192.168.252.1:41297 -> 
192.168.252.1:5671):
{handshake_error,starting,0,
     {exit,
         {as_user_no_password,
             {gen_server,call,
                 [rabbit_auth_backend_ldap,
                  {login,<<"O=client,CN=ecozzi-01">>},
                  infinity]}},
         'connection.start_ok',
         [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
          {rabbit_access_control,'-check_user_login/2-fun-0-',4,[]},
          {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}}

rabbitmq.config:

[
   {rabbit,
     [
       {hipe_compile, true},
       {tcp_listen_options,
         [binary,
           {packet,raw},
           {reuseaddr,true},
           {backlog,128},
           {nodelay,true},
           {exit_on_close,false}
         ]
       },
       {auth_mechanisms, ['EXTERNAL']},
       {ssl_listeners, [5671]},
       {ssl_options, [{cacertfile,"/opt/cray/ssl/testca/cacert.pem"},
                      {certfile,"/opt/cray/ssl/server-01/cert.pem"},
                      {keyfile,"/opt/cray/ssl/server-01/key.pem"},
                      {verify,verify_peer},
                      {fail_if_no_peer_cert,true}
                     ]
       },
       {auth_backends, [rabbit_auth_backend_ldap]}
     ]
   },
   {rabbitmq_auth_backend_ldap,
     [
       {servers,               ["192.168.252.5"]},
        {user_dn_pattern,       "cn=${username},ou=msgbus,dc=cray,dc=com"},
        {use_ssl,               false},
        {port,                  389},
        {log,                   network},
        {vhost_access_query,    {in_group,
                                 
"ou=${vhost}-users,ou=vhosts,dc=cray,dc=com"}},
        {resource_access_query,
          {for, [
                  {permission, configure, {in_group, 
"cn=admin,dc=cray,dc=com"}},
                  {permission, write,
                    {for, [{resource, queue,    {in_group, 
"cn=admin,dc=cray,dc=com"}},
                           {resource, exchange, {constant, true}}]}},
                  {permission, read,
                    {for, [{resource, exchange, {in_group, 
"cn=admin,dc=cray,dc=com"}},
                           {resource, queue,    {constant, true}}]}}
                ]
          }
        },
        {tag_queries, [
                        {administrator, {constant, false}},
                        {management,    {constant, true}}
                      ]
        }
    ]
   }
].


From simon at rabbitmq.com  Wed May 22 16:35:47 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 May 2013 16:35:47 +0100
Subject: [rabbitmq-discuss] Error trying to configure
	rabbit_auth_backend_ldap
In-Reply-To: <519CE2C7.2020901@cray.com>
References: <519CE2C7.2020901@cray.com>
Message-ID: <519CE5D3.4080508@rabbitmq.com>

Hi.

The problem is the 'other_bind' configuration option defaults to 
'as_user', but this isn't compatible with passwordless login.

'other_bind' controls how RabbitMQ connects to the LDAP server to do 
anything other than check a {user, password} combination. 'as_user' 
means connect to LDAP with the username and password of the logged in 
user. You can see how this would fail to work.

So you need to set 'other_bind' to either 'anon' or {"another-user", 
"another-password"} depending on how you want RabbitMQ connect to LDAP here.

This could really be better explained in the documentation, I'll work on 
that...

Cheers, Simon

On 22/05/13 16:22, Eric Cozzi wrote:
> I am trying to configure rabbit_auth_backend_ldap as a backing auth for
> passwordless login using rabbitmq_auth_mechanism_ssl, but I am getting
> the following error. I've also included my rabbitmq.config file for
> reference.
>
> Any help would be appreciated.
> Thanks,
> Eric
>
> Logfile:
>
> =ERROR REPORT==== 22-May-2013::09:32:37 ===
> ** Generic server rabbit_auth_backend_ldap terminating
> ** Last message in was {login,<<"O=client,CN=ecozzi-01">>}
> ** When Server state == {state,
>                           ["192.168.252.5"],
> "cn=${username},ou=msgbus,dc=cray,dc=com",none,none,
>                           as_user,
>                           {in_group,
>                            "ou=${vhost}-users,ou=vhosts,dc=cray,dc=com"},
>                           {for,
>                            [{permission,configure,
>                              {in_group,"cn=admin,dc=cray,dc=com"}},
>                             {permission,write,
>                              {for,
>                               [{resource,queue,
>                                 {in_group,"cn=admin,dc=cray,dc=com"}},
>                                {resource,exchange,{constant,true}}]}},
>                             {permission,read,
>                              {for,
>                               [{resource,exchange,
>                                 {in_group,"cn=admin,dc=cray,dc=com"}},
>                                {resource,queue,{constant,true}}]}}]},
>                           [{administrator,{constant,false}},
>                            {management,{constant,true}}],
>                           false,network,389}
> ** Reason for termination ==
> ** as_user_no_password
>
> =INFO REPORT==== 22-May-2013::09:32:37 ===
> LDAP CHECK: passwordless login for O=client,CN=ecozzi-01
>
> =ERROR REPORT==== 22-May-2013::09:32:40 ===
> closing AMQP connection <0.4824.0> (192.168.252.1:41297 ->
> 192.168.252.1:5671):
> {handshake_error,starting,0,
>      {exit,
>          {as_user_no_password,
>              {gen_server,call,
>                  [rabbit_auth_backend_ldap,
>                   {login,<<"O=client,CN=ecozzi-01">>},
>                   infinity]}},
>          'connection.start_ok',
>          [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
>           {rabbit_access_control,'-check_user_login/2-fun-0-',4,[]},
>
> {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}}
>
> rabbitmq.config:
>
> [
>    {rabbit,
>      [
>        {hipe_compile, true},
>        {tcp_listen_options,
>          [binary,
>            {packet,raw},
>            {reuseaddr,true},
>            {backlog,128},
>            {nodelay,true},
>            {exit_on_close,false}
>          ]
>        },
>        {auth_mechanisms, ['EXTERNAL']},
>        {ssl_listeners, [5671]},
>        {ssl_options, [{cacertfile,"/opt/cray/ssl/testca/cacert.pem"},
>                       {certfile,"/opt/cray/ssl/server-01/cert.pem"},
>                       {keyfile,"/opt/cray/ssl/server-01/key.pem"},
>                       {verify,verify_peer},
>                       {fail_if_no_peer_cert,true}
>                      ]
>        },
>        {auth_backends, [rabbit_auth_backend_ldap]}
>      ]
>    },
>    {rabbitmq_auth_backend_ldap,
>      [
>        {servers,               ["192.168.252.5"]},
>         {user_dn_pattern,       "cn=${username},ou=msgbus,dc=cray,dc=com"},
>         {use_ssl,               false},
>         {port,                  389},
>         {log,                   network},
>         {vhost_access_query,    {in_group,
> "ou=${vhost}-users,ou=vhosts,dc=cray,dc=com"}},
>         {resource_access_query,
>           {for, [
>                   {permission, configure, {in_group,
> "cn=admin,dc=cray,dc=com"}},
>                   {permission, write,
>                     {for, [{resource, queue,    {in_group,
> "cn=admin,dc=cray,dc=com"}},
>                            {resource, exchange, {constant, true}}]}},
>                   {permission, read,
>                     {for, [{resource, exchange, {in_group,
> "cn=admin,dc=cray,dc=com"}},
>                            {resource, queue,    {constant, true}}]}}
>                 ]
>           }
>         },
>         {tag_queries, [
>                         {administrator, {constant, false}},
>                         {management,    {constant, true}}
>                       ]
>         }
>     ]
>    }
> ].
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, Pivotal

From Ron.Cordell at RelayHealth.com  Wed May 22 19:25:59 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron L)
Date: Wed, 22 May 2013 18:25:59 +0000
Subject: [rabbitmq-discuss] F5 Load Balancer Pool Management
In-Reply-To: <20130522054737.GG292@kaka.it.su.se>
References: <0B8CD6850421B745BE39BC5C7601923271F697F0@DDCEP50015.na.corp.mckesson.com>
	<20130522054737.GG292@kaka.it.su.se>
Message-ID: <0B8CD6850421B745BE39BC5C7601923271F6A883@DDCEP50015.na.corp.mckesson.com>

Thanks, Simon - that's very helpful.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon Lundstr?m
Sent: Tuesday, May 21, 2013 10:48 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] F5 Load Balancer Pool Management

Morning Ron!

We're just in the middle of implementing RabbitMQ cluster by using our
F5 BIG-IP loadbalancers.

The idea is to have two healthchecks:

1, One very simple which connects to the node and sees that the "path is clear", i.e. that no firewall etc is blocking the connection to the node. This is being done by sending eight random bytes to the AMQP port (we're using SSL) and the server should respond with AMQP0091 (see, <https://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf> section 4.2.2 Protocol Header).

The problem with this is that it creates alot of log noise and I'm not sure how to filter this out or how to generate a smart enough request that RabbitMQ won't generate log noise.

2, The other health check is more complex and we want to check that a node is really up and that it accepts messages. As BIG-IP doesn't support AMQP OOTB we only found two other solutions:
* Write and compile a static C-binary which does the check and speaks the AMQP protocol
* Put a Nagios NRPE check on the host which does the check and use the BIG-IP to do a NRPE request to the node.

While the first solution seems ideal we don't want to complicate our BIG-IP setup (i.e. put files on it) so we chose the latter.

I created a Perl-script <https://github.com/simmel/create_nrpe_request>
that can create the binary request that NRPE uses so it can be used in the BIG-IP.

Healthcheck #2 is done but I'm still trying to make #1 smarter and not create log noise.
Any ideas here from you or others?

Br,
- Simon

____________________________________

Simon Lundstr?m
Section for Infrastructure

IT Services
Stockholm University
SE-106 91 Stockholm, Sweden

www.su.se/it

____________________________________
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From srd at duneram.com  Wed May 22 19:54:39 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Wed, 22 May 2013 18:54:39 +0000
Subject: [rabbitmq-discuss] =?iso-8859-1?q?effectively_using_-setcookie?=
Message-ID: <20130522185439.19733.qmail@hoster904.com>

Hi,
I'm using rabbit 3.0.4 on a centos system.

Suppose I have a cluster I want to stand up and want to make it easy without having to copy the cookie file to all the nodes.

If I run as rabbitmq the command: rabbitmq-server -setcookie pigcat &
It appears to start fine however I have noticed a couple of things.
the .erlang_cookie doesn't update.

If I later run rabbitmqctl cluster_status  I can't to communicate with the node because I cannot set the cookie to my desired cookie.

So the question is, how does one effectively maintain a cluster using the -setcookie option?

I tried looking at the rabbitmqctl and rabbitmq-server script files but none of them hit the erl application directly.  In the docs it briefly mentions one could modify the scripts so that erl is started with a specific cookie.
I'd like to be able to do this but do not see where it would be that I need to augment so I can ensure the cookie is always set to a known value when accessing the node.

Does anyone have an example of how / what scripts need to be modified?

Thanks in advance.



From videlalvaro at gmail.com  Wed May 22 20:05:23 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 22 May 2013 21:05:23 +0200
Subject: [rabbitmq-discuss] effectively using -setcookie
In-Reply-To: <20130522185439.19733.qmail@hoster904.com>
References: <20130522185439.19733.qmail@hoster904.com>
Message-ID: <CAMcAHLXuCskRHG+rvdMsOf+dPPogVqOBFt3AGC05KyhiePW21A@mail.gmail.com>

Hi,

If I read the source code correctly, rabbitmq-server will accept arguments
that will be sent directly to erl, so you can use -setcookie there.

On the other hand rabbitmqctl expects an ENV var
called RABBITMQ_CTL_ERL_ARGS, so I guess you could pass -setcookie there.

And no, -setcookie won't change the value of .erlang_cookie; it's used
to override it.

Regards,

Alvaro




On Wed, May 22, 2013 at 8:54 PM, srd <srd at duneram.com> wrote:

> Hi,
> I'm using rabbit 3.0.4 on a centos system.
>
> Suppose I have a cluster I want to stand up and want to make it easy
> without having to copy the cookie file to all the nodes.
>
> If I run as rabbitmq the command: rabbitmq-server -setcookie pigcat &
> It appears to start fine however I have noticed a couple of things.
> the .erlang_cookie doesn't update.
>
> If I later run rabbitmqctl cluster_status  I can't to communicate with the
> node because I cannot set the cookie to my desired cookie.
>
> So the question is, how does one effectively maintain a cluster using the
> -setcookie option?
>
> I tried looking at the rabbitmqctl and rabbitmq-server script files but
> none of them hit the erl application directly.  In the docs it briefly
> mentions one could modify the scripts so that erl is started with a
> specific cookie.
> I'd like to be able to do this but do not see where it would be that I
> need to augment so I can ensure the cookie is always set to a known value
> when accessing the node.
>
> Does anyone have an example of how / what scripts need to be modified?
>
> Thanks in advance.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130522/db545e28/attachment.htm>

From vikram.vis at gmail.com  Wed May 22 21:50:51 2013
From: vikram.vis at gmail.com (vikram)
Date: Wed, 22 May 2013 13:50:51 -0700 (PDT)
Subject: [rabbitmq-discuss] [java-client] Is there a full working
 example of "DefaultConsumer" without *deprecated * QueueingConsumer ?
In-Reply-To: <5190BF33.1010902@rabbitmq.com>
References: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
	<5190BF33.1010902@rabbitmq.com>
Message-ID: <1369255851048-26944.post@n5.nabble.com>


I am having a similar issue. In my callback I only get 2 messages  and no
more. The only difference is that I do client acknowledge and  acknowledge
only after some time. I do not acknowledge immediately after a message
arrives. Would this be a problem ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/java-client-Is-there-a-full-working-example-of-DefaultConsumer-without-deprecated-QueueingConsumer-tp26564p26944.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From moshima at advent.com  Wed May 22 23:20:09 2013
From: moshima at advent.com (michi.oshima)
Date: Wed, 22 May 2013 15:20:09 -0700 (PDT)
Subject: [rabbitmq-discuss] RDQ files filling the disk.
In-Reply-To: <519C969D.5040102@rabbitmq.com>
References: <1369174785991-26903.post@n5.nabble.com>
	<6ADE8373-F46E-435C-BA32-96D47D85BB7B@rabbitmq.com>
	<519C9649.1000404@rabbitmq.com> <519C969D.5040102@rabbitmq.com>
Message-ID: <1369261209431-26945.post@n5.nabble.com>

I don't have history information for queue sizes.  I only have access to
history for disk size.  Judging from it, a queue has been monotonically
growing in size.

And it has to be the shovel's queue attached to RabbitMQ1 that's been
accumulating the messages.  Trying to depict the flow of messages here:

Client1 --> amq.topic at Rabbit1 --> shovel_queue --> amq.topic at Rabbit2 -->
client2_queue --> Client2

I set up the queue with all default settings, with routing_key set to "#". 
Currently we don't use RabbitMQ for any purpose other than sending messages
from Client1 to Client2 in the manner depicted above.

I wonder under what circumstances 'shovel_queue1' could start accumulating
messages.  While messages are getting received on Client2?  As I said
before, there is no shovel related errors recorded in the log files.  May be
shovel is *somehow* not getting message acknowledgements from RabbitMQ2?  Is
that even possible?





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RDQ-files-filling-the-disk-tp26903p26945.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From francois at seevibes.com  Thu May 23 03:37:31 2013
From: francois at seevibes.com (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Wed, 22 May 2013 22:37:31 -0400
Subject: [rabbitmq-discuss] Recovering a busted instance
In-Reply-To: <519CDE9C.50409@rabbitmq.com>
References: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>
	<519C9396.20904@rabbitmq.com>
	<C118B33D-010E-43CF-B7A0-8CD62CA20D65@seevibes.com>
	<519CDE9C.50409@rabbitmq.com>
Message-ID: <E7976305-A7E1-4C41-8722-858288032253@seevibes.com>


Le 2013-05-22 ? 11:05, Simon MacMullen a ?crit :

> On 22/05/13 15:57, Fran?ois Beausoleil wrote:
>> You mean I should grab the latest from:
>> 
>> http://www.rabbitmq.com/nightlies/rabbitmq-server/current/
> 

Sorry to report RabbitMQ still doesn't start. I have the following crash using 3.1.1.40522:

=CRASH REPORT==== 23-May-2013::02:33:49 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.153.0>
    registered_name: []
    exception exit: {bad_return,
                     {{rabbit,start,[normal,[]]},
                      {'EXIT',
                       {rabbit,failure_during_boot,
                        {badmatch,
                         {error,
                          {{{function_clause,
                             [{rabbit_queue_index,journal_minus_segment1,
                               [{no_pub,no_del,ack},undefined]},
                              {rabbit_queue_index,
                               '-journal_minus_segment/2-fun-0-',4},
                              {array,sparse_foldl_3,7},
                              {array,sparse_foldl_2,9},
                              {rabbit_queue_index,
                               '-recover_journal/1-fun-0-',1},
                              {dict,map_bucket,2},
                              {dict,map_bucket,2},
                              {dict,map_bkt_list,2}]},
                            {gen_server2,call,[<0.223.0>,out,infinity]}},
                           {child,undefined,msg_store_persistent,
                            {rabbit_msg_store,start_link,
                             [msg_store_persistent,
                              "/var/lib/rabbitmq/mnesia/rabbit at rabbit104",
                              [<<251,36,244,99,192,144,85,200,209,96,141,61,
                                 212,212,28,95>>,
                               <<191,32,57,94,174,211,166,0,76,193,74,149,252,
                                 177,185,245>>,
                               <<212,228,229,81,23,60,150,249,91,90,197,56,156,
                                 20,130,194>>,
                               <<120,60,75,235,213,77,54,137,14,124,111,62,250,
                                 138,144,114>>,
...

startup_log says:

Stack trace:
   [{rabbit_variable_queue,start_msg_store,2},
    {rabbit_amqqueue,recover,0},
    {rabbit,recover,0},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
    {rabbit,run_boot_step,1},
    {rabbit,'-start/2-lc$^0/1-0-',1},
    {rabbit,start,2},
    {application_master,start_it_old,4}]

Anything else I can do?

Bye,
Fran?ois

From moshima at advent.com  Thu May 23 05:08:08 2013
From: moshima at advent.com (michi.oshima)
Date: Wed, 22 May 2013 21:08:08 -0700 (PDT)
Subject: [rabbitmq-discuss] RDQ files filling the disk.
In-Reply-To: <1369261209431-26945.post@n5.nabble.com>
References: <1369174785991-26903.post@n5.nabble.com>
	<6ADE8373-F46E-435C-BA32-96D47D85BB7B@rabbitmq.com>
	<519C9649.1000404@rabbitmq.com> <519C969D.5040102@rabbitmq.com>
	<1369261209431-26945.post@n5.nabble.com>
Message-ID: <1369282088605-26947.post@n5.nabble.com>

Hi,

Please disregard my problem for now.  I now have a hypothesis.  I think the
problem is a lot more mundane than I originally thought.

Although I have not had access to the two rabbitmq instances thus far, I
believe RabbitMQ1 has at least one old queue created by shovel plug-in.  It
must be receiving messages without anybody consuming them.

I'm currently not naming the queue in shovel config.  I believe giving it a
constant name should solve the problem.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RDQ-files-filling-the-disk-tp26903p26947.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu May 23 11:59:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 May 2013 11:59:41 +0100
Subject: [rabbitmq-discuss] Recovering a busted instance
In-Reply-To: <E7976305-A7E1-4C41-8722-858288032253@seevibes.com>
References: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>
	<519C9396.20904@rabbitmq.com>
	<C118B33D-010E-43CF-B7A0-8CD62CA20D65@seevibes.com>
	<519CDE9C.50409@rabbitmq.com>
	<E7976305-A7E1-4C41-8722-858288032253@seevibes.com>
Message-ID: <519DF69D.4050809@rabbitmq.com>

On 23/05/13 03:37, Fran?ois Beausoleil wrote:
> Sorry to report RabbitMQ still doesn't start. I have the following crash using 3.1.1.40522:

Sorry, not sure what I was thinking. The new code will only recover if 
the corruption happens *after* the upgrade. Sorry to mislead.

If the Mnesia dir is not too big and not too confidential, tar it up and 
send it to me off-list and I will see what I can do. (Preferably a copy 
which has not been through the upgrade process.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From francois at seevibes.com  Thu May 23 12:38:27 2013
From: francois at seevibes.com (=?utf-8?Q?Fran=C3=A7ois_Beausoleil?=)
Date: Thu, 23 May 2013 07:38:27 -0400
Subject: [rabbitmq-discuss] Recovering a busted instance
In-Reply-To: <519DF69D.4050809@rabbitmq.com>
References: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>
	<519C9396.20904@rabbitmq.com>
	<C118B33D-010E-43CF-B7A0-8CD62CA20D65@seevibes.com>
	<519CDE9C.50409@rabbitmq.com>
	<E7976305-A7E1-4C41-8722-858288032253@seevibes.com>
	<519DF69D.4050809@rabbitmq.com>
Message-ID: <FF934ECA-BD85-4AFA-AA54-2412D69DC1C6@seevibes.com>

As you suggested, I backed up before. The tar is 2-3 GiB. My next step was exactly a fresh install then replace the mnesia dir with my backup. I'll let you know today.

Fran?ois

El 2013-05-23, a las 06:59, Simon MacMullen <simon at rabbitmq.com> escribi?:

> On 23/05/13 03:37, Fran?ois Beausoleil wrote:
>> Sorry to report RabbitMQ still doesn't start. I have the following crash using 3.1.1.40522:
> 
> Sorry, not sure what I was thinking. The new code will only recover if the corruption happens *after* the upgrade. Sorry to mislead.
> 
> If the Mnesia dir is not too big and not too confidential, tar it up and send it to me off-list and I will see what I can do. (Preferably a copy which has not been through the upgrade process.)
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal

From matthias at rabbitmq.com  Thu May 23 12:51:00 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 12:51:00 +0100
Subject: [rabbitmq-discuss] Recovering a busted instance
In-Reply-To: <FF934ECA-BD85-4AFA-AA54-2412D69DC1C6@seevibes.com>
References: <DDD786CD-72ED-4C9B-A86D-19F804029D38@seevibes.com>
	<519C9396.20904@rabbitmq.com>
	<C118B33D-010E-43CF-B7A0-8CD62CA20D65@seevibes.com>
	<519CDE9C.50409@rabbitmq.com>
	<E7976305-A7E1-4C41-8722-858288032253@seevibes.com>
	<519DF69D.4050809@rabbitmq.com>
	<FF934ECA-BD85-4AFA-AA54-2412D69DC1C6@seevibes.com>
Message-ID: <519E02A4.6060907@rabbitmq.com>

Fran?ois,

On 23/05/13 12:38, Fran?ois Beausoleil wrote:
> My next step was exactly a fresh install then replace the mnesia dir
> with my backup.

That is going to produce the same result, so don't bother.

Matthias.

From gobadiah at gmail.com  Thu May 23 14:11:29 2013
From: gobadiah at gmail.com (Michael Journo)
Date: Thu, 23 May 2013 15:11:29 +0200
Subject: [rabbitmq-discuss] Queue declare doesn't return
In-Reply-To: <1A5BC5FB-2457-46E0-8F78-E5542C3BDAB2@rabbitmq.com>
References: <CAMv=6V7saw-P79crBMaOdKG5zv1Sbxj20ys1ktbGPG5mDaKH7w@mail.gmail.com>
	<1A5BC5FB-2457-46E0-8F78-E5542C3BDAB2@rabbitmq.com>
Message-ID: <CAMv=6V4kcP1n7UHdPSjwa5xefSM0w+bbsd2qQ5dEGZU5D4Hf3w@mail.gmail.com>

Hello Tim,

I'm using debian 6 and 7, and indeed I think heartbeats would be a good
start to prevent this kind of behaviour, but helas SimpleAqmpClient doesn't
support it. Can you think of any workaround ?

Thank you so much,


2013/5/20 Tim Watson <watson.timothy at gmail.com>

> This sounds a lot like the physical network connection has been severed,
> but the client isn't noticing for a very long time. What os are you using?
> Have you considered turning on heartbeats in your clients, be expedite
> detection of connection failures?
>
> Cheers,
> Tim
>
> On 20 May 2013, at 16:26, Michael Journo <gobadiah at gmail.com> wrote:
>
>  Hello,
>
>
> I've came across a problem, but unfortunately I have very little
> information about it.
>
>
> I use rabbitmq 2.8.4, along with clients such as pika (python side) and
> SimpleAmqpClient (c++ side). This issue was experienced in both those
> clients.
>
>
> What happened is simply that DeclareQueue or queue_declare wouldn't return
> at all (I mean being blocked for *days*).
>
>
> When the incident started, I get a lot of
>
>
>
> =WARNING REPORT==== 18-May-2013::03:09:18 ===
>
> closing AMQP connection <0.3256.1697> (127.0.0.1:46099 -> 127.0.0.1:5672):
>
> connection_closed_abruptly
>
>
> in the rabbitmq log, but nothing more.
>
>
> I fixed this by ? restarting rabbitmq, but I'm kind of worry because I
> don't know how to detect this problem again (building a timeout mechanism
> on top of the clients is just not ok).
>
>
> If anyone has any idea about what could cause this, it would be greatly
> appreciated.
>
> --
> michael
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/2cf43ade/attachment.htm>

From matthias at rabbitmq.com  Thu May 23 14:23:38 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 14:23:38 +0100
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <5198DC48.7080606@osic.rs>
References: <CDBE4A18.9B54%Michael.Laing@nytimes.com>
	<5198DC48.7080606@osic.rs>
Message-ID: <519E185A.2080001@rabbitmq.com>

Nikola,

On 19/05/13 15:06, Nikola Savic wrote:
> Would STOMP be better approach to connect to RabbitMQ from PHP?

STOMP's connection establishment handshake has fewer steps, so for a 
connect-publish-disconnect scenario might well be quicker than AMQP. 
Though the only way to be sure is to test it :)

Matthias.


From michael.justin at gmx.net  Thu May 23 14:39:06 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 23 May 2013 15:39:06 +0200
Subject: [rabbitmq-discuss] Test (will be deleted)
Message-ID: <knl65k$kaf$1@ger.gmane.org>


-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From tim at rabbitmq.com  Thu May 23 14:45:25 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 23 May 2013 14:45:25 +0100
Subject: [rabbitmq-discuss] Queue declare doesn't return
In-Reply-To: <CAMv=6V4kcP1n7UHdPSjwa5xefSM0w+bbsd2qQ5dEGZU5D4Hf3w@mail.gmail.com>
References: <CAMv=6V7saw-P79crBMaOdKG5zv1Sbxj20ys1ktbGPG5mDaKH7w@mail.gmail.com>
	<1A5BC5FB-2457-46E0-8F78-E5542C3BDAB2@rabbitmq.com>
	<CAMv=6V4kcP1n7UHdPSjwa5xefSM0w+bbsd2qQ5dEGZU5D4Hf3w@mail.gmail.com>
Message-ID: <357FF217-0A7B-4E27-9ACE-9F2C4A162A80@rabbitmq.com>

Hi Michael,

On 23 May 2013, at 14:11, Michael Journo wrote:
> 
> I'm using debian 6 and 7, and indeed I think heartbeats would be a good start to prevent this kind of behaviour, but helas SimpleAqmpClient doesn't support it. Can you think of any workaround ? 
> 

In the absence of support for heartbeats, you might consider enabling tcp keep-alives at the operating system level instead.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/94247818/attachment.htm>

From videlalvaro at gmail.com  Thu May 23 15:17:35 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 23 May 2013 16:17:35 +0200
Subject: [rabbitmq-discuss] More throughput using cluster
In-Reply-To: <5198F131.8000706@osic.rs>
References: <2d09029d-c03e-4b8c-83e9-db5f23ef0b04@googlegroups.com>
	<CAE3HoVSV_JjrnLXmXom7t8w3Owsp8ScQ3kbZ9HS+9GvgkDCpUg@mail.gmail.com>
	<5198865F.8000901@osic.rs>
	<CAE3HoVSnf34pyju8rsyDOnQPW6eahG5N5Wkv-zXwkbE56sb1_A@mail.gmail.com>
	<5198BD8C.2090609@osic.rs>
	<CAE3HoVRJiPdW4Zx=h1OH4sKgnDFsswC1FJj7fkC30ByDhGPbcw@mail.gmail.com>
	<5198DBAC.7090901@osic.rs>
	<CAE3HoVQGZPeaCYKNQXiz6jCF0wfi58EoMDJ_WDM1s9SYeoUdFQ@mail.gmail.com>
	<5198DD85.1020101@osic.rs>
	<CAMcAHLUmH2rrb6QuZX84Z-pvXwvVnixprKFGKevC3zXHso8AjA@mail.gmail.com>
	<5198ED8A.2080909@osic.rs>
	<CAE3HoVT6Lg-T0Li9qJhxPnhi3PZrvcmzfbuSWMmrrcutfX_E7A@mail.gmail.com>
	<5198F131.8000706@osic.rs>
Message-ID: <CAMcAHLWt64XU=FMbAUTmAw0n2AzvpQSqNyyLkFoPTb5E0R957Q@mail.gmail.com>

Hi Nikola.

php-amqplib doesn't support heartbeats right now, but I was just reading
the source code trying to understand how/where to add them.

I would try to cook a new version of the lib with support for heatbeats. At
least to be able to reply to the server when it sends heartbeats to the
client.

Sending heartbeats to the server to see if it is still there is harder with
PHP, since there are no timeouts as with Javascript.

Regards,

Alvaro




On Sun, May 19, 2013 at 5:35 PM, Nikola Savic <niks at osic.rs> wrote:

>
> Hmm ... I'll look into using basic.consume with two channels like you
> suggest.
>
> There is one more channel that we use :( Direct channel by which worker
> process (consumer) sends ECHO message to itself, because we couldn't make
> php-amqplib recognize that RabbitMQ has gone away.
>
> Alvaro, is there support for AMQP heartbeat in php-amqplib? I was not
> being able to find and activate it :(
>
>
> On 05/19/2013 05:26 PM, Michael Klishin wrote:
>
>  2013/5/19 Nikola Savic <niks at osic.rs>
>
>> We're not using basic_consume, since we must monitor two different
>> channels/exchanges (one direct and one fannout). This is because workers
>> must get messages (task related) by direct queue, and broadcasts over
>> fannout
>
>
> You should be able to do this easily with any client using basic.consume.
>
> Also, sounds like a suitable use case for exchangeo-to-exchange bindings:
>
>  http://www.rabbitmq.com/e2e.html
>  --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/f6d66bbf/attachment.htm>

From gobadiah at gmail.com  Thu May 23 15:33:03 2013
From: gobadiah at gmail.com (Michael Journo)
Date: Thu, 23 May 2013 16:33:03 +0200
Subject: [rabbitmq-discuss] Queue declare doesn't return
In-Reply-To: <357FF217-0A7B-4E27-9ACE-9F2C4A162A80@rabbitmq.com>
References: <CAMv=6V7saw-P79crBMaOdKG5zv1Sbxj20ys1ktbGPG5mDaKH7w@mail.gmail.com>
	<1A5BC5FB-2457-46E0-8F78-E5542C3BDAB2@rabbitmq.com>
	<CAMv=6V4kcP1n7UHdPSjwa5xefSM0w+bbsd2qQ5dEGZU5D4Hf3w@mail.gmail.com>
	<357FF217-0A7B-4E27-9ACE-9F2C4A162A80@rabbitmq.com>
Message-ID: <CAMv=6V585MVqkWF_jrzFt-8ZtXHJ25R0pWx_8Ure0EJmPNKiUA@mail.gmail.com>

Hey,

Thanks I'll look into that.


2013/5/23 Tim Watson <tim at rabbitmq.com>

> Hi Michael,
>
> On 23 May 2013, at 14:11, Michael Journo wrote:
>
>
> I'm using debian 6 and 7, and indeed I think heartbeats would be a good
> start to prevent this kind of behaviour, but helas SimpleAqmpClient doesn't
> support it. Can you think of any workaround ?
>
>
> In the absence of support for heartbeats, you might consider enabling tcp
> keep-alives at the operating system level instead.
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/fe62c0b2/attachment.htm>

From bison_art at o2.pl  Thu May 23 15:44:40 2013
From: bison_art at o2.pl (rabbit15)
Date: Thu, 23 May 2013 07:44:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <519528ED.5050205@rabbitmq.com>
References: <1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
	<1368619663987-26710.post@n5.nabble.com>
	<1368620907646-26713.post@n5.nabble.com>
	<51938BF1.7070106@rabbitmq.com>
	<1368625779575-26720.post@n5.nabble.com>
	<51939483.5020305@rabbitmq.com>
	<1368703737826-26757.post@n5.nabble.com>
	<519528ED.5050205@rabbitmq.com>
Message-ID: <1369320280572-26957.post@n5.nabble.com>

Hi I have output from other machine

./rabbitmqctl status
Status of node rabbit at katlabucs5 ...
[{pid,12721},
 {running_applications,
     [{rabbitmq_perfmon,"Embedded Rabbit Perfmon","0.0.0"},
      {rabbitmq_tracing,"RabbitMQ message logging / tracing","3.1.0"},
      {rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},
      {rabbit,"RabbitMQ","3.1.0"},
      {os_mon,"CPO  CXC 138 46","2.2.10"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
      {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.0-gitd541e9a"},
      {xmerl,"XML parser","1.3.2"},
      {inets,"INETS  CXC 138 49","5.9.1"},
      {mnesia,"MNESIA  CXC 138 12","4.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {stdlib,"ERTS  CXC 138 10","1.18.2"},
      {kernel,"ERTS  CXC 138 10","2.15.2"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B02 (erts-5.9.2) [source] [64-bit] [smp:32:32]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,19874114832},
      {connection_procs,1303985192},
      {queue_procs,12282797608},
      {plugins,4009736},
      {other_proc,120396865},
      {mnesia,817400},
      {mgmt_db,21649896},
      {msg_index,262032},
      {other_ets,2414032},
      {binary,6108831024},
      {code,18609290},
      {atom,703377},
      {other_system,9638380}]},
 {vm_memory_high_watermark,3.2},
 {vm_memory_limit,216556175360},
 {disk_free_limit,0},
 {disk_free,1571921027072},
 {file_descriptors,
     [{total_limit,924},
      {total_used,491},
      {sockets_limit,829},
      {sockets_used,489}]},
 {processes,[{limit,1048576},{used,5855}]},
 {run_queue,1},
 {uptime,797}]
...done.

I see that on faster machine which has 32 CPU(Intel(R) Xeon(R) CPU E5-2670 0
@ 2.60GHz) and 64GB RAM there can be store more messages about 10 milions.
Previous machine was with 24 CPU (Intel(R) Xeon(R) CPU           X5675  @
3.07GHz) and 92 GB RAM and there could 600k -2500k stored messages.
Maybe there is some option for GC ?
Best Regards,
Artur





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-grows-very-fast-tp26626p26957.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Thu May 23 16:14:47 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 16:14:47 +0100
Subject: [rabbitmq-discuss] F5 Load Balancer Pool Management
In-Reply-To: <20130522054737.GG292@kaka.it.su.se>
References: <0B8CD6850421B745BE39BC5C7601923271F697F0@DDCEP50015.na.corp.mckesson.com>
	<20130522054737.GG292@kaka.it.su.se>
Message-ID: <519E3267.8090003@rabbitmq.com>

Simon,

On 22/05/13 06:47, Simon Lundstr?m wrote:
> The idea is to have two healthchecks:
>
> 1, One very simple which connects to the node and sees that the "path is
> clear", i.e. that no firewall etc is blocking the connection to the
> node. This is being done by sending eight random bytes to the AMQP port
> (we're using SSL) and the server should respond with AMQP0091 (see,
> <https://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf> section 4.2.2 Protocol
> Header).
>
> The problem with this is that it creates alot of log noise and I'm not
> sure how to filter this out or how to generate a smart enough request
> that RabbitMQ won't generate log noise.
> [...]
 > I'm still trying to make #1 smarter and not create log noise.
> Any ideas here from you or others?

You can adjust the log level for connection-related events. See the 
log_levels variable in 
http://www.rabbitmq.com/configure.html#configuration-file. This may not 
be fine-grained enough for you though since to suppress the errors from 
the above LB connections you'd have to set the connection log_level to 
'none', thus suppressing logging of all connection-related events.

Matthias.

From matthias at rabbitmq.com  Thu May 23 16:20:03 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 16:20:03 +0100
Subject: [rabbitmq-discuss] [java-client] Is there a full working
 example of "DefaultConsumer" without *deprecated * QueueingConsumer ?
In-Reply-To: <1369255851048-26944.post@n5.nabble.com>
References: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
	<5190BF33.1010902@rabbitmq.com>
	<1369255851048-26944.post@n5.nabble.com>
Message-ID: <519E33A3.9010700@rabbitmq.com>

On 22/05/13 21:50, vikram wrote:
> I am having a similar issue. In my callback I only get 2 messages  and no
> more. The only difference is that I do client acknowledge and  acknowledge
> only after some time. I do not acknowledge immediately after a message
> arrives. Would this be a problem ?

Please post some self-contained code that exhibits the problem you are 
seeing.

Matthias.

From michael.justin at gmx.net  Thu May 23 17:21:56 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 23 May 2013 18:21:56 +0200
Subject: [rabbitmq-discuss] Fwd: RabbitMQ 3.0.4 send to temporary queue fails
In-Reply-To: <md5:GYw5vDqP1m4NNeb4elXl2w==>
References: <md5:GYw5vDqP1m4NNeb4elXl2w==>
Message-ID: <519E4224.70708@gmx.net>

Hello,

I am following the tutorial
http://www.rabbitmq.com/tutorials/tutorial-six-java.html with one
difference: for the server side part, I use a Delphi STOMP application.

The client is based on the tutorial code and sends a message to the
"rpc_queue", and specifies a reply queue.

The server receives the following frame with the payload "30":

MESSAGE
subscription:{888A96BF-0B48-4801-A58A-E17463A8DCE5}
destination:/queue/rpc_queue
message-id:T_{888A96BF-0B48-4801-A58A-E17463A8DCE5}@@session-dq-3JC__vwqOqfKZDLdsLQ@@1
reply-to:/reply-queue/amq.gen-gXiB6yijyRPPClTuIAugKA
correlation-id:7700ff89-57a6-4674-ae6e-3b1d8fd01edc
content-type:text/plain
content-length:2


30




So the AMQP side has set reply-to to
/reply-queue/amq.gen-gXiB6yijyRPPClTuIAugKA

Now when the Delphi side tries to send the response to the reply-to
address, the broker responds with an error:

SEND
destination:/temp-queue/amq.gen-gXiB6yijyRPPClTuIAugKA
correlation-id:7700ff89-57a6-4674-ae6e-3b1d8fd01edc
content-type:text/plain


832040

received:
ERROR
message:Processing error
content-type:text/plain
version:1.0,1.1,1.2
content-length:16


Processing error



Processing error Processing error




Is this a problem in my code or is it a server side error?



-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/

From matthias at rabbitmq.com  Thu May 23 17:47:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 17:47:51 +0100
Subject: [rabbitmq-discuss] Fwd: RabbitMQ 3.0.4 send to temporary queue
 fails
In-Reply-To: <519E4224.70708@gmx.net>
References: <md5:GYw5vDqP1m4NNeb4elXl2w==> <519E4224.70708@gmx.net>
Message-ID: <519E4837.7010907@rabbitmq.com>

Michael,

On 23/05/13 17:21, Michael Justin wrote:
> So the AMQP side has set reply-to to
> /reply-queue/amq.gen-gXiB6yijyRPPClTuIAugKA
>
> Now when the Delphi side tries to send the response to the reply-to
> address, the broker responds with an error:
>
> SEND
> destination:/temp-queue/amq.gen-gXiB6yijyRPPClTuIAugKA
> correlation-id:7700ff89-57a6-4674-ae6e-3b1d8fd01edc
> content-type:text/plain

Why is the destination set to /temp-queue/... instead of /reply-queue/... ?

> ERROR
> message:Processing error
> content-type:text/plain
> version:1.0,1.1,1.2
> content-length:16
>
>
> Processing error
>
>
>
> Processing error Processing error

Our error reporting could probably be better here. There should be a 
more detailed error, probably containing a stack trace, in the rabbit 
logs. Please look for that and post it here.


Regards,

Matthias.


From mpietrek at skytap.com  Thu May 23 18:03:57 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 23 May 2013 10:03:57 -0700
Subject: [rabbitmq-discuss] One node in a cluster never fully starts up
In-Reply-To: <CACLE7izfttKxd4kEBt9uriR1O+-o=_Qx9o=OGBZ+LUbEDf8efQ@mail.gmail.com>
References: <CACLE7ixg=3z1DRg+jZVrwfULrkJiFbNWA15UQP1_QFbHo_N6ng@mail.gmail.com>
	<87r4ryc138.wl%francesco@rabbitmq.com>
	<CACLE7izfttKxd4kEBt9uriR1O+-o=_Qx9o=OGBZ+LUbEDf8efQ@mail.gmail.com>
Message-ID: <CACLE7izKYNKDkxPNDNZgF9cCc8PP+6qHnPoA0zop1zNnyhQFmg@mail.gmail.com>

Hey all,

I'm reviving a really old question here, but I suspect the story has
changed between 2.8.4 and 3.1.1.

See prior messages in this thread for context, but in a nutshell, we're
looking for guidance on whether to start up our clustered brokers
sequentially or in parallel.

I know that sequentially is the ideal situation, but in the case of an
uncontrolled shutdown, it doesn't reliably start, as the first node may
time out waiting for a later node.

When this happens, starting the nodes in parallel gets past the problem.
However, my understanding is that this has its own risks. (See my original
first message in this thread.)

At the end of the day, we just need a set of scripts that will idempotently
start/stop the cluster reliably. It's infeasible to expect an operator
(i.e. not me) to assess the current cluster state and then guess which
approach to take.

Has the guidance changed between 2.8.4 and 3.1.1? I know it's basically a
mnesia issue - I just don't know what improvements have been made since
2.8.4.

Thanks,

Matt


On Thu, Jul 26, 2012 at 8:45 AM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Francesco,
>
> Thanks for the quick reply. A couple of replies/questions:
>
> If I'm understanding what you're saying, we should be starting up our
> brokers sequentially. However, in my experience this hasn't worked. For
> instance, we've seen mq1 stall in its startup, waiting for mq3 to start.
> But mq3 can't start (per the sequential logic) till mq1 finishes starting
> up. Per advice I received from you previously (below) we've moved to async
> startup of the brokers:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020689.html
>
> >* Question 2*>* ---------------*>* Related to the above scenario, is there any danger (after an unplanned*>* shutdown), in simply letting all the nodes start in parallel and*>* letting Mnesia's waiting sort out the order? It seems to work OK in my*>* limited testing so far, but I don't know if we're risking data loss.*
> It should be fine, but in general it's better to do cluster operations
> sequentially and at one site. In this specific case it should be OK.
>
> As it stands now, we're in a catch 22 - If we do sequential startup, we
> run the risk of deadlocking if we start the nodes in the wrong order. But
> if we do async startup, we run into the problem described in this thread.
>
> --------
>
> > Uhm.  It looks like mnesia is detecting a deadlock, and I'm not sure
> why.  What
> > happens if you don't kill it?  Does it terminate by itself, eventually?
>
> I've let it wait for a good long time (30 minutes +) before killing it.
>
> Thanks much for your help,
>
> Matt
>
>
> On Thu, Jul 26, 2012 at 2:40 AM, Francesco Mazzoli <francesco at rabbitmq.com
> > wrote:
>
>> Hi Matt,
>>
>> At Wed, 25 Jul 2012 11:48:56 -0700,
>> Matt Pietrek wrote:
>> > We have a 3 node cluster (mq1, mq2, mq3) running 2.8.4 supporting a
>> small
>> > number of HA queues. During startup of the cluster, we start all nodes
>> in
>> > parallel.
>>
>> This is not a good idea when dealing with clustering.  RabbitMQ
>> clustering is
>> basically a thin layer over mnesia clustering, and we need to do some
>> additional
>> bookkeeping that is prone to race conditions (e.g. storing the online
>> nodes at
>> shutdown).  We are putting efforts in making this process more reliable
>> on the
>> rabbit side.
>>
>> For this reason you should always execute clustering operations
>> sequentially.
>>
>> > Usually everything works fine. However, we've just recently seen one of
>> the
>> > nodes (mq3) won't start, i.e., the rabbitmqctl wait <pid> doesn't
>> complete.
>> >
>> > I can log in to the management UI on mq1 and mq2, so they're at least
>> > minimally running.
>> >
>> > Luckily, we've turned on verbose Mnesia logging. here's what the
>> failing node
>> > (mq3) shows in the console spew:
>> >
>> > [...]
>> >
>> > The pattern of "Getting table rabbit_durable_exchange (disc_copies)
>> from node
>> > rabbit at mq1:" cycles between mq1 and mq2 repeatedly until I kill mq3.
>>
>> Uhm.  It looks like mnesia is detecting a deadlock, and I'm not sure why.
>>  What
>> happens if you don't kill it?  Does it terminate by itself, eventually?
>>
>> > What other sort of information can I provide or look for when this
>> situation
>> > repeats?
>>
>> Well, the normal rabbit logs would help.
>>
>> --
>> Francesco * Often in error, never in doubt
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/163a7a14/attachment.htm>

From michael.justin at gmx.net  Thu May 23 19:03:57 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 23 May 2013 20:03:57 +0200
Subject: [rabbitmq-discuss] Fwd: RabbitMQ 3.0.4 send to temporary queue
	fails
In-Reply-To: <519E4837.7010907@rabbitmq.com>
References: <md5:GYw5vDqP1m4NNeb4elXl2w==> <519E4224.70708@gmx.net>
	<519E4837.7010907@rabbitmq.com>
Message-ID: <knllm8$cu5$1@ger.gmane.org>

Matthias Radestock wrote:
 > Why is the destination set to /temp-queue/... instead of 
/reply-queue/... ?

Good catch. It was an error in my application code for the creation of 
the destination object.

Now it works like a charm - Delphi RPC/STOMP server talks with Java AMQP 
client. (Tested with RabbitMQ 3.0.4)

Many thanks!
-- 
Michael Justin


From matthias at rabbitmq.com  Thu May 23 19:10:08 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 19:10:08 +0100
Subject: [rabbitmq-discuss] Fwd: RabbitMQ 3.0.4 send to temporary queue
 fails
In-Reply-To: <knllm8$cu5$1@ger.gmane.org>
References: <md5:GYw5vDqP1m4NNeb4elXl2w==> <519E4224.70708@gmx.net>
	<519E4837.7010907@rabbitmq.com> <knllm8$cu5$1@ger.gmane.org>
Message-ID: <519E5B80.9030608@rabbitmq.com>

Michael,

On 23/05/13 19:03, Michael Justin wrote:
> Matthias Radestock wrote:
>  > Why is the destination set to /temp-queue/... instead of
> /reply-queue/... ?
>
> Good catch. It was an error in my application code for the creation of
> the destination object.
>
> Now it works like a charm - Delphi RPC/STOMP server talks with Java AMQP
> client. (Tested with RabbitMQ 3.0.4)

Great. I'd still like to see the error that was written to the rabbit 
logs previously, so we can improve the error message that gets sent to 
the stomp client.

Matthias.

From michael.justin at gmx.net  Thu May 23 19:21:05 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 23 May 2013 20:21:05 +0200
Subject: [rabbitmq-discuss] Fwd: RabbitMQ 3.0.4 send to temporary queue
	fails
In-Reply-To: <519E5B80.9030608@rabbitmq.com>
References: <md5:GYw5vDqP1m4NNeb4elXl2w==> <519E4224.70708@gmx.net>
	<519E4837.7010907@rabbitmq.com> <knllm8$cu5$1@ger.gmane.org>
	<519E5B80.9030608@rabbitmq.com>
Message-ID: <knlmmc$pd0$1@ger.gmane.org>

Am 23.05.2013 20:10, Matthias Radestock wrote:

> Great. I'd still like to see the error that was written to the rabbit
> logs previously, so we can improve the error message that gets sent to
> the stomp client.

The error message in the log is:

=ERROR REPORT==== 23-May-2013::20:19:39 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error"
Server private detail: {function_clause,
                            [{rabbit_stomp_processor,ensure_queue,
                                 [send,
 
{temp_queue,"amq.gen-cjlV8rKmK9p0yAp21aTIFw"},
                                  {stomp_frame,"SEND",
                                      [{"content-type","text/plain"},
                                       {"correlation-id",
 
"ea1e263c-fbe9-441a-b9d2-e4ab04399072"},
                                       {"destination",
 
"/temp-queue/amq.gen-cjlV8rKmK9p0yAp21aTIFw"}],
                                      [<<"832040">>]},
                                  <0.277.0>,
                                  {set,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                       [],[],[]},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                        [],[],[]}}}],
                                 []},
                             {rabbit_stomp_processor,do_send,4,[]},
                             {rabbit_stomp_processor,process_request,3,[]},
                             {gen_server2,handle_msg,2,[]},
                             {proc_lib,wake_up,3,
                                 [{file,"proc_lib.erl"},{line,237}]}]}



-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From matthias at rabbitmq.com  Thu May 23 19:30:13 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 19:30:13 +0100
Subject: [rabbitmq-discuss] Fwd: RabbitMQ 3.0.4 send to temporary queue
 fails
In-Reply-To: <knlmmc$pd0$1@ger.gmane.org>
References: <md5:GYw5vDqP1m4NNeb4elXl2w==> <519E4224.70708@gmx.net>
	<519E4837.7010907@rabbitmq.com> <knllm8$cu5$1@ger.gmane.org>
	<519E5B80.9030608@rabbitmq.com> <knlmmc$pd0$1@ger.gmane.org>
Message-ID: <519E6035.1030408@rabbitmq.com>

Michael,

On 23/05/13 19:21, Michael Justin wrote:
> The error message in the log is: [...]

Turns out we fixed that already. From the 3.1.0 release notes:

25466 don't crash when SENDing to /temp-queue

Matthias.

From matthias at rabbitmq.com  Thu May 23 19:58:52 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 19:58:52 +0100
Subject: [rabbitmq-discuss] Memory grows very fast
In-Reply-To: <1369320280572-26957.post@n5.nabble.com>
References: <1368513277366-26650.post@n5.nabble.com>
	<1368515626832-26651.post@n5.nabble.com>
	<51921E5E.5000603@rabbitmq.com>
	<1368619663987-26710.post@n5.nabble.com>
	<1368620907646-26713.post@n5.nabble.com>
	<51938BF1.7070106@rabbitmq.com>
	<1368625779575-26720.post@n5.nabble.com>
	<51939483.5020305@rabbitmq.com>
	<1368703737826-26757.post@n5.nabble.com>
	<519528ED.5050205@rabbitmq.com>
	<1369320280572-26957.post@n5.nabble.com>
Message-ID: <519E66EC.8020003@rabbitmq.com>

Artur,

On 23/05/13 15:44, rabbit15 wrote:
> I see that on faster machine which has 32 CPU(Intel(R) Xeon(R) CPU E5-2670 0
> @ 2.60GHz) and 64GB RAM there can be store more messages about 10 milions.
> Previous machine was with 24 CPU (Intel(R) Xeon(R) CPU           X5675  @
> 3.07GHz) and 92 GB RAM and there could 600k -2500k stored messages.

That's probably just due to the changes in timing.

You are clearly putting rabbit under extreme load. In the status report 
you just posted, the system had been running for just ~12 minutes, yet 
there were 800+ open connections, taking up 1.3GB of memory between 
them. Now, connections only hold data very briefly, so this is a clear 
indication that the rabbit is heavily loaded. Furthermore, in an earlier 
report you posted, the run_queue sat at 148 - that's 148 Erlang 
processes waiting for a CPU to become free to do some work.

With such a usage, memory consumption will always be high.

> Maybe there is some option for GC ?

There are plenty of Erlang gc options to tweak. Usually that makes 
matters worse, but if you really want to go down that route then, for 
starters, try setting the ERL_FULLSWEEP_AFTER environment variable to 0 
or some other low value (the default is 65535) in 
/etc/rabbitmq/rabbitmq-env.conf, i.e.

export ERL_FULLSWEEP_AFTER 0

and restart rabbit.

You can confirm the setting took effect by running

$ rabbitmqctl eval 'erlang:system_info(fullsweep_after).'
{fullsweep_after,0}
...done.
$

Regards,

Matthias.

From mpietrek at skytap.com  Thu May 23 21:15:38 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 23 May 2013 13:15:38 -0700
Subject: [rabbitmq-discuss] Auto-delete queues not compatible with basic.get
	(vs. basic.consume)?
Message-ID: <CACLE7ixPuAff-v1QZd331kGORG-fsd58XfretN7bog2hELtuew@mail.gmail.com>

Working with RabbitMQ 3.1.

My code declares a queue as auto-delete, non-persistent. It then proceeds
to read a number of message from the queue using basic.get. I don't call
basic.consume however.

Eventually the code finishes and the connection goes away. The RabbitMQ
admin console shows no connections and no channels, but my queue was never
deleted.

I know auto-deletion has to do with consumers, but from my perspective, my
code is certainly consuming messages, and the channels/connections are
definitely going away.

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/e03d0452/attachment.htm>

From n16483 at cray.com  Thu May 23 21:28:09 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Thu, 23 May 2013 15:28:09 -0500
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
Message-ID: <519E7BD9.60902@cray.com>

I am having an issue configuring Federation and passwordless-ssl login. 
Federation is using https. Seems if I enable the ssl config option 
{fail_if_no_peer_cert,true}, peer brokers get a SSL connection error 
when trying to establish the Federation. Even though I'm setting my SSL 
keys and certs in the rabbitmq config, I'm guessing that Federation 
isn't using the configured certs? Is there a way to configure the client 
and CA cert's to use with Federation?

Eric

Below is my (simplified) configuration.

[
   {rabbit,
     [
       {hipe_compile, true},
       {tcp_listen_options,
         [binary,
           {packet,raw},
           {reuseaddr,true},
           {backlog,128},
           {nodelay,true},
           {exit_on_close,false}
         ]
       },
       {ssl_listeners, [5671]},
       {ssl_options, [{cacertfile,"/opt/cray/ssl/testca/cacert.pem"},
                      {certfile,"/opt/cray/ssl/server-01/cert.pem"},
                      {keyfile,"/opt/cray/ssl/server-01/key.pem"},
                      {verify,verify_peer},
                      {fail_if_no_peer_cert,false}
                     ]
       }
     ]
   }
].


From michael.s.klishin at gmail.com  Thu May 23 21:38:56 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 24 May 2013 00:38:56 +0400
Subject: [rabbitmq-discuss] Auto-delete queues not compatible with
 basic.get (vs. basic.consume)?
In-Reply-To: <CACLE7ixPuAff-v1QZd331kGORG-fsd58XfretN7bog2hELtuew@mail.gmail.com>
References: <CACLE7ixPuAff-v1QZd331kGORG-fsd58XfretN7bog2hELtuew@mail.gmail.com>
Message-ID: <CAE3HoVRtc=9xgV39EH1dVWcsrSP+9RNnoCzAmmJMpJB8gfbcLw@mail.gmail.com>

2013/5/24 Matt Pietrek <mpietrek at skytap.com>

> Eventually the code finishes and the connection goes away. The RabbitMQ
> admin console shows no connections and no channels, but my queue was never
> deleted.


Auto-deleted queues are deleted the last consumer is cancelled or goes
away. If there were no
consumers at all, it won't be deleted.

Exclusive queues will be deleted when
the connection that created them is closed (but they also can't be shared).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130524/456ebbcf/attachment.htm>

From colleen at surfmerchants.com  Thu May 23 21:45:17 2013
From: colleen at surfmerchants.com (Colleen Mirabello)
Date: Thu, 23 May 2013 16:45:17 -0400
Subject: [rabbitmq-discuss] Graceful shutdown of blocking consumers in PHP?
Message-ID: <519E7FDD.9090608@surfmerchants.com>

(PHP 5.33, AMQP protocol 0-9-1, librabbitmq 0.0.1, phpamqp 1.0.9)

I'm having trouble figuring out how to gracefully shut down a blocking 
PHP consumer.

The context of this problem is that we would like to create a script 
that forks many consumer children based on a configuration file. That 
script will then monitor its children and restart them should any fail. 
We would also like to be able to kill this parent script and have it 
stop and kill its children and then exit.

Our preference is to use consume() rather than get() if possible.

The problem we're having is how to get a signal to the child processes 
to get them to stop consuming.

A very simple example script (with connection info removed):

<?php
// so we can catch system calls...
declare(ticks=1);

pcntl_signal(SIGTERM, array('RunControl', 'sysCalls'));
pcntl_signal(SIGHUP, array('RunControl', 'sysCalls'));
pcntl_signal(SIGUSR1, array('RunControl', 'sysCalls'));


class RunControl
{
     static $alive = true;

     // catch system calls
     function sysCalls($signal)
     {
         print "Got signal to die\n";
     }
}

function consume($message, $queue)
{
     print "Got a message!\n";
     $queue->ack($message->getDeliveryTag());
}


$connection = new AMQPConnection($connectionInfo);
$connection->connect();

$channel = new AMQPChannel($connection);
$queue = new AMQPQueue($channel);

$queue->setName('my_queue');

$queue->consume('consume');
?>

If I run this script, the consumer will happily consume messages. 
However, executing a kill command on its pid does not cause the "Got 
signal to die" message to print.

I have tried using $queue->cancel() in many different configurations 
(within the same script, in another script, with a consumer tag, 
without), but it doesn't seem to do anything.

I tried the workaround described here: 
http://blog.andrewrose.co.uk/2008/02/php-getting-signals-through-to-blocking.html 
and it resulted in a whole bunch of "interrupted system call" exceptions.

Does anyone have any suggestions for how I can get my consumer to exit 
gracefully? Thanks.

     - Colleen


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/12f9abd0/attachment.htm>

From mpietrek at skytap.com  Thu May 23 21:47:23 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 23 May 2013 13:47:23 -0700
Subject: [rabbitmq-discuss] Auto-delete queues not compatible with
 basic.get (vs. basic.consume)?
In-Reply-To: <CAE3HoVRtc=9xgV39EH1dVWcsrSP+9RNnoCzAmmJMpJB8gfbcLw@mail.gmail.com>
References: <CACLE7ixPuAff-v1QZd331kGORG-fsd58XfretN7bog2hELtuew@mail.gmail.com>
	<CAE3HoVRtc=9xgV39EH1dVWcsrSP+9RNnoCzAmmJMpJB8gfbcLw@mail.gmail.com>
Message-ID: <CACLE7iztzWiWqZ+FM4jp0U0CCKS0bcix7kDDudB=bSHCUiOHqg@mail.gmail.com>

Thanks for the clarification Michael.

Another follow up question: What exactly is meant by "they can't be
shared"? Is the exclusivity limited to reading, or does it encompass both
reading and writing?

In my case, I'm constructing an RPC scenario. The queue I'm creating is for
the reply to come in on. Some other process using some other connection
must be able to write to it.






On Thu, May 23, 2013 at 1:38 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> 2013/5/24 Matt Pietrek <mpietrek at skytap.com>
>
>> Eventually the code finishes and the connection goes away. The RabbitMQ
>> admin console shows no connections and no channels, but my queue was never
>> deleted.
>
>
> Auto-deleted queues are deleted the last consumer is cancelled or goes
> away. If there were no
> consumers at all, it won't be deleted.
>
> Exclusive queues will be deleted when
> the connection that created them is closed (but they also can't be shared).
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/6a83c37b/attachment.htm>

From michael.s.klishin at gmail.com  Thu May 23 21:57:43 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 24 May 2013 00:57:43 +0400
Subject: [rabbitmq-discuss] Auto-delete queues not compatible with
 basic.get (vs. basic.consume)?
In-Reply-To: <CACLE7iztzWiWqZ+FM4jp0U0CCKS0bcix7kDDudB=bSHCUiOHqg@mail.gmail.com>
References: <CACLE7ixPuAff-v1QZd331kGORG-fsd58XfretN7bog2hELtuew@mail.gmail.com>
	<CAE3HoVRtc=9xgV39EH1dVWcsrSP+9RNnoCzAmmJMpJB8gfbcLw@mail.gmail.com>
	<CACLE7iztzWiWqZ+FM4jp0U0CCKS0bcix7kDDudB=bSHCUiOHqg@mail.gmail.com>
Message-ID: <CAE3HoVRjumHM9QxMkLz1Mmddqh__gtB+WgEyRM8q7JLjZg8_BA@mail.gmail.com>

2013/5/24 Matt Pietrek <mpietrek at skytap.com>

> Another follow up question: What exactly is meant by "they can't be
> shared"? Is the exclusivity limited to reading, or does it encompass both
> reading and writing?
>
>
any operation on the queue


> In my case, I'm constructing an RPC scenario. The queue I'm creating is
> for the reply to come in on. Some other process using some other connection
> must be able to write to it.


exclusive queues are perfectly fine for collecting replies
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130524/485da6c9/attachment.htm>

From matthias at rabbitmq.com  Thu May 23 22:18:56 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 May 2013 22:18:56 +0100
Subject: [rabbitmq-discuss] Auto-delete queues not compatible with
 basic.get (vs. basic.consume)?
In-Reply-To: <CAE3HoVRjumHM9QxMkLz1Mmddqh__gtB+WgEyRM8q7JLjZg8_BA@mail.gmail.com>
References: <CACLE7ixPuAff-v1QZd331kGORG-fsd58XfretN7bog2hELtuew@mail.gmail.com>
	<CAE3HoVRtc=9xgV39EH1dVWcsrSP+9RNnoCzAmmJMpJB8gfbcLw@mail.gmail.com>
	<CACLE7iztzWiWqZ+FM4jp0U0CCKS0bcix7kDDudB=bSHCUiOHqg@mail.gmail.com>
	<CAE3HoVRjumHM9QxMkLz1Mmddqh__gtB+WgEyRM8q7JLjZg8_BA@mail.gmail.com>
Message-ID: <519E87C0.5070304@rabbitmq.com>

On 23/05/13 21:57, Michael Klishin wrote:
>
> 2013/5/24 Matt Pietrek <mpietrek at skytap.com <mailto:mpietrek at skytap.com>>
>
>     Another follow up question: What exactly is meant by "they can't be
>     shared"? Is the exclusivity limited to reading, or does it encompass
>     both reading and writing?
>
>
> any operation on the queue

More specifically, any queue.* method in AMQP.

Note that publishers never 'write' to queues but publish messages to 
exchanges. So they are not affected by a queue's exclusivity.

Matthias.

From mpietrek at skytap.com  Thu May 23 22:23:59 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 23 May 2013 14:23:59 -0700
Subject: [rabbitmq-discuss] Auto-delete queues not compatible with
 basic.get (vs. basic.consume)?
In-Reply-To: <519E87C0.5070304@rabbitmq.com>
References: <CACLE7ixPuAff-v1QZd331kGORG-fsd58XfretN7bog2hELtuew@mail.gmail.com>
	<CAE3HoVRtc=9xgV39EH1dVWcsrSP+9RNnoCzAmmJMpJB8gfbcLw@mail.gmail.com>
	<CACLE7iztzWiWqZ+FM4jp0U0CCKS0bcix7kDDudB=bSHCUiOHqg@mail.gmail.com>
	<CAE3HoVRjumHM9QxMkLz1Mmddqh__gtB+WgEyRM8q7JLjZg8_BA@mail.gmail.com>
	<519E87C0.5070304@rabbitmq.com>
Message-ID: <CACLE7izTD=ukJmXRm2giqGVRXg52uWbqra6bqt5rrWKizmke3w@mail.gmail.com>

Thanks Matthias - You cleared up my point of confusion.

Specifically, that because messages are written to an exchange rather than
a queue, the publisher doesn't "touch" the queue.

This is an important but subtle point. I may have overlooked it, but I
don't recall it being highlighted anywhere in the docs.

Matt


On Thu, May 23, 2013 at 2:18 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 23/05/13 21:57, Michael Klishin wrote:
>
>>
>> 2013/5/24 Matt Pietrek <mpietrek at skytap.com <mailto:mpietrek at skytap.com>>
>>
>>
>>     Another follow up question: What exactly is meant by "they can't be
>>     shared"? Is the exclusivity limited to reading, or does it encompass
>>     both reading and writing?
>>
>>
>> any operation on the queue
>>
>
> More specifically, any queue.* method in AMQP.
>
> Note that publishers never 'write' to queues but publish messages to
> exchanges. So they are not affected by a queue's exclusivity.
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/c17daaf1/attachment.htm>

From videlalvaro at gmail.com  Thu May 23 22:41:28 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 23 May 2013 23:41:28 +0200
Subject: [rabbitmq-discuss] Graceful shutdown of blocking consumers in
	PHP?
In-Reply-To: <519E7FDD.9090608@surfmerchants.com>
References: <519E7FDD.9090608@surfmerchants.com>
Message-ID: <CAMcAHLXX91sSGG_PELGhBVTm_5PGFeu2oJu-UY79+Xq_rFAM4A@mail.gmail.com>

Hi,

Using that library, can you consume from more than one queue? If yes, then
you could send control messages to the script and make it stop.

With php-amqplib since the while loop is part of user land code, you can
control all the consuming parts on your own so this wouldn't be a problem.

Regards,

Alvaro


On Thu, May 23, 2013 at 10:45 PM, Colleen Mirabello <
colleen at surfmerchants.com> wrote:

>  (PHP 5.33, AMQP protocol 0-9-1, librabbitmq 0.0.1, phpamqp 1.0.9)
>
> I'm having trouble figuring out how to gracefully shut down a blocking PHP
> consumer.
>
> The context of this problem is that we would like to create a script that
> forks many consumer children based on a configuration file. That script
> will then monitor its children and restart them should any fail. We would
> also like to be able to kill this parent script and have it stop and kill
> its children and then exit.
>
> Our preference is to use consume() rather than get() if possible.
>
> The problem we're having is how to get a signal to the child processes to
> get them to stop consuming.
>
> A very simple example script (with connection info removed):
>
> <?php
> // so we can catch system calls...
> declare(ticks=1);
>
> pcntl_signal(SIGTERM, array('RunControl', 'sysCalls'));
> pcntl_signal(SIGHUP, array('RunControl', 'sysCalls'));
> pcntl_signal(SIGUSR1, array('RunControl', 'sysCalls'));
>
>
> class RunControl
> {
>     static $alive = true;
>
>     // catch system calls
>     function sysCalls($signal)
>     {
>         print "Got signal to die\n";
>     }
> }
>
> function consume($message, $queue)
> {
>     print "Got a message!\n";
>     $queue->ack($message->getDeliveryTag());
> }
>
>
> $connection = new AMQPConnection($connectionInfo);
> $connection->connect();
>
> $channel = new AMQPChannel($connection);
> $queue = new AMQPQueue($channel);
>
> $queue->setName('my_queue');
>
> $queue->consume('consume');
> ?>
>
> If I run this script, the consumer will happily consume messages. However,
> executing a kill command on its pid does not cause the "Got signal to die"
> message to print.
>
> I have tried using $queue->cancel() in many different configurations
> (within the same script, in another script, with a consumer tag, without),
> but it doesn't seem to do anything.
>
> I tried the workaround described here:
> http://blog.andrewrose.co.uk/2008/02/php-getting-signals-through-to-blocking.html
> and it resulted in a whole bunch of "interrupted system call" exceptions.
>
> Does anyone have any suggestions for how I can get my consumer to exit
> gracefully? Thanks.
>
>     - Colleen
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/5aad3dd8/attachment.htm>

From vikram.vis at gmail.com  Thu May 23 22:44:19 2013
From: vikram.vis at gmail.com (Vikram Viswanathan)
Date: Thu, 23 May 2013 14:44:19 -0700
Subject: [rabbitmq-discuss] [java-client] Is there a full working
 example of "DefaultConsumer" without *deprecated * QueueingConsumer ?
In-Reply-To: <519E33A3.9010700@rabbitmq.com>
References: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
	<5190BF33.1010902@rabbitmq.com>
	<1369255851048-26944.post@n5.nabble.com>
	<519E33A3.9010700@rabbitmq.com>
Message-ID: <519E8DB3.2050308@gmail.com>

Thanks. I found that that there was a previously not closed consumer for 
the same queue and that was consuming the message. Everything works now.

-Vikram

On 05/23/2013 08:20 AM, Matthias Radestock wrote:
> On 22/05/13 21:50, vikram wrote:
>> I am having a similar issue. In my callback I only get 2 messages  
>> and no
>> more. The only difference is that I do client acknowledge and 
>> acknowledge
>> only after some time. I do not acknowledge immediately after a message
>> arrives. Would this be a problem ?
>
> Please post some self-contained code that exhibits the problem you are 
> seeing.
>
> Matthias.


From francesco at rabbitmq.com  Fri May 24 00:34:05 2013
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 24 May 2013 00:34:05 +0100
Subject: [rabbitmq-discuss] One node in a cluster never fully starts up
In-Reply-To: <CACLE7izKYNKDkxPNDNZgF9cCc8PP+6qHnPoA0zop1zNnyhQFmg@mail.gmail.com>
References: <CACLE7ixg=3z1DRg+jZVrwfULrkJiFbNWA15UQP1_QFbHo_N6ng@mail.gmail.com>
	<87r4ryc138.wl%francesco@rabbitmq.com>
	<CACLE7izfttKxd4kEBt9uriR1O+-o=_Qx9o=OGBZ+LUbEDf8efQ@mail.gmail.com>
	<CACLE7izKYNKDkxPNDNZgF9cCc8PP+6qHnPoA0zop1zNnyhQFmg@mail.gmail.com>
Message-ID: <87zjvlmfte.wl%francesco@rabbitmq.com>

Hi Matt!

I haven?t looked at RabbitMQ for a while, so my answers might be outdated and/or
wrong, but since I gave the original answers I?m going to give it a shot :).

> I know that sequentially is the ideal situation, but in the case of an
> uncontrolled shutdown, it doesn't reliably start, as the first node may
> time out waiting for a later node.
> 
> When this happens, starting the nodes in parallel gets past the problem.
> However, my understanding is that this has its own risks. (See my original
> first message in this thread.)
> 
> At the end of the day, we just need a set of scripts that will idempotently
> start/stop the cluster reliably. It's infeasible to expect an operator
> (i.e. not me) to assess the current cluster state and then guess which
> approach to take.
> 
> Has the guidance changed between 2.8.4 and 3.1.1? I know it's basically a
> mnesia issue - I just don't know what improvements have been made since
> 2.8.4.

The improvements consist in the fact that the operations are safer now.  It goes
more or less like this: when the node starts up it asks the other nodes (?other
nodes? in this case being the ones in the config file) for the cluster they are
in, and then joins it if the other nodes are consistent in terms of Erlang and
RabbitMQ versions.

This opens up a race condition if the clusters start together: in the startup
sequence they all ask each other out for the cluster, but since they?re still
not fully started that they might all (or some) get inconclusive replies.  Thus
the cluster might not form fully.  There surely are other negative outcomes that
I am misremembering, but since RabbitMQ 3 it should be fairly hard (or at least
harder) to get catastrophic results (e.g. mnesia panics).  This is because in
the past RabbitMQ blindly clustered with the other nodes without really
bothering to check if it made sense to do so.

The situation is a tricky one to solve with an interface similar to the one that
we have now, and within the constraints of mnesia.  One can probably devise
ad-hoc solution if your assumptions are stronger than the ones we make in the
code, e.g. you might check after a bit if the nodes are really clustered and
take action if they are not.

Hopefully the above was helpful, you might want to wait for others for more
precise answers :).

Francesco

From sezcurra at gmail.com  Fri May 24 00:37:17 2013
From: sezcurra at gmail.com (Santiago Ezcurra)
Date: Thu, 23 May 2013 16:37:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Naming RabbitMQ nodes with complete domain
 names
In-Reply-To: <4D6049A5.1030204@rabbitmq.com>
References: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>	<6E4EDE37-C738-47D3-AEEE-B8E002073098@gmail.com>	<AANLkTimOPtEdSi4gTca4u8UvHfPQk+0=tT++C-1MtXK4@mail.gmail.com>	<DB37F2C2-7A68-406C-8099-9AD26771CDAD@gmail.com>
	<AANLkTi=jAO3GqPePoW0v_0NqyhQKHWEjZsH27S93Meq5@mail.gmail.com>
	<4D6049A5.1030204@rabbitmq.com>
Message-ID: <b5753ad7-50be-48e1-8d59-eccf7316867e@googlegroups.com>

Hi there.....I know this is old thread, but I'm having the same 
problem.....the thing is that I'm trying to build a cluster on amazon ec2. 
there, there is no domain and the machines only have a hostname of the form 
ip-0-0-0-0. everything works fine for one node (and erlang starts with 
-name rabbit at ip-x-x-x-x), but when i try to join cluster to another node, 
there is no name resolution happening between both machines (other than 
specifying mutually on respectives ec/hosts). 
those machines does recognize the name *ip-x-x-x-x.ec2.internal*....but I'm 
just failing to configure this name. When i tried specifying this long name 
in NODENAME in env file, it's when erlang (or rabbitmq, don't know) 
complains with "can't get short name whatever". and maybe it's because the 
newer version, but I can't find where to change the -sname by -name in any 
scripts.....could you please have any advice for me ??

Thanks !

Santiago.



On Saturday, February 19, 2011 7:52:21 PM UTC-3, Matthias Radestock wrote:
>
> Max,
>
> Max Bridgewater wrote:
> > Thanks Alvaro. Unfortunately this still doesn't work for me. The steps
> > I followed are:
> > 
> > a) Stop rabbitmq
> > b) Change the option -sname to -name in rabbitmq-multi
>
> You'd also need to change this in rabbitmq-server.
>
> However, ...
>
> >>>>> The original issue is this: I'm trying to use JInterface to connect 
> to
> >>>>> a rabbitmq cluster hosted on EC2. But I keep getting "Cannot connect
> >>>>> to peer node". My understanding is that this error is happening
> >>>>> because I'm using the address 'rab... at domain.org <javascript:>' to 
> contact the
> >>>>> remote RabbitMQ node named: rabbit at domain. (Note the missing TLD).
> >>>>> That is, because there is no exact  match between the node name given
> >>>>> to JInterface and the name of the node it is connecting to, the
> >>>>> connection fails.
> >>>>>
> >>>>> I desperately tried configuring RabbitMQ to take the complete domain
> >>>>> name (domain.org) instead of just the short domain name (domain). 
> Any
> >>>>> suggestion on how to resolve this issue?
>
> I'd suggest configuring your local name resolution s.t. the hostname of 
> the machine rabbit is running on resolves to the correct IP. That way 
> you don't have to mess with long names.
>
> Btw, what are you trying to accomplish with JInterface?
>
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130523/1f3748d4/attachment.htm>

From simlu at su.se  Fri May 24 08:15:51 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Fri, 24 May 2013 09:15:51 +0200
Subject: [rabbitmq-discuss] Management access log rotation
Message-ID: <20130524071551.GP292@kaka.it.su.se>

Morning,

Would it possible to get the managements access log to write itself to
one file like <nodename>{,-sasl}.log so that it can more easily be
rotated and compress with logrotate(1)?

I'd rather not have to cron a find to compress and delete files.

Br,
- Simon

____________________________________

Simon Lundstr?m
Section for Infrastructure

IT Services
Stockholm University
SE-106 91 Stockholm, Sweden

www.su.se/it

____________________________________

From niks at osic.rs  Fri May 24 09:29:41 2013
From: niks at osic.rs (Nikola Savic)
Date: Fri, 24 May 2013 10:29:41 +0200
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <519E185A.2080001@rabbitmq.com>
References: <CDBE4A18.9B54%Michael.Laing@nytimes.com>
	<5198DC48.7080606@osic.rs> <519E185A.2080001@rabbitmq.com>
Message-ID: <519F24F5.9000801@osic.rs>


I found one benchmark of different MQ servers, which included STOMP and 
AMQP on RabbitMQ. STOMP was much slower :(

http://x-aeon.com/wp/2013/04/10/a-quick-message-queue-benchmark-activemq-rabbitmq-hornetq-qpid-apollo/

Will try to implement STOMP on producers and will let you know if it 
works better from client and server point of view :)

On 05/23/2013 03:23 PM, Matthias Radestock wrote:
> Nikola,
>
> On 19/05/13 15:06, Nikola Savic wrote:
>> Would STOMP be better approach to connect to RabbitMQ from PHP?
>
> STOMP's connection establishment handshake has fewer steps, so for a 
> connect-publish-disconnect scenario might well be quicker than AMQP. 
> Though the only way to be sure is to test it :)
>
> Matthias.
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130524/93b78c7a/attachment.htm>

From matthias at rabbitmq.com  Fri May 24 09:36:25 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 May 2013 09:36:25 +0100
Subject: [rabbitmq-discuss] Expected msg/s per CPU core
In-Reply-To: <519F24F5.9000801@osic.rs>
References: <CDBE4A18.9B54%Michael.Laing@nytimes.com>
	<5198DC48.7080606@osic.rs> <519E185A.2080001@rabbitmq.com>
	<519F24F5.9000801@osic.rs>
Message-ID: <519F2689.9080405@rabbitmq.com>

On 24/05/13 09:29, Nikola Savic wrote:
>
> I found one benchmark of different MQ servers, which included STOMP and
> AMQP on RabbitMQ. STOMP was much slower :(
>
> http://x-aeon.com/wp/2013/04/10/a-quick-message-queue-benchmark-activemq-rabbitmq-hornetq-qpid-apollo/
>
> Will try to implement STOMP on producers and will let you know if it
> works better from client and server point of view :)

That benchmark didn't test your specific usage pattern, namely 
connect-send-disconnect-repeat. It also didn't run PHP on the client 
side. Hence it really isn't a good basis of comparison for your workload.


Matthias.

From simon at rabbitmq.com  Fri May 24 11:02:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 May 2013 11:02:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <519E7BD9.60902@cray.com>
References: <519E7BD9.60902@cray.com>
Message-ID: <519F3AB1.3040804@rabbitmq.com>

Hi. Are you setting the various SSL options in the URIs? See 
http://www.rabbitmq.com/shovel.html#uris for the URI format. Federation 
uses the AMQP client, which doesn't get its SSL options from the 
configuration file.

Cheers, Simon

On 23/05/13 21:28, Eric Cozzi wrote:
> I am having an issue configuring Federation and passwordless-ssl login.
> Federation is using https. Seems if I enable the ssl config option
> {fail_if_no_peer_cert,true}, peer brokers get a SSL connection error
> when trying to establish the Federation. Even though I'm setting my SSL
> keys and certs in the rabbitmq config, I'm guessing that Federation
> isn't using the configured certs? Is there a way to configure the client
> and CA cert's to use with Federation?
>
> Eric
>
> Below is my (simplified) configuration.
>
> [
>    {rabbit,
>      [
>        {hipe_compile, true},
>        {tcp_listen_options,
>          [binary,
>            {packet,raw},
>            {reuseaddr,true},
>            {backlog,128},
>            {nodelay,true},
>            {exit_on_close,false}
>          ]
>        },
>        {ssl_listeners, [5671]},
>        {ssl_options, [{cacertfile,"/opt/cray/ssl/testca/cacert.pem"},
>                       {certfile,"/opt/cray/ssl/server-01/cert.pem"},
>                       {keyfile,"/opt/cray/ssl/server-01/key.pem"},
>                       {verify,verify_peer},
>                       {fail_if_no_peer_cert,false}
>                      ]
>        }
>      ]
>    }
> ].
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 24 11:04:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 May 2013 11:04:58 +0100
Subject: [rabbitmq-discuss] Management access log rotation
In-Reply-To: <20130524071551.GP292@kaka.it.su.se>
References: <20130524071551.GP292@kaka.it.su.se>
Message-ID: <519F3B4A.4090509@rabbitmq.com>

Hi.

I'm afraid the management logs are just what's available from 
Webmachine, which offers very little configurability.

We've got a bug open to do our own HTTP logging, but I don't know how 
many people care. Does anyone else want to speak up?

Cheers, Simon

On 24/05/13 08:15, Simon Lundstr?m wrote:
> Morning,
>
> Would it possible to get the managements access log to write itself to
> one file like <nodename>{,-sasl}.log so that it can more easily be
> rotated and compress with logrotate(1)?
>
> I'd rather not have to cron a find to compress and delete files.
>
> Br,
> - Simon
>
> ____________________________________
>
> Simon Lundstr?m
> Section for Infrastructure
>
> IT Services
> Stockholm University
> SE-106 91 Stockholm, Sweden
>
> www.su.se/it
>
> ____________________________________
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From colleen at surfmerchants.com  Fri May 24 14:31:22 2013
From: colleen at surfmerchants.com (Colleen Mirabello)
Date: Fri, 24 May 2013 09:31:22 -0400
Subject: [rabbitmq-discuss] Graceful shutdown of blocking consumers in
 PHP?
In-Reply-To: <CAMcAHLXX91sSGG_PELGhBVTm_5PGFeu2oJu-UY79+Xq_rFAM4A@mail.gmail.com>
References: <519E7FDD.9090608@surfmerchants.com>
	<CAMcAHLXX91sSGG_PELGhBVTm_5PGFeu2oJu-UY79+Xq_rFAM4A@mail.gmail.com>
Message-ID: <519F6BAA.5050404@surfmerchants.com>

Alvaro,

Using that library, I don't believe there's a way to get the same script 
to consume from multiple queues using consume(). Once you call 
consume(), the script blocks waiting for messages from that queue.

Thanks.

     - Colleen


On 5/23/2013 5:41 PM, Alvaro Videla wrote:
> Hi,
>
> Using that library, can you consume from more than one queue? If yes, 
> then you could send control messages to the script and make it stop.
>
> With php-amqplib since the while loop is part of user land code, you 
> can control all the consuming parts on your own so this wouldn't be a 
> problem.
>
> Regards,
>
> Alvaro
>

From sabrina.kuehn90 at web.de  Fri May 24 14:33:46 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Fri, 24 May 2013 06:33:46 -0700 (PDT)
Subject: [rabbitmq-discuss] User permission
Message-ID: <1369402426514-26987.post@n5.nabble.com>

Hi,
I have an understanding problem because of the user permissions.

My senario:
I have a cluster, I have queues, ...
I have users who should have there own queues, which only they and I should
can see AND all of them should have permissions to send msg to a special
queue and only one user (me) should have the permission to receive.

Can someone help me to create this permissions in the web UI or console?

I tried it a few times but no matter what I try my test user could see
everything he couldn't change the conf but... not like I wanted.

(Perhaps I have to create vhosts, but I don't know.) 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/User-permission-tp26987.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Fri May 24 14:40:23 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 24 May 2013 15:40:23 +0200
Subject: [rabbitmq-discuss] Graceful shutdown of blocking consumers in
	PHP?
In-Reply-To: <519F6BAA.5050404@surfmerchants.com>
References: <519E7FDD.9090608@surfmerchants.com>
	<CAMcAHLXX91sSGG_PELGhBVTm_5PGFeu2oJu-UY79+Xq_rFAM4A@mail.gmail.com>
	<519F6BAA.5050404@surfmerchants.com>
Message-ID: <CAMcAHLX3WcxDgqJf7BgMq-wm9jN15ta91GGm_j2UvmGez2sGtA@mail.gmail.com>

While I'm biased by being the maintainer of php-amqplib, one thing I like
from that library is the ability to have multiple consumers on the same PHP
script.


On Fri, May 24, 2013 at 3:31 PM, Colleen Mirabello <
colleen at surfmerchants.com> wrote:

> Alvaro,
>
> Using that library, I don't believe there's a way to get the same script
> to consume from multiple queues using consume(). Once you call consume(),
> the script blocks waiting for messages from that queue.
>
> Thanks.
>
>     - Colleen
>
>
>
> On 5/23/2013 5:41 PM, Alvaro Videla wrote:
>
>> Hi,
>>
>> Using that library, can you consume from more than one queue? If yes,
>> then you could send control messages to the script and make it stop.
>>
>> With php-amqplib since the while loop is part of user land code, you can
>> control all the consuming parts on your own so this wouldn't be a problem.
>>
>> Regards,
>>
>> Alvaro
>>
>>  ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130524/15a4910a/attachment.htm>

From n16483 at cray.com  Fri May 24 14:51:14 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Fri, 24 May 2013 08:51:14 -0500
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <519F3AB1.3040804@rabbitmq.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
Message-ID: <519F7052.6030301@cray.com>

A-ha! That's exactly what I was missing. Thanks!

Eric

On 05/24/2013 05:02 AM, Simon MacMullen wrote:
> Hi. Are you setting the various SSL options in the URIs? See 
> http://www.rabbitmq.com/shovel.html#uris for the URI format. 
> Federation uses the AMQP client, which doesn't get its SSL options 
> from the configuration file.
>
> Cheers, Simon
>
> On 23/05/13 21:28, Eric Cozzi wrote:
>> I am having an issue configuring Federation and passwordless-ssl login.
>> Federation is using https. Seems if I enable the ssl config option
>> {fail_if_no_peer_cert,true}, peer brokers get a SSL connection error
>> when trying to establish the Federation. Even though I'm setting my SSL
>> keys and certs in the rabbitmq config, I'm guessing that Federation
>> isn't using the configured certs? Is there a way to configure the client
>> and CA cert's to use with Federation?
>>
>> Eric
>>
>> Below is my (simplified) configuration.
>>
>> [
>>    {rabbit,
>>      [
>>        {hipe_compile, true},
>>        {tcp_listen_options,
>>          [binary,
>>            {packet,raw},
>>            {reuseaddr,true},
>>            {backlog,128},
>>            {nodelay,true},
>>            {exit_on_close,false}
>>          ]
>>        },
>>        {ssl_listeners, [5671]},
>>        {ssl_options, [{cacertfile,"/opt/cray/ssl/testca/cacert.pem"},
>>                       {certfile,"/opt/cray/ssl/server-01/cert.pem"},
>>                       {keyfile,"/opt/cray/ssl/server-01/key.pem"},
>>                       {verify,verify_peer},
>>                       {fail_if_no_peer_cert,false}
>>                      ]
>>        }
>>      ]
>>    }
>> ].
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From iain.hull at workday.com  Fri May 24 15:35:07 2013
From: iain.hull at workday.com (Iain Hull)
Date: Fri, 24 May 2013 15:35:07 +0100
Subject: [rabbitmq-discuss] Monitoring for busy_dist_port
In-Reply-To: <519B86E8.4020102@rabbitmq.com>
References: <CANum3oXEbm6Xyy98-Jif09HbkEWB6bYGiwWN4ZNF55af9OJRtg@mail.gmail.com>
	<519B86E8.4020102@rabbitmq.com>
Message-ID: <CANum3oVQZ_jORuEFp6QH6=kxb0OjN==GSx3M7OuDAhk3RA+Lvg@mail.gmail.com>

Hi Simon, Tim,

Thanks for your replies and effort analysing my query.

On Riak we have experienced stability issues when large data is
being transferred.  I am not too sure the exact root cause, but we see
busy_dist_port messages then one of the Riak nodes crashes and has to be
restarted by Chef.  Increasing "+zdbbl 18432" resolved this issue.

This contains more information about Riak and this setting
http://boundary.com/blog/2012/09/26/incuriosity-killed-the-infrastructur/

We have not seen any stability issues with our use of RabbitMQ to date.
After our Riak experience I was concerned if our RabbitMQ usage pattern
changes over time (for example message sizes increase), we could experience
similar stability issues too.  If there is a chance of this I would like to
be warned before its a problem.

Iain.


On 21 May 2013 15:38, Simon MacMullen <simon at rabbitmq.com> wrote:

> To add to what Tim said: I've run some tests with busy_dist_port
> monitoring patched into RabbitMQ and while I can certainly see
> busy_dist_port messages, I haven't been able to demonstrate any improvement
> in throughput by tweaking zdbbl until they went away - so I don't see the
> point in exposing them.
>
> Out of interest, did you see a performance improvement in Riak after
> modifying zdbbl, or were you just trying to make the warnings go away? :-)
>
> Cheers, Simon
>
>
> On 20/05/13 12:15, Iain Hull wrote:
>
>> We are in the process of deploying a Riak cluster, and are wondering if
>> some of the lessons we learned monitoring Erlang in Riak should be
>> applied to RabbitMQ.
>>
>> During testing we noticed a lot of busy_dist_port in the logs, the root
>> was cause was a the Erlang kernel parameter zdbbl was set too low.  We
>> have adjusted the parameter and are now monitoring the logs for
>> busy_dist_port errors.
>>
>> I have searched the RabbitMQ mailing list for cases of busy_dist_port or
>> zdbbl, but cannot find any.  I am wondering if RabbitMQ can suffer from
>> problems with busy_dist_port or if zdbbl should be set to any particular
>> value? Or I should I monitor the RabbitMQ logs for busy_dist_port?
>>
>> Thanks,
>> Iain.
>>
>> --
>> Iain Hull
>> Senior Software Engineer
>> iain.hull.workday (Skype)
>> iain.hull at workday.com <mailto:iain.hull at workday.com>
>>
>> <http://www.workday.com/**signature-uk<http://www.workday.com/signature-uk>
>> >
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
Iain Hull
Senior Software Engineer
iain.hull.workday (Skype)
iain.hull at workday.com

<http://www.workday.com/signature-uk>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130524/e536b9e2/attachment.htm>

From simlu at su.se  Fri May 24 15:43:09 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Fri, 24 May 2013 16:43:09 +0200
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <5097C8CF.6050901@rabbitmq.com>
References: <20121019100118.GB1210@kaka.it.su.se>
	<508149DB.7010701@rabbitmq.com>
	<20121029160441.GI426@kaka.it.su.se>
	<508FB1AF.8060003@rabbitmq.com>
	<20121030110101.GK426@kaka.it.su.se>
	<508FB59F.9030807@rabbitmq.com>
	<20121030121229.GM426@kaka.it.su.se>
	<5097C8CF.6050901@rabbitmq.com>
Message-ID: <20130524144308.GQ292@kaka.it.su.se>

On Mon, 2012-11-05 at 14:10:23 +0000, Simon MacMullen wrote:
> On 30/10/12 12:12, Simon Lundstr?m wrote:
> >So basically:
> >
> >Parse the config/defaults in this order:
> ># defaults from default_options hash^Wdictionary
> ># config file
> >## Find out which config file to use, one of:
> >### specified via --config
> >#### Use it and exit with an error if it doesn't exist
> >### default config file (~/.rabbitmqadmin.conf)
> >#### If file doesn't exist, just ignore it.
> >## If node doesn't exist in config and is:
> >### specified via commandline
> >#### Display error and exit
> >### using the default node
> >#### ignore the config file entirely
> ># Options on the command line
> 
> Yes, I think that makes sense.

Sorry for taking so long, been busy on other things = )

I've patched this and created a PR on Github (see
<https://github.com/rabbitmq/rabbitmq-management/pull/6>)

Please tell me if you prefer patches some other way.

Have a great weekend!

Br,
- Simon

From guido.extras at gmail.com  Fri May 24 14:35:21 2013
From: guido.extras at gmail.com (Guido Extra)
Date: Fri, 24 May 2013 08:35:21 -0500
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too short
	and incomplete
Message-ID: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>

I have created several plugin applications that run under RabbitMQ and when they produce an issue, sometimes the ERROR REPORT is logged in a very short/incomplete manner that does not allow me to identify where ( which module and line of code ) the error occurred. 

Here is an example:

=ERROR REPORT==== 24-May-2013::08:23:35 ===
Error in process <0.489.0> on node 'rabbit at guidomacbookpro2' with exit value: {function_clause,[{orddict,fetch,["rxLBslwAswwgRz6RMtmDYenC8",[{"rxlbslwaswwgrz6rmtmdyenc8",[[{"BRANCH_ID","B8UpVlS40csA6v246IsYeTGYB"},{"DTTM_VERSION",2.013032e+16},{"HEADER_ID","B8UpVlS40csA6v246IsYeTGYB"},{"MODEL_ID","rxLBslwAsw...

Notice above the last "..." characters, that's where it all ends. The interesting stuff is certainly at the end of that 

Strangely, other times, the report shows complete. I can't also understand what is the difference.

Question: 

How to get a full / complete report ? 


Thanks
Guido



From mark at bakedbeans.com  Fri May 24 17:02:12 2013
From: mark at bakedbeans.com (Mark Snelling)
Date: Fri, 24 May 2013 09:02:12 -0700 (PDT)
Subject: [rabbitmq-discuss] [dotnet-client] Help mocking IModel.BasicPublish
Message-ID: <ab79c0c0-bf3e-4e44-8748-8b9c88d06a07@googlegroups.com>

Hello,

I'm writing unit tests for the various components in my application, some 
of which interface with a RabbitMQ broker.

I've managed to successfully implement reading from a mocked call to 
IModel.BasicConsume() and acknowledging with IModel.BasicAck() but am stuck 
on IModel.BasicPublish(), in particular mocking the ack/nack mechanism with 
IModel as I need to test my component in both those scenarios.

How does the ack/nack mechanism work with IModel.WaitForConfirms() and how 
would I go about sending an ack/nack when the publisher calls 
IModel.BasicPublish()?

I'm using NSubstitute as my mocking library but I imagine the solution 
is translatable across mocking frameworks.

Thanks,

Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130524/de1420f5/attachment.htm>

From n16483 at cray.com  Fri May 24 22:55:07 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Fri, 24 May 2013 16:55:07 -0500
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <519F7052.6030301@cray.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com>
Message-ID: <519FE1BB.9030005@cray.com>

Simon,

Again, thank you for your continued help. I have made progress, but I'm 
hitting another problem.

I'm trying to establish federation between two brokers (one happens to 
be clustered, but the second cluster node is currently down) using 
passwordless-SSH using a LDAP authentication backend. If I disable 
external auth, I can get the federation clients to connect. Once I 
enable external auth, I get the following error. Any ideas?

=ERROR REPORT==== 24-May-2013::16:34:44 ===
** Generic server <0.2696.0> terminating
** Last message in was {'$gen_cast',maybe_go}
** When Server state == {not_started,
                          {{upstream,
                            {amqp_params_network,<<"guest">>,<<"guest">>,
<<"/">>,"ecozzi-02",undefined,0,0,0,infinity,
                             [{fail_if_no_peer_cert,true},
                              {verify,verify_peer},
                              {keyfile,"/opt/cray/ssl/client-01/key.pem"},
                              {certfile,"/opt/cray/ssl/client-01/cert.pem"},
                              
{cacertfile,"/opt/cray/ssl/testca/cacert.pem"}],
                             [#Fun<amqp_uri.7.123484526>,
                              #Fun<amqp_uri.7.123484526>],
                             [],[]},
<<"amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&certfile=/opt/cray/ssl/client-01/cert.pem&keyfile=/opt/cray/ssl/client-01/key.pem&verify=verify_peer&fail_if_no_peer_cert=true">>,
                            {exchange,
                             {resource,<<"/">>,exchange,<<"cray.topic">>},
                             topic,true,false,false,[],
                             [{federation,
                               
[{{<<"ecozzi-02">>,<<"cray.topic">>},<<"A">>}]}],
                             [{vhost,<<"/">>},
                              {name,<<"federate-me">>},
                              {pattern,<<"^cray.">>},
                              {definition,
                               [{<<"federation-upstream-set">>,<<"all">>}]},
                              {priority,0}]},
                            1000,1,1,none,none,true,none,<<"ecozzi-02">>},
                           {resource,<<"/">>,exchange,<<"cray.topic">>}}}
** Reason for termination ==
** {{{case_clause,
          {badrpc,
              {'EXIT',
                  {{badarg,{error,noSuchObject}},
                   
[{rabbit_access_control,'-check_vhost_access/2-fun-0-',3,[]},
                    {rabbit_access_control,check_access,5,[]},
                    {rabbit_direct,connect,5,[]},
                    {rpc,local_call,3,[{file,"rpc.erl"},{line,327}]},
                    {amqp_direct_connection,connect,4,[]},
                    {amqp_gen_connection,handle_call,3,[]},
                    {gen_server,handle_msg,5,
                        [{file,"gen_server.erl"},{line,588}]},
                    {proc_lib,init_p_do_apply,3,
                        [{file,"proc_lib.erl"},{line,227}]}]}}}},
      [{amqp_direct_connection,connect,4,[]},
       {amqp_gen_connection,handle_call,3,[]},
       {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,588}]},
       {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]},
     {gen_server,call,[<0.2699.0>,connect,infinity]}}

Eric

On 05/24/2013 08:51 AM, Eric Cozzi wrote:
> A-ha! That's exactly what I was missing. Thanks!
>
> Eric
>
> On 05/24/2013 05:02 AM, Simon MacMullen wrote:
>> Hi. Are you setting the various SSL options in the URIs? See 
>> http://www.rabbitmq.com/shovel.html#uris for the URI format. 
>> Federation uses the AMQP client, which doesn't get its SSL options 
>> from the configuration file.
>>
>> Cheers, Simon
>>
>> On 23/05/13 21:28, Eric Cozzi wrote:
>>> I am having an issue configuring Federation and passwordless-ssl login.
>>> Federation is using https. Seems if I enable the ssl config option
>>> {fail_if_no_peer_cert,true}, peer brokers get a SSL connection error
>>> when trying to establish the Federation. Even though I'm setting my SSL
>>> keys and certs in the rabbitmq config, I'm guessing that Federation
>>> isn't using the configured certs? Is there a way to configure the 
>>> client
>>> and CA cert's to use with Federation?
>>>
>>> Eric
>>>
>>> Below is my (simplified) configuration.
>>>
>>> [
>>>    {rabbit,
>>>      [
>>>        {hipe_compile, true},
>>>        {tcp_listen_options,
>>>          [binary,
>>>            {packet,raw},
>>>            {reuseaddr,true},
>>>            {backlog,128},
>>>            {nodelay,true},
>>>            {exit_on_close,false}
>>>          ]
>>>        },
>>>        {ssl_listeners, [5671]},
>>>        {ssl_options, [{cacertfile,"/opt/cray/ssl/testca/cacert.pem"},
>>>                       {certfile,"/opt/cray/ssl/server-01/cert.pem"},
>>>                       {keyfile,"/opt/cray/ssl/server-01/key.pem"},
>>>                       {verify,verify_peer},
>>>                       {fail_if_no_peer_cert,false}
>>>                      ]
>>>        }
>>>      ]
>>>    }
>>> ].
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From niks at osic.rs  Fri May 24 23:28:02 2013
From: niks at osic.rs (Nikola Savic)
Date: Sat, 25 May 2013 00:28:02 +0200
Subject: [rabbitmq-discuss] PHP STOMP extension/lib that works well with
	RabbitMQ?
Message-ID: <519FE972.7090407@osic.rs>

Hi all,

Is anyone successfully using PHP STOMP extension or library to connect 
and send/consume messages over RabbitMQ with STOMP adapter?

Thanks,
Nikola
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130525/f89b2d3e/attachment.htm>

From shivangvyas2008 at gmail.com  Sat May 25 09:55:07 2013
From: shivangvyas2008 at gmail.com (shivang vyas)
Date: Sat, 25 May 2013 01:55:07 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbmitmq - app hangs while calling login user
	method...
Message-ID: <ba28f0b6-313a-418d-8ba6-0f0f1faf0feb@googlegroups.com>

using this library for ios rabbitmq client 
integration: https://github.com/bimawa/librabbitmq-objC

here is an iOS - obj C code: 

}

-(void)establish{

    

    AMQPConnection *connection = [[AMQPConnection alloc] init];

    NSError *error, *error1,*error2,*error3;

    [connection connectToHost:<hostname> onPort:<portno> error:&error] ? 
NSLog(@"Connected to host"):NSLog(@"not connected to host");

    

    [connection loginAsUser:@"guest" withPasswort:@"guest"

                    onVHost:@"/" error:&error1];

    

    AMQPChannel *channel = [connection openChannel];

    AMQPExchange * exchange = [[AMQPExchange alloc] initExchangeWithName
:<exchangename>

                                                               onChannel
:channel];

    

    AMQPQueue *queue = [[AMQPQueue alloc] initWithName:@"my_queue" onChannel
:channel];

    [queue bindToExchange:exchange withKey:@"99999" error:&error3];

    

    AMQPConsumer *consumer = [[AMQPConsumer alloc] initForQueue:queue 
onChannel:&channel

                                            useAcknowledgements:YES

                                                    isExclusive:NO

                                           receiveLocalMessages:NO

                                                          error:&error2

                                                       deepLoop:5];

    AMQPConsumerThread *consumerThread = [[AMQPConsumerThread alloc] 
initWithConsumer:consumer delegate:(id)self nameThread:@"shivng_thread"];

    [consumerThread start];

    

    

    

}


-(void)amqpConsumerThreadReceivedNewMessage:(AMQPMessage*)theMessage{

    NSLog(@"message = %@", theMessage);

    NSLog(@"message.body = %@", theMessage.body);

}

-(void)amqpConsumerThreadLoseConnection{

    NSLog(@"Consumer thread lost connection");

}

application just got hanged while calling : 

 [connection loginAsUser:@"guest" withPasswort:@"guest"

                    onVHost:@"/" error:&error1];


the reason is, function: 

result = recv(state->sockfd, state->sock_inbound_buffer.bytes,state->
sock_inbound_buffer.len, 0);

doesn't return back, just waiting waiting......

app waiting for executing next other statements after the above line...





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130525/c867ec81/attachment.htm>

From watson.timothy at gmail.com  Sat May 25 19:05:22 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 25 May 2013 19:05:22 +0100
Subject: [rabbitmq-discuss] rabbmitmq - app hangs while calling login
	user method...
In-Reply-To: <ba28f0b6-313a-418d-8ba6-0f0f1faf0feb@googlegroups.com>
References: <ba28f0b6-313a-418d-8ba6-0f0f1faf0feb@googlegroups.com>
Message-ID: <B1601D12-5FA9-4638-8BDB-21A643CFF477@rabbitmq.com>

Is the broker running on the host and port you're connecting to?

Have you tried contacting the author of this library?

On 25 May 2013, at 09:55, shivang vyas <shivangvyas2008 at gmail.com> wrote:

> using this library for ios rabbitmq client integration: https://github.com/bimawa/librabbitmq-objC
> 
> here is an iOS - obj C code: 
> 
> }
> 
> -(void)establish{
> 
>     
> 
>     AMQPConnection *connection = [[AMQPConnection alloc] init];
> 
>     NSError *error, *error1,*error2,*error3;
> 
>     [connection connectToHost:<hostname> onPort:<portno> error:&error] ? NSLog(@"Connected to host"):NSLog(@"not connected to host");
> 
>     
> 
>     [connection loginAsUser:@"guest" withPasswort:@"guest"
> 
>                     onVHost:@"/" error:&error1];
> 
>     
> 
>     AMQPChannel *channel = [connection openChannel];
> 
>     AMQPExchange * exchange = [[AMQPExchange alloc] initExchangeWithName:<exchangename>
> 
>                                                                onChannel:channel];
> 
>     
> 
>     AMQPQueue *queue = [[AMQPQueue alloc] initWithName:@"my_queue" onChannel:channel];
> 
>     [queue bindToExchange:exchange withKey:@"99999" error:&error3];
> 
>     
> 
>     AMQPConsumer *consumer = [[AMQPConsumer alloc] initForQueue:queue onChannel:&channel
> 
>                                             useAcknowledgements:YES
> 
>                                                     isExclusive:NO
> 
>                                            receiveLocalMessages:NO
> 
>                                                           error:&error2
> 
>                                                        deepLoop:5];
> 
>     AMQPConsumerThread *consumerThread = [[AMQPConsumerThread alloc] initWithConsumer:consumer delegate:(id)self nameThread:@"shivng_thread"];
> 
>     [consumerThread start];
> 
>     
> 
>     
> 
>     
> 
> }
> 
> 
> 
> -(void)amqpConsumerThreadReceivedNewMessage:(AMQPMessage*)theMessage{
> 
>     NSLog(@"message = %@", theMessage);
> 
>     NSLog(@"message.body = %@", theMessage.body);
> 
> }
> 
> -(void)amqpConsumerThreadLoseConnection{
> 
>     NSLog(@"Consumer thread lost connection");
> 
> }
> 
> application just got hanged while calling : 
> 
>  [connection loginAsUser:@"guest" withPasswort:@"guest"
> 
>                     onVHost:@"/" error:&error1];
> 
> 
> 
> the reason is, function: 
> 
> result = recv(state->sockfd, state->sock_inbound_buffer.bytes,state->sock_inbound_buffer.len, 0);
> 
> doesn't return back, just waiting waiting......
> 
> app waiting for executing next other statements after the above line...
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130525/0696a7be/attachment.htm>

From matthias at rabbitmq.com  Sat May 25 21:56:33 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 25 May 2013 21:56:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <519FE1BB.9030005@cray.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com> <519FE1BB.9030005@cray.com>
Message-ID: <51A12581.40908@rabbitmq.com>

Eric,

On 24/05/13 22:55, Eric Cozzi wrote:
>                   {{badarg,{error,noSuchObject}},
> [{rabbit_access_control,'-check_vhost_access/2-fun-0-',3,[]},
>                     {rabbit_access_control,check_access,5,[]},

That indicates that your LDAP auth backend returned a 'noSuchObject' 
error when performing the vhost access check for the user.

I suggest you enable logging in the LDAP auth plug-in to track down the 
cause.

However, the error really should be handled more gracefully by rabbit, 
and I am at a loss why it's producing such a stack trace. What versions 
of RabbitMQ and Erlang are you running and how did you install rabbit 
(e.g. from a package, compiled from source, etc)?

Matthias.

From buptloveandroid at gmail.com  Sun May 26 07:03:06 2013
From: buptloveandroid at gmail.com (bupt bupt)
Date: Sun, 26 May 2013 14:03:06 +0800
Subject: [rabbitmq-discuss] problem about TTL
 time/transaction/HighAvailablity Cluster from new beginner of rabbitmq
Message-ID: <CAL-OO0k_kKMYxR-9qEbSKUkMx7FQyaeGT32+QBP13V0mdHfGtg@mail.gmail.com>

hello everyone,
       I am a new beginner of Rabbitmq. I am fascinated by its efficiency
and easy to use. But I have some problem and want to ask every engineer.
1.what is rabbitmq-server's default TTL time? I didn't configure any data
to rabbitmq.
2.what kind of data structure and which type of data can be delivered to
rabbitmq-server?
3.If I didn't want to lose any message , how can I design our message queue
architecture. I know that rabbitmq has durable parameter solution but it
still can't guarantee it didn't lose any message at all, especially for the
data stored in memory but not in the disk. I also know that durable
solution and transaction method will effect qps performance greatly, Can
you help to design a good message queue system using rabbitmq and don't
lose any message?
4. Can you give me a demo code about how to use transaction of rabbitmq in
java or python?
      thank you very much ~~
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130526/8052eb3c/attachment.htm>

From watson.timothy at gmail.com  Sun May 26 14:52:01 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sun, 26 May 2013 14:52:01 +0100
Subject: [rabbitmq-discuss] problem about TTL
	time/transaction/HighAvailablity Cluster from new beginner of
	rabbitmq
In-Reply-To: <CAL-OO0k_kKMYxR-9qEbSKUkMx7FQyaeGT32+QBP13V0mdHfGtg@mail.gmail.com>
References: <CAL-OO0k_kKMYxR-9qEbSKUkMx7FQyaeGT32+QBP13V0mdHfGtg@mail.gmail.com>
Message-ID: <3AA2A4F5-4B46-42CA-B4EA-50BF0CD475C8@rabbitmq.com>

On 26 May 2013, at 07:03, bupt bupt <buptloveandroid at gmail.com> wrote:
> 1.what is rabbitmq-server's default TTL time? I didn't configure any data to rabbitmq.

Infinity.

> 2.what kind of data structure and which type of data can be delivered to rabbitmq-server? 

Rabbit, like many message brokers, treats a message's payload as a binary blob of data. You can put whatever you like in there, then add (de)serialisation at the application level.

> 3.If I didn't want to lose any message , how can I design our message queue architecture.

See http://www.rabbitmq.com/reliability.html

> I know that rabbitmq has durable parameter solution but it still can't guarantee it didn't lose any message at all,

Durability has nothing to do with message persistence - its delivery mode that specifies the latter, on a per-message basis.

> especially for the data stored in memory but not in the disk. I also know that durable solution and transaction method will effect qps performance greatly, Can you help to design a good message queue system using rabbitmq and don't lose any message?

See the reliability guide I mentioned above.

> 4. Can you give me a demo code about how to use transaction of rabbitmq in java or python?
>       thank you very much ~~

http://www.rabbitmq.com/tutorials.html

Tim

From watson.timothy at gmail.com  Sun May 26 14:54:52 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sun, 26 May 2013 14:54:52 +0100
Subject: [rabbitmq-discuss] problem about TTL
	time/transaction/HighAvailablity Cluster from new beginner of
	rabbitmq
In-Reply-To: <3AA2A4F5-4B46-42CA-B4EA-50BF0CD475C8@rabbitmq.com>
References: <CAL-OO0k_kKMYxR-9qEbSKUkMx7FQyaeGT32+QBP13V0mdHfGtg@mail.gmail.com>
	<3AA2A4F5-4B46-42CA-B4EA-50BF0CD475C8@rabbitmq.com>
Message-ID: <8601B067-219A-4C77-9336-19ABE4E9DECB@rabbitmq.com>

On 26 May 2013, at 14:52, Tim Watson <tim at rabbitmq.com> wrote:
> 
>> 4. Can you give me a demo code about how to use transaction of rabbitmq in java or python?
>>      thank you very much ~~
> 
> http://www.rabbitmq.com/tutorials.html
> 

No wait, there's nothin about transactions in there. But if I were you I'd google for "publisher confirms" instead of transactions.

Tim

From rotem.hermon at gmail.com  Sun May 26 10:23:33 2013
From: rotem.hermon at gmail.com (Rotem Hermon)
Date: Sun, 26 May 2013 02:23:33 -0700 (PDT)
Subject: [rabbitmq-discuss] New version on maven?
Message-ID: <1657784e-848f-4ef9-96ba-8192bfdd376c@googlegroups.com>

The last version of the java client on the central maven repository is 
3.0.4. 
Is 3.1.1 going to be published anytime soon? (It's been a while since it 
was released).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130526/84ecf9f1/attachment.htm>

From matthias at rabbitmq.com  Sun May 26 17:08:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 26 May 2013 17:08:34 +0100
Subject: [rabbitmq-discuss] New version on maven?
In-Reply-To: <1657784e-848f-4ef9-96ba-8192bfdd376c@googlegroups.com>
References: <1657784e-848f-4ef9-96ba-8192bfdd376c@googlegroups.com>
Message-ID: <51A23382.2060002@rabbitmq.com>

On 26/05/13 10:23, Rotem Hermon wrote:
> The last version of the java client on the central maven repository is
> 3.0.4.

3.1.0 has been up there for a few weeks. See 
http://search.maven.org/#artifactdetails|com.rabbitmq|amqp-client|3.1.0|jar

> Is 3.1.1 going to be published anytime soon? (It's been a while since it
> was released).

3.1.1 will get to the central repo eventually, but, if you look at the 
3.1.1 release notes you'll see that it actually contains no changes over 
3.1.0.

Matthias.

From buptloveandroid at gmail.com  Mon May 27 16:12:50 2013
From: buptloveandroid at gmail.com (bupt bupt)
Date: Mon, 27 May 2013 23:12:50 +0800
Subject: [rabbitmq-discuss] problem about flow control and HA cluster
Message-ID: <CAL-OO0mgtEiqFtL_UNzLDyJto3hAKpr=pDaBDVKFoAiSJw6q0A@mail.gmail.com>

hello everyone,
        I have read official document of rabbitmq, But I still have some
problem, Could you help me:
1. Can you give me an example(internet address is ok) about how to finish
flow control if the length of queue is too big or if the used memory and
disc near the threshold. Can you give me some client code(python or Java)
to help me use it.
2. I have read document about how to set up rabbitmq cluster by"
http://www.rabbitmq.com/clustering.html" But who is master and who is
cluster, It  doesn't tell us. which broker manage all the nodes in cluster?
I didn't see any mirror queue in this address, Can this cluster still be HA
cluster?
3. Is every message has length and size limit? what is the maximum size of
every message?
Thank you very much!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130527/df762b18/attachment.htm>

From lee at rightscale.com  Mon May 27 19:22:59 2013
From: lee at rightscale.com (Lee Kirchhoff)
Date: Mon, 27 May 2013 11:22:59 -0700
Subject: [rabbitmq-discuss] RabbitMQ 3.1.1 released
In-Reply-To: <869D442E-7CFA-4633-9E82-4A5A6832E655@rabbitmq.com>
References: <869D442E-7CFA-4633-9E82-4A5A6832E655@rabbitmq.com>
Message-ID: <CAMuted0gGcS6Vhkv81co8db0tHXz0U7AvJCKY6ynNUOVYqTMSw@mail.gmail.com>

I see a mercurial tag for 3.1.0 but none for 3.1.1. Shouldn't there be one?

Lee Kirchhoff


On Tue, May 21, 2013 at 6:34 AM, Tim Watson <tim at rabbitmq.com> wrote:

> The RabbitMQ team is pleased to announce the release of RabbitMQ 3.1.1.
>
> This release fixes a number of bugs in 3.1.0 and earlier versions.
>
>
> See the release notes at:
>
> http://www.rabbitmq.com/release-notes/README-3.1.1.txt
>
> for more information.
>
> The new release can be downloaded from:
>
> http://www.rabbitmq.com/download.html
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list.
>
> Regards,
>                     The RabbitMQ Team
>                     (http://www.rabbitmq.com)
> _______________________________________________
> rabbitmq-announce mailing list
> rabbitmq-announce at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-announce
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130527/b1af3ddf/attachment.htm>

From natewang0425 at gmail.com  Tue May 28 05:32:52 2013
From: natewang0425 at gmail.com (Nate)
Date: Mon, 27 May 2013 21:32:52 -0700 (PDT)
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <5194CC1D.90201@rabbitmq.com>
References: <CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
	<51933936.60008@rabbitmq.com>
	<CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>
	<519353D2.4020400@rabbitmq.com>
	<CAHqyxU0XU1K0imG-QwZiLS-_akkpnf7+0biN8sPR25WyyMx3sw@mail.gmail.com>
	<519496BC.2070604@rabbitmq.com>
	<CAHqyxU0BpBCgj9GvCdruH-n9A6r3W9p7v=a92ZGic-XzdN3gpw@mail.gmail.com>
	<5194CC1D.90201@rabbitmq.com>
Message-ID: <CAHqyxU17hvQ2YrLs42=OJGXgawbtQ+0NzqgWG4_PnXqx4DoB0A@mail.gmail.com>

Hi Matthias,

    I use pstack to dig the erlang procces, The log seems like the erlang
already crash??!. Are there any other hint can help to track this issue?

process name:
/usr/lib/erlang/erts-5.9/bin/beam.smp -- -root /usr/lib/erlang -progname
erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/sbin/../ebin -noshell
-noinput -hidden -sname rabbitmqctl8972 -s rabbit_control_main -nodename
rabbit at rabbitmq1 -extra rotate_logs

Thread 4 (Thread 0x40800940 (LWP 16722)):
#0  0x00002b03c5245fc2 in select () from /lib64/libc.so.6
#1  0x00000000005b3281 in erts_milli_sleep ()
#2  0x000000000045585a in system_cleanup ()
#3  0x0000000000455e0c in erl_exit ()
#4  0x000000000054c946 in signal_dispatcher_thread_func ()
#5  0x00000000005aec19 in thr_wrapper ()
#6  0x00002b03c4d5a73d in start_thread () from /lib64/libpthread.so.0
#7  0x00002b03c524cd1d in clone () from /lib64/libc.so.6
Thread 3 (Thread 0x41001940 (LWP 16723)):
#0  0x00002b03c4d5eee9 in pthread_cond_wait@@GLIBC_2.3.2 () from
/lib64/libpthread.so.0
#1  0x00000000005ad0d9 in ethr_cond_wait ()
#2  0x0000000000476587 in sys_msg_dispatcher_wait ()
#3  0x00000000004ef7a1 in erts_thr_progress_register_managed_thread ()
#4  0x000000000047a3d1 in sys_msg_dispatcher_func ()
#5  0x00000000005aec19 in thr_wrapper ()
#6  0x00002b03c4d5a73d in start_thread () from /lib64/libpthread.so.0
#7  0x00002b03c524cd1d in clone () from /lib64/libc.so.6
Thread 2 (Thread 0x41007940 (LWP 16724)):
#0  0x00002b03c4d5eee9 in pthread_cond_wait@@GLIBC_2.3.2 () from
/lib64/libpthread.so.0
#1  0x00000000005ad0d9 in ethr_cond_wait ()
#2  0x000000000054d76f in child_waiter ()
#3  0x00000000005aec19 in thr_wrapper ()
#4  0x00002b03c4d5a73d in start_thread () from /lib64/libpthread.so.0
#5  0x00002b03c524cd1d in clone () from /lib64/libc.so.6
Thread 1 (Thread 0x2b03c54d0af0 (LWP 16710)):
#0  0x00002b03c4d614c4 in __lll_lock_wait () from /lib64/libpthread.so.0
#1  0x00002b03c4d5ce1a in _L_lock_1034 () from /lib64/libpthread.so.0
#2  0x00002b03c4d5ccdc in pthread_mutex_lock () from /lib64/libpthread.so.0
#3  0x00000000004bb8be in erts_get_timeval ()
#4  0x00000000004efbe4 in erts_thr_progress_fatal_error_block ()
#5  0x00000000004fa562 in erl_crash_dump_v ()
#6  0x0000000000455eab in erl_exit ()
#7  0x00000000004ba9d5 in get_tolerant_timeofday ()
#8  0x00000000004baffa in erts_get_emu_time ()
#9  0x00000000004a5d41 in erl_create_process ()
#10 0x000000000045709b in erl_start ()
#11 0x0000000000436169 in main ()


2013/5/16 Matthias Radestock-3 [via RabbitMQ] <
ml-node+s1065348n26760h25 at n5.nabble.com>

> Nate,
>
> On 16/05/13 12:36, Nate wrote:
> >         Yes, I ran it as root and nothing return to me.... However, when
> > I use SIGABRT the process will be deleted. My OS is centos 5.5.
>
> There must be something seriously wrong with that Erlang VM process if
> it is not reacting to SIGUSR1.
>
> I suggest you "walk up the call stack" of the ps output you posted
> initially and manually run the log rotation commands, to check whether
> any of them get stuck, e.g.
>
> /bin/sh /usr/sbin/rabbitmqctl rotate_logs
> /bin/sh /etc/init.d/rabbitmq-server rotate-logs
> /bin/sh /sbin/service rabbitmq-server rotate-logs
> sh -c ? /sbin/service rabbitmq-server rotate-logs > /dev/null? ?
> (hmm, what's with those question marks? are they placeholders for
> something?)
> /usr/sbin/logrotate /etc/logrotate.conf
> /bin/sh /etc/cron.daily/logrotate
> /bin/bash /usr/bin/run-parts /etc/cron.daily
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=26760&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p26760.html
>  To unsubscribe from Re: After weekly log rotatation was done, the command
> "rabbitmqctl rotate-logs" never stop, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=26607&code=bmF0ZXdhbmcwNDI1QGdtYWlsLmNvbXwyNjYwN3w0NTY2Njg2Njk=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Re-After-weekly-log-rotatation-was-done-the-command-rabbitmqctl-rotate-logs-never-stop-tp26607p27006.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130527/a4e8cfa5/attachment.htm>

From crashcourse at gmail.com  Tue May 28 05:49:16 2013
From: crashcourse at gmail.com (Crash Course)
Date: Mon, 27 May 2013 21:49:16 -0700
Subject: [rabbitmq-discuss] Architecture Question
Message-ID: <CAFLufr7Y9k2144a6cnWrFxM-Jwx0sQpsFJKAXqhpX=qXewRobw@mail.gmail.com>

Hello all!

I've been running some tests locally, trying to determine whether RabbitMQ
will meet our performance requirements.

I'm running the broker (3.1.1) on a Dual Xeon E5 (12 cores total) with 256
MB and Windows Server 2012, on Erlang R16B (64bit). One of the primary
workflows that we want to enable is using a cluster  is to have several
workers behind the cluster taking messages from multiple clients.

With a single producer -> direct exchange -> single consumer on a single
broker, I can get about 38000 messages / second. (I'm not sure where the
performance limit is here, since I'm not queuing any messages, the consumer
is the equivalent of /dev/null, and the CPU on the broker doesn't go above
12%)

To test it, I ran two brokers on the same server, and tried setting up a
couple of different exchange/queue layouts:

   - Producers publishing to a single consistent hash exchange, with each
   consumer connecting to a private queue bound to the exchange
   - Producers publishing to a single exchange / default exchange, with
   each consumer connecting to a single queue off the exchange

In the first scenario above, if I use 24 consumers (and hence 24 queues)
distributed equally across both brokers, I can barely muster 52000 messages
/ second (and going up to 30% CPU on each Erlang broker)

In the second scenario, I stop at under 10000 messages / second.

This leads me to believe that the former is the better design, but what
kind of architecture would give a 4 fold or 10 fold increase in throughput?
Would we have to hash prior to RabbitMQ? An x-consistent-hash in front of
multiple x-consistent-hash exchanges?

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130527/e8fe4a4e/attachment.htm>

From matthias at rabbitmq.com  Tue May 28 11:02:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 May 2013 11:02:27 +0100
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too
 short and incomplete
In-Reply-To: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
References: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
Message-ID: <51A480B3.7080700@rabbitmq.com>

Guido,

On 24/05/13 14:35, Guido Extra wrote:
> I have created several plugin applications that run under RabbitMQ
> and when they produce an issue, sometimes the ERROR REPORT is logged
> in a very short/incomplete manner that does not allow me to identify
> where ( which module and line of code ) the error occurred.
>
> Here is an example:
>
> =ERROR REPORT==== 24-May-2013::08:23:35 === Error in process
> <0.489.0> on node 'rabbit at guidomacbookpro2' with exit value:
> {function_clause,[{orddict,fetch,["rxLBslwAswwgRz6RMtmDYenC8",[{"rxlbslwaswwgrz6rmtmdyenc8",[[{"BRANCH_ID","B8UpVlS40csA6v246IsYeTGYB"},{"DTTM_VERSION",2.013032e+16},{"HEADER_ID","B8UpVlS40csA6v246IsYeTGYB"},{"MODEL_ID","rxLBslwAsw...
>
>  Notice above the last "..." characters, that's where it all ends.
> The interesting stuff is certainly at the end of that
>
> Strangely, other times, the report shows complete. I can't also
> understand what is the difference.
>
> Question:
>
> How to get a full / complete report ?

The above message is clearly generated by your own code - nothing in 
rabbit or otp produces an error message of the form "Error in process 
<pid> on node '<node>' with exit value: <reason>". So the truncation 
must happen in your own code, somehow.

Matthias.

From matthias at rabbitmq.com  Tue May 28 11:05:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 May 2013 11:05:23 +0100
Subject: [rabbitmq-discuss] After weekly log rotatation was done,
 the command "rabbitmqctl rotate-logs" never stop
In-Reply-To: <CAHqyxU17hvQ2YrLs42=OJGXgawbtQ+0NzqgWG4_PnXqx4DoB0A@mail.gmail.com>
References: <CAHqyxU2Nb+Zhfg8-bhuNSjwxyQ_WWgKdxoe1JN4vr4qhQm7tNw@mail.gmail.com>
	<51926F78.20401@rabbitmq.com>
	<1368600742183-26693.post@n5.nabble.com>
	<51933936.60008@rabbitmq.com>
	<CAHqyxU36RqZTcgePO9MojEW9WGCi+Gqds5r6gEEoY-s-PX57wA@mail.gmail.com>
	<519353D2.4020400@rabbitmq.com>
	<CAHqyxU0XU1K0imG-QwZiLS-_akkpnf7+0biN8sPR25WyyMx3sw@mail.gmail.com>
	<519496BC.2070604@rabbitmq.com>
	<CAHqyxU0BpBCgj9GvCdruH-n9A6r3W9p7v=a92ZGic-XzdN3gpw@mail.gmail.com>
	<5194CC1D.90201@rabbitmq.com>
	<CAHqyxU17hvQ2YrLs42=OJGXgawbtQ+0NzqgWG4_PnXqx4DoB0A@mail.gmail.com>
Message-ID: <51A48163.7000007@rabbitmq.com>

Nate,

On 28/05/13 05:32, Nate wrote:
>      I use pstack to dig the erlang procces, The log seems like the
> erlang already crash??!.

Looks like it's stuck writing the crash dump. The crash dump may have 
been triggered by the SIGUSR1 - that's what it is supposed to to do - or 
perhaps the process was stuck in that code already.

> Are there any other hint can help to track this issue?

As I said...

>     I suggest you "walk up the call stack" of the ps output you posted
>     initially and manually run the log rotation commands, to check whether
>     any of them get stuck, e.g.
>
>     /bin/sh /usr/sbin/rabbitmqctl rotate_logs
>     /bin/sh /etc/init.d/rabbitmq-server rotate-logs
>     /bin/sh /sbin/service rabbitmq-server rotate-logs
>     sh -c ? /sbin/service rabbitmq-server rotate-logs > /dev/null? ?
>     (hmm, what's with those question marks? are they placeholders for
>     something?)
>     /usr/sbin/logrotate /etc/logrotate.conf
>     /bin/sh /etc/cron.daily/logrotate
>     /bin/bash /usr/bin/run-parts /etc/cron.daily

Regards,

Matthias.

From matthias at rabbitmq.com  Tue May 28 11:11:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 May 2013 11:11:40 +0100
Subject: [rabbitmq-discuss] Naming RabbitMQ nodes with complete domain
 names
In-Reply-To: <b5753ad7-50be-48e1-8d59-eccf7316867e@googlegroups.com>
References: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>	<6E4EDE37-C738-47D3-AEEE-B8E002073098@gmail.com>	<AANLkTimOPtEdSi4gTca4u8UvHfPQk+0=tT++C-1MtXK4@mail.gmail.com>	<DB37F2C2-7A68-406C-8099-9AD26771CDAD@gmail.com>
	<AANLkTi=jAO3GqPePoW0v_0NqyhQKHWEjZsH27S93Meq5@mail.gmail.com>
	<4D6049A5.1030204@rabbitmq.com>
	<b5753ad7-50be-48e1-8d59-eccf7316867e@googlegroups.com>
Message-ID: <51A482DC.4000604@rabbitmq.com>

On 24/05/13 00:37, Santiago Ezcurra wrote:
> Hi there.....I know this is old thread, but I'm having the same
> problem.....the thing is that I'm trying to build a cluster on amazon
> ec2. there, there is no domain and the machines only have a hostname of
> the form ip-0-0-0-0. everything works fine for one node (and erlang
> starts with -name rabbit at ip-x-x-x-x), but when i try to join cluster to
> another node, there is no name resolution happening between both
> machines (other than specifying mutually on respectives ec/hosts).
> those machines does recognize the name *ip-x-x-x-x.ec2.internal*....but
> I'm just failing to configure this name. When i tried specifying this
> long name in NODENAME in env file, it's when erlang (or rabbitmq, don't
> know) complains with "can't get short name whatever". and maybe it's
> because the newer version, but I can't find where to change the -sname
> by -name in any scripts.....could you please have any advice for me ??

Don't attempt to use long names. Configure name resolution of short 
names, e.g. via /etc/hosts.

Matthias.

From matthias at rabbitmq.com  Tue May 28 11:25:31 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 May 2013 11:25:31 +0100
Subject: [rabbitmq-discuss] User permission
In-Reply-To: <1369402426514-26987.post@n5.nabble.com>
References: <1369402426514-26987.post@n5.nabble.com>
Message-ID: <51A4861B.8010006@rabbitmq.com>

On 24/05/13 14:33, Slyth wrote:
> I have users who should have there own queues, which only they and I should
> can see AND all of them should have permissions to send msg to a special
> queue and only one user (me) should have the permission to receive.

What do you mean by "see"? In the management UI? Do your users really 
need to have access to that at all? And even if they do, do you really 
care whether they can see the presence of other user's queues, as long 
as they can't do anything with them?

Matthias.

From tim at rabbitmq.com  Tue May 28 11:44:55 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 May 2013 11:44:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.1 released
In-Reply-To: <CAMuted0gGcS6Vhkv81co8db0tHXz0U7AvJCKY6ynNUOVYqTMSw@mail.gmail.com>
References: <869D442E-7CFA-4633-9E82-4A5A6832E655@rabbitmq.com>
	<CAMuted0gGcS6Vhkv81co8db0tHXz0U7AvJCKY6ynNUOVYqTMSw@mail.gmail.com>
Message-ID: <B871D459-2BF6-477B-8A0B-DB4FAA4204D5@rabbitmq.com>

Hi Lee,

On 27 May 2013, at 19:22, Lee Kirchhoff wrote:

> I see a mercurial tag for 3.1.0 but none for 3.1.1. Shouldn't there be one?
> 

Yes there should, and the tag will become visible shortly. There was a hiccup during the release process that led to rabbitmq-server, the java-client and dotnet-client repository tags not being pushed. We're working to resolve the issue and the tags should become visible shortly.

Cheers,
Tim 

From emile at rabbitmq.com  Tue May 28 12:36:51 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 28 May 2013 12:36:51 +0100
Subject: [rabbitmq-discuss] PHP STOMP extension/lib that works well with
 RabbitMQ?
In-Reply-To: <519FE972.7090407@osic.rs>
References: <519FE972.7090407@osic.rs>
Message-ID: <51A496D3.2000400@rabbitmq.com>

On 24/05/13 23:28, Nikola Savic wrote:
> Is anyone successfully using PHP STOMP extension or library to connect
> and send/consume messages over RabbitMQ with STOMP adapter?


There are several PHP STOMP implementations listed at
http://stomp.github.io/implementations.html
that you can try.



-Emile




From tim at rabbitmq.com  Tue May 28 12:37:48 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 May 2013 12:37:48 +0100
Subject: [rabbitmq-discuss] Architecture Question
In-Reply-To: <CAFLufr7Y9k2144a6cnWrFxM-Jwx0sQpsFJKAXqhpX=qXewRobw@mail.gmail.com>
References: <CAFLufr7Y9k2144a6cnWrFxM-Jwx0sQpsFJKAXqhpX=qXewRobw@mail.gmail.com>
Message-ID: <130F24DD-517C-4048-9F88-E61BD7D8C6E3@rabbitmq.com>

Hi,

On 28 May 2013, at 05:49, Crash Course wrote:

> I'm running the broker (3.1.1) on a Dual Xeon E5 (12 cores total) with 256 MB and Windows Server 2012, on Erlang R16B (64bit).

I'm guessing you don't really mean 256MB right?

> One of the primary workflows that we want to enable is using a cluster  is to have several workers behind the cluster taking messages from multiple clients.
> 
> With a single producer -> direct exchange -> single consumer on a single broker, I can get about 38000 messages / second. (I'm not sure where the performance limit is here, since I'm not queuing any messages, the consumer is the equivalent of /dev/null, and the CPU on the broker doesn't go above 12%)

There is no such thing as 'not queueing any messages' since consumers *have* to consume from a queue. Presumably what you're saying is that the consumer isn't doing any work before sending an ACK. Are you using ACKs, have you considered setting a prefetch count, etc? Have you read http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2 to get an idea of the baselines you might expect to see?

> 
> To test it, I ran two brokers on the same server, and tried setting up a couple of different exchange/queue layouts:

Have you considered benchmarking with a single broker first, then adding in the clustering later on? Clustering is intended to provide reliability/robustness/fallback rather than improve performance - were you aware of that? Clustering comes with some overheads, e.g., if you publish to node-1 and consume from node-2, the messages have to be routed between nodes as well. A queue will *only* run on one node in the cluster, so producers and/or consumers connecting to some other node, will have their actions (i.e., publishing or consuming) forwarded to the node on which the queue is running.

> Producers publishing to a single consistent hash exchange, with each consumer connecting to a private queue bound to the exchange
> Producers publishing to a single exchange / default exchange, with each consumer connecting to a single queue off the exchange
This limits throughput to the speed at which a single queue can progress, in terms of both accepting incoming messages *and* passing them on to individual consumers. Why? Because for each matching binding, the message will be routed to that (bound) queue. Are you saying that you're trying to use the producer supplied routing keys in combination with the bindings to distribute the load across multiple consumers? 

Having multiple publishers and multiple consumers generally will increase throughput, though there will still be limits and of course for a single queue, messages will be delivered to consumers in a round-robin fashion.


> In the first scenario above, if I use 24 consumers (and hence 24 queues) distributed equally across both brokers, I can barely muster 52000 messages / second (and going up to 30% CPU on each Erlang broker)
> 

What happens if you use producer => direct exch => queue => consumer * 24 instead? What about on a single broker? How fast can you make a single queue go (with your anticipated load) and what does the optimum balance between # producers and # consumers for a single queue appear to be on your hardware? What happens if you now take *that* configuration and balance it across multiple queues?

> In the second scenario, I stop at under 10000 messages / second.
> 

How are your producers and consumers set up? Are your channels in confirm mode or using transactions? Are you using basic.get or basic.consume to consume, what about ACKs - are these auto or manual - if the latter, how long do your clients take to ACK? Have you considered changing the prefetch size, esp. if you've got multiple consumers per queue?

> This leads me to believe that the former is the better design, but what kind of architecture would give a 4 fold or 10 fold increase in throughput? Would we have to hash prior to RabbitMQ? An x-consistent-hash in front of multiple x-consistent-hash exchanges?
> 

The idea of the x-consistent-hash-exchange is to evenly distributed messages based on routing key. If I were you, I'd start by benchmarking against a single broker with just one and then multiple producers *and* consumers per queue, if your application logic can cope with that. Then I'd consider introducing multiple exchanges and/or queues, both with 1 producer/consumer and then multiples, still on a single broker. Then, finally, I'd introduce clustering. By all means use the consistent hash exchange if it helps, but IMO first you should try to get a feel for how an "out of the box" topology can perform far various combinations (and multiples) of producers, consumers, queues, etc.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130528/a362c7bd/attachment.htm>

From matthias at rabbitmq.com  Tue May 28 13:01:28 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 May 2013 13:01:28 +0100
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too
 short and incomplete
In-Reply-To: <28DAC48C-FF7D-492B-80DB-E000D4B19BA3@gmail.com>
References: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
	<51A480B3.7080700@rabbitmq.com>
	<28DAC48C-FF7D-492B-80DB-E000D4B19BA3@gmail.com>
Message-ID: <51A49C98.4010309@rabbitmq.com>

On 28/05/13 12:47, Guido Extra wrote:
> I am not use the error_logger:error_report/2 function, which would
> produce a log with such a header "=ERROR REPORT===="

error_logger is used in lots of places.

What I pointed out is that the particular error message - "Error in 
process <pid> on node '<node>' with exit value: <reason>" - is not in 
any rabbit or Erlang code. It must be in your code.

> I believe it must be the report_error itself that truncates Terms
> that are too large.

The problem is most likely with the format string and/or args you use to 
construct the error message.

Matthias.

From guido.extras at gmail.com  Tue May 28 12:47:50 2013
From: guido.extras at gmail.com (Guido Extra)
Date: Tue, 28 May 2013 06:47:50 -0500
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too
	short and incomplete
In-Reply-To: <51A480B3.7080700@rabbitmq.com>
References: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
	<51A480B3.7080700@rabbitmq.com>
Message-ID: <28DAC48C-FF7D-492B-80DB-E000D4B19BA3@gmail.com>

Hi Matthias

I am not use the error_logger:error_report/2 function, which would produce a log with such a header "=ERROR REPORT===="

I checked the RabbitMq source code and found it used under the supervisor2.erl module below. Nothing looks like to be truncating it, so I believe it must be the report_error itself that truncates Terms that are too large. Once this happens again I will add markers to supervisor2 so I can identify if the exception passed through it and how was the term's integrity at that point .

Thanks
Guido

%%% ------------------------------------------------------
%%% Error and progress reporting.
%%% ------------------------------------------------------

report_error(Error, Reason, Child, SupName) ->
    ErrorMsg = [{supervisor, SupName},
		{errorContext, Error},
		{reason, Reason},
		{offender, extract_child(Child)}],
    error_logger:error_report(supervisor_report, ErrorMsg).

shutdown_error_reporter(SupName) ->
    fun(Reason, Child) ->
        report_error(shutdown_error, Reason, Child, SupName)
    end.

extract_child(Child) ->
    [{pid, Child#child.pid},
     {name, Child#child.name},
     {mfa, Child#child.mfa},
     {restart_type, Child#child.restart_type},
     {shutdown, Child#child.shutdown},
     {child_type, Child#child.child_type}].
 



On May 28, 2013, at 5:02 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Guido,
> 
> On 24/05/13 14:35, Guido Extra wrote:
>> I have created several plugin applications that run under RabbitMQ
>> and when they produce an issue, sometimes the ERROR REPORT is logged
>> in a very short/incomplete manner that does not allow me to identify
>> where ( which module and line of code ) the error occurred.
>> 
>> Here is an example:
>> 
>> =ERROR REPORT==== 24-May-2013::08:23:35 === Error in process
>> <0.489.0> on node 'rabbit at guidomacbookpro2' with exit value:
>> {function_clause,[{orddict,fetch,["rxLBslwAswwgRz6RMtmDYenC8",[{"rxlbslwaswwgrz6rmtmdyenc8",[[{"BRANCH_ID","B8UpVlS40csA6v246IsYeTGYB"},{"DTTM_VERSION",2.013032e+16},{"HEADER_ID","B8UpVlS40csA6v246IsYeTGYB"},{"MODEL_ID","rxLBslwAsw...
>> 
>> Notice above the last "..." characters, that's where it all ends.
>> The interesting stuff is certainly at the end of that
>> 
>> Strangely, other times, the report shows complete. I can't also
>> understand what is the difference.
>> 
>> Question:
>> 
>> How to get a full / complete report ?
> 
> The above message is clearly generated by your own code - nothing in rabbit or otp produces an error message of the form "Error in process <pid> on node '<node>' with exit value: <reason>". So the truncation must happen in your own code, somehow.
> 
> Matthias.


From MJeffery at fnb.co.za  Tue May 28 13:12:29 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Tue, 28 May 2013 12:12:29 +0000
Subject: [rabbitmq-discuss] Trace Plugin
Message-ID: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>

Hello

The trace plugin is still listed as "experimental".

Would anyone be willing to confirm its readiness for use in a production environment ?

Another thing that I would just like to confirm :

Even if the tracing plugin is disabled, the command parameters trace_on and trace_off are still available to be passed to rabbitmqctl, they will just have no effect ?

Thanks

Jeff

To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130528/b6deb0e7/attachment.htm>

From matthias at rabbitmq.com  Tue May 28 13:24:39 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 May 2013 13:24:39 +0100
Subject: [rabbitmq-discuss] Trace Plugin
In-Reply-To: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
References: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
Message-ID: <51A4A207.1090103@rabbitmq.com>

On 28/05/13 13:12, Jeffery, Mark wrote:
> The trace plugin is still listed as ?experimental?.
>
> Would anyone be willing to confirm its readiness for use in a production
> environment ?

We are not planning any major work on it in the foreseeable future.
We haven't received many bug reports or feature requests since releasing 
it. Which could mean either the plug-in works perfectly, or it doesn't 
get used much, or both :) Take your pick.

> Another thing that I would just like to confirm :
>
> Even if the tracing plugin is disabled, the command parameters trace_on
> and trace_off are still available to be passed to rabbitmqctl, they will
> just have no effect ?

As the description of rabbitmq_tracing says... it "Adds message tracing 
to the management plugin. Logs messages from the firehose in a couple of 
formats.". So the actual tracing is done by the firehose 
(http://www.rabbitmq.com/firehose.html), and that's what 'rabbitmqctl 
trace_{on,off}' controls. Hence even without the rabbitmq_tracing 
plug-in, there is a cost to running with tracing enabled.

Regards,

Matthias.

From MJeffery at fnb.co.za  Tue May 28 13:52:20 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Tue, 28 May 2013 12:52:20 +0000
Subject: [rabbitmq-discuss] Trace Plugin
In-Reply-To: <51A4A207.1090103@rabbitmq.com>
References: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
	<51A4A207.1090103@rabbitmq.com>
Message-ID: <06536F18C0038E489237EEE3CA9BF2D01403E7C9@FRGR1D2MX07.services.firstrand.net>

Thanks.

Thanks for the prompt response :

I have the following scenario that led to my question

On 3.0.1 if I (via Java, not management console)

Have the rabbitmq_tracing plugin enabled
Declare a queue "tracepublish"
Bind it to exchange amq.rabbitmq.trace with routing key publish.#
Start a Consumer on "tracepublish"
Execute rabbitmqctl trace_on

I receive all the messages published perfectly.

However if I
Disable the rabbitmq_tracing plugin.
Declare a queue "tracepublish"
Bind it to exchange amq.rabbitmq.trace with routing key publish.#
Start a Consumer on "tracepublish"
Execute rabbitmqctl trace_on

I get no messages on the consumer side. Almost as though the firehose tracing was disabled when the plugin was disabled

Thanks

Jeff

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Tuesday, May 28, 2013 2:25 PM
To: Discussions about RabbitMQ
Cc: Jeffery, Mark
Subject: Re: [rabbitmq-discuss] Trace Plugin

On 28/05/13 13:12, Jeffery, Mark wrote:
> The trace plugin is still listed as "experimental".
>
> Would anyone be willing to confirm its readiness for use in a 
> production environment ?

We are not planning any major work on it in the foreseeable future.
We haven't received many bug reports or feature requests since releasing it. Which could mean either the plug-in works perfectly, or it doesn't get used much, or both :) Take your pick.

> Another thing that I would just like to confirm :
>
> Even if the tracing plugin is disabled, the command parameters 
> trace_on and trace_off are still available to be passed to 
> rabbitmqctl, they will just have no effect ?

As the description of rabbitmq_tracing says... it "Adds message tracing to the management plugin. Logs messages from the firehose in a couple of formats.". So the actual tracing is done by the firehose (http://www.rabbitmq.com/firehose.html), and that's what 'rabbitmqctl trace_{on,off}' controls. Hence even without the rabbitmq_tracing plug-in, there is a cost to running with tracing enabled.

Regards,

Matthias.
To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.

From steve at rabbitmq.com  Tue May 28 14:37:06 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 28 May 2013 14:37:06 +0100
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too
	short and incomplete
In-Reply-To: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
References: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
Message-ID: <8C8E83E6-81ED-484B-9DB5-DB8960E8A760@rabbitmq.com>

On 24 May 2013, at 14:35, Guido Extra <guido.extras at gmail.com> wrote:
> The interesting stuff is certainly at the end of that 

maybe not? 

> {function_clause,[{orddict,fetch,["rxLBslwAswwgRz6RMtmDYenC8",
> [{"rxlbslwaswwgrz6rmtmdyenc8", ...

I'm sure you noticed, but did you see that the search key matches the
first member of the orddict in every respect except CASE?

Just saying?

Steve Powell  [Cell: +44-7815-838-558]
Links: Pivotal, SpringSource, VMware, Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, aesthetic;
   is understandable, unobtrusive, honest;
   is long-lasting, thorough, environmentally friendly;
   and is as little design as possible.
Copyright Dieter Rams, amended March 2003; October 2009; and August 2012

From guido.extras at gmail.com  Tue May 28 14:42:42 2013
From: guido.extras at gmail.com (Guido Extra)
Date: Tue, 28 May 2013 08:42:42 -0500
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too
	short and incomplete
In-Reply-To: <8C8E83E6-81ED-484B-9DB5-DB8960E8A760@rabbitmq.com>
References: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
	<8C8E83E6-81ED-484B-9DB5-DB8960E8A760@rabbitmq.com>
Message-ID: <04FA70FE-6804-4FA9-9F0B-C3A88FBFB60B@gmail.com>


Yes Steve. Thanks for highlighting that. I had that resolved earlier. The only issue I have is to locate where in the code that happened given the truncated log/error details. I often get the fully formatted error report, but on some occasions it is simply truncated short from where the module and line numbers appear. 


On May 28, 2013, at 8:37 AM, Steve Powell <steve at rabbitmq.com> wrote:

>> rxLBslwAswwgRz6RMtmDYenC8

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130528/d36855cb/attachment.htm>

From tim at rabbitmq.com  Tue May 28 14:42:56 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 May 2013 14:42:56 +0100
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too
	short and incomplete
In-Reply-To: <28DAC48C-FF7D-492B-80DB-E000D4B19BA3@gmail.com>
References: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
	<51A480B3.7080700@rabbitmq.com>
	<28DAC48C-FF7D-492B-80DB-E000D4B19BA3@gmail.com>
Message-ID: <FE12207D-827D-4A11-84CF-209954824033@rabbitmq.com>

Guido,

On 28 May 2013, at 12:47, Guido Extra wrote:

> I checked the RabbitMq source code and found it used under the supervisor2.erl module below.
[snip]
> report_error(Error, Reason, Child, SupName) ->
>    ErrorMsg = [{supervisor, SupName},
> 		{errorContext, Error},
> 		{reason, Reason},
> 		{offender, extract_child(Child)}],
>    error_logger:error_report(supervisor_report, ErrorMsg).
> 
[snip]

Sure, but that code does not, as Matthias has already pointed out, print the message "error in Process <p> on node <n> ..." etc. *That* error message must be coming from somewhere else. What are your other dependencies, besides rabbit - have you looked in them for use of error_logger?

From j_depp_99 at yahoo.com  Tue May 28 14:47:22 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 28 May 2013 06:47:22 -0700 (PDT)
Subject: [rabbitmq-discuss] .net client producer fails consistently with
 Error Message: Unable to write data to the transport connection:
Message-ID: <1369748842405-27023.post@n5.nabble.com>

I have a producer setup using the .Net client (v 3.1.0.0) that is accessing a
high volume stream and writing to a rabbitmq queue. Very frequently the
producer will freeze while trying to send a message and then get the
following exception:



Unable to write data to the transport connection: An existing connection was
forcibly closed by the remote host


I then try and dispose of the producer but then get another error message:


   gproducer.Dispose()

AlreadyClosedException

The AMQP operation was interrupted: AMQP close-reason, initiated by Library,
code=0, text="End of stream", classId=0, methodId=0,
cause=System.IO.IOException: Unable to write data to the transport
connection: An established connection was aborted by the software in your
host machine. ---> System.Net.Sockets.SocketException: An established
connection was aborted by the software in your host machine
   at System.Net.Sockets.Socket.Send(Byte[] buffer, Int32 offset, Int32
size, SocketFlags socketFlags)
   at System.Net.Sockets.NetworkStream.Write(Byte[] buffer, Int32 offset,
Int32 size)
   --- End of inner exception stack trace ---
   at System.Net.Sockets.NetworkStream.Write(Byte[] buffer, Int32 offset,
Int32 size)
   at System.IO.BufferedStream.Flush()
   at System.IO.BinaryWriter.Flush()
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.WriteFrame(Frame frame)
   at RabbitMQ.Client.Impl.ConnectionBase.WriteFrame(Frame f)
   at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()


To work around this I then create a new producer and a new connection and
the cycle continues. This has happened almost every minute. Is this a
problem with the .NET client because the other developers here say they have
no problem with their java versions.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/net-client-producer-fails-consistently-with-Error-Message-Unable-to-write-data-to-the-transport-conn-tp27023.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Tue May 28 14:48:04 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 May 2013 14:48:04 +0100
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too
	short and incomplete
In-Reply-To: <FE12207D-827D-4A11-84CF-209954824033@rabbitmq.com>
References: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
	<51A480B3.7080700@rabbitmq.com>
	<28DAC48C-FF7D-492B-80DB-E000D4B19BA3@gmail.com>
	<FE12207D-827D-4A11-84CF-209954824033@rabbitmq.com>
Message-ID: <82875BC7-422D-4FFC-9FB1-27D1016C329C@rabbitmq.com>

Also...

On 28 May 2013, at 14:42, Tim Watson wrote:
> *That* error message must be coming from somewhere else. What are your other dependencies, besides rabbit - have you looked in them for use of error_logger?

In terms of the truncation - are you by any chance using the rabbitmq-lager logging integration?

From tim at rabbitmq.com  Tue May 28 14:52:53 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 May 2013 14:52:53 +0100
Subject: [rabbitmq-discuss] rabbitmq error report of plugins is too
	short and incomplete
In-Reply-To: <82875BC7-422D-4FFC-9FB1-27D1016C329C@rabbitmq.com>
References: <1EE595D4-B2CC-4DA6-B1A6-5D2F53B6B66B@gmail.com>
	<51A480B3.7080700@rabbitmq.com>
	<28DAC48C-FF7D-492B-80DB-E000D4B19BA3@gmail.com>
	<FE12207D-827D-4A11-84CF-209954824033@rabbitmq.com>
	<82875BC7-422D-4FFC-9FB1-27D1016C329C@rabbitmq.com>
Message-ID: <A4BA9883-D70E-42EE-A858-47761E323E28@rabbitmq.com>

And a quick update....

You *can* generate that error message with default sasl logging enabled, if your (even non gen_server afaict) process crashes unexpectedly, however... the truncation is /not/ a built in thing, nor is rabbit doing anything 'special' in this regard. If you're using lager (or another dependency that itself uses lager or installs a different error_logger event handler) then that might be to blame.

Cheers,
Tim

On 28 May 2013, at 14:48, Tim Watson wrote:

> Also...
> 
> On 28 May 2013, at 14:42, Tim Watson wrote:
>> *That* error message must be coming from somewhere else. What are your other dependencies, besides rabbit - have you looked in them for use of error_logger?
> 
> In terms of the truncation - are you by any chance using the rabbitmq-lager logging integration?


From AMorgan at salesforce.com  Tue May 28 15:10:35 2013
From: AMorgan at salesforce.com (Adam Morgan)
Date: Tue, 28 May 2013 07:10:35 -0700
Subject: [rabbitmq-discuss] Channel vs Connection shutdowns
Message-ID: <CDCA412B.2837%amorgan@salesforce.com>

I am working on a messaging API to wrap the RabbitMQ java client.  I am adding auto-reconnection logic using the ShutdownListener hook.

So far in my testing I have only been able to instigate a Connection shutdown.  I have added shutdown listeners to both Channels and Connections, but no matter what I do to try and cause a shutdown (besides calling Channel.close()), all shutdowns seem to be on the Connection.

Is there a way to instigate a non-application-initiated shutdown (ie, cause an error that results in a shutdown) on the Channel object instead of the Connection?

For the record, the only non-application-initiated shutdowns I have caused were by attempting to publish to a non-existent exchange with an immediate flag=true.

Thanks
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130528/24846a56/attachment.htm>

From tim at rabbitmq.com  Tue May 28 15:22:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 May 2013 15:22:07 +0100
Subject: [rabbitmq-discuss] [dotnet-client] Help mocking
	IModel.BasicPublish
In-Reply-To: <ab79c0c0-bf3e-4e44-8748-8b9c88d06a07@googlegroups.com>
References: <ab79c0c0-bf3e-4e44-8748-8b9c88d06a07@googlegroups.com>
Message-ID: <30396DB5-7391-4A0D-B30B-3BC09E743E56@rabbitmq.com>

Hi Mark,

On 24 May 2013, at 17:02, Mark Snelling wrote:

> I've managed to successfully implement reading from a mocked call to IModel.BasicConsume() and acknowledging with IModel.BasicAck() but am stuck on IModel.BasicPublish(), in particular mocking the ack/nack mechanism with IModel as I need to test my component in both those scenarios.
> 
> How does the ack/nack mechanism work with IModel.WaitForConfirms() and how would I go about sending an ack/nack when the publisher calls IModel.BasicPublish()?
> 

It really depends on how you've mocked the model reference, but essentially the broker will send either ACK for one (or more, if batching) or NACK for the published messages, depending on whether or not it was willing and able to take responsibility for them. Presumably in your test cases you want to handle the situation where #WaitForConfirms() fails, in which case you should either return false (where you wish to simulate the broker issuing a NACK) or return true but also set the out parameter 'timedOut' to true to indicate that a timeout occurred.

Hope that makes sense.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130528/995f5a11/attachment.htm>

From crashcourse at gmail.com  Tue May 28 18:11:15 2013
From: crashcourse at gmail.com (Crash Course)
Date: Tue, 28 May 2013 10:11:15 -0700
Subject: [rabbitmq-discuss] Architecture Question
Message-ID: <CAFLufr75tLsT_r5hZS_Dg_rPQdE8KF8A=nndk-9GfcWhwnn-jQ@mail.gmail.com>

Thanks for the response Tim!


> Hi,
>
> On 28 May 2013, at 05:49, Crash Course wrote:
>
> > I'm running the broker (3.1.1) on a Dual Xeon E5 (12 cores total) with 256 MB and Windows Server 2012, on Erlang R16B (64bit).
>
> I'm guessing you don't really mean 256MB right?

Correct - I meant 256 GB. Apparently I'm thinking about a different decade!

> > One of the primary workflows that we want to enable is using a cluster  is to have several workers behind the cluster taking messages from multiple clients.
> >
> > With a single producer -> direct exchange -> single consumer on a single broker, I can get about 38000 messages / second. (I'm not sure where the performance limit is here, since I'm not queuing any messages, the consumer is the equivalent of /dev/null, and the CPU on the broker doesn't go above 12%)
>
> There is no such thing as 'not queueing any messages' since consumers *have* to consume from a queue. Presumably what you're saying is that the consumer isn't doing any work before sending an ACK. Are you using ACKs, have you considered setting a prefetch count, etc? Have you read http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2 to get an idea of the baselines you might expect to see?

By "not queuing any messages", I mean that the broker has no queued
messages. The consumer is set up in noAck mode, and from the
documentation I've read, setting the prefetch count has no impact in
noAck. I have read that page to get an idea of baselines, which would
indicate that 44000 is a reasonable baseline for the single
producer/queue/consumer/noack scenario.

> >
> > To test it, I ran two brokers on the same server, and tried setting up a couple of different exchange/queue layouts:
>
> Have you considered benchmarking with a single broker first, then adding in the clustering later on? Clustering is intended to provide reliability/robustness/fallback rather than improve performance - were you aware of that? Clustering comes with some overheads, e.g., if you publish to node-1 and consume from node-2, the messages have to be routed between nodes as well. A queue will *only* run on one node in the cluster, so producers and/or consumers connecting to some other node, will have their actions (i.e., publishing or consuming) forwarded to the node on which the queue is running.

I was aware that clustering was intended to provide
reliability/robustness/fallback, but was hoping that it would provide
some ease of scaling as well, instead of having to have our
application be aware of which node/broker to connect to to optimize
performance.

> > Producers publishing to a single consistent hash exchange, with each consumer connecting to a private queue bound to the exchange
> > Producers publishing to a single exchange / default exchange, with each consumer connecting to a single queue off the exchange
> This limits throughput to the speed at which a single queue can progress, in terms of both accepting incoming messages *and* passing them on to individual consumers. Why? Because for each matching binding, the message will be routed to that (bound) queue. Are you saying that you're trying to use the producer supplied routing keys in combination with the bindings to distribute the load across multiple consumers?
>
> Having multiple publishers and multiple consumers generally will increase throughput, though there will still be limits and of course for a single queue, messages will be delivered to consumers in a round-robin fashion.

In the second scenario, I'm doing producer -> direct exchange ->
single queue -> multiple consumers, where producers and consumers
connect to a random node.

>
> > In the first scenario above, if I use 24 consumers (and hence 24 queues) distributed equally across both brokers, I can barely muster 52000 messages / second (and going up to 30% CPU on each Erlang broker)
> >
>
> What happens if you use producer => direct exch => queue => consumer * 24 instead? What about on a single broker? How fast can you make a single queue go (with your anticipated load) and what does the optimum balance between # producers and # consumers for a single queue appear to be on your hardware? What happens if you now take *that* configuration and balance it across multiple queues?

On a single broker, with producer -> direct exchange -> queue ->
consumer * 24, I still have a rate of ~38000 messages per second,
which leads me to believe that a single queue will be limited to that
rate on this hardware/OS configuration.

> > In the second scenario, I stop at under 10000 messages / second.
> >
>
> How are your producers and consumers set up? Are your channels in confirm mode or using transactions? Are you using basic.get or basic.consume to consume, what about ACKs - are these auto or manual - if the latter, how long do your clients take to ACK? Have you considered changing the prefetch size, esp. if you've got multiple consumers per queue?

The producers are sending a 500 byte message via basic.publish.
As above, my consumers are in noack mode, and they are using
basic.consume followed by performing a dequeue off the consumer in a
while loop (and doing no processing of the message).

Message size appears not to make a difference, as I can set the
message size to be 10 bytes, and the message rate stays the same.

> > This leads me to believe that the former is the better design, but what kind of architecture would give a 4 fold or 10 fold increase in throughput? Would we have to hash prior to RabbitMQ? An x-consistent-hash in front of multiple x-consistent-hash exchanges?
> >
>
> The idea of the x-consistent-hash-exchange is to evenly distributed messages based on routing key. If I were you, I'd start by benchmarking against a single broker with just one and then multiple producers *and* consumers per queue, if your application logic can cope with that. Then I'd consider introducing multiple exchanges and/or queues, both with 1 producer/consumer and then multiples, still on a single broker. Then, finally, I'd introduce clustering. By all means use the consistent hash exchange if it helps, but IMO first you should try to get a feel for how an "out of the box" topology can perform far various combinations (and multiples) of producers, consumers, queues, etc.

Thanks for the pointer!

What I'm seeing as I go from
4 producers -> direct exchange -> single queue -> 6 consumers
then repeating that layout two more times (in parallel) against a
single broker is:
38000 -> 54000 -> 63000 messages per second
and
14 -> 26 -> 34% CPU

Would your recommendation then be to achieve scaling of RabbitMQ by
having the application layer be able to send to multiple exchanges and
brokers, and consumers likewise be able to listen to multiple queues
and multiple brokers

> Cheers,
> Tim

From jesper.louis.andersen at gmail.com  Tue May 28 18:32:35 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Tue, 28 May 2013 19:32:35 +0200
Subject: [rabbitmq-discuss] Architecture Question
In-Reply-To: <CAFLufr75tLsT_r5hZS_Dg_rPQdE8KF8A=nndk-9GfcWhwnn-jQ@mail.gmail.com>
References: <CAFLufr75tLsT_r5hZS_Dg_rPQdE8KF8A=nndk-9GfcWhwnn-jQ@mail.gmail.com>
Message-ID: <CAGrdgiULDoTP55HCXRQjFqyE1qtf9MGdcGmnniHiJ6wGyF6+bg@mail.gmail.com>

On Tue, May 28, 2013 at 7:11 PM, Crash Course <crashcourse at gmail.com> wrote:

> Message size appears not to make a difference, as I can set the
> message size to be 10 bytes, and the message rate stays the same.
>

This would have me guess the problem is with either

latency - some kind of wait occurs which you are round-tripping on.
os configuration - some value is not tuned accordingly
implementation detail - there is somewhere in the stack something is
implemented in a less than desirable way.

I would check larger messages, 8k for instance right away.


-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130528/93184373/attachment.htm>

From crashcourse at gmail.com  Tue May 28 19:21:25 2013
From: crashcourse at gmail.com (Crash Course)
Date: Tue, 28 May 2013 11:21:25 -0700
Subject: [rabbitmq-discuss] Architecture Question
Message-ID: <CAFLufr5NYtNksCyr3owvR08ECxyoQH=9oheryVaUNDTbwPbTxg@mail.gmail.com>

Thanks Jesper,

I just tried with 8k messages, and the rate goes to drops to about
20000, but that doesn't seem too bad since the message is fairly
large.

Implementation wise, I'm not sure what else I can change, as I'm using
version 3.1.1 of the .NET client, and my consumer is just:

var consumer = new QueueingBasicConsumer(channel);
channel.BasicConsume(queue, true, consumer);

while (!shutdown)
{
try
{
consumer.Queue.Dequeue();
}
catch (EndOfStreamException)
{
break;
}
}


> On Tue, May 28, 2013 at 7:11 PM, Crash Course <crashcourse at gmail.com> wrote:
>
>> Message size appears not to make a difference, as I can set the
>> message size to be 10 bytes, and the message rate stays the same.
>>
>
> This would have me guess the problem is with either
>
> latency - some kind of wait occurs which you are round-tripping on.
> os configuration - some value is not tuned accordingly
> implementation detail - there is somewhere in the stack something is
> implemented in a less than desirable way.
>
> I would check larger messages, 8k for instance right away.
>
>
> --
> J.

From rohit.yadav at wingify.com  Tue May 28 22:06:50 2013
From: rohit.yadav at wingify.com (rohit.yadav at wingify.com)
Date: Tue, 28 May 2013 14:06:50 -0700 (PDT)
Subject: [rabbitmq-discuss] How to do publisher confirms over STOMP with
	RabbitMQ
Message-ID: <d38b2a93-fa1b-4b58-a477-2dde1a3474a4@googlegroups.com>

Hi,

I'm trying to explore STOMP to communicate with RabbitMQ. I'm sending a 
persistent message to RabbitMQ using a SEND frame with persistent:true and 
delivery-mode:2 headers but in return I don't get any RECEIPT or MESSAGE 
frame replies.
How do you do reliable message publishing over STOMP? Publisher confirms 
suggests that a reply would be sent if persistent messages are delivered to 
queue and persisted on disk or when they are consumed. In both cases I'm 
not getting any replies, am I doing it wrong.

If not confirms, how may I use transactions?

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130528/32902675/attachment.htm>

From matthias at rabbitmq.com  Tue May 28 23:13:32 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 May 2013 23:13:32 +0100
Subject: [rabbitmq-discuss] How to do publisher confirms over STOMP with
 RabbitMQ
In-Reply-To: <d38b2a93-fa1b-4b58-a477-2dde1a3474a4@googlegroups.com>
References: <d38b2a93-fa1b-4b58-a477-2dde1a3474a4@googlegroups.com>
Message-ID: <51A52C0C.7050100@rabbitmq.com>

On 28/05/13 22:06, rohit.yadav at wingify.com wrote:
> I'm trying to explore STOMP to communicate with RabbitMQ. I'm sending a
> persistent message to RabbitMQ using a SEND frame with persistent:true
> and delivery-mode:2 headers but in return I don't get any RECEIPT or
> MESSAGE frame replies.

You need to set a 'receipt' header on the SEND frame, as per the spec - 
http://stomp.github.io/stomp-specification-1.1.html#Header_receipt.

Btw, a) there is no point setting *both* persistent:true and 
delivery-mode:2, and b) receipts are orthogonal to persistence, i.e. 
whether receipts are issued depends solely on whether the SEND frame 
contains a 'receipt' header.

Regards,

Matthias.

From rohit.yadav at wingify.com  Wed May 29 04:41:44 2013
From: rohit.yadav at wingify.com (Rohit Yadav)
Date: Wed, 29 May 2013 09:11:44 +0530
Subject: [rabbitmq-discuss] How to do publisher confirms over STOMP with
	RabbitMQ
In-Reply-To: <51A52C0C.7050100@rabbitmq.com>
References: <d38b2a93-fa1b-4b58-a477-2dde1a3474a4@googlegroups.com>
	<51A52C0C.7050100@rabbitmq.com>
Message-ID: <CAMF++H-f39eB3=Ot2p_bfHV2Qvvy5MFAdYDAsUnNZ1zo7cAEbw@mail.gmail.com>

Thanks Matthias for your reply, you're right persistent:true would work,
both are making the message persistent.
What is the best way to deliver messages over STOMP reliably? I wanted to
use receipts as a way of knowing that the payload reached the STOMP
adapter. As per spec I also see transactions and ack, what works in that
use case?

Regards.


On Wed, May 29, 2013 at 3:43 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 28/05/13 22:06, rohit.yadav at wingify.com wrote:
>
>> I'm trying to explore STOMP to communicate with RabbitMQ. I'm sending a
>> persistent message to RabbitMQ using a SEND frame with persistent:true
>> and delivery-mode:2 headers but in return I don't get any RECEIPT or
>> MESSAGE frame replies.
>>
>
> You need to set a 'receipt' header on the SEND frame, as per the spec -
> http://stomp.github.io/stomp-**specification-1.1.html#Header_**receipt<http://stomp.github.io/stomp-specification-1.1.html#Header_receipt>
> .
>
> Btw, a) there is no point setting *both* persistent:true and
> delivery-mode:2, and b) receipts are orthogonal to persistence, i.e.
> whether receipts are issued depends solely on whether the SEND frame
> contains a 'receipt' header.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130529/e53ea0b2/attachment.htm>

From matthias at rabbitmq.com  Wed May 29 07:37:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 07:37:23 +0100
Subject: [rabbitmq-discuss] How to do publisher confirms over STOMP with
 RabbitMQ
In-Reply-To: <CAMF++H-f39eB3=Ot2p_bfHV2Qvvy5MFAdYDAsUnNZ1zo7cAEbw@mail.gmail.com>
References: <d38b2a93-fa1b-4b58-a477-2dde1a3474a4@googlegroups.com>
	<51A52C0C.7050100@rabbitmq.com>
	<CAMF++H-f39eB3=Ot2p_bfHV2Qvvy5MFAdYDAsUnNZ1zo7cAEbw@mail.gmail.com>
Message-ID: <51A5A223.9020209@rabbitmq.com>

On 29/05/13 04:41, Rohit Yadav wrote:
> What is the best way to deliver messages over STOMP reliably? I wanted
> to use receipts as a way of knowing that the payload reached the STOMP
> adapter.

That's what receipts are for. So use them.

> As per spec I also see transactions and ack, what works in that
> use case?

No point using transactions. Acks provide reliability for consuming. So 
use those there.

Matthias.

From mikhail.denisenko at nih.gov  Tue May 28 23:42:18 2013
From: mikhail.denisenko at nih.gov (Denisenko, Mikhail (NIH/NLM/NCBI) [C])
Date: Tue, 28 May 2013 22:42:18 +0000
Subject: [rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster
	to hang
Message-ID: <9BF1FFB72A0A1C46918CACA3891CB96A03D2831E@MLBXv02.nih.gov>

Hello,

We had a problem today that was caused by wiped rabbit_serial file on one of the nodes. Our rabbitmq cluster consisting of two nodes become inaccessible.
There is a ticket: https://github.com/rabbitmq/rabbitmq-server/issues/17

I think that rabbitmq should be able to recover from this situation by maybe removing invalid rabbit_serial file, what do you think?

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130528/286a6aed/attachment.htm>

From matthias at rabbitmq.com  Wed May 29 08:49:33 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 08:49:33 +0100
Subject: [rabbitmq-discuss] empty rabbit_serial file causes rabbitmq
 cluster to hang
In-Reply-To: <9BF1FFB72A0A1C46918CACA3891CB96A03D2831E@MLBXv02.nih.gov>
References: <9BF1FFB72A0A1C46918CACA3891CB96A03D2831E@MLBXv02.nih.gov>
Message-ID: <51A5B30D.2030408@rabbitmq.com>

On 28/05/13 23:42, Denisenko, Mikhail (NIH/NLM/NCBI) [C] wrote:
> We had a problem today that was caused by wiped rabbit_serial file on
> one of the nodes. Our rabbitmq cluster consisting of two nodes become
> inaccessible.
>
> There is a ticket: https://github.com/rabbitmq/rabbitmq-server/issues/17
>
> I think that rabbitmq should be able to recover from this situation by
> maybe removing invalid rabbit_serial file, what do you think?

As Emile mentioned in the ticket, rabbit cannot recover from arbitrary 
filesystem corruption.

The specific issue of rabbit_serial being empty actually has come up 
once before - see 
http://rabbitmq.1065348.n5.nabble.com/Cannot-start-guid-generator-rabbitmq-td4415.html. 
So I have filed a feature request to investigate whether we should 
handle this particular case of corruption more gracefully.

I recommend you look into what may have caused the corruption. While 
there is an easy workaround in this particular instance, the same isn't 
true for other files, and corruptions there could easily lead to data 
loss, possibly undetected.


Regards,

Matthias.

From sabrina.kuehn90 at web.de  Wed May 29 09:22:12 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Wed, 29 May 2013 01:22:12 -0700 (PDT)
Subject: [rabbitmq-discuss] User permission
In-Reply-To: <51A4861B.8010006@rabbitmq.com>
References: <1369402426514-26987.post@n5.nabble.com>
	<51A4861B.8010006@rabbitmq.com>
Message-ID: <1369815732957-27037.post@n5.nabble.com>

No there was a misunderstood between my boss and me. They don't have access
to the web interface but the problem is still there, that I don't know how I
should config the permissions.

> I have users who should have there own queues, *on* which only they and I
> should
> *have full access (c+w+r)* AND all of them should have permissions to
> *only* send msg to a >special
> queue and only one user (me) should have the permission to receive*(full
> access)*. 

To day is my last day here in this comany so I have to solve the problem
today or instruct someone (but I want to solve the problem so please help
me^^).



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/User-permission-tp26987p27037.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed May 29 09:26:17 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 09:26:17 +0100
Subject: [rabbitmq-discuss] Trace Plugin
In-Reply-To: <06536F18C0038E489237EEE3CA9BF2D01403E7C9@FRGR1D2MX07.services.firstrand.net>
References: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
	<51A4A207.1090103@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D01403E7C9@FRGR1D2MX07.services.firstrand.net>
Message-ID: <51A5BBA9.4010202@rabbitmq.com>

Jeff,

On 28/05/13 13:52, Jeffery, Mark wrote:
> I have the following scenario that led to my question
>
> On 3.0.1 if I (via Java, not management console)
>
> Have the rabbitmq_tracing plugin enabled
> Declare a queue "tracepublish"
> Bind it to exchange amq.rabbitmq.trace with routing key publish.#
> Start a Consumer on "tracepublish"
> Execute rabbitmqctl trace_on
>
> I receive all the messages published perfectly.
>
> However if I
> Disable the rabbitmq_tracing plugin.
> Declare a queue "tracepublish"
> Bind it to exchange amq.rabbitmq.trace with routing key publish.#
> Start a Consumer on "tracepublish"
> Execute rabbitmqctl trace_on
>
> I get no messages on the consumer side. Almost as though the firehose
> tracing was disabled when the plugin was disabled

I can see nothing in the code that would cause that to happen. Check the 
logs for "{Enabling,Disabling} tracing for vhost ..." messages. Any 
change in the tracing should be accompanied by these.

Note that the tracing state is checked on channel creation only, so 
enabling/disabling tracing after a channel has been created has no 
effect on the tracing of messages published/consumed on that channel. I 
wonder whether that could explain the difference in behaviour you were 
seeing.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed May 29 09:54:13 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 09:54:13 +0100
Subject: [rabbitmq-discuss] Channel vs Connection shutdowns
In-Reply-To: <CDCA412B.2837%amorgan@salesforce.com>
References: <CDCA412B.2837%amorgan@salesforce.com>
Message-ID: <51A5C235.1070402@rabbitmq.com>

Adam,

On 28/05/13 15:10, Adam Morgan wrote:
> Is there a way to instigate a non-application-initiated shutdown (ie,
> cause an error that results in a shutdown) on the Channel object instead
> of the Connection?

Take a look at all the errors that are labelled as "channel" in the spec 
at https://www.rabbitmq.com/amqp-0-9-1-reference.html#constants, and 
then look at the various AMQP commands documented in the spec to see 
which ones return such errors.

As you'll see from that, there are quite a few ways to trigger channel 
errors. One of the easiest is probably to attempt to delete a 
non-existing queue.

> For the record, the only non-application-initiated shutdowns I have
> caused were by attempting to publish to a non-existent exchange with an
> immediate flag=true.

Publishing to a non-existing exchange will trigger a 404 (not-found) 
channel error, so that should have worked... except publishing with the 
'immediate' flag is unsupported, triggering a 540 (not-implemented) 
connection error instead.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed May 29 10:40:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 10:40:51 +0100
Subject: [rabbitmq-discuss] User permission
In-Reply-To: <1369815732957-27037.post@n5.nabble.com>
References: <1369402426514-26987.post@n5.nabble.com>
	<51A4861B.8010006@rabbitmq.com>
	<1369815732957-27037.post@n5.nabble.com>
Message-ID: <51A5CD23.9090406@rabbitmq.com>

On 29/05/13 09:22, Slyth wrote:
> No there was a misunderstood between my boss and me. They don't have access
> to the web interface but the problem is still there, that I don't know how I
> should config the permissions.
>
>> I have users who should have there own queues, *on* which only they and I
>> should
>> *have full access (c+w+r)* AND all of them should have permissions to
>> *only* send msg to a >special
>> queue and only one user (me) should have the permission to receive*(full
>> access)*.

Most of that should be quite straightforward to set up. The only tricky 
bit is preventing users from sending messages to queues other than their 
own. Before we come to that, have you managed to get the permissions set 
up for everything else? If not, please explain what you tried, i.e. what 
permissions you have set (post the output of 'rabbitmqctl 
list_permissions') and what incorrect behaviour you observed.

Matthias.

From sabrina.kuehn90 at web.de  Wed May 29 10:56:52 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Wed, 29 May 2013 02:56:52 -0700 (PDT)
Subject: [rabbitmq-discuss] User permission
In-Reply-To: <51A5CD23.9090406@rabbitmq.com>
References: <1369402426514-26987.post@n5.nabble.com>
	<51A4861B.8010006@rabbitmq.com>
	<1369815732957-27037.post@n5.nabble.com>
	<51A5CD23.9090406@rabbitmq.com>
Message-ID: <1369821412556-27041.post@n5.nabble.com>

Here is the output:
root at rab1:~# rabbitmqctl list_permissions -p drainware
Listing permissions in vhost "drainware" ...
drainware       .*      .*      .*
test    ^[.*]   .*      ^[.*]
...done.
root at rab1:~# rabbitmqctl list_permissions -p vtest
Listing permissions in vhost "vtest" ...
drainware       .*      .*      .*
test    .*      .*      .*
...done.

User should't be allowed to send or receive msg of the queue of other user
only of their own and all should be able to send to one special queue. I
used a seperat vhost but perhaps I can use one vhost or should use one vhost
and can use regex to solve my problem.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/User-permission-tp26987p27041.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed May 29 11:08:03 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 11:08:03 +0100
Subject: [rabbitmq-discuss] User permission
In-Reply-To: <1369821412556-27041.post@n5.nabble.com>
References: <1369402426514-26987.post@n5.nabble.com>
	<51A4861B.8010006@rabbitmq.com>
	<1369815732957-27037.post@n5.nabble.com>
	<51A5CD23.9090406@rabbitmq.com>
	<1369821412556-27041.post@n5.nabble.com>
Message-ID: <51A5D383.1090809@rabbitmq.com>

On 29/05/13 10:56, Slyth wrote:
> Here is the output:
> root at rab1:~# rabbitmqctl list_permissions -p drainware
> Listing permissions in vhost "drainware" ...
> drainware       .*      .*      .*
> test    ^[.*]   .*      ^[.*]
> ...done.
> root at rab1:~# rabbitmqctl list_permissions -p vtest
> Listing permissions in vhost "vtest" ...
> drainware       .*      .*      .*
> test    .*      .*      .*
> ...done.

So what exactly doesn't work right with the above setup?

Matthias.

From sabrina.kuehn90 at web.de  Wed May 29 11:13:37 2013
From: sabrina.kuehn90 at web.de (Slyth)
Date: Wed, 29 May 2013 03:13:37 -0700 (PDT)
Subject: [rabbitmq-discuss] User permission
In-Reply-To: <51A5D383.1090809@rabbitmq.com>
References: <1369402426514-26987.post@n5.nabble.com>
	<51A4861B.8010006@rabbitmq.com>
	<1369815732957-27037.post@n5.nabble.com>
	<51A5CD23.9090406@rabbitmq.com>
	<1369821412556-27041.post@n5.nabble.com>
	<51A5D383.1090809@rabbitmq.com>
Message-ID: <1369822417379-27043.post@n5.nabble.com>

I think there has to be a better solution or not?

Is it the best solution that I need for every user a new vhost or is it
better to use one vhost and use regex to manage the access?

Would you use the same solution?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/User-permission-tp26987p27043.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From MJeffery at fnb.co.za  Wed May 29 11:24:07 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Wed, 29 May 2013 10:24:07 +0000
Subject: [rabbitmq-discuss] Trace Plugin
References: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
	<51A4A207.1090103@rabbitmq.com> 
Message-ID: <06536F18C0038E489237EEE3CA9BF2D01403F9E5@FRGR1D2MX07.services.firstrand.net>

Hello

Is this a bug ? elbeit a low priority one.

I have tested the same client on 2.8.4 and I receive messages.

Thanks

Jeff

-----Original Message-----
From: Jeffery, Mark 
Sent: Tuesday, May 28, 2013 2:52 PM
To: 'Matthias Radestock'; Discussions about RabbitMQ
Subject: RE: [rabbitmq-discuss] Trace Plugin

Thanks.

Thanks for the prompt response :

I have the following scenario that led to my question

On 3.0.1 if I (via Java, not management console)

Have the rabbitmq_tracing plugin enabled Declare a queue "tracepublish"
Bind it to exchange amq.rabbitmq.trace with routing key publish.# Start a Consumer on "tracepublish"
Execute rabbitmqctl trace_on

I receive all the messages published perfectly.

However if I
Disable the rabbitmq_tracing plugin.
Declare a queue "tracepublish"
Bind it to exchange amq.rabbitmq.trace with routing key publish.# Start a Consumer on "tracepublish"
Execute rabbitmqctl trace_on

I get no messages on the consumer side. Almost as though the firehose tracing was disabled when the plugin was disabled

Thanks

Jeff

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Tuesday, May 28, 2013 2:25 PM
To: Discussions about RabbitMQ
Cc: Jeffery, Mark
Subject: Re: [rabbitmq-discuss] Trace Plugin

On 28/05/13 13:12, Jeffery, Mark wrote:
> The trace plugin is still listed as "experimental".
>
> Would anyone be willing to confirm its readiness for use in a 
> production environment ?

We are not planning any major work on it in the foreseeable future.
We haven't received many bug reports or feature requests since releasing it. Which could mean either the plug-in works perfectly, or it doesn't get used much, or both :) Take your pick.

> Another thing that I would just like to confirm :
>
> Even if the tracing plugin is disabled, the command parameters 
> trace_on and trace_off are still available to be passed to 
> rabbitmqctl, they will just have no effect ?

As the description of rabbitmq_tracing says... it "Adds message tracing to the management plugin. Logs messages from the firehose in a couple of formats.". So the actual tracing is done by the firehose (http://www.rabbitmq.com/firehose.html), and that's what 'rabbitmqctl trace_{on,off}' controls. Hence even without the rabbitmq_tracing plug-in, there is a cost to running with tracing enabled.

Regards,

Matthias.
To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.

From matthias at rabbitmq.com  Wed May 29 11:30:39 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 11:30:39 +0100
Subject: [rabbitmq-discuss] Trace Plugin
In-Reply-To: <06536F18C0038E489237EEE3CA9BF2D01403F9E5@FRGR1D2MX07.services.firstrand.net>
References: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
	<51A4A207.1090103@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D01403F9E5@FRGR1D2MX07.services.firstrand.net>
Message-ID: <51A5D8CF.9060505@rabbitmq.com>

On 29/05/13 11:24, Jeffery, Mark wrote:
> Is this a bug ? elbeit a low priority one.
>
> I have tested the same client on 2.8.4 and I receive messages.

See my reply from a few hours ago. Matthias.

From simon at rabbitmq.com  Wed May 29 11:48:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 May 2013 11:48:14 +0100
Subject: [rabbitmq-discuss] Monitoring for busy_dist_port
In-Reply-To: <CANum3oVQZ_jORuEFp6QH6=kxb0OjN==GSx3M7OuDAhk3RA+Lvg@mail.gmail.com>
References: <CANum3oXEbm6Xyy98-Jif09HbkEWB6bYGiwWN4ZNF55af9OJRtg@mail.gmail.com>
	<519B86E8.4020102@rabbitmq.com>
	<CANum3oVQZ_jORuEFp6QH6=kxb0OjN==GSx3M7OuDAhk3RA+Lvg@mail.gmail.com>
Message-ID: <51A5DCEE.5020308@rabbitmq.com>

Hi Iain.

I read that blog post some time ago and am still not very clear on what 
is *really* going on, but I'm certainly sure that from our perspective, 
busy_dist_port is nothing to be scared of, which is why we don't log it.

So I would not worry.

Cheers, Simon

On 24/05/13 15:35, Iain Hull wrote:
> Hi Simon, Tim,
>
> Thanks for your replies and effort analysing my query.
>
> On Riak we have experienced stability issues when large data is
> being transferred.  I am not too sure the exact root cause, but we see
> busy_dist_port messages then one of the Riak nodes crashes and has to be
> restarted by Chef.  Increasing "+zdbbl 18432" resolved this issue.
>
> This contains more information about Riak and this setting
> http://boundary.com/blog/2012/09/26/incuriosity-killed-the-infrastructur/
>
> We have not seen any stability issues with our use of RabbitMQ to date.
> After our Riak experience I was concerned if our RabbitMQ usage pattern
> changes over time (for example message sizes increase), we could
> experience similar stability issues too.  If there is a chance of this I
> would like to be warned before its a problem.
>
> Iain.
>
>
> On 21 May 2013 15:38, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     To add to what Tim said: I've run some tests with busy_dist_port
>     monitoring patched into RabbitMQ and while I can certainly see
>     busy_dist_port messages, I haven't been able to demonstrate any
>     improvement in throughput by tweaking zdbbl until they went away -
>     so I don't see the point in exposing them.
>
>     Out of interest, did you see a performance improvement in Riak after
>     modifying zdbbl, or were you just trying to make the warnings go
>     away? :-)
>
>     Cheers, Simon
>
>
>     On 20/05/13 12:15, Iain Hull wrote:
>
>         We are in the process of deploying a Riak cluster, and are
>         wondering if
>         some of the lessons we learned monitoring Erlang in Riak should be
>         applied to RabbitMQ.
>
>         During testing we noticed a lot of busy_dist_port in the logs,
>         the root
>         was cause was a the Erlang kernel parameter zdbbl was set too
>         low.  We
>         have adjusted the parameter and are now monitoring the logs for
>         busy_dist_port errors.
>
>         I have searched the RabbitMQ mailing list for cases of
>         busy_dist_port or
>         zdbbl, but cannot find any.  I am wondering if RabbitMQ can
>         suffer from
>         problems with busy_dist_port or if zdbbl should be set to any
>         particular
>         value? Or I should I monitor the RabbitMQ logs for busy_dist_port?
>
>         Thanks,
>         Iain.
>
>         --
>         Iain Hull
>         Senior Software Engineer
>         iain.hull.workday (Skype)
>         iain.hull at workday.com <mailto:iain.hull at workday.com>
>         <mailto:iain.hull at workday.com <mailto:iain.hull at workday.com>>
>
>         <http://www.workday.com/__signature-uk
>         <http://www.workday.com/signature-uk>>
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>
>
>
> --
> Iain Hull
> Senior Software Engineer
> iain.hull.workday (Skype)
> iain.hull at workday.com <mailto:iain.hull at workday.com>
>
> <http://www.workday.com/signature-uk>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Wed May 29 11:52:22 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 29 May 2013 11:52:22 +0100
Subject: [rabbitmq-discuss] .net client producer fails consistently with
 Error Message: Unable to write data to the transport connection:
In-Reply-To: <1369748842405-27023.post@n5.nabble.com>
References: <1369748842405-27023.post@n5.nabble.com>
Message-ID: <51A5DDE6.5000500@rabbitmq.com>

On 28/05/13 14:47, jdepp wrote:
> Unable to write data to the transport connection: An existing connection was
> forcibly closed by the remote host

> To work around this I then create a new producer and a new connection and
> the cycle continues. This has happened almost every minute. Is this a
> problem with the .NET client because the other developers here say they have
> no problem with their java versions.

Have you checked the broker logfile? If the logfile contains entries
about abrupt disconnections then the problem is probably caused by a
network infrastructure issue. Do you see the same problem when you
connect to a broker over the loopback interface?

The connection Dispose() method is similar to calling Abort(), which is
similar to calling Close(), which throws an exception if the connection
is already closed. An alternative is to register a ConnectionShutdown
event handler.




-Emile








From emile at rabbitmq.com  Wed May 29 12:12:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 29 May 2013 12:12:50 +0100
Subject: [rabbitmq-discuss] .net client producer fails consistently with
 Error Message: Unable to write data to the transport connection:
In-Reply-To: <51A5DDE6.5000500@rabbitmq.com>
References: <1369748842405-27023.post@n5.nabble.com>
	<51A5DDE6.5000500@rabbitmq.com>
Message-ID: <51A5E2B2.4080104@rabbitmq.com>

On 29/05/13 11:52, Emile Joubert wrote:
> Abort(), which is similar to calling Close(), which throws an
> exception if the connection is already closed.

This explanation is slightly misleading because Abort() does not throw
AlreadyClosedException. I failed to mention that there is a bug open to
improve the behaviour of IConnection.Dispose(). When fixed this will be
listed in the release notes of the relevant release.



-Emile






From simlu at su.se  Wed May 29 12:41:11 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Wed, 29 May 2013 13:41:11 +0200
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <20130524144308.GQ292@kaka.it.su.se>
References: <20121019100118.GB1210@kaka.it.su.se>
	<508149DB.7010701@rabbitmq.com>
	<20121029160441.GI426@kaka.it.su.se>
	<508FB1AF.8060003@rabbitmq.com>
	<20121030110101.GK426@kaka.it.su.se>
	<508FB59F.9030807@rabbitmq.com>
	<20121030121229.GM426@kaka.it.su.se>
	<5097C8CF.6050901@rabbitmq.com>
	<20130524144308.GQ292@kaka.it.su.se>
Message-ID: <20130529114110.GA1107@kaka.it.su.se>

Hi Tim!

No, I haven't signed any contributor agreement, please advice.

(As per GitHub pull request)

Br,
- Simon

On Fri, 2013-05-24 at 16:43:09 +0200, Simon Lundstr?m wrote:
> On Mon, 2012-11-05 at 14:10:23 +0000, Simon MacMullen wrote:
> > On 30/10/12 12:12, Simon Lundstr?m wrote:
> > >So basically:
> > >
> > >Parse the config/defaults in this order:
> > ># defaults from default_options hash^Wdictionary
> > ># config file
> > >## Find out which config file to use, one of:
> > >### specified via --config
> > >#### Use it and exit with an error if it doesn't exist
> > >### default config file (~/.rabbitmqadmin.conf)
> > >#### If file doesn't exist, just ignore it.
> > >## If node doesn't exist in config and is:
> > >### specified via commandline
> > >#### Display error and exit
> > >### using the default node
> > >#### ignore the config file entirely
> > ># Options on the command line
> > 
> > Yes, I think that makes sense.
> 
> Sorry for taking so long, been busy on other things = )
> 
> I've patched this and created a PR on Github (see
> <https://github.com/rabbitmq/rabbitmq-management/pull/6>)
> 
> Please tell me if you prefer patches some other way.
> 
> Have a great weekend!

From domwongemail at gmail.com  Wed May 29 12:52:39 2013
From: domwongemail at gmail.com (Dominic Wong)
Date: Wed, 29 May 2013 12:52:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ shovel - standalone app?
Message-ID: <BE7C9B62-1985-4362-BEBD-84651F26B570@googlemail.com>

Hi all,

I was wondering if there is a standalone version of the rabbit shovel plugin i.e. one that I can run without having to spin up a rabbit broker. 

My use case is that I'd like to spin up shovels in a fairly dynamic manner without having to restart the broker every time I want to change my shovel definitions. For instance, I want a loosely couple "cloud" of rabbit brokers and want to shovel messages between them. When one broker comes up I'd like to start shovels that push messages to this broker and pull messages out of it. I don't think I can really use federation since I'd like finer grained control over what gets pushed to where.

Any pointers on how I can achieve this?

Thanks
Dom

From MJeffery at fnb.co.za  Wed May 29 13:36:21 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Wed, 29 May 2013 12:36:21 +0000
Subject: [rabbitmq-discuss] Trace Plugin
In-Reply-To: <51A5BBA9.4010202@rabbitmq.com>
References: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
	<51A4A207.1090103@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D01403E7C9@FRGR1D2MX07.services.firstrand.net>
	<51A5BBA9.4010202@rabbitmq.com>
Message-ID: <06536F18C0038E489237EEE3CA9BF2D01403FDB1@FRGR1D2MX07.services.firstrand.net>

Apologies for bumping earlier: I didn't see the mail.

I think this is cluster related (I didn't mention the cluster earlier, sorry)

It seems that the fire-hose tracing only seems to allow tracing on the first node that is started in the cluster.
ie The consumer needs to connect to the node that was started first.
If I connect the consumer to a node that wasn't started first, messages aren't routed to the declared queue.

Is this the case ?

I am able to run trace_on and trace_off and see the messages start and stop at the consumer with no problems. (With out re-creating the channel).

Thanks

Jeff

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Wednesday, May 29, 2013 10:26 AM
To: Jeffery, Mark
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Trace Plugin

Jeff,

On 28/05/13 13:52, Jeffery, Mark wrote:
> I have the following scenario that led to my question
>
> On 3.0.1 if I (via Java, not management console)
>
> Have the rabbitmq_tracing plugin enabled Declare a queue 
> "tracepublish"
> Bind it to exchange amq.rabbitmq.trace with routing key publish.# 
> Start a Consumer on "tracepublish"
> Execute rabbitmqctl trace_on
>
> I receive all the messages published perfectly.
>
> However if I
> Disable the rabbitmq_tracing plugin.
> Declare a queue "tracepublish"
> Bind it to exchange amq.rabbitmq.trace with routing key publish.# 
> Start a Consumer on "tracepublish"
> Execute rabbitmqctl trace_on
>
> I get no messages on the consumer side. Almost as though the firehose 
> tracing was disabled when the plugin was disabled

I can see nothing in the code that would cause that to happen. Check the logs for "{Enabling,Disabling} tracing for vhost ..." messages. Any change in the tracing should be accompanied by these.

Note that the tracing state is checked on channel creation only, so enabling/disabling tracing after a channel has been created has no effect on the tracing of messages published/consumed on that channel. I wonder whether that could explain the difference in behaviour you were seeing.

Regards,

Matthias.
To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.

From matthias at rabbitmq.com  Wed May 29 13:47:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 13:47:10 +0100
Subject: [rabbitmq-discuss] Trace Plugin
In-Reply-To: <06536F18C0038E489237EEE3CA9BF2D01403FDB1@FRGR1D2MX07.services.firstrand.net>
References: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
	<51A4A207.1090103@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D01403E7C9@FRGR1D2MX07.services.firstrand.net>
	<51A5BBA9.4010202@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D01403FDB1@FRGR1D2MX07.services.firstrand.net>
Message-ID: <51A5F8CE.8080106@rabbitmq.com>

Jeff,

On 29/05/13 13:36, Jeffery, Mark wrote:
> It seems that the fire-hose tracing only seems to allow tracing on
> the first node that is started in the cluster.

Not so much that, but as the docs 
(http://www.rabbitmq.com/firehose.html) state, tracing is a *per-node* 
feature. i.e. if you want to trace on all nodes then you need to run 
'rabbitmqctl trace_on' on all nodes.

> I am able to run trace_on and trace_off and see the messages start
> and stop at the consumer with no problems. (With out re-creating the
> channel).

The channels that matter are the ones on which the messages you want to 
trace get transmitted. Not the channels on which you consume the trace 
messages.

Matthias.

From MJeffery at fnb.co.za  Wed May 29 13:50:14 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Wed, 29 May 2013 12:50:14 +0000
Subject: [rabbitmq-discuss] Trace Plugin
In-Reply-To: <51A5F8CE.8080106@rabbitmq.com>
References: <06536F18C0038E489237EEE3CA9BF2D01403E708@FRGR1D2MX07.services.firstrand.net>
	<51A4A207.1090103@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D01403E7C9@FRGR1D2MX07.services.firstrand.net>
	<51A5BBA9.4010202@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D01403FDB1@FRGR1D2MX07.services.firstrand.net>
	<51A5F8CE.8080106@rabbitmq.com>
Message-ID: <06536F18C0038E489237EEE3CA9BF2D01403FE37@FRGR1D2MX07.services.firstrand.net>

Perfect.

Thanks for clearing that up.



-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Wednesday, May 29, 2013 2:47 PM
To: Jeffery, Mark
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Trace Plugin

Jeff,

On 29/05/13 13:36, Jeffery, Mark wrote:
> It seems that the fire-hose tracing only seems to allow tracing on the 
> first node that is started in the cluster.

Not so much that, but as the docs
(http://www.rabbitmq.com/firehose.html) state, tracing is a *per-node* feature. i.e. if you want to trace on all nodes then you need to run 'rabbitmqctl trace_on' on all nodes.

> I am able to run trace_on and trace_off and see the messages start and 
> stop at the consumer with no problems. (With out re-creating the 
> channel).

The channels that matter are the ones on which the messages you want to trace get transmitted. Not the channels on which you consume the trace messages.

Matthias.
To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.

From j_depp_99 at yahoo.com  Wed May 29 15:28:40 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Wed, 29 May 2013 07:28:40 -0700 (PDT)
Subject: [rabbitmq-discuss] .net client producer fails consistently with
 Error Message: Unable to write data to the transport connection:
In-Reply-To: <51A5E2B2.4080104@rabbitmq.com>
References: <1369748842405-27023.post@n5.nabble.com>
	<51A5DDE6.5000500@rabbitmq.com> <51A5E2B2.4080104@rabbitmq.com>
Message-ID: <1369837720302-27054.post@n5.nabble.com>

Thanks for your response. I actually finally figured out what was wrong. The
other developers had consumers running that were not acknowledging messages
correctly or fast enough and the unacknowledged queue was over 500000. Once
I stopped producing and had them restart their consumers; I restarted my
producer and it has been running error free for more than 12 hours. I knew
that the rabbit server will throttle the producer but did not expect a
disconnect and I guess the timeout comes into play as it is being throttled.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/net-client-producer-fails-consistently-with-Error-Message-Unable-to-write-data-to-the-transport-conn-tp27023p27054.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mikhail.denisenko at nih.gov  Wed May 29 15:43:06 2013
From: mikhail.denisenko at nih.gov (Denisenko, Mikhail (NIH/NLM/NCBI) [C])
Date: Wed, 29 May 2013 14:43:06 +0000
Subject: [rabbitmq-discuss] empty rabbit_serial file causes rabbitmq
 cluster to hang
In-Reply-To: <51A5B30D.2030408@rabbitmq.com>
References: <9BF1FFB72A0A1C46918CACA3891CB96A03D2831E@MLBXv02.nih.gov>,
	<51A5B30D.2030408@rabbitmq.com>
Message-ID: <9BF1FFB72A0A1C46918CACA3891CB96A03D28995@MLBXv02.nih.gov>

Thanks for the feature request. In our case this file become corrupted after restart of rabbitmq. Our restart procedure is to try graceful restart first and after some time try kill -9 if it didn't exit. I suspect that in this case it didn't die within timeout and was killed with -9 and maybe it didn't flush buffer for this file.
________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Wednesday, May 29, 2013 3:49 AM
To: Discussions about RabbitMQ
Cc: Denisenko, Mikhail (NIH/NLM/NCBI) [C]
Subject: Re: [rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang

On 28/05/13 23:42, Denisenko, Mikhail (NIH/NLM/NCBI) [C] wrote:
> We had a problem today that was caused by wiped rabbit_serial file on
> one of the nodes. Our rabbitmq cluster consisting of two nodes become
> inaccessible.
>
> There is a ticket: https://github.com/rabbitmq/rabbitmq-server/issues/17
>
> I think that rabbitmq should be able to recover from this situation by
> maybe removing invalid rabbit_serial file, what do you think?

As Emile mentioned in the ticket, rabbit cannot recover from arbitrary
filesystem corruption.

The specific issue of rabbit_serial being empty actually has come up
once before - see
http://rabbitmq.1065348.n5.nabble.com/Cannot-start-guid-generator-rabbitmq-td4415.html.
So I have filed a feature request to investigate whether we should
handle this particular case of corruption more gracefully.

I recommend you look into what may have caused the corruption. While
there is an easy workaround in this particular instance, the same isn't
true for other files, and corruptions there could easily lead to data
loss, possibly undetected.


Regards,

Matthias.

From n16483 at cray.com  Wed May 29 15:53:36 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Wed, 29 May 2013 09:53:36 -0500
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <51A12581.40908@rabbitmq.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com> <519FE1BB.9030005@cray.com>
	<51A12581.40908@rabbitmq.com>
Message-ID: <51A61670.8050104@cray.com>

Matthias,

Sorry for the delay in responding.

I have the LDAP auth plugin logging at Network level. There are no 
additional log statements that are being output. I've also confirmed 
that the user exists in my LDAP. So, I'm not sure why it couldn't find 
the user, unless it's not looking for the correct username. It should be 
using the CN from the SSL certificate as the username, which in this 
case should be either ecozzi-02 or ecozzi-03.

Erlang version is:
ecozzi-01:/home/ecozzi # cat /usr/lib64/erlang/releases/RELEASES
[{release,"OTP  APN 181 01","R15B02","5.9.2",
           [{kernel,"2.15.2","/usr/lib64/erlang/lib/kernel-2.15.2"},
            {stdlib,"1.18.2","/usr/lib64/erlang/lib/stdlib-1.18.2"},
            {sasl,"2.2.1","/usr/lib64/erlang/lib/sasl-2.2.1"}],
           permanent}].

Rabbit Version:
ecozzi-01:/home/ecozzi # rabbitmqctl status
Status of node 'rabbit at ecozzi-01' ...
[{pid,3800},
  {running_applications,
      [{rabbitmq_federation_management,"RabbitMQ Federation Management",
           "3.0.1"},
       {rabbitmq_management,"RabbitMQ Management Console","3.0.1"},
       {rabbitmq_federation,"RabbitMQ Federation","3.0.1"},
       {rabbitmq_auth_backend_ldap,"RabbitMQ LDAP Authentication Backend",
           "3.0.1"},
       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.1"},
       {rabbit,"RabbitMQ","3.0.1"},
       {ssl,"Erlang/OTP SSL application","5.1"},
       {public_key,"Public key infrastructure","0.16"},
       {crypto,"CRYPTO version 2","2.2"},
       {os_mon,"CPO  CXC 138 46","2.2.10"},
       {rabbitmq_auth_mechanism_ssl,
           "RabbitMQ SSL authentication (SASL EXTERNAL)","3.0.1"},
       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.1"},
       {webmachine,"webmachine","1.9.1-rmq3.0.1-git52e62bc"},
       {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.1-gitd541e9a"},
       {xmerl,"XML parser","1.3.2"},
       {inets,"INETS  CXC 138 49","5.9.1"},
       {mnesia,"MNESIA  CXC 138 12","4.7.1"},
       {eldap,"Ldap api","1.0"},
       {amqp_client,"RabbitMQ AMQP Client","3.0.1"},
       {sasl,"SASL  CXC 138 11","2.2.1"},
       {stdlib,"ERTS  CXC 138 10","1.18.2"},
       {kernel,"ERTS  CXC 138 10","2.15.2"}]},
  {os,{unix,linux}},
  {erlang_version,
      "Erlang R15B02 (erts-5.9.2) [source] [64-bit] [smp:2:2] 
[async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,
      [{total,37603792},
       {connection_procs,162600},
       {queue_procs,235552},
       {plugins,377592},
       {other_proc,10276868},
       {mnesia,94464},
       {mgmt_db,84936},
       {msg_index,32576},
       {other_ets,1236360},
       {binary,306624},
       {code,20204649},
       {atom,760729},
       {other_system,3830842}]},
  {vm_memory_high_watermark,0.4},
  {vm_memory_limit,205919027},
  {disk_free_limit,1000000000},
  {disk_free,0},
  {file_descriptors,
      
[{total_limit,924},{total_used,16},{sockets_limit,829},{sockets_used,4}]},
  {processes,[{limit,1048576},{used,249}]},
  {run_queue,0},
  {uptime,406985}]
...done.

On 05/25/2013 03:56 PM, Matthias Radestock wrote:
> Eric,
>
> On 24/05/13 22:55, Eric Cozzi wrote:
>>                   {{badarg,{error,noSuchObject}},
>> [{rabbit_access_control,'-check_vhost_access/2-fun-0-',3,[]},
>>                     {rabbit_access_control,check_access,5,[]},
>
> That indicates that your LDAP auth backend returned a 'noSuchObject' 
> error when performing the vhost access check for the user.
>
> I suggest you enable logging in the LDAP auth plug-in to track down 
> the cause.
>
> However, the error really should be handled more gracefully by rabbit, 
> and I am at a loss why it's producing such a stack trace. What 
> versions of RabbitMQ and Erlang are you running and how did you 
> install rabbit (e.g. from a package, compiled from source, etc)?
>
> Matthias.
>

From matthias at rabbitmq.com  Wed May 29 16:04:43 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 16:04:43 +0100
Subject: [rabbitmq-discuss] empty rabbit_serial file causes rabbitmq
 cluster to hang
In-Reply-To: <9BF1FFB72A0A1C46918CACA3891CB96A03D28995@MLBXv02.nih.gov>
References: <9BF1FFB72A0A1C46918CACA3891CB96A03D2831E@MLBXv02.nih.gov>,
	<51A5B30D.2030408@rabbitmq.com>
	<9BF1FFB72A0A1C46918CACA3891CB96A03D28995@MLBXv02.nih.gov>
Message-ID: <51A6190B.2060002@rabbitmq.com>

On 29/05/13 15:43, Denisenko, Mikhail (NIH/NLM/NCBI) [C] wrote:
> Thanks for the feature request. In our case this file become
> corrupted after restart of rabbitmq. Our restart procedure is to try
> graceful restart first and after some time try kill -9 if it didn't
> exit. I suspect that in this case it didn't die within timeout and
> was killed with -9 and maybe it didn't flush buffer for this file.

Hmm. Doesn't quite add up. The file gets written during startup, not 
shutdown. And the time window should be very short, since the file is 
tiny. And we call 'sync' after the writing.

Matthias.

From Michael.Laing at nytimes.com  Wed May 29 22:09:04 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Wed, 29 May 2013 17:09:04 -0400
Subject: [rabbitmq-discuss] 3.1.1 - vhost/policy fails in load of defs
Message-ID: <CDCBE6B0.9CDE%Michael.Laing@nytimes.com>

Creating a vhost AND a policy for that vhost in a definitions file and loading that file fails with missing vhost.

Perhaps this is a side effect of 'fixing' vhost validation in 3.1.1?

We ran into this during node initialization when we load defs.

ml
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130529/f15ded61/attachment.htm>

From chris at koding.com  Wed May 29 22:27:12 2013
From: chris at koding.com (chriskoding)
Date: Wed, 29 May 2013 14:27:12 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ is crashing for seemingly no reason
Message-ID: <1369862832282-27060.post@n5.nabble.com>

Hello ?

I am experimenting with an E2E topology not different than the one described
in example 2 of this blog post:
http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

I went ahead and created 1M exchanges, several million E2E bindings and
bound 100K queues, and subscribed 100K consumers?1 per queue.  This on an
EC2 instance with 17GB of RAM.  My topology is consuming about 5.6GB of RAM. 
I published several hundred thousand messages to 100K various exchanges in
the topology, as a test. This worked fine, let's say.

But for whatever reason, I can't keep this Rabbit from crashing.  It seems
to crash when "idle", mind you, this enormous topology in memory.  Once it
happened after only about 5min.  Another time it idled fine for a few hours,
before finally crashing.

The log seemed mostly benign.  The salient part: http://d.pr/n/2Ifn

Any idea why this might happen?  Tips appreciated.

Best,
Chris





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-is-crashing-for-seemingly-no-reason-tp27060.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed May 29 22:36:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 22:36:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ is crashing for seemingly no reason
In-Reply-To: <1369862832282-27060.post@n5.nabble.com>
References: <1369862832282-27060.post@n5.nabble.com>
Message-ID: <51A674EA.9080403@rabbitmq.com>

On 29/05/13 22:27, chriskoding wrote:
> But for whatever reason, I can't keep this Rabbit from crashing.  It seems
> to crash when "idle", mind you, this enormous topology in memory.  Once it
> happened after only about 5min.  Another time it idled fine for a few hours,
> before finally crashing.
>
> The log seemed mostly benign.  The salient part: http://d.pr/n/2Ifn

There is no evidence of any crashes in that. There is however a 
controlled shutdown:

=INFO REPORT==== 29-May-2013::10:44:03 ===
Stopping RabbitMQ

Rabbit doesn't just suddenly decide that it's had enough; 
something/somebody must have told it to stop.

Matthias.

From n16483 at cray.com  Wed May 29 23:00:30 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Wed, 29 May 2013 17:00:30 -0500
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <51A61670.8050104@cray.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com> <519FE1BB.9030005@cray.com>
	<51A12581.40908@rabbitmq.com> <51A61670.8050104@cray.com>
Message-ID: <51A67A7E.1050606@cray.com>

What am I doing wrong?? I have set auth_mechanism=external in my 
federation URI, but according to the RabbitMQ log, it's trying to 
authenticate as guest.

ecozzi-01:~ # rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-username  "guest"
federation      local-nodename  "rabbit at ecozzi-01.site"
federation-upstream     ecozzi-02       
{"prefetch-count":1000,"uri":"amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&certfile=/opt/cray/ssl/client-01/cert.pem&keyfile=/opt/cray/ssl/client-01/key.pem&verify=verify_peer&fail_if_no_peer_cert=true&auth_mechanism=external","trust-user-id":true,"max-hops":1}

ecozzi-02:/etc/rabbitmq # rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-username  "guest"
federation      local-nodename  "smw_cluster"
federation-upstream     ecozzi-01       
{"prefetch-count":1000,"uri":"amqps://ecozzi-01?cacertfile=/opt/cray/ssl/testca/cacert.pem&certfile=/opt/cray/ssl/client-02/cert.pem&keyfile=/opt/cray/ssl/client-02/key.pem&verify=verify_peer&fail_if_no_peer_cert=true&auth_mechanism=external","trust-user-id":true,"max-hops":1}

*Log File:*
ecozzi-01:~ # rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-username  "guest"
federation      local-nodename  "rabbit at ecozzi-01.site"
federation-upstream     ecozzi-02       
{"prefetch-count":1000,"uri":"amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&certfile=/opt/cray/ssl/client-01/cert.pem&keyfile=/opt/cray/ssl/client-01/key.pem&verify=verify_peer&fail_if_no_peer_cert=true&auth_mechanism=external","trust-user-id":true,"max-hops":1}

ecozzi-02:/etc/rabbitmq # rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-username  "guest"
federation      local-nodename  "smw_cluster"
federation-upstream     ecozzi-01       
{"prefetch-count":1000,"uri":"amqps://ecozzi-01?cacertfile=/opt/cray/ssl/testca/cacert.pem&certfile=/opt/cray/ssl/client-02/cert.pem&keyfile=/opt/cray/ssl/client-02/key.pem&verify=verify_peer&fail_if_no_peer_cert=true&auth_mechanism=external","trust-user-id":true,"max-hops":1}



On 05/29/2013 09:53 AM, Eric Cozzi wrote:
> Matthias,
>
> Sorry for the delay in responding.
>
> I have the LDAP auth plugin logging at Network level. There are no 
> additional log statements that are being output. I've also confirmed 
> that the user exists in my LDAP. So, I'm not sure why it couldn't find 
> the user, unless it's not looking for the correct username. It should 
> be using the CN from the SSL certificate as the username, which in 
> this case should be either ecozzi-02 or ecozzi-03.
>
> Erlang version is:
> ecozzi-01:/home/ecozzi # cat /usr/lib64/erlang/releases/RELEASES
> [{release,"OTP  APN 181 01","R15B02","5.9.2",
>           [{kernel,"2.15.2","/usr/lib64/erlang/lib/kernel-2.15.2"},
>            {stdlib,"1.18.2","/usr/lib64/erlang/lib/stdlib-1.18.2"},
>            {sasl,"2.2.1","/usr/lib64/erlang/lib/sasl-2.2.1"}],
>           permanent}].
>
> Rabbit Version:
> ecozzi-01:/home/ecozzi # rabbitmqctl status
> Status of node 'rabbit at ecozzi-01' ...
> [{pid,3800},
>  {running_applications,
>      [{rabbitmq_federation_management,"RabbitMQ Federation Management",
>           "3.0.1"},
>       {rabbitmq_management,"RabbitMQ Management Console","3.0.1"},
>       {rabbitmq_federation,"RabbitMQ Federation","3.0.1"},
>       {rabbitmq_auth_backend_ldap,"RabbitMQ LDAP Authentication Backend",
>           "3.0.1"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.1"},
>       {rabbit,"RabbitMQ","3.0.1"},
>       {ssl,"Erlang/OTP SSL application","5.1"},
>       {public_key,"Public key infrastructure","0.16"},
>       {crypto,"CRYPTO version 2","2.2"},
>       {os_mon,"CPO  CXC 138 46","2.2.10"},
>       {rabbitmq_auth_mechanism_ssl,
>           "RabbitMQ SSL authentication (SASL EXTERNAL)","3.0.1"},
>       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.1"},
>       {webmachine,"webmachine","1.9.1-rmq3.0.1-git52e62bc"},
>       {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.1-gitd541e9a"},
>       {xmerl,"XML parser","1.3.2"},
>       {inets,"INETS  CXC 138 49","5.9.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>       {eldap,"Ldap api","1.0"},
>       {amqp_client,"RabbitMQ AMQP Client","3.0.1"},
>       {sasl,"SASL  CXC 138 11","2.2.1"},
>       {stdlib,"ERTS  CXC 138 10","1.18.2"},
>       {kernel,"ERTS  CXC 138 10","2.15.2"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R15B02 (erts-5.9.2) [source] [64-bit] [smp:2:2] 
> [async-threads:30] [hipe] [kernel-poll:true]\n"},
>  {memory,
>      [{total,37603792},
>       {connection_procs,162600},
>       {queue_procs,235552},
>       {plugins,377592},
>       {other_proc,10276868},
>       {mnesia,94464},
>       {mgmt_db,84936},
>       {msg_index,32576},
>       {other_ets,1236360},
>       {binary,306624},
>       {code,20204649},
>       {atom,760729},
>       {other_system,3830842}]},
>  {vm_memory_high_watermark,0.4},
>  {vm_memory_limit,205919027},
>  {disk_free_limit,1000000000},
>  {disk_free,0},
>  {file_descriptors,
>      
> [{total_limit,924},{total_used,16},{sockets_limit,829},{sockets_used,4}]},
>  {processes,[{limit,1048576},{used,249}]},
>  {run_queue,0},
>  {uptime,406985}]
> ...done.
>
> On 05/25/2013 03:56 PM, Matthias Radestock wrote:
>> Eric,
>>
>> On 24/05/13 22:55, Eric Cozzi wrote:
>>>                   {{badarg,{error,noSuchObject}},
>>> [{rabbit_access_control,'-check_vhost_access/2-fun-0-',3,[]},
>>>                     {rabbit_access_control,check_access,5,[]},
>>
>> That indicates that your LDAP auth backend returned a 'noSuchObject' 
>> error when performing the vhost access check for the user.
>>
>> I suggest you enable logging in the LDAP auth plug-in to track down 
>> the cause.
>>
>> However, the error really should be handled more gracefully by 
>> rabbit, and I am at a loss why it's producing such a stack trace. 
>> What versions of RabbitMQ and Erlang are you running and how did you 
>> install rabbit (e.g. from a package, compiled from source, etc)?
>>
>> Matthias.
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130529/1c3c3702/attachment.htm>

From matthias at rabbitmq.com  Wed May 29 23:23:03 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 23:23:03 +0100
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <51A61670.8050104@cray.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com> <519FE1BB.9030005@cray.com>
	<51A12581.40908@rabbitmq.com> <51A61670.8050104@cray.com>
Message-ID: <51A67FC7.4030504@rabbitmq.com>

Eric,

On 29/05/13 15:53, Eric Cozzi wrote:
> I have the LDAP auth plugin logging at Network level. There are no
> additional log statements that are being output.

What do you mean? That you don't see any LDAP log output at all? Or just 
no LDAP network log output? Either would suggest that something isn't 
right with your rabbitmq_auth_backend_ldap configuration.

> Erlang version is: [R15B02]
> Rabbit Version: [3.0.1]

Thanks. We did discover why the error is reported in such a weird way, 
so will fix that in the next release. The question is though why you get 
that error in the first place. The logs should allow you to track that down.

Matthias.

From matthias at rabbitmq.com  Wed May 29 23:52:48 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 May 2013 23:52:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <51A67A7E.1050606@cray.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com> <519FE1BB.9030005@cray.com>
	<51A12581.40908@rabbitmq.com> <51A61670.8050104@cray.com>
	<51A67A7E.1050606@cray.com>
Message-ID: <51A686C0.5030102@rabbitmq.com>

On 29/05/13 23:00, Eric Cozzi wrote:
> What am I doing wrong?? I have set auth_mechanism=external in my
> federation URI, but according to the RabbitMQ log, it's trying to
> authenticate as guest.

You didn't actually post the logs.

Are you sure the entries you see in the logs aren't from authorisation 
requests of the local connections used by the federation plug-in to 
publish messages? According to the federation local-username parameters 
you posted these connections will be associated with the 'guest' user.

Matthias.

From yaniv at gigya-inc.com  Wed May 29 21:35:11 2013
From: yaniv at gigya-inc.com (yaniv3007)
Date: Wed, 29 May 2013 13:35:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Unacked messages when process goes down
Message-ID: <1369859711001-27058.post@n5.nabble.com>

Hi,
I am seeing some strange behaviour on my integration with the Java client.
I am working with no ack mode (not manual neither auto mode). I am sending
1000 messages from the producer. I see in the management panel that 1000
messages are in state unack. Then when the process goes down, I see them all
as acked.
Any explanation for that?
One more strange behaviour: I am sending 1000 messages and ack them all.
When I restart the process I see them again as not acked.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Unacked-messages-when-process-goes-down-tp27058.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Thu May 30 00:22:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 00:22:34 +0100
Subject: [rabbitmq-discuss] Unacked messages when process goes down
In-Reply-To: <1369859711001-27058.post@n5.nabble.com>
References: <1369859711001-27058.post@n5.nabble.com>
Message-ID: <51A68DBA.9050600@rabbitmq.com>

On 29/05/13 21:35, yaniv3007 wrote:
> I am seeing some strange behaviour on my integration with the Java client.
> I am working with no ack mode (not manual neither auto mode). I am sending
> 1000 messages from the producer. I see in the management panel that 1000
> messages are in state unack. Then when the process goes down, I see them all
> as acked.
> Any explanation for that?
> One more strange behaviour: I am sending 1000 messages and ack them all.
> When I restart the process I see them again as not acked.

Please post some screen shots for each of the above phases, i.e. after 
sending 1000 messages, after stopping the consuming process, after 
restarting the consuming process.

Also, please verify with 'rabbitmqctl list_consumers' that the consumers 
really are consuming in the mode you expect.

Matthias.

From matthias at rabbitmq.com  Thu May 30 08:23:05 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 08:23:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ is crashing for seemingly no reason
In-Reply-To: <CAL8N6NdLkzbKjU0YY7d5LM5=j=vO5p=uLqF=Z2d=sdnU09gvhw@mail.gmail.com>
References: <1369862832282-27060.post@n5.nabble.com>
	<51A674EA.9080403@rabbitmq.com>
	<CAL8N6NdLkzbKjU0YY7d5LM5=j=vO5p=uLqF=Z2d=sdnU09gvhw@mail.gmail.com>
Message-ID: <51A6FE59.20901@rabbitmq.com>

Chris,

(please keep the list on cc)

On 30/05/13 01:45, Christopher Thorn wrote:
> Thanks for your reply.  You're right, the syslog shows that an interrupt
> signal is being sent.  I'm guessing that this because the CPU is too
> small.  I'll upgrade my box, and try again.

An interrupt signal sent to the Erlang process wouldn't cause a graceful 
shutdown. Something must be invoking 'rabbitmqctl stop', possibly the OS 
via the rabbitmq init scripts.

Matthias.

From emile at rabbitmq.com  Thu May 30 10:31:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 30 May 2013 10:31:30 +0100
Subject: [rabbitmq-discuss] problem about flow control and HA cluster
In-Reply-To: <CAL-OO0mgtEiqFtL_UNzLDyJto3hAKpr=pDaBDVKFoAiSJw6q0A@mail.gmail.com>
References: <CAL-OO0mgtEiqFtL_UNzLDyJto3hAKpr=pDaBDVKFoAiSJw6q0A@mail.gmail.com>
Message-ID: <51A71C72.8000506@rabbitmq.com>



Hi,

On 27/05/13 16:12, bupt bupt wrote:
> 1. Can you give me an example(internet address is ok) about how to
> finish flow control if the length of queue is too big or if the used
> memory and disc near the threshold. Can you give me some client
> code(python or Java) to help me use it.

If I understand correctly you have a broker with disk free space close
to the disk free limit or memory use close to the high watermark, and
you want to disable resource flow control.

You should be aware that disabling resource flow control will make the
broker more likely to run out of resources and crash. A better solution
is to provision the broker with more resources. You should only relax
the resource limits if your application can tolerate the increased risk
of a crashing broker.

You can relax memory flow control by increasing the memory high
watermark from 40% to 50% or higher, e.g.

 rabbitmqctl set_vm_memory_high_watermark 0.5

Setting it to an infeasibly large ration effectively disables memory
flow control:

 rabbitmqctl set_vm_memory_high_watermark 100.0

These instructions will change the limits for a running broker. See the
instructions here for how to make the changes permanent by changing the
configuration file: http://www.rabbitmq.com/memory.html#memsup


You can reduce the disk free limit by specifying a lower limit:

 rabbitmqctl eval 'rabbit_disk_monitor:set_disk_free_limit(500000000).'

or disable it by setting the limit to zero:

 rabbitmqctl eval 'rabbit_disk_monitor:set_disk_free_limit(0).'

See http://www.rabbitmq.com/memory.html#diskfreesup for persisting the
change in the configuration file.


> 2. I have read document about how to set up rabbitmq cluster
> by"http://www.rabbitmq.com/clustering.html" But who is master and who is
> cluster, It  doesn't tell us. which broker manage all the nodes in
> cluster? I didn't see any mirror queue in this address, Can this cluster
> still be HA cluster?

There is no global master. Queues can have different policies, so there
is a master node per queue (assuming the queue is mirrored). See the
"rabbitmqctl list_queues" documentation for querying the master and
slave nodes for queues:

http://www.rabbitmq.com/man/rabbitmqctl.1.man.html

> 3. Is every message has length and size limit? what is the maximum size
> of every message?


Messages can be as large as you like, but they should not consume a
significant fraction of total available RAM. If you want to process
extremely large messages then you need alot of RAM.

Queue length can be limited with the x-max-length argument. See
http://www.rabbitmq.com/maxlength.html.




-Emile





From simon at rabbitmq.com  Thu May 30 10:48:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 30 May 2013 10:48:43 +0100
Subject: [rabbitmq-discuss] 3.1.1 - vhost/policy fails in load of defs
In-Reply-To: <CDCBE6B0.9CDE%Michael.Laing@nytimes.com>
References: <CDCBE6B0.9CDE%Michael.Laing@nytimes.com>
Message-ID: <51A7207B.30102@rabbitmq.com>

Gosh, how embarrassing. Can't believe our tests didn't spot that. Thanks 
for the bug report.

Cheers, Simon

On 29/05/13 22:09, Laing, Michael P. wrote:
> Creating a vhost AND a policy for that vhost in a definitions file and
> loading that file fails with missing vhost.
>
> Perhaps this is a side effect of 'fixing' vhost validation in 3.1.1?
>
> We ran into this during node initialization when we load defs.
>
> ml
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From mlinnen at protosystem.net  Thu May 30 11:51:30 2013
From: mlinnen at protosystem.net (mlinnen at protosystem.net)
Date: Thu, 30 May 2013 10:51:30 +0000
Subject: [rabbitmq-discuss] =?utf-8?q?MQTT_Adapter_question?=
Message-ID: <20130530040133.462756105A@mc.internetmailserver.net>

I have some embedded devices that I want to place on a RabbitMQ messaging infrastructure.  These embedded devices can publish and subscribe to MQTT topics.  I have the RabbitMQ MQTT adapter plugin enabled and it appears to be hosting the MQTT broker and I can publish to the broker endpoint.


My question is how do the AMQP messages get broken down into MQTT topics?  if I publish a message on the RabbitMQ side what topic do I subscribe to on the MQTT side for the embedded devices?



Thanks

Sent from Windows Mail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/ee5f08a8/attachment.htm>

From emile at rabbitmq.com  Thu May 30 12:13:03 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 30 May 2013 12:13:03 +0100
Subject: [rabbitmq-discuss] RabbitMQ shovel - standalone app?
In-Reply-To: <BE7C9B62-1985-4362-BEBD-84651F26B570@googlemail.com>
References: <BE7C9B62-1985-4362-BEBD-84651F26B570@googlemail.com>
Message-ID: <51A7343F.6070409@rabbitmq.com>


On 29/05/13 12:52, Dominic Wong wrote:
> I was wondering if there is a standalone version of the rabbit shovel
> plugin i.e. one that I can run without having to spin up a rabbit
> broker.

No, the shovel is only distributed as a broker plugin.

> My use case is that I'd like to spin up shovels in a fairly dynamic
> manner without having to restart the broker every time I want to
> change my shovel definitions. For instance, I want a loosely couple
> "cloud" of rabbit brokers and want to shovel messages between them.
> When one broker comes up I'd like to start shovels that push messages
> to this broker and pull messages out of it. I don't think I can
> really use federation since I'd like finer grained control over what
> gets pushed to where.


One solution would be to furnish newly started brokers with the
necessary shovel configuration that affect them.

If you want to run shovels without a broker then it should be possible
to package the shovel as a standalone Erlang release, which depends on
the Erlang client. You will still need to a restart when changing the
configuration, so this will not be much of an improvement.



-Emile


From emile at rabbitmq.com  Thu May 30 12:28:01 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 30 May 2013 12:28:01 +0100
Subject: [rabbitmq-discuss] MQTT Adapter question
In-Reply-To: <20130530040133.462756105A@mc.internetmailserver.net>
References: <20130530040133.462756105A@mc.internetmailserver.net>
Message-ID: <51A737C1.7050008@rabbitmq.com>


Hi,

On 30/05/13 11:51, mlinnen at protosystem.net wrote:
> My question is how do the AMQP messages get broken down into MQTT
> topics?  if I publish a message on the RabbitMQ side what topic do I
> subscribe to on the MQTT side for the embedded devices?

The RabbitMQ MQTT adapter make use of a configured topic exchange, which
is "amq.topic" by default. If AMQP publishers select this exchange then
MQTT subscribers with matching subscriptions will be able to receive
their messages. The message routing key must match the subscription
pattern with respect to the syntax rules of each protocol. The
translation table is here:
http://hg.rabbitmq.com/rabbitmq-mqtt/file/351b73d637e6/src/rabbit_mqtt_util.erl#l27

See com.rabbitmq.mqtt.test.MqttTest.testInteropA2M() for an example of
interop between AMQP and MQTT.

Also see this post by Brett Cameron for more interop examples:
http://assortedrambles.blogspot.co.nz/2012/11/the-polygot-rabbit.html




-Emile






From tim at rabbitmq.com  Thu May 30 12:46:17 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 30 May 2013 12:46:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ shovel - standalone app?
In-Reply-To: <51A7343F.6070409@rabbitmq.com>
References: <BE7C9B62-1985-4362-BEBD-84651F26B570@googlemail.com>
	<51A7343F.6070409@rabbitmq.com>
Message-ID: <CCEA1916-34E8-4669-9FC9-1AF169049F46@rabbitmq.com>

On 30 May 2013, at 12:13, Emile Joubert wrote:
> 
> If you want to run shovels without a broker then it should be possible
> to package the shovel as a standalone Erlang release, which depends on
> the Erlang client. You will still need to a restart when changing the
> configuration, so this will not be much of an improvement.

Just for the record, for a future releaes, we have been considering making shovel configuration dynamic (i.e., based on runtime parameters) in a fashion somewhat similar to federation. Work on this feature has not been started yet though.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/179f2ee7/attachment.htm>

From tim at rabbitmq.com  Thu May 30 13:18:45 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 30 May 2013 13:18:45 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <20130529114110.GA1107@kaka.it.su.se>
References: <20121019100118.GB1210@kaka.it.su.se>
	<508149DB.7010701@rabbitmq.com>
	<20121029160441.GI426@kaka.it.su.se>
	<508FB1AF.8060003@rabbitmq.com>
	<20121030110101.GK426@kaka.it.su.se>
	<508FB59F.9030807@rabbitmq.com>
	<20121030121229.GM426@kaka.it.su.se>
	<5097C8CF.6050901@rabbitmq.com>
	<20130524144308.GQ292@kaka.it.su.se>
	<20130529114110.GA1107@kaka.it.su.se>
Message-ID: <1BA2C713-CA3E-43BC-8A0A-99D819CD6BCB@rabbitmq.com>

Hi Simon!

I'm going to QA your changes this week, but I won't be able to send you the agreement (and then merge them) until I get hold of the latest copy. Bear with me - I'll try and make sure this happens before the next release! :D

Cheers,
Tim 

On 29 May 2013, at 12:41, Simon Lundstr?m wrote:

> Hi Tim!
> 
> No, I haven't signed any contributor agreement, please advice.
> 
> (As per GitHub pull request)
> 
> Br,
> - Simon
> 
> On Fri, 2013-05-24 at 16:43:09 +0200, Simon Lundstr?m wrote:
>> On Mon, 2012-11-05 at 14:10:23 +0000, Simon MacMullen wrote:
>>> On 30/10/12 12:12, Simon Lundstr?m wrote:
>>>> So basically:
>>>> 
>>>> Parse the config/defaults in this order:
>>>> # defaults from default_options hash^Wdictionary
>>>> # config file
>>>> ## Find out which config file to use, one of:
>>>> ### specified via --config
>>>> #### Use it and exit with an error if it doesn't exist
>>>> ### default config file (~/.rabbitmqadmin.conf)
>>>> #### If file doesn't exist, just ignore it.
>>>> ## If node doesn't exist in config and is:
>>>> ### specified via commandline
>>>> #### Display error and exit
>>>> ### using the default node
>>>> #### ignore the config file entirely
>>>> # Options on the command line
>>> 
>>> Yes, I think that makes sense.
>> 
>> Sorry for taking so long, been busy on other things = )
>> 
>> I've patched this and created a PR on Github (see
>> <https://github.com/rabbitmq/rabbitmq-management/pull/6>)
>> 
>> Please tell me if you prefer patches some other way.
>> 
>> Have a great weekend!


From Michael.Laing at nytimes.com  Thu May 30 13:34:13 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 30 May 2013 08:34:13 -0400
Subject: [rabbitmq-discuss] Messages as mutex tokens - rewrite or nack
Message-ID: <CDCCBF85.9D29%Michael.Laing@nytimes.com>

Our clusters support apps that do work periodically, e.g. Every few seconds or minutes, typically analyzing/reporting the state of other apps.

We run an identical instance of each app connected to each node of the cluster. The apps each subscribe to a 'token' mirrored queue which is seeded with a single message.

One app gets the message, does its work, waits for the appropriate interval, and then republishes the token message to the queue. The next app gets the message - they proceed in a round robin fashion.

Today I am reviewing and refactoring this logic, and I wonder if it would be better to keep a single token message and just nack it instead of rewriting. Nacking is a little simpler.

However, I see in the documentation for BasicReject that the broker may not want to deliver the same message within the same channel context; does this hold for BasicNack as well?

In a cluster with one node, the above pattern using rewrite works fine. Would it still work using nack or would the app have to close the channel and resubscribe using a new one (probably too expensive/messy)?

Cheers,
Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/7b5a8368/attachment.htm>

From AMorgan at salesforce.com  Thu May 30 13:38:52 2013
From: AMorgan at salesforce.com (Adam Morgan)
Date: Thu, 30 May 2013 05:38:52 -0700
Subject: [rabbitmq-discuss] AutoAck issue
Message-ID: <CDCCCEAC.28EA%amorgan@salesforce.com>

I am trying to implement guaranteed delivery in my system but am having issues around acknowledgements being sent automagically.


 *   I have turned on channel.confirmSelect() on publishing channel.
 *   I have added my publisher as a ConfirmListener to the publishing channel.
 *   I very clearly have autoAck=false in my basicConsume() call.

Despite this, my publisher/ConfirmListener is receiving an ack as soon as my consumer receives the message.  Repeat, my consumer client has NOT yet called basicAck(), but my publisher/ConfirmListener callback is made.

Is there something else I should be doing?  Is there other configuration I might be doing that would interfere with this?

Thanks
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/e6309502/attachment.htm>

From matthias at rabbitmq.com  Thu May 30 13:52:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 13:52:16 +0100
Subject: [rabbitmq-discuss] User permission
In-Reply-To: <1369822417379-27043.post@n5.nabble.com>
References: <1369402426514-26987.post@n5.nabble.com>
	<51A4861B.8010006@rabbitmq.com>
	<1369815732957-27037.post@n5.nabble.com>
	<51A5CD23.9090406@rabbitmq.com>
	<1369821412556-27041.post@n5.nabble.com>
	<51A5D383.1090809@rabbitmq.com>
	<1369822417379-27043.post@n5.nabble.com>
Message-ID: <51A74B80.2070804@rabbitmq.com>

On 29/05/13 11:13, Slyth wrote:
> I think there has to be a better solution or not?
>
> Is it the best solution that I need for every user a new vhost or is it
> better to use one vhost and use regex to manage the access?
>
> Would you use the same solution?

The answer, as is so often the case, is "it depends".

The main downside to a set up with lots of vhosts is that a) messages 
cannot get routed to multiple vhost, and b) any client that needs access 
to multiple vhosts requires a separate connection to each.

 From the little you have told us about the requirements, (a) is not 
really an issue, since it appears that your applications will only ever 
send messages to their "own" queue and the single 'special' queue..

But (b) might bite you. In particular, you stated that "I should have 
full access (c+w+r) [to all queues]", which implies that there is some 
privileged users that needs to be able to work across all the user 
queues. With the vhost-per-user design that would require that user to 
establish one connection per user, which is tedious and resource consuming.


Matthias.

From tim at rabbitmq.com  Thu May 30 13:57:05 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 30 May 2013 13:57:05 +0100
Subject: [rabbitmq-discuss] AutoAck issue
In-Reply-To: <CDCCCEAC.28EA%amorgan@salesforce.com>
References: <CDCCCEAC.28EA%amorgan@salesforce.com>
Message-ID: <1FAF8BC5-35DB-4241-B631-54B0A643D6F6@rabbitmq.com>

Hi Adam,

On 30 May 2013, at 13:38, Adam Morgan wrote:

> I am trying to implement guaranteed delivery in my system but am having issues around acknowledgements being sent automagically.
> 
> I have turned on channel.confirmSelect() on publishing channel.
> I have added my publisher as a ConfirmListener to the publishing channel.
> I very clearly have autoAck=false in my basicConsume() call.
> 
> Despite this, my publisher/ConfirmListener is receiving an ack as soon as my consumer receives the message.  Repeat, my consumer client has NOT yet called basicAck(), but my publisher/ConfirmListener callback is made.  
> 
> Is there something else I should be doing?  Is there other configuration I might be doing that would interfere with this?   

I think you're getting confused between confirms and ACKs. Confirms sent from the broker to a producer are orthogonal to ACKs sent from a consumer to the broker. When the broker has accepted responsibility for a message, it will send a confirm _in the form of an ACK_ to the publisher. Now "accepted responsibility" means various things depending on you configuration - see https://www.rabbitmq.com/reliability.html for details - but in general, if the broker is able to immediately deliver a message to an active consumer, then it has certainly discharged it's responsibility "to the producer" for handling that message, therefore it sends a confirm (i.e., an ACK) to the producer. This is completely independent of what the consumer does with the message - it might NACK/REJECT it but that's "the broker's problem to handle" and not the producer's. Once the broker sends a confirm, *it* is responsible for the message.

What you appear to be looking for is a kind of RPC (in terms of synchronicity) between producer and consumer, and /that/ is not what messaging systems typically deliver, opting instead for a de-coupled view of the interaction via an intermediary (i.e., the broker). Notably, even JMS transactions do *not* coordinate over both the producer and consumer, but handle only one perspective or the other.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/bc8b4996/attachment.htm>

From simon at rabbitmq.com  Thu May 30 13:59:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 30 May 2013 13:59:23 +0100
Subject: [rabbitmq-discuss] AutoAck issue
In-Reply-To: <CDCCCEAC.28EA%amorgan@salesforce.com>
References: <CDCCCEAC.28EA%amorgan@salesforce.com>
Message-ID: <51A74D2B.7080300@rabbitmq.com>

On 30/05/13 13:38, Adam Morgan wrote:
> Despite this, my publisher/ConfirmListener is receiving an ack as soon
> as my consumer receives the message.  Repeat, my consumer client has NOT
> yet called basicAck(), but my publisher/ConfirmListener callback is made.

Your publisher will receive an ack as soon as your RabbitMQ broker has 
taken responsibility for the message; not as soon as a consumer has.

Otherwise you would not be decoupling very well :-)

See http://www.rabbitmq.com/reliability.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Thu May 30 13:59:49 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 30 May 2013 13:59:49 +0100
Subject: [rabbitmq-discuss] AutoAck issue
In-Reply-To: <CDCCCEAC.28EA%amorgan@salesforce.com>
References: <CDCCCEAC.28EA%amorgan@salesforce.com>
Message-ID: <51A74D45.7020304@rabbitmq.com>

On 30/05/13 13:38, Adam Morgan wrote:

> Despite this, my publisher/ConfirmListener is receiving an ack as soon
> as my consumer receives the message.  Repeat, my consumer client has NOT
> yet called basicAck(), but my publisher/ConfirmListener callback is made.  

Acknowledgements are being sent by the broker to confirm to the
publisher that messages received up to that point have been received and
won't be lost, as an alternative to using transactions. The conditions
that determine when the broker sends confirms are described here:

http://www.rabbitmq.com/confirms.html

In the case of persistent messages, being on disk is sufficient to
trigger a confirm. A broker confirmation is not necessarily confirmation
that a consumer acknowledged the message.

Consumers may send acknowledgements to the broker after  processing a
message. The acks sent by consumers have a different meaning from the
acks sent from the broker to publishers.



-Emile







From simon at rabbitmq.com  Thu May 30 14:06:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 30 May 2013 14:06:12 +0100
Subject: [rabbitmq-discuss] Messages as mutex tokens - rewrite or nack
In-Reply-To: <CDCCBF85.9D29%Michael.Laing@nytimes.com>
References: <CDCCBF85.9D29%Michael.Laing@nytimes.com>
Message-ID: <51A74EC4.3040700@rabbitmq.com>

basic.reject and basic.nack are really only different on the wire.

As you have seen, the AMQP standard states that a server MUST avoid 
redelivering the message to the came channel. In practice we don't do 
that, the message is just reinserted into the queue.

We don't guarantee that we won't change a future version of RabbitMQ to 
be closer to the spec in this regard, but it's certainly not high up our 
list of priorities now. But just in case, you might want to stick to 
your current approach.

Cheers, Simon

On 30/05/13 13:34, Laing, Michael P. wrote:
> Our clusters support apps that do work periodically, e.g. Every few
> seconds or minutes, typically analyzing/reporting the state of other apps.
>
> We run an identical instance of each app connected to each node of the
> cluster. The apps each subscribe to a 'token' mirrored queue which is
> seeded with a single message.
>
> One app gets the message, does its work, waits for the appropriate
> interval, and then republishes the token message to the queue. The next
> app gets the message - they proceed in a round robin fashion.
>
> Today I am reviewing and refactoring this logic, and I wonder if it
> would be better to keep a single token message and just nack it instead
> of rewriting. Nacking is a little simpler.
>
> However, I see in the documentation for BasicReject that the broker may
> not want to deliver the same message within the same channel context;
> does this hold for BasicNack as well?
>
> In a cluster with one node, the above pattern using rewrite works fine.
> Would it still work using nack or would the app have to close the
> channel and resubscribe using a new one (probably too expensive/messy)?
>
> Cheers,
> Michael
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From AMorgan at salesforce.com  Thu May 30 14:12:08 2013
From: AMorgan at salesforce.com (Adam Morgan)
Date: Thu, 30 May 2013 06:12:08 -0700
Subject: [rabbitmq-discuss] AutoAck issue
In-Reply-To: <1FAF8BC5-35DB-4241-B631-54B0A643D6F6@rabbitmq.com>
Message-ID: <CDCCD678.28F8%amorgan@salesforce.com>

Ok thanks for the clarification Tim, Simon, and Emile...  Yes, I was definitely mixing acks and confirms.  So in effect, everything is working properly! Ha! :)

So the consumer acks are to tell the broker that the message has been dealt with, and doesn't need to be consumed again.  Of course!


On 5/30/13 9:57 AM, "Tim Watson" <tim at rabbitmq.com> wrote:

Hi Adam,

On 30 May 2013, at 13:38, Adam Morgan wrote:

AutoAck issue
I am trying to implement guaranteed delivery in my system but am having issues around acknowledgements being sent automagically.


 *   I have turned on channel.confirmSelect() on publishing channel.
 *   I have added my publisher as a ConfirmListener to the publishing channel.
 *   I very clearly have autoAck=false in my basicConsume() call.

Despite this, my publisher/ConfirmListener is receiving an ack as soon as my consumer receives the message.  Repeat, my consumer client has NOT yet called basicAck(), but my publisher/ConfirmListener callback is made.

Is there something else I should be doing?  Is there other configuration I might be doing that would interfere with this?

I think you're getting confused between confirms and ACKs. Confirms sent from the broker to a producer are orthogonal to ACKs sent from a consumer to the broker. When the broker has accepted responsibility for a message, it will send a confirm _in the form of an ACK_ to the publisher. Now "accepted responsibility" means various things depending on you configuration - see https://www.rabbitmq.com/reliability.html for details - but in general, if the broker is able to immediately deliver a message to an active consumer, then it has certainly discharged it's responsibility "to the producer" for handling that message, therefore it sends a confirm (i.e., an ACK) to the producer. This is completely independent of what the consumer does with the message - it might NACK/REJECT it but that's "the broker's problem to handle" and not the producer's. Once the broker sends a confirm, *it* is responsible for the message.

What you appear to be looking for is a kind of RPC (in terms of synchronicity) between producer and consumer, and /that/ is not what messaging systems typically deliver, opting instead for a de-coupled view of the interaction via an intermediary (i.e., the broker). Notably, even JMS transactions do *not* coordinate over both the producer and consumer, but handle only one perspective or the other.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/e923af7a/attachment.htm>

From rohit.yadav at wingify.com  Thu May 30 14:45:42 2013
From: rohit.yadav at wingify.com (Rohit Yadav)
Date: Thu, 30 May 2013 19:15:42 +0530
Subject: [rabbitmq-discuss] New lua-resty-rabbitmq library
Message-ID: <CAMF++H9BZAw6ooF2h8LSm0jUzHJjwX6Xd=3NxUfOn2zM9NohpA@mail.gmail.com>

Hi,

I started working on implementing a client library for RabbitMQ based on
STOMP 1.2 protocol, I'm sharing the initial buggy version [1] with the
community for feedback, suggestions and review.

For the initial version I've implemented only authentication and publishing
using receipts. I'll blog about this work with some history and background
soon [2].

To test this library I wrote a load testing tool in golang which would run
concurrent HTTP requests to an Openresty server. A handler runs Lua code
for that request and uses the resty-rabbitmq library to sanitize, serialize
and publish data to RabbitMQ's STOMP adapter.

With a noncurrent load test of total 1M requests, using the library a
producer (in /example/) was able to publish all the messages to the broker
without any errors. But in case of concurrent connections, I frequently got
timeout errors or writing to closed socket errors.

How may I make publishing fault tolerant and avoid deduplicating messages
in concurrent environment by correctly implementing states and reuse
sockets using cosocket api pool? I set keepalive timeout on the cosocket
tcp sock to 0 (no timeout as per wiki) and I saw exponential increase in
socket consumed via the RabbitMQ management web interface, for a load of
100k requests, I saw fluctuations between 200-1200 consumed sockets with a
lot of socket errors.

Ideas, flames? Thanks.

[1] https://github.com/wingify/lua-resty-rabbitmq
[2] http://engineering.wingify.com/

Regards,
Rohit Yadav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/563ed5db/attachment.htm>

From smallfish.xy at gmail.com  Thu May 30 14:58:56 2013
From: smallfish.xy at gmail.com (smallfish)
Date: Thu, 30 May 2013 21:58:56 +0800
Subject: [rabbitmq-discuss] [openresty] New lua-resty-rabbitmq library
In-Reply-To: <CAMF++H9BZAw6ooF2h8LSm0jUzHJjwX6Xd=3NxUfOn2zM9NohpA@mail.gmail.com>
References: <CAMF++H9BZAw6ooF2h8LSm0jUzHJjwX6Xd=3NxUfOn2zM9NohpA@mail.gmail.com>
Message-ID: <CACPpB2yhVemwwt5Bd2wVAf-6XzVvJmqhbcV13F_dfZw5S+_4Bw@mail.gmail.com>

Great! but miss some other protocol (ack/publish etc..)
:-)

--
smallfish http://chenxiaoyu.org


On Thu, May 30, 2013 at 9:45 PM, Rohit Yadav <rohit.yadav at wingify.com>wrote:

> Hi,
>
> I started working on implementing a client library for RabbitMQ based on
> STOMP 1.2 protocol, I'm sharing the initial buggy version [1] with the
> community for feedback, suggestions and review.
>
> For the initial version I've implemented only authentication and
> publishing using receipts. I'll blog about this work with some history and
> background soon [2].
>
> To test this library I wrote a load testing tool in golang which would run
> concurrent HTTP requests to an Openresty server. A handler runs Lua code
> for that request and uses the resty-rabbitmq library to sanitize, serialize
> and publish data to RabbitMQ's STOMP adapter.
>
> With a noncurrent load test of total 1M requests, using the library a
> producer (in /example/) was able to publish all the messages to the broker
> without any errors. But in case of concurrent connections, I frequently got
> timeout errors or writing to closed socket errors.
>
> How may I make publishing fault tolerant and avoid deduplicating messages
> in concurrent environment by correctly implementing states and reuse
> sockets using cosocket api pool? I set keepalive timeout on the cosocket
> tcp sock to 0 (no timeout as per wiki) and I saw exponential increase in
> socket consumed via the RabbitMQ management web interface, for a load of
> 100k requests, I saw fluctuations between 200-1200 consumed sockets with a
> lot of socket errors.
>
> Ideas, flames? Thanks.
>
> [1] https://github.com/wingify/lua-resty-rabbitmq
> [2] http://engineering.wingify.com/
>
> Regards,
> Rohit Yadav
>
> --
> --
> ???????openresty?,???????!
> ??: ??????? openresty+subscribe at googlegroups.com
> ??: ????? openresty at googlegroups.com
> ??: ????? openresty+unsubscribe at googlegroups.com
> ??: http://groups.google.com/group/openresty
> ??: http://openresty.org/
> ??: https://github.com/agentzh/ngx_openresty
> ??: http://openresty.org/download/agentzh-nginx-tutorials-zhcn.html
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/7ac234ed/attachment.htm>

From rohit.yadav at wingify.com  Thu May 30 15:26:37 2013
From: rohit.yadav at wingify.com (Rohit Yadav)
Date: Thu, 30 May 2013 19:56:37 +0530
Subject: [rabbitmq-discuss] [openresty-en] Re: [openresty] New
	lua-resty-rabbitmq library
In-Reply-To: <CACPpB2yhVemwwt5Bd2wVAf-6XzVvJmqhbcV13F_dfZw5S+_4Bw@mail.gmail.com>
References: <CAMF++H9BZAw6ooF2h8LSm0jUzHJjwX6Xd=3NxUfOn2zM9NohpA@mail.gmail.com>
	<CACPpB2yhVemwwt5Bd2wVAf-6XzVvJmqhbcV13F_dfZw5S+_4Bw@mail.gmail.com>
Message-ID: <CAMF++H8g42G7SyeEHESeOg8iRFJdZpgoGC6x+OQjVVkbD4AiJw@mail.gmail.com>

On Thu, May 30, 2013 at 7:28 PM, smallfish <smallfish.xy at gmail.com> wrote:

> Great! but miss some other protocol (ack/publish etc..)
>
:-)
>

STOMP was simplest to write in Lua so I went ahead with it after members
from the community suggested for lua-resty.
In this library we do have publisher confirms by using STOMP RECEIPT which
are acks from the RabbitMQ stomp adapter for a given receipt no. which we
put on a SEND frame.
I see on the management web interface of RabbitMQ that channels are in
confirm mode.

A typical use case for this library is to publish on localhost RMQ broker
from resty/lua handler, in that case latency and network issues won't be
much trouble.

Regards.


> --
> smallfish http://chenxiaoyu.org
>
>
> On Thu, May 30, 2013 at 9:45 PM, Rohit Yadav <rohit.yadav at wingify.com>wrote:
>
>> Hi,
>>
>> I started working on implementing a client library for RabbitMQ based on
>> STOMP 1.2 protocol, I'm sharing the initial buggy version [1] with the
>> community for feedback, suggestions and review.
>>
>> For the initial version I've implemented only authentication and
>> publishing using receipts. I'll blog about this work with some history and
>> background soon [2].
>>
>> To test this library I wrote a load testing tool in golang which would
>> run concurrent HTTP requests to an Openresty server. A handler runs Lua
>> code for that request and uses the resty-rabbitmq library to sanitize,
>> serialize and publish data to RabbitMQ's STOMP adapter.
>>
>> With a noncurrent load test of total 1M requests, using the library a
>> producer (in /example/) was able to publish all the messages to the broker
>> without any errors. But in case of concurrent connections, I frequently got
>> timeout errors or writing to closed socket errors.
>>
>> How may I make publishing fault tolerant and avoid deduplicating messages
>> in concurrent environment by correctly implementing states and reuse
>> sockets using cosocket api pool? I set keepalive timeout on the cosocket
>> tcp sock to 0 (no timeout as per wiki) and I saw exponential increase in
>> socket consumed via the RabbitMQ management web interface, for a load of
>> 100k requests, I saw fluctuations between 200-1200 consumed sockets with a
>> lot of socket errors.
>>
>> Ideas, flames? Thanks.
>>
>> [1] https://github.com/wingify/lua-resty-rabbitmq
>> [2] http://engineering.wingify.com/
>>
>> Regards,
>> Rohit Yadav
>>
>> --
>> --
>> ???????openresty?,???????!
>> ??: ??????? openresty+subscribe at googlegroups.com
>> ??: ????? openresty at googlegroups.com
>> ??: ????? openresty+unsubscribe at googlegroups.com
>> ??: http://groups.google.com/group/openresty
>> ??: http://openresty.org/
>> ??: https://github.com/agentzh/ngx_openresty
>> ??: http://openresty.org/download/agentzh-nginx-tutorials-zhcn.html
>>
>>
>>
>
>  --
> You received this message because you are subscribed to the Google Groups
> "openresty-en" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to openresty-en+unsubscribe at googlegroups.com.
> For more options, visit https://groups.google.com/groups/opt_out.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/45572ed2/attachment.htm>

From a2800276 at gmail.com  Thu May 30 15:32:02 2013
From: a2800276 at gmail.com (a2800276)
Date: Thu, 30 May 2013 07:32:02 -0700 (PDT)
Subject: [rabbitmq-discuss] reconfigure existing queue with dead letter
	exchange.
Message-ID: <8bc2f300-031f-4e52-951d-3059924fbc2c@googlegroups.com>

Sorry, this is probably a totally stupid beginners question...

Is it somehow possible to reconfigure an already existing queue and attach 
an x-dead-letter-exchange parameter, e.g. with `rabbitmqctl`, or does the 
DL-exchange have to be specified during queue creation?

Thanks,
   -tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/84fc7e4f/attachment.htm>

From n16483 at cray.com  Thu May 30 15:35:11 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Thu, 30 May 2013 09:35:11 -0500
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <51A686C0.5030102@rabbitmq.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com> <519FE1BB.9030005@cray.com>
	<51A12581.40908@rabbitmq.com> <51A61670.8050104@cray.com>
	<51A67A7E.1050606@cray.com> <51A686C0.5030102@rabbitmq.com>
Message-ID: <51A7639F.3000002@cray.com>

Matthias,

Thanks. Setting the local-username to a valid username fixed the 
problem. But, I'm still confused.

I have RabbitMQ configured to use the auth_mechanism_ssl plugin. So, why 
do I have to set the local-username at all? I expected that by setting 
the client ssl-keys in the federation URI, federation would pull the 
username out of the SSL key and use that to authenticate. This works for 
normal clients connecting via SSL. Why doesn't this work for federation 
clients?

Eric

On 05/29/2013 05:52 PM, Matthias Radestock wrote:
> On 29/05/13 23:00, Eric Cozzi wrote:
>> What am I doing wrong?? I have set auth_mechanism=external in my
>> federation URI, but according to the RabbitMQ log, it's trying to
>> authenticate as guest.
>
> You didn't actually post the logs.
>
> Are you sure the entries you see in the logs aren't from authorisation 
> requests of the local connections used by the federation plug-in to 
> publish messages? According to the federation local-username 
> parameters you posted these connections will be associated with the 
> 'guest' user.
>
> Matthias.
>

From michael.s.klishin at gmail.com  Thu May 30 16:22:47 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 30 May 2013 19:22:47 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre13
Message-ID: <CAE3HoVQK0zsKFoPSaTa5OFFM53QLETFjQE9ELsaovitVJM8R6A@mail.gmail.com>

Bunny 0.9.0.pre13 is released [1].

This is a development release that fixes one regression and introduces a
few usability
improvements, all around consumers.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/05/30/bunny-0-dot-9-0-dot-pre13-is-released/

1. https://rubygems.org/gems/bunny/versions/0.9.0.pre13
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/2ee57306/attachment.htm>

From matthias at rabbitmq.com  Thu May 30 17:00:28 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 17:00:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <51A7639F.3000002@cray.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com> <519FE1BB.9030005@cray.com>
	<51A12581.40908@rabbitmq.com> <51A61670.8050104@cray.com>
	<51A67A7E.1050606@cray.com> <51A686C0.5030102@rabbitmq.com>
	<51A7639F.3000002@cray.com>
Message-ID: <51A7779C.7010109@rabbitmq.com>

Eric,

On 30/05/13 15:35, Eric Cozzi wrote:
> Thanks. Setting the local-username to a valid username fixed the
> problem. But, I'm still confused.

Take a look at the diagram and explanation at 
http://www.rabbitmq.com/federation.html#details

> I have RabbitMQ configured to use the auth_mechanism_ssl plugin. So, why
> do I have to set the local-username at all? I expected that by setting
> the client ssl-keys in the federation URI, federation would pull the
> username out of the SSL key and use that to authenticate. This works for
> normal clients connecting via SSL. Why doesn't this work for federation
> clients?

The URIs you specify in the federation config tell a downstream 
(right-hand side of the diagram) how to establish an AMQP connection to 
an upstream (left-hand side of the diagram), thus establishing an 
upstream link (as labelled in the diagram) across which messages that 
have been published on the upstream are pulled to the downstream.

The ssl config in the broker configuration of the upstream, and the ssl 
settings in the URIs of the federation config of the downstream, control 
authentication and authorisation for that link.

But there is more....

Any messages pulled down over the upstream link are re-published 
locally, via a local/internal connection - indicated by the fat arrow on 
the right-hand side that loops back onto the exchange. That local 
connection requires a username for authorisation. It is that username 
which you set in the federation config with local-username.

Note that this user only requires authorisation, not authentication 
(hence no password, ssl credentials, etc).


Regards,

Matthias.

From matthias at rabbitmq.com  Thu May 30 17:49:37 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 17:49:37 +0100
Subject: [rabbitmq-discuss] Architecture Question
In-Reply-To: <CAFLufr75tLsT_r5hZS_Dg_rPQdE8KF8A=nndk-9GfcWhwnn-jQ@mail.gmail.com>
References: <CAFLufr75tLsT_r5hZS_Dg_rPQdE8KF8A=nndk-9GfcWhwnn-jQ@mail.gmail.com>
Message-ID: <51A78321.5080103@rabbitmq.com>

On 28/05/13 18:11, Crash Course wrote:
> What I'm seeing as I go from
> 4 producers -> direct exchange -> single queue -> 6 consumers
> then repeating that layout two more times (in parallel) against a
> single broker is:
> 38000 -> 54000 -> 63000 messages per second
> and
> 14 -> 26 -> 34% CPU
>
> Would your recommendation then be to achieve scaling of RabbitMQ by
> having the application layer be able to send to multiple exchanges and
> brokers, and consumers likewise be able to listen to multiple queues
> and multiple brokers

The architecture will be determined by the application's requirements on 
the routing topology.

Inside the broker, messages are passed through a pipeline of processes, 
which roughly looks like this:

producer connection handler (one per connection) ->
protocol and routing logic (one per channel) ->
queue ->
protocol logic (one per channel) ->
consumer connection handler (one per connection)

This pipeline is never perfectly smooth - there's always some bottleneck 
somewhere.

Generally, the more you separate message flows - by making them go 
through separate connections, channels and queues - the smaller the 
impact of individual bottlenecks becomes and the better performance 
you'll get.

The "layout repetition" you did above is a good example of that.

Regards,

Matthias.

From emile at rabbitmq.com  Thu May 30 17:50:16 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 30 May 2013 17:50:16 +0100
Subject: [rabbitmq-discuss] reconfigure existing queue with dead letter
 exchange.
In-Reply-To: <8bc2f300-031f-4e52-951d-3059924fbc2c@googlegroups.com>
References: <8bc2f300-031f-4e52-951d-3059924fbc2c@googlegroups.com>
Message-ID: <51A78348.6050706@rabbitmq.com>


Hi,

On 30/05/13 15:32, a2800276 wrote:
> Is it somehow possible to reconfigure an already existing queue and
> attach an x-dead-letter-exchange parameter, e.g. with `rabbitmqctl`, or
> does the DL-exchange have to be specified during queue creation?


There are some queue parameters that can be modified after queue
creation. Federation and mirrored queues can be controlled in this way.
See http://www.rabbitmq.com/parameters.html

A dead letter exchange can only be set during queue declaration. See
http://www.rabbitmq.com/dlx.html for details.



-Emile





From AMorgan at salesforce.com  Thu May 30 18:12:54 2013
From: AMorgan at salesforce.com (Adam Morgan)
Date: Thu, 30 May 2013 10:12:54 -0700
Subject: [rabbitmq-discuss] ConfirmSelect() overhead
Message-ID: <CDCD0EE6.2913%amorgan@salesforce.com>

Has anyone else done a test to determine the impact of enabling confirmSelect() on publishing channels with respect to publishing rates?  In preliminary testing I have seen slower throughput by a ratio of about 40:1.  Is this in line with what others have seen?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/a675d132/attachment.htm>

From matthias at rabbitmq.com  Thu May 30 18:23:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 18:23:44 +0100
Subject: [rabbitmq-discuss] ConfirmSelect() overhead
In-Reply-To: <CDCD0EE6.2913%amorgan@salesforce.com>
References: <CDCD0EE6.2913%amorgan@salesforce.com>
Message-ID: <51A78B20.8040705@rabbitmq.com>

Adam,

On 30/05/13 18:12, Adam Morgan wrote:
> Has anyone else done a test to determine the impact of enabling
> confirmSelect() on publishing channels with respect to publishing rates?
>   In preliminary testing I have seen slower throughput by a ratio of
> about 40:1.  Is this in line with what others have seen?

How are you using confirms?

If you are waiting for a confirm after every single publish then things 
will go very slow indeed, since you are effectively making publish 
synchronous, taking in the entire round trip and processing latency, 
and, depending on the delivery mode, cost of writing to disk.

So don't do that. Ideally applications should handle confirms 
asynchronously, decoupled from publishing. If that is too hard / 
impractical, at least batch the waiting for confirms, e.g. wait for 
confirms every n messages or n seconds.

Matthias.

From AMorgan at salesforce.com  Thu May 30 18:31:48 2013
From: AMorgan at salesforce.com (Adam Morgan)
Date: Thu, 30 May 2013 10:31:48 -0700
Subject: [rabbitmq-discuss] ConfirmSelect() overhead
In-Reply-To: <51A78B20.8040705@rabbitmq.com>
Message-ID: <CDCD1354.291B%amorgan@salesforce.com>

Yeah, I was hoping to ensure guaranteed delivery simply, without caching messages for re-publishing, but looks like I'll have to add a thread and cache for doing this.

Is this the convention?  To cache the message with its sequence #, with another thread checking on the cache, attempting republish when Nacks received?

thx

On 5/30/13 2:23 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

Adam,

On 30/05/13 18:12, Adam Morgan wrote:
> Has anyone else done a test to determine the impact of enabling
> confirmSelect() on publishing channels with respect to publishing rates?
>   In preliminary testing I have seen slower throughput by a ratio of
> about 40:1.  Is this in line with what others have seen?

How are you using confirms?

If you are waiting for a confirm after every single publish then things
will go very slow indeed, since you are effectively making publish
synchronous, taking in the entire round trip and processing latency,
and, depending on the delivery mode, cost of writing to disk.

So don't do that. Ideally applications should handle confirms
asynchronously, decoupled from publishing. If that is too hard /
impractical, at least batch the waiting for confirms, e.g. wait for
confirms every n messages or n seconds.

Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/07eaf1da/attachment.htm>

From chengwei.ding at klarna.com  Thu May 30 16:46:13 2013
From: chengwei.ding at klarna.com (Chengwei Ding)
Date: Thu, 30 May 2013 17:46:13 +0200
Subject: [rabbitmq-discuss] 500 error when import config
Message-ID: <CAEhLKC8NG58toMrrg72n+GYfAg1rD7ac1bBbKMUR60yQgdfHnQ@mail.gmail.com>

Hello all,

I try to import a json config via rabbitmqadmin, it return 500 error like
below. Some json configure
could be imported through gui without problem (login as guest:guest).

Anybody has any idea?

[vagrant at rabbit tmp]$  ./rabbitmqadmin import rabbit_conf.json
Traceback (most recent call last):
  File "./rabbitmqadmin", line 914, in <module>
    main()
  File "./rabbitmqadmin", line 354, in main
    method()
  File "./rabbitmqadmin", line 489, in invoke_import
    self.post("/definitions", definitions)
  File "./rabbitmqadmin", line 383, in post
    return self.http("POST", "/api%s" % path, body)
  File "./rabbitmqadmin", line 421, in http
    % (resp.status, resp.reason, path, resp.read()))
Exception: Received 500 Internal Server Error for path /api/definitions
<html><head><title>500 Internal Server
Error</title></head><body><h1>Internal Server Error</h1>The server
encountered an error while processing this
request:<br><pre>{error,{error,{case_clause,{null}},
              [{rabbit_mgmt_format,'-to_amqp_table/1-lc$^0/1-0-',1,[]},
               {rabbit_mgmt_wm_definitions,add_queue,1,[]},
               {rabbit_mgmt_wm_definitions,'-for_all/3-lc$^0/1-0-',2,[]},
               {rabbit_mgmt_wm_definitions,apply_defs,3,[]},
               {webmachine_resource,resource_call,3,[]},
               {webmachine_resource,do,3,[]},
               {webmachine_decision_core,resource_call,1,[]},

 {webmachine_decision_core,accept_helper,0,[]}]}}</pre><P><HR><ADDRESS>mochiweb+webmachine
web server</ADDRESS></body></html>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/3b1f3c02/attachment.htm>

From matthias at rabbitmq.com  Thu May 30 18:38:56 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 18:38:56 +0100
Subject: [rabbitmq-discuss] ConfirmSelect() overhead
In-Reply-To: <CDCD1354.291B%amorgan@salesforce.com>
References: <CDCD1354.291B%amorgan@salesforce.com>
Message-ID: <51A78EB0.5060201@rabbitmq.com>

On 30/05/13 18:31, Adam Morgan wrote:
> Yeah, I was hoping to ensure guaranteed delivery simply, without caching
> messages for re-publishing, but looks like I?ll have to add a thread and
> cache for doing this.
>
> Is this the convention?  To cache the message with its sequence #, with
> another thread checking on the cache, attempting republish when Nacks
> received?

There is no one correct answer here. Very much depends on the 
application. In some applications guaranteed message delivery is 
possible without maintaining any 'waiting for confirm' buffers, e.g. if 
any 'lost' messages can be re-created easily from other 
application/system state.

Matthias.

From matthias at rabbitmq.com  Thu May 30 18:50:29 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 18:50:29 +0100
Subject: [rabbitmq-discuss] 500 error when import config
In-Reply-To: <CAEhLKC8NG58toMrrg72n+GYfAg1rD7ac1bBbKMUR60yQgdfHnQ@mail.gmail.com>
References: <CAEhLKC8NG58toMrrg72n+GYfAg1rD7ac1bBbKMUR60yQgdfHnQ@mail.gmail.com>
Message-ID: <51A79165.2070301@rabbitmq.com>

On 30/05/13 16:46, Chengwei Ding wrote:
> I try to import a json config via rabbitmqadmin, it return 500 error
> like below. Some json configure
> could be imported through gui without problem (login as guest:guest).
>
> Anybody has any idea?

What version of rabbit are you running?

Are you saying that the *same* json imported fine through the gui?

Where did the json you are trying to import originate? From a previous 
export or was it generated by some other process / by hand?

Can you post the json?


Regards,

Matthias.

From AMorgan at salesforce.com  Thu May 30 20:11:36 2013
From: AMorgan at salesforce.com (Adam Morgan)
Date: Thu, 30 May 2013 12:11:36 -0700
Subject: [rabbitmq-discuss] Testing confirms and Nacks
Message-ID: <CDCD2AB8.2928%amorgan@salesforce.com>

Is there a reliable/easy way to cause a Nack to be returned when confirmSelect() is enabled?  Would love to have a test case around this :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/ceb45d30/attachment.htm>

From matthias at rabbitmq.com  Thu May 30 20:21:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 20:21:40 +0100
Subject: [rabbitmq-discuss] Testing confirms and Nacks
In-Reply-To: <CDCD2AB8.2928%amorgan@salesforce.com>
References: <CDCD2AB8.2928%amorgan@salesforce.com>
Message-ID: <51A7A6C4.3060203@rabbitmq.com>

Adam,

On 30/05/13 20:11, Adam Morgan wrote:
> Is there a reliable/easy way to cause a Nack to be returned when
> confirmSelect() is enabled?

http://rabbitmq.1065348.n5.nabble.com/Testing-lightweight-publisher-confirms-td834.html

So 'no'.

Matthias.

From AMorgan at salesforce.com  Thu May 30 20:26:16 2013
From: AMorgan at salesforce.com (Adam Morgan)
Date: Thu, 30 May 2013 12:26:16 -0700
Subject: [rabbitmq-discuss] Testing confirms and Nacks
In-Reply-To: <51A7A6C4.3060203@rabbitmq.com>
Message-ID: <CDCD2E28.292D%amorgan@salesforce.com>

Figures :-/

Thanks anyway - you guys have been a big help today!


On 5/30/13 4:21 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

Adam,

On 30/05/13 20:11, Adam Morgan wrote:
> Is there a reliable/easy way to cause a Nack to be returned when
> confirmSelect() is enabled?

http://rabbitmq.1065348.n5.nabble.com/Testing-lightweight-publisher-confirms-td834.html

So 'no'.

Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/c0455e97/attachment.htm>

From stuff at moesel.net  Thu May 30 21:01:37 2013
From: stuff at moesel.net (Chris)
Date: Thu, 30 May 2013 16:01:37 -0400
Subject: [rabbitmq-discuss] Building from SRPM installs plugins w/ version
	0.0.0
Message-ID: <CAHEpgBCq8t3Q0M7MvkA4eVrVynFyTsTnA7c4WETwa=2Ymouv=Q@mail.gmail.com>

Hi All,

We generally package our own RPMs, often using the SRPM when it is
available.  Today we packaged RabbitMQ 3.1.1 from this SRPM:
http://www.rabbitmq.com/releases/rabbitmq-server/v3.1.1/rabbitmq-server-3.1.1-1.src.rpm
using
the Fedora Project Koji <https://fedoraproject.org/wiki/Koji> build system.

Without modifying the SRPM, the generated RPM contains plugins all with
version 0.0.0.  For example:

/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/plugins/amqp_client-0.0.0.ez
/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/plugins/cowboy-0.5.0-rmq0.0.0-git4b93c2d.ez
/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/plugins/eldap-0.0.0-gite309de4.ez

I have two questions:

1) Is there something special we should be doing in our build environment
to fix this?
2) Are these incorrectly versioned filenames harmful?

Thanks,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/f96a1b88/attachment.htm>

From john.hayden at nokia.com  Thu May 30 21:35:57 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Thu, 30 May 2013 20:35:57 +0000
Subject: [rabbitmq-discuss] rabbitmq-shovel issues [for hyperthunk]
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224C8C03@008-AM1MPN1-043.mgdnok.nokia.com>

I have 2 Rabbits running on 2 different ec2 instances in AWS
Rabbit1 has had a Shovel plugin installed in order to send messages to Rabbit2
These Rabbits are being used for a Sensu monitoring network
The Sensu server is in the same region as Rabbit1
When a message is sent by Sensu to Rabbit1 it fansout to all connected queues (maybe the wrong terminology here), including one called us-west-2
The Shovel is supposed to pick up messages from us-west-2 and forward it to Rabbit2
Later on I will add other queues to forward to other Rabbits

As I try this setup, I seem to timeout on a connection and I don't know why.

Here is a gist of what is going on: https://gist.github.com/jhhayden/5679708

Thanks in advance

John Hayden
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/313628b2/attachment.htm>

From matthias at rabbitmq.com  Thu May 30 21:58:25 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 May 2013 21:58:25 +0100
Subject: [rabbitmq-discuss] rabbitmq-shovel issues [for hyperthunk]
In-Reply-To: <8607A672AFB05B4D804456463DD7DCCF224C8C03@008-AM1MPN1-043.mgdnok.nokia.com>
References: <8607A672AFB05B4D804456463DD7DCCF224C8C03@008-AM1MPN1-043.mgdnok.nokia.com>
Message-ID: <51A7BD71.50808@rabbitmq.com>

On 30/05/13 21:35, john.hayden at nokia.com wrote:
> I have 2 Rabbits running on 2 different ec2 instances in AWS
> Rabbit1 has had a Shovel plugin installed in order to send messages to
> Rabbit2
> These Rabbits are being used for a Sensu monitoring network
> The Sensu server is in the same region as Rabbit1
> When a message is sent by Sensu to Rabbit1 it fansout to all connected
> queues (maybe the wrong terminology here), including one called us-west-2
> The Shovel is supposed to pick up messages from us-west-2 and forward it
> to Rabbit2
> Later on I will add other queues to forward to other Rabbits
>
> As I try this setup, I seem to timeout on a connection and I don't know why.
>
> Here is a gist of what is going on: https://gist.github.com/jhhayden/5679708

Have you checked the obvious, i.e. whether the Rabbit1 machine can 
connect to both endpoints? In particular, on Rabbit1 run

telnet 54.243.157.166 5672

and then type AMQPxx<return>

This should reply with 'AMQP<somestuff>' and close the connection.

Then try the same for the other connection, i.e. 'telnet 54.245.126.50 
5672'.

Also, it's worth checking the rabbit logs on both brokers for connection 
attempts and errors.


A few other points...

- you say that the shovel is running on rabbit1 and shovelling to 
rabbit2. That means it would be better to use a direct connection to 
rabbit1 instead of a network connection. From 
http://www.rabbitmq.com/shovel.html#configuration "If the [URI] host is 
omitted [...] the shovel uses a direct connection to the broker in which 
it is running. This avoids using the network stack.". In addition to 
better performance, direct connections are not affected by network 
issues, which should make it easier to debug the problem you are seeing.

- there's no need to specify the port 5672 in the URI since that is the 
default

Regards,

Matthias.

From MaslinskiR at valassis.com  Thu May 30 22:14:33 2013
From: MaslinskiR at valassis.com (Maslinski, Ray)
Date: Thu, 30 May 2013 21:14:33 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <5199FB29.70306@rabbitmq.com>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
	<5199FB29.70306@rabbitmq.com>
Message-ID: <7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>

Follow-up question ...

I tried some experiments to gain some understanding of how the cluster behaved with clients attached during a network partition event.  Essentially, I repeated the previous tests described below for autohealing and automatic queue synchronization, but left the cluster communications port blocked while the client test completed.  One oddity I noticed was that while the consumer connected to the slave appeared to receive an indication that something was amiss (client log showed a consumer cancel exception being handled by the Spring AMQP framework, and other monitoring logs appeared to show the client restarting a connection, which seems to be consistent with documentation), the consumer connected to the master seemed to remain oblivious to any possible issues.  That consumer continued to receive messages, but at an extremely slow rate (test published at 16/sec fixed rate, but the remaining consumer began to receive messages at the rate of about 1 every 14 seconds).

Since the test client waits around for expected message deliveries with a resettable 30 second timeout, it continued to run for an extended period of time (longer than I waited around for).  In addition, the admin console showed a relatively small number of unacked messages on that server, with the unacked count increasing with each actual delivery (client should always be acknowledging in the test setup, and reported no errors).  Eventually unblocking the cluster port released a bunch of messages in a short interval (albeit with some lost, as described previously).

I also saw  producer connections go into flow control during the outage and remain there during the slow consumer delivery (though the test had long since completed delivering all its messages).

Does this sound like expected behavior during a partition?

Ray Maslinski
Senior Software Developer, Engineering
Valassis / Digital Media
Cell: 585.330.2426
maslinskir at valassis.com
www.valassis.com

Creating the future of intelligent media delivery to drive your greatest success

_____________________________________________________________________________

This message may include proprietary or protected information. If you are not the intended?
recipient, please notify me, delete this message and do not further communicate the information?
contained herein without my express consent.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, May 20, 2013 6:30 AM
To: Discussions about RabbitMQ
Cc: Maslinski, Ray
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures when recovering from cluster partition

On 17/05/13 20:38, Maslinski, Ray wrote:
> Hello,

Hi!

> To simulate a network partition failure, I've been using iptables to 
> temporarily block inbound and outbound access on one of the nodes to 
> the single port configured for cluster communications through 
> inet_dist_listen_min and inet_dist_listen_max settings (min = max).
> Client access is not blocked during a simulated partition fault.

Sounds reasonable.

> I've observed two anomalies during testing that I wasn't expecting 
> based on the documentation I've read:
>
> -At a sufficiently high message rate, some number of messages will be 
> lost during the fault sequence, with the number lost tending to 
> increase with message rate.  No indication of a send error has been 
> observed by the client program. Based on results obtained from test 
> logs and an independent monitor listening on trace messages from each 
> node, it appears that as soon as the port is blocked, both nodes 
> continue to accept published messages, but (temporarily) stop 
> delivering messages until the cluster heartbeat failure is detected, 
> at which point the cluster is partitioned and the slave promotes itself to become master.
> In the sequences I've looked at, the messages that are lost all appear 
> to be published to the original master (and final master after a 
> winner is selected during autoheal).  Neither the start nor the end of 
> the lost message window appear to line up with any events in the logs, 
> other than the start occurring sometime after the port connection is 
> blocked but before the cluster heartbeat failure is detected, and the 
> end occurring sometime after the detection of the cluster heartbeat 
> failure and before the detection of the partitioned cluster after the 
> connection is unblocked.  Is message loss to be expected in this scenario?

I would expect to see message loss in a cluster heal scenario.

It's important to remember that a cluster partition is still a substantial problem, and the healing process involves throwing state away. Autoheal mode just means you get through this process faster, and hopefully spend much less time accepting messages that will end up being lost.

I would expect intuitively that only messages from the losing partitions would be lost. But I am not entirely surprised if messages from the winner are lost too; there is a period after the partitions have come back together but before autoheal kicks in during which we will have multiple masters for a queue, and behaviour can be unpredictable.

> -Occasionally the autoheal loser node fails to rejoin the cluster 
> after restart.  I don't have a lot of data points on this one since 
> it's only happened a handful of times during overnight test 
> iterations.  During one failure, the autoheal winner showed the log 
> message below during
> recovery:

Ah, that looks like a bug in autoheal. I think the stack trace you posted should contain enough information to fix it. Thanks.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

From mike.linnen at gmail.com  Fri May 31 03:29:09 2013
From: mike.linnen at gmail.com (Mike Linnen)
Date: Thu, 30 May 2013 19:29:09 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and MQTT Adapter
Message-ID: <d8bd254c-73e9-4e60-8ea7-23463f7a9b9b@googlegroups.com>

I have the adapter plugin enabled and I am able to post to an MQTT topic so 
I believe the service is hosting the MQTT broker ok.   I would like to use 
this adapter to make it easier to publish and subscribe to MQTT topics from 
embedded devices.  However I am having trouble determining what the topic 
needs to be on the MQTT side to publish a message that gets onto the 
RabbitMQ bus.  I am also having trouble determining what topics I can 
subscribe to on the MQTT side so that when I publish a message on the 
RabbotMQ bus I can receive it on the device that is subscribed to the MQTT 
topic.
 
Does anyone know what an MQTT topic looks like for a RabbitMQ AMQP message?
 
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/f7f14ced/attachment.htm>

From abbiya at gmail.com  Fri May 31 08:20:08 2013
From: abbiya at gmail.com (Seshachalam Malisetti)
Date: Fri, 31 May 2013 00:20:08 -0700 (PDT)
Subject: [rabbitmq-discuss] user presence in android im APP?
Message-ID: <1a80d9c2-90f3-4180-aeb7-41c66b53ceab@googlegroups.com>

 
   
I have an instant messaging app for android where users can chat. it is 
done by a rabbitmq server. Messaging just works fine. I need to find out 
the user presence whether user is online or whats the last online time. 
some how i think xmpp can do it but i'm not sure how to this.

Any ideas how to find the user presence in mobile IM apps ?

Thanks, Seshu 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/97594095/attachment.htm>

From matthias at rabbitmq.com  Fri May 31 08:47:28 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 May 2013 08:47:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ and MQTT Adapter
In-Reply-To: <d8bd254c-73e9-4e60-8ea7-23463f7a9b9b@googlegroups.com>
References: <d8bd254c-73e9-4e60-8ea7-23463f7a9b9b@googlegroups.com>
Message-ID: <51A85590.6000408@rabbitmq.com>

Mike,

this appears to be a repeat of the question you asked yesterday. My 
colleague Emile answered that. See 
http://rabbitmq.1065348.n5.nabble.com/MQTT-Adapter-question-tp27069p27071.html

Regards,

Matthias.

On 31/05/13 03:29, Mike Linnen wrote:
> I have the adapter plugin enabled and I am able to post to an MQTT topic
> so I believe the service is hosting the MQTT broker ok.   I would like
> to use this adapter to make it easier to publish and subscribe to MQTT
> topics from embedded devices.  However I am having trouble determining
> what the topic needs to be on the MQTT side to publish a message that
> gets onto the RabbitMQ bus.  I am also having trouble determining what
> topics I can subscribe to on the MQTT side so that when I publish a
> message on the RabbotMQ bus I can receive it on the device that is
> subscribed to the MQTT topic.
> Does anyone know what an MQTT topic looks like for a RabbitMQ AMQP message?
> Thanks
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From watson.timothy at gmail.com  Fri May 31 09:31:10 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 31 May 2013 09:31:10 +0100
Subject: [rabbitmq-discuss] user presence in android im APP?
In-Reply-To: <1a80d9c2-90f3-4180-aeb7-41c66b53ceab@googlegroups.com>
References: <1a80d9c2-90f3-4180-aeb7-41c66b53ceab@googlegroups.com>
Message-ID: <9CCC7973-C9A0-4908-817B-1E48E0502A97@rabbitmq.com>

Take a look at https://github.com/tonyg/presence-exchange and/or https://github.com/tonyg/rabbitmq-xmpp. These are experimental and I have no idea whether they will work with the latest release of rabbit, but its  worth a look.

On 31 May 2013, at 08:20, Seshachalam Malisetti <abbiya at gmail.com> wrote:

> 
> I have an instant messaging app for android where users can chat. it is done by a rabbitmq server. Messaging just works fine. I need to find out the user presence whether user is online or whats the last online time. some how i think xmpp can do it but i'm not sure how to this.
> 
> Any ideas how to find the user presence in mobile IM apps ?
> 
> Thanks, Seshu
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/79ba14c3/attachment.htm>

From chengwei.ding at klarna.com  Fri May 31 09:35:17 2013
From: chengwei.ding at klarna.com (Chengwei Ding)
Date: Fri, 31 May 2013 10:35:17 +0200
Subject: [rabbitmq-discuss] 500 error when import config
In-Reply-To: <51A79165.2070301@rabbitmq.com>
References: <CAEhLKC8NG58toMrrg72n+GYfAg1rD7ac1bBbKMUR60yQgdfHnQ@mail.gmail.com>
	<51A79165.2070301@rabbitmq.com>
Message-ID: <CAEhLKC9BgEVLLF1+ToX1ayj2LB5DHZ3caSaosTDbusxdo8FBVA@mail.gmail.com>

Hello Matthias, looks like the problem come from emacs json format. If I
pass the json without calling emacs json-pretty-print-buffer, everything
works. Don't know why yet, maybe look into a bit later. Thx for the reply.


On Thu, May 30, 2013 at 7:50 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 30/05/13 16:46, Chengwei Ding wrote:
>
>> I try to import a json config via rabbitmqadmin, it return 500 error
>> like below. Some json configure
>> could be imported through gui without problem (login as guest:guest).
>>
>> Anybody has any idea?
>>
>
> What version of rabbit are you running?
>

My testing env is centos6 x64 + rabbit 3.0.4


> Are you saying that the *same* json imported fine through the gui?
>

You are right . It's "same" not "some".

>
> Where did the json you are trying to import originate? From a previous
> export or was it generated by some other process / by hand?
>

it was generated from a local test machine running 3.0.1


>
> Can you post the json?
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/5630b2b7/attachment.htm>

From matthias at rabbitmq.com  Fri May 31 09:41:35 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 May 2013 09:41:35 +0100
Subject: [rabbitmq-discuss] 500 error when import config
In-Reply-To: <CAEhLKC9BgEVLLF1+ToX1ayj2LB5DHZ3caSaosTDbusxdo8FBVA@mail.gmail.com>
References: <CAEhLKC8NG58toMrrg72n+GYfAg1rD7ac1bBbKMUR60yQgdfHnQ@mail.gmail.com>
	<51A79165.2070301@rabbitmq.com>
	<CAEhLKC9BgEVLLF1+ToX1ayj2LB5DHZ3caSaosTDbusxdo8FBVA@mail.gmail.com>
Message-ID: <51A8623F.4000508@rabbitmq.com>

On 31/05/13 09:35, Chengwei Ding wrote:
> Hello Matthias, looks like the problem come from emacs json format. If I
> pass the json without calling emacs json-pretty-print-buffer, everything
> works. Don't know why yet, maybe look into a bit later.

It would still be good to get an example of json that produces the error 
you saw, so we can improve the error handling in the code and generate a 
more informative error message.

If there is sensitive data in the json, feel free to send it to me 
privately.

Matthias.

From simon at rabbitmq.com  Fri May 31 11:49:55 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 31 May 2013 11:49:55 +0100
Subject: [rabbitmq-discuss] 500 error when import config
In-Reply-To: <CAEhLKC9BgEVLLF1+ToX1ayj2LB5DHZ3caSaosTDbusxdo8FBVA@mail.gmail.com>
References: <CAEhLKC8NG58toMrrg72n+GYfAg1rD7ac1bBbKMUR60yQgdfHnQ@mail.gmail.com>
	<51A79165.2070301@rabbitmq.com>
	<CAEhLKC9BgEVLLF1+ToX1ayj2LB5DHZ3caSaosTDbusxdo8FBVA@mail.gmail.com>
Message-ID: <51A88053.1040306@rabbitmq.com>

On 31/05/13 09:35, Chengwei Ding wrote:
> Hello Matthias, looks like the problem come from emacs json format. If I
> pass the json without calling emacs json-pretty-print-buffer, everything
> works. Don't know why yet, maybe look into a bit later. Thx for the reply.

I looked into this. json-pretty-print-buffer appears to convert {} to 
null. I am really not sure that's a reasonable thing to do.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From chengwei.ding at klarna.com  Fri May 31 12:05:09 2013
From: chengwei.ding at klarna.com (Chengwei Ding)
Date: Fri, 31 May 2013 13:05:09 +0200
Subject: [rabbitmq-discuss] 500 error when import config
In-Reply-To: <51A88053.1040306@rabbitmq.com>
References: <CAEhLKC8NG58toMrrg72n+GYfAg1rD7ac1bBbKMUR60yQgdfHnQ@mail.gmail.com>
	<51A79165.2070301@rabbitmq.com>
	<CAEhLKC9BgEVLLF1+ToX1ayj2LB5DHZ3caSaosTDbusxdo8FBVA@mail.gmail.com>
	<51A88053.1040306@rabbitmq.com>
Message-ID: <CAEhLKC-LKq4g97BtqLJTmXWvWBfXjsvstM3Bp8rwqSXxrxeKyA@mail.gmail.com>

I can confirm that is the cause. Thanks Simon. Though wired emacs function.


On Fri, May 31, 2013 at 12:49 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 31/05/13 09:35, Chengwei Ding wrote:
>
>> Hello Matthias, looks like the problem come from emacs json format. If I
>> pass the json without calling emacs json-pretty-print-buffer, everything
>> works. Don't know why yet, maybe look into a bit later. Thx for the reply.
>>
>
> I looked into this. json-pretty-print-buffer appears to convert {} to
> null. I am really not sure that's a reasonable thing to do.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/49c40516/attachment.htm>

From michael.s.klishin at gmail.com  Fri May 31 12:49:57 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 31 May 2013 15:49:57 +0400
Subject: [rabbitmq-discuss] ANN Hot Bunnies 2.0.0.pre3 is released
Message-ID: <CAE3HoVQ9vvgkoe6sR11YeyRX58Q3KqbS_gqTtkDfPu6hSe4hDg@mail.gmail.com>

Hot Bunnies is a battle tested JRuby client for RabbitMQ [1].

Hot Bunnies 2.0 is a major release that will introduce some breaking public
API changes
and makes Hot Bunnies API be very close to that of Bunny 0.9 [2]. Most
apps, however,
won't require many changes to upgrade.

Change log explains the changes and why they make Hot Bunnies an easier to
use library:
https://github.com/ruby-amqp/hot_bunnies/blob/master/ChangeLog.md

Hot Bunnies now also has a documentation site: http://hotbunnies.info.

Keep in mind that 2.0.0.pre3 [3] is the first pre-release
version ready to be announced to the public. There likely will be more
development
releases to come, and the docs are incomplete and not yet edited.

Give 2.0.0.pre3 a try. It is a much nicer library than Hot Bunnies 1.5.

1. http://hotbunnies.info
2. http://rubybunny.info
3. https://rubygems.org/gems/hot_bunnies/versions/2.0.0.pre3-java
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/be84651b/attachment.htm>

From tilak.chauhan at ymail.com  Fri May 31 12:59:57 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Fri, 31 May 2013 04:59:57 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ connection(s) Blocking !
Message-ID: <1370001597528-27113.post@n5.nabble.com>

Hi,

I installed/configured RabbitMQ on multiple servers and for couple of weeks
everything was working fine. But, recently while adding new messages to the
queues I noticed a connection(s) blocking issue and when I ran `rabbitmqctl
set_vm_memory_high_watermark 0.6` command then all servers start to work.
Can anybody help me to know why I'd this issue on my servers ? As I read
somewhere this is a memory related issue. How could this be possible ?
because queues were already empty  and I tried to add just 100 new messages
into queues. which thing was consuming RMQ default allocated memory ? Is
there anything I can in my script to never get stuck into such issue ?

I'm using Rabbitmq 3.0.4 and also configured clustering on severs.

Thanks,
T.luck









--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-connection-s-Blocking-tp27113.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tilak.chauhan at ymail.com  Fri May 31 13:04:10 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Fri, 31 May 2013 05:04:10 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ connection(s) Blocking !
Message-ID: <1370001850389-27114.post@n5.nabble.com>

Hi,

I installed/configured RabbitMQ on multiple servers and for past couple of
weeks everything was working fine. But, recently while adding new messages
to the queues I noticed a connection(s) blocking issue and when I ran
`rabbitmqctl set_vm_memory_high_watermark 0.6` command then all servers
start to work. Can anybody help me to know why I'd this issue on my servers
? As I read somewhere this is a memory related issue. How could this be
possible ? because queues were already empty  and I tried to add just 100
new messages into queues. So which thing was consuming default allocated
memory to RMQ ? Is there anything I can do in my script to never get stuck
into such issues ?

I'm using Rabbitmq 3.0.4 and also have clustering configured on severs.

Thanks,
T.luck



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-connection-s-Blocking-tp27114.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Fri May 31 13:35:37 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 May 2013 13:35:37 +0100
Subject: [rabbitmq-discuss] Building from SRPM installs plugins w/
	version 0.0.0
In-Reply-To: <CAHEpgBCq8t3Q0M7MvkA4eVrVynFyTsTnA7c4WETwa=2Ymouv=Q@mail.gmail.com>
References: <CAHEpgBCq8t3Q0M7MvkA4eVrVynFyTsTnA7c4WETwa=2Ymouv=Q@mail.gmail.com>
Message-ID: <AAF5A26A-FCC7-432E-A278-F386D4F118F0@rabbitmq.com>

I'm not sure how you would normally deal with a source RPM in this respect, but anyway the src RPM that you've downloaded only contains the sources and these are given a release number by the build system. Take a look in the various shell scripts and makes files in the rabbitmq-public-umbrella for details.

Is there are a reason why you need to package from source yourselves?

On 30 May 2013, at 21:01, Chris wrote:

> 1) Is there something special we should be doing in our build environment to fix this?

Don't know - our rpm generation works fine, so maybe try to crib some ideas from there?

> 2) Are these incorrectly versioned filenames harmful?

Probably not. RabbitMQ brokers will refuse to cluster if their major versions differ, however for plugins there may be no adverse affects at all, but don't take that as gospel. Also it could be confusing for folks trying to offer on-list support if your rabbitmqctl output shows plugin version numbers of 0.0.0.

Cheers,
Tim

From stuff at moesel.net  Fri May 31 14:39:56 2013
From: stuff at moesel.net (Chris)
Date: Fri, 31 May 2013 09:39:56 -0400
Subject: [rabbitmq-discuss] Building from SRPM installs plugins w/
	version 0.0.0
In-Reply-To: <AAF5A26A-FCC7-432E-A278-F386D4F118F0@rabbitmq.com>
References: <CAHEpgBCq8t3Q0M7MvkA4eVrVynFyTsTnA7c4WETwa=2Ymouv=Q@mail.gmail.com>
	<AAF5A26A-FCC7-432E-A278-F386D4F118F0@rabbitmq.com>
Message-ID: <CAHEpgBBu1OwVzCEKwp+XAY7yP9=a_HsEhYnhmhV4eeQ+zRMv8w@mail.gmail.com>

Thank you for the response.  Looking in the Makefile, I see this:

VERSION:=0.0.0


And I found this in the README in the rabbitmq-public-umbrella, which seems
to confirm it:

By default, PACKAGE_VERSION takes its value from VERSION.  VERSION is
a global (not per-package) variable intended to be set when invoking
make in order to specify the version number for the release.  So, if
package.mk does nothing to change the default behaviour, the version
number of a package will be the release-wide version number from
VERSION.  By default, VERSION has the value 0.0.0.


It's worth noting, however, that we're not the only ones who apparently
have been caught by this.  If you look at the most recent published RPMs
from the Fedora Project and altlinux.org (albeit the most current are still
old), you'll see that their published RPMs for RabbitMQ also have 0.0.0
plugins:

   -
   http://fedora.mirror.nexicom.net/linux/development/rawhide/x86_64/os/Packages/r/rabbitmq-server-3.0.4-1.fc20.noarch.rpm
   -
   ftp://ftp.altlinux.org/pub/distributions/ALTLinux/Sisyphus/files/noarch/RPMS/rabbitmq-server-2.8.7-alt2.noarch.rpm

As for why we repackage, I don't know-- it wasn't my decision.  I guess
maybe we are control freaks? ;-)

Thanks,
Chris


On Fri, May 31, 2013 at 8:35 AM, Tim Watson <tim at rabbitmq.com> wrote:

> I'm not sure how you would normally deal with a source RPM in this
> respect, but anyway the src RPM that you've downloaded only contains the
> sources and these are given a release number by the build system. Take a
> look in the various shell scripts and makes files in the
> rabbitmq-public-umbrella for details.
>
> Is there are a reason why you need to package from source yourselves?
>
> On 30 May 2013, at 21:01, Chris wrote:
>
> > 1) Is there something special we should be doing in our build
> environment to fix this?
>
> Don't know - our rpm generation works fine, so maybe try to crib some
> ideas from there?
>
> > 2) Are these incorrectly versioned filenames harmful?
>
> Probably not. RabbitMQ brokers will refuse to cluster if their major
> versions differ, however for plugins there may be no adverse affects at
> all, but don't take that as gospel. Also it could be confusing for folks
> trying to offer on-list support if your rabbitmqctl output shows plugin
> version numbers of 0.0.0.
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/b8020edc/attachment.htm>

From tim at rabbitmq.com  Fri May 31 15:14:28 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 May 2013 15:14:28 +0100
Subject: [rabbitmq-discuss] Building from SRPM installs plugins w/
	version 0.0.0
In-Reply-To: <CAHEpgBBu1OwVzCEKwp+XAY7yP9=a_HsEhYnhmhV4eeQ+zRMv8w@mail.gmail.com>
References: <CAHEpgBCq8t3Q0M7MvkA4eVrVynFyTsTnA7c4WETwa=2Ymouv=Q@mail.gmail.com>
	<AAF5A26A-FCC7-432E-A278-F386D4F118F0@rabbitmq.com>
	<CAHEpgBBu1OwVzCEKwp+XAY7yP9=a_HsEhYnhmhV4eeQ+zRMv8w@mail.gmail.com>
Message-ID: <E1281AC6-60B4-45E3-8025-110AEA002317@rabbitmq.com>

Hi Chris,

On 31 May 2013, at 14:39, Chris wrote:
> It's worth noting, however, that we're not the only ones who apparently have been caught by this.  If you look at the most recent published RPMs from the Fedora Project and altlinux.org (albeit the most current are still old), you'll see that their published RPMs for RabbitMQ also have 0.0.0 plugins:
> http://fedora.mirror.nexicom.net/linux/development/rawhide/x86_64/os/Packages/r/rabbitmq-server-3.0.4-1.fc20.noarch.rpm
> ftp://ftp.altlinux.org/pub/distributions/ALTLinux/Sisyphus/files/noarch/RPMS/rabbitmq-server-2.8.7-alt2.noarch.rpm
Yes, we're clearly not doing the right thing here. I've filed a ticket to address this, hopefully going into the next release.

> As for why we repackage, I don't know-- it wasn't my decision.  I guess maybe we are control freaks? ;-)  

Well lucky for us you are, since we hadn't noticed this!

Thanks for the bug report!

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/ecd7423e/attachment.htm>

From tim at rabbitmq.com  Fri May 31 15:29:18 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 May 2013 15:29:18 +0100
Subject: [rabbitmq-discuss] rabbitmq-shovel issues [for hyperthunk]
In-Reply-To: <51A7BD71.50808@rabbitmq.com>
References: <8607A672AFB05B4D804456463DD7DCCF224C8C03@008-AM1MPN1-043.mgdnok.nokia.com>
	<51A7BD71.50808@rabbitmq.com>
Message-ID: <365842DA-5C21-45E4-85EF-0FF433E0C3C1@rabbitmq.com>

Hi John,

Did you try Matthias' suggestions out? Are you still struggling with this? It'd be good to get you past these hurdles since I know you've been trying to get this to work for quite some time now.

Cheers,
Tim (aka hyperthunk)

On 30 May 2013, at 21:58, Matthias Radestock wrote:

> On 30/05/13 21:35, john.hayden at nokia.com wrote:
>> I have 2 Rabbits running on 2 different ec2 instances in AWS
>> Rabbit1 has had a Shovel plugin installed in order to send messages to
>> Rabbit2
>> These Rabbits are being used for a Sensu monitoring network
>> The Sensu server is in the same region as Rabbit1
>> When a message is sent by Sensu to Rabbit1 it fansout to all connected
>> queues (maybe the wrong terminology here), including one called us-west-2
>> The Shovel is supposed to pick up messages from us-west-2 and forward it
>> to Rabbit2
>> Later on I will add other queues to forward to other Rabbits
>> 
>> As I try this setup, I seem to timeout on a connection and I don't know why.
>> 
>> Here is a gist of what is going on: https://gist.github.com/jhhayden/5679708
> 
> Have you checked the obvious, i.e. whether the Rabbit1 machine can connect to both endpoints? In particular, on Rabbit1 run
> 
> telnet 54.243.157.166 5672
> 
> and then type AMQPxx<return>
> 
> This should reply with 'AMQP<somestuff>' and close the connection.
> 
> Then try the same for the other connection, i.e. 'telnet 54.245.126.50 5672'.
> 
> Also, it's worth checking the rabbit logs on both brokers for connection attempts and errors.
> 
> 
> A few other points...
> 
> - you say that the shovel is running on rabbit1 and shovelling to rabbit2. That means it would be better to use a direct connection to rabbit1 instead of a network connection. From http://www.rabbitmq.com/shovel.html#configuration "If the [URI] host is omitted [...] the shovel uses a direct connection to the broker in which it is running. This avoids using the network stack.". In addition to better performance, direct connections are not affected by network issues, which should make it easier to debug the problem you are seeing.
> 
> - there's no need to specify the port 5672 in the URI since that is the default
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From n16483 at cray.com  Fri May 31 15:29:59 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Fri, 31 May 2013 09:29:59 -0500
Subject: [rabbitmq-discuss] RabbitMQ Federation & SSL
In-Reply-To: <51A7779C.7010109@rabbitmq.com>
References: <519E7BD9.60902@cray.com> <519F3AB1.3040804@rabbitmq.com>
	<519F7052.6030301@cray.com> <519FE1BB.9030005@cray.com>
	<51A12581.40908@rabbitmq.com> <51A61670.8050104@cray.com>
	<51A67A7E.1050606@cray.com> <51A686C0.5030102@rabbitmq.com>
	<51A7639F.3000002@cray.com> <51A7779C.7010109@rabbitmq.com>
Message-ID: <51A8B3E7.40107@cray.com>

Thanks. I had looked at and read that page. But, I obviously need to 
meditate on it some more.

Eric

On 05/30/2013 11:00 AM, Matthias Radestock wrote:
> Eric,
>
> On 30/05/13 15:35, Eric Cozzi wrote:
>> Thanks. Setting the local-username to a valid username fixed the
>> problem. But, I'm still confused.
>
> Take a look at the diagram and explanation at 
> http://www.rabbitmq.com/federation.html#details
>
>> I have RabbitMQ configured to use the auth_mechanism_ssl plugin. So, why
>> do I have to set the local-username at all? I expected that by setting
>> the client ssl-keys in the federation URI, federation would pull the
>> username out of the SSL key and use that to authenticate. This works for
>> normal clients connecting via SSL. Why doesn't this work for federation
>> clients?
>
> The URIs you specify in the federation config tell a downstream 
> (right-hand side of the diagram) how to establish an AMQP connection 
> to an upstream (left-hand side of the diagram), thus establishing an 
> upstream link (as labelled in the diagram) across which messages that 
> have been published on the upstream are pulled to the downstream.
>
> The ssl config in the broker configuration of the upstream, and the 
> ssl settings in the URIs of the federation config of the downstream, 
> control authentication and authorisation for that link.
>
> But there is more....
>
> Any messages pulled down over the upstream link are re-published 
> locally, via a local/internal connection - indicated by the fat arrow 
> on the right-hand side that loops back onto the exchange. That local 
> connection requires a username for authorisation. It is that username 
> which you set in the federation config with local-username.
>
> Note that this user only requires authorisation, not authentication 
> (hence no password, ssl credentials, etc).
>
>
> Regards,
>
> Matthias.
>

From Petr.Gotthard at Honeywell.com  Fri May 31 16:05:05 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Fri, 31 May 2013 15:05:05 +0000
Subject: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from
	rabbitmq-web-dispatch
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D33F4C8@FR44EX3005.global.ds.honeywell.com>

Hello,
Could there be yet another bug in the repository? If you look at rabbitmq-web-dispatch<http://hg.rabbitmq.com/rabbitmq-web-dispatch/summary>, there is no tag for 3.0.3 and 3.0.4 although the log says it was created. (I didn't check all the other repos.)

Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/79bcf98e/attachment.htm>

From buptloveandroid at gmail.com  Fri May 31 16:20:40 2013
From: buptloveandroid at gmail.com (bupt bupt)
Date: Fri, 31 May 2013 23:20:40 +0800
Subject: [rabbitmq-discuss] problem about flow control and HA cluster
In-Reply-To: <51A71C72.8000506@rabbitmq.com>
References: <CAL-OO0mgtEiqFtL_UNzLDyJto3hAKpr=pDaBDVKFoAiSJw6q0A@mail.gmail.com>
	<51A71C72.8000506@rabbitmq.com>
Message-ID: <CAL-OO0=_WyBCQTFEEu5asTdWXpTB8Xu91g7OpDH0jUPxihqXpA@mail.gmail.com>

thank you very much![?]


2013/5/30 Emile Joubert <emile at rabbitmq.com>

>
>
> Hi,
>
> On 27/05/13 16:12, bupt bupt wrote:
> > 1. Can you give me an example(internet address is ok) about how to
> > finish flow control if the length of queue is too big or if the used
> > memory and disc near the threshold. Can you give me some client
> > code(python or Java) to help me use it.
>
> If I understand correctly you have a broker with disk free space close
> to the disk free limit or memory use close to the high watermark, and
> you want to disable resource flow control.
>
> You should be aware that disabling resource flow control will make the
> broker more likely to run out of resources and crash. A better solution
> is to provision the broker with more resources. You should only relax
> the resource limits if your application can tolerate the increased risk
> of a crashing broker.
>
> You can relax memory flow control by increasing the memory high
> watermark from 40% to 50% or higher, e.g.
>
>  rabbitmqctl set_vm_memory_high_watermark 0.5
>
> Setting it to an infeasibly large ration effectively disables memory
> flow control:
>
>  rabbitmqctl set_vm_memory_high_watermark 100.0
>
> These instructions will change the limits for a running broker. See the
> instructions here for how to make the changes permanent by changing the
> configuration file: http://www.rabbitmq.com/memory.html#memsup
>
>
> You can reduce the disk free limit by specifying a lower limit:
>
>  rabbitmqctl eval 'rabbit_disk_monitor:set_disk_free_limit(500000000).'
>
> or disable it by setting the limit to zero:
>
>  rabbitmqctl eval 'rabbit_disk_monitor:set_disk_free_limit(0).'
>
> See http://www.rabbitmq.com/memory.html#diskfreesup for persisting the
> change in the configuration file.
>
>
> > 2. I have read document about how to set up rabbitmq cluster
> > by"http://www.rabbitmq.com/clustering.html" But who is master and who is
> > cluster, It  doesn't tell us. which broker manage all the nodes in
> > cluster? I didn't see any mirror queue in this address, Can this cluster
> > still be HA cluster?
>
> There is no global master. Queues can have different policies, so there
> is a master node per queue (assuming the queue is mirrored). See the
> "rabbitmqctl list_queues" documentation for querying the master and
> slave nodes for queues:
>
> http://www.rabbitmq.com/man/rabbitmqctl.1.man.html
>
> > 3. Is every message has length and size limit? what is the maximum size
> > of every message?
>
>
> Messages can be as large as you like, but they should not consume a
> significant fraction of total available RAM. If you want to process
> extremely large messages then you need alot of RAM.
>
> Queue length can be limited with the x-max-length argument. See
> http://www.rabbitmq.com/maxlength.html.
>
>
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/9365395e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 103 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/9365395e/attachment.gif>

From john.hayden at nokia.com  Fri May 31 16:29:38 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Fri, 31 May 2013 15:29:38 +0000
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224CEDEC@008-AM1MPN1-043.mgdnok.nokia.com>

I am very new to rabbitmq and shovel but I may have found a bug:

My setup:

I am running Rabbit 3.1.1 and have shovel plugin enabled.
I have sense clients that communicate with this rabbit broker successfully to vhost /sensu with sensu and mypass as username and password.

The shovel plugin (loaded on the first Rabbit) with talk to a 2nd Rabbit which is also serving sense clients using the same vhost, username and password.

Here is my shovel config file:

[
    {rabbitmq_shovel,
      [{shovels, [ {test_shovel,
        [ {sources, [{broker, "amqp://sensu:mypass@/sensu"}]}
        , {destinations, [{broker, "amqp://sensu:mypass at ec2-54-245-126-50.us-west-2.compute.amazonaws.com/sensu"}]}
        , {queue, <<"rabbitmq-us-west-2">>}
        ]
      }]}]
    }
].

As you can see, my source (which is Rabbit1) is being connected to by the shovel by the non network method and has the username, password and vhost
The destination is set up as a network connection

Here is the error is get after a restart of Rabbit1 server:

=INFO REPORT==== 31-May-2013::15:13:10 ===
accepting AMQP connection <0.387.0> (10.73.3.20:39733 -> 10.40.215.251:5672)

=ERROR REPORT==== 31-May-2013::15:13:24 ===
** Generic server <0.400.0> terminating
** Last message in was {'$gen_cast',init}
** When Server state == {state,undefined,undefined,undefined,undefined,
                         test_shovel,
                         {shovel,
                          {endpoint,
                           [{amqp_params_direct,<<"sensu">>,none,<<"sensu">>,
                             'rabbit at ip-10-40-215-251',none,[]}],
                           []},
                          {endpoint,
                           [{amqp_params_network,<<"sensu">>,<<"mypass">>,
                             <<"sensu">>,
                             "ec2-54-245-126-50.us-west-2.compute.amazonaws.com",
                             undefined,0,0,0,infinity,none,
                             [#Fun<amqp_uri.7.123484526>,
                              #Fun<amqp_uri.7.123484526>],
                             [],[]}],
                           []},
                          0,on_confirm,
                          #Fun<rabbit_shovel_config.15.100604638>,
                          #Fun<rabbit_shovel_config.15.100604638>,
                          <<"rabbitmq-us-west-2">>,5},
                         undefined,undefined,undefined,undefined,undefined}
** Reason for termination ==
** {{badmatch,{error,access_refused}},
    [{rabbit_shovel_worker,make_conn_and_chan,1},
     {rabbit_shovel_worker,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}


Notice this line:
[{amqp_params_direct,<<"sensu">>,none,<<"sensu">>,
                             'rabbit at ip-10-40-215-251',none,[]}],

If I read this correctly, the password is not being passed and THUS authentication is being denied.

Is this a bug?

John Hayden
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/a2022eb3/attachment.htm>

From simon at rabbitmq.com  Fri May 31 17:05:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 31 May 2013 17:05:32 +0100
Subject: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from
	rabbitmq-web-dispatch
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D33F4C8@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D33F4C8@FR44EX3005.global.ds.honeywell.com>
Message-ID: <51A8CA4C.6000204@rabbitmq.com>

On 31/05/13 16:05, Gotthard, Petr wrote:
> Could there be yet another bug in the repository? If you look at
> rabbitmq-web-dispatch
> <http://hg.rabbitmq.com/rabbitmq-web-dispatch/summary>, there is no tag
> for 3.0.3 and 3.0.4 although the log says it was created. (I didn?t
> check all the other repos.)

Hmm.

"hg tags" in the checked out repository does list these tags, it's just 
the web interface that doesn't.

I suspect a bug in hg's web interface to be honest. Tags in hg are 
rather quirky, and the machine running the web interface is not running 
the latest hg release.

Not sure what we can do about this really I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 31 17:15:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 31 May 2013 17:15:07 +0100
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <8607A672AFB05B4D804456463DD7DCCF224CEDEC@008-AM1MPN1-043.mgdnok.nokia.com>
References: <8607A672AFB05B4D804456463DD7DCCF224CEDEC@008-AM1MPN1-043.mgdnok.nokia.com>
Message-ID: <51A8CC8B.4090005@rabbitmq.com>

On 31/05/13 16:29, john.hayden at nokia.com wrote:
> I am very new to rabbitmq and shovel but I may have found a bug:

<snip>

>          [ {sources, [{broker, "amqp://sensu:mypass@/sensu"}]}

<snip>

> ** Reason for termination ==
> ** {{badmatch,{error,access_refused}},
>      [{rabbit_shovel_worker,make_conn_and_chan,1},
>       {rabbit_shovel_worker,handle_cast,2},
>       {gen_server2,handle_msg,2},
>       {proc_lib,init_p_do_apply,3}]}
>
>
> Notice this line:
> [{amqp_params_direct,<<"sensu">>,none,<<"sensu">>,
>                               'rabbit at ip-10-40-215-251',none,[]}],
>
> If I read this correctly, the password is not being passed and THUS
> authentication is being denied.

No, not really. The source URI "amqp://sensu:mypass@/sensu" doesn't 
specify a host, therefore it connects with the direct client (i.e. via 
Erlang message passing rather than AMQP). In most contexts the direct 
client does not need a password (since if you can connect via Erlang 
message passing you must be trusted). So the password in that URL is 
ignored (and you can take it out) but this is not your problem - you 
have some other access control issue.

Check the logs for errors looking like:

=ERROR REPORT==== 31-May-2013::17:12:33 ===
closing AMQP connection <0.388.0> (127.0.0.1:40730 -> 127.0.0.1:5672):
{handshake_error,starting,0,
  {amqp_error,access_refused,
              "PLAIN login refused: user 'user' - invalid credentials",
              'connection.start_ok'}}

or similar.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Petr.Gotthard at Honeywell.com  Fri May 31 17:15:33 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Fri, 31 May 2013 16:15:33 +0000
Subject: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from
 rabbitmq-web-dispatch
In-Reply-To: <51A8CA4C.6000204@rabbitmq.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D33F4C8@FR44EX3005.global.ds.honeywell.com>
	<51A8CA4C.6000204@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D33F56B@FR44EX3005.global.ds.honeywell.com>

Well, I'm trying to run "make BRANCH=rabbitmq_v3_0_4 up_c" and it fails for rabbitmq-web-dispatch with an "unknown tag" error. It works, when I use rabbitmq_v3_1_0 instead.

Should upgrade hg?


Petr

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 31. kv?tna 2013 18:06
To: Discussions about RabbitMQ
Cc: Gotthard, Petr
Subject: Re: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from rabbitmq-web-dispatch

On 31/05/13 16:05, Gotthard, Petr wrote:
> Could there be yet another bug in the repository? If you look at 
> rabbitmq-web-dispatch 
> <http://hg.rabbitmq.com/rabbitmq-web-dispatch/summary>, there is no 
> tag for 3.0.3 and 3.0.4 although the log says it was created. (I 
> didn't check all the other repos.)

Hmm.

"hg tags" in the checked out repository does list these tags, it's just the web interface that doesn't.

I suspect a bug in hg's web interface to be honest. Tags in hg are rather quirky, and the machine running the web interface is not running the latest hg release.

Not sure what we can do about this really I'm afraid.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 31 17:19:35 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 31 May 2013 17:19:35 +0100
Subject: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from
	rabbitmq-web-dispatch
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D33F56B@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D33F4C8@FR44EX3005.global.ds.honeywell.com>
	<51A8CA4C.6000204@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D33F56B@FR44EX3005.global.ds.honeywell.com>
Message-ID: <51A8CD97.6080609@rabbitmq.com>

On 31/05/13 17:15, Gotthard, Petr wrote:
> Well, I'm trying to run "make BRANCH=rabbitmq_v3_0_4 up_c" and it fails for rabbitmq-web-dispatch with an "unknown tag" error. It works, when I use rabbitmq_v3_1_0 instead.
>
> Should upgrade hg?

I would give it a try, that definitely works for me. (Using hg 2.5.4)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 31 17:21:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 31 May 2013 17:21:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ connection(s) Blocking !
In-Reply-To: <1370001597528-27113.post@n5.nabble.com>
References: <1370001597528-27113.post@n5.nabble.com>
Message-ID: <51A8CDEE.4040007@rabbitmq.com>

On 31/05/13 12:59, tluck wrote:
> I installed/configured RabbitMQ on multiple servers and for couple of weeks
> everything was working fine. But, recently while adding new messages to the
> queues I noticed a connection(s) blocking issue and when I ran `rabbitmqctl
> set_vm_memory_high_watermark 0.6` command then all servers start to work.
> Can anybody help me to know why I'd this issue on my servers ?

The memory alarm presumably went off; something was causing RabbitMQ's 
memory use to exceed 40% of the physical memory available. Normally we 
would expect memory use to drop after the alarm went off as messages are 
paged out / consumed, see http://www.rabbitmq.com/memory.html

> As I read
> somewhere this is a memory related issue. How could this be possible ?
> because queues were already empty  and I tried to add just 100 new messages
> into queues. which thing was consuming RMQ default allocated memory ?

See http://www.rabbitmq.com/memory-use.html for how to find out where 
memory is going in your Rabbit.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Fri May 31 17:27:36 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 May 2013 17:27:36 +0100
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <51A8CC8B.4090005@rabbitmq.com>
References: <8607A672AFB05B4D804456463DD7DCCF224CEDEC@008-AM1MPN1-043.mgdnok.nokia.com>
	<51A8CC8B.4090005@rabbitmq.com>
Message-ID: <51A8CF78.8020904@rabbitmq.com>

On 31/05/13 17:15, Simon MacMullen wrote:
> Check the logs for errors looking like:
>
> =ERROR REPORT==== 31-May-2013::17:12:33 ===
> closing AMQP connection <0.388.0> (127.0.0.1:40730 -> 127.0.0.1:5672):
> {handshake_error,starting,0,
>   {amqp_error,access_refused,
>               "PLAIN login refused: user 'user' - invalid credentials",
>               'connection.start_ok'}}
>
> or similar.

More likely "access to vhost 'sensu' refused for user 'sensu'". Well, 
that would be my guess anyway :)

Matthias.

From simon at rabbitmq.com  Fri May 31 17:32:57 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 31 May 2013 17:32:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
	<5199FB29.70306@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>
Message-ID: <51A8D0B9.7040200@rabbitmq.com>

Hi. The behaviour you describe doesn't really match what I would expect 
to see. In the beginning of a partition I would expect:

1) Partition starts

2) Things behave slowly for approximately net_ticktime (see 
http://www.rabbitmq.com/partitions.html#net_ticktime) as nodes attempt 
to contact each other and time out

3) On each node, Erlang decides the other nodes are down. Things speed 
up again, HA queues fail over. Split-brain has begun.

It sounds like you were stuck in 2) for an extended period of time. Have 
you changed net_ticktime?

Alternatively, when testing partitions I have see really odd behaviour 
by blocking network traffic in one direction only with iptables. You 
might want to check if you've done that by mistake.

Cheers, Simon

On 30/05/13 22:14, Maslinski, Ray wrote:
> Follow-up question ...
>
> I tried some experiments to gain some understanding of how the
> cluster behaved with clients attached during a network partition
> event.  Essentially, I repeated the previous tests described below
> for autohealing and automatic queue synchronization, but left the
> cluster communications port blocked while the client test completed.
> One oddity I noticed was that while the consumer connected to the
> slave appeared to receive an indication that something was amiss
> (client log showed a consumer cancel exception being handled by the
> Spring AMQP framework, and other monitoring logs appeared to show the
> client restarting a connection, which seems to be consistent with
> documentation), the consumer connected to the master seemed to remain
> oblivious to any possible issues.  That consumer continued to receive
> messages, but at an extremely slow rate (test published at 16/sec
> fixed rate, but the remaining consumer began to receive messages at
> the rate of about 1 every 14 seconds).
>
> Since the test client waits around for expected message deliveries
> with a resettable 30 second timeout, it continued to run for an
> extended period of time (longer than I waited around for).  In
> addition, the admin console showed a relatively small number of
> unacked messages on that server, with the unacked count increasing
> with each actual delivery (client should always be acknowledging in
> the test setup, and reported no errors).  Eventually unblocking the
> cluster port released a bunch of messages in a short interval (albeit
> with some lost, as described previously).
>
> I also saw  producer connections go into flow control during the
> outage and remain there during the slow consumer delivery (though the
> test had long since completed delivering all its messages).
>
> Does this sound like expected behavior during a partition?
>
> Ray Maslinski Senior Software Developer, Engineering Valassis /
> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
> www.valassis.com
>
> Creating the future of intelligent media delivery to drive your
> greatest success
>
> _____________________________________________________________________________
>
>  This message may include proprietary or protected information. If
> you are not the intended recipient, please notify me, delete this
> message and do not further communicate the information contained
> herein without my express consent.
>
> -----Original Message----- From: Simon MacMullen
> [mailto:simon at rabbitmq.com] Sent: Monday, May 20, 2013 6:30 AM To:
> Discussions about RabbitMQ Cc: Maslinski, Ray Subject: Re:
> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures
> when recovering from cluster partition
>
> On 17/05/13 20:38, Maslinski, Ray wrote:
>> Hello,
>
> Hi!
>
>> To simulate a network partition failure, I've been using iptables
>> to temporarily block inbound and outbound access on one of the
>> nodes to the single port configured for cluster communications
>> through inet_dist_listen_min and inet_dist_listen_max settings (min
>> = max). Client access is not blocked during a simulated partition
>> fault.
>
> Sounds reasonable.
>
>> I've observed two anomalies during testing that I wasn't expecting
>> based on the documentation I've read:
>>
>> -At a sufficiently high message rate, some number of messages will
>> be lost during the fault sequence, with the number lost tending to
>> increase with message rate.  No indication of a send error has
>> been observed by the client program. Based on results obtained from
>> test logs and an independent monitor listening on trace messages
>> from each node, it appears that as soon as the port is blocked,
>> both nodes continue to accept published messages, but (temporarily)
>> stop delivering messages until the cluster heartbeat failure is
>> detected, at which point the cluster is partitioned and the slave
>> promotes itself to become master. In the sequences I've looked at,
>> the messages that are lost all appear to be published to the
>> original master (and final master after a winner is selected during
>> autoheal).  Neither the start nor the end of the lost message
>> window appear to line up with any events in the logs, other than
>> the start occurring sometime after the port connection is blocked
>> but before the cluster heartbeat failure is detected, and the end
>> occurring sometime after the detection of the cluster heartbeat
>> failure and before the detection of the partitioned cluster after
>> the connection is unblocked.  Is message loss to be expected in
>> this scenario?
>
> I would expect to see message loss in a cluster heal scenario.
>
> It's important to remember that a cluster partition is still a
> substantial problem, and the healing process involves throwing state
> away. Autoheal mode just means you get through this process faster,
> and hopefully spend much less time accepting messages that will end
> up being lost.
>
> I would expect intuitively that only messages from the losing
> partitions would be lost. But I am not entirely surprised if messages
> from the winner are lost too; there is a period after the partitions
> have come back together but before autoheal kicks in during which we
> will have multiple masters for a queue, and behaviour can be
> unpredictable.
>
>> -Occasionally the autoheal loser node fails to rejoin the cluster
>> after restart.  I don't have a lot of data points on this one
>> since it's only happened a handful of times during overnight test
>> iterations.  During one failure, the autoheal winner showed the
>> log message below during recovery:
>
> Ah, that looks like a bug in autoheal. I think the stack trace you
> posted should contain enough information to fix it. Thanks.
>
> Cheers, Simon
>
> -- Simon MacMullen RabbitMQ, Pivotal
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From jincheker at gmail.com  Fri May 31 15:44:40 2013
From: jincheker at gmail.com (Steven Yue)
Date: Fri, 31 May 2013 07:44:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to start rabbitmq-server on a fresh
	installed server
Message-ID: <8c3b4908-9445-487e-a645-6d2951007821@googlegroups.com>

Hi, everyone

I'm trying to install rabbitmq-server on my VPS server. The server is 
running newly fresh installed Ubuntu 12.04, and the rabbitmq is installed 
from APT repository.

The console shows this information:

* Starting message broker rabbitmq-server
* FAILED - check /var/log/rabbitmq/startup_\{log, _err\}


And I check the log file, it shows this:

ERROR: node with name "rabbit" already running on "mydomain"

DIAGNOSTICS
===========

nodes in question: [rabbit@ mydomain]

hosts, their running nodes and ports:
- mydomain: [{rabbit,56948}]

current node details:
- node name: rabbitmqprelaunch5633@ mydomain
- home dir: /var/lib/rabbitmq
- cookie hash: AfrR2Uw6t3aBV6UMzo2KHA==

When I run 'ps aux | grep rabbit', I get this:

rabbitmq  5607  0.0  0.0   7416   316 ?        S    14:55   0:00 
/usr/lib/erlang/erts-5.8.5/bin/epmd -daemon

I tried to stop the server, by running:

sudo rabbitmqctl stop

And it show: Error: unable to connect to node rabbit@ mydomain: nodedown

I've tried to google this problem, and followed those instructions in the 
following posts, but still couldn't get any luck:
http://stackoverflow.com/questions/8737754/node-with-name-rabbit-already-running-but-also-unable-to-connect-to-node
http://stackoverflow.com/questions/10347751/rabbitmq-refusing-to-start

I want to know why this happens on a newly install server? And can anyone 
help me out to solve this?

Thanks

Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/968eb71d/attachment.htm>

From a2800276 at gmail.com  Fri May 31 16:01:59 2013
From: a2800276 at gmail.com (Tim Becker)
Date: Fri, 31 May 2013 17:01:59 +0200
Subject: [rabbitmq-discuss] reconfigure existing queue with dead letter
	exchange.
In-Reply-To: <51A78348.6050706@rabbitmq.com>
References: <8bc2f300-031f-4e52-951d-3059924fbc2c@googlegroups.com>
	<51A78348.6050706@rabbitmq.com>
Message-ID: <CAEUTYMtZMGpkV9+Dymmo+go82ehz=fRUFK+13XmRb2HgBipWNw@mail.gmail.com>

There are some queue parameters that can be modified after queue
> creation. Federation and mirrored queues can be controlled in this way.
> See http://www.rabbitmq.com/parameters.html
>
> A dead letter exchange can only be set during queue declaration. See
> http://www.rabbitmq.com/dlx.html for details.
>

Thanks very much!



>
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/f69d71af/attachment.htm>

From angry.gremlin at gmail.com  Fri May 31 17:19:04 2013
From: angry.gremlin at gmail.com (=?KOI8-R?B?+szPyiDn0sXNzMnO?=)
Date: Fri, 31 May 2013 19:19:04 +0300
Subject: [rabbitmq-discuss] Many fanout exchanges or fewer direct exchanges
	with routing keys
Message-ID: <CAGxVCqwmVBGa9TUAxr7dcdYSvvSeiF0n4bgpLawx10uOO9frLQ@mail.gmail.com>

Hi,

I've been trying to use RabbitMQ and faced the following question.

I need to intensively broadcast 10 types of messages (so there will be many
consumers for each message type) and each type has ~100 subtypes.

I wonder which of the following approaches is better:

   1.

   Create a direct exchange for each message type and send messages with a
   routing key (subtype name) and consumers will be connected  with a
   temporary queue. (Because there is no complex routing keys like
   'key1.key2.*' I decided not to use topic exchange).
   2.

   Create a fanout exchange for each message subtype (something around 1000
   exchanges).

Best regards,
Oleg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/f2d491bd/attachment.htm>

From Petr.Gotthard at Honeywell.com  Fri May 31 18:48:38 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Fri, 31 May 2013 17:48:38 +0000
Subject: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from
 rabbitmq-web-dispatch
In-Reply-To: <51A8CD97.6080609@rabbitmq.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D33F4C8@FR44EX3005.global.ds.honeywell.com>
	<51A8CA4C.6000204@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D33F56B@FR44EX3005.global.ds.honeywell.com>
	<51A8CD97.6080609@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D33F5F2@FR44EX3005.global.ds.honeywell.com>

Oh, noooo.

Upgraded to hg 2.6.1, trying "hg tags" in the rabbitmq-web-dispatch directory and still see no tags for 3.0.3, 3.0.4 and 3.1.1 (but see 3.1.0, so the repo is not outdated).

Tried on a different machine with hg 2.1.2: I can see 3.0.3 and 3.0.4 there, but no 3.1.1.

Other repos seem to be ok, the update fails only at the rabbitmq-web-dispatch.


Petr

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 31. kv?tna 2013 18:20
To: Gotthard, Petr
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from rabbitmq-web-dispatch

On 31/05/13 17:15, Gotthard, Petr wrote:
> Well, I'm trying to run "make BRANCH=rabbitmq_v3_0_4 up_c" and it fails for rabbitmq-web-dispatch with an "unknown tag" error. It works, when I use rabbitmq_v3_1_0 instead.
>
> Should upgrade hg?

I would give it a try, that definitely works for me. (Using hg 2.5.4)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From watson.timothy at gmail.com  Fri May 31 19:36:36 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 31 May 2013 19:36:36 +0100
Subject: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from
	rabbitmq-web-dispatch
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D33F5F2@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D33F4C8@FR44EX3005.global.ds.honeywell.com>
	<51A8CA4C.6000204@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D33F56B@FR44EX3005.global.ds.honeywell.com>
	<51A8CD97.6080609@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D33F5F2@FR44EX3005.global.ds.honeywell.com>
Message-ID: <D1055F2D-726A-47CD-8A1E-240F1C733A03@rabbitmq.com>

Some repos didn't get tagged properly during the release, but I don't think that was one of them. I'll double check when I'm in front of a terminal later though.

On 31 May 2013, at 18:48, "Gotthard, Petr" <Petr.Gotthard at Honeywell.com> wrote:

> Oh, noooo.
> 
> Upgraded to hg 2.6.1, trying "hg tags" in the rabbitmq-web-dispatch directory and still see no tags for 3.0.3, 3.0.4 and 3.1.1 (but see 3.1.0, so the repo is not outdated).
> 
> Tried on a different machine with hg 2.1.2: I can see 3.0.3 and 3.0.4 there, but no 3.1.1.
> 
> Other repos seem to be ok, the update fails only at the rabbitmq-web-dispatch.
> 
> 
> Petr
> 
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com] 
> Sent: 31. kv?tna 2013 18:20
> To: Gotthard, Petr
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from rabbitmq-web-dispatch
> 
> On 31/05/13 17:15, Gotthard, Petr wrote:
>> Well, I'm trying to run "make BRANCH=rabbitmq_v3_0_4 up_c" and it fails for rabbitmq-web-dispatch with an "unknown tag" error. It works, when I use rabbitmq_v3_1_0 instead.
>> 
>> Should upgrade hg?
> 
> I would give it a try, that definitely works for me. (Using hg 2.5.4)
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From MaslinskiR at valassis.com  Fri May 31 20:04:02 2013
From: MaslinskiR at valassis.com (Maslinski, Ray)
Date: Fri, 31 May 2013 19:04:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <51A8D0B9.7040200@rabbitmq.com>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
	<5199FB29.70306@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>
	<51A8D0B9.7040200@rabbitmq.com>
Message-ID: <7F7BFE76D0F5234F9258D88C37C9EC6B151F43A4@VALVCSMBX001PH.val.vlss.local>

The net_ticktime is using the default value, and event sequence seems consistent with the associated timeout.

Roughly,

Start test

Block cluster connection at some point -> trace data shows that only publish events are occurring after this happens

After a bit more than a minute, RabbitMQ server log shows lost cluster connection on both nodes, along with the death of the mirrors and promotion of slave to master.

Test continues and completes publish phase, since these appeared to be progressing normally, with no errors visible to client

Test then starts to verify that all messages were received by polling the contents of a buffer used to store incoming messages.  In a normal scenario without faults, this generally means that the first poll finds all the messages expected to be present and test completes successfully.  Otherwise, the poll rechecks for any missing messages once per second, and gives up if 30 seconds elapse without any new messages showing up (timer is reset if any messages arrived during polling window).

The slow trickle of messages occurs during the last phase, as one appears to arrive every 14 seconds and the polling loop continues to retry.  Trace data doesn't appear to log any deliver events during this stage, but console shows a slow increment in the number of unacknowledged messages that lines up with the delivery rate observed by the client.

Ray Maslinski
Senior Software Developer, Engineering
Valassis / Digital Media
Cell: 585.330.2426
maslinskir at valassis.com
www.valassis.com

Creating the future of intelligent media delivery to drive your greatest success

_____________________________________________________________________________

This message may include proprietary or protected information. If you are not the intended?
recipient, please notify me, delete this message and do not further communicate the information?
contained herein without my express consent.


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Friday, May 31, 2013 12:33 PM
To: Maslinski, Ray
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures when recovering from cluster partition

Hi. The behaviour you describe doesn't really match what I would expect to see. In the beginning of a partition I would expect:

1) Partition starts

2) Things behave slowly for approximately net_ticktime (see
http://www.rabbitmq.com/partitions.html#net_ticktime) as nodes attempt to contact each other and time out

3) On each node, Erlang decides the other nodes are down. Things speed up again, HA queues fail over. Split-brain has begun.

It sounds like you were stuck in 2) for an extended period of time. Have you changed net_ticktime?

Alternatively, when testing partitions I have see really odd behaviour by blocking network traffic in one direction only with iptables. You might want to check if you've done that by mistake.

Cheers, Simon

On 30/05/13 22:14, Maslinski, Ray wrote:
> Follow-up question ...
>
> I tried some experiments to gain some understanding of how the cluster 
> behaved with clients attached during a network partition event.  
> Essentially, I repeated the previous tests described below for 
> autohealing and automatic queue synchronization, but left the cluster 
> communications port blocked while the client test completed.
> One oddity I noticed was that while the consumer connected to the 
> slave appeared to receive an indication that something was amiss 
> (client log showed a consumer cancel exception being handled by the 
> Spring AMQP framework, and other monitoring logs appeared to show the 
> client restarting a connection, which seems to be consistent with 
> documentation), the consumer connected to the master seemed to remain 
> oblivious to any possible issues.  That consumer continued to receive 
> messages, but at an extremely slow rate (test published at 16/sec 
> fixed rate, but the remaining consumer began to receive messages at 
> the rate of about 1 every 14 seconds).
>
> Since the test client waits around for expected message deliveries 
> with a resettable 30 second timeout, it continued to run for an 
> extended period of time (longer than I waited around for).  In 
> addition, the admin console showed a relatively small number of 
> unacked messages on that server, with the unacked count increasing 
> with each actual delivery (client should always be acknowledging in 
> the test setup, and reported no errors).  Eventually unblocking the 
> cluster port released a bunch of messages in a short interval (albeit 
> with some lost, as described previously).
>
> I also saw  producer connections go into flow control during the 
> outage and remain there during the slow consumer delivery (though the 
> test had long since completed delivering all its messages).
>
> Does this sound like expected behavior during a partition?
>
> Ray Maslinski Senior Software Developer, Engineering Valassis / 
> Digital Media Cell: 585.330.2426 maslinskir at valassis.com 
> www.valassis.com
>
> Creating the future of intelligent media delivery to drive your 
> greatest success
>
> ______________________________________________________________________
> _______
>
>  This message may include proprietary or protected information. If you 
> are not the intended recipient, please notify me, delete this message 
> and do not further communicate the information contained herein 
> without my express consent.
>
> -----Original Message----- From: Simon MacMullen 
> [mailto:simon at rabbitmq.com] Sent: Monday, May 20, 2013 6:30 AM To:
> Discussions about RabbitMQ Cc: Maslinski, Ray Subject: Re:
> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures 
> when recovering from cluster partition
>
> On 17/05/13 20:38, Maslinski, Ray wrote:
>> Hello,
>
> Hi!
>
>> To simulate a network partition failure, I've been using iptables to 
>> temporarily block inbound and outbound access on one of the nodes to 
>> the single port configured for cluster communications through 
>> inet_dist_listen_min and inet_dist_listen_max settings (min = max). 
>> Client access is not blocked during a simulated partition fault.
>
> Sounds reasonable.
>
>> I've observed two anomalies during testing that I wasn't expecting 
>> based on the documentation I've read:
>>
>> -At a sufficiently high message rate, some number of messages will be 
>> lost during the fault sequence, with the number lost tending to 
>> increase with message rate.  No indication of a send error has been 
>> observed by the client program. Based on results obtained from test 
>> logs and an independent monitor listening on trace messages from each 
>> node, it appears that as soon as the port is blocked, both nodes 
>> continue to accept published messages, but (temporarily) stop 
>> delivering messages until the cluster heartbeat failure is detected, 
>> at which point the cluster is partitioned and the slave promotes 
>> itself to become master. In the sequences I've looked at, the 
>> messages that are lost all appear to be published to the original 
>> master (and final master after a winner is selected during autoheal).  
>> Neither the start nor the end of the lost message window appear to 
>> line up with any events in the logs, other than the start occurring 
>> sometime after the port connection is blocked but before the cluster 
>> heartbeat failure is detected, and the end occurring sometime after 
>> the detection of the cluster heartbeat failure and before the 
>> detection of the partitioned cluster after the connection is 
>> unblocked.  Is message loss to be expected in this scenario?
>
> I would expect to see message loss in a cluster heal scenario.
>
> It's important to remember that a cluster partition is still a 
> substantial problem, and the healing process involves throwing state 
> away. Autoheal mode just means you get through this process faster, 
> and hopefully spend much less time accepting messages that will end up 
> being lost.
>
> I would expect intuitively that only messages from the losing 
> partitions would be lost. But I am not entirely surprised if messages 
> from the winner are lost too; there is a period after the partitions 
> have come back together but before autoheal kicks in during which we 
> will have multiple masters for a queue, and behaviour can be 
> unpredictable.
>
>> -Occasionally the autoheal loser node fails to rejoin the cluster 
>> after restart.  I don't have a lot of data points on this one since 
>> it's only happened a handful of times during overnight test 
>> iterations.  During one failure, the autoheal winner showed the log 
>> message below during recovery:
>
> Ah, that looks like a bug in autoheal. I think the stack trace you 
> posted should contain enough information to fix it. Thanks.
>
> Cheers, Simon
>
> -- Simon MacMullen RabbitMQ, Pivotal
>


--
Simon MacMullen
RabbitMQ, Pivotal

From john.hayden at nokia.com  Fri May 31 20:40:57 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Fri, 31 May 2013 19:40:57 +0000
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <51A8CF78.8020904@rabbitmq.com>
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224CF1B1@008-AM1MPN1-043.mgdnok.nokia.com>

OK but both Rabbits have clients connecting to them that are using sense
as a user to connect to the vhost sensu.
Therefore the only difference here is that shovel, acting VERY similar to
a client is NOT connecting with the same credentials either on the local
non network side or the remote network connection. Neither of which makes
sense to me.

On 5/31/13 12:27 PM, "ext Matthias Radestock" <matthias at rabbitmq.com>
wrote:

>On 31/05/13 17:15, Simon MacMullen wrote:
>> Check the logs for errors looking like:
>>
>> =ERROR REPORT==== 31-May-2013::17:12:33 ===
>> closing AMQP connection <0.388.0> (127.0.0.1:40730 -> 127.0.0.1:5672):
>> {handshake_error,starting,0,
>>   {amqp_error,access_refused,
>>               "PLAIN login refused: user 'user' - invalid credentials",
>>               'connection.start_ok'}}
>>
>> or similar.
>
>More likely "access to vhost 'sensu' refused for user 'sensu'". Well,
>that would be my guess anyway :)
>
>Matthias.
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From john.hayden at nokia.com  Fri May 31 20:42:48 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Fri, 31 May 2013 19:42:48 +0000
Subject: [rabbitmq-discuss] rabbitmq-shovel issues [for hyperthunk]
In-Reply-To: <365842DA-5C21-45E4-85EF-0FF433E0C3C1@rabbitmq.com>
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224CF1E4@008-AM1MPN1-043.mgdnok.nokia.com>

Yes I did and reposted under a "new" thread (not used to mailing lists)
called [rabbitmq-discuss] Shovel authentication question (possible bug)

On 5/31/13 10:29 AM, "ext Tim Watson" <tim at rabbitmq.com> wrote:

>Hi John,
>
>Did you try Matthias' suggestions out? Are you still struggling with
>this? It'd be good to get you past these hurdles since I know you've been
>trying to get this to work for quite some time now.
>
>Cheers,
>Tim (aka hyperthunk)
>
>On 30 May 2013, at 21:58, Matthias Radestock wrote:
>
>> On 30/05/13 21:35, john.hayden at nokia.com wrote:
>>> I have 2 Rabbits running on 2 different ec2 instances in AWS
>>> Rabbit1 has had a Shovel plugin installed in order to send messages to
>>> Rabbit2
>>> These Rabbits are being used for a Sensu monitoring network
>>> The Sensu server is in the same region as Rabbit1
>>> When a message is sent by Sensu to Rabbit1 it fansout to all connected
>>> queues (maybe the wrong terminology here), including one called
>>>us-west-2
>>> The Shovel is supposed to pick up messages from us-west-2 and forward
>>>it
>>> to Rabbit2
>>> Later on I will add other queues to forward to other Rabbits
>>> 
>>> As I try this setup, I seem to timeout on a connection and I don't
>>>know why.
>>> 
>>> Here is a gist of what is going on:
>>>https://gist.github.com/jhhayden/5679708
>> 
>> Have you checked the obvious, i.e. whether the Rabbit1 machine can
>>connect to both endpoints? In particular, on Rabbit1 run
>> 
>> telnet 54.243.157.166 5672
>> 
>> and then type AMQPxx<return>
>> 
>> This should reply with 'AMQP<somestuff>' and close the connection.
>> 
>> Then try the same for the other connection, i.e. 'telnet 54.245.126.50
>>5672'.
>> 
>> Also, it's worth checking the rabbit logs on both brokers for
>>connection attempts and errors.
>> 
>> 
>> A few other points...
>> 
>> - you say that the shovel is running on rabbit1 and shovelling to
>>rabbit2. That means it would be better to use a direct connection to
>>rabbit1 instead of a network connection. From
>>http://www.rabbitmq.com/shovel.html#configuration "If the [URI] host is
>>omitted [...] the shovel uses a direct connection to the broker in which
>>it is running. This avoids using the network stack.". In addition to
>>better performance, direct connections are not affected by network
>>issues, which should make it easier to debug the problem you are seeing.
>> 
>> - there's no need to specify the port 5672 in the URI since that is the
>>default
>> 
>> Regards,
>> 
>> Matthias.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Fri May 31 22:31:56 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 May 2013 22:31:56 +0100
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <8607A672AFB05B4D804456463DD7DCCF224CF1B1@008-AM1MPN1-043.mgdnok.nokia.com>
References: <8607A672AFB05B4D804456463DD7DCCF224CF1B1@008-AM1MPN1-043.mgdnok.nokia.com>
Message-ID: <51A916CC.8000304@rabbitmq.com>

John,

On 31/05/13 20:40, john.hayden at nokia.com wrote:
> OK but both Rabbits have clients connecting to them that are using sense
> as a user to connect to the vhost sensu.
> Therefore the only difference here is that shovel, acting VERY similar to
> a client is NOT connecting with the same credentials either on the local
> non network side or the remote network connection. Neither of which makes
> sense to me.

Simon and I were just guessing what error might appear in the logs. 
Please check what error is *actually* being recorded.

Matthias

From matthias at rabbitmq.com  Fri May 31 23:01:00 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 May 2013 23:01:00 +0100
Subject: [rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from
	rabbitmq-web-dispatch
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D33F5F2@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D33F4C8@FR44EX3005.global.ds.honeywell.com>
	<51A8CA4C.6000204@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D33F56B@FR44EX3005.global.ds.honeywell.com>
	<51A8CD97.6080609@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D33F5F2@FR44EX3005.global.ds.honeywell.com>
Message-ID: <51A91D9C.3010603@rabbitmq.com>

Petr,

On 31/05/13 18:48, Gotthard, Petr wrote:
> trying "hg tags" in the rabbitmq-web-dispatch
> directory and still see no tags for 3.0.3, 3.0.4 and 3.1.1

Well spotted. Fixed.

Looks like a merge that had gone bad.

Compare

http://hg.rabbitmq.com/rabbitmq-web-dispatch/rev/88b1f30ff06d

(the bad merge)

with

http://hg.rabbitmq.com/rabbitmq-web-dispatch/rev/61f9b13d650d

(the merge I just did, which has the same parents, but notably contains 
a change to the .hgtags file)

Regards,

Matthias.

From joe.vandermark at gmail.com  Fri May 31 20:30:33 2013
From: joe.vandermark at gmail.com (Joe Vandermark)
Date: Fri, 31 May 2013 12:30:33 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ monitoring app shows load balancer
 IP instead of client IP
In-Reply-To: <abdd0428-6c47-427d-9c14-9efc7b7e2193@googlegroups.com>
References: <abdd0428-6c47-427d-9c14-9efc7b7e2193@googlegroups.com>
Message-ID: <2ab116e2-c718-4262-8ea8-9dacaabf1b8a@googlegroups.com>

I have a similar issue/requirement. Checking in to see if Mike figured this 
out or if anyone else has a similar need and solution.

On Monday, January 7, 2013 11:40:39 AM UTC-6, Mike wrote:
>
> I have a rabbitMQ cluster running on EC2 behind an AWS load-balancer. In 
> the rabbitMQ monitoring app, it shows the IP address of each machine that's 
> currently connected to rabbitMQ. Since the clients are hitting rabbitMQ 
> through the LB, it's showing the LBs IP address, instead of the client.
>
> Is there a way to get the rabbitMQ monitoring plugin to show the 
> x-forwarded-for request header, which contains the actual client IP address?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/a4128f15/attachment.htm>

From john.hayden at nokia.com  Fri May 31 23:50:27 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Fri, 31 May 2013 22:50:27 +0000
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <51A916CC.8000304@rabbitmq.com>
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224CF3D6@008-AM1MPN1-043.mgdnok.nokia.com>

Matthias,

  I hope that post didn't come across as strident or angry. I wasn't. I
was just trying to add emphasis to certain parts of the post. In the first
post, I did post the error from the rabbit log. Is there anything else I
can post to be more helpful?

Thanks again

John Hayden

On 5/31/13 5:31 PM, "ext Matthias Radestock" <matthias at rabbitmq.com> wrote:

>John,
>
>On 31/05/13 20:40, john.hayden at nokia.com wrote:
>> OK but both Rabbits have clients connecting to them that are using sense
>> as a user to connect to the vhost sensu.
>> Therefore the only difference here is that shovel, acting VERY similar
>>to
>> a client is NOT connecting with the same credentials either on the local
>> non network side or the remote network connection. Neither of which
>>makes
>> sense to me.
>
>Simon and I were just guessing what error might appear in the logs.
>Please check what error is *actually* being recorded.
>
>Matthias


