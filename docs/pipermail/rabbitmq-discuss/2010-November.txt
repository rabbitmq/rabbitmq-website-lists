From david_syer at hotmail.com  Mon Nov  1 00:47:09 2010
From: david_syer at hotmail.com (Dave Syer)
Date: Sun, 31 Oct 2010 17:47:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Missing features making me look at moving
	off RabbitMQ
In-Reply-To: <4CCB790F.3000106@rabbitmq.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
	<4CCB790F.3000106@rabbitmq.com>
Message-ID: <bac4fc6c-b9b9-42c7-a7ed-7967f75c56d2@t13g2000yqm.googlegroups.com>



On Oct 29, 6:46?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> We are working on better and more integrated HA. Meanwhile, the
> instructions for the existing active/passive HA may look a bit
> daunting, but it's actually not that hard to set up.

I also found the existing HA guide rather hard going.  I suppose that
doesn't help much, but it's good to share the pain sometimes.

I think I would probably want to try and have the hypervisor deal with
HA (e.g. shadow VMs in vSphere).

> > -- Support custom authentication schemes <e.g. LDAP>

Spring Security and Spring Integration already work together (and LDAP
is a dime a dozen for Spring Security users), so Spring AMQP with
Spring Integration might provide a nice high-level wrapper for this.

> > -- Support message-level permissions
> That sounds like a pretty hard problem. Are there any messaging systems
> out there that do something close to what you need here?

Spring Security is pretty good for that kind of requirement also. We
could try it pretty soon once Spring AMQP and Spring Integration get
properly synched up (should be any time, now that Spring Integration
2.0 is getting close to final).

Dave.

From simon at rabbitmq.com  Mon Nov  1 10:56:01 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 01 Nov 2010 10:56:01 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
References: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <4CCE9CC1.7060200@rabbitmq.com>

On 30/10/10 01:13, Michael Vierling wrote:
> We're developing a Splunk plugin for RabbitMQ.  Splunk is an excellent
> log search engine and we highly recommend it. Anyway, while Splunk can
> ingest almost any log files, it prefers a key-value pair format. You can
> see this page for more details:
>
> http://www.splunk.com/wiki/Apps:Common_Information_Model
>
> So in that spirit, I'd like to propose the following patch to the
> rabbitmqadmin script, which ships with your management 2.1.1 plugin.
> This patch adds a key-value pair Splunk compatible option (kvp) to the
> script. It would be very helpful if this could be incorporated into the
> official Management plugin.

<snip>

Hi Michael.

First of all, it's nice to know someone's using rabbitmqadmin - I think 
you're the first to ask about it...

In order to accept your patch, I'd need to get you to sign our 
contributor agreement (yes, even for something this small). Or I could 
reimplement it; that might be easier.

But before that, can we clear up a few issues:

* I'd like to not call it kvp since it's really timestamp - key/value, 
which seems quite Splunk-specific.
* I hadn't thought of using rabbitmqadmin to generate log files. I 
assume the idea is to provide historic data for trends etc. Does Splunk 
always work like this?
* How do quotes (and non-ASCII characters) need to be escaped? The link 
does not explain.
* I assume you're not proposing to use any of the "standard fields"?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jiri at krutil.com  Mon Nov  1 12:22:44 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Mon, 01 Nov 2010 13:22:44 +0100
Subject: [rabbitmq-discuss] Protection against slow consumers
Message-ID: <20101101132244.100175927nswe1wk@webmail.active24.cz>

Hello together

I'm looking for a way how to protect against slow consumers.

We are publishing messages to a topic exchange as part of a public  
interface. The subscribers are applications developed by our clients  
(outside of our control).

Our concern is that one slow consumer could potentially force the  
broker to throttle our publisher, affecting all other consumers.

We encourage the consumers to use a small prefetch buffer, but have no  
way how to enforce this. In general, we cannot assume that all  
consumers cooperate.

For instance, a client that is consuming but not acking will (I  
believe) impact the broker memory consumption.

Your ideas are welcome.

Cheers
Jiri Krutil
Deutsche Boerse Systems AG


From elubisse at sportingindex.com  Mon Nov  1 11:58:39 2010
From: elubisse at sportingindex.com (Eric@SPIN)
Date: Mon, 1 Nov 2010 04:58:39 -0700 (PDT)
Subject: [rabbitmq-discuss]  Why do I get unackowledged messages?
Message-ID: <30104183.post@talk.nabble.com>


This question may have an obvious answer but I don't know what it is. I've
got about 10 queues on an exchange. I'm enqueing/dequeing via the .NET
client version 2.1.1.0. The behaviour that i'm seeing is that messages stay
in the unacknowledged queue for long (and seemingly random) periods of time.
The system is not under any significant load. For some of the queues the
messages are eventually processed for others they remain for hours. I use
the same code for all the queues. What could be going wrong?
-- 
View this message in context: http://old.nabble.com/Why-do-I-get-unackowledged-messages--tp30104183p30104183.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexandru at rabbitmq.com  Mon Nov  1 13:10:45 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 1 Nov 2010 13:10:45 +0000
Subject: [rabbitmq-discuss] Is the "master" node mandatory ?
In-Reply-To: <4CBE9802.20300@ubikod.com>
References: <4CBD991B.3080704@ubikod.com> <20101019131405.GE6803@rabbitmq.com>
	<4CBDC73F.4080301@ubikod.com> <20101019163516.GM6803@rabbitmq.com>
	<4CBE9802.20300@ubikod.com>
Message-ID: <20101101131045.GA2628@dakota.eng.vmware.com>

> To summarize, the list of exchanges and queues are recreated at 
> reconnection time by producers and consumers, thus, the "state" of 
> the cluster can be lost. That's why I think we can use RAM node 
> only. But maybe the "state" of the cluster is not limited to the 
> list of exchanges and queues ?

The "state" of the cluster is just the names of the nodes currently in
the cluster and the queues/exchanges declared on said nodes.

All nodes, whether ram or disc record the names of the other nodes in
the cluster, so even ram nodes will rejoin the cluster when restarted.

Ram nodes don't store most of their mnesia tables on disk, so they won't
remember queues/exchanges/messages on restart.

Your scenario seems fine: if you don't mind having to redeclare
queues/exchanges on every use and losing messages on node failure, using
a cluster of all ram nodes is ok.


Also, sorry for the late reply.


Cheers,
Alex

On Wed, Oct 20, 2010 at 09:19:30AM +0200, Vincent Barat wrote:
>   Thank you for this long reply, I was not aware about that.
> 
> In our use case, all queues are not persistent. Thus, when a node 
> fails, all messages of all queues it handles are lost (since 
> messages are not replicated between nodes).
> This situation is ok for us (anyway there is nothing we can do to 
> prevent this, except to upgrade to RabbitMQ 2.0 with persistent 
> queues, something we plan to do, but throughput being our main 
> concern, we need to benchmark it first).
> 
> For the moment, what we must ensure is not to lose the global list 
> of exchanges declared by producers on node failure.
> AFAIK, this list is maintained in mnesia. If all nodes fails, 
> because they are all RAM nodes, we lose this exchange list. But in 
> that case, producers would recreate all exchange at reconnection 
> time, whatever the node that is restarted first.
> 
> To summarize, the list of exchanges and queues are recreated at 
> reconnection time by producers and consumers, thus, the "state" of 
> the cluster can be lost. That's why I think we can use RAM node 
> only. But maybe the "state" of the cluster is not limited to the 
> list of exchanges and queues ?
> 
> 
> Le 19/10/10 18:35, Matthew Sackman a ?crit :
> > On Tue, Oct 19, 2010 at 06:28:47PM +0200, Vincent Barat wrote:
> >> My two nodes are RAM nodes actually.
> > Ahh. From http://rabbitmq.com/clustering.html:
> >
> > "Because state is replicated across all nodes in the cluster, it is
> > sufficient to have just one disk node within a cluster, to store the
> > state of the cluster safely. Beware, however, that RabbitMQ will not
> > stop you from creating a cluster with only RAM nodes. Should you do
> > this, and suffer a power failure to the entire cluster, the entire state
> > of the cluster, including all messages, will be lost."
> >
> > I think we used to prevent you from building RAM-node-only clusters. We
> > must have changed behaviour there a while ago. It makes sense that the
> > last node to die needs to be brought up first: if a node goes down and
> > it knew that it was part of a cluster, then when coming back up, it'll
> > remember it was part of a cluster and try to reconnect to it - it will
> > be very aware that any data it holds (in this case, none!) will likely
> > be out of date and it needs to resync from the other nodes in the
> > cluster - it'll have no knowledge that the other nodes also went down.
> >
> > That said, it's been a while since I played around with clusters so my
> > information might be out of date.
> >
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jon.brisbin at npcinternational.com  Mon Nov  1 13:42:49 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 1 Nov 2010 08:42:49 -0500
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <AANLkTikrmpnkV8p8Bpzh6ytjUzuqU9e+F4PPj0SDEYkp@mail.gmail.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>
	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>
	<AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>
	<90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>
	<AANLkTikrmpnkV8p8Bpzh6ytjUzuqU9e+F4PPj0SDEYkp@mail.gmail.com>
Message-ID: <26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>


On Oct 30, 2010, at 3:28 AM, Kshitiz Garg wrote:

> Now if I use a HA proxy and have independent RabbitMQs sitting behind
> that proxy, how will that be different from using a HA proxy and have
> clustered RabbitMQs sitting behind that proxy. What is that these
> clustered RabbitMQs have in common?  Actually I want to understand
> "clustering" in this regard.

If the brokers aren't clustered, your individual RabbitMQ brokers won't share users, exchanges, queues, or any other resource. I'm not sure how that affects applications because I haven't tried it. I suspect it wouldn't work very well with round-robin load balancing because consumers might get connected to a different broker than the producers.

If you're using only the failover configuration, though, it would be better. You'd just have to reestablish all your Channels if one of them gets disconnected, assuming the next connection will go to the other broker.

"Clustered" RabbitMQ brokers look the same no matter which actual broker you contact. Messages delivered to one broker will be delivered to consumers on another broker. Without this clustering, you have to create some kind of store-and-forward (maybe using the shovel plugin) or your application has to manage that itself.

If your brokers are clustered, upgrading versions of the broker is, in my experience, fragile. Every version upgrade I've done (we're running it on Ubuntu Linux) results in a dead broker that has to be manually restarted. I've also had to re-configure the broker back into the cluster more times than I'd like. 

<soapbox>
The broker upgrade process could use some attention, IMHO. The broker should restart after upgrades without manual intervention and new versions should ALWAYS be able to migrate data so I don't have to reconfigure all my users and clustering configuration.
</soapbox>

jb


> 
> Thanks,
> Kshitiz Garg
> 
> 
> On Fri, Oct 29, 2010 at 7:12 PM, Jon Brisbin
> <jon.brisbin at npcinternational.com> wrote:
>> 
>> On Oct 29, 2010, at 8:31 AM, Kshitiz Garg wrote:
>> 
>>> Should I refer to "RabbitMQ High Availability Guide" for setting up a
>>> system like yours?
>> 
>> It's certainly a good idea to read that guide. But I'm using an intentionally simplistic setup that follows the transcript here:
>> 
>> http://www.rabbitmq.com/clustering.html#creating
>> 
>> 
>>> does "haproxy" automatically decides the routing of
>>> the message depending on the availability of rabbitMQ instances
>>> sitting behind this ?
>> 
>> Sort of. HAProxy is a TCP/IP "traffic cop". It knows nothing about the contents of the packets it proxies. It simply knows whether or not any of the configured backends is alive and able to receive data.
>> 
>> Maybe a better way to say it is that it decides the routing of the TCP traffic to the broker. It knows nothing about messages.
>> 
>> http://haproxy.1wt.eu/
>> 
>> I'm also using a "best effort" approach. I'm not going to get my britches in a wrinkle if my broker goes down for a few minutes (or a few hours ;) until I get it fixed. I recognize others don't have that luxury.
>> 
>> jb
>> 
>> 
>> 
>>> 
>>> Regards,
>>> Kshitiz
>>> 
>>> On Fri, Oct 29, 2010 at 6:39 PM, Jon Brisbin
>>> <jon.brisbin at npcinternational.com> wrote:
>>>> 
>>>> Do you want failover or clustering (or both)?
>>>> I use both. I have haproxy as a TCP proxy that sits in front of the RabbitMQ servers and acts as a failover and load balancer mechanism.
>>>> Behind the proxy are clustered RabbitMQ instances, which means they use the standard RabbitMQ clustering mechanism and have the same queues, exchanges, and whatnot on each box.
>>>> I then use Spring AMQP to connect to the *proxy*, who decides which of the RabbitMQ instances I actually get connected to.
>>>> 
>>>> Jon Brisbin
>>>> Portal Webmaster
>>>> NPC International, Inc.
>>>> 
>>>> On Oct 29, 2010, at 1:27 AM, Kshitiz Garg wrote:
>>>> 
>>>> Hi,
>>>> 
>>>> I have just started working with RabbitMQ for my cloud messaging/eventing application. The proof of concept worked well with rabbitMQ and Spring AMQP. Now, I want to start preparing for scalability.
>>>> I am able to setup a rabbitMQ cluster with 2 rabbitMQs installed on 2 separate machines. Now I want to know what is achieved by "clustering" in terms of rabbitMQ.
>>>> 
>>>> My spring amqp template has been given a connection Factory like this:
>>>> 
>>>>     <!-- RabbitMQ configurations -->
>>>>     <!-- Define a connectionFactory -->
>>>>     <bean id="connectionFactory"
>>>>         class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
>>>>         <constructor-arg value="localhost" />
>>>>         <property name="username" value="guest" />
>>>>         <property name="password" value="guest" />
>>>>     </bean>
>>>> 
>>>>     <!-- Configure the admin class -->
>>>>     <bean id="amqpAdmin" class="org.springframework.amqp.rabbit.core.RabbitAdmin">
>>>>         <constructor-arg ref="connectionFactory" />
>>>>     </bean>
>>>> 
>>>> Here I have specified localhost, so now, if I send a amqp message through rabbitMQ and this localhost broker is not up, will that message go through its cluster node automatically ?
>>>> 
>>>> If that's the case, then what do we mean by high availability?
>>>> 
>>>> Thanks,
>>>> Kshitiz Garg
>>>> 
>>>> 
>>>> 
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> 
>>>> 
>> 
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> 
>> 
>> 


Jon Brisbin
Portal Webmaster
NPC International, Inc.




From simon at rabbitmq.com  Mon Nov  1 13:47:12 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 01 Nov 2010 13:47:12 +0000
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>	<AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>	<90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>	<AANLkTikrmpnkV8p8Bpzh6ytjUzuqU9e+F4PPj0SDEYkp@mail.gmail.com>
	<26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>
Message-ID: <4CCEC4E0.9000009@rabbitmq.com>

On 01/11/10 13:42, Jon Brisbin wrote:
> <soapbox> The broker upgrade process could use some attention, IMHO.
> The broker should restart after upgrades without manual intervention
> and new versions should ALWAYS be able to migrate data so I don't
> have to reconfigure all my users and clustering configuration.
> </soapbox>

We're working on it. It's very likely 2.0.0 -> 2.1.0 will be the last 
such reconfiguration-requiring upgrade.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Mon Nov  1 13:51:09 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 01 Nov 2010 13:51:09 +0000
Subject: [rabbitmq-discuss] Lose messages between restarts of broker
In-Reply-To: <5D226D9E05A7E342B774D1881408C3EB013B4B5B56@34093-MBX-C15.mex07a.mlsrvr.com>
References: <AANLkTi=HnKQgcTJ=nNQw3Kj66pbBp5XY5Br9_Dz8637o@mail.gmail.com>	<20101027222357.GC18601@wellquite.org>
	<5D226D9E05A7E342B774D1881408C3EB013B4B5B56@34093-MBX-C15.mex07a.mlsrvr.com>
Message-ID: <4CCEC5CD.4020701@rabbitmq.com>


Hi Rudi,

Op 28/10/2010 19:50, het Rudi Wirth geskryf:
>> If you really need messages to go safely to disk, then you should
>> put the channel into transactional mode (tx.select), and issue a
>> tx.commit
>
> What about unacknowledged messages?
>
> A Producer (rabbit 2.1.1 java client, not Spring Rabbit AMQP) commits
> some persistent messages on a durable queue/exchange.
>
> The Consumer is neither ack'ing nor rejecting the message to leave it
> on the queue (and let recovery retry it later), but I am committing
> periodically, e.g.:
>
> QueueingConsumer.Delivery delivery = consumer.nextDelivery(); //
> neither channel.basicReject or Ack channel.txCommit();
>
> Per ctl:
>
> $ rabbitmqctl list_queues name messages messages_unacknowledged
> messages_ready Listing queues ... testQueue       5       5       0
>
> Using a soft "rabbitmqctl stop", a Broker restart will make the
> unacknowledged messages ready again (as expected). testQueue       5
> 0       5
>
> With a Broker hardkill, the unack'd messages disappear. testQueue
> 0       0       0
>
> For our implementation, I was going to rely on unacknowledged
> messages, flow control (qos) and periodic channel.basicRecover() to
> implement a crude, controlled "delayed retry" behavior, without using
> a temporary parking queue or application-provided intermediate
> storage. Not that anyone would kill the broker but is there a way to
> flush unack'd messages to disk?

The advice that Matthew gave applies to unacknowledged message too. If 
the publisher commits on a transacted channel then persistent messages 
in a durable queue are guaranteed to be on disk up to the point when 
they get removed from the queue. This includes any period that messages 
spend in an unacknowledged state.

In your example, had the publisher made the channel transactional and 
committed the messages, all unacknowledged messaged would be in the 
ready list after a hardkill.

There is no direct way for a consumer to affect the persistence of a 
published message other than to republish it as a new message with 
different parameters.

Regards

Emile

From emile at rabbitmq.com  Mon Nov  1 14:12:44 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 01 Nov 2010 14:12:44 +0000
Subject: [rabbitmq-discuss] Why do I get unackowledged messages?
In-Reply-To: <30104183.post@talk.nabble.com>
References: <30104183.post@talk.nabble.com>
Message-ID: <4CCECADC.5030305@rabbitmq.com>


Hi Eric,

Op 01/11/2010 11:58, het Eric at SPIN geskryf:
>
> This question may have an obvious answer but I don't know what it is. I've
> got about 10 queues on an exchange. I'm enqueing/dequeing via the .NET
> client version 2.1.1.0. The behaviour that i'm seeing is that messages stay
> in the unacknowledged queue for long (and seemingly random) periods of time.
> The system is not under any significant load. For some of the queues the
> messages are eventually processed for others they remain for hours. I use
> the same code for all the queues. What could be going wrong?

The most likely cause is that consumers are not acknowledging messages. 
You could set the noAck flag when consuming messages or call the 
BasicAck() method after processing a message.

Regards

Emile

From simon at rabbitmq.com  Mon Nov  1 14:45:00 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 01 Nov 2010 14:45:00 +0000
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <4CCEC4E0.9000009@rabbitmq.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>	<AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>	<90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>	<AANLkTikrmpnkV8p8Bpzh6ytjUzuqU9e+F4PPj0SDEYkp@mail.gmail.com>	<26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>
	<4CCEC4E0.9000009@rabbitmq.com>
Message-ID: <4CCED26C.5000507@rabbitmq.com>

On 01/11/10 13:47, Simon MacMullen wrote:
> On 01/11/10 13:42, Jon Brisbin wrote:
>> <soapbox> The broker upgrade process could use some attention, IMHO.
>> The broker should restart after upgrades without manual intervention
>> and new versions should ALWAYS be able to migrate data so I don't
>> have to reconfigure all my users and clustering configuration.
>> </soapbox>
>
> We're working on it. It's very likely 2.0.0 -> 2.1.0 will be the last
> such reconfiguration-requiring upgrade.

Oops, got slightly ahead of myself there. What we're currently working 
on only works in the single-node case (although obviously we hope to 
extend that in the future).

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jon.brisbin at npcinternational.com  Mon Nov  1 14:49:12 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 1 Nov 2010 09:49:12 -0500
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <4CCEC4E0.9000009@rabbitmq.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>	<AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>	<90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>	<AANLkTikrmpnkV8p8Bpzh6ytjUzuqU9e+F4PPj0SDEYkp@mail.gmail.com>
	<26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>
	<4CCEC4E0.9000009@rabbitmq.com>
Message-ID: <4656424D-DB31-49F8-90B8-A0120DE5B85D@npcinternational.com>


On Nov 1, 2010, at 8:47 AM, Simon MacMullen wrote:

> On 01/11/10 13:42, Jon Brisbin wrote:
>> <soapbox> The broker upgrade process could use some attention, IMHO.
>> The broker should restart after upgrades without manual intervention
>> and new versions should ALWAYS be able to migrate data so I don't
>> have to reconfigure all my users and clustering configuration.
>> </soapbox>
> 
> We're working on it. It's very likely 2.0.0 -> 2.1.0 will be the last such reconfiguration-requiring upgrade.

Awesome! :)

jb

> 
> Cheers, Simon
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Jon Brisbin
Portal Webmaster
NPC International, Inc.




From stephanion2002 at gmail.com  Mon Nov  1 14:50:37 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Mon, 1 Nov 2010 20:20:37 +0530
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>
	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>
	<AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>
	<90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>
	<AANLkTikrmpnkV8p8Bpzh6ytjUzuqU9e+F4PPj0SDEYkp@mail.gmail.com>
	<26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>
Message-ID: <AANLkTikN8XK9uCzNHChRHh_Y6U7Wh41uaR0A=KR2NADP@mail.gmail.com>

Thanks a lot Jon, I would be bothering you again in future  :)

On Mon, Nov 1, 2010 at 7:12 PM, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
>
> On Oct 30, 2010, at 3:28 AM, Kshitiz Garg wrote:
>
>> Now if I use a HA proxy and have independent RabbitMQs sitting behind
>> that proxy, how will that be different from using a HA proxy and have
>> clustered RabbitMQs sitting behind that proxy. What is that these
>> clustered RabbitMQs have in common? ?Actually I want to understand
>> "clustering" in this regard.
>
> If the brokers aren't clustered, your individual RabbitMQ brokers won't share users, exchanges, queues, or any other resource. I'm not sure how that affects applications because I haven't tried it. I suspect it wouldn't work very well with round-robin load balancing because consumers might get connected to a different broker than the producers.
>
> If you're using only the failover configuration, though, it would be better. You'd just have to reestablish all your Channels if one of them gets disconnected, assuming the next connection will go to the other broker.
>
> "Clustered" RabbitMQ brokers look the same no matter which actual broker you contact. Messages delivered to one broker will be delivered to consumers on another broker. Without this clustering, you have to create some kind of store-and-forward (maybe using the shovel plugin) or your application has to manage that itself.
>
> If your brokers are clustered, upgrading versions of the broker is, in my experience, fragile. Every version upgrade I've done (we're running it on Ubuntu Linux) results in a dead broker that has to be manually restarted. I've also had to re-configure the broker back into the cluster more times than I'd like.
>
> <soapbox>
> The broker upgrade process could use some attention, IMHO. The broker should restart after upgrades without manual intervention and new versions should ALWAYS be able to migrate data so I don't have to reconfigure all my users and clustering configuration.
> </soapbox>
>
> jb
>
>
>>
>> Thanks,
>> Kshitiz Garg
>>
>>
>> On Fri, Oct 29, 2010 at 7:12 PM, Jon Brisbin
>> <jon.brisbin at npcinternational.com> wrote:
>>>
>>> On Oct 29, 2010, at 8:31 AM, Kshitiz Garg wrote:
>>>
>>>> Should I refer to "RabbitMQ High Availability Guide" for setting up a
>>>> system like yours?
>>>
>>> It's certainly a good idea to read that guide. But I'm using an intentionally simplistic setup that follows the transcript here:
>>>
>>> http://www.rabbitmq.com/clustering.html#creating
>>>
>>>
>>>> does "haproxy" automatically decides the routing of
>>>> the message depending on the availability of rabbitMQ instances
>>>> sitting behind this ?
>>>
>>> Sort of. HAProxy is a TCP/IP "traffic cop". It knows nothing about the contents of the packets it proxies. It simply knows whether or not any of the configured backends is alive and able to receive data.
>>>
>>> Maybe a better way to say it is that it decides the routing of the TCP traffic to the broker. It knows nothing about messages.
>>>
>>> http://haproxy.1wt.eu/
>>>
>>> I'm also using a "best effort" approach. I'm not going to get my britches in a wrinkle if my broker goes down for a few minutes (or a few hours ;) until I get it fixed. I recognize others don't have that luxury.
>>>
>>> jb
>>>
>>>
>>>
>>>>
>>>> Regards,
>>>> Kshitiz
>>>>
>>>> On Fri, Oct 29, 2010 at 6:39 PM, Jon Brisbin
>>>> <jon.brisbin at npcinternational.com> wrote:
>>>>>
>>>>> Do you want failover or clustering (or both)?
>>>>> I use both. I have haproxy as a TCP proxy that sits in front of the RabbitMQ servers and acts as a failover and load balancer mechanism.
>>>>> Behind the proxy are clustered RabbitMQ instances, which means they use the standard RabbitMQ clustering mechanism and have the same queues, exchanges, and whatnot on each box.
>>>>> I then use Spring AMQP to connect to the *proxy*, who decides which of the RabbitMQ instances I actually get connected to.
>>>>>
>>>>> Jon Brisbin
>>>>> Portal Webmaster
>>>>> NPC International, Inc.
>>>>>
>>>>> On Oct 29, 2010, at 1:27 AM, Kshitiz Garg wrote:
>>>>>
>>>>> Hi,
>>>>>
>>>>> I have just started working with RabbitMQ for my cloud messaging/eventing application. The proof of concept worked well with rabbitMQ and Spring AMQP. Now, I want to start preparing for scalability.
>>>>> I am able to setup a rabbitMQ cluster with 2 rabbitMQs installed on 2 separate machines. Now I want to know what is achieved by "clustering" in terms of rabbitMQ.
>>>>>
>>>>> My spring amqp template has been given a connection Factory like this:
>>>>>
>>>>> ? ? <!-- RabbitMQ configurations -->
>>>>> ? ? <!-- Define a connectionFactory -->
>>>>> ? ? <bean id="connectionFactory"
>>>>> ? ? ? ? class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
>>>>> ? ? ? ? <constructor-arg value="localhost" />
>>>>> ? ? ? ? <property name="username" value="guest" />
>>>>> ? ? ? ? <property name="password" value="guest" />
>>>>> ? ? </bean>
>>>>>
>>>>> ? ? <!-- Configure the admin class -->
>>>>> ? ? <bean id="amqpAdmin" class="org.springframework.amqp.rabbit.core.RabbitAdmin">
>>>>> ? ? ? ? <constructor-arg ref="connectionFactory" />
>>>>> ? ? </bean>
>>>>>
>>>>> Here I have specified localhost, so now, if I send a amqp message through rabbitMQ and this localhost broker is not up, will that message go through its cluster node automatically ?
>>>>>
>>>>> If that's the case, then what do we mean by high availability?
>>>>>
>>>>> Thanks,
>>>>> Kshitiz Garg
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>>
>>>
>>>
>>> Jon Brisbin
>>> Portal Webmaster
>>> NPC International, Inc.
>>>
>>>
>>>
>>>
>
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>

From scott at beamdog.com  Mon Nov  1 15:38:31 2010
From: scott at beamdog.com (Scott Brooks)
Date: Mon, 1 Nov 2010 09:38:31 -0600
Subject: [rabbitmq-discuss] Missing features making me look at moving
	off RabbitMQ
In-Reply-To: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
Message-ID: <AANLkTimz-U2=xyPefsh3EYmtOdGtcyMUA-8bHp=k_0Js@mail.gmail.com>

> Support message-level permissions
>
> * It'd be nice for a publisher to be able to include a security token and have the broker decide to vend to a consumer or not based on it
> * Haven't really thought about this in-depth yet, but the problem we are trying to solve is publishing multiple-tiers of security-sensitive information where the message content itself determines who should see it

Can you encode that security token into the binding on a topic
exchange?  That would mean somewhat fixed values for your security
token, and I can certainly see some ways that it wouldn't work, but
you may be able to get things going.

From emile at rabbitmq.com  Mon Nov  1 16:13:07 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 01 Nov 2010 16:13:07 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <20101101132244.100175927nswe1wk@webmail.active24.cz>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
Message-ID: <4CCEE713.4090603@rabbitmq.com>

Hi Ji??,

Op 01/11/2010 12:22, het jiri at krutil.com geskryf:
> Hello together
>
> I'm looking for a way how to protect against slow consumers.
>
> We are publishing messages to a topic exchange as part of a public
> interface. The subscribers are applications developed by our clients
> (outside of our control).
>
> Our concern is that one slow consumer could potentially force the broker
> to throttle our publisher, affecting all other consumers.
>
> We encourage the consumers to use a small prefetch buffer, but have no
> way how to enforce this. In general, we cannot assume that all consumers
> cooperate.
>
> For instance, a client that is consuming but not acking will (I believe)
> impact the broker memory consumption.
>
> Your ideas are welcome.

I assume you have subscribers each set up with their own queue and 
binding. In this case I would expect long queues associated with slow 
subscribers to be persisted to disk automatically. This prevents RAM 
pressure, which the broker attempts to relieve by blocking producers. 
This assumes that you are running version 2.0.0 or later. If you are 
seeing different results then we'd like to hear the details.

Regards

Emile

From rwirth at demandware.com  Mon Nov  1 16:15:42 2010
From: rwirth at demandware.com (Rudi Wirth)
Date: Mon, 1 Nov 2010 11:15:42 -0500
Subject: [rabbitmq-discuss] Lose messages between restarts of broker
In-Reply-To: <4CCEC5CD.4020701@rabbitmq.com>
References: <AANLkTi=HnKQgcTJ=nNQw3Kj66pbBp5XY5Br9_Dz8637o@mail.gmail.com>
	<20101027222357.GC18601@wellquite.org>
	<5D226D9E05A7E342B774D1881408C3EB013B4B5B56@34093-MBX-C15.mex07a.mlsrvr.com>
	<4CCEC5CD.4020701@rabbitmq.com>
Message-ID: <5D226D9E05A7E342B774D1881408C3EB013CB97ED4@34093-MBX-C15.mex07a.mlsrvr.com>


Thanks Emile!

> The advice that Matthew gave applies to unacknowledged message too. If 
> the publisher commits on a transacted channel then persistent messages 
> in a durable queue are guaranteed to be on disk up to the point when 
> they get removed from the queue. This includes any period that messages 
> spend in an unacknowledged state.

I re-tested and confirmed. I had some unack'd messages still on the queue from an earlier producer session/channel that wasn't transactional; in that case, a consumer can't make "non-transactional" existing data transactional which makes sense of course.

Best
-Rudi
This e-mail message and all attachments transmitted with it may contain privileged and/or confidential information intended solely for the use of the addressee(s). If the reader of this message is not the intended recipient, you are hereby notified that any reading, dissemination, distribution, copying, forwarding or other use of this message or its attachments is strictly prohibited. If you have received this message in error, please notify the sender immediately and delete this message, all attachments and all copies and backups thereof.


From jiri at krutil.com  Mon Nov  1 16:33:23 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Mon, 01 Nov 2010 17:33:23 +0100
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <4CCEE713.4090603@rabbitmq.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
Message-ID: <20101101173323.49957a8l9sdaafoc@webmail.active24.cz>

Hi Emile

> I assume you have subscribers each set up with their own queue and binding.

Yes, each subscriber uses an exclusive auto-delete queue bound to the  
exchange.

> In this case I would expect long queues associated with slow  
> subscribers to be persisted to disk automatically. This prevents RAM  
> pressure, which the broker attempts to relieve by blocking producers.

I see what you mean, but what if the subscriber uses a large prefetch  
buffer and consumes without ever acking?

Also, even if long queues get persisted to disk, this consumes  
resources and the queues can't grow forever.

Is there no way how can we limit the queue size or message time to live?

> This assumes that you are running version 2.0.0 or later.

We are running RabbitMQ 2.1.0.

Cheers
Jiri


From rob at rabbitmq.com  Mon Nov  1 16:56:22 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Mon, 1 Nov 2010 16:56:22 +0000
Subject: [rabbitmq-discuss] Missing features making me look at moving
	off RabbitMQ
In-Reply-To: <bac4fc6c-b9b9-42c7-a7ed-7967f75c56d2@t13g2000yqm.googlegroups.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
	<4CCB790F.3000106@rabbitmq.com>
	<bac4fc6c-b9b9-42c7-a7ed-7967f75c56d2@t13g2000yqm.googlegroups.com>
Message-ID: <9C2AFDD9-252D-4060-884C-206784CAEF98@rabbitmq.com>

>>> -- Support custom authentication schemes <e.g. LDAP>
> 
> Spring Security and Spring Integration already work together (and LDAP
> is a dime a dozen for Spring Security users), so Spring AMQP with
> Spring Integration might provide a nice high-level wrapper for this.

I'm not sure this will quite address the issue. If the plan is to allow pluggable authentication for credentials supplied to the RabbitMQ broker, then the plug point will be in the broker, not in the client application.

I _think_ this is what Christian was getting at :)

> 
>>> -- Support message-level permissions
>> That sounds like a pretty hard problem. Are there any messaging systems
>> out there that do something close to what you need here?
> 
> Spring Security is pretty good for that kind of requirement also. We
> could try it pretty soon once Spring AMQP and Spring Integration get
> properly synched up (should be any time, now that Spring Integration
> 2.0 is getting close to final).

I think this gets close but I'm not sure it's necessarily the whole solution. Using Spring Security, message  filtering can happen at the application-level, but I think Christian was talking more about RabbitMQ not sending message to certain consumers at all.

In this case, I'm imagining the idea is to have permissions controlling which RabbitMQ users can see which messages. The broker will then only deliver messages to consumers where the authenticated user is allowed to see the messages.

> Dave.

Rob

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From clegnitto at mozilla.com  Mon Nov  1 18:38:43 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 1 Nov 2010 11:38:43 -0700
Subject: [rabbitmq-discuss] Missing features making me look at moving
	off RabbitMQ
In-Reply-To: <4CCB790F.3000106@rabbitmq.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
	<4CCB790F.3000106@rabbitmq.com>
Message-ID: <BC3955C1-F80A-46DF-9CB5-F9C8E99698E5@mozilla.com>

Thanks for the reply! Comments inline.

On Oct 29, 2010, at 6:46 PM, Matthias Radestock wrote:

> Christian,
> 
> Christian Legnitto wrote:
>> Just thought I'd send a note detailing why I am investigating moving off RabbitMQ.
> 
> Thanks for letting us know. Let's see whether we can help you...
> 
>> -- Built-in way to deal with the "slow consumer" problem
>> * For pulse, it is entirely conceivable that consumers will check in once and perhaps go away for weeks (or maybe forever) * Ideally
>> support would be configurable and similar to http://activemq.apache.org/slow-consumer-handling.html
> 
> RabbitMQ has several ways of dealing with consumers that go away:
> - exclusive queues - go away when the connection dies

I want consumers to be able to get what they missed while away. For example, if someone is running a tool on a laptop or their personal server goes down, I want the messages missed to persist.

> - auto-delete queues - go away when the last consumer disappears

Again, as above I want missed messages from the point the consumer checked in to the point they come back (which could be weeks)

> - queues with leases - go away when unused for some time

Same deal.

> - per-queue message ttl (in the next release) - messages expire after a
> per-queue configured ttl

Same deal.

> 
> Would any of these work for your use case?

Nope :-( Basically I want to give a reasonable expectation to consumers, something like "If you do not actively consume messages the most that will be kept are the latest 20,000. If the system isn't resource constrained we may store more, but you can't rely on it." I also want to be able to lift/modify this restriction for certain critical consumers. 

> 
>> -- Built-in HA
>> * It'd be nice to not have to cobble together multiple pieces to get this
> 
> Instead of "cobbled together" I'd like to think of it as "using a combination of tried & trusted best-of-breed products" ;)
> 
> We are working on better and more integrated HA. Meanwhile, the instructions for the existing active/passive HA may look a bit
> daunting, but it's actually not that hard to set up.

Yeah, honestly this was just put here for completeness. I haven't looked into it too much, but from perusing the docs + other broker docs it looks more involved than other setups.

> 
>> -- Support custom authentication schemes
>> * I'd like to be able to hook authentication to different backends (like ldap, use bugzilla for auth, etc) * I need this as I don't want
>> to maintain lists and want to give permissions based on ldap groups
> 
> This has been requested a few times but hasn't yet bubbled up far enough
> our priority list to make it into the code base.
> 
> Tweaking the code s.t. it supports your particular authentication scheme
> should only take a few hours. Implementing a more generally
> applicable and pluggable mechanism would take a few days.

I figured it wouldn't be too difficult to do, just wasn't sure about the supporting erlang libs. In my use-case I'd want to define fallback schemes as well. That is, first try to find the person in ldap, then check a local, hard-coded list of users.

>> -- Support message-level permissions
>> * It'd be nice for a publisher to be able to include a security token
>> and have the broker decide to vend to a consumer or not based on it
>> * Haven't really thought about this in-depth yet, but the problem we are trying to solve is publishing multiple-tiers of security-sensitive information where the message content itself determines who should see it
> 
> That sounds like a pretty hard problem. Are there any messaging systems
> out there that do something close to what you need here?

I don't think so. The main problem I am trying to solve is a secure way to publish bugzilla messages into the broker. As you can imagine, each message has differing levels of security, and each consumer / queue needs to only be able to see certain stuff. I need to think about the problem some more, but if I could include some key/vaue pairs from bugzilla in the message and the broker could choose to vend or not based on some configuration I believe it would be all that is needed to solve. Of course this would kill throughput...

> 
>> -- Support for WebSockets
>> * It'd be nice for there a plugin to support websockets * More important for Mozilla as most tools are web-based *
> 
> I'd be surprised if some websockets support didn't find its way into
> a rabbit plug-in soon.
> 
> Meanwhile, would any of existing Rabbit plug-ins/extensions for
> messaging-over-HTTP, such as the jsonrpc-channel
> (http://www.rabbitmq.com/plugins.html#rabbitmq-jsonrpc-channel) and
> rabbithub (http://github.com/tonyg/rabbithub) work for you?

Yep. I've also set up orbit in front of the STOMP plugin, so I can get the WebSockets functionality with additional effort.

> 
>> -- Public bugtracker
>> * Be nice to file bugs, learn from other's bugs, etc
> 
> There is no official public rabbit bug tracker but you can (and people
> occasionally do) file bugs in the rabbit bug trackers on github, ubuntu, debian, etc. That doesn't give you much insight into what the rabbit team is working on though, which is what I think you are after.


Yep, it'd be nice to cc myself on bugs, see which bugs have movement, etc.

> 
>> * I understand there is a private one. Can you just set all existing
>> bugs to restricted and provide public access? All new bugs could be
>> public and as soon as old bugs are vetted you could open them up
> 
> Something like that will probably happen eventually. The issue tracking system plays a pivotal role in the work of the RabbitMQ team. We have more than 2500 bugs recorded in it, touch about 30 bugs a day and open ~100 new ones per month. So there's a lot going on, which of course would make it an incredibly valuable resource for the community. But because it is so important to the rabbit team any fundamental changes to it require careful consideration.

Totally understandable. Bugzilla is the basis for all workflows here at Moz so we understand how important it is to make sure it's solid. That being said, we do have private bugs (secure/ corporation-specific/legal) as well as public bugs, so the end-goal is certainly doable.

Plus, once you get a public bugzilla you can use my extension to send messages to Rabbit. Once that data is flowing there are tons of cool tools you can build on top to help your org ;-)


> 
>> -- Public roadmap
>> * Very critical when you are basing your entire organization on a product
> 
> Our to do list so far has resisted attempts to condense it into a roadmap that can be navigated without a personal guide ;) And our plans are quite fluid since the prioritisation of work items is often finely balanced and can change radically with just a single user request (e.g. for pluggable authentication ;), bug report, etc.
> 
> Having said that, we are always happy to discuss our current plans with potential customers / users. Shall I give you a ring?

Eventually, yes :-) I'm knee-ddep in Firefox releases at the moment so my Rabbit stuff has been put on the back-burner.

> 
>> * Management console / API was on this list, then all of a sudden someone started working on it (thanks!), but it would have been nice to know it was coming
> 
> That is one example of the fluidity of our plans. Improvements to management had been on our todo list for a long time. It took a combination of various factors and events to push it near the top of our priority list. Once it had ended up there, exploratory work got underway very quickly. The first line of code was written on July 12th. We announced it to the world less than four weeks later, on August 6th, once we were confident it would make it into the product soon.
> 
> So if it looked like rabbitmq-management appeared out of the blue then that is because it did :)
> 
> Most features / fixes we decide to work on make it into the product within 1-2 months. Or they get parked or abandoned. For the few items that take several months we could perhaps be a bit more vocal about their progress. But doing so always carries the risk of disappointing people when the features subsequently get delayed or abandoned.
> 
> 
> Regards,
> 
> Matthias.


From clegnitto at mozilla.com  Mon Nov  1 18:41:35 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 1 Nov 2010 11:41:35 -0700
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
Message-ID: <0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>

There is not something like http://activemq.apache.org/slow-consumer-handling.html for Rabbit. You can sort of approximate it with a maintenance script that sweeps through and drains messages from a queue depending on a heuristic of your choice.

We are interested in something like this too (see my message titled "Missing features making me look at moving off RabbitMQ" to the list).

Thanks,
Christian

On Nov 1, 2010, at 9:33 AM, jiri at krutil.com wrote:

> Hi Emile
> 
>> I assume you have subscribers each set up with their own queue and binding.
> 
> Yes, each subscriber uses an exclusive auto-delete queue bound to the exchange.
> 
>> In this case I would expect long queues associated with slow subscribers to be persisted to disk automatically. This prevents RAM pressure, which the broker attempts to relieve by blocking producers.
> 
> I see what you mean, but what if the subscriber uses a large prefetch buffer and consumes without ever acking?
> 
> Also, even if long queues get persisted to disk, this consumes resources and the queues can't grow forever.
> 
> Is there no way how can we limit the queue size or message time to live?
> 
>> This assumes that you are running version 2.0.0 or later.
> 
> We are running RabbitMQ 2.1.0.
> 
> Cheers
> Jiri
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From clegnitto at mozilla.com  Mon Nov  1 18:46:39 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 1 Nov 2010 11:46:39 -0700
Subject: [rabbitmq-discuss] Missing features making me look at moving
	off RabbitMQ
In-Reply-To: <AANLkTimz-U2=xyPefsh3EYmtOdGtcyMUA-8bHp=k_0Js@mail.gmail.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
	<AANLkTimz-U2=xyPefsh3EYmtOdGtcyMUA-8bHp=k_0Js@mail.gmail.com>
Message-ID: <D0488A7C-F5F8-4043-9C7A-270FEB0887B1@mozilla.com>

Hmmm, I hadn't really thought of that, I'll look into it. You mean adding something like "secure.level.1" to the routing key and only letting certain users bind with with that? Is there a way to restrict bindings based on routing keys? Also, wouldn't # and * bypass that?

Thanks,
Christian

On Nov 1, 2010, at 8:38 AM, Scott Brooks wrote:

>> Support message-level permissions
>> 
>> * It'd be nice for a publisher to be able to include a security token and have the broker decide to vend to a consumer or not based on it
>> * Haven't really thought about this in-depth yet, but the problem we are trying to solve is publishing multiple-tiers of security-sensitive information where the message content itself determines who should see it
> 
> Can you encode that security token into the binding on a topic
> exchange?  That would mean somewhat fixed values for your security
> token, and I can certainly see some ways that it wouldn't work, but
> you may be able to get things going.


From clegnitto at mozilla.com  Mon Nov  1 18:49:29 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 1 Nov 2010 11:49:29 -0700
Subject: [rabbitmq-discuss] Missing features making me look at moving
	off RabbitMQ
In-Reply-To: <9C2AFDD9-252D-4060-884C-206784CAEF98@rabbitmq.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
	<4CCB790F.3000106@rabbitmq.com>
	<bac4fc6c-b9b9-42c7-a7ed-7967f75c56d2@t13g2000yqm.googlegroups.com>
	<9C2AFDD9-252D-4060-884C-206784CAEF98@rabbitmq.com>
Message-ID: <3EC3073C-128A-407A-AD9E-F9386D63697D@mozilla.com>


On Nov 1, 2010, at 9:56 AM, Rob Harrop wrote:

>>>> -- Support custom authentication schemes <e.g. LDAP>
>> 
>> Spring Security and Spring Integration already work together (and LDAP
>> is a dime a dozen for Spring Security users), so Spring AMQP with
>> Spring Integration might provide a nice high-level wrapper for this.
> 
> I'm not sure this will quite address the issue. If the plan is to allow pluggable authentication for credentials supplied to the RabbitMQ broker, then the plug point will be in the broker, not in the client application.
> 
> I _think_ this is what Christian was getting at :)

Yep, talking about on the broker. I don't even use Java :-)

> 
>> 
>>>> -- Support message-level permissions
>>> That sounds like a pretty hard problem. Are there any messaging systems
>>> out there that do something close to what you need here?
>> 
>> Spring Security is pretty good for that kind of requirement also. We
>> could try it pretty soon once Spring AMQP and Spring Integration get
>> properly synched up (should be any time, now that Spring Integration
>> 2.0 is getting close to final).
> 
> I think this gets close but I'm not sure it's necessarily the whole solution. Using Spring Security, message  filtering can happen at the application-level, but I think Christian was talking more about RabbitMQ not sending message to certain consumers at all.
> 
> In this case, I'm imagining the idea is to have permissions controlling which RabbitMQ users can see which messages. The broker will then only deliver messages to consumers where the authenticated user is allowed to see the messages.

Exactly. Specifically for the Bugzilla message case, if a comment is marked private I want the "comment changed" message to only be vended to consumers who have authenticated with a user who can see private comments. I also only want the matching "bug changed" message to be visible to those people as well. If I have everything publishing to the same exchange the permissions are too coarse to allow this.

> 
>> Dave.
> 
> Rob
> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Mon Nov  1 18:56:44 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 01 Nov 2010 18:56:44 +0000
Subject: [rabbitmq-discuss] Missing features making me look at moving
 off RabbitMQ
In-Reply-To: <BC3955C1-F80A-46DF-9CB5-F9C8E99698E5@mozilla.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
	<4CCB790F.3000106@rabbitmq.com>
	<BC3955C1-F80A-46DF-9CB5-F9C8E99698E5@mozilla.com>
Message-ID: <4CCF0D6C.9040404@rabbitmq.com>

Christian,

just to pick up on one point ...

On 01/11/10 18:38, Christian Legnitto wrote:
> On Oct 29, 2010, at 6:46 PM, Matthias Radestock wrote:
>> RabbitMQ has several ways of dealing with consumers that go away: -
>> exclusive queues - go away when the connection dies
>
> I want consumers to be able to get what they missed while away. For
> example, if someone is running a tool on a laptop or their personal
> server goes down, I want the messages missed to persist.
>
> Basically I want to give a reasonable expectation to
> consumers, something like "If you do not actively consume messages
> the most that will be kept are the latest 20,000. If the system isn't
> resource constrained we may store more, but you can't rely on it." I
> also want to be able to lift/modify this restriction for certain
> critical consumers.

Both queue leases and per-queue message ttl give you that *except* the 
eviction criteria is time based rather than count based. A time based 
criteria seems preferable from the user's point of view, e.g. they know 
that if they connect at least every n seconds/days and drain their 
queues then they will not miss anything.

 From a server-admin's point of view a count-based eviction policy may 
seem preferable, but it really only manages resources in a sensible way 
if message sizes and the amount of sharing (i.e. the fact that the same 
message residing in multiple queues will be referred to *by reference* 
in both the memory and disk based storage) is predictable and constant. 
In many applications that is not the case.


Regards,

Matthias.

From matthias at rabbitmq.com  Mon Nov  1 19:37:27 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 01 Nov 2010 19:37:27 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
Message-ID: <4CCF16F7.9080908@rabbitmq.com>

Jiri,

On 01/11/10 16:33, jiri at krutil.com wrote:
> I see what you mean, but what if the subscriber uses a large prefetch
> buffer and consumes without ever acking?

Currently unacked messages are held in memory. Changing that is on our 
todo list.

> Also, even if long queues get persisted to disk, this consumes resources
> and the queues can't grow forever.
>
> Is there no way how can we limit the queue size or message time to live?

Given that your queues are exclusive and thus get deleted on consumer 
disconnect, presumably your concern here is that while consumers are 
connected queues could still grow to the point where disk space is 
exhausted. Right?

If so then per-queue message TTLs might be an answer, which is a new 
feature we are introducing in the next release.


Regards,

Matthias.

From bkjones at gmail.com  Mon Nov  1 20:17:17 2010
From: bkjones at gmail.com (Brian Jones)
Date: Mon, 1 Nov 2010 16:17:17 -0400
Subject: [rabbitmq-discuss] Seeking 'right way' to do IPC
Message-ID: <AANLkTi=YaasxW7fUb26MK=fiSXxX6d_gecXC7VgYuYWx@mail.gmail.com>

Hi all,

I'm setting up a rabbitmq server that will act as an IPC backchannel between
several nodes. Nodes can come and go, their number can vary, names aren't
consistent, etc. Ideally, the scenario I'd like to see work (sans any
assumed exchange types or binding semantics) is this:

1.  NodeA, NodeB, and NodeC connect. All of them will be both publishers and
consumers
2. Any node publishes a message
3. The other two nodes *each* receive the message
4. The publishing node *does not* receive the message.

In addition, I have another use case that seems... elusive:

1. NodeA, NodeB, and NodeC connect. All of them will be both publishers and
consumers
2. Any of the nodes publishes a message
3. Exactly one of the other nodes receives the message -- first one wins.
4. The publishing node *does not* receive the message.

The first scenario can be seen as a "node synchronization" problem: for
everything that happens on NodeB, a message must be sent to all other nodes
to bring them in sync.

The second scenario is more of a "Task delegation" problem: For everything
that happens on NodeC, a message is sent and the task is consumed/performed
by whichever node happens to receive it first.

Given that the numbers/names of the nodes aren't necessarily consistent
(nodes can be added/removed as scaling needs require), and I don't want the
publishing node to receive copies of messages they've published, what is a
reasonable way to go about addressing each of these scenarios using existing
AMQP capabilities in RabbitMQ (note I don't want to use exchange-to-exchange
bindings or other Rabbit-specific utilities)?

Thanks.
brian





-- 
Brian K. Jones
My Blog          http://www.protocolostomy.com
Follow me      http://twitter.com/bkjones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101101/f93e1f67/attachment.htm>

From alexis at rabbitmq.com  Mon Nov  1 20:27:14 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 1 Nov 2010 20:27:14 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>
Message-ID: <AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>

Christian, Jiri,

What are your thoughts on per message TTLs for this?

alexis


On Mon, Nov 1, 2010 at 6:41 PM, Christian Legnitto
<clegnitto at mozilla.com> wrote:
> There is not something like http://activemq.apache.org/slow-consumer-handling.html for Rabbit. You can sort of approximate it with a maintenance script that sweeps through and drains messages from a queue depending on a heuristic of your choice.
>
> We are interested in something like this too (see my message titled "Missing features making me look at moving off RabbitMQ" to the list).
>
> Thanks,
> Christian
>
> On Nov 1, 2010, at 9:33 AM, jiri at krutil.com wrote:
>
>> Hi Emile
>>
>>> I assume you have subscribers each set up with their own queue and binding.
>>
>> Yes, each subscriber uses an exclusive auto-delete queue bound to the exchange.
>>
>>> In this case I would expect long queues associated with slow subscribers to be persisted to disk automatically. This prevents RAM pressure, which the broker attempts to relieve by blocking producers.
>>
>> I see what you mean, but what if the subscriber uses a large prefetch buffer and consumes without ever acking?
>>
>> Also, even if long queues get persisted to disk, this consumes resources and the queues can't grow forever.
>>
>> Is there no way how can we limit the queue size or message time to live?
>>
>>> This assumes that you are running version 2.0.0 or later.
>>
>> We are running RabbitMQ 2.1.0.
>>
>> Cheers
>> Jiri
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From clegnitto at mozilla.com  Mon Nov  1 20:41:39 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 1 Nov 2010 13:41:39 -0700
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>
	<AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>
Message-ID: <AD10644A-146D-47DF-A607-EFC32F82FD04@mozilla.com>

For my use-case it isn't exactly what I want.

If a user is listening for a very specific message (say "bug.changed.review.requested.foo at example.com") and they only have 2 items in the queue, I don't really want to delete those items because a pre-determined time has passed. On the flip-side, if I set the TTL to one day and the queue suddenly balloons to 100k within an hour, I want to limit the queue rather than waiting the one day for the messages to expire.

Thanks,
Christian


On Nov 1, 2010, at 1:27 PM, Alexis Richardson wrote:

> Christian, Jiri,
> 
> What are your thoughts on per message TTLs for this?
> 
> alexis
> 
> 
> On Mon, Nov 1, 2010 at 6:41 PM, Christian Legnitto
> <clegnitto at mozilla.com> wrote:
>> There is not something like http://activemq.apache.org/slow-consumer-handling.html for Rabbit. You can sort of approximate it with a maintenance script that sweeps through and drains messages from a queue depending on a heuristic of your choice.
>> 
>> We are interested in something like this too (see my message titled "Missing features making me look at moving off RabbitMQ" to the list).
>> 
>> Thanks,
>> Christian
>> 
>> On Nov 1, 2010, at 9:33 AM, jiri at krutil.com wrote:
>> 
>>> Hi Emile
>>> 
>>>> I assume you have subscribers each set up with their own queue and binding.
>>> 
>>> Yes, each subscriber uses an exclusive auto-delete queue bound to the exchange.
>>> 
>>>> In this case I would expect long queues associated with slow subscribers to be persisted to disk automatically. This prevents RAM pressure, which the broker attempts to relieve by blocking producers.
>>> 
>>> I see what you mean, but what if the subscriber uses a large prefetch buffer and consumes without ever acking?
>>> 
>>> Also, even if long queues get persisted to disk, this consumes resources and the queues can't grow forever.
>>> 
>>> Is there no way how can we limit the queue size or message time to live?
>>> 
>>>> This assumes that you are running version 2.0.0 or later.
>>> 
>>> We are running RabbitMQ 2.1.0.
>>> 
>>> Cheers
>>> Jiri
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From alexis at rabbitmq.com  Mon Nov  1 20:44:31 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 1 Nov 2010 20:44:31 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <AD10644A-146D-47DF-A607-EFC32F82FD04@mozilla.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>
	<AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>
	<AD10644A-146D-47DF-A607-EFC32F82FD04@mozilla.com>
Message-ID: <AANLkTi=+jxs3TU3-sE+hYV=5c-ffdtAmaFbqG94PiJsQ@mail.gmail.com>

I see, ok.

Is there any reason to do this, other than conserving physical resources?

alexis



On Mon, Nov 1, 2010 at 8:41 PM, Christian Legnitto
<clegnitto at mozilla.com> wrote:
> For my use-case it isn't exactly what I want.
>
> If a user is listening for a very specific message (say "bug.changed.review.requested.foo at example.com") and they only have 2 items in the queue, I don't really want to delete those items because a pre-determined time has passed. On the flip-side, if I set the TTL to one day and the queue suddenly balloons to 100k within an hour, I want to limit the queue rather than waiting the one day for the messages to expire.
>
> Thanks,
> Christian
>
>
> On Nov 1, 2010, at 1:27 PM, Alexis Richardson wrote:
>
>> Christian, Jiri,
>>
>> What are your thoughts on per message TTLs for this?
>>
>> alexis
>>
>>
>> On Mon, Nov 1, 2010 at 6:41 PM, Christian Legnitto
>> <clegnitto at mozilla.com> wrote:
>>> There is not something like http://activemq.apache.org/slow-consumer-handling.html for Rabbit. You can sort of approximate it with a maintenance script that sweeps through and drains messages from a queue depending on a heuristic of your choice.
>>>
>>> We are interested in something like this too (see my message titled "Missing features making me look at moving off RabbitMQ" to the list).
>>>
>>> Thanks,
>>> Christian
>>>
>>> On Nov 1, 2010, at 9:33 AM, jiri at krutil.com wrote:
>>>
>>>> Hi Emile
>>>>
>>>>> I assume you have subscribers each set up with their own queue and binding.
>>>>
>>>> Yes, each subscriber uses an exclusive auto-delete queue bound to the exchange.
>>>>
>>>>> In this case I would expect long queues associated with slow subscribers to be persisted to disk automatically. This prevents RAM pressure, which the broker attempts to relieve by blocking producers.
>>>>
>>>> I see what you mean, but what if the subscriber uses a large prefetch buffer and consumes without ever acking?
>>>>
>>>> Also, even if long queues get persisted to disk, this consumes resources and the queues can't grow forever.
>>>>
>>>> Is there no way how can we limit the queue size or message time to live?
>>>>
>>>>> This assumes that you are running version 2.0.0 or later.
>>>>
>>>> We are running RabbitMQ 2.1.0.
>>>>
>>>> Cheers
>>>> Jiri
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>

From clegnitto at mozilla.com  Mon Nov  1 20:52:16 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 1 Nov 2010 13:52:16 -0700
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <AANLkTi=+jxs3TU3-sE+hYV=5c-ffdtAmaFbqG94PiJsQ@mail.gmail.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>
	<AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>
	<AD10644A-146D-47DF-A607-EFC32F82FD04@mozilla.com>
	<AANLkTi=+jxs3TU3-sE+hYV=5c-ffdtAmaFbqG94PiJsQ@mail.gmail.com>
Message-ID: <043EA4D9-9421-4E1A-9665-90F52FE4A8E7@mozilla.com>

Nope, just the resources. I want to have tiers of service, where known fast-consuming consumers get no queue limits (to absorb message spikes), corporation employees and responsive external tools get fairly high limits, and random tools by the general public get fairly low. The public aspect is important as we are open and want anyone to be able to play with our data easily (without causing a DOS for critical applications).

Thanks,
Christian

On Nov 1, 2010, at 1:44 PM, Alexis Richardson wrote:

> I see, ok.
> 
> Is there any reason to do this, other than conserving physical resources?
> 
> alexis
> 
> 
> 
> On Mon, Nov 1, 2010 at 8:41 PM, Christian Legnitto
> <clegnitto at mozilla.com> wrote:
>> For my use-case it isn't exactly what I want.
>> 
>> If a user is listening for a very specific message (say "bug.changed.review.requested.foo at example.com") and they only have 2 items in the queue, I don't really want to delete those items because a pre-determined time has passed. On the flip-side, if I set the TTL to one day and the queue suddenly balloons to 100k within an hour, I want to limit the queue rather than waiting the one day for the messages to expire.
>> 
>> Thanks,
>> Christian
>> 
>> 
>> On Nov 1, 2010, at 1:27 PM, Alexis Richardson wrote:
>> 
>>> Christian, Jiri,
>>> 
>>> What are your thoughts on per message TTLs for this?
>>> 
>>> alexis
>>> 
>>> 
>>> On Mon, Nov 1, 2010 at 6:41 PM, Christian Legnitto
>>> <clegnitto at mozilla.com> wrote:
>>>> There is not something like http://activemq.apache.org/slow-consumer-handling.html for Rabbit. You can sort of approximate it with a maintenance script that sweeps through and drains messages from a queue depending on a heuristic of your choice.
>>>> 
>>>> We are interested in something like this too (see my message titled "Missing features making me look at moving off RabbitMQ" to the list).
>>>> 
>>>> Thanks,
>>>> Christian
>>>> 
>>>> On Nov 1, 2010, at 9:33 AM, jiri at krutil.com wrote:
>>>> 
>>>>> Hi Emile
>>>>> 
>>>>>> I assume you have subscribers each set up with their own queue and binding.
>>>>> 
>>>>> Yes, each subscriber uses an exclusive auto-delete queue bound to the exchange.
>>>>> 
>>>>>> In this case I would expect long queues associated with slow subscribers to be persisted to disk automatically. This prevents RAM pressure, which the broker attempts to relieve by blocking producers.
>>>>> 
>>>>> I see what you mean, but what if the subscriber uses a large prefetch buffer and consumes without ever acking?
>>>>> 
>>>>> Also, even if long queues get persisted to disk, this consumes resources and the queues can't grow forever.
>>>>> 
>>>>> Is there no way how can we limit the queue size or message time to live?
>>>>> 
>>>>>> This assumes that you are running version 2.0.0 or later.
>>>>> 
>>>>> We are running RabbitMQ 2.1.0.
>>>>> 
>>>>> Cheers
>>>>> Jiri
>>>>> 
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>> 
>> 


From alexis at rabbitmq.com  Mon Nov  1 20:55:01 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 1 Nov 2010 20:55:01 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <043EA4D9-9421-4E1A-9665-90F52FE4A8E7@mozilla.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>
	<AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>
	<AD10644A-146D-47DF-A607-EFC32F82FD04@mozilla.com>
	<AANLkTi=+jxs3TU3-sE+hYV=5c-ffdtAmaFbqG94PiJsQ@mail.gmail.com>
	<043EA4D9-9421-4E1A-9665-90F52FE4A8E7@mozilla.com>
Message-ID: <AANLkTinoWNo5pk-QCCKz1VpvR=763nQN-qVGW65oggjr@mail.gmail.com>

Nice use case :-)

Could you measure consumption of the resources directly (eg Gb on
disk) instead of indirectly (eg #messages)?

alexis


On Mon, Nov 1, 2010 at 8:52 PM, Christian Legnitto
<clegnitto at mozilla.com> wrote:
> Nope, just the resources. I want to have tiers of service, where known fast-consuming consumers get no queue limits (to absorb message spikes), corporation employees and responsive external tools get fairly high limits, and random tools by the general public get fairly low. The public aspect is important as we are open and want anyone to be able to play with our data easily (without causing a DOS for critical applications).
>
> Thanks,
> Christian
>
> On Nov 1, 2010, at 1:44 PM, Alexis Richardson wrote:
>
>> I see, ok.
>>
>> Is there any reason to do this, other than conserving physical resources?
>>
>> alexis
>>
>>
>>
>> On Mon, Nov 1, 2010 at 8:41 PM, Christian Legnitto
>> <clegnitto at mozilla.com> wrote:
>>> For my use-case it isn't exactly what I want.
>>>
>>> If a user is listening for a very specific message (say "bug.changed.review.requested.foo at example.com") and they only have 2 items in the queue, I don't really want to delete those items because a pre-determined time has passed. On the flip-side, if I set the TTL to one day and the queue suddenly balloons to 100k within an hour, I want to limit the queue rather than waiting the one day for the messages to expire.
>>>
>>> Thanks,
>>> Christian
>>>
>>>
>>> On Nov 1, 2010, at 1:27 PM, Alexis Richardson wrote:
>>>
>>>> Christian, Jiri,
>>>>
>>>> What are your thoughts on per message TTLs for this?
>>>>
>>>> alexis
>>>>
>>>>
>>>> On Mon, Nov 1, 2010 at 6:41 PM, Christian Legnitto
>>>> <clegnitto at mozilla.com> wrote:
>>>>> There is not something like http://activemq.apache.org/slow-consumer-handling.html for Rabbit. You can sort of approximate it with a maintenance script that sweeps through and drains messages from a queue depending on a heuristic of your choice.
>>>>>
>>>>> We are interested in something like this too (see my message titled "Missing features making me look at moving off RabbitMQ" to the list).
>>>>>
>>>>> Thanks,
>>>>> Christian
>>>>>
>>>>> On Nov 1, 2010, at 9:33 AM, jiri at krutil.com wrote:
>>>>>
>>>>>> Hi Emile
>>>>>>
>>>>>>> I assume you have subscribers each set up with their own queue and binding.
>>>>>>
>>>>>> Yes, each subscriber uses an exclusive auto-delete queue bound to the exchange.
>>>>>>
>>>>>>> In this case I would expect long queues associated with slow subscribers to be persisted to disk automatically. This prevents RAM pressure, which the broker attempts to relieve by blocking producers.
>>>>>>
>>>>>> I see what you mean, but what if the subscriber uses a large prefetch buffer and consumes without ever acking?
>>>>>>
>>>>>> Also, even if long queues get persisted to disk, this consumes resources and the queues can't grow forever.
>>>>>>
>>>>>> Is there no way how can we limit the queue size or message time to live?
>>>>>>
>>>>>>> This assumes that you are running version 2.0.0 or later.
>>>>>>
>>>>>> We are running RabbitMQ 2.1.0.
>>>>>>
>>>>>> Cheers
>>>>>> Jiri
>>>>>>
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>
>>>
>
>

From jon.brisbin at npcinternational.com  Mon Nov  1 21:30:13 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 1 Nov 2010 16:30:13 -0500
Subject: [rabbitmq-discuss] Seeking 'right way' to do IPC
In-Reply-To: <AANLkTi=YaasxW7fUb26MK=fiSXxX6d_gecXC7VgYuYWx@mail.gmail.com>
References: <AANLkTi=YaasxW7fUb26MK=fiSXxX6d_gecXC7VgYuYWx@mail.gmail.com>
Message-ID: <220C6709-C115-475E-945C-E4C89B0BFDFA@npcinternational.com>

On Nov 1, 2010, at 3:17 PM, Brian Jones wrote:

> 1.  NodeA, NodeB, and NodeC connect. All of them will be both publishers and consumers
> 2. Any node publishes a message
> 3. The other two nodes *each* receive the message
> 4. The publishing node *does not* receive the message. 

IMHO it's easier to decide whether a message is your own message or not (by setting your own name in a header) in the consumer and toss it if it is. I've done this before and it's easier than creating complicated routing rules to prevent the producer from receiving its own message, given the simplicity of fanout exchanges. It's simple and it works (my favorite! :). 

Basic.Reject might also be something to look at here: 

http://www.rabbitmq.com/blog/2010/08/03/well-ill-let-you-go-basicreject-in-rabbitmq/

> 1. NodeA, NodeB, and NodeC connect. All of them will be both publishers and consumers
> 2. Any of the nodes publishes a message
> 3. Exactly one of the other nodes receives the message -- first one wins. 
> 4. The publishing node *does not* receive the message. 

You'll need consumers to bind on the same queue name to get the round-robin stuff. You'll also likely want to incorporate some variation of the "throw away my own messages" or Basic.Reject scheme mentioned above.

FWIW- I've found it's almost always easier to deal with messages by deciding what to do with them after you've consumed them rather than by trying to prevent them from ever going to your consumers in the first place. I can also shove more messages down the pipe because it doesn't have to try and figure out whether or not to deliver a message.

Jon Brisbin
Portal Webmaster
NPC International, Inc.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101101/5427ef5f/attachment.htm>

From matthias at rabbitmq.com  Mon Nov  1 21:35:34 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 01 Nov 2010 21:35:34 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <043EA4D9-9421-4E1A-9665-90F52FE4A8E7@mozilla.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>	<4CCEE713.4090603@rabbitmq.com>	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>	<0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>	<AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>	<AD10644A-146D-47DF-A607-EFC32F82FD04@mozilla.com>	<AANLkTi=+jxs3TU3-sE+hYV=5c-ffdtAmaFbqG94PiJsQ@mail.gmail.com>
	<043EA4D9-9421-4E1A-9665-90F52FE4A8E7@mozilla.com>
Message-ID: <4CCF32A6.2060500@rabbitmq.com>

Christian,

Christian Legnitto wrote:
> Nope, just the resources. I want to have tiers of service, where
> known fast-consuming consumers get no queue limits (to absorb message
> spikes), corporation employees and responsive external tools get
> fairly high limits, and random tools by the general public get fairly
> low. The public aspect is important as we are open and want anyone to
> be able to play with our data easily (without causing a DOS for
> critical applications).

Understood. The main problem with per-queue message count or TTL limits 
is that they are a very poor indicator of disk usage due to variations 
in message rates (in case of TTLs), message sizes and, most importantly, 
the degree of sharing (i.e. the same message held by multiple queues 
being written to disk only once).

Another problem with per-queue limits in general is the massive resource 
underutilisation that one gets as a result of having to set the limits 
on a worst case basis, i.e. "what if all consumers stopped consuming 
from their queues simultaneously".

So the question is what controls could we put in place that address 
these issues and bound the amount of message data held by RabbitMQ?


Regards,

Matthias.

From jiri at krutil.com  Mon Nov  1 22:07:38 2010
From: jiri at krutil.com (Jiri Krutil)
Date: Mon, 1 Nov 2010 23:07:38 +0100
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<0AB6B8C2-1E57-4DE9-929F-5A8E57BE3881@mozilla.com>
	<AANLkTinVo6aq3E+ZfngN+YGBUUt51K_Oz96M6JNPPdR1@mail.gmail.com>
Message-ID: <A3F29C19-2170-415E-A80C-179E809BAE1C@krutil.com>

In our use case, we assume that consumers will be fast and the message  
flow fairly low. So normally there should be almost no messages kept  
on the broker.

What we are concerned about is a consumer that (willingly or not)  
subscribes but does not consume, or consumes but does not ack.  
(Consumers are not under our control and belong to different clients  
that use our API.)

Of course we don't want one such funny consumer to disrupt the message  
flow to all other consumers (by draining broker memory or disk).

So anything that will prevent this should be OK - per-queue message  
TTL or per-queue limit on message count/size.

Cheers
Jiri


On 1 Nov 2010, at 21:27, Alexis Richardson <alexis at rabbitmq.com> wrote:

> Christian, Jiri,
>
> What are your thoughts on per message TTLs for this?
>
> alexis
>
>
> On Mon, Nov 1, 2010 at 6:41 PM, Christian Legnitto
> <clegnitto at mozilla.com> wrote:
>> There is not something like http://activemq.apache.org/slow-consumer-handling.html 
>>  for Rabbit. You can sort of approximate it with a maintenance  
>> script that sweeps through and drains messages from a queue  
>> depending on a heuristic of your choice.
>>
>> We are interested in something like this too (see my message titled  
>> "Missing features making me look at moving off RabbitMQ" to the  
>> list).
>>
>> Thanks,
>> Christian
>>
>> On Nov 1, 2010, at 9:33 AM, jiri at krutil.com wrote:
>>
>>> Hi Emile
>>>
>>>> I assume you have subscribers each set up with their own queue  
>>>> and binding.
>>>
>>> Yes, each subscriber uses an exclusive auto-delete queue bound to  
>>> the exchange.
>>>
>>>> In this case I would expect long queues associated with slow  
>>>> subscribers to be persisted to disk automatically. This prevents  
>>>> RAM pressure, which the broker attempts to relieve by blocking  
>>>> producers.
>>>
>>> I see what you mean, but what if the subscriber uses a large  
>>> prefetch buffer and consumes without ever acking?
>>>
>>> Also, even if long queues get persisted to disk, this consumes  
>>> resources and the queues can't grow forever.
>>>
>>> Is there no way how can we limit the queue size or message time to  
>>> live?
>>>
>>>> This assumes that you are running version 2.0.0 or later.
>>>
>>> We are running RabbitMQ 2.1.0.
>>>
>>> Cheers
>>> Jiri
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>

From jiri at krutil.com  Mon Nov  1 22:14:40 2010
From: jiri at krutil.com (Jiri Krutil)
Date: Mon, 1 Nov 2010 23:14:40 +0100
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <4CCF16F7.9080908@rabbitmq.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
Message-ID: <745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>

Matthias,


> Given that your queues are exclusive and thus get deleted on  
> consumer disconnect, presumably your concern here is that while  
> consumers are connected queues could still grow to the point where  
> disk space is exhausted. Right?

Right. Disk space or memory.

> If so then per-queue message TTLs might be an answer, which is a new  
> feature we are introducing in the next release.

Which release is that and when can we expect it?

Will it be possible for us to set per-queue message ttl on the  
exclusive broker-named queues created by consumers?

Cheers
Jiri 

From matthias at rabbitmq.com  Mon Nov  1 22:21:14 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 01 Nov 2010 22:21:14 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
Message-ID: <4CCF3D5A.8060002@rabbitmq.com>

Jiri,

Jiri Krutil wrote:
>> If so then per-queue message TTLs might be an answer, which is a new 
>> feature we are introducing in the next release.
> 
> Which release is that and when can we expect it?

It will probably be called 2.2.0, and it will probably appear before the 
end of the year.

> Will it be possible for us to set per-queue message ttl on the exclusive 
> broker-named queues created by consumers?

The ttl gets set as part of the queue.declare command. So it's set by 
the declaring client.


Regards,

Matthias.

From jiri at krutil.com  Tue Nov  2 08:30:32 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Tue, 02 Nov 2010 09:30:32 +0100
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <4CCF3D5A.8060002@rabbitmq.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
	<4CCF3D5A.8060002@rabbitmq.com>
Message-ID: <20101102093032.17587fria71q52ww@webmail.active24.cz>

> The ttl gets set as part of the queue.declare command. So it's set  
> by the declaring client.

Oh. So we can't let the clients declare their auto-delete exclusive  
response queues? And it looked so promising...


From matthias at rabbitmq.com  Tue Nov  2 08:32:24 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 02 Nov 2010 08:32:24 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <20101102093032.17587fria71q52ww@webmail.active24.cz>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
	<4CCF3D5A.8060002@rabbitmq.com>
	<20101102093032.17587fria71q52ww@webmail.active24.cz>
Message-ID: <4CCFCC98.2000000@rabbitmq.com>

Jiri,

jiri at krutil.com wrote:
>> The ttl gets set as part of the queue.declare command. So it's set by 
>> the declaring client.
> 
> Oh. So we can't let the clients declare their auto-delete exclusive 
> response queues? And it looked so promising...

You can, but they'd have to set the x-message-ttl argument as part of 
the queue declaration.


Matthias.

From jiri at krutil.com  Tue Nov  2 08:41:44 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Tue, 02 Nov 2010 09:41:44 +0100
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <4CCFCC98.2000000@rabbitmq.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
	<4CCF3D5A.8060002@rabbitmq.com>
	<20101102093032.17587fria71q52ww@webmail.active24.cz>
	<4CCFCC98.2000000@rabbitmq.com>
Message-ID: <20101102094144.58325dxputwv44kk@webmail.active24.cz>

Matthias,

>>> The ttl gets set as part of the queue.declare command. So it's set  
>>> by the declaring client.
>>
>> Oh. So we can't let the clients declare their auto-delete exclusive  
>> response queues? And it looked so promising...
>
> You can, but they'd have to set the x-message-ttl argument as part  
> of the queue declaration.

Sure, but what if they don't want to cooperate?

It seems to me that AMQP design in general assumes that peers always  
cooperate, which is a bit surprising for a protocol intended for  
communication across enterprises.

I guess we just have to live with that.

Cheers
Jiri


From pauljones23 at gmail.com  Tue Nov  2 08:57:01 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Tue, 2 Nov 2010 08:57:01 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <20101102094144.58325dxputwv44kk@webmail.active24.cz>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
	<4CCF3D5A.8060002@rabbitmq.com>
	<20101102093032.17587fria71q52ww@webmail.active24.cz>
	<4CCFCC98.2000000@rabbitmq.com>
	<20101102094144.58325dxputwv44kk@webmail.active24.cz>
Message-ID: <AANLkTikJ+uKNAONTJm2jyy9rCX18Zdn_E6PZEDbY1TvF@mail.gmail.com>

On Tue, Nov 2, 2010 at 8:41 AM, <jiri at krutil.com> wrote:

> You can, but they'd have to set the x-message-ttl argument as part of the
>> queue declaration.
>>
>
> Sure, but what if they don't want to cooperate?
>
> It seems to me that AMQP design in general assumes that peers always
> cooperate, which is a bit surprising for a protocol intended for
> communication across enterprises.
>

Would it perhaps to plausible to implement some kind of AMQP policy gateway
between Rabbit and the external clients? This could enforce the setting of
various attributes on the declarations, and even allow for far more advanced
rules to be applied than Rabbit might want to support.

Paul.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101102/9fb5348c/attachment.htm>

From matthias at rabbitmq.com  Tue Nov  2 08:59:51 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 02 Nov 2010 08:59:51 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <20101102094144.58325dxputwv44kk@webmail.active24.cz>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
	<4CCF3D5A.8060002@rabbitmq.com>
	<20101102093032.17587fria71q52ww@webmail.active24.cz>
	<4CCFCC98.2000000@rabbitmq.com>
	<20101102094144.58325dxputwv44kk@webmail.active24.cz>
Message-ID: <4CCFD307.8030907@rabbitmq.com>

Jiri,

jiri at krutil.com wrote:
>> You can, but they'd have to set the x-message-ttl argument as part of 
>> the queue declaration.
> 
> Sure, but what if they don't want to cooperate?
> 
> It seems to me that AMQP design in general assumes that peers always 
> cooperate, which is a bit surprising for a protocol intended for 
> communication across enterprises.

One way to get more control over what clients are doing is to insert an 
AMQP proxy. Proxies are great for dealing with authentication and 
authorisation, load balancing, throttling, etc.

In this specific case you could have a proxy that inspects all 
queue.declare commands and either rejects those w/o an appropriate 
x-message-ttl or inserts the x-message-ttl on the client's behalf.


Regards,

Matthias.

From jiri at krutil.com  Tue Nov  2 09:06:02 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Tue, 02 Nov 2010 10:06:02 +0100
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <4CCFD307.8030907@rabbitmq.com>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
	<4CCF3D5A.8060002@rabbitmq.com>
	<20101102093032.17587fria71q52ww@webmail.active24.cz>
	<4CCFCC98.2000000@rabbitmq.com>
	<20101102094144.58325dxputwv44kk@webmail.active24.cz>
	<4CCFD307.8030907@rabbitmq.com>
Message-ID: <20101102100602.18641yq77pefo1hc@webmail.active24.cz>

Matthias,

> One way to get more control over what clients are doing is to insert  
> an AMQP proxy. Proxies are great for dealing with authentication and  
> authorisation, load balancing, throttling, etc.
>
> In this specific case you could have a proxy that inspects all  
> queue.declare commands and either rejects those w/o an appropriate  
> x-message-ttl or inserts the x-message-ttl on the client's behalf.

Interesting. How would I go about doing that?
Is there a tutorial or documentation I could look at?

Cheers
Jiri


From matthias at rabbitmq.com  Tue Nov  2 09:22:02 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 02 Nov 2010 09:22:02 +0000
Subject: [rabbitmq-discuss] Protection against slow consumers
In-Reply-To: <20101102100602.18641yq77pefo1hc@webmail.active24.cz>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>
	<4CCEE713.4090603@rabbitmq.com>
	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>
	<4CCF16F7.9080908@rabbitmq.com>
	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>
	<4CCF3D5A.8060002@rabbitmq.com>
	<20101102093032.17587fria71q52ww@webmail.active24.cz>
	<4CCFCC98.2000000@rabbitmq.com>
	<20101102094144.58325dxputwv44kk@webmail.active24.cz>
	<4CCFD307.8030907@rabbitmq.com>
	<20101102100602.18641yq77pefo1hc@webmail.active24.cz>
Message-ID: <4CCFD83A.4020909@rabbitmq.com>

Jiri,

jiri at krutil.com wrote:
>> One way to get more control over what clients are doing is to insert 
>> an AMQP proxy [...]
> 
> Interesting. How would I go about doing that?

Our tracer tool (http://www.rabbitmq.com/examples.html#tracer) would be 
a starting point. See 
http://hg.rabbitmq.com/rabbitmq-java-client/file/default/src/com/rabbitmq/tools/Tracer.java 
for the code.

Though if I was working on this myself I'd probably write it in Erlang.

I reckon an AMQP proxy with some pluggable logic would be a great asset 
to many AMQP users.

Regards,

Matthias.

From bkjones at gmail.com  Wed Nov  3 01:48:00 2010
From: bkjones at gmail.com (Brian Jones)
Date: Tue, 2 Nov 2010 21:48:00 -0400
Subject: [rabbitmq-discuss] Seeking 'right way' to do IPC
In-Reply-To: <220C6709-C115-475E-945C-E4C89B0BFDFA@npcinternational.com>
References: <AANLkTi=YaasxW7fUb26MK=fiSXxX6d_gecXC7VgYuYWx@mail.gmail.com>
	<220C6709-C115-475E-945C-E4C89B0BFDFA@npcinternational.com>
Message-ID: <AANLkTinfkW6sFHDY0-ipP972ypHbzT9_qWW5hzLOQ2C6@mail.gmail.com>

On Mon, Nov 1, 2010 at 5:30 PM, Jon Brisbin <
jon.brisbin at npcinternational.com> wrote:

>
> IMHO it's easier to decide whether a message is your own message or not (by
> setting your own name in a header) in the consumer and toss it if it is.
> I've done this before and it's easier than creating complicated routing
> rules to prevent the producer from receiving its own message, given the
> simplicity of fanout exchanges. It's simple and it works (my favorite! :).
>

With all due respect, I'm not after easier from a dev perspective, I'm after
more efficient from an overall workflow and performance perspective.

I'm currently doing as you suggest, and I've done it on other projects as
well, and it works, but I wouldn't call it "right". Consider that in a
scenario where hundreds or thousands of messages per second are being
processed, every single consumer has to *consume* every single message
whether they sent it or not. This is inelegant, in addition to being
inefficient.

Also, what in the world could be easier than simply not getting the messages
you published? ;-)


> Basic.Reject might also be something to look at here:
>
>
> http://www.rabbitmq.com/blog/2010/08/03/well-ill-let-you-go-basicreject-in-rabbitmq/
>
>
>From the spec:

 The client MUST NOT use this method as a means of selecting messages to
> process.


There's also nothing in there saying that the message is not actually
delivered. It's not a 'standing' rejection of items matching some routing
key, it appears to be meant for clients who, for whatever reason, are unable
to process the message "at this time".


> FWIW- I've found it's almost always easier to deal with messages by
> deciding what to do with them after you've consumed them rather than by
> trying to prevent them from ever going to your consumers in the first place.
> I can also shove more messages down the pipe because it doesn't have to try
> and figure out whether or not to deliver a message.
>

I should think it *has* to be more costly in the scope of the wider
application environment to deliver a message and make the decision on the
client end than to have RabbitMQ do the check before delivering. That said,
I also agree that, given Rabbit's inability to do this at the moment, doing
it on the client *is* easier.

Thanks for the insights. At least I know I'm not the only one doing things
this way.

brian



>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>


-- 
Brian K. Jones
My Blog          http://www.protocolostomy.com
Follow me      http://twitter.com/bkjones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101102/20ce8936/attachment.htm>

From matthias at rabbitmq.com  Wed Nov  3 08:43:12 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 03 Nov 2010 08:43:12 +0000
Subject: [rabbitmq-discuss] Missing features making me look at moving
 off RabbitMQ
In-Reply-To: <D0488A7C-F5F8-4043-9C7A-270FEB0887B1@mozilla.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>	<AANLkTimz-U2=xyPefsh3EYmtOdGtcyMUA-8bHp=k_0Js@mail.gmail.com>
	<D0488A7C-F5F8-4043-9C7A-270FEB0887B1@mozilla.com>
Message-ID: <4CD120A0.4090001@rabbitmq.com>

Christian,

On 01/11/10 18:46, Christian Legnitto wrote:
> Hmmm, I hadn't really thought of that, I'll look into it. You mean
> adding something like "secure.level.1" to the routing key and only
> letting certain users bind with with that?

I suspect Scott thought your "security tokens" were cryptographically
strong tokens the possession of which entitles a user to receive certain
information.

> Is there a way to restrict bindings based on routing keys?

No. Though that is something a proxy could do.

> Also, wouldn't # and * bypass that?

No. Though again a proxy could prohibit such wildcard bindings.


It is unclear from your description of the problem how the 
confidentiality constraints are expressed. Some piece of information 
gets publish and should be routed only to those consumers which are 
allowed to receive it. Leaving aside the specifics of rabbit, what would 
the algorithm look like that decides whether a particular consumer 
should receive the message? I.e. define the function 
ShouldReceive(someData, someInformationAboutConsumer).


Regards,

Matthias.

From adamka at dgt.com.pl  Wed Nov  3 10:06:47 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Wed, 03 Nov 2010 11:06:47 +0100
Subject: [rabbitmq-discuss] Subscription queue and exchange by event
Message-ID: <4CD13437.5070002@dgt.com.pl>

Hi,

I'm looking for how to subscribe queues and exchanges no synchronously 
but by events.  Message come and event fired.
  I'm sure somebody done it before. Can you tell what changes I need to 
do? Some code will be very usefull.



Regards

Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From jiri at krutil.com  Wed Nov  3 10:08:20 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Wed, 03 Nov 2010 11:08:20 +0100
Subject: [rabbitmq-discuss] AlreadyClosedException in Java client
Message-ID: <20101103110820.13993ux6m3d1j1q8@webmail.active24.cz>

Our Java client sometimes (randomly) can't publish a message:  
AlreadyClosedException: clean connection shutdown; reason: Attempt to  
use closed channel

The client uses a single connection and multiple channels across  
multiple threads.

I'm seeing this error in a method, which creates a channel, publishes  
a single message using basicPublish and closes the channel. It seems  
that the problem occurs when the method is being invoked in a loop  
from two threads at the same time. The channel is a local variable,  
the connection is a member variable. The calls to  
Connection.createChannel are not synchronized.

I have a shutdown listener registered on the connection, which did not  
get called. The connection seems to be alive. Without restarting the  
client or reconnecting, another attempt to publish succeeds.

We are using broker and client version 2.1.0.
Below is broker status after such an error while the client is still up.

Any ideas?

Cheers
Jiri



rabbitmqctl list_channels
Listing channels ...
<rabbit at titan.11596.0>  capacity        false   1       0
<rabbit at titan.11600.0>  capacity        false   0       0
...done.

rabbitmqctl list_connections
Listing connections ...
capacity        172.20.12.132   1187    running
...done.

rabbitmqctl status
Status of node rabbit at titan ...
[{running_applications,[{rabbit,"RabbitMQ","2.1.0"},
                         {ssl,"Erlang/OTP SSL application","4.0.1"},
                         {public_key,"Public key infrastructure","0.8"},
                         {crypto,"CRYPTO version 2","2.0.1"},
                         {os_mon,"CPO  CXC 138 46","2.2.5"},
                         {sasl,"SASL  CXC 138 11","2.1.9.2"},
                         {mnesia,"MNESIA  CXC 138 12","4.4.15"},
                         {stdlib,"ERTS  CXC 138 10","1.17.1"},
                         {kernel,"ERTS  CXC 138 10","2.14.1"}]},
  {nodes,[{disc,[rabbit at titan]}]},
  {running_nodes,[rabbit at titan]}]
...done.


From matthias at rabbitmq.com  Wed Nov  3 10:12:17 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 03 Nov 2010 10:12:17 +0000
Subject: [rabbitmq-discuss] AlreadyClosedException in Java client
In-Reply-To: <20101103110820.13993ux6m3d1j1q8@webmail.active24.cz>
References: <20101103110820.13993ux6m3d1j1q8@webmail.active24.cz>
Message-ID: <4CD13581.1050602@rabbitmq.com>

Jiri,

On 03/11/10 10:08, jiri at krutil.com wrote:
> Our Java client sometimes (randomly) can't publish a message:
> AlreadyClosedException: clean connection shutdown; reason: Attempt to
> use closed channel

Is there any error message in the server log?

Regards,

Matthias.

From emile at rabbitmq.com  Wed Nov  3 10:22:26 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 03 Nov 2010 10:22:26 +0000
Subject: [rabbitmq-discuss] Subscription queue and exchange by event
In-Reply-To: <4CD13437.5070002@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl>
Message-ID: <4CD137E2.3050707@rabbitmq.com>

Hi Adam,

On 03/11/10 10:06, Adam Kaminiecki wrote:
> Hi,
> 
> I'm looking for how to subscribe queues and exchanges no synchronously
> but by events.  Message come and event fired.
>  I'm sure somebody done it before. Can you tell what changes I need to
> do? Some code will be very usefull.

I assume an asynchronous callback will be sufficient and that you don't
need a .net event. The standard way is to subclass DefaultBasicConsumer
and override HandleBasicDeliver. You can take a look at LowLevelLogTail
for an example of how to do this. You need to be aware of the threading
constraints imposed by this solution, as explained in the .net user guide.


Regards

Emile

From jiri at krutil.com  Wed Nov  3 11:27:27 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Wed, 03 Nov 2010 12:27:27 +0100
Subject: [rabbitmq-discuss] AlreadyClosedException in Java client
In-Reply-To: <4CD13581.1050602@rabbitmq.com>
References: <20101103110820.13993ux6m3d1j1q8@webmail.active24.cz>
	<4CD13581.1050602@rabbitmq.com>
Message-ID: <20101103122727.42532padhc4vn7y8@webmail.active24.cz>

Matthias,

>> Our Java client sometimes (randomly) can't publish a message:
>> AlreadyClosedException: clean connection shutdown; reason: Attempt to
>> use closed channel
>
> Is there any error message in the server log?

There are errors like this on the server, which might very well be related:

=ERROR REPORT==== 3-Nov-2010::11:04:24 ===
connection <0.17229.0> (running), channel 4 - error:
{amqp_error,not_found,
             "no exchange 'foo' in vhost '/capacity/development'",
             'basic.publish'}

Is it possible that this is the actual problem and the Java client is  
only reporting misleading error messages?

Cheers
Jiri


From matthias at rabbitmq.com  Wed Nov  3 11:40:58 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 03 Nov 2010 11:40:58 +0000
Subject: [rabbitmq-discuss] AlreadyClosedException in Java client
In-Reply-To: <20101103122727.42532padhc4vn7y8@webmail.active24.cz>
References: <20101103110820.13993ux6m3d1j1q8@webmail.active24.cz>
	<4CD13581.1050602@rabbitmq.com>
	<20101103122727.42532padhc4vn7y8@webmail.active24.cz>
Message-ID: <4CD14A4A.9070004@rabbitmq.com>

Jiri,

On 03/11/10 11:27, jiri at krutil.com wrote:
> There are errors like this on the server, which might very well be related:
>
> =ERROR REPORT==== 3-Nov-2010::11:04:24 ===
> connection <0.17229.0> (running), channel 4 - error:
> {amqp_error,not_found,
> "no exchange 'foo' in vhost '/capacity/development'",
> 'basic.publish'}
>
> Is it possible that this is the actual problem

Yes.

> and the Java client is only reporting misleading error messages?

Publishing is asynchronous, which means basic.publish itself will never 
"return" any error that it may have triggered. Instead the error is 
handled asynchronously by the client library code. The 
AlreadyClosedException you are seeing is due to library having received 
and processed the server-initiated channel.close already by the time the 
application tries to close the channel.

Regards,

Matthias.

From jiri at krutil.com  Wed Nov  3 11:48:39 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Wed, 03 Nov 2010 12:48:39 +0100
Subject: [rabbitmq-discuss] AlreadyClosedException in Java client
In-Reply-To: <4CD14A4A.9070004@rabbitmq.com>
References: <20101103110820.13993ux6m3d1j1q8@webmail.active24.cz>
	<4CD13581.1050602@rabbitmq.com>
	<20101103122727.42532padhc4vn7y8@webmail.active24.cz>
	<4CD14A4A.9070004@rabbitmq.com>
Message-ID: <20101103124839.20365kdhqh887b40@webmail.active24.cz>

Matthias,

>> Is it possible that this is the actual problem
>> and the Java client is only reporting misleading error messages?
>
> Publishing is asynchronous, which means basic.publish itself will  
> never "return" any error that it may have triggered. Instead the  
> error is handled asynchronously by the client library code. The  
> AlreadyClosedException you are seeing is due to library having  
> received and processed the server-initiated channel.close already by  
> the time the application tries to close the channel.

Is there a way to say that the channel should remain open even if an  
error occurs in basic.publish?

Or a way how to get register a channel.close listener, so that I know  
I need to re-open the channel in case I want to continue using it?

Thanks
Jiri


From matthias at rabbitmq.com  Wed Nov  3 11:57:37 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 03 Nov 2010 11:57:37 +0000
Subject: [rabbitmq-discuss] AlreadyClosedException in Java client
In-Reply-To: <20101103124839.20365kdhqh887b40@webmail.active24.cz>
References: <20101103110820.13993ux6m3d1j1q8@webmail.active24.cz>
	<4CD13581.1050602@rabbitmq.com>
	<20101103122727.42532padhc4vn7y8@webmail.active24.cz>
	<4CD14A4A.9070004@rabbitmq.com>
	<20101103124839.20365kdhqh887b40@webmail.active24.cz>
Message-ID: <4CD14E31.3090205@rabbitmq.com>

Jiri,

On 03/11/10 11:48, jiri at krutil.com wrote:
> Is there a way to say that the channel should remain open even if an
>  error occurs in basic.publish?

No, all errors in AMQP close either the channel or the connection.

> Or a way how to get register a channel.close listener,

Yes. See Channel.addShutdownListener et al.

> so that I know I  need to re-open the channel in case I want to
> continue using it?

There is a good chance that anything you do along these lines will be 
racy. Since the errors arrive asynchronously it generally is impossible 
to guarantee that the invocation of a method on a channel won't fail 
with an AlreadyClosedException. So you may want to catch that exception 
and re-open the channel then.


Regards,

Matthias.

From tonyg at rabbitmq.com  Wed Nov  3 12:40:13 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Wed, 03 Nov 2010 08:40:13 -0400
Subject: [rabbitmq-discuss] The Assumption Of Cooperative Peers (was Re:
 Protection against slow consumers)
In-Reply-To: <20101102094144.58325dxputwv44kk@webmail.active24.cz>
References: <20101101132244.100175927nswe1wk@webmail.active24.cz>	<4CCEE713.4090603@rabbitmq.com>	<20101101173323.49957a8l9sdaafoc@webmail.active24.cz>	<4CCF16F7.9080908@rabbitmq.com>	<745D0186-80B9-4DF0-A658-1DA206B8F013@krutil.com>	<4CCF3D5A.8060002@rabbitmq.com>	<20101102093032.17587fria71q52ww@webmail.active24.cz>	<4CCFCC98.2000000@rabbitmq.com>
	<20101102094144.58325dxputwv44kk@webmail.active24.cz>
Message-ID: <4CD1582D.5060704@rabbitmq.com>

On 02/11/2010 04:41, jiri at krutil.com wrote:
> It seems to me that AMQP design in general assumes that peers always cooperate,
> which is a bit surprising for a protocol intended for communication across
> enterprises.

That is a REALLY INTERESTING POINT. It's a thought that should inform future
development of the AMQP (or STOMP, or any other messaging) protocol.

Tony

From jiri at krutil.com  Wed Nov  3 14:19:49 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Wed, 03 Nov 2010 15:19:49 +0100
Subject: [rabbitmq-discuss] Java client: Closing channel in channel shutdown
	listener
Message-ID: <20101103151949.852626bywqo1q2dc@webmail.active24.cz>

Using the Java client, I have a shutdown listener registered on a  
channel. When this listener gets invoked, I attempt to close all AMQP  
resources. This includes closing other channels.

When I attempt to close another channel inside the channel shutdown  
listener, the connection thread seems to hang. The call stack looks  
like this:

	BlockingValueOrException<V,E>.uninterruptibleGetValue(int) line: 51
	AMQChannel$SimpleBlockingRpcContinuation(AMQChannel$BlockingRpcContinuation<T>).getReply(int) line:  
348
	ChannelN.close(int, String, boolean, Throwable, boolean) line: 416
	ChannelN.close(int, String) line: 360
	ChannelN.close() line: 353
	MyClass.shutdownCompleted(ShutdownSignalException) line: 40
	ChannelN(ShutdownNotifierComponent).notifyListeners() line: 74
	ChannelN.processAsync(Command) line: 242
	ChannelN(AMQChannel).handleCompleteInboundCommand(AMQCommand) line: 165
	ChannelN(AMQChannel).handleFrame(Frame) line: 110
	AMQConnection$MainLoop.run() line: 434

Both broker and Java client are 2.1.0.

Am I doing something I shouldn't?

Cheers
Jiri


From simon at rabbitmq.com  Wed Nov  3 14:35:09 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 03 Nov 2010 14:35:09 +0000
Subject: [rabbitmq-discuss] Java client: Closing channel in channel
 shutdown listener
In-Reply-To: <20101103151949.852626bywqo1q2dc@webmail.active24.cz>
References: <20101103151949.852626bywqo1q2dc@webmail.active24.cz>
Message-ID: <4CD1731D.5080602@rabbitmq.com>

On 03/11/10 14:19, jiri at krutil.com wrote:
> Using the Java client, I have a shutdown listener registered on a
> channel. When this listener gets invoked, I attempt to close all AMQP
> resources. This includes closing other channels.
>
> When I attempt to close another channel inside the channel shutdown
> listener, the connection thread seems to hang. The call stack looks like
> this:

Hi Jiri. The shutdown listener is invoked by the connection's mainloop 
thread, so it can't in itself do anything that involves sending data 
over the connection (which includes closing channels).

Do you need to close channels? If the error is hard, the connection will 
be closed and implicitly all channels will close; if the error is soft 
only the channel that caused the error will close and the others will 
keep working.

Cheers, Simon

>
> BlockingValueOrException<V,E>.uninterruptibleGetValue(int) line: 51
> AMQChannel$SimpleBlockingRpcContinuation(AMQChannel$BlockingRpcContinuation<T>).getReply(int)
> line: 348
> ChannelN.close(int, String, boolean, Throwable, boolean) line: 416
> ChannelN.close(int, String) line: 360
> ChannelN.close() line: 353
> MyClass.shutdownCompleted(ShutdownSignalException) line: 40
> ChannelN(ShutdownNotifierComponent).notifyListeners() line: 74
> ChannelN.processAsync(Command) line: 242
> ChannelN(AMQChannel).handleCompleteInboundCommand(AMQCommand) line: 165
> ChannelN(AMQChannel).handleFrame(Frame) line: 110
> AMQConnection$MainLoop.run() line: 434
>
> Both broker and Java client are 2.1.0.
>
> Am I doing something I shouldn't?
>
> Cheers
> Jiri
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From adamka at dgt.com.pl  Wed Nov  3 13:51:33 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Wed, 03 Nov 2010 14:51:33 +0100
Subject: [rabbitmq-discuss] Connection close forced
Message-ID: <4CD168E5.5060406@dgt.com.pl>

Hi,

Im connecting to broker and before i going to send a message event occurs
ConnectionShutdown  with  reason "Connection close forced" code=200


my code:

var conFactory = new ConnectionFactory {Address = server};
                 using (conn = conFactory.CreateConnection())
                 {
                     conn.AutoClose = false;

                     using (var channel = conn.CreateModel())
                     {
                         channel.BasicReturn += new 
RabbitMQ.Client.Events.BasicReturnEventHandler(channel_BasicReturn);
                         if (channel.IsOpen)
                         {
                             channel.QueueDeclare(RmqQueue);
                         }

                     }
                 }
here event occurs

after that I'm using
byte[] messageBodyBytes = System.Text.Encoding.UTF8.GetBytes(message);
                 if (channel.IsOpen)
                 {
                     channel.BasicPublish(RmqQueue, RmqQueue, null, 
messageBodyBytes);
                 }

channel and connection is closed after QueueDeclare
what I'm doing wrong?


Regards,
Adam


-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From emile at rabbitmq.com  Wed Nov  3 15:10:58 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 03 Nov 2010 15:10:58 +0000
Subject: [rabbitmq-discuss] Connection close forced
In-Reply-To: <4CD168E5.5060406@dgt.com.pl>
References: <4CD168E5.5060406@dgt.com.pl>
Message-ID: <4CD17B82.40308@rabbitmq.com>

Hi Adam,

On 03/11/10 13:51, Adam Kaminiecki wrote:
> Hi,
> 
> Im connecting to broker and before i going to send a message event occurs
> ConnectionShutdown  with  reason "Connection close forced" code=200
> 
> 
> my code:
> 
> var conFactory = new ConnectionFactory {Address = server};
>                 using (conn = conFactory.CreateConnection())
>                 {
>                     conn.AutoClose = false;
> 
>                     using (var channel = conn.CreateModel())
>                     {
>                         channel.BasicReturn += new
> RabbitMQ.Client.Events.BasicReturnEventHandler(channel_BasicReturn);
>                         if (channel.IsOpen)
>                         {
>                             channel.QueueDeclare(RmqQueue);
>                         }
> 
>                     }
>                 }
> here event occurs
> 
> after that I'm using
> byte[] messageBodyBytes = System.Text.Encoding.UTF8.GetBytes(message);
>                 if (channel.IsOpen)
>                 {
>                     channel.BasicPublish(RmqQueue, RmqQueue, null,
> messageBodyBytes);
>                 }
> 
> channel and connection is closed after QueueDeclare
> what I'm doing wrong?

The reason for the problem is that the connection and channel are both
scoped with using{}. Both have been disposed at the point where you try
to use them. The examples contain some illustrations of how to scope the
connection and channel correctly.

Regards

Emile


From philippe.blayo at gmail.com  Wed Nov  3 15:12:37 2010
From: philippe.blayo at gmail.com (Philippe Blayo)
Date: Wed, 3 Nov 2010 16:12:37 +0100
Subject: [rabbitmq-discuss] Is it safe to interrupt nextDelivery() ?
Message-ID: <AANLkTi=xmRqb=exKrMC68gfa_HvQwCPYkH5woBQeHp4r@mail.gmail.com>

Hello,


For our fitnesse tests, we have a thread that consumes messages and is
interrupted after a time out. It is interrupted most of the time in
the blocking call to QueuingConsummer.nextDelivery(). We observe that
there is a pending message that is not taken and not acknowledged :

$ rabbitmqctl list_queues name messages_ready messages_unacknowledged
Listing queues ...
STAT_PRINCIPALE 1       1
...done.

Our consumer receive an InterruptedException via
ExecutorService.shutdownNow() in queue.take() in the QueuingConsummer.
We reuse channels on the same connection but not on two concurrent
threads at a time.

Is there a better way to close the QueuingConsummer.nextDelivery() ?

-- 
Philippe Blayo & Bruno Thomas

From stanislav.pogrebnyak at gmail.com  Wed Nov  3 15:18:07 2010
From: stanislav.pogrebnyak at gmail.com (cthulhu)
Date: Wed, 3 Nov 2010 08:18:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Ubuntu 10.04 installation troubles
Message-ID: <9b60fc01-a00d-4ea1-9886-bd1ccac2ff63@u17g2000yqi.googlegroups.com>

Hi I'm trying to install RabbitMQ on Ubuntu 10.04 and after
installation server doesnt want to start


sudo /etc/init.d/rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/
startup_log, _err
rabbitmq-server.

 cat /var/log/rabbitmq/startup_log
Starting all nodes...
Starting node rabbit at switchplayed...

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.2  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at switchplayed
app descriptor: /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../
ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : k6w2+82lfC+dn9tB9fQtFw==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit

starting internal event notification
system                           ...done
starting logging
server                                               ...done
starting
database                                                     ...done
-- kernel ready
starting alarm
handler                                                ...done
starting queue
supervisor                                             ...done
starting node
monitor                                                 ...done
starting cluster
router                                               ...done
-- core initialized
starting empty DB
check                                               ...done
starting codec correctness
check                                      ...done
starting exchange
recovery                                            ...done
starting queue
recovery                                               ...done
starting
persister                                                    ...done
starting guid
generator                                               ...done
-- message delivery logic ready
starting error log
relay                                              ...done
starting
networking                                                   ...BOOT
ERROR: FAILED
Reason: {{badmatch,
             {error,
                 {shutdown,
 
{child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',
                         {tcp_listener_sup,start_link,
                             [{0,0,0,0},
                              5672,
                              [binary,
                               {packet,raw},
                               {reuseaddr,true},
                               {exit_on_close,false}],
                              {rabbit_networking,tcp_listener_started,
[]},
                              {rabbit_networking,tcp_listener_stopped,
[]},
                              {rabbit_networking,start_client,[]},
                              "TCP Listener"]},
                         transient,infinity,supervisor,
                         [tcp_listener_sup]}}}},
         [{rabbit_networking,start_listener,4},
          {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
          {rabbit_networking,boot_tcp,0},
          {rabbit_networking,boot,0},
          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
          {rabbit,run_boot_step,1},
          {rabbit,'-start/2-lc$^0/1-0-',1},
          {rabbit,start,2}]}
{"init terminating in do_boot",{{nocatch,{error,
{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,
[]]},{'EXIT',{rabbit,failure_during_boot}}}}}}},[{init,start_it,1},
{init,start_em,1}]}}

can any one helps me? I was using rabbitmq on Ubuntu 9.04 and it was
working perfectly.

Thanks

From dbecker at cpicorp.com  Wed Nov  3 15:36:09 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Wed, 3 Nov 2010 10:36:09 -0500
Subject: [rabbitmq-discuss] Ubuntu 10.04 installation troubles
In-Reply-To: <9b60fc01-a00d-4ea1-9886-bd1ccac2ff63@u17g2000yqi.googlegroups.com>
References: <9b60fc01-a00d-4ea1-9886-bd1ccac2ff63@u17g2000yqi.googlegroups.com>
Message-ID: <4CD18169.3030701@cpicorp.com>

On 11/03/2010 10:18 AM, cthulhu wrote:
> Hi I'm trying to install RabbitMQ on Ubuntu 10.04 and after
> installation server doesnt want to start

I would install the .deb from rabbitmq.com:

http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server_2.1.1-1_all.deb

It installs just fine on 10.04 and is the latest release (1.7.2 is quite
old).

Derek


From jiri at krutil.com  Wed Nov  3 15:39:13 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Wed, 03 Nov 2010 16:39:13 +0100
Subject: [rabbitmq-discuss] Java client: Closing channel in channel
 shutdown listener
In-Reply-To: <4CD1731D.5080602@rabbitmq.com>
References: <20101103151949.852626bywqo1q2dc@webmail.active24.cz>
	<4CD1731D.5080602@rabbitmq.com>
Message-ID: <20101103163913.2389274e9k5plg74@webmail.active24.cz>

Simon,

> Hi Jiri. The shutdown listener is invoked by the connection's  
> mainloop thread, so it can't in itself do anything that involves  
> sending data over the connection (which includes closing channels).

OK. Can I close the connection from a channel shutdown listener?

> Do you need to close channels? If the error is hard, the connection  
> will be closed and implicitly all channels will close; if the error  
> is soft only the channel that caused the error will close and the  
> others will keep working.

I have a few long-lived channels in my app. If any of them gets closed  
due to an error (maybe I attempt to publish to a nonexistent  
exchange), I want to close everything, re-connect and re-open my  
channels. This is to avoid a situation when a closed channel causes  
that part of the app does not work, trying to use a closed channel  
over and over again.

So I guess the easiest way to go for me is: in the channel shutdown  
listener, close the connection without trying to close channels, then  
re-connect.

Do you see any problem in that approach?

Many thanks
Jiri


From davegreggory at yahoo.com  Wed Nov  3 15:43:22 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 3 Nov 2010 08:43:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Exception on TCP connection
Message-ID: <418228.62636.qm@web111008.mail.gq1.yahoo.com>


Every once in a while we notice this error in our RabbitMQ logs. Any idea what 
this means?




 =ERROR REPORT==== 2-Nov-2010::19:37:31 ===
exception on TCP connection <0.10945.3> from 192.168.210.9:14189
{timeout,running} 
We run 2 RabbitMQ 2.0 nodes unclustered, sitting behind a load balancer.  Only 1 
RabbitMQ node active at a time in the load balancer. Second one  is there mainly 
for failing over to. 


When this happens the shutdown listener on the Java Client API does not fire in 
spite of having AMQP Heartbeats enabled. There are no other significant entries 
in the logs. Just the standard "starting TCP connection",  "closing TCP 
connection", "accepted TCP connection" and "connection_closed_abruptly" entries 
(Connection closed abruptly is just the load balancer checking whether Rabbit 
node is alive). 


      

From stanislav.pogrebnyak at gmail.com  Wed Nov  3 16:06:30 2010
From: stanislav.pogrebnyak at gmail.com (cthulhu)
Date: Wed, 3 Nov 2010 09:06:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Ubuntu 10.04 installation troubles
In-Reply-To: <4CD18169.3030701@cpicorp.com>
References: <9b60fc01-a00d-4ea1-9886-bd1ccac2ff63@u17g2000yqi.googlegroups.com>
	<4CD18169.3030701@cpicorp.com>
Message-ID: <bd56bce4-3645-4adb-b817-8cb9e37d0c97@e14g2000yqe.googlegroups.com>

I was trying that too, no luck. It looks like some dependencies aren't
sutisfied, or maybe versions doesn't match, my head is going to blow,
I was googled for the error, some one reffer to plugins, but i was
trying that too no luck. Maybe some one could help me with
understanding log files?

On 3 ???, 17:36, Derek Chen-Becker <dbec... at cpicorp.com> wrote:
> On 11/03/2010 10:18 AM, cthulhu wrote:
>
> > Hi I'm trying to install RabbitMQ on Ubuntu 10.04 and after
> > installation server doesnt want to start
>
> I would install the .deb from rabbitmq.com:
>
> http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-serv...
>
> It installs just fine on 10.04 and is the latest release (1.7.2 is quite
> old).
>
> Derek
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dbecker at cpicorp.com  Wed Nov  3 16:16:17 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Wed, 3 Nov 2010 11:16:17 -0500
Subject: [rabbitmq-discuss] Ubuntu 10.04 installation troubles
In-Reply-To: <bd56bce4-3645-4adb-b817-8cb9e37d0c97@e14g2000yqe.googlegroups.com>
References: <9b60fc01-a00d-4ea1-9886-bd1ccac2ff63@u17g2000yqi.googlegroups.com>	<4CD18169.3030701@cpicorp.com>
	<bd56bce4-3645-4adb-b817-8cb9e37d0c97@e14g2000yqe.googlegroups.com>
Message-ID: <4CD18AD1.5060703@cpicorp.com>

On 11/03/2010 11:06 AM, cthulhu wrote:
> I was trying that too, no luck. It looks like some dependencies aren't
> sutisfied, or maybe versions doesn't match, my head is going to blow,
> I was googled for the error, some one reffer to plugins, but i was
> trying that too no luck. Maybe some one could help me with
> understanding log files?

Well, I don't really know Erlang (or RabbitMQ's logs) well, but from
your log it appears that the error is occurring when RabbitMQ tries to
bind to TCP port 5672. By any chance is something already on that port?

Derek

From stanislav.pogrebnyak at gmail.com  Wed Nov  3 16:41:48 2010
From: stanislav.pogrebnyak at gmail.com (cthulhu)
Date: Wed, 3 Nov 2010 09:41:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Ubuntu 10.04 installation troubles
In-Reply-To: <4CD18AD1.5060703@cpicorp.com>
References: <9b60fc01-a00d-4ea1-9886-bd1ccac2ff63@u17g2000yqi.googlegroups.com>
	<4CD18169.3030701@cpicorp.com>
	<bd56bce4-3645-4adb-b817-8cb9e37d0c97@e14g2000yqe.googlegroups.com>
	<4CD18AD1.5060703@cpicorp.com>
Message-ID: <12ab4c58-886a-432a-ae53-fcee658101b1@v20g2000yqb.googlegroups.com>

Ohhh Thanks a lot - thats it, it was frozen rabbitmq process, I killed
it with -9 and now everything is ok. Weard that restart doesn't affect
anything.

On 3 ???, 18:16, Derek Chen-Becker <dbec... at cpicorp.com> wrote:
> On 11/03/2010 11:06 AM, cthulhu wrote:
>
> > I was trying that too, no luck. It looks like some dependencies aren't
> > sutisfied, or maybe versions doesn't match, my head is going to blow,
> > I was googled for the error, some one reffer to plugins, but i was
> > trying that too no luck. Maybe some one could help me with
> > understanding log files?
>
> Well, I don't really know Erlang (or RabbitMQ's logs) well, but from
> your log it appears that the error is occurring when RabbitMQ tries to
> bind to TCP port 5672. By any chance is something already on that port?
>
> Derek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tranzenziuzex at gmail.com  Wed Nov  3 17:15:55 2010
From: tranzenziuzex at gmail.com (T-zex)
Date: Wed, 3 Nov 2010 17:15:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ message receiving slower than publishing
Message-ID: <AANLkTikAsOGgm+r7DpVVMiSprQ2qcqnZLXrReEnnGtvN@mail.gmail.com>

Hi,

We are running the latest version of RabbitMQ 2.1.1 on windows server,
and using .Net client. We are running a test as follows: publishing
500000 messages to the transcient non durable fanout exchange, the
client uses autodelete queue. There is only one queue. Publisher sends
~ 10K messages per second. After all messages are sent it disconnects.
rabbitmqctl tool is showing that queue size is 0, but receiver is
still getting messages for a few seconds, it has received only 60% of
messages. Do you know why there is such a delay and how to minimize
it?

Cheers!

From matthew at rabbitmq.com  Wed Nov  3 17:19:37 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 3 Nov 2010 17:19:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ message receiving slower than
 publishing
In-Reply-To: <AANLkTikAsOGgm+r7DpVVMiSprQ2qcqnZLXrReEnnGtvN@mail.gmail.com>
References: <AANLkTikAsOGgm+r7DpVVMiSprQ2qcqnZLXrReEnnGtvN@mail.gmail.com>
Message-ID: <20101103171937.GC22102@rabbitmq.com>

On Wed, Nov 03, 2010 at 05:15:55PM +0000, T-zex wrote:
> We are running the latest version of RabbitMQ 2.1.1 on windows server,
> and using .Net client. We are running a test as follows: publishing
> 500000 messages to the transcient non durable fanout exchange, the
> client uses autodelete queue. There is only one queue. Publisher sends
> ~ 10K messages per second. After all messages are sent it disconnects.
> rabbitmqctl tool is showing that queue size is 0, but receiver is
> still getting messages for a few seconds, it has received only 60% of
> messages. Do you know why there is such a delay and how to minimize
> it?

Receiver has no qos set and is using basic.consume? As a result, the
broker has sent all messages to the receiver (thus the queue is empty),
but the receiver has not processed them all yet.

Assuming the receiver is acknowledging messages (noAck = false), if you
watch the number of unacknowledged messages in the queue, you should see
that drop as the receiver churns through its backlog.

...is my guess.

Matthew

From tranzenziuzex at gmail.com  Wed Nov  3 17:43:42 2010
From: tranzenziuzex at gmail.com (T-zex)
Date: Wed, 3 Nov 2010 17:43:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ message receiving slower than
	publishing
In-Reply-To: <20101103171937.GC22102@rabbitmq.com>
References: <AANLkTikAsOGgm+r7DpVVMiSprQ2qcqnZLXrReEnnGtvN@mail.gmail.com>
	<20101103171937.GC22102@rabbitmq.com>
Message-ID: <AANLkTikyEpE3wp3UN_9Nkcw0jgREO61PDNUOKvQM3hU7@mail.gmail.com>

Thank you Matthew.

Yes, we are using IModel.BasicConsume, noAck = false.
We use DefaultBasicConsumer and HandleBasicDeliver override is just
incrementing the counter in this test, so no latency here.
What do you mean by "broker has sent all messages to the receiver"? We
are not using QueueingBasicConsumer.

The documentation says "RabbitMQ operates at sub-millisecond latency
in transient mode under a load of 10k messages per second."
Is this sending and receiving or is it just sending? We can achieve
10k sending but receiving is 7k.


On Wed, Nov 3, 2010 at 5:19 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Wed, Nov 03, 2010 at 05:15:55PM +0000, T-zex wrote:
>> We are running the latest version of RabbitMQ 2.1.1 on windows server,
>> and using .Net client. We are running a test as follows: publishing
>> 500000 messages to the transcient non durable fanout exchange, the
>> client uses autodelete queue. There is only one queue. Publisher sends
>> ~ 10K messages per second. After all messages are sent it disconnects.
>> rabbitmqctl tool is showing that queue size is 0, but receiver is
>> still getting messages for a few seconds, it has received only 60% of
>> messages. Do you know why there is such a delay and how to minimize
>> it?
>
> Receiver has no qos set and is using basic.consume? As a result, the
> broker has sent all messages to the receiver (thus the queue is empty),
> but the receiver has not processed them all yet.
>
> Assuming the receiver is acknowledging messages (noAck = false), if you
> watch the number of unacknowledged messages in the queue, you should see
> that drop as the receiver churns through its backlog.
>
> ...is my guess.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Wed Nov  3 17:59:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 3 Nov 2010 17:59:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ message receiving slower than
 publishing
In-Reply-To: <AANLkTikyEpE3wp3UN_9Nkcw0jgREO61PDNUOKvQM3hU7@mail.gmail.com>
References: <AANLkTikAsOGgm+r7DpVVMiSprQ2qcqnZLXrReEnnGtvN@mail.gmail.com>
	<20101103171937.GC22102@rabbitmq.com>
	<AANLkTikyEpE3wp3UN_9Nkcw0jgREO61PDNUOKvQM3hU7@mail.gmail.com>
Message-ID: <20101103175917.GD22102@rabbitmq.com>

On Wed, Nov 03, 2010 at 05:43:42PM +0000, T-zex wrote:
> Yes, we are using IModel.BasicConsume, noAck = false.
> We use DefaultBasicConsumer and HandleBasicDeliver override is just
> incrementing the counter in this test, so no latency here.
> What do you mean by "broker has sent all messages to the receiver"? We
> are not using QueueingBasicConsumer.

Sure, but there are many buffers in between. If your messages are small
and the buffers large, all messages may be buffered in transit.

During this period, can you check what the output of is:
rabbitmqctl list_queues names messages_ready messages_unacknowledged

I would expect the messages_ready column to be 0, but the
messages_unacknowledged column to not be.

> The documentation says "RabbitMQ operates at sub-millisecond latency
> in transient mode under a load of 10k messages per second."
> Is this sending and receiving or is it just sending? We can achieve
> 10k sending but receiving is 7k.

Yup, a lot of this depends on network settings and the performance of
individual clients, message sizes, etc etc.

Matthew

From MVierling at attinteractive.com  Thu Nov  4 01:52:52 2010
From: MVierling at attinteractive.com (Michael Vierling)
Date: Wed, 3 Nov 2010 18:52:52 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <4CCE9CC1.7060200@rabbitmq.com>
References: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CCE9CC1.7060200@rabbitmq.com>
Message-ID: <237050FF255D844CBDF840D42334EB9B66C6627DFC@SFOEXM02.YELLOWPAGES.LOCAL>

>First of all, it's nice to know someone's using rabbitmqadmin

I think it is great!  Cli tools are especially important to us.  It would be doable but painful to scrape the html output.

>I'd like to not call it kvp since it's really timestamp - key/value, which seems quite Splunk-specific.

Timestamp, followed by key/value pairs seems rather generic to me :-)  But feel free to call it anything you wish, including "splunk"

>I hadn't thought of using rabbitmqadmin to generate log files. I assume the idea
>is to provide historic data for trends etc. Does Splunk always work like this?

Yes, linux tools such as ps, iostat, memstat, etc are used by Splunk in a similar manner.  I plan on polling via rabbitmqadmin every 30 seconds and then using the data for dashboard graphs.  It can be extremely helpful when troubleshooting to visually look for changes in behavior.

>How do quotes (and non-ASCII characters) need to be escaped? The link does not explain.

Splunk attempts to apply UTF-8 encoding by default.  See - http://www.splunk.com/base/Documentation/latest/Admin/Configurecharactersetencoding

> I assume you're not proposing to use any of the "standard fields"?

No, I'm not proposing this.  Also, we can add mapping tables to convert RabbitMQ keys to generic Splunk keys.

Michael

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Monday, November 01, 2010 3:56 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ and Splunk

On 30/10/10 01:13, Michael Vierling wrote:
> We're developing a Splunk plugin for RabbitMQ.  Splunk is an excellent
> log search engine and we highly recommend it. Anyway, while Splunk can
> ingest almost any log files, it prefers a key-value pair format. You can
> see this page for more details:
>
> http://www.splunk.com/wiki/Apps:Common_Information_Model
>
> So in that spirit, I'd like to propose the following patch to the
> rabbitmqadmin script, which ships with your management 2.1.1 plugin.
> This patch adds a key-value pair Splunk compatible option (kvp) to the
> script. It would be very helpful if this could be incorporated into the
> official Management plugin.

<snip>

Hi Michael.

First of all, it's nice to know someone's using rabbitmqadmin - I think 
you're the first to ask about it...

In order to accept your patch, I'd need to get you to sign our 
contributor agreement (yes, even for something this small). Or I could 
reimplement it; that might be easier.

But before that, can we clear up a few issues:

* I'd like to not call it kvp since it's really timestamp - key/value, 
which seems quite Splunk-specific.
* I hadn't thought of using rabbitmqadmin to generate log files. I 
assume the idea is to provide historic data for trends etc. Does Splunk 
always work like this?
* How do quotes (and non-ASCII characters) need to be escaped? The link 
does not explain.
* I assume you're not proposing to use any of the "standard fields"?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From adamka at dgt.com.pl  Thu Nov  4 08:14:22 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Thu, 04 Nov 2010 09:14:22 +0100
Subject: [rabbitmq-discuss] Message from queue or exchange never income
In-Reply-To: <4CD168E5.5060406@dgt.com.pl>
References: <4CD168E5.5060406@dgt.com.pl>
Message-ID: <4CD26B5E.2010802@dgt.com.pl>

Hi,

Im sending message on exchange and queues but I've never receive them on 
any other client...

I've override HandleBasicDeliver in sub class DefaultBasicConsumer like 
in example LowLevelLogTail
i dont get any errors when im using basicPublish




Regards

Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From matthias at rabbitmq.com  Thu Nov  4 08:24:18 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Nov 2010 08:24:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <237050FF255D844CBDF840D42334EB9B66C6627DFC@SFOEXM02.YELLOWPAGES.LOCAL>
References: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>	<4CCE9CC1.7060200@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627DFC@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <4CD26DB2.8030806@rabbitmq.com>

Michael,

Michael Vierling wrote:
> Yes, linux tools such as ps, iostat, memstat, etc are used by Splunk
> in a similar manner.

None of these output their data in timestamp+comma-separated-k/v format. 
So if splunk can process their output, why can't it process rabbitmqadmin's?


Regards,

Matthias.

From jiri at krutil.com  Thu Nov  4 08:41:36 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Thu, 04 Nov 2010 09:41:36 +0100
Subject: [rabbitmq-discuss] Remote configuration of users and permissions
Message-ID: <20101104094136.184673wymhs7hyww@webmail.active24.cz>

Hi

We need to set up a mechanism for automatic re-configuration of users  
and permissions on the broker whenever a change is made in our back  
end, such as adding a new user or changing user privileges.

Can you advise how could that be best done?

Cheers
Jiri


From simon at rabbitmq.com  Thu Nov  4 11:10:57 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Nov 2010 11:10:57 +0000
Subject: [rabbitmq-discuss] Java client: Closing channel in channel
 shutdown listener
In-Reply-To: <20101103163913.2389274e9k5plg74@webmail.active24.cz>
References: <20101103151949.852626bywqo1q2dc@webmail.active24.cz>
	<4CD1731D.5080602@rabbitmq.com>
	<20101103163913.2389274e9k5plg74@webmail.active24.cz>
Message-ID: <4CD294C1.9000904@rabbitmq.com>

On 03/11/10 15:39, jiri at krutil.com wrote:
> Simon,
>
>> Hi Jiri. The shutdown listener is invoked by the connection's mainloop
>> thread, so it can't in itself do anything that involves sending data
>> over the connection (which includes closing channels).
>
> OK. Can I close the connection from a channel shutdown listener?

Not directly; it has the same problem. Of course, you could just spin up 
a short-lived thread to do the closing in either case.

>> Do you need to close channels? If the error is hard, the connection
>> will be closed and implicitly all channels will close; if the error is
>> soft only the channel that caused the error will close and the others
>> will keep working.
>
> I have a few long-lived channels in my app. If any of them gets closed
> due to an error (maybe I attempt to publish to a nonexistent exchange),
> I want to close everything, re-connect and re-open my channels. This is
> to avoid a situation when a closed channel causes that part of the app
> does not work, trying to use a closed channel over and over again.

Right. Of course, you could just reopen the channel that closed, but 
your approach may be simpler.

> So I guess the easiest way to go for me is: in the channel shutdown
> listener, close the connection without trying to close channels, then
> re-connect.

If you close the connection the channels get closed implicitly. But as 
noted above, you'll need to do that in a different thread.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From adrian.jetzer at efgfp.com  Thu Nov  4 11:11:20 2010
From: adrian.jetzer at efgfp.com (JETZER Adrian)
Date: Thu, 4 Nov 2010 12:11:20 +0100
Subject: [rabbitmq-discuss] same routing key for multiple queue bindings in
 multiple exchanges
Message-ID: <3A92CBBC0DB56D488C18F62C50317A160202EF7E@CHGVASVEXC02.efgz.efg.corp>

Hello 

I just wanted to confirm an "issue" I just discovered.

It looks to me that routing keys must be unique in the entire broker. We
use the same routing-key-name for two queue bindings.

channel.queueBind("queue1", "exchange_a", "routing_key");
channel.queueBind("queue2", "exchange_b", "routing_key");

The request we send to the "routing_key" gets sometimes picked up also
by "queue2", although we say "exchange_a" in the basicPublish command.
 
channel.basicPublish("exchange_a", "routing_key", props, body);

So is this a bug or a feature?

Thanks,
Adrian

==== The EFG Mail Gateway made the following annotation ====

This message is for the addressee only and may contain confidential or
privileged information. You must delete and not use it if you are not
the intended recipient. It may not be secure or error-free. All e-mail
communications to and from the EFG Financial Products Group may be monitored.
Processing of incoming e-mails cannot be guaranteed. Any views expressed
in this message are those of the individual sender. This message is for
information purposes only. All liability of the EFG Financial Products Group
and its entities for any damages resulting from e-mail use is excluded.
US persons are kindly requested to read the important legal information
presented at following URL: http://www.efgfp.com. If you suspect that the
message may have been intercepted or amended, please call the sender.
Should you require any further information, please contact the Compliance
Manager on compliance at efgfp.com.
============================================================

From simon at rabbitmq.com  Thu Nov  4 11:14:07 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Nov 2010 11:14:07 +0000
Subject: [rabbitmq-discuss] Remote configuration of users and permissions
In-Reply-To: <20101104094136.184673wymhs7hyww@webmail.active24.cz>
References: <20101104094136.184673wymhs7hyww@webmail.active24.cz>
Message-ID: <4CD2957F.50509@rabbitmq.com>

On 04/11/10 08:41, jiri at krutil.com wrote:
> We need to set up a mechanism for automatic re-configuration of users
> and permissions on the broker whenever a change is made in our back end,
> such as adding a new user or changing user privileges.

At the moment your best bet is probably driving the management plugin's 
HTTP API from your back end whenever anything changes.

The long-talked-about pluggable authentication back end is bubbling up 
towards the top of the to do list...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Thu Nov  4 12:58:53 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 4 Nov 2010 12:58:53 +0000
Subject: [rabbitmq-discuss] same routing key for multiple queue bindings
 in multiple exchanges
In-Reply-To: <3A92CBBC0DB56D488C18F62C50317A160202EF7E@CHGVASVEXC02.efgz.efg.corp>
References: <3A92CBBC0DB56D488C18F62C50317A160202EF7E@CHGVASVEXC02.efgz.efg.corp>
Message-ID: <AANLkTinAPKMORfmRT=__DjsJt901fRrqVs7i9XnbQy0v@mail.gmail.com>

On Thu, Nov 4, 2010 at 11:11, JETZER Adrian <adrian.jetzer at efgfp.com> wrote:
> I just wanted to confirm an "issue" I just discovered.
>
> It looks to me that routing keys must be unique in the entire broker. We
> use the same routing-key-name for two queue bindings.
>
> channel.queueBind("queue1", "exchange_a", "routing_key");
> channel.queueBind("queue2", "exchange_b", "routing_key");
>
> The request we send to the "routing_key" gets sometimes picked up also
> by "queue2", although we say "exchange_a" in the basicPublish command.
>
> channel.basicPublish("exchange_a", "routing_key", props, body);
>
> So is this a bug or a feature?

I'm pretty sure it's a problem with your application.

In the configuration you've presented, message published
to "exchange_a" with "routing_key" will be delivered to "queue1".
And to "exchange_b" with "routing_key" will be delivered to "queue2".

You can list your queues/bindings/exchanges using the `rabbitmqctl` tool:
sudo rabbitmqctl list_queues
sudo rabbitmqctl list_bindings
sudo rabbitmqctl list_exchanges

You can also use our management plugin to get a www interface to
similar things: http://www.rabbitmq.com/management.html

Cheers,
  Marek

From majek04 at gmail.com  Thu Nov  4 13:02:19 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 4 Nov 2010 13:02:19 +0000
Subject: [rabbitmq-discuss] Message from queue or exchange never income
In-Reply-To: <4CD26B5E.2010802@dgt.com.pl>
References: <4CD168E5.5060406@dgt.com.pl>
	<4CD26B5E.2010802@dgt.com.pl>
Message-ID: <AANLkTi=VWWUTPKHM3wexkjg8S8f1BOBuiKRL+e34JOth@mail.gmail.com>

On Thu, Nov 4, 2010 at 08:14, Adam Kaminiecki <adamka at dgt.com.pl> wrote:
> Hi,
>
> Im sending message on exchange and queues but I've never receive them on any
> other client...
>
> I've override HandleBasicDeliver in sub class DefaultBasicConsumer like in
> example LowLevelLogTail
> i dont get any errors when im using basicPublish

Please double check if the exchange exists, and if you're
using a proper routing key (that matches a binding).

If you still can't find a problem, try to use the default
nameless exchange "" and put a queue name as
the routing key. That way you can override your exchanges
and send message kind of directly to the queue. That
should always work.

Cheers,
  Marek

From majek04 at gmail.com  Thu Nov  4 13:58:54 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 4 Nov 2010 13:58:54 +0000
Subject: [rabbitmq-discuss] unacknowledged messages lost after broker
 kill, despite consumer txCommit and noAck
In-Reply-To: <30088199.post@talk.nabble.com>
References: <30088199.post@talk.nabble.com>
Message-ID: <AANLkTim5iaSNFa6AoOc3B+FeuQ6_70ybR6EqK-Wi8E89@mail.gmail.com>

On Fri, Oct 29, 2010 at 19:46, rjwirth <rwirth at demandware.com> wrote:
>> If you really need messages to go safely to disk, then you should put
>> the channel into transactional mode (tx.select), and issue a tx.commit
>
> What about unacknowledged messages?
>
> A Producer (rabbit 2.1.1 java client, not Spring Rabbit AMQP) commits some
> persistent messages on a durable queue/exchange.
>
> The Consumer is neither ack'ing nor rejecting the message to leave it on the
> queue (and let recovery retry it later), but I am committing periodically,
> e.g.:
>
> ?QueueingConsumer.Delivery delivery = consumer.nextDelivery();
> ?// neither channel.basicReject or Ack
> ?channel.txCommit();
>
> Per ctl:
>
> ?$ rabbitmqctl list_queues name messages messages_unacknowledged
> messages_ready
> ?Listing queues ...
> ?testQueue ? ? ? 5 ? ? ? 5 ? ? ? 0
>
> Using a soft "rabbitmqctl stop", a Broker restart will make the
> unacknowledged messages ready again (as expected).
> ?testQueue ? ? ? 5 ? ? ? 0 ? ? ? 5
>
> With a Broker hardkill, the unack'd messages disappear even after I have
> just committed the channel
> ?testQueue ? ? ? 0 ? ? ? 0 ? ? ? 0
>
> Is there anything to commit on the channel if the Broker didn't get an Ack?
> Shouldn't the "lease" of the message be at least committed?

Hi,

Maybe I missed something, but I'm not able to reproduce your results.
1. I publish 5 persistent messages in a transaction (tx_select, tx_commit).
2. I receive all of them, with no_ack=False and not acknowledge manually.
3. Restart the server.

For both, hard kill and `rabbitmqctl stop` I'm able to see the messages after
rabbit is up again.

Did I get everything right?

Cheers,
  Marek

From majek04 at gmail.com  Thu Nov  4 14:02:23 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 4 Nov 2010 14:02:23 +0000
Subject: [rabbitmq-discuss] unacknowledged messages lost after broker
 kill, despite consumer txCommit and noAck
In-Reply-To: <AANLkTim5iaSNFa6AoOc3B+FeuQ6_70ybR6EqK-Wi8E89@mail.gmail.com>
References: <30088199.post@talk.nabble.com>
	<AANLkTim5iaSNFa6AoOc3B+FeuQ6_70ybR6EqK-Wi8E89@mail.gmail.com>
Message-ID: <AANLkTik3Tka+C+ybrxHv_aa1=w+x_VTkoWPiWXEXd3+J@mail.gmail.com>

On Thu, Nov 4, 2010 at 13:58, Marek Majkowski <majek04 at gmail.com> wrote:
> On Fri, Oct 29, 2010 at 19:46, rjwirth <rwirth at demandware.com> wrote:
>>> If you really need messages to go safely to disk, then you should put
>>> the channel into transactional mode (tx.select), and issue a tx.commit
>>
>> What about unacknowledged messages?
>>
>> A Producer (rabbit 2.1.1 java client, not Spring Rabbit AMQP) commits some
>> persistent messages on a durable queue/exchange.
>>
>> The Consumer is neither ack'ing nor rejecting the message to leave it on the
>> queue (and let recovery retry it later), but I am committing periodically,
>> e.g.:
>>
>> ?QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>> ?// neither channel.basicReject or Ack
>> ?channel.txCommit();
>>
>> Per ctl:
>>
>> ?$ rabbitmqctl list_queues name messages messages_unacknowledged
>> messages_ready
>> ?Listing queues ...
>> ?testQueue ? ? ? 5 ? ? ? 5 ? ? ? 0
>>
>> Using a soft "rabbitmqctl stop", a Broker restart will make the
>> unacknowledged messages ready again (as expected).
>> ?testQueue ? ? ? 5 ? ? ? 0 ? ? ? 5
>>
>> With a Broker hardkill, the unack'd messages disappear even after I have
>> just committed the channel
>> ?testQueue ? ? ? 0 ? ? ? 0 ? ? ? 0
>>
>> Is there anything to commit on the channel if the Broker didn't get an Ack?
>> Shouldn't the "lease" of the message be at least committed?
>
> Hi,
>
> Maybe I missed something, but I'm not able to reproduce your results.
> 1. I publish 5 persistent messages in a transaction (tx_select, tx_commit).
> 2. I receive all of them, with no_ack=False and not acknowledge manually.
> 3. Restart the server.
>
> For both, hard kill and `rabbitmqctl stop` I'm able to see the messages after
> rabbit is up again.
>
> Did I get everything right?

I see the same results when I do receive messages in a committed
transaction (still without acking).

Marek

From amr.mostafa at egyptdc.com  Thu Nov  4 14:05:33 2010
From: amr.mostafa at egyptdc.com (Amr Mostafa)
Date: Thu, 4 Nov 2010 16:05:33 +0200
Subject: [rabbitmq-discuss] Remote configuration of users and permissions
In-Reply-To: <20101104094136.184673wymhs7hyww@webmail.active24.cz>
References: <20101104094136.184673wymhs7hyww@webmail.active24.cz>
Message-ID: <AANLkTimu0MndAaqOJnA=zuDkVf=hD06jjvKuKbjZ+bsv@mail.gmail.com>

Hi,

On Thu, Nov 4, 2010 at 10:41 AM, <jiri at krutil.com> wrote:

> We need to set up a mechanism for automatic re-configuration of users and
> permissions on the broker whenever a change is made in our back end, such as
> adding a new user or changing user privileges.
>

Spring-AMQP has an in-progress implementation of a RabbitMQ administration
interface that speaks to RabbitMQ over the Java-Erlang interface.

http://static.springsource.org/spring-amqp/docs/1.0.x/api/org/springframework/amqp/rabbit/admin/RabbitBrokerAdmin.html

That's what I'd use now. Though historically I've also tried Alice and
implemented a Java wrapper around it, and the results were satisfying, I
didn't try the Management plugin's HTTP API before, but I'd give it a try
before Alice if I want to head down the REST API route.

Regards,
Amr
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101104/5b45d20a/attachment.htm>

From rwirth at demandware.com  Thu Nov  4 14:18:01 2010
From: rwirth at demandware.com (rjwirth)
Date: Thu, 4 Nov 2010 07:18:01 -0700 (PDT)
Subject: [rabbitmq-discuss] unacknowledged messages lost after broker
 kill, despite consumer txCommit and noAck
In-Reply-To: <AANLkTik3Tka+C+ybrxHv_aa1=w+x_VTkoWPiWXEXd3+J@mail.gmail.com>
References: <30088199.post@talk.nabble.com>
	<AANLkTim5iaSNFa6AoOc3B+FeuQ6_70ybR6EqK-Wi8E89@mail.gmail.com>
	<AANLkTik3Tka+C+ybrxHv_aa1=w+x_VTkoWPiWXEXd3+J@mail.gmail.com>
Message-ID: <30132516.post@talk.nabble.com>



Marek Majkowski wrote:
> 
> On Thu, Nov 4, 2010 at 13:58, Marek Majkowski <majek04 at gmail.com> wrote:
> 
>> Maybe I missed something, but I'm not able to reproduce your results.
>> 1. I publish 5 persistent messages in a transaction (tx_select,
>> tx_commit).
>> 2. I receive all of them, with no_ack=False and not acknowledge manually.
>> 3. Restart the server.
>>
>> For both, hard kill and `rabbitmqctl stop` I'm able to see the messages
>> after
>> rabbit is up again.
>>
>> Did I get everything right?
> 
> 

Hello Marek,
yes, I got this working too. See also
http://old.nabble.com/Lose-messages-between-restarts-of-broker-ts30071809.html.
In my initial testing, I must've had some message from a previous non-tx
producer/channel (and a tx consumer channel). This then also allows for the
consumer to run in non-tx mode; if the broker crashes, you'd incur dup
messages if an ack or reject didn't get committed in time.
Thanks
-Rudi

-----
Rudi Wirth

-- 
View this message in context: http://old.nabble.com/unacknowledged-messages-lost-after-broker-kill%2C-despite-consumer-txCommit-and-noAck-tp30088199p30132516.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Thu Nov  4 17:26:17 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 4 Nov 2010 17:26:17 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
Message-ID: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>

On Fri, Oct 29, 2010 at 19:55, Christian Legnitto <clegnitto at mozilla.com> wrote:
> [...]
> Support for WebSockets
>
> * It'd be nice for there a plugin to support websockets
> * More important for Mozilla as most tools are web-based
> * I have set it up with orbitd, but it's a pain / another moving piece / easier to uncomment a line like http://activemq.apache.org/websockets.html


Christian,

I'm interested in creating a websockets plugin for Rabbit.

But I'm not really sure how you'd like to use it.

As a thing exposed to the wild internet?
Or just as another framing for AMQP?
Or as a wire protocol for STOMP?
(like this thing http://jmesnil.net/stomp-websocket/doc/)

Or maybe you have yet another use case?

Cheers,
  Marek

From clegnitto at mozilla.com  Thu Nov  4 17:47:27 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Thu, 4 Nov 2010 10:47:27 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
Message-ID: <290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>


On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:

> On Fri, Oct 29, 2010 at 19:55, Christian Legnitto <clegnitto at mozilla.com> wrote:
>> [...]
>> Support for WebSockets
>> 
>> * It'd be nice for there a plugin to support websockets
>> * More important for Mozilla as most tools are web-based
>> * I have set it up with orbitd, but it's a pain / another moving piece / easier to uncomment a line like http://activemq.apache.org/websockets.html
> 
> 
> Christian,
> 
> I'm interested in creating a websockets plugin for Rabbit.
> 
> But I'm not really sure how you'd like to use it.
> 
> As a thing exposed to the wild internet?
> Or just as another framing for AMQP?
> Or as a wire protocol for STOMP?
> (like this thing http://jmesnil.net/stomp-websocket/doc/)
> 
> Or maybe you have yet another use case?
> 
> Cheers,
>  Marek

I was thinking more like http://jmesnil.net/stomp-websocket/doc/, as that's what I have been using. Of course, the more options the merrier :-) I can't really provide erlang help, but I'm sure I can poke the WebSocket guys here at Moz to provide any assistance required on that front.

Thanks,
Christian

From MVierling at attinteractive.com  Thu Nov  4 19:03:28 2010
From: MVierling at attinteractive.com (Michael Vierling)
Date: Thu, 4 Nov 2010 12:03:28 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <4CD26DB2.8030806@rabbitmq.com>
References: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CCE9CC1.7060200@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627DFC@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CD26DB2.8030806@rabbitmq.com>
Message-ID: <237050FF255D844CBDF840D42334EB9B66C6627EC3@SFOEXM02.YELLOWPAGES.LOCAL>

Let me turn the question around: why have messy poorly formatted log data?  Splunk has extensive tools to extract fields.  But it will always be true that having clean, well formatted log data goes a long ways towards making any extraction process easier and more reliable.

Hundreds of lines of code are needed to parse iostat, ps and the others.  Why write that code?  And don't forget the performance impact, since that data can't be properly indexed.

Best,
Michael

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Thursday, November 04, 2010 1:24 AM
To: Michael Vierling
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ and Splunk

Michael,

Michael Vierling wrote:
> Yes, linux tools such as ps, iostat, memstat, etc are used by Splunk
> in a similar manner.

None of these output their data in timestamp+comma-separated-k/v format. 
So if splunk can process their output, why can't it process rabbitmqadmin's?


Regards,

Matthias.

From therevoltingx at gmail.com  Thu Nov  4 19:07:06 2010
From: therevoltingx at gmail.com (Miguel Morales)
Date: Thu, 4 Nov 2010 12:07:06 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
Message-ID: <AANLkTikH85-ptkGq0ZGxgB_SaFaB7=tFqZVDs0np2hwU@mail.gmail.com>

I'd be very interested in this.  I haven't looked too much into it, so
I don't know what existing solutions exist.  This is what I'd like
though:
I don't need for the browser to create any queues/exchanges/bindings
so those calls are not important to me.  This should be done server
side (at least to me.)
I'd like to use it in a very text/json oriented way.  Here's how I'd
like to publish a message:

var message = new Object();
message.command = "publish";
message.queue = "myqueue";
message.exchange = "myexchange";
message.key = "mybindkey";
message.body = "hello world";

var message_json = JSON.stringify(message);

var ws = new WebSocket("ws://4.2.2.2:123");
ws.send(message_json);

Consuming:

var subscribe = new Object();
subscribe.command = "consume";
subscribe.queue = ...

ws.send(subscribe_json);

//wait for reply from server...
ws.onopen = function(event)
{
  //handle message or error here..
}

I don't need STOMP support, the websocket plugin should just require a
port for communication and delegate the commands to rabbitmq.

On Thu, Nov 4, 2010 at 10:47 AM, Christian Legnitto
<clegnitto at mozilla.com> wrote:
>
> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>
>> On Fri, Oct 29, 2010 at 19:55, Christian Legnitto <clegnitto at mozilla.com> wrote:
>>> [...]
>>> Support for WebSockets
>>>
>>> * It'd be nice for there a plugin to support websockets
>>> * More important for Mozilla as most tools are web-based
>>> * I have set it up with orbitd, but it's a pain / another moving piece / easier to uncomment a line like http://activemq.apache.org/websockets.html
>>
>>
>> Christian,
>>
>> I'm interested in creating a websockets plugin for Rabbit.
>>
>> But I'm not really sure how you'd like to use it.
>>
>> As a thing exposed to the wild internet?
>> Or just as another framing for AMQP?
>> Or as a wire protocol for STOMP?
>> (like this thing http://jmesnil.net/stomp-websocket/doc/)
>>
>> Or maybe you have yet another use case?
>>
>> Cheers,
>> ?Marek
>
> I was thinking more like http://jmesnil.net/stomp-websocket/doc/, as that's what I have been using. Of course, the more options the merrier :-) I can't really provide erlang help, but I'm sure I can poke the WebSocket guys here at Moz to provide any assistance required on that front.
>
> Thanks,
> Christian
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://developingthedream.blogspot.com/,
http://www.youtube.com/user/revoltingx

From matthias at rabbitmq.com  Thu Nov  4 19:33:13 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Nov 2010 19:33:13 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <237050FF255D844CBDF840D42334EB9B66C6627EC3@SFOEXM02.YELLOWPAGES.LOCAL>
References: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>	<4CCE9CC1.7060200@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627DFC@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CD26DB2.8030806@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627EC3@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <4CD30A79.4050000@rabbitmq.com>

Michael,

On 04/11/10 19:03, Michael Vierling wrote:
> Let me turn the question around: why have messy poorly formatted log
> data?  Splunk has extensive tools to extract fields.  But it will
> always be true that having clean, well formatted log data goes a long
> ways towards making any extraction process easier and more reliable.

No arguing with that. However,

1) rabbitmqadmin is not outputting *log* data (and neither, for that 
matter are ps, iostat, etc). Which makes things like sticking timestamps 
at the beginning of every line feel rather artificial. Of course there 
are perfectly legitimate reasons for wanting to process non-log data 
with tools like splunk, but the logical place for the supporting code to 
live is as a plug-in to splunk.

2) what exactly is wrong with the existing formats output by 
rabbitmqadmin? The default table format is designed for human 
readability. The tsv format is designed for post-processing with 
standard unix tools (e.g. "rabbitmqadmin -f tsv -q list connections | 
cut -f 2 | while read conn ; do rabbitmqadmin close connection ${conn} ; 
done" will close all connections). And the json format works well for 
post processing by programmatic means.

> Hundreds of lines of code are needed to parse iostat, ps and the others.

I appreciate that but surely the same isn't true of the rabbitmqadmin 
outputs. In particular the tsv and json outputs should be a breeze to 
parse. If they are not then that is certainly something we'd want to fix.


Regards,

Matthias.

From MVierling at attinteractive.com  Thu Nov  4 20:13:41 2010
From: MVierling at attinteractive.com (Michael Vierling)
Date: Thu, 4 Nov 2010 13:13:41 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <4CD30A79.4050000@rabbitmq.com>
References: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CCE9CC1.7060200@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627DFC@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CD26DB2.8030806@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627EC3@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CD30A79.4050000@rabbitmq.com>
Message-ID: <237050FF255D844CBDF840D42334EB9B66C6627EEA@SFOEXM02.YELLOWPAGES.LOCAL>

The tsv format may work fine.  I'll defer my feedback until I can properly test it though.

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Thursday, November 04, 2010 12:33 PM
To: Michael Vierling
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ and Splunk

Michael,

On 04/11/10 19:03, Michael Vierling wrote:
> Let me turn the question around: why have messy poorly formatted log
> data?  Splunk has extensive tools to extract fields.  But it will
> always be true that having clean, well formatted log data goes a long
> ways towards making any extraction process easier and more reliable.

No arguing with that. However,

1) rabbitmqadmin is not outputting *log* data (and neither, for that 
matter are ps, iostat, etc). Which makes things like sticking timestamps 
at the beginning of every line feel rather artificial. Of course there 
are perfectly legitimate reasons for wanting to process non-log data 
with tools like splunk, but the logical place for the supporting code to 
live is as a plug-in to splunk.

2) what exactly is wrong with the existing formats output by 
rabbitmqadmin? The default table format is designed for human 
readability. The tsv format is designed for post-processing with 
standard unix tools (e.g. "rabbitmqadmin -f tsv -q list connections | 
cut -f 2 | while read conn ; do rabbitmqadmin close connection ${conn} ; 
done" will close all connections). And the json format works well for 
post processing by programmatic means.

> Hundreds of lines of code are needed to parse iostat, ps and the others.

I appreciate that but surely the same isn't true of the rabbitmqadmin 
outputs. In particular the tsv and json outputs should be a breeze to 
parse. If they are not then that is certainly something we'd want to fix.


Regards,

Matthias.

From matthias at rabbitmq.com  Thu Nov  4 20:16:22 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Nov 2010 20:16:22 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <237050FF255D844CBDF840D42334EB9B66C6627EEA@SFOEXM02.YELLOWPAGES.LOCAL>
References: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>	<4CCE9CC1.7060200@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627DFC@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CD26DB2.8030806@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627EC3@SFOEXM02.YELLOWPAGES.LOCAL>
	<4CD30A79.4050000@rabbitmq.com>
	<237050FF255D844CBDF840D42334EB9B66C6627EEA@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <4CD31496.1030804@rabbitmq.com>

Michael,

Michael Vierling wrote:
> The tsv format may work fine.

That would be great. Also note the -q switch for turning off the 
informational header/footer.

Regards,

Matthias.

From adam.hitchcock at skype.net  Thu Nov  4 20:33:31 2010
From: adam.hitchcock at skype.net (Adam Hitchcock)
Date: Thu, 4 Nov 2010 13:33:31 -0700
Subject: [rabbitmq-discuss] How to consume from 10, 000 to 100,
	000 queues in a single process (java)
Message-ID: <AANLkTi=MqdG4LFMMumF1GkH6TM9+VEVQSBmL3HeMoPxU@mail.gmail.com>

Currently I am using a single threaded process that performs
basic_consume with a custom callback handler (based off the
ConsumerMain.java example)

I am finding that queues are building up because I'm not able to
consume fast enough. So what are the best practices to consume from
thousands to hundres of thousands of queues on a single core machine?

More details:
noAck = true
I am using a single instance of a class extending DefaultConsumer with
an over ridden handleDelivery().
Does anybody have numbers on what the maximum consume rate is on a
stock ec2 setup?

From mikeb at rabbitmq.com  Fri Nov  5 08:00:19 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 05 Nov 2010 08:00:19 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <AANLkTikH85-ptkGq0ZGxgB_SaFaB7=tFqZVDs0np2hwU@mail.gmail.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
	<AANLkTikH85-ptkGq0ZGxgB_SaFaB7=tFqZVDs0np2hwU@mail.gmail.com>
Message-ID: <4CD3B993.4030101@rabbitmq.com>

> var message = new Object(); message.command = "publish";
> message.queue = "myqueue"; message.exchange = "myexchange";
> message.key = "mybindkey"; message.body = "hello world";
>
> var message_json = JSON.stringify(message);
>
> var ws = new WebSocket("ws://4.2.2.2:123"); ws.send(message_json);
>
> Consuming:
>
> var subscribe = new Object(); subscribe.command = "consume";
> subscribe.queue = ...
>
> ws.send(subscribe_json);
>
> //wait for reply from server... ws.onopen = function(event) {
> //handle message or error here.. }

How about something /really/ simple:

var sock = new RabbitSocket("subscribe", "myexchange");
sock.onMessage(function(msg) {
   ...
});

and perhaps more provocatively,

var sock = new RabbitSocket("request", "myqueue");
sock.send("question");
sock.onMessage(function(answer) {
   ...
});

or even

sock.request("question", function(answer) {
   ...
});

This is a bit more like how our STOMP adapter works (now, on
default branch[1]), and more like the much admired ZeroMQ.  I've been
messing around with this kind of model at
https://github.com/squaremo/rabbit.js#readme.

[1] http://hg.rabbitmq.com/rabbitmq-stomp/file/0aff7391968a/DESIGN.md


Michael.

> I don't need STOMP support, the websocket plugin should just require
> a port for communication and delegate the commands to rabbitmq.
>
> On Thu, Nov 4, 2010 at 10:47 AM, Christian Legnitto
> <clegnitto at mozilla.com>  wrote:
>>
>> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>>
>>> On Fri, Oct 29, 2010 at 19:55, Christian
>>> Legnitto<clegnitto at mozilla.com>  wrote:
>>>> [...] Support for WebSockets
>>>>
>>>> * It'd be nice for there a plugin to support websockets * More
>>>> important for Mozilla as most tools are web-based * I have set
>>>> it up with orbitd, but it's a pain / another moving piece /
>>>> easier to uncomment a line like
>>>> http://activemq.apache.org/websockets.html
>>>
>>>
>>> Christian,
>>>
>>> I'm interested in creating a websockets plugin for Rabbit.
>>>
>>> But I'm not really sure how you'd like to use it.
>>>
>>> As a thing exposed to the wild internet? Or just as another
>>> framing for AMQP? Or as a wire protocol for STOMP? (like this
>>> thing http://jmesnil.net/stomp-websocket/doc/)
>>>
>>> Or maybe you have yet another use case?
>>>
>>> Cheers, Marek
>>
>> I was thinking more like http://jmesnil.net/stomp-websocket/doc/,
>> as that's what I have been using. Of course, the more options the
>> merrier :-) I can't really provide erlang help, but I'm sure I can
>> poke the WebSocket guys here at Moz to provide any assistance
>> required on that front.
>>
>> Thanks, Christian _______________________________________________
>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>>
>
>


From therevoltingx at gmail.com  Fri Nov  5 08:47:20 2010
From: therevoltingx at gmail.com (Miguel Morales)
Date: Fri, 5 Nov 2010 01:47:20 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <4CD3B993.4030101@rabbitmq.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
	<AANLkTikH85-ptkGq0ZGxgB_SaFaB7=tFqZVDs0np2hwU@mail.gmail.com>
	<4CD3B993.4030101@rabbitmq.com>
Message-ID: <AANLkTimwaWDRM1DJCG_UPz5ctCXwXcbJYDWGPh6UeWbi@mail.gmail.com>

I was thinking of how to avoid writing a JS library to have to
distribute and maintain.  Granted, adding something like that would be
a bit trivial.  So I guess it wouldn't be too bad.

I haven't done much work with websockets, but I like this project's
syntax: http://code.google.com/p/jquery-websocket/
Where you can setup a sort of RPC/event system while keeping the code
free of if/else.

I wouldn't want to mess with any framing or any such amqp
functionality.  Just dead simple publishing/consuming and with an
optional clean RPC system.

The plugin should listen for a specific json encoded message and
distribute the message to the specified location.
The plugin should know when we are a registered consumer and deliver a
json encoded message with the message and its information.

These are just some quick thoughts on it though.  It may not even need
to be a plugin, but the lower the delivery latency, the better.

On Fri, Nov 5, 2010 at 1:00 AM, Michael Bridgen <mikeb at rabbitmq.com> wrote:
>> var message = new Object(); message.command = "publish";
>> message.queue = "myqueue"; message.exchange = "myexchange";
>> message.key = "mybindkey"; message.body = "hello world";
>>
>> var message_json = JSON.stringify(message);
>>
>> var ws = new WebSocket("ws://4.2.2.2:123"); ws.send(message_json);
>>
>> Consuming:
>>
>> var subscribe = new Object(); subscribe.command = "consume";
>> subscribe.queue = ...
>>
>> ws.send(subscribe_json);
>>
>> //wait for reply from server... ws.onopen = function(event) {
>> //handle message or error here.. }
>
> How about something /really/ simple:
>
> var sock = new RabbitSocket("subscribe", "myexchange");
> sock.onMessage(function(msg) {
> ?...
> });
>
> and perhaps more provocatively,
>
> var sock = new RabbitSocket("request", "myqueue");
> sock.send("question");
> sock.onMessage(function(answer) {
> ?...
> });
>
> or even
>
> sock.request("question", function(answer) {
> ?...
> });
>
> This is a bit more like how our STOMP adapter works (now, on
> default branch[1]), and more like the much admired ZeroMQ. ?I've been
> messing around with this kind of model at
> https://github.com/squaremo/rabbit.js#readme.
>
> [1] http://hg.rabbitmq.com/rabbitmq-stomp/file/0aff7391968a/DESIGN.md
>
>
> Michael.
>
>> I don't need STOMP support, the websocket plugin should just require
>> a port for communication and delegate the commands to rabbitmq.
>>
>> On Thu, Nov 4, 2010 at 10:47 AM, Christian Legnitto
>> <clegnitto at mozilla.com> ?wrote:
>>>
>>> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>>>
>>>> On Fri, Oct 29, 2010 at 19:55, Christian
>>>> Legnitto<clegnitto at mozilla.com> ?wrote:
>>>>>
>>>>> [...] Support for WebSockets
>>>>>
>>>>> * It'd be nice for there a plugin to support websockets * More
>>>>> important for Mozilla as most tools are web-based * I have set
>>>>> it up with orbitd, but it's a pain / another moving piece /
>>>>> easier to uncomment a line like
>>>>> http://activemq.apache.org/websockets.html
>>>>
>>>>
>>>> Christian,
>>>>
>>>> I'm interested in creating a websockets plugin for Rabbit.
>>>>
>>>> But I'm not really sure how you'd like to use it.
>>>>
>>>> As a thing exposed to the wild internet? Or just as another
>>>> framing for AMQP? Or as a wire protocol for STOMP? (like this
>>>> thing http://jmesnil.net/stomp-websocket/doc/)
>>>>
>>>> Or maybe you have yet another use case?
>>>>
>>>> Cheers, Marek
>>>
>>> I was thinking more like http://jmesnil.net/stomp-websocket/doc/,
>>> as that's what I have been using. Of course, the more options the
>>> merrier :-) I can't really provide erlang help, but I'm sure I can
>>> poke the WebSocket guys here at Moz to provide any assistance
>>> required on that front.
>>>
>>> Thanks, Christian _______________________________________________
>>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>>
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://developingthedream.blogspot.com/,
http://www.youtube.com/user/revoltingx

From tim at cantemo.com  Fri Nov  5 08:49:19 2010
From: tim at cantemo.com (Tim Child)
Date: Fri, 5 Nov 2010 09:49:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <4CD3B993.4030101@rabbitmq.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
	<AANLkTikH85-ptkGq0ZGxgB_SaFaB7=tFqZVDs0np2hwU@mail.gmail.com>
	<4CD3B993.4030101@rabbitmq.com>
Message-ID: <488E039D-CDAE-4E23-9F3C-2904FAAB398B@cantemo.com>

And authentication?

Seems to me that you should consider some form of authentication against the service, whether it is some sort of REST callback to another service or some other mechanism.

Tim.


On 5 Nov 2010, at 09:00, Michael Bridgen wrote:

>> var message = new Object(); message.command = "publish";
>> message.queue = "myqueue"; message.exchange = "myexchange";
>> message.key = "mybindkey"; message.body = "hello world";
>> 
>> var message_json = JSON.stringify(message);
>> 
>> var ws = new WebSocket("ws://4.2.2.2:123"); ws.send(message_json);
>> 
>> Consuming:
>> 
>> var subscribe = new Object(); subscribe.command = "consume";
>> subscribe.queue = ...
>> 
>> ws.send(subscribe_json);
>> 
>> //wait for reply from server... ws.onopen = function(event) {
>> //handle message or error here.. }
> 
> How about something /really/ simple:
> 
> var sock = new RabbitSocket("subscribe", "myexchange");
> sock.onMessage(function(msg) {
>  ...
> });
> 
> and perhaps more provocatively,
> 
> var sock = new RabbitSocket("request", "myqueue");
> sock.send("question");
> sock.onMessage(function(answer) {
>  ...
> });
> 
> or even
> 
> sock.request("question", function(answer) {
>  ...
> });
> 
> This is a bit more like how our STOMP adapter works (now, on
> default branch[1]), and more like the much admired ZeroMQ.  I've been
> messing around with this kind of model at
> https://github.com/squaremo/rabbit.js#readme.
> 
> [1] http://hg.rabbitmq.com/rabbitmq-stomp/file/0aff7391968a/DESIGN.md
> 
> 
> Michael.
> 
>> I don't need STOMP support, the websocket plugin should just require
>> a port for communication and delegate the commands to rabbitmq.
>> 
>> On Thu, Nov 4, 2010 at 10:47 AM, Christian Legnitto
>> <clegnitto at mozilla.com>  wrote:
>>> 
>>> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>>> 
>>>> On Fri, Oct 29, 2010 at 19:55, Christian
>>>> Legnitto<clegnitto at mozilla.com>  wrote:
>>>>> [...] Support for WebSockets
>>>>> 
>>>>> * It'd be nice for there a plugin to support websockets * More
>>>>> important for Mozilla as most tools are web-based * I have set
>>>>> it up with orbitd, but it's a pain / another moving piece /
>>>>> easier to uncomment a line like
>>>>> http://activemq.apache.org/websockets.html
>>>> 
>>>> 
>>>> Christian,
>>>> 
>>>> I'm interested in creating a websockets plugin for Rabbit.
>>>> 
>>>> But I'm not really sure how you'd like to use it.
>>>> 
>>>> As a thing exposed to the wild internet? Or just as another
>>>> framing for AMQP? Or as a wire protocol for STOMP? (like this
>>>> thing http://jmesnil.net/stomp-websocket/doc/)
>>>> 
>>>> Or maybe you have yet another use case?
>>>> 
>>>> Cheers, Marek
>>> 
>>> I was thinking more like http://jmesnil.net/stomp-websocket/doc/,
>>> as that's what I have been using. Of course, the more options the
>>> merrier :-) I can't really provide erlang help, but I'm sure I can
>>> poke the WebSocket guys here at Moz to provide any assistance
>>> required on that front.
>>> 
>>> Thanks, Christian _______________________________________________
>>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>> 
>>> 
>> 
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com
CANTEMO

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/6859e2c8/attachment-0001.htm>

From therevoltingx at gmail.com  Fri Nov  5 08:55:43 2010
From: therevoltingx at gmail.com (Miguel Morales)
Date: Fri, 5 Nov 2010 01:55:43 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <488E039D-CDAE-4E23-9F3C-2904FAAB398B@cantemo.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
	<AANLkTikH85-ptkGq0ZGxgB_SaFaB7=tFqZVDs0np2hwU@mail.gmail.com>
	<4CD3B993.4030101@rabbitmq.com>
	<488E039D-CDAE-4E23-9F3C-2904FAAB398B@cantemo.com>
Message-ID: <AANLkTim5S71stsDSvf1+yvBB6O__FChgQ0s+-j3zk5qD@mail.gmail.com>

Hmm, I can think of two ways for authentication.  Appending it to the
url (not sure if it's possible):
var ws = new WebSocket("ws://4.2.2.2:123?username=myname&password=mypassword");

Not sure if you can properly handle errors this way.  Another way
would be something like:

var ws = new WS(...);
//attemp to login....
ws.send({username: 'myname', password: 'mypassword'});
//... check if it worked, maybe get an auth token?


On Fri, Nov 5, 2010 at 1:49 AM, Tim Child <tim at cantemo.com> wrote:
> And authentication?
> Seems to me that you should consider some form of authentication against the
> service, whether it is some sort of REST callback to another service or some
> other mechanism.
> Tim.
>
> On 5 Nov 2010, at 09:00, Michael Bridgen wrote:
>
> var message = new Object(); message.command = "publish";
>
> message.queue = "myqueue"; message.exchange = "myexchange";
>
> message.key = "mybindkey"; message.body = "hello world";
>
> var message_json = JSON.stringify(message);
>
> var ws = new WebSocket("ws://4.2.2.2:123"); ws.send(message_json);
>
> Consuming:
>
> var subscribe = new Object(); subscribe.command = "consume";
>
> subscribe.queue = ...
>
> ws.send(subscribe_json);
>
> //wait for reply from server... ws.onopen = function(event) {
>
> //handle message or error here.. }
>
> How about something /really/ simple:
>
> var sock = new RabbitSocket("subscribe", "myexchange");
> sock.onMessage(function(msg) {
> ?...
> });
>
> and perhaps more provocatively,
>
> var sock = new RabbitSocket("request", "myqueue");
> sock.send("question");
> sock.onMessage(function(answer) {
> ?...
> });
>
> or even
>
> sock.request("question", function(answer) {
> ?...
> });
>
> This is a bit more like how our STOMP adapter works (now, on
> default branch[1]), and more like the much admired ZeroMQ. ?I've been
> messing around with this kind of model at
> https://github.com/squaremo/rabbit.js#readme.
>
> [1] http://hg.rabbitmq.com/rabbitmq-stomp/file/0aff7391968a/DESIGN.md
>
>
> Michael.
>
> I don't need STOMP support, the websocket plugin should just require
>
> a port for communication and delegate the commands to rabbitmq.
>
> On Thu, Nov 4, 2010 at 10:47 AM, Christian Legnitto
>
> <clegnitto at mozilla.com> ?wrote:
>
> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>
> On Fri, Oct 29, 2010 at 19:55, Christian
>
> Legnitto<clegnitto at mozilla.com> ?wrote:
>
> [...] Support for WebSockets
>
> * It'd be nice for there a plugin to support websockets * More
>
> important for Mozilla as most tools are web-based * I have set
>
> it up with orbitd, but it's a pain / another moving piece /
>
> easier to uncomment a line like
>
> http://activemq.apache.org/websockets.html
>
>
> Christian,
>
> I'm interested in creating a websockets plugin for Rabbit.
>
> But I'm not really sure how you'd like to use it.
>
> As a thing exposed to the wild internet? Or just as another
>
> framing for AMQP? Or as a wire protocol for STOMP? (like this
>
> thing http://jmesnil.net/stomp-websocket/doc/)
>
> Or maybe you have yet another use case?
>
> Cheers, Marek
>
> I was thinking more like http://jmesnil.net/stomp-websocket/doc/,
>
> as that's what I have been using. Of course, the more options the
>
> merrier :-) I can't really provide erlang help, but I'm sure I can
>
> poke the WebSocket guys here at Moz to provide any assistance
>
> required on that front.
>
> Thanks, Christian _______________________________________________
>
> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> Tim Child
> +46 (0) 7602 17785
> Skype: timchild
> http://www.cantemo.com
> CANTEMO
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://developingthedream.blogspot.com/,
http://www.youtube.com/user/revoltingx

From tim at cantemo.com  Fri Nov  5 09:12:19 2010
From: tim at cantemo.com (Tim Child)
Date: Fri, 5 Nov 2010 10:12:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <AANLkTimwaWDRM1DJCG_UPz5ctCXwXcbJYDWGPh6UeWbi@mail.gmail.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
	<AANLkTikH85-ptkGq0ZGxgB_SaFaB7=tFqZVDs0np2hwU@mail.gmail.com>
	<4CD3B993.4030101@rabbitmq.com>
	<AANLkTimwaWDRM1DJCG_UPz5ctCXwXcbJYDWGPh6UeWbi@mail.gmail.com>
Message-ID: <A2EE02F9-BA9C-49F3-BF42-7EE60E84EEE6@cantemo.com>

Been using js.io as part of other products with some good results.

https://github.com/mcarter/js.io

But, socket.io seems better:

https://github.com/LearnBoost/Socket.IO

Basically whats been important when I have been implementing comet systems is that if you use say websockets, that you can use another form of communication for those browsers that don't support websockets (or the particular variant of the spec that you are trying to use) - which is many of them.

Draft 75
Chrome 5
Safari 5.0
Draft 76
Firefox 4 beta
Chrome 6
safari 5.02
Opera 10.70

Some of the libraries use flash as a fallback mechanism, which I find unacceptable. For instance a large percentage of my peers use products like click2flash which will block the use of the flash library, and with Apple's continuing reluctance to support Flash we are finding larger percentages of the audience that can't use that fallback, and can't use websockets.





On 5 Nov 2010, at 09:47, Miguel Morales wrote:

> I was thinking of how to avoid writing a JS library to have to
> distribute and maintain.  Granted, adding something like that would be
> a bit trivial.  So I guess it wouldn't be too bad.
> 
> I haven't done much work with websockets, but I like this project's
> syntax: http://code.google.com/p/jquery-websocket/
> Where you can setup a sort of RPC/event system while keeping the code
> free of if/else.
> 
> I wouldn't want to mess with any framing or any such amqp
> functionality.  Just dead simple publishing/consuming and with an
> optional clean RPC system.
> 
> The plugin should listen for a specific json encoded message and
> distribute the message to the specified location.
> The plugin should know when we are a registered consumer and deliver a
> json encoded message with the message and its information.
> 
> These are just some quick thoughts on it though.  It may not even need
> to be a plugin, but the lower the delivery latency, the better.
> 
> O

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com
CANTEMO

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/b2355189/attachment.htm>

From tim at cantemo.com  Fri Nov  5 09:16:35 2010
From: tim at cantemo.com (Tim Child)
Date: Fri, 5 Nov 2010 10:16:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <AANLkTim5S71stsDSvf1+yvBB6O__FChgQ0s+-j3zk5qD@mail.gmail.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
	<AANLkTikH85-ptkGq0ZGxgB_SaFaB7=tFqZVDs0np2hwU@mail.gmail.com>
	<4CD3B993.4030101@rabbitmq.com>
	<488E039D-CDAE-4E23-9F3C-2904FAAB398B@cantemo.com>
	<AANLkTim5S71stsDSvf1+yvBB6O__FChgQ0s+-j3zk5qD@mail.gmail.com>
Message-ID: <21652925-177A-402C-8168-3A7584911751@cantemo.com>

This puts the password in plain text if you are not using https:

> {username: 'myname', password: 'mypassword'}

Hookbox has a nice way of passing the authentication, by using a combination of the username and a session cookie.
When you authenticate with hookbox, you get a web callback passing the session cookie id with the username which of course
your web application should know about as it generated the session cookie, and can map it to the username and can then allow
or deny the request..

Downside is of course that you have to provide this mechanism in your web application.

Tim.

On 5 Nov 2010, at 09:55, Miguel Morales wrote:

> Hmm, I can think of two ways for authentication.  Appending it to the
> url (not sure if it's possible):
> var ws = new WebSocket("ws://4.2.2.2:123?username=myname&password=mypassword");
> 
> Not sure if you can properly handle errors this way.  Another way
> would be something like:
> 
> var ws = new WS(...);
> //attemp to login....
> ws.send({username: 'myname', password: 'mypassword'});
> //... check if it worked, maybe get an auth token?
> 
> 
> On Fri, Nov 5, 2010 at 1:49 AM, Tim Child <tim at cantemo.com> wrote:
>> And authentication?
>> Seems to me that you should consider some form of authentication against the
>> service, whether it is some sort of REST callback to another service or some
>> other mechanism.
>> Tim.
>> 
>> On 5 Nov 2010, at 09:00, Michael Bridgen wrote:
>> 
>> var message = new Object(); message.command = "publish";
>> 
>> message.queue = "myqueue"; message.exchange = "myexchange";
>> 
>> message.key = "mybindkey"; message.body = "hello world";
>> 
>> var message_json = JSON.stringify(message);
>> 
>> var ws = new WebSocket("ws://4.2.2.2:123"); ws.send(message_json);
>> 
>> Consuming:
>> 
>> var subscribe = new Object(); subscribe.command = "consume";
>> 
>> subscribe.queue = ...
>> 
>> ws.send(subscribe_json);
>> 
>> //wait for reply from server... ws.onopen = function(event) {
>> 
>> //handle message or error here.. }
>> 
>> How about something /really/ simple:
>> 
>> var sock = new RabbitSocket("subscribe", "myexchange");
>> sock.onMessage(function(msg) {
>>  ...
>> });
>> 
>> and perhaps more provocatively,
>> 
>> var sock = new RabbitSocket("request", "myqueue");
>> sock.send("question");
>> sock.onMessage(function(answer) {
>>  ...
>> });
>> 
>> or even
>> 
>> sock.request("question", function(answer) {
>>  ...
>> });
>> 
>> This is a bit more like how our STOMP adapter works (now, on
>> default branch[1]), and more like the much admired ZeroMQ.  I've been
>> messing around with this kind of model at
>> https://github.com/squaremo/rabbit.js#readme.
>> 
>> [1] http://hg.rabbitmq.com/rabbitmq-stomp/file/0aff7391968a/DESIGN.md
>> 
>> 
>> Michael.
>> 
>> I don't need STOMP support, the websocket plugin should just require
>> 
>> a port for communication and delegate the commands to rabbitmq.
>> 
>> On Thu, Nov 4, 2010 at 10:47 AM, Christian Legnitto
>> 
>> <clegnitto at mozilla.com>  wrote:
>> 
>> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>> 
>> On Fri, Oct 29, 2010 at 19:55, Christian
>> 
>> Legnitto<clegnitto at mozilla.com>  wrote:
>> 
>> [...] Support for WebSockets
>> 
>> * It'd be nice for there a plugin to support websockets * More
>> 
>> important for Mozilla as most tools are web-based * I have set
>> 
>> it up with orbitd, but it's a pain / another moving piece /
>> 
>> easier to uncomment a line like
>> 
>> http://activemq.apache.org/websockets.html
>> 
>> 
>> Christian,
>> 
>> I'm interested in creating a websockets plugin for Rabbit.
>> 
>> But I'm not really sure how you'd like to use it.
>> 
>> As a thing exposed to the wild internet? Or just as another
>> 
>> framing for AMQP? Or as a wire protocol for STOMP? (like this
>> 
>> thing http://jmesnil.net/stomp-websocket/doc/)
>> 
>> Or maybe you have yet another use case?
>> 
>> Cheers, Marek
>> 
>> I was thinking more like http://jmesnil.net/stomp-websocket/doc/,
>> 
>> as that's what I have been using. Of course, the more options the
>> 
>> merrier :-) I can't really provide erlang help, but I'm sure I can
>> 
>> poke the WebSocket guys here at Moz to provide any assistance
>> 
>> required on that front.
>> 
>> Thanks, Christian _______________________________________________
>> 
>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>> 
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Tim Child
>> +46 (0) 7602 17785
>> Skype: timchild
>> http://www.cantemo.com
>> CANTEMO
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> 
> 
> -- 
> ~ Jeremiah:9:23-24
> Android 2D MMORPG: http://developingthedream.blogspot.com/,
> http://www.youtube.com/user/revoltingx

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com
CANTEMO

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/39e4f07f/attachment-0001.htm>

From christian at schuhbaum.info  Fri Nov  5 09:42:42 2010
From: christian at schuhbaum.info (Christian Schuhbaum)
Date: Fri, 05 Nov 2010 10:42:42 +0100
Subject: [rabbitmq-discuss] JsonRpc and RabbitMQ
Message-ID: <4CD3D192.3040405@schuhbaum.info>

Hello everybody,

i'm currently trying to use the jsonRpc-Plugin with the rabbitMQ-2.1.1
server.
The configuration works fine and the json-rpc examples are working, too.

The only thing, i want to do with the rabbitmq-server is:
Client -> [put some text] -> rabbitMQ Server
Other client -> [consume the queue entries] -> rabbitMQ Server

This means, i'm also need the persistence of rabbitmq.

Is there any documentation out there, about the usage of the
jsonRpc-methods?
Basically i just need the same functionallity as the amqp-library gives me.
Create Channel, create queue, bind queue+channel, add persistence, write
to the channel (persistent) and read it from an other client.

I found the basic.publish-method in the javascript-library. For example
a parameter with 12 entries "null". Where do they come? How do i know,
what parameters are required?

Can anybody help me?

From adamka at dgt.com.pl  Fri Nov  5 10:13:25 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Fri, 05 Nov 2010 11:13:25 +0100
Subject: [rabbitmq-discuss] deadlock in example??
In-Reply-To: <4CD168E5.5060406@dgt.com.pl>
References: <4CD168E5.5060406@dgt.com.pl>
Message-ID: <4CD3D8C5.6070605@dgt.com.pl>

Hi,

I'm just testing example "Subscriber" but have strange problem....

when code reach metod
private static string ensureQueue(IModel ch)

and inside try to declare queue

string queueName = ch.QueueDeclare();

doesnt go forward like in deadlock....


Server log:

=INFO REPORT==== 5-Nov-2010::11:06:05 ===
accepted TCP connection on 0.0.0.0:5672 from 192.168.44.130:49866

=INFO REPORT==== 5-Nov-2010::11:06:05 ===
starting TCP connection <0.6531.0> from 192.168.44.130:49866

=ERROR REPORT==== 5-Nov-2010::11:06:15 ===
** Generic server <0.6549.0> terminating
** Last message in was {init,false}
** When Server state == {q,{amqqueue,
                                {resource,<<"/">>,queue,
<<"amq.gen-8l5NzzAMZ+9yV1qSZPtW7g==">>},
                                false,true,<0.6531.0>,[],<0.6549.0>},
                            none,false,rabbit_variable_queue,undefined,
                            {[],[]},
                            {[],[]},
                            undefined,undefined,undefined,undefined,
                            {state,none,undefined}}
** Reason for termination ==
** {bad_return_value,
        {error,
            {{badmatch,{error,exchange_not_found}},
             [{rabbit_amqqueue,'-internal_declare/2-fun-0-',3},
              {mnesia_tm,apply_fun,3},
              {mnesia_tm,execute_transaction,5},
              {worker_pool_worker,handle_call,3},
              {gen_server2,handle_msg,7},
              {proc_lib,wake_up,3}]}}}

=ERROR REPORT==== 5-Nov-2010::11:06:15 ===
** Generic server <0.6534.0> terminating
** Last message in was {'$gen_cast',
                            {method,
                                
{'queue.declare',0,<<>>,false,false,true,true,
                                    false,[]},
                                none}}
** When Server state == {ch,running,1,<0.6531.0>,<0.6533.0>,undefined,
                             #Fun<rabbit_channel_sup.0.58069862>,none,
                             {sets,0,16,16,8,80,48,
                                   
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[]}}},
                             1,
                             {[],[]},
                             {[],[]},
<<"guest">>,<<"/">>,<<>>,
                             {dict,0,16,16,8,80,48,
                                   
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[]}}},
                             {dict,0,16,16,8,80,48,
                                   
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[]}}},
<0.6530.0>,
                             {state,none,undefined}}
** Reason for termination ==
** {{{bad_return_value,
          {error,
              {{badmatch,{error,exchange_not_found}},
               [{rabbit_amqqueue,'-internal_declare/2-fun-0-',3},
                {mnesia_tm,apply_fun,3},
                {mnesia_tm,execute_transaction,5},
                {worker_pool_worker,handle_call,3},
                {gen_server2,handle_msg,7},
                {proc_lib,wake_up,3}]}}},
      {gen_server2,call,[<0.6549.0>,{init,false}]}},
     [{gen_server2,call,2},
      {rabbit_amqqueue,declare,5},
      {rabbit_channel,handle_method,3},
      {rabbit_channel,handle_cast,2},
      {gen_server2,handle_msg,7},
      {proc_lib,wake_up,3}]}


dont know whats goint on...



Regards

Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From matthew at rabbitmq.com  Fri Nov  5 10:18:28 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 5 Nov 2010 10:18:28 +0000
Subject: [rabbitmq-discuss] deadlock in example??
In-Reply-To: <4CD3D8C5.6070605@dgt.com.pl>
References: <4CD168E5.5060406@dgt.com.pl>
 <4CD3D8C5.6070605@dgt.com.pl>
Message-ID: <20101105101827.GB4220@wellquite.org>

On Fri, Nov 05, 2010 at 11:13:25AM +0100, Adam Kaminiecki wrote:
> =ERROR REPORT==== 5-Nov-2010::11:06:15 ===
> ** Generic server <0.6549.0> terminating
> ** Last message in was {init,false}
> ** When Server state == {q,{amqqueue,
>                                {resource,<<"/">>,queue,
> <<"amq.gen-8l5NzzAMZ+9yV1qSZPtW7g==">>},
>                                false,true,<0.6531.0>,[],<0.6549.0>},
>                            none,false,rabbit_variable_queue,undefined,
>                            {[],[]},
>                            {[],[]},
>                            undefined,undefined,undefined,undefined,
>                            {state,none,undefined}}
> ** Reason for termination ==
> ** {bad_return_value,
>        {error,
>            {{badmatch,{error,exchange_not_found}},
>             [{rabbit_amqqueue,'-internal_declare/2-fun-0-',3},
>              {mnesia_tm,apply_fun,3},
>              {mnesia_tm,execute_transaction,5},
>              {worker_pool_worker,handle_call,3},
>              {gen_server2,handle_msg,7},
>              {proc_lib,wake_up,3}]}}}

The only thing I can think is that you've deleted the default, nameless
exchange. Consequently, it explodes when trying to give the new queue the
binding from the default nameless exchange.

Have you in fact deleted the default nameless exchange?

Matthew

From matthew at rabbitmq.com  Fri Nov  5 10:23:15 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 5 Nov 2010 10:23:15 +0000
Subject: [rabbitmq-discuss] deadlock in example??
In-Reply-To: <20101105101827.GB4220@wellquite.org>
References: <4CD168E5.5060406@dgt.com.pl> <4CD3D8C5.6070605@dgt.com.pl>
	<20101105101827.GB4220@wellquite.org>
Message-ID: <20101105102315.GC4220@wellquite.org>

On Fri, Nov 05, 2010 at 10:18:28AM +0000, Matthew Sackman wrote:
> Have you in fact deleted the default nameless exchange?

Just fyi, we've changed the behaviour in the latest 2.1.1 release so
that you can't delete the default nameless exchange. Upgrading might
help you here ;)

Matthew

From jon.rowland at isam.com  Fri Nov  5 10:27:51 2010
From: jon.rowland at isam.com (Jon Rowland)
Date: Fri, 5 Nov 2010 05:27:51 -0500
Subject: [rabbitmq-discuss] Plug-in out of date warnings when starting
 the RabbitMQ server on Windows
In-Reply-To: <20100919100910.GB28163@wellquite.org>
References: <985477893245CF449ABD4F01814A9FF65E705C12A0@34093-MBX-C06.mex07a.mlsrvr.com>
	<20100918223650.GE16939@wellquite.org>
	<985477893245CF449ABD4F01814A9FF65E705C137E@34093-MBX-C06.mex07a.mlsrvr.com>
	<20100919100910.GB28163@wellquite.org>
Message-ID: <985477893245CF449ABD4F01814A9FF65E7968D7E8@34093-MBX-C06.mex07a.mlsrvr.com>

An update on this. I complete uninstalled RabbitMQ/Erlang packages from my machine and made sure that the folders really were gone.

I then freshly installed the Erlang, RabbitMQ-Server packages from the windows complete 2.1.1 package.

On starting the server, I get exactly the same plugins warnings as previously. I noticed another mail on the list with a response from David Wragg suggesting a workaround of deleting the src folder. I can confirm that this workaround also works for me.

I've done a little bit of digging. It appears the detection of 'out of date' is just done on a file datetime comparison of the src versus beam versions. If I do the Windows equivalent of 'touch'-ing the .beam files, the warnings go away. So it looks like for whatever reason, the .beam files are getting a slightly older file datetime than the src files, causing the warnings. The file datetime is set by the 'unzip' so I'm not sure it's something you'll be able to control (unless you can somehow control the unzip order).

Not a major problem for me but could be confusing for other newcomers.

Regards,
Jon

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: 19 September 2010 11:09
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Plug-in out of date warnings when starting the RabbitMQ server on Windows

On Sun, Sep 19, 2010 at 05:01:55AM -0500, Jon Rowland wrote:
> I don't think so, this is a fresh install of 2.1.0 (on a machine that previously has had 1.7.0, but was uninstalled).
> 
> There are a lot of the plug-in warnings (around 80), including rabbit ones, e.g.
> ...
> *WARNING* rabbit: Object code (rabbit_exchange) out of date
> *WARNING* rabbit: Object code (rabbit_exchange_type) out of date
> ...

Right, it must be finding those _somewhere_. If you've only installed
the 2.1.0 broker and no plugins then it must be finding them from some
previous install. Hunt down the plugins directory, nuke it from orbit,
and then rerun "rabbitmq-service.bat install" as documented at
http://www.rabbitmq.com/admin-guide.html#uninstalling-plugins

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Fri Nov  5 10:30:55 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 5 Nov 2010 10:30:55 +0000
Subject: [rabbitmq-discuss] Plug-in out of date warnings when starting
 the RabbitMQ server on Windows
In-Reply-To: <985477893245CF449ABD4F01814A9FF65E7968D7E8@34093-MBX-C06.mex07a.mlsrvr.com>
References: <985477893245CF449ABD4F01814A9FF65E705C12A0@34093-MBX-C06.mex07a.mlsrvr.com>
	<20100918223650.GE16939@wellquite.org>
	<985477893245CF449ABD4F01814A9FF65E705C137E@34093-MBX-C06.mex07a.mlsrvr.com>
	<20100919100910.GB28163@wellquite.org>
	<985477893245CF449ABD4F01814A9FF65E7968D7E8@34093-MBX-C06.mex07a.mlsrvr.com>
Message-ID: <20101105103055.GD4220@wellquite.org>

On Fri, Nov 05, 2010 at 05:27:51AM -0500, Jon Rowland wrote:
> I've done a little bit of digging. It appears the detection of 'out of date' is just done on a file datetime comparison of the src versus beam versions. If I do the Windows equivalent of 'touch'-ing the .beam files, the warnings go away. So it looks like for whatever reason, the .beam files are getting a slightly older file datetime than the src files, causing the warnings. The file datetime is set by the 'unzip' so I'm not sure it's something you'll be able to control (unless you can somehow control the unzip order).
> 
> Not a major problem for me but could be confusing for other newcomers.

Thanks for digging into this. I agree the warning is confusing. I wonder
whether if we specified the files to the zip command in a different
order we could avoid this. I bet zip is simple enough to just unpack in
the same (or reverse) order it packed in.

Matthew

From matthew at rabbitmq.com  Fri Nov  5 10:39:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 5 Nov 2010 10:39:18 +0000
Subject: [rabbitmq-discuss] deadlock in example??
In-Reply-To: <4CD3DD0E.9000001@dgt.com.pl>
References: <4CD168E5.5060406@dgt.com.pl> <4CD3D8C5.6070605@dgt.com.pl>
	<20101105101827.GB4220@wellquite.org> <4CD3DD0E.9000001@dgt.com.pl>
Message-ID: <20101105103918.GE4220@wellquite.org>

Hi Adam,

(Please keep the mailing list CC'd)

On Fri, Nov 05, 2010 at 11:31:42AM +0100, Adam Kaminiecki wrote:
> Possible yes but when i change declaration to:
>  string queueName = ch.QueueDeclare("999");
> 
> the same situation happend...

Yes, it will do. _Every_ queue that you declare gets a binding from the
default nameless exchange.

> i'will change the server but can I create the same exchane to reapir it??

It's possible on older versions of Rabbit you can do an active declare
of the exchange. Not sure. Otherwise, if you just nuke out the RabbitMQ
dataset, it'll recreate it on startup. (Usually,
/var/lib/rabbitmq/mnesia)

Matthew

From rob at rabbitmq.com  Fri Nov  5 11:08:50 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 5 Nov 2010 11:08:50 +0000
Subject: [rabbitmq-discuss] Is it safe to interrupt nextDelivery() ?
In-Reply-To: <AANLkTi=xmRqb=exKrMC68gfa_HvQwCPYkH5woBQeHp4r@mail.gmail.com>
References: <AANLkTi=xmRqb=exKrMC68gfa_HvQwCPYkH5woBQeHp4r@mail.gmail.com>
Message-ID: <AC7FFC20-3A5E-4B3F-83FC-2D5859AE2BE6@rabbitmq.com>


On 3 Nov 2010, at 15:12, Philippe Blayo wrote:

> Hello,
> 
> 
> For our fitnesse tests, we have a thread that consumes messages and is
> interrupted after a time out. It is interrupted most of the time in
> the blocking call to QueuingConsummer.nextDelivery(). We observe that
> there is a pending message that is not taken and not acknowledged :

Is this timeout triggered by your fitnesse tests? Presumably you are looking to limit the time a test takes in the case of failure.

> 
> $ rabbitmqctl list_queues name messages_ready messages_unacknowledged
> Listing queues ...
> STAT_PRINCIPALE 1       1
> ...done.
> 
> Our consumer receive an InterruptedException via
> ExecutorService.shutdownNow() in queue.take() in the QueuingConsummer.
> We reuse channels on the same connection but not on two concurrent
> threads at a time.

This is to be expected. When using shutdownNow() all worker threads are interrupted and queue.take() is a perfectly interruptible operation. This isn't necessarily a problem because interruption is intended to be a cooperative process between threads. The interruption itself doesn't actually leave the consumer or the server in any bad state. In fact, after the ES has shutdown, you can happily take that same QueueingConsumer and start calling nextDelivery on other threads and it will continue to work.

> 
> Is there a better way to close the QueuingConsummer.nextDelivery() ?

That depends on your definition of better :) You could call ExecutorServer.shutdown followed by ExecutorService.waitForTermination(). This will give the worker threads in the ES some time to drain what is left in the queue and exit gracefully.

> 
> -- 
> Philippe Blayo & Bruno Thomas
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/7267c02e/attachment.htm>

From rob.harrop at gmail.com  Fri Nov  5 11:07:24 2010
From: rob.harrop at gmail.com (Rob Harrop)
Date: Fri, 5 Nov 2010 11:07:24 +0000
Subject: [rabbitmq-discuss] Is it safe to interrupt nextDelivery() ?
In-Reply-To: <AANLkTi=xmRqb=exKrMC68gfa_HvQwCPYkH5woBQeHp4r@mail.gmail.com>
References: <AANLkTi=xmRqb=exKrMC68gfa_HvQwCPYkH5woBQeHp4r@mail.gmail.com>
Message-ID: <C6D9A321-69B4-455D-930C-AAD34E96373D@gmail.com>


On 3 Nov 2010, at 15:12, Philippe Blayo wrote:

> Hello,
> 
> 
> For our fitnesse tests, we have a thread that consumes messages and is
> interrupted after a time out. It is interrupted most of the time in
> the blocking call to QueuingConsummer.nextDelivery(). We observe that
> there is a pending message that is not taken and not acknowledged :

Is this timeout triggered by your fitnesse tests? Presumably you are looking to limit the time a test takes in the case of failure.

> 
> $ rabbitmqctl list_queues name messages_ready messages_unacknowledged
> Listing queues ...
> STAT_PRINCIPALE 1       1
> ...done.
> 
> Our consumer receive an InterruptedException via
> ExecutorService.shutdownNow() in queue.take() in the QueuingConsummer.
> We reuse channels on the same connection but not on two concurrent
> threads at a time.

This is to be expected. When using shutdownNow() all worker threads are interrupted and queue.take() is a perfectly interruptible operation. This isn't necessarily a problem because interruption is intended to be a cooperative process between threads. The interruption itself doesn't actually leave the consumer or the server in any bad state. In fact, after the ES has shutdown, you can happily take that same QueueingConsumer and start calling nextDelivery on other threads and it will continue to work.

> 
> Is there a better way to close the QueuingConsummer.nextDelivery() ?

That depends on your definition of better :) You could call ExecutorServer.shutdown followed by ExecutorService.waitForTermination(). This will give the worker threads in the ES some time to drain what is left in the queue and exit gracefully. 

> 
> -- 
> Philippe Blayo & Bruno Thomas
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mikeb at rabbitmq.com  Fri Nov  5 11:18:01 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 05 Nov 2010 11:18:01 +0000
Subject: [rabbitmq-discuss] Exception on TCP connection
In-Reply-To: <418228.62636.qm@web111008.mail.gq1.yahoo.com>
References: <418228.62636.qm@web111008.mail.gq1.yahoo.com>
Message-ID: <4CD3E7E9.5090500@rabbitmq.com>

Hi Dave,

> Every once in a while we notice this error in our RabbitMQ logs. Any idea what
> this means?
 >
>   =ERROR REPORT==== 2-Nov-2010::19:37:31 ===
> exception on TCP connection<0.10945.3>  from 192.168.210.9:14189
> {timeout,running}

It indicates missed heartbeats.

Have a look here:
http://old.nabble.com/Unexplained-shutdown-of-RabbitMQ-td28558360.html

and here:
http://forum.trapexit.org/mailinglists/viewtopic.php?t=16662&sid=9c5323df7c6a6b8cf28ffc9ba6c34fd6

> We run 2 RabbitMQ 2.0 nodes unclustered, sitting behind a load balancer.  Only 1
> RabbitMQ node active at a time in the load balancer. Second one  is there mainly
> for failing over to.
>
>
> When this happens the shutdown listener on the Java Client API does not fire in
> spite of having AMQP Heartbeats enabled.

Does the connection actually get closed though?  If I recall correctly, 
connections will only be forcibly closed if a client misses a number of 
heartbeats in a row (two I think).


Michael

 > There are no other significant entries
> in the logs. Just the standard "starting TCP connection",  "closing TCP
> connection", "accepted TCP connection" and "connection_closed_abruptly" entries
> (Connection closed abruptly is just the load balancer checking whether Rabbit
> node is alive).
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From majek04 at gmail.com  Fri Nov  5 12:33:27 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 5 Nov 2010 12:33:27 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
Message-ID: <AANLkTimMamcVaiV=X9HZoa70bg-SU=-XSJGgL8CiZuv7@mail.gmail.com>

On Thu, Nov 4, 2010 at 17:47, Christian Legnitto <clegnitto at mozilla.com> wrote:
> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>> I'm interested in creating a websockets plugin for Rabbit.
>>
>> But I'm not really sure how you'd like to use it.
>>
>> As a thing exposed to the wild internet?
>> Or just as another framing for AMQP?
>> Or as a wire protocol for STOMP?
>> (like this thing http://jmesnil.net/stomp-websocket/doc/)
>>
>
> I was thinking more like http://jmesnil.net/stomp-websocket/doc/, as that's what I have been using. Of course, the more options the merrier :-) I can't really provide erlang help, but I'm sure I can poke the WebSocket guys here at Moz to provide any assistance required on that front.

Christian,

I understand that tunneling STOMP over websockets is cool,
but I can't imagine a good use case for that.

For example, inside a datacentre I'd probably use just raw Stomp.
I would be quite reluctant to expose Stomp/websockets to users
over the internet, because of security concerns - the users will
effectively gain almost full control of the server (via stomp protocol).

Do you have a specific use case in mind?

Cheers,
  Marek

From shane at digitalsanctum.com  Fri Nov  5 13:25:30 2010
From: shane at digitalsanctum.com (Shane)
Date: Fri, 5 Nov 2010 06:25:30 -0700 (PDT)
Subject: [rabbitmq-discuss] what would cause queue size to immediately go to
	0?
Message-ID: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>

I have a fanout exchange with one consumer and I'm seeing the queue
size go from over 60 to 0 as soon as the first message is consumed.
After that I'm seeing logging indicating the messages are continuing
to get consumed at the expected rate (one every ~30s). I'm observing
the queue size by looking at the "Queues" page of the mgmt plugin as
well as running rabbitmqctl list_queues. I've tested this with all the
2.x versions and erlange 5.7.5 and 5.8.1.1 on windows xp.

Anyone see this behavior before?


From majek04 at gmail.com  Fri Nov  5 13:33:38 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 5 Nov 2010 13:33:38 +0000
Subject: [rabbitmq-discuss] what would cause queue size to immediately
 go to 0?
In-Reply-To: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
Message-ID: <AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>

On Fri, Nov 5, 2010 at 13:25, Shane <shane at digitalsanctum.com> wrote:
> I have a fanout exchange with one consumer and I'm seeing the queue
> size go from over 60 to 0 as soon as the first message is consumed.
> After that I'm seeing logging indicating the messages are continuing
> to get consumed at the expected rate (one every ~30s). I'm observing
> the queue size by looking at the "Queues" page of the mgmt plugin as
> well as running rabbitmqctl list_queues. I've tested this with all the
> 2.x versions and erlange 5.7.5 and 5.8.1.1 on windows xp.
>
> Anyone see this behavior before?

Shane,

You probably use `no_ack=True` flag for `basic.consume`.
With acknowledgments turned off (noack=True), all the messages
from the queue get delivered immediately to your consumer.

It doesn't really matter how fast is your consumer - Rabbit
believes that all the messages were delivered, while, in fact
they are buffered somewhere on the network.

Please try using explicit acknowledgments, with no_ack=False
and do acks manually using `basic_ack`

Cheers,
  Marek

From matthew at rabbitmq.com  Fri Nov  5 13:56:07 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 5 Nov 2010 13:56:07 +0000
Subject: [rabbitmq-discuss] what would cause queue size to immediately
 go to 0?
In-Reply-To: <AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
	<AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
Message-ID: <20101105135606.GJ4220@wellquite.org>

On Fri, Nov 05, 2010 at 01:33:38PM +0000, Marek Majkowski wrote:
> Please try using explicit acknowledgments, with no_ack=False
> and do acks manually using `basic_ack`

You might also need to use basic.qos to prevent the broker flooding the
client with msgs. But in general, this behaviour is "fine", provided
that's what you require in terms of behaviour of the consumers.

It's always worth looking at messages_ready (i.e. messages in the queue
which have not been delivered yet) and messages_unacknowledged (i.e.
messages which have been delivered by the queue for which no
acknowledgement has been received yet), to see quite what's going on.
(The "messages" field is the sum of those two).

Matthew

From james.r.carr at gmail.com  Fri Nov  5 14:17:13 2010
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 5 Nov 2010 09:17:13 -0500
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <AANLkTimMamcVaiV=X9HZoa70bg-SU=-XSJGgL8CiZuv7@mail.gmail.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>
	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>
	<AANLkTimMamcVaiV=X9HZoa70bg-SU=-XSJGgL8CiZuv7@mail.gmail.com>
Message-ID: <AANLkTi=sND=PXxyrQnG1ef2c2TOJM6jHbnnMB8M94xT0@mail.gmail.com>

I'll chime in real quick... I am an avid Socket.IO user and I love it
because it has good fallback techniques. Also I think rabbitmq
shouldn't distribute a client library but rather just support
websockets as a protocol. I keep seeing this as being quite useful
because most of the time when I use node.js to tie socket.IO and
rabbitmq together it is just a simple pass through. :)

Thanks,
James



On Fri, Nov 5, 2010 at 7:33 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Thu, Nov 4, 2010 at 17:47, Christian Legnitto <clegnitto at mozilla.com> wrote:
>> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>>> I'm interested in creating a websockets plugin for Rabbit.
>>>
>>> But I'm not really sure how you'd like to use it.
>>>
>>> As a thing exposed to the wild internet?
>>> Or just as another framing for AMQP?
>>> Or as a wire protocol for STOMP?
>>> (like this thing http://jmesnil.net/stomp-websocket/doc/)
>>>
>>
>> I was thinking more like http://jmesnil.net/stomp-websocket/doc/, as that's what I have been using. Of course, the more options the merrier :-) I can't really provide erlang help, but I'm sure I can poke the WebSocket guys here at Moz to provide any assistance required on that front.
>
> Christian,
>
> I understand that tunneling STOMP over websockets is cool,
> but I can't imagine a good use case for that.
>
> For example, inside a datacentre I'd probably use just raw Stomp.
> I would be quite reluctant to expose Stomp/websockets to users
> over the internet, because of security concerns - the users will
> effectively gain almost full control of the server (via stomp protocol).
>
> Do you have a specific use case in mind?
>
> Cheers,
> ?Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mikeb at rabbitmq.com  Fri Nov  5 14:21:10 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 05 Nov 2010 14:21:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <AANLkTi=sND=PXxyrQnG1ef2c2TOJM6jHbnnMB8M94xT0@mail.gmail.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>	<AANLkTimMamcVaiV=X9HZoa70bg-SU=-XSJGgL8CiZuv7@mail.gmail.com>
	<AANLkTi=sND=PXxyrQnG1ef2c2TOJM6jHbnnMB8M94xT0@mail.gmail.com>
Message-ID: <4CD412D6.9080902@rabbitmq.com>

> I'll chime in real quick... I am an avid Socket.IO user and I love it
> because it has good fallback techniques. Also I think rabbitmq
> shouldn't distribute a client library but rather just support
> websockets as a protocol. I keep seeing this as being quite useful
> because most of the time when I use node.js to tie socket.IO and
> rabbitmq together it is just a simple pass through. :)

Something I have considered is supporting bare websockets and the 
Socket.IO "protocols", such that the Socket.IO client works with 
RabbitMQ directly.  Is that what you're suggesting, or otherwise would 
that be a good idea do you think?


Michael.


> On Fri, Nov 5, 2010 at 7:33 AM, Marek Majkowski<majek04 at gmail.com>  wrote:
>> On Thu, Nov 4, 2010 at 17:47, Christian Legnitto<clegnitto at mozilla.com>  wrote:
>>> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>>>> I'm interested in creating a websockets plugin for Rabbit.
>>>>
>>>> But I'm not really sure how you'd like to use it.
>>>>
>>>> As a thing exposed to the wild internet?
>>>> Or just as another framing for AMQP?
>>>> Or as a wire protocol for STOMP?
>>>> (like this thing http://jmesnil.net/stomp-websocket/doc/)
>>>>
>>>
>>> I was thinking more like http://jmesnil.net/stomp-websocket/doc/, as that's what I have been using. Of course, the more options the merrier :-) I can't really provide erlang help, but I'm sure I can poke the WebSocket guys here at Moz to provide any assistance required on that front.
>>
>> Christian,
>>
>> I understand that tunneling STOMP over websockets is cool,
>> but I can't imagine a good use case for that.
>>
>> For example, inside a datacentre I'd probably use just raw Stomp.
>> I would be quite reluctant to expose Stomp/websockets to users
>> over the internet, because of security concerns - the users will
>> effectively gain almost full control of the server (via stomp protocol).
>>
>> Do you have a specific use case in mind?
>>
>> Cheers,
>>   Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From shane at digitalsanctum.com  Fri Nov  5 14:52:52 2010
From: shane at digitalsanctum.com (Shane)
Date: Fri, 5 Nov 2010 07:52:52 -0700 (PDT)
Subject: [rabbitmq-discuss] what would cause queue size to immediately
	go to 0?
In-Reply-To: <20101105135606.GJ4220@wellquite.org>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
	<AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
	<20101105135606.GJ4220@wellquite.org>
Message-ID: <0a957937-a8c9-4c03-902c-abf68eb7f979@f16g2000vbz.googlegroups.com>

Thanks for the replies. It looks as though the messages are indeed all
acknowledged but I'm still puzzled as to why since I haven't changed
no_ack or QOS from their defaults.

I'm using Spring AMQP and Java client 2.1.1. Where should I be setting
or checking the settings mentioned?


On Nov 5, 9:56?am, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Fri, Nov 05, 2010 at 01:33:38PM +0000, Marek Majkowski wrote:
> > Please try using explicit acknowledgments, with no_ack=False
> > and do acks manually using `basic_ack`
>
> You might also need to use basic.qos to prevent the broker flooding the
> client with msgs. But in general, this behaviour is "fine", provided
> that's what you require in terms of behaviour of the consumers.
>
> It's always worth looking at messages_ready (i.e. messages in the queue
> which have not been delivered yet) and messages_unacknowledged (i.e.
> messages which have been delivered by the queue for which no
> acknowledgement has been received yet), to see quite what's going on.
> (The "messages" field is the sum of those two).
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mikeb at rabbitmq.com  Fri Nov  5 15:13:12 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 05 Nov 2010 15:13:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Websockets
In-Reply-To: <AANLkTi=sND=PXxyrQnG1ef2c2TOJM6jHbnnMB8M94xT0@mail.gmail.com>
References: <AANLkTi=i+_Mr0pgSx4MnpV5362OEi+6NwLL0-r6S8KiF@mail.gmail.com>	<290D8F72-5659-45E6-9CAB-120ECC2170F0@mozilla.com>	<AANLkTimMamcVaiV=X9HZoa70bg-SU=-XSJGgL8CiZuv7@mail.gmail.com>
	<AANLkTi=sND=PXxyrQnG1ef2c2TOJM6jHbnnMB8M94xT0@mail.gmail.com>
Message-ID: <4CD41F08.5080206@rabbitmq.com>

James,

> Also I think rabbitmq
> shouldn't distribute a client library but rather just support
> websockets as a protocol.

What would this look like? (e.g., how would you send a message to a queue?)

mkb.

> On Fri, Nov 5, 2010 at 7:33 AM, Marek Majkowski<majek04 at gmail.com>  wrote:
>> On Thu, Nov 4, 2010 at 17:47, Christian Legnitto<clegnitto at mozilla.com>  wrote:
>>> On Nov 4, 2010, at 10:26 AM, Marek Majkowski wrote:
>>>> I'm interested in creating a websockets plugin for Rabbit.
>>>>
>>>> But I'm not really sure how you'd like to use it.
>>>>
>>>> As a thing exposed to the wild internet?
>>>> Or just as another framing for AMQP?
>>>> Or as a wire protocol for STOMP?
>>>> (like this thing http://jmesnil.net/stomp-websocket/doc/)
>>>>
>>>
>>> I was thinking more like http://jmesnil.net/stomp-websocket/doc/, as that's what I have been using. Of course, the more options the merrier :-) I can't really provide erlang help, but I'm sure I can poke the WebSocket guys here at Moz to provide any assistance required on that front.
>>
>> Christian,
>>
>> I understand that tunneling STOMP over websockets is cool,
>> but I can't imagine a good use case for that.
>>
>> For example, inside a datacentre I'd probably use just raw Stomp.
>> I would be quite reluctant to expose Stomp/websockets to users
>> over the internet, because of security concerns - the users will
>> effectively gain almost full control of the server (via stomp protocol).
>>
>> Do you have a specific use case in mind?
>>
>> Cheers,
>>   Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From rob at rabbitmq.com  Fri Nov  5 15:22:43 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 5 Nov 2010 15:22:43 +0000
Subject: [rabbitmq-discuss] what would cause queue size to immediately
	go to 0?
In-Reply-To: <0a957937-a8c9-4c03-902c-abf68eb7f979@f16g2000vbz.googlegroups.com>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
	<AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
	<20101105135606.GJ4220@wellquite.org>
	<0a957937-a8c9-4c03-902c-abf68eb7f979@f16g2000vbz.googlegroups.com>
Message-ID: <A5DE326A-BDE9-4D60-AE7E-07DA4C07E224@rabbitmq.com>


On 5 Nov 2010, at 14:52, Shane wrote:

> Thanks for the replies. It looks as though the messages are indeed all
> acknowledged but I'm still puzzled as to why since I haven't changed
> no_ack or QOS from their defaults.
> 
> I'm using Spring AMQP and Java client 2.1.1. Where should I be setting
> or checking the settings mentioned?

Well, in Spring AMQP noAck is managed for you depending on how you consume the messages. 

Are you using one of the MessageListenerContainer implementations? Also, are you using transactions?

> 
> 
> On Nov 5, 9:56 am, Matthew Sackman <matt... at rabbitmq.com> wrote:
>> On Fri, Nov 05, 2010 at 01:33:38PM +0000, Marek Majkowski wrote:
>>> Please try using explicit acknowledgments, with no_ack=False
>>> and do acks manually using `basic_ack`
>> 
>> You might also need to use basic.qos to prevent the broker flooding the
>> client with msgs. But in general, this behaviour is "fine", provided
>> that's what you require in terms of behaviour of the consumers.
>> 
>> It's always worth looking at messages_ready (i.e. messages in the queue
>> which have not been delivered yet) and messages_unacknowledged (i.e.
>> messages which have been delivered by the queue for which no
>> acknowledgement has been received yet), to see quite what's going on.
>> (The "messages" field is the sum of those two).
>> 
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From shane at digitalsanctum.com  Fri Nov  5 15:43:32 2010
From: shane at digitalsanctum.com (Shane)
Date: Fri, 5 Nov 2010 08:43:32 -0700 (PDT)
Subject: [rabbitmq-discuss] what would cause queue size to immediately
	go to 0?
In-Reply-To: <A5DE326A-BDE9-4D60-AE7E-07DA4C07E224@rabbitmq.com>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
	<AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
	<20101105135606.GJ4220@wellquite.org>
	<0a957937-a8c9-4c03-902c-abf68eb7f979@f16g2000vbz.googlegroups.com>
	<A5DE326A-BDE9-4D60-AE7E-07DA4C07E224@rabbitmq.com>
Message-ID: <3d53ddee-a5c9-4bdc-b6f1-81a78bcfd598@o2g2000vbh.googlegroups.com>

Rob,

I'm using the SimpleMessageListenerContainer with a very simple
message handler and not using transactions. Here's the relevant config
(concurrentCustomers is 2):

@Bean
  public SimpleMessageListenerContainer listenerContainer() {
    SimpleMessageListenerContainer container = new
SimpleMessageListenerContainer();
    container.setConnectionFactory(connectionFactory());
    container.setMessageListener(messageListenerAdapter());
    container.setConcurrentConsumers(concurrentConsumers);
    container.setQueues(dexcQueue());
    return container;
  }

  @Bean
  public MessageListenerAdapter messageListenerAdapter() {
    return new MessageListenerAdapter(cmdHandler(),
jsonMessageConverter());
  }

  @Bean
  public CmdHandler cmdHandler() {
    return new CmdHandler();
  }

@Bean
  public Queue dexcQueue() {
    return new Queue(DexcQueue.DEXC_REQUEST.getQueueName());
  }

  @Bean
  public FanoutExchange dexcExchange() {
    return new
FanoutExchange(DexcExchange.DEXC_FANOUT.getExchangeName());
  }

  @Bean
  public Binding dexcBinding() {
    return BindingBuilder.from(dexcQueue()).to(dexcExchange());
  }



On Nov 5, 11:22?am, Rob Harrop <r... at rabbitmq.com> wrote:
> On 5 Nov 2010, at 14:52, Shane wrote:
>
> > Thanks for the replies. It looks as though the messages are indeed all
> > acknowledged but I'm still puzzled as to why since I haven't changed
> > no_ack or QOS from their defaults.
>
> > I'm using Spring AMQP and Java client 2.1.1. Where should I be setting
> > or checking the settings mentioned?
>
> Well, in Spring AMQP noAck is managed for you depending on how you consume the messages.
>
> Are you using one of the MessageListenerContainer implementations? Also, are you using transactions?
>
>
>
>
>
>
>
>
>
>
>
> > On Nov 5, 9:56 am, Matthew Sackman <matt... at rabbitmq.com> wrote:
> >> On Fri, Nov 05, 2010 at 01:33:38PM +0000, Marek Majkowski wrote:
> >>> Please try using explicit acknowledgments, with no_ack=False
> >>> and do acks manually using `basic_ack`
>
> >> You might also need to use basic.qos to prevent the broker flooding the
> >> client with msgs. But in general, this behaviour is "fine", provided
> >> that's what you require in terms of behaviour of the consumers.
>
> >> It's always worth looking at messages_ready (i.e. messages in the queue
> >> which have not been delivered yet) and messages_unacknowledged (i.e.
> >> messages which have been delivered by the queue for which no
> >> acknowledgement has been received yet), to see quite what's going on.
> >> (The "messages" field is the sum of those two).
>
> >> Matthew
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david_syer at hotmail.com  Fri Nov  5 15:51:55 2010
From: david_syer at hotmail.com (Dave Syer)
Date: Fri, 5 Nov 2010 08:51:55 -0700 (PDT)
Subject: [rabbitmq-discuss] what would cause queue size to immediately
	go to 0?
In-Reply-To: <3d53ddee-a5c9-4bdc-b6f1-81a78bcfd598@o2g2000vbh.googlegroups.com>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
	<AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
	<20101105135606.GJ4220@wellquite.org>
	<0a957937-a8c9-4c03-902c-abf68eb7f979@f16g2000vbz.googlegroups.com>
	<A5DE326A-BDE9-4D60-AE7E-07DA4C07E224@rabbitmq.com>
	<3d53ddee-a5c9-4bdc-b6f1-81a78bcfd598@o2g2000vbh.googlegroups.com>
Message-ID: <cce0bb32-a482-4f40-9f0a-0bf0838267b6@x42g2000yqx.googlegroups.com>

On Nov 5, 3:22 pm, Rob Harrop <r... at rabbitmq.com> wrote:
> Are you using one of the MessageListenerContainer implementations? Also, are you using transactions?

Also are you using 1.0.0.M1 or a more recent snapshot (because there
is only one flag to set in recent versions - transactional=true/false,
which we translate into noAck if you request non-transactional
usage)?  It's less moving parts and the semantics for common messaging
use cases are simpler.  NoAck is still the default though, so you need
to be explicit, and from the code you posted that is not the case.

I would recommend using a snapshot if you can stand the potential
instability because we have added full support for rollback since
1.0.0.M1.

From shane at digitalsanctum.com  Fri Nov  5 16:07:50 2010
From: shane at digitalsanctum.com (Shane Witbeck)
Date: Fri, 5 Nov 2010 12:07:50 -0400
Subject: [rabbitmq-discuss] what would cause queue size to immediately
 go to 0?
In-Reply-To: <cce0bb32-a482-4f40-9f0a-0bf0838267b6@x42g2000yqx.googlegroups.com>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
	<AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
	<20101105135606.GJ4220@wellquite.org>
	<0a957937-a8c9-4c03-902c-abf68eb7f979@f16g2000vbz.googlegroups.com>
	<A5DE326A-BDE9-4D60-AE7E-07DA4C07E224@rabbitmq.com>
	<3d53ddee-a5c9-4bdc-b6f1-81a78bcfd598@o2g2000vbh.googlegroups.com>
	<cce0bb32-a482-4f40-9f0a-0bf0838267b6@x42g2000yqx.googlegroups.com>
Message-ID: <AANLkTikpDL_Weyq+fo++g=m1ZP-Pu__bHpZSHzV7VvjZ@mail.gmail.com>

I was using 1.0.0.M1 and now using a nightly snapshot (20101104).

Stepping through the code (ChannelN) I saw that noack is true with code
unchanged. I set container.setChannelTransacted(true); and now noack is
false and I see the desired behavior.

I should mention that I'm using the AmqpOutboundEndpoint in the Spring
Integration sandbox to publish messages from a JdbcInboundAdapter. Should I
be aware of any other changes that would effect this setup?

Thanks,
Shane

On Fri, Nov 5, 2010 at 11:51 AM, Dave Syer <david_syer at hotmail.com> wrote:

> On Nov 5, 3:22 pm, Rob Harrop <r... at rabbitmq.com> wrote:
> > Are you using one of the MessageListenerContainer implementations? Also,
> are you using transactions?
>
> Also are you using 1.0.0.M1 or a more recent snapshot (because there
> is only one flag to set in recent versions - transactional=true/false,
> which we translate into noAck if you request non-transactional
> usage)?  It's less moving parts and the semantics for common messaging
> use cases are simpler.  NoAck is still the default though, so you need
> to be explicit, and from the code you posted that is not the case.
>
> I would recommend using a snapshot if you can stand the potential
> instability because we have added full support for rollback since
> 1.0.0.M1.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
-Shane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/110b8749/attachment.htm>

From david_syer at hotmail.com  Fri Nov  5 16:18:48 2010
From: david_syer at hotmail.com (Dave Syer)
Date: Fri, 5 Nov 2010 09:18:48 -0700 (PDT)
Subject: [rabbitmq-discuss] what would cause queue size to immediately
	go to 0?
In-Reply-To: <AANLkTikpDL_Weyq+fo++g=m1ZP-Pu__bHpZSHzV7VvjZ@mail.gmail.com>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
	<AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
	<20101105135606.GJ4220@wellquite.org>
	<0a957937-a8c9-4c03-902c-abf68eb7f979@f16g2000vbz.googlegroups.com>
	<A5DE326A-BDE9-4D60-AE7E-07DA4C07E224@rabbitmq.com>
	<3d53ddee-a5c9-4bdc-b6f1-81a78bcfd598@o2g2000vbh.googlegroups.com>
	<cce0bb32-a482-4f40-9f0a-0bf0838267b6@x42g2000yqx.googlegroups.com>
	<AANLkTikpDL_Weyq+fo++g=m1ZP-Pu__bHpZSHzV7VvjZ@mail.gmail.com>
Message-ID: <5e5cc0ba-c577-4fd7-b772-a17b067540f5@j2g2000yqf.googlegroups.com>

On Nov 5, 4:07?pm, Shane Witbeck <sh... at digitalsanctum.com> wrote:
> Stepping through the code (ChannelN) I saw that noack is true with code
> unchanged. I set container.setChannelTransacted(true); and now noack is
> false and I see the desired behavior.

Cool.  That's what we expect.

> I should mention that I'm using the AmqpOutboundEndpoint in the Spring
> Integration sandbox to publish messages from a JdbcInboundAdapter. Should I
> be aware of any other changes that would effect this setup?

Nothing in the current snapshot, but I am working on
https://jira.springframework.org/browse/AMQP-69 (it's more than a test
now) to support best efforts 1PC (http://www.javaworld.com/javaworld/
jw-01-2009/jw-01-spring-transactions.html).  By analogy with the
Spring JMS support this will be enabled if you inject a transaction
manager into the message listener container.  This might be useful to
you if you want to use a DataSourceTransactionManager in your Spring
Integration flow, and make it single threaded - then if there are any
failures (except a rabbit broker failure after the DB commit) your
system returns to its original state before the transaction.

From davegreggory at yahoo.com  Fri Nov  5 16:58:17 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Fri, 5 Nov 2010 09:58:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Fw:  Exception on TCP connection
In-Reply-To: <4CD3E7E9.5090500@rabbitmq.com>
References: <418228.62636.qm@web111008.mail.gq1.yahoo.com>
	<4CD3E7E9.5090500@rabbitmq.com>
Message-ID: <463355.55600.qm@web111015.mail.gq1.yahoo.com>

Sending to the list...



----- Forwarded Message ----
From: Dave Greggory <davegreggory at yahoo.com>
To: Michael Bridgen <mikeb at rabbitmq.com>
Sent: Fri, November 5, 2010 12:57:30 PM
Subject: Re: [rabbitmq-discuss] Exception on TCP connection

No the connection does not get closed and the shutdown event never fires. 

We enabled AMQP heartbeats (@ 30 seconds), just for the purpose of early 
detection of connection trouble. 

See http://old.nabble.com/Shutdown-Listener-on-Java-Client-API-td29699374.html

So is the normal behavior for connection to shutdown and the shutdown event to 
fire when 2 heartbeats are missed? What could be preventing that?




----- Original Message ----
From: Michael Bridgen <mikeb at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Fri, November 5, 2010 7:18:01 AM
Subject: Re: [rabbitmq-discuss] Exception on TCP connection

Hi Dave,

> Every once in a while we notice this error in our RabbitMQ logs. Any idea what
> this means?
>
>   =ERROR REPORT==== 2-Nov-2010::19:37:31 ===
> exception on TCP connection<0.10945.3>  from 192.168.210.9:14189
> {timeout,running}

It indicates missed heartbeats.

Have a look here:
http://old.nabble.com/Unexplained-shutdown-of-RabbitMQ-td28558360.html

and here:
http://forum.trapexit.org/mailinglists/viewtopic.php?t=16662&sid=9c5323df7c6a6b8cf28ffc9ba6c34fd6



> We run 2 RabbitMQ 2.0 nodes unclustered, sitting behind a load balancer.  Only 

>1
> RabbitMQ node active at a time in the load balancer. Second one  is there 
>mainly
> for failing over to.
>
>
> When this happens the shutdown listener on the Java Client API does not fire 
in
> spite of having AMQP Heartbeats enabled.

Does the connection actually get closed though?  If I recall correctly, 
connections will only be forcibly closed if a client misses a number of 
heartbeats in a row (two I think).


Michael

> There are no other significant entries
> in the logs. Just the standard "starting TCP connection",  "closing TCP
> connection", "accepted TCP connection" and "connection_closed_abruptly" 
entries
> (Connection closed abruptly is just the load balancer checking whether Rabbit
> node is alive).
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


      

From shane at digitalsanctum.com  Fri Nov  5 18:26:00 2010
From: shane at digitalsanctum.com (Shane)
Date: Fri, 5 Nov 2010 11:26:00 -0700 (PDT)
Subject: [rabbitmq-discuss] what would cause queue size to immediately
	go to 0?
In-Reply-To: <5e5cc0ba-c577-4fd7-b772-a17b067540f5@j2g2000yqf.googlegroups.com>
References: <68a35c25-bfa3-40c5-833d-5b263c96a4ac@k22g2000yqh.googlegroups.com>
	<AANLkTimj4rPadnWTA_ia5CXrd5nkwAqiFTH9C+K+QyED@mail.gmail.com>
	<20101105135606.GJ4220@wellquite.org>
	<0a957937-a8c9-4c03-902c-abf68eb7f979@f16g2000vbz.googlegroups.com>
	<A5DE326A-BDE9-4D60-AE7E-07DA4C07E224@rabbitmq.com>
	<3d53ddee-a5c9-4bdc-b6f1-81a78bcfd598@o2g2000vbh.googlegroups.com>
	<cce0bb32-a482-4f40-9f0a-0bf0838267b6@x42g2000yqx.googlegroups.com>
	<AANLkTikpDL_Weyq+fo++g=m1ZP-Pu__bHpZSHzV7VvjZ@mail.gmail.com>
	<5e5cc0ba-c577-4fd7-b772-a17b067540f5@j2g2000yqf.googlegroups.com>
Message-ID: <f57a37b8-9f4f-46eb-8627-bb5e32b88c81@k22g2000yqh.googlegroups.com>

Thanks everyone. I forgot how volatile working with snapshot code can
be!


On Nov 5, 12:18?pm, Dave Syer <david_s... at hotmail.com> wrote:
> On Nov 5, 4:07?pm, Shane Witbeck <sh... at digitalsanctum.com> wrote:
>
> > Stepping through the code (ChannelN) I saw that noack is true with code
> > unchanged. I set container.setChannelTransacted(true); and now noack is
> > false and I see the desired behavior.
>
> Cool. ?That's what we expect.
>
> > I should mention that I'm using the AmqpOutboundEndpoint in the Spring
> > Integration sandbox to publish messages from a JdbcInboundAdapter. Should I
> > be aware of any other changes that would effect this setup?
>
> Nothing in the current snapshot, but I am working onhttps://jira.springframework.org/browse/AMQP-69(it's more than a test
> now) to support best efforts 1PC (http://www.javaworld.com/javaworld/
> jw-01-2009/jw-01-spring-transactions.html). ?By analogy with the
> Spring JMS support this will be enabled if you inject a transaction
> manager into the message listener container. ?This might be useful to
> you if you want to use a DataSourceTransactionManager in your Spring
> Integration flow, and make it single threaded - then if there are any
> failures (except a rabbit broker failure after the DB commit) your
> system returns to its original state before the transaction.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From shane at digitalsanctum.com  Fri Nov  5 18:55:15 2010
From: shane at digitalsanctum.com (Shane)
Date: Fri, 5 Nov 2010 11:55:15 -0700 (PDT)
Subject: [rabbitmq-discuss] |Spam| broker going down, how to troubleshoot?
Message-ID: <3a80ffe7-316d-4f01-b8da-c75a24ddbbef@a37g2000yqi.googlegroups.com>

We have a one node broker in a dev env which goes down once a day. The
rabbit log doesn't appear to show any clues other than a
"connection_closed_abruptly" which I assume occurs as the broker goes
down. What steps can I take to troubleshoot why the broker is going
down? Running version 2.1.1 running on SuSe linux running. Here's the
relevant rabbit log entries:

=INFO REPORT==== 5-Nov-2010::10:58:28 ===
accepted TCP connection on 0.0.0.0:5672 from 10.164.45.176:4448

=INFO REPORT==== 5-Nov-2010::10:58:28 ===
starting TCP connection <0.4560.22> from 10.164.45.176:4448

=WARNING REPORT==== 5-Nov-2010::11:37:57 ===
exception on TCP connection <0.4560.22> from 10.164.45.176:4448
connection_closed_abruptly

=INFO REPORT==== 5-Nov-2010::11:37:57 ===
closing TCP connection <0.4560.22> from 10.164.45.176:4448


=INFO REPORT==== 5-Nov-2010::12:00:36 ===
Limiting to approx 1048475 file handles (943625 sockets)

=INFO REPORT==== 5-Nov-2010::12:00:36 ===
Memory limit set to 1542MB.

=INFO REPORT==== 5-Nov-2010::12:00:36 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 5-Nov-2010::12:00:36 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 5-Nov-2010::12:00:36 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide
index

=WARNING REPORT==== 5-Nov-2010::12:00:36 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 5-Nov-2010::12:00:36 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 5-Nov-2010::12:00:36 ===
Management plugin started.
HTTP API:       http://nyggmspgd73:55672/api/
Management UI:  http://nyggmspgd73:55672/mgmt/

=INFO REPORT==== 5-Nov-2010::12:00:42 ===
accepted TCP connection on 0.0.0.0:5672 from 10.152.117.173:42281

=INFO REPORT==== 5-Nov-2010::12:00:42 ===
starting TCP connection <0.290.0> from 10.152.117.173:42281

From matthias at rabbitmq.com  Fri Nov  5 19:03:45 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 05 Nov 2010 19:03:45 +0000
Subject: [rabbitmq-discuss] |Spam|  |Spam| broker going down,
	how to	troubleshoot?
In-Reply-To: <3a80ffe7-316d-4f01-b8da-c75a24ddbbef@a37g2000yqi.googlegroups.com>
References: <3a80ffe7-316d-4f01-b8da-c75a24ddbbef@a37g2000yqi.googlegroups.com>
Message-ID: <4CD45511.70707@rabbitmq.com>

Shane,

Shane wrote:
> We have a one node broker in a dev env which goes down once a day. [...]
> Here's the relevant rabbit log entries:

Is there anything in the rabbit-sasl.log file?

How was rabbit started on that machine?

> =WARNING REPORT==== 5-Nov-2010::11:37:57 ===
> exception on TCP connection <0.4560.22> from 10.164.45.176:4448
> connection_closed_abruptly

That's a client disconnecting. It's unlikely that it has anything to do 
with rabbit going down.

> =INFO REPORT==== 5-Nov-2010::12:00:36 ===
> Limiting to approx 1048475 file handles (943625 sockets)

Hmm. Just after mid-day. Does rabbit go down at the same time every day?


Regards,

Matthias.

From fdourado at bancofator.com.br  Fri Nov  5 19:26:08 2010
From: fdourado at bancofator.com.br (Fernando Rodrigo Chagas Dourado)
Date: Fri, 5 Nov 2010 17:26:08 -0200
Subject: [rabbitmq-discuss] JBoss and RabbitMQ
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C7F09E83@FSP-SRV-EXCH01.FatorDoria.br>

Hello,

 

I have a doubt about jBoss and RabbitMQ.

 

It's possible to jBoss consume or deliver a message to RabbitMQ? 

 

I'm looking for some solution that doesn't use threads inside
application server.

 

--

Fernando Dourado

 



Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.  
SAC: 0800 770 7229 ou sac at bancofator.com.br 
Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)      
                 email : ouvidoria at bancofator.com.br                                                    
                 carta:   Rua Dr. Renato Paes de Barros, 1017, 12o.andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001.

Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation. 
Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator 
Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)              
              or by email: ouvidoria at bancofator.com.br                           
              or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001 .
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/0a795724/attachment-0001.htm>

From matthias at rabbitmq.com  Fri Nov  5 19:28:16 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 05 Nov 2010 19:28:16 +0000
Subject: [rabbitmq-discuss] |Spam|  |Spam| broker going down,
	how to troubleshoot?
In-Reply-To: <AANLkTi=aVKkz0mhNUtcNdxktLgdN9vBnqcTo0QPswv8u@mail.gmail.com>
References: <3a80ffe7-316d-4f01-b8da-c75a24ddbbef@a37g2000yqi.googlegroups.com>	<4CD45511.70707@rabbitmq.com>
	<AANLkTi=aVKkz0mhNUtcNdxktLgdN9vBnqcTo0QPswv8u@mail.gmail.com>
Message-ID: <4CD45AD0.1020309@rabbitmq.com>

Shane,

Shane Witbeck wrote:
> The rabbit-sasl.log is 5MB but the last entry was from Oct 28. 

Right. So clearly something went wrong before that date since the sasl 
log should normally be empty.

> Yesterday the broker went down at ~2pm, so not the same time every day.
> The rabbit started via "rabbitmq-server start -detached"

That's a strange way to start rabbit. Where did you get that from? How 
did you install rabbit? We generally recommend that people install 
rabbit from the package for their o/s and start/stop it using the 
appropriate system commands. On SuSe that should be s.t. like

/sbin/service rabbitmq-server start

(according to http://www.rabbitmq.com/install.html#rpm - I am not a SuSe 
expert)

Though that doesn't quite explain why rabbit would die. Is there 
anything noteworthy in the system logs? Perhaps rabbit is being nuked by 
the infamous OOM Killer.


Matthias.
PS: please keep rabbitmq-discuss cc'ed.

From shane at digitalsanctum.com  Fri Nov  5 19:41:08 2010
From: shane at digitalsanctum.com (Shane Witbeck)
Date: Fri, 5 Nov 2010 15:41:08 -0400
Subject: [rabbitmq-discuss] |Spam|  |Spam| broker going down,
	how to troubleshoot?
In-Reply-To: <4CD45AD0.1020309@rabbitmq.com>
References: <3a80ffe7-316d-4f01-b8da-c75a24ddbbef@a37g2000yqi.googlegroups.com>
	<4CD45511.70707@rabbitmq.com>
	<AANLkTi=aVKkz0mhNUtcNdxktLgdN9vBnqcTo0QPswv8u@mail.gmail.com>
	<4CD45AD0.1020309@rabbitmq.com>
Message-ID: <AANLkTimzFZY7nVHW0SUOR_mJ1=a_S0EKT+MNrZENEFGw@mail.gmail.com>

I installed rabbit via the generic unix tar because we don't have access to
the normal OS package manager (one of the joys of being in a strict
corporate env).

I got "rabbitmq-server start -detached" from the documentation (
http://www.rabbitmq.com/install.html#running-generic-unix)

I haven't found anything noteworthy in the system logs yet.


On Fri, Nov 5, 2010 at 3:28 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Shane,
>
>
> Shane Witbeck wrote:
>
>> The rabbit-sasl.log is 5MB but the last entry was from Oct 28.
>>
>
> Right. So clearly something went wrong before that date since the sasl log
> should normally be empty.
>
>
>  Yesterday the broker went down at ~2pm, so not the same time every day.
>> The rabbit started via "rabbitmq-server start -detached"
>>
>
> That's a strange way to start rabbit. Where did you get that from? How did
> you install rabbit? We generally recommend that people install rabbit from
> the package for their o/s and start/stop it using the appropriate system
> commands. On SuSe that should be s.t. like
>
> /sbin/service rabbitmq-server start
>
> (according to http://www.rabbitmq.com/install.html#rpm - I am not a SuSe
> expert)
>
> Though that doesn't quite explain why rabbit would die. Is there anything
> noteworthy in the system logs? Perhaps rabbit is being nuked by the infamous
> OOM Killer.
>
>
> Matthias.
> PS: please keep rabbitmq-discuss cc'ed.
>



-- 
-Shane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/b2d3f1d6/attachment.htm>

From matthias at rabbitmq.com  Fri Nov  5 19:51:45 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 05 Nov 2010 19:51:45 +0000
Subject: [rabbitmq-discuss] |Spam|  |Spam| broker going down,
	how to troubleshoot?
In-Reply-To: <AANLkTimzFZY7nVHW0SUOR_mJ1=a_S0EKT+MNrZENEFGw@mail.gmail.com>
References: <3a80ffe7-316d-4f01-b8da-c75a24ddbbef@a37g2000yqi.googlegroups.com>	<4CD45511.70707@rabbitmq.com>	<AANLkTi=aVKkz0mhNUtcNdxktLgdN9vBnqcTo0QPswv8u@mail.gmail.com>	<4CD45AD0.1020309@rabbitmq.com>
	<AANLkTimzFZY7nVHW0SUOR_mJ1=a_S0EKT+MNrZENEFGw@mail.gmail.com>
Message-ID: <4CD46051.5040004@rabbitmq.com>

Shane,

Shane Witbeck wrote:
> I installed rabbit via the generic unix tar because we don't have access 
> to the normal OS package manager (one of the joys of being in a strict 
> corporate env).

ok. Did you have to set any env vars / modify the startup scripts in any 
way? And are you running rabbit as root, a dedicated 'rabbitmq' user, or 
yourself?

> I got "rabbitmq-server start -detached" from the documentation 
> (http://www.rabbitmq.com/install.html#running-generic-unix)

There is no "start" in there. Shouldn't cause any harm though.

Is there an erl_crash.dump in the directory from which you started rabbit?

> I haven't found anything noteworthy in the system logs yet.

I see your rabbit is running the management plugin. Have you been 
keeping an eye on it through that? And did anything odd crop up - high 
memory or fd use, for example - just before the death?

It is quite rare for rabbit to die, and very unusual indeed for it to do 
so without a trace. For that to happen the most likely cause of death is 
that something/body is killing it.


Regards,

Matthias.

From shane at digitalsanctum.com  Fri Nov  5 20:10:19 2010
From: shane at digitalsanctum.com (Shane Witbeck)
Date: Fri, 5 Nov 2010 16:10:19 -0400
Subject: [rabbitmq-discuss] |Spam|  |Spam| broker going down,
	how to troubleshoot?
In-Reply-To: <4CD46051.5040004@rabbitmq.com>
References: <3a80ffe7-316d-4f01-b8da-c75a24ddbbef@a37g2000yqi.googlegroups.com>
	<4CD45511.70707@rabbitmq.com>
	<AANLkTi=aVKkz0mhNUtcNdxktLgdN9vBnqcTo0QPswv8u@mail.gmail.com>
	<4CD45AD0.1020309@rabbitmq.com>
	<AANLkTimzFZY7nVHW0SUOR_mJ1=a_S0EKT+MNrZENEFGw@mail.gmail.com>
	<4CD46051.5040004@rabbitmq.com>
Message-ID: <AANLkTi==TkghG_xsVhVFk2k3yH-M7JWxZdV+LMJN6gdm@mail.gmail.com>

Here's the env vars we set prior to starting the broker:

ERLANG_VERSION=R14A
RABBIT_VERSION=2.1.1
RABBIT_HOME=/data/spg/prod/3rd/rabbitmq/rabbitmq_server-${RABBIT_VERSION}
export ERLANG_HOME=/data/spg/prod/3rd/erlang/${ERLANG_VERSION}
export RABBITMQ_LOG_BASE=/var/tmp/spg/rabbitmq
export
RABBITMQ_MNESIA_BASE=/data/spg/prodrw/rabbitmq/rel/incr/${SPG_FARM_ENV}/data/mnesia
export
RABBITMQ_CONFIG_FILE=/data/spg/prodrw/rabbitmq/rel/incr/${SPG_FARM_ENV}/conf/rabbitmq
export PATH=$PATH:$ERLANG_HOME/bin:${RABBIT_HOME}/sbin

Not running as root but using a shared login (I know it's bad but out of my
control).

The only thing I've noticed about the mgmt plugin is that it has a nasty
memory leak in the IE browser (if left open over night, it accumulates over
1GB of memory). This probably has nothing to do with the broker going down
but thought I'd mention it since you asked :)

Since it's happened twice now in as many days I will be keeping a closer eye
on it and report back with whatever I find.

Thanks


On Fri, Nov 5, 2010 at 3:51 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Shane,
>
>
> Shane Witbeck wrote:
>
>> I installed rabbit via the generic unix tar because we don't have access
>> to the normal OS package manager (one of the joys of being in a strict
>> corporate env).
>>
>
> ok. Did you have to set any env vars / modify the startup scripts in any
> way? And are you running rabbit as root, a dedicated 'rabbitmq' user, or
> yourself?
>
>
>  I got "rabbitmq-server start -detached" from the documentation (
>> http://www.rabbitmq.com/install.html#running-generic-unix)
>>
>
> There is no "start" in there. Shouldn't cause any harm though.
>
> Is there an erl_crash.dump in the directory from which you started rabbit?
>
>
>  I haven't found anything noteworthy in the system logs yet.
>>
>
> I see your rabbit is running the management plugin. Have you been keeping
> an eye on it through that? And did anything odd crop up - high memory or fd
> use, for example - just before the death?
>
> It is quite rare for rabbit to die, and very unusual indeed for it to do so
> without a trace. For that to happen the most likely cause of death is that
> something/body is killing it.
>
>
> Regards,
>
> Matthias.
>



-- 
-Shane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/7ab87807/attachment.htm>

From MVierling at attinteractive.com  Sat Nov  6 05:40:09 2010
From: MVierling at attinteractive.com (Michael Vierling)
Date: Fri, 5 Nov 2010 22:40:09 -0700
Subject: [rabbitmq-discuss] Mgmt Plugin (2.1.1) feedback
Message-ID: <237050FF255D844CBDF840D42334EB9B66C66280F1@SFOEXM02.YELLOWPAGES.LOCAL>

Overall we really like the new Management Plugin.  We're using this instead of Alice now.  There are a few areas that could use improvement though.  Here are some feature requests:

- Queue Size (aggregate)
It would be helpful to display the current, aggregate queue size, i.e. the total sum of all queues.  This can help an Admin detect when a queue is not getting drained.  This could be displayed as a single number on the /api/overview within the Message Rates row.

- RabbitMQ version
Can System Information display the RabbitMQ version?  We added this into Alice.  It is very helpful when managing a cluster, because sometimes a node fails to get upgraded.  The version of Erlang can also be useful.

- Uptime
Also added to Alice.  This is useful to track reliability.

-rabbitmqadmin CLI
We like it!  However, it is missing the ability to display /api/overview.  Also would still prefer a key-value pair option.

-Firefox strangeness
I've noticed that I can only have one dashboard window open.  We have about 32 RabbitMQ nodes.  Normally I would keep all 32 nodes open, each in a separate tab window, in Firefox.  But this seems to slow Firefox so much that it becomes unusable.  At a certain point Firefox needs to be killed and after that because of some glitch it is impossible to login back into RabbitMQ's dashboard.

Great job overall though.  The ability to drill down into Channels and see individual rates and counts is really nice.

Best,
Michael




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101105/792021cb/attachment-0001.htm>

From simon at rabbitmq.com  Sat Nov  6 11:55:06 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sat, 06 Nov 2010 11:55:06 +0000
Subject: [rabbitmq-discuss] Mgmt Plugin (2.1.1) feedback
In-Reply-To: <237050FF255D844CBDF840D42334EB9B66C66280F1@SFOEXM02.YELLOWPAGES.LOCAL>
References: <237050FF255D844CBDF840D42334EB9B66C66280F1@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <4CD5421A.9020405@rabbitmq.com>

On 06/11/2010 5:40AM, Michael Vierling wrote:
> Overall we really like the new Management Plugin.

Cool.

> Here are some feature requests:
>
> - Queue Size (aggregate)
>
> It would be helpful to display the current, aggregate queue size, i.e.
> the total sum of all queues. This can help an Admin detect when a queue
> is not getting drained. This could be displayed as a single number on
> the /api/overview within the Message Rates row.

Yeah, that sounds fairly useful.

> - RabbitMQ version
>
> Can System Information display the RabbitMQ version? We added this into
> Alice. It is very helpful when managing a cluster, because sometimes a
> node fails to get upgraded. The version of Erlang can also be useful.

This is already there, albeit obscurely - open the applications pane on 
the overview page and you can see versions of all running applications.

> - Uptime
>
> Also added to Alice. This is useful to track reliability.

Sounds useful.

> -rabbitmqadmin CLI
>
> We like it! However, it is missing the ability to display /api/overview.

That's a fair point, but the trouble is it's not very table-like 
(although it's becoming more so...)

> Also would still prefer a key-value pair option.

I think the KV part is not in doubt (as to general usefulness), it's the 
timestamp bit that feels very special-cased.

> -Firefox strangeness
>
> I've noticed that I can only have one dashboard window open. We have
> about 32 RabbitMQ nodes. Normally I would keep all 32 nodes open, each
> in a separate tab window, in Firefox. But this seems to slow Firefox so
> much that it becomes unusable. At a certain point Firefox needs to be
> killed and after that because of some glitch it is impossible to login
> back into RabbitMQ's dashboard.

Hmm. I'll investigate. Of course, JavaScript should never leak memory, 
but there are some bad GCs out there...

> Great job overall though. The ability to drill down into Channels and
> see individual rates and counts is really nice.

You'll like the upcoming version then; that's extended so you can do the 
same for queues and exchanges, as well as seeing rates at which 
channels, exchanges and queues are talking to each other.

Cheers, Simon

From nickperkinslondon at gmail.com  Sat Nov  6 15:07:51 2010
From: nickperkinslondon at gmail.com (Nick Perkins)
Date: Sat, 6 Nov 2010 11:07:51 -0400
Subject: [rabbitmq-discuss] crash! : on Ubuntu inside VirtualBox inside
	Windows 7
Message-ID: <AANLkTimstf_LMVxTFTnFuBPkyw+o3JP3BQCSAyVYDrFv@mail.gmail.com>

Help!

I am a bit of a noob on linux, and I am struggling to get RabbitMQ up
and running...
I installed Ubuntu ( 10.10 ) inside a VirtualBox on Windows 7
( i know thats not ideal, but it should still work, right? )

I downloaded the latest RabbitMQ 2.1.1
I have Erlang 13b
When I run "sudo rabbitmq-server", I get this:

{error_logger,{{2010,11,6},{10,43,45}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,11,6},{10,43,45}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.22.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.80>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,494}],[]]}
{error_logger,{{2010,11,6},{10,43,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at nick-VirtualBox',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,11,6},{10,43,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,11,6},{10,43,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Can anyone help?

-- 
Nick Perkins

From videlalvaro at gmail.com  Sat Nov  6 15:26:49 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 6 Nov 2010 09:26:49 -0600
Subject: [rabbitmq-discuss] crash! : on Ubuntu inside VirtualBox inside
	Windows 7
In-Reply-To: <AANLkTimstf_LMVxTFTnFuBPkyw+o3JP3BQCSAyVYDrFv@mail.gmail.com>
References: <AANLkTimstf_LMVxTFTnFuBPkyw+o3JP3BQCSAyVYDrFv@mail.gmail.com>
Message-ID: <D18E50F2-18A6-42DA-968D-30C51CAA72FA@gmail.com>

Hi Nick,

Do ps ax | grep rabbit

or something like that, you probably have another instance of the server already running

Regards,

Alvaro

On Nov 6, 2010, at 9:07 AM, Nick Perkins wrote:

> Help!
> 
> I am a bit of a noob on linux, and I am struggling to get RabbitMQ up
> and running...
> I installed Ubuntu ( 10.10 ) inside a VirtualBox on Windows 7
> ( i know thats not ideal, but it should still work, right? )
> 
> I downloaded the latest RabbitMQ 2.1.1
> I have Erlang 13b
> When I run "sudo rabbitmq-server", I get this:
> 
> {error_logger,{{2010,11,6},{10,43,45}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> {error_logger,{{2010,11,6},{10,43,45}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.22.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.80>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,494}],[]]}
> {error_logger,{{2010,11,6},{10,43,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at nick-VirtualBox',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2010,11,6},{10,43,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2010,11,6},{10,43,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> 
> Can anyone help?
> 
> -- 
> Nick Perkins
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From nickperkinslondon at gmail.com  Sat Nov  6 15:44:03 2010
From: nickperkinslondon at gmail.com (Nick Perkins)
Date: Sat, 6 Nov 2010 11:44:03 -0400
Subject: [rabbitmq-discuss] crash! : on Ubuntu inside VirtualBox inside
 Windows 7
In-Reply-To: <D18E50F2-18A6-42DA-968D-30C51CAA72FA@gmail.com>
References: <AANLkTimstf_LMVxTFTnFuBPkyw+o3JP3BQCSAyVYDrFv@mail.gmail.com>
	<D18E50F2-18A6-42DA-968D-30C51CAA72FA@gmail.com>
Message-ID: <AANLkTinDxMaDO1Bqj2zAnkM8Cjtmfhy_atCZgS6GqZ7K@mail.gmail.com>

oh!
I think you're right...(thanks)

on Windows I used to start and stop the service myself
can I still do that?
I will be doing some experimental programming in python,
so I want to be able to "clean the slate" between test runs.
( delete all state from the message broker )

I am also new to the "mailing-list" concept ( not sure if am doing it right? )


On Sat, Nov 6, 2010 at 11:26 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi Nick,
>
> Do ps ax | grep rabbit
>
> or something like that, you probably have another instance of the server already running
>
> Regards,
>
> Alvaro
>
> On Nov 6, 2010, at 9:07 AM, Nick Perkins wrote:
>
>> Help!
>>
>> I am a bit of a noob on linux, and I am struggling to get RabbitMQ up
>> and running...
>> I installed Ubuntu ( 10.10 ) inside a VirtualBox on Windows 7
>> ( i know thats not ideal, but it should still work, right? )
>>
>> I downloaded the latest RabbitMQ 2.1.1
>> I have Erlang 13b
>> When I run "sudo rabbitmq-server", I get this:
>>
>> {error_logger,{{2010,11,6},{10,43,45}},"Protocol: ~p: register error:
>> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>> {error_logger,{{2010,11,6},{10,43,45}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.22.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.80>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,494}],[]]}
>> {error_logger,{{2010,11,6},{10,43,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at nick-VirtualBox',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>> {error_logger,{{2010,11,6},{10,43,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>> {error_logger,{{2010,11,6},{10,43,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>
>> Can anyone help?
>>
>> --
>> Nick Perkins
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Nick Perkins

From videlalvaro at gmail.com  Sat Nov  6 15:46:12 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 6 Nov 2010 09:46:12 -0600
Subject: [rabbitmq-discuss] crash! : on Ubuntu inside VirtualBox inside
	Windows 7
In-Reply-To: <AANLkTinDxMaDO1Bqj2zAnkM8Cjtmfhy_atCZgS6GqZ7K@mail.gmail.com>
References: <AANLkTimstf_LMVxTFTnFuBPkyw+o3JP3BQCSAyVYDrFv@mail.gmail.com>
	<D18E50F2-18A6-42DA-968D-30C51CAA72FA@gmail.com>
	<AANLkTinDxMaDO1Bqj2zAnkM8Cjtmfhy_atCZgS6GqZ7K@mail.gmail.com>
Message-ID: <25E38110-9FBB-4247-8265-A7CF6A5EAD8D@gmail.com>

To clear the state of the broker, if you really don't care about what's there, then do

./rabbitmqctl stop_app
./rabbitmqctl reset
./rabbitmqctl start_app

Be really careful because you will lose all your queues!!!!

If you start/stop the server that doesn't guarantee that you will reset the state of the broker

Regards,

Alvaro

On Nov 6, 2010, at 9:44 AM, Nick Perkins wrote:

> oh!
> I think you're right...(thanks)
> 
> on Windows I used to start and stop the service myself
> can I still do that?
> I will be doing some experimental programming in python,
> so I want to be able to "clean the slate" between test runs.
> ( delete all state from the message broker )
> 
> I am also new to the "mailing-list" concept ( not sure if am doing it right? )
> 
> 
> On Sat, Nov 6, 2010 at 11:26 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Hi Nick,
>> 
>> Do ps ax | grep rabbit
>> 
>> or something like that, you probably have another instance of the server already running
>> 
>> Regards,
>> 
>> Alvaro
>> 
>> On Nov 6, 2010, at 9:07 AM, Nick Perkins wrote:
>> 
>>> Help!
>>> 
>>> I am a bit of a noob on linux, and I am struggling to get RabbitMQ up
>>> and running...
>>> I installed Ubuntu ( 10.10 ) inside a VirtualBox on Windows 7
>>> ( i know thats not ideal, but it should still work, right? )
>>> 
>>> I downloaded the latest RabbitMQ 2.1.1
>>> I have Erlang 13b
>>> When I run "sudo rabbitmq-server", I get this:
>>> 
>>> {error_logger,{{2010,11,6},{10,43,45}},"Protocol: ~p: register error:
>>> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>>> {error_logger,{{2010,11,6},{10,43,45}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.22.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.80>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,494}],[]]}
>>> {error_logger,{{2010,11,6},{10,43,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at nick-VirtualBox',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>> {error_logger,{{2010,11,6},{10,43,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>> {error_logger,{{2010,11,6},{10,43,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>> 
>>> Can anyone help?
>>> 
>>> --
>>> Nick Perkins
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> 
> 
> -- 
> Nick Perkins


From jiri at krutil.com  Mon Nov  8 08:21:55 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Mon, 08 Nov 2010 09:21:55 +0100
Subject: [rabbitmq-discuss] Java client: Closing channel in channel
 shutdown listener
In-Reply-To: <4CD294C1.9000904@rabbitmq.com>
References: <20101103151949.852626bywqo1q2dc@webmail.active24.cz>
	<4CD1731D.5080602@rabbitmq.com>
	<20101103163913.2389274e9k5plg74@webmail.active24.cz>
	<4CD294C1.9000904@rabbitmq.com>
Message-ID: <20101108092155.13834r7wym95sl4w@webmail.active24.cz>

Simon,

>> Can I close the connection from a channel shutdown listener?
>
> Not directly; it has the same problem. Of course, you could just  
> spin up a short-lived thread to do the closing in either case.

It seems to work even when I close the connection directly in the  
thread that invoked the shutdown listener (of connection or channel).

Can I leave it this way or am I programming by coincidence?

(Maybe this issue could also be mentioned in the Java Client API Guide.)

Cheeers
Jiri


From emile at rabbitmq.com  Mon Nov  8 11:07:52 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 08 Nov 2010 11:07:52 +0000
Subject: [rabbitmq-discuss] JsonRpc and RabbitMQ
In-Reply-To: <4CD3D192.3040405@schuhbaum.info>
References: <4CD3D192.3040405@schuhbaum.info>
Message-ID: <4CD7DA08.1000703@rabbitmq.com>

Hi Christian

On 05/11/10 09:42, Christian Schuhbaum wrote:
> Hello everybody,
> 
> i'm currently trying to use the jsonRpc-Plugin with the rabbitMQ-2.1.1
> server.
> The configuration works fine and the json-rpc examples are working, too.
> 
> The only thing, i want to do with the rabbitmq-server is:
> Client -> [put some text] -> rabbitMQ Server
> Other client -> [consume the queue entries] -> rabbitMQ Server
> 
> This means, i'm also need the persistence of rabbitmq.
> 
> Is there any documentation out there, about the usage of the
> jsonRpc-methods?
> Basically i just need the same functionallity as the amqp-library gives me.
> Create Channel, create queue, bind queue+channel, add persistence, write
> to the channel (persistent) and read it from an other client.
> 
> I found the basic.publish-method in the javascript-library. For example
> a parameter with 12 entries "null". Where do they come? How do i know,
> what parameters are required?
> 
> Can anybody help me?

Unfortunately there is not much documentation available for the RabbitMQ
JSON RPC adapter, but the tests provide a good overview of how it is
used, e.g.

http://hg.rabbitmq.com/rabbitmq-jsonrpc-channel/file/default/priv/www-examples/test/test.js

The version of basicPublish() illustrated there takes 3 arguments:
exchange, routing_key and message.

If you wish to send messages in persistent mode then see basicPublish()
in rabbitmq.js which accepts message properties. Set the delivery_mode
property to 2 for persistent messages.


Regards

Emile

From adamka at dgt.com.pl  Mon Nov  8 11:21:50 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Mon, 08 Nov 2010 12:21:50 +0100
Subject: [rabbitmq-discuss] client disconnection after publish to not exist
	exchange
In-Reply-To: <4CD13437.5070002@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl>
Message-ID: <4CD7DD4E.7070102@dgt.com.pl>

Hi,
I'm using few exchanges on version 2.1.1 and sending/receiving messages 
without any porblem but when one of consumer delete exchange and another 
is trying to publish to deleted exchange he gets error: no exchange 
found which is expacted. My question is why the client is disconnected 
from the server?? Its recommended to always use:
channel.ExchangeDeclare before publish?

  It's behavior is strange for me because client when lose connection no 
longer subscribe exchanges.... but on server still are consumers and 
connections presented.

In code I need to reconnect client beacuese I always retrieve errore
  "The AMQP operation was interrupted: AMQP close-reason, initiated by 
Peer, code=404, text=\"NOT_FOUND - no exchange '333,333' in vhost '/'\", 
classId=60, methodId=40,
the same when I'm was trying to publish to not exist exchange.




Regards

Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From f at scalethink.com  Mon Nov  8 12:04:20 2010
From: f at scalethink.com (Liwen Fan)
Date: Mon, 8 Nov 2010 20:04:20 +0800
Subject: [rabbitmq-discuss] connection.createChannel() block after
 send/receive messages to non-exist queues
Message-ID: <AANLkTinz3d48Lv_Ka+YCgn5ZUot1bNGrmKpegJ7zkeS=@mail.gmail.com>

Hi,

We are running rabbit 2.1.1 with java client.
Our code is simple. Many threads share a common connection. In every thread,
it holds its own channel.
When some threads publish/get messages to/from exchanges/queues which do not
exist, its own channel dies.
But, the problem is, other threads that calls at connection.createChannel()
will block.

we only use channel.basicGet() and channel.basicPublish() for our message
delivery.
Any suggestions?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101108/247c117f/attachment.htm>

From emile at rabbitmq.com  Mon Nov  8 12:35:35 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 08 Nov 2010 12:35:35 +0000
Subject: [rabbitmq-discuss] client disconnection after publish to not
 exist	exchange
In-Reply-To: <4CD7DD4E.7070102@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
Message-ID: <4CD7EE97.9030604@rabbitmq.com>

Hi Adam,

On 08/11/10 11:21, Adam Kaminiecki wrote:
> Hi,
> I'm using few exchanges on version 2.1.1 and sending/receiving messages
> without any porblem but when one of consumer delete exchange and another
> is trying to publish to deleted exchange he gets error: no exchange
> found which is expacted. My question is why the client is disconnected
> from the server?? Its recommended to always use:
> channel.ExchangeDeclare before publish?

The AMQP 0-9-1 spec requires that the broker raise a channel exception
if a publisher attempts to publish to a non-existent exchange.

It is unusual for publishers to deal with the risk of an exchange
disappearing, because exchanges are normally long-lived. Publishers must
be prepared to redeclare exchanges or recover from channel exceptions in
the presence of such risk.

If you explain the reason for consumers deleting exchanges then I may be
able to suggest an alternative messaging pattern.

As a preventative measure you can use permissions to prevent clients
from deleting exchanges, or use server-assigned names to make them
undiscoverable via AMQP.


Regards

Emile

From rob at rabbitmq.com  Mon Nov  8 13:15:20 2010
From: rob at rabbitmq.com (rob)
Date: Mon, 08 Nov 2010 13:15:20 +0000
Subject: [rabbitmq-discuss] connection.createChannel() block after
 send/receive messages to non-exist queues
In-Reply-To: <AANLkTinz3d48Lv_Ka+YCgn5ZUot1bNGrmKpegJ7zkeS=@mail.gmail.com>
References: <AANLkTinz3d48Lv_Ka+YCgn5ZUot1bNGrmKpegJ7zkeS=@mail.gmail.com>
Message-ID: <dc92f646fe565a16da23f7b6af93392e@rabbitmq.com>

On Mon, 8 Nov 2010 20:04:20 +0800, Liwen Fan <f at scalethink.com> wrote:
> Hi,
> 
> We are running rabbit 2.1.1 with java client.
> Our code is simple. Many threads share a common connection. In every
> thread,
> it holds its own channel.
> When some threads publish/get messages to/from exchanges/queues which do
> not
> exist, its own channel dies.
> But, the problem is, other threads that calls at
connection.createChannel()
> will block.
> 
> we only use channel.basicGet() and channel.basicPublish() for our
message
> delivery.
> Any suggestions?

Did you also upgrade the Java Client to 2.1.1? There was a deadlock bug
that was fixed in 2.1.1 that sounds very similar to what you describe.

Rob

From rob at rabbitmq.com  Mon Nov  8 13:16:05 2010
From: rob at rabbitmq.com (rob)
Date: Mon, 08 Nov 2010 13:16:05 +0000
Subject: [rabbitmq-discuss] JBoss and RabbitMQ
In-Reply-To: <6E15CEE6F245AC46B04E0160AAFD88C7F09E83@FSP-SRV-EXCH01.FatorDoria.br>
References: <6E15CEE6F245AC46B04E0160AAFD88C7F09E83@FSP-SRV-EXCH01.FatorDoria.br>
Message-ID: <c766ca82c67590ded95a7590cbb18391@rabbitmq.com>

On Fri, 5 Nov 2010 17:26:08 -0200, "Fernando Rodrigo Chagas Dourado"
<fdourado at bancofator.com.br> wrote:
> Hello,
> 
>  
> 
> I have a doubt about jBoss and RabbitMQ.
> 
>  
> 
> It's possible to jBoss consume or deliver a message to RabbitMQ? 
> 
>  
> 
> I'm looking for some solution that doesn't use threads inside
> application server.
> 
>  
> 
> --
> 
> Fernando Dourado
> 

Fernando,

Any application you can deploy to JBoss can consume and deliver messages
to RabbitMQ using the Java Client.

Creating a connection to the broker requires that a single thread be
created for managing the conversation with the broker. You can reuse this
same connection across any number of your application threads.

If you are looking for a solution that doesn't create any threads at all,
then you can use the STOMP adapter to send messages into the server. You
can do this in the same thread that your application code is running on.

You can consume messages using STOMP as well but doing so without a
dedicated TCP thread is going to be messy and unreliable.

I hope this helps.

Regards,

Rob


From adamka at dgt.com.pl  Mon Nov  8 14:32:46 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Mon, 08 Nov 2010 15:32:46 +0100
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <4CD7DD4E.7070102@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
Message-ID: <4CD80A0E.3060504@dgt.com.pl>


Hi,

How can i publish another message type than string(for example type 
object) on exchane or queue??



Regards,
Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From mikeb at rabbitmq.com  Mon Nov  8 14:42:27 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 08 Nov 2010 14:42:27 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <4CD80A0E.3060504@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl>
Message-ID: <4CD80C53.4000708@rabbitmq.com>

On 11/08/2010 02:32 PM, Adam Kaminiecki wrote:
>
> Hi,
>
> How can i publish another message type than string(for example type
> object) on exchane or queue??

AMQP and RabbitMQ don't care what you are publishing -- to them it's 
just bytes.  However, a client library might; so, it depends on your 
client library.  Most client libraries will let you supply a byte array 
or the equivalent to the basic.publish method.

In other words, you should serialise whatever it is you want to send, to 
bytes or (if your library doesn't support that) something like JSON.

Regards,
Michael

From moshima at advent.com  Mon Nov  8 17:34:31 2010
From: moshima at advent.com (michi.oshima)
Date: Mon, 8 Nov 2010 09:34:31 -0800 (PST)
Subject: [rabbitmq-discuss]  Passing null for 'arguments' to queueBind()
Message-ID: <30162963.post@talk.nabble.com>


Hi,

I'm using rabbitmq server 2.1.0 and rabbitmq java client 2.1.0.  

I'm currently exploring 'headers' exchange type.  I'd publish a message with
argument table set to 'A' for example, with the intent that consumer with
the matching argument 'A' would receive the message.  And those consumers
who do not specify 'A' would not get the message.

I'm finding that a consumer ends up receiving all messages if I pass null as
the value for the 'arguments' parameter.  I am using the following
queueBind() method of the Channel interface:

AMQP.Queue.BindOk queueBind(java.lang.String?queue,
                            java.lang.String?exchange,
                            java.lang.String?routingKey,
                           
java.util.Map<java.lang.String,java.lang.Object>?arguments)
                            throws java.io.IOException

1. Is this intended?  That is, I merely have to specify null for 'arguments'
to receive all messages.
2. Is there any way to prevent a client from subscribing to all messages?
3. Is this an operator error?  Am I setting things up incorrectly?

What I'm trying to achieve is some degree of message privacy.  Consumer A
would put the key 'A' to argument to receive all messages meant for A, and
Consumer B would put the key 'B' to argument to receive all messages meant
for B.  Consumer A is prevented from receiving messages meant for Consumer
B, simply because he is ignorant of the key 'B'.  

4. Is there a better way to achieve message privacy?



-- 
View this message in context: http://old.nabble.com/Passing-null-for-%27arguments%27-to-queueBind%28%29-tp30162963p30162963.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From f at scalethink.com  Tue Nov  9 02:45:26 2010
From: f at scalethink.com (Liwen Fan)
Date: Tue, 9 Nov 2010 10:45:26 +0800
Subject: [rabbitmq-discuss] connection.createChannel() block after
 send/receive messages to non-exist queues
In-Reply-To: <dc92f646fe565a16da23f7b6af93392e@rabbitmq.com>
References: <AANLkTinz3d48Lv_Ka+YCgn5ZUot1bNGrmKpegJ7zkeS=@mail.gmail.com>
	<dc92f646fe565a16da23f7b6af93392e@rabbitmq.com>
Message-ID: <AANLkTimfbwwwYki=xBgdjx5cvp+hKppc+mtnsjqmEStj@mail.gmail.com>

Thanks rob, we are using java client 2.1.0.

it is ok now when we bring it to 2.1.1. many thanks.


2010/11/8 rob <rob at rabbitmq.com>

> On Mon, 8 Nov 2010 20:04:20 +0800, Liwen Fan <f at scalethink.com> wrote:
> > Hi,
> >
> > We are running rabbit 2.1.1 with java client.
> > Our code is simple. Many threads share a common connection. In every
> > thread,
> > it holds its own channel.
> > When some threads publish/get messages to/from exchanges/queues which do
> > not
> > exist, its own channel dies.
> > But, the problem is, other threads that calls at
> connection.createChannel()
> > will block.
> >
> > we only use channel.basicGet() and channel.basicPublish() for our
> message
> > delivery.
> > Any suggestions?
>
> Did you also upgrade the Java Client to 2.1.1? There was a deadlock bug
> that was fixed in 2.1.1 that sounds very similar to what you describe.
>
> Rob
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101109/af5f557d/attachment.htm>

From nickperkinslondon at gmail.com  Tue Nov  9 03:20:12 2010
From: nickperkinslondon at gmail.com (Nick Perkins)
Date: Mon, 8 Nov 2010 22:20:12 -0500
Subject: [rabbitmq-discuss] Help! I broke my it!
Message-ID: <AANLkTimB5PBw5vVt9fgdkAQMPF0NSMOQnkK+SxsYWUC7@mail.gmail.com>

Help! I broke my it!
I tried to install some plugins, but now even when I remove them it
still won't work.
What did I do?
How do I fix it?

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.8.0  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at bigdaddy-linux
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-1.8.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
cookie hash    : yzxRoDmJHV6hQB/vs4k+8w==
log            : /var/log/rabbitmq/rabbit at bigdaddy-linux.log
sasl log       : /var/log/rabbitmq/rabbit at bigdaddy-linux-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at bigdaddy-linux
erlang version : 5.7.4

BOOT ERROR: Could not add boot step dependency of rabbit_mgmt_database
on rabbit_event:
Boot step not registered: rabbit_event
Erlang has closed
{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})


-- 
Nick Perkins

From mikeb at rabbitmq.com  Tue Nov  9 07:07:24 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 09 Nov 2010 07:07:24 +0000
Subject: [rabbitmq-discuss] Help! I broke my it!
In-Reply-To: <AANLkTimB5PBw5vVt9fgdkAQMPF0NSMOQnkK+SxsYWUC7@mail.gmail.com>
References: <AANLkTimB5PBw5vVt9fgdkAQMPF0NSMOQnkK+SxsYWUC7@mail.gmail.com>
Message-ID: <4CD8F32C.4040704@rabbitmq.com>

On 09/11/2010 03:20, Nick Perkins wrote:
> Help! I broke my it!
> I tried to install some plugins, but now even when I remove them it
> still won't work.
> What did I do?

It looks like you've installed the management plugin in an old RabbitMQ.
It won't in general (there may be exceptions) work with versions older 
than itself.

> How do I fix it?

Either upgrade RabbitMQ to the same version as the management plugin 
(2.1.1, if you've downloaded the plugin recently), or live without the 
management plugin for now.  I don't think it goes as far back as v1.8.0.

You can get debs and RPMs (or a tarball) for the most recent versions 
from http://www.rabbitmq.com/, or your favourite distribution may just 
have it.

Michael

--

> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.8.0  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
> LLC., and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at bigdaddy-linux
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-1.8.0/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> cookie hash    : yzxRoDmJHV6hQB/vs4k+8w==
> log            : /var/log/rabbitmq/rabbit at bigdaddy-linux.log
> sasl log       : /var/log/rabbitmq/rabbit at bigdaddy-linux-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at bigdaddy-linux
> erlang version : 5.7.4
>
> BOOT ERROR: Could not add boot step dependency of rabbit_mgmt_database
> on rabbit_event:
> Boot step not registered: rabbit_event
> Erlang has closed
> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>
>


From vincentcheongst at gmail.com  Tue Nov  9 08:33:42 2010
From: vincentcheongst at gmail.com (Vincent Cheong)
Date: Tue, 9 Nov 2010 16:33:42 +0800
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
Message-ID: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>

I have downloaded the rabbit mq c client from
http://hg.rabbitmq.com/rabbitmq-c/summary and compiled the the library using
mingw successfully.

However when I compile against the library (librabbitmq.dll.a) and run my
application, I get a run-time check failure of the value of esp being not
properly saved. Any help would be deeply appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101109/5a4e728f/attachment.htm>

From simon at rabbitmq.com  Tue Nov  9 08:54:01 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Nov 2010 08:54:01 +0000
Subject: [rabbitmq-discuss] Help! I broke my it!
In-Reply-To: <4CD8F32C.4040704@rabbitmq.com>
References: <AANLkTimB5PBw5vVt9fgdkAQMPF0NSMOQnkK+SxsYWUC7@mail.gmail.com>
	<4CD8F32C.4040704@rabbitmq.com>
Message-ID: <4CD90C29.30905@rabbitmq.com>

On 09/11/2010 7:07AM, Michael Bridgen wrote:
> On 09/11/2010 03:20, Nick Perkins wrote:
>> How do I fix it?
>
> Either upgrade RabbitMQ to the same version as the management plugin
> (2.1.1, if you've downloaded the plugin recently), or live without the
> management plugin for now. I don't think it goes as far back as v1.8.0.

 From the reference to "rabbit_mgmt_database" I think Nick was trying to 
run a very early version of the management plugin. However, there's no 
version early enough to run on 1.x.

Nick, to fix your immediate problem, have you run 
rabbitmq-deactivate-plugins? Versions 1.x of RabbitMQ required you to 
run rabbitmq-(de)activate-plugins whenever you installed / uninstalled 
plugins.

If that doesn't work, I think you should seek out and destroy files 
called "rabbit.boot", "rabbit.rel" and "rabbit.script". I can't remember 
where 1.x put them though.

Of course, upgrading to 2.1.1 is still recommended :)

Cheers, Simon

From jerryk at vmware.com  Tue Nov  9 08:55:43 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 9 Nov 2010 00:55:43 -0800
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
Message-ID: <F768CC65-DAC4-479A-A2D6-30C10CD42F7A@vmware.com>

Hi, Vincent.

I don't have a Windows box in front of me, indeed haven't seriously touched Windows in quite a while, but this is typically the result of either mismatched types (e.g. you've got a header file or typedef claiming a function's type is something that it really isn't) or incompatible calling conventions between caller and callee.  In either case you end up with a number of bytes pushed on the stack at call time, with commensurate adjustment of the stack pointer, and the SP isn't being restored properly afterward.

For historical reasons dating back to the earliest 16-bit versions, Windows is blessed with a number of strange calling conventions that differ in such things as what order the arguments get pushed on the stack and who's responsible for cleaning up and resetting the stack pointer when a function finishes.

Over the years you'd see function prototypes annotated with things like STDCALL, CALLBACK, CDECL, PASCAL, WINAPI, etc.  MSDN should document these in detail, and beware there are many synonyms.  In the cave times this allowed Windows apps to be slightly smaller by reducing the amount of code that had to be generated at Windows API call sites by entire bytes.

First I'd take a peek into the source for the C client library, and any include files you're pulling in to make use of it and make sure you know what the calling conventions are.  If you're defining callbacks in your code that will be invoked by stuff in the library, make sure those functions really have the signatures the caller wants.   Also, if you or any code between you and the library have typedef'ed any function pointers for convenience, make sure those types really and truly match those of the functions the DLL is exporting.

Jerry

On Nov 9, 2010, at 8:33 AM, Vincent Cheong wrote:

I have downloaded the rabbit mq c client from http://hg.rabbitmq.com/rabbitmq-c/summary and compiled the the library using mingw successfully.

However when I compile against the library (librabbitmq.dll.a) and run my application, I get a run-time check failure of the value of esp being not properly saved. Any help would be deeply appreciated.
<ATT00001..txt>


From vincentcheongst at gmail.com  Tue Nov  9 09:31:28 2010
From: vincentcheongst at gmail.com (Vincent Cheong)
Date: Tue, 9 Nov 2010 17:31:28 +0800
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <F768CC65-DAC4-479A-A2D6-30C10CD42F7A@vmware.com>
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<F768CC65-DAC4-479A-A2D6-30C10CD42F7A@vmware.com>
Message-ID: <AANLkTi=VJfTC6eH3nnR4Q7=ypkv1b-5hYEgyVXQF=kiT@mail.gmail.com>

Hi Jerry,

Thanks for your suggestion. I'm not too sure if there are any typedef'ed
function in the client code but I did include the stdint.h used by mingw in
my c++ app. Running my code in debug mode, I can see the esp value
being changed during some (but not all) of the client function calls. I must
be doing something wrong as this seems like a trivial problem that most
windows c++ user should run into.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101109/431030cf/attachment.htm>

From adamka at dgt.com.pl  Tue Nov  9 10:45:45 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Tue, 09 Nov 2010 11:45:45 +0100
Subject: [rabbitmq-discuss]  latency
In-Reply-To: <4CD80A0E.3060504@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl>
Message-ID: <4CD92659.4080008@dgt.com.pl>

Hi,

I have a problem with huge latency.
I have 1  exchange type direct and 1 producer and 1 consumer.

Porducer publish 10message per secon

but consumer gets 1 message in 2 sec

after 15min producer published about 56k message which are simply string 
meesages

I've closed producer, consumer 20min later is  still getting message. 
Max was 3 mes. per second.

I'm using basicpublish where basicProperties is null

Consumer consume message by subclass on overrided HandleBasicDeliver

What can i change to increase consuming?? Is any faster exchange? Have I 
change something in basicProperties??




Regards,
Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From david at rabbitmq.com  Tue Nov  9 11:30:34 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 09 Nov 2010 11:30:34 +0000
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	(Vincent Cheong's message of "Tue, 9 Nov 2010 16:33:42 +0800")
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
Message-ID: <yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>

Vincent Cheong <vincentcheongst at gmail.com> writes:
> I have downloaded the rabbit mq c client from
> http://hg.rabbitmq.com/rabbitmq-c/summary and compiled the the library using
> mingw successfully.
>
> However when I compile against the library (librabbitmq.dll.a) and run my
> application, I get a run-time check failure of the value of esp being not
> properly saved. Any help would be deeply appreciated.

Are you trying to call the mingw-compiled library from code developed in
Visual Studio?  That doesn't work, as explained in the README.windows
file.

But we have addressed this issue in the bug23423 branch.  If you switch
to that branch, README.windows contains instructions on how to build the
library with Microsoft's compiler, so that it is callable from code
developed in VS.

That branch still has to go through code review here, but it should work
fine.  Let me know if you have any problems with it.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From fdourado at bancofator.com.br  Tue Nov  9 12:02:22 2010
From: fdourado at bancofator.com.br (Fernando Rodrigo Chagas Dourado)
Date: Tue, 9 Nov 2010 10:02:22 -0200
Subject: [rabbitmq-discuss] RES:  JBoss and RabbitMQ
In-Reply-To: <c766ca82c67590ded95a7590cbb18391@rabbitmq.com>
References: <6E15CEE6F245AC46B04E0160AAFD88C7F09E83@FSP-SRV-EXCH01.FatorDoria.br>
	<c766ca82c67590ded95a7590cbb18391@rabbitmq.com>
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C7F5A9CF@FSP-SRV-EXCH01.FatorDoria.br>

Thanks Rob,

I hope in the future JBoss implement a client to consume AMQP messages more easy.

Like a annotation @AMQPClient at class scope. 

:)

Fernando Dourado


-----Mensagem original-----
De: rob [mailto:rob at rabbitmq.com] 
Enviada em: segunda-feira, 8 de novembro de 2010 11:16
Para: Fernando Rodrigo Chagas Dourado
Cc: rabbitmq-discuss at lists.rabbitmq.com
Assunto: Re: [rabbitmq-discuss] JBoss and RabbitMQ

On Fri, 5 Nov 2010 17:26:08 -0200, "Fernando Rodrigo Chagas Dourado"
<fdourado at bancofator.com.br> wrote:
> Hello,
> 
>  
> 
> I have a doubt about jBoss and RabbitMQ.
> 
>  
> 
> It's possible to jBoss consume or deliver a message to RabbitMQ? 
> 
>  
> 
> I'm looking for some solution that doesn't use threads inside
> application server.
> 
>  
> 
> --
> 
> Fernando Dourado
> 

Fernando,

Any application you can deploy to JBoss can consume and deliver messages
to RabbitMQ using the Java Client.

Creating a connection to the broker requires that a single thread be
created for managing the conversation with the broker. You can reuse this
same connection across any number of your application threads.

If you are looking for a solution that doesn't create any threads at all,
then you can use the STOMP adapter to send messages into the server. You
can do this in the same thread that your application code is running on.

You can consume messages using STOMP as well but doing so without a
dedicated TCP thread is going to be messy and unreliable.

I hope this helps.

Regards,

Rob



Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.  
SAC: 0800 770 7229 ou sac at bancofator.com.br 
Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)      
                 email : ouvidoria at bancofator.com.br                                                    
                 carta:   Rua Dr. Renato Paes de Barros, 1017, 12o.andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001.

Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation. 
Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator 
Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)              
              or by email: ouvidoria at bancofator.com.br                           
              or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001 .

From simon at rabbitmq.com  Tue Nov  9 12:03:09 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Nov 2010 12:03:09 +0000
Subject: [rabbitmq-discuss] Java client: Closing channel in channel
 shutdown listener
In-Reply-To: <20101108092155.13834r7wym95sl4w@webmail.active24.cz>
References: <20101103151949.852626bywqo1q2dc@webmail.active24.cz>
	<4CD1731D.5080602@rabbitmq.com>
	<20101103163913.2389274e9k5plg74@webmail.active24.cz>
	<4CD294C1.9000904@rabbitmq.com>
	<20101108092155.13834r7wym95sl4w@webmail.active24.cz>
Message-ID: <4CD9387D.4040000@rabbitmq.com>

On 08/11/10 08:21, jiri at krutil.com wrote:
> Simon,
>
>>> Can I close the connection from a channel shutdown listener?
>>
>> Not directly; it has the same problem. Of course, you could just spin
>> up a short-lived thread to do the closing in either case.
>
> It seems to work even when I close the connection directly in the thread
> that invoked the shutdown listener (of connection or channel).
>
> Can I leave it this way or am I programming by coincidence?

No, I was wrong. Now that I've actually looked at the code I see that 
Connection.close() has some magic in it to allow you to call it from any 
thread.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Tue Nov  9 12:04:55 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Nov 2010 12:04:55 +0000
Subject: [rabbitmq-discuss] Java client: Closing channel in channel
 shutdown listener
In-Reply-To: <4CD9387D.4040000@rabbitmq.com>
References: <20101103151949.852626bywqo1q2dc@webmail.active24.cz>	<4CD1731D.5080602@rabbitmq.com>	<20101103163913.2389274e9k5plg74@webmail.active24.cz>	<4CD294C1.9000904@rabbitmq.com>	<20101108092155.13834r7wym95sl4w@webmail.active24.cz>
	<4CD9387D.4040000@rabbitmq.com>
Message-ID: <4CD938E7.5050909@rabbitmq.com>

On 09/11/10 12:03, Simon MacMullen wrote:
> On 08/11/10 08:21, jiri at krutil.com wrote:
>> Can I leave it this way or am I programming by coincidence?
>
> No, I was wrong.

Or rather:

"Yes you can. I was wrong..."

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From adamka at dgt.com.pl  Tue Nov  9 13:46:35 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Tue, 09 Nov 2010 14:46:35 +0100
Subject: [rabbitmq-discuss] latency
In-Reply-To: <4CD92659.4080008@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl>
	<4CD7DD4E.7070102@dgt.com.pl>	<4CD80A0E.3060504@dgt.com.pl>
	<4CD92659.4080008@dgt.com.pl>
Message-ID: <4CD950BB.60304@dgt.com.pl>

It is not Rabbit problem :)

but have another problem first consumer which connect to exchange before 
my creazy producer is very slow... dont know why any other consumers 
work properly...

One more question. Can i publish message in one thread and listen for 
message in another in my situation??



Regards,
Adam






W dniu 2010-11-09 11:45, Adam Kaminiecki pisze:
> Hi,
>
> I have a problem with huge latency.
> I have 1  exchange type direct and 1 producer and 1 consumer.
>
> Porducer publish 10message per secon
>
> but consumer gets 1 message in 2 sec
>
> after 15min producer published about 56k message which are simply 
> string meesages
>
> I've closed producer, consumer 20min later is  still getting message. 
> Max was 3 mes. per second.
>
> I'm using basicpublish where basicProperties is null
>
> Consumer consume message by subclass on overrided HandleBasicDeliver
>
> What can i change to increase consuming?? Is any faster exchange? Have 
> I change something in basicProperties??
>
>
>
>
> Regards,
> Adam
>

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From matthew at rabbitmq.com  Tue Nov  9 14:00:01 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 9 Nov 2010 14:00:01 +0000
Subject: [rabbitmq-discuss] latency
In-Reply-To: <4CD950BB.60304@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl> <4CD92659.4080008@dgt.com.pl>
	<4CD950BB.60304@dgt.com.pl>
Message-ID: <20101109140001.GE22102@rabbitmq.com>

On Tue, Nov 09, 2010 at 02:46:35PM +0100, Adam Kaminiecki wrote:
> It is not Rabbit problem :)

Always good to hear ;)

> but have another problem first consumer which connect to exchange
> before my creazy producer is very slow... dont know why any other
> consumers work properly...

Are you saying:

1. You connect several consumers to Rabbit.
2. You have a publisher publishing to Rabbit.
3. All but the first consumer have a fast receiving rate.

?

In 1, are all these consumers consuming from the same queue or do they
all have their own queues?

> One more question. Can i publish message in one thread and listen
> for message in another in my situation??

Err yes - if you're using the Java client, you should use the
QueueingConsumer to do the thread jump.

Matthew

From adamka at dgt.com.pl  Tue Nov  9 14:08:43 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Tue, 09 Nov 2010 15:08:43 +0100
Subject: [rabbitmq-discuss] latency
In-Reply-To: <20101109140001.GE22102@rabbitmq.com>
References: <4CD13437.5070002@dgt.com.pl>
	<4CD7DD4E.7070102@dgt.com.pl>	<4CD80A0E.3060504@dgt.com.pl>
	<4CD92659.4080008@dgt.com.pl>	<4CD950BB.60304@dgt.com.pl>
	<20101109140001.GE22102@rabbitmq.com>
Message-ID: <4CD955EB.3060909@dgt.com.pl>


>> but have another problem first consumer which connect to exchange
>> before my creazy producer is very slow... dont know why any other
>> consumers work properly...
> Are you saying:
>
> 1. You connect several consumers to Rabbit.
> 2. You have a publisher publishing to Rabbit.
> 3. All but the first consumer have a fast receiving rate.
>
> ?
Yes
> In 1, are all these consumers consuming from the same queue or do they
> all have their own queues?
my using example bind to exchane
q = channel.QueueDeclare();
                 channel.QueueBind(q, exchName, exchName, false, null);

so they have their own queues I suppose



Regards
Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From matthew at rabbitmq.com  Tue Nov  9 14:19:15 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 9 Nov 2010 14:19:15 +0000
Subject: [rabbitmq-discuss] latency
In-Reply-To: <4CD955EB.3060909@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl> <4CD92659.4080008@dgt.com.pl>
	<4CD950BB.60304@dgt.com.pl> <20101109140001.GE22102@rabbitmq.com>
	<4CD955EB.3060909@dgt.com.pl>
Message-ID: <20101109141914.GF22102@rabbitmq.com>

On Tue, Nov 09, 2010 at 03:08:43PM +0100, Adam Kaminiecki wrote:
> Yes
> >In 1, are all these consumers consuming from the same queue or do they
> >all have their own queues?
> my using example bind to exchane
> q = channel.QueueDeclare();
>                 channel.QueueBind(q, exchName, exchName, false, null);
> 
> so they have their own queues I suppose

Quite. So you can use rabbitmqctl list_queues to see the stats regarding
each queue - what is the output of that during this: is one queue indeed
much larger than all the others?

Matthew

From matthew at rabbitmq.com  Tue Nov  9 14:45:14 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 9 Nov 2010 14:45:14 +0000
Subject: [rabbitmq-discuss] latency
In-Reply-To: <4CD95B81.5070405@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl> <4CD92659.4080008@dgt.com.pl>
	<4CD950BB.60304@dgt.com.pl> <20101109140001.GE22102@rabbitmq.com>
	<4CD955EB.3060909@dgt.com.pl> <20101109141914.GF22102@rabbitmq.com>
	<4CD95B81.5070405@dgt.com.pl>
Message-ID: <20101109144514.GG22102@rabbitmq.com>

Hi Adam,

(please keep the mailing list CC'd)

On Tue, Nov 09, 2010 at 03:32:33PM +0100, Adam Kaminiecki wrote:
> >Quite. So you can use rabbitmqctl list_queues to see the stats regarding
> >each queue - what is the output of that during this: is one queue indeed
> >much larger than all the others?
> >
> yes and its growing when producer is working.
> I found something else if bind 1 consumer from another maschine it's
> slow to. but if I run my application 2 times creating 2 consumers,
> first is slow but secon works correctly. Do you need my code how I'm
> using it? Becasue I dont know what is wrong.

Me neither - if it's the same code on both consumers then it should
behave pretty similarly. Could you post the code please? Ideally, both
the consuming and producing code.

Matthew

From allister.macleod at gmail.com  Tue Nov  9 16:43:27 2010
From: allister.macleod at gmail.com (A. MacLeod)
Date: Tue, 9 Nov 2010 08:43:27 -0800 (PST)
Subject: [rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ 2.x.x
Message-ID: <4dddb88f-6938-4acc-9ee9-e26806034ad8@35g2000prt.googlegroups.com>

Hi. I am researching AMQP flow control strategies to use for a
distributed application that uses RabbitMQ for interprocess message
passing.  The "channel.flow" and "channel.flow_ok" messages from the
AMQP spec at first seemed to be a useful first step for flow control.
However, from looking at various documentation, forum posts, and
looking at the RabbitMQ source, it looks like we may not get very much
benefit from channel.flow when we are using RabbitMQ version 2.0.0 or
later.

Am I correct in concluding that a RabbitMQ 2.x.x broker will never
generate a channel.flow message, ever?  I grepped the Erlang source
and saw that the broker responds to incoming channel.flow messages
appropriately.  There is a comment in the memory management code that
mentions that a memory alarm should cause channel.flow, but I did not
see anything in actual code to back that up.

A post from Marek M. in
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/2d26d2d740c216be/a3ff743a389bb360
indicates that channel.flow behavior has changed between 1.8.1 and
2.0.0.  From what I understand, the broker now effects flow control by
just not reading bytes from the socket instead of issuing channel.flow
messages.  This is consistent with a test I ran, using the 2.0.0 Java
client library, where I have a producer thread continuously shove 8kb
messages into a direct exchange, and have a slow-poke consumer using
basic.consume to receive acknowledgement-required messages very
slowly.  Once the memory fills up, the producer visibly slows down,
but FlowListener never has handleFlow called.

I have also tried some experiments where I use something like
consumerChannel.flow(false) to stop flow on the consumer's channel.
However, when I try to reopen the flow by doing
consumerChannel.flow(true), my consumer instance (of a class derived
from DefaultConsumer) never receives any more messages.  Do I need to
re-issue consumerChannel.basicConsume(...) after I re-enable flow from
the consumer side?

Thanks in advance,
  Allister

From matthew at rabbitmq.com  Tue Nov  9 17:23:59 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 9 Nov 2010 17:23:59 +0000
Subject: [rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ
 2.x.x
In-Reply-To: <4dddb88f-6938-4acc-9ee9-e26806034ad8@35g2000prt.googlegroups.com>
References: <4dddb88f-6938-4acc-9ee9-e26806034ad8@35g2000prt.googlegroups.com>
Message-ID: <20101109172358.GH22102@rabbitmq.com>

On Tue, Nov 09, 2010 at 08:43:27AM -0800, A. MacLeod wrote:
> Am I correct in concluding that a RabbitMQ 2.x.x broker will never
> generate a channel.flow message, ever?

Yes, you are.

>  I grepped the Erlang source
> and saw that the broker responds to incoming channel.flow messages
> appropriately.  There is a comment in the memory management code that
> mentions that a memory alarm should cause channel.flow, but I did not
> see anything in actual code to back that up.

Superb - the comment is out of date. I have fixed that.

> A post from Marek M. in
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/2d26d2d740c216be/a3ff743a389bb360
> indicates that channel.flow behavior has changed between 1.8.1 and
> 2.0.0.  From what I understand, the broker now effects flow control by
> just not reading bytes from the socket instead of issuing channel.flow
> messages.  This is consistent with a test I ran, using the 2.0.0 Java
> client library, where I have a producer thread continuously shove 8kb
> messages into a direct exchange, and have a slow-poke consumer using
> basic.consume to receive acknowledgement-required messages very
> slowly.  Once the memory fills up, the producer visibly slows down,
> but FlowListener never has handleFlow called.

Indeed that is correct.

> I have also tried some experiments where I use something like
> consumerChannel.flow(false) to stop flow on the consumer's channel.
> However, when I try to reopen the flow by doing
> consumerChannel.flow(true), my consumer instance (of a class derived
> from DefaultConsumer) never receives any more messages.  Do I need to
> re-issue consumerChannel.basicConsume(...) after I re-enable flow from
> the consumer side?

No, you shouldn't do. The Java client has a test for channel.flow in
com.rabbitmq.client.test.functional.QosTests. If you can't make it work
please let us know - it should all "just work".

FWIW, the idea of the broker sending channel.flow to the client is a
good one - it's sensible for the broker to be able to ignore just
publishes amongst other methods on each given channel.

Unfortunately, channel.flow is synchronous, so the broker has to wait
for the client to respond (and send back the flow_ok) before it can
start getting upperty should the producer continue to send messages. The
problem here then is what timeout do you apply before you just start
ignoring the producer anyway? If the client is only doing publishes
anyway, you have absolutely no idea what the round trip time is.
Furthermore, as we discovered when we tried to implement it, there's the
possibility that the client _did_ respond and issue the flow_ok, but the
broker was so overloaded it didn't notice it until after the timeout.
Thus the client gets disconnected even when it did all the right things.

Consequently, relying on TCP backpressure is pretty much the only
sensible thing that can be done.

Matthew

From adamka at dgt.com.pl  Tue Nov  9 18:17:57 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Tue, 09 Nov 2010 19:17:57 +0100
Subject: [rabbitmq-discuss] latency
In-Reply-To: <20101109144514.GG22102@rabbitmq.com>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl> <4CD92659.4080008@dgt.com.pl>
	<4CD950BB.60304@dgt.com.pl> <20101109140001.GE22102@rabbitmq.com>
	<4CD955EB.3060909@dgt.com.pl> <20101109141914.GF22102@rabbitmq.com>
	<4CD95B81.5070405@dgt.com.pl> <20101109144514.GG22102@rabbitmq.com>
Message-ID: <4CD99055.10005@dgt.com.pl>

consuming and producting:

  private void Inicjalize()
         {
                 conFactory = new ConnectionFactory { Address = server };
                 conn = conFactory.CreateConnection();

                     conn.CallbackException += ConnCallbackException;
                     conn.CallbackException += ConnCallbackException;
                     conn.ConnectionShutdown += ConnConnectionShutdown;
                     conn.AutoClose = false;

                     channel = conn.CreateModel();
         }


declaring exchange and binding

private void NewExchange(string exchName, string exchType, ClientType 
clientType,bool durable)
         {

             try
             {
                 channel.ExchangeDeclare(exchName, exchType,durable);
                 q = channel.QueueDeclare();
                 channel.QueueBind(q, exchName, exchName, false, null);


                 switch (clientType)
                 {
                     case ClientType.Listener:
                         var consumerr = new MyConsumer(channel);

                         consumerr.NewMessagee += ConsumerrNewMessagee;
                         channel.BasicConsume(q, null, consumerr);
                         channel.BasicPublish(exchName, exchName, null, 
Encoding.UTF8.GetBytes("Hello everybody I'm new exch Consumer! : " + q));
                         break;
                     case ClientType.Producer:
                         channel.BasicPublish(exchName, exchName, null, 
Encoding.UTF8.GetBytes("Hello everybody I'm new exch Producer! : " + q));
                         break;
                     case ClientType.Both:
                         var cconsumer = new MyConsumer(channel);
                         cconsumer.NewMessagee += ConsumerrNewMessagee;
                         channel.BasicConsume(q, null, cconsumer);
                         channel.BasicPublish(exchName, exchName, null, 
Encoding.UTF8.GetBytes("Hello everybody I'm new exch Consumer and 
Producer! : " + q));
                         break;
                     default:
                         break;

                 }

             }
             catch 
(RabbitMQ.Client.Exceptions.OperationInterruptedException e)
             {
                 InvokeErrorMessage(e.Message, q);
             }
             catch (Exception e)
             {
                 InvokeErrorMessage(e.Message, q);
             }
         }



internal class MyConsumer : DefaultBasicConsumer
         {
             public delegate void NewMessage(BasicDeliverEventArgs e);
             public event NewMessage NewMessagee;


             public MyConsumer(IModel ch) : base(ch) { }

             public override void HandleBasicDeliver(string consumerTag,
                                                     ulong deliveryTag,
                                                     bool redelivered,
                                                     string exchange,
                                                     string routingKey,
                                                     IBasicProperties 
properties,
                                                     byte[] body)
             {
                 Model.BasicAck(deliveryTag, false);

                 // We only use BasicDeliverEventArgs here for
                 // convenience. Often we wouldn't bother packaging up
                 // all the arguments we received: we'd simply use
                 // those we needed directly.
                 var e = new BasicDeliverEventArgs();
                 /*
                 e.ConsumerTag = consumerTag;
                 e.DeliveryTag = deliveryTag;
                 e.Redelivered = redelivered;
                 e.Exchange = exchange;
                 e.RoutingKey = routingKey;
                 e.BasicProperties = properties;
                 e.Body = body;
                 */
                 NewMessagee(e);
              }
         }

     private void ProcessSingleDelivery(BasicDeliverEventArgs e)
         {
                 NewMessageEx(e, e.Exchange);
         }




Usage:





     public partial class Form1 : Form
     {
         private RmqExchClient Pe;

         delegate void Etykieta(string msg);


         private StreamWriter logstr;
         private Timer timer;
         private int flush_count = 0;
         readonly Random rand = new Random((int)DateTime.Now.ToBinary());
         private DateTime timout;
         private ulong i = 0;
         private int z = 0;


         public Form1()
         {
             InitializeComponent();
            Closing += Form1_Closing;
         }

         void Form1_Closing(object sender, CancelEventArgs e)
         {

             Pe.Close();
             if(timer!=null)timer.Stop();
             if (logstr != null)
             {
                 logstr.Flush();
                 logstr.Close();
             }
         }

         private void ZmienTekstW(string m)
         {
             label2.Text = m;
             Log(m);
         }

         private void ZmienTekstE(string m)
         {
             label4.Text = m;
             Log(m);
         }


         void Pe_ErrorMessageE(string m, string channell)
         {
             string message = m + " from exch: " + channell;
             BeginInvoke(new Etykieta(ZmienTekstE), new object[] { 
message });
         }


         private void button1_Click(object sender, EventArgs e)
         {
             Pe.SendMessageToExch(messageBox.Text, 
comboBox3.SelectedItem.ToString());
             
//Pe.SendMessageToExch(messageBox.Text,comboBox3.SelectedItem.ToString());
         }

         private void button2_Click(object sender, EventArgs e)
         {
             bool d=false;
             RmqExchClient.ClientType c = RmqExchClient.ClientType.Both;
             string s = comboBox1.SelectedItem.ToString();
             if(comboBox4.SelectedItem.ToString()=="tak") d = true;
             if(comboBox2.SelectedItem.ToString() == "both") c = 
RmqExchClient.ClientType.Both;
             if (comboBox2.SelectedItem.ToString() == "producer") c = 
RmqExchClient.ClientType.Producer;
             if (comboBox2.SelectedItem.ToString() == "consumer") c = 
RmqExchClient.ClientType.Listener;
             Pe.DeclareNewExchaneOrJoin(textBox1.Text,s,c,d);
         }

         private void comboBox3_Click(object sender, EventArgs e)
         {
             comboBox3.Items.Clear();
             foreach (var s in Pe.Exchanges)
             {
                 if(s!=null)
                 comboBox3.Items.Add(s);
             }
         }

         private void button3_Click(object sender, EventArgs e)
         {
             Pe = new RmqExchClient(textBox2.Text);
             Pe.NewMessageEx += Pe_NewMessageEx;
             Pe.ErrorMessageE += Pe_ErrorMessageE;
         }

         void 
Pe_NewMessageEx(RabbitMQ.Client.Events.BasicDeliverEventArgs m, string 
exchange)
         {
             z++;
             BeginInvoke(new Etykieta(ZmienTekstW), new object[] { 
z.ToString() });
         }



         private void button4_Click(object sender, EventArgs e)
         {
             Pe.DeleteExch(textBox4.Text);
         }

         private void button5_Click(object sender, EventArgs e)
         {
             try
             {
                 if (!string.IsNullOrEmpty(textBox3.Text))
                 {
                    if(folderBrowserDialog1.ShowDialog()==DialogResult.OK)
                    {
                        timout = 
DateTime.Now.AddHours(Convert.ToDouble(textBox3.Text));
                        logstr = new 
StreamWriter(folderBrowserDialog1.SelectedPath+"\\log.txt",true);
                        timer=new Timer();
                        timer.Interval = 10;
                        timer.Tick += timer_Tick;
                        timer.Enabled = true;
                        timer.Start();
                    }
                 }
             }
                 catch(Exception ex)
                 {
                     Log(ex.Message);
                 }
         }

         void timer_Tick(object sender, EventArgs e)
         {
             if (DateTime.Now < timout)
             {
                 i++;
                 Pe.SendMessageToExch(i, comboBox3.SelectedItem.ToString());
                 Log("message sended: " +i );
                 label5.Text = i.ToString();
             }
         }

         private void Log(string msg)
         {
                 if (logstr != null)
                 {
                     logstr.WriteLine("SUD[{0,6}] {1}: {2}",
                         System.Diagnostics.Process.GetCurrentProcess().Id,
                         DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss.fff"),
                         msg);
                     flush_count++;
                     flush_count %= 10;
                     if (flush_count == 0) logstr.Flush();
                 }
         }

         private void button6_Click(object sender, EventArgs e)
         {
             if (folderBrowserDialog1.ShowDialog() == DialogResult.OK)
             {
                 logstr = new 
StreamWriter(folderBrowserDialog1.SelectedPath + "\\log.txt", true);
             }
         }

     }
}


I think i found my mistake I left your PrecessSingleDelivery from 
example (below) .Now i have correct it and its working :) all client 
consume correct even first. I


before:
private void ProcessSingleDelivery(BasicDeliverEventArgs e)
         {
             DebugUtil.DumpProperties(e, Console.Out, 0);
             if (e.BasicProperties.ContentType == MapMessageReader.MimeType)
             {
                 IMapMessageReader r = new 
MapMessageReader(e.BasicProperties, e.Body);
                 DebugUtil.DumpProperties(r.Body, Console.Out, 0);
             }
             else if (e.BasicProperties.ContentType == 
StreamMessageReader.MimeType)
             {
                 IStreamMessageReader r = new 
StreamMessageReader(e.BasicProperties, e.Body);
                 while (true)
                 {
                     try
                     {
                         object v = r.ReadObject();
                         NewMessageEx(e, e.Exchange);
                     }
                     catch (EndOfStreamException)
                     {
                         break;
                     }
                 }
             }
             else
             {
                 NewMessageEx(e, e.Exchange);
             }
         }

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From allister.macleod at gmail.com  Tue Nov  9 18:31:49 2010
From: allister.macleod at gmail.com (A. MacLeod)
Date: Tue, 9 Nov 2010 10:31:49 -0800 (PST)
Subject: [rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ
	2.x.x
In-Reply-To: <20101109172358.GH22102@rabbitmq.com>
References: <4dddb88f-6938-4acc-9ee9-e26806034ad8@35g2000prt.googlegroups.com>
	<20101109172358.GH22102@rabbitmq.com>
Message-ID: <07b294bb-bae9-4a47-bf04-7891babd40e3@w30g2000prj.googlegroups.com>

Thanks for the quick reply.

On Nov 9, 12:23?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Tue, Nov 09, 2010 at 08:43:27AM -0800, A. MacLeod wrote:
> > Am I correct in concluding that a RabbitMQ 2.x.x broker will never
> > generate a channel.flow message, ever?
>
> Yes, you are.

Ok, cool.

> > I have also tried some experiments where I use something like
> > consumerChannel.flow(false) to stop flow on the consumer's channel.
> > However, when I try to reopen the flow by doing
> > consumerChannel.flow(true), my consumer instance (of a class derived
> > from DefaultConsumer) never receives any more messages. ?Do I need to
> > re-issue consumerChannel.basicConsume(...) after I re-enable flow from
> > the consumer side?
>
> No, you shouldn't do. The Java client has a test for channel.flow in
> com.rabbitmq.client.test.functional.QosTests. If you can't make it work
> please let us know - it should all "just work".

Ok.  I will take a look at the client source code and adjust my
experimental code accordingly.  Probably I'm making some incorrect
assumptions about the sequencing and sync/async nature of various
calls.

> FWIW, the idea of the broker sending channel.flow to the client is a
> good one - it's sensible for the broker to be able to ignore just
> publishes amongst other methods on each given channel.
>
> Unfortunately, channel.flow is synchronous, so the broker has to wait
> for the client to respond (and send back the flow_ok) before it can
> start getting upperty should the producer continue to send messages. The
> problem here then is what timeout do you apply before you just start
> ignoring the producer anyway? If the client is only doing publishes
> anyway, you have absolutely no idea what the round trip time is.
> Furthermore, as we discovered when we tried to implement it, there's the
> possibility that the client _did_ respond and issue the flow_ok, but the
> broker was so overloaded it didn't notice it until after the timeout.
> Thus the client gets disconnected even when it did all the right things.
>
> Consequently, relying on TCP backpressure is pretty much the only
> sensible thing that can be done.

Sounds like a case of "fine in theory, but not so much in practice."
With such a fuzzy distinction between well-behaved and badly-behaved
clients, channel.flow starts to look pretty clunky.  From what I can
tell with the experimental code I've written, the TCP backpressure
works beautifully.

Thanks again for the info!

From matthew at rabbitmq.com  Tue Nov  9 19:22:31 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 9 Nov 2010 19:22:31 +0000
Subject: [rabbitmq-discuss] Usefulness of Channel.Flow with RabbitMQ
 2.x.x
In-Reply-To: <07b294bb-bae9-4a47-bf04-7891babd40e3@w30g2000prj.googlegroups.com>
References: <4dddb88f-6938-4acc-9ee9-e26806034ad8@35g2000prt.googlegroups.com>
	<20101109172358.GH22102@rabbitmq.com>
	<07b294bb-bae9-4a47-bf04-7891babd40e3@w30g2000prj.googlegroups.com>
Message-ID: <20101109192230.GA12180@wellquite.org>

On Tue, Nov 09, 2010 at 10:31:49AM -0800, A. MacLeod wrote:
> Sounds like a case of "fine in theory, but not so much in practice."
> With such a fuzzy distinction between well-behaved and badly-behaved
> clients, channel.flow starts to look pretty clunky.  From what I can
> tell with the experimental code I've written, the TCP backpressure
> works beautifully.

It does, up to the point that you have one consumer and one producer on
different channels within the same connection, and thus the consumer
gets stopped at the same point as the producer. But then again, channels
themselves are possibly a misguided feature too.

Matthew

From hsaid at plantcml-eads.com  Tue Nov  9 20:00:48 2010
From: hsaid at plantcml-eads.com (Hussein Said)
Date: Tue, 9 Nov 2010 15:00:48 -0500
Subject: [rabbitmq-discuss] WCF ServiceModel examples
Message-ID: <3173206D0F5F6B418F76F5997B2AE7520191FCFD@gatex01.CMLnet.peinet.peinc.com>

 

Hi, 
New to RabbitMQ, so pleas bear with me. 
I have downloaded and configured RabbitMQ as per instructions. The
server is up and running. 
I need to get the RabbitMQ.ServiceModel.Test tests to work. So far, I
managed to get the OneWayTest to pass. I had to change the  new
ServiceHost(typeof(LogService), new Uri("soap.amqp:///")); to 
 new ServiceHost(typeof(LogService), new Uri("soap.amqp://amq.direct/"))
wich means for some reason, the default exchange was not working. 

The remaining tests are failing. In particular, the TwoWayTest fails and
I get 

[14:44:02.2057888] TwoWayTest Failed: 
        OperationInterruptedException 
        The AMQP operation was interrupted: AMQP close-reason, initiated
by Peer 
, code=403, text="ACCESS_REFUSED - operation not permitted on the
default exchange", classId=50, methodId=20, cause= 
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply() in
C:\dev\RC 
S-Berlin\rabbitmq-dotnet-client-2.1.1\projects\client\RabbitMQ.Client\sr
c\client 
\impl\SimpleBlockingRpcContinuation.cs:line 87 
   at RabbitMQ.Client.Impl.ModelBase.ModelRpc(MethodBase method,
ContentHeaderBa 
se header, Byte[] body) in
C:\dev\RCS-Berlin\rabbitmq-dotnet-client-2.1.1\projec 
ts\client\RabbitMQ.Client\src\client\impl\ModelBase.cs:line 439 
   at RabbitMQ.Client.Framing.Impl.v0_9.Model.QueueBind(String queue,
String exc... 



Any ideas as to why the OneWayTest passes, but the others fails? 

thanks

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101109/f15af209/attachment.htm>

From hsaid at plantcml-eads.com  Tue Nov  9 19:45:20 2010
From: hsaid at plantcml-eads.com (hsaid)
Date: Tue, 9 Nov 2010 11:45:20 -0800 (PST)
Subject: [rabbitmq-discuss] WCF (RabbitMQ.ServiceModel.Test) examples failing
Message-ID: <30174336.post@talk.nabble.com>


Hi,
New to RabbitMQ, so pleas bear with me.
I have donwloaded and configuerd RQ as per instructions. The server is up an
running.
I need to get the RabbitMQ.ServiceModel.Test tests to work. So far, I
managed to get the OneWayTest to pass. I had to change the  new
ServiceHost(typeof(LogService), new Uri("soap.amqp:///")); to
 new ServiceHost(typeof(LogService), new Uri("soap.amqp://amq.direct/"))
wich means for some reason, the default exchange was not working.

The remaining tests are failing. In particular, the TwoWayTest fails and I
get 

[14:44:02.2057888] TwoWayTest Failed:
        OperationInterruptedException
        The AMQP operation was interrupted: AMQP close-reason, initiated by
Peer
, code=403, text="ACCESS_REFUSED - operation not permitted on the default
exchange", classId=50, methodId=20, cause=
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply() in
C:\dev\RC
S-Berlin\rabbitmq-dotnet-client-2.1.1\projects\client\RabbitMQ.Client\src\client
\impl\SimpleBlockingRpcContinuation.cs:line 87
   at RabbitMQ.Client.Impl.ModelBase.ModelRpc(MethodBase method,
ContentHeaderBa
se header, Byte[] body) in
C:\dev\RCS-Berlin\rabbitmq-dotnet-client-2.1.1\projec
ts\client\RabbitMQ.Client\src\client\impl\ModelBase.cs:line 439
   at RabbitMQ.Client.Framing.Impl.v0_9.Model.QueueBind(String queue, String
exc...



Any ideas as to why the OneWayTest passes, but the others fails?

thanks
-- 
View this message in context: http://old.nabble.com/WCF-%28RabbitMQ.ServiceModel.Test%29-examples-failing-tp30174336p30174336.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Wed Nov 10 07:48:54 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 10 Nov 2010 07:48:54 +0000
Subject: [rabbitmq-discuss] Passing null for 'arguments' to queueBind()
In-Reply-To: <30162963.post@talk.nabble.com>
References: <30162963.post@talk.nabble.com>
Message-ID: <4CDA4E66.1000508@rabbitmq.com>

Michi,

michi.oshima wrote:
> I'm currently exploring 'headers' exchange type.  I'd publish a message with
> argument table set to 'A' for example, with the intent that consumer with
> the matching argument 'A' would receive the message.  And those consumers
> who do not specify 'A' would not get the message.
> 
> I'm finding that a consumer ends up receiving all messages if I pass null as
> the value for the 'arguments' parameter. 
> 
> 1. Is this intended?  That is, I merely have to specify null for 'arguments'
> to receive all messages.

Yes, that is the specified behaviour.

> 2. Is there any way to prevent a client from subscribing to all messages?

Not directly, but see below.

> What I'm trying to achieve is some degree of message privacy.  Consumer A
> would put the key 'A' to argument to receive all messages meant for A, and
> Consumer B would put the key 'B' to argument to receive all messages meant
> for B.  Consumer A is prevented from receiving messages meant for Consumer
> B, simply because he is ignorant of the key 'B'.  

So essentially the producer is selecting who is allowed to receive a 
message by listing a set of tokens / shared secrets. Right?

I can think of three ways of doing that with RabbitMQ...

1) The publisher sends the message N times to a direct exchange, each 
time with an individual security token as the routing key. Consumers 
bind to that direct exchange with their token. (You could also just use 
the default exchange, if the consumer's queues are named with their 
token). The downside of this approach is the cost of having to send 
(and for the server to process) the same message multiple times.

2) Write a custom exchange type plug-in. This could work exactly like a 
headers exchange but not permit empty bindings. Or it could work more 
like a direct exchange, with the producer perhaps listing the tokens in 
the message's routing key, comma-separated.

3) Write a proxy that prevents empty bindings.


Regards,

Matthias.

From matthias at rabbitmq.com  Wed Nov 10 08:15:06 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 10 Nov 2010 08:15:06 +0000
Subject: [rabbitmq-discuss] Passing null for 'arguments' to queueBind()
In-Reply-To: <4CDA4E66.1000508@rabbitmq.com>
References: <30162963.post@talk.nabble.com> <4CDA4E66.1000508@rabbitmq.com>
Message-ID: <4CDA548A.90703@rabbitmq.com>

Matthias Radestock wrote:
> I can think of three ways of doing that with RabbitMQ...
> 
> 1) The publisher sends the message N times to a direct exchange, each 
> time with an individual security token as the routing key. Consumers 
> bind to that direct exchange with their token. (You could also just use 
> the default exchange, if the consumer's queues are named with their 
> token). The downside of this approach is the cost of having to send (and 
> for the server to process) the same message multiple times.
> 
> 2) Write a custom exchange type plug-in. This could work exactly like a 
> headers exchange but not permit empty bindings. Or it could work more 
> like a direct exchange, with the producer perhaps listing the tokens in 
> the message's routing key, comma-separated.
> 
> 3) Write a proxy that prevents empty bindings.

There is a problem with all of the above approaches...any routing key / 
header included in the message will be passed to *all* consumers, thus 
allowing consumers to learn each other's secrets.

Back to the drawing board...


Matthias.

From cuigang0120 at msn.com  Wed Nov 10 09:44:57 2010
From: cuigang0120 at msn.com (=?gb2312?B?tN641ihNU04p?=)
Date: Wed, 10 Nov 2010 17:44:57 +0800
Subject: [rabbitmq-discuss] Can Java API JsonRpcClient know server not exist?
Message-ID: <COL115-DS4538A0282EBF5B9653B17B6310@phx.gbl>

Hi,

I'm run RabbitMQ Java client 2.1.1 examples HelloJsonServer and HelloJsonClient. The RabbitMQ Server's version is 2.1.1.
My question is if HelloJsonServer program not running, I start up HelloJsonClient first, the process will be blocked.
Is there a way to set a timeout or exception, when HelloJsonClient send the request and HelloJsonServer not exist the function will throw an exception tell me JsonRpcClient waiting response time out or the request server not exist?

And another question is when the HelloJsonClient start up first ( HelloJsonServer not exist at this time ), the process be blocked, and then kill the HelloJsonClient process, run HelloJsonServer, HelloJsonServer will handled a request message. Is there a way when the JsonRpcClient process terminated, the in queue request messages from that JsonRpcClient can automatic dropped by the broker?

Thanks.

Cui Gang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101110/f0d379f2/attachment.htm>

From majek04 at gmail.com  Wed Nov 10 12:11:41 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 10 Nov 2010 12:11:41 +0000
Subject: [rabbitmq-discuss] How to consume from 10, 000 to 100,
 000 queues in a single process (java)
In-Reply-To: <AANLkTi=MqdG4LFMMumF1GkH6TM9+VEVQSBmL3HeMoPxU@mail.gmail.com>
References: <AANLkTi=MqdG4LFMMumF1GkH6TM9+VEVQSBmL3HeMoPxU@mail.gmail.com>
Message-ID: <AANLkTikut=hYBuxj4kzeoa8-FyCXFFg4eHGGfpG8x37r@mail.gmail.com>

Adam,

On Thu, Nov 4, 2010 at 20:33, Adam Hitchcock <adam.hitchcock at skype.net> wrote:
> Currently I am using a single threaded process that performs
> basic_consume with a custom callback handler (based off the
> ConsumerMain.java example)
>
> I am finding that queues are building up because I'm not able to
> consume fast enough.

If your consumer is too slow, maybe you can run second one?
Can you scale on the consuming side?

> So what are the best practices to consume from
> thousands to hundres of thousands of queues on a single core machine?

Well, if you can you should avoid it. Have you seen exchange-to-exchange
bindings, maybe using them you could create a simpler architecture:
http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

If you can't avoid using many queues, make sure they are small and
make sure you have enough resources (plenty of memory, a lot
of erlang process descriptors, and fast CPU).
Also SSD hard drive may help. 64 bit operating system is a requirement
for any setup with more than 2 gigs of RAM.
You should also avoid `touching` the queues too often. Don't use
basic.get, don't run `rabbitmqctl list_queues`. If possible don't
use acks (noack=True, as unacked messages need to be stored in-memory).

And obviously, run the newest RabbitMQ on a recent erlang.

> More details:
> noAck = true
> I am using a single instance of a class extending DefaultConsumer with
> an over ridden handleDelivery().

That sounds okay.

> Does anybody have numbers on what the maximum consume rate is on a
> stock ec2 setup?

No, but it's not that hard to measure. Here you have an example of how to
run our java MulticastMain benchmark:
http://www.rabbitmq.com/ec2.html#testing

Cheers,
  Marek

From moshima at advent.com  Wed Nov 10 16:19:28 2010
From: moshima at advent.com (Michi Oshima)
Date: Wed, 10 Nov 2010 08:19:28 -0800 (PST)
Subject: [rabbitmq-discuss] Passing null for 'arguments' to queueBind()
In-Reply-To: <4CDA548A.90703@rabbitmq.com>
References: <30162963.post@talk.nabble.com> <4CDA4E66.1000508@rabbitmq.com>
	<4CDA548A.90703@rabbitmq.com>
Message-ID: <30182063.post@talk.nabble.com>


Hi Matthias,


Matthias Radestock-3 wrote:
> 
> There is a problem with all of the above approaches...any routing key / 
> header included in the message will be passed to *all* consumers, thus 
> allowing consumers to learn each other's secrets.
> 

I'm not sure if this is true.  My thinking is that if a consumer doesn't
receive a message, the consumer cannot inspect its properties.  

Does a consumer get all messages, and is it up to some internal logic of the
consumer to filter out messages that aren't meant for the consumer?  I would
have thought this type of logic would be inside an exchange and kept away
from consumers.

For now I'm assuming we aren't back to the drawing board.  Your options #2
and #3 sound promising.  (Although I'd have to learn Erlang first.)


Matthias Radestock-3 wrote:
> 
>> 2) Write a custom exchange type plug-in. This could work exactly like a 
>> headers exchange but not permit empty bindings. Or it could work more 
>> like a direct exchange, with the producer perhaps listing the tokens in 
>> the message's routing key, comma-separated.
> 

I think I might try this one.  The custom exchange type will be basically a
headers exchange.  The only difference is that a null header will match
nothing: that is, it won't permit empty bindings.  

I'm so far failing to dig up good information for implementing custom
exchange type.  If you know of a good link, please let me know.


Matthias Radestock-3 wrote:
> 
>> 3) Write a proxy that prevents empty bindings.
> 

Could you direct me to more information about this also?  This proxy is
something new to me.  And again, I'm failing to locate information about it.  

In violation of mailing list etiquette, I thank you very much for your
replies.

Michi Oshima
-- 
View this message in context: http://old.nabble.com/Passing-null-for-%27arguments%27-to-queueBind%28%29-tp30162963p30182063.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Wed Nov 10 16:36:55 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 10 Nov 2010 16:36:55 +0000
Subject: [rabbitmq-discuss] Passing null for 'arguments' to queueBind()
In-Reply-To: <30182063.post@talk.nabble.com>
References: <30162963.post@talk.nabble.com>
	<4CDA4E66.1000508@rabbitmq.com>	<4CDA548A.90703@rabbitmq.com>
	<30182063.post@talk.nabble.com>
Message-ID: <4CDACA27.30009@rabbitmq.com>

Michi,

Michi Oshima wrote:
> I'm not sure if this is true.  My thinking is that if a consumer doesn't
> receive a message, the consumer cannot inspect its properties.  

The problems is that any consumers that *do* receive the message will 
learn the tokens of all other consumers that received the message too. 
They could subsequently bind to the exchange with these tokens as the 
binding key and receive messages intended for other consumers.

That is not a problem if there is a fixed set of groups of consumers, 
and messages are always addressed to all the members of a group. For 
that you'd simply assign each group a token, give that to consumers and 
get the consumers to bind with all the tokens they hold.

It *is* a problem though when the groups are formed dynamically on a per 
message basis, i.e. when each consumer has a unique secret token, known 
to the producer, and the producer constructs the recipient group of the 
message on the fly by including all the intended recipient's tokens in 
the message headers.


Regards,

Matthias.

From hsaid at plantcml-eads.com  Wed Nov 10 20:50:33 2010
From: hsaid at plantcml-eads.com (Hussein Said)
Date: Wed, 10 Nov 2010 15:50:33 -0500
Subject: [rabbitmq-discuss] WCF (RabbitMQ.ServiceModel.Test) examples
	failing
In-Reply-To: <30174336.post@talk.nabble.com>
References: <30174336.post@talk.nabble.com>
Message-ID: <3173206D0F5F6B418F76F5997B2AE752019203D2@gatex01.CMLnet.peinet.peinc.com>

Hello,
I had to modify the RabbitMQChannelListenerBase.cs in ServiceModel so
that it uses amq.direct exchange as oppsed to the default exchange.
Line 93:                m_listenUri = new Uri(new
Uri("soap.amqp://amq.direct/"), Guid.NewGuid().ToString());

I hate to modify the source code(in this particular case), so can
someone from the development team confirm that the WCF ServiceModel
works with default exchanges, and if so, can you explain
Why it is failing?

thanks


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of hsaid
Sent: November 9, 2010 2:45 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] WCF (RabbitMQ.ServiceModel.Test) examples
failing


Hi,
New to RabbitMQ, so pleas bear with me.
I have donwloaded and configuerd RQ as per instructions. The server is
up an
running.
I need to get the RabbitMQ.ServiceModel.Test tests to work. So far, I
managed to get the OneWayTest to pass. I had to change the  new
ServiceHost(typeof(LogService), new Uri("soap.amqp:///")); to
 new ServiceHost(typeof(LogService), new Uri("soap.amqp://amq.direct/"))
wich means for some reason, the default exchange was not working.

The remaining tests are failing. In particular, the TwoWayTest fails and
I
get 

[14:44:02.2057888] TwoWayTest Failed:
        OperationInterruptedException
        The AMQP operation was interrupted: AMQP close-reason, initiated
by
Peer
, code=403, text="ACCESS_REFUSED - operation not permitted on the
default
exchange", classId=50, methodId=20, cause=
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply() in
C:\dev\RC
S-Berlin\rabbitmq-dotnet-client-2.1.1\projects\client\RabbitMQ.Client\sr
c\client
\impl\SimpleBlockingRpcContinuation.cs:line 87
   at RabbitMQ.Client.Impl.ModelBase.ModelRpc(MethodBase method,
ContentHeaderBa
se header, Byte[] body) in
C:\dev\RCS-Berlin\rabbitmq-dotnet-client-2.1.1\projec
ts\client\RabbitMQ.Client\src\client\impl\ModelBase.cs:line 439
   at RabbitMQ.Client.Framing.Impl.v0_9.Model.QueueBind(String queue,
String
exc...



Any ideas as to why the OneWayTest passes, but the others fails?

thanks
-- 
View this message in context:
http://old.nabble.com/WCF-%28RabbitMQ.ServiceModel.Test%29-examples-fail
ing-tp30174336p30174336.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From moshima at advent.com  Wed Nov 10 21:03:22 2010
From: moshima at advent.com (Michi Oshima)
Date: Wed, 10 Nov 2010 13:03:22 -0800 (PST)
Subject: [rabbitmq-discuss] Passing null for 'arguments' to queueBind()
In-Reply-To: <4CDACA27.30009@rabbitmq.com>
References: <30162963.post@talk.nabble.com> <4CDA4E66.1000508@rabbitmq.com>
	<4CDA548A.90703@rabbitmq.com> <30182063.post@talk.nabble.com>
	<4CDACA27.30009@rabbitmq.com>
Message-ID: <30184535.post@talk.nabble.com>




Matthias Radestock-3 wrote:
> 
> It *is* a problem though when the groups are formed dynamically on a per 
> message basis, i.e. when each consumer has a unique secret token, known 
> to the producer, and the producer constructs the recipient group of the 
> message on the fly by including all the intended recipient's tokens in 
> the message headers.
> 

I understand you now, and above is exactly the situation I have.  I wonder
if a custom exchange type can remove headers from a message prior to
delivery.  

Michi Oshima
-- 
View this message in context: http://old.nabble.com/Passing-null-for-%27arguments%27-to-queueBind%28%29-tp30162963p30184535.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Wed Nov 10 22:33:08 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 10 Nov 2010 22:33:08 +0000
Subject: [rabbitmq-discuss] WCF (RabbitMQ.ServiceModel.Test) examples
 failing
In-Reply-To: <3173206D0F5F6B418F76F5997B2AE752019203D2@gatex01.CMLnet.peinet.peinc.com>
References: <30174336.post@talk.nabble.com>
	<3173206D0F5F6B418F76F5997B2AE752019203D2@gatex01.CMLnet.peinet.peinc.com>
Message-ID: <20101110223307.GA5515@wellquite.org>

On Wed, Nov 10, 2010 at 03:50:33PM -0500, Hussein Said wrote:
> I hate to modify the source code(in this particular case), so can
> someone from the development team confirm that the WCF ServiceModel
> works with default exchanges, and if so, can you explain
> Why it is failing?

Because, when we updated the behaviour of Rabbit wrt the default
exchange, we failed to notice that it broke the WCF. We're working to
fix this.

Matthew

From hsaid at plantcml-eads.com  Wed Nov 10 22:40:42 2010
From: hsaid at plantcml-eads.com (Hussein Said)
Date: Wed, 10 Nov 2010 17:40:42 -0500
Subject: [rabbitmq-discuss] WCF (RabbitMQ.ServiceModel.Test) examples
	failing
In-Reply-To: <20101110223307.GA5515@wellquite.org>
References: <30174336.post@talk.nabble.com><3173206D0F5F6B418F76F5997B2AE752019203D2@gatex01.CMLnet.peinet.peinc.com>
	<20101110223307.GA5515@wellquite.org>
Message-ID: <3173206D0F5F6B418F76F5997B2AE75201920492@gatex01.CMLnet.peinet.peinc.com>

Thanks for your reply. I will wait for the update, but for now, I got a
Rabbit running and being fed all sort of messages :-)


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
Matthew Sackman
Sent: November 10, 2010 5:33 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] WCF (RabbitMQ.ServiceModel.Test)
examples failing

On Wed, Nov 10, 2010 at 03:50:33PM -0500, Hussein Said wrote:
> I hate to modify the source code(in this particular case), so can
> someone from the development team confirm that the WCF ServiceModel
> works with default exchanges, and if so, can you explain
> Why it is failing?

Because, when we updated the behaviour of Rabbit wrt the default
exchange, we failed to notice that it broke the WCF. We're working to
fix this.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From vincentcheongst at gmail.com  Thu Nov 11 02:53:40 2010
From: vincentcheongst at gmail.com (Vincent Cheong)
Date: Thu, 11 Nov 2010 10:53:40 +0800
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>

I've downloaded the branch but am having some compilation problem. The error
line is "cl : Command line error D8021 : invalid numeric argument
'/Wl,-DLL'"

The full build output is listed below:

Using Visual Studio install at /C/Program Files/Microsoft Visual Studio 8

Using Windows SDK install at /C/Program Files/Microsoft SDKs/Windows/v6.0A

+ autoreconf -i

C:\MinGW\bin\libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to
configure.ac and

C:\MinGW\bin\libtoolize: rerunning C:\MinGW\bin\libtoolize, to keep the
correct libtool macros in-tree.

C:\MinGW\bin\libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in
Makefile.am.

+ ./configure CC=cl.exe LD=link.exe CFLAGS=-nologo

checking for a BSD-compatible install... /bin/install -c

checking whether build environment is sane... yes

checking for a thread-safe mkdir -p... /bin/mkdir -p

checking for gawk... gawk

checking whether make sets $(MAKE)... yes

checking for style of include used by make... GNU

checking for gcc... cl.exe

checking whether the C compiler works... yes

checking for C compiler default output file name... conftest.exe

checking for suffix of executables... .exe

checking whether we are cross compiling... no

checking for suffix of object files... obj

checking whether we are using the GNU C compiler... no

checking whether cl.exe accepts -g... yes

checking for cl.exe option to accept ISO C89... none needed

checking dependency style of cl.exe... none

checking how to run the C preprocessor... cl.exe -E

checking for grep that handles long lines and -e... /bin/grep

checking for egrep... /bin/grep -E

checking for ANSI C header files... yes

checking for sys/types.h... yes

checking for sys/stat.h... yes

checking for stdlib.h... yes

checking for string.h... yes

checking for memory.h... yes

checking for strings.h... no

checking for inttypes.h... no

checking for stdint.h... no

checking for unistd.h... no

checking minix/config.h usability... no

checking minix/config.h presence... no

checking for minix/config.h... no

checking whether it is safe to define __EXTENSIONS__... yes

checking for gcc... (cached) cl.exe

checking whether we are using the GNU C compiler... (cached) no

checking whether cl.exe accepts -g... (cached) yes

checking for cl.exe option to accept ISO C89... (cached) none needed

checking dependency style of cl.exe... (cached) none

checking build system type... i686-pc-mingw32

checking host system type... i686-pc-mingw32

checking for as... as

checking for dlltool... dlltool

checking for objdump... objdump

checking how to print strings... printf

checking for a sed that does not truncate output... /bin/sed

checking for fgrep... /bin/grep -F

checking for non-GNU ld... link.exe

checking if the linker (link.exe) is GNU ld... no

checking for BSD- or MS-compatible name lister (nm)... /bin/nm -B

checking the name lister (/bin/nm -B) interface... BSD nm

checking whether ln -s works... no, using cp -p

checking the maximum length of command line arguments... 8192

checking whether the shell understands some XSI constructs... yes

checking whether the shell understands "+="... yes

checking how to convert i686-pc-mingw32 file names to i686-pc-mingw32
format... func_convert_file_msys_to_w32

checking for link.exe option to reload object files... -r

checking for objdump... (cached) objdump

checking how to recognize dependent libraries... file_magic ^x86 archive
import|^x86 DLL

checking for dlltool... (cached) dlltool

checking how to associate runtime and link libraries...
func_cygming_dll_for_implib

checking for ar... ar

checking for archiver @FILE support... @

checking for strip... strip

checking for ranlib... ranlib

checking command to parse /bin/nm -B output from cl.exe object... ok

checking for sysroot... no

checking for mt... mt

checking if mt is a manifest tool... yes

checking for dlfcn.h... no

checking for objdir... .libs

checking for cl.exe option to produce PIC... -DDLL_EXPORT -DPIC

checking if cl.exe PIC flag -DDLL_EXPORT -DPIC works... yes

checking if cl.exe static flag works... yes

checking if cl.exe supports -c -o file.obj... no

checking if cl.exe supports -c -o file.obj... (cached) no

checking if we can lock with hard links... yes

checking whether the cl.exe linker (link.exe) supports shared libraries...
yes

checking dynamic linker characteristics... Win32 link.exe

checking how to hardcode library paths into programs... immediate

checking whether stripping libraries is possible... yes

checking if libtool supports shared libraries... yes

checking whether to build shared libraries... yes

checking whether to build static libraries... yes

checking for ANSI C header files... (cached) yes

checking for inline... __inline

checking location of AMQP codegen directory...
/home/vincentcheong/rabbit/windows_rabbitmq-c/../rabbitmq-codegen

checking finding a python with simplejson installed... python

checking for poptGetContext in -lpopt... no

checking for xmlto... no

configure: creating ./config.status

config.status: creating Makefile

config.status: creating librabbitmq/Makefile

config.status: creating tests/Makefile

config.status: creating examples/Makefile

config.status: creating tools/Makefile

config.status: creating tools/doc/Makefile

config.status: creating config.h

config.status: config.h is unchanged

config.status: executing depfiles commands

config.status: executing libtool commands

+ sed -i -e
's/^fix_srcfile_path=.*$/fix_srcfile_path=""/;s/^deplibs_check_method=.*$/deplibs_check_method=pass_all/;/^archive_cmds=/s/-link
-dll/& -implib:\\$libname.\\$libext/' libtool

+ make

make all-recursive

make[1]: Entering directory `/home/vincentcheong/rabbit/windows_rabbitmq-c'

Making all in librabbitmq

make[2]: Entering directory
`/home/vincentcheong/rabbit/windows_rabbitmq-c/librabbitmq'

make all-am

make[3]: Entering directory
`/home/vincentcheong/rabbit/windows_rabbitmq-c/librabbitmq'

/bin/sh ../libtool --tag=CC --mode=link cl.exe -I./windows
-DBUILDING_LIBRABBITMQ -I../msinttypes -nologo -no-undefined -o
librabbitmq.la -rpath /usr/local/lib amqp_mem.lo amqp_table.lo
amqp_connection.lo amqp_socket.lo amqp_api.lo socket.lo amqp_framing.lo
ws2_32.lib

*** Warning: Linking the shared library librabbitmq.la against the

*** static library ws2_32.lib is not portable!

libtool: link: rm -fr .libs/rabbitmq.exp

libtool: link: /bin/nm -B .libs/amqp_mem.obj .libs/amqp_table.obj
.libs/amqp_connection.obj .libs/amqp_socket.obj .libs/amqp_api.obj
.libs/socket.obj .libs/amqp_framing.obj | sed -n -e 's/^.*[
]\([ABCDGIRSTW][ABCDGIRSTW]*\)[ ][ ]*_\([_A-Za-z][_A-Za-z0-9]*\)\{0,1\}$/\1
_\2 \2/p' | /bin/sed -e '/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1,DATA/' | /bin/sed
-e '/^[AITW][ ]/s/.*[ ]//' | sort | uniq > .libs/rabbitmq.exp

libtool: link: if test "x`/bin/sed 1q .libs/rabbitmq.exp`" = xEXPORTS; then
sed -n -e s/\\\(.*\\\)/-link\ -EXPORT:\\\1/ -e 1\!p < .libs/rabbitmq.exp >
.libs/rabbitmq-0.dll.exp; else sed -e s/\\\(.*\\\)/-link\ -EXPORT:\\\1/ <
.libs/rabbitmq.exp > .libs/rabbitmq-0.dll.exp; fi

libtool: link: cl.exe -o .libs/rabbitmq-0.dll .libs/amqp_mem.obj
.libs/amqp_table.obj .libs/amqp_connection.obj .libs/amqp_socket.obj
.libs/amqp_api.obj .libs/socket.obj .libs/amqp_framing.obj ws2_32.lib
@.libs/rabbitmq-0.dll.exp -Wl,-DLL

Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 14.00.50727.762 for
80x86

Copyright (C) Microsoft Corporation. All rights reserved.

cl : Command line warning D9035 : option 'o' has been deprecated and will be
removed in a future release

cl -link -EXPORT:amqp_abort

-link -EXPORT:amqp_basic_ack

-link -EXPORT:amqp_basic_consume

-link -EXPORT:amqp_basic_get

-link -EXPORT:amqp_basic_publish

-link -EXPORT:amqp_bytes_free

-link -EXPORT:amqp_bytes_malloc

-link -EXPORT:amqp_bytes_malloc_dup

-link -EXPORT:amqp_channel_close

-link -EXPORT:amqp_channel_open

-link -EXPORT:amqp_connection_close

-link -EXPORT:amqp_constant_is_hard_error

-link -EXPORT:amqp_constant_name

-link -EXPORT:amqp_cstring_bytes

-link -EXPORT:amqp_data_in_buffer

-link -EXPORT:amqp_decode_method

-link -EXPORT:amqp_decode_properties

-link -EXPORT:amqp_decode_table

-link -EXPORT:amqp_destroy_connection

-link -EXPORT:amqp_empty_array,DATA

-link -EXPORT:amqp_empty_bytes,DATA

-link -EXPORT:amqp_empty_table,DATA

-link -EXPORT:amqp_encode_method

-link -EXPORT:amqp_encode_properties

-link -EXPORT:amqp_encode_table

-link -EXPORT:amqp_error_string

-link -EXPORT:amqp_exchange_declare

-link -EXPORT:amqp_frames_enqueued

-link -EXPORT:amqp_get_channel_max

-link -EXPORT:amqp_get_rpc_reply

-link -EXPORT:amqp_get_sockfd

-link -EXPORT:amqp_handle_input

-link -EXPORT:amqp_login

-link -EXPORT:amqp_maybe_release_buffers

-link -EXPORT:amqp_method_has_content

-link -EXPORT:amqp_method_name

-link -EXPORT:amqp_new_connection

-link -EXPORT:amqp_open_socket

-link -EXPORT:amqp_os_error_string

-link -EXPORT:amqp_pool_alloc

-link -EXPORT:amqp_pool_alloc_bytes

-link -EXPORT:amqp_queue_bind

-link -EXPORT:amqp_queue_declare

-link -EXPORT:amqp_queue_delete

-link -EXPORT:amqp_queue_purge

-link -EXPORT:amqp_queue_unbind

-link -EXPORT:amqp_release_buffers

-link -EXPORT:amqp_release_buffers_ok

-link -EXPORT:amqp_send_frame

-link -EXPORT:amqp_send_header

-link -EXPORT:amqp_send_method

-link -EXPORT:amqp_set_sockfd

-link -EXPORT:amqp_simple_rpc

-link -EXPORT:amqp_simple_wait_frame

-link -EXPORT:amqp_simple_wait_method

-link -EXPORT:amqp_socket_init

-link -EXPORT:amqp_table_entry_cmp

-link -EXPORT:amqp_tune_connection

-link -EXPORT:amqp_tx_commit

-link -EXPORT:amqp_tx_rollback

-link -EXPORT:amqp_tx_select

-link -EXPORT:amqp_version

-link -EXPORT:empty_amqp_pool

-link -EXPORT:init_amqp_pool

-link -EXPORT:recycle_amqp_pool

cl : Command line error D8021 : invalid numeric argument '/Wl,-DLL'

make[3]: *** [librabbitmq.la] Error 2

make[3]: Leaving directory
`/home/vincentcheong/rabbit/windows_rabbitmq-c/librabbitmq'

make[2]: *** [all] Error 2

make[2]: Leaving directory
`/home/vincentcheong/rabbit/windows_rabbitmq-c/librabbitmq'

make[1]: *** [all-recursive] Error 1

make[1]: Leaving directory `/home/vincentcheong/rabbit/windows_rabbitmq-c'

make: *** [all] Error 2


On Tue, Nov 9, 2010 at 7:30 PM, David Wragg <david at rabbitmq.com> wrote:

>  Vincent Cheong <vincentcheongst at gmail.com> writes:
> > I have downloaded the rabbit mq c client from
> > http://hg.rabbitmq.com/rabbitmq-c/summary and compiled the the library
> using
> > mingw successfully.
> >
> > However when I compile against the library (librabbitmq.dll.a) and run my
> > application, I get a run-time check failure of the value of esp being not
> > properly saved. Any help would be deeply appreciated.
>
> Are you trying to call the mingw-compiled library from code developed in
> Visual Studio?  That doesn't work, as explained in the README.windows
> file.
>
> But we have addressed this issue in the bug23423 branch.  If you switch
> to that branch, README.windows contains instructions on how to build the
> library with Microsoft's compiler, so that it is callable from code
> developed in VS.
>
> That branch still has to go through code review here, but it should work
> fine.  Let me know if you have any problems with it.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101111/2226b952/attachment-0001.htm>

From david at rabbitmq.com  Thu Nov 11 04:11:40 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 11 Nov 2010 04:11:40 +0000
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	(Vincent Cheong's message of "Thu, 11 Nov 2010 10:53:40 +0800")
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
Message-ID: <yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>

Hi Vincent,

Vincent Cheong <vincentcheongst at gmail.com> writes:
> I've downloaded the branch but am having some compilation problem. The error
> line is "cl : Command line error D8021 : invalid numeric argument
> '/Wl,-DLL'"
>
> The full build output is listed below:
> [...]

>From the output, I see that nothing is actually getting compiled, but
only linked.  I'm not sure that this is related to the error, but it
makes me think that you have some files present from an earlier build,
and that might be affecting things.  Could you try deleting (or moving)
your rabbitmq-c directory, and starting from a fresh 'hg clone' of the
rabbitmq-c repository, and let me know what happens?

Thanks,
David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From selfsorted at gmail.com  Thu Nov 11 01:52:26 2010
From: selfsorted at gmail.com (ssorted)
Date: Wed, 10 Nov 2010 17:52:26 -0800 (PST)
Subject: [rabbitmq-discuss] Only 20 req-resps per second
Message-ID: <f7dd867e-7ab2-46d7-93e3-9a581330c2f6@c39g2000yqi.googlegroups.com>

Hi.
I would like to use RabbitMQ for RPC. Example Python scripts I used
are here:
- client - http://dpaste.com/hold/273708/,
- server - http://dpaste.com/hold/273709/

The client script sends 100 requests and waits 100 times for a
response. It is done sequentially for each request: send 1st message,
wait for response for 1st message, send 2nd message ....

Performance is very low: the client.py script needs 4 seconds to
finish which means only 25 requests+responses per second. After
changing the client.py script to first send all requests, and then
consume all responses, it finishes in 0.25 second which means 400
requests+responses per second. But this is not the situation I need to
simulate and bad performance of the original script is a problem for
me.

These scripts use amqplib, I reimplemented them in pika (alternative
AMQP Python library) but without any difference in performance.

The question is: have I implemented the RPC mechanism correctly? And
why the performance is so bad? Can be something done or simply AMQP
isn't suited for high performance RPC?


Regards,
Artur

From sameek at arosys.com  Thu Nov 11 06:50:28 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 10 Nov 2010 22:50:28 -0800 (PST)
Subject: [rabbitmq-discuss] how to set the basic message properties for
 message in rabbitmq?
Message-ID: <30187552.post@talk.nabble.com>


Hi all

i am using Rabbitmq Java client API.i want to set the Basic Properties of
message and also get the message Id of the message.if possible please
provide some code to understand the things.

Thanks

-- 
View this message in context: http://old.nabble.com/how-to-set-the-basic-message-properties-for-message-in-rabbitmq--tp30187552p30187552.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Thu Nov 11 07:08:03 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 10 Nov 2010 23:08:03 -0800 (PST)
Subject: [rabbitmq-discuss] Java Client :how can i uniquely identify a
 message?
Message-ID: <30187626.post@talk.nabble.com>


I have Created a RabbitMQ Producer and a RabbitMQ Consumer....

suppose my producer produces 10 messages. How can i get a particular message
from those 10 messages.

I want to know how can i uniquely identify a message and read that or
consume that message.
-- 
View this message in context: http://old.nabble.com/Java-Client-%3Ahow-can-i-uniquely-identify-a-message--tp30187626p30187626.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Thu Nov 11 07:25:35 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 10 Nov 2010 23:25:35 -0800 (PST)
Subject: [rabbitmq-discuss] Java Client :how can i uniquely identify a
 message?
Message-ID: <30187702.post@talk.nabble.com>


I have Created a RabbitMQ Producer and a RabbitMQ Consumer....

suppose my producer produces 10 messages. How can i get a particular message
from those 10 messages.

I want to know how can i uniquely identify a message and read that or
consume that message.
-- 
View this message in context: http://old.nabble.com/Java-Client-%3Ahow-can-i-uniquely-identify-a-message--tp30187702p30187702.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From vincentcheongst at gmail.com  Thu Nov 11 07:59:51 2010
From: vincentcheongst at gmail.com (Vincent Cheong)
Date: Thu, 11 Nov 2010 15:59:51 +0800
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	<yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>

Hi David,

I believe the individual .c files were compiled. The respective obj file
were found in librabbitmq/.libs. However, I did not get the source files via
a 'hg clone' but downloaded them from
http://hg.rabbitmq.com/rabbitmq-c/file/f09918f7aa73. I have multiple
versions of visual studio installed on my machine but i'm forcing it to use
my visual studio 2005 compiler. I did so by removing the 10.0 and 9.0 for
the vsvers and v7.0A and v6.0A from the build-ms.sh file. Is this the
correct way to it or have I introduced an error by doing so?

Thanks,
Vincent

On Thu, Nov 11, 2010 at 12:11 PM, David Wragg <david at rabbitmq.com> wrote:

> Hi Vincent,
>
> Vincent Cheong <vincentcheongst at gmail.com> writes:
> > I've downloaded the branch but am having some compilation problem. The
> error
> > line is "cl : Command line error D8021 : invalid numeric argument
> > '/Wl,-DLL'"
> >
> > The full build output is listed below:
> > [...]
>
> From the output, I see that nothing is actually getting compiled, but
> only linked.  I'm not sure that this is related to the error, but it
> makes me think that you have some files present from an earlier build,
> and that might be affecting things.  Could you try deleting (or moving)
> your rabbitmq-c directory, and starting from a fresh 'hg clone' of the
> rabbitmq-c repository, and let me know what happens?
>
> Thanks,
>  David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101111/78e78708/attachment.htm>

From madalin at sellerengine.com  Thu Nov 11 08:16:20 2010
From: madalin at sellerengine.com (Madalin Popa)
Date: Thu, 11 Nov 2010 10:16:20 +0200
Subject: [rabbitmq-discuss] about RabbitMQ + HTTP Server configuration
Message-ID: <1289463380.2135.7.camel@madalin-laptop>

Hi,

I have a RabbitMQ server with 2 channels (tx, rx), consuming requests
(rx channel) from a HTTP server and passing them to a pool of
slaves...The slaves, when they finish their work, pass the result back
on RabbitMQ tx channel, from where the response needs to be mapped back
to initial HTTP request. Are there any natural/out of the box solutions
for this final part of mapping the response received from tx queue back
to HTTP requester?

Thanks a lot for your help.

Warmest Regards,
Dragos POPA


From david at rabbitmq.com  Thu Nov 11 08:33:09 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 11 Nov 2010 08:33:09 +0000
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>
	(Vincent Cheong's message of "Thu, 11 Nov 2010 15:59:51 +0800")
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	<yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
	<AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>
Message-ID: <yrv4c1v6sp8e2.fsf@dwragg.eng.vmware.com>

Hi Vincent,

Vincent Cheong <vincentcheongst at gmail.com> writes:
> I believe the individual .c files were compiled. The respective obj file
> were found in librabbitmq/.libs.

Yes, but the compiler commands that produced those obj files were not
present in the build output you sent.  I'd like to see the output you
get when building from an absolutely clean state, to help me understand
the cause of the error.

> However, I did not get the source files via
> a 'hg clone' but downloaded them from
> http://hg.rabbitmq.com/rabbitmq-c/file/f09918f7aa73.

Downloading that revision via one of the archive links (such as the
'zip' link) is fine too.  But make sure you delete your existing
rabbitmq-c directory first - don't just unpack over it - so that you
build from a clean state.

> I have multiple
> versions of visual studio installed on my machine but i'm forcing it to use
> my visual studio 2005 compiler. I did so by removing the 10.0 and 9.0 for
> the vsvers and v7.0A and v6.0A from the build-ms.sh file. Is this the
> correct way to it or have I introduced an error by doing so?

This should be fine.  I expect that if you do not make this change, and
so build with the compiler from VS 10.0, you will get the same error.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From simon at rabbitmq.com  Thu Nov 11 08:34:16 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Nov 2010 08:34:16 +0000
Subject: [rabbitmq-discuss] Only 20 req-resps per second
In-Reply-To: <f7dd867e-7ab2-46d7-93e3-9a581330c2f6@c39g2000yqi.googlegroups.com>
References: <f7dd867e-7ab2-46d7-93e3-9a581330c2f6@c39g2000yqi.googlegroups.com>
Message-ID: <4CDBAA88.1030804@rabbitmq.com>

On 11/11/2010 1:52AM, ssorted wrote:

 > Performance is very low: the client.py script needs 4 seconds to
 > finish which means only 25 requests+responses per second.

That's not what I see. With everything running on localhost I see 100 
iterations in ~240ms on my laptop. Commenting out the print statements 
and increasing to 1000 iterations (to amortise Python's startup costs) I 
get 1000 in ~1200ms - or about 1.2ms each. Pipelining would let things 
go faster still, but I understand why you'd not want that.

> The question is: have I implemented the RPC mechanism correctly?

No, I think your code is reasonable.

> And
> why the performance is so bad? Can be something done or simply AMQP
> isn't suited for high performance RPC?

That's a good question. What is the latency between client.py / Rabbit / 
server.py? But it can't all be latency, even your pipelined case seems 
very slow.

Cheers, Simon

From vincentcheongst at gmail.com  Thu Nov 11 08:54:31 2010
From: vincentcheongst at gmail.com (Vincent Cheong)
Date: Thu, 11 Nov 2010 16:54:31 +0800
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <yrv4c1v6sp8e2.fsf@dwragg.eng.vmware.com>
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	<yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
	<AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>
	<yrv4c1v6sp8e2.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=5pONoOVKtVxT6tap-g6RgQryPUapE+BkSzKeS@mail.gmail.com>

Hi David,

I removed the old directory did a new build. The same errors is still there.
The complete build log is below:


checking for gawk... gawk

checking whether make sets $(MAKE)... yes

checking for style of include used by make... GNU

checking for gcc... cl.exe

checking whether the C compiler works... yes

checking for C compiler default output file name... conftest.exe

checking for suffix of executables... .exe

checking whether we are cross compiling... no

checking for suffix of object files... obj

checking whether we are using the GNU C compiler... no

checking whether cl.exe accepts -g... yes

checking for cl.exe option to accept ISO C89... none needed

checking dependency style of cl.exe... none

checking how to run the C preprocessor... cl.exe -E

checking for grep that handles long lines and -e... /bin/grep

checking for egrep... /bin/grep -E

checking for ANSI C header files... yes

checking for sys/types.h... yes

checking for sys/stat.h... yes

checking for stdlib.h... yes

checking for string.h... yes

checking for memory.h... yes

checking for strings.h... no

checking for inttypes.h... no

checking for stdint.h... no

checking for unistd.h... no

checking minix/config.h usability... no

checking minix/config.h presence... no

checking for minix/config.h... no

checking whether it is safe to define __EXTENSIONS__... yes

checking for gcc... (cached) cl.exe

checking whether we are using the GNU C compiler... (cached) no

checking whether cl.exe accepts -g... (cached) yes

checking for cl.exe option to accept ISO C89... (cached) none needed

checking dependency style of cl.exe... (cached) none

checking build system type... i686-pc-mingw32

checking host system type... i686-pc-mingw32

checking for as... as

checking for dlltool... dlltool

checking for objdump... objdump

checking how to print strings... printf

checking for a sed that does not truncate output... /bin/sed

checking for fgrep... /bin/grep -F

checking for non-GNU ld... link.exe

checking if the linker (link.exe) is GNU ld... no

checking for BSD- or MS-compatible name lister (nm)... /bin/nm -B

checking the name lister (/bin/nm -B) interface... BSD nm

checking whether ln -s works... no, using cp -p

checking the maximum length of command line arguments... 8192

checking whether the shell understands some XSI constructs... yes

checking whether the shell understands "+="... yes

checking how to convert i686-pc-mingw32 file names to i686-pc-mingw32
format...

func_convert_file_msys_to_w32

checking for link.exe option to reload object files... -r

checking for objdump... (cached) objdump

checking how to recognize dependent libraries... file_magic ^x86 archive
import|

^x86 DLL

checking for dlltool... (cached) dlltool

checking how to associate runtime and link libraries...
func_cygming_dll_for_imp

lib

checking for ar... ar

checking for archiver @FILE support... @

checking for strip... strip

checking for ranlib... ranlib

checking command to parse /bin/nm -B output from cl.exe object... ok

checking for sysroot... no

checking for mt... mt

checking if mt is a manifest tool... yes

checking for dlfcn.h... no

checking for objdir... .libs

checking for cl.exe option to produce PIC... -DDLL_EXPORT -DPIC

checking if cl.exe PIC flag -DDLL_EXPORT -DPIC works... yes

checking if cl.exe static flag works... yes

checking if cl.exe supports -c -o file.obj... no

checking if cl.exe supports -c -o file.obj... (cached) no

checking if we can lock with hard links... yes

checking whether the cl.exe linker (link.exe) supports shared libraries...
yes

checking dynamic linker characteristics... Win32 link.exe

checking how to hardcode library paths into programs... immediate

checking whether stripping libraries is possible... yes

checking if libtool supports shared libraries... yes

checking whether to build shared libraries... yes

checking whether to build static libraries... yes

checking for ANSI C header files... (cached) yes

checking for inline... __inline

checking location of AMQP codegen directory...
/home/vincentcheong/rabbit/window

s_rabbitmq-c/../rabbitmq-codegen

checking finding a python with simplejson installed... python

checking for poptGetContext in -lpopt... no

checking for xmlto... no

configure: creating ./config.status

config.status: creating Makefile

config.status: creating librabbitmq/Makefile

config.status: creating tests/Makefile

config.status: creating examples/Makefile

config.status: creating tools/Makefile

config.status: creating tools/doc/Makefile

config.status: creating config.h

config.status: executing depfiles commands

config.status: executing libtool commands

+ sed -i -e
's/^fix_srcfile_path=.*$/fix_srcfile_path=""/;s/^deplibs_check_metho

d=.*$/deplibs_check_method=pass_all/;/^archive_cmds=/s/-link -dll/&
-implib:\\$l

ibname.\\$libext/' libtool

+ make

make all-recursive

make[1]: Entering directory `/home/vincentcheong/rabbit/windows_rabbitmq-c'

Making all in librabbitmq

make[2]: Entering directory
`/home/vincentcheong/rabbit/windows_rabbitmq-c/libra

bbitmq'

PYTHONPATH=/home/vincentcheong/rabbit/windows_rabbitmq-c/../rabbitmq-codegen
pyt

hon ./codegen.py header
/home/vincentcheong/rabbit/windows_rabbitmq-c/../rabbitm

q-codegen/amqp-rabbitmq-0.9.1.json amqp_framing.h

PYTHONPATH=/home/vincentcheong/rabbit/windows_rabbitmq-c/../rabbitmq-codegen
pyt

hon ./codegen.py body
/home/vincentcheong/rabbit/windows_rabbitmq-c/../rabbitmq-

codegen/amqp-rabbitmq-0.9.1.json amqp_framing.c

make all-am

make[3]: Entering directory
`/home/vincentcheong/rabbit/windows_rabbitmq-c/libra

bbitmq'

source='amqp_mem.c' object='amqp_mem.lo' libtool=yes \

DEPDIR=.deps depmode=none /bin/sh ../depcomp \

/bin/sh ../libtool --tag=CC --mode=compile cl.exe -DHAVE_CONFIG_H -I.

-I.. -I./windows -DBUILDING_LIBRABBITMQ -I../msinttypes -nologo -c -o amqp_m

em.lo amqp_mem.c

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_mem.c -DDLL_EXPORT -DPIC

amqp_mem.c

libtool: compile: mv -f "amqp_mem.obj" ".libs/amqp_mem.obj"

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_mem.c >/dev/null 2>&1

source='amqp_table.c' object='amqp_table.lo' libtool=yes \

DEPDIR=.deps depmode=none /bin/sh ../depcomp \

/bin/sh ../libtool --tag=CC --mode=compile cl.exe -DHAVE_CONFIG_H -I.

-I.. -I./windows -DBUILDING_LIBRABBITMQ -I../msinttypes -nologo -c -o amqp_t

able.lo amqp_table.c

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_table.c -DDLL_EXPORT -DPIC

amqp_table.c

libtool: compile: mv -f "amqp_table.obj" ".libs/amqp_table.obj"

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_table.c >/dev/null 2>&1

source='amqp_connection.c' object='amqp_connection.lo' libtool=yes \

DEPDIR=.deps depmode=none /bin/sh ../depcomp \

/bin/sh ../libtool --tag=CC --mode=compile cl.exe -DHAVE_CONFIG_H -I.

-I.. -I./windows -DBUILDING_LIBRABBITMQ -I../msinttypes -nologo -c -o amqp_c

onnection.lo amqp_connection.c

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_connection.c -DDLL_EXPORT -DPIC

amqp_connection.c

libtool: compile: mv -f "amqp_connection.obj" ".libs/amqp_connection.obj"

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_connection.c >/dev/null 2>&1

source='amqp_socket.c' object='amqp_socket.lo' libtool=yes \

DEPDIR=.deps depmode=none /bin/sh ../depcomp \

/bin/sh ../libtool --tag=CC --mode=compile cl.exe -DHAVE_CONFIG_H -I.

-I.. -I./windows -DBUILDING_LIBRABBITMQ -I../msinttypes -nologo -c -o amqp_s

ocket.lo amqp_socket.c

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_socket.c -DDLL_EXPORT -DPIC

amqp_socket.c

libtool: compile: mv -f "amqp_socket.obj" ".libs/amqp_socket.obj"

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_socket.c >/dev/null 2>&1

source='amqp_api.c' object='amqp_api.lo' libtool=yes \

DEPDIR=.deps depmode=none /bin/sh ../depcomp \

/bin/sh ../libtool --tag=CC --mode=compile cl.exe -DHAVE_CONFIG_H -I.

-I.. -I./windows -DBUILDING_LIBRABBITMQ -I../msinttypes -nologo -c -o amqp_a

pi.lo amqp_api.c

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_api.c -DDLL_EXPORT -DPIC

amqp_api.c

libtool: compile: mv -f "amqp_api.obj" ".libs/amqp_api.obj"

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_api.c >/dev/null 2>&1

source='windows/socket.c' object='socket.lo' libtool=yes \

DEPDIR=.deps depmode=none /bin/sh ../depcomp \

/bin/sh ../libtool --tag=CC --mode=compile cl.exe -DHAVE_CONFIG_H -I.

-I.. -I./windows -DBUILDING_LIBRABBITMQ -I../msinttypes -nologo -c -o socke

t.lo `test -f 'windows/socket.c' || echo './'`windows/socket.c

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c windows/socket.c -DDLL_EXPORT -DPIC

socket.c

libtool: compile: mv -f "socket.obj" ".libs/socket.obj"

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c windows/socket.c >/dev/null 2>&1

source='amqp_framing.c' object='amqp_framing.lo' libtool=yes \

DEPDIR=.deps depmode=none /bin/sh ../depcomp \

/bin/sh ../libtool --tag=CC --mode=compile cl.exe -DHAVE_CONFIG_H -I.

-I.. -I./windows -DBUILDING_LIBRABBITMQ -I../msinttypes -nologo -c -o amqp_f

raming.lo amqp_framing.c

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_framing.c -DDLL_EXPORT -DPIC

amqp_framing.c

libtool: compile: mv -f "amqp_framing.obj" ".libs/amqp_framing.obj"

libtool: compile: cl.exe -DHAVE_CONFIG_H -I. -I.. -I./windows
-DBUILDING_LIBRAB

BITMQ -I../msinttypes -nologo -c amqp_framing.c >/dev/null 2>&1

/bin/sh ../libtool --tag=CC --mode=link cl.exe -I./windows
-DBUILDING_LIBRABBI

TMQ -I../msinttypes -nologo -no-undefined -o librabbitmq.la -rpath
/usr/local/

lib amqp_mem.lo amqp_table.lo amqp_connection.lo amqp_socket.lo amqp_api.lo
sock

et.lo amqp_framing.lo ws2_32.lib

*** Warning: Linking the shared library librabbitmq.la against the

*** static library ws2_32.lib is not portable!

libtool: link: /bin/nm -B .libs/amqp_mem.obj .libs/amqp_table.obj
.libs/amqp_co

nnection.obj .libs/amqp_socket.obj .libs/amqp_api.obj .libs/socket.obj
.libs/amq

p_framing.obj | sed -n -e 's/^.*[ ]\([ABCDGIRSTW][ABCDGIRSTW]*\)[ ][ ]*_\

([_A-Za-z][_A-Za-z0-9]*\)\{0,1\}$/\1 _\2 \2/p' | /bin/sed -e '/^[BCDGRS][
]/s/.*

[ ]\([^ ]*\)/\1,DATA/' | /bin/sed -e '/^[AITW][ ]/s/.*[ ]//' | sort | uniq >
.li

bs/rabbitmq.exp

libtool: link: if test "x`/bin/sed 1q .libs/rabbitmq.exp`" = xEXPORTS; then
sed

-n -e s/\\\(.*\\\)/-link\ -EXPORT:\\\1/ -e 1\!p < .libs/rabbitmq.exp >
.libs/rab

bitmq-0.dll.exp; else sed -e s/\\\(.*\\\)/-link\ -EXPORT:\\\1/ <
.libs/rabbitmq.

exp > .libs/rabbitmq-0.dll.exp; fi

libtool: link: cl.exe -o .libs/rabbitmq-0.dll .libs/amqp_mem.obj
.libs/amqp_ta

ble.obj .libs/amqp_connection.obj .libs/amqp_socket.obj .libs/amqp_api.obj
.libs

/socket.obj .libs/amqp_framing.obj ws2_32.lib @.libs/rabbitmq-0.dll.exp -Wl

,-DLL

Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 14.00.50727.762 for
80x86

Copyright (C) Microsoft Corporation. All rights reserved.

cl : Command line warning D9035 : option 'o' has been deprecated and will be
rem

oved in a future release

cl -link -EXPORT:amqp_abort

-link -EXPORT:amqp_basic_ack

-link -EXPORT:amqp_basic_consume

-link -EXPORT:amqp_basic_get

-link -EXPORT:amqp_basic_publish

-link -EXPORT:amqp_bytes_free

-link -EXPORT:amqp_bytes_malloc

-link -EXPORT:amqp_bytes_malloc_dup

-link -EXPORT:amqp_channel_close

-link -EXPORT:amqp_channel_open

-link -EXPORT:amqp_connection_close

-link -EXPORT:amqp_constant_is_hard_error

-link -EXPORT:amqp_constant_name

-link -EXPORT:amqp_cstring_bytes

-link -EXPORT:amqp_data_in_buffer

-link -EXPORT:amqp_decode_method

-link -EXPORT:amqp_decode_properties

-link -EXPORT:amqp_decode_table

-link -EXPORT:amqp_destroy_connection

-link -EXPORT:amqp_empty_array,DATA

-link -EXPORT:amqp_empty_bytes,DATA

-link -EXPORT:amqp_empty_table,DATA

-link -EXPORT:amqp_encode_method

-link -EXPORT:amqp_encode_properties

-link -EXPORT:amqp_encode_table

-link -EXPORT:amqp_error_string

-link -EXPORT:amqp_exchange_declare

-link -EXPORT:amqp_frames_enqueued

-link -EXPORT:amqp_get_channel_max

-link -EXPORT:amqp_get_rpc_reply

-link -EXPORT:amqp_get_sockfd

-link -EXPORT:amqp_handle_input

-link -EXPORT:amqp_login

-link -EXPORT:amqp_maybe_release_buffers

-link -EXPORT:amqp_method_has_content

-link -EXPORT:amqp_method_name

-link -EXPORT:amqp_new_connection

-link -EXPORT:amqp_open_socket

-link -EXPORT:amqp_os_error_string

-link -EXPORT:amqp_pool_alloc

-link -EXPORT:amqp_pool_alloc_bytes

-link -EXPORT:amqp_queue_bind

-link -EXPORT:amqp_queue_declare

-link -EXPORT:amqp_queue_delete

-link -EXPORT:amqp_queue_purge

-link -EXPORT:amqp_queue_unbind

-link -EXPORT:amqp_release_buffers

-link -EXPORT:amqp_release_buffers_ok

-link -EXPORT:amqp_send_frame

-link -EXPORT:amqp_send_header

-link -EXPORT:amqp_send_method

-link -EXPORT:amqp_set_sockfd

-link -EXPORT:amqp_simple_rpc

-link -EXPORT:amqp_simple_wait_frame

-link -EXPORT:amqp_simple_wait_method

-link -EXPORT:amqp_socket_init

-link -EXPORT:amqp_table_entry_cmp

-link -EXPORT:amqp_tune_connection

-link -EXPORT:amqp_tx_commit

-link -EXPORT:amqp_tx_rollback

-link -EXPORT:amqp_tx_select

-link -EXPORT:amqp_version

-link -EXPORT:empty_amqp_pool

-link -EXPORT:init_amqp_pool

-link -EXPORT:recycle_amqp_pool

cl : Command line error D8021 : invalid numeric argument '/Wl,-DLL'

make[3]: *** [librabbitmq.la] Error 2

make[3]: Leaving directory
`/home/vincentcheong/rabbit/windows_rabbitmq-c/librab

bitmq'

make[2]: *** [all] Error 2

make[2]: Leaving directory
`/home/vincentcheong/rabbit/windows_rabbitmq-c/librab

bitmq'

make[1]: *** [all-recursive] Error 1

make[1]: Leaving directory `/home/vincentcheong/rabbit/windows_rabbitmq-c'

make: *** [all] Error 2


On Thu, Nov 11, 2010 at 4:33 PM, David Wragg <david at rabbitmq.com> wrote:

> Hi Vincent,
>
> Vincent Cheong <vincentcheongst at gmail.com> writes:
> > I believe the individual .c files were compiled. The respective obj file
> > were found in librabbitmq/.libs.
>
> Yes, but the compiler commands that produced those obj files were not
> present in the build output you sent.  I'd like to see the output you
> get when building from an absolutely clean state, to help me understand
> the cause of the error.
>
> > However, I did not get the source files via
> > a 'hg clone' but downloaded them from
> > http://hg.rabbitmq.com/rabbitmq-c/file/f09918f7aa73.
>
> Downloading that revision via one of the archive links (such as the
> 'zip' link) is fine too.  But make sure you delete your existing
> rabbitmq-c directory first - don't just unpack over it - so that you
> build from a clean state.
>
> > I have multiple
> > versions of visual studio installed on my machine but i'm forcing it to
> use
> > my visual studio 2005 compiler. I did so by removing the 10.0 and 9.0 for
> > the vsvers and v7.0A and v6.0A from the build-ms.sh file. Is this the
> > correct way to it or have I introduced an error by doing so?
>
> This should be fine.  I expect that if you do not make this change, and
> so build with the compiler from VS 10.0, you will get the same error.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101111/61f4591a/attachment-0001.htm>

From icambron at gmail.com  Thu Nov 11 09:04:59 2010
From: icambron at gmail.com (Isaac Cambron)
Date: Thu, 11 Nov 2010 04:04:59 -0500
Subject: [rabbitmq-discuss] subscriptions after .NET upgrade
Message-ID: <AANLkTi=B9LH0s=dfMDG3TCVB64bniG37mL7xDXrMZy8T@mail.gmail.com>

I have an older application that I'm trying to get onto the latest and
greatest version of Rabbit and the .NET client. I'm having a bit of a
problem getting it to work the same way across the API changes.

In my old app, I had a simple piece that broadcast to all of my consumers
who happen to be listening. Let's say they print the message's content to
the console when they get it. It was pretty simple. Each consumer just
creates a subscription:

Subscription sub = new Subscription(ch, someExchange, ExchangeType.Topic,
someTopic);

and listened to it. The broadcaster just did this:

ch.BasicPublish(someExchange, someTopic, null, someBytes);

Now, that signature for Subscription no longer exists. I've tried stuff like
this (which matches the old implementation from Subscription.cs):

ch.ExchangeDeclare(EXCHANGE, ExchangeType.Topic);
ch.QueueDeclare(STATUS_QUEUE);
ch.QueueBind(STATUS_QUEUE, EXCHANGE, TOPIC, false, null);
Subscription sub = new Subscription(ch, STATUS_QUEUE, true);

But the behavior I'm seeing is totally different:

1. Only one of the consumers gets the message and prints something. It's
round-robin instead of broadcast.
2. When a new consumer is created and subscribes, it gets all of the
messages I've ever put in the queue and prints them to the console.

I'm able to fix #2 by changing noAck to true, but not #1, and I suspect I
have something very wrong. Any ideas?

Thanks,
Isaac
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101111/63845768/attachment.htm>

From emile at rabbitmq.com  Thu Nov 11 09:30:44 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 11 Nov 2010 09:30:44 +0000
Subject: [rabbitmq-discuss] subscriptions after .NET upgrade
In-Reply-To: <AANLkTi=B9LH0s=dfMDG3TCVB64bniG37mL7xDXrMZy8T@mail.gmail.com>
References: <AANLkTi=B9LH0s=dfMDG3TCVB64bniG37mL7xDXrMZy8T@mail.gmail.com>
Message-ID: <4CDBB7C4.8000003@rabbitmq.com>

Hi Isaac,

On 11/11/10 09:04, Isaac Cambron wrote:
> I have an older application that I'm trying to get onto the latest and
> greatest version of Rabbit and the .NET client. I'm having a bit of a
> problem getting it to work the same way across the API changes.
> 
> In my old app, I had a simple piece that broadcast to all of my
> consumers who happen to be listening. Let's say they print the message's
> content to the console when they get it. It was pretty simple. Each
> consumer just creates a subscription:
> 
> Subscription sub = new Subscription(ch, someExchange,
> ExchangeType.Topic, someTopic);
> 
> and listened to it. The broadcaster just did this:
> 
> ch.BasicPublish(someExchange, someTopic, null, someBytes);
> 
> Now, that signature for Subscription no longer exists. I've tried stuff
> like this (which matches the old implementation from Subscription.cs):
> 
> ch.ExchangeDeclare(EXCHANGE, ExchangeType.Topic);
> ch.QueueDeclare(STATUS_QUEUE);
> ch.QueueBind(STATUS_QUEUE, EXCHANGE, TOPIC, false, null);
> Subscription sub = new Subscription(ch, STATUS_QUEUE, true);
> 
> But the behavior I'm seeing is totally different:
> 
> 1. Only one of the consumers gets the message and prints something. It's
> round-robin instead of broadcast.
> 2. When a new consumer is created and subscribes, it gets all of the
> messages I've ever put in the queue and prints them to the console.
> 
> I'm able to fix #2 by changing noAck to true, but not #1, and I suspect
> I have something very wrong. Any ideas?

Subscriptions have indeed been simplified for release version 2.0.0.
Preceding the use of Subscription with declarations and the binding, as
you have done, is correct.

If only one consumer gets messages then try setting the channel prefetch
to a small number (e.g. 1) by calling ch.BasicQos() before creating the
subscription.

Regards


Emile

From david at rabbitmq.com  Thu Nov 11 09:38:33 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 11 Nov 2010 09:38:33 +0000
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <AANLkTi=5pONoOVKtVxT6tap-g6RgQryPUapE+BkSzKeS@mail.gmail.com>
	(Vincent Cheong's message of "Thu, 11 Nov 2010 16:54:31 +0800")
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	<yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
	<AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>
	<yrv4c1v6sp8e2.fsf@dwragg.eng.vmware.com>
	<AANLkTi=5pONoOVKtVxT6tap-g6RgQryPUapE+BkSzKeS@mail.gmail.com>
Message-ID: <yrv4cwroknqsm.fsf@dwragg.eng.vmware.com>

Hi Vincent,

Vincent Cheong <vincentcheongst at gmail.com> writes:
> I removed the old directory did a new build. The same errors is still
> there.

Thanks.

The output suggest that you have a different version of libtool from the
one installed by the rabbitmq-c/etc/install-mingw.sh script.  Did you
use that script to install mingw, or did you do it some other way?  It's
quite possible that the Windows build depends upon the specific versions
of packages installed by that script - I haven't tested it with anything
else.

If you did use that script, is it possible that you have another version
of mingw or cygwin installed, and present in your PATH?  If so, please
set PATH before you start bash, so that only the version of mingw
installed by the script is mentioned.

Finally, if none of the above seems to apply, please do the following
two commands at the bash prompt, and send the output:

which libtool
libtool --version

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From rob at rabbitmq.com  Thu Nov 11 09:56:01 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 11 Nov 2010 09:56:01 +0000
Subject: [rabbitmq-discuss] how to set the basic message properties for
	message in rabbitmq?
In-Reply-To: <30187552.post@talk.nabble.com>
References: <30187552.post@talk.nabble.com>
Message-ID: <960F53B0-AE6C-4424-BF25-321972F421E1@rabbitmq.com>

To set the BasicProperties, you simply create an instance of AMQP.BasicProperties and then pass it into the basicPublish method:

AMQP.BasicProperties props = new AMQP.BasicProperties();
props.setDeliveryMode(2);
channel.basicPublish(exchange, routingKey, props, message.getBytes());

Hope this helps,

Rob

On 11 Nov 2010, at 06:50, sam_mis wrote:

> 
> Hi all
> 
> i am using Rabbitmq Java client API.i want to set the Basic Properties of
> message and also get the message Id of the message.if possible please
> provide some code to understand the things.
> 
> Thanks
> 
> -- 
> View this message in context: http://old.nabble.com/how-to-set-the-basic-message-properties-for-message-in-rabbitmq--tp30187552p30187552.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From vincentcheongst at gmail.com  Thu Nov 11 10:10:19 2010
From: vincentcheongst at gmail.com (Vincent Cheong)
Date: Thu, 11 Nov 2010 18:10:19 +0800
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <yrv4cwroknqsm.fsf@dwragg.eng.vmware.com>
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	<yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
	<AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>
	<yrv4c1v6sp8e2.fsf@dwragg.eng.vmware.com>
	<AANLkTi=5pONoOVKtVxT6tap-g6RgQryPUapE+BkSzKeS@mail.gmail.com>
	<yrv4cwroknqsm.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=4bsVw3fbTk-2Xog6BZhkGbFk6cUwyzvBbcE87@mail.gmail.com>

Hi David,

I did not get install mingw using the install script. It is a pretty up to
date version (libs and compilers) that I have been using all along. I've
checked my PATH there's only one mingw/bin.

The libtool printouts are as follow:

Vincent Chong at VincentCheong ~
$ which libtool
/mingw/bin/libtool

Vincent Chong at VincentCheong ~
$ libtool --version
libtool (GNU libtool 1.3260 2010-09-02) 2.2.11a
Written by Gordon Matzigkeit <gord at gnu.ai.mit.edu>, 1996
Copyright (C) 2010 Free Software Foundation, Inc.
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

I've been looking at error statement again.
cl : Command line error D8021 : invalid numeric argument '/Wl,-DLL'
the cl command seems to be expecting a numeral after /W. Could the cl option
be /W1 or /WL instead or /Wl?

Thanks for taking the time to help

Cheers,
Vincent

On Thu, Nov 11, 2010 at 5:38 PM, David Wragg <david at rabbitmq.com> wrote:

> Hi Vincent,
>
> Vincent Cheong <vincentcheongst at gmail.com> writes:
> > I removed the old directory did a new build. The same errors is still
> > there.
>
> Thanks.
>
> The output suggest that you have a different version of libtool from the
> one installed by the rabbitmq-c/etc/install-mingw.sh script.  Did you
> use that script to install mingw, or did you do it some other way?  It's
> quite possible that the Windows build depends upon the specific versions
> of packages installed by that script - I haven't tested it with anything
> else.
>
> If you did use that script, is it possible that you have another version
> of mingw or cygwin installed, and present in your PATH?  If so, please
> set PATH before you start bash, so that only the version of mingw
> installed by the script is mentioned.
>
> Finally, if none of the above seems to apply, please do the following
> two commands at the bash prompt, and send the output:
>
> which libtool
> libtool --version
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101111/ea9f1edc/attachment.htm>

From rob at rabbitmq.com  Thu Nov 11 10:12:02 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 11 Nov 2010 10:12:02 +0000
Subject: [rabbitmq-discuss] Java Client :how can i uniquely identify a
	message?
In-Reply-To: <30187626.post@talk.nabble.com>
References: <30187626.post@talk.nabble.com>
Message-ID: <99E139B9-A952-493F-92C4-A2B60F115111@rabbitmq.com>


On 11 Nov 2010, at 07:08, sam_mis wrote:

> 
> I have Created a RabbitMQ Producer and a RabbitMQ Consumer....
> 
> suppose my producer produces 10 messages. How can i get a particular message
> from those 10 messages.

You can't pick a particular message to retrieve from the queue, you must consume messages in the order they were added to the queue.

> 
> I want to know how can i uniquely identify a message and read that or
> consume that message.

You can use the message ID property (BasicProperties.{set, get}MessageId) to add your own identifier to messages as you send them.

What do you want to do with the messages that you don't choose to process? Is there a way you could route messages more effectively on the send side?

> -- 
> View this message in context: http://old.nabble.com/Java-Client-%3Ahow-can-i-uniquely-identify-a-message--tp30187626p30187626.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From akalend at mail.ru  Thu Nov 11 10:21:05 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Thu, 11 Nov 2010 13:21:05 +0300
Subject: [rabbitmq-discuss] =?windows-1251?q?Fwd=3A__about_RabbitMQ_+_HTTP?=
	=?windows-1251?q?_Server_configuration?=
Message-ID: <E1PGUHB-0007lf-00.akalend-mail-ru@f56.mail.ru>

the REST wrapper over HTTP for RabbitMQ

http://github.com/akalend/amqp-rest


Alexandre

Thu, 11 Nov 2010 10:16:20 +0200 ?????? ?? Madalin Popa <madalin at sellerengine.com>:

> Hi,
> 
> I have a RabbitMQ server with 2 channels (tx, rx), consuming requests
> (rx channel) from a HTTP server and passing them to a pool of
> slaves...The slaves, when they finish their work, pass the result back
> on RabbitMQ tx channel, from where the response needs to be mapped back
> to initial HTTP request. Are there any natural/out of the box solutions
> for this final part of mapping the response received from tx queue back
> to HTTP requester?
> 
> Thanks a lot for your help.
> 
> Warmest Regards,
> Dragos POPA
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From david at rabbitmq.com  Thu Nov 11 10:51:13 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 11 Nov 2010 10:51:13 +0000
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <AANLkTi=4bsVw3fbTk-2Xog6BZhkGbFk6cUwyzvBbcE87@mail.gmail.com>
	(Vincent Cheong's message of "Thu, 11 Nov 2010 18:10:19 +0800")
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	<yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
	<AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>
	<yrv4c1v6sp8e2.fsf@dwragg.eng.vmware.com>
	<AANLkTi=5pONoOVKtVxT6tap-g6RgQryPUapE+BkSzKeS@mail.gmail.com>
	<yrv4cwroknqsm.fsf@dwragg.eng.vmware.com>
	<AANLkTi=4bsVw3fbTk-2Xog6BZhkGbFk6cUwyzvBbcE87@mail.gmail.com>
Message-ID: <yrv4c7hgkf80u.fsf@dwragg.eng.vmware.com>

Vincent Cheong <vincentcheongst at gmail.com> writes:
> I did not get install mingw using the install script. It is a pretty up to
> date version (libs and compilers) that I have been using all along. I've
> checked my PATH there's only one mingw/bin.

Ah, I see.  I'm afraid that the easiest way forward for you will be to
do a second temporary install of mingw using the script - you can delete
it as soon as the build has worked :-)

> [...]
>
> I've been looking at error statement again.
> cl : Command line error D8021 : invalid numeric argument '/Wl,-DLL'
> the cl command seems to be expecting a numeral after /W. Could the cl option
> be /W1 or /WL instead or /Wl?

-Wl,-DLL is a gcc option, and cl.exe generally has a completely
different option syntax.  Why libtool is passing that option to cl.exe,
I don't know.  libtool's support for the MS toolchain seems to be quite
weak, and I was only able to get 2.2.7a to work by patching its output.
I wouldn't be surprised if later versions break that support completely.
So at the moment, you really need 2.2.7a.

I don't know if there will be such strict dependencies on the other
required mingw/msys packages.  You might be able to make it work just by
changing your version of libtool, but I'm not sure.

Thanks for bringing this to my attention, I will clarify the build
instructions.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From matthew at rabbitmq.com  Thu Nov 11 11:00:02 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 11 Nov 2010 11:00:02 +0000
Subject: [rabbitmq-discuss] Java Client :how can i uniquely identify a
 message?
In-Reply-To: <30187702.post@talk.nabble.com>
References: <30187702.post@talk.nabble.com>
Message-ID: <20101111110001.GE4096@wellquite.org>

On Wed, Nov 10, 2010 at 11:25:35PM -0800, sam_mis wrote:
> I want to know how can i uniquely identify a message and read that or
> consume that message.

Queues are queues. FIFO queues. Thus you cannot consume any message that
is not at the head of the queue.

Matthew

From selfsorted at gmail.com  Thu Nov 11 11:06:12 2010
From: selfsorted at gmail.com (ssorted)
Date: Thu, 11 Nov 2010 03:06:12 -0800 (PST)
Subject: [rabbitmq-discuss] Only 20 req-resps per second
In-Reply-To: <4CDBAA88.1030804@rabbitmq.com>
References: <f7dd867e-7ab2-46d7-93e3-9a581330c2f6@c39g2000yqi.googlegroups.com>
	<4CDBAA88.1030804@rabbitmq.com>
Message-ID: <a1652c97-fda6-4a41-ae03-cad6900e802c@26g2000yqv.googlegroups.com>

> ?> Performance is very low: the client.py script needs 4 seconds to
> ?> finish which means only 25 requests+responses per second.
>
> That's not what I see. With everything running on localhost I see 100
> iterations in ~240ms on my laptop. Commenting out the print statements
> and increasing to 1000 iterations (to amortise Python's startup costs) I
> get 1000 in ~1200ms - or about 1.2ms each.

Hmm, I'm still getting this 20x slower than you. Log from "strace -r":

     0.000194 sendto(3, "\1\0\1\0\0\0\r\0<\0P\0\0\0\0\0\0\0\25\0\316",
21, 0, NULL, 0) = 21
     0.000371 sendto(3, "\1\0\1\0\0\0\34\0<\0(\0\0\namq.direct
\trrexamp"..., 36, 0, NULL, 0) = 36
     0.000196 sendto(3, "\2\0\1\0\0\0000\0<\0\0\0\0\0\0\0\0\0\2\22\0\1
amq.gen-n"..., 56, 0, NULL, 0) = 56
     0.000133 sendto(3, "\3\0\1\0\0\0\00221\316", 10, 0, NULL, 0) = 10
     0.000133 recvfrom(3, "\1\0\1\0\0\0[\0<\0<!amq.ctag-
jFAKf1Ix2Wc"..., 65536, 0, NULL, NULL) = 135
     0.038957 write(1, "Got response 21XXX\n", 19) = 19
     0.000196 sendto(3, "\1\0\1\0\0\0\r\0<\0P\0\0\0\0\0\0\0\26\0\316",
21, 0, NULL, 0) = 21
     0.000339 sendto(3, "\1\0\1\0\0\0\34\0<\0(\0\0\namq.direct
\trrexamp"..., 36, 0, NULL, 0) = 36
     0.000196 sendto(3, "\2\0\1\0\0\0000\0<\0\0\0\0\0\0\0\0\0\2\22\0\1
amq.gen-n"..., 56, 0, NULL, 0) = 56
     0.000133 sendto(3, "\3\0\1\0\0\0\00222\316", 10, 0, NULL, 0) = 10
     0.000134 recvfrom(3, "\1\0\1\0\0\0[\0<\0<!amq.ctag-
jFAKf1Ix2Wc"..., 65536, 0, NULL, NULL) = 135
     0.038953 write(1, "Got response 22XXX\n", 19) = 19
     0.000184 sendto(3, "\1\0\1\0\0\0\r\0<\0P\0\0\0\0\0\0\0\27\0\316",
21, 0, NULL, 0) = 21
     0.000336 sendto(3, "\1\0\1\0\0\0\34\0<\0(\0\0\namq.direct
\trrexamp"..., 36, 0, NULL, 0) = 36
     0.000198 sendto(3, "\2\0\1\0\0\0000\0<\0\0\0\0\0\0\0\0\0\2\22\0\1
amq.gen-n"..., 56, 0, NULL, 0) = 56
     0.000105 sendto(3, "\3\0\1\0\0\0\00223\316", 10, 0, NULL, 0) = 10
     0.000108 recvfrom(3, "\1\0\1\0\0\0[\0<\0<!amq.ctag-
jFAKf1Ix2Wc"..., 65536, 0, NULL, NULL) = 135
     0.039150 write(1, "Got response 23XXX\n", 19) = 19

So between receiving from RabbitMQ and printing reponse lasts 0.04
second, but no my code is executed there.
Log from profiling client.py: http://dpaste.com/hold/273869/ - almost
all is spent in socket.recv.

I'm using Ubuntu 10.10 64bit, I tried Python 2.6 and Python 2.7,
RabbitMQ 1.8.0 from distribution and 2.1.1 downloaded from
rabbitmq.org, EXT4 and XFS filesystem for Mnesia database.

How to debug it further?

> Pipelining would let things go faster still, but I understand why you'd not want that.

I'm simulating situation when web application makes one blocking RPC
call (using RabbitMQ) per request.

> That's a good question. What is the latency between client.py / Rabbit /
> server.py? But it can't all be latency, even your pipelined case seems
> very slow.

Everything is running on 127.0.0.1.


Regards,
Artur

From david at rabbitmq.com  Thu Nov 11 11:21:27 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 11 Nov 2010 11:21:27 +0000
Subject: [rabbitmq-discuss] Only 20 req-resps per second
In-Reply-To: <a1652c97-fda6-4a41-ae03-cad6900e802c@26g2000yqv.googlegroups.com>
	(ssorted's message of "Thu, 11 Nov 2010 03:06:12 -0800 (PST)")
References: <f7dd867e-7ab2-46d7-93e3-9a581330c2f6@c39g2000yqi.googlegroups.com>
	<4CDBAA88.1030804@rabbitmq.com>
	<a1652c97-fda6-4a41-ae03-cad6900e802c@26g2000yqv.googlegroups.com>
Message-ID: <yrv4cy690ds20.fsf@dwragg.eng.vmware.com>

ssorted <selfsorted at gmail.com> writes:
> How to debug it further?

In my experience, surprising slowness in applications using TCP sockets
is often due to the Nagle algorithm.  This might not be the cause in
your case, but it's definitely something to eliminate.  I see that
neither pika or py-amqplib set TCP_NODELAY.

So you might want to try adding something like

    sock.setsockopt(SOL_TCP, TCP_NODELAY, 1)

in the appropriate place in one of the libraries, and see if it improves
things for you.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From simon at rabbitmq.com  Thu Nov 11 13:12:52 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Nov 2010 13:12:52 +0000
Subject: [rabbitmq-discuss] Fw:  Exception on TCP connection
In-Reply-To: <463355.55600.qm@web111015.mail.gq1.yahoo.com>
References: <418228.62636.qm@web111008.mail.gq1.yahoo.com>	<4CD3E7E9.5090500@rabbitmq.com>
	<463355.55600.qm@web111015.mail.gq1.yahoo.com>
Message-ID: <4CDBEBD4.6010601@rabbitmq.com>

Hi Dave.

Yes, the Java client should shut down after two missed heartbeats. I've 
just tested this with 2.1.1 and 1.8.1 clients against a 2.1.1 server and 
it worked for me; although there is a remark in the 2.1.1 release notes:

  - move heartbeat sender into a separate thread to ensure that missing
    heartbeats are detected promptly in all cases

Cheers, Simon

On 05/11/10 16:58, Dave Greggory wrote:
> Sending to the list...
>
>
>
> ----- Forwarded Message ----
> From: Dave Greggory<davegreggory at yahoo.com>
> To: Michael Bridgen<mikeb at rabbitmq.com>
> Sent: Fri, November 5, 2010 12:57:30 PM
> Subject: Re: [rabbitmq-discuss] Exception on TCP connection
>
> No the connection does not get closed and the shutdown event never fires.
>
> We enabled AMQP heartbeats (@ 30 seconds), just for the purpose of early
> detection of connection trouble.
>
> See http://old.nabble.com/Shutdown-Listener-on-Java-Client-API-td29699374.html
>
> So is the normal behavior for connection to shutdown and the shutdown event to
> fire when 2 heartbeats are missed? What could be preventing that?
>
>
>
>
> ----- Original Message ----
> From: Michael Bridgen<mikeb at rabbitmq.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Fri, November 5, 2010 7:18:01 AM
> Subject: Re: [rabbitmq-discuss] Exception on TCP connection
>
> Hi Dave,
>
>> Every once in a while we notice this error in our RabbitMQ logs. Any idea what
>> this means?
>>
>>    =ERROR REPORT==== 2-Nov-2010::19:37:31 ===
>> exception on TCP connection<0.10945.3>   from 192.168.210.9:14189
>> {timeout,running}
>
> It indicates missed heartbeats.
>
> Have a look here:
> http://old.nabble.com/Unexplained-shutdown-of-RabbitMQ-td28558360.html
>
> and here:
> http://forum.trapexit.org/mailinglists/viewtopic.php?t=16662&sid=9c5323df7c6a6b8cf28ffc9ba6c34fd6
>
>
>
>> We run 2 RabbitMQ 2.0 nodes unclustered, sitting behind a load balancer.  Only
>
>> 1
>> RabbitMQ node active at a time in the load balancer. Second one  is there
>> mainly
>> for failing over to.
>>
>>
>> When this happens the shutdown listener on the Java Client API does not fire
> in
>> spite of having AMQP Heartbeats enabled.
>
> Does the connection actually get closed though?  If I recall correctly,
> connections will only be forcibly closed if a client misses a number of
> heartbeats in a row (two I think).
>
>
> Michael
>
>> There are no other significant entries
>> in the logs. Just the standard "starting TCP connection",  "closing TCP
>> connection", "accepted TCP connection" and "connection_closed_abruptly"
> entries
>> (Connection closed abruptly is just the load balancer checking whether Rabbit
>> node is alive).
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Thu Nov 11 14:19:44 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 11 Nov 2010 14:19:44 +0000
Subject: [rabbitmq-discuss] about RabbitMQ + HTTP Server configuration
In-Reply-To: <1289463380.2135.7.camel@madalin-laptop>
References: <1289463380.2135.7.camel@madalin-laptop>
Message-ID: <AANLkTin8q_D9mGL76gVaTf2oS0g+xP3YcRHwJNFphqPO@mail.gmail.com>

On Thu, Nov 11, 2010 at 08:16, Madalin Popa <madalin at sellerengine.com> wrote:
> I have a RabbitMQ server with 2 channels (tx, rx), consuming requests
> (rx channel) from a HTTP server and passing them to a pool of
> slaves...The slaves, when they finish their work, pass the result back
> on RabbitMQ tx channel, from where the response needs to be mapped back
> to initial HTTP request. Are there any natural/out of the box solutions
> for this final part of mapping the response received from tx queue back
> to HTTP requester?

What we usually do to achieve rpc:
 1. On every Requester we create an anonymous queue.
     Let's say that this queue is randomly named 'req-1'
 2. Requester publishes a message to the queue shared by the workers.
    This message contains usual stuff, like the description of the
    work to do. But except from that, it should have two headers
    set: 'reply_to' -> set to 'req-1' and 'correlation_id' -> set to a
random value.
3 . The worker picks up the task, does what it should do,
    and after it's done, it's ready to respond.
    The response should go to the queue named by 'reply_to' header
    in the request. Don't forget also to copy over the 'correlation_id' header.
4. Requester looks at his queue, sees a reply.
    Based on 'correlation_id' it's able to match it to the request.
5. Tadam. Job done.

Using this schema you:
 - need one queue per requester
 - don't have to create a single queue per every request
 - you're free to trash responses that come with invalid 'correlation_id' tag.

Cheers,
  Marek

From tranzenziuzex at gmail.com  Thu Nov 11 14:38:25 2010
From: tranzenziuzex at gmail.com (T-zex)
Date: Thu, 11 Nov 2010 14:38:25 +0000
Subject: [rabbitmq-discuss] multiple publishers to the same exchange
Message-ID: <AANLkTimUZdt9=qVF_fV2prYxNr-toEnQbht-UD-YrQze@mail.gmail.com>

Hi,

We are publishing messages to the same exchange from multiple threads
(8 of them), could this be the reason of message receiver slowdown?
Is RabbitMq able to handle multiple publishers to the same exchange?

Thanks

From matthew at rabbitmq.com  Thu Nov 11 14:50:16 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 11 Nov 2010 14:50:16 +0000
Subject: [rabbitmq-discuss] multiple publishers to the same exchange
In-Reply-To: <AANLkTimUZdt9=qVF_fV2prYxNr-toEnQbht-UD-YrQze@mail.gmail.com>
References: <AANLkTimUZdt9=qVF_fV2prYxNr-toEnQbht-UD-YrQze@mail.gmail.com>
Message-ID: <20101111145015.GB8054@wellquite.org>

On Thu, Nov 11, 2010 at 02:38:25PM +0000, T-zex wrote:
> We are publishing messages to the same exchange from multiple threads
> (8 of them), could this be the reason of message receiver slowdown?
> Is RabbitMq able to handle multiple publishers to the same exchange?

Yes. Each channel is a separate process within Rabbit, and it's the
channel that does the routing logic, before passing the message to any
destination queues. Thus all channels can route through the same
exchanges in parallel.

Matthew

From list.rabbit at calidris.co.uk  Thu Nov 11 15:03:31 2010
From: list.rabbit at calidris.co.uk (Tim Sawyer)
Date: Thu, 11 Nov 2010 15:03:31 -0000 (GMT)
Subject: [rabbitmq-discuss] as3-amqp connection failed
Message-ID: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>

I think I?m missing something somewhere.

I have a Flex client, deployed and running on a Windows 7 box.  It uses
as3-amqp to receive messages from a rabbitmq server.  Messages are created
from a Java back end, which is also running on the Windows 7 box.  The
rabbitmq server is deployed on fedora 14, installed from the repositories,
and is version 2.1.  I?m running a policy server on the fedora box on port
843 which returns the following crossdomain.xml.

<?xml version="1.0"?>
<!DOCTYPE cross-domain-policy SYSTEM "/xml/dtds/cross-domain-policy.dtd">
<cross-domain-policy>
  <site-control permitted-cross-domain-policies="master-only"/>
  <allow-access-from domain="*" to-ports="61613,5672" />
</cross-domain-policy>

The Flex part is failing to connect to the amqp server, with the following
error:

Error #2044: Unhandled connectionError:. text=Connection failed
	at org.amqp::Connection()
	at Dashboard/setupAmqpConnection()
	at flash.events::EventDispatcher/dispatchEventFunction()
	at flash.events::EventDispatcher/dispatchEvent()
	at
mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::dispatchRpcEvent()
	at
mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::resultHandler()
	at mx.rpc::Responder/result()
	at mx.rpc::AsyncRequest/acknowledge()
	at DirectHTTPMessageResponder/completeHandler()
	at flash.events::EventDispatcher/dispatchEventFunction()
	at flash.events::EventDispatcher/dispatchEvent()
	at flash.net::URLLoader/onComplete()

Without the policy server running, I get:

Error #2044: Unhandled securityError:. text=Error #2048: Security sandbox
violation: http://localhost:8224/Dashboard/Dashboard.swf cannot load data
from nightjar:5672.
	at org.amqp::Connection()
	at Dashboard/setupAmqpConnection()
	at flash.events::EventDispatcher/dispatchEventFunction()
	at flash.events::EventDispatcher/dispatchEvent()
	at
mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::dispatchRpcEvent()
	at
mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::resultHandler()
	at mx.rpc::Responder/result()
	at mx.rpc::AsyncRequest/acknowledge()
	at DirectHTTPMessageResponder/completeHandler()
	at flash.events::EventDispatcher/dispatchEventFunction()
	at flash.events::EventDispatcher/dispatchEvent()
	at flash.net::URLLoader/onComplete()

so it does appear to be getting past this check.

I can happily connect from a python script on the windows box, and see the
broadcast messages (my exchange is a fanout) that are being produced from
Java on the same (windows) machine.  These are routing to the fedora box
for rabbitmq, so the communication is fine, and the rabbitmq server is
running.  It just seems to be the Flash/Flex part having trouble.

This code used to work - I was running rabbitmq (I think it was version
1.7.2) on an old fedora box (9 I think), and the Java and Flex bits were
running on Windows XP.  Lots of changes in environment since then - are
any of this likely to have an effect?

Does anyone have any clues where to start looking?  Is anyone out there
using the as3-amqp client?

Thanks,

Tim.



From simon at rabbitmq.com  Thu Nov 11 15:10:11 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Nov 2010 15:10:11 +0000
Subject: [rabbitmq-discuss] as3-amqp connection failed
In-Reply-To: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>
References: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>
Message-ID: <4CDC0753.20009@rabbitmq.com>

On 11/11/10 15:03, Tim Sawyer wrote:
> Does anyone have any clues where to start looking?  Is anyone out there
> using the as3-amqp client?

Anything showing up in the RabbitMQ server logs? Can you see what's 
happening with Wireshark? (It only understands AMQP 0-9 so will fail to 
decode some frames, but should give you a better clue...)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From tranzenziuzex at gmail.com  Thu Nov 11 15:10:56 2010
From: tranzenziuzex at gmail.com (T-zex)
Date: Thu, 11 Nov 2010 15:10:56 +0000
Subject: [rabbitmq-discuss] multiple publishers to the same exchange
In-Reply-To: <20101111145015.GB8054@wellquite.org>
References: <AANLkTimUZdt9=qVF_fV2prYxNr-toEnQbht-UD-YrQze@mail.gmail.com>
	<20101111145015.GB8054@wellquite.org>
Message-ID: <AANLkTikg0hphS0PZN-Yn08Wx=uRsoEpRQkyJQSFCgogq@mail.gmail.com>

Does this mean that adding a subscriber (queue) will also degrade the
performance:

Say in case we have 1 publisher and 1 subscriber we have 10kHz send
and 10kHz receive throughput.
In case we have 2 publishers then they will be able to send only 5KHz
each?, will the receiver  still be 10kHz?
In case we have 1 10 kHz publisher and two queues, will these queues
be receiving 5kHz each?

Thanks

On Thu, Nov 11, 2010 at 2:50 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Thu, Nov 11, 2010 at 02:38:25PM +0000, T-zex wrote:
>> We are publishing messages to the same exchange from multiple threads
>> (8 of them), could this be the reason of message receiver slowdown?
>> Is RabbitMq able to handle multiple publishers to the same exchange?
>
> Yes. Each channel is a separate process within Rabbit, and it's the
> channel that does the routing logic, before passing the message to any
> destination queues. Thus all channels can route through the same
> exchanges in parallel.
>
> Matthew
>

From matthew at rabbitmq.com  Thu Nov 11 15:18:40 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 11 Nov 2010 15:18:40 +0000
Subject: [rabbitmq-discuss] multiple publishers to the same exchange
In-Reply-To: <AANLkTikg0hphS0PZN-Yn08Wx=uRsoEpRQkyJQSFCgogq@mail.gmail.com>
References: <AANLkTimUZdt9=qVF_fV2prYxNr-toEnQbht-UD-YrQze@mail.gmail.com>
	<20101111145015.GB8054@wellquite.org>
	<AANLkTikg0hphS0PZN-Yn08Wx=uRsoEpRQkyJQSFCgogq@mail.gmail.com>
Message-ID: <20101111151840.GC8054@wellquite.org>

On Thu, Nov 11, 2010 at 03:10:56PM +0000, T-zex wrote:
> Say in case we have 1 publisher and 1 subscriber we have 10kHz send
> and 10kHz receive throughput.
> In case we have 2 publishers then they will be able to send only 5KHz
> each?, will the receiver  still be 10kHz?
> In case we have 1 10 kHz publisher and two queues, will these queues
> be receiving 5kHz each?

A queue is a single process within Erlang. Thus your throughput limit on
a _single_ queue is one CPU core. However, as I said, channels and other
bits and pieces for each connection are also processes, so one queue
with a channel can, in theory, eat up probably 3 or 4 cores in total,
when absolutely maxed out.

Obviously, with each queue being your single unit of concurrency, if
you need higher throughput, then adding additional queues so you can
utilise more cores, is a valid approach.

So it's not to do with how many producers or consumers you have, it's
more to do with how fast a single queue can run on your hardware, and
then that performance should distribute itself reasonably well as you
add consumers and producers. It's a bit more complex than that, but
that's the general idea.

Matthew

From selfsorted at gmail.com  Thu Nov 11 15:33:24 2010
From: selfsorted at gmail.com (ssorted)
Date: Thu, 11 Nov 2010 07:33:24 -0800 (PST)
Subject: [rabbitmq-discuss] Only 20 req-resps per second
In-Reply-To: <yrv4cy690ds20.fsf@dwragg.eng.vmware.com>
References: <f7dd867e-7ab2-46d7-93e3-9a581330c2f6@c39g2000yqi.googlegroups.com>
	<4CDBAA88.1030804@rabbitmq.com>
	<a1652c97-fda6-4a41-ae03-cad6900e802c@26g2000yqv.googlegroups.com>
	<yrv4cy690ds20.fsf@dwragg.eng.vmware.com>
Message-ID: <e9506a0b-1719-4359-9b11-2c1cdc40a002@y37g2000vbl.googlegroups.com>

On Nov 11, 12:21?pm, David Wragg <da... at rabbitmq.com> wrote:
> ssorted <selfsor... at gmail.com> writes:
> > How to debug it further?
>
> In my experience, surprising slowness in applications using TCP sockets
> is often due to the Nagle algorithm. ?This might not be the cause in
> your case, but it's definitely something to eliminate. ?I see that
> neither pika or py-amqplib set TCP_NODELAY.
>
> So you might want to try adding something like
>
> ? ? sock.setsockopt(SOL_TCP, TCP_NODELAY, 1)
>

It solved the problem, thank you! I added the line to amqplib version:

conn.transport.sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_NODELAY,
1)

Now I get 600 requests+reponses per second! Such performance is
sufficient for me.


Regards,
Artur

From 0x6e6562 at gmail.com  Thu Nov 11 15:52:47 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 11 Nov 2010 15:52:47 +0000
Subject: [rabbitmq-discuss] as3-amqp connection failed
In-Reply-To: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>
References: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>
Message-ID: <AANLkTin5YuhMWuXX_6f1yLVa=tsMRDeNbQ+c+Zaq8xmV@mail.gmail.com>

Tim,

On Thu, Nov 11, 2010 at 3:03 PM, Tim Sawyer <list.rabbit at calidris.co.uk> wrote:
> This code used to work - I was running rabbitmq (I think it was version
> 1.7.2) on an old fedora box (9 I think), and the Java and Flex bits were
> running on Windows XP. ?Lots of changes in environment since then - are
> any of this likely to have an effect?

The AS3 client hasn't been maintained for a quite a while now, mainly
due to lack of interest.

The client only speaks AMQP 0-8, so it won't work with a 0-9-1 broker
that doesn't handle 0-8 (I'm don't whether the current master branch
of Rabbit has some kind of retro-handling for 0-8).

To get the client to speak 0-9-1 you'd have to run the codegen with
the 0-9-1 spec - assuming that the grammar of the 0-9-1 XML spec is
with the 0-8 grammar - and then recompile the library.

Cheers,

Ben

From simon at rabbitmq.com  Thu Nov 11 15:54:13 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Nov 2010 15:54:13 +0000
Subject: [rabbitmq-discuss] as3-amqp connection failed
In-Reply-To: <AANLkTin5YuhMWuXX_6f1yLVa=tsMRDeNbQ+c+Zaq8xmV@mail.gmail.com>
References: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>
	<AANLkTin5YuhMWuXX_6f1yLVa=tsMRDeNbQ+c+Zaq8xmV@mail.gmail.com>
Message-ID: <4CDC11A5.8050700@rabbitmq.com>

On 11/11/10 15:52, Ben Hood wrote:
> (I'm don't whether the current master branch
> of Rabbit has some kind of retro-handling for 0-8).

It does; all versions since 2.0 speak 0-9-1 and 0-8.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From icambron at gmail.com  Fri Nov 12 00:23:12 2010
From: icambron at gmail.com (Isaac Cambron)
Date: Thu, 11 Nov 2010 19:23:12 -0500
Subject: [rabbitmq-discuss] subscriptions after .NET upgrade
In-Reply-To: <4CDBB7C4.8000003@rabbitmq.com>
References: <AANLkTi=B9LH0s=dfMDG3TCVB64bniG37mL7xDXrMZy8T@mail.gmail.com>
	<4CDBB7C4.8000003@rabbitmq.com>
Message-ID: <AANLkTi=omujaQncopbUJj1bCxHemsna7m6dJjCJKNVZf@mail.gmail.com>

Thanks Emile - I'll try that.

On Thu, Nov 11, 2010 at 4:30 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Isaac,
>
> On 11/11/10 09:04, Isaac Cambron wrote:
> > I have an older application that I'm trying to get onto the latest and
> > greatest version of Rabbit and the .NET client. I'm having a bit of a
> > problem getting it to work the same way across the API changes.
> >
> > In my old app, I had a simple piece that broadcast to all of my
> > consumers who happen to be listening. Let's say they print the message's
> > content to the console when they get it. It was pretty simple. Each
> > consumer just creates a subscription:
> >
> > Subscription sub = new Subscription(ch, someExchange,
> > ExchangeType.Topic, someTopic);
> >
> > and listened to it. The broadcaster just did this:
> >
> > ch.BasicPublish(someExchange, someTopic, null, someBytes);
> >
> > Now, that signature for Subscription no longer exists. I've tried stuff
> > like this (which matches the old implementation from Subscription.cs):
> >
> > ch.ExchangeDeclare(EXCHANGE, ExchangeType.Topic);
> > ch.QueueDeclare(STATUS_QUEUE);
> > ch.QueueBind(STATUS_QUEUE, EXCHANGE, TOPIC, false, null);
> > Subscription sub = new Subscription(ch, STATUS_QUEUE, true);
> >
> > But the behavior I'm seeing is totally different:
> >
> > 1. Only one of the consumers gets the message and prints something. It's
> > round-robin instead of broadcast.
> > 2. When a new consumer is created and subscribes, it gets all of the
> > messages I've ever put in the queue and prints them to the console.
> >
> > I'm able to fix #2 by changing noAck to true, but not #1, and I suspect
> > I have something very wrong. Any ideas?
>
> Subscriptions have indeed been simplified for release version 2.0.0.
> Preceding the use of Subscription with declarations and the binding, as
> you have done, is correct.
>
> If only one consumer gets messages then try setting the channel prefetch
> to a small number (e.g. 1) by calling ch.BasicQos() before creating the
> subscription.
>
> Regards
>
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101111/3d40cd35/attachment.htm>

From vincentcheongst at gmail.com  Fri Nov 12 02:47:07 2010
From: vincentcheongst at gmail.com (Vincent Cheong)
Date: Fri, 12 Nov 2010 10:47:07 +0800
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <yrv4c7hgkf80u.fsf@dwragg.eng.vmware.com>
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	<yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
	<AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>
	<yrv4c1v6sp8e2.fsf@dwragg.eng.vmware.com>
	<AANLkTi=5pONoOVKtVxT6tap-g6RgQryPUapE+BkSzKeS@mail.gmail.com>
	<yrv4cwroknqsm.fsf@dwragg.eng.vmware.com>
	<AANLkTi=4bsVw3fbTk-2Xog6BZhkGbFk6cUwyzvBbcE87@mail.gmail.com>
	<yrv4c7hgkf80u.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTinVtPV64DKbdA1riRognT7F5ea=+uJ5_tNZ_RtR@mail.gmail.com>

Hi David,

I downgraded my libtool version to 2.2.7a and got it to work!  I also added
$vsdir/VC/PlatformSDK/Lib to the LIB in build-ms.sh as my ws2_32.lib file is
found there.

Thanks for all your help.

Vincent

On Thu, Nov 11, 2010 at 6:51 PM, David Wragg <david at rabbitmq.com> wrote:

> Vincent Cheong <vincentcheongst at gmail.com> writes:
> > I did not get install mingw using the install script. It is a pretty up
> to
> > date version (libs and compilers) that I have been using all along. I've
> > checked my PATH there's only one mingw/bin.
>
> Ah, I see.  I'm afraid that the easiest way forward for you will be to
> do a second temporary install of mingw using the script - you can delete
> it as soon as the build has worked :-)
>
> > [...]
> >
> > I've been looking at error statement again.
> > cl : Command line error D8021 : invalid numeric argument '/Wl,-DLL'
> > the cl command seems to be expecting a numeral after /W. Could the cl
> option
> > be /W1 or /WL instead or /Wl?
>
> -Wl,-DLL is a gcc option, and cl.exe generally has a completely
> different option syntax.  Why libtool is passing that option to cl.exe,
> I don't know.  libtool's support for the MS toolchain seems to be quite
> weak, and I was only able to get 2.2.7a to work by patching its output.
> I wouldn't be surprised if later versions break that support completely.
> So at the moment, you really need 2.2.7a.
>
> I don't know if there will be such strict dependencies on the other
> required mingw/msys packages.  You might be able to make it work just by
> changing your version of libtool, but I'm not sure.
>
> Thanks for bringing this to my attention, I will clarify the build
> instructions.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101112/4c35af70/attachment-0001.htm>

From list.rabbit at calidris.co.uk  Fri Nov 12 10:05:42 2010
From: list.rabbit at calidris.co.uk (Tim Sawyer)
Date: Fri, 12 Nov 2010 10:05:42 +0000
Subject: [rabbitmq-discuss] as3-amqp connection failed
In-Reply-To: <4CDC0753.20009@rabbitmq.com>
References: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>
	<4CDC0753.20009@rabbitmq.com>
Message-ID: <4CDD1176.60408@calidris.co.uk>

On 11/11/10 15:52, Ben Hood wrote:
 > The AS3 client hasn't been maintained for a quite a while now, mainly
 > due to lack of interest.

I'm not a big fan of AS3 myself, but that's what I'm stuck with for now!

On 11/11/10 15:10, Simon MacMullen wrote:
> On 11/11/10 15:03, Tim Sawyer wrote:
>> Does anyone have any clues where to start looking? Is anyone out there
>> using the as3-amqp client?
>
> Anything showing up in the RabbitMQ server logs? Can you see what's
> happening with Wireshark? (It only understands AMQP 0-9 so will fail to
> decode some frames, but should give you a better clue...)
>
> Cheers, Simon
>

Thanks everyone, I'll have a look at the network traffic Monday and see 
if I can see what's going on.

Tim.

From emil.vladev at gmail.com  Fri Nov 12 12:08:55 2010
From: emil.vladev at gmail.com (=?UTF-8?B?0JXQvNC40Lsg0JjQstCw0L3QvtCyIC8gRW1pbCBJdmFub3Y=?=)
Date: Fri, 12 Nov 2010 14:08:55 +0200
Subject: [rabbitmq-discuss] jsonrpc-channel not showing up under
	localhost:55672
Message-ID: <AANLkTinjd6sxv+NSFoOehZXDFS_Am1rx_ZTBiB+RgFnE@mail.gmail.com>

Good day,

I just installed rabbitmq 2.1.1 via .deb package on Ubuntu 10.10 and
got the .ez files for the jsonrpc-channel and management plugins. When
I visit http://localhost:55672/ I see Management Console, HTTP API,
Command Line Tool entries. However - there is no entry for
jsonrpc-channel (for the examples). I've managed to get it running
with rabbitmq 1.7, but no luck with 2.1.1. Attaching the logs.

Regards,
Emil

-- 
My place to share my ideas:
http://bolddream.com (now live :)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.log
Type: text/x-log
Size: 813 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101112/8f19e546/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: startup_log
Type: application/octet-stream
Size: 3232 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101112/8f19e546/attachment.obj>

From simon at rabbitmq.com  Fri Nov 12 12:18:46 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Nov 2010 12:18:46 +0000
Subject: [rabbitmq-discuss] jsonrpc-channel not showing up
	under	localhost:55672
In-Reply-To: <AANLkTinjd6sxv+NSFoOehZXDFS_Am1rx_ZTBiB+RgFnE@mail.gmail.com>
References: <AANLkTinjd6sxv+NSFoOehZXDFS_Am1rx_ZTBiB+RgFnE@mail.gmail.com>
Message-ID: <4CDD30A6.2050901@rabbitmq.com>

On 12/11/10 12:08, ???? ?????? / Emil Ivanov wrote:
> I just installed rabbitmq 2.1.1 via .deb package on Ubuntu 10.10 and
> got the .ez files for the jsonrpc-channel and management plugins. When
> I visithttp://localhost:55672/  I see Management Console, HTTP API,
> Command Line Tool entries. However - there is no entry for
> jsonrpc-channel (for the examples). I've managed to get it running
> with rabbitmq 1.7, but no luck with 2.1.1. Attaching the logs.

Hi Emil. The .ez file for jsonrpc-channel does not install the examples, 
since there would be no obvious way to remove them for production use. 
And the rpc and js_root contexts don't appear in the list since there's 
no point directly clicking on them.

Unfortunately this does mean it's not exactly obvious that anything is 
happening! If you go into the management plugin overview page and expand 
"Applications" you should find rabbit_jsonrpc, rabbit_jsonrpc_channel 
and rfc4627_jsonrpc applications running.

I'll have a think about how we can make this clearer.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From mutazmq at gmail.com  Fri Nov 12 14:56:28 2010
From: mutazmq at gmail.com (Mutaz Qasem)
Date: Fri, 12 Nov 2010 18:56:28 +0400
Subject: [rabbitmq-discuss] beam.smp takes a lot of CPU adn memory
Message-ID: <AANLkTin9_d=PNu6HNet_yGv6yU3z+LnDJR_zZDNsWboj@mail.gmail.com>

Hi

beam.smp is taking ebtween 70% - 90% of my CPU and around 780M RES and 980
VIRT.

I'm running rabbitmq-server 1.8.1
and Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2]
[async-threads:0] [hipe] [kernel-poll:false]

Any ideas please?

Thank you in advance
Mutaz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101112/5745b5c9/attachment.htm>

From matthew at rabbitmq.com  Fri Nov 12 15:28:00 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 12 Nov 2010 15:28:00 +0000
Subject: [rabbitmq-discuss] beam.smp takes a lot of CPU adn memory
In-Reply-To: <AANLkTin9_d=PNu6HNet_yGv6yU3z+LnDJR_zZDNsWboj@mail.gmail.com>
References: <AANLkTin9_d=PNu6HNet_yGv6yU3z+LnDJR_zZDNsWboj@mail.gmail.com>
Message-ID: <20101112152800.GV22102@rabbitmq.com>

On Fri, Nov 12, 2010 at 06:56:28PM +0400, Mutaz Qasem wrote:
> beam.smp is taking ebtween 70% - 90% of my CPU and around 780M RES and 980
> VIRT.
> 
> I'm running rabbitmq-server 1.8.1
> and Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2]
> [async-threads:0] [hipe] [kernel-poll:false]
> 
> Any ideas please?

Send fewer messages?

Matthew

From mikeb at rabbitmq.com  Fri Nov 12 17:43:38 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 12 Nov 2010 17:43:38 +0000
Subject: [rabbitmq-discuss] Passing null for 'arguments' to queueBind()
In-Reply-To: <30184535.post@talk.nabble.com>
References: <30162963.post@talk.nabble.com>
	<4CDA4E66.1000508@rabbitmq.com>	<4CDA548A.90703@rabbitmq.com>
	<30182063.post@talk.nabble.com>	<4CDACA27.30009@rabbitmq.com>
	<30184535.post@talk.nabble.com>
Message-ID: <4CDD7CCA.30509@rabbitmq.com>

>> It *is* a problem though when the groups are formed dynamically on
>> a per message basis, i.e. when each consumer has a unique secret
>> token, known to the producer, and the producer constructs the
>> recipient group of the message on the fly by including all the
>> intended recipient's tokens in the message headers.
>
> I understand you now, and above is exactly the situation I have.  I
> wonder if a custom exchange type can remove headers from a message
> prior to delivery.

Here is a design:

Allow CC and BCC fields* when publishing.  These are given to exchange 
types** when routing (i.e., they are part of the envelope); and, the 
routing code removes Bcc before actually delivering to queues.

Full semantics left as an exercise*** for the reader.

* They would probably have to be put in message headers, but possibly 
they could be given specific support in our clients.

** We'd update direct and topic to take account of them; fanout and 
headers don't need to, and other types given be given the fields and do 
what they like.

*** For example, "" is a valid routing key, so how do you send to 
multiple recipients just with BCC field?


Michael

From hsaid at plantcml-eads.com  Sat Nov 13 17:06:00 2010
From: hsaid at plantcml-eads.com (Hussein Said)
Date: Sat, 13 Nov 2010 12:06:00 -0500
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <4CDD7CCA.30509@rabbitmq.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com>	<4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com>	<4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com>
	<4CDD7CCA.30509@rabbitmq.com>
Message-ID: <3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com>

Hi,
I would like to know if there is something equivalent to the WCF
ServiceModel on the Java side. 
I  have a web service hosted in WCF that calls another web Service
hosted on Axis2. I was able with relative ease
To add the RabbitMQ binding on the .net side, and use SOAP as the
protocol, and RabbitMQ as the transport using the RabbitMQ service model
libraries. Now I would like to be able to do the same thing from the
Java side using SOAP. This will allow us to leverage our current
investments in SOAP, but use RabbitMQ powerful messaging infrastructure
to transport over Queues. 


thanks

From mutazmq at gmail.com  Sat Nov 13 17:10:40 2010
From: mutazmq at gmail.com (Mutaz Qasem)
Date: Sat, 13 Nov 2010 21:10:40 +0400
Subject: [rabbitmq-discuss] beam.smp takes a lot of CPU and memory
Message-ID: <AANLkTimh+52PX6+eDVYf0FpPQ+XVBk17B2yxyiXKQ0nk@mail.gmail.com>

Hi Matthew

There are few already. a message every hour! Please advise

Thank you
Mutaz


On Sat, Nov 13, 2010 at 4:00 PM, <
rabbitmq-discuss-request at lists.rabbitmq.com> wrote:

> Send rabbitmq-discuss mailing list submissions to
>        rabbitmq-discuss at lists.rabbitmq.com
>
> To subscribe or unsubscribe via the World Wide Web, visit
>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> or, via email, send a message with subject or body 'help' to
>        rabbitmq-discuss-request at lists.rabbitmq.com
>
> You can reach the person managing the list at
>        rabbitmq-discuss-owner at lists.rabbitmq.com
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of rabbitmq-discuss digest..."
>
>
> Today's Topics:
>
>   1. jsonrpc-channel not showing up under      localhost:55672
>      (???? ?????? / Emil Ivanov)
>   2. Re: jsonrpc-channel not showing up        under   localhost:55672
>      (Simon MacMullen)
>   3. beam.smp takes a lot of CPU adn memory (Mutaz Qasem)
>   4. Re: beam.smp takes a lot of CPU adn memory (Matthew Sackman)
>   5. Re: Passing null for 'arguments' to queueBind() (Michael Bridgen)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Fri, 12 Nov 2010 14:08:55 +0200
> From: ???? ?????? / Emil Ivanov         <emil.vladev at gmail.com>
> Subject: [rabbitmq-discuss] jsonrpc-channel not showing up under
>        localhost:55672
> To: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID:
>        <AANLkTinjd6sxv+NSFoOehZXDFS_Am1rx_ZTBiB+RgFnE at mail.gmail.com<AANLkTinjd6sxv%2BNSFoOehZXDFS_Am1rx_ZTBiB%2BRgFnE at mail.gmail.com>
> >
> Content-Type: text/plain; charset="utf-8"
>
> Good day,
>
> I just installed rabbitmq 2.1.1 via .deb package on Ubuntu 10.10 and
> got the .ez files for the jsonrpc-channel and management plugins. When
> I visit http://localhost:55672/ I see Management Console, HTTP API,
> Command Line Tool entries. However - there is no entry for
> jsonrpc-channel (for the examples). I've managed to get it running
> with rabbitmq 1.7, but no luck with 2.1.1. Attaching the logs.
>
> Regards,
> Emil
>
> --
> My place to share my ideas:
> http://bolddream.com (now live :)
> -------------- next part --------------
> A non-text attachment was scrubbed...
> Name: rabbit.log
> Type: text/x-log
> Size: 813 bytes
> Desc: not available
> URL: <
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101112/8f19e546/attachment-0001.bin
> >
> -------------- next part --------------
> A non-text attachment was scrubbed...
> Name: startup_log
> Type: application/octet-stream
> Size: 3232 bytes
> Desc: not available
> URL: <
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101112/8f19e546/attachment-0001.obj
> >
>
> ------------------------------
>
> Message: 2
> Date: Fri, 12 Nov 2010 12:18:46 +0000
> From: Simon MacMullen <simon at rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] jsonrpc-channel not showing up  under
>        localhost:55672
> To: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID: <4CDD30A6.2050901 at rabbitmq.com>
> Content-Type: text/plain; charset=UTF-8; format=flowed
>
> On 12/11/10 12:08, ???? ?????? / Emil Ivanov wrote:
> > I just installed rabbitmq 2.1.1 via .deb package on Ubuntu 10.10 and
> > got the .ez files for the jsonrpc-channel and management plugins. When
> > I visithttp://localhost:55672/  I see Management Console, HTTP API,
> > Command Line Tool entries. However - there is no entry for
> > jsonrpc-channel (for the examples). I've managed to get it running
> > with rabbitmq 1.7, but no luck with 2.1.1. Attaching the logs.
>
> Hi Emil. The .ez file for jsonrpc-channel does not install the examples,
> since there would be no obvious way to remove them for production use.
> And the rpc and js_root contexts don't appear in the list since there's
> no point directly clicking on them.
>
> Unfortunately this does mean it's not exactly obvious that anything is
> happening! If you go into the management plugin overview page and expand
> "Applications" you should find rabbit_jsonrpc, rabbit_jsonrpc_channel
> and rfc4627_jsonrpc applications running.
>
> I'll have a think about how we can make this clearer.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>
>
> ------------------------------
>
> Message: 3
> Date: Fri, 12 Nov 2010 18:56:28 +0400
> From: Mutaz Qasem <mutazmq at gmail.com>
> Subject: [rabbitmq-discuss] beam.smp takes a lot of CPU adn memory
> To: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID:
>        <AANLkTin9_d=PNu6HNet_yGv6yU3z+LnDJR_zZDNsWboj at mail.gmail.com<PNu6HNet_yGv6yU3z%2BLnDJR_zZDNsWboj at mail.gmail.com>
> >
> Content-Type: text/plain; charset="iso-8859-1"
>
> Hi
>
> beam.smp is taking ebtween 70% - 90% of my CPU and around 780M RES and 980
> VIRT.
>
> I'm running rabbitmq-server 1.8.1
> and Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2]
> [async-threads:0] [hipe] [kernel-poll:false]
>
> Any ideas please?
>
> Thank you in advance
> Mutaz
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101112/5745b5c9/attachment-0001.htm
> >
>
> ------------------------------
>
> Message: 4
> Date: Fri, 12 Nov 2010 15:28:00 +0000
> From: Matthew Sackman <matthew at rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] beam.smp takes a lot of CPU adn memory
> To: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID: <20101112152800.GV22102 at rabbitmq.com>
> Content-Type: text/plain; charset=us-ascii
>
> On Fri, Nov 12, 2010 at 06:56:28PM +0400, Mutaz Qasem wrote:
> > beam.smp is taking ebtween 70% - 90% of my CPU and around 780M RES and
> 980
> > VIRT.
> >
> > I'm running rabbitmq-server 1.8.1
> > and Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2]
> > [async-threads:0] [hipe] [kernel-poll:false]
> >
> > Any ideas please?
>
> Send fewer messages?
>
> Matthew
>
>
> ------------------------------
>
> Message: 5
> Date: Fri, 12 Nov 2010 17:43:38 +0000
> From: Michael Bridgen <mikeb at rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] Passing null for 'arguments' to
>        queueBind()
> To: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID: <4CDD7CCA.30509 at rabbitmq.com>
> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
>
> >> It *is* a problem though when the groups are formed dynamically on
> >> a per message basis, i.e. when each consumer has a unique secret
> >> token, known to the producer, and the producer constructs the
> >> recipient group of the message on the fly by including all the
> >> intended recipient's tokens in the message headers.
> >
> > I understand you now, and above is exactly the situation I have.  I
> > wonder if a custom exchange type can remove headers from a message
> > prior to delivery.
>
> Here is a design:
>
> Allow CC and BCC fields* when publishing.  These are given to exchange
> types** when routing (i.e., they are part of the envelope); and, the
> routing code removes Bcc before actually delivering to queues.
>
> Full semantics left as an exercise*** for the reader.
>
> * They would probably have to be put in message headers, but possibly
> they could be given specific support in our clients.
>
> ** We'd update direct and topic to take account of them; fanout and
> headers don't need to, and other types given be given the fields and do
> what they like.
>
> *** For example, "" is a valid routing key, so how do you send to
> multiple recipients just with BCC field?
>
>
> Michael
>
>
> ------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> End of rabbitmq-discuss Digest, Vol 42, Issue 40
> ************************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101113/c4123be6/attachment.htm>

From emil.vladev at gmail.com  Sun Nov 14 13:31:56 2010
From: emil.vladev at gmail.com (=?UTF-8?B?0JXQvNC40Lsg0JjQstCw0L3QvtCyIC8gRW1pbCBJdmFub3Y=?=)
Date: Sun, 14 Nov 2010 15:31:56 +0200
Subject: [rabbitmq-discuss] jsonrpc-channel not showing up under
	localhost:55672
In-Reply-To: <4CDD30A6.2050901@rabbitmq.com>
References: <AANLkTinjd6sxv+NSFoOehZXDFS_Am1rx_ZTBiB+RgFnE@mail.gmail.com>
	<4CDD30A6.2050901@rabbitmq.com>
Message-ID: <AANLkTinUhBcMJFryhtdnqgzf20PVSemPERg8RfycaMLg@mail.gmail.com>

Thank you Simon for the answer. May I suggest bundling the samples as a
separate .ez - it can easily be deleted for prod environments.

Regards,
Emil

On Nov 12, 2010 2:19 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

On 12/11/10 12:08, ???? ?????? / Emil Ivanov wrote:

> >
> > I just installed rabbitmq 2.1.1 via .deb package on Ubuntu 10.10 and
> > got the .ez files for the...
> I visithttp://localhost:55672/  I see Management Console, HTTP API,
>
>
> > Command Line Tool entries. However - there is no entry for
> > jsonrpc-channel (for the examples). ...
>

Hi Emil. The .ez file for jsonrpc-channel does not install the examples,
since there would be no obvious way to remove them for production use. And
the rpc and js_root contexts don't appear in the list since there's no point
directly clicking on them.

Unfortunately this does mean it's not exactly obvious that anything is
happening! If you go into the management plugin overview page and expand
"Applications" you should find rabbit_jsonrpc, rabbit_jsonrpc_channel and
rfc4627_jsonrpc applications running.

I'll have a think about how we can make this clearer.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101114/0b38cdd3/attachment.htm>

From gavinbutler at hushmail.com  Sun Nov 14 21:07:51 2010
From: gavinbutler at hushmail.com (Gavin Butler)
Date: Sun, 14 Nov 2010 13:07:51 -0800
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
Message-ID: <20101114210751.544EF32A761@smtp.hushmail.com>

Hello list,

Has anyone had success using a AMQP or Stomp PHP client to both 
send and receive messages from RabbitMQ?  If so, please could you 
post the version of the client/library, and various dependency 
versions?

Our RabbitMQ version is 2.1.0, and we have had varying degrees of 
success with AMQP and Stomp (if anyone would like more details, I 
will gladly provide them):

RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/, 
http://code.google.com/p/php-rabbit/): both sent messages with no 
problems, though get or consume failed to retrieve any message 
content.

Pure PHP AMQP (http://code.google.com/p/php-amqplib/): an 
assortment of errors sending.

Fusesource Stomp client 
(http://stomp.fusesource.org/documentation/php/index.html): send 
and subscribe works, though ack does not (invalid body 
terminator...which seems ok: "\x00").

Stomp PHP Extension (http://pecl.php.net/package/stomp): both send 
and receive do not work (no errors, but works fine with ActiveMQ, 
incidentally).

Zend Stomp: sends and receives, though doesn't appear to coexist 
with queues of the same name (and vhost) used by other 
producers/consumers.

Thanks,

-gavin


From david at rabbitmq.com  Sun Nov 14 22:45:37 2010
From: david at rabbitmq.com (David Wragg)
Date: Sun, 14 Nov 2010 22:45:37 +0000
Subject: [rabbitmq-discuss] Running rabbitmq client on visual studio 2005
In-Reply-To: <AANLkTinVtPV64DKbdA1riRognT7F5ea=+uJ5_tNZ_RtR@mail.gmail.com>
	(Vincent Cheong's message of "Fri, 12 Nov 2010 10:47:07 +0800")
References: <AANLkTi=UHWoS+AcQ2zV2CbMnprObptbT9ZxH9hSDCpSx@mail.gmail.com>
	<yrv4c39rahgyt.fsf@dwragg.eng.vmware.com>
	<AANLkTi=hvAreCoQ_GX1AMKLM-21cmXRxFYVXOv1cEoPZ@mail.gmail.com>
	<yrv4c62w4pkhv.fsf@dwragg.eng.vmware.com>
	<AANLkTi=SZqSDhT=AvJwkagyfU+3onkAg_t31kNGhYHbp@mail.gmail.com>
	<yrv4c1v6sp8e2.fsf@dwragg.eng.vmware.com>
	<AANLkTi=5pONoOVKtVxT6tap-g6RgQryPUapE+BkSzKeS@mail.gmail.com>
	<yrv4cwroknqsm.fsf@dwragg.eng.vmware.com>
	<AANLkTi=4bsVw3fbTk-2Xog6BZhkGbFk6cUwyzvBbcE87@mail.gmail.com>
	<yrv4c7hgkf80u.fsf@dwragg.eng.vmware.com>
	<AANLkTinVtPV64DKbdA1riRognT7F5ea=+uJ5_tNZ_RtR@mail.gmail.com>
Message-ID: <yrv4czktba5im.fsf@dwragg.eng.vmware.com>

Vincent Cheong <vincentcheongst at gmail.com> writes:
> I downgraded my libtool version to 2.2.7a and got it to work!  I also added
> $vsdir/VC/PlatformSDK/Lib to the LIB in build-ms.sh as my ws2_32.lib file is
> found there.

Thanks Vincent - I have corrected this in the branch.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From clegnitto at mozilla.com  Sun Nov 14 23:07:28 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Sun, 14 Nov 2010 15:07:28 -0800
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <20101114210751.544EF32A761@smtp.hushmail.com>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
Message-ID: <6064B5E2-5443-4938-80E2-E9DACD8F62C8@mozilla.com>

I've had success with http://us.php.net/amqp. I haven't tested too extensively, but I am able to send and receive simple messages through a topic exchange using RabbitMQ 2.1.1.

Christian

On Nov 14, 2010, at 1:07 PM, Gavin Butler wrote:

> Hello list,
> 
> Has anyone had success using a AMQP or Stomp PHP client to both 
> send and receive messages from RabbitMQ?  If so, please could you 
> post the version of the client/library, and various dependency 
> versions?
> 
> Our RabbitMQ version is 2.1.0, and we have had varying degrees of 
> success with AMQP and Stomp (if anyone would like more details, I 
> will gladly provide them):
> 
> RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/, 
> http://code.google.com/p/php-rabbit/): both sent messages with no 
> problems, though get or consume failed to retrieve any message 
> content.
> 
> Pure PHP AMQP (http://code.google.com/p/php-amqplib/): an 
> assortment of errors sending.
> 
> Fusesource Stomp client 
> (http://stomp.fusesource.org/documentation/php/index.html): send 
> and subscribe works, though ack does not (invalid body 
> terminator...which seems ok: "\x00").
> 
> Stomp PHP Extension (http://pecl.php.net/package/stomp): both send 
> and receive do not work (no errors, but works fine with ActiveMQ, 
> incidentally).
> 
> Zend Stomp: sends and receives, though doesn't appear to coexist 
> with queues of the same name (and vhost) used by other 
> producers/consumers.
> 
> Thanks,
> 
> -gavin
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From dikang85 at gmail.com  Mon Nov 15 09:01:10 2010
From: dikang85 at gmail.com (Dikang Gu)
Date: Mon, 15 Nov 2010 17:01:10 +0800
Subject: [rabbitmq-discuss] Two rabbitmq servers in one cluster,
 if one is down, the requests on the other one are blocked.
Message-ID: <AANLkTikZXftF5CK=7NkLy+1H_tX4zjg9KJ_k6ykLC+be@mail.gmail.com>

As per subject. Do you have any suggestions about how to solve this?

Also, my friend sent out a similar issue before:

2010/11/8 rob <rob at rabbitmq.com>

On Mon, 8 Nov 2010 20:04:20 +0800, Liwen Fan <f at scalethink.com> wrote:
> > Hi,
> >
> > We are running rabbit 2.1.1 with java client.
> > Our code is simple. Many threads share a common connection. In every
> > thread,
> > it holds its own channel.
> > When some threads publish/get messages to/from exchanges/queues which do
> > not
> > exist, its own channel dies.
> > But, the problem is, other threads that calls at
> connection.createChannel()
> > will block.
> >
> > we only use channel.basicGet() and channel.basicPublish() for our
> message
> > delivery.
> > Any suggestions?
>

Thanks
Dikang.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101115/199bc1e2/attachment.htm>

From emile at rabbitmq.com  Mon Nov 15 09:49:54 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 15 Nov 2010 09:49:54 +0000
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com>	<4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com>	<4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com>	<4CDD7CCA.30509@rabbitmq.com>
	<3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com>
Message-ID: <4CE10242.4040302@rabbitmq.com>

Hi Hussein,

On 13/11/10 17:06, Hussein Said wrote:
> Hi,
> I would like to know if there is something equivalent to the WCF
> ServiceModel on the Java side. 
> I  have a web service hosted in WCF that calls another web Service
> hosted on Axis2. I was able with relative ease
> To add the RabbitMQ binding on the .net side, and use SOAP as the
> protocol, and RabbitMQ as the transport using the RabbitMQ service model
> libraries. Now I would like to be able to do the same thing from the
> Java side using SOAP. This will allow us to leverage our current
> investments in SOAP, but use RabbitMQ powerful messaging infrastructure
> to transport over Queues. 


In theory it should be possible to interoperate using a Java web
services library that speaks the correct flavour of SOAP, but I'm not
aware of anyone trying this using the RabbitMQ WCF binding specifically.
We would be interested to hear the results of your attempt.


Regards

Emile

From mdeferran at ubikod.com  Mon Nov 15 10:56:25 2010
From: mdeferran at ubikod.com (Manuel DE FERRAN)
Date: Mon, 15 Nov 2010 11:56:25 +0100
Subject: [rabbitmq-discuss] ll_alloc errors on RabbitMQ 2.1.1
Message-ID: <AANLkTi=2R-i56ASN2M8Eu2TTWHuCXSPhY9rdnH9aVvNt@mail.gmail.com>

Greetings,

recently we upgraded to version 2.1.1. We picked up the official debian
package, and installed it on a debian lenny. And we face problems of memory
allocation 'll_alloc: Cannot allocate 486539264 bytes of memory (of type
"port_tab")' when invoking rabbitmqctl.
We have definitely no clue about what's happening. Moreover it does not
happen every time, but when it happens once, we're stuck. Rebooting fixes
the issue.

~# lsb_release -a
No LSB modules are available.
Distributor ID: Debian
Description:    Debian GNU/Linux 5.0.5 (lenny)
Release:        5.0.5
Codename:       lenny

~# erl
Erlang R13B04 (erts-5.7.5) [source] [64-bit] [rq:1] [async-threads:0]
[kernel-poll:false]

~# cat /var/log/rabbitmq/startup_err
...
+ exec erl -pa /usr/lib/rabbitmq/lib/rabbitmq_server-2.1.1/sbin/../ebin
-noinput -hidden -sname rabbitmq_multi2660 -s rabbit_multi -extra start_all
1
ll_alloc: Cannot allocate 486539264 bytes of memory (of type "port_tab").
/usr/lib/rabbitmq/bin/rabbitmq-server: line 107:  2683
Aborted                 erl -pa "$RABBITMQ_EBIN_ROOT" -rabbit plugins_dir
"\"$RABBITMQ_PLUGINS_DIR\"" -rabbit plugins_expand_dir
"\"${RABBITMQ_MNESIA_DIR}/plugins-scratch\"" -rabbit rabbit_ebin
"\"$RABBITMQ_EBIN_ROOT\"" -noinput -hidden -s rabbit_plugin_activator -extra
"$@"
Error: {node_start_failed,normal}

Maybe a faulty memory ? We will run a memtest when possible.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101115/8ca3240c/attachment-0001.htm>

From matthew at rabbitmq.com  Mon Nov 15 11:31:31 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 15 Nov 2010 11:31:31 +0000
Subject: [rabbitmq-discuss] ll_alloc errors on RabbitMQ 2.1.1
In-Reply-To: <AANLkTi=2R-i56ASN2M8Eu2TTWHuCXSPhY9rdnH9aVvNt@mail.gmail.com>
References: <AANLkTi=2R-i56ASN2M8Eu2TTWHuCXSPhY9rdnH9aVvNt@mail.gmail.com>
Message-ID: <20101115113130.GB9393@wellquite.org>

Howdy,

On Mon, Nov 15, 2010 at 11:56:25AM +0100, Manuel DE FERRAN wrote:
> recently we upgraded to version 2.1.1. We picked up the official debian
> package, and installed it on a debian lenny. And we face problems of memory
> allocation 'll_alloc: Cannot allocate 486539264 bytes of memory (of type
> "port_tab")' when invoking rabbitmqctl.

How much RAM is installed in the machine? How much is available? Have
you performed any configuration of Rabbit such as altering the
vm_high_memory_watermark value? Is it a 32-bit or 64-bit installation?

Matthew

From adamka at dgt.com.pl  Mon Nov 15 11:43:33 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Mon, 15 Nov 2010 12:43:33 +0100
Subject: [rabbitmq-discuss]  consume messages from exchanges
In-Reply-To: <4CD99055.10005@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl> <4CD92659.4080008@dgt.com.pl>
	<4CD950BB.60304@dgt.com.pl> <20101109140001.GE22102@rabbitmq.com>
	<4CD955EB.3060909@dgt.com.pl> <20101109141914.GF22102@rabbitmq.com>
	<4CD95B81.5070405@dgt.com.pl> <20101109144514.GG22102@rabbitmq.com>
	<4CD99055.10005@dgt.com.pl>
Message-ID: <4CE11CE5.30606@dgt.com.pl>

Hi,
I have got few questions about consumming practises.

Which is better, create new consumer for each queues and exchanges when 
binding or Can I use 1 consumer?
How can I change consumer name which is displayed when using    
rabbimqctl -q list_consumers? Is it possible??
Can I use 1 consumer queue to bind it to more than  1 exchange?


Regards,
Adam



-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From mdeferran at ubikod.com  Mon Nov 15 12:35:43 2010
From: mdeferran at ubikod.com (Manuel DE FERRAN)
Date: Mon, 15 Nov 2010 13:35:43 +0100
Subject: [rabbitmq-discuss] ll_alloc errors on RabbitMQ 2.1.1
In-Reply-To: <20101115113130.GB9393@wellquite.org>
References: <AANLkTi=2R-i56ASN2M8Eu2TTWHuCXSPhY9rdnH9aVvNt@mail.gmail.com>
	<20101115113130.GB9393@wellquite.org>
Message-ID: <AANLkTikTphxZegPGwzZ6C-54u+9RVYN0aX0Pqn5pXoQv@mail.gmail.com>

On Mon, Nov 15, 2010 at 12:31 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Howdy,
>
> On Mon, Nov 15, 2010 at 11:56:25AM +0100, Manuel DE FERRAN wrote:
> > recently we upgraded to version 2.1.1. We picked up the official debian
> > package, and installed it on a debian lenny. And we face problems of
> memory
> > allocation 'll_alloc: Cannot allocate 486539264 bytes of memory (of type
> > "port_tab")' when invoking rabbitmqctl.
>
> How much RAM is installed in the machine? How much is available? Have
> you performed any configuration of Rabbit such as altering the
> vm_high_memory_watermark value? Is it a 32-bit or 64-bit installation?
>
>

1.5 GB is assigned to this machine (that's a xen virtual machine). There is
more than 500MB of available memory. We released up to 1GB, and that did not
fix the issue.

We are using the default configuration, means no configuration at all.

And that's a 64 bits installation, we grabbed the debian package from
http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101115/ae1975c8/attachment.htm>

From videlalvaro at gmail.com  Mon Nov 15 13:19:41 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 15 Nov 2010 21:19:41 +0800
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <6064B5E2-5443-4938-80E2-E9DACD8F62C8@mozilla.com>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
	<6064B5E2-5443-4938-80E2-E9DACD8F62C8@mozilla.com>
Message-ID: <6F1DF9E7-3F89-4095-A417-A5350CBF84DB@gmail.com>

Have you tried: http://github.com/tnc/php-amqplib

Is a fixed version of one library that you point in your email

Cheers,

Alvaro

On Nov 15, 2010, at 7:07 AM, Christian Legnitto wrote:

> I've had success with http://us.php.net/amqp. I haven't tested too extensively, but I am able to send and receive simple messages through a topic exchange using RabbitMQ 2.1.1.
> 
> Christian
> 
> On Nov 14, 2010, at 1:07 PM, Gavin Butler wrote:
> 
>> Hello list,
>> 
>> Has anyone had success using a AMQP or Stomp PHP client to both 
>> send and receive messages from RabbitMQ?  If so, please could you 
>> post the version of the client/library, and various dependency 
>> versions?
>> 
>> Our RabbitMQ version is 2.1.0, and we have had varying degrees of 
>> success with AMQP and Stomp (if anyone would like more details, I 
>> will gladly provide them):
>> 
>> RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/, 
>> http://code.google.com/p/php-rabbit/): both sent messages with no 
>> problems, though get or consume failed to retrieve any message 
>> content.
>> 
>> Pure PHP AMQP (http://code.google.com/p/php-amqplib/): an 
>> assortment of errors sending.
>> 
>> Fusesource Stomp client 
>> (http://stomp.fusesource.org/documentation/php/index.html): send 
>> and subscribe works, though ack does not (invalid body 
>> terminator...which seems ok: "\x00").
>> 
>> Stomp PHP Extension (http://pecl.php.net/package/stomp): both send 
>> and receive do not work (no errors, but works fine with ActiveMQ, 
>> incidentally).
>> 
>> Zend Stomp: sends and receives, though doesn't appear to coexist 
>> with queues of the same name (and vhost) used by other 
>> producers/consumers.
>> 
>> Thanks,
>> 
>> -gavin
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gperrot at ubikod.com  Mon Nov 15 13:28:33 2010
From: gperrot at ubikod.com (Guillaume Perrot)
Date: Mon, 15 Nov 2010 14:28:33 +0100
Subject: [rabbitmq-discuss] Persistent messages ?
Message-ID: <AANLkTin7qndiB5Qkdg-3U2h5oiU4sApTie++ezF4q+pT@mail.gmail.com>

Hi,
I could not find detailed documentation about how persistent messages
work in rabbitmq.
In the Java library I saw no reference at all.
In the FAQ there is just one line I could not relate with the Java library.
How does it work ? Is there something to configure server side ?

From videlalvaro at gmail.com  Mon Nov 15 14:08:58 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 15 Nov 2010 22:08:58 +0800
Subject: [rabbitmq-discuss] Persistent messages ?
In-Reply-To: <AANLkTin7qndiB5Qkdg-3U2h5oiU4sApTie++ezF4q+pT@mail.gmail.com>
References: <AANLkTin7qndiB5Qkdg-3U2h5oiU4sApTie++ezF4q+pT@mail.gmail.com>
Message-ID: <B5F526D6-80FF-4E16-A1F7-8B4E71893687@gmail.com>

Hi,

There's nothing to configure on the server side,

If you want persistent message on AMQP 0.8 then set the property 'delivery_mode' = 2

Cheers,

Alvaro

On Nov 15, 2010, at 9:28 PM, Guillaume Perrot wrote:

> Hi,
> I could not find detailed documentation about how persistent messages
> work in rabbitmq.
> In the Java library I saw no reference at all.
> In the FAQ there is just one line I could not relate with the Java library.
> How does it work ? Is there something to configure server side ?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gperrot at ubikod.com  Mon Nov 15 14:22:48 2010
From: gperrot at ubikod.com (Guillaume Perrot)
Date: Mon, 15 Nov 2010 15:22:48 +0100
Subject: [rabbitmq-discuss] Persistent messages ?
In-Reply-To: <B5F526D6-80FF-4E16-A1F7-8B4E71893687@gmail.com>
References: <AANLkTin7qndiB5Qkdg-3U2h5oiU4sApTie++ezF4q+pT@mail.gmail.com>
	<B5F526D6-80FF-4E16-A1F7-8B4E71893687@gmail.com>
Message-ID: <AANLkTimV2Atu_8XUNSocHjuFdJL376q6_RC=XnU3fjXp@mail.gmail.com>

I use rabbitmq 2.1.1 and thus AMQP 0.9.1.
And I don't know how to set the delivery mode with the Java lib.

2010/11/15 Alvaro Videla <videlalvaro at gmail.com>:
> Hi,
>
> There's nothing to configure on the server side,
>
> If you want persistent message on AMQP 0.8 then set the property 'delivery_mode' = 2
>
> Cheers,
>
> Alvaro
>
> On Nov 15, 2010, at 9:28 PM, Guillaume Perrot wrote:
>
>> Hi,
>> I could not find detailed documentation about how persistent messages
>> work in rabbitmq.
>> In the Java library I saw no reference at all.
>> In the FAQ there is just one line I could not relate with the Java library.
>> How does it work ? Is there something to configure server side ?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From videlalvaro at gmail.com  Mon Nov 15 14:24:20 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 15 Nov 2010 22:24:20 +0800
Subject: [rabbitmq-discuss] Persistent messages ?
In-Reply-To: <AANLkTimV2Atu_8XUNSocHjuFdJL376q6_RC=XnU3fjXp@mail.gmail.com>
References: <AANLkTin7qndiB5Qkdg-3U2h5oiU4sApTie++ezF4q+pT@mail.gmail.com>
	<B5F526D6-80FF-4E16-A1F7-8B4E71893687@gmail.com>
	<AANLkTimV2Atu_8XUNSocHjuFdJL376q6_RC=XnU3fjXp@mail.gmail.com>
Message-ID: <D64AAFE0-F353-4347-B59A-34A488754C32@gmail.com>

I can't help you there since I don't use Java. Maybe another guy on the list

Cheers
On Nov 15, 2010, at 10:22 PM, Guillaume Perrot wrote:

> I use rabbitmq 2.1.1 and thus AMQP 0.9.1.
> And I don't know how to set the delivery mode with the Java lib.
> 
> 2010/11/15 Alvaro Videla <videlalvaro at gmail.com>:
>> Hi,
>> 
>> There's nothing to configure on the server side,
>> 
>> If you want persistent message on AMQP 0.8 then set the property 'delivery_mode' = 2
>> 
>> Cheers,
>> 
>> Alvaro
>> 
>> On Nov 15, 2010, at 9:28 PM, Guillaume Perrot wrote:
>> 
>>> Hi,
>>> I could not find detailed documentation about how persistent messages
>>> work in rabbitmq.
>>> In the Java library I saw no reference at all.
>>> In the FAQ there is just one line I could not relate with the Java library.
>>> How does it work ? Is there something to configure server side ?
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 


From simon at rabbitmq.com  Mon Nov 15 14:26:22 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Nov 2010 14:26:22 +0000
Subject: [rabbitmq-discuss] Persistent messages ?
In-Reply-To: <AANLkTimV2Atu_8XUNSocHjuFdJL376q6_RC=XnU3fjXp@mail.gmail.com>
References: <AANLkTin7qndiB5Qkdg-3U2h5oiU4sApTie++ezF4q+pT@mail.gmail.com>	<B5F526D6-80FF-4E16-A1F7-8B4E71893687@gmail.com>
	<AANLkTimV2Atu_8XUNSocHjuFdJL376q6_RC=XnU3fjXp@mail.gmail.com>
Message-ID: <4CE1430E.4030408@rabbitmq.com>

Hi Guillaume. See:

http://www.rabbitmq.com/api-guide.html#publishing

Cheers, Simon

On 15/11/10 14:22, Guillaume Perrot wrote:
> I use rabbitmq 2.1.1 and thus AMQP 0.9.1.
> And I don't know how to set the delivery mode with the Java lib.
>
> 2010/11/15 Alvaro Videla<videlalvaro at gmail.com>:
>> Hi,
>>
>> There's nothing to configure on the server side,
>>
>> If you want persistent message on AMQP 0.8 then set the property 'delivery_mode' = 2
>>
>> Cheers,
>>
>> Alvaro
>>
>> On Nov 15, 2010, at 9:28 PM, Guillaume Perrot wrote:
>>
>>> Hi,
>>> I could not find detailed documentation about how persistent messages
>>> work in rabbitmq.
>>> In the Java library I saw no reference at all.
>>> In the FAQ there is just one line I could not relate with the Java library.
>>> How does it work ? Is there something to configure server side ?
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From gperrot at ubikod.com  Mon Nov 15 14:38:14 2010
From: gperrot at ubikod.com (Guillaume Perrot)
Date: Mon, 15 Nov 2010 15:38:14 +0100
Subject: [rabbitmq-discuss] Persistent messages ?
In-Reply-To: <D64AAFE0-F353-4347-B59A-34A488754C32@gmail.com>
References: <AANLkTin7qndiB5Qkdg-3U2h5oiU4sApTie++ezF4q+pT@mail.gmail.com>
	<B5F526D6-80FF-4E16-A1F7-8B4E71893687@gmail.com>
	<AANLkTimV2Atu_8XUNSocHjuFdJL376q6_RC=XnU3fjXp@mail.gmail.com>
	<D64AAFE0-F353-4347-B59A-34A488754C32@gmail.com>
Message-ID: <AANLkTinZZF+RWiVi9=oDgaEeaPXbDT7eH6Fh1tp-zDfz@mail.gmail.com>

I eventually found, sorry for the inconvenience.
I never thought it was a per publish setting.

2010/11/15 Alvaro Videla <videlalvaro at gmail.com>:
> I can't help you there since I don't use Java. Maybe another guy on the list
>
> Cheers
> On Nov 15, 2010, at 10:22 PM, Guillaume Perrot wrote:
>
>> I use rabbitmq 2.1.1 and thus AMQP 0.9.1.
>> And I don't know how to set the delivery mode with the Java lib.
>>
>> 2010/11/15 Alvaro Videla <videlalvaro at gmail.com>:
>>> Hi,
>>>
>>> There's nothing to configure on the server side,
>>>
>>> If you want persistent message on AMQP 0.8 then set the property 'delivery_mode' = 2
>>>
>>> Cheers,
>>>
>>> Alvaro
>>>
>>> On Nov 15, 2010, at 9:28 PM, Guillaume Perrot wrote:
>>>
>>>> Hi,
>>>> I could not find detailed documentation about how persistent messages
>>>> work in rabbitmq.
>>>> In the Java library I saw no reference at all.
>>>> In the FAQ there is just one line I could not relate with the Java library.
>>>> How does it work ? Is there something to configure server side ?
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>
>

From flatline at stresstiming.de  Mon Nov 15 15:16:56 2010
From: flatline at stresstiming.de (diez)
Date: Mon, 15 Nov 2010 16:16:56 +0100
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <20101114210751.544EF32A761@smtp.hushmail.com>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
Message-ID: <4CE14EE8.5020606@stresstiming.de>

Hi Gavin,

I/we have patched the php-rabbit version of Alexander Kalendarev to the
latest Version of the rabbitmq clib. So you can use it with the latest
server  > 2.2 and library version.

At first you have to apply the patch on the Google code site.

http://code.google.com/p/php-rabbit/issues/detail?id=29

After that use the attached patch.

Grettings

Dieter


Am 14.11.2010 22:07, schrieb Gavin Butler:
> Hello list,
>
> Has anyone had success using a AMQP or Stomp PHP client to both 
> send and receive messages from RabbitMQ?  If so, please could you 
> post the version of the client/library, and various dependency 
> versions?
>
> Our RabbitMQ version is 2.1.0, and we have had varying degrees of 
> success with AMQP and Stomp (if anyone would like more details, I 
> will gladly provide them):
>
> RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/, 
> http://code.google.com/p/php-rabbit/): both sent messages with no 
> problems, though get or consume failed to retrieve any message 
> content.
>
> Pure PHP AMQP (http://code.google.com/p/php-amqplib/): an 
> assortment of errors sending.
>
> Fusesource Stomp client 
> (http://stomp.fusesource.org/documentation/php/index.html): send 
> and subscribe works, though ack does not (invalid body 
> terminator...which seems ok: "\x00").
>
> Stomp PHP Extension (http://pecl.php.net/package/stomp): both send 
> and receive do not work (no errors, but works fine with ActiveMQ, 
> incidentally).
>
> Zend Stomp: sends and receives, though doesn't appear to coexist 
> with queues of the same name (and vhost) used by other 
> producers/consumers.
>
> Thanks,
>
> -gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   


-------------- next part --------------
A non-text attachment was scrubbed...
Name: php-rabbit-latest-server.diff
Type: text/x-patch
Size: 6599 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101115/33238c13/attachment.bin>

From flatline at stresstiming.de  Mon Nov 15 15:21:01 2010
From: flatline at stresstiming.de (diez)
Date: Mon, 15 Nov 2010 16:21:01 +0100
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <4CE14EE8.5020606@stresstiming.de>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
	<4CE14EE8.5020606@stresstiming.de>
Message-ID: <4CE14FDD.2050109@stresstiming.de>

Hi @all

sorry it ncludes the first patch. So you must only apply my attached patch.

Regards Dieter

Am 15.11.2010 16:16, schrieb diez:
> Hi Gavin,
>
> I/we have patched the php-rabbit version of Alexander Kalendarev to the
> latest Version of the rabbitmq clib. So you can use it with the latest
> server  > 2.2 and library version.
>
> At first you have to apply the patch on the Google code site.
>
> http://code.google.com/p/php-rabbit/issues/detail?id=29
>
> After that use the attached patch.
>
> Grettings
>
> Dieter
>
>
> Am 14.11.2010 22:07, schrieb Gavin Butler:
>   
>> Hello list,
>>
>> Has anyone had success using a AMQP or Stomp PHP client to both 
>> send and receive messages from RabbitMQ?  If so, please could you 
>> post the version of the client/library, and various dependency 
>> versions?
>>
>> Our RabbitMQ version is 2.1.0, and we have had varying degrees of 
>> success with AMQP and Stomp (if anyone would like more details, I 
>> will gladly provide them):
>>
>> RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/, 
>> http://code.google.com/p/php-rabbit/): both sent messages with no 
>> problems, though get or consume failed to retrieve any message 
>> content.
>>
>> Pure PHP AMQP (http://code.google.com/p/php-amqplib/): an 
>> assortment of errors sending.
>>
>> Fusesource Stomp client 
>> (http://stomp.fusesource.org/documentation/php/index.html): send 
>> and subscribe works, though ack does not (invalid body 
>> terminator...which seems ok: "\x00").
>>
>> Stomp PHP Extension (http://pecl.php.net/package/stomp): both send 
>> and receive do not work (no errors, but works fine with ActiveMQ, 
>> incidentally).
>>
>> Zend Stomp: sends and receives, though doesn't appear to coexist 
>> with queues of the same name (and vhost) used by other 
>> producers/consumers.
>>
>> Thanks,
>>
>> -gavin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>   
>>     
>
>   
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101115/fde5177f/attachment.htm>

From Loren.Schlomer at echostar.com  Mon Nov 15 15:24:11 2010
From: Loren.Schlomer at echostar.com (Schlomer, Loren)
Date: Mon, 15 Nov 2010 08:24:11 -0700
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <20101114210751.544EF32A761@smtp.hushmail.com>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
Message-ID: <6294CCE6B4CE7D4D81822D7408E0D6570F979CB5EF@ECHOEXCC1.SATS.CORP>

I have good luck sending JSON with the pure PHP AMQP lib.  What errors are you seeing?



________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin Butler [gavinbutler at hushmail.com]
Sent: Sunday, November 14, 2010 2:07 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?

Hello list,

Has anyone had success using a AMQP or Stomp PHP client to both
send and receive messages from RabbitMQ?  If so, please could you
post the version of the client/library, and various dependency
versions?

Our RabbitMQ version is 2.1.0, and we have had varying degrees of
success with AMQP and Stomp (if anyone would like more details, I
will gladly provide them):

RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/,
http://code.google.com/p/php-rabbit/): both sent messages with no
problems, though get or consume failed to retrieve any message
content.

Pure PHP AMQP (http://code.google.com/p/php-amqplib/): an
assortment of errors sending.

Fusesource Stomp client
(http://stomp.fusesource.org/documentation/php/index.html): send
and subscribe works, though ack does not (invalid body
terminator...which seems ok: "\x00").

Stomp PHP Extension (http://pecl.php.net/package/stomp): both send
and receive do not work (no errors, but works fine with ActiveMQ,
incidentally).

Zend Stomp: sends and receives, though doesn't appear to coexist
with queues of the same name (and vhost) used by other
producers/consumers.

Thanks,

-gavin

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From simon at rabbitmq.com  Mon Nov 15 17:32:55 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Nov 2010 17:32:55 +0000
Subject: [rabbitmq-discuss] jsonrpc-channel not showing up under
	localhost:55672
In-Reply-To: <AANLkTinUhBcMJFryhtdnqgzf20PVSemPERg8RfycaMLg@mail.gmail.com>
References: <AANLkTinjd6sxv+NSFoOehZXDFS_Am1rx_ZTBiB+RgFnE@mail.gmail.com>	<4CDD30A6.2050901@rabbitmq.com>
	<AANLkTinUhBcMJFryhtdnqgzf20PVSemPERg8RfycaMLg@mail.gmail.com>
Message-ID: <4CE16EC7.9090302@rabbitmq.com>

On 14/11/10 13:31, ???? ?????? / Emil Ivanov wrote:
> Thank you Simon for the answer. May I suggest bundling the samples as a
> separate .ez - it can easily be deleted for prod environments.

Yeah, that's the conclusion I came to as well. It'll be in the next release.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From gavinbutler at hushmail.com  Mon Nov 15 18:31:50 2010
From: gavinbutler at hushmail.com (Gavin Butler)
Date: Mon, 15 Nov 2010 10:31:50 -0800 (PST)
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <6064B5E2-5443-4938-80E2-E9DACD8F62C8@mozilla.com>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
	<6064B5E2-5443-4938-80E2-E9DACD8F62C8@mozilla.com>
Message-ID: <9f78fc7a-21d4-41e7-ad0e-6f1d619a68eb@o15g2000prh.googlegroups.com>

Thanks Christian.  In my environment, the amqp extension suffers from
the same problems as the others that depend on librabbitmq - consume/
get fail to retrieve any message content.  Same behavior on 2.1.1 too,
incidentally.

Also, the version I downloaded suffered from the same problem
described in the thread below, in which a consume results in a
segfault.  With modifications, the segfault goes away, but consume
still doesn't retrieve message content.

http://old.nabble.com/Rabbitmq-c-Help-td29742345.html

I'll probably just use the project that Alvaro mentioned, since that
seems to work well in our setup.

Thanks,

-gavin

On Nov 14, 3:07?pm, Christian Legnitto <clegni... at mozilla.com> wrote:
> I've had success withhttp://us.php.net/amqp. I haven't tested too extensively, but I am able to send and receive simple messages through a topic exchange using RabbitMQ 2.1.1.
>
> Christian
>
> On Nov 14, 2010, at 1:07 PM, Gavin Butler wrote:
>
>
>
> > Hello list,
>
> > Has anyone had success using a AMQP or StompPHPclient to both
> > send and receive messages from RabbitMQ? ?If so, please could you
> > post the version of the client/library, and various dependency
> > versions?
>
> > Our RabbitMQ version is 2.1.0, and we have had varying degrees of
> > success with AMQP and Stomp (if anyone would like more details, I
> > will gladly provide them):
>
> > RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/,
> >http://code.google.com/p/php-rabbit/):both sent messages with no
> > problems, though get or consume failed to retrieve any message
> > content.
>
> > PurePHPAMQP (http://code.google.com/p/php-amqplib/):an
> > assortment of errors sending.
>
> > Fusesource Stomp client
> > (http://stomp.fusesource.org/documentation/php/index.html):send
> > and subscribe works, though ack does not (invalid body
> > terminator...which seems ok: "\x00").
>
> > StompPHPExtension (http://pecl.php.net/package/stomp):both send
> > and receive do not work (no errors, but works fine with ActiveMQ,
> > incidentally).
>
> > Zend Stomp: sends and receives, though doesn't appear to coexist
> > with queues of the same name (and vhost) used by other
> > producers/consumers.
>
> > Thanks,
>
> > -gavin
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gavinbutler at hushmail.com  Mon Nov 15 18:35:26 2010
From: gavinbutler at hushmail.com (Gavin Butler)
Date: Mon, 15 Nov 2010 10:35:26 -0800 (PST)
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <6F1DF9E7-3F89-4095-A417-A5350CBF84DB@gmail.com>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
	<6064B5E2-5443-4938-80E2-E9DACD8F62C8@mozilla.com>
	<6F1DF9E7-3F89-4095-A417-A5350CBF84DB@gmail.com>
Message-ID: <5e7b5a51-903b-40a7-8734-493719b2cec0@n32g2000pre.googlegroups.com>

This seems to be the only project I did not try, and it worked
perfectly.

Thanks for pointing me to that - and thanks for providing this
project!

On Nov 15, 5:19?am, Alvaro Videla <videlalv... at gmail.com> wrote:
> Have you tried:http://github.com/tnc/php-amqplib
>
> Is a fixed version of one library that you point in your email
>
> Cheers,
>
> Alvaro
>
> On Nov 15, 2010, at 7:07 AM, Christian Legnitto wrote:
>
>
>
> > I've had success withhttp://us.php.net/amqp. I haven't tested too extensively, but I am able to send and receive simple messages through a topic exchange using RabbitMQ 2.1.1.
>
> > Christian
>
> > On Nov 14, 2010, at 1:07 PM, Gavin Butler wrote:
>
> >> Hello list,
>
> >> Has anyone had success using a AMQP or StompPHPclient to both
> >> send and receive messages from RabbitMQ? ?If so, please could you
> >> post the version of the client/library, and various dependency
> >> versions?
>
> >> Our RabbitMQ version is 2.1.0, and we have had varying degrees of
> >> success with AMQP and Stomp (if anyone would like more details, I
> >> will gladly provide them):
>
> >> RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/,
> >>http://code.google.com/p/php-rabbit/):both sent messages with no
> >> problems, though get or consume failed to retrieve any message
> >> content.
>
> >> PurePHPAMQP (http://code.google.com/p/php-amqplib/):an
> >> assortment of errors sending.
>
> >> Fusesource Stomp client
> >> (http://stomp.fusesource.org/documentation/php/index.html):send
> >> and subscribe works, though ack does not (invalid body
> >> terminator...which seems ok: "\x00").
>
> >> StompPHPExtension (http://pecl.php.net/package/stomp):both send
> >> and receive do not work (no errors, but works fine with ActiveMQ,
> >> incidentally).
>
> >> Zend Stomp: sends and receives, though doesn't appear to coexist
> >> with queues of the same name (and vhost) used by other
> >> producers/consumers.
>
> >> Thanks,
>
> >> -gavin
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.com
> >>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From list.rabbit at calidris.co.uk  Mon Nov 15 18:43:03 2010
From: list.rabbit at calidris.co.uk (Tim Sawyer)
Date: Mon, 15 Nov 2010 18:43:03 +0000
Subject: [rabbitmq-discuss] as3-amqp connection failed
In-Reply-To: <4CDD1176.60408@calidris.co.uk>
References: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>	<4CDC0753.20009@rabbitmq.com>
	<4CDD1176.60408@calidris.co.uk>
Message-ID: <4CE17F37.3030307@calidris.co.uk>

On 12/11/10 10:05, Tim Sawyer wrote:
> On 11/11/10 15:52, Ben Hood wrote:
>  > The AS3 client hasn't been maintained for a quite a while now, mainly
>  > due to lack of interest.
>
> I'm not a big fan of AS3 myself, but that's what I'm stuck with for now!
>
> On 11/11/10 15:10, Simon MacMullen wrote:
>> On 11/11/10 15:03, Tim Sawyer wrote:
>>> Does anyone have any clues where to start looking? Is anyone out there
>>> using the as3-amqp client?
>>
>> Anything showing up in the RabbitMQ server logs? Can you see what's
>> happening with Wireshark? (It only understands AMQP 0-9 so will fail to
>> decode some frames, but should give you a better clue...)
>>
>> Cheers, Simon
>>
>
> Thanks everyone, I'll have a look at the network traffic Monday and see
> if I can see what's going on.

Fixed it. Wireshark gave me the clue that I needed, I found an error 
message on the wire.

The back end declares an exchange as auto delete = true. The as3 front
end library is hard coded to declare the exchange as auto delete =
false. It looks like this worked fine on previous versions of rabbitmq, 
but newer servers throw an error.

I changed my back end to declare the exchange as auto delete = false and 
it works again now.

Thanks for your help everyone,

Tim.

From matthias at rabbitmq.com  Mon Nov 15 18:48:40 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 15 Nov 2010 18:48:40 +0000
Subject: [rabbitmq-discuss] as3-amqp connection failed
In-Reply-To: <4CE17F37.3030307@calidris.co.uk>
References: <42064.87.85.237.82.1289487811.squirrel@www.hotmandarins.co.uk>	<4CDC0753.20009@rabbitmq.com>	<4CDD1176.60408@calidris.co.uk>
	<4CE17F37.3030307@calidris.co.uk>
Message-ID: <4CE18088.9080000@rabbitmq.com>

Tim,

On 15/11/10 18:43, Tim Sawyer wrote:
> Fixed it. Wireshark gave me the clue that I needed, I found an error
> message on the wire.

Glad you got it working. The error should also have shown up in rabbit's 
log file. If you have access to that it's a good idea to inspect it 
every now and then, particularly when working with client libraries that 
are prone to swallowing errors ;)


Regards,

Matthias.

From pdezwart at rubiconproject.com  Mon Nov 15 18:57:02 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 15 Nov 2010 10:57:02 -0800
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <20101114210751.544EF32A761@smtp.hushmail.com>
Message-ID: <C906C27E.12CF2%pdezwart@rubiconproject.com>

Hey Gavin,

We are very close to having a working version of the AMQP client for
RabbitMQ 2.1. The problem we have had to deal with is that the C library is
unversioned, and as a result it is rather difficult to handle all of the
people out there who are running different versions which each have
different signatures.

Pieter


On 11/14/10 1:07 PM, "Gavin Butler" <gavinbutler at hushmail.com> wrote:

> Hello list,
> 
> Has anyone had success using a AMQP or Stomp PHP client to both
> send and receive messages from RabbitMQ?  If so, please could you
> post the version of the client/library, and various dependency
> versions?
> 
> Our RabbitMQ version is 2.1.0, and we have had varying degrees of
> success with AMQP and Stomp (if anyone would like more details, I
> will gladly provide them):
> 
> RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/,
> http://code.google.com/p/php-rabbit/): both sent messages with no
> problems, though get or consume failed to retrieve any message
> content.
> 
> Pure PHP AMQP (http://code.google.com/p/php-amqplib/): an
> assortment of errors sending.
> 
> Fusesource Stomp client
> (http://stomp.fusesource.org/documentation/php/index.html): send
> and subscribe works, though ack does not (invalid body
> terminator...which seems ok: "\x00").
> 
> Stomp PHP Extension (http://pecl.php.net/package/stomp): both send
> and receive do not work (no errors, but works fine with ActiveMQ,
> incidentally).
> 
> Zend Stomp: sends and receives, though doesn't appear to coexist
> with queues of the same name (and vhost) used by other
> producers/consumers.
> 
> Thanks,
> 
> -gavin
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
 REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE



From majek04 at gmail.com  Mon Nov 15 19:25:47 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 15 Nov 2010 19:25:47 +0000
Subject: [rabbitmq-discuss] consume messages from exchanges
In-Reply-To: <4CE11CE5.30606@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl> <4CD92659.4080008@dgt.com.pl>
	<4CD950BB.60304@dgt.com.pl> <20101109140001.GE22102@rabbitmq.com>
	<4CD955EB.3060909@dgt.com.pl> <20101109141914.GF22102@rabbitmq.com>
	<4CD95B81.5070405@dgt.com.pl> <20101109144514.GG22102@rabbitmq.com>
	<4CD99055.10005@dgt.com.pl> <4CE11CE5.30606@dgt.com.pl>
Message-ID: <AANLkTin5mq0P2NUaJ03iu1YdeoawYB05HcZey9V5ND7+@mail.gmail.com>

On Mon, Nov 15, 2010 at 11:43, Adam Kaminiecki <adamka at dgt.com.pl> wrote:
> Hi,
> I have got few questions about consumming practises.
>
> Which is better, create new consumer for each queues and exchanges when
> binding or Can I use 1 consumer?

You can't create 'a consumer for an exchange'.

Except from that, that's pretty common question. It all depends on your
design. Often you can have a single queue with one consumer
and a whole bunch of exchanges and bindings. The other time
it might be better to have a single exchange and many queues.

That's the whole point of AMQP, you can create topology as you need it.
So start with something simple, that you feel comfortable with.

> How can I change consumer name which is displayed when using ? ?rabbimqctl
> -q list_consumers? Is it possible??
> Can I use 1 consumer queue to bind it to more than ?1 exchange?

Yes, a queue can have multiple bindings.

BTW, have you seen our tutorials?

https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-one.md

Cheers,
  Marek

From gavinbutler at hushmail.com  Mon Nov 15 19:32:49 2010
From: gavinbutler at hushmail.com (Gavin Butler)
Date: Mon, 15 Nov 2010 11:32:49 -0800 (PST)
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <4CE14FDD.2050109@stresstiming.de>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
	<4CE14EE8.5020606@stresstiming.de>
	<4CE14FDD.2050109@stresstiming.de>
Message-ID: <7b0c3c63-c0e6-4165-b3a3-c1d3ad8e0086@n32g2000pre.googlegroups.com>

Thanks for the patch Dieter!  That fixed the issue consuming messages
with php-rabbit.

Worked with both 2.1.0 and 2.1.1 server versions.

On Nov 15, 7:21?am, diez <flatl... at stresstiming.de> wrote:
> Hi @all
>
> sorry it ncludes the first patch. So you must only apply my attached patch.
>
> Regards Dieter
>
> Am 15.11.2010 16:16, schrieb diez:
>
> > Hi Gavin,
>
> > I/we have patched the php-rabbit version of Alexander Kalendarev to the
> > latest Version of the rabbitmq clib. So you can use it with the latest
> > server ?> 2.2 and library version.
>
> > At first you have to apply the patch on the Google code site.
>
> >http://code.google.com/p/php-rabbit/issues/detail?id=29
>
> > After that use the attached patch.
>
> > Grettings
>
> > Dieter
>
> > Am 14.11.2010 22:07, schrieb Gavin Butler:
>
> >> Hello list,
>
> >> Has anyone had success using a AMQP or Stomp PHP client to both
> >> send and receive messages from RabbitMQ? ?If so, please could you
> >> post the version of the client/library, and various dependency
> >> versions?
>
> >> Our RabbitMQ version is 2.1.0, and we have had varying degrees of
> >> success with AMQP and Stomp (if anyone would like more details, I
> >> will gladly provide them):
>
> >> RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/,
> >>http://code.google.com/p/php-rabbit/):both sent messages with no
> >> problems, though get or consume failed to retrieve any message
> >> content.
>
> >> Pure PHP AMQP (http://code.google.com/p/php-amqplib/):an
> >> assortment of errors sending.
>
> >> Fusesource Stomp client
> >> (http://stomp.fusesource.org/documentation/php/index.html):send
> >> and subscribe works, though ack does not (invalid body
> >> terminator...which seems ok: "\x00").
>
> >> Stomp PHP Extension (http://pecl.php.net/package/stomp):both send
> >> and receive do not work (no errors, but works fine with ActiveMQ,
> >> incidentally).
>
> >> Zend Stomp: sends and receives, though doesn't appear to coexist
> >> with queues of the same name (and vhost) used by other
> >> producers/consumers.
>
> >> Thanks,
>
> >> -gavin
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.com
> >>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gavinbutler at hushmail.com  Mon Nov 15 20:28:56 2010
From: gavinbutler at hushmail.com (Gavin Butler)
Date: Mon, 15 Nov 2010 12:28:56 -0800 (PST)
Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
In-Reply-To: <6294CCE6B4CE7D4D81822D7408E0D6570F979CB5EF@ECHOEXCC1.SATS.CORP>
References: <20101114210751.544EF32A761@smtp.hushmail.com>
	<6294CCE6B4CE7D4D81822D7408E0D6570F979CB5EF@ECHOEXCC1.SATS.CORP>
Message-ID: <9d551e87-839e-4b42-b558-fde9b55b614a@35g2000prb.googlegroups.com>

Here's the output from the test script that is bundled with the
project.  I haven't really made an effort to debug this though.

Just in case there is any uncertainty, this is from the pure PHP
project hosted here: http://code.google.com/p/php-amqplib/ ; the other
pure PHP project suggested by Alvaro (https://github.com/tnc/php-
amqplib) works perfectly.

We're going to use Alvaro's suggestion, but if you or anyone else wish
to debug further with our environment setup, I will gladly help with
that.

Thanks,

-gavin


amqp_test.php output:

Creating connection
< [hex]:
0000  41 4D 51 50 01 01 09 01                            AMQP....

waiting for 10,10
waiting for a new frame
PHP Warning:  feof() expects parameter 1 to be resource, object given
in /root/php-amqplib-read-only/amqp_wire.inc on line 302
PHP Warning:  fread() expects parameter 1 to be resource, object given
in /root/php-amqplib-read-only/amqp_wire.inc on line 303
Caught exception: Error reading data. Recevived 0 instead of expected
1 bytes
Trace:
#0 /root/php-amqplib-read-only/amqp_wire.inc(348): AMQPReader-
>rawread(1)
#1 /root/php-amqplib-read-only/amqp.inc(494): AMQPReader->read_octet()
#2 /root/php-amqplib-read-only/amqp.inc(514): AMQPConnection-
>wait_frame()
#3 /root/php-amqplib-read-only/amqp.inc(166): AMQPConnection-
>wait_channel(0)
#4 /root/php-amqplib-read-only/amqp.inc(251): AbstractChannel-
>next_frame()
#5 /root/php-amqplib-read-only/amqp.inc(350): AbstractChannel-
>wait(Array)
#6 /root/php-amqplib-read-only/amqp_test.php(21): AMQPConnection-
>__construct('test-rabbbitmq', 5672, 'guest', 'guest')
#7 {main}< [hex]:
0000  01 00 00 00 00 00 0B 00  0A 00 3C 00 00 00 00
00   ........ ..<.....
0010  00 00 CE                                           ..?

< 10,60: Connection.close
waiting for 10,61
waiting for a new frame
PHP Warning:  feof() expects parameter 1 to be resource, object given
in /root/php-amqplib-read-only/amqp_wire.inc on line 302
PHP Warning:  fread() expects parameter 1 to be resource, object given
in /root/php-amqplib-read-only/amqp_wire.inc on line 303
PHP Fatal error:  Exception thrown without a stack frame in Unknown on
line 0

On Nov 15, 7:24?am, "Schlomer, Loren" <Loren.Schlo... at echostar.com>
wrote:
> I have good luck sending JSON with the pure PHP AMQP lib. ?What errors are you seeing?
>
> ________________________________________
> From: rabbitmq-discuss-boun... at lists.rabbitmq.com [rabbitmq-discuss-boun... at lists.rabbitmq.com] On Behalf Of Gavin Butler [gavinbut... at hushmail.com]
> Sent: Sunday, November 14, 2010 2:07 PM
> To: rabbitmq-disc... at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Working PHP impl. to send and receive?
>
> Hello list,
>
> Has anyone had success using a AMQP or Stomp PHP client to both
> send and receive messages from RabbitMQ? ?If so, please could you
> post the version of the client/library, and various dependency
> versions?
>
> Our RabbitMQ version is 2.1.0, and we have had varying degrees of
> success with AMQP and Stomp (if anyone would like more details, I
> will gladly provide them):
>
> RabbitMQ-C library extensions (http://code.google.com/p/php-amqp/,http://code.google.com/p/php-rabbit/):both sent messages with no
> problems, though get or consume failed to retrieve any message
> content.
>
> Pure PHP AMQP (http://code.google.com/p/php-amqplib/):an
> assortment of errors sending.
>
> Fusesource Stomp client
> (http://stomp.fusesource.org/documentation/php/index.html):send
> and subscribe works, though ack does not (invalid body
> terminator...which seems ok: "\x00").
>
> Stomp PHP Extension (http://pecl.php.net/package/stomp):both send
> and receive do not work (no errors, but works fine with ActiveMQ,
> incidentally).
>
> Zend Stomp: sends and receives, though doesn't appear to coexist
> with queues of the same name (and vhost) used by other
> producers/consumers.
>
> Thanks,
>
> -gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From adamka at dgt.com.pl  Tue Nov 16 11:46:31 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Tue, 16 Nov 2010 12:46:31 +0100
Subject: [rabbitmq-discuss] consume messages from exchanges
In-Reply-To: <AANLkTin5mq0P2NUaJ03iu1YdeoawYB05HcZey9V5ND7+@mail.gmail.com>
References: <4CD13437.5070002@dgt.com.pl>	<4CD7DD4E.7070102@dgt.com.pl>	<4CD80A0E.3060504@dgt.com.pl>	<4CD92659.4080008@dgt.com.pl>	<4CD950BB.60304@dgt.com.pl>	<20101109140001.GE22102@rabbitmq.com>	<4CD955EB.3060909@dgt.com.pl>	<20101109141914.GF22102@rabbitmq.com>	<4CD95B81.5070405@dgt.com.pl>	<20101109144514.GG22102@rabbitmq.com>	<4CD99055.10005@dgt.com.pl>	<4CE11CE5.30606@dgt.com.pl>
	<AANLkTin5mq0P2NUaJ03iu1YdeoawYB05HcZey9V5ND7+@mail.gmail.com>
Message-ID: <4CE26F17.4000003@dgt.com.pl>

Thanks for reply and nice tutorial.

Can anybody explain me some variables:
passive
exclusive
nowait


Regards,
     Adam


W dniu 2010-11-15 20:25, Marek Majkowski pisze:
> On Mon, Nov 15, 2010 at 11:43, Adam Kaminiecki<adamka at dgt.com.pl>  wrote:
>> Hi,
>> I have got few questions about consumming practises.
>>
>> Which is better, create new consumer for each queues and exchanges when
>> binding or Can I use 1 consumer?
> You can't create 'a consumer for an exchange'.
>
> Except from that, that's pretty common question. It all depends on your
> design. Often you can have a single queue with one consumer
> and a whole bunch of exchanges and bindings. The other time
> it might be better to have a single exchange and many queues.
>
> That's the whole point of AMQP, you can create topology as you need it.
> So start with something simple, that you feel comfortable with.
>
>> How can I change consumer name which is displayed when using    rabbimqctl
>> -q list_consumers? Is it possible??
>> Can I use 1 consumer queue to bind it to more than  1 exchange?
> Yes, a queue can have multiple bindings.
>
> BTW, have you seen our tutorials?
>
> https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-one.md
>
> Cheers,
>    Marek
>

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From majek04 at gmail.com  Tue Nov 16 11:57:41 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 16 Nov 2010 11:57:41 +0000
Subject: [rabbitmq-discuss] consume messages from exchanges
In-Reply-To: <4CE26F17.4000003@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl> <4CD7DD4E.7070102@dgt.com.pl>
	<4CD80A0E.3060504@dgt.com.pl> <4CD92659.4080008@dgt.com.pl>
	<4CD950BB.60304@dgt.com.pl> <20101109140001.GE22102@rabbitmq.com>
	<4CD955EB.3060909@dgt.com.pl> <20101109141914.GF22102@rabbitmq.com>
	<4CD95B81.5070405@dgt.com.pl> <20101109144514.GG22102@rabbitmq.com>
	<4CD99055.10005@dgt.com.pl> <4CE11CE5.30606@dgt.com.pl>
	<AANLkTin5mq0P2NUaJ03iu1YdeoawYB05HcZey9V5ND7+@mail.gmail.com>
	<4CE26F17.4000003@dgt.com.pl>
Message-ID: <AANLkTikPZeZP08bbFO_vAwrRrxiqpryc=EPhmVBcQRNi@mail.gmail.com>

On Tue, Nov 16, 2010 at 11:46, Adam Kaminiecki <adamka at dgt.com.pl> wrote:
> Thanks for reply and nice tutorial.
>
> Can anybody explain me some variables:
> passive

Checks if queue exists.
(passes if the queue does exist, fails when the queue doesn't exist.)

> exclusive
Spec says:
"Exclusive queues may only be accessed by the current connection, and
are deleted when that  connection  closes. Passive declaration of an
exclusive queue by other connections are not allowed. "

> nowait

Async version of queue-declare. The server won't reply with
queue-declare-ok. Rarely useful.

>
>
> Regards,
> ? ?Adam
>
>
> W dniu 2010-11-15 20:25, Marek Majkowski pisze:
>>
>> On Mon, Nov 15, 2010 at 11:43, Adam Kaminiecki<adamka at dgt.com.pl> ?wrote:
>>>
>>> Hi,
>>> I have got few questions about consumming practises.
>>>
>>> Which is better, create new consumer for each queues and exchanges when
>>> binding or Can I use 1 consumer?
>>
>> You can't create 'a consumer for an exchange'.
>>
>> Except from that, that's pretty common question. It all depends on your
>> design. Often you can have a single queue with one consumer
>> and a whole bunch of exchanges and bindings. The other time
>> it might be better to have a single exchange and many queues.
>>
>> That's the whole point of AMQP, you can create topology as you need it.
>> So start with something simple, that you feel comfortable with.
>>
>>> How can I change consumer name which is displayed when using
>>> ?rabbimqctl
>>> -q list_consumers? Is it possible??
>>> Can I use 1 consumer queue to bind it to more than ?1 exchange?
>>
>> Yes, a queue can have multiple bindings.
>>
>> BTW, have you seen our tutorials?
>>
>>
>> https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-one.md
>>
>> Cheers,
>> ? Marek
>>
>
> --
> This message has been scanned for viruses and
> dangerous content by MailScanner, and is
> believed to be clean.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mikeb at rabbitmq.com  Tue Nov 16 12:04:51 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 16 Nov 2010 12:04:51 +0000
Subject: [rabbitmq-discuss] consume messages from exchanges
In-Reply-To: <4CE26F17.4000003@dgt.com.pl>
References: <4CD13437.5070002@dgt.com.pl>	<4CD7DD4E.7070102@dgt.com.pl>	<4CD80A0E.3060504@dgt.com.pl>	<4CD92659.4080008@dgt.com.pl>	<4CD950BB.60304@dgt.com.pl>	<20101109140001.GE22102@rabbitmq.com>	<4CD955EB.3060909@dgt.com.pl>	<20101109141914.GF22102@rabbitmq.com>	<4CD95B81.5070405@dgt.com.pl>	<20101109144514.GG22102@rabbitmq.com>	<4CD99055.10005@dgt.com.pl>	<4CE11CE5.30606@dgt.com.pl>	<AANLkTin5mq0P2NUaJ03iu1YdeoawYB05HcZey9V5ND7+@mail.gmail.com>
	<4CE26F17.4000003@dgt.com.pl>
Message-ID: <4CE27363.2040804@rabbitmq.com>

Hi Adam,

> Can anybody explain me some variables:
> passive

If passive=true, the server will check only that the named exchange or 
queue is present, and raise an error if not.  Note the contrast with 
passive=false, for which an error is raised if the exchange or queue 
*is* present *but* has different properties.

> exclusive

There's two places "exclusive" is used.

In queue.declare, it restricts the scope of the queue to the connection; 
i.e., only the current connection will be able to refer to it.  The one 
exception to this is sending to the default exchange, where an exclusive 
queue name may be given as the routing key.

In basic.consume, it ensures that the connection is the only consumer 
from the given queue.

> nowait

"nowait" means the server should not send a reply to an otherwise 
synchronous method, e.g., queue.declare.  It sounds useful, but often 
there's important information in server responses (including the 
presence of the response).


HTH
Michael

> W dniu 2010-11-15 20:25, Marek Majkowski pisze:
>> On Mon, Nov 15, 2010 at 11:43, Adam Kaminiecki<adamka at dgt.com.pl> wrote:
>>> Hi,
>>> I have got few questions about consumming practises.
>>>
>>> Which is better, create new consumer for each queues and exchanges when
>>> binding or Can I use 1 consumer?
>> You can't create 'a consumer for an exchange'.
>>
>> Except from that, that's pretty common question. It all depends on your
>> design. Often you can have a single queue with one consumer
>> and a whole bunch of exchanges and bindings. The other time
>> it might be better to have a single exchange and many queues.
>>
>> That's the whole point of AMQP, you can create topology as you need it.
>> So start with something simple, that you feel comfortable with.
>>
>>> How can I change consumer name which is displayed when using rabbimqctl
>>> -q list_consumers? Is it possible??
>>> Can I use 1 consumer queue to bind it to more than 1 exchange?
>> Yes, a queue can have multiple bindings.
>>
>> BTW, have you seen our tutorials?
>>
>> https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-one.md
>>
>>
>> Cheers,
>> Marek
>>
>


From jerryk at vmware.com  Tue Nov 16 15:59:00 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 16 Nov 2010 07:59:00 -0800
Subject: [rabbitmq-discuss] Can Java API JsonRpcClient know server not
 exist?
In-Reply-To: <4CE16DAA.1010807@rabbitmq.com>
References: <4CE16DAA.1010807@rabbitmq.com>
Message-ID: <73004BFA-1A71-44D8-A718-D04CBE8136ED@vmware.com>

Hi, Cui...

I'm run RabbitMQ Java client 2.1.1 examples HelloJsonServer and HelloJsonClient. The RabbitMQ Server's version is 2.1.1.
My question is if HelloJsonServer program not running, I start up HelloJsonClient first, the process will be blocked.
Is there a way to set a timeout or exception, when HelloJsonClient send the request and HelloJsonServer not exist the function will throw an exception tell me JsonRpcClient waiting response time out or the request server not exist?

At present neither JsonRpcClient, nor RpcClient which it extends, supports a timeout to stop the constructor from blocking in the way you want.  This would be a nice thing to have, so we'll put it in as a bug/feature request for a future release.

If you want a short term remedy, you could try creating a subclass of JsonRpcClient, in which you have a new constructor that takes your timeout and stores it in a field, and then overriding primitiveCall (which is inherited from RpcClient.java) with a method that calls the version of uninterruptibleGet that takes an integer timeout as its argument rather than the nullary one that's currently called.  Although perhaps not the prettiest thing to have to do in end user code, it will at least get you out of your current situation.

Jerry



From hsaid at plantcml-eads.com  Tue Nov 16 21:26:47 2010
From: hsaid at plantcml-eads.com (Hussein Said)
Date: Tue, 16 Nov 2010 16:26:47 -0500
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com>	<4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com>	<4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com>	<4CDD7CCA.30509@rabbitmq.com>
	<3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com>
	<4CE10242.4040302@rabbitmq.com>
Message-ID: <3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com>

WCF RabbitMQ bindings works great and I am consuming Web services using the RabbitMQ binding with little change to our codebase.
I guess my question is if there are any plans(now or future) to have a custom AXIS2 or JAX-WS Transport for RabbitMQ since they are widely used SOAP stacks. This will greatly benifit the SOAP community so that the adoption of  AMQP is less of a barrier if a native AMQP transport client is available. Spring has one, and OpenAMQP has JMS over RabbitMQ. Also, I noticed on the AMQP org site that 1-0 SOAP Mapping <http://mail.cml.com/confluence/display/AMQP/1-0+SOAP+Mapping>   is proposed, but that may be months before approved and supported.
 
regards
hussein

________________________________

From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Mon 11/15/2010 4:49 AM
To: rabbitmq-discuss at lists.rabbitmq.com; Hussein Said
Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ



Hi Hussein,

On 13/11/10 17:06, Hussein Said wrote:
> Hi,
> I would like to know if there is something equivalent to the WCF
> ServiceModel on the Java side.
> I  have a web service hosted in WCF that calls another web Service
> hosted on Axis2. I was able with relative ease
> To add the RabbitMQ binding on the .net side, and use SOAP as the
> protocol, and RabbitMQ as the transport using the RabbitMQ service model
> libraries. Now I would like to be able to do the same thing from the
> Java side using SOAP. This will allow us to leverage our current
> investments in SOAP, but use RabbitMQ powerful messaging infrastructure
> to transport over Queues.


In theory it should be possible to interoperate using a Java web
services library that speaks the correct flavour of SOAP, but I'm not
aware of anyone trying this using the RabbitMQ WCF binding specifically.
We would be interested to hear the results of your attempt.


Regards

Emile


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101116/5ec226ad/attachment.htm>

From siefert.david at gmail.com  Wed Nov 17 12:37:58 2010
From: siefert.david at gmail.com (David Siefert)
Date: Wed, 17 Nov 2010 06:37:58 -0600
Subject: [rabbitmq-discuss] JMS client impl (javax.jms)
Message-ID: <AANLkTi=7GN6yuEFifwr-s2uuqq7-LW+HxCUGSOe5aE+j@mail.gmail.com>

Hi-

I'm trying to evaluate RabbitMQ w/ Java, and the first thing I notice is
that the AMQP 1.7.2 client I am using does not implement any JMS interfaces.
 Is there support for JMS? and where would I get this driver?

Thanks,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101117/8505efa1/attachment.htm>

From jon.brisbin at npcinternational.com  Wed Nov 17 14:13:34 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 17 Nov 2010 08:13:34 -0600
Subject: [rabbitmq-discuss] JMS client impl (javax.jms)
In-Reply-To: <AANLkTi=7GN6yuEFifwr-s2uuqq7-LW+HxCUGSOe5aE+j@mail.gmail.com>
References: <AANLkTi=7GN6yuEFifwr-s2uuqq7-LW+HxCUGSOe5aE+j@mail.gmail.com>
Message-ID: <F499E156-D470-4111-849D-72B8F10CAF04@npcinternational.com>


On Nov 17, 2010, at 6:37 AM, David Siefert wrote:

> I'm trying to evaluate RabbitMQ w/ Java, and the first thing I notice is that the AMQP 1.7.2 client I am using does not implement any JMS interfaces.  Is there support for JMS? and where would I get this driver?

I see tonyg mentioned last year success with the OpenAMQ AMQP JMS client:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-March/003167.html

But I think most people who use RabbitMQ prefer not to be bound by the JMS API and make more full use of AMQP. Spring Integration has some tools to make working between the two environments easier:

http://www.springsource.org/spring-integration

For my own 2 cents: if you want JMS, use a JMS broker like ActiveMQ or something. If you're using RabbitMQ, you're doing it because AMQP has things that JMS doesn't that make the latter better than the former. If you have to stick with JMS because there's a line in the sand somewhere you can't cross, I'd almost say just stick with the brokers that more JMS-centric.

I love RabbitMQ for everything and I use the Java client. I've found JMS too simplistic and I've now moved to using the spring-amqp abstraction on top of the plain Java client:

http://www.springsource.org/spring-amqp

If you're starting from scratch, then you owe it to yourself to try this route first. You'll be more successful in the end. I know this from experience. ;)

Jon Brisbin
Portal Webmaster
NPC International, Inc.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101117/11995b05/attachment.htm>

From adamka at dgt.com.pl  Wed Nov 17 15:00:09 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Wed, 17 Nov 2010 16:00:09 +0100
Subject: [rabbitmq-discuss]  format
In-Reply-To: <F499E156-D470-4111-849D-72B8F10CAF04@npcinternational.com>
References: <AANLkTi=7GN6yuEFifwr-s2uuqq7-LW+HxCUGSOe5aE+j@mail.gmail.com>
	<F499E156-D470-4111-849D-72B8F10CAF04@npcinternational.com>
Message-ID: <4CE3EDF9.4080005@dgt.com.pl>

Hi,

Can anybody tell me about format of an Expiration property in 
IBasicProperties beacasue its string type in C#. Is it in miliseconds?



Regards,
Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From pzfreo at gmail.com  Wed Nov 17 15:11:09 2010
From: pzfreo at gmail.com (Paul Fremantle)
Date: Wed, 17 Nov 2010 15:11:09 +0000
Subject: [rabbitmq-discuss] JMS client impl (javax.jms)
In-Reply-To: <F499E156-D470-4111-849D-72B8F10CAF04@npcinternational.com>
References: <AANLkTi=7GN6yuEFifwr-s2uuqq7-LW+HxCUGSOe5aE+j@mail.gmail.com>
	<F499E156-D470-4111-849D-72B8F10CAF04@npcinternational.com>
Message-ID: <AANLkTimDvNDtWZ3vuFaWZMyK+hTne0b4-UMW-hgbabsC@mail.gmail.com>

> For my own 2 cents: if you want JMS, use a JMS broker like ActiveMQ or
> something. If you're using RabbitMQ, you're doing it because AMQP has things
> that JMS doesn't that make the latter better than the former. If you have to
> stick with JMS because there's a line in the sand somewhere you can't cross,
> I'd almost say just stick with the brokers that more JMS-centric.

I understand your opinion Jon, but my own 2 cents are completely
different. JMS offers a well-understood abstraction to a programming
model. There are some pain points (JNDI), but its very widely used and
adopted. The AMQP working group spent a lot of time ensuring that JMS
can be implemented on top of AMQP. There are a lot of reasons why to
use JMS/AMQP:

1) Interop with other languages. Because AMQP has clearly defined and
published semantics and a mapping of those to JMS then it makes a good
model where JMS users can use what they know and AMQP users what they
know but everyone can talk.
2) Migration from an existing JMS broker: Users who are using JMS
today may want to position themselves for AMQP in the future.
3) Integration with standard software (e.g. ESBs) that already talk via JMS APIs
4) People who actually like JMS but want the performance, standards
basis, etc of AMQP.
5) People who want to outsource their broker to StormMQ and keep
existing JMS code.

Paul


-- 
Paul Fremantle
Co-Founder and CTO, WSO2
Apache Synapse PMC Chair
OASIS WS-RX TC Co-chair

blog: http://pzf.fremantle.org
paul at wso2.com

"Oxygenating the Web Service Platform", www.wso2.com

From jon.brisbin at npcinternational.com  Wed Nov 17 15:34:04 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 17 Nov 2010 09:34:04 -0600
Subject: [rabbitmq-discuss] JMS client impl (javax.jms)
In-Reply-To: <AANLkTimDvNDtWZ3vuFaWZMyK+hTne0b4-UMW-hgbabsC@mail.gmail.com>
References: <AANLkTi=7GN6yuEFifwr-s2uuqq7-LW+HxCUGSOe5aE+j@mail.gmail.com>
	<F499E156-D470-4111-849D-72B8F10CAF04@npcinternational.com>
	<AANLkTimDvNDtWZ3vuFaWZMyK+hTne0b4-UMW-hgbabsC@mail.gmail.com>
Message-ID: <FEB33178-51E1-4E87-BD66-43AC8A03C5F4@npcinternational.com>

I think this topic can quickly digress into a religious war of "my API is better than your API". I don't want to send us down that road. ;)

Suffice it to say that I try and encourage people to ask the "why am I doing it this way" question as often as possible (because I ask myself that question on every project...can I do it better this time than I did last time, etc...). If it's because we don't have time or money to do any differently, that's a perfectly legitimate business decision. We do that here quite a bit, unfortunately. But if you're going down a different road altogether (AMQP), it often pays to get the larger perspective and, just because it *can* be done a certain way doesn't mean it *should*.

And don't get me started on ESBs! :) We're working on an ESB project right now and I'm amazed at how much stimulation of India's economy we're doing by paying these people to construct fantastically complicated systems of webservices and such to do simple things that can more efficiently and easily be done without the overhead imposed by the ESB paradigm. 

But that's another religious war I don't want to inflame! ;)

Jon Brisbin
Portal Webmaster
NPC International, Inc.


On Nov 17, 2010, at 9:11 AM, Paul Fremantle wrote:

>> For my own 2 cents: if you want JMS, use a JMS broker like ActiveMQ or
>> something. If you're using RabbitMQ, you're doing it because AMQP has things
>> that JMS doesn't that make the latter better than the former. If you have to
>> stick with JMS because there's a line in the sand somewhere you can't cross,
>> I'd almost say just stick with the brokers that more JMS-centric.
> 
> I understand your opinion Jon, but my own 2 cents are completely
> different. JMS offers a well-understood abstraction to a programming
> model. There are some pain points (JNDI), but its very widely used and
> adopted. The AMQP working group spent a lot of time ensuring that JMS
> can be implemented on top of AMQP. There are a lot of reasons why to
> use JMS/AMQP:
> 
> 1) Interop with other languages. Because AMQP has clearly defined and
> published semantics and a mapping of those to JMS then it makes a good
> model where JMS users can use what they know and AMQP users what they
> know but everyone can talk.
> 2) Migration from an existing JMS broker: Users who are using JMS
> today may want to position themselves for AMQP in the future.
> 3) Integration with standard software (e.g. ESBs) that already talk via JMS APIs
> 4) People who actually like JMS but want the performance, standards
> basis, etc of AMQP.
> 5) People who want to outsource their broker to StormMQ and keep
> existing JMS code.
> 
> Paul
> 
> 
> -- 
> Paul Fremantle
> Co-Founder and CTO, WSO2
> Apache Synapse PMC Chair
> OASIS WS-RX TC Co-chair
> 
> blog: http://pzf.fremantle.org
> paul at wso2.com
> 
> "Oxygenating the Web Service Platform", www.wso2.com






From ovidiudeac at gmail.com  Thu Nov 18 00:27:15 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 18 Nov 2010 02:27:15 +0200
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
	working?
Message-ID: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>

I'm using rabbitmq 1.8.0 with .NET client.

I have a persistent queue and I want to delete it using the the following code:

IModel Channel;
...
Channel.QueueDelete(Queue,false, false, false);

Any idea why this doesn't work?

I also tried various combinations of parameters but the result was the same.

thanks,
ovidiu

From matthias at rabbitmq.com  Thu Nov 18 04:50:30 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Nov 2010 04:50:30 +0000
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
 working?
In-Reply-To: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>
Message-ID: <4CE4B096.5010605@rabbitmq.com>

Ovidiu,

Ovidiu Deac wrote:
> I have a persistent queue and I want to delete it using the the following code:
> ...
> Channel.QueueDelete(Queue,false, false, false);
> 
> Any idea why this doesn't work?
> 
> I also tried various combinations of parameters but the result was the same.

What was the result? Did you get an error? Is there anything in the 
server logs?

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Nov 18 05:16:14 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Nov 2010 05:16:14 +0000
Subject: [rabbitmq-discuss] beam.smp takes a lot of CPU and memory
In-Reply-To: <AANLkTimh+52PX6+eDVYf0FpPQ+XVBk17B2yxyiXKQ0nk@mail.gmail.com>
References: <AANLkTimh+52PX6+eDVYf0FpPQ+XVBk17B2yxyiXKQ0nk@mail.gmail.com>
Message-ID: <4CE4B69E.6040505@rabbitmq.com>

Mutaz,

Mutaz Qasem wrote:
> There are few already. a message every hour! Please advise

Rabbit certainly shouldn't be consuming 70-90% of the CPU when handling 
just a few messages an hour.

What do 'rabbitmqctl list_queues' and 'rabbitmqctl list_connections' show?

Also, 1.8.1 is quite old. Please upgrade to the latest version. While I 
don't recall any bug fixes in relation to the problem you are 
describing, it will be much easier to identify the cause if you can 
reproduce the behaviour in the current rabbit release.

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Nov 18 05:21:09 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Nov 2010 05:21:09 +0000
Subject: [rabbitmq-discuss] Two rabbitmq servers in one cluster,
 if one is down, the requests on the other one are blocked.
In-Reply-To: <AANLkTikZXftF5CK=7NkLy+1H_tX4zjg9KJ_k6ykLC+be@mail.gmail.com>
References: <AANLkTikZXftF5CK=7NkLy+1H_tX4zjg9KJ_k6ykLC+be@mail.gmail.com>
Message-ID: <4CE4B7C5.2090802@rabbitmq.com>

Dikang,

Dikang Gu wrote:
> As per subject. Do you have any suggestions about how to solve this?

Can you elaborate on what you are doing? Exactly how does the problem 
manifest itself?


Regards,

Matthias.

From matthias at rabbitmq.com  Thu Nov 18 05:49:19 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Nov 2010 05:49:19 +0000
Subject: [rabbitmq-discuss] ll_alloc errors on RabbitMQ 2.1.1
In-Reply-To: <AANLkTikTphxZegPGwzZ6C-54u+9RVYN0aX0Pqn5pXoQv@mail.gmail.com>
References: <AANLkTi=2R-i56ASN2M8Eu2TTWHuCXSPhY9rdnH9aVvNt@mail.gmail.com>	<20101115113130.GB9393@wellquite.org>
	<AANLkTikTphxZegPGwzZ6C-54u+9RVYN0aX0Pqn5pXoQv@mail.gmail.com>
Message-ID: <4CE4BE5F.6030703@rabbitmq.com>

Manuel,

Manuel DE FERRAN wrote:
> On Mon, Nov 15, 2010 at 12:31 PM, Matthew Sackman <matthew at rabbitmq.com 
> <mailto:matthew at rabbitmq.com>> wrote:
> 
>     Howdy,
> 
>     On Mon, Nov 15, 2010 at 11:56:25AM +0100, Manuel DE FERRAN wrote:
>      > recently we upgraded to version 2.1.1. We picked up the official
>     debian
>      > package, and installed it on a debian lenny. And we face problems
>     of memory
>      > allocation 'll_alloc: Cannot allocate 486539264 bytes of memory
>     (of type
>      > "port_tab")' when invoking rabbitmqctl.
> 
>     How much RAM is installed in the machine? How much is available? Have
>     you performed any configuration of Rabbit such as altering the
>     vm_high_memory_watermark value? Is it a 32-bit or 64-bit installation?
> 
> 
> 
> 1.5 GB is assigned to this machine (that's a xen virtual machine). There 
> is more than 500MB of available memory. We released up to 1GB, and that 
> did not fix the issue.
> 
> We are using the default configuration, means no configuration at all.
> 
> And that's a 64 bits installation, we grabbed the debian package from 
> http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/.

So the rabbitmq-server itself is running fine and you only encounter 
problems with rabbitmqctl? Strange indeed.

What version of Erlang is running on that machine?

Looking at the Erlang source code, the error would appear to crop up 
when the operating system is configured with a very high file descriptor 
limit. What does 'ulimit -n' report? (NB: you should run that as the 
'rabbitmq' user). If the figure is in the many millions, I suggest you 
set a lower limit in the o/s config. Alternativly, set the ERL_MAX_PORTS 
environment variable.

I wonder whether there is some strange hypervisor interaction going on. 
Could you perhaps try a different kind of VM?


Regards,

Matthias.

From mdeferran at ubikod.com  Thu Nov 18 08:09:24 2010
From: mdeferran at ubikod.com (Manuel DE FERRAN)
Date: Thu, 18 Nov 2010 09:09:24 +0100
Subject: [rabbitmq-discuss] ll_alloc errors on RabbitMQ 2.1.1
In-Reply-To: <4CE4BE5F.6030703@rabbitmq.com>
References: <AANLkTi=2R-i56ASN2M8Eu2TTWHuCXSPhY9rdnH9aVvNt@mail.gmail.com>
	<20101115113130.GB9393@wellquite.org>
	<AANLkTikTphxZegPGwzZ6C-54u+9RVYN0aX0Pqn5pXoQv@mail.gmail.com>
	<4CE4BE5F.6030703@rabbitmq.com>
Message-ID: <AANLkTikhEguxRH9_xE_pVNhmEpAUeYJSsXfhK7wa2C4=@mail.gmail.com>

(inline)

On Thu, Nov 18, 2010 at 6:49 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Manuel,
>
> Manuel DE FERRAN wrote:
>
>  On Mon, Nov 15, 2010 at 12:31 PM, Matthew Sackman <matthew at rabbitmq.com<mailto:
>> matthew at rabbitmq.com>> wrote:
>>
>>    Howdy,
>>
>>    On Mon, Nov 15, 2010 at 11:56:25AM +0100, Manuel DE FERRAN wrote:
>>     > recently we upgraded to version 2.1.1. We picked up the official
>>    debian
>>     > package, and installed it on a debian lenny. And we face problems
>>    of memory
>>     > allocation 'll_alloc: Cannot allocate 486539264 bytes of memory
>>    (of type
>>     > "port_tab")' when invoking rabbitmqctl.
>>
>>    How much RAM is installed in the machine? How much is available? Have
>>    you performed any configuration of Rabbit such as altering the
>>    vm_high_memory_watermark value? Is it a 32-bit or 64-bit installation?
>>
>>
>>
>> 1.5 GB is assigned to this machine (that's a xen virtual machine). There
>> is more than 500MB of available memory. We released up to 1GB, and that did
>> not fix the issue.
>>
>> We are using the default configuration, means no configuration at all.
>>
>> And that's a 64 bits installation, we grabbed the debian package from
>> http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/.
>>
>
> So the rabbitmq-server itself is running fine and you only encounter
> problems with rabbitmqctl? Strange indeed.
>
> What version of Erlang is running on that machine?
>

"erl" returns following header :
Erlang R13B04 (erts-5.7.5) [source] [64-bit] [rq:1] [async-threads:0]
[kernel-poll:false]

Erlang has been installed from official debian lenny package, the exact
version is 1:13.b.4-dfsg-5.



> Looking at the Erlang source code, the error would appear to crop up when
> the operating system is configured with a very high file descriptor limit.
> What does 'ulimit -n' report? (NB: you should run that as the 'rabbitmq'
> user). If the figure is in the many millions, I suggest you set a lower
> limit in the o/s config. Alternativly, set the ERL_MAX_PORTS environment
> variable.
>
>
That's a good point. The ulimit was returning about 600k as open file limit.
We lowered it to about 32k and so far we can not reproduce the problem.



> I wonder whether there is some strange hypervisor interaction going on.
> Could you perhaps try a different kind of VM?
>
>
Yes probably, we will try it if it fails again. Thanks !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101118/fa976bc3/attachment.htm>

From sriram.varahan at gmail.com  Thu Nov 18 11:52:40 2010
From: sriram.varahan at gmail.com (sriramv)
Date: Thu, 18 Nov 2010 03:52:40 -0800 (PST)
Subject: [rabbitmq-discuss] Get a list of running nodes in RabbitMQ cluster
Message-ID: <30247070.post@talk.nabble.com>


Hello,

        I have set up a RabbitMQ cluster consisting of 2 nodes. I need to
retrieve the running nodes on the cluster.

One way of doing this would be to run 'rabbitmqctl list_queues' on either of
these nodes.

What if I want to remotely(a client) fetch this information from either of
these nodes. The reason for this is I am implementing HA on the client side
rather than on RabbitMQ server. So in case one of the nodes goes down I will
know the other one running and can connect to this.

Any suggestion for achieving this functionality.

Thanks,
Sriram.
-- 
View this message in context: http://old.nabble.com/Get-a-list-of-running-nodes-in-RabbitMQ-cluster-tp30247070p30247070.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Thu Nov 18 12:07:15 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Nov 2010 12:07:15 +0000
Subject: [rabbitmq-discuss] Get a list of running nodes in RabbitMQ
	cluster
In-Reply-To: <30247070.post@talk.nabble.com>
References: <30247070.post@talk.nabble.com>
Message-ID: <4CE516F3.6010107@rabbitmq.com>

On 18/11/10 11:52, sriramv wrote:
> What if I want to remotely(a client) fetch this information from either of
> these nodes. The reason for this is I am implementing HA on the client side
> rather than on RabbitMQ server. So in case one of the nodes goes down I will
> know the other one running and can connect to this.
>
> Any suggestion for achieving this functionality.

Hi Sriramv.

The *next* release of the management plugin will include this 
functionality in the usual JSON-over-HTTP way. Unfortunately it's not in 
2.1.1. If you're happy to build everything from Mercurial yourself you 
can have it now though; it;s on default.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Thu Nov 18 12:08:31 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 18 Nov 2010 12:08:31 +0000
Subject: [rabbitmq-discuss] Get a list of running nodes in RabbitMQ
 cluster
In-Reply-To: <30247070.post@talk.nabble.com>
References: <30247070.post@talk.nabble.com>
Message-ID: <20101118120830.GH17656@rabbitmq.com>

On Thu, Nov 18, 2010 at 03:52:40AM -0800, sriramv wrote:
>         I have set up a RabbitMQ cluster consisting of 2 nodes. I need to
> retrieve the running nodes on the cluster.

rabbitmqctl status

> What if I want to remotely(a client) fetch this information from either of
> these nodes. The reason for this is I am implementing HA on the client side
> rather than on RabbitMQ server. So in case one of the nodes goes down I will
> know the other one running and can connect to this.
> 
> Any suggestion for achieving this functionality.

There are a couple of ways of doing this. One would be DNS changes,
driven by something like pacemaker which responds to the failure of one
node. Another is to just preload the clients with the necessary host
names and have them try each host in order. Another would be to stick a
plain TCP load balancer in front and have it monitor the nodes and proxy
TCP connections through as necessary.

Matthew

From majek04 at gmail.com  Thu Nov 18 13:22:29 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 18 Nov 2010 13:22:29 +0000
Subject: [rabbitmq-discuss] format
In-Reply-To: <4CE3EDF9.4080005@dgt.com.pl>
References: <AANLkTi=7GN6yuEFifwr-s2uuqq7-LW+HxCUGSOe5aE+j@mail.gmail.com>
	<F499E156-D470-4111-849D-72B8F10CAF04@npcinternational.com>
	<4CE3EDF9.4080005@dgt.com.pl>
Message-ID: <AANLkTin30arDasjsfHutghCgqHQ_6XpX1=BJjzqpC_iN@mail.gmail.com>

On Wed, Nov 17, 2010 at 15:00, Adam Kaminiecki <adamka at dgt.com.pl> wrote:
> Hi,
>
> Can anybody tell me about format of an Expiration property in
> IBasicProperties beacasue its string type in C#. Is it in miliseconds?

0-9-1 spec defines 'expiration' property as a short string.
Rabbit ignores its value (we don't support message expiration).


Marek

From aaron at agoragames.com  Thu Nov 18 16:23:23 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 18 Nov 2010 11:23:23 -0500
Subject: [rabbitmq-discuss] rabbitmqctl script complaints
Message-ID: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>

It's been awhile since I tried to run the debian package release
builds of rabbitmq.  In setting up my new workstation, I opted for
this route rather than source to see how I fared.

It was smooth except for this bit in /usr/sbin/rabbitmqctl:

if [ `id -u` = 0 ] ; then
    su rabbitmq -s /bin/sh -c "/usr/lib/rabbitmq/bin/${SCRIPT} ${CMDLINE}"
elif [ `id -u` = `id -u rabbitmq` ] ; then
    /usr/lib/rabbitmq/bin/${SCRIPT} "$@"
else
    /usr/lib/rabbitmq/bin/${SCRIPT}
    echo
    echo "Only root or rabbitmq should run ${SCRIPT}"
    echo
    exit 1
fi

This is rather unfortunate because as I noted in my blog post,
http://blog.agoragames.com/2010/07/28/grabbing-the-rabbit-by-the-horns/,
it is possible through /etc/rabbitmq/rabbitmq.conf to avoid the
sudo-is-required caveat.  This is beneficial in both development and
production environments, where non-sudo access is routine for
application developers.

Any chance this can be fixed in the next release?

cheers,
Aaron

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From emile at rabbitmq.com  Thu Nov 18 16:28:35 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 18 Nov 2010 16:28:35 +0000
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com>	<4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com>	<4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com>	<4CDD7CCA.30509@rabbitmq.com>
	<3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com>
	<4CE10242.4040302@rabbitmq.com>
	<3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com>
Message-ID: <4CE55433.6070805@rabbitmq.com>


Hi Hussein,

Thanks for your question. The RabbitMQ team do not have any immediate
plans to add a Java SOAP stack, but that could change if there is
sufficient demand.

I'm copying in Mark Pollack who may know whether anything related is
planned for Spring-AMQP.


Regards

Emile



On 16/11/10 21:26, Hussein Said wrote:
> WCF RabbitMQ bindings works great and I am consuming Web services using
> the RabbitMQ binding with little change to our codebase.
> I guess my question is if there are any plans(now or future) to have a
> custom AXIS2 or JAX-WS Transport for RabbitMQ since they are widely used
> SOAP stacks. This will greatly benifit the SOAP community so that the
> adoption of  AMQP is less of a barrier if a native AMQP transport client
> is available. Spring has one, and OpenAMQP has JMS over RabbitMQ. Also,
> I noticed on the AMQP org site that 1-0 SOAP Mapping
> <http://mail.cml.com/confluence/display/AMQP/1-0+SOAP+Mapping>  is
> proposed, but that may be months before approved and supported.
>  
> regards
> hussein
> 
> ------------------------------------------------------------------------
> *From:* Emile Joubert [mailto:emile at rabbitmq.com]
> *Sent:* Mon 11/15/2010 4:49 AM
> *To:* rabbitmq-discuss at lists.rabbitmq.com; Hussein Said
> *Subject:* Re: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> Hi Hussein,
> 
> On 13/11/10 17:06, Hussein Said wrote:
>> Hi,
>> I would like to know if there is something equivalent to the WCF
>> ServiceModel on the Java side.
>> I  have a web service hosted in WCF that calls another web Service
>> hosted on Axis2. I was able with relative ease
>> To add the RabbitMQ binding on the .net side, and use SOAP as the
>> protocol, and RabbitMQ as the transport using the RabbitMQ service model
>> libraries. Now I would like to be able to do the same thing from the
>> Java side using SOAP. This will allow us to leverage our current
>> investments in SOAP, but use RabbitMQ powerful messaging infrastructure
>> to transport over Queues.
> 
> 
> In theory it should be possible to interoperate using a Java web
> services library that speaks the correct flavour of SOAP, but I'm not
> aware of anyone trying this using the RabbitMQ WCF binding specifically.
> We would be interested to hear the results of your attempt.
> 
> 
> Regards
> 
> Emile
> 


-- 
Emile Joubert

RabbitMQ
SpringSource, a division of VMware

From simon at rabbitmq.com  Thu Nov 18 16:30:19 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Nov 2010 16:30:19 +0000
Subject: [rabbitmq-discuss] rabbitmqctl script complaints
In-Reply-To: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>
References: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>
Message-ID: <4CE5549B.1040404@rabbitmq.com>

On 18/11/10 16:23, Aaron Westendorf wrote:
> It's been awhile since I tried to run the debian package release
> builds of rabbitmq.  In setting up my new workstation, I opted for
> this route rather than source to see how I fared.
>
> It was smooth except for this bit in /usr/sbin/rabbitmqctl:

<snip>

The /usr/sbin/rabbitmqctl which ships with the RPM / Debian packages is 
only a wrapper, there to enforce the root requirement and su to the 
rabbitmq user for people who've installed RabbitMQ the normal way and 
don't want to care about Erlang cookies.

If you Know What You Are Doing and want to sidestep all that, the 
unwrapped rabbitmqctl script can be found at 
/usr/lib/rabbitmq/bin/rabbitmqctl instead.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From aaron at agoragames.com  Thu Nov 18 16:42:12 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 18 Nov 2010 11:42:12 -0500
Subject: [rabbitmq-discuss] rabbitmqctl script complaints
In-Reply-To: <4CE5549B.1040404@rabbitmq.com>
References: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>
	<4CE5549B.1040404@rabbitmq.com>
Message-ID: <AANLkTinmAvX1VU-N8ogL4tbJKVKm4FGVhnqRPvZxs5ie@mail.gmail.com>

Yes, but then one has to start editing their PATH, which is not always
a pleasant task in a large production deploy.  The default install can
be made flexible enough to support more use cases than it currently
does.  One way to do that would be to exec the
/usr/lib/rabbitmq/bin/rabbitmqctl and only on failure, print out the
note that one should switch user if they are not root or rabbitmq.

cheers,
Aaron

On Thu, Nov 18, 2010 at 11:30 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>
> The /usr/sbin/rabbitmqctl which ships with the RPM / Debian packages is only
> a wrapper, there to enforce the root requirement and su to the rabbitmq user
> for people who've installed RabbitMQ the normal way and don't want to care
> about Erlang cookies.
>
> If you Know What You Are Doing and want to sidestep all that, the unwrapped
> rabbitmqctl script can be found at /usr/lib/rabbitmq/bin/rabbitmqctl
> instead.
>
> Cheers, Simon


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From simon at rabbitmq.com  Thu Nov 18 16:42:28 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Nov 2010 16:42:28 +0000
Subject: [rabbitmq-discuss] rabbitmqctl script complaints
In-Reply-To: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>
References: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>
Message-ID: <4CE55774.3030800@rabbitmq.com>

On 18/11/10 16:23, Aaron Westendorf wrote:
> This is rather unfortunate because as I noted in my blog post,
> http://blog.agoragames.com/2010/07/28/grabbing-the-rabbit-by-the-horns/,
> it is possible through /etc/rabbitmq/rabbitmq.conf to avoid the
> sudo-is-required caveat.

Having now read your blog post, I should also do my usual thing of 
pimping the management plugin - if you want to offer the equivalent of 
rabbitmqctl status or rabbitmqctl list_queues to non-root, non-local 
users, the management plugin can do that. It even comes with a command 
line tool now.

And I think you should carefully lock down access to things like 
rabbitmqctl stop and rabbitmqctl reset, but that may just be me :)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jerryk at vmware.com  Thu Nov 18 16:46:03 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 18 Nov 2010 08:46:03 -0800
Subject: [rabbitmq-discuss] rabbitmqctl script complaints
In-Reply-To: <4CE55774.3030800@rabbitmq.com>
References: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>
	<4CE55774.3030800@rabbitmq.com>
Message-ID: <4E31E408-B721-4C84-8ACA-49DEDA07C9F3@vmware.com>

I can second that...  Simon introduced me to the management plugin just this week, and it's very convenient to use.  Also the command line tool outputs a number of things in a somewhat nicer to read format than the corresponding functionality in rabbitmqctl.

On Nov 18, 2010, at 4:42 PM, Simon MacMullen wrote:

> On 18/11/10 16:23, Aaron Westendorf wrote:
>> This is rather unfortunate because as I noted in my blog post,
>> http://blog.agoragames.com/2010/07/28/grabbing-the-rabbit-by-the-horns/,
>> it is possible through /etc/rabbitmq/rabbitmq.conf to avoid the
>> sudo-is-required caveat.
> 
> Having now read your blog post, I should also do my usual thing of 
> pimping the management plugin - if you want to offer the equivalent of 
> rabbitmqctl status or rabbitmqctl list_queues to non-root, non-local 
> users, the management plugin can do that. It even comes with a command 
> line tool now.
> 
> And I think you should carefully lock down access to things like 
> rabbitmqctl stop and rabbitmqctl reset, but that may just be me :)
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Nov 18 16:47:24 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Nov 2010 16:47:24 +0000
Subject: [rabbitmq-discuss] rabbitmqctl script complaints
In-Reply-To: <AANLkTinmAvX1VU-N8ogL4tbJKVKm4FGVhnqRPvZxs5ie@mail.gmail.com>
References: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>	<4CE5549B.1040404@rabbitmq.com>
	<AANLkTinmAvX1VU-N8ogL4tbJKVKm4FGVhnqRPvZxs5ie@mail.gmail.com>
Message-ID: <4CE5589C.7040905@rabbitmq.com>

On 18/11/10 16:42, Aaron Westendorf wrote:
> Yes, but then one has to start editing their PATH, which is not always
> a pleasant task in a large production deploy.

Well, the wrapper shell script you mention in the blog post could 
reference the real rabbitmqctl.

> The default install can
> be made flexible enough to support more use cases than it currently
> does.  One way to do that would be to exec the
> /usr/lib/rabbitmq/bin/rabbitmqctl and only on failure, print out the
> note that one should switch user if they are not root or rabbitmq.

Ah, I see.

It would be nice to distinguish failure caused by the wrong Erlang 
cookie from other types of failure, but this makes some sense. I'll open 
a bug.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From mpollack at vmware.com  Thu Nov 18 17:16:09 2010
From: mpollack at vmware.com (Mark Pollack)
Date: Thu, 18 Nov 2010 09:16:09 -0800
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <4CE55433.6070805@rabbitmq.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com>
	<4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com>
	<4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com>
	<4CDD7CCA.30509@rabbitmq.com>
	<3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com>
	<4CE10242.4040302@rabbitmq.com>
	<3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com>
	<4CE55433.6070805@rabbitmq.com>
Message-ID: <806F700D7E08E9408413160B05EB66672A49A3D406@EXCH-MBX-1.vmware.com>

Hi,

No immediate plans. This would though perhaps better sit as an extension/addition to the Spring Web Services project which already supports SOAP over JMS.

Mark


> -----Original Message-----
> From: Emile Joubert [mailto:emile at rabbitmq.com]
> Sent: Thursday, November 18, 2010 11:29 AM
> To: Hussein Said
> Cc: rabbitmq-discuss at lists.rabbitmq.com; Mark Pollack
> Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> 
> Hi Hussein,
> 
> Thanks for your question. The RabbitMQ team do not have any immediate
> plans to add a Java SOAP stack, but that could change if there is
> sufficient demand.
> 
> I'm copying in Mark Pollack who may know whether anything related is
> planned for Spring-AMQP.
> 
> 
> Regards
> 
> Emile
> 
> 
> 
> On 16/11/10 21:26, Hussein Said wrote:
> > WCF RabbitMQ bindings works great and I am consuming Web services
> using
> > the RabbitMQ binding with little change to our codebase.
> > I guess my question is if there are any plans(now or future) to have
> a
> > custom AXIS2 or JAX-WS Transport for RabbitMQ since they are widely
> used
> > SOAP stacks. This will greatly benifit the SOAP community so that the
> > adoption of  AMQP is less of a barrier if a native AMQP transport
> client
> > is available. Spring has one, and OpenAMQP has JMS over RabbitMQ.
> Also,
> > I noticed on the AMQP org site that 1-0 SOAP Mapping
> > <http://mail.cml.com/confluence/display/AMQP/1-0+SOAP+Mapping>  is
> > proposed, but that may be months before approved and supported.
> >
> > regards
> > hussein
> >
> > ---------------------------------------------------------------------
> ---
> > *From:* Emile Joubert [mailto:emile at rabbitmq.com]
> > *Sent:* Mon 11/15/2010 4:49 AM
> > *To:* rabbitmq-discuss at lists.rabbitmq.com; Hussein Said
> > *Subject:* Re: [rabbitmq-discuss] SOAP over RabbitMQ
> >
> > Hi Hussein,
> >
> > On 13/11/10 17:06, Hussein Said wrote:
> >> Hi,
> >> I would like to know if there is something equivalent to the WCF
> >> ServiceModel on the Java side.
> >> I  have a web service hosted in WCF that calls another web Service
> >> hosted on Axis2. I was able with relative ease
> >> To add the RabbitMQ binding on the .net side, and use SOAP as the
> >> protocol, and RabbitMQ as the transport using the RabbitMQ service
> model
> >> libraries. Now I would like to be able to do the same thing from the
> >> Java side using SOAP. This will allow us to leverage our current
> >> investments in SOAP, but use RabbitMQ powerful messaging
> infrastructure
> >> to transport over Queues.
> >
> >
> > In theory it should be possible to interoperate using a Java web
> > services library that speaks the correct flavour of SOAP, but I'm not
> > aware of anyone trying this using the RabbitMQ WCF binding
> specifically.
> > We would be interested to hear the results of your attempt.
> >
> >
> > Regards
> >
> > Emile
> >
> 
> 
> --
> Emile Joubert
> 
> RabbitMQ
> SpringSource, a division of VMware

From markfisher at vmware.com  Thu Nov 18 17:25:17 2010
From: markfisher at vmware.com (Mark Fisher)
Date: Thu, 18 Nov 2010 09:25:17 -0800
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <806F700D7E08E9408413160B05EB66672A49A3D406@EXCH-MBX-1.vmware.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com>
	<4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com>
	<4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com>
	<4CDD7CCA.30509@rabbitmq.com>
	<3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com>
	<4CE10242.4040302@rabbitmq.com>
	<3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com>
	<4CE55433.6070805@rabbitmq.com>,
	<806F700D7E08E9408413160B05EB66672A49A3D406@EXCH-MBX-1.vmware.com>
Message-ID: <392922E81643B245A905B42E3E34C24014D35171A0@EXCH-MBX-1.vmware.com>

Also, the Spring Integration project provides Web Service adapters (built on top of Spring-WS), and we have AMQP adapters in progress (built on top of Spring-AMQP). So, that at least provides a "bridge" between the two (e.g. inbound-amqp -> outbound-ws or vice versa). While that is different than a native AMQP transport within a SOAP stack, depending on the application, that level of decoupling might provide some advantages, such as routing/transformation/filtering support and more control over the Messaging Mappers.

-Mark
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mark Pollack [mpollack at vmware.com]
Sent: Thursday, November 18, 2010 12:16 PM
To: Emile Joubert; Hussein Said
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ

Hi,

No immediate plans. This would though perhaps better sit as an extension/addition to the Spring Web Services project which already supports SOAP over JMS.

Mark


> -----Original Message-----
> From: Emile Joubert [mailto:emile at rabbitmq.com]
> Sent: Thursday, November 18, 2010 11:29 AM
> To: Hussein Said
> Cc: rabbitmq-discuss at lists.rabbitmq.com; Mark Pollack
> Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
>
>
> Hi Hussein,
>
> Thanks for your question. The RabbitMQ team do not have any immediate
> plans to add a Java SOAP stack, but that could change if there is
> sufficient demand.
>
> I'm copying in Mark Pollack who may know whether anything related is
> planned for Spring-AMQP.
>
>
> Regards
>
> Emile
>
>
>
> On 16/11/10 21:26, Hussein Said wrote:
> > WCF RabbitMQ bindings works great and I am consuming Web services
> using
> > the RabbitMQ binding with little change to our codebase.
> > I guess my question is if there are any plans(now or future) to have
> a
> > custom AXIS2 or JAX-WS Transport for RabbitMQ since they are widely
> used
> > SOAP stacks. This will greatly benifit the SOAP community so that the
> > adoption of  AMQP is less of a barrier if a native AMQP transport
> client
> > is available. Spring has one, and OpenAMQP has JMS over RabbitMQ.
> Also,
> > I noticed on the AMQP org site that 1-0 SOAP Mapping
> > <http://mail.cml.com/confluence/display/AMQP/1-0+SOAP+Mapping>  is
> > proposed, but that may be months before approved and supported.
> >
> > regards
> > hussein
> >
> > ---------------------------------------------------------------------
> ---
> > *From:* Emile Joubert [mailto:emile at rabbitmq.com]
> > *Sent:* Mon 11/15/2010 4:49 AM
> > *To:* rabbitmq-discuss at lists.rabbitmq.com; Hussein Said
> > *Subject:* Re: [rabbitmq-discuss] SOAP over RabbitMQ
> >
> > Hi Hussein,
> >
> > On 13/11/10 17:06, Hussein Said wrote:
> >> Hi,
> >> I would like to know if there is something equivalent to the WCF
> >> ServiceModel on the Java side.
> >> I  have a web service hosted in WCF that calls another web Service
> >> hosted on Axis2. I was able with relative ease
> >> To add the RabbitMQ binding on the .net side, and use SOAP as the
> >> protocol, and RabbitMQ as the transport using the RabbitMQ service
> model
> >> libraries. Now I would like to be able to do the same thing from the
> >> Java side using SOAP. This will allow us to leverage our current
> >> investments in SOAP, but use RabbitMQ powerful messaging
> infrastructure
> >> to transport over Queues.
> >
> >
> > In theory it should be possible to interoperate using a Java web
> > services library that speaks the correct flavour of SOAP, but I'm not
> > aware of anyone trying this using the RabbitMQ WCF binding
> specifically.
> > We would be interested to hear the results of your attempt.
> >
> >
> > Regards
> >
> > Emile
> >
>
>
> --
> Emile Joubert
>
> RabbitMQ
> SpringSource, a division of VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From aaron at agoragames.com  Thu Nov 18 17:28:46 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 18 Nov 2010 12:28:46 -0500
Subject: [rabbitmq-discuss] rabbitmqctl script complaints
In-Reply-To: <4CE5589C.7040905@rabbitmq.com>
References: <AANLkTi=4AyfT-N56Ujb41Y_LionKb+yRHGj7jPEiQb4Q@mail.gmail.com>
	<4CE5549B.1040404@rabbitmq.com>
	<AANLkTinmAvX1VU-N8ogL4tbJKVKm4FGVhnqRPvZxs5ie@mail.gmail.com>
	<4CE5589C.7040905@rabbitmq.com>
Message-ID: <AANLkTimmhPMfG75LAuoa_dcTkvDtYVb3oHaHe_38Stgm@mail.gmail.com>

All good points on previous replies; we have not yet incorporated any
plugins into our standard installation.

Thanks for scheduling a detailed look at the script Simon.

cheers,
Aaron

On Thu, Nov 18, 2010 at 11:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 18/11/10 16:42, Aaron Westendorf wrote:
>>
>> Yes, but then one has to start editing their PATH, which is not always
>> a pleasant task in a large production deploy.
>
> Well, the wrapper shell script you mention in the blog post could reference
> the real rabbitmqctl.
>
>> The default install can
>> be made flexible enough to support more use cases than it currently
>> does. ?One way to do that would be to exec the
>> /usr/lib/rabbitmq/bin/rabbitmqctl and only on failure, print out the
>> note that one should switch user if they are not root or rabbitmq.
>
> Ah, I see.
>
> It would be nice to distinguish failure caused by the wrong Erlang cookie
> from other types of failure, but this makes some sense. I'll open a bug.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From hsaid at plantcml-eads.com  Thu Nov 18 17:46:17 2010
From: hsaid at plantcml-eads.com (Hussein Said)
Date: Thu, 18 Nov 2010 12:46:17 -0500
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <392922E81643B245A905B42E3E34C24014D35171A0@EXCH-MBX-1.vmware.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com><4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com><4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com><4CDD7CCA.30509@rabbitmq.com><3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com><4CE10242.4040302@rabbitmq.com><3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com><4CE55433.6070805@rabbitmq.com>,
	<806F700D7E08E9408413160B05EB66672A49A3D406@EXCH-MBX-1.vmware.com>
	<392922E81643B245A905B42E3E34C24014D35171A0@EXCH-MBX-1.vmware.com>
Message-ID: <3173206D0F5F6B418F76F5997B2AE752019FA9D3@gatex01.CMLnet.peinet.peinc.com>

Thanks for your replies. Any idea when those adaptors will be out? It
definitely looks promising for our needs.
Note that a native AMQP Transport within the SOAP stack is likely easier
to adopt within existing SOAP sweatshops, as it would be easier to
integrate without having to rewire the web services through the
Spring-WS framework(based on my limited knowledge of the Spring
framework of course)

Regards
hussein

-----Original Message-----
From: Mark Fisher [mailto:markfisher at vmware.com] 
Sent: November 18, 2010 12:25 PM
To: Mark Pollack; Emile Joubert; Hussein Said
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ

Also, the Spring Integration project provides Web Service adapters
(built on top of Spring-WS), and we have AMQP adapters in progress
(built on top of Spring-AMQP). So, that at least provides a "bridge"
between the two (e.g. inbound-amqp -> outbound-ws or vice versa). While
that is different than a native AMQP transport within a SOAP stack,
depending on the application, that level of decoupling might provide
some advantages, such as routing/transformation/filtering support and
more control over the Messaging Mappers.

-Mark
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mark Pollack
[mpollack at vmware.com]
Sent: Thursday, November 18, 2010 12:16 PM
To: Emile Joubert; Hussein Said
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ

Hi,

No immediate plans. This would though perhaps better sit as an
extension/addition to the Spring Web Services project which already
supports SOAP over JMS.

Mark


> -----Original Message-----
> From: Emile Joubert [mailto:emile at rabbitmq.com]
> Sent: Thursday, November 18, 2010 11:29 AM
> To: Hussein Said
> Cc: rabbitmq-discuss at lists.rabbitmq.com; Mark Pollack
> Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
>
>
> Hi Hussein,
>
> Thanks for your question. The RabbitMQ team do not have any immediate
> plans to add a Java SOAP stack, but that could change if there is
> sufficient demand.
>
> I'm copying in Mark Pollack who may know whether anything related is
> planned for Spring-AMQP.
>
>
> Regards
>
> Emile
>
>
>
> On 16/11/10 21:26, Hussein Said wrote:
> > WCF RabbitMQ bindings works great and I am consuming Web services
> using
> > the RabbitMQ binding with little change to our codebase.
> > I guess my question is if there are any plans(now or future) to have
> a
> > custom AXIS2 or JAX-WS Transport for RabbitMQ since they are widely
> used
> > SOAP stacks. This will greatly benifit the SOAP community so that
the
> > adoption of  AMQP is less of a barrier if a native AMQP transport
> client
> > is available. Spring has one, and OpenAMQP has JMS over RabbitMQ.
> Also,
> > I noticed on the AMQP org site that 1-0 SOAP Mapping
> > <http://mail.cml.com/confluence/display/AMQP/1-0+SOAP+Mapping>  is
> > proposed, but that may be months before approved and supported.
> >
> > regards
> > hussein
> >
> >
---------------------------------------------------------------------
> ---
> > *From:* Emile Joubert [mailto:emile at rabbitmq.com]
> > *Sent:* Mon 11/15/2010 4:49 AM
> > *To:* rabbitmq-discuss at lists.rabbitmq.com; Hussein Said
> > *Subject:* Re: [rabbitmq-discuss] SOAP over RabbitMQ
> >
> > Hi Hussein,
> >
> > On 13/11/10 17:06, Hussein Said wrote:
> >> Hi,
> >> I would like to know if there is something equivalent to the WCF
> >> ServiceModel on the Java side.
> >> I  have a web service hosted in WCF that calls another web Service
> >> hosted on Axis2. I was able with relative ease
> >> To add the RabbitMQ binding on the .net side, and use SOAP as the
> >> protocol, and RabbitMQ as the transport using the RabbitMQ service
> model
> >> libraries. Now I would like to be able to do the same thing from
the
> >> Java side using SOAP. This will allow us to leverage our current
> >> investments in SOAP, but use RabbitMQ powerful messaging
> infrastructure
> >> to transport over Queues.
> >
> >
> > In theory it should be possible to interoperate using a Java web
> > services library that speaks the correct flavour of SOAP, but I'm
not
> > aware of anyone trying this using the RabbitMQ WCF binding
> specifically.
> > We would be interested to hear the results of your attempt.
> >
> >
> > Regards
> >
> > Emile
> >
>
>
> --
> Emile Joubert
>
> RabbitMQ
> SpringSource, a division of VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpollack at vmware.com  Thu Nov 18 17:58:18 2010
From: mpollack at vmware.com (Mark Pollack)
Date: Thu, 18 Nov 2010 09:58:18 -0800
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <3173206D0F5F6B418F76F5997B2AE752019FA9D3@gatex01.CMLnet.peinet.peinc.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com><4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com><4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com><4CDD7CCA.30509@rabbitmq.com><3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com><4CE10242.4040302@rabbitmq.com><3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com><4CE55433.6070805@rabbitmq.com>,
	<806F700D7E08E9408413160B05EB66672A49A3D406@EXCH-MBX-1.vmware.com>
	<392922E81643B245A905B42E3E34C24014D35171A0@EXCH-MBX-1.vmware.com>
	<3173206D0F5F6B418F76F5997B2AE752019FA9D3@gatex01.CMLnet.peinet.peinc.com>
Message-ID: <806F700D7E08E9408413160B05EB66672A49A3D47D@EXCH-MBX-1.vmware.com>

Hi,

It probably wouldn't be easier to adopt a AMQP transport for SOAP if both ends weren't Spring Web Service based (or using the same web services framework).  From what I've seen SOAP over JMS isn't a widely supported option across SOAP stacks/products and even then, despite some specs being written on how it should work, I had interoperability issues a few years ago between Spring Web Services on JMS and .NET WCF TIBCO support.  SOAP over JMS isn't covered by the WS-I profiles AFAIK.

Mark


> -----Original Message-----
> From: Hussein Said [mailto:hsaid at plantcml-eads.com]
> Sent: Thursday, November 18, 2010 12:46 PM
> To: Mark Fisher; Mark Pollack; Emile Joubert
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> Thanks for your replies. Any idea when those adaptors will be out? It
> definitely looks promising for our needs.
> Note that a native AMQP Transport within the SOAP stack is likely
> easier
> to adopt within existing SOAP sweatshops, as it would be easier to
> integrate without having to rewire the web services through the
> Spring-WS framework(based on my limited knowledge of the Spring
> framework of course)
> 
> Regards
> hussein
> 
> -----Original Message-----
> From: Mark Fisher [mailto:markfisher at vmware.com]
> Sent: November 18, 2010 12:25 PM
> To: Mark Pollack; Emile Joubert; Hussein Said
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> Also, the Spring Integration project provides Web Service adapters
> (built on top of Spring-WS), and we have AMQP adapters in progress
> (built on top of Spring-AMQP). So, that at least provides a "bridge"
> between the two (e.g. inbound-amqp -> outbound-ws or vice versa). While
> that is different than a native AMQP transport within a SOAP stack,
> depending on the application, that level of decoupling might provide
> some advantages, such as routing/transformation/filtering support and
> more control over the Messaging Mappers.
> 
> -Mark
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mark Pollack
> [mpollack at vmware.com]
> Sent: Thursday, November 18, 2010 12:16 PM
> To: Emile Joubert; Hussein Said
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> Hi,
> 
> No immediate plans. This would though perhaps better sit as an
> extension/addition to the Spring Web Services project which already
> supports SOAP over JMS.
> 
> Mark
> 
> 
> > -----Original Message-----
> > From: Emile Joubert [mailto:emile at rabbitmq.com]
> > Sent: Thursday, November 18, 2010 11:29 AM
> > To: Hussein Said
> > Cc: rabbitmq-discuss at lists.rabbitmq.com; Mark Pollack
> > Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
> >
> >
> > Hi Hussein,
> >
> > Thanks for your question. The RabbitMQ team do not have any immediate
> > plans to add a Java SOAP stack, but that could change if there is
> > sufficient demand.
> >
> > I'm copying in Mark Pollack who may know whether anything related is
> > planned for Spring-AMQP.
> >
> >
> > Regards
> >
> > Emile
> >
> >
> >
> > On 16/11/10 21:26, Hussein Said wrote:
> > > WCF RabbitMQ bindings works great and I am consuming Web services
> > using
> > > the RabbitMQ binding with little change to our codebase.
> > > I guess my question is if there are any plans(now or future) to
> have
> > a
> > > custom AXIS2 or JAX-WS Transport for RabbitMQ since they are widely
> > used
> > > SOAP stacks. This will greatly benifit the SOAP community so that
> the
> > > adoption of  AMQP is less of a barrier if a native AMQP transport
> > client
> > > is available. Spring has one, and OpenAMQP has JMS over RabbitMQ.
> > Also,
> > > I noticed on the AMQP org site that 1-0 SOAP Mapping
> > > <http://mail.cml.com/confluence/display/AMQP/1-0+SOAP+Mapping>  is
> > > proposed, but that may be months before approved and supported.
> > >
> > > regards
> > > hussein
> > >
> > >
> ---------------------------------------------------------------------
> > ---
> > > *From:* Emile Joubert [mailto:emile at rabbitmq.com]
> > > *Sent:* Mon 11/15/2010 4:49 AM
> > > *To:* rabbitmq-discuss at lists.rabbitmq.com; Hussein Said
> > > *Subject:* Re: [rabbitmq-discuss] SOAP over RabbitMQ
> > >
> > > Hi Hussein,
> > >
> > > On 13/11/10 17:06, Hussein Said wrote:
> > >> Hi,
> > >> I would like to know if there is something equivalent to the WCF
> > >> ServiceModel on the Java side.
> > >> I  have a web service hosted in WCF that calls another web Service
> > >> hosted on Axis2. I was able with relative ease
> > >> To add the RabbitMQ binding on the .net side, and use SOAP as the
> > >> protocol, and RabbitMQ as the transport using the RabbitMQ service
> > model
> > >> libraries. Now I would like to be able to do the same thing from
> the
> > >> Java side using SOAP. This will allow us to leverage our current
> > >> investments in SOAP, but use RabbitMQ powerful messaging
> > infrastructure
> > >> to transport over Queues.
> > >
> > >
> > > In theory it should be possible to interoperate using a Java web
> > > services library that speaks the correct flavour of SOAP, but I'm
> not
> > > aware of anyone trying this using the RabbitMQ WCF binding
> > specifically.
> > > We would be interested to hear the results of your attempt.
> > >
> > >
> > > Regards
> > >
> > > Emile
> > >
> >
> >
> > --
> > Emile Joubert
> >
> > RabbitMQ
> > SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From hsaid at plantcml-eads.com  Thu Nov 18 18:32:46 2010
From: hsaid at plantcml-eads.com (Hussein Said)
Date: Thu, 18 Nov 2010 13:32:46 -0500
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <806F700D7E08E9408413160B05EB66672A49A3D47D@EXCH-MBX-1.vmware.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com><4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com><4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com><4CDD7CCA.30509@rabbitmq.com><3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com><4CE10242.4040302@rabbitmq.com><3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com><4CE55433.6070805@rabbitmq.com>,
	<806F700D7E08E9408413160B05EB66672A49A3D406@EXCH-MBX-1.vmware.com>
	<392922E81643B245A905B42E3E34C24014D35171A0@EXCH-MBX-1.vmware.com>
	<3173206D0F5F6B418F76F5997B2AE752019FA9D3@gatex01.CMLnet.peinet.peinc.com>
	<806F700D7E08E9408413160B05EB66672A49A3D47D@EXCH-MBX-1.vmware.com>
Message-ID: <3173206D0F5F6B418F76F5997B2AE752019FAA2A@gatex01.CMLnet.peinet.peinc.com>

You are right. However, if one is using Basic http binding and a
contract first approach, then interoperability headaches should be
minimal. I have AXIS2 and WCF talking SOAP this way. 
I guess what I would explore is to use RabbitMQP java client and use the
AXIS2 Transport framework(as they advertised it for SOAP over JMS) and
build a custom transport for AXIS2 SOAP over AMQP. In theory, I believe
this should work and it would be similar to what RabbitMQ ServiceModel
did for WCF.

Regards
hussein

-----Original Message-----
From: Mark Pollack [mailto:mpollack at vmware.com] 
Sent: November 18, 2010 12:58 PM
To: Hussein Said; Mark Fisher; Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ

Hi,

It probably wouldn't be easier to adopt a AMQP transport for SOAP if
both ends weren't Spring Web Service based (or using the same web
services framework).  From what I've seen SOAP over JMS isn't a widely
supported option across SOAP stacks/products and even then, despite some
specs being written on how it should work, I had interoperability issues
a few years ago between Spring Web Services on JMS and .NET WCF TIBCO
support.  SOAP over JMS isn't covered by the WS-I profiles AFAIK.

Mark


> -----Original Message-----
> From: Hussein Said [mailto:hsaid at plantcml-eads.com]
> Sent: Thursday, November 18, 2010 12:46 PM
> To: Mark Fisher; Mark Pollack; Emile Joubert
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> Thanks for your replies. Any idea when those adaptors will be out? It
> definitely looks promising for our needs.
> Note that a native AMQP Transport within the SOAP stack is likely
> easier
> to adopt within existing SOAP sweatshops, as it would be easier to
> integrate without having to rewire the web services through the
> Spring-WS framework(based on my limited knowledge of the Spring
> framework of course)
> 
> Regards
> hussein
> 
> -----Original Message-----
> From: Mark Fisher [mailto:markfisher at vmware.com]
> Sent: November 18, 2010 12:25 PM
> To: Mark Pollack; Emile Joubert; Hussein Said
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> Also, the Spring Integration project provides Web Service adapters
> (built on top of Spring-WS), and we have AMQP adapters in progress
> (built on top of Spring-AMQP). So, that at least provides a "bridge"
> between the two (e.g. inbound-amqp -> outbound-ws or vice versa).
While
> that is different than a native AMQP transport within a SOAP stack,
> depending on the application, that level of decoupling might provide
> some advantages, such as routing/transformation/filtering support and
> more control over the Messaging Mappers.
> 
> -Mark
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mark
Pollack
> [mpollack at vmware.com]
> Sent: Thursday, November 18, 2010 12:16 PM
> To: Emile Joubert; Hussein Said
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> Hi,
> 
> No immediate plans. This would though perhaps better sit as an
> extension/addition to the Spring Web Services project which already
> supports SOAP over JMS.
> 
> Mark
> 
> 
> > -----Original Message-----
> > From: Emile Joubert [mailto:emile at rabbitmq.com]
> > Sent: Thursday, November 18, 2010 11:29 AM
> > To: Hussein Said
> > Cc: rabbitmq-discuss at lists.rabbitmq.com; Mark Pollack
> > Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
> >
> >
> > Hi Hussein,
> >
> > Thanks for your question. The RabbitMQ team do not have any
immediate
> > plans to add a Java SOAP stack, but that could change if there is
> > sufficient demand.
> >
> > I'm copying in Mark Pollack who may know whether anything related is
> > planned for Spring-AMQP.
> >
> >
> > Regards
> >
> > Emile
> >
> >
> >
> > On 16/11/10 21:26, Hussein Said wrote:
> > > WCF RabbitMQ bindings works great and I am consuming Web services
> > using
> > > the RabbitMQ binding with little change to our codebase.
> > > I guess my question is if there are any plans(now or future) to
> have
> > a
> > > custom AXIS2 or JAX-WS Transport for RabbitMQ since they are
widely
> > used
> > > SOAP stacks. This will greatly benifit the SOAP community so that
> the
> > > adoption of  AMQP is less of a barrier if a native AMQP transport
> > client
> > > is available. Spring has one, and OpenAMQP has JMS over RabbitMQ.
> > Also,
> > > I noticed on the AMQP org site that 1-0 SOAP Mapping
> > > <http://mail.cml.com/confluence/display/AMQP/1-0+SOAP+Mapping>  is
> > > proposed, but that may be months before approved and supported.
> > >
> > > regards
> > > hussein
> > >
> > >
> ---------------------------------------------------------------------
> > ---
> > > *From:* Emile Joubert [mailto:emile at rabbitmq.com]
> > > *Sent:* Mon 11/15/2010 4:49 AM
> > > *To:* rabbitmq-discuss at lists.rabbitmq.com; Hussein Said
> > > *Subject:* Re: [rabbitmq-discuss] SOAP over RabbitMQ
> > >
> > > Hi Hussein,
> > >
> > > On 13/11/10 17:06, Hussein Said wrote:
> > >> Hi,
> > >> I would like to know if there is something equivalent to the WCF
> > >> ServiceModel on the Java side.
> > >> I  have a web service hosted in WCF that calls another web
Service
> > >> hosted on Axis2. I was able with relative ease
> > >> To add the RabbitMQ binding on the .net side, and use SOAP as the
> > >> protocol, and RabbitMQ as the transport using the RabbitMQ
service
> > model
> > >> libraries. Now I would like to be able to do the same thing from
> the
> > >> Java side using SOAP. This will allow us to leverage our current
> > >> investments in SOAP, but use RabbitMQ powerful messaging
> > infrastructure
> > >> to transport over Queues.
> > >
> > >
> > > In theory it should be possible to interoperate using a Java web
> > > services library that speaks the correct flavour of SOAP, but I'm
> not
> > > aware of anyone trying this using the RabbitMQ WCF binding
> > specifically.
> > > We would be interested to hear the results of your attempt.
> > >
> > >
> > > Regards
> > >
> > > Emile
> > >
> >
> >
> > --
> > Emile Joubert
> >
> > RabbitMQ
> > SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpollack at vmware.com  Thu Nov 18 18:44:11 2010
From: mpollack at vmware.com (Mark Pollack)
Date: Thu, 18 Nov 2010 10:44:11 -0800
Subject: [rabbitmq-discuss] SOAP over RabbitMQ
In-Reply-To: <3173206D0F5F6B418F76F5997B2AE752019FAA2A@gatex01.CMLnet.peinet.peinc.com>
References: <30162963.post@talk.nabble.com><4CDA4E66.1000508@rabbitmq.com><4CDA548A.90703@rabbitmq.com><30182063.post@talk.nabble.com><4CDACA27.30009@rabbitmq.com><30184535.post@talk.nabble.com><4CDD7CCA.30509@rabbitmq.com><3173206D0F5F6B418F76F5997B2AE752019664B2@gatex01.CMLnet.peinet.peinc.com><4CE10242.4040302@rabbitmq.com><3173206D0F5F6B418F76F5997B2AE752107DDA@gatex01.CMLnet.peinet.peinc.com><4CE55433.6070805@rabbitmq.com>,
	<806F700D7E08E9408413160B05EB66672A49A3D406@EXCH-MBX-1.vmware.com>
	<392922E81643B245A905B42E3E34C24014D35171A0@EXCH-MBX-1.vmware.com>
	<3173206D0F5F6B418F76F5997B2AE752019FA9D3@gatex01.CMLnet.peinet.peinc.com>
	<806F700D7E08E9408413160B05EB66672A49A3D47D@EXCH-MBX-1.vmware.com>
	<3173206D0F5F6B418F76F5997B2AE752019FAA2A@gatex01.CMLnet.peinet.peinc.com>
Message-ID: <806F700D7E08E9408413160B05EB66672A49A3D517@EXCH-MBX-1.vmware.com>

Hi,

I went down the whole contract first approach as well (that is one of the main features in Spring Web Services!) but interop didn't work out of the box with TIBCO WCF client over JMS and Spring Web Services.  I was able to use a hacked together ActiveMQ NMS based WCF implementation to get it to work.  While contract first helps of course, in particular in terms of payload data interop, there is more to it than that.  I think in my case the WCF implementation wasn't looking in the 'right' spot for the return destination - yea - something really basic like that. 

You can go down the AXIS or Spring Web services route since they both support SOAP over JMS.  I'm sure one can get it to work either way and in particular make it fit to whatever the detailed expectations are of the WCF RabbitMQ library.  For example, what is its expected format to specify the return reply-to exchange?  Next step would be to see if this java implementation would then work against the QPID WCF library?  That is my point of where it starts to get sticky - around mixing and matching different web service frameworks out of the box.  I'd be interested to know for sure, but as it is not well travel territory expect some bumps.

Mark


 

 

> -----Original Message-----
> From: Hussein Said [mailto:hsaid at plantcml-eads.com]
> Sent: Thursday, November 18, 2010 1:33 PM
> To: Mark Pollack; Mark Fisher; Emile Joubert
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> You are right. However, if one is using Basic http binding and a
> contract first approach, then interoperability headaches should be
> minimal. I have AXIS2 and WCF talking SOAP this way.
> I guess what I would explore is to use RabbitMQP java client and use
> the
> AXIS2 Transport framework(as they advertised it for SOAP over JMS) and
> build a custom transport for AXIS2 SOAP over AMQP. In theory, I believe
> this should work and it would be similar to what RabbitMQ ServiceModel
> did for WCF.
> 
> Regards
> hussein
> 
> -----Original Message-----
> From: Mark Pollack [mailto:mpollack at vmware.com]
> Sent: November 18, 2010 12:58 PM
> To: Hussein Said; Mark Fisher; Emile Joubert
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ
> 
> Hi,
> 
> It probably wouldn't be easier to adopt a AMQP transport for SOAP if
> both ends weren't Spring Web Service based (or using the same web
> services framework).  From what I've seen SOAP over JMS isn't a widely
> supported option across SOAP stacks/products and even then, despite
> some
> specs being written on how it should work, I had interoperability
> issues
> a few years ago between Spring Web Services on JMS and .NET WCF TIBCO
> support.  SOAP over JMS isn't covered by the WS-I profiles AFAIK.
> 
> Mark
> 
> 
> > -----Original Message-----
> > From: Hussein Said [mailto:hsaid at plantcml-eads.com]
> > Sent: Thursday, November 18, 2010 12:46 PM
> > To: Mark Fisher; Mark Pollack; Emile Joubert
> > Cc: rabbitmq-discuss at lists.rabbitmq.com
> > Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ
> >
> > Thanks for your replies. Any idea when those adaptors will be out? It
> > definitely looks promising for our needs.
> > Note that a native AMQP Transport within the SOAP stack is likely
> > easier
> > to adopt within existing SOAP sweatshops, as it would be easier to
> > integrate without having to rewire the web services through the
> > Spring-WS framework(based on my limited knowledge of the Spring
> > framework of course)
> >
> > Regards
> > hussein
> >
> > -----Original Message-----
> > From: Mark Fisher [mailto:markfisher at vmware.com]
> > Sent: November 18, 2010 12:25 PM
> > To: Mark Pollack; Emile Joubert; Hussein Said
> > Cc: rabbitmq-discuss at lists.rabbitmq.com
> > Subject: RE: [rabbitmq-discuss] SOAP over RabbitMQ
> >
> > Also, the Spring Integration project provides Web Service adapters
> > (built on top of Spring-WS), and we have AMQP adapters in progress
> > (built on top of Spring-AMQP). So, that at least provides a "bridge"
> > between the two (e.g. inbound-amqp -> outbound-ws or vice versa).
> While
> > that is different than a native AMQP transport within a SOAP stack,
> > depending on the application, that level of decoupling might provide
> > some advantages, such as routing/transformation/filtering support and
> > more control over the Messaging Mappers.
> >
> > -Mark
> > ________________________________________
> > From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> > [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mark
> Pollack
> > [mpollack at vmware.com]
> > Sent: Thursday, November 18, 2010 12:16 PM
> > To: Emile Joubert; Hussein Said
> > Cc: rabbitmq-discuss at lists.rabbitmq.com
> > Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
> >
> > Hi,
> >
> > No immediate plans. This would though perhaps better sit as an
> > extension/addition to the Spring Web Services project which already
> > supports SOAP over JMS.
> >
> > Mark
> >
> >
> > > -----Original Message-----
> > > From: Emile Joubert [mailto:emile at rabbitmq.com]
> > > Sent: Thursday, November 18, 2010 11:29 AM
> > > To: Hussein Said
> > > Cc: rabbitmq-discuss at lists.rabbitmq.com; Mark Pollack
> > > Subject: Re: [rabbitmq-discuss] SOAP over RabbitMQ
> > >
> > >
> > > Hi Hussein,
> > >
> > > Thanks for your question. The RabbitMQ team do not have any
> immediate
> > > plans to add a Java SOAP stack, but that could change if there is
> > > sufficient demand.
> > >
> > > I'm copying in Mark Pollack who may know whether anything related
> is
> > > planned for Spring-AMQP.
> > >
> > >
> > > Regards
> > >
> > > Emile
> > >
> > >
> > >
> > > On 16/11/10 21:26, Hussein Said wrote:
> > > > WCF RabbitMQ bindings works great and I am consuming Web services
> > > using
> > > > the RabbitMQ binding with little change to our codebase.
> > > > I guess my question is if there are any plans(now or future) to
> > have
> > > a
> > > > custom AXIS2 or JAX-WS Transport for RabbitMQ since they are
> widely
> > > used
> > > > SOAP stacks. This will greatly benifit the SOAP community so that
> > the
> > > > adoption of  AMQP is less of a barrier if a native AMQP transport
> > > client
> > > > is available. Spring has one, and OpenAMQP has JMS over RabbitMQ.
> > > Also,
> > > > I noticed on the AMQP org site that 1-0 SOAP Mapping
> > > > <http://mail.cml.com/confluence/display/AMQP/1-0+SOAP+Mapping>
> is
> > > > proposed, but that may be months before approved and supported.
> > > >
> > > > regards
> > > > hussein
> > > >
> > > >
> > ---------------------------------------------------------------------
> > > ---
> > > > *From:* Emile Joubert [mailto:emile at rabbitmq.com]
> > > > *Sent:* Mon 11/15/2010 4:49 AM
> > > > *To:* rabbitmq-discuss at lists.rabbitmq.com; Hussein Said
> > > > *Subject:* Re: [rabbitmq-discuss] SOAP over RabbitMQ
> > > >
> > > > Hi Hussein,
> > > >
> > > > On 13/11/10 17:06, Hussein Said wrote:
> > > >> Hi,
> > > >> I would like to know if there is something equivalent to the WCF
> > > >> ServiceModel on the Java side.
> > > >> I  have a web service hosted in WCF that calls another web
> Service
> > > >> hosted on Axis2. I was able with relative ease
> > > >> To add the RabbitMQ binding on the .net side, and use SOAP as
> the
> > > >> protocol, and RabbitMQ as the transport using the RabbitMQ
> service
> > > model
> > > >> libraries. Now I would like to be able to do the same thing from
> > the
> > > >> Java side using SOAP. This will allow us to leverage our current
> > > >> investments in SOAP, but use RabbitMQ powerful messaging
> > > infrastructure
> > > >> to transport over Queues.
> > > >
> > > >
> > > > In theory it should be possible to interoperate using a Java web
> > > > services library that speaks the correct flavour of SOAP, but I'm
> > not
> > > > aware of anyone trying this using the RabbitMQ WCF binding
> > > specifically.
> > > > We would be interested to hear the results of your attempt.
> > > >
> > > >
> > > > Regards
> > > >
> > > > Emile
> > > >
> > >
> > >
> > > --
> > > Emile Joubert
> > >
> > > RabbitMQ
> > > SpringSource, a division of VMware
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From f at scalethink.com  Fri Nov 19 05:34:55 2010
From: f at scalethink.com (Liwen Fan)
Date: Fri, 19 Nov 2010 13:34:55 +0800
Subject: [rabbitmq-discuss] rabbit servers block in cluster environment
Message-ID: <AANLkTi=Sup5qHcGStxBNCOJgxL+McOZJO+XCJxzrpu4a@mail.gmail.com>

Hi
  we face some blocking problems in rabbitmq cluster environment.
  we have some java test clients and 2 rabbit servers clustered, one ram and
the other disk, all of them are 2.1.1.
  the client creates two connections when it is initialized, and holds these
two connections. For each action as basicGet/basicPublish, it randomly
chooses one connection.
  the queues and exchanges are created on one server (random choose) when
the client starts up.
  then the client creates many threads. Each thread randomly chooses one
connection and randomly chooses several exchanges to publish and several
queues to get.

  but after several message published/got, both servers face blocking
problems. The test client blocks and the server command like "rabbitmqctl
list_queues" and "rabbitmqctl stop" blocks too.
  but "rabbitmqctl status" does not block and returns ok.

  when we move to 1 single server(disk), everything turns fine. Rabbit
server behaves quite well as a single node.

  by the way, we are running on erlang R14B. Both queues and messages are
persistent and durable.
  Any suggestions?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/afbe0a12/attachment.htm>

From stephanion2002 at gmail.com  Fri Nov 19 06:19:15 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Fri, 19 Nov 2010 11:49:15 +0530
Subject: [rabbitmq-discuss] Doubt regarding rabbit servers in clustered
	environment
Message-ID: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>

Hi,

We are getting into rabbit cluster configuration with Load balancer in
front. I had this doubt that if we get to connect to rab1 at the time of
creation of exchanges and queues and rab2 at the time of using these
exchanges and queues, how will the system behave? Basically we want to know
that do we have to create similar exchanges and queues on both RabbitMQs or
is there any automatic provision?

Regards,
Kshitiz Garg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/dc1a363a/attachment.htm>

From f at scalethink.com  Fri Nov 19 07:11:03 2010
From: f at scalethink.com (Liwen Fan)
Date: Fri, 19 Nov 2010 15:11:03 +0800
Subject: [rabbitmq-discuss] rabbit servers block in cluster environment
In-Reply-To: <AANLkTi=Sup5qHcGStxBNCOJgxL+McOZJO+XCJxzrpu4a@mail.gmail.com>
References: <AANLkTi=Sup5qHcGStxBNCOJgxL+McOZJO+XCJxzrpu4a@mail.gmail.com>
Message-ID: <AANLkTik1BU8sROqZyw0oniqo0hMBZY-1fw=QczjBkmRY@mail.gmail.com>

this situation also occurs when 2 servers are configured both disk.
and, if the client only connects to 1 server (2 servers are clustered), no
blocking is detected.
is that the recommended way?


2010/11/19 Liwen Fan <f at scalethink.com>

> Hi
>   we face some blocking problems in rabbitmq cluster environment.
>   we have some java test clients and 2 rabbit servers clustered, one ram
> and the other disk, all of them are 2.1.1.
>   the client creates two connections when it is initialized, and holds
> these two connections. For each action as basicGet/basicPublish, it randomly
> chooses one connection.
>   the queues and exchanges are created on one server (random choose) when
> the client starts up.
>   then the client creates many threads. Each thread randomly chooses one
> connection and randomly chooses several exchanges to publish and several
> queues to get.
>
>   but after several message published/got, both servers face blocking
> problems. The test client blocks and the server command like "rabbitmqctl
> list_queues" and "rabbitmqctl stop" blocks too.
>   but "rabbitmqctl status" does not block and returns ok.
>
>   when we move to 1 single server(disk), everything turns fine. Rabbit
> server behaves quite well as a single node.
>
>   by the way, we are running on erlang R14B. Both queues and messages are
> persistent and durable.
>   Any suggestions?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/3c420dce/attachment.htm>

From matthias at rabbitmq.com  Fri Nov 19 07:20:17 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 19 Nov 2010 07:20:17 +0000
Subject: [rabbitmq-discuss] rabbit servers block in cluster environment
In-Reply-To: <AANLkTik1BU8sROqZyw0oniqo0hMBZY-1fw=QczjBkmRY@mail.gmail.com>
References: <AANLkTi=Sup5qHcGStxBNCOJgxL+McOZJO+XCJxzrpu4a@mail.gmail.com>
	<AANLkTik1BU8sROqZyw0oniqo0hMBZY-1fw=QczjBkmRY@mail.gmail.com>
Message-ID: <4CE62531.1090609@rabbitmq.com>

Liwen Fan wrote:
> this situation also occurs when 2 servers are configured both disk.
> and, if the client only connects to 1 server (2 servers are clustered), 
> no blocking is detected.

The blocking you are seeing when interacting with queues across a 
cluster is a known bug. The fix is on 'default' in hg and will be in the 
next release.

Regards,

Matthias.

From abinesh.s at gmail.com  Fri Nov 19 07:29:08 2010
From: abinesh.s at gmail.com (abinesh s)
Date: Fri, 19 Nov 2010 12:59:08 +0530
Subject: [rabbitmq-discuss] Message stalls in the queue for long time
Message-ID: <AANLkTi=4UHvzQ8HtrvhtSU0eJqtun7na1+AkNsdeqkg0@mail.gmail.com>

Hi All,

We have a problem with RabbitMQ when using with grails application(We are
using RabbitMQ grails plugin), We developed a testing application contains
three queues named TestQueue1, TestQueue2, TestQueue3, where we posted a
message in TestQueue1 and the handler fetch the message and do some process
and again posted it to TestQueue2, and the handler fetch the message and do
some process and Posted it to TestQueue3 and the handler for that Queue
fetch and stored the message into database. Its working fine, but some times
the handlers are not working and the messages in the queue remains for a
long time. We are using Ubuntu Linux platform. We cant understand why it is
happening, If we restart the queue server then it starts working fine after
some time again the messages get stalled. The handler class not working
fine. Please help us to know whats going on there?

Thanks in Advance.

-- 
Thanks and Regards
Abinesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/eb92854c/attachment.htm>

From majek04 at gmail.com  Fri Nov 19 08:12:13 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 19 Nov 2010 08:12:13 +0000
Subject: [rabbitmq-discuss] Doubt regarding rabbit servers in clustered
	environment
In-Reply-To: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>
References: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>
Message-ID: <AANLkTi=b2Xsd_AOxJ_qtb7z7EqJX6Si_6mMM6BeqNUZz@mail.gmail.com>

Hi,

On Fri, Nov 19, 2010 at 06:19, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
> We are getting into rabbit cluster configuration with Load balancer in
> front. I had this doubt that if we get to connect to rab1 at the time of
> creation of exchanges and queues and rab2 at the time of using these
> exchanges and queues, how will the system behave? Basically we want to know
> that do we have to create similar exchanges and queues on both RabbitMQs or
> is there any automatic provision?

RabbitMQ clustering is a complex beast.

Most of the resources are automatically shared in the cluster. So if you
create an exchange on one server, it will automatically appear in the
other one. Under the hood we're just using a replicated Erlang
database (mnesia).

On the other hand that is not true for queue data (messages). Queue
gets assigned
to a particular node in cluster, and all the traffic to a queue gets forwarded
to one particular node.

Cheers,
  Marek

From flatline at stresstiming.de  Fri Nov 19 09:41:56 2010
From: flatline at stresstiming.de (diez)
Date: Fri, 19 Nov 2010 10:41:56 +0100
Subject: [rabbitmq-discuss] http://code.google.com/p/php-rabbit gone!
Message-ID: <4CE64664.2000703@stresstiming.de>

Hi @all,

today i wanted to look on  http://code.google.com/p/php-rabbit but it is
gone, does anybody know something about it?

Has Alexandre stopped development or has google kicked the project?

Greetings Dieter

From jerryk at vmware.com  Fri Nov 19 09:56:37 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 19 Nov 2010 01:56:37 -0800
Subject: [rabbitmq-discuss] http://code.google.com/p/php-rabbit gone!
In-Reply-To: <4CE64664.2000703@stresstiming.de>
References: <4CE64664.2000703@stresstiming.de>
Message-ID: <17F6FE08-68DA-4F6C-92A2-AB84ED1B7A03@vmware.com>

Just FYI, it's not available to me either right now.  

I get "Forbidden: Your client does not have permission to get URL /p/php-rabbit/ from this server."   

Perhaps it's a temporary outage or misconfiguration on the hosting side?


On Nov 19, 2010, at 9:41 AM, diez wrote:

> Hi @all,
> 
> today i wanted to look on  http://code.google.com/p/php-rabbit but it is
> gone, does anybody know something about it?
> 
> Has Alexandre stopped development or has google kicked the project?
> 
> Greetings Dieter
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ovidiudeac at gmail.com  Fri Nov 19 10:52:19 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Fri, 19 Nov 2010 12:52:19 +0200
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
	working?
In-Reply-To: <4CE4B096.5010605@rabbitmq.com>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>
	<4CE4B096.5010605@rabbitmq.com>
Message-ID: <AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>

Thanks for the answer. I don't get any errors. At least I don't see any.

I try to reproduce the problem with clean code but it works fine. So I
should reformulate the question: Do you have any clues why it wouldn't
work with my production code i.e. what could influence the behavior of
QueueDelete?

ovidiu

On Thu, Nov 18, 2010 at 6:50 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Ovidiu,
>
> Ovidiu Deac wrote:
>>
>> I have a persistent queue and I want to delete it using the the following
>> code:
>> ...
>> Channel.QueueDelete(Queue,false, false, false);
>>
>> Any idea why this doesn't work?
>>
>> I also tried various combinations of parameters but the result was the
>> same.
>
> What was the result? Did you get an error? Is there anything in the server
> logs?
>
> Regards,
>
> Matthias.
>

From akalend at mail.ru  Fri Nov 19 11:03:50 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Fri, 19 Nov 2010 14:03:50 +0300
Subject: [rabbitmq-discuss]
	=?windows-1251?q?http=3A//code=2Egoogle=2Ecom/?=
	=?windows-1251?q?p/php-rabbit_gone!?=
In-Reply-To: <4CE64664.2000703@stresstiming.de>
References: <4CE64664.2000703@stresstiming.de>
Message-ID: <E1PJOkw-0001Y0-00.akalend-mail-ru@f202.mail.ru>

I'm sorry that it information not reported  this list previously.

The project was removed to PECL  ( http://pecl.php.net/amqp )  as  some forks  confuse the  users.
many questions which project is better.

The PECL project have the PHP standart code and more advanced. So I'm remaining  a leader of the project.
I will make merge my patches and exists pecl source.


Alexandre

Fri, 19 Nov 2010 10:41:56 +0100 ?????? ?? diez <flatline at stresstiming.de>:

> Hi @all,
> 
> today i wanted to look on  http://code.google.com/p/php-rabbit but it is
> gone, does anybody know something about it?
> 
> Has Alexandre stopped development or has google kicked the project?
> 
> Greetings Dieter
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From sunshinesucker at gmail.com  Fri Nov 19 12:12:53 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Fri, 19 Nov 2010 12:12:53 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
Message-ID: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>

Hello,

I am thinking about upgrading the 2.1.1 and was wondering if someone would
provide some steps on how to build the webhooks plugin against it without
the plugin crashing the server?  When i run the make file it builds however
I get a lot of warning with the lhttpc_lib.erl file and bool() type now
being called boolean(). I have changed the files but I still get a kernel
pid terminated message.  I also get a warning message regarding undefined
function amqp_connection:start_direct/0.


Has anyone got webhooks to work with 2.1.1? The logs are not telling me
anything useful. Any suggestions would be great at this point...

thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/39dd16bd/attachment.htm>

From matthias at rabbitmq.com  Fri Nov 19 12:39:11 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 19 Nov 2010 12:39:11 +0000
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
 working?
In-Reply-To: <AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>	<4CE4B096.5010605@rabbitmq.com>
	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>
Message-ID: <4CE66FEF.606@rabbitmq.com>

Ovidiu,

On 19/11/10 10:52, Ovidiu Deac wrote:
> Thanks for the answer. I don't get any errors. At least I don't see any.

So what *are* you seeing? Does the QueueDelete call succeed but the 
queue is still there? That can only happen if the queue gets redeclared 
by something else.


Matthias.

From mikeb at rabbitmq.com  Fri Nov 19 13:05:32 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 19 Nov 2010 13:05:32 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
Message-ID: <4CE6761C.1050507@rabbitmq.com>

> I am thinking about upgrading the 2.1.1 and was wondering if someone
> would provide some steps on how to build the webhooks plugin against it
> without the plugin crashing the server?

What webhooks plugin are you talking about?

If you mean rabbithub (http://github.com/tonyg/rabbithub and latterly, 
http://github.com/rabbitmq/rabbithub), that may be due to get some 
attention. (E.g., this weekend, from me)

Michael

From jon.brisbin at npcinternational.com  Fri Nov 19 14:10:36 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 19 Nov 2010 08:10:36 -0600
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
Message-ID: <4057469B-C1F1-4068-A1DF-B910FD29C847@npcinternational.com>

I assume you mean my webhooks plugin:

https://github.com/jbrisbin/rabbitmq-webhooks

I haven't built itwith 2.1.x yet, but I figured I'd need to give it some attention pretty quickly. Thanks for letting me know.

I'll check it out today and see if I can't get a fix in.


Jon Brisbin
Portal Webmaster
NPC International, Inc.


On Nov 19, 2010, at 6:12 AM, sunghyun lee wrote:

> Hello,
> 
> I am thinking about upgrading the 2.1.1 and was wondering if someone would provide some steps on how to build the webhooks plugin against it without the plugin crashing the server?  When i run the make file it builds however I get a lot of warning with the lhttpc_lib.erl file and bool() type now being called boolean(). I have changed the files but I still get a kernel pid terminated message.  I also get a warning message regarding undefined function amqp_connection:start_direct/0.  
> 
> 
> Has anyone got webhooks to work with 2.1.1? The logs are not telling me anything useful. Any suggestions would be great at this point...
> 
> thanks!
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/44b29684/attachment.htm>

From sunshinesucker at gmail.com  Fri Nov 19 14:16:22 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Fri, 19 Nov 2010 14:16:22 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <4057469B-C1F1-4068-A1DF-B910FD29C847@npcinternational.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
	<4057469B-C1F1-4068-A1DF-B910FD29C847@npcinternational.com>
Message-ID: <AANLkTik5k+PVGb-ifp+4o2aO6dm2C-HOChQrbVhgqu=w@mail.gmail.com>

great, thanks.

On 19 November 2010 14:10, Jon Brisbin <jon.brisbin at npcinternational.com>wrote:

> I assume you mean my webhooks plugin:
>
> https://github.com/jbrisbin/rabbitmq-webhooks
>
> I haven't built itwith 2.1.x yet, but I figured I'd need to give it some
> attention pretty quickly. Thanks for letting me know.
>
> I'll check it out today and see if I can't get a fix in.
>
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
> On Nov 19, 2010, at 6:12 AM, sunghyun lee wrote:
>
> Hello,
>
> I am thinking about upgrading the 2.1.1 and was wondering if someone would
> provide some steps on how to build the webhooks plugin against it without
> the plugin crashing the server?  When i run the make file it builds however
> I get a lot of warning with the lhttpc_lib.erl file and bool() type now
> being called boolean(). I have changed the files but I still get a kernel
> pid terminated message.  I also get a warning message regarding undefined
> function amqp_connection:start_direct/0.
>
>
> Has anyone got webhooks to work with 2.1.1? The logs are not telling me
> anything useful. Any suggestions would be great at this point...
>
> thanks!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/7171d47d/attachment.htm>

From sunshinesucker at gmail.com  Fri Nov 19 14:33:13 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Fri, 19 Nov 2010 14:33:13 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <4CE6761C.1050507@rabbitmq.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
	<4CE6761C.1050507@rabbitmq.com>
Message-ID: <AANLkTim6oFZAomuxkUh8JFL3-OYN+Q_e4qMuyhnhBqGP@mail.gmail.com>

I didnt mean that however I think you have just opened up a whole load of
other options for us if it does what I think it does. I will keep upto date
on your progress..


On 19 November 2010 13:05, Michael Bridgen <mikeb at rabbitmq.com> wrote:

> I am thinking about upgrading the 2.1.1 and was wondering if someone
>> would provide some steps on how to build the webhooks plugin against it
>> without the plugin crashing the server?
>>
>
> What webhooks plugin are you talking about?
>
> If you mean rabbithub (http://github.com/tonyg/rabbithub and latterly,
> http://github.com/rabbitmq/rabbithub), that may be due to get some
> attention. (E.g., this weekend, from me)
>
> Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/b2489b13/attachment.htm>

From jon.brisbin at npcinternational.com  Fri Nov 19 15:53:33 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 19 Nov 2010 09:53:33 -0600
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
Message-ID: <FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>

I just updated GitHub with some code changes to make the webhooks plugin work with RabbitMQ 2.1.1 and the latest erlang AMQP client. I also uploaded a binary with just the plugins needed to the "Downloads" section.

jb


On Nov 19, 2010, at 6:12 AM, sunghyun lee wrote:

> Hello,
> 
> I am thinking about upgrading the 2.1.1 and was wondering if someone would provide some steps on how to build the webhooks plugin against it without the plugin crashing the server?  When i run the make file it builds however I get a lot of warning with the lhttpc_lib.erl file and bool() type now being called boolean(). I have changed the files but I still get a kernel pid terminated message.  I also get a warning message regarding undefined function amqp_connection:start_direct/0.  
> 
> 
> Has anyone got webhooks to work with 2.1.1? The logs are not telling me anything useful. Any suggestions would be great at this point...
> 
> thanks!
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Jon Brisbin
Portal Webmaster
NPC International, Inc.




From stephanion2002 at gmail.com  Fri Nov 19 16:46:57 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Fri, 19 Nov 2010 22:16:57 +0530
Subject: [rabbitmq-discuss] Doubt regarding rabbit servers in clustered
	environment
In-Reply-To: <AANLkTi=b2Xsd_AOxJ_qtb7z7EqJX6Si_6mMM6BeqNUZz@mail.gmail.com>
References: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>
	<AANLkTi=b2Xsd_AOxJ_qtb7z7EqJX6Si_6mMM6BeqNUZz@mail.gmail.com>
Message-ID: <AANLkTimKO98fXd=e2Z=iWsKP-k2pwoiqLHhCYQo3Ff_T@mail.gmail.com>

Thanks for the reply Mark,

In our case, we

1. Create two exchanges A and B
2. Create 8 queues a,b,c,d,e,f,g,h
3. Bind A,B to these queues.
4. Consumer is listening to a,b,c,d,e,f,g,h ......
5. For the above operations, we are using two Rabbit MQ nodes in clustered
mode.

Please let us know the behaviour of clustered RabbitMQs ....

Also, I could not understand the statement *"all the traffic to a queue gets
forwarded to one particular node."*  (we send the messages to an exchange
and not a queue, isn't it ?)

Regards,
Kshitiz Garg

On Fri, Nov 19, 2010 at 1:42 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> Hi,
>
> On Fri, Nov 19, 2010 at 06:19, Kshitiz Garg <stephanion2002 at gmail.com>
> wrote:
> > We are getting into rabbit cluster configuration with Load balancer in
> > front. I had this doubt that if we get to connect to rab1 at the time of
> > creation of exchanges and queues and rab2 at the time of using these
> > exchanges and queues, how will the system behave? Basically we want to
> know
> > that do we have to create similar exchanges and queues on both RabbitMQs
> or
> > is there any automatic provision?
>
> RabbitMQ clustering is a complex beast.
>
> Most of the resources are automatically shared in the cluster. So if you
> create an exchange on one server, it will automatically appear in the
> other one. Under the hood we're just using a replicated Erlang
> database (mnesia).
>
> On the other hand that is not true for queue data (messages). Queue
> gets assigned
> to a particular node in cluster, and all the traffic to a queue gets
> forwarded
> to one particular node.
>
> Cheers,
>   Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/ae0caaa3/attachment.htm>

From majek04 at gmail.com  Fri Nov 19 17:04:05 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 19 Nov 2010 17:04:05 +0000
Subject: [rabbitmq-discuss] Doubt regarding rabbit servers in clustered
	environment
In-Reply-To: <AANLkTimKO98fXd=e2Z=iWsKP-k2pwoiqLHhCYQo3Ff_T@mail.gmail.com>
References: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>
	<AANLkTi=b2Xsd_AOxJ_qtb7z7EqJX6Si_6mMM6BeqNUZz@mail.gmail.com>
	<AANLkTimKO98fXd=e2Z=iWsKP-k2pwoiqLHhCYQo3Ff_T@mail.gmail.com>
Message-ID: <AANLkTimDiyBOk2rmQDPmbGwMm=s1Y9k1mqdmrzAZDfWQ@mail.gmail.com>

On Fri, Nov 19, 2010 at 16:46, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
> Thanks for the reply Mark,
>
> In our case, we
>
> 1. Create two exchanges A and B
> 2. Create 8 queues a,b,c,d,e,f,g,h
> 3. Bind A,B to these queues.
> 4. Consumer is listening to a,b,c,d,e,f,g,h ......
> 5. For the above operations, we are using two Rabbit MQ nodes in clustered
> mode.
>
> Please let us know the behaviour of clustered RabbitMQs ....
>
> Also, I could not understand the statement "all the traffic to a queue gets
> forwarded to one particular node."? (we send the messages to an exchange and
> not a queue, isn't it ?)

Right. I said it's complex :)

All the metadata lives in a replicated Erlang database (mnesia). That includes:
exchanges, bindings, credentials and so on.

So, if you update anything of that - it will be immediately visible
in the whole cluster. In other words: when you create an exchange
A on node 1, that will automatically create exchange A on node 2.

Now, with queues that's more complex. When you connect to node 1
and do queue_declare(xx), you are actually creating a queue on
that particular node. This information (queue xx is created on node 1)
is shared with other nodes. All the nodes know that a location of
queue xx is node1.

Whenever you publish stuff, to whatever node, the message
is pushed to a local exchange (as mentioned before, exchanges
are 'copied' to every node). Next step after the exchange
is the binding. The bindings are also 'copied' to all the nodes.
At that point the node knows: this message should go to a queue xx.

The node looks up where the queue lives and pushes a message to
a particular node that holds queue xx.

So, once again: exchanges and bindings are replicated, they
are the same for every node in the cluster.
Queue on the other hand lives on a particular node (actually
on the node that 'queue_declare' was executed).

Clustering != HA
(the messages (queue contents) live on a single node)

(I'm sure my friends from the team will clarify if I got the details wrong)

Is this description any better?

Cheers,
  Marek

From pdezwart at rubiconproject.com  Fri Nov 19 19:39:21 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 19 Nov 2010 11:39:21 -0800
Subject: [rabbitmq-discuss] http://code.google.com/	p/php-rabbit gone!
In-Reply-To: <E1PJOkw-0001Y0-00.akalend-mail-ru@f202.mail.ru>
References: <4CE64664.2000703@stresstiming.de>
	<E1PJOkw-0001Y0-00.akalend-mail-ru@f202.mail.ru>
Message-ID: <8d417371-527c-4d00-b4b4-b3e66a5825f1@blur>

In hindsight, we should have made an announcement, sorry Dieter.
On that note, we would like to invite any and all PHP extension developers to join us. We believe it is best for the community to have a centralized and standard client with proper documentation. Furthermore, Alexandre is tied up in a lot of other projects and we could use some help.
We welcome anyone who wants to contribute or even take the lead.
Pieter

-----Original message-----
From: Alexandre Kalendarev <akalend at mail.ru>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Fri, Nov 19, 2010 11:03:50 GMT+00:00
Subject: Re: [rabbitmq-discuss]	http://code.google.com/	p/php-rabbit gone!

I'm sorry that it information not reported  this list previously.

The project was removed to PECL  ( http://pecl.php.net/amqp )  as  some forks  confuse the  users.
many questions which project is better.

The PECL project have the PHP standart code and more advanced. So I'm remaining  a leader of the project.
I will make merge my patches and exists pecl source.


Alexandre

Fri, 19 Nov 2010 10:41:56 +0100 ?????? ?? diez <flatline at stresstiming.de>:

> Hi @all,
> 
> today i wanted to look on  http://code.google.com/p/php-rabbit but it is
> gone, does anybody know something about it?
> 
> Has Alexandre stopped development or has google kicked the project?
> 
> Greetings Dieter
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101119/c15cf296/attachment.htm>

From stephanion2002 at gmail.com  Sat Nov 20 05:01:59 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Sat, 20 Nov 2010 10:31:59 +0530
Subject: [rabbitmq-discuss] Doubt regarding rabbit servers in clustered
	environment
In-Reply-To: <AANLkTimDiyBOk2rmQDPmbGwMm=s1Y9k1mqdmrzAZDfWQ@mail.gmail.com>
References: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>
	<AANLkTi=b2Xsd_AOxJ_qtb7z7EqJX6Si_6mMM6BeqNUZz@mail.gmail.com>
	<AANLkTimKO98fXd=e2Z=iWsKP-k2pwoiqLHhCYQo3Ff_T@mail.gmail.com>
	<AANLkTimDiyBOk2rmQDPmbGwMm=s1Y9k1mqdmrzAZDfWQ@mail.gmail.com>
Message-ID: <AANLkTinuBcuwotmH9hO53Rh7LDz0KRtbXCTqWd_6=JFY@mail.gmail.com>

This is helpful Mark!

Since our 8 queues are going to handle lot of data, we can cluster 8
RabbitMQ nodes, each to serve a single queue and its contents. But there are
two concerns:

1. In the case a node (say, containing queue a) is down, how will the queue
a's consumers will get their messages?

2. A load balancer like HA Proxy in front of these nodes will not be of any
use since nodes are not similar.

I am afraid that since we are neither getting "Load balancing" nor "High
availability",  we will have to consider another broker.

Please let me know your thoughts about it.

Regards,
Kshitiz Garg



On Fri, Nov 19, 2010 at 10:34 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Fri, Nov 19, 2010 at 16:46, Kshitiz Garg <stephanion2002 at gmail.com>
> wrote:
> > Thanks for the reply Mark,
> >
> > In our case, we
> >
> > 1. Create two exchanges A and B
> > 2. Create 8 queues a,b,c,d,e,f,g,h
> > 3. Bind A,B to these queues.
> > 4. Consumer is listening to a,b,c,d,e,f,g,h ......
> > 5. For the above operations, we are using two Rabbit MQ nodes in
> clustered
> > mode.
> >
> > Please let us know the behaviour of clustered RabbitMQs ....
> >
> > Also, I could not understand the statement "all the traffic to a queue
> gets
> > forwarded to one particular node."  (we send the messages to an exchange
> and
> > not a queue, isn't it ?)
>
> Right. I said it's complex :)
>
> All the metadata lives in a replicated Erlang database (mnesia). That
> includes:
> exchanges, bindings, credentials and so on.
>
> So, if you update anything of that - it will be immediately visible
> in the whole cluster. In other words: when you create an exchange
> A on node 1, that will automatically create exchange A on node 2.
>
> Now, with queues that's more complex. When you connect to node 1
> and do queue_declare(xx), you are actually creating a queue on
> that particular node. This information (queue xx is created on node 1)
> is shared with other nodes. All the nodes know that a location of
> queue xx is node1.
>
> Whenever you publish stuff, to whatever node, the message
> is pushed to a local exchange (as mentioned before, exchanges
> are 'copied' to every node). Next step after the exchange
> is the binding. The bindings are also 'copied' to all the nodes.
> At that point the node knows: this message should go to a queue xx.
>
> The node looks up where the queue lives and pushes a message to
> a particular node that holds queue xx.
>
> So, once again: exchanges and bindings are replicated, they
> are the same for every node in the cluster.
> Queue on the other hand lives on a particular node (actually
> on the node that 'queue_declare' was executed).
>
> Clustering != HA
> (the messages (queue contents) live on a single node)
>
> (I'm sure my friends from the team will clarify if I got the details wrong)
>
> Is this description any better?
>
> Cheers,
>   Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101120/2aeba6ba/attachment-0001.htm>

From radu at picohost.net  Sun Nov 21 20:16:34 2010
From: radu at picohost.net (Radu Voicilas)
Date: Sun, 21 Nov 2010 22:16:34 +0200
Subject: [rabbitmq-discuss] RabbitMQ's Erlang client status
Message-ID: <201011212216.34421.radu@picohost.net>

Hi,

Is there a page where one can find out the current status of the Erlang client? 
I know that it was supposed to be oficially supported someday soon, but I don't 
know how to find out.

Thanks!

From matthew at rabbitmq.com  Sun Nov 21 21:23:54 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 21 Nov 2010 21:23:54 +0000
Subject: [rabbitmq-discuss] RabbitMQ's Erlang client status
In-Reply-To: <201011212216.34421.radu@picohost.net>
References: <201011212216.34421.radu@picohost.net>
Message-ID: <20101121212352.GA15734@wellquite.org>

Hi,

On Sun, Nov 21, 2010 at 10:16:34PM +0200, Radu Voicilas wrote:
> Is there a page where one can find out the current status of the Erlang client? 

Err, no, not really.

> I know that it was supposed to be oficially supported someday soon, but I don't 
> know how to find out.

It's still not supported officially I'm afraid. There's a finite list of
work that needs to get done on it before it becomes officially
supported. The list occasionally grows. It'll get there, but "someday
soon" is likely a little optimistic.

Matthew

From taylste at gmail.com  Sun Nov 21 21:52:09 2010
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 22 Nov 2010 08:52:09 +1100
Subject: [rabbitmq-discuss] stop when queue is empty
Message-ID: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>

Hi,

I was planning on using a BasicGet return value of null as a termination
condition.

The pattern I'm working with that this enables is:
-> stream from database
-> do some stuff in parallel
-> stream back to database

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/e85d2f61/attachment.htm>

From taylste at gmail.com  Sun Nov 21 23:11:11 2010
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 22 Nov 2010 10:11:11 +1100
Subject: [rabbitmq-discuss] queue limits
Message-ID: <AANLkTim0HA9NSMP5RMFA4+AJvQHv1HcewjXx0416CG_J@mail.gmail.com>

Are there any limits to how long or large a queue can get apart from disk
space?

Is there a limit to the message size?

Is there a limit to the number of queue?  Rather than one bus/queue with
many message types, I'm creating a few queue for each simple units of work +
having only a few message types per queue.  Does anyone see a problem with
this approach when using RabbitMQ?

I'm at that nervous stage of it looks good, but I'm not quite sure yet.  I
guess I'm asking for experiences without having fully tested.  I'm hoping to
avoid potential pitfalls and save some time.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/1e55f2db/attachment.htm>

From matthew at rabbitmq.com  Sun Nov 21 23:33:12 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 21 Nov 2010 23:33:12 +0000
Subject: [rabbitmq-discuss] queue limits
In-Reply-To: <AANLkTim0HA9NSMP5RMFA4+AJvQHv1HcewjXx0416CG_J@mail.gmail.com>
References: <AANLkTim0HA9NSMP5RMFA4+AJvQHv1HcewjXx0416CG_J@mail.gmail.com>
Message-ID: <20101121233309.GB15734@wellquite.org>

On Mon, Nov 22, 2010 at 10:11:11AM +1100, Steven Taylor wrote:
> Are there any limits to how long or large a queue can get apart from disk
> space?

Yes. Unless you're using the rabbitmq-toke plugin, there is still a
(very small) per message RAM cost in the form of an index from message
guid to file+offset+size. Ultimately, you can end up with all your RAM
in this index, and thus even though all messages are on disk, you won't
be able to add more messages to a queue.

> Is there a limit to the message size?

Nope, but it must be able to fit in RAM, and it's probably risky to
attempt any message greater than one quarter of the amount of RAM
installed owing to copying of the message etc which is likely to occur.

> Is there a limit to the number of queue?

Yes. Each queue in Rabbit is an Erlang process. By default, we start up
the Erlang VM configured for a million processes, so you should be able
to get close to that, especially off a single connection and channel. If
you need to get to these sorts of numbers then you may well need to
raise the Erlang VM process limit further. This will cost more RAM, but
will allow you to create more AMQP resources.

> Rather than one bus/queue with
> many message types, I'm creating a few queue for each simple units of work +
> having only a few message types per queue.  Does anyone see a problem with
> this approach when using RabbitMQ?

No, but if you need high performance and scalability, you may run into
issues. You may want to look at the queue expiry stuff as well and
obviously judicious use of exclusive and auto-delete flags is warranted.

> I'm at that nervous stage of it looks good, but I'm not quite sure yet.  I
> guess I'm asking for experiences without having fully tested.  I'm hoping to
> avoid potential pitfalls and save some time.

If in doubt, test ;) It _will_ fail at some point - and you need to
discover where that point is and how close it is to your requirements.

Matthew

From jasonjwwilliams at gmail.com  Mon Nov 22 02:01:14 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 21 Nov 2010 19:01:14 -0700
Subject: [rabbitmq-discuss] RabbitMQ in Action is in early access!
Message-ID: <AANLkTinunut=Z-Qxa+guBxdCqr2ns6J-Ao0phmo_yxcs@mail.gmail.com>

We wanted to let everybody know that RabbitMQ in Action just got
posted for early access. We're still working on chapters around
clustering and monitoring, but we'd appreciate everybody's feedback!

http://manning.com/videla/

-J

From ewangchong at gmail.com  Mon Nov 22 04:50:55 2010
From: ewangchong at gmail.com (WANG Chong (Bob))
Date: Mon, 22 Nov 2010 12:50:55 +0800
Subject: [rabbitmq-discuss] Help!
Message-ID: <AANLkTi=MFzZpOFAabg-u3FXqzC=ArnJjzJ6knwmHyRwv@mail.gmail.com>

Hi all,

I am wondering is there anybody who can answer my question?

I am using RabbitMQ for the messaging broker in my application, now the
scenario is a same service may be replicated to many nodes, they need to
receive the same message in some cases. My proposal is to create many queues
listening a fan-out exchange, but my boss doubt that this will cost too many
resources on the messaging server, so he insists not to create new queues
but same services listening on the same queue, is this feasible? Any body
who can help?

Thanks a lot!

-- 
Yours Sincerely
WANG Chong (Bob)
Mobile: +86 (0) 1370-651-7250
MSN: ewangchong at msn.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/e7656e4b/attachment.htm>

From stephanion2002 at gmail.com  Mon Nov 22 06:23:35 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Mon, 22 Nov 2010 11:53:35 +0530
Subject: [rabbitmq-discuss] Doubt regarding rabbit servers in clustered
	environment
In-Reply-To: <AANLkTinuBcuwotmH9hO53Rh7LDz0KRtbXCTqWd_6=JFY@mail.gmail.com>
References: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>
	<AANLkTi=b2Xsd_AOxJ_qtb7z7EqJX6Si_6mMM6BeqNUZz@mail.gmail.com>
	<AANLkTimKO98fXd=e2Z=iWsKP-k2pwoiqLHhCYQo3Ff_T@mail.gmail.com>
	<AANLkTimDiyBOk2rmQDPmbGwMm=s1Y9k1mqdmrzAZDfWQ@mail.gmail.com>
	<AANLkTinuBcuwotmH9hO53Rh7LDz0KRtbXCTqWd_6=JFY@mail.gmail.com>
Message-ID: <AANLkTin1qK3BRMH+=5qtZfj-Xzb9nPYdcfaNVwfoyAcV@mail.gmail.com>

Hi,

Please help us, someone ?

Regards,
Kshitiz Garg

On Sat, Nov 20, 2010 at 10:31 AM, Kshitiz Garg <stephanion2002 at gmail.com>wrote:

> This is helpful Mark!
>
> Since our 8 queues are going to handle lot of data, we can cluster 8
> RabbitMQ nodes, each to serve a single queue and its contents. But there are
> two concerns:
>
> 1. In the case a node (say, containing queue a) is down, how will the queue
> a's consumers will get their messages?
>
> 2. A load balancer like HA Proxy in front of these nodes will not be of any
> use since nodes are not similar.
>
> I am afraid that since we are neither getting "Load balancing" nor "High
> availability",  we will have to consider another broker.
>
> Please let me know your thoughts about it.
>
> Regards,
> Kshitiz Garg
>
>
>
>
> On Fri, Nov 19, 2010 at 10:34 PM, Marek Majkowski <majek04 at gmail.com>wrote:
>
>> On Fri, Nov 19, 2010 at 16:46, Kshitiz Garg <stephanion2002 at gmail.com>
>> wrote:
>> > Thanks for the reply Mark,
>> >
>> > In our case, we
>> >
>> > 1. Create two exchanges A and B
>> > 2. Create 8 queues a,b,c,d,e,f,g,h
>> > 3. Bind A,B to these queues.
>> > 4. Consumer is listening to a,b,c,d,e,f,g,h ......
>> > 5. For the above operations, we are using two Rabbit MQ nodes in
>> clustered
>> > mode.
>> >
>> > Please let us know the behaviour of clustered RabbitMQs ....
>> >
>> > Also, I could not understand the statement "all the traffic to a queue
>> gets
>> > forwarded to one particular node."  (we send the messages to an exchange
>> and
>> > not a queue, isn't it ?)
>>
>> Right. I said it's complex :)
>>
>> All the metadata lives in a replicated Erlang database (mnesia). That
>> includes:
>> exchanges, bindings, credentials and so on.
>>
>> So, if you update anything of that - it will be immediately visible
>> in the whole cluster. In other words: when you create an exchange
>> A on node 1, that will automatically create exchange A on node 2.
>>
>> Now, with queues that's more complex. When you connect to node 1
>> and do queue_declare(xx), you are actually creating a queue on
>> that particular node. This information (queue xx is created on node 1)
>> is shared with other nodes. All the nodes know that a location of
>> queue xx is node1.
>>
>> Whenever you publish stuff, to whatever node, the message
>> is pushed to a local exchange (as mentioned before, exchanges
>> are 'copied' to every node). Next step after the exchange
>> is the binding. The bindings are also 'copied' to all the nodes.
>> At that point the node knows: this message should go to a queue xx.
>>
>> The node looks up where the queue lives and pushes a message to
>> a particular node that holds queue xx.
>>
>> So, once again: exchanges and bindings are replicated, they
>> are the same for every node in the cluster.
>> Queue on the other hand lives on a particular node (actually
>> on the node that 'queue_declare' was executed).
>>
>> Clustering != HA
>> (the messages (queue contents) live on a single node)
>>
>> (I'm sure my friends from the team will clarify if I got the details
>> wrong)
>>
>> Is this description any better?
>>
>> Cheers,
>>   Marek
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/ac72689a/attachment-0001.htm>

From coolchen033 at gmail.com  Mon Nov 22 07:38:36 2010
From: coolchen033 at gmail.com (=?GB2312?B?s8LOsMa9?=)
Date: Mon, 22 Nov 2010 15:38:36 +0800
Subject: [rabbitmq-discuss] max channels
Message-ID: <AANLkTimqerrQduuF5kj668WXU69gYFtQU83ocA6LhiYC@mail.gmail.com>

hi everyone

i'm use rabbitmq to store url and consumer get the url to crawl  now,*
the *problem
is : i user Multithread in consumer and each thread use  one channel.
so rabbitmq server has so many channels,how many channels rabbitmq server
can support ? or i should modify code for Multithread use same channel ?
it's seems hard to write
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/e7574087/attachment.htm>

From taylste at gmail.com  Mon Nov 22 07:38:53 2010
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 22 Nov 2010 18:38:53 +1100
Subject: [rabbitmq-discuss] queue limits
In-Reply-To: <20101121233309.GB15734@wellquite.org>
References: <AANLkTim0HA9NSMP5RMFA4+AJvQHv1HcewjXx0416CG_J@mail.gmail.com>
	<20101121233309.GB15734@wellquite.org>
Message-ID: <AANLkTing4urJpboo9aS5ipv9MH34hLBg=4v8HrdHSSbj@mail.gmail.com>

On 22 November 2010 10:33, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Mon, Nov 22, 2010 at 10:11:11AM +1100, Steven Taylor wrote:
> > Are there any limits to how long or large a queue can get apart from disk
> > space?
>
> Yes. Unless you're using the rabbitmq-toke plugin, there is still a
> (very small) per message RAM cost in the form of an index from message
> guid to file+offset+size. Ultimately, you can end up with all your RAM
> in this index, and thus even though all messages are on disk, you won't
> be able to add more messages to a queue.
>

Fine

> Is there a limit to the message size?

Nope, but it must be able to fit in RAM, and it's probably risky to
> attempt any message greater than one quarter of the amount of RAM
> installed owing to copying of the message etc which is likely to occur.
>

Sounds sensible.


>
> > Is there a limit to the number of queue?
>
> Yes. Each queue in Rabbit is an Erlang process. By default, we start up
> the Erlang VM configured for a million processes, so you should be able
> to get close to that, especially off a single connection and channel. If
> you need to get to these sorts of numbers then you may well need to
> raise the Erlang VM process limit further. This will cost more RAM, but
> will allow you to create more AMQP resources.
>

So far we're talking 15 queus. I think we're okay. ;)


>
> > Rather than one bus/queue with
> > many message types, I'm creating a few queue for each simple units of
> work +
> > having only a few message types per queue.  Does anyone see a problem
> with
> > this approach when using RabbitMQ?
>
> No, but if you need high performance and scalability, you may run into
> issues. You may want to look at the queue expiry stuff as well and
> obviously judicious use of exclusive and auto-delete flags is warranted.
>
>
we're not talking super high performance (yet). I'll need to watch this and
get a feel for it.



> > I'm at that nervous stage of it looks good, but I'm not quite sure yet.
>  I
> > guess I'm asking for experiences without having fully tested.  I'm hoping
> to
> > avoid potential pitfalls and save some time.
>
> If in doubt, test ;) It _will_ fail at some point - and you need to
> discover where that point is and how close it is to your requirements.
>

I have been testing, but sometimes I will need you guys to help me know
what's going on underneath.


thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/460e3081/attachment.htm>

From ewangchong at gmail.com  Mon Nov 22 04:42:25 2010
From: ewangchong at gmail.com (WANG Chong (Bob))
Date: Mon, 22 Nov 2010 12:42:25 +0800
Subject: [rabbitmq-discuss] Help!
Message-ID: <AANLkTikOqwoiVQRgJJT9mvEaFYQ3EmpR9j_Q6B+MKc5N@mail.gmail.com>

Hi all,

I am wondering is there anybody who can answer my question?

I am using RabbitMQ for the messaging broker in my application, now the
scenario is a same service may be replicated to many nodes, they need to
receive the same message in some cases. My proposal is to create many queues
listening a fan-out exchange, but my boss doubt that this will cost too many
resources on the messaging server, so he insists not to create new queues
but same services listening on the same queue, is this feasible? Any body
who can help?

Thanks a lot!

-- 
Yours Sincerely
WANG Chong (Bob)
Mobile: +86 (0) 1370-651-7250
MSN: ewangchong at msn.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/3a781ecb/attachment.htm>

From coolchen033 at gmail.com  Mon Nov 22 07:29:10 2010
From: coolchen033 at gmail.com (=?GB2312?B?s8LOsMa9?=)
Date: Mon, 22 Nov 2010 15:29:10 +0800
Subject: [rabbitmq-discuss] max channels
Message-ID: <AANLkTimaw_mEzC0LVwFQYL7_pc9WDOTy_zBAuQBkUM7P@mail.gmail.com>

hi everyone

i'm use rabbitmq to store url and consumer get the url to crawl  now,*
the *problem
is : i user Multithread in consumer and each thread use  one channel.
so rabbitmq server has so many channels,how many channels rabbitmq server
can support ? or i should modify code for Multithread use same channel ?
it's seems hard to write
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/9f40778c/attachment.htm>

From radu at picohost.net  Mon Nov 22 08:31:00 2010
From: radu at picohost.net (Radu Voicilas)
Date: Mon, 22 Nov 2010 10:31:00 +0200
Subject: [rabbitmq-discuss] RabbitMQ's Erlang client status
In-Reply-To: <20101121212352.GA15734@wellquite.org>
References: <201011212216.34421.radu@picohost.net>
	<20101121212352.GA15734@wellquite.org>
Message-ID: <201011221031.00367.radu@picohost.net>

On Sunday, November 21, 2010 11:23:54 pm Matthew Sackman wrote:
> Hi,
> 
> On Sun, Nov 21, 2010 at 10:16:34PM +0200, Radu Voicilas wrote:
> > Is there a page where one can find out the current status of the Erlang
> > client?
> 
> Err, no, not really.
> 
> > I know that it was supposed to be oficially supported someday soon, but I
> > don't know how to find out.
> 
> It's still not supported officially I'm afraid. There's a finite list of
> work that needs to get done on it before it becomes officially
> supported. The list occasionally grows. It'll get there, but "someday
> soon" is likely a little optimistic.

It seems like you guys are open to accepting code so if some kind of TODO list 
is added somewhere, maybe you'll find contributors that maybe will speed up the 
process.

My 2 cents.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Nov 22 09:04:31 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Nov 2010 09:04:31 +0000
Subject: [rabbitmq-discuss] Help!
In-Reply-To: <AANLkTi=MFzZpOFAabg-u3FXqzC=ArnJjzJ6knwmHyRwv@mail.gmail.com>
References: <AANLkTi=MFzZpOFAabg-u3FXqzC=ArnJjzJ6knwmHyRwv@mail.gmail.com>
Message-ID: <4CEA321F.2010808@rabbitmq.com>

On 22/11/2010 4:50AM, WANG Chong (Bob) wrote:
> My proposal is to create many
> queues listening a fan-out exchange, but my boss doubt that this will
> cost too many resources on the messaging server, so he insists not to
> create new queues but same services listening on the same queue, is this
> feasible? Any body who can help?

Hi Wang.

The two proposals will do two different things - if you have many 
consumers on one queue, each message will only be consumed once, by one 
of the consumers. With each consumer having its own queue, each message 
will be consumer by every consumer.

If you're concerned about performance I suggest running some tests. 
Queues are not *that* expensive, although obviously delivering the same 
message multiple times will cost more than delivering it once.

Cheers, Simon

From alexis at rabbitmq.com  Mon Nov 22 09:25:56 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 22 Nov 2010 09:25:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ in Action is in early access!
In-Reply-To: <AANLkTinunut=Z-Qxa+guBxdCqr2ns6J-Ao0phmo_yxcs@mail.gmail.com>
References: <AANLkTinunut=Z-Qxa+guBxdCqr2ns6J-Ao0phmo_yxcs@mail.gmail.com>
Message-ID: <AANLkTin46aZ1DK1T-M6KFDDoe6vvn2NCZjfX0_JhErB7@mail.gmail.com>

Well done guys!

On Mon, Nov 22, 2010 at 2:01 AM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> We wanted to let everybody know that RabbitMQ in Action just got
> posted for early access. We're still working on chapters around
> clustering and monitoring, but we'd appreciate everybody's feedback!
>
> http://manning.com/videla/
>
> -J
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From peter at cacoethes.co.uk  Mon Nov 22 08:53:02 2010
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Mon, 22 Nov 2010 08:53:02 +0000
Subject: [rabbitmq-discuss] Message stalls in the queue for long time
Message-ID: <AANLkTi=H81CGg-eiyW2E_AN9kU8T1MCYOQEWUfnBOepX@mail.gmail.com>

I can only think that the message listeners stop running for some
reason (perhaps an exception?) or the messages don't match the
requirements of the listeners. Are the messages picked up when you
restart the Grails application? If they are still there after
restarting the application, then the latter is the more likely
explanation.

What version of the Grails plugin are you using? What does the code
for your handlers look like? Are you specifying a specific type in the
handleMessage() signature?

Regards,

Peter

-- 
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From emile at rabbitmq.com  Mon Nov 22 09:53:05 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Nov 2010 09:53:05 +0000
Subject: [rabbitmq-discuss] Help!
In-Reply-To: <AANLkTikOqwoiVQRgJJT9mvEaFYQ3EmpR9j_Q6B+MKc5N@mail.gmail.com>
References: <AANLkTikOqwoiVQRgJJT9mvEaFYQ3EmpR9j_Q6B+MKc5N@mail.gmail.com>
Message-ID: <4CEA3D81.1010309@rabbitmq.com>


Hi Bob,

On 22/11/10 04:42, WANG Chong (Bob) wrote:
> Hi all,
> 
> I am wondering is there anybody who can answer my question?
> 
> I am using RabbitMQ for the messaging broker in my application, now the
> scenario is a same service may be replicated to many nodes, they need to
> receive the same message in some cases. My proposal is to create many
> queues listening a fan-out exchange, but my boss doubt that this will
> cost too many resources on the messaging server, so he insists not to
> create new queues but same services listening on the same queue, is this
> feasible? Any body who can help?

The normal pattern is to have many consumers listen to a single queue in
cases where the message needs to be picked up by a single consumer. If
the same message needs to be delivered to many consumers then you should
create a queue and a binding for each consumer.

Creating many queues do consume more resources, but it is possible for
commodity hardware to support tens of thousands of queues. If the queues
exceed the resource budget of your server then clustering can help you
to spread the load.

Regards

Emile

From majek04 at gmail.com  Mon Nov 22 10:16:08 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 22 Nov 2010 10:16:08 +0000
Subject: [rabbitmq-discuss] max channels
In-Reply-To: <AANLkTimqerrQduuF5kj668WXU69gYFtQU83ocA6LhiYC@mail.gmail.com>
References: <AANLkTimqerrQduuF5kj668WXU69gYFtQU83ocA6LhiYC@mail.gmail.com>
Message-ID: <AANLkTikw=rYfuAdaCRwe376rMrUgfZbe3DQS4LcAE9rB@mail.gmail.com>

On Mon, Nov 22, 2010 at 07:38, ??? <coolchen033 at gmail.com> wrote:
> so rabbitmq server has so many channels,how many channels rabbitmq server
> can support ? or i should modify code for?Multithread use same channel ?

RabbitMQ doesn't impose any limit on channels. Theoretically you may
create as many channels as you have free erlang-process-ids. Which
is usually about 32k.

But in practice RabbitMQ shouldn't be using too many channels.
If you're using more than a dozen of channels for a consumer, you're
probably doing something wrong.

You may run multiple 'basic.consumes' on one channel. But when you
share a channel between threads remember to make sure the access
is synchronized.

Cheers,
  Marek

From ewangchong at gmail.com  Mon Nov 22 10:21:07 2010
From: ewangchong at gmail.com (WANG Chong (Bob))
Date: Mon, 22 Nov 2010 18:21:07 +0800
Subject: [rabbitmq-discuss] Help!
In-Reply-To: <4CEA3D81.1010309@rabbitmq.com>
References: <AANLkTikOqwoiVQRgJJT9mvEaFYQ3EmpR9j_Q6B+MKc5N@mail.gmail.com>
	<4CEA3D81.1010309@rabbitmq.com>
Message-ID: <AANLkTi=sDcyzUVH--Enz1m3iq84MfN-46kJC4h1yGXpm@mail.gmail.com>

Hi Steven, Taylor and Emile,

thanks a lot, I think you have answered my question, I actually explained to
my boss, but he means to create as fewer queues as possble, and dispatch
messages on each node, where all the services running on. Maybe I need to
write a dispatcher or something, and have to handle the priority or load
balance issue by myself, oh my...

On Mon, Nov 22, 2010 at 5:53 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Bob,
>
> On 22/11/10 04:42, WANG Chong (Bob) wrote:
> > Hi all,
> >
> > I am wondering is there anybody who can answer my question?
> >
> > I am using RabbitMQ for the messaging broker in my application, now the
> > scenario is a same service may be replicated to many nodes, they need to
> > receive the same message in some cases. My proposal is to create many
> > queues listening a fan-out exchange, but my boss doubt that this will
> > cost too many resources on the messaging server, so he insists not to
> > create new queues but same services listening on the same queue, is this
> > feasible? Any body who can help?
>
> The normal pattern is to have many consumers listen to a single queue in
> cases where the message needs to be picked up by a single consumer. If
> the same message needs to be delivered to many consumers then you should
> create a queue and a binding for each consumer.
>
> Creating many queues do consume more resources, but it is possible for
> commodity hardware to support tens of thousands of queues. If the queues
> exceed the resource budget of your server then clustering can help you
> to spread the load.
>
> Regards
>
> Emile
>



-- 
Yours Sincerely
WANG Chong (Bob)
Mobile: +86 (0) 1370-651-7250
MSN: ewangchong at msn.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/1f0b6d76/attachment.htm>

From majek04 at gmail.com  Mon Nov 22 10:25:25 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 22 Nov 2010 10:25:25 +0000
Subject: [rabbitmq-discuss] Doubt regarding rabbit servers in clustered
	environment
In-Reply-To: <AANLkTinuBcuwotmH9hO53Rh7LDz0KRtbXCTqWd_6=JFY@mail.gmail.com>
References: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>
	<AANLkTi=b2Xsd_AOxJ_qtb7z7EqJX6Si_6mMM6BeqNUZz@mail.gmail.com>
	<AANLkTimKO98fXd=e2Z=iWsKP-k2pwoiqLHhCYQo3Ff_T@mail.gmail.com>
	<AANLkTimDiyBOk2rmQDPmbGwMm=s1Y9k1mqdmrzAZDfWQ@mail.gmail.com>
	<AANLkTinuBcuwotmH9hO53Rh7LDz0KRtbXCTqWd_6=JFY@mail.gmail.com>
Message-ID: <AANLkTimQpynw=DZaoj63RoF5GQhfb0EWms_=3_Hifc2C@mail.gmail.com>

On Sat, Nov 20, 2010 at 05:01, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
> Since our 8 queues are going to handle lot of data, we can cluster 8
> RabbitMQ nodes, each to serve a single queue and its contents. But there are
> two concerns:

Remember that any modification of shared database must be agreed between
all the nodes in the cluster. 8 nodes is a lot and might result in a
latency for commands like exchange.declare or queue.bind. We rarely
see a cluster of more than a few nodes.

> 1. In the case a node (say, containing queue a) is down, how will the queue
> a's consumers will get their messages?

They won't.

> 2. A load balancer like HA Proxy in front of these nodes will not be of any
> use since nodes are not similar.

It would help to spread the connections equally between nodes.
That is pretty useful if you have a lot of connections.

> I am afraid that since we are neither getting "Load balancing" nor "High
> availability",? we will have to consider another broker.

For HA we're usually suggesting Active-Passive failover:
  http://www.rabbitmq.com/pacemaker.html
We're currently working on Active-Active HA, but it will take us some time.

Clustering does help in "Load balancing" but only in some situations.
For example it may be pretty useful for the 'fanout' cases, when you
have many queues.

But if you have a single queue, clustering won't help you.
It's a bit like with database sharding, if you have one monolitic table -
sharding won't help.

Cheers,
  Marek

From majek04 at gmail.com  Mon Nov 22 10:31:28 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 22 Nov 2010 10:31:28 +0000
Subject: [rabbitmq-discuss] stop when queue is empty
In-Reply-To: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>
References: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>
Message-ID: <AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>

Steven,

Have you seen this thread:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009223.html

On Sun, Nov 21, 2010 at 21:52, Steven Taylor <taylste at gmail.com> wrote:
> Hi,
>
> I was planning on using a BasicGet return value of null as a termination
> condition.
>
> The pattern I'm working with that this enables is:
> -> stream from database
> -> do some stuff in parallel
> -> stream back to database
>
> thanks,
> -Steven
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From sunshinesucker at gmail.com  Mon Nov 22 11:29:35 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Mon, 22 Nov 2010 11:29:35 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
	<FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>
Message-ID: <AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>

Jon,

I tried your updated version and get a error when starting the server:
failed to load application lhttpc.  Am I missing something with installing
the plugin? I added the three files that were on the zip file...


On 19 November 2010 15:53, Jon Brisbin <jon.brisbin at npcinternational.com>wrote:

> I just updated GitHub with some code changes to make the webhooks plugin
> work with RabbitMQ 2.1.1 and the latest erlang AMQP client. I also uploaded
> a binary with just the plugins needed to the "Downloads" section.
>
> jb
>
>
> On Nov 19, 2010, at 6:12 AM, sunghyun lee wrote:
>
> > Hello,
> >
> > I am thinking about upgrading the 2.1.1 and was wondering if someone
> would provide some steps on how to build the webhooks plugin against it
> without the plugin crashing the server?  When i run the make file it builds
> however I get a lot of warning with the lhttpc_lib.erl file and bool() type
> now being called boolean(). I have changed the files but I still get a
> kernel pid terminated message.  I also get a warning message regarding
> undefined function amqp_connection:start_direct/0.
> >
> >
> > Has anyone got webhooks to work with 2.1.1? The logs are not telling me
> anything useful. Any suggestions would be great at this point...
> >
> > thanks!
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/0625fdd9/attachment.htm>

From taylste at gmail.com  Mon Nov 22 12:14:47 2010
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 22 Nov 2010 23:14:47 +1100
Subject: [rabbitmq-discuss] stop when queue is empty
In-Reply-To: <AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>
References: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>
	<AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>
Message-ID: <AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>

Thanks. That's useful. So there's a consumer count. I'd been thinking about
misbehaving workers... meaning that we may be waiting for a message to
reappear on the queue after a time to live period has expired? So that would
mean the worker can go on misbehaving and we wont care.  Of course this
assumes the message itself isn't malformed. We're not in a perfect world, so
choose one and move on.

In this situation nothing destructive needs to happen. Finished or nearly
finished is good enough for me.

-Steven


On 22 November 2010 21:31, Marek Majkowski <majek04 at gmail.com> wrote:

> Steven,
>
> Have you seen this thread:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009223.html
>
> On Sun, Nov 21, 2010 at 21:52, Steven Taylor <taylste at gmail.com> wrote:
> > Hi,
> >
> > I was planning on using a BasicGet return value of null as a termination
> > condition.
> >
> > The pattern I'm working with that this enables is:
> > -> stream from database
> > -> do some stuff in parallel
> > -> stream back to database
> >
> > thanks,
> > -Steven
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/9d431546/attachment.htm>

From majek04 at gmail.com  Mon Nov 22 12:54:01 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 22 Nov 2010 12:54:01 +0000
Subject: [rabbitmq-discuss] stop when queue is empty
In-Reply-To: <AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>
References: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>
	<AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>
	<AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>
Message-ID: <AANLkTinWb1bBdCNH=Fwqs4uym0j1u6Onimxz5YTn7oJ-@mail.gmail.com>

On Mon, Nov 22, 2010 at 12:14, Steven Taylor <taylste at gmail.com> wrote:
> Thanks. That's useful. So there's a consumer count. I'd been thinking about
> misbehaving workers... meaning that we may be waiting for a message to
> reappear on the queue after a time to live period has expired? So that would
> mean the worker can go on misbehaving and we wont care.? Of course this
> assumes the message itself isn't malformed.?We're not in a perfect world, so
> choose one and move on.
>
> In this situation nothing destructive needs to happen. Finished or nearly
> finished is good enough for me.

In that case just run basic.get or queue.declare and check the message count.

Cheers,
  Marek


> -Steven
>
> On 22 November 2010 21:31, Marek Majkowski <majek04 at gmail.com> wrote:
>>
>> Steven,
>>
>> Have you seen this thread:
>>
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009223.html
>>
>> On Sun, Nov 21, 2010 at 21:52, Steven Taylor <taylste at gmail.com> wrote:
>> > Hi,
>> >
>> > I was planning on using a BasicGet return value of null as a termination
>> > condition.
>> >
>> > The pattern I'm working with that this enables is:
>> > -> stream from database
>> > -> do some stuff in parallel
>> > -> stream back to database
>> >
>> > thanks,
>> > -Steven
>> >
>

From simon at chi.swan.ac.uk  Mon Nov 22 13:17:35 2010
From: simon at chi.swan.ac.uk (Simon Thompson)
Date: Mon, 22 Nov 2010 13:17:35 +0000
Subject: [rabbitmq-discuss] .Net API event driven
Message-ID: <7DF3B42CC0C71B4A8E0A3546F223B690149DE4@Zoidberg.chi.swan.ac.uk>

Just wanted to let people know I have an example of thread safe event driven subscription to RabbitMQ - my use case is a windows UI that need to receive messages fro a RabbitMQ queue without blocking the thread.

Check it out if its of interest to you at http://rabbitears.codeplex.com/

Thanks
Simon

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/d76cf30c/attachment.htm>

From jim at rabbitmq.com  Mon Nov 22 14:04:22 2010
From: jim at rabbitmq.com (Jim Apperly)
Date: Mon, 22 Nov 2010 14:04:22 +0000
Subject: [rabbitmq-discuss] Improving our documentation
Message-ID: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>

Back in October, Marek announced that we had started work on some beginners'
tutorials for RabbitMQ [1].

I am very pleased to be able to let everyone know that the first "Get
Started" tutorials have gone live on the RabbitMQ website today. Thank you
to everyone who provided comments and feedback - please keep them coming.

The tutorials are available at:
http://www.rabbitmq.com/getstarted.html

This is by no means the end of the work we are doing to make our
documentation better so expect to see more improvements over the coming
weeks and months. If you have any ideas about what you would like to see
(or, indeed, what you wouldn't) then please let us know.

Jim


______________________________________________
[1]
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/69f96899/attachment.htm>

From stephanion2002 at gmail.com  Mon Nov 22 14:09:46 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Mon, 22 Nov 2010 19:39:46 +0530
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
Message-ID: <AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>

There is some problem viewing the Tutorial pages on firefox ....

On Mon, Nov 22, 2010 at 7:34 PM, Jim Apperly <jim at rabbitmq.com> wrote:

> Back in October, Marek announced that we had started work on some
> beginners' tutorials for RabbitMQ [1].
>
> I am very pleased to be able to let everyone know that the first "Get
> Started" tutorials have gone live on the RabbitMQ website today. Thank you
> to everyone who provided comments and feedback - please keep them coming.
>
> The tutorials are available at:
> http://www.rabbitmq.com/getstarted.html
>
> This is by no means the end of the work we are doing to make our
> documentation better so expect to see more improvements over the coming
> weeks and months. If you have any ideas about what you would like to see
> (or, indeed, what you wouldn't) then please let us know.
>
> Jim
>
>
> ______________________________________________
> [1]
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/2707e62c/attachment.htm>

From jim at rabbitmq.com  Mon Nov 22 14:12:03 2010
From: jim at rabbitmq.com (Jim Apperly)
Date: Mon, 22 Nov 2010 14:12:03 +0000
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
Message-ID: <AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>

On 22 November 2010 14:09, Kshitiz Garg <stephanion2002 at gmail.com> wrote:

> There is some problem viewing the Tutorial pages on firefox ....
>

Please can you elaborate?  It works fine for me (FF 3.5.13 on Windows).

Jim



>
> On Mon, Nov 22, 2010 at 7:34 PM, Jim Apperly <jim at rabbitmq.com> wrote:
>
>> Back in October, Marek announced that we had started work on some
>> beginners' tutorials for RabbitMQ [1].
>>
>> I am very pleased to be able to let everyone know that the first "Get
>> Started" tutorials have gone live on the RabbitMQ website today. Thank you
>> to everyone who provided comments and feedback - please keep them coming.
>>
>> The tutorials are available at:
>> http://www.rabbitmq.com/getstarted.html
>>
>> This is by no means the end of the work we are doing to make our
>> documentation better so expect to see more improvements over the coming
>> weeks and months. If you have any ideas about what you would like to see
>> (or, indeed, what you wouldn't) then please let us know.
>>
>> Jim
>>
>>
>> ______________________________________________
>> [1]
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/97c1e3d8/attachment-0001.htm>

From stephanion2002 at gmail.com  Mon Nov 22 14:17:10 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Mon, 22 Nov 2010 19:47:10 +0530
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
	<AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>
Message-ID: <AANLkTik6=QPjnzkuB6tG6Uupx0cx931zjDKnDnUNMGR8@mail.gmail.com>

Not that it's not working, but coming up differently...see the attached
Snapshots ....

On Mon, Nov 22, 2010 at 7:42 PM, Jim Apperly <jim at rabbitmq.com> wrote:

> On 22 November 2010 14:09, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
>
>> There is some problem viewing the Tutorial pages on firefox ....
>>
>
> Please can you elaborate?  It works fine for me (FF 3.5.13 on Windows).
>
> Jim
>
>
>
>>
>> On Mon, Nov 22, 2010 at 7:34 PM, Jim Apperly <jim at rabbitmq.com> wrote:
>>
>>> Back in October, Marek announced that we had started work on some
>>> beginners' tutorials for RabbitMQ [1].
>>>
>>> I am very pleased to be able to let everyone know that the first "Get
>>> Started" tutorials have gone live on the RabbitMQ website today. Thank you
>>> to everyone who provided comments and feedback - please keep them coming.
>>>
>>> The tutorials are available at:
>>> http://www.rabbitmq.com/getstarted.html
>>>
>>> This is by no means the end of the work we are doing to make our
>>> documentation better so expect to see more improvements over the coming
>>> weeks and months. If you have any ideas about what you would like to see
>>> (or, indeed, what you wouldn't) then please let us know.
>>>
>>> Jim
>>>
>>>
>>> ______________________________________________
>>> [1]
>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/c2b36dbc/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Firefox.JPG
Type: image/jpeg
Size: 124690 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/c2b36dbc/attachment-0002.jpeg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: InternetExplorer.JPG
Type: image/jpeg
Size: 113201 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/c2b36dbc/attachment-0003.jpeg>

From stephanion2002 at gmail.com  Mon Nov 22 14:18:54 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Mon, 22 Nov 2010 19:48:54 +0530
Subject: [rabbitmq-discuss] Doubt regarding rabbit servers in clustered
	environment
In-Reply-To: <AANLkTimQpynw=DZaoj63RoF5GQhfb0EWms_=3_Hifc2C@mail.gmail.com>
References: <AANLkTi=jpVRep2qa8HBheEOTcJFq8s9P8jJ01WQy3qp9@mail.gmail.com>
	<AANLkTi=b2Xsd_AOxJ_qtb7z7EqJX6Si_6mMM6BeqNUZz@mail.gmail.com>
	<AANLkTimKO98fXd=e2Z=iWsKP-k2pwoiqLHhCYQo3Ff_T@mail.gmail.com>
	<AANLkTimDiyBOk2rmQDPmbGwMm=s1Y9k1mqdmrzAZDfWQ@mail.gmail.com>
	<AANLkTinuBcuwotmH9hO53Rh7LDz0KRtbXCTqWd_6=JFY@mail.gmail.com>
	<AANLkTimQpynw=DZaoj63RoF5GQhfb0EWms_=3_Hifc2C@mail.gmail.com>
Message-ID: <AANLkTin2XWGnY+sxdMMFPajJC71v7pXF0Fc2tLEv6wJV@mail.gmail.com>

Thanks Marek,

We will do our homework on these lines and will post our doubts again.

Thanks & Regards,
Kshitiz Garg

On Mon, Nov 22, 2010 at 3:55 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Sat, Nov 20, 2010 at 05:01, Kshitiz Garg <stephanion2002 at gmail.com>
> wrote:
> > Since our 8 queues are going to handle lot of data, we can cluster 8
> > RabbitMQ nodes, each to serve a single queue and its contents. But there
> are
> > two concerns:
>
> Remember that any modification of shared database must be agreed between
> all the nodes in the cluster. 8 nodes is a lot and might result in a
> latency for commands like exchange.declare or queue.bind. We rarely
> see a cluster of more than a few nodes.
>
> > 1. In the case a node (say, containing queue a) is down, how will the
> queue
> > a's consumers will get their messages?
>
> They won't.
>
> > 2. A load balancer like HA Proxy in front of these nodes will not be of
> any
> > use since nodes are not similar.
>
> It would help to spread the connections equally between nodes.
> That is pretty useful if you have a lot of connections.
>
> > I am afraid that since we are neither getting "Load balancing" nor "High
> > availability",  we will have to consider another broker.
>
> For HA we're usually suggesting Active-Passive failover:
>  http://www.rabbitmq.com/pacemaker.html
> We're currently working on Active-Active HA, but it will take us some time.
>
> Clustering does help in "Load balancing" but only in some situations.
> For example it may be pretty useful for the 'fanout' cases, when you
> have many queues.
>
> But if you have a single queue, clustering won't help you.
> It's a bit like with database sharding, if you have one monolitic table -
> sharding won't help.
>
> Cheers,
>   Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/90f4d29a/attachment.htm>

From jiri at krutil.com  Mon Nov 22 14:21:20 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Mon, 22 Nov 2010 15:21:20 +0100
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
Message-ID: <20101122152120.12880vjdzfaobhb4@webmail.active24.cz>

Cool, good work!

Regarding the Java examples, in my opinion the following is a bit unusual:

- Java classes usually start with an uppercase letter.
- Connection.close() should be probably called from a finally block.
- Should recv.java really have an infinite loop?
- When handling an exception, one should print all the available info  
before swallowing it - for example using e.printStackTrace().

Regards
Jiri


> Back in October, Marek announced that we had started work on some beginners'
> tutorials for RabbitMQ [1].
>
> I am very pleased to be able to let everyone know that the first "Get
> Started" tutorials have gone live on the RabbitMQ website today. Thank you
> to everyone who provided comments and feedback - please keep them coming.
>
> The tutorials are available at:
> http://www.rabbitmq.com/getstarted.html
>
> This is by no means the end of the work we are doing to make our
> documentation better so expect to see more improvements over the coming
> weeks and months. If you have any ideas about what you would like to see
> (or, indeed, what you wouldn't) then please let us know.
>
> Jim
>
>
> ______________________________________________
> [1]
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
>




From jim at rabbitmq.com  Mon Nov 22 14:23:38 2010
From: jim at rabbitmq.com (Jim Apperly)
Date: Mon, 22 Nov 2010 14:23:38 +0000
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <AANLkTik6=QPjnzkuB6tG6Uupx0cx931zjDKnDnUNMGR8@mail.gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
	<AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>
	<AANLkTik6=QPjnzkuB6tG6Uupx0cx931zjDKnDnUNMGR8@mail.gmail.com>
Message-ID: <AANLkTim3y-ck6uZNeH7s7EEU1k1JRE55n3POQ2QaEOY3@mail.gmail.com>

On 22 November 2010 14:17, Kshitiz Garg <stephanion2002 at gmail.com> wrote:

> Not that it's not working, but coming up differently...see the attached
> Snapshots ....


Maybe its a cached version of the stylesheet?  You could try restarting FF
or shift-refresh may work.

Jim



> On Mon, Nov 22, 2010 at 7:42 PM, Jim Apperly <jim at rabbitmq.com> wrote:
>
>> On 22 November 2010 14:09, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
>>
>>> There is some problem viewing the Tutorial pages on firefox ....
>>>
>>
>> Please can you elaborate?  It works fine for me (FF 3.5.13 on Windows).
>>
>> Jim
>>
>>
>>
>>>
>>> On Mon, Nov 22, 2010 at 7:34 PM, Jim Apperly <jim at rabbitmq.com> wrote:
>>>
>>>> Back in October, Marek announced that we had started work on some
>>>> beginners' tutorials for RabbitMQ [1].
>>>>
>>>> I am very pleased to be able to let everyone know that the first "Get
>>>> Started" tutorials have gone live on the RabbitMQ website today. Thank you
>>>> to everyone who provided comments and feedback - please keep them coming.
>>>>
>>>> The tutorials are available at:
>>>> http://www.rabbitmq.com/getstarted.html
>>>>
>>>> This is by no means the end of the work we are doing to make our
>>>> documentation better so expect to see more improvements over the coming
>>>> weeks and months. If you have any ideas about what you would like to see
>>>> (or, indeed, what you wouldn't) then please let us know.
>>>>
>>>> Jim
>>>>
>>>>
>>>> ______________________________________________
>>>> [1]
>>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/e091d9f7/attachment.htm>

From stephanion2002 at gmail.com  Mon Nov 22 14:29:55 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Mon, 22 Nov 2010 19:59:55 +0530
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <AANLkTim3y-ck6uZNeH7s7EEU1k1JRE55n3POQ2QaEOY3@mail.gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
	<AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>
	<AANLkTik6=QPjnzkuB6tG6Uupx0cx931zjDKnDnUNMGR8@mail.gmail.com>
	<AANLkTim3y-ck6uZNeH7s7EEU1k1JRE55n3POQ2QaEOY3@mail.gmail.com>
Message-ID: <AANLkTing9384pcSeu2Wx3cBM0pwJ-HpJqWR7timwr78i@mail.gmail.com>

You are absolutely right. My bad!
Sorry :)

On Mon, Nov 22, 2010 at 7:53 PM, Jim Apperly <jim at rabbitmq.com> wrote:

> On 22 November 2010 14:17, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
>
>> Not that it's not working, but coming up differently...see the attached
>> Snapshots ....
>
>
> Maybe its a cached version of the stylesheet?  You could try restarting FF
> or shift-refresh may work.
>
> Jim
>
>
>
>> On Mon, Nov 22, 2010 at 7:42 PM, Jim Apperly <jim at rabbitmq.com> wrote:
>>
>>> On 22 November 2010 14:09, Kshitiz Garg <stephanion2002 at gmail.com>wrote:
>>>
>>>> There is some problem viewing the Tutorial pages on firefox ....
>>>>
>>>
>>> Please can you elaborate?  It works fine for me (FF 3.5.13 on Windows).
>>>
>>> Jim
>>>
>>>
>>>
>>>>
>>>> On Mon, Nov 22, 2010 at 7:34 PM, Jim Apperly <jim at rabbitmq.com> wrote:
>>>>
>>>>> Back in October, Marek announced that we had started work on some
>>>>> beginners' tutorials for RabbitMQ [1].
>>>>>
>>>>> I am very pleased to be able to let everyone know that the first "Get
>>>>> Started" tutorials have gone live on the RabbitMQ website today. Thank you
>>>>> to everyone who provided comments and feedback - please keep them coming.
>>>>>
>>>>> The tutorials are available at:
>>>>> http://www.rabbitmq.com/getstarted.html
>>>>>
>>>>> This is by no means the end of the work we are doing to make our
>>>>> documentation better so expect to see more improvements over the coming
>>>>> weeks and months. If you have any ideas about what you would like to see
>>>>> (or, indeed, what you wouldn't) then please let us know.
>>>>>
>>>>> Jim
>>>>>
>>>>>
>>>>> ______________________________________________
>>>>> [1]
>>>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/dda9d11b/attachment-0001.htm>

From adamka at dgt.com.pl  Mon Nov 22 15:06:38 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Mon, 22 Nov 2010 16:06:38 +0100
Subject: [rabbitmq-discuss]  clustering server
In-Reply-To: <AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>
References: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>	<AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>
	<AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>
Message-ID: <4CEA86FE.4020304@dgt.com.pl>

Hi,

how can I change name of node on server. Im asking because I have 2 
maschines with RabbitMQ,maschines have the same name so my nodes on 
rabbit to.
In clustering have to pass node name another rabbit serwer.

When Im clusering Rabbit between diffrent maschines need I only node 
name of another maschine? No ip addres?

Will it work if i will use only node name which are the same?


regards,
Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From jon.brisbin at npcinternational.com  Mon Nov 22 15:12:46 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 22 Nov 2010 09:12:46 -0600
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
	<FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>
	<AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>
Message-ID: <2AA38F4A-ACD9-4F93-9736-84C3157CCF84@npcinternational.com>

It looks like, in 2.1.1, the lhttpc plugin needs to be unzipped inside the plugins folder. I've no idea why this is, maybe the Rabbit folks can answer that one.

But if you go into the plugins folder and do:

mkdir lhttpc
cd lhttpc
unzip ../lhttpc.ez
cd ..
rm lhttpc.ez

then start the broker, it will start...

jb


On Nov 22, 2010, at 5:29 AM, sunghyun lee wrote:

> Jon,
> 
> I tried your updated version and get a error when starting the server: failed to load application lhttpc.  Am I missing something with installing the plugin? I added the three files that were on the zip file...
> 
> 
> On 19 November 2010 15:53, Jon Brisbin <jon.brisbin at npcinternational.com> wrote:
> I just updated GitHub with some code changes to make the webhooks plugin work with RabbitMQ 2.1.1 and the latest erlang AMQP client. I also uploaded a binary with just the plugins needed to the "Downloads" section.
> 
> jb
> 
> 
> On Nov 19, 2010, at 6:12 AM, sunghyun lee wrote:
> 
> > Hello,
> >
> > I am thinking about upgrading the 2.1.1 and was wondering if someone would provide some steps on how to build the webhooks plugin against it without the plugin crashing the server?  When i run the make file it builds however I get a lot of warning with the lhttpc_lib.erl file and bool() type now being called boolean(). I have changed the files but I still get a kernel pid terminated message.  I also get a warning message regarding undefined function amqp_connection:start_direct/0.
> >
> >
> > Has anyone got webhooks to work with 2.1.1? The logs are not telling me anything useful. Any suggestions would be great at this point...
> >
> > thanks!
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
> 
> 
> 
> 


Jon Brisbin
Portal Webmaster
NPC International, Inc.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/243c5d1e/attachment.htm>

From mikeb at rabbitmq.com  Mon Nov 22 17:24:58 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 22 Nov 2010 17:24:58 +0000
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <20101122152120.12880vjdzfaobhb4@webmail.active24.cz>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<20101122152120.12880vjdzfaobhb4@webmail.active24.cz>
Message-ID: <4CEAA76A.9070206@rabbitmq.com>

Jiri, thanks for your comments --

How's http://github.com/rabbitmq/rabbitmq-tutorials/tree/master/java 
now?  I'll update the tutorial text too.

> Regarding the Java examples, in my opinion the following is a bit unusual:
>
> - Java classes usually start with an uppercase letter.

I thought I'd get away with that one ..

> - Connection.close() should be probably called from a finally block.

This is a bit awkward, because (as it sends frames over the connection) 
Connection.close() can throw an IOException.  We may clean this up a bit 
by providing a closeQuietly().

> - Should recv.java really have an infinite loop?

It doesn't hurt, in our "Hello World" -- the nextDelivery() blocks.

> - When handling an exception, one should print all the available info
> before swallowing it - for example using e.printStackTrace().

Yes you're right, that is more idiomatic (and helpful).

Cheers,
Michael


>> Back in October, Marek announced that we had started work on some
>> beginners'
>> tutorials for RabbitMQ [1].
>>
>> I am very pleased to be able to let everyone know that the first "Get
>> Started" tutorials have gone live on the RabbitMQ website today. Thank
>> you
>> to everyone who provided comments and feedback - please keep them coming.
>>
>> The tutorials are available at:
>> http://www.rabbitmq.com/getstarted.html
>>
>> This is by no means the end of the work we are doing to make our
>> documentation better so expect to see more improvements over the coming
>> weeks and months. If you have any ideas about what you would like to see
>> (or, indeed, what you wouldn't) then please let us know.
>>
>> Jim
>>
>>
>> ______________________________________________
>> [1]
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
>>
>>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Mon Nov 22 19:35:09 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 23 Nov 2010 03:35:09 +0800
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <AANLkTing9384pcSeu2Wx3cBM0pwJ-HpJqWR7timwr78i@mail.gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
	<AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>
	<AANLkTik6=QPjnzkuB6tG6Uupx0cx931zjDKnDnUNMGR8@mail.gmail.com>
	<AANLkTim3y-ck6uZNeH7s7EEU1k1JRE55n3POQ2QaEOY3@mail.gmail.com>
	<AANLkTing9384pcSeu2Wx3cBM0pwJ-HpJqWR7timwr78i@mail.gmail.com>
Message-ID: <26AE8163-C242-4A00-81EC-1774735E1003@gmail.com>

Hi all,

I've ported the python examples to PHP, check here:

http://github.com/videlalvaro/rabbitmq-tutorials

Perhaps you could merge them to your repo?

Regards,

Alvaro

On Nov 22, 2010, at 10:29 PM, Kshitiz Garg wrote:

> You are absolutely right. My bad!
> Sorry :)
> 
> On Mon, Nov 22, 2010 at 7:53 PM, Jim Apperly <jim at rabbitmq.com> wrote:
> On 22 November 2010 14:17, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
> Not that it's not working, but coming up differently...see the attached Snapshots ....
> 
> Maybe its a cached version of the stylesheet?  You could try restarting FF or shift-refresh may work.
> 
> Jim
> 
>  
> On Mon, Nov 22, 2010 at 7:42 PM, Jim Apperly <jim at rabbitmq.com> wrote:
> On 22 November 2010 14:09, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
> There is some problem viewing the Tutorial pages on firefox ....
> 
> Please can you elaborate?  It works fine for me (FF 3.5.13 on Windows).
> 
> Jim
> 
>  
> 
> On Mon, Nov 22, 2010 at 7:34 PM, Jim Apperly <jim at rabbitmq.com> wrote:
> Back in October, Marek announced that we had started work on some beginners' tutorials for RabbitMQ [1].
> 
> I am very pleased to be able to let everyone know that the first "Get Started" tutorials have gone live on the RabbitMQ website today. Thank you to everyone who provided comments and feedback - please keep them coming.
> 
> The tutorials are available at:
> http://www.rabbitmq.com/getstarted.html
> 
> This is by no means the end of the work we are doing to make our documentation better so expect to see more improvements over the coming weeks and months. If you have any ideas about what you would like to see (or, indeed, what you wouldn't) then please let us know.
> 
> Jim
> 
> 
> ______________________________________________
> [1] http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101123/e9f08939/attachment.htm>

From jim at rabbitmq.com  Mon Nov 22 21:29:24 2010
From: jim at rabbitmq.com (Jim Apperly)
Date: Mon, 22 Nov 2010 21:29:24 +0000
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <26AE8163-C242-4A00-81EC-1774735E1003@gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
	<AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>
	<AANLkTik6=QPjnzkuB6tG6Uupx0cx931zjDKnDnUNMGR8@mail.gmail.com>
	<AANLkTim3y-ck6uZNeH7s7EEU1k1JRE55n3POQ2QaEOY3@mail.gmail.com>
	<AANLkTing9384pcSeu2Wx3cBM0pwJ-HpJqWR7timwr78i@mail.gmail.com>
	<26AE8163-C242-4A00-81EC-1774735E1003@gmail.com>
Message-ID: <AANLkTinnOrq3L56UJ+-LRKhPNtpRPEztRKW7Pz6-t5X7@mail.gmail.com>

Alvaro,

On 22 November 2010 19:35, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi all,
>
> I've ported the python examples to PHP, check here:
>
> http://github.com/videlalvaro/rabbitmq-tutorials
>

A big woo-hoo! Thank you.


Perhaps you could merge them to your repo?
>

I don't see why not :)


Jim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101122/20de74ea/attachment-0001.htm>

From jiri at krutil.com  Mon Nov 22 21:30:06 2010
From: jiri at krutil.com (Jiri Krutil)
Date: Mon, 22 Nov 2010 22:30:06 +0100
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <4CEAA76A.9070206@rabbitmq.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>	<20101122152120.12880vjdzfaobhb4@webmail.active24.cz>
	<4CEAA76A.9070206@rabbitmq.com>
Message-ID: <4CEAE0DE.2090007@krutil.com>

Michael,

I think it looks much better now.

Btw, I guess the finally block in Recv won't get executed unless an 
exception is thrown -- that means no clean shutdown is possible. But I 
guess that's OK for a hello-world app.

Regards
Jiri

> Jiri, thanks for your comments --
>
> How's http://github.com/rabbitmq/rabbitmq-tutorials/tree/master/java 
> now?  I'll update the tutorial text too.
>
>> Regarding the Java examples, in my opinion the following is a bit 
>> unusual:
>>
>> - Java classes usually start with an uppercase letter.
>
> I thought I'd get away with that one ..
>
>> - Connection.close() should be probably called from a finally block.
>
> This is a bit awkward, because (as it sends frames over the 
> connection) Connection.close() can throw an IOException.  We may clean 
> this up a bit by providing a closeQuietly().
>
>> - Should recv.java really have an infinite loop?
>
> It doesn't hurt, in our "Hello World" -- the nextDelivery() blocks.
>
>> - When handling an exception, one should print all the available info
>> before swallowing it - for example using e.printStackTrace().
>
> Yes you're right, that is more idiomatic (and helpful).
>
> Cheers,
> Michael
>
>
>>> Back in October, Marek announced that we had started work on some
>>> beginners'
>>> tutorials for RabbitMQ [1].
>>>
>>> I am very pleased to be able to let everyone know that the first "Get
>>> Started" tutorials have gone live on the RabbitMQ website today. Thank
>>> you
>>> to everyone who provided comments and feedback - please keep them 
>>> coming.
>>>
>>> The tutorials are available at:
>>> http://www.rabbitmq.com/getstarted.html
>>>
>>> This is by no means the end of the work we are doing to make our
>>> documentation better so expect to see more improvements over the coming
>>> weeks and months. If you have any ideas about what you would like to 
>>> see
>>> (or, indeed, what you wouldn't) then please let us know.
>>>
>>> Jim
>>>
>>>
>>> ______________________________________________
>>> [1]
>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-October/009351.html 
>>>
>>>
>>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From coolchen033 at gmail.com  Tue Nov 23 07:16:14 2010
From: coolchen033 at gmail.com (Kevin Chan)
Date: Tue, 23 Nov 2010 15:16:14 +0800
Subject: [rabbitmq-discuss] max channels
In-Reply-To: <AANLkTikw=rYfuAdaCRwe376rMrUgfZbe3DQS4LcAE9rB@mail.gmail.com>
References: <AANLkTimqerrQduuF5kj668WXU69gYFtQU83ocA6LhiYC@mail.gmail.com>
	<AANLkTikw=rYfuAdaCRwe376rMrUgfZbe3DQS4LcAE9rB@mail.gmail.com>
Message-ID: <AANLkTik8MYZ+6s-GhPjOHYtAY_F9_AtH8uUQxvrKKwUN@mail.gmail.com>

Thanks Marek, now my every consumer use 10 threads and each thread use one
channel ,i have 15 consumers ,so on the rabbitmq server it has 150 channels

it's seems work ok.

2010/11/22 Marek Majkowski <majek04 at gmail.com>

> On Mon, Nov 22, 2010 at 07:38, ??? <coolchen033 at gmail.com> wrote:
> > so rabbitmq server has so many channels,how many channels rabbitmq server
> > can support ? or i should modify code for Multithread use same channel ?
>
> RabbitMQ doesn't impose any limit on channels. Theoretically you may
> create as many channels as you have free erlang-process-ids. Which
> is usually about 32k.
>
> But in practice RabbitMQ shouldn't be using too many channels.
> If you're using more than a dozen of channels for a consumer, you're
> probably doing something wrong.
>
> You may run multiple 'basic.consumes' on one channel. But when you
> share a channel between threads remember to make sure the access
> is synchronized.
>
> Cheers,
>   Marek
>



-- 
Kevin Chan

XiaMen China
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101123/0673497b/attachment.htm>

From abinesh.s at gmail.com  Tue Nov 23 09:08:26 2010
From: abinesh.s at gmail.com (abinesh s)
Date: Tue, 23 Nov 2010 14:38:26 +0530
Subject: [rabbitmq-discuss] Message stalls in the queue for long time
Message-ID: <AANLkTimvCzdKCpTp9MBdrhZT186g3DfVLKgZYw6mYb6D@mail.gmail.com>

Hi Peter Ledbrook,

Thanks for your reply, I am using RabbitMQ Grails Plugin version 0.2. Am
using the method signature and I used to pass a map object to this method.
As you said my listeners are not working fine.

void handleMessage(def textMessage) {
}

Also, the messages are not picked up again when I restart my application.
Please help me to get through this.
-- 
Thanks and Regards
Abinesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101123/0e2ffd00/attachment.htm>

From rob at rabbitmq.com  Tue Nov 23 10:07:59 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 23 Nov 2010 10:07:59 +0000
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <4CEAE0DE.2090007@krutil.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>	<20101122152120.12880vjdzfaobhb4@webmail.active24.cz>
	<4CEAA76A.9070206@rabbitmq.com> <4CEAE0DE.2090007@krutil.com>
Message-ID: <004a548238dca21f58a42875efb5ef44@rabbitmq.com>

On Mon, 22 Nov 2010 22:30:06 +0100, Jiri Krutil <jiri at krutil.com> wrote:
> Michael,
> 
> I think it looks much better now.
> 
> Btw, I guess the finally block in Recv won't get executed unless an 
> exception is thrown -- that means no clean shutdown is possible. But I 
> guess that's OK for a hello-world app.

The finally block _always_ gets executed, whether the is an exception or
not, so you get both clean shutdown, and shutdown in the case of an
exception.

> 
> Regards
> Jiri
> 
>> Jiri, thanks for your comments --
>>
>> How's http://github.com/rabbitmq/rabbitmq-tutorials/tree/master/java 
>> now?  I'll update the tutorial text too.
>>

Rob


From peter at cacoethes.co.uk  Tue Nov 23 10:20:12 2010
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Tue, 23 Nov 2010 10:20:12 +0000
Subject: [rabbitmq-discuss] Message stalls in the queue for long time
In-Reply-To: <AANLkTimvCzdKCpTp9MBdrhZT186g3DfVLKgZYw6mYb6D@mail.gmail.com>
References: <AANLkTimvCzdKCpTp9MBdrhZT186g3DfVLKgZYw6mYb6D@mail.gmail.com>
Message-ID: <AANLkTi=d0rwejsAq+fdW+3nzFGjXTKhh6JoHKHPiV6tB@mail.gmail.com>

Sorry, left off the list the first time.

> Thanks for your reply, I am using RabbitMQ Grails Plugin version 0.2. Am using the method signature and I used to pass a map object to this method. As you said my listeners are not working fine.
>
> void handleMessage(def textMessage) {
> }
>
> Also, the messages are not picked up again when I restart my application. Please help me to get through this.

First, I recommend testing the 0.3-SNAPSHOT version of the plugin:

   grails install-plugin rabbitmq 0.3-SNAPSHOT

That has a few fixes in it and may resolve your problem. If it
doesn't, then would you be able to attach a Grails project that
reproduces the issue to JIRA?

   http://jira.codehaus.org/browse/GRAILSPLUGINS/component/14416

I can only think that the messages on the queues aren't matching some
sort of criteria and hence aren't being picked up by the message
handlers. It's obviously not because of the method signature, since
you don't specify a type (so all message types will be picked up). Are
there any differences between the messages that are picked up and
those that are left on the queue(s)?

Thanks,

Peter

--
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From jiri at krutil.com  Tue Nov 23 10:29:59 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Tue, 23 Nov 2010 11:29:59 +0100
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <004a548238dca21f58a42875efb5ef44@rabbitmq.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<20101122152120.12880vjdzfaobhb4@webmail.active24.cz>
	<4CEAA76A.9070206@rabbitmq.com> <4CEAE0DE.2090007@krutil.com>
	<004a548238dca21f58a42875efb5ef44@rabbitmq.com>
Message-ID: <20101123112959.1804770xnugo538k@webmail.active24.cz>

>> Btw, I guess the finally block in Recv won't get executed unless an
>> exception is thrown -- that means no clean shutdown is possible. But I
>> guess that's OK for a hello-world app.
>
> The finally block _always_ gets executed, whether the is an exception or
> not, so you get both clean shutdown, and shutdown in the case of an
> exception.

The finally block does not get executed if you stop the JVM.

The endless loop in Recv.main() can only end in two ways: exception or  
JVM shutdown. I don't see a way how to perform a clean shutdown of the  
receiver.

If the user stops the receiver by killing the Java process, the  
connection will stay open on the broker and will have to time out. In  
my opinion that's a reasource leak, which should not appear in a  
tutorial.

Jiri


From adamka at dgt.com.pl  Tue Nov 23 11:05:28 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Tue, 23 Nov 2010 12:05:28 +0100
Subject: [rabbitmq-discuss]   clustering server trouble
In-Reply-To: <4CEA86FE.4020304@dgt.com.pl>
References: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>	<AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>	<AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>
	<4CEA86FE.4020304@dgt.com.pl>
Message-ID: <4CEB9FF8.7030606@dgt.com.pl>

Hi,

I have a porblem with clustering two servers. They are on two diffrent 
maschines. I have changed their cookie for the same. But when Im trying 
make cluster I get error
Error: {failed_to_cluster_with,[134], "Mnesia could not connect to some 
nodes."}

Name of another node is correct, there are in the same network.
I"m using server version 2.1.1


Can anybody help me please?



Regards,
Adam


-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From rob at rabbitmq.com  Tue Nov 23 11:16:55 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 23 Nov 2010 11:16:55 +0000
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <20101123112959.1804770xnugo538k@webmail.active24.cz>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<20101122152120.12880vjdzfaobhb4@webmail.active24.cz>
	<4CEAA76A.9070206@rabbitmq.com> <4CEAE0DE.2090007@krutil.com>
	<004a548238dca21f58a42875efb5ef44@rabbitmq.com>
	<20101123112959.1804770xnugo538k@webmail.active24.cz>
Message-ID: <26b5586968412ebc1958d642f06eb337@rabbitmq.com>

On Tue, 23 Nov 2010 11:29:59 +0100, jiri at krutil.com wrote:
>>> Btw, I guess the finally block in Recv won't get executed unless an
>>> exception is thrown -- that means no clean shutdown is possible. But I
>>> guess that's OK for a hello-world app.
>>
>> The finally block _always_ gets executed, whether the is an exception
or
>> not, so you get both clean shutdown, and shutdown in the case of an
>> exception.
> 
> The finally block does not get executed if you stop the JVM.
> 
> The endless loop in Recv.main() can only end in two ways: exception or  
> JVM shutdown. I don't see a way how to perform a clean shutdown of the  
> receiver.
> 
> If the user stops the receiver by killing the Java process, the  
> connection will stay open on the broker and will have to time out. In  
> my opinion that's a reasource leak, which should not appear in a  
> tutorial.
> 
> Jiri

Ah, I didn't realise you were talking about abrupt termination :)

We could register a shutdown hook to perform clean up on exit, but that
feels like overkill for such a simple example. I can't think of another way
to guarantee that cleanup happens. Even without the infinite loop a user
can still Ctrl-C.

What do you think would be best here?

I'm very tentatively toying with the idea of working up a patch for the
client itself that will register a shutdown hook and maintain a set of weak
refs to connections for clean up on termination. What do you think about
this?

Rob

From peter at cacoethes.co.uk  Tue Nov 23 11:27:52 2010
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Tue, 23 Nov 2010 11:27:52 +0000
Subject: [rabbitmq-discuss] Message stalls in the queue for long time
In-Reply-To: <AANLkTi=5vKLDRukyjCENa7+NCrnWNSeXOsUPyuPoEqB+@mail.gmail.com>
References: <AANLkTimvCzdKCpTp9MBdrhZT186g3DfVLKgZYw6mYb6D@mail.gmail.com>
	<AANLkTikYa3se0sOF6BZGDLF9g1rmYy4oeTXpLgJ0un0q@mail.gmail.com>
	<AANLkTi=5vKLDRukyjCENa7+NCrnWNSeXOsUPyuPoEqB+@mail.gmail.com>
Message-ID: <AANLkTik6um5XqdYBryGU9+9p15WrXG705T500SfqncTZ@mail.gmail.com>

> Thanks for your reply.
> Can you please give me a answer for this:
>
> If any Exceptions occurred in processing messages in queue handlers will make the message to stall in the queue?

I'm not sure about this. Exceptions shouldn't cause the listener
thread to fail, but I haven't tested it. If I have time, I'll look
into that.

> Which one is better Using RabbitMQ Grails Plugin or Using RabbitMQ Java client API?

The Java client API is more mature than either Spring AMQP or the
Grails plugin, but the latter will certainly make your life easier for
the simple cases. If you use the Java client API, you'd have to do a
fair bit more work yourself.

> Also is it possible to see the log of RabbitMQ about the details which client is placing the message and which client fetching it?

I don't know the answer to this question. Hopefully one of the
RabbitMQ developers can answer it.

Peter

--
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From david at rabbitmq.com  Tue Nov 23 11:32:39 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 23 Nov 2010 11:32:39 +0000
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <20101123112959.1804770xnugo538k@webmail.active24.cz>
	(jiri@krutil.com's message of "Tue, 23 Nov 2010 11:29:59 +0100")
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<20101122152120.12880vjdzfaobhb4@webmail.active24.cz>
	<4CEAA76A.9070206@rabbitmq.com> <4CEAE0DE.2090007@krutil.com>
	<004a548238dca21f58a42875efb5ef44@rabbitmq.com>
	<20101123112959.1804770xnugo538k@webmail.active24.cz>
Message-ID: <yrv4cpqtw5l7s.fsf@dwragg.eng.vmware.com>

jiri at krutil.com writes:
> If the user stops the receiver by killing the Java process, the
> connection will stay open on the broker and will have to time out. In
> my opinion that's a reasource leak, which should not appear in a
> tutorial.

Connections will be closed by the operating system when a process is
killed.  No time out is involved under normal circumstances.  To get
thhe effect you describe, you would have to do something like pulling
the power cable out of the client machine.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jiri at krutil.com  Tue Nov 23 11:57:22 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Tue, 23 Nov 2010 12:57:22 +0100
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <26b5586968412ebc1958d642f06eb337@rabbitmq.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<20101122152120.12880vjdzfaobhb4@webmail.active24.cz>
	<4CEAA76A.9070206@rabbitmq.com> <4CEAE0DE.2090007@krutil.com>
	<004a548238dca21f58a42875efb5ef44@rabbitmq.com>
	<20101123112959.1804770xnugo538k@webmail.active24.cz>
	<26b5586968412ebc1958d642f06eb337@rabbitmq.com>
Message-ID: <20101123125722.12352sviprcrl944@webmail.active24.cz>

Rob,

> We could register a shutdown hook to perform clean up on exit, but that
> feels like overkill for such a simple example. I can't think of another way
> to guarantee that cleanup happens. Even without the infinite loop a user
> can still Ctrl-C.

In view of what David wrote about the operating system closing the  
connection when the client process dies, I guess there is no point  
addressing the case when user kills the process.

I personally would consider giving the user a possibility to ask the  
program to shut down by listening for the messages on a separate  
thread and using the main thread to wait for user input. But that  
would probably make the example harder to understand.

> I'm very tentatively toying with the idea of working up a patch for the
> client itself that will register a shutdown hook and maintain a set of weak
> refs to connections for clean up on termination. What do you think about
> this?

I don't think that's necessary and I would not expect that from a  
client library. The programmer using the client library should have  
control over the resources and is responsible for proper cleanup.

Jiri


From abinesh.s at gmail.com  Tue Nov 23 11:57:21 2010
From: abinesh.s at gmail.com (abinesh s)
Date: Tue, 23 Nov 2010 17:27:21 +0530
Subject: [rabbitmq-discuss] Message stalls in the queue for long time
In-Reply-To: <AANLkTik6um5XqdYBryGU9+9p15WrXG705T500SfqncTZ@mail.gmail.com>
References: <AANLkTimvCzdKCpTp9MBdrhZT186g3DfVLKgZYw6mYb6D@mail.gmail.com>
	<AANLkTikYa3se0sOF6BZGDLF9g1rmYy4oeTXpLgJ0un0q@mail.gmail.com>
	<AANLkTi=5vKLDRukyjCENa7+NCrnWNSeXOsUPyuPoEqB+@mail.gmail.com>
	<AANLkTik6um5XqdYBryGU9+9p15WrXG705T500SfqncTZ@mail.gmail.com>
Message-ID: <AANLkTikfq06crA3HgaN=HxGq2=8QDcTFCMDQ4_NZs6f2@mail.gmail.com>

Hi Peter,

Thanks for your reply, Now we idenitified a exception which occurred while
updating the message in database. StaleObjectStateException, because we are
using Hibernate. After this exception occurs the listener failed to
acknowledge the message,(So we think this reason makes that message to
remain in the queue) Is it right?

On Tue, Nov 23, 2010 at 4:57 PM, Peter Ledbrook <peter at cacoethes.co.uk>wrote:

> > Thanks for your reply.
> > Can you please give me a answer for this:
> >
> > If any Exceptions occurred in processing messages in queue handlers will
> make the message to stall in the queue?
>
> I'm not sure about this. Exceptions shouldn't cause the listener
> thread to fail, but I haven't tested it. If I have time, I'll look
> into that.
>
> > Which one is better Using RabbitMQ Grails Plugin or Using RabbitMQ Java
> client API?
>
> The Java client API is more mature than either Spring AMQP or the
> Grails plugin, but the latter will certainly make your life easier for
> the simple cases. If you use the Java client API, you'd have to do a
> fair bit more work yourself.
>
> > Also is it possible to see the log of RabbitMQ about the details which
> client is placing the message and which client fetching it?
>
> I don't know the answer to this question. Hopefully one of the
> RabbitMQ developers can answer it.
>
> Peter
>
> --
> Peter Ledbrook
> Grails Advocate
> SpringSource - A Division of VMware
>



-- 
Thanks and Regards
Abinesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101123/b4ef194b/attachment.htm>

From peter at cacoethes.co.uk  Tue Nov 23 12:04:41 2010
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Tue, 23 Nov 2010 12:04:41 +0000
Subject: [rabbitmq-discuss] Message stalls in the queue for long time
In-Reply-To: <AANLkTikfq06crA3HgaN=HxGq2=8QDcTFCMDQ4_NZs6f2@mail.gmail.com>
References: <AANLkTimvCzdKCpTp9MBdrhZT186g3DfVLKgZYw6mYb6D@mail.gmail.com>
	<AANLkTikYa3se0sOF6BZGDLF9g1rmYy4oeTXpLgJ0un0q@mail.gmail.com>
	<AANLkTi=5vKLDRukyjCENa7+NCrnWNSeXOsUPyuPoEqB+@mail.gmail.com>
	<AANLkTik6um5XqdYBryGU9+9p15WrXG705T500SfqncTZ@mail.gmail.com>
	<AANLkTikfq06crA3HgaN=HxGq2=8QDcTFCMDQ4_NZs6f2@mail.gmail.com>
Message-ID: <AANLkTinMNUurHCV6yhP3-E1je3edjB0pQP-eskcLNYfv@mail.gmail.com>

> Thanks for your reply, Now we idenitified a exception which occurred while updating the message in database. StaleObjectStateException, because we are using Hibernate. After this exception occurs the listener failed to acknowledge the message,(So we think this reason makes that message to remain in the queue) Is it right?

This is easy to check: wrap the code in handleMessage() in a try/catch
block. If the messages are no longer left on the server, then that's
the problem. The exact behaviour will depend on Spring AMQP and how
it's MessageListenerContainer handles exceptions. Something to look
into.

Peter

--
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From majek04 at gmail.com  Tue Nov 23 13:39:21 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 23 Nov 2010 13:39:21 +0000
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <26AE8163-C242-4A00-81EC-1774735E1003@gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
	<AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>
	<AANLkTik6=QPjnzkuB6tG6Uupx0cx931zjDKnDnUNMGR8@mail.gmail.com>
	<AANLkTim3y-ck6uZNeH7s7EEU1k1JRE55n3POQ2QaEOY3@mail.gmail.com>
	<AANLkTing9384pcSeu2Wx3cBM0pwJ-HpJqWR7timwr78i@mail.gmail.com>
	<26AE8163-C242-4A00-81EC-1774735E1003@gmail.com>
Message-ID: <AANLkTinWswLB8Txd4HdhYkAkY=i9wU3_zsjajo=xX6R0@mail.gmail.com>

On Mon, Nov 22, 2010 at 19:35, Alvaro Videla <videlalvaro at gmail.com> wrote:
> I've ported the python examples to PHP, check here:
> http://github.com/videlalvaro/rabbitmq-tutorials
> Perhaps you could merge them to your repo?

Thanks Alvaro.

I've just merged it. Thanks for keeping the code structure close
to the python one.

I couldn't resist a temptation to tweak a few things here and
there. Tell me if I broke something!

I also made sure that the php and python code is interoperable.

It's pretty cool to see that a message sent from python
can easily be delivered to php and the other way around.

Cheers,
   Marek

From videlalvaro at gmail.com  Tue Nov 23 13:49:34 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 23 Nov 2010 21:49:34 +0800
Subject: [rabbitmq-discuss] Improving our documentation
In-Reply-To: <AANLkTinWswLB8Txd4HdhYkAkY=i9wU3_zsjajo=xX6R0@mail.gmail.com>
References: <AANLkTimrNpkj71kfpfQneqkTt+PCoHQECdP1iRDWeLJj@mail.gmail.com>
	<AANLkTikUdRKnZypUzmBAY8JtCsODN9VQKf2pCCv=xTh3@mail.gmail.com>
	<AANLkTimYSTYynGd+AM-0XvZ2KnJ-LJ0EtSM+jzh5+B7u@mail.gmail.com>
	<AANLkTik6=QPjnzkuB6tG6Uupx0cx931zjDKnDnUNMGR8@mail.gmail.com>
	<AANLkTim3y-ck6uZNeH7s7EEU1k1JRE55n3POQ2QaEOY3@mail.gmail.com>
	<AANLkTing9384pcSeu2Wx3cBM0pwJ-HpJqWR7timwr78i@mail.gmail.com>
	<26AE8163-C242-4A00-81EC-1774735E1003@gmail.com>
	<AANLkTinWswLB8Txd4HdhYkAkY=i9wU3_zsjajo=xX6R0@mail.gmail.com>
Message-ID: <067A702F-AC51-417B-94AA-FD20F1F471D6@gmail.com>

Cool and thanks!.

I think yes, it's pretty impressive that the "interoperability" thing actually works :D

Maybe you could showcase that in the tutorials, no?

Cheers,

Alvaro

On Nov 23, 2010, at 9:39 PM, Marek Majkowski wrote:

> On Mon, Nov 22, 2010 at 19:35, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> I've ported the python examples to PHP, check here:
>> http://github.com/videlalvaro/rabbitmq-tutorials
>> Perhaps you could merge them to your repo?
> 
> Thanks Alvaro.
> 
> I've just merged it. Thanks for keeping the code structure close
> to the python one.
> 
> I couldn't resist a temptation to tweak a few things here and
> there. Tell me if I broke something!
> 
> I also made sure that the php and python code is interoperable.
> 
> It's pretty cool to see that a message sent from python
> can easily be delivered to php and the other way around.
> 
> Cheers,
>   Marek


From adamka at dgt.com.pl  Tue Nov 23 14:33:19 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Tue, 23 Nov 2010 15:33:19 +0100
Subject: [rabbitmq-discuss] clustering server trouble
In-Reply-To: <4CEB9FF8.7030606@dgt.com.pl>
References: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>	<AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>	<AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>	<4CEA86FE.4020304@dgt.com.pl>
	<4CEB9FF8.7030606@dgt.com.pl>
Message-ID: <4CEBD0AF.10301@dgt.com.pl>

ok I  resolved it but have another problem. Is it possible to reconnect 
client to another cluster? I mean is client support failover? I can't  
find any usefull information.

Regards,
Adam



W dniu 2010-11-23 12:05, Adam Kaminiecki pisze:
> Hi,
>
> I have a porblem with clustering two servers. They are on two diffrent 
> maschines. I have changed their cookie for the same. But when Im 
> trying make cluster I get error
> Error: {failed_to_cluster_with,[134], "Mnesia could not connect to 
> some nodes."}
>
> Name of another node is correct, there are in the same network.
> I"m using server version 2.1.1
>
>
> Can anybody help me please?
>
>
>
> Regards,
> Adam
>
>

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From matthias at rabbitmq.com  Tue Nov 23 15:04:04 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 23 Nov 2010 15:04:04 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <2AA38F4A-ACD9-4F93-9736-84C3157CCF84@npcinternational.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>	<FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>	<AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>
	<2AA38F4A-ACD9-4F93-9736-84C3157CCF84@npcinternational.com>
Message-ID: <4CEBD7E4.6040609@rabbitmq.com>

Jon,

On 22/11/10 15:12, Jon Brisbin wrote:
> It looks like, in 2.1.1, the lhttpc plugin needs to be unzipped inside
> the plugins folder. I've no idea why this is, maybe the Rabbit folks can
> answer that one.

I suspect the problem is that lhttpc.ez does not contain a top-level 
directory.

Matthias.

From jon.brisbin at npcinternational.com  Tue Nov 23 15:09:07 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 23 Nov 2010 09:09:07 -0600
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <4CEBD7E4.6040609@rabbitmq.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>	<FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>	<AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>
	<2AA38F4A-ACD9-4F93-9736-84C3157CCF84@npcinternational.com>
	<4CEBD7E4.6040609@rabbitmq.com>
Message-ID: <214C5D07-2CE0-4CA8-BBCB-610F03C4370D@npcinternational.com>


On Nov 23, 2010, at 9:04 AM, Matthias Radestock wrote:

> Jon,
> 
> On 22/11/10 15:12, Jon Brisbin wrote:
>> It looks like, in 2.1.1, the lhttpc plugin needs to be unzipped inside
>> the plugins folder. I've no idea why this is, maybe the Rabbit folks can
>> answer that one.
> 
> I suspect the problem is that lhttpc.ez does not contain a top-level directory.
> 

Ahh... I built that manually.

Thanks for the hint, Matthias. That's an easy fix. :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.




From clegnitto at mozilla.com  Tue Nov 23 20:09:15 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Tue, 23 Nov 2010 12:09:15 -0800
Subject: [rabbitmq-discuss] GitHub and AMQP/RabbitMQ
Message-ID: <A4F559F7-996A-474A-B5F8-4E5BAADDEA34@mozilla.com>

Just wanted to let the list know I created a service to integrate GitHub with RabbitMQ:

	http://christian.legnitto.com/blog/2010/11/23/github-amqp-integration-service-hook-live/

Hope it is useful for someone. I'll be adding more features (SSL support, etc) in the coming weeks.

Thanks,
Christian

From br at versly.com  Tue Nov 23 23:15:59 2010
From: br at versly.com (Benjamin Renaud)
Date: Tue, 23 Nov 2010 15:15:59 -0800
Subject: [rabbitmq-discuss] Headless install (which it thinks is an
 'upgrade' though it isn't) of Rabbit MQ server
Message-ID: <AANLkTikp9mQbu61JfJHBcz654+Nw0hYXHRcGZFXrHN=m@mail.gmail.com>

Hi,

When I try to install Rabbit MQ Server on Ubuntu 10.04.1 LTS, I get an
interactive screen telling me that "I have an earlier version of Rabbit
installed and that this will destroy my old data, do I want to continue?". I
must install Rabbit Server headless (without human intervention) so this is
a show-stopper for me.  DEBIAN_FRONTEND=noninteractive
does not work.

Furthermore, the machine in question is a clean AMI from Amazon EC2, with no
Rabbit not installed on it at all. So I need a way pass in 'ok' every time
(pipe something into the script?). Or preferably not get this dialog.

Anyone knows a solution to this?

Thanks!!
Benjamin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101123/b694e5f3/attachment-0001.htm>

From coolchen033 at gmail.com  Wed Nov 24 05:43:34 2010
From: coolchen033 at gmail.com (Kevin Chan)
Date: Wed, 24 Nov 2010 13:43:34 +0800
Subject: [rabbitmq-discuss] how queues send msg balance
Message-ID: <AANLkTikCF3ROew_xNXi7U-OeUE6s-bo3=guf5COTMrH9@mail.gmail.com>

hi everyone

on my rabbitmq-server have one queue this queue has stored many msg ,i have
many consumers want to connect this queue ,so the server has many channels,
but some consumer can receive the msg, the other consumer can not receive,i
use rabbitmqctl list_channels found some channels has so many msg ?but the
other one has 0 msg ,how can i do to make send msg balance to all channels?

Thanks
-- 
Kevin Chan

XiaMen China
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101124/91f3adab/attachment.htm>

From majek04 at gmail.com  Wed Nov 24 10:01:50 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 24 Nov 2010 10:01:50 +0000
Subject: [rabbitmq-discuss] how queues send msg balance
In-Reply-To: <AANLkTikCF3ROew_xNXi7U-OeUE6s-bo3=guf5COTMrH9@mail.gmail.com>
References: <AANLkTikCF3ROew_xNXi7U-OeUE6s-bo3=guf5COTMrH9@mail.gmail.com>
Message-ID: <AANLkTinRJVdf0dGC6bSr7VENiQ0gpABoKnft+T4Fq4BT@mail.gmail.com>

Kevin,

Please take a look at our second tutorial:
http://www.rabbitmq.com/tutorial-two-python.html

I think what you need is 'basic.qos' command.

Cheers,
  Marek

2010/11/24 Kevin Chan <coolchen033 at gmail.com>:
> hi everyone
>
> on my rabbitmq-server have one queue this queue has stored many msg ,i have
> many consumers want to connect this queue ,so the server has many channels,
> but some consumer can receive the msg, the other consumer can not receive,i
> use rabbitmqctl list_channels found some channels has so many msg ?but the
> other one has 0 msg ,how can i do to make send msg balance to all channels?
>
> Thanks
> --
> Kevin Chan
> XiaMen China
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From abhishek.kona at gmail.com  Wed Nov 24 10:31:06 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 24 Nov 2010 16:01:06 +0530
Subject: [rabbitmq-discuss] Java Client not able to create channel
Message-ID: <4CECE96A.7010602@gmail.com>

Hi

I am using the Java API 2.1.0 with RabbitMQ 2.1.0

My code is :
  if ((this.channel == null) || this.channel.isOpen() == false)
         {
             try
             {

                 this.channel = connection.createChannel();

             }
             catch (final IOException e)
             {
                 logger.error("While refreshing channel" + e);

             }
        }


There is a single instance of this class which has a connection object 
which is created only once.
A channel is created before every operation on RabbitMQ.
I have observed that after some time the program waits at 
connection.createChannel() (It waits does not throw and exception).
Is there something wrong in what I am doing or is it an issue with the 
2.1.0 library.

Thanks and Regards
-Abhishek Kona

From adamka at dgt.com.pl  Wed Nov 24 10:56:40 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Wed, 24 Nov 2010 11:56:40 +0100
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <4CECE96A.7010602@gmail.com>
References: <4CECE96A.7010602@gmail.com>
Message-ID: <4CECEF68.4020307@dgt.com.pl>

Hi,

If you can install server version 2.1.1

First You have to create connectionfactory

var conFactory = new ConnectionFactory { serwerAddress };
var conn = conFactory.CreateConnection();

then use:

channel = conn.CreateModel();


Its example from C# but I believe that is shoud be similar in Java.
I hope it will help.

Regards,
Adam



W dniu 2010-11-24 11:31, Abhishek Kona pisze:
> Hi
>
> I am using the Java API 2.1.0 with RabbitMQ 2.1.0
>
> My code is :
>  if ((this.channel == null) || this.channel.isOpen() == false)
>         {
>             try
>             {
>
>                 this.channel = connection.createChannel();
>
>             }
>             catch (final IOException e)
>             {
>                 logger.error("While refreshing channel" + e);
>
>             }
>        }
>
>
> There is a single instance of this class which has a connection object 
> which is created only once.
> A channel is created before every operation on RabbitMQ.
> I have observed that after some time the program waits at 
> connection.createChannel() (It waits does not throw and exception).
> Is there something wrong in what I am doing or is it an issue with the 
> 2.1.0 library.
>
> Thanks and Regards
> -Abhishek Kona
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From rob at rabbitmq.com  Wed Nov 24 10:59:20 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Wed, 24 Nov 2010 10:59:20 +0000
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <4CECE96A.7010602@gmail.com>
References: <4CECE96A.7010602@gmail.com>
Message-ID: <cb1680c755485b7ccfeead357744c621@rabbitmq.com>

Abishek,

There is a deadlock bug in the 2.1.0 client that causes the problem you
are seeing. I fixed this in the 2.1.1 client, so upgrading should do the
trick.

Regards,

Rob

On Wed, 24 Nov 2010 16:01:06 +0530, Abhishek Kona
<abhishek.kona at gmail.com>
wrote:
> Hi
> 
> I am using the Java API 2.1.0 with RabbitMQ 2.1.0
> 
> My code is :
>   if ((this.channel == null) || this.channel.isOpen() == false)
>          {
>              try
>              {
> 
>                  this.channel = connection.createChannel();
> 
>              }
>              catch (final IOException e)
>              {
>                  logger.error("While refreshing channel" + e);
> 
>              }
>         }
> 
> 
> There is a single instance of this class which has a connection object 
> which is created only once.
> A channel is created before every operation on RabbitMQ.
> I have observed that after some time the program waits at 
> connection.createChannel() (It waits does not throw and exception).
> Is there something wrong in what I am doing or is it an issue with the 
> 2.1.0 library.
> 
> Thanks and Regards
> -Abhishek Kona
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From abhishek.kona at gmail.com  Wed Nov 24 11:21:57 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 24 Nov 2010 16:51:57 +0530
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <cb1680c755485b7ccfeead357744c621@rabbitmq.com>
References: <4CECE96A.7010602@gmail.com>
	<cb1680c755485b7ccfeead357744c621@rabbitmq.com>
Message-ID: <4CECF555.3060605@gmail.com>

On 24/11/10 4:29 PM, Rob Harrop wrote:
> are seeing. I fixed this in the 2.1.1 client, so upgrading should do the
I have upgraded RabbitMQ and the client to 2.1.1 but still I see the 
same behavior.

The application stops at
             connection = connectionfactory.newConnection();
It does not even fail and throw up.

-Abhishek Kona


From rob at rabbitmq.com  Wed Nov 24 11:21:03 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Wed, 24 Nov 2010 11:21:03 +0000
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <4CECF555.3060605@gmail.com>
References: <4CECE96A.7010602@gmail.com>
	<cb1680c755485b7ccfeead357744c621@rabbitmq.com>
	<4CECF555.3060605@gmail.com>
Message-ID: <694c6e51f0a6d9bf0195cd40f2e1dd2c@rabbitmq.com>

That seems different to your previous report which mentioned that the
program waited at connection.createChannel() rather than
connectionfactory.newConnection(). Is that correct, or am I reading it
wrong :)

Can you create and post a thread dump of the process while it is waiting?
You can get one with jstack <pid>.

Regards,

Rob

On Wed, 24 Nov 2010 16:51:57 +0530, Abhishek Kona
<abhishek.kona at gmail.com>
wrote:
> On 24/11/10 4:29 PM, Rob Harrop wrote:
>> are seeing. I fixed this in the 2.1.1 client, so upgrading should do
the
> I have upgraded RabbitMQ and the client to 2.1.1 but still I see the 
> same behavior.
> 
> The application stops at
>              connection = connectionfactory.newConnection();
> It does not even fail and throw up.
> 
> -Abhishek Kona

From majek04 at gmail.com  Wed Nov 24 11:42:49 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 24 Nov 2010 11:42:49 +0000
Subject: [rabbitmq-discuss] Headless install (which it thinks is an
 'upgrade' though it isn't) of Rabbit MQ server
In-Reply-To: <AANLkTikp9mQbu61JfJHBcz654+Nw0hYXHRcGZFXrHN=m@mail.gmail.com>
References: <AANLkTikp9mQbu61JfJHBcz654+Nw0hYXHRcGZFXrHN=m@mail.gmail.com>
Message-ID: <AANLkTi=keqr+Z3bu3h6TvqrKZ=rsivmqjp5ASnsfps_U@mail.gmail.com>

What about '-y' ?
apt-get -qy install rabbitmq-server


On Tue, Nov 23, 2010 at 23:15, Benjamin Renaud <br at versly.com> wrote:
> Hi,
> When I try to install Rabbit MQ Server on?Ubuntu 10.04.1 LTS, I get an
> interactive screen telling me that "I have an earlier version of Rabbit
> installed and that this will destroy my old data, do I want to continue?". I
> must install Rabbit Server headless (without human intervention) so this is
> a show-stopper for me.??DEBIAN_FRONTEND=noninteractive
> does not work.
> Furthermore, the machine in question is a clean AMI from Amazon EC2, with no
> Rabbit not installed on it at all. So I need a way pass in 'ok' every time
> (pipe something into the script?). Or preferably not get this dialog.
> Anyone knows a solution to this?
> Thanks!!
> Benjamin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From abhishek.kona at gmail.com  Wed Nov 24 11:58:09 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 24 Nov 2010 17:28:09 +0530
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <694c6e51f0a6d9bf0195cd40f2e1dd2c@rabbitmq.com>
References: <4CECE96A.7010602@gmail.com>
	<cb1680c755485b7ccfeead357744c621@rabbitmq.com>
	<4CECF555.3060605@gmail.com>
	<694c6e51f0a6d9bf0195cd40f2e1dd2c@rabbitmq.com>
Message-ID: <4CECFDD1.6030107@gmail.com>

On 24/11/10 4:51 PM, Rob Harrop wrote:
> That seems different to your previous report which mentioned that the
> program waited at connection.createChannel() rather than
> connectionfactory.newConnection(). Is that correct, or am I reading it
> wrong :)
>
> Can you create and post a thread dump of the process while it is waiting?
> You can get one with jstack<pid>.
>
> Regards,
>
> Rob
>
> On Wed, 24 Nov 2010 16:51:57 +0530, Abhishek Kona
> <abhishek.kona at gmail.com>
> wrote:
>> On 24/11/10 4:29 PM, Rob Harrop wrote:
>>> are seeing. I fixed this in the 2.1.1 client, so upgrading should do
> the
>> I have upgraded RabbitMQ and the client to 2.1.1 but still I see the
>> same behavior.
>>
>> The application stops at
>>               connection = connectionfactory.newConnection();
>> It does not even fail and throw up.
>>
>> -Abhishek Kona
Ya I was trying different things and this time I was creating a new 
connection for each request, this time the block was at
connection=connectionFactory.newConnection();

I am attaching the jstack out put here,
Thanks for the quick replies.

-Abhishek Kona

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: jstack.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101124/f55f499e/attachment.txt>

From abhishek.kona at gmail.com  Wed Nov 24 12:20:40 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 24 Nov 2010 17:50:40 +0530
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <4CECFDD1.6030107@gmail.com>
References: <4CECE96A.7010602@gmail.com>
	<cb1680c755485b7ccfeead357744c621@rabbitmq.com>
	<4CECF555.3060605@gmail.com>
	<694c6e51f0a6d9bf0195cd40f2e1dd2c@rabbitmq.com>
	<4CECFDD1.6030107@gmail.com>
Message-ID: <4CED0318.7030705@gmail.com>

On 24/11/10 5:28 PM, Abhishek Kona wrote:
> On 24/11/10 4:51 PM, Rob Harrop wrote:
>> That seems different to your previous report which mentioned that the
>> program waited at connection.createChannel() rather than
>> connectionfactory.newConnection(). Is that correct, or am I reading it
>> wrong :)
>>
>> Can you create and post a thread dump of the process while it is 
>> waiting?
>> You can get one with jstack<pid>.
>>
>> Regards,
>>
>> Rob
>>
>> On Wed, 24 Nov 2010 16:51:57 +0530, Abhishek Kona
>> <abhishek.kona at gmail.com>
>> wrote:
>>> On 24/11/10 4:29 PM, Rob Harrop wrote:
>>>> are seeing. I fixed this in the 2.1.1 client, so upgrading should do
>> the
>>> I have upgraded RabbitMQ and the client to 2.1.1 but still I see the
>>> same behavior.
>>>
>>> The application stops at
>>>               connection = connectionfactory.newConnection();
>>> It does not even fail and throw up.
>>>
>>> -Abhishek Kona
> Ya I was trying different things and this time I was creating a new 
> connection for each request, this time the block was at
> connection=connectionFactory.newConnection();
>
> I am attaching the jstack out put here,
> Thanks for the quick replies.
>
> -Abhishek Kona
>
I am able to confirm the same error,
My application stops at connection=connectionfactory.newConnection();

I am using RabbitMQ 2.1.1 and 2.1.1 Library.
I am attaching the jstack output again.

-Abhishek Kona

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: jstack.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101124/6fb25d58/attachment.txt>

From stephanion2002 at gmail.com  Wed Nov 24 12:35:52 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Wed, 24 Nov 2010 18:05:52 +0530
Subject: [rabbitmq-discuss] RabbitMQ clustering
Message-ID: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>

Hi,

Can someone present a pictorial representation of 4-5 Rabbit MQ nodes with
Clustering and HA (it can also go on the RabbitMQ site). I wanted to know
about a RabbitMQ setup which is able to handle millions of messages.

I hope there would be many more users with such a requirement.

Thanks
Kshitiz Garg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101124/6fcb379c/attachment.htm>

From stephanion2002 at gmail.com  Wed Nov 24 13:18:30 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Wed, 24 Nov 2010 18:48:30 +0530
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>
	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>
	<AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>
	<90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>
	<AANLkTikrmpnkV8p8Bpzh6ytjUzuqU9e+F4PPj0SDEYkp@mail.gmail.com>
	<26816F6C-1DB4-425F-8619-BBDB259C679A@npcinternational.com>
Message-ID: <AANLkTimEp+uN=5mv96Euu=F0hPbziVPcTPyT-vnLgv95@mail.gmail.com>

Hi,

On this mailing list, Jon had described once that they use a setup like
this:

*Haproxy as a TCP proxy sitting in front of the RabbitMQ clustered servers
and acts as a failover and load balancer mechanism.
The clustered RabbitMQ instances use the standard RabbitMQ clustering
mechanism and have the same queues, exchanges, and whatnot on each box.
*
However, here on the rabbitQM mailing list, I got to know that: queues are
not replicated on all the nodes. Instead the queue remain specific to the
node on which it was declared.

For millions of messages handling capability, I want a very similar setup
like Jon's, along with the active-passive ability of those RabbitMQ
instances , so that means a setup like this:

*HA proxy->3 Clustered RabbitMQ instances->Each RabbitMQ instance is having
an independent HA active-passive setup (i.e. effectively 6 instances).......
*
Does this look scalable ? Am I missing something ? Anything else I can
add/replace....

Many thanks,
Kshitiz Garg



On Mon, Nov 1, 2010 at 7:12 PM, Jon Brisbin <
jon.brisbin at npcinternational.com> wrote:

>
> On Oct 30, 2010, at 3:28 AM, Kshitiz Garg wrote:
>
> > Now if I use a HA proxy and have independent RabbitMQs sitting behind
> > that proxy, how will that be different from using a HA proxy and have
> > clustered RabbitMQs sitting behind that proxy. What is that these
> > clustered RabbitMQs have in common?  Actually I want to understand
> > "clustering" in this regard.
>
> If the brokers aren't clustered, your individual RabbitMQ brokers won't
> share users, exchanges, queues, or any other resource. I'm not sure how that
> affects applications because I haven't tried it. I suspect it wouldn't work
> very well with round-robin load balancing because consumers might get
> connected to a different broker than the producers.
>
> If you're using only the failover configuration, though, it would be
> better. You'd just have to reestablish all your Channels if one of them gets
> disconnected, assuming the next connection will go to the other broker.
>
> "Clustered" RabbitMQ brokers look the same no matter which actual broker
> you contact. Messages delivered to one broker will be delivered to consumers
> on another broker. Without this clustering, you have to create some kind of
> store-and-forward (maybe using the shovel plugin) or your application has to
> manage that itself.
>
> If your brokers are clustered, upgrading versions of the broker is, in my
> experience, fragile. Every version upgrade I've done (we're running it on
> Ubuntu Linux) results in a dead broker that has to be manually restarted.
> I've also had to re-configure the broker back into the cluster more times
> than I'd like.
>
> <soapbox>
> The broker upgrade process could use some attention, IMHO. The broker
> should restart after upgrades without manual intervention and new versions
> should ALWAYS be able to migrate data so I don't have to reconfigure all my
> users and clustering configuration.
> </soapbox>
>
> jb
>
>
> >
> > Thanks,
> > Kshitiz Garg
> >
> >
> > On Fri, Oct 29, 2010 at 7:12 PM, Jon Brisbin
> > <jon.brisbin at npcinternational.com> wrote:
> >>
> >> On Oct 29, 2010, at 8:31 AM, Kshitiz Garg wrote:
> >>
> >>> Should I refer to "RabbitMQ High Availability Guide" for setting up a
> >>> system like yours?
> >>
> >> It's certainly a good idea to read that guide. But I'm using an
> intentionally simplistic setup that follows the transcript here:
> >>
> >> http://www.rabbitmq.com/clustering.html#creating
> >>
> >>
> >>> does "haproxy" automatically decides the routing of
> >>> the message depending on the availability of rabbitMQ instances
> >>> sitting behind this ?
> >>
> >> Sort of. HAProxy is a TCP/IP "traffic cop". It knows nothing about the
> contents of the packets it proxies. It simply knows whether or not any of
> the configured backends is alive and able to receive data.
> >>
> >> Maybe a better way to say it is that it decides the routing of the TCP
> traffic to the broker. It knows nothing about messages.
> >>
> >> http://haproxy.1wt.eu/
> >>
> >> I'm also using a "best effort" approach. I'm not going to get my
> britches in a wrinkle if my broker goes down for a few minutes (or a few
> hours ;) until I get it fixed. I recognize others don't have that luxury.
> >>
> >> jb
> >>
> >>
> >>
> >>>
> >>> Regards,
> >>> Kshitiz
> >>>
> >>> On Fri, Oct 29, 2010 at 6:39 PM, Jon Brisbin
> >>> <jon.brisbin at npcinternational.com> wrote:
> >>>>
> >>>> Do you want failover or clustering (or both)?
> >>>> I use both. I have haproxy as a TCP proxy that sits in front of the
> RabbitMQ servers and acts as a failover and load balancer mechanism.
> >>>> Behind the proxy are clustered RabbitMQ instances, which means they
> use the standard RabbitMQ clustering mechanism and have the same queues,
> exchanges, and whatnot on each box.
> >>>> I then use Spring AMQP to connect to the *proxy*, who decides which of
> the RabbitMQ instances I actually get connected to.
> >>>>
> >>>> Jon Brisbin
> >>>> Portal Webmaster
> >>>> NPC International, Inc.
> >>>>
> >>>> On Oct 29, 2010, at 1:27 AM, Kshitiz Garg wrote:
> >>>>
> >>>> Hi,
> >>>>
> >>>> I have just started working with RabbitMQ for my cloud
> messaging/eventing application. The proof of concept worked well with
> rabbitMQ and Spring AMQP. Now, I want to start preparing for scalability.
> >>>> I am able to setup a rabbitMQ cluster with 2 rabbitMQs installed on 2
> separate machines. Now I want to know what is achieved by "clustering" in
> terms of rabbitMQ.
> >>>>
> >>>> My spring amqp template has been given a connection Factory like this:
> >>>>
> >>>>     <!-- RabbitMQ configurations -->
> >>>>     <!-- Define a connectionFactory -->
> >>>>     <bean id="connectionFactory"
> >>>>
> class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
> >>>>         <constructor-arg value="localhost" />
> >>>>         <property name="username" value="guest" />
> >>>>         <property name="password" value="guest" />
> >>>>     </bean>
> >>>>
> >>>>     <!-- Configure the admin class -->
> >>>>     <bean id="amqpAdmin"
> class="org.springframework.amqp.rabbit.core.RabbitAdmin">
> >>>>         <constructor-arg ref="connectionFactory" />
> >>>>     </bean>
> >>>>
> >>>> Here I have specified localhost, so now, if I send a amqp message
> through rabbitMQ and this localhost broker is not up, will that message go
> through its cluster node automatically ?
> >>>>
> >>>> If that's the case, then what do we mean by high availability?
> >>>>
> >>>> Thanks,
> >>>> Kshitiz Garg
> >>>>
> >>>>
> >>>>
> >>>>
> >>>> _______________________________________________
> >>>> rabbitmq-discuss mailing list
> >>>> rabbitmq-discuss at lists.rabbitmq.com
> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>>
> >>>>
> >>>>
> >>
> >>
> >> Jon Brisbin
> >> Portal Webmaster
> >> NPC International, Inc.
> >>
> >>
> >>
> >>
>
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101124/e4265c13/attachment-0001.htm>

From ovidiudeac at gmail.com  Thu Nov 25 00:16:48 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 25 Nov 2010 02:16:48 +0200
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
	working?
In-Reply-To: <4CE66FEF.606@rabbitmq.com>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>
	<4CE4B096.5010605@rabbitmq.com>
	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>
	<4CE66FEF.606@rabbitmq.com>
Message-ID: <AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>

Hi again,

I'm back with more info. Yes, the queue is still there.

I've got the chance to do some cleanup of the code  and some debugging
and it seems that I get an exception when I try delete an exchange
that doesn't exist and then all the following operations throw the
same exception, even if they try to delete queues that does exist.

The following code reproduces the problem:

IModel _channel;
//....set up _channel

            System.Console.WriteLine("deleting the exchange...");
            try
            {
                _channel.ExchangeDelete("x",false, false);
            } catch(Exception ex)
            {
                System.Console.WriteLine(ex.Message);
            }

            System.Console.WriteLine("deleting the queue...");

            try
            {
                _channel.QueueDelete("q", false, false, false);
            } catch(Exception ex)
            {
                        System.Console.WriteLine(ex.Message);
            }

Running this code when the exchange x DOESN'T exist and the queue q
DOES exist gives me the following output:

deleting the exchange...
The AMQP operation was interrupted: AMQP close-reason, initiated by
Peer, code=404, text="NOT_FOUND - no exchange 'x' in vhost '/'",
classId=40, methodId=20, cause=
deleting the queue...
The AMQP operation was interrupted: AMQP close-reason, initiated by
Peer, code=404, text="NOT_FOUND - no exchange 'x' in vhost '/'",
classId=40, methodId=20, cause=


So it seems that one error on the channel doesn't allow me to do any
other operations using that channel. Is there any possibility to reuse
the channel?

Thanks,
Ovidiu

On Fri, Nov 19, 2010 at 2:39 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Ovidiu,
>
> On 19/11/10 10:52, Ovidiu Deac wrote:
>>
>> Thanks for the answer. I don't get any errors. At least I don't see any.
>
> So what *are* you seeing? Does the QueueDelete call succeed but the queue is
> still there? That can only happen if the queue gets redeclared by something
> else.
>
>
> Matthias.
>

From abhishek.kona at gmail.com  Thu Nov 25 06:27:14 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Thu, 25 Nov 2010 11:57:14 +0530
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <4CED0318.7030705@gmail.com>
References: <4CECE96A.7010602@gmail.com>
	<cb1680c755485b7ccfeead357744c621@rabbitmq.com>
	<4CECF555.3060605@gmail.com>
	<694c6e51f0a6d9bf0195cd40f2e1dd2c@rabbitmq.com>
	<4CECFDD1.6030107@gmail.com> <4CED0318.7030705@gmail.com>
Message-ID: <4CEE01C2.6000505@gmail.com>

On 24/11/10 5:50 PM, Abhishek Kona wrote:
> On 24/11/10 5:28 PM, Abhishek Kona wrote:
>> On 24/11/10 4:51 PM, Rob Harrop wrote:
>>> That seems different to your previous report which mentioned that the
>>> program waited at connection.createChannel() rather than
>>> connectionfactory.newConnection(). Is that correct, or am I reading it
>>> wrong :)
>>>
>>> Can you create and post a thread dump of the process while it is 
>>> waiting?
>>> You can get one with jstack<pid>.
>>>
>>> Regards,
>>>
>>> Rob
>>>
>>> On Wed, 24 Nov 2010 16:51:57 +0530, Abhishek Kona
>>> <abhishek.kona at gmail.com>
>>> wrote:
>>>> On 24/11/10 4:29 PM, Rob Harrop wrote:
>>>>> are seeing. I fixed this in the 2.1.1 client, so upgrading should do
>>> the
>>>> I have upgraded RabbitMQ and the client to 2.1.1 but still I see the
>>>> same behavior.
>>>>
>>>> The application stops at
>>>>               connection = connectionfactory.newConnection();
>>>> It does not even fail and throw up.
>>>>
>>>> -Abhishek Kona
>> Ya I was trying different things and this time I was creating a new 
>> connection for each request, this time the block was at
>> connection=connectionFactory.newConnection();
>>
>> I am attaching the jstack out put here,
>> Thanks for the quick replies.
>>
>> -Abhishek Kona
>>
> I am able to confirm the same error,
> My application stops at connection=connectionfactory.newConnection();
>
> I am using RabbitMQ 2.1.1 and 2.1.1 Library.
> I am attaching the jstack output again.
>
> -Abhishek Kona
>
Hi folks,

Any opinions about the issue. My application only stops when I user 
RabbitMQ, any first impressions?

Thanks for all the fish.
-Abhishek Kona

From adamka at dgt.com.pl  Thu Nov 25 08:36:49 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Thu, 25 Nov 2010 09:36:49 +0100
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
 working?
In-Reply-To: <AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>	<4CE4B096.5010605@rabbitmq.com>	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>	<4CE66FEF.606@rabbitmq.com>
	<AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>
Message-ID: <4CEE2021.10904@dgt.com.pl>

I had a similar poroblem but Emile explaint it to me:

"The AMQP 0-9-1 spec requires that the broker raise a channel exception
if a publisher attempts to publish to a non-existent exchange.

It is unusual for publishers to deal with the risk of an exchange
disappearing, because exchanges are normally long-lived. Publishers must
be prepared to redeclare exchanges or recover from channel exceptions in
the presence of such risk.

If you explain the reason for consumers deleting exchanges then I may be
able to suggest an alternative messaging pattern.

As a preventative measure you can use permissions to prevent clients
from deleting exchanges, or use server-assigned names to make them
undiscoverable via AMQP.

Regards

Emile"


Regards Adam



W dniu 2010-11-25 01:16, Ovidiu Deac pisze:
> Hi again,
>
> I'm back with more info. Yes, the queue is still there.
>
> I've got the chance to do some cleanup of the code  and some debugging
> and it seems that I get an exception when I try delete an exchange
> that doesn't exist and then all the following operations throw the
> same exception, even if they try to delete queues that does exist.
>
> The following code reproduces the problem:
>
> IModel _channel;
> //....set up _channel
>
>              System.Console.WriteLine("deleting the exchange...");
>              try
>              {
>                  _channel.ExchangeDelete("x",false, false);
>              } catch(Exception ex)
>              {
>                  System.Console.WriteLine(ex.Message);
>              }
>
>              System.Console.WriteLine("deleting the queue...");
>
>              try
>              {
>                  _channel.QueueDelete("q", false, false, false);
>              } catch(Exception ex)
>              {
>                          System.Console.WriteLine(ex.Message);
>              }
>
> Running this code when the exchange x DOESN'T exist and the queue q
> DOES exist gives me the following output:
>
> deleting the exchange...
> The AMQP operation was interrupted: AMQP close-reason, initiated by
> Peer, code=404, text="NOT_FOUND - no exchange 'x' in vhost '/'",
> classId=40, methodId=20, cause=
> deleting the queue...
> The AMQP operation was interrupted: AMQP close-reason, initiated by
> Peer, code=404, text="NOT_FOUND - no exchange 'x' in vhost '/'",
> classId=40, methodId=20, cause=
>
>
> So it seems that one error on the channel doesn't allow me to do any
> other operations using that channel. Is there any possibility to reuse
> the channel?
>
> Thanks,
> Ovidiu
>
> On Fri, Nov 19, 2010 at 2:39 PM, Matthias Radestock
> <matthias at rabbitmq.com>  wrote:
>> Ovidiu,
>>
>> On 19/11/10 10:52, Ovidiu Deac wrote:
>>> Thanks for the answer. I don't get any errors. At least I don't see any.
>> So what *are* you seeing? Does the QueueDelete call succeed but the queue is
>> still there? That can only happen if the queue gets redeclared by something
>> else.
>>
>>
>> Matthias.
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From nikhilesh.gargi at hp.com  Thu Nov 25 09:45:16 2010
From: nikhilesh.gargi at hp.com (Gargi, Nikhilesh Prakash)
Date: Thu, 25 Nov 2010 09:45:16 +0000
Subject: [rabbitmq-discuss] High availibility in queues
Message-ID: <23E658492CE48649B5B5168EBC60387842C8FED9EC@GVW1101EXC.americas.hpqcorp.net>

Hi,

We are planning to use RabbitMQ in clustering.

If we add 4 RabbitMQ nodes in a cluster, all the credentials, exchanges and bindings get copied to each mnesia db. However, since the queues are specific to nodes, the message directed to a particular queue will be lost (if the node on which that queue was created is down). Is it correct? How can we workaround this? This seems to be a weak link for a High availability solution we need. Are the message will be persisted somewhere and will be delivered to that queue after that particular node comes up?

If the message is gonna lost, can we have a workaround that we create copies of the queues explicitly on each node. Now since they are copies, the exchange will send the message to all the nodes and even if a node is down, message will be delivered to all the copies of that queue.


Thanks & Regards,
Nikhilesh Gargi


From ovidiudeac at gmail.com  Thu Nov 25 10:34:00 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 25 Nov 2010 12:34:00 +0200
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
	working?
In-Reply-To: <4CEE2021.10904@dgt.com.pl>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>
	<4CE4B096.5010605@rabbitmq.com>
	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>
	<4CE66FEF.606@rabbitmq.com>
	<AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>
	<4CEE2021.10904@dgt.com.pl>
Message-ID: <AANLkTikHx5qxJiim4WxhyCNSZ3zk2EoGe8SFQ8gNXvPA@mail.gmail.com>

I am doing some functional automated testing which involves setup the
environment (i.e. creating a brand new exchange, queues, do the
bindings), run the module that needs test and then clear the
environment.

So I don't have a problem with the exchange deletion. My real problem
is the fact that after an error encountered while deleting the
exchange I can't do any other operations on that channel.

ovidiu

On Thu, Nov 25, 2010 at 10:36 AM, Adam Kaminiecki <adamka at dgt.com.pl> wrote:
> I had a similar poroblem but Emile explaint it to me:
>
> "The AMQP 0-9-1 spec requires that the broker raise a channel exception
> if a publisher attempts to publish to a non-existent exchange.
>
> It is unusual for publishers to deal with the risk of an exchange
> disappearing, because exchanges are normally long-lived. Publishers must
> be prepared to redeclare exchanges or recover from channel exceptions in
> the presence of such risk.
>
> If you explain the reason for consumers deleting exchanges then I may be
> able to suggest an alternative messaging pattern.
>
> As a preventative measure you can use permissions to prevent clients
> from deleting exchanges, or use server-assigned names to make them
> undiscoverable via AMQP.
>
> Regards
>
> Emile"
>
>
> Regards Adam
>
>
>
> W dniu 2010-11-25 01:16, Ovidiu Deac pisze:
>>
>> Hi again,
>>
>> I'm back with more info. Yes, the queue is still there.
>>
>> I've got the chance to do some cleanup of the code ?and some debugging
>> and it seems that I get an exception when I try delete an exchange
>> that doesn't exist and then all the following operations throw the
>> same exception, even if they try to delete queues that does exist.
>>
>> The following code reproduces the problem:
>>
>> IModel _channel;
>> //....set up _channel
>>
>> ? ? ? ? ? ? System.Console.WriteLine("deleting the exchange...");
>> ? ? ? ? ? ? try
>> ? ? ? ? ? ? {
>> ? ? ? ? ? ? ? ? _channel.ExchangeDelete("x",false, false);
>> ? ? ? ? ? ? } catch(Exception ex)
>> ? ? ? ? ? ? {
>> ? ? ? ? ? ? ? ? System.Console.WriteLine(ex.Message);
>> ? ? ? ? ? ? }
>>
>> ? ? ? ? ? ? System.Console.WriteLine("deleting the queue...");
>>
>> ? ? ? ? ? ? try
>> ? ? ? ? ? ? {
>> ? ? ? ? ? ? ? ? _channel.QueueDelete("q", false, false, false);
>> ? ? ? ? ? ? } catch(Exception ex)
>> ? ? ? ? ? ? {
>> ? ? ? ? ? ? ? ? ? ? ? ? System.Console.WriteLine(ex.Message);
>> ? ? ? ? ? ? }
>>
>> Running this code when the exchange x DOESN'T exist and the queue q
>> DOES exist gives me the following output:
>>
>> deleting the exchange...
>> The AMQP operation was interrupted: AMQP close-reason, initiated by
>> Peer, code=404, text="NOT_FOUND - no exchange 'x' in vhost '/'",
>> classId=40, methodId=20, cause=
>> deleting the queue...
>> The AMQP operation was interrupted: AMQP close-reason, initiated by
>> Peer, code=404, text="NOT_FOUND - no exchange 'x' in vhost '/'",
>> classId=40, methodId=20, cause=
>>
>>
>> So it seems that one error on the channel doesn't allow me to do any
>> other operations using that channel. Is there any possibility to reuse
>> the channel?
>>
>> Thanks,
>> Ovidiu
>>
>> On Fri, Nov 19, 2010 at 2:39 PM, Matthias Radestock
>> <matthias at rabbitmq.com> ?wrote:
>>>
>>> Ovidiu,
>>>
>>> On 19/11/10 10:52, Ovidiu Deac wrote:
>>>>
>>>> Thanks for the answer. I don't get any errors. At least I don't see any.
>>>
>>> So what *are* you seeing? Does the QueueDelete call succeed but the queue
>>> is
>>> still there? That can only happen if the queue gets redeclared by
>>> something
>>> else.
>>>
>>>
>>> Matthias.
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> --
> This message has been scanned for viruses and
> dangerous content by MailScanner, and is
> believed to be clean.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From david at rabbitmq.com  Thu Nov 25 11:11:11 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 25 Nov 2010 11:11:11 +0000
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
	working?
In-Reply-To: <AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>
	(Ovidiu Deac's message of "Thu, 25 Nov 2010 02:16:48 +0200")
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>
	<4CE4B096.5010605@rabbitmq.com>
	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>
	<4CE66FEF.606@rabbitmq.com>
	<AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>
Message-ID: <yrv4c1v69aca8.fsf@dwragg.eng.vmware.com>

Hi,

Ovidiu Deac <ovidiudeac at gmail.com> writes:
> So it seems that one error on the channel doesn't allow me to do any
> other operations using that channel. Is there any possibility to reuse
> the channel?

In AMQP, the broker signals channel-level errors as part of closing the
channel.  So there is no way to reuse a channel after an error.  You
will need to open a new channel for further operations.

It might be better if the .NET client produced an exception that more
clearly indicates this, but there is little it can do to handle the
situation more elegantly.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From majek04 at gmail.com  Thu Nov 25 11:18:00 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 25 Nov 2010 11:18:00 +0000
Subject: [rabbitmq-discuss] High availibility in queues
In-Reply-To: <23E658492CE48649B5B5168EBC60387842C8FED9EC@GVW1101EXC.americas.hpqcorp.net>
References: <23E658492CE48649B5B5168EBC60387842C8FED9EC@GVW1101EXC.americas.hpqcorp.net>
Message-ID: <AANLkTi=E7GSDG5-MpcGqPNbDiOr6nKAbOVuy+5pCHcmR@mail.gmail.com>

On Thu, Nov 25, 2010 at 09:45, Gargi, Nikhilesh Prakash
<nikhilesh.gargi at hp.com> wrote:
> We are planning to use RabbitMQ in clustering.
>
> If we add 4 RabbitMQ nodes in a cluster, all the credentials, exchanges and bindings get copied to each mnesia db. However, since the queues are specific to nodes, the message directed to a particular queue will be lost (if the node on which that queue was created is down). Is it correct? How can we workaround this? This seems to be a weak link for a High availability solution we need. Are the message will be persisted somewhere and will be delivered to that queue after that particular node comes up?
>
> If the message is gonna lost, can we have a workaround that we create copies of the queues explicitly on each node. Now since they are copies, the exchange will send the message to all the nodes and even if a node is down, message will be delivered to all the copies of that queue.


Clustering != HA.

Maybe this thread will help:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-November/010010.html

Cheers,
 Marek

From majek04 at gmail.com  Thu Nov 25 11:35:18 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 25 Nov 2010 11:35:18 +0000
Subject: [rabbitmq-discuss]  Thoughts from a new user (two months later)
Message-ID: <AANLkTinbeNaU9c8yob38Lsc7qWBkoB6v3C5rc_bLMvU2@mail.gmail.com>

Adam,

Although you've presented your suggestions more than
two monts ago, I'd like to share my thoughts now.

On Fri, Sep 17, 2010 at 22:55, Adam Nelson <adam at varud.com> wrote:
> I've been using RabbitMQ for 2 months now and I figured I would share my
> experiences.
>
> == Background ==
>
> I'm using RabbitMQ because Celery recommends it. ?If Celery recommended
> something else, I would have used that. ?I'm just pointing that out because
> sometimes core services forget that people often use them because a
> particular library favors that implementation. ?It's important to take care
> of the downstream libraries, especially when you're using an open protocol
> like AMQP.
>
> == Comments so Far ==
>
> I think RabbitMQ is awesome and has done really well so far for me. ?It's
> been very fast (only marginally important for me) and very stable (much,
> much more important for me). ?Here's my constructive criticism (i.e. things
> that can be addressed easily IMHO).
>
> ?* This newsgroup format is terrible. ?Please move to Google Groups.

There is a copy of our list on GG, but the full migration won't happen.
I'm fairly happy with mailman, although I do agree that there is
a place for improvement.

> ?* The code is very difficult to get at. ?Please move to Github (or
> BitBucket). ?I see that you're using Mercurial already, so BitBucket is the
> obvious choice. ?I think GitHub is way more feature rich but if you're not
> willing to move to Git, that won't work of course.

The code is now mirrored on github.

> ?* The documentation is not version-specific. ?This has caused me enormous
> problems (specifically with set-permissions, which is why I'm in the mode to
> write this message at all). ?Please move to a platform that supports
> versioned documentation better. ?I don't know the best solution to this
> exactly - maybe Sphinx or just a wiki with a url structure that supports
> multiple versions?

I do understand your point, but that's not something top-priority IMO.
We always strongly encourage to upgrade to the newest version,
and we want to focus on improving our latest version.

> ?* Where are the open tickets? ?It appears that all bugs are going through
> the mailing list - it's really hard on the users to not have an
> easy-to-search ticket system. ?Launchpad could work or BitBucket's issue
> system, or Redmine, or Trac?

Yeah, I'd love to have open our bugtracker, but apparently, that's pretty hard.
We're still looking for a way how to do it.

> ?* The site itself needs a fresh look. ?I know MongoDB is funded, but
> there's an example of a great site for this type of thing:
> http://www.mongodb.org/ .

Would you like to volunteer? I'm much better at writing erlang
than doing websites.

> ?* Outdated stuff should be taken down or have a disclaimer on it. ?For
> instance the ec2 page: http://www.rabbitmq.com/ec2.html has images for
> Karmic Koala. ?While that was great last year, it's really time to have a
> Lucid ec2 images available - or nothing at all. ?A Lucid image, because it
> is long term, could be up for a year or two and it would be ok.

Ec2 page has been fixed, I hope.

> ?* Please don't tell Mac users to use MacPorts:
> http://www.rabbitmq.com/macports.html It's time to move them to HomeBrew at
> http://github.com/mxcl/homebrew

We're making some slow progress on that front.

> ?* Please be more descriptive about how to set up an environment with tools
> like Alice and Wonderland. ?These appear to be great assets to RabbitMQ, but
> are hidden in the dense 'Getting Started' page:
> http://www.rabbitmq.com/how.html . ?All the links from a Getting Started
> page should take no longer than 1 hour to read. ?Check out Django's one hour
> intro here: http://docs.djangoproject.com/en/dev/intro/tutorial01/ ?. ?The
> first link on RabbitMQ's Getting Started page goes to this Alexis Richardson
> talk -
> http://skillsmatter.com/podcast/erlang/alexis-richardson-introduction-to-rabbitmq
> . ?While the content is great, it's geared towards the intermediate user,
> not a beginner just getting started. ?Also, having dynamic delicious
> searches is fine for an appendix maybe, but not the first page for people
> getting started.

We've introduced tutorials, and we'll continue to improve. Feedback is welcome.

Cheers,
    Marek Majkowski

From rob at rabbitmq.com  Thu Nov 25 11:36:43 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 25 Nov 2010 11:36:43 +0000
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <4CEE01C2.6000505@gmail.com>
References: <4CECE96A.7010602@gmail.com>
	<cb1680c755485b7ccfeead357744c621@rabbitmq.com>
	<4CECF555.3060605@gmail.com>
	<694c6e51f0a6d9bf0195cd40f2e1dd2c@rabbitmq.com>
	<4CECFDD1.6030107@gmail.com> <4CED0318.7030705@gmail.com>
	<4CEE01C2.6000505@gmail.com>
Message-ID: <3f2e0d60ab9f9e8624ecb31848435ead@rabbitmq.com>

On Thu, 25 Nov 2010 11:57:14 +0530, Abhishek Kona
<abhishek.kona at gmail.com>
wrote:
> On 24/11/10 5:50 PM, Abhishek Kona wrote:
>> On 24/11/10 5:28 PM, Abhishek Kona wrote:
>>> On 24/11/10 4:51 PM, Rob Harrop wrote:
>>>> That seems different to your previous report which mentioned that the
>>>> program waited at connection.createChannel() rather than
>>>> connectionfactory.newConnection(). Is that correct, or am I reading
it
>>>> wrong :)
>>>>
>>>> Can you create and post a thread dump of the process while it is 
>>>> waiting?
>>>> You can get one with jstack<pid>.
>>>>
>>>> Regards,
>>>>
>>>> Rob
>>>>
>>>> On Wed, 24 Nov 2010 16:51:57 +0530, Abhishek Kona
>>>> <abhishek.kona at gmail.com>
>>>> wrote:
>>>>> On 24/11/10 4:29 PM, Rob Harrop wrote:
>>>>>> are seeing. I fixed this in the 2.1.1 client, so upgrading should
do
>>>> the
>>>>> I have upgraded RabbitMQ and the client to 2.1.1 but still I see the
>>>>> same behavior.
>>>>>
>>>>> The application stops at
>>>>>               connection = connectionfactory.newConnection();
>>>>> It does not even fail and throw up.
>>>>>
>>>>> -Abhishek Kona
>>> Ya I was trying different things and this time I was creating a new 
>>> connection for each request, this time the block was at
>>> connection=connectionFactory.newConnection();
>>>
>>> I am attaching the jstack out put here,
>>> Thanks for the quick replies.
>>>
>>> -Abhishek Kona
>>>
>> I am able to confirm the same error,
>> My application stops at connection=connectionfactory.newConnection();
>>
>> I am using RabbitMQ 2.1.1 and 2.1.1 Library.
>> I am attaching the jstack output again.
>>
>> -Abhishek Kona
>>
> Hi folks,
> 
> Any opinions about the issue. My application only stops when I user 
> RabbitMQ, any first impressions?
> 
> Thanks for all the fish.
> -Abhishek Kona

Hi,

I'm not convinced that your application is actually stopping at
connectionFactory.newConnection(), the stack trace doesn't support this. 

What appears to be happening is that the connection is started and is
waiting, ready to process incoming messages from the server. This is
correct. 

What are you expecting to happen that isn't actually happening?

Rob


From abhishek.kona at gmail.com  Thu Nov 25 11:56:52 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Thu, 25 Nov 2010 17:26:52 +0530
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <4CEE01C2.6000505@gmail.com>
References: <4CECE96A.7010602@gmail.com>
	<cb1680c755485b7ccfeead357744c621@rabbitmq.com>
	<4CECF555.3060605@gmail.com>
	<694c6e51f0a6d9bf0195cd40f2e1dd2c@rabbitmq.com>
	<4CECFDD1.6030107@gmail.com> <4CED0318.7030705@gmail.com>
	<4CEE01C2.6000505@gmail.com>
Message-ID: <4CEE4F04.7080005@gmail.com>

On 25/11/10 11:57 AM, Abhishek Kona wrote:
> On 24/11/10 5:50 PM, Abhishek Kona wrote:
>> On 24/11/10 5:28 PM, Abhishek Kona wrote:
>>> On 24/11/10 4:51 PM, Rob Harrop wrote:
>>>> That seems different to your previous report which mentioned that the
>>>> program waited at connection.createChannel() rather than
>>>> connectionfactory.newConnection(). Is that correct, or am I reading it
>>>> wrong :)
>>>>
>>>> Can you create and post a thread dump of the process while it is 
>>>> waiting?
>>>> You can get one with jstack<pid>.
>>>>
>>>> Regards,
>>>>
>>>> Rob
>>>>
>>>> On Wed, 24 Nov 2010 16:51:57 +0530, Abhishek Kona
>>>> <abhishek.kona at gmail.com>
>>>> wrote:
>>>>> On 24/11/10 4:29 PM, Rob Harrop wrote:
>>>>>> are seeing. I fixed this in the 2.1.1 client, so upgrading should do
>>>> the
>>>>> I have upgraded RabbitMQ and the client to 2.1.1 but still I see the
>>>>> same behavior.
>>>>>
>>>>> The application stops at
>>>>>               connection = connectionfactory.newConnection();
>>>>> It does not even fail and throw up.
>>>>>
>>>>> -Abhishek Kona
>>> Ya I was trying different things and this time I was creating a new 
>>> connection for each request, this time the block was at
>>> connection=connectionFactory.newConnection();
>>>
>>> I am attaching the jstack out put here,
>>> Thanks for the quick replies.
>>>
>>> -Abhishek Kona
>>>
>> I am able to confirm the same error,
>> My application stops at connection=connectionfactory.newConnection();
>>
>> I am using RabbitMQ 2.1.1 and 2.1.1 Library.
>> I am attaching the jstack output again.
>>
>> -Abhishek Kona
>>
> Hi folks,
>
> Any opinions about the issue. My application only stops when I user 
> RabbitMQ, any first impressions?
>
> Thanks for all the fish.
> -Abhishek Kona
I am sorry for the trouble,
There was a RabbitMQ connection which was not being closed on an error.
This was causing many number of RabbitMQ connection threads being 
created, which was causing problems.

Also is there an issue with running RabbitMQ server on Mac? When I run 
the server on an Ubuntu Machine the above code was working.
I am not sure about this though, will report back if I face the same 
issue again.

Thanks a lot Rob for taking time to help me out.

-Abhishek Kona


From rob at rabbitmq.com  Thu Nov 25 11:59:36 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 25 Nov 2010 11:59:36 +0000
Subject: [rabbitmq-discuss] Java Client not able to create channel
In-Reply-To: <4CEE4F04.7080005@gmail.com>
References: <4CECE96A.7010602@gmail.com>
	<cb1680c755485b7ccfeead357744c621@rabbitmq.com>
	<4CECF555.3060605@gmail.com>
	<694c6e51f0a6d9bf0195cd40f2e1dd2c@rabbitmq.com>
	<4CECFDD1.6030107@gmail.com> <4CED0318.7030705@gmail.com>
	<4CEE01C2.6000505@gmail.com> <4CEE4F04.7080005@gmail.com>
Message-ID: <3b677f0e06b5ee3025788c4f46569b40@rabbitmq.com>

> I am sorry for the trouble,
> There was a RabbitMQ connection which was not being closed on an error.
> This was causing many number of RabbitMQ connection threads being 
> created, which was causing problems.

Hmmm, a connection not being closed on an error sounds like a problem. Can
you create a reproducible case here?

> 
> Also is there an issue with running RabbitMQ server on Mac? When I run 
> the server on an Ubuntu Machine the above code was working.
> I am not sure about this though, will report back if I face the same 
> issue again.

I'm developing on Mac day-to-day and see no problems running the server.

> 
> Thanks a lot Rob for taking time to help me out.

No problem at all.

> 
> -Abhishek Kona

Rob


From coolchen033 at gmail.com  Thu Nov 25 12:09:26 2010
From: coolchen033 at gmail.com (Kevin Chan)
Date: Thu, 25 Nov 2010 20:09:26 +0800
Subject: [rabbitmq-discuss] how queues send msg balance
In-Reply-To: <AANLkTinRJVdf0dGC6bSr7VENiQ0gpABoKnft+T4Fq4BT@mail.gmail.com>
References: <AANLkTikCF3ROew_xNXi7U-OeUE6s-bo3=guf5COTMrH9@mail.gmail.com>
	<AANLkTinRJVdf0dGC6bSr7VENiQ0gpABoKnft+T4Fq4BT@mail.gmail.com>
Message-ID: <AANLkTi=-=a=28F8+HwVK3dDs7-4vs06PVqFdbtfqo7PA@mail.gmail.com>

thanks Marek  ,i have solved it by use channel.basicqos

2010/11/24 Marek Majkowski <majek04 at gmail.com>

> Kevin,
>
> Please take a look at our second tutorial:
> http://www.rabbitmq.com/tutorial-two-python.html
>
> I think what you need is 'basic.qos' command.
>
> Cheers,
>  Marek
>
> 2010/11/24 Kevin Chan <coolchen033 at gmail.com>:
> > hi everyone
> >
> > on my rabbitmq-server have one queue this queue has stored many msg ,i
> have
> > many consumers want to connect this queue ,so the server has many
> channels,
> > but some consumer can receive the msg, the other consumer can not
> receive,i
> > use rabbitmqctl list_channels found some channels has so many msg ?but
> the
> > other one has 0 msg ,how can i do to make send msg balance to all
> channels?
> >
> > Thanks
> > --
> > Kevin Chan
> > XiaMen China
> >
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>



-- 
Kevin Chan

XiaMen China
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101125/88a7a389/attachment.htm>

From rob at rabbitmq.com  Thu Nov 25 17:21:00 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 25 Nov 2010 17:21:00 +0000
Subject: [rabbitmq-discuss] clustering server trouble
In-Reply-To: <4CEBD0AF.10301@dgt.com.pl>
References: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>	<AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>	<AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>	<4CEA86FE.4020304@dgt.com.pl>
	<4CEB9FF8.7030606@dgt.com.pl> <4CEBD0AF.10301@dgt.com.pl>
Message-ID: <454eac40be70ccfe5e00ef4b365100ab@rabbitmq.com>

Hi Adam,

There is nothing built into the clients (I believe from your other posts
you're using .NET) that supports this.

However, you should be able to create something specific to your usage
quite easily. The ShutdownListener gives you the chance to see when
connections/channels are closed. You can then prod the relevant bits of
your application to create new connections and channels across the known
backup nodes. You can also add the appropriate compensation logic.

Hope this helps,

Rob

On Tue, 23 Nov 2010 15:33:19 +0100, Adam Kaminiecki <adamka at dgt.com.pl>
wrote:
> ok I  resolved it but have another problem. Is it possible to reconnect 
> client to another cluster? I mean is client support failover? I can't  
> find any usefull information.
> 
> Regards,
> Adam
> 
> 
> 
> W dniu 2010-11-23 12:05, Adam Kaminiecki pisze:
>> Hi,
>>
>> I have a porblem with clustering two servers. They are on two diffrent 
>> maschines. I have changed their cookie for the same. But when Im 
>> trying make cluster I get error
>> Error: {failed_to_cluster_with,[134], "Mnesia could not connect to 
>> some nodes."}
>>
>> Name of another node is correct, there are in the same network.
>> I"m using server version 2.1.1
>>
>>
>> Can anybody help me please?
>>
>>
>>
>> Regards,
>> Adam
>>
>>

From sunshinesucker at gmail.com  Thu Nov 25 17:41:31 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Thu, 25 Nov 2010 17:41:31 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <214C5D07-2CE0-4CA8-BBCB-610F03C4370D@npcinternational.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
	<FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>
	<AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>
	<2AA38F4A-ACD9-4F93-9736-84C3157CCF84@npcinternational.com>
	<4CEBD7E4.6040609@rabbitmq.com>
	<214C5D07-2CE0-4CA8-BBCB-610F03C4370D@npcinternational.com>
Message-ID: <AANLkTikpHxS7qR90rG7OEhPaBFYrU1omP33R4TZ1iXeP@mail.gmail.com>

I tried but the broker still doesnt start...


On 23 November 2010 15:09, Jon Brisbin <jon.brisbin at npcinternational.com>wrote:

>
> On Nov 23, 2010, at 9:04 AM, Matthias Radestock wrote:
>
> > Jon,
> >
> > On 22/11/10 15:12, Jon Brisbin wrote:
> >> It looks like, in 2.1.1, the lhttpc plugin needs to be unzipped inside
> >> the plugins folder. I've no idea why this is, maybe the Rabbit folks can
> >> answer that one.
> >
> > I suspect the problem is that lhttpc.ez does not contain a top-level
> directory.
> >
>
> Ahh... I built that manually.
>
> Thanks for the hint, Matthias. That's an easy fix. :)
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101125/a01b45d2/attachment.htm>

From sunshinesucker at gmail.com  Thu Nov 25 17:41:31 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Thu, 25 Nov 2010 17:41:31 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <214C5D07-2CE0-4CA8-BBCB-610F03C4370D@npcinternational.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
	<FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>
	<AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>
	<2AA38F4A-ACD9-4F93-9736-84C3157CCF84@npcinternational.com>
	<4CEBD7E4.6040609@rabbitmq.com>
	<214C5D07-2CE0-4CA8-BBCB-610F03C4370D@npcinternational.com>
Message-ID: <AANLkTikpHxS7qR90rG7OEhPaBFYrU1omP33R4TZ1iXeP@mail.gmail.com>

I tried but the broker still doesnt start...


On 23 November 2010 15:09, Jon Brisbin <jon.brisbin at npcinternational.com>wrote:

>
> On Nov 23, 2010, at 9:04 AM, Matthias Radestock wrote:
>
> > Jon,
> >
> > On 22/11/10 15:12, Jon Brisbin wrote:
> >> It looks like, in 2.1.1, the lhttpc plugin needs to be unzipped inside
> >> the plugins folder. I've no idea why this is, maybe the Rabbit folks can
> >> answer that one.
> >
> > I suspect the problem is that lhttpc.ez does not contain a top-level
> directory.
> >
>
> Ahh... I built that manually.
>
> Thanks for the hint, Matthias. That's an easy fix. :)
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101125/a01b45d2/attachment-0001.htm>

From adamka at dgt.com.pl  Thu Nov 25 18:01:55 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Thu, 25 Nov 2010 19:01:55 +0100
Subject: [rabbitmq-discuss] clustering server trouble
In-Reply-To: <454eac40be70ccfe5e00ef4b365100ab@rabbitmq.com>
References: <AANLkTik6ognaTQv9hL1yRaOq8jZOc+nujCxzETRDZEm7@mail.gmail.com>	<AANLkTikv15_7sQFtXMCAbKX_fzdW2wjuP5Wd7=URMM4A@mail.gmail.com>	<AANLkTikAezUdrgBV3ZOEtf8CeDufN9NM=vhM6D+6d3nn@mail.gmail.com>	<4CEA86FE.4020304@dgt.com.pl>
	<4CEB9FF8.7030606@dgt.com.pl> <4CEBD0AF.10301@dgt.com.pl>
	<454eac40be70ccfe5e00ef4b365100ab@rabbitmq.com>
Message-ID: <4CEEA493.10607@dgt.com.pl>

Thanks for reply. I just wanna make sure I need to do it on my own:)

Regards,
Adam

W dniu 2010-11-25 18:21, Rob Harrop pisze:
> Hi Adam,
>
> There is nothing built into the clients (I believe from your other posts
> you're using .NET) that supports this.
>
> However, you should be able to create something specific to your usage
> quite easily. The ShutdownListener gives you the chance to see when
> connections/channels are closed. You can then prod the relevant bits of
> your application to create new connections and channels across the known
> backup nodes. You can also add the appropriate compensation logic.
>
> Hope this helps,
>
> Rob
>
> On Tue, 23 Nov 2010 15:33:19 +0100, Adam Kaminiecki<adamka at dgt.com.pl>
> wrote:
>> ok I  resolved it but have another problem. Is it possible to reconnect
>> client to another cluster? I mean is client support failover? I can't
>> find any usefull information.
>>
>> Regards,
>> Adam
>>
>>
>>
>> W dniu 2010-11-23 12:05, Adam Kaminiecki pisze:
>>> Hi,
>>>
>>> I have a porblem with clustering two servers. They are on two diffrent
>>> maschines. I have changed their cookie for the same. But when Im
>>> trying make cluster I get error
>>> Error: {failed_to_cluster_with,[134], "Mnesia could not connect to
>>> some nodes."}
>>>
>>> Name of another node is correct, there are in the same network.
>>> I"m using server version 2.1.1
>>>
>>>
>>> Can anybody help me please?
>>>
>>>
>>>
>>> Regards,
>>> Adam
>>>
>>>

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From joserwan at gmail.com  Thu Nov 25 19:43:11 2010
From: joserwan at gmail.com (Erwan)
Date: Thu, 25 Nov 2010 14:43:11 -0500
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my cluster
	config file
Message-ID: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>

Hello,

I'm trying  to configure a 2 nodes cluster setup. It works if I add a node
with rabbitmqctl cluster rabbit at server, but it doesn't if I use a config
file.

Here is my config /etc/rabbitmq/rabbitmq_cluster.config :

['rabbit at server-172160237','rabbit at server-172160224']


/etc/hosts is set up :

(...)
127.0.0.1 server-172160237
172.16.0.224 server-172160224


When I start rabbit-mq server, I have no error, and rabbitmq status returns
:

Status of node 'rabbit at server-172160237' ...
[{running_applications,[{rabbit,"RabbitMQ","2.1.1"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {nodes,[{disc,['rabbit at server-172160237']}]},
 {running_nodes,['rabbit at server-172160237']}]
...done.

I even tried to pass config file as environment variable :

RABBITMQ_NODENAME=toto
RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster rabbitmq-server
and
RABBITMQ_NODENAME=toto
RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster.config
rabbitmq-server


But same result, except that rabbit has been replaced by toto ...

Do you see something I may have done wrong ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101125/0da28624/attachment.htm>

From dr.mark.lui at gmail.com  Thu Nov 25 19:53:20 2010
From: dr.mark.lui at gmail.com (Mark Lui)
Date: Thu, 25 Nov 2010 11:53:20 -0800
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my
 cluster config file
In-Reply-To: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
References: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
Message-ID: <AANLkTikyr9XaLA+sfhzgaunV6JBbh5pCtN6xkxYHvys4@mail.gmail.com>

I have been running into the same issue.  Clustering works fine using
the clustering transcript in the doc e.g.,

rabbit2$ rabbitmqctl stop_app
Stopping node rabbit at rabbit2 ...done.
rabbit2$ rabbitmqctl reset
Resetting node rabbit at rabbit2 ...done.
rabbit2$ rabbitmqctl cluster rabbit at rabbit1
Clustering node rabbit at rabbit2 with [rabbit at rabbit1] ...done.
rabbit2$ rabbitmqctl start_app
Starting node rabbit at rabbit2 ...done.

etc...

However using the auto-configuration sections of the docs has not worked.

I tried adding

[
  {rabbit, [
  	{cluster_nodes, ['rabbit at rabbit1', 'rabbit at rabbit2']}
  ]},
].

to the rabbitmq.config file and got a syntax error.  Then tried

[
  {rabbit, [
  	{cluster_nodes, ['rabbit at rabbit1', 'rabbit at rabbit2']}
  ]}
].

removing the comma and it did not cluster.  Then tried

['rabbit at rabbit1', 'rabbit at rabbit2']

in the rabbitmq_cluster.config file and it did not cluster.

I am at a lost as to what I am doing wrong.  We would like to use the
auto-configuration for an easier CM deployment.  Any insight as what
is wrong would be appreciated.

Mark


On Thu, Nov 25, 2010 at 11:43 AM, Erwan <joserwan at gmail.com> wrote:
> Hello,
> I'm trying ?to configure a 2 nodes cluster setup. It works if I add a node
> with rabbitmqctl cluster rabbit at server, but it doesn't if I use a config
> file.
> Here is my config /etc/rabbitmq/rabbitmq_cluster.config :
> ['rabbit at server-172160237','rabbit at server-172160224']
>
> /etc/hosts is set up :
> (...)
> 127.0.0.1 server-172160237
> 172.16.0.224 server-172160224
>
> When I start rabbit-mq server, I have no error, and rabbitmq status returns
> :
> Status of node 'rabbit at server-172160237' ...
> [{running_applications,[{rabbit,"RabbitMQ","2.1.1"},
> ?? ? ? ? ? ? ? ? ? ? ? ?{os_mon,"CPO ?CXC 138 46","2.1.8"},
> ?? ? ? ? ? ? ? ? ? ? ? ?{sasl,"SASL ?CXC 138 11","2.1.5.4"},
> ?? ? ? ? ? ? ? ? ? ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.4.7"},
> ?? ? ? ? ? ? ? ? ? ? ? ?{stdlib,"ERTS ?CXC 138 10","1.15.5"},
> ?? ? ? ? ? ? ? ? ? ? ? ?{kernel,"ERTS ?CXC 138 10","2.12.5"}]},
> ?{nodes,[{disc,['rabbit at server-172160237']}]},
> ?{running_nodes,['rabbit at server-172160237']}]
> ...done.
> I even tried to pass config file as environment variable :
> RABBITMQ_NODENAME=toto
> RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster rabbitmq-server
> and
> RABBITMQ_NODENAME=toto
> RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster.config
> rabbitmq-server
>
> But same result, except that rabbit has been replaced by toto ...
> Do you see something I may have done wrong ?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From joserwan at gmail.com  Thu Nov 25 19:59:31 2010
From: joserwan at gmail.com (Erwan)
Date: Thu, 25 Nov 2010 14:59:31 -0500
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my
 cluster config file
In-Reply-To: <AANLkTikyr9XaLA+sfhzgaunV6JBbh5pCtN6xkxYHvys4@mail.gmail.com>
References: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
	<AANLkTikyr9XaLA+sfhzgaunV6JBbh5pCtN6xkxYHvys4@mail.gmail.com>
Message-ID: <AANLkTi=yFFGFpe0j1BA4xWEACVkMnJqsDPR+voLNiTWN@mail.gmail.com>

Just a precision : I run
* rabbitmq-server 2.1.1
* erlang R12B-5-10
on CentOS x64

On Thu, Nov 25, 2010 at 2:53 PM, Mark Lui <dr.mark.lui at gmail.com> wrote:

> I have been running into the same issue.  Clustering works fine using
> the clustering transcript in the doc e.g.,
>
> rabbit2$ rabbitmqctl stop_app
> Stopping node rabbit at rabbit2 ...done.
> rabbit2$ rabbitmqctl reset
> Resetting node rabbit at rabbit2 ...done.
> rabbit2$ rabbitmqctl cluster rabbit at rabbit1
> Clustering node rabbit at rabbit2 with [rabbit at rabbit1] ...done.
> rabbit2$ rabbitmqctl start_app
> Starting node rabbit at rabbit2 ...done.
>
> etc...
>
> However using the auto-configuration sections of the docs has not worked.
>
> I tried adding
>
> [
>  {rabbit, [
>        {cluster_nodes, ['rabbit at rabbit1', 'rabbit at rabbit2']}
>  ]},
> ].
>
> to the rabbitmq.config file and got a syntax error.  Then tried
>
> [
>  {rabbit, [
>        {cluster_nodes, ['rabbit at rabbit1', 'rabbit at rabbit2']}
>  ]}
> ].
>
> removing the comma and it did not cluster.  Then tried
>
> ['rabbit at rabbit1', 'rabbit at rabbit2']
>
> in the rabbitmq_cluster.config file and it did not cluster.
>
> I am at a lost as to what I am doing wrong.  We would like to use the
> auto-configuration for an easier CM deployment.  Any insight as what
> is wrong would be appreciated.
>
> Mark
>
>
> On Thu, Nov 25, 2010 at 11:43 AM, Erwan <joserwan at gmail.com> wrote:
> > Hello,
> > I'm trying  to configure a 2 nodes cluster setup. It works if I add a
> node
> > with rabbitmqctl cluster rabbit at server, but it doesn't if I use a config
> > file.
> > Here is my config /etc/rabbitmq/rabbitmq_cluster.config :
> > ['rabbit at server-172160237','rabbit at server-172160224']
> >
> > /etc/hosts is set up :
> > (...)
> > 127.0.0.1 server-172160237
> > 172.16.0.224 server-172160224
> >
> > When I start rabbit-mq server, I have no error, and rabbitmq status
> returns
> > :
> > Status of node 'rabbit at server-172160237' ...
> > [{running_applications,[{rabbit,"RabbitMQ","2.1.1"},
> >                         {os_mon,"CPO  CXC 138 46","2.1.8"},
> >                         {sasl,"SASL  CXC 138 11","2.1.5.4"},
> >                         {mnesia,"MNESIA  CXC 138 12","4.4.7"},
> >                         {stdlib,"ERTS  CXC 138 10","1.15.5"},
> >                         {kernel,"ERTS  CXC 138 10","2.12.5"}]},
> >  {nodes,[{disc,['rabbit at server-172160237']}]},
> >  {running_nodes,['rabbit at server-172160237']}]
> > ...done.
> > I even tried to pass config file as environment variable :
> > RABBITMQ_NODENAME=toto
> > RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster
> rabbitmq-server
> > and
> > RABBITMQ_NODENAME=toto
> > RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster.config
> > rabbitmq-server
> >
> > But same result, except that rabbit has been replaced by toto ...
> > Do you see something I may have done wrong ?
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101125/d667d024/attachment.htm>

From alexandru at rabbitmq.com  Thu Nov 25 20:31:37 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 25 Nov 2010 20:31:37 +0000
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my
 cluster config file
In-Reply-To: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
References: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
Message-ID: <20101125203137.GA2280@dakota.doc.ic.ac.uk>

Hi Erwan,

The cluster config file was replaced in favour of a cluster_nodes
configuration variable in rabbitmq.config.  See the "Auto-configuration
of a cluster" section in our clustering guide.

http://www.rabbitmq.com/clustering.html

I'll check why the next poster is having trouble.

Cheers,
Alex

On Thu, Nov 25, 2010 at 02:43:11PM -0500, Erwan wrote:
> Hello,
> 
> I'm trying  to configure a 2 nodes cluster setup. It works if I add a node
> with rabbitmqctl cluster rabbit at server, but it doesn't if I use a config
> file.
> 
> Here is my config /etc/rabbitmq/rabbitmq_cluster.config :
> 
> ['rabbit at server-172160237','rabbit at server-172160224']
> 
> 
> /etc/hosts is set up :
> 
> (...)
> 127.0.0.1 server-172160237
> 172.16.0.224 server-172160224
> 
> 
> When I start rabbit-mq server, I have no error, and rabbitmq status returns
> :
> 
> Status of node 'rabbit at server-172160237' ...
> [{running_applications,[{rabbit,"RabbitMQ","2.1.1"},
>                         {os_mon,"CPO  CXC 138 46","2.1.8"},
>                         {sasl,"SASL  CXC 138 11","2.1.5.4"},
>                         {mnesia,"MNESIA  CXC 138 12","4.4.7"},
>                         {stdlib,"ERTS  CXC 138 10","1.15.5"},
>                         {kernel,"ERTS  CXC 138 10","2.12.5"}]},
>  {nodes,[{disc,['rabbit at server-172160237']}]},
>  {running_nodes,['rabbit at server-172160237']}]
> ...done.
> 
> I even tried to pass config file as environment variable :
> 
> RABBITMQ_NODENAME=toto
> RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster rabbitmq-server
> and
> RABBITMQ_NODENAME=toto
> RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster.config
> rabbitmq-server
> 
> 
> But same result, except that rabbit has been replaced by toto ...
> 
> Do you see something I may have done wrong ?

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Thu Nov 25 20:32:17 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 25 Nov 2010 20:32:17 +0000
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my
 cluster config file
In-Reply-To: <AANLkTikyr9XaLA+sfhzgaunV6JBbh5pCtN6xkxYHvys4@mail.gmail.com>
References: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
	<AANLkTikyr9XaLA+sfhzgaunV6JBbh5pCtN6xkxYHvys4@mail.gmail.com>
Message-ID: <4CEEC7D1.8030806@rabbitmq.com>

Erwan, Mark,

Erwan wrote:
> Here is my config /etc/rabbitmq/rabbitmq_cluster.config :
> 
> ['rabbit at server-172160237','rabbit at server-172160224']

The contents of the rabbitmq_cluster.config file got moved into the
general rabbitmq.config file a few versions ago. See the current
instructions at http://www.rabbitmq.com/clustering.html#auto-config

Mark Lui wrote:
> However using the auto-configuration sections of the docs has not
> worked.
> 
> I tried adding
> 
> [ {rabbit, [ {cluster_nodes, ['rabbit at rabbit1', 'rabbit at rabbit2']} 
> ]}, ].
> 
> to the rabbitmq.config file and got a syntax error.

That's a typo in the docs. Sorry. Fixed now.

> Then tried [ {rabbit, [ {cluster_nodes, ['rabbit at rabbit1',
> 'rabbit at rabbit2']} ]} ].
> 
> removing the comma and it did not cluster.

That should work. You did copy the rabbitmq.config file onto both nodes, 
right? What does 'rabbitmqctl status' return on the individual nodes?


Regards,

Matthias.

From joserwan at gmail.com  Thu Nov 25 20:47:29 2010
From: joserwan at gmail.com (Erwan)
Date: Thu, 25 Nov 2010 15:47:29 -0500
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my
 cluster config file
In-Reply-To: <20101125203137.GA2280@dakota.doc.ic.ac.uk>
References: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
	<20101125203137.GA2280@dakota.doc.ic.ac.uk>
Message-ID: <AANLkTinvWgLHizm_D4SCpXNG8-AVw7MvPg4+ga2oMrjV@mail.gmail.com>

Thank you it works !

I tried rabbit_config.config earlier, but it didn't work. I don't know what
is different now in my config ! Anyway, maybe rabbitMQ should have raise an
exception and it didn't ?

Thank you.

On Thu, Nov 25, 2010 at 3:31 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> Hi Erwan,
>
> The cluster config file was replaced in favour of a cluster_nodes
> configuration variable in rabbitmq.config.  See the "Auto-configuration
> of a cluster" section in our clustering guide.
>
> http://www.rabbitmq.com/clustering.html
>
> I'll check why the next poster is having trouble.
>
> Cheers,
> Alex
>
> On Thu, Nov 25, 2010 at 02:43:11PM -0500, Erwan wrote:
> > Hello,
> >
> > I'm trying  to configure a 2 nodes cluster setup. It works if I add a
> node
> > with rabbitmqctl cluster rabbit at server, but it doesn't if I use a config
> > file.
> >
> > Here is my config /etc/rabbitmq/rabbitmq_cluster.config :
> >
> > ['rabbit at server-172160237','rabbit at server-172160224']
> >
> >
> > /etc/hosts is set up :
> >
> > (...)
> > 127.0.0.1 server-172160237
> > 172.16.0.224 server-172160224
> >
> >
> > When I start rabbit-mq server, I have no error, and rabbitmq status
> returns
> > :
> >
> > Status of node 'rabbit at server-172160237' ...
> > [{running_applications,[{rabbit,"RabbitMQ","2.1.1"},
> >                         {os_mon,"CPO  CXC 138 46","2.1.8"},
> >                         {sasl,"SASL  CXC 138 11","2.1.5.4"},
> >                         {mnesia,"MNESIA  CXC 138 12","4.4.7"},
> >                         {stdlib,"ERTS  CXC 138 10","1.15.5"},
> >                         {kernel,"ERTS  CXC 138 10","2.12.5"}]},
> >  {nodes,[{disc,['rabbit at server-172160237']}]},
> >  {running_nodes,['rabbit at server-172160237']}]
> > ...done.
> >
> > I even tried to pass config file as environment variable :
> >
> > RABBITMQ_NODENAME=toto
> > RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster
> rabbitmq-server
> > and
> > RABBITMQ_NODENAME=toto
> > RABBITMQ_CLUSTER_CONFIG_FILE=/etc/rabbitmq/rabbitmq_cluster.config
> > rabbitmq-server
> >
> >
> > But same result, except that rabbit has been replaced by toto ...
> >
> > Do you see something I may have done wrong ?
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101125/0f9a5ef9/attachment.htm>

From dr.mark.lui at gmail.com  Thu Nov 25 22:04:27 2010
From: dr.mark.lui at gmail.com (Mark Lui)
Date: Thu, 25 Nov 2010 14:04:27 -0800
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my
 cluster config file
In-Reply-To: <4CEEC7D1.8030806@rabbitmq.com>
References: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
	<AANLkTikyr9XaLA+sfhzgaunV6JBbh5pCtN6xkxYHvys4@mail.gmail.com>
	<4CEEC7D1.8030806@rabbitmq.com>
Message-ID: <AANLkTi=prqbR3f1kXE4K1Q1xZcDYZ6nQu6cyN6LaaEah@mail.gmail.com>

Yes.  I did copy to both nodes. The status returns as there is no cluster.

On Nov 25, 2010 12:32 PM, "Matthias Radestock" <matthias at rabbitmq.com>
wrote:

Erwan, Mark,



Erwan wrote:
>
> Here is my config /etc/rabbitmq/rabbitmq_cluster.config :
>
> ['rabbit at server-172...
The contents of the rabbitmq_cluster.config file got moved into the
general rabbitmq.config file a few versions ago. See the current
instructions at http://www.rabbitmq.com/clustering.html#auto-config



Mark Lui wrote:
>
> However using the auto-configuration sections of the docs has not
> worked.
>
...
That's a typo in the docs. Sorry. Fixed now.



> Then tried [ {rabbit, [ {cluster_nodes, ['rabbit at rabbit1',
> 'rabbit at rabbit2']} ]} ].
>
> removi...
That should work. You did copy the rabbitmq.config file onto both nodes,
right? What does 'rabbitmqctl status' return on the individual nodes?


Regards,

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101125/35965572/attachment.htm>

From matthias at rabbitmq.com  Thu Nov 25 22:30:27 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 25 Nov 2010 22:30:27 +0000
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my
 cluster config file
In-Reply-To: <AANLkTi=prqbR3f1kXE4K1Q1xZcDYZ6nQu6cyN6LaaEah@mail.gmail.com>
References: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>	<AANLkTikyr9XaLA+sfhzgaunV6JBbh5pCtN6xkxYHvys4@mail.gmail.com>	<4CEEC7D1.8030806@rabbitmq.com>
	<AANLkTi=prqbR3f1kXE4K1Q1xZcDYZ6nQu6cyN6LaaEah@mail.gmail.com>
Message-ID: <4CEEE383.7010407@rabbitmq.com>

Mark Lui wrote:
> Yes.  I did copy to both nodes. The status returns as there is no cluster.

Can rabbitmqctl see the node on the other machine? E.g. on rabbit1 try 
'rabbitmqctl -n rabbit at rabbit2 status' and vice versa.


Matthias.

From dr.mark.lui at gmail.com  Fri Nov 26 00:22:22 2010
From: dr.mark.lui at gmail.com (Mark Lui)
Date: Thu, 25 Nov 2010 16:22:22 -0800
Subject: [rabbitmq-discuss] rabbitmq-server doesn't seem to read my
 cluster config file
In-Reply-To: <4CEEE383.7010407@rabbitmq.com>
References: <AANLkTi=yK6g1JiB7xWY9WWBTMoHuzet0cOMs7djFkJJn@mail.gmail.com>
	<AANLkTikyr9XaLA+sfhzgaunV6JBbh5pCtN6xkxYHvys4@mail.gmail.com>
	<4CEEC7D1.8030806@rabbitmq.com>
	<AANLkTi=prqbR3f1kXE4K1Q1xZcDYZ6nQu6cyN6LaaEah@mail.gmail.com>
	<4CEEE383.7010407@rabbitmq.com>
Message-ID: <AANLkTimL4Bn3GV5OX28y3h7VKi7ADy7RM+=6r9zOfLEb@mail.gmail.com>

Thanks for everyone's responses.  I got it working.  Might of had a
configuration error.

Mark

On Thu, Nov 25, 2010 at 2:30 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Mark Lui wrote:
>>
>> Yes. ?I did copy to both nodes. The status returns as there is no cluster.
>
> Can rabbitmqctl see the node on the other machine? E.g. on rabbit1 try
> 'rabbitmqctl -n rabbit at rabbit2 status' and vice versa.
>
>
> Matthias.
>

From ovidiudeac at gmail.com  Fri Nov 26 08:19:10 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Fri, 26 Nov 2010 10:19:10 +0200
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
	working?
In-Reply-To: <yrv4c1v69aca8.fsf@dwragg.eng.vmware.com>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>
	<4CE4B096.5010605@rabbitmq.com>
	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>
	<4CE66FEF.606@rabbitmq.com>
	<AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>
	<yrv4c1v69aca8.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=udpbJttV7F0FOH=Mx2mh80bxjBbA-4Wo2-OcE@mail.gmail.com>

On Thu, Nov 25, 2010 at 1:11 PM, David Wragg <david at rabbitmq.com> wrote:
> In AMQP, the broker signals channel-level errors as part of closing the
> channel. ?So there is no way to reuse a channel after an error. ?You
> will need to open a new channel for further operations.

I see. Is this a bug or a feature?

From simon at rabbitmq.com  Fri Nov 26 08:42:35 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Nov 2010 08:42:35 +0000
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
 working?
In-Reply-To: <AANLkTi=udpbJttV7F0FOH=Mx2mh80bxjBbA-4Wo2-OcE@mail.gmail.com>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>	<4CE4B096.5010605@rabbitmq.com>	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>	<4CE66FEF.606@rabbitmq.com>	<AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>	<yrv4c1v69aca8.fsf@dwragg.eng.vmware.com>
	<AANLkTi=udpbJttV7F0FOH=Mx2mh80bxjBbA-4Wo2-OcE@mail.gmail.com>
Message-ID: <4CEF72FB.6010605@rabbitmq.com>

On 26/11/2010 8:19AM, Ovidiu Deac wrote:
> On Thu, Nov 25, 2010 at 1:11 PM, David Wragg<david at rabbitmq.com>  wrote:
>> In AMQP, the broker signals channel-level errors as part of closing the
>> channel.  So there is no way to reuse a channel after an error.  You
>> will need to open a new channel for further operations.
>
> I see. Is this a bug or a feature?

That's an interesting question. Certainly it annoys a whole bunch of 
people. But there are reasons.

The spec states that it's done this way to "avoid ambiguous states after 
errors", and there's some truth to this, although with some effort I'm 
sure an unambiguous set of post-error states could be defined.

The more real concern for me is one of reliability. If you're aiming to 
write a reliable messaging system, you'll have to plan for connections 
(and hence channels) going away unexpectedly anyway - with the best will 
in the world machines crash and people trip over network cables. And if 
you're doing that anyway then treating programming / configuration 
errors in a similar way makes at least some degree of sense.

To come back to your use case - if you're writing automated tests and 
need to clean up when you're finished, try declaring your exchanges 
autodelete. They will then go when the last queue unbinds from them. And 
then either declare queues autodelete - they'll go when the last 
consumer disconnects, or exclusive - they'll go when the creating 
connection goes. You shouldn't have to explicitly delete stuff at all.

Cheers, Simon

From matthias at rabbitmq.com  Fri Nov 26 08:54:47 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 26 Nov 2010 08:54:47 +0000
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
 working?
In-Reply-To: <4CEF72FB.6010605@rabbitmq.com>
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>	<4CE4B096.5010605@rabbitmq.com>	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>	<4CE66FEF.606@rabbitmq.com>	<AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>	<yrv4c1v69aca8.fsf@dwragg.eng.vmware.com>	<AANLkTi=udpbJttV7F0FOH=Mx2mh80bxjBbA-4Wo2-OcE@mail.gmail.com>
	<4CEF72FB.6010605@rabbitmq.com>
Message-ID: <4CEF75D7.4030800@rabbitmq.com>

Simon MacMullen wrote:
> On 26/11/2010 8:19AM, Ovidiu Deac wrote:
>> On Thu, Nov 25, 2010 at 1:11 PM, David Wragg<david at rabbitmq.com>  wrote:
>>> In AMQP, the broker signals channel-level errors as part of closing the
>>> channel.  So there is no way to reuse a channel after an error.  You
>>> will need to open a new channel for further operations.
>>
>> I see. Is this a bug or a feature?
> 
> That's an interesting question. Certainly it annoys a whole bunch of 
> people. But there are reasons.
> 
> [...]
> To come back to your use case - if you're writing automated tests and 
> need to clean up when you're finished, try declaring your exchanges 
> autodelete. They will then go when the last queue unbinds from them. And 
> then either declare queues autodelete - they'll go when the last 
> consumer disconnects, or exclusive - they'll go when the creating 
> connection goes. You shouldn't have to explicitly delete stuff at all.

Arguably a few of the error conditions AMQP defines shouldn't be errors 
at all. Case in point, given that resource declaration is an *assertion* 
and thus an idempotent operation, resource deletion should be too 
(though I guess the operation should then be called 'retract' ;)


Regards,

Matthias.

From david at rabbitmq.com  Fri Nov 26 09:06:48 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 26 Nov 2010 09:06:48 +0000
Subject: [rabbitmq-discuss] .Net Cilent/1.8.0: IModel.QueueDelete not
	working?
In-Reply-To: <AANLkTi=udpbJttV7F0FOH=Mx2mh80bxjBbA-4Wo2-OcE@mail.gmail.com>
	(Ovidiu Deac's message of "Fri, 26 Nov 2010 10:19:10 +0200")
References: <AANLkTi=Y9H3_4RFvQq3V_RypYDj18OX3xB0D405bsW7n@mail.gmail.com>
	<4CE4B096.5010605@rabbitmq.com>
	<AANLkTinOZ5FBQS7Y+hXV31TbXxE3=ZVaFnNLKvso7X3G@mail.gmail.com>
	<4CE66FEF.606@rabbitmq.com>
	<AANLkTik=fssJZjei4Tx8GNS2TkX6GMmx5JWD9pYEU76+@mail.gmail.com>
	<yrv4c1v69aca8.fsf@dwragg.eng.vmware.com>
	<AANLkTi=udpbJttV7F0FOH=Mx2mh80bxjBbA-4Wo2-OcE@mail.gmail.com>
Message-ID: <yrv4czkswcv2v.fsf@dwragg.eng.vmware.com>

Ovidiu Deac <ovidiudeac at gmail.com> writes:
> On Thu, Nov 25, 2010 at 1:11 PM, David Wragg <david at rabbitmq.com> wrote:
>> In AMQP, the broker signals channel-level errors as part of closing the
>> channel. ?So there is no way to reuse a channel after an error. ?You
>> will need to open a new channel for further operations.
>
> I see. Is this a bug or a feature?

This behaviour is defined in the specification of the AMQP 0-9-1
protocol, so whether it is regarded as a bug or a feature has little
practical significance.  It is not something we can fix in rabbit.

I don't know whether AMQP 1.0 works differently in this area.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From fdourado at bancofator.com.br  Fri Nov 26 13:42:03 2010
From: fdourado at bancofator.com.br (Fernando Rodrigo Chagas Dourado)
Date: Fri, 26 Nov 2010 11:42:03 -0200
Subject: [rabbitmq-discuss] Exchanges and Queues
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br>

Guys,

 

What's the main diference between exchanges and queues?

 

I can't find on documentation.

 

Tks,

 

Fernando Dourado



Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.  
SAC: 0800 770 7229 ou sac at bancofator.com.br 
Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)      
                 email : ouvidoria at bancofator.com.br                                                    
                 carta:   Rua Dr. Renato Paes de Barros, 1017, 12o.andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001.

Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation. 
Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator 
Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)              
              or by email: ouvidoria at bancofator.com.br                           
              or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001 .
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101126/1bd6d49d/attachment.htm>

From majek04 at gmail.com  Fri Nov 26 13:44:05 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 26 Nov 2010 13:44:05 +0000
Subject: [rabbitmq-discuss] Exchanges and Queues
In-Reply-To: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br>
References: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br>
Message-ID: <AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com>

Fernando,

Have you seen our tutorials?

http://www.rabbitmq.com/getstarted.html

Exchanges are described in second tutorial


Cheers,
   Marek

On Fri, Nov 26, 2010 at 13:42, Fernando Rodrigo Chagas Dourado
<fdourado at bancofator.com.br> wrote:
> Guys,
>
>
>
> What?s the main diference between exchanges and queues?
>
>
>
> I can?t find on documentation.
>
>
>
> Tks,
>
>
>
> Fernando Dourado

From majek04 at gmail.com  Fri Nov 26 13:45:07 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 26 Nov 2010 13:45:07 +0000
Subject: [rabbitmq-discuss] Exchanges and Queues
In-Reply-To: <AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com>
References: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br>
	<AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com>
Message-ID: <AANLkTi=dgRrg5hRtyQYJgcD82ruBSaNpaP7tH9Vtv8J9@mail.gmail.com>

On Fri, Nov 26, 2010 at 13:44, Marek Majkowski <majek04 at gmail.com> wrote:
> Fernando,
>
> Have you seen our tutorials?
>
> http://www.rabbitmq.com/getstarted.html
>
> Exchanges are described in second tutorial

Wrong. In third.


> Cheers,
> ? Marek
>
> On Fri, Nov 26, 2010 at 13:42, Fernando Rodrigo Chagas Dourado
> <fdourado at bancofator.com.br> wrote:
>> Guys,
>>
>>
>>
>> What?s the main diference between exchanges and queues?
>>
>>
>>
>> I can?t find on documentation.
>>
>>
>>
>> Tks,
>>
>>
>>
>> Fernando Dourado
>

From fdourado at bancofator.com.br  Fri Nov 26 13:46:42 2010
From: fdourado at bancofator.com.br (Fernando Rodrigo Chagas Dourado)
Date: Fri, 26 Nov 2010 11:46:42 -0200
Subject: [rabbitmq-discuss] RES:  Exchanges and Queues
In-Reply-To: <AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com>
References: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br>
	<AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com>
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C70115DBA4@FSP-SRV-EXCH01.FatorDoria.br>

I will see. Thanks.

But, the main question is: here we always use exchanges and queues with same value. Today I think, "perhaps this is wrong".

Fernando Dourado


-----Mensagem original-----
De: Marek Majkowski [mailto:majek04 at gmail.com] 
Enviada em: sexta-feira, 26 de novembro de 2010 11:44
Para: Fernando Rodrigo Chagas Dourado
Cc: rabbitmq-discuss at lists.rabbitmq.com
Assunto: Re: [rabbitmq-discuss] Exchanges and Queues

Fernando,

Have you seen our tutorials?

http://www.rabbitmq.com/getstarted.html

Exchanges are described in second tutorial


Cheers,
   Marek

On Fri, Nov 26, 2010 at 13:42, Fernando Rodrigo Chagas Dourado
<fdourado at bancofator.com.br> wrote:
> Guys,
>
>
>
> What?s the main diference between exchanges and queues?
>
>
>
> I can?t find on documentation.
>
>
>
> Tks,
>
>
>
> Fernando Dourado


Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.  
SAC: 0800 770 7229 ou sac at bancofator.com.br 
Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)      
                 email : ouvidoria at bancofator.com.br                                                    
                 carta:   Rua Dr. Renato Paes de Barros, 1017, 12o.andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001.

Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation. 
Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator 
Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)              
              or by email: ouvidoria at bancofator.com.br                           
              or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001 .

From alexis at rabbitmq.com  Fri Nov 26 15:25:04 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 26 Nov 2010 15:25:04 +0000
Subject: [rabbitmq-discuss] RES: Exchanges and Queues
In-Reply-To: <6E15CEE6F245AC46B04E0160AAFD88C70115DBA4@FSP-SRV-EXCH01.FatorDoria.br>
References: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br>
	<AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com>
	<6E15CEE6F245AC46B04E0160AAFD88C70115DBA4@FSP-SRV-EXCH01.FatorDoria.br>
Message-ID: <AANLkTikBNkCBy_vZF0iXfRCHUL1marb_6p4i7-8eKuPN@mail.gmail.com>

Fernando

You are correct that it is wrong to treat exchanges and queues as
"exactly the same".  There are many differences, but from a *routing
and delivery* point of view:

* Exchanges can push messages to multiple recipients

* Queues share messages among consumers on a round robin basis

alexis


On Fri, Nov 26, 2010 at 1:46 PM, Fernando Rodrigo Chagas Dourado
<fdourado at bancofator.com.br> wrote:
> I will see. Thanks.
>
> But, the main question is: here we always use exchanges and queues with same value. Today I think, "perhaps this is wrong".
>
> Fernando Dourado
>
>
> -----Mensagem original-----
> De: Marek Majkowski [mailto:majek04 at gmail.com]
> Enviada em: sexta-feira, 26 de novembro de 2010 11:44
> Para: Fernando Rodrigo Chagas Dourado
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Assunto: Re: [rabbitmq-discuss] Exchanges and Queues
>
> Fernando,
>
> Have you seen our tutorials?
>
> http://www.rabbitmq.com/getstarted.html
>
> Exchanges are described in second tutorial
>
>
> Cheers,
> ? Marek
>
> On Fri, Nov 26, 2010 at 13:42, Fernando Rodrigo Chagas Dourado
> <fdourado at bancofator.com.br> wrote:
>> Guys,
>>
>>
>>
>> What?s the main diference between exchanges and queues?
>>
>>
>>
>> I can?t find on documentation.
>>
>>
>>
>> Tks,
>>
>>
>>
>> Fernando Dourado
>
>
> Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.
> SAC: 0800 770 7229 ou sac at bancofator.com.br
> Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)
> ? ? ? ? ? ? ? ? email : ouvidoria at bancofator.com.br
> ? ? ? ? ? ? ? ? carta: ? Rua Dr. Renato Paes de Barros, 1017, 12o.andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001.
>
> Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation.
> Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator
> Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)
> ? ? ? ? ? ? ?or by email: ouvidoria at bancofator.com.br
> ? ? ? ? ? ? ?or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001 .
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From fullergalway at gmail.com  Fri Nov 26 16:15:53 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 26 Nov 2010 16:15:53 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
Message-ID: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>

Hi,

Rabbitmq is very nice. Easy to install, and very easy to get running with it.

We are experimenting using the java interfaces. We are publishing json
messages of various sizes to a queue from several servers. A single
thread is consuming these messages, acknowledging each message.

Having noticed memory consumption on our server I ran a test of using
a clean install, and adding 3600 messages to the queue, then consuming
these messages and checking for memory usage using top command. I
notice that the memory used by rabbitmq slowly creeps upwards.

Is there a step I am missing to free some memory?

ps and status output below.

Thanks,
Rob.

Here is the ps line at each stage:

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
before publishing any messages:
26643 rabbitmq  20   0  278m  34m 2844 S    0  0.2   0:01.43 beam.smp
after publishing 3666 messages to the queue:
26643 rabbitmq  20   0  315m  65m 2924 S    0  0.4   0:05.21 beam.smp
consuming the messages from the queue.
after 1st cycle: (zero messages now in queue)
26643 rabbitmq  20   0  300m  52m 2924 S    0  0.3   0:08.18 beam.smp
publish 3666 messages with consumer running...
after 2nd cycle:  (zero messages now in queue)
26643 rabbitmq  20   0  306m  63m 2924 S    0  0.4   0:14.30 beam.smp
publish 3666 messages with consumer running...
after 3rd cycle:  (zero messages now in queue)
26643 rabbitmq  20   0  316m  72m 2924 S    0  0.5   0:18.72 beam.smp
later, with all publisher/consumer connections now closed:
26643 rabbitmq  20   0  316m  72m 2924 S    0  0.5   0:19.87 beam.smp


Output of status command follows:
Status of node rabbit at test ...
[{running_applications,
     [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
      {webmachine,"webmachine","1.7.0"},
      {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
      {rabbit,"RabbitMQ","2.1.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {crypto,"CRYPTO version 1","1.6.3"},
      {inets,"INETS  CXC 138 49","5.2"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,[{disc,[rabbit at test]}]},
 {running_nodes,[rabbit at test]}]
...done.


$ uname -a
Linux test 2.6.32-25-server #45-Ubuntu SMP Sat Oct 16 20:06:58 UTC
2010 x86_64 GNU/Linux

From matthew at rabbitmq.com  Fri Nov 26 16:19:15 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 26 Nov 2010 16:19:15 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
Message-ID: <20101126161915.GF1917@wellquite.org>

On Fri, Nov 26, 2010 at 04:15:53PM +0000, Robert Fuller wrote:
> Having noticed memory consumption on our server I ran a test of using
> a clean install, and adding 3600 messages to the queue, then consuming
> these messages and checking for memory usage using top command. I
> notice that the memory used by rabbitmq slowly creeps upwards.

Are you acknowledging messages or consuming with noAck/autoAck = true ?

Matthew

From jasonjwwilliams at gmail.com  Fri Nov 26 16:27:15 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 26 Nov 2010 09:27:15 -0700
Subject: [rabbitmq-discuss] RES: Exchanges and Queues
In-Reply-To: <AANLkTikBNkCBy_vZF0iXfRCHUL1marb_6p4i7-8eKuPN@mail.gmail.com>
References: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br>
	<AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com>
	<6E15CEE6F245AC46B04E0160AAFD88C70115DBA4@FSP-SRV-EXCH01.FatorDoria.br>
	<AANLkTikBNkCBy_vZF0iXfRCHUL1marb_6p4i7-8eKuPN@mail.gmail.com>
Message-ID: <AANLkTinoJ-i6S6SiNRbnUN3wUgMFd2rgXBjKsBZdkV5w@mail.gmail.com>

Hey Fernando,

The free chapter one of our book has a pretty in-depth description of
the difference, and the general foundation/primitives for AMQP:

http://manning.com/videla/

-J

On Fri, Nov 26, 2010 at 8:25 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Fernando
>
> You are correct that it is wrong to treat exchanges and queues as
> "exactly the same". ?There are many differences, but from a *routing
> and delivery* point of view:
>
> * Exchanges can push messages to multiple recipients
>
> * Queues share messages among consumers on a round robin basis
>
> alexis
>
>
> On Fri, Nov 26, 2010 at 1:46 PM, Fernando Rodrigo Chagas Dourado
> <fdourado at bancofator.com.br> wrote:
>> I will see. Thanks.
>>
>> But, the main question is: here we always use exchanges and queues with same value. Today I think, "perhaps this is wrong".
>>
>> Fernando Dourado
>>
>>
>> -----Mensagem original-----
>> De: Marek Majkowski [mailto:majek04 at gmail.com]
>> Enviada em: sexta-feira, 26 de novembro de 2010 11:44
>> Para: Fernando Rodrigo Chagas Dourado
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Assunto: Re: [rabbitmq-discuss] Exchanges and Queues
>>
>> Fernando,
>>
>> Have you seen our tutorials?
>>
>> http://www.rabbitmq.com/getstarted.html
>>
>> Exchanges are described in second tutorial
>>
>>
>> Cheers,
>> ? Marek
>>
>> On Fri, Nov 26, 2010 at 13:42, Fernando Rodrigo Chagas Dourado
>> <fdourado at bancofator.com.br> wrote:
>>> Guys,
>>>
>>>
>>>
>>> What?s the main diference between exchanges and queues?
>>>
>>>
>>>
>>> I can?t find on documentation.
>>>
>>>
>>>
>>> Tks,
>>>
>>>
>>>
>>> Fernando Dourado
>>
>>
>> Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.
>> SAC: 0800 770 7229 ou sac at bancofator.com.br
>> Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)
>> ? ? ? ? ? ? ? ? email : ouvidoria at bancofator.com.br
>> ? ? ? ? ? ? ? ? carta: ? Rua Dr. Renato Paes de Barros, 1017, 12o.andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001.
>>
>> Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation.
>> Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator
>> Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)
>> ? ? ? ? ? ? ?or by email: ouvidoria at bancofator.com.br
>> ? ? ? ? ? ? ?or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001 .
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From fullergalway at gmail.com  Fri Nov 26 16:28:14 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 26 Nov 2010 16:28:14 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <20101126161915.GF1917@wellquite.org>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
Message-ID: <AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>

On 26 November 2010 16:19, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Fri, Nov 26, 2010 at 04:15:53PM +0000, Robert Fuller wrote:
>> Having noticed memory consumption on our server I ran a test of using
>> a clean install, and adding 3600 messages to the queue, then consuming
>> these messages and checking for memory usage using top command. I
>> notice that the memory used by rabbitmq slowly creeps upwards.
>
> Are you acknowledging messages or consuming with noAck/autoAck = true ?

The consumer is acknowledging each message.

>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From fdourado at bancofator.com.br  Fri Nov 26 16:29:38 2010
From: fdourado at bancofator.com.br (Fernando Rodrigo Chagas Dourado)
Date: Fri, 26 Nov 2010 14:29:38 -0200
Subject: [rabbitmq-discuss] RES:  RES: Exchanges and Queues
In-Reply-To: <AANLkTinoJ-i6S6SiNRbnUN3wUgMFd2rgXBjKsBZdkV5w@mail.gmail.com>
References: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br><AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com><6E15CEE6F245AC46B04E0160AAFD88C70115DBA4@FSP-SRV-EXCH01.FatorDoria.br><AANLkTikBNkCBy_vZF0iXfRCHUL1marb_6p4i7-8eKuPN@mail.gmail.com>
	<AANLkTinoJ-i6S6SiNRbnUN3wUgMFd2rgXBjKsBZdkV5w@mail.gmail.com>
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C70115DD28@FSP-SRV-EXCH01.FatorDoria.br>

Great Jason... I will dedicate some days to understand this and make use of AMQP more cool here.

Fernando Dourado


-----Mensagem original-----
De: Jason J. W. Williams [mailto:jasonjwwilliams at gmail.com] 
Enviada em: sexta-feira, 26 de novembro de 2010 14:27
Para: Alexis Richardson
Cc: Fernando Rodrigo Chagas Dourado; rabbitmq-discuss at lists.rabbitmq.com
Assunto: Re: [rabbitmq-discuss] RES: Exchanges and Queues

Hey Fernando,

The free chapter one of our book has a pretty in-depth description of
the difference, and the general foundation/primitives for AMQP:

http://manning.com/videla/

-J

On Fri, Nov 26, 2010 at 8:25 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Fernando
>
> You are correct that it is wrong to treat exchanges and queues as
> "exactly the same". ?There are many differences, but from a *routing
> and delivery* point of view:
>
> * Exchanges can push messages to multiple recipients
>
> * Queues share messages among consumers on a round robin basis
>
> alexis
>
>
> On Fri, Nov 26, 2010 at 1:46 PM, Fernando Rodrigo Chagas Dourado
> <fdourado at bancofator.com.br> wrote:
>> I will see. Thanks.
>>
>> But, the main question is: here we always use exchanges and queues with same value. Today I think, "perhaps this is wrong".
>>
>> Fernando Dourado
>>
>>
>> -----Mensagem original-----
>> De: Marek Majkowski [mailto:majek04 at gmail.com]
>> Enviada em: sexta-feira, 26 de novembro de 2010 11:44
>> Para: Fernando Rodrigo Chagas Dourado
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Assunto: Re: [rabbitmq-discuss] Exchanges and Queues
>>
>> Fernando,
>>
>> Have you seen our tutorials?
>>
>> http://www.rabbitmq.com/getstarted.html
>>
>> Exchanges are described in second tutorial
>>
>>
>> Cheers,
>> ? Marek
>>
>> On Fri, Nov 26, 2010 at 13:42, Fernando Rodrigo Chagas Dourado
>> <fdourado at bancofator.com.br> wrote:
>>> Guys,
>>>
>>>
>>>
>>> What's the main diference between exchanges and queues?
>>>
>>>
>>>
>>> I can't find on documentation.
>>>
>>>
>>>
>>> Tks,
>>>
>>>
>>>
>>> Fernando Dourado
>>
>>
>> Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.
>> SAC: 0800 770 7229 ou sac at bancofator.com.br
>> Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)
>> ? ? ? ? ? ? ? ? email : ouvidoria at bancofator.com.br
>> ? ? ? ? ? ? ? ? carta: ? Rua Dr. Renato Paes de Barros, 1017, 12o.andar - Itaim Bibi - S?o Paulo - SP - 04530-001.
>>
>> Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation.
>> Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator
>> Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)
>> ? ? ? ? ? ? ?or by email: ouvidoria at bancofator.com.br
>> ? ? ? ? ? ? ?or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar - Itaim Bibi - S?o Paulo - SP - 04530-001 .
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.  
SAC: 0800 770 7229 ou sac at bancofator.com.br 
Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)      
                 email : ouvidoria at bancofator.com.br                                                    
                 carta:   Rua Dr. Renato Paes de Barros, 1017, 12o.andar  Itaim Bibi - S?o Paulo  SP  04530-001.

Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation. 
Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator 
Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)              
              or by email: ouvidoria at bancofator.com.br                           
              or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar  Itaim Bibi - S?o Paulo  SP  04530-001 .

From jasonjwwilliams at gmail.com  Fri Nov 26 16:30:54 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 26 Nov 2010 09:30:54 -0700
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
Message-ID: <AANLkTink1n6togf2WC=YR3hVMU1c9Zja2s_caz0V_geY@mail.gmail.com>

Have you tried setting vm_memory_high_watermark in the rabbitmq.config file?

-J

On Fri, Nov 26, 2010 at 9:15 AM, Robert Fuller <fullergalway at gmail.com> wrote:
> Hi,
>
> Rabbitmq is very nice. Easy to install, and very easy to get running with it.
>
> We are experimenting using the java interfaces. We are publishing json
> messages of various sizes to a queue from several servers. A single
> thread is consuming these messages, acknowledging each message.
>
> Having noticed memory consumption on our server I ran a test of using
> a clean install, and adding 3600 messages to the queue, then consuming
> these messages and checking for memory usage using top command. I
> notice that the memory used by rabbitmq slowly creeps upwards.
>
> Is there a step I am missing to free some memory?
>
> ps and status output below.
>
> Thanks,
> Rob.
>
> Here is the ps line at each stage:
>
> ?PID USER ? ? ?PR ?NI ?VIRT ?RES ?SHR S %CPU %MEM ? ?TIME+ ?COMMAND
> before publishing any messages:
> 26643 rabbitmq ?20 ? 0 ?278m ?34m 2844 S ? ?0 ?0.2 ? 0:01.43 beam.smp
> after publishing 3666 messages to the queue:
> 26643 rabbitmq ?20 ? 0 ?315m ?65m 2924 S ? ?0 ?0.4 ? 0:05.21 beam.smp
> consuming the messages from the queue.
> after 1st cycle: (zero messages now in queue)
> 26643 rabbitmq ?20 ? 0 ?300m ?52m 2924 S ? ?0 ?0.3 ? 0:08.18 beam.smp
> publish 3666 messages with consumer running...
> after 2nd cycle: ?(zero messages now in queue)
> 26643 rabbitmq ?20 ? 0 ?306m ?63m 2924 S ? ?0 ?0.4 ? 0:14.30 beam.smp
> publish 3666 messages with consumer running...
> after 3rd cycle: ?(zero messages now in queue)
> 26643 rabbitmq ?20 ? 0 ?316m ?72m 2924 S ? ?0 ?0.5 ? 0:18.72 beam.smp
> later, with all publisher/consumer connections now closed:
> 26643 rabbitmq ?20 ? 0 ?316m ?72m 2924 S ? ?0 ?0.5 ? 0:19.87 beam.smp
>
>
> Output of status command follows:
> Status of node rabbit at test ...
> [{running_applications,
> ? ? [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
> ? ? ?{webmachine,"webmachine","1.7.0"},
> ? ? ?{amqp_client,"RabbitMQ AMQP Client","2.1.1"},
> ? ? ?{rabbit,"RabbitMQ","2.1.1"},
> ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.4.12"},
> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.4"},
> ? ? ?{sasl,"SASL ?CXC 138 11","2.1.8"},
> ? ? ?{rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
> ? ? ?{mochiweb,"MochiMedia Web Server","1.3"},
> ? ? ?{crypto,"CRYPTO version 1","1.6.3"},
> ? ? ?{inets,"INETS ?CXC 138 49","5.2"},
> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.16.4"},
> ? ? ?{kernel,"ERTS ?CXC 138 10","2.13.4"}]},
> ?{nodes,[{disc,[rabbit at test]}]},
> ?{running_nodes,[rabbit at test]}]
> ...done.
>
>
> $ uname -a
> Linux test 2.6.32-25-server #45-Ubuntu SMP Sat Oct 16 20:06:58 UTC
> 2010 x86_64 GNU/Linux
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Fri Nov 26 16:33:10 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 26 Nov 2010 16:33:10 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
	<AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
Message-ID: <20101126163309.GG1917@wellquite.org>

On Fri, Nov 26, 2010 at 04:28:14PM +0000, Robert Fuller wrote:
> On 26 November 2010 16:19, Matthew Sackman <matthew at rabbitmq.com> wrote:
> > On Fri, Nov 26, 2010 at 04:15:53PM +0000, Robert Fuller wrote:
> >> Having noticed memory consumption on our server I ran a test of using
> >> a clean install, and adding 3600 messages to the queue, then consuming
> >> these messages and checking for memory usage using top command. I
> >> notice that the memory used by rabbitmq slowly creeps upwards.
> >
> > Are you acknowledging messages or consuming with noAck/autoAck = true ?
> 
> The consumer is acknowledging each message.

Ok, in which case there's nothing more you can do. Erlang is a GC'd
language and so when it obtains memory on demand, it may choose not to
promptly return that memory to the OS. It might take a while for some
large contiguous block of free memory to occur before Erlang free's the
memory.

Thus whilst the memory use of Rabbit may initially rise, provided you
keep draining the queues such that they don't grow endlessly, you should
find the memory use levels out after a while.

Matthew

From fullergalway at gmail.com  Fri Nov 26 16:34:45 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 26 Nov 2010 16:34:45 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTink1n6togf2WC=YR3hVMU1c9Zja2s_caz0V_geY@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<AANLkTink1n6togf2WC=YR3hVMU1c9Zja2s_caz0V_geY@mail.gmail.com>
Message-ID: <AANLkTimUvVv094z4NMjr6BUbxqMx-t6a+xT1cwv_npLr@mail.gmail.com>

On 26 November 2010 16:30, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Have you tried setting vm_memory_high_watermark in the rabbitmq.config file?
No. I understand this can be used for flow control. Does it also
trigger garbage collection?

> -J
>
> On Fri, Nov 26, 2010 at 9:15 AM, Robert Fuller <fullergalway at gmail.com> wrote:
>> Hi,
>>
>> Rabbitmq is very nice. Easy to install, and very easy to get running with it.
>>
>> We are experimenting using the java interfaces. We are publishing json
>> messages of various sizes to a queue from several servers. A single
>> thread is consuming these messages, acknowledging each message.
>>
>> Having noticed memory consumption on our server I ran a test of using
>> a clean install, and adding 3600 messages to the queue, then consuming
>> these messages and checking for memory usage using top command. I
>> notice that the memory used by rabbitmq slowly creeps upwards.
>>
>> Is there a step I am missing to free some memory?
>>
>> ps and status output below.
>>
>> Thanks,
>> Rob.
>>
>> Here is the ps line at each stage:
>>
>> ?PID USER ? ? ?PR ?NI ?VIRT ?RES ?SHR S %CPU %MEM ? ?TIME+ ?COMMAND
>> before publishing any messages:
>> 26643 rabbitmq ?20 ? 0 ?278m ?34m 2844 S ? ?0 ?0.2 ? 0:01.43 beam.smp
>> after publishing 3666 messages to the queue:
>> 26643 rabbitmq ?20 ? 0 ?315m ?65m 2924 S ? ?0 ?0.4 ? 0:05.21 beam.smp
>> consuming the messages from the queue.
>> after 1st cycle: (zero messages now in queue)
>> 26643 rabbitmq ?20 ? 0 ?300m ?52m 2924 S ? ?0 ?0.3 ? 0:08.18 beam.smp
>> publish 3666 messages with consumer running...
>> after 2nd cycle: ?(zero messages now in queue)
>> 26643 rabbitmq ?20 ? 0 ?306m ?63m 2924 S ? ?0 ?0.4 ? 0:14.30 beam.smp
>> publish 3666 messages with consumer running...
>> after 3rd cycle: ?(zero messages now in queue)
>> 26643 rabbitmq ?20 ? 0 ?316m ?72m 2924 S ? ?0 ?0.5 ? 0:18.72 beam.smp
>> later, with all publisher/consumer connections now closed:
>> 26643 rabbitmq ?20 ? 0 ?316m ?72m 2924 S ? ?0 ?0.5 ? 0:19.87 beam.smp
>>
>>
>> Output of status command follows:
>> Status of node rabbit at test ...
>> [{running_applications,
>> ? ? [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
>> ? ? ?{webmachine,"webmachine","1.7.0"},
>> ? ? ?{amqp_client,"RabbitMQ AMQP Client","2.1.1"},
>> ? ? ?{rabbit,"RabbitMQ","2.1.1"},
>> ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.4.12"},
>> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.4"},
>> ? ? ?{sasl,"SASL ?CXC 138 11","2.1.8"},
>> ? ? ?{rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
>> ? ? ?{mochiweb,"MochiMedia Web Server","1.3"},
>> ? ? ?{crypto,"CRYPTO version 1","1.6.3"},
>> ? ? ?{inets,"INETS ?CXC 138 49","5.2"},
>> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.16.4"},
>> ? ? ?{kernel,"ERTS ?CXC 138 10","2.13.4"}]},
>> ?{nodes,[{disc,[rabbit at test]}]},
>> ?{running_nodes,[rabbit at test]}]
>> ...done.
>>
>>
>> $ uname -a
>> Linux test 2.6.32-25-server #45-Ubuntu SMP Sat Oct 16 20:06:58 UTC
>> 2010 x86_64 GNU/Linux
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From matthew at rabbitmq.com  Fri Nov 26 16:36:07 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 26 Nov 2010 16:36:07 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTimUvVv094z4NMjr6BUbxqMx-t6a+xT1cwv_npLr@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<AANLkTink1n6togf2WC=YR3hVMU1c9Zja2s_caz0V_geY@mail.gmail.com>
	<AANLkTimUvVv094z4NMjr6BUbxqMx-t6a+xT1cwv_npLr@mail.gmail.com>
Message-ID: <20101126163606.GI1917@wellquite.org>

On Fri, Nov 26, 2010 at 04:34:45PM +0000, Robert Fuller wrote:
> On 26 November 2010 16:30, Jason J. W. Williams
> <jasonjwwilliams at gmail.com> wrote:
> > Have you tried setting vm_memory_high_watermark in the rabbitmq.config file?
> No. I understand this can be used for flow control. Does it also
> trigger garbage collection?

Not really, no. You shouldn't need to touch that setting except in
extremis.

Matthew

From simon at rabbitmq.com  Fri Nov 26 16:38:05 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Nov 2010 16:38:05 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTink1n6togf2WC=YR3hVMU1c9Zja2s_caz0V_geY@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<AANLkTink1n6togf2WC=YR3hVMU1c9Zja2s_caz0V_geY@mail.gmail.com>
Message-ID: <4CEFE26D.2070204@rabbitmq.com>

Bear in mind that's set by default anyway (to 0.4).

RabbitMQ can benefit from keeping things in memory, but you don't want 
it to eat all your memory. Therefore it will try not to exceed (physical 
ram) * (vm_memory_high_watermark). It can go a bit over, but at that 
point it'll become much more aggressive about swapping messages out to 
disk so it's rare to go a long way over.

And as Matthew points out, GCing makes all this a bit approximate. But 
my workstation can sustain ca 20k messages per second for as long as 
I've cared to watch it.

Cheers, Simon

On 26/11/10 16:30, Jason J. W. Williams wrote:
> Have you tried setting vm_memory_high_watermark in the rabbitmq.config file?
>
> -J
>
> On Fri, Nov 26, 2010 at 9:15 AM, Robert Fuller<fullergalway at gmail.com>  wrote:
>> Hi,
>>
>> Rabbitmq is very nice. Easy to install, and very easy to get running with it.
>>
>> We are experimenting using the java interfaces. We are publishing json
>> messages of various sizes to a queue from several servers. A single
>> thread is consuming these messages, acknowledging each message.
>>
>> Having noticed memory consumption on our server I ran a test of using
>> a clean install, and adding 3600 messages to the queue, then consuming
>> these messages and checking for memory usage using top command. I
>> notice that the memory used by rabbitmq slowly creeps upwards.
>>
>> Is there a step I am missing to free some memory?
>>
>> ps and status output below.
>>
>> Thanks,
>> Rob.
>>
>> Here is the ps line at each stage:
>>
>>   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
>> before publishing any messages:
>> 26643 rabbitmq  20   0  278m  34m 2844 S    0  0.2   0:01.43 beam.smp
>> after publishing 3666 messages to the queue:
>> 26643 rabbitmq  20   0  315m  65m 2924 S    0  0.4   0:05.21 beam.smp
>> consuming the messages from the queue.
>> after 1st cycle: (zero messages now in queue)
>> 26643 rabbitmq  20   0  300m  52m 2924 S    0  0.3   0:08.18 beam.smp
>> publish 3666 messages with consumer running...
>> after 2nd cycle:  (zero messages now in queue)
>> 26643 rabbitmq  20   0  306m  63m 2924 S    0  0.4   0:14.30 beam.smp
>> publish 3666 messages with consumer running...
>> after 3rd cycle:  (zero messages now in queue)
>> 26643 rabbitmq  20   0  316m  72m 2924 S    0  0.5   0:18.72 beam.smp
>> later, with all publisher/consumer connections now closed:
>> 26643 rabbitmq  20   0  316m  72m 2924 S    0  0.5   0:19.87 beam.smp
>>
>>
>> Output of status command follows:
>> Status of node rabbit at test ...
>> [{running_applications,
>>      [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
>>       {webmachine,"webmachine","1.7.0"},
>>       {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
>>       {rabbit,"RabbitMQ","2.1.1"},
>>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>>       {sasl,"SASL  CXC 138 11","2.1.8"},
>>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
>>       {mochiweb,"MochiMedia Web Server","1.3"},
>>       {crypto,"CRYPTO version 1","1.6.3"},
>>       {inets,"INETS  CXC 138 49","5.2"},
>>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>>   {nodes,[{disc,[rabbit at test]}]},
>>   {running_nodes,[rabbit at test]}]
>> ...done.
>>
>>
>> $ uname -a
>> Linux test 2.6.32-25-server #45-Ubuntu SMP Sat Oct 16 20:06:58 UTC
>> 2010 x86_64 GNU/Linux
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From fullergalway at gmail.com  Fri Nov 26 16:44:51 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 26 Nov 2010 16:44:51 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <20101126163309.GG1917@wellquite.org>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
	<AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
	<20101126163309.GG1917@wellquite.org>
Message-ID: <AANLkTimB3DOW=-1c_emewsT5xQR+ddH6CRc9ifhMPCYE@mail.gmail.com>

On 26 November 2010 16:33, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Fri, Nov 26, 2010 at 04:28:14PM +0000, Robert Fuller wrote:
>> On 26 November 2010 16:19, Matthew Sackman <matthew at rabbitmq.com> wrote:
>> > On Fri, Nov 26, 2010 at 04:15:53PM +0000, Robert Fuller wrote:
>> >> Having noticed memory consumption on our server I ran a test of using
>> >> a clean install, and adding 3600 messages to the queue, then consuming
>> >> these messages and checking for memory usage using top command. I
>> >> notice that the memory used by rabbitmq slowly creeps upwards.
>> >
>> > Are you acknowledging messages or consuming with noAck/autoAck = true ?
>>
>> The consumer is acknowledging each message.
>
> Ok, in which case there's nothing more you can do. Erlang is a GC'd
> language and so when it obtains memory on demand, it may choose not to
> promptly return that memory to the OS. It might take a while for some
> large contiguous block of free memory to occur before Erlang free's the
> memory.
>
> Thus whilst the memory use of Rabbit may initially rise, provided you
> keep draining the queues such that they don't grow endlessly, you should
> find the memory use levels out after a while.

Thanks Mathew, this makes sense and also maybe sheds some light on the
larger picture which is this: Over a number of hours during our
producers were producing a few million messages at about the same rate
the consumer was able to process them. However, because the consumer
started after the producer, there remained at all times some thousands
of messages in the queue. Memory consumption seemed to rise and rise.
Is it only when the queue reaches a zero size that the memory is
cleared?

What strategies would you suggest for dealing with this?

One I can think of would be to maintain a rotation of queues... after
putting a million messages onto any queue move on to the next queue.
The consumer, finding no messages on a queue will move to the next
queue in the rotation. Is this reasonable?


>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jon.brisbin at npcinternational.com  Fri Nov 26 16:49:02 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 26 Nov 2010 10:49:02 -0600
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <AANLkTikpHxS7qR90rG7OEhPaBFYrU1omP33R4TZ1iXeP@mail.gmail.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
	<FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>
	<AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>
	<2AA38F4A-ACD9-4F93-9736-84C3157CCF84@npcinternational.com>
	<4CEBD7E4.6040609@rabbitmq.com>
	<214C5D07-2CE0-4CA8-BBCB-610F03C4370D@npcinternational.com>
	<AANLkTikpHxS7qR90rG7OEhPaBFYrU1omP33R4TZ1iXeP@mail.gmail.com>
Message-ID: <66150186-E436-4242-A742-EB1698C61751@npcinternational.com>

Can I see your webhooks configuration?

jb


On Nov 25, 2010, at 11:41 AM, sunghyun lee wrote:

> I tried but the broker still doesnt start...
> 
> 
> On 23 November 2010 15:09, Jon Brisbin <jon.brisbin at npcinternational.com> wrote:
> 
> On Nov 23, 2010, at 9:04 AM, Matthias Radestock wrote:
> 
> > Jon,
> >
> > On 22/11/10 15:12, Jon Brisbin wrote:
> >> It looks like, in 2.1.1, the lhttpc plugin needs to be unzipped inside
> >> the plugins folder. I've no idea why this is, maybe the Rabbit folks can
> >> answer that one.
> >
> > I suspect the problem is that lhttpc.ez does not contain a top-level directory.
> >
> 
> Ahh... I built that manually.
> 
> Thanks for the hint, Matthias. That's an easy fix. :)
> 
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


Jon Brisbin
Portal Webmaster
NPC International, Inc.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101126/cb187ea8/attachment.htm>

From matthew at rabbitmq.com  Fri Nov 26 16:51:51 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 26 Nov 2010 16:51:51 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTimB3DOW=-1c_emewsT5xQR+ddH6CRc9ifhMPCYE@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
	<AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
	<20101126163309.GG1917@wellquite.org>
	<AANLkTimB3DOW=-1c_emewsT5xQR+ddH6CRc9ifhMPCYE@mail.gmail.com>
Message-ID: <20101126165150.GJ1917@wellquite.org>

On Fri, Nov 26, 2010 at 04:44:51PM +0000, Robert Fuller wrote:
> Thanks Mathew, this makes sense and also maybe sheds some light on the
> larger picture which is this: Over a number of hours during our
> producers were producing a few million messages at about the same rate
> the consumer was able to process them. However, because the consumer
> started after the producer, there remained at all times some thousands
> of messages in the queue. Memory consumption seemed to rise and rise.
> Is it only when the queue reaches a zero size that the memory is
> cleared?

No - provided the queue is staying at a constant length, and the
consumers are acking messages (the "messages unacknowledged" field
should stay constant and low), the memory usage should not grow
continuously.

> One I can think of would be to maintain a rotation of queues... after
> putting a million messages onto any queue move on to the next queue.
> The consumer, finding no messages on a queue will move to the next
> queue in the rotation. Is this reasonable?

It's reasonable, but should be utterly unnecessary.

Matthew

From fullergalway at gmail.com  Fri Nov 26 17:09:35 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 26 Nov 2010 17:09:35 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <20101126165150.GJ1917@wellquite.org>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
	<AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
	<20101126163309.GG1917@wellquite.org>
	<AANLkTimB3DOW=-1c_emewsT5xQR+ddH6CRc9ifhMPCYE@mail.gmail.com>
	<20101126165150.GJ1917@wellquite.org>
Message-ID: <AANLkTinFNobBXieQhXjSLS8b_UJF__qtg2=wm7u-y3Sw@mail.gmail.com>

> No - provided the queue is staying at a constant length, and the
> consumers are acking messages (the "messages unacknowledged" field
> should stay constant and low), the memory usage should not grow
> continuously.
ok, thanks this also makes sense.

What eventually happens to message 2 in sequence 1,2,3,4,5 if the
other messages in the sequence have been acknowledged, (but not 2)?
What needs to change in order for message 2 to be received again by
the consumer?

I think that in the case of some errors in the running application the
consumer client did not acknowledge some messages. I was secretly
naively hoping that such messages would be injected by the server into
the sequence at a later point after some timeout not having received
the ack.

From matthew at rabbitmq.com  Fri Nov 26 17:15:17 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 26 Nov 2010 17:15:17 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTinFNobBXieQhXjSLS8b_UJF__qtg2=wm7u-y3Sw@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
	<AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
	<20101126163309.GG1917@wellquite.org>
	<AANLkTimB3DOW=-1c_emewsT5xQR+ddH6CRc9ifhMPCYE@mail.gmail.com>
	<20101126165150.GJ1917@wellquite.org>
	<AANLkTinFNobBXieQhXjSLS8b_UJF__qtg2=wm7u-y3Sw@mail.gmail.com>
Message-ID: <20101126171517.GM1917@wellquite.org>

If messages are being delivered to a consumer and no_ack/auto_ack is
false, then responsibility for that message remains with the broker
until the consumer:
i) acks the message
ii) closes the channel or connection (either politely or by crashing)
iii) nacks or in some way explicitly requeues the message

In the case of (i), at that point the broker can forget about the
message. In the other cases, the broker reinjects the message to the
rear of the queue, thus making the message available for delivery to
others.

Matthew

From fullergalway at gmail.com  Fri Nov 26 20:34:10 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 26 Nov 2010 20:34:10 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <20101126171517.GM1917@wellquite.org>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
	<AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
	<20101126163309.GG1917@wellquite.org>
	<AANLkTimB3DOW=-1c_emewsT5xQR+ddH6CRc9ifhMPCYE@mail.gmail.com>
	<20101126165150.GJ1917@wellquite.org>
	<AANLkTinFNobBXieQhXjSLS8b_UJF__qtg2=wm7u-y3Sw@mail.gmail.com>
	<20101126171517.GM1917@wellquite.org>
Message-ID: <AANLkTi=XCypEYr-PkSeB2z2=9DxLeuxncCXyK2qQkppX@mail.gmail.com>

Thanks Mathew for the guidance.

My conclusion at this point is that the memory issues we experienced
are a consequence of the way we are (mis)using rabbitmq. I will adjust
implementation of our consumer to take into consideration your
comments in this thread.

Thanks again,
Rob.

From aquino.gustavo at gmail.com  Fri Nov 26 22:50:04 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Fri, 26 Nov 2010 20:50:04 -0200
Subject: [rabbitmq-discuss] RES:  RES: Exchanges and Queues
In-Reply-To: <6E15CEE6F245AC46B04E0160AAFD88C70115DD28@FSP-SRV-EXCH01.FatorDoria.br>
References: <6E15CEE6F245AC46B04E0160AAFD88C70115DB8E@FSP-SRV-EXCH01.FatorDoria.br><AANLkTikN5_xJ9hLSA18YV6tRbrj+9G0ACa1-GaR6XbKH@mail.gmail.com><6E15CEE6F245AC46B04E0160AAFD88C70115DBA4@FSP-SRV-EXCH01.FatorDoria.br><AANLkTikBNkCBy_vZF0iXfRCHUL1marb_6p4i7-8eKuPN@mail.gmail.com>
	<AANLkTinoJ-i6S6SiNRbnUN3wUgMFd2rgXBjKsBZdkV5w@mail.gmail.com>
	<6E15CEE6F245AC46B04E0160AAFD88C70115DD28@FSP-SRV-EXCH01.FatorDoria.br>
Message-ID: <14B0D7D1-CCD9-45D0-BFD7-D537A9789995@gmail.com>

Hi Dourado,

Are u sure that are using exchanges and queues as the same way?

You don't use more exchanges to route messages between queues? Look  
for mkt data feed design, it's a very good eg. of how to use exchanges  
and queues and other good eg. Is the core your project ;-)

Call me my friend, will be a pleasure help you.

Regards.


On 26/11/2010, at 14:29, "Fernando Rodrigo Chagas Dourado" <fdourado at bancofator.com.br 
 > wrote:

> Great Jason... I will dedicate some days to understand this and make  
> use of AMQP more cool here.
>
> Fernando Dourado
>
>
> -----Mensagem original-----
> De: Jason J. W. Williams [mailto:jasonjwwilliams at gmail.com]
> Enviada em: sexta-feira, 26 de novembro de 2010 14:27
> Para: Alexis Richardson
> Cc: Fernando Rodrigo Chagas Dourado; rabbitmq-discuss at lists.rabbitmq.com
> Assunto: Re: [rabbitmq-discuss] RES: Exchanges and Queues
>
> Hey Fernando,
>
> The free chapter one of our book has a pretty in-depth description of
> the difference, and the general foundation/primitives for AMQP:
>
> http://manning.com/videla/
>
> -J
>
> On Fri, Nov 26, 2010 at 8:25 AM, Alexis Richardson <alexis at rabbitmq.com 
> > wrote:
>> Fernando
>>
>> You are correct that it is wrong to treat exchanges and queues as
>> "exactly the same".  There are many differences, but from a *routing
>> and delivery* point of view:
>>
>> * Exchanges can push messages to multiple recipients
>>
>> * Queues share messages among consumers on a round robin basis
>>
>> alexis
>>
>>
>> On Fri, Nov 26, 2010 at 1:46 PM, Fernando Rodrigo Chagas Dourado
>> <fdourado at bancofator.com.br> wrote:
>>> I will see. Thanks.
>>>
>>> But, the main question is: here we always use exchanges and queues  
>>> with same value. Today I think, "perhaps this is wrong".
>>>
>>> Fernando Dourado
>>>
>>>
>>> -----Mensagem original-----
>>> De: Marek Majkowski [mailto:majek04 at gmail.com]
>>> Enviada em: sexta-feira, 26 de novembro de 2010 11:44
>>> Para: Fernando Rodrigo Chagas Dourado
>>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>>> Assunto: Re: [rabbitmq-discuss] Exchanges and Queues
>>>
>>> Fernando,
>>>
>>> Have you seen our tutorials?
>>>
>>> http://www.rabbitmq.com/getstarted.html
>>>
>>> Exchanges are described in second tutorial
>>>
>>>
>>> Cheers,
>>>   Marek
>>>
>>> On Fri, Nov 26, 2010 at 13:42, Fernando Rodrigo Chagas Dourado
>>> <fdourado at bancofator.com.br> wrote:
>>>> Guys,
>>>>
>>>>
>>>>
>>>> What's the main diference between exchanges and queues?
>>>>
>>>>
>>>>
>>>> I can't find on documentation.
>>>>
>>>>
>>>>
>>>> Tks,
>>>>
>>>>
>>>>
>>>> Fernando Dourado
>>>
>>>
>>> Pontos de vista e opini?es inclusos nesta mensagem s?o de respon 
>>> sabilidade do remetente a menos que claramente mencionado como o 
>>> riginados pelas Empresas do Conglomerado Fator. Comunica??es pel 
>>> a internet n?o podem ser garantidas quanto ? sua seguran?a ou in 
>>> exist?ncia de erros e v?rus. As empresas controladas pelo Banco  
>>> Fator, por esta raz?o, n?o assumem responsabilidade por qualquer 
>>>  erro ou omiss?o no contexto da mensagem, decorrente da transmis 
>>> s?o via internet. Essa mensagem pode conter informa??o confidenc 
>>> ial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a rec 
>>> eber esta mensagem, n?o poder? usar, copiar ou divulgar as infor 
>>> ma??es nela contidas ou tomar qualquer a??o baseada nessas infor 
>>> ma??es. Se voc? recebeu esta mensagem por engano, por favor, avi 
>>> se imediatamente o remetente, respondendo este e-mail e em segui 
>>> da apagando-o. Agradecemos a sua coopera??o.
>>> SAC: 0800 770 7229 ou sac at bancofator.com.br
>>> Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)
>>>                 email : ouvidoria at bancofator.com.br
>>>                 carta:   Rua Dr. Renato Paes de Barros, 1017,  
>>> 12o.andar - Itaim Bibi - S?o Paulo - SP - 04530-001.
>>>
>>> Points of view and opinions herein expressed are the  
>>> responsibility of sender unless clearly stated otherwise as having  
>>> been originated in companies of the Fator Conglomerate.  
>>> Communications via the Internet cannot be guaranteed with regards  
>>> to safety or the absence of errors and viruses. For this reason,  
>>> Banco Fator-controlled companies shall not assume responsibility  
>>> for errors or omissions in the context of a transmission via the  
>>> Internet. This e-mail may be confidential. If you are not the  
>>> intended recipient or the authorized person to receive this  
>>> message, you may not use, copy or publicize information therein  
>>> contained or take any action based on such information. If you are  
>>> not the intended addressee, please advise sender immediately by  
>>> replying to this e-mail and delete if obtained in error. We  
>>> appreciate your cooperation.
>>> Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator
>>> Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)
>>>              or by email: ouvidoria at bancofator.com.br
>>>              or by letter: Rua Dr. Renato Paes de Barros, 1017,  
>>> 12o. andar - Itaim Bibi - S?o Paulo - SP - 04530-001 .
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabi 
> lidade do remetente a menos que claramente mencionado como originado 
> s pelas Empresas do Conglomerado Fator. Comunica??es pela internet n 
> ?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de  
> erros e v?rus. As empresas controladas pelo Banco Fator, por esta ra 
> z?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no  
> contexto da mensagem, decorrente da transmiss?o via internet. Essa m 
> ensagem pode conter informa??o confidencial. Se voc? n?o for o  
> destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o pod 
> er? usar, copiar ou divulgar as informa??es nela contidas ou tomar  
> qualquer a??o baseada nessas informa??es. Se voc? recebeu esta  
> mensagem por engano, por favor, avise imediatamente o remetente, res 
> pondendo este e-mail e em seguida apagando-o. Agradecemos a sua coop 
> era??o.
> SAC: 0800 770 7229 ou sac at bancofator.com.br
> Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)
>                 email : ouvidoria at bancofator.com.br
>                 carta:   Rua Dr. Renato Paes de Barros, 1017,  
> 12o.andar  Itaim Bibi - S?o Paulo  SP  04530-001.
>
> Points of view and opinions herein expressed are the responsibility  
> of sender unless clearly stated otherwise as having been originated  
> in companies of the Fator Conglomerate. Communications via the  
> Internet cannot be guaranteed with regards to safety or the absence  
> of errors and viruses. For this reason, Banco Fator-controlled  
> companies shall not assume responsibility for errors or omissions in  
> the context of a transmission via the Internet. This e-mail may be  
> confidential. If you are not the intended recipient or the  
> authorized person to receive this message, you may not use, copy or  
> publicize information therein contained or take any action based on  
> such information. If you are not the intended addressee, please  
> advise sender immediately by replying to this e-mail and delete if  
> obtained in error. We appreciate your cooperation.
> Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator
> Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)
>              or by email: ouvidoria at bancofator.com.br
>              or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o.  
> andar  Itaim Bibi - S?o Paulo  SP  04530-001 .
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From therevoltingx at gmail.com  Fri Nov 26 23:59:39 2010
From: therevoltingx at gmail.com (Miguel Morales)
Date: Fri, 26 Nov 2010 15:59:39 -0800
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTi=XCypEYr-PkSeB2z2=9DxLeuxncCXyK2qQkppX@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
	<AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
	<20101126163309.GG1917@wellquite.org>
	<AANLkTimB3DOW=-1c_emewsT5xQR+ddH6CRc9ifhMPCYE@mail.gmail.com>
	<20101126165150.GJ1917@wellquite.org>
	<AANLkTinFNobBXieQhXjSLS8b_UJF__qtg2=wm7u-y3Sw@mail.gmail.com>
	<20101126171517.GM1917@wellquite.org>
	<AANLkTi=XCypEYr-PkSeB2z2=9DxLeuxncCXyK2qQkppX@mail.gmail.com>
Message-ID: <AANLkTinYWtuwUUWQ8neAaBHOmvVa1svijojSJnOHAHDW@mail.gmail.com>

Hello Robert,

Although I haven't done comprehensive tests, I have noticed that a lot
of the time the memory is simply cached by the OS.
Try running free and checking the cache value, it might or might not help.


On Fri, Nov 26, 2010 at 12:34 PM, Robert Fuller <fullergalway at gmail.com> wrote:
> Thanks Mathew for the guidance.
>
> My conclusion at this point is that the memory issues we experienced
> are a consequence of the way we are (mis)using rabbitmq. I will adjust
> implementation of our consumer to take into consideration your
> comments in this thread.
>
> Thanks again,
> Rob.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://developingthedream.blogspot.com/,
http://www.youtube.com/user/revoltingx

From pdezwart at rubiconproject.com  Sat Nov 27 09:10:10 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Sat, 27 Nov 2010 01:10:10 -0800
Subject: [rabbitmq-discuss] DQOTD: Is publishing to an undeclared exchange
	ok?
Message-ID: <C9160AF2.13738%pdezwart@rubiconproject.com>

Hey guys,

My Dumb Question Of The Day (registered) is: What is the expected behavior
when publishing to an exchange that has not been previously declared? It
seems that if I do that using the C client, the message disappears into the
void without so much as a peep.
The only reason I ask is that I wan the PHP client to behave in the most
appropriate manner, matching that of the client and broker.

Thanks for not flaming,
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101127/541618ee/attachment.htm>

From matthew at rabbitmq.com  Sat Nov 27 10:05:17 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 27 Nov 2010 10:05:17 +0000
Subject: [rabbitmq-discuss] DQOTD: Is publishing to an undeclared
 exchange ok?
In-Reply-To: <C9160AF2.13738%pdezwart@rubiconproject.com>
References: <C9160AF2.13738%pdezwart@rubiconproject.com>
Message-ID: <20101127100516.GA2722@rabbitmq.com>

On Sat, Nov 27, 2010 at 01:10:10AM -0800, Pieter de Zwart wrote:
> My Dumb Question Of The Day (registered) is: What is the expected behavior
> when publishing to an exchange that has not been previously declared? It
> seems that if I do that using the C client, the message disappears into the
> void without so much as a peep.

It's a channel-level error to publish a message to a non existant
exchange. You should get back a 404 exit reason with the channel being
closed.

Matthew

From david at rabbitmq.com  Sun Nov 28 06:25:13 2010
From: david at rabbitmq.com (David Wragg)
Date: Sun, 28 Nov 2010 06:25:13 +0000
Subject: [rabbitmq-discuss] DQOTD: Is publishing to an undeclared
	exchange ok?
In-Reply-To: <C9160AF2.13738%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Sat, 27 Nov 2010 01:10:10 -0800")
References: <C9160AF2.13738%pdezwart@rubiconproject.com>
Message-ID: <yrv4ck4jyufqu.fsf@dwragg.eng.vmware.com>

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> My Dumb Question Of The Day (registered) is: What is the expected behavior
> when publishing to an exchange that has not been previously declared? It
> seems that if I do that using the C client, the message disappears into the
> void without so much as a peep.

Publishing a message in AMQP is a fully asynchronous operation: The
client sends a basic.publish method to the server, and does not wait for
any kind of reply.  So there is no way for the amqp_basic_publish
function to return an error in this case.

But, the next synchronous operation you do on the channel should return
the error.

For example, with the amqp-publish utility in the rabbitmq-c tools
directory, if you do:

  $ tools/amqp-publish -e nosuch -b "hello"

It responds with the error:

  closing channel: server channel error 404, message: NOT_FOUND - no
  exchange 'nosuch' in vhost '/'

As the prefix to this error suggests, the error is being reported from
amqp_channel_close, because in publish.c, that is the synchronous
operation following the amqp_basic_publish call.

> The only reason I ask is that I wan the PHP client to behave in the most
> appropriate manner, matching that of the client and broker.

Currently, if you want to get localize errors to particular
amqp_basic_publish calls, you'll need to follow each one with a
synchronous operation to collect the error.  Opening and closing a
channel around each publish is perhaps the most obvious way to do this.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From frank.goenninger at consequor.de  Sun Nov 28 13:42:44 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Sun, 28 Nov 2010 14:42:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No rule
 to make target deps.mk ?!
Message-ID: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>

Hi all:

I am trying to build 2.1.1 from sources. I am using GNU make version 3.81. Still I am getting a "no rule to make target deps.mk" error. I checked the Makefile and it clearly has such a rule. Hmm - anybody seen this before? Any ideas ? TIA!

Best regards

  Frank
 
--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From matthew at rabbitmq.com  Sun Nov 28 13:49:56 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 28 Nov 2010 13:49:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
Message-ID: <20101128134955.GA12093@wellquite.org>

On Sun, Nov 28, 2010 at 02:42:44PM +0100, Frank G?nninger wrote:
> I am trying to build 2.1.1 from sources. I am using GNU make version 3.81. Still I am getting a "no rule to make target deps.mk" error. I checked the Makefile and it clearly has such a rule. Hmm - anybody seen this before? Any ideas ? TIA!

Can you just confirm you have codegen and server directories as siblings
within the public-umbrella repo?

Matthew

From frank.goenninger at consequor.de  Sun Nov 28 13:55:19 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Sun, 28 Nov 2010 14:55:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <20101128134955.GA12093@wellquite.org>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
Message-ID: <FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>

Hi Matthew,

Am 28.11.2010 um 14:49 schrieb Matthew Sackman:

> On Sun, Nov 28, 2010 at 02:42:44PM +0100, Frank G?nninger wrote:
>> I am trying to build 2.1.1 from sources. I am using GNU make version 3.81. Still I am getting a "no rule to make target deps.mk" error. I checked the Makefile and it clearly has such a rule. Hmm - anybody seen this before? Any ideas ? TIA!
> 
> Can you just confirm you have codegen and server directories as siblings
> within the public-umbrella repo?

$ cd rabbitmq-server-2.1.1/
frgo at ccde007 /opt/rabbitmq/src/rabbitmq-server-2.1.1
$ ll
total 208
-rw-r--r--@  1 frgo  staff  23936 19 Okt 18:23 INSTALL
-rw-r--r--@  1 frgo  staff    195 19 Okt 18:23 LICENSE
-rw-r--r--@  1 frgo  staff  25561 19 Okt 18:23 LICENSE-MPL-RabbitMQ
-rw-r--r--@  1 frgo  staff  11200 28 Nov 14:32 Makefile
-rw-r--r--@  1 frgo  staff   3180 19 Okt 18:23 README
-rwxr-xr-x@  1 frgo  staff   1719 19 Okt 18:23 calculate-relative
drwxr-xr-x@ 10 frgo  staff    340 19 Okt 18:23 codegen
-rw-r--r--@  1 frgo  staff  19919 19 Okt 18:23 codegen.py
drwxr-xr-x@ 11 frgo  staff    374 19 Okt 18:23 docs
drwxr-xr-x@  3 frgo  staff    102 19 Okt 18:23 ebin
-rw-r--r--@  1 frgo  staff    494 19 Okt 18:23 generate_app
-rw-r--r--@  1 frgo  staff   2343 19 Okt 18:23 generate_deps
drwxr-xr-x@  7 frgo  staff    238 19 Okt 18:23 include
drwxr-xr-x@ 10 frgo  staff    340 19 Okt 18:23 scripts
drwxr-xr-x@ 81 frgo  staff   2754 19 Okt 18:23 src

... that's what I'm seeing. If that?s the "public-umbrella repo" I don't know.

Cheers
  Frank

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From matthew at rabbitmq.com  Sun Nov 28 14:12:04 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 28 Nov 2010 14:12:04 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
Message-ID: <20101128141204.GB12093@wellquite.org>

Hi Frank,

On Sun, Nov 28, 2010 at 02:55:19PM +0100, Frank G?nninger wrote:
> Am 28.11.2010 um 14:49 schrieb Matthew Sackman:
> 
> > On Sun, Nov 28, 2010 at 02:42:44PM +0100, Frank G?nninger wrote:
> >> I am trying to build 2.1.1 from sources. I am using GNU make version 3.81. Still I am getting a "no rule to make target deps.mk" error. I checked the Makefile and it clearly has such a rule. Hmm - anybody seen this before? Any ideas ? TIA!
> > 
> > Can you just confirm you have codegen and server directories as siblings
> > within the public-umbrella repo?
> 
> $ cd rabbitmq-server-2.1.1/
> ... that's what I'm seeing. If that?s the "public-umbrella repo" I don't know.


Agh, my mistake, sorry - I'd failed to remember how our source releases
work. However, when I download
http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server-2.1.1.tar.gz
and unpack, and issue make in there, I get:

$ make
python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
xsltproc --stringparam modulename "`basename src/rabbit_ctl_usage.erl .erl`" \
                docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp
sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_ctl_usage.erl.tmp > src/rabbit_ctl_usage.erl.tmp2
fold -s src/rabbit_ctl_usage.erl.tmp2 > src/rabbit_ctl_usage.erl.tmp3
mv src/rabbit_ctl_usage.erl.tmp3 src/rabbit_ctl_usage.erl
rm src/rabbit_ctl_usage.erl.tmp src/rabbit_ctl_usage.erl.tmp2
xsltproc --stringparam modulename "`basename src/rabbit_multi_usage.erl .erl`" \
                docs/usage.xsl docs/rabbitmq-multi.1.xml > src/rabbit_multi_usage.erl.tmp
sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_multi_usage.erl.tmp > src/rabbit_multi_usage.erl.tmp2
fold -s src/rabbit_multi_usage.erl.tmp2 > src/rabbit_multi_usage.erl.tmp3
mv src/rabbit_multi_usage.erl.tmp3 src/rabbit_multi_usage.erl
rm src/rabbit_multi_usage.erl.tmp src/rabbit_multi_usage.erl.tmp2
python codegen.py --ignore-conflicts header codegen/amqp-rabbitmq-0.9.1.json codegen/amqp-rabbitmq-0.8.json include/rabbit_framing.hrl
rm -f deps.mk
escript generate_deps include src \$\(EBIN_DIR\) deps.mk
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/bpqueue.erl
...

What output do you get?

Matthew

From stan.mcqueen at gmail.com  Sun Nov 28 14:30:06 2010
From: stan.mcqueen at gmail.com (Stan McQueen)
Date: Sun, 28 Nov 2010 07:30:06 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
Message-ID: <AANLkTimhOROPsRTnzVeih2XnAvYGUs4K0VuFjW1f0q8v@mail.gmail.com>

I wonder if this is the same issue I had a week or so ago when it was
discovered that the rabbitmq-server repo was not being transferred correctly
between the mercurial repo and the git repo? Apparently the repo problem is
hidden as a warning instead of being exposed as an error. Try checking out
the rabbitmq-public-umbrella instead of the rabbitmq-server and see if the
problem goes away. It did for me.

Stan

On Sun, Nov 28, 2010 at 6:42 AM, Frank G?nninger <
frank.goenninger at consequor.de> wrote:

> Hi all:
>
> I am trying to build 2.1.1 from sources. I am using GNU make version 3.81.
> Still I am getting a "no rule to make target deps.mk" error. I checked the
> Makefile and it clearly has such a rule. Hmm - anybody seen this before? Any
> ideas ? TIA!
>
> Best regards
>
>  Frank
>
> --
>  C o n s e q u o r   C o n s u l t i n g   A G
>  Frank Goenninger
>
>  E-Mail: frank.goenninger at consequor.de
>  Phone: +49 711 781 181-10
>  Fax:   +49 711 781 181-11
>
>  Consequor Consulting AG
>  Liebknechstr. 33
>  D-70565 Stuttgart
>
>  Vorstand: Frank G?nninger (Vors.), Martin Melcher
>  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
>  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
>  Registergericht Amtsgericht Stuttgart HRB 727446
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101128/99cc2747/attachment.htm>

From frank.goenninger at consequor.de  Sun Nov 28 14:31:40 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Sun, 28 Nov 2010 15:31:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <20101128141204.GB12093@wellquite.org>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
	<20101128141204.GB12093@wellquite.org>
Message-ID: <8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>

Hi Matthew, 

Am 28.11.2010 um 15:12 schrieb Matthew Sackman:

> Hi Frank,
> 
> On Sun, Nov 28, 2010 at 02:55:19PM +0100, Frank G?nninger wrote:
>> Am 28.11.2010 um 14:49 schrieb Matthew Sackman:
>> 
>>> On Sun, Nov 28, 2010 at 02:42:44PM +0100, Frank G?nninger wrote:
>>>> I am trying to build 2.1.1 from sources. I am using GNU make version 3.81. Still I am getting a "no rule to make target deps.mk" error. I checked the Makefile and it clearly has such a rule. Hmm - anybody seen this before? Any ideas ? TIA!
>>> 
>>> Can you just confirm you have codegen and server directories as siblings
>>> within the public-umbrella repo?
>> 
>> $ cd rabbitmq-server-2.1.1/
>> ... that's what I'm seeing. If that?s the "public-umbrella repo" I don't know.
> 
> 
> Agh, my mistake, sorry - I'd failed to remember how our source releases
> work. However, when I download
> http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server-2.1.1.tar.gz
> and unpack, and issue make in there, I get:
> 
> $ make
> python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
> python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
> xsltproc --stringparam modulename "`basename src/rabbit_ctl_usage.erl .erl`" \
>                docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp
> sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_ctl_usage.erl.tmp > src/rabbit_ctl_usage.erl.tmp2
> fold -s src/rabbit_ctl_usage.erl.tmp2 > src/rabbit_ctl_usage.erl.tmp3
> mv src/rabbit_ctl_usage.erl.tmp3 src/rabbit_ctl_usage.erl
> rm src/rabbit_ctl_usage.erl.tmp src/rabbit_ctl_usage.erl.tmp2
> xsltproc --stringparam modulename "`basename src/rabbit_multi_usage.erl .erl`" \
>                docs/usage.xsl docs/rabbitmq-multi.1.xml > src/rabbit_multi_usage.erl.tmp
> sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_multi_usage.erl.tmp > src/rabbit_multi_usage.erl.tmp2
> fold -s src/rabbit_multi_usage.erl.tmp2 > src/rabbit_multi_usage.erl.tmp3
> mv src/rabbit_multi_usage.erl.tmp3 src/rabbit_multi_usage.erl
> rm src/rabbit_multi_usage.erl.tmp src/rabbit_multi_usage.erl.tmp2
> python codegen.py --ignore-conflicts header codegen/amqp-rabbitmq-0.9.1.json codegen/amqp-rabbitmq-0.8.json include/rabbit_framing.hrl
> rm -f deps.mk
> escript generate_deps include src \$\(EBIN_DIR\) deps.mk
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/bpqueue.erl
> ...
> 
> What output do you get?

After downloading and unpacking I get:

$ cd rabbitmq-server-2.1.1
frgo at ccde007 /opt/rabbitmq/src/rabbitmq-server-2.1.1
$ ll
total 208
-rw-r--r--@  1 frgo  admin  23936 19 Okt 18:23 INSTALL
-rw-r--r--@  1 frgo  admin    195 19 Okt 18:23 LICENSE
-rw-r--r--@  1 frgo  admin  25561 19 Okt 18:23 LICENSE-MPL-RabbitMQ
-rw-r--r--@  1 frgo  admin  11200 19 Okt 18:23 Makefile
-rw-r--r--@  1 frgo  admin   3180 19 Okt 18:23 README
-rwxr-xr-x@  1 frgo  admin   1719 19 Okt 18:23 calculate-relative
drwxr-xr-x@ 10 frgo  admin    340 19 Okt 18:23 codegen
-rw-r--r--@  1 frgo  admin  19919 19 Okt 18:23 codegen.py
drwxr-xr-x@ 11 frgo  admin    374 19 Okt 18:23 docs
drwxr-xr-x@  3 frgo  admin    102 19 Okt 18:23 ebin
-rw-r--r--@  1 frgo  admin    494 19 Okt 18:23 generate_app
-rw-r--r--@  1 frgo  admin   2343 19 Okt 18:23 generate_deps
drwxr-xr-x@  7 frgo  admin    238 19 Okt 18:23 include
drwxr-xr-x@ 10 frgo  admin    340 19 Okt 18:23 scripts
drwxr-xr-x@ 81 frgo  admin   2754 19 Okt 18:23 src
frgo at ccde007 /opt/rabbitmq/src/rabbitmq-server-2.1.1
$ make
make: *** No rule to make target `deps.mk', needed by `ebin/bpqueue.beam'.  Stop.

So, no call to codegen.

Python version:

$ python --version
Python 2.6.1

Erlang:

$ erl
Erlang R14B (erts-5.8.1) [source] [smp:4:4] [rq:4] [async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.8.1  (abort with ^G)
1> 

I did succeed in earlier versions (1.8.x) of RabbitMQ ... 

Thanks for your suppport!!!

Cheers
  Frank


From matthew at rabbitmq.com  Sun Nov 28 14:32:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 28 Nov 2010 14:32:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ clustering
In-Reply-To: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
References: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
Message-ID: <20101128143218.GC12093@wellquite.org>

On Wed, Nov 24, 2010 at 06:05:52PM +0530, Kshitiz Garg wrote:
> Can someone present a pictorial representation of 4-5 Rabbit MQ nodes with
> Clustering and HA (it can also go on the RabbitMQ site). I wanted to know
> about a RabbitMQ setup which is able to handle millions of messages.

Can you elaborate on "millions of messages"? A single Rabbit node can do
about 2 bn msgs/day under certain conditions. What is the nature of your
requirements for HA - are you writing every message to disk and thus
need Rabbit to guarantee that messages are not lost even in the event of
failure, or are the messages more transient but you require HA in terms
of availability of Rabbit/AMQP service?

Matthew

From frank.goenninger at consequor.de  Sun Nov 28 14:33:15 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Sun, 28 Nov 2010 15:33:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <AANLkTimhOROPsRTnzVeih2XnAvYGUs4K0VuFjW1f0q8v@mail.gmail.com>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<AANLkTimhOROPsRTnzVeih2XnAvYGUs4K0VuFjW1f0q8v@mail.gmail.com>
Message-ID: <F7E9055B-762A-4FD9-B6D8-C03D25FDC5FF@consequor.de>

Hi Stan,

Am 28.11.2010 um 15:30 schrieb Stan McQueen:

> I wonder if this is the same issue I had a week or so ago when it was discovered that the rabbitmq-server repo was not being transferred  correctly between the mercurial repo and the git repo? Apparently the repo problem is hidden as a warning instead of being exposed as an error. Try checking out the rabbitmq-public-umbrella instead of the rabbitmq-server and see if the problem goes away. It did for me.

Hm - I did not use Git to DL this. I just simply clicked on the DL link on the server download page. Thanks for pointing out, though - I will try !

Cheers
  Frank

> 
> Stan
> 
> On Sun, Nov 28, 2010 at 6:42 AM, Frank G?nninger <frank.goenninger at consequor.de> wrote:
> Hi all:
> 
> I am trying to build 2.1.1 from sources. I am using GNU make version 3.81. Still I am getting a "no rule to make target deps.mk" error. I checked the Makefile and it clearly has such a rule. Hmm - anybody seen this before? Any ideas ? TIA!
> 
> Best regards
> 
>  Frank
> 
> --
>  C o n s e q u o r   C o n s u l t i n g   A G
>  Frank Goenninger
> 
>  E-Mail: frank.goenninger at consequor.de
>  Phone: +49 711 781 181-10
>  Fax:   +49 711 781 181-11
> 
>  Consequor Consulting AG
>  Liebknechstr. 33
>  D-70565 Stuttgart
> 
>  Vorstand: Frank G?nninger (Vors.), Martin Melcher
>  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
>  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
>  Registergericht Amtsgericht Stuttgart HRB 727446
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> <ATT00001..txt>

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From matthew at rabbitmq.com  Sun Nov 28 14:33:28 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 28 Nov 2010 14:33:28 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <AANLkTimhOROPsRTnzVeih2XnAvYGUs4K0VuFjW1f0q8v@mail.gmail.com>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<AANLkTimhOROPsRTnzVeih2XnAvYGUs4K0VuFjW1f0q8v@mail.gmail.com>
Message-ID: <20101128143327.GD12093@wellquite.org>

On Sun, Nov 28, 2010 at 07:30:06AM -0700, Stan McQueen wrote:
> I wonder if this is the same issue I had a week or so ago when it was
> discovered that the rabbitmq-server repo was not being transferred correctly
> between the mercurial repo and the git repo? Apparently the repo problem is
> hidden as a warning instead of being exposed as an error. Try checking out
> the rabbitmq-public-umbrella instead of the rabbitmq-server and see if the
> problem goes away. It did for me.

I'm pretty sure Frank is building from our 2.1.1 source tarball, not
from our mercurial repos. (Though I certainly realised this a bit late
;)

Matthew

From matthew at rabbitmq.com  Sun Nov 28 14:34:55 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 28 Nov 2010 14:34:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
	<20101128141204.GB12093@wellquite.org>
	<8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>
Message-ID: <20101128143455.GE12093@wellquite.org>

On Sun, Nov 28, 2010 at 03:31:40PM +0100, Frank G?nninger wrote:
> $ make
> make: *** No rule to make target `deps.mk', needed by `ebin/bpqueue.beam'.  Stop.
> 
> So, no call to codegen.

That is mysterious indeed. What happens if you type

make src/rabbit_framing_amqp_0_9_1.erl

?

Matthew

From frank.goenninger at consequor.de  Sun Nov 28 14:52:51 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Sun, 28 Nov 2010 15:52:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <20101128143455.GE12093@wellquite.org>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
	<20101128141204.GB12093@wellquite.org>
	<8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>
	<20101128143455.GE12093@wellquite.org>
Message-ID: <7D1AF250-AEB4-485F-A07D-264962E5B678@consequor.de>

Am 28.11.2010 um 15:34 schrieb Matthew Sackman:

> On Sun, Nov 28, 2010 at 03:31:40PM +0100, Frank G?nninger wrote:
>> $ make
>> make: *** No rule to make target `deps.mk', needed by `ebin/bpqueue.beam'.  Stop.
>> 
>> So, no call to codegen.
> 
> That is mysterious indeed. What happens if you type
> 
> make src/rabbit_framing_amqp_0_9_1.erl
> 
> ?

This does not produce any error but also does not produce any result either. Meanwhile I cloned the source via hg and, SUCCESS - the hg cloned source compiled as expected !

I then did a diff on the Makefiles from hg depot and the source tarball:

96c95
< 	echo $(subst : ,:,$(foreach FILE,$^,$(FILE):)) | escript generate_deps $@ $(EBIN_DIR)
---
> 	escript generate_deps $(INCLUDE_DIR) $(SOURCE_DIR) \$$\(EBIN_DIR\) $@

That's the relevant change that makes it work ... I did not change anything in the hg depot so it's maybe an idea to update the source tarball.

Thanks to Stan for giving the heads-up and for your support, Matthew!!

Frank


From matt at mydomedia.com  Sun Nov 28 15:02:33 2010
From: matt at mydomedia.com (Matt Miller)
Date: Sun, 28 Nov 2010 10:02:33 -0500 (EST)
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-ldap compiling.
In-Reply-To: <442003775.83.1290956311397.JavaMail.root@zimbra>
Message-ID: <1917490087.87.1290956553154.JavaMail.root@zimbra>

Greetings,

Has anyone compiled the rabbitmq-auth-backend-ldap plugin? I'm wondering if the plugin is too new for me to check it out. I have downloaded the public umbrella and have compiled other plugins, i.e. stomp. But this one is giving me the following error:

matt:rabbitmq-public-umbrella matt$ cd rabbitmq-auth-backend-ldap/
matt:rabbitmq-auth-backend-ldap matt$ make
ERL_LIBS=build/deps:deps erlc -I include -o ebin -Wall +debug_info -pa ebin src/rabbit_auth_backend_ldap.erl
src/rabbit_auth_backend_ldap.erl:40: can't find include lib "rabbit_common/include/rabbit_auth_backend_spec.hrl"
src/rabbit_auth_backend_ldap.erl:123: field impl undefined in record user
src/rabbit_auth_backend_ldap.erl:124: variable 'P' is unbound
src/rabbit_auth_backend_ldap.erl:124: variable 'U' is unbound
src/rabbit_auth_backend_ldap.erl:188: field auth_backend undefined in record user
src/rabbit_auth_backend_ldap.erl:189: field impl undefined in record user
src/rabbit_auth_backend_ldap.erl:39: Warning: behaviour rabbit_auth_backend undefined
make: *** [ebin/rabbit_auth_backend_ldap.beam] Error 1
matt:rabbitmq-auth-backend-ldap matt$ 



I noticed mention of bug23455 (http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/cadbb093f812/README), and I was not sure wether to patch my umbrella or how to proceed. 

TIA, 
Matt

 

From matthias at rabbitmq.com  Sun Nov 28 15:09:36 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 28 Nov 2010 15:09:36 +0000
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-ldap compiling.
In-Reply-To: <1917490087.87.1290956553154.JavaMail.root@zimbra>
References: <1917490087.87.1290956553154.JavaMail.root@zimbra>
Message-ID: <4CF270B0.50109@rabbitmq.com>

Matt,

Matt Miller wrote:
> Has anyone compiled the rabbitmq-auth-backend-ldap plugin? I'm
> wondering if the plugin is too new for me to check it out.

That plug-in is still under development. If a plug-in isn't listed at 
http://www.rabbitmq.com/plugins.html then chances are that getting it to 
build, let alone work, is anything but straightforward.


Regards,

Matthias.

From simon at rabbitmq.com  Sun Nov 28 15:35:43 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sun, 28 Nov 2010 15:35:43 +0000
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-ldap compiling.
In-Reply-To: <1917490087.87.1290956553154.JavaMail.root@zimbra>
References: <1917490087.87.1290956553154.JavaMail.root@zimbra>
Message-ID: <4CF276CF.401@rabbitmq.com>

On 28/11/2010 3:02PM, Matt Miller wrote:
> Has anyone compiled the rabbitmq-auth-backend-ldap plugin? I'm
> wondering if the plugin is too new for me to check it out.

It's pretty new, and very raw. It also depends on changes to the server 
that have not even started to go through our QA process - which is why I 
haven't started making a fuss about it on this list yet :)

So if you're feeling *very* brave "hg update bug23455" in 
rabbitmq-server and rabbitmq-erlang-client, then make clean everywhere, 
then build the server, then the erlang client, then the auth plugin. If 
you want the management plugin, that also needs the repository 
"rabbitmq-management-agent", both on bug23455 as well.

ATM it does a credible job of authentication (i.e. login), but 
authorisation (i.e. permissions) is very half done. And the 
documentation is pretty rough. And it chews through LDAP connections 
like water. But apart from that...

I'd be interested to hear from you (and anyone else) how you'd want to 
do authorisation under LDAP, since at the moment I'm still working out 
the best way to generally map AMQPish concepts into the LDAP world. ATM 
only users really live in LDAP, putting AMQP objects in LDAP isn't 
really feasible, so the mapping needs to be defined by the sysadmin 
somewhat.

(Oh, and I'm not working on this for at least the next week, another 
Secret Project is taking my time...)

Cheers, Simon

From matthew at rabbitmq.com  Sun Nov 28 15:52:55 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 28 Nov 2010 15:52:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <7D1AF250-AEB4-485F-A07D-264962E5B678@consequor.de>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
	<20101128141204.GB12093@wellquite.org>
	<8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>
	<20101128143455.GE12093@wellquite.org>
	<7D1AF250-AEB4-485F-A07D-264962E5B678@consequor.de>
Message-ID: <20101128155254.GF12093@wellquite.org>

Hi Frank,

On Sun, Nov 28, 2010 at 03:52:51PM +0100, Frank G?nninger wrote:
> This does not produce any error but also does not produce any result either. Meanwhile I cloned the source via hg and, SUCCESS - the hg cloned source compiled as expected !
> 
> I then did a diff on the Makefiles from hg depot and the source tarball:
> 
> 96c95
> < 	echo $(subst : ,:,$(foreach FILE,$^,$(FILE):)) | escript generate_deps $@ $(EBIN_DIR)
> ---
> > 	escript generate_deps $(INCLUDE_DIR) $(SOURCE_DIR) \$$\(EBIN_DIR\) $@
> 
> That's the relevant change that makes it work ... I did not change anything in the hg depot so it's maybe an idea to update the source tarball.

No, something's wrong there - that change is not relevant - or at least
shouldn't be.

If you:
wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server-2.1.1.tar.gz
tar xzf rabbitmq-server-2.1.1.tar.gz
cd rabbitmq-server-2.1.1
make

it does just work. At least for me.

If you're building from our hg or git mirrors, then that's something
very different, and generally building from the latest head of default
is the right thing to do.

Matthew

From matt at mydomedia.com  Sun Nov 28 15:52:53 2010
From: matt at mydomedia.com (Matt Miller)
Date: Sun, 28 Nov 2010 10:52:53 -0500 (EST)
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-ldap compiling.
In-Reply-To: <4CF276CF.401@rabbitmq.com>
Message-ID: <574013489.97.1290959573340.JavaMail.root@zimbra>

Simon, 

My only requirement is to authorize incoming stomp connections to the rabbitmq-stomp server via username, password. I will take a look by merging the bug23455.. 

I am available to test this and provide feedback if there is a need. I have some friends that are adept Erlang developers to help me. I will try to get them involved, no promises. 

Thank you Matthias and Simon. 

Cheers,
Matt

----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, November 28, 2010 10:35:43 AM
Subject: Re: [rabbitmq-discuss] rabbitmq-auth-backend-ldap compiling.

On 28/11/2010 3:02PM, Matt Miller wrote:
> Has anyone compiled the rabbitmq-auth-backend-ldap plugin? I'm
> wondering if the plugin is too new for me to check it out.

It's pretty new, and very raw. It also depends on changes to the server 
that have not even started to go through our QA process - which is why I 
haven't started making a fuss about it on this list yet :)

So if you're feeling *very* brave "hg update bug23455" in 
rabbitmq-server and rabbitmq-erlang-client, then make clean everywhere, 
then build the server, then the erlang client, then the auth plugin. If 
you want the management plugin, that also needs the repository 
"rabbitmq-management-agent", both on bug23455 as well.

ATM it does a credible job of authentication (i.e. login), but 
authorisation (i.e. permissions) is very half done. And the 
documentation is pretty rough. And it chews through LDAP connections 
like water. But apart from that...

I'd be interested to hear from you (and anyone else) how you'd want to 
do authorisation under LDAP, since at the moment I'm still working out 
the best way to generally map AMQPish concepts into the LDAP world. ATM 
only users really live in LDAP, putting AMQP objects in LDAP isn't 
really feasible, so the mapping needs to be defined by the sysadmin 
somewhat.

(Oh, and I'm not working on this for at least the next week, another 
Secret Project is taking my time...)

Cheers, Simon
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Sun Nov 28 16:01:30 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sun, 28 Nov 2010 16:01:30 +0000
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-ldap compiling.
In-Reply-To: <574013489.97.1290959573340.JavaMail.root@zimbra>
References: <574013489.97.1290959573340.JavaMail.root@zimbra>
Message-ID: <4CF27CDA.4060000@rabbitmq.com>

On 28/11/2010 3:52PM, Matt Miller wrote:
> My only requirement is to authorize incoming stomp connections to the
> rabbitmq-stomp server via username, password. I will take a look by
> merging the bug23455..

Good luck. I haven't tested against the stomp plugin at all, but I 
*think* it should work.

> I am available to test this and provide feedback if there is a need.
> I have some friends that are adept Erlang developers to help me. I
> will try to get them involved, no promises.

Cool. Feedback is always appreciated.

Cheers, Simon

From frank.goenninger at consequor.de  Sun Nov 28 16:29:44 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Sun, 28 Nov 2010 17:29:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <20101128155254.GF12093@wellquite.org>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
	<20101128141204.GB12093@wellquite.org>
	<8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>
	<20101128143455.GE12093@wellquite.org>
	<7D1AF250-AEB4-485F-A07D-264962E5B678@consequor.de>
	<20101128155254.GF12093@wellquite.org>
Message-ID: <9BDFF1B6-36E5-4A19-A173-075E37BEBE2E@consequor.de>


Am 28.11.2010 um 16:52 schrieb Matthew Sackman:

> On Sun, Nov 28, 2010 at 03:52:51PM +0100, Frank G?nninger wrote:

>> 96c95
>> < 	echo $(subst : ,:,$(foreach FILE,$^,$(FILE):)) | escript generate_deps $@ $(EBIN_DIR)
>> ---
>>> 	escript generate_deps $(INCLUDE_DIR) $(SOURCE_DIR) \$$\(EBIN_DIR\) $@
>> 
>> That's the relevant change that makes it work ... I did not change anything in the hg depot so it's maybe an idea to update the source tarball.
> 
> No, something's wrong there - that change is not relevant - or at least
> shouldn't be.
> 
> If you:
> wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server-2.1.1.tar.gz
> tar xzf rabbitmq-server-2.1.1.tar.gz
> cd rabbitmq-server-2.1.1
> make


That doesn't work on OS X 10.6.5 (darwin 10.5.0) with GNU make 3.81. It's not clear to me at all what is the difference between the two environments (hg and source tarball).

Nevertheless: I am up and running with 2.1.1 - so I'm happy ;-)

Best wishes

  Frank


From aquino.gustavo at gmail.com  Sun Nov 28 16:31:07 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 28 Nov 2010 14:31:07 -0200
Subject: [rabbitmq-discuss] RabbitMQ clustering
In-Reply-To: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
References: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
Message-ID: <AANLkTi=STEeUigLbDiowk=GKpoxdt_9w56uA6NP4fRz9@mail.gmail.com>

Hi Garg,

Could you give to us more details about what you need? eg.  it's messages
throughput is per second? and etc.

Regards.




On Wed, Nov 24, 2010 at 10:35 AM, Kshitiz Garg <stephanion2002 at gmail.com>wrote:

> Hi,
>
> Can someone present a pictorial representation of 4-5 Rabbit MQ nodes with
> Clustering and HA (it can also go on the RabbitMQ site). I wanted to know
> about a RabbitMQ setup which is able to handle millions of messages.
>
> I hope there would be many more users with such a requirement.
>
> Thanks
> Kshitiz Garg
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101128/92035dce/attachment.htm>

From matthew at rabbitmq.com  Sun Nov 28 16:35:09 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 28 Nov 2010 16:35:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <9BDFF1B6-36E5-4A19-A173-075E37BEBE2E@consequor.de>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
	<20101128141204.GB12093@wellquite.org>
	<8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>
	<20101128143455.GE12093@wellquite.org>
	<7D1AF250-AEB4-485F-A07D-264962E5B678@consequor.de>
	<20101128155254.GF12093@wellquite.org>
	<9BDFF1B6-36E5-4A19-A173-075E37BEBE2E@consequor.de>
Message-ID: <20101128163509.GG12093@wellquite.org>

On Sun, Nov 28, 2010 at 05:29:44PM +0100, Frank G?nninger wrote:
> Nevertheless: I am up and running with 2.1.1 - so I'm happy ;-)

Good good! Btw, RabbitMQ is in macports, which we support, so
installation of RabbitMQ on OS X should be relatively straightforward.

http://www.rabbitmq.com/macports.html

Matthew

From matthias at rabbitmq.com  Sun Nov 28 16:49:41 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 28 Nov 2010 16:49:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <9BDFF1B6-36E5-4A19-A173-075E37BEBE2E@consequor.de>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>	<20101128134955.GA12093@wellquite.org>	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>	<20101128141204.GB12093@wellquite.org>	<8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>	<20101128143455.GE12093@wellquite.org>	<7D1AF250-AEB4-485F-A07D-264962E5B678@consequor.de>	<20101128155254.GF12093@wellquite.org>
	<9BDFF1B6-36E5-4A19-A173-075E37BEBE2E@consequor.de>
Message-ID: <4CF28825.1050204@rabbitmq.com>

Frank,

Frank G?nninger wrote:
> Am 28.11.2010 um 16:52 schrieb Matthew Sackman:
>> If you:
>> wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server-2.1.1.tar.gz
>> tar xzf rabbitmq-server-2.1.1.tar.gz
>> cd rabbitmq-server-2.1.1
>> make
> 
> That doesn't work on OS X 10.6.5 (darwin 10.5.0) with GNU make 3.81.
> It's not clear to me at all what is the difference between the two
> environments (hg and source tarball).

This does work for a colleague of mine on 10.6.5 and make 3.81 from 
xcode. Oh well.

As Matthew pointed out, there is a rabbit package in macports. And 
homebrew. And if you are not keen on either of these then the generic 
Unix binary 
(http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server-generic-unix-2.1.1.tar.gz). 
should work just fine. Building from source is really only required if 
you want to modify the code.


Regards,

Matthias

From frank.goenninger at consequor.de  Sun Nov 28 17:00:39 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Sun, 28 Nov 2010 18:00:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!
In-Reply-To: <4CF28825.1050204@rabbitmq.com>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de>
	<20101128134955.GA12093@wellquite.org>
	<FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de>
	<20101128141204.GB12093@wellquite.org>
	<8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de>
	<20101128143455.GE12093@wellquite.org>
	<7D1AF250-AEB4-485F-A07D-264962E5B678@consequor.de>
	<20101128155254.GF12093@wellquite.org>
	<9BDFF1B6-36E5-4A19-A173-075E37BEBE2E@consequor.de>
	<4CF28825.1050204@rabbitmq.com>
Message-ID: <54F52CB5-233F-4939-AC87-A5CFC5C27AA7@consequor.de>

Hi Matthias,

Am 28.11.2010 um 17:49 schrieb Matthias Radestock:

> Frank,
> 
> Frank G?nninger wrote:
>> Am 28.11.2010 um 16:52 schrieb Matthew Sackman:
>>> If you:
>>> wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server-2.1.1.tar.gz
>>> tar xzf rabbitmq-server-2.1.1.tar.gz
>>> cd rabbitmq-server-2.1.1
>>> make
>> 
>> That doesn't work on OS X 10.6.5 (darwin 10.5.0) with GNU make 3.81.
>> It's not clear to me at all what is the difference between the two
>> environments (hg and source tarball).
> 
> This does work for a colleague of mine on 10.6.5 and make 3.81 from 
> xcode. Oh well.

Whatever the difference between our two envs is ...

> As Matthew pointed out, there is a rabbit package in macports. And 
> homebrew.

Not using any of those. But:

> And if you are not keen on either of these then the generic 
> Unix binary 
> (http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/rabbitmq-server-generic-unix-2.1.1.tar.gz). 
> should work just fine. Building from source is really only required if 
> you want to modify the code.


I know that, thanks, and this does work. I managed to compile and install myself now. All is well. ;-)

Thanks again for superb support on a Sunday ! 

Frank

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From matt at inovativtech.com  Mon Nov 29 03:01:18 2010
From: matt at inovativtech.com (matt at inovativtech.com)
Date: Mon, 29 Nov 2010 03:01:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources:
	Norule to make target deps.mk ?!
In-Reply-To: <20101128163509.GG12093@wellquite.org>
References: <D6DDCF58-0223-4A4F-A070-6151EB87AF89@consequor.de><20101128134955.GA12093@wellquite.org><FD36CF04-C43C-43B0-8B61-56228F13C8F5@consequor.de><20101128141204.GB12093@wellquite.org><8C729917-3A6F-491A-B49A-3F604CC86BDD@consequor.de><20101128143455.GE12093@wellquite.org><7D1AF250-AEB4-485F-A07D-264962E5B678@consequor.de><20101128155254.GF12093@wellquite.org><9BDFF1B6-36E5-4A19-A173-075E37BEBE2E@consequor.de><20101128163509.GG12093@wellquite.org>
Message-ID: <1098421652-1290999682-cardhu_decombobulator_blackberry.rim.net-636436622-@bda2484.bisx.prod.on.blackberry>

Hi all,

just wanted to mention that I believe the homebrew for mac os x  also exists; its a bit faster than macports. A formula was submitted about 3 weeks ago; I might be mistaken.

$brew install rabbitmq


Cheers,
Matt
Sent via BlackBerry by AT&T

-----Original Message-----
From: Matthew Sackman <matthew at rabbitmq.com>
Sender: rabbitmq-discuss-bounces at lists.rabbitmq.com
Date: Sun, 28 Nov 2010 16:35:09 
To: <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ 2.1.1: Building from sources: No
 rule to make target deps.mk ?!

On Sun, Nov 28, 2010 at 05:29:44PM +0100, Frank G?nninger wrote:
> Nevertheless: I am up and running with 2.1.1 - so I'm happy ;-)

Good good! Btw, RabbitMQ is in macports, which we support, so
installation of RabbitMQ on OS X should be relatively straightforward.

http://www.rabbitmq.com/macports.html

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From stephanion2002 at gmail.com  Mon Nov 29 07:18:55 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Mon, 29 Nov 2010 12:48:55 +0530
Subject: [rabbitmq-discuss] RabbitMQ clustering
In-Reply-To: <AANLkTi=STEeUigLbDiowk=GKpoxdt_9w56uA6NP4fRz9@mail.gmail.com>
References: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
	<AANLkTi=STEeUigLbDiowk=GKpoxdt_9w56uA6NP4fRz9@mail.gmail.com>
Message-ID: <AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>

Hi Gustavo,

Sorry for replying late,

We don't have any figure yet, but on our pub-sub system, millions of of
publishers will be publishing messages.

Our system is as follows:

1. A publisher publishes message on our rest APIs.
2. From there, we first store those messages in DB.
3. After storing, we publish the message on RabbitMQ setup using a load
balancer.
4. Behind the load balancer, we have a cluster of 4 rabbitMQ nodes.
5. At the consuming end,  we have perl and java consumers fetching messages.
7. These internal consumers send messages to the subscribers as per the
subscription protocol.

Now, if we add 4 RabbitMQ nodes in a cluster, all the credentials, exchanges
and bindings get copied to each mnesia db. However, since the queues are
specific to nodes, the message directed to a particular queue will be lost
(if the node on which that queue was created is down). This seems to be a
weak link for a scalable and High availability solution we need. Will the
message be persisted somewhere and delivered to that queue after that
particular node comes up?

If the message is gonna lost, can we have a workaround that we create copies
of the queues explicitly on each node. Now since they are copies, the
exchange will send the message to all the nodes and even if a node is down,
message will be delivered to all the copies of that queue.

We know that Clustering!=HA, but we do need Clustering with HA. Here since
even after clustering of 4 rabbitMQ nodes, the active-passive setup for each
of these 4 nodes becomes the bottleneck because of the complexity of the
non-replication of "queues". Is there any workaround or any other setup u
can suggest ?

Regards,
Kshitiz Garg

On Sun, Nov 28, 2010 at 10:01 PM, Gustavo Aquino
<aquino.gustavo at gmail.com>wrote:

> Hi Garg,
>
> Could you give to us more details about what you need? eg.  it's messages
> throughput is per second? and etc.
>
> Regards.
>
>
>
>
> On Wed, Nov 24, 2010 at 10:35 AM, Kshitiz Garg <stephanion2002 at gmail.com>wrote:
>
>> Hi,
>>
>> Can someone present a pictorial representation of 4-5 Rabbit MQ nodes with
>> Clustering and HA (it can also go on the RabbitMQ site). I wanted to know
>> about a RabbitMQ setup which is able to handle millions of messages.
>>
>> I hope there would be many more users with such a requirement.
>>
>> Thanks
>> Kshitiz Garg
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101129/e27bdf0e/attachment.htm>

From majek04 at gmail.com  Mon Nov 29 10:19:57 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 29 Nov 2010 10:19:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ clustering
In-Reply-To: <AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>
References: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
	<AANLkTi=STEeUigLbDiowk=GKpoxdt_9w56uA6NP4fRz9@mail.gmail.com>
	<AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>
Message-ID: <AANLkTimrkTX=J9C=MX4_5A1hhXPyy_v3W_kaLw8Mv83d@mail.gmail.com>

Hi,

You have a valid point, just a quick question...

On Mon, Nov 29, 2010 at 07:18, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
> Hi Gustavo,
>
> Sorry for replying late,
>
> We don't have any figure yet, but on our pub-sub system, millions of of
> publishers will be publishing messages.
>
> Our system is as follows:
>
> 1. A publisher publishes message on our rest APIs.
> 2. From there, we first store those messages in DB.
> 3. After storing, we publish the message on RabbitMQ setup using a load
> balancer.
> 4. Behind the load balancer, we have a cluster of 4 rabbitMQ nodes.
> 5. At the consuming end,? we have perl and java consumers fetching messages.
> 7. These internal consumers send messages to the subscribers as per the
> subscription protocol.
>
> Now, if we add 4 RabbitMQ nodes in a cluster, all the credentials, exchanges
> and bindings get copied to each mnesia db. However, since the queues are
> specific to nodes, the message directed to a particular queue will be lost
> (if the node on which that queue was created is down). This seems to be a
> weak link for a scalable and High availability solution we need. Will the
> message be persisted somewhere and delivered to that queue after that
> particular node comes up?
>
> If the message is gonna lost, can we have a workaround that we create copies
> of the queues explicitly on each node. Now since they are copies, the
> exchange will send the message to all the nodes and even if a node is down,
> message will be delivered to all the copies of that queue.
>
> We know that Clustering!=HA, but we do need Clustering with HA. Here since
> even after clustering of 4 rabbitMQ nodes, the active-passive setup for each
> of these 4 nodes becomes the bottleneck because of the complexity of the
> non-replication of "queues". Is there any workaround or any other setup u
> can suggest ?

... have you actually tried a setup with only a single RabbitMQ node, and did
it really became a bottleneck?

Marek


> Regards,
> Kshitiz Garg
>
> On Sun, Nov 28, 2010 at 10:01 PM, Gustavo Aquino <aquino.gustavo at gmail.com>
> wrote:
>>
>> Hi Garg,
>> Could you give to us more details about what you need? eg. ?it's messages
>> throughput is per second? and etc.
>> Regards.
>>
>>
>>
>> On Wed, Nov 24, 2010 at 10:35 AM, Kshitiz Garg <stephanion2002 at gmail.com>
>> wrote:
>>>
>>> Hi,
>>>
>>> Can someone present a pictorial representation of 4-5 Rabbit MQ nodes
>>> with Clustering and HA (it can also go on the RabbitMQ site). I wanted to
>>> know about a RabbitMQ setup which is able to handle millions of messages.
>>>
>>> I hope there would be many more users with such a requirement.
>>>
>>> Thanks
>>> Kshitiz Garg
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From stephanion2002 at gmail.com  Mon Nov 29 10:30:47 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Mon, 29 Nov 2010 16:00:47 +0530
Subject: [rabbitmq-discuss] RabbitMQ clustering
In-Reply-To: <AANLkTimrkTX=J9C=MX4_5A1hhXPyy_v3W_kaLw8Mv83d@mail.gmail.com>
References: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
	<AANLkTi=STEeUigLbDiowk=GKpoxdt_9w56uA6NP4fRz9@mail.gmail.com>
	<AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>
	<AANLkTimrkTX=J9C=MX4_5A1hhXPyy_v3W_kaLw8Mv83d@mail.gmail.com>
Message-ID: <AANLkTimn1gpGNeOfrmYkAZegO_oF=wTOfgvoAZosOp7S@mail.gmail.com>

Hi Marek,

For POC it worked, but we know that since ours is a "cloud" based
application, it will scale. So we have to chose a broker carefully. Do we
have a workaround for this ?

Regards,
Kshitiz Garg
HP R&D Division

 On Mon, Nov 29, 2010 at 3:49 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> Hi,
>
> You have a valid point, just a quick question...
>
> On Mon, Nov 29, 2010 at 07:18, Kshitiz Garg <stephanion2002 at gmail.com>
> wrote:
> > Hi Gustavo,
> >
> > Sorry for replying late,
> >
> > We don't have any figure yet, but on our pub-sub system, millions of of
> > publishers will be publishing messages.
> >
> > Our system is as follows:
> >
> > 1. A publisher publishes message on our rest APIs.
> > 2. From there, we first store those messages in DB.
> > 3. After storing, we publish the message on RabbitMQ setup using a load
> > balancer.
> > 4. Behind the load balancer, we have a cluster of 4 rabbitMQ nodes.
> > 5. At the consuming end,  we have perl and java consumers fetching
> messages.
> > 7. These internal consumers send messages to the subscribers as per the
> > subscription protocol.
> >
> > Now, if we add 4 RabbitMQ nodes in a cluster, all the credentials,
> exchanges
> > and bindings get copied to each mnesia db. However, since the queues are
> > specific to nodes, the message directed to a particular queue will be
> lost
> > (if the node on which that queue was created is down). This seems to be a
> > weak link for a scalable and High availability solution we need. Will the
> > message be persisted somewhere and delivered to that queue after that
> > particular node comes up?
> >
> > If the message is gonna lost, can we have a workaround that we create
> copies
> > of the queues explicitly on each node. Now since they are copies, the
> > exchange will send the message to all the nodes and even if a node is
> down,
> > message will be delivered to all the copies of that queue.
> >
> > We know that Clustering!=HA, but we do need Clustering with HA. Here
> since
> > even after clustering of 4 rabbitMQ nodes, the active-passive setup for
> each
> > of these 4 nodes becomes the bottleneck because of the complexity of the
> > non-replication of "queues". Is there any workaround or any other setup u
> > can suggest ?
>
> ... have you actually tried a setup with only a single RabbitMQ node, and
> did
> it really became a bottleneck?
>
> Marek
>
>
> > Regards,
> > Kshitiz Garg
> >
> > On Sun, Nov 28, 2010 at 10:01 PM, Gustavo Aquino <
> aquino.gustavo at gmail.com>
> > wrote:
> >>
> >> Hi Garg,
> >> Could you give to us more details about what you need? eg.  it's
> messages
> >> throughput is per second? and etc.
> >> Regards.
> >>
> >>
> >>
> >> On Wed, Nov 24, 2010 at 10:35 AM, Kshitiz Garg <
> stephanion2002 at gmail.com>
> >> wrote:
> >>>
> >>> Hi,
> >>>
> >>> Can someone present a pictorial representation of 4-5 Rabbit MQ nodes
> >>> with Clustering and HA (it can also go on the RabbitMQ site). I wanted
> to
> >>> know about a RabbitMQ setup which is able to handle millions of
> messages.
> >>>
> >>> I hope there would be many more users with such a requirement.
> >>>
> >>> Thanks
> >>> Kshitiz Garg
> >>>
> >>>
> >>>
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-discuss at lists.rabbitmq.com
> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>
> >>
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101129/e6c822bc/attachment-0001.htm>

From pdezwart at rubiconproject.com  Mon Nov 29 16:38:38 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 29 Nov 2010 08:38:38 -0800
Subject: [rabbitmq-discuss] DQOTD: Is publishing to an undeclared
 exchange ok?
In-Reply-To: <yrv4ck4jyufqu.fsf@dwragg.eng.vmware.com>
Message-ID: <C919170E.137DE%pdezwart@rubiconproject.com>

Ah, thank you for the detailed response David, that makes much more sense.
Pieter


On 11/27/10 10:25 PM, "David Wragg" <david at rabbitmq.com> wrote:

> Pieter de Zwart <pdezwart at rubiconproject.com> writes:
>> My Dumb Question Of The Day (registered) is: What is the expected behavior
>> when publishing to an exchange that has not been previously declared? It
>> seems that if I do that using the C client, the message disappears into the
>> void without so much as a peep.
> 
> Publishing a message in AMQP is a fully asynchronous operation: The
> client sends a basic.publish method to the server, and does not wait for
> any kind of reply.  So there is no way for the amqp_basic_publish
> function to return an error in this case.
> 
> But, the next synchronous operation you do on the channel should return
> the error.
> 
> For example, with the amqp-publish utility in the rabbitmq-c tools
> directory, if you do:
> 
>   $ tools/amqp-publish -e nosuch -b "hello"
> 
> It responds with the error:
> 
>   closing channel: server channel error 404, message: NOT_FOUND - no
>   exchange 'nosuch' in vhost '/'
> 
> As the prefix to this error suggests, the error is being reported from
> amqp_channel_close, because in publish.c, that is the synchronous
> operation following the amqp_basic_publish call.
> 
>> The only reason I ask is that I wan the PHP client to behave in the most
>> appropriate manner, matching that of the client and broker.
> 
> Currently, if you want to get localize errors to particular
> amqp_basic_publish calls, you'll need to follow each one with a
> synchronous operation to collect the error.  Opening and closing a
> channel around each publish is perhaps the most obvious way to do this.
> 
> David


From gmr at myyearbook.com  Mon Nov 29 21:31:49 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 29 Nov 2010 16:31:49 -0500
Subject: [rabbitmq-discuss] Less Verbose Logging
Message-ID: <AANLkTikkjcCpumN817Lx8OynfehM9HiXQ+ov2PB65V3c@mail.gmail.com>

Is there a command line switch to set logging to errors only?

From majek04 at gmail.com  Mon Nov 29 23:31:05 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 29 Nov 2010 23:31:05 +0000
Subject: [rabbitmq-discuss] Less Verbose Logging
In-Reply-To: <AANLkTikkjcCpumN817Lx8OynfehM9HiXQ+ov2PB65V3c@mail.gmail.com>
References: <AANLkTikkjcCpumN817Lx8OynfehM9HiXQ+ov2PB65V3c@mail.gmail.com>
Message-ID: <AANLkTik75rBDChWkaugffTqHPvqzLgYCd0ykZwo4CNha@mail.gmail.com>

No. Sorry.

You can use `rabbitmqctl` to rotate logs more often.

Cheers,
  Marek

On Mon, Nov 29, 2010 at 21:31, Gavin M. Roy <gmr at myyearbook.com> wrote:
> Is there a command line switch to set logging to errors only?

From rauan at maemirov.com  Tue Nov 30 04:12:13 2010
From: rauan at maemirov.com (Rauan Maemirov)
Date: Tue, 30 Nov 2010 10:12:13 +0600
Subject: [rabbitmq-discuss] Less Verbose Logging
In-Reply-To: <AANLkTik75rBDChWkaugffTqHPvqzLgYCd0ykZwo4CNha@mail.gmail.com>
References: <AANLkTikkjcCpumN817Lx8OynfehM9HiXQ+ov2PB65V3c@mail.gmail.com>
	<AANLkTik75rBDChWkaugffTqHPvqzLgYCd0ykZwo4CNha@mail.gmail.com>
Message-ID: <AANLkTi=xjcxgSpND+NwOQbashCffFx+XzZc7PFaHH2e=@mail.gmail.com>

Any plans for making it tunable in future?

2010/11/30 Marek Majkowski <majek04 at gmail.com>

> No. Sorry.
>
> You can use `rabbitmqctl` to rotate logs more often.
>
> Cheers,
>   Marek
>
> On Mon, Nov 29, 2010 at 21:31, Gavin M. Roy <gmr at myyearbook.com> wrote:
> > Is there a command line switch to set logging to errors only?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101130/af430cd0/attachment.htm>

From videlalvaro at gmail.com  Tue Nov 30 07:10:58 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 30 Nov 2010 15:10:58 +0800
Subject: [rabbitmq-discuss] Less Verbose Logging
In-Reply-To: <AANLkTi=xjcxgSpND+NwOQbashCffFx+XzZc7PFaHH2e=@mail.gmail.com>
References: <AANLkTikkjcCpumN817Lx8OynfehM9HiXQ+ov2PB65V3c@mail.gmail.com>
	<AANLkTik75rBDChWkaugffTqHPvqzLgYCd0ykZwo4CNha@mail.gmail.com>
	<AANLkTi=xjcxgSpND+NwOQbashCffFx+XzZc7PFaHH2e=@mail.gmail.com>
Message-ID: <58660FC0-A181-4B08-82DC-81870F2C0813@gmail.com>

Actually you can get the logs filtered by severity. We explain how to get them filtered by severity in chapter 2 of the RabbitMQ in Action book.

Basically this is what's going on:

RabbitMQ is logging to the 'amq.rabbitmq.log' exchange, and uses as routing key the severity of the error, which AFAIK are: error, warning and info.

So you could set up some consumers to get the logs that you want. 

Regards,

Alvaro

On Nov 30, 2010, at 12:12 PM, Rauan Maemirov wrote:

> Any plans for making it tunable in future?
> 
> 2010/11/30 Marek Majkowski <majek04 at gmail.com>
> No. Sorry.
> 
> You can use `rabbitmqctl` to rotate logs more often.
> 
> Cheers,
>  Marek
> 
> On Mon, Nov 29, 2010 at 21:31, Gavin M. Roy <gmr at myyearbook.com> wrote:
> > Is there a command line switch to set logging to errors only?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101130/34fefb07/attachment.htm>

From sunshinesucker at gmail.com  Tue Nov 30 09:16:01 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Tue, 30 Nov 2010 09:16:01 +0000
Subject: [rabbitmq-discuss] building webhooks plugin with 2.1.1
In-Reply-To: <66150186-E436-4242-A742-EB1698C61751@npcinternational.com>
References: <AANLkTikhuZcq3w0YCaFDPH4d0t4p8U_niVEYuiwD4bZW@mail.gmail.com>
	<FEBA449D-3B3A-4ED8-A321-C031571D5F3B@npcinternational.com>
	<AANLkTikuC9FY5urRut_ZCetZ-agbM-FpxMN6Ozsmowro@mail.gmail.com>
	<2AA38F4A-ACD9-4F93-9736-84C3157CCF84@npcinternational.com>
	<4CEBD7E4.6040609@rabbitmq.com>
	<214C5D07-2CE0-4CA8-BBCB-610F03C4370D@npcinternational.com>
	<AANLkTikpHxS7qR90rG7OEhPaBFYrU1omP33R4TZ1iXeP@mail.gmail.com>
	<66150186-E436-4242-A742-EB1698C61751@npcinternational.com>
Message-ID: <AANLkTimbLppmd=mtY9oYigEYQ7VxqxECFSwv=TdDXSdp@mail.gmail.com>

Attached is the config file, we have no problems with it on version 2.0.0 of
the server but if you can see any potential issues with it let me know.

many thanks


On 26 November 2010 16:49, Jon Brisbin <jon.brisbin at npcinternational.com>wrote:

> Can I see your webhooks configuration?
>
> jb
>
>
> On Nov 25, 2010, at 11:41 AM, sunghyun lee wrote:
>
> I tried but the broker still doesnt start...
>
>
> On 23 November 2010 15:09, Jon Brisbin <jon.brisbin at npcinternational.com>wrote:
>
>>
>> On Nov 23, 2010, at 9:04 AM, Matthias Radestock wrote:
>>
>> > Jon,
>> >
>> > On 22/11/10 15:12, Jon Brisbin wrote:
>> >> It looks like, in 2.1.1, the lhttpc plugin needs to be unzipped inside
>> >> the plugins folder. I've no idea why this is, maybe the Rabbit folks
>> can
>> >> answer that one.
>> >
>> > I suspect the problem is that lhttpc.ez does not contain a top-level
>> directory.
>> >
>>
>> Ahh... I built that manually.
>>
>> Thanks for the hint, Matthias. That's an easy fix. :)
>>
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101130/8025f94b/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq.config
Type: application/octet-stream
Size: 1083 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101130/8025f94b/attachment-0001.obj>

From mixtlispam at gmail.com  Tue Nov 30 10:30:22 2010
From: mixtlispam at gmail.com (mixtli)
Date: Tue, 30 Nov 2010 02:30:22 -0800 (PST)
Subject: [rabbitmq-discuss] access control
Message-ID: <ede8db07-94cb-41c4-8da6-eb680a8ddf92@35g2000prt.googlegroups.com>

  I have an app that will have a central controller which is fed data
from pollers around the internet.  I envision the controller having a
bidirectional communication with each poller.   Each poller should
only have access to it's own queues.

So I might have inqueue.bob, inqueue.jim, outqueue.bob, and
outqueue.jim as queues.  However, I don't know the names of the queues
until runtime.   I can create a queue from the ruby api i'm using, but
see no way to set its permissions.
I suppose I can shell out to the command line, though my broker lives
on another server, so I'd have to ssh.  I saw something about a
management console with an api.   Is that the recommended way to do
what I need?

Am I thinking about my model wrong?   I'm new to message queues.

Thanks!




From simon at rabbitmq.com  Tue Nov 30 10:58:56 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Nov 2010 10:58:56 +0000
Subject: [rabbitmq-discuss] access control
In-Reply-To: <ede8db07-94cb-41c4-8da6-eb680a8ddf92@35g2000prt.googlegroups.com>
References: <ede8db07-94cb-41c4-8da6-eb680a8ddf92@35g2000prt.googlegroups.com>
Message-ID: <4CF4D8F0.5040703@rabbitmq.com>

On 30/11/10 10:30, mixtli wrote:
> I suppose I can shell out to the command line, though my broker lives
> on another server, so I'd have to ssh.  I saw something about a
> management console with an api.   Is that the recommended way to do
> what I need?

Pretty much. Install the management plugin from
http://www.rabbitmq.com/plugins.html, browse to
http://server-name:55672/api/ for API documentation - mirrored at 
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_1_1/priv/www-api/help.html

> Am I thinking about my model wrong?   I'm new to message queues.

This seems reasonable. It's possible that if you would be happy with 
anyone being able to publish to your queues but only their owners being 
able to read from them you could forget about the permissions  system 
and just have the queues declared exclusive - but that doesn't sound 
like a great fit so the permissions route is probably correct.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From rob at rabbitmq.com  Tue Nov 30 11:19:23 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 30 Nov 2010 11:19:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 Release
Message-ID: <5bf8b8e358791cfa64b32e709f429bc4@rabbitmq.com>

The RabbitMQ team is delighted to announce the release of RabbitMQ
2.2.0.

This release fixes a number of bugs and introduces some enhancements,
including automatic upgrades of non-clustered brokers, per-queue
message TTLs and significantly reduced memory usage for pending
acknowledgements.

See the attached release notes for more details.

Binary and source distributions of the new release can be found in the
usual place at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.

Regards,
        The RabbitMQ Team
-------------- next part --------------
Release: RabbitMQ 2.2.0

Release Highlights
==================

server
------
bug fixes
- fix issue that causes cross-cluster communication to deadlock after
  sustained cluster activity
- fix queue memory leak when using the management plugin or other
  consumers of queue statistics
- brokers started with rabbitmq_multi.bat are now restartable
- clustering reset no longer destroys installed plugins
- fix race condition between queue declaration and connection
  termination that causes spurious noproc errors to appear in the log
- fix memory leak when long-running channels consume and cancel on
  many queues
- queue.declare and exchange.declare raise precondition_failed rather
  than not_allowed when attempting to redeclare a queue or exchange
  with parameters different than those currently known to the broker

enhancements
- automatic, lossless upgrade to new versions of RabbitMQ
  (when not clustered)
- support per-queue message TTL. See:
  http://www.rabbitmq.com/extensions.html#queue-ttl
- the volume of pending acks is now bounded by disk space rather
  than by memory
- store passwords as hashes
- allow server properties to be configured in the RabbitMQ config file
- SSL connections are listed as such by rabbitmqctl
- simplify permission configuration by removing the client
  permission scope
- improve performance of message routing
- removed support for basic.recover with requeue=false

java client
-----------
enhancements
- 'noAck' argument renamed to 'autoAck'
- add PossibleAuthenticationFailureException and
  ProtocolVersionMismatchException to match up with the .net client.

.net client
-----------
bug fixes
- fix race condition that can cause spurious SocketErrors to be thrown
  during connection.close
- fix WCF support to use 'amq.direct' exchange instead of default
  exchange

management plugin
-----------------
bug fixes
- fix issue preventing user authentication when using Safari
- backing queue stats now display correctly

enhancements
- the management plugin is now fully cluster-aware
- show detailed incoming/outgoing message rates per channel, exchange
  and queue
- show active/idle state for channels and queues
- show node uptime, rabbit version, erlang version and total queued
  messages
- add tab completion to rabbitmqadmin

STOMP plugin
------------
enhancements
- overhaul the destination selection process to use only the
  'destination' header
- add support for /queue and /topic destinations
- remove support for custom 'routing_key' and 'exchange headers' and
  introduce /exchange/<name>/<key> destination type
- the order of SEND and SUBSCRIBE frames is no longer important
- STOMP listeners show up as such in the management plugin

build and packaging
-------------------
bug fixes
- remove build-time dependency on OTP source to allow users to
  build without the OTP source present
- eliminate all valid dialyzer errors

enhancements
- include pre-compiled man pages in the MacPorts distribution,
  drastically reducing the number of dependencies required.

Upgrading
=========
To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply
install the new version. All configuration and persistent message data
is retained.

To upgrade a non-clustered RabbitMQ from release 2.1.0, first upgrade
to 2.1.1 (which retains all data), and then to the current version as
described above.

To upgrade a clustered RabbitMQ or from releases prior to 2.1.0, if
the RabbitMQ installation does not contain any important data then
simply install the new version. RabbitMQ will move the existing data
to a backup location before creating a fresh, empty database. A
warning is recorded in the logs. If your RabbitMQ installation
contains important data then we recommend you contact
support at rabbitmq.com for assistance with the upgrade.

From stephanion2002 at gmail.com  Tue Nov 30 11:20:45 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Tue, 30 Nov 2010 16:50:45 +0530
Subject: [rabbitmq-discuss] RabbitMQ clustering
In-Reply-To: <AANLkTimn1gpGNeOfrmYkAZegO_oF=wTOfgvoAZosOp7S@mail.gmail.com>
References: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
	<AANLkTi=STEeUigLbDiowk=GKpoxdt_9w56uA6NP4fRz9@mail.gmail.com>
	<AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>
	<AANLkTimrkTX=J9C=MX4_5A1hhXPyy_v3W_kaLw8Mv83d@mail.gmail.com>
	<AANLkTimn1gpGNeOfrmYkAZegO_oF=wTOfgvoAZosOp7S@mail.gmail.com>
Message-ID: <AANLkTinOhYi09DY8cE_uEdwOHcnVG5syAwwtY+GXpjDG@mail.gmail.com>

Hi Gustavo/Marek,

Please help us in designing the setup.

Regards,
Kshitiz Garg

On Mon, Nov 29, 2010 at 4:00 PM, Kshitiz Garg <stephanion2002 at gmail.com>wrote:

> Hi Marek,
>
> For POC it worked, but we know that since ours is a "cloud" based
> application, it will scale. So we have to chose a broker carefully. Do we
> have a workaround for this ?
>
> Regards,
> Kshitiz Garg
> HP R&D Division
>
>
>  On Mon, Nov 29, 2010 at 3:49 PM, Marek Majkowski <majek04 at gmail.com>wrote:
>
>> Hi,
>>
>> You have a valid point, just a quick question...
>>
>> On Mon, Nov 29, 2010 at 07:18, Kshitiz Garg <stephanion2002 at gmail.com>
>> wrote:
>> > Hi Gustavo,
>> >
>> > Sorry for replying late,
>> >
>> > We don't have any figure yet, but on our pub-sub system, millions of of
>> > publishers will be publishing messages.
>> >
>> > Our system is as follows:
>> >
>> > 1. A publisher publishes message on our rest APIs.
>> > 2. From there, we first store those messages in DB.
>> > 3. After storing, we publish the message on RabbitMQ setup using a load
>> > balancer.
>> > 4. Behind the load balancer, we have a cluster of 4 rabbitMQ nodes.
>> > 5. At the consuming end,  we have perl and java consumers fetching
>> messages.
>> > 7. These internal consumers send messages to the subscribers as per the
>> > subscription protocol.
>> >
>> > Now, if we add 4 RabbitMQ nodes in a cluster, all the credentials,
>> exchanges
>> > and bindings get copied to each mnesia db. However, since the queues are
>> > specific to nodes, the message directed to a particular queue will be
>> lost
>> > (if the node on which that queue was created is down). This seems to be
>> a
>> > weak link for a scalable and High availability solution we need. Will
>> the
>> > message be persisted somewhere and delivered to that queue after that
>> > particular node comes up?
>> >
>> > If the message is gonna lost, can we have a workaround that we create
>> copies
>> > of the queues explicitly on each node. Now since they are copies, the
>> > exchange will send the message to all the nodes and even if a node is
>> down,
>> > message will be delivered to all the copies of that queue.
>> >
>> > We know that Clustering!=HA, but we do need Clustering with HA. Here
>> since
>> > even after clustering of 4 rabbitMQ nodes, the active-passive setup for
>> each
>> > of these 4 nodes becomes the bottleneck because of the complexity of the
>> > non-replication of "queues". Is there any workaround or any other setup
>> u
>> > can suggest ?
>>
>> ... have you actually tried a setup with only a single RabbitMQ node, and
>> did
>> it really became a bottleneck?
>>
>> Marek
>>
>>
>> > Regards,
>> > Kshitiz Garg
>> >
>> > On Sun, Nov 28, 2010 at 10:01 PM, Gustavo Aquino <
>> aquino.gustavo at gmail.com>
>> > wrote:
>> >>
>> >> Hi Garg,
>> >> Could you give to us more details about what you need? eg.  it's
>> messages
>> >> throughput is per second? and etc.
>> >> Regards.
>> >>
>> >>
>> >>
>> >> On Wed, Nov 24, 2010 at 10:35 AM, Kshitiz Garg <
>> stephanion2002 at gmail.com>
>> >> wrote:
>> >>>
>> >>> Hi,
>> >>>
>> >>> Can someone present a pictorial representation of 4-5 Rabbit MQ nodes
>> >>> with Clustering and HA (it can also go on the RabbitMQ site). I wanted
>> to
>> >>> know about a RabbitMQ setup which is able to handle millions of
>> messages.
>> >>>
>> >>> I hope there would be many more users with such a requirement.
>> >>>
>> >>> Thanks
>> >>> Kshitiz Garg
>> >>>
>> >>>
>> >>>
>> >>> _______________________________________________
>> >>> rabbitmq-discuss mailing list
>> >>> rabbitmq-discuss at lists.rabbitmq.com
>> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>>
>> >>
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101130/57edda52/attachment.htm>

From matthias at rabbitmq.com  Tue Nov 30 11:30:57 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 30 Nov 2010 11:30:57 +0000
Subject: [rabbitmq-discuss] access control
In-Reply-To: <4CF4D8F0.5040703@rabbitmq.com>
References: <ede8db07-94cb-41c4-8da6-eb680a8ddf92@35g2000prt.googlegroups.com>
	<4CF4D8F0.5040703@rabbitmq.com>
Message-ID: <4CF4E071.4060502@rabbitmq.com>

Simon MacMullen wrote:
> On 30/11/10 10:30, mixtli wrote:
>> I suppose I can shell out to the command line, though my broker lives
>> on another server, so I'd have to ssh.  I saw something about a
>> management console with an api.   Is that the recommended way to do
>> what I need?
> 
> Pretty much.

I suspect queues with strong names, bound to exchanges with well-known 
binding keys would suffice. That way you'd not need anything above AMQP.

Also, I don't see why you'd need two queues per poller. Surely you can 
just have one queue for the controller - to which all pollers publish - 
and then one queue per poller.


Matthias.

From gmr at myyearbook.com  Tue Nov 30 13:09:02 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 30 Nov 2010 08:09:02 -0500
Subject: [rabbitmq-discuss] Less Verbose Logging
In-Reply-To: <58660FC0-A181-4B08-82DC-81870F2C0813@gmail.com>
References: <AANLkTikkjcCpumN817Lx8OynfehM9HiXQ+ov2PB65V3c@mail.gmail.com>
	<AANLkTik75rBDChWkaugffTqHPvqzLgYCd0ykZwo4CNha@mail.gmail.com>
	<AANLkTi=xjcxgSpND+NwOQbashCffFx+XzZc7PFaHH2e=@mail.gmail.com>
	<58660FC0-A181-4B08-82DC-81870F2C0813@gmail.com>
Message-ID: <AANLkTi=FGCSqfFSZN0HawVrkjKYOtvVeR2LPoggcmDnJ@mail.gmail.com>

I just want to avoid the IO penalty of all the logging and turn off
the writing of rabbit.log or limit what is going in there.  I have a
set of brokers with a very high amount of connects and disconnects
using basic_publish.  Ideally, the 5-10 lines of logging for each
connection and disconnection (combined) could be limited or ignored.

Thanks for the reply,

Gavin

On Tue, Nov 30, 2010 at 2:10 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Actually you can get the logs filtered by severity.?We explain how to get
> them filtered by severity in chapter 2 of the RabbitMQ in Action book.
> Basically this is what's going on:
> RabbitMQ is logging to the 'amq.rabbitmq.log' exchange, and uses as routing
> key the severity of the error, which AFAIK are: error, warning and info.
> So you could set up some consumers to get the logs that you want.
> Regards,
> Alvaro
> On Nov 30, 2010, at 12:12 PM, Rauan Maemirov wrote:
>
> Any plans for making it tunable in future?
>
> 2010/11/30 Marek Majkowski <majek04 at gmail.com>
>>
>> No. Sorry.
>>
>> You can use `rabbitmqctl` to rotate logs more often.
>>
>> Cheers,
>> ?Marek
>>
>> On Mon, Nov 29, 2010 at 21:31, Gavin M. Roy <gmr at myyearbook.com> wrote:
>> > Is there a command line switch to set logging to errors only?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matthew at rabbitmq.com  Tue Nov 30 13:15:39 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 13:15:39 +0000
Subject: [rabbitmq-discuss] Less Verbose Logging
In-Reply-To: <AANLkTi=FGCSqfFSZN0HawVrkjKYOtvVeR2LPoggcmDnJ@mail.gmail.com>
References: <AANLkTikkjcCpumN817Lx8OynfehM9HiXQ+ov2PB65V3c@mail.gmail.com>
	<AANLkTik75rBDChWkaugffTqHPvqzLgYCd0ykZwo4CNha@mail.gmail.com>
	<AANLkTi=xjcxgSpND+NwOQbashCffFx+XzZc7PFaHH2e=@mail.gmail.com>
	<58660FC0-A181-4B08-82DC-81870F2C0813@gmail.com>
	<AANLkTi=FGCSqfFSZN0HawVrkjKYOtvVeR2LPoggcmDnJ@mail.gmail.com>
Message-ID: <20101130131538.GB21718@rabbitmq.com>

On Tue, Nov 30, 2010 at 08:09:02AM -0500, Gavin M. Roy wrote:
> I just want to avoid the IO penalty of all the logging and turn off
> the writing of rabbit.log or limit what is going in there.  I have a
> set of brokers with a very high amount of connects and disconnects
> using basic_publish.  Ideally, the 5-10 lines of logging for each
> connection and disconnection (combined) could be limited or ignored.

See http://old.nabble.com/Re:-Turning-off-rabbit-logging-p27068227.html

Matthew

From tontondimsum at gmail.com  Tue Nov 30 14:11:19 2010
From: tontondimsum at gmail.com (Dimitri del Marmol)
Date: Tue, 30 Nov 2010 15:11:19 +0100
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade the
	server to 2.2.0
Message-ID: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>

Hi,

I have a rabbitmq server (2.1.0) currently running in production and I
am planning an upgrade to 2.2.0. All the clients currently use the
2.1.1 java client.

I was wondering if it was necessary to upgrade all clients to 2.2.0
when upgrading the server. I guess that keeping server and clients
versions in sync would be the best way to go but how far from the
ideal situation can I go before getting into trouble?

Specifically:
- is it OK to run a client with a version older than the server (eg.
client 2.1.1 with server 2.2.0)?
- what about the other way around (eg. client 2.2.0 with server 2.1.1)?

Since 2.2.0 comes with automatic server upgrades in non clustered mode
this is something I need to get my head around since, if I understand
correctly, the server will upgrade automatically whereas I'm still
responsible on upgrading the client apps.

RTFMs (with URLs plz) accepted since this is a pretty n00b question ;-)

Cheers,

dimdm

From matthew at rabbitmq.com  Tue Nov 30 14:15:53 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 14:15:53 +0000
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
 the server to 2.2.0
In-Reply-To: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
Message-ID: <20101130141553.GF21718@rabbitmq.com>

Hi,

On Tue, Nov 30, 2010 at 03:11:19PM +0100, Dimitri del Marmol wrote:
> I have a rabbitmq server (2.1.0) currently running in production and I
> am planning an upgrade to 2.2.0. All the clients currently use the
> 2.1.1 java client.

It is not necessary to upgrade the clients. The on-the-wire protocol has
not changed.

> Specifically:
> - is it OK to run a client with a version older than the server (eg.
> client 2.1.1 with server 2.2.0)?

Yes.

> - what about the other way around (eg. client 2.2.0 with server 2.1.1)?

Yes.

> Since 2.2.0 comes with automatic server upgrades in non clustered mode
> this is something I need to get my head around since, if I understand
> correctly, the server will upgrade automatically whereas I'm still
> responsible on upgrading the client apps.

The change is that in the past, during upgrades of the server, messages
stored in the server would simply be moved to one side if the on-disk
schema changed. That is no longer the case - we have a framework in
place that can modify the on-disk data to update it as necessary to the
format required by newer versions.

Matthew

From simon at rabbitmq.com  Tue Nov 30 14:16:33 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Nov 2010 14:16:33 +0000
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
 the	server to 2.2.0
In-Reply-To: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
Message-ID: <4CF50741.3010809@rabbitmq.com>

On 30/11/10 14:11, Dimitri del Marmol wrote:
> Since 2.2.0 comes with automatic server upgrades in non clustered mode
> this is something I need to get my head around since, if I understand
> correctly, the server will upgrade automatically whereas I'm still
> responsible on upgrading the client apps.

That's the "database" (mnesia, queues etc) that gets upgraded 
automatically when you upgrade the server installation by hand - i.e. 
we're not saying the server will then pull down upgrades from the 
internet or anything. That's apt's job ;)

> RTFMs (with URLs plz) accepted since this is a pretty n00b question ;-)

Short answer:

1.x server + 2.x clients - won't work at all.
Everything else should work.

We still recommend upgrading everything whenever you can of course :)

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Tue Nov 30 14:18:46 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 14:18:46 +0000
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
 the	server to 2.2.0
In-Reply-To: <4CF50741.3010809@rabbitmq.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
	<4CF50741.3010809@rabbitmq.com>
Message-ID: <20101130141845.GH21718@rabbitmq.com>

On Tue, Nov 30, 2010 at 02:16:33PM +0000, Simon MacMullen wrote:
> Short answer:
> 1.x server + 2.x clients - won't work at all.

Ahh, that's true. I'd forgotten about that.

Matthew

From tontondimsum at gmail.com  Tue Nov 30 14:23:18 2010
From: tontondimsum at gmail.com (Dimitri del Marmol)
Date: Tue, 30 Nov 2010 15:23:18 +0100
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
 the server to 2.2.0
In-Reply-To: <20101130141845.GH21718@rabbitmq.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
	<4CF50741.3010809@rabbitmq.com> <20101130141845.GH21718@rabbitmq.com>
Message-ID: <AANLkTi=WZjkQOj0WFJNoSD=quqgVJ1EDATxVvOMLp2US@mail.gmail.com>

Awesome, this list is even faster than StackOverflow!

OK, I get it. Iwas actually worried about the automatic upgrade thing.
I prefer to plan my upgrades (duh!)
Since every thing is on version 2+ I shouldn't be worried...
I'll do the upgrade on the server 2.1.0 -> 2.1.1 -> 2.2.0 and upgrade
each client as I go in the following weeks.

Thanks a lot to you both for answering so quickly and congrats on the
release. Keep'em coming!

dimdm

From jon.brisbin at npcinternational.com  Tue Nov 30 14:33:14 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 30 Nov 2010 08:33:14 -0600
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
	the server to 2.2.0
In-Reply-To: <20101130141553.GF21718@rabbitmq.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
	<20101130141553.GF21718@rabbitmq.com>
Message-ID: <8FDD8024-7305-4EFC-9D96-C9368CCDCC2E@npcinternational.com>


On Nov 30, 2010, at 8:15 AM, Matthew Sackman wrote:

> The change is that in the past, during upgrades of the server, messages
> stored in the server would simply be moved to one side if the on-disk
> schema changed. That is no longer the case - we have a framework in
> place that can modify the on-disk data to update it as necessary to the
> format required by newer versions.

Does this include the broker configuration? I just upgraded a Ubuntu box to 2.2.0 and the broker wouldn't start. Had to zap mnesia then it started fine. Had to re-create all users/vhosts/permissions (again), though. :/

Was there a script I needed to run or something? I kind of hoped that apt would take care of running that for me...

Jon Brisbin
Portal Webmaster
NPC International, Inc.




From matthew at rabbitmq.com  Tue Nov 30 14:38:45 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 14:38:45 +0000
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
 the server to 2.2.0
In-Reply-To: <8FDD8024-7305-4EFC-9D96-C9368CCDCC2E@npcinternational.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
	<20101130141553.GF21718@rabbitmq.com>
	<8FDD8024-7305-4EFC-9D96-C9368CCDCC2E@npcinternational.com>
Message-ID: <20101130143844.GI21718@rabbitmq.com>

On Tue, Nov 30, 2010 at 08:33:14AM -0600, Jon Brisbin wrote:
> > The change is that in the past, during upgrades of the server, messages
> > stored in the server would simply be moved to one side if the on-disk
> > schema changed. That is no longer the case - we have a framework in
> > place that can modify the on-disk data to update it as necessary to the
> > format required by newer versions.
> 
> Does this include the broker configuration? I just upgraded a Ubuntu box to 2.2.0 and the broker wouldn't start. Had to zap mnesia then it started fine. Had to re-create all users/vhosts/permissions (again), though. :/
> 
> Was there a script I needed to run or something? I kind of hoped that apt would take care of running that for me...

Certainly should have done. Can you send us the logs and error message -
you said "the broker wouldn't start" - with what error? It's sounding as
if something's gone wrong.

Matthew

From jon.brisbin at npcinternational.com  Tue Nov 30 14:54:33 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 30 Nov 2010 08:54:33 -0600
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
	the server to 2.2.0
In-Reply-To: <20101130143844.GI21718@rabbitmq.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
	<20101130141553.GF21718@rabbitmq.com>
	<8FDD8024-7305-4EFC-9D96-C9368CCDCC2E@npcinternational.com>
	<20101130143844.GI21718@rabbitmq.com>
Message-ID: <D9147D6D-4C4B-4517-8676-7A8BB1BE26CC@npcinternational.com>


On Nov 30, 2010, at 8:38 AM, Matthew Sackman wrote:

> Certainly should have done. Can you send us the logs and error message -
> you said "the broker wouldn't start" - with what error? It's sounding as
> if something's gone wrong.

The log file was huge (225MB), so I just excerpted it, the apt log, and a console transcript that shows the startup_[err|log]:

Apt log...

Setting up rabbitmq-server (2.2.0-1) ...
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit status 1
E: Sub-process /usr/bin/dpkg returned an error code (1)
A package failed to install.  Trying to recover:
Setting up rabbitmq-server (2.2.0-1) ...
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit status 1
Errors were encountered while processing:
 rabbitmq-server
Press return to continue.

Trying to start the broker manually...

+-( ~ ):> sudo service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.

+-( ~ ):> cat /var/log/rabbitmq/startup_err 
Erlang has closed
Error: {node_start_failed,normal}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})

+-( ~ ):> cat /var/log/rabbitmq/startup_log 
Starting all nodes...
Starting node rabbit at warehouse2...
Activating RabbitMQ plugins ...
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.2.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at warehouse2
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.2.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
cookie hash    : LEz6QvNGm+HR8egGn/MvzQ==
log            : /var/log/rabbitmq/rabbit at warehouse2.log
sasl log       : /var/log/rabbitmq/rabbit at warehouse2-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at warehouse2
erlang version : 5.7.4

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...BOOT ERROR: FAILED
Reason: {error,{schema_mismatch,[add_ip_to_listener,add_queue_ttl,
                                 hash_passwords,remove_user_scope],
                                []}}
Stacktrace: [{rabbit_mnesia,ensure_version_ok,1},
             {rabbit_mnesia,init_db,2},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]
{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

From the log:

=ERROR REPORT==== 30-Nov-2010::08:17:12 ===
FAILED
Reason: {error,{schema_mismatch,[add_ip_to_listener,add_queue_ttl,
                                 hash_passwords,remove_user_scope],
                                []}}
Stacktrace: [{rabbit_mnesia,ensure_version_ok,1},
             {rabbit_mnesia,init_db,2},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]

=INFO REPORT==== 30-Nov-2010::08:17:13 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent


Jon Brisbin
Portal Webmaster
NPC International, Inc.




From matthew at rabbitmq.com  Tue Nov 30 15:10:36 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 15:10:36 +0000
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
 the server to 2.2.0
In-Reply-To: <D9147D6D-4C4B-4517-8676-7A8BB1BE26CC@npcinternational.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
	<20101130141553.GF21718@rabbitmq.com>
	<8FDD8024-7305-4EFC-9D96-C9368CCDCC2E@npcinternational.com>
	<20101130143844.GI21718@rabbitmq.com>
	<D9147D6D-4C4B-4517-8676-7A8BB1BE26CC@npcinternational.com>
Message-ID: <20101130151036.GL21718@rabbitmq.com>

On Tue, Nov 30, 2010 at 08:54:33AM -0600, Jon Brisbin wrote:
> Stacktrace: [{rabbit_mnesia,ensure_version_ok,1},

It thinks you're running in a cluster. Is that correct? In fact, I think
it thinks it's a slave node in a cluster and that the master node has
been upgraded. If so, the behaviour is "correct" - we don't support
upgrades in a cluster yet (as the release notes say), so moving the old
database out of the way is the right thing to do.

Matthew

From majek04 at gmail.com  Tue Nov 30 15:15:55 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 30 Nov 2010 15:15:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ clustering
In-Reply-To: <AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>
References: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
	<AANLkTi=STEeUigLbDiowk=GKpoxdt_9w56uA6NP4fRz9@mail.gmail.com>
	<AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>
Message-ID: <AANLkTi=b99iXSEMF0ADb4s+2dQur2NK2q3x6RemmLTdb@mail.gmail.com>

On Mon, Nov 29, 2010 at 07:18, Kshitiz Garg <stephanion2002 at gmail.com> wrote:
> Now, if we add 4 RabbitMQ nodes in a cluster, all the credentials, exchanges
> and bindings get copied to each mnesia db. However, since the queues are
> specific to nodes, the message directed to a particular queue will be lost
> (if the node on which that queue was created is down). This seems to be a
> weak link for a scalable and High availability solution we need. Will the
> message be persisted somewhere and delivered to that queue after that
> particular node comes up?
>
> If the message is gonna lost, can we have a workaround that we create copies
> of the queues explicitly on each node. Now since they are copies, the
> exchange will send the message to all the nodes and even if a node is down,
> message will be delivered to all the copies of that queue.

In that case you will lose all the scalability you gained by setting
up a cluster,
the throughput of the whole cluster will be equal to the throughput of the
slowest node. So it's not much different than Active-Passive HA.

If you really need Active-Active HA, you have to wait. We're currently
working on it, but the development can take  a while.

Cheers,
  Marek

From shane at digitalsanctum.com  Tue Nov 30 14:25:32 2010
From: shane at digitalsanctum.com (Shane)
Date: Tue, 30 Nov 2010 06:25:32 -0800 (PST)
Subject: [rabbitmq-discuss] how to prevent this error?
Message-ID: <0ad26201-cd62-49ef-90e1-4db19203f890@n10g2000yqd.googlegroups.com>

I'm guessing the following error happened because there was already a
rabbitmq process running. Is that right? If so, how can I prevent it
from happening in the future?

nyggmspgd73 error: {error_logger,{{2010,11,27},{15,0,43}},"Protocol:
~p:
register error:
~p~n",["inet_tcp",{{badmatch,{error,no_reg_reply_from_epmd}},
[{inet_tcp_di
st,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},
{net_
kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},
{proc_lib,i
nit_p_do_apply,3}]}]}
{error_logger,{{2010,11,27},{15,0,43}},crash_report,[[{initial_call,
{net_k
ernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},
{error_in
fo,{exit,{error,badarg},[{gen_server,init_it,6},
{proc_lib,init_p_do_apply,
3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,
[#Port
<0.93>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},
{statu
s,running},{heap_size,610},{stack_size,24},{reductions,506}],[]]}
{error_logger,{{2010,11,27},{15,0,43}},supervisor_report,[{supervisor,
{loc
al,net_sup}},{errorContext,start_error},{reason,
{'EXIT',nodistribution}},{
offender,[{pid,undefined},{name,net_kernel},{mfargs,
{net_kernel,start_link
,[[rabbitmqctl9111,shortnames]]}},{restart_type,permanent},{shutdown,
2000}
,{child_type,worker}]}]}
{error_logger,{{2010,11,27},{15,0,43}},supervisor_report,[{supervisor,
{loc
al,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,
[{p
id,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},
{re
start_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,11,27},{15,0,43}},std_info,[{application,kernel},
{exi
ted,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,
{shu
tdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump Kernel pid terminated
(application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,
[]]}}})

From matthew at rabbitmq.com  Tue Nov 30 16:08:32 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 16:08:32 +0000
Subject: [rabbitmq-discuss] how to prevent this error?
In-Reply-To: <0ad26201-cd62-49ef-90e1-4db19203f890@n10g2000yqd.googlegroups.com>
References: <0ad26201-cd62-49ef-90e1-4db19203f890@n10g2000yqd.googlegroups.com>
Message-ID: <20101130160832.GM21718@rabbitmq.com>

On Tue, Nov 30, 2010 at 06:25:32AM -0800, Shane wrote:
> I'm guessing the following error happened because there was already a
> rabbitmq process running. Is that right? If so, how can I prevent it
> from happening in the future?

No, it looks more like rabbit can't contact epmd. Can your Rabbit
nodename be resolved by your computer?

Matthew

From jon.brisbin at npcinternational.com  Tue Nov 30 16:14:20 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 30 Nov 2010 10:14:20 -0600
Subject: [rabbitmq-discuss] Should I upgrade all clients if I upgrade
	the server to 2.2.0
In-Reply-To: <20101130151036.GL21718@rabbitmq.com>
References: <AANLkTi=Nu7kVNdzizu91EmBoEzfQ9zO6pyWu834qtmP8@mail.gmail.com>
	<20101130141553.GF21718@rabbitmq.com>
	<8FDD8024-7305-4EFC-9D96-C9368CCDCC2E@npcinternational.com>
	<20101130143844.GI21718@rabbitmq.com>
	<D9147D6D-4C4B-4517-8676-7A8BB1BE26CC@npcinternational.com>
	<20101130151036.GL21718@rabbitmq.com>
Message-ID: <2849E4E6-EC2B-41E7-A1D0-FC9CC80F5B34@npcinternational.com>


On Nov 30, 2010, at 9:10 AM, Matthew Sackman wrote:

> It thinks you're running in a cluster. Is that correct?

Yes.

> In fact, I think
> it thinks it's a slave node in a cluster and that the master node has
> been upgraded.

That's actually not correct. I upgraded the slave first, as I always do (it's our backup box...it gets updates first).

> If so, the behaviour is "correct" - we don't support
> upgrades in a cluster yet (as the release notes say), so moving the old
> database out of the way is the right thing to do.

Bummer.

It's not a huge deal, as we just recreate things. But that causes us to not keep up-to-date on some brokers. I still have 1.8 brokers because I haven't wanted to take them down, upgrade them, then reconfigure everything I had (hoping I remember how I did it ;).

Jon Brisbin
Portal Webmaster
NPC International, Inc.




From csharp4me at gmail.com  Tue Nov 30 16:45:34 2010
From: csharp4me at gmail.com (Dave Gorman)
Date: Tue, 30 Nov 2010 10:45:34 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 Release
In-Reply-To: <5bf8b8e358791cfa64b32e709f429bc4@rabbitmq.com>
References: <5bf8b8e358791cfa64b32e709f429bc4@rabbitmq.com>
Message-ID: <AANLkTim0bGT_e3gXksCEWBrPxJdi6V2JfcQQ6bYNF16K@mail.gmail.com>

You guys are awesome!

Monthly releases mean you guys stay very busy.

Thank you for all your hard work.

-dg

On Tue, Nov 30, 2010 at 5:19 AM, Rob Harrop <rob at rabbitmq.com> wrote:
> The RabbitMQ team is delighted to announce the release of RabbitMQ
> 2.2.0.
>
> This release fixes a number of bugs and introduces some enhancements,
> including automatic upgrades of non-clustered brokers, per-queue
> message TTLs and significantly reduced memory usage for pending
> acknowledgements.
>
> See the attached release notes for more details.
>
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
>
> Regards,
> ? ? ? ?The RabbitMQ Team
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From clegnitto at mozilla.com  Tue Nov 30 17:43:49 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Tue, 30 Nov 2010 09:43:49 -0800
Subject: [rabbitmq-discuss] Routing key questions/suggestions
Message-ID: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>

I have a couple of quick questions/suggestions about routing keys. I guess this is more AMQP-specific, but this list is as good as any to discuss ;-)

1. Why use "." as the routing token separator? Can we make it configurable on the broker? Can we support sending a magic X-AMQP-ROUTING-SEPERATOR or something header with the message so it can be anything and vary by message?
	* It seems like an odd choice to use a character that will show up in data a lot
	* All publishers need to sanitize and all consumers need to translate back
		* Consumers could always use "#", but then they could potentially match items they aren't expecting
		* If consumers use "*" and the data has a period, they may not match when they expect

Example:

I'm listening to commit messages from GitHub. My binding is github.push.*.mycoolproject, which means I want to listen to all push messages by anyone for a project named mycoolproject. If someone's github username has a period in it though, I won't see the messages (github.push.john.smith.mycoolproject). If I bound with github.push.#.mycoolproject I would see the previous message, but I might also get messages for other projects with GitHub users that have mycoolproject in their username (github.push.this.is.mycoolproject.user.project2). I know this isn't the best example, but I'm sick and my head is a bit murky ha.

2. Are there are future plans to publish a message with multiple routing keys?
	* I know I can publish the same message multiple times with different routing keys, seems inefficient
	* I may want to surface the message data in various useful ways into the routing key

Example:

For bugzilla messages, when someone changes a bug I send a bug.changed.[field] message. Many tools want to pivot on specific users though. It'd be nice to publish them also as bzuser at example.com.changed.bug so those tools don't have to listen to all changes and group by user themselves, which seems very inefficient.

If these should be taken up by the AMQP list/working group let me know and I'll try to bring them up in the correct place.

Thanks,
Christian

From matthew at rabbitmq.com  Tue Nov 30 18:06:19 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 18:06:19 +0000
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>
Message-ID: <20101130180619.GN21718@rabbitmq.com>

On Tue, Nov 30, 2010 at 09:43:49AM -0800, Christian Legnitto wrote:
> 1. Why use "." as the routing token separator?

Well, something has to be chosen, and whatever is chosen is going to be
inconvenient for someone. I don't know whether there was some reason to
choose . over anything else.

> Can we make it configurable on the broker?

Well, it's only code. Having had a quick look through, it seems like the
splitting is currently only done at the use point. So I reckon maybe the
only change that's needed is in rabbit_exchange_type_topic.erl, change
the split_topic_key/1 fun to split on whatever you want.

> Can we support sending a magic X-AMQP-ROUTING-SEPERATOR or something
> header with the message so it can be anything and vary by message?

Erm that would be substantially more complex.

> 	* It seems like an odd choice to use a character that will show
> 	up in data a lot

True. Maybe , would be a better choice given most programming languages
use , to separate list elements anyway.

> Example:
> 
> I'm listening to commit messages from GitHub. My binding is
> github.push.*.mycoolproject, which means I want to listen to all push
> messages by anyone for a project named mycoolproject. If someone's
> github username has a period in it though, I won't see the messages
> (github.push.john.smith.mycoolproject). If I bound with
> github.push.#.mycoolproject I would see the previous message, but I
> might also get messages for other projects with GitHub users that have
> mycoolproject in their username
> (github.push.this.is.mycoolproject.user.project2). I know this isn't
> the best example, but I'm sick and my head is a bit murky ha.

Yeah, I know the feeling :/ As I said, _any_ choice is ultimately going
to collide with something else so you're always going to have to do some
sort of encoding / escaping yourself. It looks like AMQP doesn't support
any sort of escaping to prevent the . being interpreted as a semantic .
so you really are going to have to do translation to something other
than .

If, in your case, there is no character that cannot appear in a github
username (and I'd hope not - surely the whole web supports every unicode
code point by now...) then you're just not going to be able to solve
this. This possibly points to AMQP needing to change to support escaping
of . with a \

> 2. Are there are future plans to publish a message with multiple routing keys?

Not that I'm aware of.

> 	* I know I can publish the same message multiple times with different routing keys, seems inefficient

Indeed.

> For bugzilla messages, when someone changes a bug I send a
> bug.changed.[field] message. Many tools want to pivot on specific
> users though. It'd be nice to publish them also as
> bzuser at example.com.changed.bug so those tools don't have to listen to
> all changes and group by user themselves, which seems very
> inefficient.

You could put _everything_ in the routing key.
$USER.$BUG_NUMBER.$FIELD
and then the different tools just need to choose where to put # and *.
If you prefix each field value with the field name then it ensures that
such binding keys can anchor in the right place which is useful when the
range of fields overlap. Eg QA and Assign fields - if you were trying to
match changes by me to bugs, you'd be ill-advised to just do #.matthew.#
given that that would match changes _not_ by me but for bugs where I'm
the QA or assignee. Thus a key of:

user.matthew.bug.12345.qa.matthew.assignee.matthew.field.status

then allows a much more precise match of #.qa.matthew.# for example.

Matthew

From matthias at rabbitmq.com  Tue Nov 30 18:55:48 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 30 Nov 2010 18:55:48 +0000
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <20101130180619.GN21718@rabbitmq.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>
	<20101130180619.GN21718@rabbitmq.com>
Message-ID: <4CF548B4.1060506@rabbitmq.com>

Christian,

Matthew Sackman wrote:
>> 2. Are there are future plans to publish a message with multiple routing keys?
> 
> Not that I'm aware of.

Actually there are, partially based on your earlier emails :)

Though I'd call them 'ideas' rather than 'plans' at this stage.


Matthias.

From matthew at rabbitmq.com  Tue Nov 30 21:53:07 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 21:53:07 +0000
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <20101130180619.GN21718@rabbitmq.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>
	<20101130180619.GN21718@rabbitmq.com>
Message-ID: <20101130215306.GA31339@wellquite.org>

On Tue, Nov 30, 2010 at 06:06:19PM +0000, Matthew Sackman wrote:
> On Tue, Nov 30, 2010 at 09:43:49AM -0800, Christian Legnitto wrote:
> > 1. Why use "." as the routing token separator?
> 
> Well, something has to be chosen, and whatever is chosen is going to be
> inconvenient for someone. I don't know whether there was some reason to
> choose . over anything else.

Actually, I reckon any of 0x1C to 0x1F in C0 are designed for this.
Probably 0x1F being the best idea, given:

"Can be used as delimiters to mark fields of data structures. If used
for hierarchical levels, US is the lowest level (dividing plain-text
data items), while RS, GS, and FS are of increasing level to divide
groups made up of items of the level beneath it."[0]

Matthew

[0] http://en.wikipedia.org/wiki/Group_separator

From michael at ndrix.org  Tue Nov 30 21:29:18 2010
From: michael at ndrix.org (Michael Hendricks)
Date: Tue, 30 Nov 2010 14:29:18 -0700
Subject: [rabbitmq-discuss] upgrading from 2.1.0 to 2.2.0 on Debian
Message-ID: <AANLkTimvM4CnAXbDZgEfcksOqEthHqwzpkxQ7zoBqa2-@mail.gmail.com>

The release notes for 2.2.0 [1] say that one should upgrade from 2.1.0 to
2.1.1 first.  My RabbitMQ server is running on a Debian machine, but I don't
see the .deb files for 2.1.1 anymore.  Can someone point me in the right
direction.

Thanks.

-- 
Michael

1 -
http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2010-November/000031.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101130/e2aefe2c/attachment.htm>

From matthew at rabbitmq.com  Tue Nov 30 22:22:57 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Nov 2010 22:22:57 +0000
Subject: [rabbitmq-discuss] upgrading from 2.1.0 to 2.2.0 on Debian
In-Reply-To: <AANLkTimvM4CnAXbDZgEfcksOqEthHqwzpkxQ7zoBqa2-@mail.gmail.com>
References: <AANLkTimvM4CnAXbDZgEfcksOqEthHqwzpkxQ7zoBqa2-@mail.gmail.com>
Message-ID: <20101130222256.GC31339@wellquite.org>

On Tue, Nov 30, 2010 at 02:29:18PM -0700, Michael Hendricks wrote:
> The release notes for 2.2.0 [1] say that one should upgrade from 2.1.0 to
> 2.1.1 first.  My RabbitMQ server is running on a Debian machine, but I don't
> see the .deb files for 2.1.1 anymore.  Can someone point me in the right
> direction.

http://www.rabbitmq.com/releases/rabbitmq-server/v2.1.1/

They're not the actual debs that were shipped within Debian (the Debian
maintainer for RabbitMQ rebuilds the debs) but they're close enough and
will serve the purpose of upgrading you to 2.1.1.

Matthew

From david at rabbitmq.com  Tue Nov 30 22:23:14 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 30 Nov 2010 22:23:14 +0000
Subject: [rabbitmq-discuss] upgrading from 2.1.0 to 2.2.0 on Debian
In-Reply-To: <AANLkTimvM4CnAXbDZgEfcksOqEthHqwzpkxQ7zoBqa2-@mail.gmail.com>
	(Michael Hendricks's message of "Tue, 30 Nov 2010 14:29:18 -0700")
References: <AANLkTimvM4CnAXbDZgEfcksOqEthHqwzpkxQ7zoBqa2-@mail.gmail.com>
Message-ID: <yrv4cipzesb71.fsf@dwragg.eng.vmware.com>

Hi Michael,

Michael Hendricks <michael at ndrix.org> writes:
> The release notes for 2.2.0 [1] say that one should upgrade from 2.1.0 to
> 2.1.1 first.  My RabbitMQ server is running on a Debian machine, but I don't
> see the .deb files for 2.1.1 anymore.  Can someone point me in the right
> direction.

All released versions of rabbitmq-server can be found at
<http://www.rabbitmq.com/releases/rabbitmq-server/>.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

