<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Does SSD improve rabbitmq's performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Does%20SSD%20improve%20rabbitmq%27s%20performance&In-Reply-To=%3CCAJ4uuZbN6MAv7F_qiaGfA%2Bhuaa5t6bZorRDyDn2NOgw9iU8tig%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032032.html">
   <LINK REL="Next"  HREF="032036.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Does SSD improve rabbitmq's performance</H1>
    <B>Graeme N</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Does%20SSD%20improve%20rabbitmq%27s%20performance&In-Reply-To=%3CCAJ4uuZbN6MAv7F_qiaGfA%2Bhuaa5t6bZorRDyDn2NOgw9iU8tig%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Does SSD improve rabbitmq's performance">graeme at sudo.ca
       </A><BR>
    <I>Wed Nov 20 19:10:22 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032032.html">[rabbitmq-discuss] Does SSD improve rabbitmq's performance
</A></li>
        <LI>Next message: <A HREF="032036.html">[rabbitmq-discuss] Does SSD improve rabbitmq's performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32035">[ date ]</a>
              <a href="thread.html#32035">[ thread ]</a>
              <a href="subject.html#32035">[ subject ]</a>
              <a href="author.html#32035">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Nov 20, 2013 at 12:11 AM, Matthias Radestock
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt;wrote:

&gt;<i> On 20/11/13 04:38, Graeme N wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Rabbit at the moment doesn't make much effort into making its
</I>&gt;&gt;<i> workload append only and contiguous by default
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Actually all disk writes in rabbit *are* append-only (plus the occasional
</I>&gt;<i> truncate). But when dealing with multiple disk-bound queues, there is
</I>&gt;<i> inevitably a fair bit of seeking going on. And SSDs are much quicker at
</I>&gt;<i> that.
</I>&gt;<i>
</I>

Well, I guess that multiple small files, even if they are individually
written as append only, doesn't really qualify as an append-only workload
in the sense I'd normally think of it. The reason to use an append-only
workload is to ensure it performs well on spinning disks by avoiding seeks.
Looking at the files under
/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at hostname</A>/msg_store_persistent
on our busiest host, and we see ~390 files, all &lt;= 17 MiB. Compare to MySQL
or Riak, where we split the InnoDB or Bitcask append-only logs at 500 MiB,
which is chosen so it fits inside of our hardware RAID controllers' BBU
caches.

Our big messages in RabbitMQ are 500kiB to 4MiB, so each of these 16 MiB
chunks only stores ~10 of these messages, which is far smaller than our
typical batch size of ~100 messages. Relatively speaking, this is a ton
more overhead in many small files than we typically see in other datastores
that bill themselves as spinning disk friendly / append only. When you
consider that those other data stores use a single set of append-only logs
for all queues/tables/buckets in the system, and rabbit seems to be
segmenting them based on queue, it means that rabbit's workload contains at
least an order of magnitude more seeks when busy than these other storage
engines.

So, while rabbit's workload at the file chunk level may technically be
append only, it doesn't actually seem to avoid seeks in its workload, and
we tend to see pretty massive persistent queue performance improvements by
using SSDs. Thus, I wouldn't really consider its workload in the same class
as most append-only storage systems.

Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/f9fa1982/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/f9fa1982/attachment.htm</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032032.html">[rabbitmq-discuss] Does SSD improve rabbitmq's performance
</A></li>
	<LI>Next message: <A HREF="032036.html">[rabbitmq-discuss] Does SSD improve rabbitmq's performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32035">[ date ]</a>
              <a href="thread.html#32035">[ thread ]</a>
              <a href="subject.html#32035">[ subject ]</a>
              <a href="author.html#32035">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
