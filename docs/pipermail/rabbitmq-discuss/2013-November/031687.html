<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Outage%20with%203-node%20RabbitMQ%203.1.3%20Cluster&In-Reply-To=%3CCAOHkZxOYjFQOB2xW0E921SJiag3oh0m6%2BR9qbu%3DgWxwa%2BYTXLg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031754.html">
   <LINK REL="Next"  HREF="031712.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster</H1>
    <B>Matt Wise</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Outage%20with%203-node%20RabbitMQ%203.1.3%20Cluster&In-Reply-To=%3CCAOHkZxOYjFQOB2xW0E921SJiag3oh0m6%2BR9qbu%3DgWxwa%2BYTXLg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster">matt at nextdoor.com
       </A><BR>
    <I>Tue Nov  5 22:05:28 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031754.html">[rabbitmq-discuss] Durable Queues Crash
</A></li>
        <LI>Next message: <A HREF="031712.html">[rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31687">[ date ]</a>
              <a href="thread.html#31687">[ thread ]</a>
              <a href="subject.html#31687">[ subject ]</a>
              <a href="author.html#31687">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(sorry if this gets posted twice.. first email never seemed to make it to
the list)

Hey... I had a pretty rough time today with a 3-node RabbitMQ 3.1.3 cluster
thats under pretty heavy use (6-7 million messages per day -- 100MB peak
bandwidth per node). I want to pose a few questions here. First off, here's
the basic configuration though.

Configuration:
  serverA, serverB and serverC are all configured with RabbitMQ 3.1.3. They
each are configured via Puppet ... and Puppet uses a dynamic node discovery
plugin (zookeeper) to find the nodes. The node lists are hard-coded into
the rabbitmq.config file. A dynamic server list generator supplies Puppet
with this list of servers (and is not really necessary to describe here in
this email).

Scenario:
  A momentary configuration blip caused serverA and serverB to begin
reconfiguring their rabbitmq.config files... when they did this, they also
both issued a 'service rabbitmq restart' command. This command took
40+minutes and ultimately failed. During this failure, RabbitMQ was
technically running and accepting connections to the TCP ports ... but it
would not actually answer any queries. Commands like list_queues would hang
indefinitely.

Questions:
  1. We only had ~2500 messages in the queues (they are HA'd and durable).
The policy is { 'ha-mode': 'all' }. When serverA and serverB restarted, why
did they never come up? Unfortunately in the restart process, they blew
away their log files as well which makes this really tough to troubleshoot.

  2. I know that restarting serverA and serverB at nearly the same time is
obviously a bad idea -- we'll be implementing some changes so this doesn't
happen again -- but could this have lead to data corruption? Once the
entire RabbitMQ farm was shut down, we actually were forced to move the
rabbitmq data directory out of the way and start up the farm completely
with blank databases. It seemed that RabbitMQ 3.1.3 really did not want to
recover from this failure. Any thoughts?

  3. Lastly .. in the event of future failures, what tools are there for
recovering our Mnesia databases? Is there any way we can dump out the data
into some raw form, and then import it back into a new fresh cluster?

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/f64c2f36/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/f64c2f36/attachment.htm</A>&gt;
</PRE>








































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031754.html">[rabbitmq-discuss] Durable Queues Crash
</A></li>
	<LI>Next message: <A HREF="031712.html">[rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31687">[ date ]</a>
              <a href="thread.html#31687">[ thread ]</a>
              <a href="subject.html#31687">[ subject ]</a>
              <a href="author.html#31687">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
