<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Excessive RabbitMQ memory consumption
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Excessive%20RabbitMQ%20memory%20consumption&In-Reply-To=%3C528DF86A.70601%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032046.html">
   <LINK REL="Next"  HREF="032060.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Excessive RabbitMQ memory consumption</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Excessive%20RabbitMQ%20memory%20consumption&In-Reply-To=%3C528DF86A.70601%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Excessive RabbitMQ memory consumption">simon at rabbitmq.com
       </A><BR>
    <I>Thu Nov 21 12:11:22 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032046.html">[rabbitmq-discuss] Excessive RabbitMQ memory consumption
</A></li>
        <LI>Next message: <A HREF="032060.html">[rabbitmq-discuss] Excessive RabbitMQ memory consumption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32055">[ date ]</a>
              <a href="thread.html#32055">[ thread ]</a>
              <a href="subject.html#32055">[ subject ]</a>
              <a href="author.html#32055">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/11/13 02:47, Matt Pietrek wrote:
&gt;<i> The management database at 1.3GB seems excessive.
</I>
To add to what Michael said: yes, this is excessive. Almost certainly 
one of the leaks we've fixed since 3.0.2.

As a rule of thumb I would expect the management DB to take about as 
much memory as Mnesia. Certainly within an order of magnitude anyway.

I'm reluctant to get into tracking down exactly which old bug you are 
seeing :-) but there were definitely leaks in 3.0.2 such that:

* Connection and channel data was never cleaned up for nodes that crashed

* Consumer records might not be cleaned up

* Fine stats were issued for queue slaves and never cleaned up even when 
the queue was deleted

If you can't upgrade, in addition to the suggestions Michael made 
(increase the stats interval or disable the management plugin) there's a 
halfway house: disable fine stats collection 
(<A HREF="http://previous.rabbitmq.com/v3_0_x/management.html#fine-stats">http://previous.rabbitmq.com/v3_0_x/management.html#fine-stats</A>). This 
will stop you seeing message rates but will prevent some of those leaks.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032046.html">[rabbitmq-discuss] Excessive RabbitMQ memory consumption
</A></li>
	<LI>Next message: <A HREF="032060.html">[rabbitmq-discuss] Excessive RabbitMQ memory consumption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32055">[ date ]</a>
              <a href="thread.html#32055">[ thread ]</a>
              <a href="subject.html#32055">[ subject ]</a>
              <a href="author.html#32055">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
