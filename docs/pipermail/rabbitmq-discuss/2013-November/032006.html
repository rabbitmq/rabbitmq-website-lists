<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 3.2.0 keeps crashing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%203.2.0%20keeps%20crashing&In-Reply-To=%3CCA%2BMBRY%2BUzhWWe8Bvq3Fuj1pEwztjdwAp9aB5_JWU9C%2Bf%2BmpzGQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032007.html">
   <LINK REL="Next"  HREF="032012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 3.2.0 keeps crashing</H1>
    <B>Lauri Fj&#228;llstr&#246;m</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%203.2.0%20keeps%20crashing&In-Reply-To=%3CCA%2BMBRY%2BUzhWWe8Bvq3Fuj1pEwztjdwAp9aB5_JWU9C%2Bf%2BmpzGQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 3.2.0 keeps crashing">lauri.fjallstrom at gmail.com
       </A><BR>
    <I>Tue Nov 19 05:31:01 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032007.html">[rabbitmq-discuss] Issue in sending binary data using amqp_basic_publish API.
</A></li>
        <LI>Next message: <A HREF="032012.html">[rabbitmq-discuss] RabbitMQ 3.2.0 keeps crashing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32006">[ date ]</a>
              <a href="thread.html#32006">[ thread ]</a>
              <a href="subject.html#32006">[ subject ]</a>
              <a href="author.html#32006">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm running two RabbitMQ nodes in a cluster on Ubuntu 12.04. I have a
virtual host there and a ha policy for a queue. Both nodes are disc nodes.
During the last 24 hours RabbitMQ crashed twice. Producers are able to
continue publishing messages but they don't end up routed or something.
rabbitmqctl list_queues does not list the queue. In the HTTP management
console the queue is listed but the page only shows:

TypeError: Cannot read property 'ram_msg_count' of undefined
TypeError: Cannot read property 'ram_msg_count' of undefined

There should not anything special going on on the servers. Also, they are
not under heavy load or something.

After the last crash the log file on both nodes were empty. Unfortunately I
didn't backup the logs after the first crashes. I was able to find the
following information in xxx-sasl.log:

=CRASH REPORT==== 19-Nov-2013::04:17:22 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.259.0&gt;
    registered_name: []
    exception exit: {{badmatch,{error,not_found}},
                     [{rabbit_mirror_queue_master,stop_all_slaves,2},
                      {rabbit_mirror_queue_master,delete_and_terminate,2},

{rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6},
                      {rabbit_amqqueue_process,terminate_shutdown,2},
                      {gen_server2,terminate,3},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.192.0&gt;]
    messages: []
    links: [&lt;0.257.0&gt;,&lt;0.452.0&gt;,#Port&lt;0.13309&gt;]
    dictionary: [{delegate,delegate_15},
                  {{credit_to,&lt;0.788.0&gt;},20},
                  {{#Ref&lt;0.0.0.1271&gt;,fhc_handle},
                   {handle,{file_descriptor,prim_file,{#Port&lt;0.13309&gt;,20}},
                           774680,false,0,infinity,[],true,
                           &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1-api-test</A>
/queues/B1433I2VYA7YIS4WJY5I6NO4R/journal.jif&quot;,
                           [write,binary,raw,read],
                           [{write_buffer,infinity}],
                           true,true,
                           {1384,827437,174496}}},
                  {{credit_to,&lt;0.563.0&gt;},1},
                  {fhc_age_tree,{1,
                                 {{1384,827437,174496},
                                  #Ref&lt;0.0.0.1271&gt;,nil,nil}}},
                  {{&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1-api-test</A>
/queues/B1433I2VYA7YIS4WJY5I6NO4R/journal.jif&quot;,
                    fhc_file},
                   {file,1,true}},
                  {credit_blocked,[]},
                  {{ch,&lt;0.8244.0&gt;},
                   {cr,&lt;0.8244.0&gt;,#Ref&lt;0.0.10.78984&gt;,
                       {[],[]},
                       1,
                       {queue,[],[],0},
                       {qstate,&lt;0.8243.0&gt;,active,{0,nil}},
                       25}},
                  {{ch,&lt;0.8274.0&gt;},
                   {cr,&lt;0.8274.0&gt;,#Ref&lt;0.0.10.91831&gt;,
                       {[],[]},
                       1,
                       {queue,[],[],0},
                       {qstate,&lt;0.8273.0&gt;,active,{0,nil}},
                       49}},
                  {{credit_to,&lt;0.13668.0&gt;},41},
                  {guid,{{1330803274,3383937130,2004047782,2434038047},1}},
                  {{credit_from,&lt;0.251.0&gt;},1826}]
    trap_exit: true
    status: running
    heap_size: 10946
    stack_size: 24
    reductions: 1514324983
  neighbours:
    neighbour: [{pid,&lt;0.453.0&gt;},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[&lt;0.452.0&gt;,&lt;0.259.0&gt;,rabbit_amqqueue_sup,
                              rabbit_sup,&lt;0.192.0&gt;]},
                  {messages,[]},
                  {links,[&lt;0.452.0&gt;]},
                  {dictionary,[{random_seed,{24781,9822,29460}}]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,610},
                  {stack_size,7},
                  {reductions,660407699}]
    neighbour: [{pid,&lt;0.452.0&gt;},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[&lt;0.259.0&gt;,rabbit_amqqueue_sup,rabbit_sup,
                              &lt;0.192.0&gt;]},
                  {messages,[]},
                  {links,[&lt;0.259.0&gt;,&lt;0.453.0&gt;]},
                  {dictionary,[]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,2584},
                  {stack_size,7},
                  {reductions,59821}]

=SUPERVISOR REPORT==== 19-Nov-2013::04:17:22 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,{error,not_found}},
                  [{rabbit_mirror_queue_master,stop_all_slaves,2},
                   {rabbit_mirror_queue_master,delete_and_terminate,2},
                   {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6},
                   {rabbit_amqqueue_process,terminate_shutdown,2},
                   {gen_server2,terminate,3},
                   {proc_lib,wake_up,3}]}
     Offender:   [{pid,&lt;0.259.0&gt;},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 19-Nov-2013::04:30:20 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.13842.0&gt;
    registered_name: []
    exception exit: {{badmatch,true},
                     [{rabbit_queue_index,init,2},
                      {rabbit_variable_queue,init,5},
                      {rabbit_mirror_queue_master,init,3},
                      {rabbit_amqqueue_process,declare,3},
                      {gen_server2,handle_msg,2},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.192.0&gt;]
    messages: []
    links: [&lt;0.257.0&gt;]
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct}]
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 1224
  neighbours:

=SUPERVISOR REPORT==== 19-Nov-2013::04:30:20 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,true},
                  [{rabbit_queue_index,init,2},
                   {rabbit_variable_queue,init,5},
                   {rabbit_mirror_queue_master,init,3},
                   {rabbit_amqqueue_process,declare,3},
                   {gen_server2,handle_msg,2},
                   {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,&lt;0.13842.0&gt;},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]



I have no clue what's going on here. Can anyone give me a hint?

Best Regards,
Lauri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/f581acb0/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/f581acb0/attachment.htm</A>&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032007.html">[rabbitmq-discuss] Issue in sending binary data using amqp_basic_publish API.
</A></li>
	<LI>Next message: <A HREF="032012.html">[rabbitmq-discuss] RabbitMQ 3.2.0 keeps crashing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32006">[ date ]</a>
              <a href="thread.html#32006">[ thread ]</a>
              <a href="subject.html#32006">[ subject ]</a>
              <a href="author.html#32006">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
