<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Durable Queues Crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Durable%20Queues%20Crash&In-Reply-To=%3CE6DE9F52-AB49-4234-AF62-EC56747C338D%40eventbrite.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031689.html">
   <LINK REL="Next"  HREF="031695.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Durable Queues Crash</H1>
    <B>Jonathan Cua</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Durable%20Queues%20Crash&In-Reply-To=%3CE6DE9F52-AB49-4234-AF62-EC56747C338D%40eventbrite.com%3E"
       TITLE="[rabbitmq-discuss] Durable Queues Crash">jcua at eventbrite.com
       </A><BR>
    <I>Wed Nov  6 01:14:58 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031689.html">[rabbitmq-discuss] Durable Queues Crash
</A></li>
        <LI>Next message: <A HREF="031695.html">[rabbitmq-discuss] Durable Queues Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31690">[ date ]</a>
              <a href="thread.html#31690">[ thread ]</a>
              <a href="subject.html#31690">[ subject ]</a>
              <a href="author.html#31690">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just to clarify, these crashes happens over and over, but we can't figure out what causes it or when the next crash will happen, all we are doing is running Celery as the consumer like usual. In the past we are using Rabbitmq 2.8.7 (Ubuntu 10.04) and we do not see this issue at all.

Actually looking at the sasl.log again, I see this prior to the first crash.

=CRASH REPORT==== 5-Nov-2013::12:31:47 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.13824.12&gt;
    registered_name: []
    exception exit: {{badmatch,{error,not_found}},
                     [{rabbit_mirror_queue_master,stop_all_slaves,2},
                      {rabbit_mirror_queue_master,delete_and_terminate,2},
                      {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6},
                      {rabbit_amqqueue_process,terminate_shutdown,2},
                      {gen_server2,terminate,3},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.4763.12&gt;]
    messages: []
    links: [&lt;0.4951.12&gt;,&lt;0.13825.12&gt;,#Port&lt;0.149843&gt;]
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct},
                  {delegate,delegate_1},
                  {{ch,&lt;22460.3466.13&gt;},
                   {cr,&lt;22460.3466.13&gt;,#Ref&lt;0.0.8.129430&gt;,
                       {[13247,13244],[13229,13232]},
                       1,
...

trap_exit: true
    status: running
    heap_size: 317811
    stack_size: 24
    reductions: 12808667
  neighbours:
    neighbour: [{pid,&lt;0.13826.12&gt;},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[&lt;0.13825.12&gt;,&lt;0.13824.12&gt;,rabbit_amqqueue_sup,
                              rabbit_sup,&lt;0.4763.12&gt;]},
                  {messages,[]},
                  {links,[&lt;0.13825.12&gt;]},
                  {dictionary,[{random_seed,{1383,15776,4002}}]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,610},
                  {stack_size,7},
                  {reductions,10939697}]
    neighbour: [{pid,&lt;0.13825.12&gt;},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[&lt;0.13824.12&gt;,rabbit_amqqueue_sup,rabbit_sup,
                              &lt;0.4763.12&gt;]},
                  {messages,[]},
                  {links,[&lt;0.13824.12&gt;,&lt;0.13826.12&gt;]},
                  {dictionary,[]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,610},
                  {stack_size,7},
                  {reductions,1868}]

=SUPERVISOR REPORT==== 5-Nov-2013::12:31:47 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,{error,not_found}},
                  [{rabbit_mirror_queue_master,stop_all_slaves,2},
                   {rabbit_mirror_queue_master,delete_and_terminate,2},
                   {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6},
                   {rabbit_amqqueue_process,terminate_shutdown,2},
                   {gen_server2,terminate,3},
                   {proc_lib,wake_up,3}]}
     Offender:   [{pid,&lt;0.13824.12&gt;},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


And sometimes we would get this variation of another 'crash'...

=CRASH REPORT==== 5-Nov-2013::14:47:59 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.2803.0&gt;
    registered_name: []
    exception exit: {function_clause,
                        [{rabbit_mirror_queue_slave,forget_sender,
                             [down_from_gm,down_from_gm]},
                         {rabbit_mirror_queue_slave,maybe_forget_sender,3},
                         {rabbit_mirror_queue_slave,process_instruction,2},
                         {rabbit_mirror_queue_slave,handle_cast,2},
                         {gen_server2,handle_msg,2},
                         {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_mirror_queue_slave_sup,rabbit_sup,&lt;0.99.0&gt;]
    messages: [{'EXIT',&lt;0.2804.0&gt;,normal},
                  {'DOWN',
                      {delegate_9,&lt;22460.25536.1&gt;},
                      process,&lt;22460.25536.1&gt;,noproc},
                  {'$gen_cast',
                      {run_backing_queue,rabbit_variable_queue,
                          #Fun&lt;rabbit_variable_queue.26.70600163&gt;}},
                  {'$gen_cast',
                      {run_backing_queue,rabbit_variable_queue,
                          #Fun&lt;rabbit_variable_queue.27.5764429&gt;}}]
    links: [&lt;0.297.0&gt;]
    dictionary: [{credit_blocked,[]},
                  {{xtype_to_module,direct},rabbit_exchange_type_direct},
                  {delegate,delegate_9},
                  {fhc_age_tree,{0,nil}},
                  {{credit_from,&lt;0.289.0&gt;},1902},
                  {guid,{{1685981799,1034401634,624789925,1597815233},1}}]
    trap_exit: true
    status: running
    heap_size: 6765
    stack_size: 24
    reductions: 121868
  neighbours:

=SUPERVISOR REPORT==== 5-Nov-2013::14:47:59 ===
     Supervisor: {local,
                                           rabbit_mirror_queue_slave_sup}
     Context:    child_terminated
     Reason:     {function_clause,
                     [{rabbit_mirror_queue_slave,forget_sender,
                          [down_from_gm,down_from_gm]},
                      {rabbit_mirror_queue_slave,maybe_forget_sender,3},
                      {rabbit_mirror_queue_slave,process_instruction,2},
                      {rabbit_mirror_queue_slave,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,wake_up,3}]}
     Offender:   [{pid,&lt;0.2803.0&gt;},
                  {name,rabbit_mirror_queue_slave},
                  {mfargs,{rabbit_mirror_queue_slave,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


Thanks,
Jonathan


On Nov 5, 2013, at 3:47 PM, Jonathan Cua wrote:

&gt;<i> No, the nodes did not get restarted.
</I>&gt;<i> 
</I>&gt;<i> There is nothing in the sasl logs prior to the ones that I posted.
</I>&gt;<i> 
</I>&gt;<i> Jonathan
</I>&gt;<i> 
</I>&gt;<i> On Nov 5, 2013, at 3:33 PM, Matthias Radestock wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Jonathan,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On 05/11/13 21:24, Jonathan Cua wrote:
</I>&gt;&gt;&gt;<i> From time to time (around a couple of hours after the cluster has been
</I>&gt;&gt;&gt;<i> set up), I would get this error in the sasl.log. [...]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Did either of the two nodes get restarted during those two hours?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Also, do you see any errors in the sasl logs prior to the ones you posted?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Matthias.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/6d52297d/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/6d52297d/attachment.htm</A>&gt;
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031689.html">[rabbitmq-discuss] Durable Queues Crash
</A></li>
	<LI>Next message: <A HREF="031695.html">[rabbitmq-discuss] Durable Queues Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31690">[ date ]</a>
              <a href="thread.html#31690">[ thread ]</a>
              <a href="subject.html#31690">[ subject ]</a>
              <a href="author.html#31690">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
