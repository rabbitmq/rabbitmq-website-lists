<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Durable Queues Crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Durable%20Queues%20Crash&In-Reply-To=%3C948F60AA-9750-4942-91A2-58FFB2330E16%40eventbrite.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031702.html">
   <LINK REL="Next"  HREF="031688.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Durable Queues Crash</H1>
    <B>Jonathan Cua</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Durable%20Queues%20Crash&In-Reply-To=%3C948F60AA-9750-4942-91A2-58FFB2330E16%40eventbrite.com%3E"
       TITLE="[rabbitmq-discuss] Durable Queues Crash">jcua at eventbrite.com
       </A><BR>
    <I>Tue Nov  5 21:24:11 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031702.html">[rabbitmq-discuss] Rabbitmq upgrade from 3.1.3 to 3.1.5/3.2.0 Management issue
</A></li>
        <LI>Next message: <A HREF="031688.html">[rabbitmq-discuss] Durable Queues Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31686">[ date ]</a>
              <a href="thread.html#31686">[ thread ]</a>
              <a href="subject.html#31686">[ subject ]</a>
              <a href="author.html#31686">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am evaluating Rabbitmq 3.2.0 in Ubuntu 12.04. I have set up a 2 node cluster.

From time to time (around a couple of hours after the cluster has been set up), I would get this error in the sasl.log. Note: I am not able to reproduce this issue.

=CRASH REPORT==== 5-Nov-2013::12:34:51 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.6024.14&gt;
    registered_name: []
    exception exit: {{badmatch,true},
                     [{rabbit_queue_index,init,2},
                      {rabbit_variable_queue,init,5},
                      {rabbit_mirror_queue_master,init,3},
                      {rabbit_amqqueue_process,declare,3},
                      {gen_server2,handle_msg,2},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.4763.12&gt;]
    messages: []
    links: [&lt;0.4951.12&gt;]
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct}]
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 1198
  neighbours:

=SUPERVISOR REPORT==== 5-Nov-2013::12:34:51 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,true},
                  [{rabbit_queue_index,init,2},
                   {rabbit_variable_queue,init,5},
                   {rabbit_mirror_queue_master,init,3},
                   {rabbit_amqqueue_process,declare,3},
                   {gen_server2,handle_msg,2},
                   {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,&lt;0.6024.14&gt;},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]

And in the web UI, the queue will show up like this.




Then if I click on the queue on the UI, I will get this error/warning.

TypeError: Cannot read property 'ram_msg_count' of undefined


And if I do this on the command-line and grab the queue in question, I will get this incomplete data (as opposed to the info of other queues).

$ curl <A HREF="http://guest:guest@localhost:15672/api/queues">http://guest:guest@localhost:15672/api/queues</A>

    {
        &quot;arguments&quot;: {
            &quot;x-ha-policy&quot;: &quot;all&quot;
        },
        &quot;auto_delete&quot;: false,
        &quot;durable&quot;: true,
        &quot;name&quot;: &quot;test_queue&quot;,
        &quot;node&quot;: &quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>&quot;,
        &quot;vhost&quot;: &quot;/&quot;
    },


Also, if I do this, the queue in question will not show up.

$ sudo rabbitmqctl list_queues


But if I try to declare a queue like this,

$ ./rabbitmqadmin declare queue name=test_queue

or 

$ ./rabbitmqadmin delete queue name=test_queue

Both commands will just hang.


So, I would like to know what the traceback mean and possible way to fix it.


Thanks,
Jonathan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/a4e45561/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/a4e45561/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen Shot 2013-11-05 at 1.03.04 PM.png
Type: image/png
Size: 5624 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/a4e45561/attachment.png">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/a4e45561/attachment.png</A>&gt;
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031702.html">[rabbitmq-discuss] Rabbitmq upgrade from 3.1.3 to 3.1.5/3.2.0 Management issue
</A></li>
	<LI>Next message: <A HREF="031688.html">[rabbitmq-discuss] Durable Queues Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31686">[ date ]</a>
              <a href="thread.html#31686">[ thread ]</a>
              <a href="subject.html#31686">[ subject ]</a>
              <a href="author.html#31686">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
