<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Exchange Feature request: Drop Duplicates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Exchange%20Feature%20request%3A%20Drop%20Duplicates&In-Reply-To=%3C5281F975.3030107%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031860.html">
   <LINK REL="Next"  HREF="031870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Exchange Feature request: Drop Duplicates</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Exchange%20Feature%20request%3A%20Drop%20Duplicates&In-Reply-To=%3C5281F975.3030107%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Exchange Feature request: Drop Duplicates">simon at rabbitmq.com
       </A><BR>
    <I>Tue Nov 12 09:48:37 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031860.html">[rabbitmq-discuss] Exchange Feature request: Drop Duplicates
</A></li>
        <LI>Next message: <A HREF="031870.html">[rabbitmq-discuss] Exchange Feature request: Drop Duplicates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31868">[ date ]</a>
              <a href="thread.html#31868">[ thread ]</a>
              <a href="subject.html#31868">[ subject ]</a>
              <a href="author.html#31868">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The trouble is, exchanges are meant to be stateless. So it's possible to 
introduce some state into an exchange, but we have to choose between 
having per-node state (in which case dedup only works per-node), or 
having cluster-global state (where we either funnel all messages through 
one node in the cluster before they get routed to queues, or distribute 
the state around the cluster, making updates into expensive 2PC).

So this is doable but it's not obvious where compromises should be made. 
And as Matthias sort of pointed out, duplication can still happen due to 
redelivery, so this has to be an optimisation rather than something that 
guarantees duplicates won't happen.

Having said all that, it wouldn't be hideously difficult to implement, 
so I might give it a go. Depends on whether anybody else would find such 
a feature useful...

Cheers, Simon

On 11/11/2013 19:28, Laing, Michael wrote:
&gt;<i> Yes - that's actually what we do currently, using Cassandra, and it
</I>&gt;<i> scales well.
</I>&gt;<i>
</I>&gt;<i> And we also do it in memory, at the retail level, and it is very fast as
</I>&gt;<i> well.
</I>&gt;<i>
</I>&gt;<i> I am just trying to shave a millisecond off at the retail level.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Michael
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mon, Nov 11, 2013 at 2:22 PM, Matthias Reik &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">maze at reik.se</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">maze at reik.se</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Even though it sounds like a nice feature, it is probably difficult
</I>&gt;<i>     to really implement, if not done on the client side. The duplicates
</I>&gt;<i>     might happen when delivering to the client side. but on the client
</I>&gt;<i>     side it should be quite easy to do the filtering:
</I>&gt;<i>     * get a message from the queue,
</I>&gt;<i>     * check against memcached (couchbase, or some other cache
</I>&gt;<i>     technology) whether the messageID exists.
</I>&gt;<i>     * Add the new message to memcached (can be done with the previous step)
</I>&gt;<i>     * Set the timeout in memcached to your window size.
</I>&gt;<i>
</I>&gt;<i>     This should be straight forward, would scale up to quite a lot of
</I>&gt;<i>     messages) and should remove (depending on your window size) all
</I>&gt;<i>     duplicates.
</I>&gt;<i>
</I>&gt;<i>     Is there a good reason why you wouldn't want to do this on the
</I>&gt;<i>     client side as described?
</I>&gt;<i>
</I>&gt;<i>     Cheers
</I>&gt;<i>     Matthias
</I>&gt;<i>
</I>&gt;<i>     PS: as a caching technology you could of course do your own
</I>&gt;<i>     in-memory-solution but that's probably more work than to use an
</I>&gt;<i>     out-of-the-box solution.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     On 2013-11-11 12:35 , Laing, Michael wrote:
</I>&gt;&gt;<i>     In our scenarios, messages are ultimately delivered to a 'retail'
</I>&gt;&gt;<i>     rabbitmq instance to be delivered to a client. The pipelines that
</I>&gt;&gt;<i>     process and deliver messages are purposefully redundant, hence
</I>&gt;&gt;<i>     there may be multiple replicas of each message 'racing' to the
</I>&gt;&gt;<i>     endpoint.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Usually, the replicas are resolved before getting to the retail
</I>&gt;&gt;<i>     rabbit. When components fail, however, duplicates can leak through
</I>&gt;&gt;<i>     during a small window of time. We eliminate those duplicates at
</I>&gt;&gt;<i>     the retail layer by looking at each message_id. Ultimately, our
</I>&gt;&gt;<i>     client contract allows duplicates as well in case one slips by.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     It seems to me that this is a generic issue.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     What would be useful in our case, and hopefully for many others,
</I>&gt;&gt;<i>     would be a 'Duplicate Message ID Window' in milliseconds, as an
</I>&gt;&gt;<i>     exchange attribute.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     If non-zero, the exchange would drop any message with a duplicate
</I>&gt;&gt;<i>     message_id that appeared within the specified window of time,
</I>&gt;&gt;<i>     possibly routing it to the alternate exchange, if set.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     In our case, a window of a few seconds, perhaps up to a minute
</I>&gt;&gt;<i>     would suffice.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Michael
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     _______________________________________________
</I>&gt;&gt;<i>     rabbitmq-discuss mailing list
</I>&gt;&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>  &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     rabbitmq-discuss mailing list
</I>&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031860.html">[rabbitmq-discuss] Exchange Feature request: Drop Duplicates
</A></li>
	<LI>Next message: <A HREF="031870.html">[rabbitmq-discuss] Exchange Feature request: Drop Duplicates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31868">[ date ]</a>
              <a href="thread.html#31868">[ thread ]</a>
              <a href="subject.html#31868">[ subject ]</a>
              <a href="author.html#31868">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
