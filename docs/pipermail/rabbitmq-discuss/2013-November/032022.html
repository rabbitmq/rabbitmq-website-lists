<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering Problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20Problem&In-Reply-To=%3CetPan.528bae26.6b8b4567.2bab%40Nicks-iMac.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032024.html">
   <LINK REL="Next"  HREF="032023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering Problem</H1>
    <B>Nick Barrett</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20Problem&In-Reply-To=%3CetPan.528bae26.6b8b4567.2bab%40Nicks-iMac.local%3E"
       TITLE="[rabbitmq-discuss] Clustering Problem">nick at editd.com
       </A><BR>
    <I>Tue Nov 19 18:29:58 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032024.html">[rabbitmq-discuss] Very slow basic_publish
</A></li>
        <LI>Next message: <A HREF="032023.html">[rabbitmq-discuss] Clustering Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32022">[ date ]</a>
              <a href="thread.html#32022">[ thread ]</a>
              <a href="subject.html#32022">[ subject ]</a>
              <a href="author.html#32022">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

We&#8217;re currently trying to migrate our RabbitMQ setup, and to do it I&#8217;m trying to setup a cluster (and later apply ha-mode &#8220;all&#8221; &amp; ha-sync-mode &#8220;automatic&#8221; to all queues). I ran a test setup with two Rabbit installs with 2 queues with ~5 messages in each with no problem. However when I try to add the new server to our existing install (which has ~120k messages stored in it) it dies. Not only this but it kills the existing server (status reports back alive, but the management interface is gone and no queues are listed via rabbitmqctl), which caused a short panic attack in the office!

The error I&#8217;m seeing:

	<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at rabbit-01</A>:/var/log/rabbitmq# rabbitmqctl join_cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at hare</A>
	Clustering node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-01</A>' with <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at hare</A> ...
&#160;
	Error: {{badmatch,{aborted,{badarg,rabbit_user,majority}}},
	        [{rabbit_table,create_local_copy,2},
	         {rabbit_table,'-create_local_copies/1-fun-0-',2},
	         {lists,foreach,2},
	         {rabbit_table,create_local_copies,1},
	         {rabbit_mnesia,init_db,3},
	         {rabbit_mnesia,init_db_and_upgrade,3},
	         {rabbit_mnesia,init_db_with_mnesia,4},
	         {rabbit_mnesia,join_cluster,2}]}
	<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at rabbit-01</A>:/var/log/rabbitmq#  
	<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at rabbit-01</A>:/var/log/rabbitmq# rabbitmqctl start_app                
	Starting node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-01</A>' ...


Any help would be greatly appreciated!

&#8212;
Nick Barrett
EDITD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/bf126399/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/bf126399/attachment.htm</A>&gt;
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032024.html">[rabbitmq-discuss] Very slow basic_publish
</A></li>
	<LI>Next message: <A HREF="032023.html">[rabbitmq-discuss] Clustering Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32022">[ date ]</a>
              <a href="thread.html#32022">[ thread ]</a>
              <a href="subject.html#32022">[ subject ]</a>
              <a href="author.html#32022">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
