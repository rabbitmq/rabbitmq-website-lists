<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Feature Req / Bug list
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Feature%20Req%20/%20Bug%20list&In-Reply-To=%3CCAJ4uuZYzuwgdw7%2B%2BXOtGJWe5Sgoc7k-Ae9daH683OyLhxskvvA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032134.html">
   <LINK REL="Next"  HREF="032172.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Feature Req / Bug list</H1>
    <B>Graeme N</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Feature%20Req%20/%20Bug%20list&In-Reply-To=%3CCAJ4uuZYzuwgdw7%2B%2BXOtGJWe5Sgoc7k-Ae9daH683OyLhxskvvA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Feature Req / Bug list">graeme at sudo.ca
       </A><BR>
    <I>Tue Nov 26 21:13:48 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032134.html">[rabbitmq-discuss] Feature Req / Bug list
</A></li>
        <LI>Next message: <A HREF="032172.html">[rabbitmq-discuss] Feature Req / Bug list
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32171">[ date ]</a>
              <a href="thread.html#32171">[ thread ]</a>
              <a href="subject.html#32171">[ subject ]</a>
              <a href="author.html#32171">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Nov 25, 2013 at 9:39 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> Graeme: we recently merged a few fixes to bugs that we found as a result
</I>&gt;<i> of running your test scripts; these can be picked up in the latest
</I>&gt;<i> nightlies. I am now able to run rebalance_cluster.sh and toggle_nodes.sh
</I>&gt;<i> indefinitely without anything breaking.
</I>&gt;<i>
</I>
&gt;<i> Thanks for producing these scripts!
</I>&gt;<i>
</I>
No problem!

However, when I retested with the latest nightly build (3.2.1.41125-1), I
ran into issues. I used my scripts to setup a 5 node local cluster, made
100 queues, and populated them with 1000 1MB messages each. Then ran the
rebalance script, and every node promptly crashed once it started applying
the balancing policies. When I brought them back up, the cluster thrashed
the disks for a bit applying the policies, but when it finished, only
53,949 / 100,000 messages were actually present.

I suspected this was because I wasn't using confirmed message delivery in
my Go queue populator, so I changed it to do message confirmations and
re-tried. This didn't result in a crash and all the policies get created,
but none of them auto apply, even though they're all set to &quot;automatic&quot;.
The cluster just sits there, and never actually applies any of the polices
or distributes any data, even if I run through every queue and run
sync_queue.

So it appears there's still bugs with actually applying policies and
syncing data, as I actually can't get any policies to properly replicate
without using unconfirmed messages and crashing the cluster. I've uploaded
the current version of the scripts I'm using to Mega:

<A HREF="https://mega.co.nz/#!jsBH2JSR!fP1zVwsi1ScQrnwzNOBlH05HJN0z9IofYRzy4WvjBjU">https://mega.co.nz/#!jsBH2JSR!fP1zVwsi1ScQrnwzNOBlH05HJN0z9IofYRzy4WvjBjU</A>

The steps I used to create the situation where there are policies that
refuse to apply or sync should be easy to replicate by doing the following:

./create_cluster.sh
./setup_queues.sh
./populate_queues.sh
./rebalance_cluster.sh

Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/5284f0a8/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/5284f0a8/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032134.html">[rabbitmq-discuss] Feature Req / Bug list
</A></li>
	<LI>Next message: <A HREF="032172.html">[rabbitmq-discuss] Feature Req / Bug list
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32171">[ date ]</a>
              <a href="thread.html#32171">[ thread ]</a>
              <a href="subject.html#32171">[ subject ]</a>
              <a href="author.html#32171">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
