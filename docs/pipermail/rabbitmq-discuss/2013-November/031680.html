<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Cluster - node hanging on join_cluster - mnesia reporting connection issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Cluster%20-%20node%20hanging%20on%0A%20join_cluster%20-%20mnesia%20reporting%20connection%20issues&In-Reply-To=%3C7c56a3c6-8dab-498f-9952-b6f98a242ad8%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031678.html">
   <LINK REL="Next"  HREF="031681.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Cluster - node hanging on join_cluster - mnesia reporting connection issues</H1>
    <B>Matt Wise</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Cluster%20-%20node%20hanging%20on%0A%20join_cluster%20-%20mnesia%20reporting%20connection%20issues&In-Reply-To=%3C7c56a3c6-8dab-498f-9952-b6f98a242ad8%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Cluster - node hanging on join_cluster - mnesia reporting connection issues">matt at nextdoor.com
       </A><BR>
    <I>Tue Nov  5 17:06:08 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031678.html">[rabbitmq-discuss] rabbitmq nodedown - nodedown - Generic	server rabbit_disk_monitor terminating
</A></li>
        <LI>Next message: <A HREF="031681.html">[rabbitmq-discuss] RabbitMQ Cluster - node hanging on	join_cluster - mnesia reporting connection issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31680">[ date ]</a>
              <a href="thread.html#31680">[ thread ]</a>
              <a href="subject.html#31680">[ subject ]</a>
              <a href="author.html#31680">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I feel like I've seen similar behavior when multiple nodes in a RabbitMQ 
cluster are restarted at around the same time. I just posted last night 
about a similar outage we had with a 3 node cluster when two of the nodes 
were restarted at about the same time. Our post hasn't made it onto the 
list yet (moderated?) but hopefully it will today.

On Wednesday, October 9, 2013 1:43:19 PM UTC-7, Zach Austin wrote:
&gt;<i>
</I>&gt;<i> The issue was resolved by restarting RabbitMQ on rabbit2.  Not sure why 
</I>&gt;<i> this was required, especially after removing, resetting, and re-adding 
</I>&gt;<i> rabbit1.
</I>&gt;<i>
</I>&gt;<i> On Wednesday, October 9, 2013 12:50:13 PM UTC-5, Zach Austin wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi All,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We're having an issue getting one machine in our rabbit cluster back up 
</I>&gt;&gt;<i> and running after a reboot affected two of the 4 servers in the cluster.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the cluster layout:
</I>&gt;&gt;<i> rabbit1
</I>&gt;&gt;<i> rabbit2
</I>&gt;&gt;<i> rabbit3 (master)
</I>&gt;&gt;<i> rabbit4
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> rabbit1 and rabbit2 were rebooted.  Rabbit2 successfully rejoined the 
</I>&gt;&gt;<i> cluster.  Rabbit1 did not.  Additionally, the rabbitMQ will no longer start 
</I>&gt;&gt;<i> on rabbit1.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Reviewing the log on rabbit1, I find: Mnesia on 'rabbit1' could not 
</I>&gt;&gt;<i> connect to node(s) ['rabbit2']
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I can ping rabbit1 from rabbit2 and vice-versa.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What I've done so far:
</I>&gt;&gt;<i> 1) Verified the erlang cookie values amongst all cluster nodes are 
</I>&gt;&gt;<i> identical
</I>&gt;&gt;<i> 2) Verified the windows firewall is disabled on all cluster nodes.
</I>&gt;&gt;<i> 2) Issued &quot;rabbitmqctl forget_cluster_node rabbit1&quot; on the rabbit3 master.
</I>&gt;&gt;<i> 2) Deleted the mnesia database on rabbit1.
</I>&gt;&gt;<i> 3) Successfully started RabbitMQ on rabbit1 (deleting mnesia DB did this).
</I>&gt;&gt;<i> 4) Issued &quot;rabbitmqctl stop_app&quot;, followed by &quot;rabbitmqctl join_cluster 
</I>&gt;&gt;<i> rabbit3&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> At this point, rabbitmqctl hangs after the &quot;cluster node... with node... 
</I>&gt;&gt;<i> &quot; line (I waited over 15 minutes).  Reviewing the log on rabbit1 again, I 
</I>&gt;&gt;<i> find the same issue logged: Mnesia on 'rabbit1' could not connect to 
</I>&gt;&gt;<i> node(s) ['rabbit2']
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can anyone point me in the direction of what I should check next?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Zach
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/3139c99b/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/3139c99b/attachment-0001.htm</A>&gt;
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031678.html">[rabbitmq-discuss] rabbitmq nodedown - nodedown - Generic	server rabbit_disk_monitor terminating
</A></li>
	<LI>Next message: <A HREF="031681.html">[rabbitmq-discuss] RabbitMQ Cluster - node hanging on	join_cluster - mnesia reporting connection issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31680">[ date ]</a>
              <a href="thread.html#31680">[ thread ]</a>
              <a href="subject.html#31680">[ subject ]</a>
              <a href="author.html#31680">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
