<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Delivery / Redelivery counter plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Delivery%20/%20Redelivery%20counter%20plugin&In-Reply-To=%3CCAHC35TB65ntf5-79HZfhTRp9fSh6n-ptSTfxeMGvVkq6-%2Boneg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031905.html">
   <LINK REL="Next"  HREF="031931.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Delivery / Redelivery counter plugin</H1>
    <B>Karl Nilsson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Delivery%20/%20Redelivery%20counter%20plugin&In-Reply-To=%3CCAHC35TB65ntf5-79HZfhTRp9fSh6n-ptSTfxeMGvVkq6-%2Boneg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Delivery / Redelivery counter plugin">kjnilsson at gmail.com
       </A><BR>
    <I>Wed Nov 13 12:49:59 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031905.html">[rabbitmq-discuss] Delivery / Redelivery counter plugin
</A></li>
        <LI>Next message: <A HREF="031931.html">[rabbitmq-discuss] Delivery / Redelivery counter plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31908">[ date ]</a>
              <a href="thread.html#31908">[ thread ]</a>
              <a href="subject.html#31908">[ subject ]</a>
              <a href="author.html#31908">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Emile,

Firstly, thanks for the reply and for raising the priority of this feature.
I am sure it won't only be us that will appreciate this. :)

I totally understand that doing a 'proper' implementation of toxic message
handling is a complex task and would not be suitable for a plugin. What I
am after is something that would satisfy our system specific requirements
in the meantime. The idea I had was to simply plug something into the
channel deliver/redeliver function to add / increment a custom header value
that we could later inspect in the consumers. This value doesn't even have
to be very accurate (e.g. taking replication / failover into account). All
we want to achieve is to have some indication of a message being one that
has been redelivered multiple times and then take some action based on
that.

Is it technically possible to do this using the plugin architecture? If so,
I'd appreciate any pointers of as to how.

Using multiple queues is an additional complexity that I'd like to try to
avoid as long as possible.

Karl


On 13 November 2013 12:18, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 13/11/13 11:55, Karl Nilsson wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I know there is a planned feature for this (basic / deliver / 01) but I
</I>&gt;<i> &gt; checked with Alvaro who has confirmed it isn't a priority at this time
</I>&gt;<i> &gt; so we could do with some kind of half-way house in the meantime.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The priority of this feature has just raised because it is determined in
</I>&gt;<i> part by demand.
</I>&gt;<i>
</I>&gt;<i> The complete implementation of toxic message handling is complicated by
</I>&gt;<i> the need for on-disk representations to change in order to accommodate
</I>&gt;<i> the counter information. Maintaining the counter in RAM is not an option
</I>&gt;<i> since the redelivery information could be unbounded.
</I>&gt;<i>
</I>&gt;<i> This feature would need to modify and interact with multiple broker
</I>&gt;<i> subsystems, so not the ideal for a plugin.
</I>&gt;<i>
</I>&gt;<i> The best alternative at present is to use the redelivery flag as an
</I>&gt;<i> indicator that a message may be suspect. It is possible to extend the
</I>&gt;<i> utility of the redelivery flag slightly by republishing redelivered
</I>&gt;<i> messages to a separate queue for high-risk messages. If messages from
</I>&gt;<i> the high-disk queue again have the redelivery flag set then the message
</I>&gt;<i> is probably toxic and should be handled as an exception.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
*Karl Nilsson*
twitter: @kjnilsson
blog: coderkarl.wordpress.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/f6ca9f49/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/f6ca9f49/attachment.htm</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031905.html">[rabbitmq-discuss] Delivery / Redelivery counter plugin
</A></li>
	<LI>Next message: <A HREF="031931.html">[rabbitmq-discuss] Delivery / Redelivery counter plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31908">[ date ]</a>
              <a href="thread.html#31908">[ thread ]</a>
              <a href="subject.html#31908">[ subject ]</a>
              <a href="author.html#31908">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
