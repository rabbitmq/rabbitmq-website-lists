<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] High cpu usage on CentOS boxes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20cpu%20usage%20on%20CentOS%20boxes&In-Reply-To=%3CE9D9362E-71DC-4481-B646-D4031E1A735C%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032140.html">
   <LINK REL="Next"  HREF="032094.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] High cpu usage on CentOS boxes</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20cpu%20usage%20on%20CentOS%20boxes&In-Reply-To=%3CE9D9362E-71DC-4481-B646-D4031E1A735C%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] High cpu usage on CentOS boxes">watson.timothy at gmail.com
       </A><BR>
    <I>Wed Nov 27 10:21:10 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032140.html">[rabbitmq-discuss] High cpu usage on CentOS boxes
</A></li>
        <LI>Next message: <A HREF="032094.html">[rabbitmq-discuss] Error starting Rabbitmq-server Segmentation Fault
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32179">[ date ]</a>
              <a href="thread.html#32179">[ thread ]</a>
              <a href="subject.html#32179">[ subject ]</a>
              <a href="author.html#32179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As Simon said, this is highly unlikely o be anything to do with the OS distro, however it could be due to differences in the Linux kernel version the two distro run over and/different versions of erlang/OTP. Are both the servers runnin the same Linux kernel and the same erlang version? Are both 64/32bit architectures and is the erlang runtime they're both running compiled for the same?

Cheers,
Tim

On 26 Nov 2013, at 05:24, shridharan muthu &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">shridharan.m at gmail.com</A>&gt; wrote:

&gt;<i> Hello Simon,
</I>&gt;<i>    Cent OS takes much lesser traffic than I have on Ubuntu. I migrated 5% cpu traffic from ubuntu and It caused 15% cpu increase in Cent OS. I goggled and noticed quite similar questions but didn't find any solutions. If there are a few knobs that I can tune,  I would be happy to test it out. 
</I>&gt;<i>  
</I>&gt;<i>     BTW, I don't use Mandatory/Immediate flags or Acks. All my publisher &amp; consumer calls are asynchronous. 
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Shri
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Mon, Nov 25, 2013 at 9:28 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> I'm afraid there isn't a good way to see which parts of the broker are busy at the moment (we hope to add something along these lines in a future release).
</I>&gt;<i> 
</I>&gt;<i> I'm suspicious of the idea that it's distro-related though. Is the CentOS server really performing the same workload as the Ubuntu server?
</I>&gt;<i> 
</I>&gt;<i> To get to the bottom of this you'd have to gradually take bits away until you see the CPU usage drop - stop connections, disable plugins and so on.
</I>&gt;<i> 
</I>&gt;<i> Cheers, Simon
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 25/11/2013 16:53, shridharan muthu wrote:
</I>&gt;<i> Hello There,
</I>&gt;<i> 
</I>&gt;<i>     Reg my previous message, is there anyway to dig into the high cpu
</I>&gt;<i> usage issue? With similar configs in Ubuntu &amp; Cent OS, Cent OS takes lot
</I>&gt;<i> more cpu for beam.smp process. I switched log level to &quot;info&quot; but
</I>&gt;<i> noticed nothing unusual.
</I>&gt;<i> 
</I>&gt;<i> Any help would be appreciated.
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Shri
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Fri, Nov 22, 2013 at 3:56 PM, shridharan muthu
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">shridharan.m at gmail.com</A> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">shridharan.m at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     Hi There,
</I>&gt;<i>          I am experiencing high cpu usage (above 400%) on Cent OS rabbit
</I>&gt;<i>     mq cluster (with 2 nodes). We have a similar setup in Ubuntu and cpu
</I>&gt;<i>     usage seems fine. Pls fine the report, status and top below.
</I>&gt;<i> 
</I>&gt;<i>     OS: /CentOS release 6.4/
</I>&gt;<i> 
</I>&gt;<i>     Report:
</I>&gt;<i>     /{pid,2148},/
</I>&gt;<i>     / {running_applications,/
</I>&gt;<i>     /     [{rabbitmq_management,&quot;RabbitMQ Management Console&quot;,&quot;3.0.2&quot;},/
</I>&gt;<i>     /      {rabbitmq_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;3.0.2&quot;},/
</I>&gt;<i>     /      {rabbit,&quot;RabbitMQ&quot;,&quot;3.0.2&quot;},/
</I>&gt;<i>     /      {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.7&quot;},/
</I>&gt;<i>     /      {rabbitmq_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;3.0.2&quot;},/
</I>&gt;<i>     /      {webmachine,&quot;webmachine&quot;,&quot;1.9.1-rmq3.0.2-git52e62bc&quot;},/
</I>&gt;<i>     /      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;2.3.1-rmq3.0.2-gitd541e9a&quot;},/
</I>&gt;<i>     /      {xmerl,&quot;XML parser&quot;,&quot;1.2.10&quot;},/
</I>&gt;<i>     /      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.7.1&quot;},/
</I>&gt;<i>     /      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.5&quot;},/
</I>&gt;<i>     /      {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;3.0.2&quot;},/
</I>&gt;<i>     /      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.10&quot;},/
</I>&gt;<i>     /      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.17.5&quot;},/
</I>&gt;<i>     /      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.14.5&quot;}]},/
</I>&gt;<i>     / {os,{unix,linux}},/
</I>&gt;<i>     / {erlang_version,/
</I>&gt;<i>     /     &quot;Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:12:12]
</I>&gt;<i>     [rq:12] [async-threads:30] [kernel-poll:true]\n&quot;},/
</I>&gt;<i>     / {memory,/
</I>&gt;<i>     /     [{total,285898072},/
</I>&gt;<i>     /      {connection_procs,16592856},/
</I>&gt;<i>     /      {queue_procs,1064888},/
</I>&gt;<i>     /      {plugins,269872},/
</I>&gt;<i>     /      {other_proc,13173224},/
</I>&gt;<i>     /      {mnesia,100632},/
</I>&gt;<i>     /      {mgmt_db,2167672},/
</I>&gt;<i>     /      {msg_index,35352},/
</I>&gt;<i>     /      {other_ets,72058416},/
</I>&gt;<i>     /      {binary,7326576},/
</I>&gt;<i>     /      {code,17434264},/
</I>&gt;<i>     /      {atom,3356065},/
</I>&gt;<i>     /      {other_system,152318255}]},/
</I>&gt;<i>     / {vm_memory_high_watermark,0.4},/
</I>&gt;<i>     / {vm_memory_limit,4991811584},/
</I>&gt;<i>     / {disk_free_limit,1000000000},/
</I>&gt;<i>     / {disk_free,17927184384},/
</I>&gt;<i>     / {file_descriptors,/
</I>&gt;<i>     /     [{total_limit,199900},/
</I>&gt;<i>     /      {total_used,314},/
</I>&gt;<i>     /      {sockets_limit,179908},/
</I>&gt;<i>     /      {sockets_used,312}]},/
</I>&gt;<i>     / {processes,[{limit,1048576},{used,2703}]},/
</I>&gt;<i>     / {run_queue,0},/
</I>&gt;<i>     / {uptime,3207797}]/
</I>&gt;<i> 
</I>&gt;<i>      From Top:
</I>&gt;<i>     /   2249 rabbitmq  20   0 2989m 319m 2540 S 371.5  2.7  25109:43
</I>&gt;<i>     beam.smp /
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>       Pls advise me how to proceed further.
</I>&gt;<i> 
</I>&gt;<i>     Thanks,
</I>&gt;<i>     Shri
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/f15b71ff/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/f15b71ff/attachment.htm</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032140.html">[rabbitmq-discuss] High cpu usage on CentOS boxes
</A></li>
	<LI>Next message: <A HREF="032094.html">[rabbitmq-discuss] Error starting Rabbitmq-server Segmentation Fault
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32179">[ date ]</a>
              <a href="thread.html#32179">[ thread ]</a>
              <a href="subject.html#32179">[ subject ]</a>
              <a href="author.html#32179">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
