<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Subscribing%20an%20Exchange%20with%20RabbitHub&In-Reply-To=%3C3470F6D0EFD14CB1AE230C22DD5477CE%40Lijo%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032070.html">
   <LINK REL="Next"  HREF="031903.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Subscribing an Exchange with RabbitHub</H1>
    <B>Lijo Sebastian</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Subscribing%20an%20Exchange%20with%20RabbitHub&In-Reply-To=%3C3470F6D0EFD14CB1AE230C22DD5477CE%40Lijo%3E"
       TITLE="[rabbitmq-discuss] Subscribing an Exchange with RabbitHub">lijo at citrusinformatics.com
       </A><BR>
    <I>Wed Nov 13 11:46:13 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032070.html">[rabbitmq-discuss] SSL connection - ASN1 error
</A></li>
        <LI>Next message: <A HREF="031903.html">[rabbitmq-discuss] Delivery / Redelivery counter plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31900">[ date ]</a>
              <a href="thread.html#31900">[ thread ]</a>
              <a href="subject.html#31900">[ subject ]</a>
              <a href="author.html#31900">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>See the Info report and Crash report below:


=INFO REPORT==== 13-Nov-2013::16:34:26 ===
RabbitHub register subscription (startup); ok
rabbithub_pseudo_queue
{rabbithub_lease,
{rabbithub_subscription,
{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;junk&quot;&gt;&gt;},
&quot;foo&quot;,&quot;<A HREF="http://192.168.1.37:8086/hubsub&quot;},">http://192.168.1.37:8086/hubsub&quot;},</A>
1384427066480905}
=CRASH REPORT==== 13-Nov-2013::16:34:26 ===
crasher:
initial call: rabbithub_pseudo_queue:init/1
pid: &lt;0.15753.0&gt;
registered_name: []
exception exit: {{badmatch,
{amqqueue,
{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,
&lt;&lt;&quot;amq.http.pseudoqueue-Xbp6m5myR_Z21g8Igw-AdA&quot;&gt;&gt;},
false,false,none,[],&lt;0.15753.0&gt;,[],undefined,
undefined,undefined,[]}},
[{rabbithub_pseudo_queue,really_init,1,
[{file,&quot;src/rabbithub_pseudo_queue.erl&quot;},{line,28}]},
{gen_server,init_it,6,
[{file,&quot;gen_server.erl&quot;},{line,304}]},
{proc_lib,init_p_do_apply,3,
[{file,&quot;proc_lib.erl&quot;},{line,239}]}]}
in function gen_server:init_it/6 (gen_server.erl, line 328)
ancestors: [rabbithub_subscription_sup,rabbithub_sup,&lt;0.252.0&gt;]
messages: []
links: [&lt;0.265.0&gt;]
dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct},
{guid,{{1572502171,2578597878,1993740040,2198831220},0}}]
trap_exit: true
status: running
heap_size: 987
stack_size: 27
reductions: 624
neighbours:


Any guess?


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Brett Cameron 
Sent: Wednesday, November 13, 2013 11:40 AM
To: Lijo Sebastian 
Subject: Re: Fwd: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

The response to the challenge request needs to go back to RabbitHub, which is what you appear to be doing; there should be something in the RabbitMQ log that provides more information as to why this is failing. Possibly your UTF-8 encoding is changing the value, so the sent and received tokens do not match, although an HTTP 500 tends too imply something a bit more serious... possibly the 3.1.5 version of the plugin is not 100% compatible with RabbitMQ 3.2.1... but anything liek this will be evident from the RabbitMQ log.


For my testing I just tend to use the following trivial piece of Ruby Sinatra code, which starts up a web server on port 4567. As you can see, the GET just responds by sending back the challenge token. The POST method just displays the received message and will return an empty response body.

require 'sinatra'

get '/sub2' do
   puts &quot;Received #{params}&quot;
   puts &quot;Responding to challenge request...&quot;
   params[:&quot;hub.challenge&quot;]
end

post '/sub2' do
   puts &quot;Received message: #{params} &quot;
end






On Wed, Nov 13, 2013 at 7:00 PM, Lijo Sebastian &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lijo at citrusinformatics.com</A>&gt; wrote:

  Yeah Brett, i received the token with &#8216;hub.challenge&#8217; parameter.

  But issue here is i think, i need to send response to my server, right? 

  As now i am trying subscribe part in command prompt with  curl commands, and my c# application listening for a callback url,  how could i send a response to server from the listening localhost is the issue here i think!


  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  From: Brett Cameron 
  Sent: Wednesday, November 13, 2013 11:19 AM
  To: Lijo Sebastian 
  Subject: Fwd: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

  I probably would have just returned it as a string without doing the UTF-8 encoding, but the the HTTP 500 error is interesting. Check the RabbitMQ log for additional information.


  Additionally, can you confirm that your C# code received the token?


  ---------- Forwarded message ----------
  From: Lijo Sebastian &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lijo at citrusinformatics.com</A>&gt;
  Date: Wed, Nov 13, 2013 at 6:20 PM
  Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
  To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;



  Okai. I got the url with hub.challenge=&lt;token&gt; as a querystring.
  How should i return this challenge token back to webserver?


  Currently i tried with

  // Retrieves challengetoken 
  string challenge = request.QueryString[&quot;hub.challenge&quot;];

  // Converting the text to byteArray
  byte[] challengeBuffer = Encoding.UTF8.GetBytes(challenge);

  // Writes buffer into the response body.
  Response.Body.Write(challengeBuffer, 0, challengeBuffer.Length);

  But this is the result i got..

  * upload completely sent off: 117 out of 117 bytes
  &lt; HTTP/1.1 500 Internal Server Error
  &lt; Server: nginx/1.1.19
  &lt; Date: Wed, 13 Nov 2013 05:15:09 GMT
  &lt; Content-Length: 0
  &lt; Connection: keep-alive
  &lt;
  * Connection #0 to host xxxx.yyyy.com left intact
  * Closing connection #0

  What could be the possible error here?



  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  From: Brett Cameron 
  Sent: Wednesday, November 13, 2013 10:07 AM
  To: rabbitmq-discuss 
  Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

  That's correct. As per the documentation you can also specify a duration for the subscription (after which it will be expired), etc.

  Just be sure to note that the initial challenge is a GET; messages are then forwarded to the URL using POST.

  On 13/11/2013 5:31 PM, &quot;Lijo Sebastian&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lijo at citrusinformatics.com</A>&gt; wrote:

    Oh, so can i specify any url as a callback url and satisfy request verification.
    any client url that can do verification on this request right?



    Regards, 
    Lijo Sebastian
    Senior Software Engineer
    Citrus Informatics (India) Pvt Ltd.

    From: Brett Cameron 
    Sent: Wednesday, November 13, 2013 2:05 AM
    To: Discussions about RabbitMQ 
    Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

    Lijo,


    The error indicates that your web server at rabbitmq.citrus.com did not respond correctly to the initial challenge request. When a subscription is requested, RabbitHub sends a challenge request (HTTP GET) to the specified URL. The challenge request sends a token and the web server is expected to respond to the challenge request by sending back the same token in the response body. Assuming this process completes successfully the subscription will be activated. Once the subscription has been activated, RabbitHub will send to the subscription URL any messages matching the subscription (note that messages are sent using HTTP POST, not GET).


    Brett





    On Wed, Nov 13, 2013 at 1:43 AM, Lijo Sebastian &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lijo at citrusinformatics.com</A>&gt; wrote:

      Hi,
              Please guide me through. 
                  I am using RabbitHub plugin for RESTish way of publishing messages.
                  Creating and Deleting Exchanges or Queues are working fine. 
                  Also able to publish message with http post method to queues subscribed through amqp. 

      But how to achieve subscribe with RabbitHub.

      I tried the example available with RabbitHub tutorial.  Added my call back  url . Got Error.

      What could be the possibilities of the below shown error?

      Thanks in Advance!!!

      Error : 

      Request verification failed: challenge_mismatch* Connection #0 to host rabbitmq
      citrus.com left intact
      * Closing connection #0


      Regards, 
      Lijo Sebastian
      Senior Software Engineer
      Citrus Informatics (India) Pvt Ltd.

      _______________________________________________
      rabbitmq-discuss mailing list
      <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
      <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>




----------------------------------------------------------------------------
    _______________________________________________
    rabbitmq-discuss mailing list
    <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
    <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>


    _______________________________________________
    rabbitmq-discuss mailing list
    <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
    <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>



------------------------------------------------------------------------------
  _______________________________________________
  rabbitmq-discuss mailing list
  <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
  <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>


  _______________________________________________
  rabbitmq-discuss mailing list
  <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
  <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/78633487/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/78633487/attachment.htm</A>&gt;
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032070.html">[rabbitmq-discuss] SSL connection - ASN1 error
</A></li>
	<LI>Next message: <A HREF="031903.html">[rabbitmq-discuss] Delivery / Redelivery counter plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31900">[ date ]</a>
              <a href="thread.html#31900">[ thread ]</a>
              <a href="subject.html#31900">[ subject ]</a>
              <a href="author.html#31900">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
