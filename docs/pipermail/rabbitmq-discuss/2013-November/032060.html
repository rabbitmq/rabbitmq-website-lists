<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Excessive RabbitMQ memory consumption
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Excessive%20RabbitMQ%20memory%20consumption&In-Reply-To=%3CCACLE7izXkKsg5v%3DrAkZGUiBY%3DbJHm1G0x3-698v9S51VrK-RuQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032055.html">
   <LINK REL="Next"  HREF="032061.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Excessive RabbitMQ memory consumption</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Excessive%20RabbitMQ%20memory%20consumption&In-Reply-To=%3CCACLE7izXkKsg5v%3DrAkZGUiBY%3DbJHm1G0x3-698v9S51VrK-RuQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Excessive RabbitMQ memory consumption">mpietrek at skytap.com
       </A><BR>
    <I>Thu Nov 21 19:24:49 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032055.html">[rabbitmq-discuss] Excessive RabbitMQ memory consumption
</A></li>
        <LI>Next message: <A HREF="032061.html">[rabbitmq-discuss] Excessive RabbitMQ memory consumption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32060">[ date ]</a>
              <a href="thread.html#32060">[ thread ]</a>
              <a href="subject.html#32060">[ subject ]</a>
              <a href="author.html#32060">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Michael and Simon - This is immensely helpful. Just knowing some
place to focus on is great. Given the nature of the issues, it appears
consistent with what we've observed in our various test scenarios.

I've got 3.2.1 running in a different cluster for testing. Hopefully it
will validate quickly and we can move to it sooner rather than later.

One more question - Without restarting the broker, is there any way to
restart just the management agent and/or force a GC so as to clean up
memory? This might buy us some time until we can upgrade.

Thanks again,

Matt


On Thu, Nov 21, 2013 at 4:11 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 21/11/13 02:47, Matt Pietrek wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> The management database at 1.3GB seems excessive.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> To add to what Michael said: yes, this is excessive. Almost certainly one
</I>&gt;<i> of the leaks we've fixed since 3.0.2.
</I>&gt;<i>
</I>&gt;<i> As a rule of thumb I would expect the management DB to take about as much
</I>&gt;<i> memory as Mnesia. Certainly within an order of magnitude anyway.
</I>&gt;<i>
</I>&gt;<i> I'm reluctant to get into tracking down exactly which old bug you are
</I>&gt;<i> seeing :-) but there were definitely leaks in 3.0.2 such that:
</I>&gt;<i>
</I>&gt;<i> * Connection and channel data was never cleaned up for nodes that crashed
</I>&gt;<i>
</I>&gt;<i> * Consumer records might not be cleaned up
</I>&gt;<i>
</I>&gt;<i> * Fine stats were issued for queue slaves and never cleaned up even when
</I>&gt;<i> the queue was deleted
</I>&gt;<i>
</I>&gt;<i> If you can't upgrade, in addition to the suggestions Michael made
</I>&gt;<i> (increase the stats interval or disable the management plugin) there's a
</I>&gt;<i> halfway house: disable fine stats collection (
</I>&gt;<i> <A HREF="http://previous.rabbitmq.com/v3_0_x/management.html#fine-stats">http://previous.rabbitmq.com/v3_0_x/management.html#fine-stats</A>). This
</I>&gt;<i> will stop you seeing message rates but will prevent some of those leaks.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/e416bbe3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/e416bbe3/attachment.htm</A>&gt;
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032055.html">[rabbitmq-discuss] Excessive RabbitMQ memory consumption
</A></li>
	<LI>Next message: <A HREF="032061.html">[rabbitmq-discuss] Excessive RabbitMQ memory consumption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32060">[ date ]</a>
              <a href="thread.html#32060">[ thread ]</a>
              <a href="subject.html#32060">[ subject ]</a>
              <a href="author.html#32060">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
