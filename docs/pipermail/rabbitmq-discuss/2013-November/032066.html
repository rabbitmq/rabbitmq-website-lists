<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Does SSD improve rabbitmq's performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Does%20SSD%20improve%20rabbitmq%27s%20performance&In-Reply-To=%3CCAJ4uuZYRdgLMTXFXCYonPPX8SvqVmvs6n-FrPhjBfzqxFgQivA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032042.html">
   <LINK REL="Next"  HREF="032037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Does SSD improve rabbitmq's performance</H1>
    <B>Graeme N</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Does%20SSD%20improve%20rabbitmq%27s%20performance&In-Reply-To=%3CCAJ4uuZYRdgLMTXFXCYonPPX8SvqVmvs6n-FrPhjBfzqxFgQivA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Does SSD improve rabbitmq's performance">graeme at sudo.ca
       </A><BR>
    <I>Fri Nov 22 00:50:20 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032042.html">[rabbitmq-discuss] Does SSD improve rabbitmq's performance
</A></li>
        <LI>Next message: <A HREF="032037.html">[rabbitmq-discuss] Does SSD improve rabbitmq's performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32066">[ date ]</a>
              <a href="thread.html#32066">[ thread ]</a>
              <a href="subject.html#32066">[ subject ]</a>
              <a href="author.html#32066">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Quick update for this, I've got some initial numbers on a box with 8x10k
RPM SAS disks in RAID5, with 128GiB of RAM:

 msg_store_file_size_limit (MiB) queues msgs / queue msg size (MB) total
msgs total msg size (MB) runtime (s) runtime (s) avg throughput MB/s 161001500
1 150000150000 449458 330.76 32100 15001 150000150000 425418 355.87 641001500
1 150000150000 401400 374.53 128100 15001 150000150000 385390 387.10 2561001500
1 150000150000 383385 390.63
I get some reasonable gains by bumping msg_store_file_size_limit up to 128
MiB, 256 MiB seems to be only marginal returns. This may simply be because
it can't batch up more data than that in RAM prior to writing, given the
RAM in my test system. Note that the underlying FS itself is capable of
delivering 780MB/s in block writes, so this is still less than I expected
to see, but demonstrates there's some minor advantages to be had by using
larger store sizes.

My next theory was that 100 queues would mean a minimum of 100 on disk
persistent files, and that I'd see better block throughput with less queues
and more messages. However, testing with lower numbers of queues and higher
messages per queue (to keep total messages delivered constant) revealed
some weird behaviour:

msg_store_file_size_limit (MiB)queuesmsgs / queuemsg size (MB)total msgstotal
msg size (MB)runtime (s)runtime (s)avg throughput MB/s12810015001150000
150000385390387.101285030001150000150000373376400.531282560001150000150000
409413364.9612810150001150000150000463442331.491285300001150000150000465448
328.59
Looks like queue contention becomes a bigger bottleneck than IO throughput
once you get below 50 queues, which is a result I didn't expect. In any
case, looks like max storage size ~= RAM hits some sort of
buffering/contention sweet spot, at least with larger messages, so that's
something which should be easy enough to automate.

Graeme




On Wed, Nov 20, 2013 at 2:01 PM, Graeme N &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">graeme at sudo.ca</A>&gt; wrote:

&gt;<i> On Wed, Nov 20, 2013 at 12:56 PM, Matthias Radestock &lt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> The msg_store has a gc hat has a hard upper bound on the amount of
</I>&gt;&gt;<i> garbage left around. See the essay near the beginning of
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_msg_store.erlfor">http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_msg_store.erlfor</A> the gory details.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is extremely informative. Definitely helping me get a better
</I>&gt;<i> understanding of what Rabbit's IO patterns are. Thanks!
</I>&gt;<i>
</I>&gt;<i> Graeme
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/d5fd57cb/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/d5fd57cb/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032042.html">[rabbitmq-discuss] Does SSD improve rabbitmq's performance
</A></li>
	<LI>Next message: <A HREF="032037.html">[rabbitmq-discuss] Does SSD improve rabbitmq's performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32066">[ date ]</a>
              <a href="thread.html#32066">[ thread ]</a>
              <a href="subject.html#32066">[ subject ]</a>
              <a href="author.html#32066">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
