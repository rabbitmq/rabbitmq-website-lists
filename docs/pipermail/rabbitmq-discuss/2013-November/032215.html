<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Policy for dead letter exchange routing back to queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Policy%20for%20dead%20letter%20exchange%20routing%20back%0A%20to%20queue&In-Reply-To=%3C29073725.23.1385702444578.JavaMail.Nicholas%40Behemoth%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032197.html">
   <LINK REL="Next"  HREF="032192.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Policy for dead letter exchange routing back to queue</H1>
    <B>Nicholas A. Stuart</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Policy%20for%20dead%20letter%20exchange%20routing%20back%0A%20to%20queue&In-Reply-To=%3C29073725.23.1385702444578.JavaMail.Nicholas%40Behemoth%3E"
       TITLE="[rabbitmq-discuss] Policy for dead letter exchange routing back to queue">nicholasastuart at gmail.com
       </A><BR>
    <I>Fri Nov 29 05:20:48 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032197.html">[rabbitmq-discuss] Policy for dead letter exchange routing back to queue
</A></li>
        <LI>Next message: <A HREF="032192.html">[rabbitmq-discuss] RabbitMq on ESXi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32215">[ date ]</a>
              <a href="thread.html#32215">[ thread ]</a>
              <a href="subject.html#32215">[ subject ]</a>
              <a href="author.html#32215">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to mimic the retry policy of ActiveMQ, where I can requeue a message if it fails a certain criteria(reject with requeue), but I want to only requeue it 5 times. I know that using a DLX/DLQ and rejecting a message without requeue will create an x-death header that will provide a count for the number of times failed. 

To give you an example, we're consuming messages from a queue in order to send them to web services(old architecture, cannot change). There are times where the web service may be down, so if it is, we'd like to requeue the message, but if the message has been tried 5 times, we'd like to just put it into another queue for later. We like the reject ability as it guarantees that it fails or succeeds for us atomically, but RabbitMQ/AMQP doesn't provide any type of retry/requeue count, except with the x-death property which provides us some insight into the failure of the message. 

----- Original Message -----
From: &quot;Simon MacMullen&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;
To: &quot;Discussions about RabbitMQ&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
Cc: &quot;Nicholas Stuart&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">nicholasastuart at gmail.com</A>&gt;
Sent: Thursday, November 28, 2013 4:05:46 AM
Subject: Re: [rabbitmq-discuss] Policy for dead letter exchange routing back to queue

On 27/11/13 15:25, Nicholas Stuart wrote:
&gt;<i> I've successfully set up a dead letter exchange policy where
</I>&gt;<i> the|dead-letter-exchange|is blank, which will return the message to the
</I>&gt;<i> original queue. However this only happens if the message was published
</I>&gt;<i> to the default exchange, or with a routing key of the queue name.
</I>&gt;<i>
</I>&gt;<i> If I set up a fanout or topic exchange, my message is dropped(rightfully
</I>&gt;<i> so). Is there any way, in the RabbitMQ policy, that I can specify a
</I>&gt;<i> routing key policy that will always point back to the queue the message
</I>&gt;<i> was consumed off of?
</I>
No, there isn't. Unless you want to create one policy per queue in which 
case you can set dead-letter-routing-key of course.

Why do you want to dead-letter back to the original queue?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032197.html">[rabbitmq-discuss] Policy for dead letter exchange routing back to queue
</A></li>
	<LI>Next message: <A HREF="032192.html">[rabbitmq-discuss] RabbitMq on ESXi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32215">[ date ]</a>
              <a href="thread.html#32215">[ thread ]</a>
              <a href="subject.html#32215">[ subject ]</a>
              <a href="author.html#32215">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
