<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Exchange Feature request: Drop Duplicates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Exchange%20Feature%20request%3A%20Drop%20Duplicates&In-Reply-To=%3CCAKgmDnGJmLzOs6AaKo5dke9OJQ6001ox6h16%3D6kzmMqQnq_ceg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031868.html">
   <LINK REL="Next"  HREF="031839.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Exchange Feature request: Drop Duplicates</H1>
    <B>Laing, Michael</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Exchange%20Feature%20request%3A%20Drop%20Duplicates&In-Reply-To=%3CCAKgmDnGJmLzOs6AaKo5dke9OJQ6001ox6h16%3D6kzmMqQnq_ceg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Exchange Feature request: Drop Duplicates">michael.laing at nytimes.com
       </A><BR>
    <I>Tue Nov 12 10:54:15 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="031868.html">[rabbitmq-discuss] Exchange Feature request: Drop Duplicates
</A></li>
        <LI>Next message: <A HREF="031839.html">[rabbitmq-discuss] C++ Consumer Example into While Loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31870">[ date ]</a>
              <a href="thread.html#31870">[ thread ]</a>
              <a href="subject.html#31870">[ subject ]</a>
              <a href="author.html#31870">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes I can see the point about statelessness.

It seems to me that in a messaging fabric, it is generally useful to have
ways of dampening duplicates.

It occurred to me this morning that federation uses hop counts - in some
topologies, esp. with planned redundancy, this does not work so well, and
perhaps a feature like this would help.

Michael






On Tue, Nov 12, 2013 at 4:48 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> The trouble is, exchanges are meant to be stateless. So it's possible to
</I>&gt;<i> introduce some state into an exchange, but we have to choose between having
</I>&gt;<i> per-node state (in which case dedup only works per-node), or having
</I>&gt;<i> cluster-global state (where we either funnel all messages through one node
</I>&gt;<i> in the cluster before they get routed to queues, or distribute the state
</I>&gt;<i> around the cluster, making updates into expensive 2PC).
</I>&gt;<i>
</I>&gt;<i> So this is doable but it's not obvious where compromises should be made.
</I>&gt;<i> And as Matthias sort of pointed out, duplication can still happen due to
</I>&gt;<i> redelivery, so this has to be an optimisation rather than something that
</I>&gt;<i> guarantees duplicates won't happen.
</I>&gt;<i>
</I>&gt;<i> Having said all that, it wouldn't be hideously difficult to implement, so
</I>&gt;<i> I might give it a go. Depends on whether anybody else would find such a
</I>&gt;<i> feature useful...
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 11/11/2013 19:28, Laing, Michael wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Yes - that's actually what we do currently, using Cassandra, and it
</I>&gt;&gt;<i> scales well.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And we also do it in memory, at the retail level, and it is very fast as
</I>&gt;&gt;<i> well.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am just trying to shave a millisecond off at the retail level.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Michael
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Nov 11, 2013 at 2:22 PM, Matthias Reik &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">maze at reik.se</A>
</I>&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">maze at reik.se</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Even though it sounds like a nice feature, it is probably difficult
</I>&gt;&gt;<i>     to really implement, if not done on the client side. The duplicates
</I>&gt;&gt;<i>     might happen when delivering to the client side. but on the client
</I>&gt;&gt;<i>     side it should be quite easy to do the filtering:
</I>&gt;&gt;<i>     * get a message from the queue,
</I>&gt;&gt;<i>     * check against memcached (couchbase, or some other cache
</I>&gt;&gt;<i>     technology) whether the messageID exists.
</I>&gt;&gt;<i>     * Add the new message to memcached (can be done with the previous
</I>&gt;&gt;<i> step)
</I>&gt;&gt;<i>     * Set the timeout in memcached to your window size.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     This should be straight forward, would scale up to quite a lot of
</I>&gt;&gt;<i>     messages) and should remove (depending on your window size) all
</I>&gt;&gt;<i>     duplicates.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Is there a good reason why you wouldn't want to do this on the
</I>&gt;&gt;<i>     client side as described?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Cheers
</I>&gt;&gt;<i>     Matthias
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     PS: as a caching technology you could of course do your own
</I>&gt;&gt;<i>     in-memory-solution but that's probably more work than to use an
</I>&gt;&gt;<i>     out-of-the-box solution.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     On 2013-11-11 12:35 , Laing, Michael wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     In our scenarios, messages are ultimately delivered to a 'retail'
</I>&gt;&gt;&gt;<i>     rabbitmq instance to be delivered to a client. The pipelines that
</I>&gt;&gt;&gt;<i>     process and deliver messages are purposefully redundant, hence
</I>&gt;&gt;&gt;<i>     there may be multiple replicas of each message 'racing' to the
</I>&gt;&gt;&gt;<i>     endpoint.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     Usually, the replicas are resolved before getting to the retail
</I>&gt;&gt;&gt;<i>     rabbit. When components fail, however, duplicates can leak through
</I>&gt;&gt;&gt;<i>     during a small window of time. We eliminate those duplicates at
</I>&gt;&gt;&gt;<i>     the retail layer by looking at each message_id. Ultimately, our
</I>&gt;&gt;&gt;<i>     client contract allows duplicates as well in case one slips by.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     It seems to me that this is a generic issue.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     What would be useful in our case, and hopefully for many others,
</I>&gt;&gt;&gt;<i>     would be a 'Duplicate Message ID Window' in milliseconds, as an
</I>&gt;&gt;&gt;<i>     exchange attribute.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     If non-zero, the exchange would drop any message with a duplicate
</I>&gt;&gt;&gt;<i>     message_id that appeared within the specified window of time,
</I>&gt;&gt;&gt;<i>     possibly routing it to the alternate exchange, if set.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     In our case, a window of a few seconds, perhaps up to a minute
</I>&gt;&gt;&gt;<i>     would suffice.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     Thanks,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     Michael
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     _______________________________________________
</I>&gt;&gt;&gt;<i>     rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>  &lt;mailto:rabbitmq-discuss@
</I>&gt;&gt;&gt;<i> lists.rabbitmq.com&gt;
</I>&gt;&gt;&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     _______________________________________________
</I>&gt;&gt;<i>     rabbitmq-discuss mailing list
</I>&gt;&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i>     &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/e1335401/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/e1335401/attachment.htm</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031868.html">[rabbitmq-discuss] Exchange Feature request: Drop Duplicates
</A></li>
	<LI>Next message: <A HREF="031839.html">[rabbitmq-discuss] C++ Consumer Example into While Loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31870">[ date ]</a>
              <a href="thread.html#31870">[ thread ]</a>
              <a href="subject.html#31870">[ subject ]</a>
              <a href="author.html#31870">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
