From ben.browitt at gmail.com  Mon Feb  1 05:58:52 2010
From: ben.browitt at gmail.com (Ben Browitt)
Date: Mon, 1 Feb 2010 07:58:52 +0200
Subject: [rabbitmq-discuss] PubSub - all bindings have to be in memory?
Message-ID: <b0200d7f1001312158g1437c8b4y123e5af00dfd5fa6@mail.gmail.com>

Hi

I want to build a pubsub system with a finite number of queues and exchanges
and a growing number of bindings.
A simple example is users (queues) that subscribe (bindings) to articles
(exchanges).
In the first 24H since an article has been published we want subscribers to
get updates (comments) in real time
but after that when the frequency of new comments will decrease it's ok if
updates will be delivered in a delay.
I don't want to limit the number of articles a user can subscribe to, so
over time the bindings can grow exponentially.

Do I have to keep all bindings in memory or is there a mode where rabbitmq
can read binding keys from disk when needed?

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100201/41328e3b/attachment.htm 

From bsullivan at lindenlab.com  Mon Feb  1 06:41:01 2010
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Sun, 31 Jan 2010 22:41:01 -0800
Subject: [rabbitmq-discuss] routing threads on a rabbitmq node
Message-ID: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com>

Hi,

I am curious if anyone on the rabbitmq team can confirm/clarify what we are
seeing with respect to some throughput issues on our RMQ cluster.

The config:
- 2-node RMQ cluster, running a topic-based exchange
- 8 publishers, running on different hosts
- dozens of consumers, ~75 wildcard topic bindings, mostly running on
different hosts (there are a couple running on the RMQ hosts for stats, etc)

The issue:
When we publish at a higher rate than normal, there appears to be a
significant delay in the pipeline between when we publish the messages and
when we receive them on the consuming side.  Since publishing is
asynchronous, the publisher applications send as fast as they can, meanwhile
we see an increasing delay in when we see those same messages come out on
the other side.  My guess (gathered from
http://www.rabbitmq.com/faq.html#node-per-CPU-core) is that there is either
a single routing thread per publisher (channel), or even worse a single
routing bottleneck per node.  Either way, this thread cannot route fast
enough in a topic exchange (we have about 75 bindings, using wildcards) and
there is a backup of messages to be routed.

This is dangerous and hard to control, since we have seen memory grow in
such a way that we have a hard time stopping it.  In certain failure modes,
when the publisher disconnects, all of the messages pending to be routed are
discarded - possibly hours of data in our environment.  It also limits the
scaling we've been able to do, since if we fire up all 8 publishers at high
volume, this backup problem spreads across all streams.

The question:
Can you please elaborate on where the routing backup could be occurring, and
what steps might be best to prevent this from happening?  It appears from
the fact that I am waiting on the routing to happen that using flags like
"mandatory" on messages is not going to help me here (though I have not
tested this).

One idea:
If it is truly the case that a single thread per node might be causing this
problem, then perhaps we can run a small rabbitmq node on each publisher
(joined to the cluster), with the sole purpose of doing the routing load?
If we publish locally, all it would need to do is keep up with it's own
routing load, not the combine routing load of 3 other publishers.  It
doesn't really prevent the problem from happening though, if I can produce
messages faster in a single thread than even a dedicated node can route.
Would this even help?

Thanks,
Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100131/1f783db0/attachment.htm 

From rajkumars at gmail.com  Mon Feb  1 09:47:16 2010
From: rajkumars at gmail.com (Rajkumar S)
Date: Mon, 1 Feb 2010 15:17:16 +0530
Subject: [rabbitmq-discuss] Disabling channel.flow
Message-ID: <64de5c8b1002010147k3491a26bn199feb5a29db4392@mail.gmail.com>

Hi,

How can I disable memory-based flow control ?

I am using stomp to send messages  to rabbit and the rabbit server
also hosts mysql and other daemons. So I occasionally get
channel.flow error. Since stomp plugin cannot handle this, I loose
messages. I am okay with latency, but cannot tolerate message loss. So
is it possible to disable memory-based flow control completely?

I have seen http://www.rabbitmq.com/extensions.html#memsup and have tried with

-os_mon system_memory_high_watermark 0
-rabbit memory_alarms false

Both these does not seems to disable channel.flow.

with regards,

raj



From matthew at lshift.net  Mon Feb  1 10:17:41 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 1 Feb 2010 10:17:41 +0000
Subject: [rabbitmq-discuss] Disabling channel.flow
In-Reply-To: <64de5c8b1002010147k3491a26bn199feb5a29db4392@mail.gmail.com>
References: <64de5c8b1002010147k3491a26bn199feb5a29db4392@mail.gmail.com>
Message-ID: <20100201101741.GM11819@mrnibble.lshift.net>

Hi Rajkumar,

On Mon, Feb 01, 2010 at 03:17:16PM +0530, Rajkumar S wrote:
> How can I disable memory-based flow control ?

Which version of Rabbit are you using? - the details for disabling
memory monitoring have changed between 1.7.0 and 1.7.1.

I advise against disabling memory monitoring. If you do disable it, and
then Rabbit runs out of memory, Rabbit will crash, likely losing more
messages.

Matthew



From matthew at lshift.net  Mon Feb  1 10:56:48 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 1 Feb 2010 10:56:48 +0000
Subject: [rabbitmq-discuss] RabbitMQ-shovel
Message-ID: <20100201105648.GO11819@mrnibble.lshift.net>

Morning,

Several people have recently been asking about a shovel for Rabbit,
which can consume messages from one consumer and deliver them to
another. Several of our clients have also been asking for such message
relocation equipment, and thus we have built one: the RabbitMQ-shovel
which is available from http://hg.rabbitmq.com/rabbitmq-shovel/

Documentation is in the form of a README, which is duplicated below.

This code has not yet been through QA, so there may be bugs in it.
We are, as always, very happy to receive bug reports. But certainly, our
testing suggests it works for us ;)

It is licensed under the MPL v1.1

Have fun!


RabbitMQ-shovel
===============


Introduction
------------

This is a plug-in for RabbitMQ that shovels messages from a queue on
one broker to an exchange on another broker. The two brokers may be
the same. The plug-in allows several shovels to be specified at the
same time. Each shovel may have a number of source and destination
brokers specified, and one of each is chosen whenever the shovel
attempts to make a connection: this permits simple round-rabbit load
balancing.

Resources can be declared upon connection to both the source and
destination brokers, and parameters can be specified for both the
reception and publishing of messages.


Requirements
------------

Currently, you must build the server from source, under branch
bug16653. You must also have checked out the rabbitmq-public-umbrella
hg repository, and have the rabbitmq-erlang-client built. From
scratch, the following commands should build RabbitMQ with the shovel
plug-in:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
cd rabbitmq-public-umbrella
hg clone http://hg.rabbitmq.com/rabbitmq-codegen
hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
hg clone http://hg.rabbitmq.com/rabbitmq-server
hg clone http://hg.rabbitmq.com/rabbitmq-shovel
cd rabbitmq-server
hg up -C bug16653
make -j
mkdir -p plugins
cd plugins
ln -s ../../rabbitmq-erlang-client
ln -s ../../rabbitmq-shovel
cd ../../rabbitmq-erlang-client
make
cd ../rabbitmq-shovel
make
cd ../rabbitmq-server
./scripts/rabbitmq-activate-plugins
make cleandb run


Configuration
-------------

The RabbitMQ configuration file specifies the shovel
configurations. This exists by default, in
/etc/rabbitmq/rabbitmq.config under Linux systems,
%RABBITMQ_BASE%\rabbitmq.config under Windows or somewhere else under
OS X. This file configures both RabbitMQ-server and all the plugins
installed in it. It is an Erlang-syntax file of the form:

[{section1, [section1-config]},
 {section2, [section2-config]},
 ...
 {sectionN, [sectionN-config]}
].

thus a list of tuples, where the left element of each tuple names the
applications being configured. Don't forget the last element of the
list doesn't have a trailing comma, and don't forget the full-stop is
needed after closing the list. Hence if you configure RabbitMQ-server
and the RabbitMQ-shovel, then the configuration file may have a
structure like this:

[{rabbit,        [configuration-for-RabbitMQ-server]},
 {rabbit-shovel, [configuration-for-RabbitMQ-shovel]}
].

A full example of the shovel configuration is:

{rabbit_shovel,
  [{shovels,
    [{my_first_shovel,
      [{sources,      [{brokers,
                          ["amqp://fred:secret at host1.domain/my_vhost",
                           "amqp://john:secret at host2.domain/my_vhost"
                          ]},
                       {declarations,
                          ['queue.declare',
                           {'queue.bind',
                                  [{exchange, <<"my_exchange">>},
                                   {queue,    <<>>}]}
                          ]}]},
       {destinations, [{broker, "amqp://"},
                       {declarations,
                          [{'exchange.declare',
                                  [{exchange, <<"my_exchange">>},
                                   {type, <<"direct">>},
                                   durable]}
                          ]}]},
       {queue, <<>>},
       {qos, 10},
       {auto_ack, false},
       {tx_size, 0},
       {delivery_mode, keep},
       {publish_fields, [{exchange, <<"my_exchange">>},
                         {routing_key, <<"from_shovel">>}]},
       {reconnect, 5}
      ]}
     ]
   }]
}

Firstly, all shovels are named. Here we have one shovel, called
'my_first_shovel'. We can have multiple shovels if you wish. Every
shovel must have all sub-fields specified: sources, destinations, qos,
auto_ack, delivery_mode, publish_fields, reconnect.


Sources and Destinations
------------------------

Sources and destinations specify respectively where messages are
fetched from and delivered too. One of 'broker' and 'brokers' must be
specified, and 'broker' is simply shorthand for when only one broker
needs specifying. Using 'brokers' allows a list of brokers to be
specified: whenever the connection to a broker is lost, another one is
chosen at random from the list and a connection attempt is made to
that. The syntax for broker URIs is:

amqp://username:password at host:port/vhost

If username or password are omitted, the default values of guest and
guest are used. If the vhost is omitted, the default value of / is
used. If the host is omitted, then the plugin uses the "direct"
connection internally rather than a network connection: this means it
connects to the RabbitMQ-server node on which it is running without
going through the network stack. This is much more efficient. If port
is omitted then the default value is used (5672 or 5671 if SSL is
used).

SSL is implemented, for which additional parameters are needed:

amqps://username:password at host:port/vhost?cacertfile=/path/to/cacert.pem&certfile=/path/to/certfile.pem&keyfile=/path/to/keyfile.pem&verify=verifyOption&fail_if_no_peer_cert=failOption

All five parameters (3 paths: cacertfile, certfile and keyfile; 2
options: verify, fail_if_no_peer_cert) must be specified. See the SSL
guide at http://www.rabbitmq.com/ssl.html#configure-erlang for details
of SSL in RabbitMQ in general and specifically for the Erlang client
(on which the shovel is built).

Note that SSL cannot be used with the direct connection (i.e. a host
must be specified when using SSL), and that it is preferable to use
the non-SSL direct connection to using SSL to connect to the same node
that's running the shovel.


Resource Declarations
---------------------

Both sources and destinations can have an optional 'declarations'
clause. The value of this is a key, consisting of AMQP Methods. If
default values are sufficient, then the method name alone can be
specified - e.g. 'queue.declare'. If parameters need to be set then
the method should be given as a tuple, with the right hand side a
proplist specifying which fields need altering from their default
values. E.g:
    {'exchange.declare',[{exchange, <<"my_exchange">>},
                         {type, <<"direct">>},
                         durable]},

One very useful feature here is the Most-Recently-Declared-Queue
feature, in which RabbitMQ remembers the name of the most recently
declared queue. This means that you can declare a private queue, and
then bind it to exchanges without ever needing to know its name.


queue :: binary
---------------

This feature specifies the name of the queue on the source brokers to
consume from. This queue must exist. Use the resource declarations to
create the queue (or ensure it exists) first. Note again that the
Most-Recently-Declared-Queue feature can be used here, thus an
anonymous queue can be used.


qos :: non-negative-integer
---------------------------

The shovel consumes from a queue. The QoS controls how many messages
are sent to the shovel in advance of the message the shovel is
currently processing.


auto_ack :: boolean
-------------------

Setting this to 'true' turns on the no_ack flag when subscribing to
the source queue.


tx_size :: non-negative-integer
-------------------------------

When set to 0, transactions are not used. Other values make publishes
transactional, with a commit every N messages. In lieu of the auto-ack
option, when transactions are not used, messages are acknowledged to
the source immediately after every publish. When transactions are
used, acks are only issued to the source on receipt of the commit-ok
message from the destination. This can thus be used to guarantee that
messages are only acknowledged (and thus forgotten about by the source
broker) when they are guaranteed to have been received by the
destination broker.


delivery_mode :: 'keep' | 0 | 2
-------------------------------

This affects the delivery_mode field when publishing to the
destination. A value of 'keep' means that the same delivery_mode
should be used as when the message was originally published to the
source broker. 0 and 2 override the original setting.


publish_fields
--------------

This is a list of tuples which override fields in the publish method
when publishing to the destination. This can be used to direct
messages to a particular exchange on the destination, for example, or
change the routing key. By default, the routing key of the message as
it is received by the shovel is passed through, but this can be
overridden as necessary.


reconnect :: non-negative-integer
---------------------------------

When an error occurs, the shovel will disconnect from both the source
and destination broker immediately. This will force uncommitted
transactions at the destination to be rolled back, and delivered but
unacknowledged messages from the source to be requeued. The shovel
will then try connecting again. If this is unsuccessful, then it's not
a good idea for the shovel to very quickly and repeatedly try to
reconnect. The value specified here is the number of seconds to wait
between each connection attempt.

Note that if set to 0, the shovel will never try to reconnect: it'll
stop after the first error.


Obtaining shovel statuses
-------------------------

>From the broker Erlang prompt, call
rabbit_shovel_status:status(). This will return a list, with one row
for each configured shovel. Each row has three fields: the shovel
name, the shovel status, and the timestamp (a local calendar time of
{{YYYY,MM,DD},{HH,MM,SS}}). There are 3 possible statuses:

'starting': The shovel is starting up, connecting and creating
resources.

'running': The shovel is up and running, shovelling messages.

{'terminated', Reason}: Something's gone wrong. The Reason should give
a further indication of where the fault lies.




From johndapps at gmail.com  Mon Feb  1 11:41:54 2010
From: johndapps at gmail.com (John Apps)
Date: Mon, 1 Feb 2010 12:41:54 +0100
Subject: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a
	query, e.g., list_queues, for a good 60 seconds or more (Windows 7)
In-Reply-To: <4B60CDDA.4070806@lshift.net>
References: <173a1edc1001270920w278dcbd5gce84a959998fe4de@mail.gmail.com>
	<4B60CDDA.4070806@lshift.net>
Message-ID: <173a1edc1002010341i249fd0e7udc10f79eb1c1c5ef@mail.gmail.com>

Matthias,
  I tried this out on another Windows 7 X64 machine I have and was unable to
reproduce the behaviour there. Rather than have this entry hang around,
please disregard for now.
When I have time I will pursue the matter and let you know what the cause
was.

Thank you for the support, John

On Thu, Jan 28, 2010 at 00:35, Matthias Radestock <matthias at lshift.net>wrote:

> John,
>
> John Apps wrote:
>
>> Whilst not being a bug per se, it is annoying behaviour when rabbitmqctl
>> 'sits there' for quite some time.
>>
>
> How long is 'quite some time'?
>
> And what rabbitmqctl command were you trying to run? list_queues (as per
> the subject line)? If so, how many queues did you have at the time?
>
> And when you say (in the subject line) that rabbitmqctl hangs *at the end*
> of a query, do you mean it displays the results and *then* hangs?
>
>  Interestingly enough, it does not accept <CTRL>C either.
>>
>
> I'll have to find a Windows machine to try to reproduce that.
>
> Are you running the standard rabbitmqctl.bat script? In the other thread
> you posted some rabbitmqctl output which contained progress log information,
> which is not something we see in testing and for which the most plausible
> explanation is that some additional options have been passed to the erl
> executable.
>
>  This wait is only encountered when activity is going on with
>> RabbitMQ, no matter what it is.
>>
>
> So this only happens when rabbit is really busy?
>
> Rabbit does prioritise handling of rabbitmqctl processing over most other
> tasks, but when the server is under heavy load it can still take some time
> to handle these requests. There is not much we can do about that really,
> since we wouldn't want to stop message processing altogether.
>
>
> Regards,
>
> Matthias.
>



-- 
---
John Apps
(49) 171 869 1813
Sent from Prien am Chiemsee, Bavaria, Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100201/8cc49a62/attachment.htm 

From holger.hoffstaette at googlemail.com  Mon Feb  1 13:23:37 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Mon, 01 Feb 2010 14:23:37 +0100
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
	connection on high-latency networks
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
Message-ID: <pan.2010.02.01.13.23.37.24000@googlemail.com>


Followup reply from Vladimir. Apparently the problem is something else.
Any of the Rabbit devs got an idea?

Holger

-------- Original Message --------
Subject: Re: [rabbitmq-discuss] Poor performance using a single RabbitMQ
connection on high-latency networks
Date: 	Sun, 31 Jan 2010 13:52:27 +0300
From: 	Vladimir Balandin <vbalandin at griddynamics.com>
To: 	Holger Hoffstaette <holger.hoffstaette at googlemail.com>


Holger, thank you a lot for reply.

We are tried to use different send/receive buffers (from 8kb to 16 Mb),
but it don't improve performance. We saw extremely large throughput
until buffer is filled (when use 1 Mb buffer we can send about 1 Mb data
with no delay, when use 256 kB buffer we can send about 256 kB, etc) but
then we see poor performance again - no more than 20 kB/s. We have
tested with Windows XP and Windows Vista.

Also we have created a simple client-server application which simply
writes data to stream and measure performance: we have seen throughput
is about 350 kB/s (it is about 40% of network usage, what is a pretty
good for us, because we can use three or four connections on this
network to arrive at least 90% of network usage). We don't understand
why RabbitMQ have poor performance using single TCP connection on our case.






From matthew at lshift.net  Mon Feb  1 13:33:16 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 1 Feb 2010 13:33:16 +0000
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
 connection on high-latency networks
In-Reply-To: <pan.2010.02.01.13.23.37.24000@googlemail.com>
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
Message-ID: <20100201133316.GQ11819@mrnibble.lshift.net>

Thanks for forwarding that to the list, Holger.

Vladimir, we have sometimes seen very strange things with Windows and
some firewall products doing deep inspection on traffic that's going to
the internet at large - XML based content often triggers this. Could you
make sure all firewalls are off, or try using SSL?

You don't state which client you're using. If you can cut the code down
to a small example which demonstrates this problem we can certainly take
a look at that.

We know of several clients who are publishing to Rabbit at high speed
over a WAN - there is nothing inherently tricky here.

On Mon, Feb 01, 2010 at 02:23:37PM +0100, Holger Hoffstaette wrote:
> Also we have created a simple client-server application which simply
> writes data to stream and measure performance: we have seen throughput
> is about 350 kB/s (it is about 40% of network usage, what is a pretty
> good for us, because we can use three or four connections on this
> network to arrive at least 90% of network usage). We don't understand
> why RabbitMQ have poor performance using single TCP connection on our case.

I have a suspicion this is a firewall issue - with your simple
streaming, do I assume the data is all nulls, or random? And with your
Rabbit tests, is the data XML?

Matthew



From matthew at lshift.net  Mon Feb  1 13:43:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 1 Feb 2010 13:43:15 +0000
Subject: [rabbitmq-discuss] PubSub - all bindings have to be in memory?
In-Reply-To: <b0200d7f1001312158g1437c8b4y123e5af00dfd5fa6@mail.gmail.com>
References: <b0200d7f1001312158g1437c8b4y123e5af00dfd5fa6@mail.gmail.com>
Message-ID: <20100201134315.GR11819@mrnibble.lshift.net>

Hi Ben,

On Mon, Feb 01, 2010 at 07:58:52AM +0200, Ben Browitt wrote:
> Do I have to keep all bindings in memory or is there a mode where rabbitmq
> can read binding keys from disk when needed?

I'm afraid bindings are all kept in RAM. The binding record is quite
small (dependent on the size of the exchange name, binding key, queue
name and any args - minimising these will help reduce memory foot print)
so you should be able to fit quite a lot of them in RAM:

> erts_debug:flat_size(#binding{exchange_name = <<"my_exchange">>, queue_name = <<"my_queue">>, key = <<"my_key">>, args = []}).
24

So just 24 bytes for that record, though obviously with padding and
longer field values, this will grow. Fixed size values here would help -
if for example you're able to use md5sums to get the exchange name and
queue name, and only use fanout or direct exchanges, and thus have an
fixed sized hash for the binding key too, then that'll make estimations
easier.

If you can estimate given, say, twice your expected number of visitors
and twice the expected number of articles they subscribe to how many
bindings that would result in, then you may be able to satisfy yourself
whether or not this is going to be a problem.

Whilst the new persister is able to page messages out to disk, we have
no plans just at the moment to be able to do the same for bindings.

Please let us know how you get on.

Matthew



From vbalandin at griddynamics.com  Mon Feb  1 13:47:03 2010
From: vbalandin at griddynamics.com (Vladimir Balandin)
Date: Mon, 1 Feb 2010 16:47:03 +0300
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
	connection on high-latency networks
In-Reply-To: <20100201133316.GQ11819@mrnibble.lshift.net>
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
	<20100201133316.GQ11819@mrnibble.lshift.net>
Message-ID: <d00202081002010547j7d8e38f5v2a80edb177be6e84@mail.gmail.com>

Here is a code example:

        final AMQP.BasicProperties props = MessageProperties.BASIC;
        final byte[] body = new byte[64000];

        long startTime = System.nanoTime();
        for (int i = 0; i < MESSAGE_COUNT; i++) {
            try {
               channel.basicPublish("",queueName, false, false, props,
body);
            } catch (Exception cause) {
               cause.printStackTrace();
               return null;
            }
         }
        long endTime = System.nanoTime();

On Mon, Feb 1, 2010 at 4:33 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Thanks for forwarding that to the list, Holger.
>
> Vladimir, we have sometimes seen very strange things with Windows and
> some firewall products doing deep inspection on traffic that's going to
> the internet at large - XML based content often triggers this. Could you
> make sure all firewalls are off, or try using SSL?
>
> You don't state which client you're using. If you can cut the code down
> to a small example which demonstrates this problem we can certainly take
> a look at that.
>
> We know of several clients who are publishing to Rabbit at high speed
> over a WAN - there is nothing inherently tricky here.
>
> On Mon, Feb 01, 2010 at 02:23:37PM +0100, Holger Hoffstaette wrote:
> > Also we have created a simple client-server application which simply
> > writes data to stream and measure performance: we have seen throughput
> > is about 350 kB/s (it is about 40% of network usage, what is a pretty
> > good for us, because we can use three or four connections on this
> > network to arrive at least 90% of network usage). We don't understand
> > why RabbitMQ have poor performance using single TCP connection on our
> case.
>
> I have a suspicion this is a firewall issue - with your simple
> streaming, do I assume the data is all nulls, or random? And with your
> Rabbit tests, is the data XML?
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Vladimir Balandin
Grid Dynamics
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100201/3338f088/attachment.htm 

From ben.browitt at gmail.com  Mon Feb  1 14:01:06 2010
From: ben.browitt at gmail.com (Ben Browitt)
Date: Mon, 1 Feb 2010 16:01:06 +0200
Subject: [rabbitmq-discuss] PubSub - all bindings have to be in memory?
In-Reply-To: <20100201134315.GR11819@mrnibble.lshift.net>
References: <b0200d7f1001312158g1437c8b4y123e5af00dfd5fa6@mail.gmail.com>
	<20100201134315.GR11819@mrnibble.lshift.net>
Message-ID: <b0200d7f1002010601g79ebd678w6457dbce54fc77d@mail.gmail.com>

Matthew,

Let's say RAM can fit all my bindings and that I'm using fixed sized values
with direct exchanges.
Assuming that the incoming and outgoing number of messages is constant,
should I expect the performance to degrade as the number of  bindings
increases or will it stay the same?
In other words, does a large number of queues, exchanges and bindings affect
the load even when
most of them aren't being used?

Ben



On Mon, Feb 1, 2010 at 3:43 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Ben,
>
> On Mon, Feb 01, 2010 at 07:58:52AM +0200, Ben Browitt wrote:
> > Do I have to keep all bindings in memory or is there a mode where
> rabbitmq
> > can read binding keys from disk when needed?
>
> I'm afraid bindings are all kept in RAM. The binding record is quite
> small (dependent on the size of the exchange name, binding key, queue
> name and any args - minimising these will help reduce memory foot print)
> so you should be able to fit quite a lot of them in RAM:
>
> > erts_debug:flat_size(#binding{exchange_name = <<"my_exchange">>,
> queue_name = <<"my_queue">>, key = <<"my_key">>, args = []}).
> 24
>
> So just 24 bytes for that record, though obviously with padding and
> longer field values, this will grow. Fixed size values here would help -
> if for example you're able to use md5sums to get the exchange name and
> queue name, and only use fanout or direct exchanges, and thus have an
> fixed sized hash for the binding key too, then that'll make estimations
> easier.
>
> If you can estimate given, say, twice your expected number of visitors
> and twice the expected number of articles they subscribe to how many
> bindings that would result in, then you may be able to satisfy yourself
> whether or not this is going to be a problem.
>
> Whilst the new persister is able to page messages out to disk, we have
> no plans just at the moment to be able to do the same for bindings.
>
> Please let us know how you get on.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100201/6ea953ba/attachment.htm 

From holger.hoffstaette at googlemail.com  Mon Feb  1 13:59:16 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Mon, 01 Feb 2010 14:59:16 +0100
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
	connection on high-latency networks
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
	<20100201133316.GQ11819@mrnibble.lshift.net>
Message-ID: <pan.2010.02.01.13.59.14.948750@googlemail.com>

On Mon, 01 Feb 2010 13:33:16 +0000, Matthew Sackman wrote:

> Thanks for forwarding that to the list, Holger.

Next one coming up, see below.

FWIW it was not an obscure problem like firewall, Windows anomalies, ack
mode or anything like that.

I've always been curious why the default values were so small - any good
reasons? What I find even more curious is why fixing the server side
affects TCP window handling, which should normally be negotiated by the
client. IIRC that only works properly when the server does not explicitly
configure anything and uses the OS defaults.

-h

-------- Original Message --------
Subject: Re: [rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks
Date: Mon, 01 Feb 2010 14:41:36 +0100
From: Holger Hoffst?tte <holger.hoffstaette at googlemail.com>
To: Vladimir Balandin <vbalandin at griddynamics.com>

Vladimir Balandin wrote:
> We have fixed the problem by set send/receive buffers on server side.
> 
> -kernel inet_default_listen_options
> [{nodelay,true},{sndbuf,65535},{recbuf,65535}]

Good to know - I wanted to suggest that next as I always do that on my
rabbits even on LAN.

Again: please post to the list so that everyone can benefit!

-h






From nabble at project23.de  Mon Feb  1 14:40:26 2010
From: nabble at project23.de (domsom)
Date: Mon, 1 Feb 2010 06:40:26 -0800 (PST)
Subject: [rabbitmq-discuss] .NET BasicPublish randomly blocks forever
In-Reply-To: <4B60C5B2.6000304@lshift.net>
References: <27295461.post@talk.nabble.com> <4B60C5B2.6000304@lshift.net>
Message-ID: <27405247.post@talk.nabble.com>


Matthias,


Matthias Radestock-2 wrote:
> 
> [...]
> Can you upgrade to 1.7.1? We changed the memory monitoring in 1.7.1, and 
> I don't remember what the options were for controlling it in 1.7.0. The 
> new system is documented at http://www.rabbitmq.com/extensions.html#memsup
> 

Thanks for the hint - on a brief test, the upgrade fixed the issue! I
switched my apt-source to your repository as well - well done, well done!

I'll post an update in case the problem returns.

- Dominik
-- 
View this message in context: http://old.nabble.com/.NET-BasicPublish-randomly-blocks-forever-tp27295461p27405247.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthew at lshift.net  Mon Feb  1 14:42:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 1 Feb 2010 14:42:15 +0000
Subject: [rabbitmq-discuss] routing threads on a rabbitmq node
In-Reply-To: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com>
References: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com>
Message-ID: <20100201144215.GS11819@mrnibble.lshift.net>

Hi Brian,

On Sun, Jan 31, 2010 at 10:41:01PM -0800, Brian Sullivan wrote:
> I am curious if anyone on the rabbitmq team can confirm/clarify what we are
> seeing with respect to some throughput issues on our RMQ cluster.
> 
> The config:
> - 2-node RMQ cluster, running a topic-based exchange
> - 8 publishers, running on different hosts
> - dozens of consumers, ~75 wildcard topic bindings, mostly running on
> different hosts (there are a couple running on the RMQ hosts for stats, etc)
> 
> The issue:
> When we publish at a higher rate than normal, there appears to be a
> significant delay in the pipeline between when we publish the messages and
> when we receive them on the consuming side.

Although what you later say about memory growth suggests it's not this,
it could be some sort of buffering or nagle algorithm which is causing
batching of more messages, up until some buffer is full, before passing
them onto the network. On the other hand, if you're seeing memory growth
heavily in RabbitMQ-server itself, then that suggests it's nowt to do
with buffering in the clients.

> Since publishing is
> asynchronous, the publisher applications send as fast as they can, meanwhile
> we see an increasing delay in when we see those same messages come out on
> the other side.  My guess (gathered from
> http://www.rabbitmq.com/faq.html#node-per-CPU-core) is that there is either
> a single routing thread per publisher (channel), or even worse a single
> routing bottleneck per node.  Either way, this thread cannot route fast
> enough in a topic exchange (we have about 75 bindings, using wildcards) and
> there is a backup of messages to be routed.

Each channel can only route one message at a time. The topic exchanges,
with wildcards are inefficient, and are O(N) where N is the number of
bindings. This is sub optimal - there are ways in which we are planning
on fixing this, we've just not got around to implementing this yet.
However, if you really just have approx 75 bindings with wildcards in
total, I'm somewhat astonished this can be causing issues. What kind of
rates are you publishing at?

> The question:
> Can you please elaborate on where the routing backup could be occurring, and
> what steps might be best to prevent this from happening?  It appears from
> the fact that I am waiting on the routing to happen that using flags like
> "mandatory" on messages is not going to help me here (though I have not
> tested this).

I suspect it's in the channel processes. I'm not really sure what you
could do to help, but could you provide some more information please?:

1) How many msgs/second are being published for this issue to occur?
2) How big are those messages?
3) Can you give an example of the routing key used?
4) How many queues do messages end up in, on average?
5) Are the consumers setting qos, and are they using subscriptions or
just basic.get? What about acknowledgements?

> One idea:
> If it is truly the case that a single thread per node might be causing this
> problem, then perhaps we can run a small rabbitmq node on each publisher
> (joined to the cluster), with the sole purpose of doing the routing load?
> If we publish locally, all it would need to do is keep up with it's own
> routing load, not the combine routing load of 3 other publishers.  It
> doesn't really prevent the problem from happening though, if I can produce
> messages faster in a single thread than even a dedicated node can route.
> Would this even help?

Yeah, it may help, but without some more details, I'm not quite sure
just yet what to suggest.

Matthew



From matthew at lshift.net  Mon Feb  1 14:44:50 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 1 Feb 2010 14:44:50 +0000
Subject: [rabbitmq-discuss] PubSub - all bindings have to be in memory?
In-Reply-To: <b0200d7f1002010601g79ebd678w6457dbce54fc77d@mail.gmail.com>
References: <b0200d7f1001312158g1437c8b4y123e5af00dfd5fa6@mail.gmail.com>
	<20100201134315.GR11819@mrnibble.lshift.net>
	<b0200d7f1002010601g79ebd678w6457dbce54fc77d@mail.gmail.com>
Message-ID: <20100201144450.GT11819@mrnibble.lshift.net>

Ben,

Firstly, I made a mistake in my previous post - it's 24 *words*, not
bytes. Sorry!

On Mon, Feb 01, 2010 at 04:01:06PM +0200, Ben Browitt wrote:
> Let's say RAM can fit all my bindings and that I'm using fixed sized values
> with direct exchanges.
> Assuming that the incoming and outgoing number of messages is constant,
> should I expect the performance to degrade as the number of  bindings
> increases or will it stay the same?

It'll degrade. If you use topic exchanges then it can degrade linearly
(which needn't be the case - we have bugs open to fix this), but if you
use a direct exchange then it'll be O(log_2 N) as the bindings are
indexable by a b-tree.

> In other words, does a large number of queues, exchanges and bindings affect
> the load even when most of them aren't being used?

Yes. I would not recommend that you keep bindings around which are not
used for long periods of time if they impact the performance of the
system overall. It depends on what kind of throughput you're needing to
achieve.

Matthew



From matthew at lshift.net  Mon Feb  1 14:50:37 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 1 Feb 2010 14:50:37 +0000
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
 connection on high-latency networks
In-Reply-To: <pan.2010.02.01.13.59.14.948750@googlemail.com>
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
	<20100201133316.GQ11819@mrnibble.lshift.net>
	<pan.2010.02.01.13.59.14.948750@googlemail.com>
Message-ID: <20100201145037.GU11819@mrnibble.lshift.net>

On Mon, Feb 01, 2010 at 02:59:16PM +0100, Holger Hoffstaette wrote:
> On Mon, 01 Feb 2010 13:33:16 +0000, Matthew Sackman wrote:
> I've always been curious why the default values were so small - any good
> reasons? What I find even more curious is why fixing the server side
> affects TCP window handling, which should normally be negotiated by the
> client. IIRC that only works properly when the server does not explicitly
> configure anything and uses the OS defaults.

Hmm. Our defaults are
SERVER_ERL_ARGS="+K true +A30 \
-kernel inet_default_listen_options
[{nodelay,true},{sndbuf,16384},{recbuf,4096}] \
-kernel inet_default_connect_options [{nodelay,true}]"

so the send buffer you've increased by 4, and the receive buffer by 16.
I'm sure we have had some reasons as to why they're set as they are, but
I'm afraid I don't know what they were. We have recently done some
investigation into the effect of different buffer sizes in the Java
client, but nothing recently going on wrt the server. I wonder whether
Matthias or Tony may recall why our server options are set as they are.

> > We have fixed the problem by set send/receive buffers on server side.
> > 
> > -kernel inet_default_listen_options
> > [{nodelay,true},{sndbuf,65535},{recbuf,65535}]
> 
> Good to know - I wanted to suggest that next as I always do that on my
> rabbits even on LAN.

Indeed, I'm glad that's fixed. I'll raise a bug internally to have a
look at these options again. It's really a matter of providing some
sensible defaults - I'm sure that on every platform, things can be
improved by specific tunings, but it's a case of finding something that
works well out of the box.

If you have any comments or advice for us on these options then we're
certainly all ears.

Matthew



From ben.browitt at gmail.com  Mon Feb  1 15:56:14 2010
From: ben.browitt at gmail.com (Ben Browitt)
Date: Mon, 1 Feb 2010 17:56:14 +0200
Subject: [rabbitmq-discuss] PubSub - all bindings have to be in memory?
In-Reply-To: <20100201144450.GT11819@mrnibble.lshift.net>
References: <b0200d7f1001312158g1437c8b4y123e5af00dfd5fa6@mail.gmail.com>
	<20100201134315.GR11819@mrnibble.lshift.net>
	<b0200d7f1002010601g79ebd678w6457dbce54fc77d@mail.gmail.com>
	<20100201144450.GT11819@mrnibble.lshift.net>
Message-ID: <b0200d7f1002010756l1e3c3f14iabb550d9b450d778@mail.gmail.com>

Thank you.

On Mon, Feb 1, 2010 at 4:44 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Ben,
>
> Firstly, I made a mistake in my previous post - it's 24 *words*, not
> bytes. Sorry!
>
> On Mon, Feb 01, 2010 at 04:01:06PM +0200, Ben Browitt wrote:
> > Let's say RAM can fit all my bindings and that I'm using fixed sized
> values
> > with direct exchanges.
> > Assuming that the incoming and outgoing number of messages is constant,
> > should I expect the performance to degrade as the number of  bindings
> > increases or will it stay the same?
>
> It'll degrade. If you use topic exchanges then it can degrade linearly
> (which needn't be the case - we have bugs open to fix this), but if you
> use a direct exchange then it'll be O(log_2 N) as the bindings are
> indexable by a b-tree.
>
> > In other words, does a large number of queues, exchanges and bindings
> affect
> > the load even when most of them aren't being used?
>
> Yes. I would not recommend that you keep bindings around which are not
> used for long periods of time if they impact the performance of the
> system overall. It depends on what kind of throughput you're needing to
> achieve.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100201/98aa2c8f/attachment.htm 

From rajkumars at gmail.com  Mon Feb  1 17:13:44 2010
From: rajkumars at gmail.com (Rajkumar S)
Date: Mon, 1 Feb 2010 22:43:44 +0530
Subject: [rabbitmq-discuss] Disabling channel.flow
In-Reply-To: <20100201101741.GM11819@mrnibble.lshift.net>
References: <64de5c8b1002010147k3491a26bn199feb5a29db4392@mail.gmail.com>
	<20100201101741.GM11819@mrnibble.lshift.net>
Message-ID: <64de5c8b1002010913o1ee469e5r520d23f4b6a65a38@mail.gmail.com>

On Mon, Feb 1, 2010 at 3:47 PM, Matthew Sackman <matthew at lshift.net> wrote:
> Which version of Rabbit are you using? - the details for disabling
> memory monitoring have changed between 1.7.0 and 1.7.1.

I downloaded rabbitmq-public-umbrella using hg, the tip points to:

changeset:   44:259da26ec626
tag:         tip
parent:      43:0d8d8a6dddae
parent:      42:b08e26cc7170
user:        David Wragg <dpw at lshift.net>
date:        Mon Oct 05 13:03:37 2009 +0100
summary:     Merge bug21745 into default

I used hg to install stomp plugin also along with rabbit. I can always
try and install latest/other  versions if that helps.

> I advise against disabling memory monitoring. If you do disable it, and
> then Rabbit runs out of memory, Rabbit will crash, likely losing more
> messages.

I understand, but the flow control keeps hitting frequently enough to
make rabbit-stomp almost useless :( So far I have not been able to
exercise any sort of control over when the flow control kicks in. Is
it possible to know how much memory rabbit thinks it has and how much
more memory it can use before flow control kicks in?

I just want to make sure that flow control does not kick in too frequently.

with regards,

raj



From matthew at lshift.net  Mon Feb  1 17:23:44 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 1 Feb 2010 17:23:44 +0000
Subject: [rabbitmq-discuss] Disabling channel.flow
In-Reply-To: <64de5c8b1002010913o1ee469e5r520d23f4b6a65a38@mail.gmail.com>
References: <64de5c8b1002010147k3491a26bn199feb5a29db4392@mail.gmail.com>
	<20100201101741.GM11819@mrnibble.lshift.net>
	<64de5c8b1002010913o1ee469e5r520d23f4b6a65a38@mail.gmail.com>
Message-ID: <20100201172343.GV11819@mrnibble.lshift.net>

Hi,

On Mon, Feb 01, 2010 at 10:43:44PM +0530, Rajkumar S wrote:
> On Mon, Feb 1, 2010 at 3:47 PM, Matthew Sackman <matthew at lshift.net> wrote:
> > Which version of Rabbit are you using? - the details for disabling
> > memory monitoring have changed between 1.7.0 and 1.7.1.
> 
> I downloaded rabbitmq-public-umbrella using hg, the tip points to:
> 
> changeset:   44:259da26ec626
> tag:         tip
> parent:      43:0d8d8a6dddae
> parent:      42:b08e26cc7170
> user:        David Wragg <dpw at lshift.net>
> date:        Mon Oct 05 13:03:37 2009 +0100
> summary:     Merge bug21745 into default
> 
> I used hg to install stomp plugin also along with rabbit. I can always
> try and install latest/other  versions if that helps.

You should *never* use tip. Tip is one of the daftest features of hg and
just points to the most recent commit. Given that we do branch per bug,
you could simply get *any* currently active branch.

There are later revisions than this. I would recommend you pull and hg
up -C default.

What you've actually given is the revision under
rabbitmq-public-umbrella. I should have been more clear: I was asking
for which version of rabbitmq-server are you using? However, I assume
you're building from source, in which case the details at
http://www.rabbitmq.com/extensions.html#memsup should help.

> I understand, but the flow control keeps hitting frequently enough to
> make rabbit-stomp almost useless :( So far I have not been able to
> exercise any sort of control over when the flow control kicks in. Is
> it possible to know how much memory rabbit thinks it has and how much
> more memory it can use before flow control kicks in?

Yes. In the logs, at start up you should see a message like:

=INFO REPORT==== 1-Feb-2010::13:36:41 ===
Memory limit set to 3151MB.

This is controlled by the vm_memory_high_watermark parameter which is
documented in the link above. When the Erlang VM has allocated more than
this amount of RAM, flow control will be invoked. If you set the
parameter to 0, then Rabbit will not monitor memory, nor will flow
control be used.

Matthew



From matt at 11craft.com  Tue Feb  2 05:25:53 2010
From: matt at 11craft.com (Matthew Scott)
Date: Mon, 1 Feb 2010 21:25:53 -0800
Subject: [rabbitmq-discuss] messages get stuck when using rabbitmq on
	windows, but not on osx or 	ubuntu
Message-ID: <9dbfb671002012125s17c53922n4bda3699b92f3ce4@mail.gmail.com>

I'm experiencing a problem with messages getting "stalled" when serving
RabbitMQ with Windows XP.

The context is a distributed job processing system, wherein some message
payloads can be around 250-500 kB.  The clients connecting to the broker are
several programs written in Python using the txAMQP library and the AMQP 0-8
protocol.  (*)

We can submit one job in our system, which results in several small
messages, and four larger messages being routed through RabbitMQ with the
size ranges noted above, and this succeeds.  However, when we submit an
identical job, one message with a larger payload is successfully routed, but
the second one is not.  I can see that it successfully reaches the broker
but never reaches the intended destination, because I get this output:

C:\rabbitmq_server-1.7.1\sbin>rabbitmqctl list_connections send_oct
send_pend
Listing connections ...
594     0
1183650 0
236655  0
616     0
610     0
2492155 256809    <-- here is the stuck message
616     0
616     0
367     0


Configuration:
- rabbitmq 1.7.1 on Windows XP, installed from packages available at
rabbitmq.com
- (also exhibited problem with rabbitmq 1.6.0 on Windows XP)
- all clients running on Windows, OR some clients on Windows (required as
they call out to Windows executables) and some on OS X
- ***exhibits problems noted above***

Configuration:
- rabbitmq 1.7.0 on Mac OS X 10.6, installed via
http://github.com/mxcl/homebrew/blob/master/Library/Formula/rabbitmq.rb
- all clients running on Windows
- no problems exhibited; can run many jobs successfully

Configuration:
- rabbitmq 1.6.0 on Ubuntu 9.10, installed using official Ubuntu packages
- all clients running on Windows
- no problems exhibited; can run many jobs successfully


We would prefer to run RabbitMQ as a service on Windows, as we have more
combined experience with Windows administration, but if stumped we will
consider running RabbitMQ on a locked down Ubuntu VM.

If needed I can try to create and post a script that triggers this problem,
but I thought I'd post this first to see if anyone has experienced a similar
problem and can offer a potential solution, or other troubleshooting
techniques.


(*) These programs originally used py-amqplib, and experienced the same
problem, but were ported to txAMQP to see if that would fix the problem and
to also improve performance when the system is idle.  Unfortunately while
the system performance improved, the problem with RabbitMQ on Windows still
persists.


-- 
Matthew Scott
ElevenCraft Inc.
+1 360 389-2512
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100201/c4f8d310/attachment.htm 

From seemasbiradar at gmail.com  Tue Feb  2 05:48:23 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Tue, 2 Feb 2010 11:18:23 +0530
Subject: [rabbitmq-discuss] Garbage Collection Problem in Consumer
Message-ID: <558967a41002012148u60c8b8c4sae08ad2e1fc67803@mail.gmail.com>

Hi All,

i tried the rabbit MQ with Producer and Consumer Program.

in Consumer side i am getting the all the Message, but the following objects

com.rabbitmq.client.QueueingConsumer.Delivery
com.rabbitmq.client.Envelop
com.rabbitmq.client.AMQP.BasicProperties

are created for each message and not garbage collected immediately after
consuming.

*in Producer.java
*
used basic publish as shown below.

channel.basicPublish(exchangeName, routingKey, true, false,
MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray()) ;


*Consumer.java
*
channel.basicConsume(queueName, true, consumer);

with no-acknowledgement *true*.

Please let me know, how to make the above object eligible for garbage
collection immediately after consuming.
for Consumer program The Heap Memory allocated is more , as this is
performace issue


Thanks,
Seema
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100202/263d463c/attachment.htm 

From aquino.gustavo at gmail.com  Tue Feb  2 11:31:50 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 2 Feb 2010 09:31:50 -0200
Subject: [rabbitmq-discuss] Garbage Collection Problem in Consumer
In-Reply-To: <558967a41002012148u60c8b8c4sae08ad2e1fc67803@mail.gmail.com>
References: <558967a41002012148u60c8b8c4sae08ad2e1fc67803@mail.gmail.com>
Message-ID: <5ef296b31002020331m6b7ab085xef85425a21b0c66e@mail.gmail.com>

Seema,

You can't control when your GC will run, if you declare this objects into
loop and don't are using hash tables or maps to reutilize it, so it will
be eligible to GC automatically, because your life cycle over in next loop.

Today I have a consumer in Java consuming about 1.000 m/s and never used
more than 15Mb and this objects never go throw eden memory, if you don't
forward this objects created inside consumer loop, this objects will be
automatic eligible for GC but GC don't run immediately you need to wait.

Can you post your consumer code ?



On Tue, Feb 2, 2010 at 3:48 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Hi All,
>
> i tried the rabbit MQ with Producer and Consumer Program.
>
> in Consumer side i am getting the all the Message, but the following
> objects
>
> com.rabbitmq.client.QueueingConsumer.Delivery
> com.rabbitmq.client.Envelop
> com.rabbitmq.client.AMQP.BasicProperties
>
> are created for each message and not garbage collected immediately after
> consuming.
>
> *in Producer.java
> *
> used basic publish as shown below.
>
> channel.basicPublish(exchangeName, routingKey, true, false,
> MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray()) ;
>
>
> *Consumer.java
> *
> channel.basicConsume(queueName, true, consumer);
>
> with no-acknowledgement *true*.
>
> Please let me know, how to make the above object eligible for garbage
> collection immediately after consuming.
> for Consumer program The Heap Memory allocated is more , as this is
> performace issue
>
>
> Thanks,
> Seema
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100202/e73e5e6c/attachment.htm 

From seemasbiradar at gmail.com  Tue Feb  2 12:29:04 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Tue, 2 Feb 2010 17:59:04 +0530
Subject: [rabbitmq-discuss] Garbage Collection Problem in Consumer
In-Reply-To: <5ef296b31002020331m6b7ab085xef85425a21b0c66e@mail.gmail.com>
References: <558967a41002012148u60c8b8c4sae08ad2e1fc67803@mail.gmail.com>
	<5ef296b31002020331m6b7ab085xef85425a21b0c66e@mail.gmail.com>
Message-ID: <558967a41002020429v58777247rd2872ce50d12ed83@mail.gmail.com>

Hi ,

Please find the attached code for Consumer.java.

public class SingleConsumer{

 public static void main(String args[]) {


 ConnectionParameters params = new ConnectionParameters();

params.setUsername(janusProperties.getProperty("rabbitmq_userName").trim());

params.setPassword(janusProperties.getProperty("rabbitmq_password").trim());
            params.setVirtualHost("/");
            params.setRequestedHeartbeat(0);
            ConnectionFactory factory = new ConnectionFactory(params);
            com.rabbitmq.client.Connection connRMQ =
factory.newConnection(janusProperties.getProperty("rabbitmq_server_ip").trim(),
Integer.parseInt(janusProperties.getProperty("rabbitmq_server_port").trim()));


            Channel channel = connRMQ.createChannel();

            String exchangeName =
janusProperties.getProperty("rabbitmq_exchangeName").trim();
            String queueName =
janusProperties.getProperty("rabbitmq_queueName").trim();
            String routingKey =
janusProperties.getProperty("rabbitmq_routingKey").trim();

            QueueingConsumer consumer = new QueueingConsumer(channel);
            channel.basicConsume(queueName, true, consumer);
           QueueingConsumer.Delivery delivery;
            while (!runInfinite)
            {
                      try {

                     delivery = consumer.nextDelivery();

                         } catch (InterruptedException ie) {
                    log.debug("Problem in Deliverying the message");
                    continue;
                }

                  /* 1 . Do some operation on the consumed data which will
take 2 -3 sec of time.
                      2. if above operation is success than continue to
receive next data
                      3. if above operation fails than resend the message
back to the queue( Consumer acting as Producer) using channel.basicPublish

                  */
                    channel.basicPublish(exchangeName, routingKey, true,
false, MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray());

}

}
        }

Memory leakage is because of operating on the data which take times. In that
time the QueueingDelivery objects are created as many as the the messages
sent by the Producer.

Thanks,
Seema
On Tue, Feb 2, 2010 at 5:01 PM, Gustavo Aquino <aquino.gustavo at gmail.com>wrote:

> Seema,
>
> You can't control when your GC will run, if you declare this objects into
> loop and don't are using hash tables or maps to reutilize it, so it will
> be eligible to GC automatically, because your life cycle over in next loop.
>
> Today I have a consumer in Java consuming about 1.000 m/s and never used
> more than 15Mb and this objects never go throw eden memory, if you don't
> forward this objects created inside consumer loop, this objects will be
> automatic eligible for GC but GC don't run immediately you need to wait.
>
> Can you post your consumer code ?
>
>
>
>   On Tue, Feb 2, 2010 at 3:48 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>
>>   Hi All,
>>
>> i tried the rabbit MQ with Producer and Consumer Program.
>>
>> in Consumer side i am getting the all the Message, but the following
>> objects
>>
>> com.rabbitmq.client.QueueingConsumer.Delivery
>> com.rabbitmq.client.Envelop
>> com.rabbitmq.client.AMQP.BasicProperties
>>
>> are created for each message and not garbage collected immediately after
>> consuming.
>>
>> *in Producer.java
>> *
>> used basic publish as shown below.
>>
>> channel.basicPublish(exchangeName, routingKey, true, false,
>> MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray()) ;
>>
>>
>> *Consumer.java
>> *
>> channel.basicConsume(queueName, true, consumer);
>>
>> with no-acknowledgement *true*.
>>
>> Please let me know, how to make the above object eligible for garbage
>> collection immediately after consuming.
>> for Consumer program The Heap Memory allocated is more , as this is
>> performace issue
>>
>>
>> Thanks,
>> Seema
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100202/db1c999e/attachment.htm 

From matthias at lshift.net  Tue Feb  2 12:35:12 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 02 Feb 2010 12:35:12 +0000
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
 connection on high-latency networks
In-Reply-To: <20100201145037.GU11819@mrnibble.lshift.net>
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>	<pan.2010.01.30.21.38.58.153375@googlemail.com>	<pan.2010.02.01.13.23.37.24000@googlemail.com>	<20100201133316.GQ11819@mrnibble.lshift.net>	<pan.2010.02.01.13.59.14.948750@googlemail.com>
	<20100201145037.GU11819@mrnibble.lshift.net>
Message-ID: <4B681C00.10408@lshift.net>

Matthew Sackman wrote:
> I wonder whether Matthias or Tony may recall why our server options
> are set as they are.

We don't want to set very large buffer sizes since we do not want to 
increase the memory footprint of connections unnecessarily. The figures 
we currently use are the minimum numbers above which I saw no 
significant performance improvements in the tests I ran ~2 years ago. 
But those tests weren't very extensive.

> Indeed, I'm glad that's fixed. I'll raise a bug internally to have a
> look at these options again. It's really a matter of providing some
> sensible defaults - I'm sure that on every platform, things can be
> improved by specific tunings, but it's a case of finding something that
> works well out of the box.
> 
> If you have any comments or advice for us on these options then we're
> certainly all ears.

The difficulty is that there are so many variables affecting the result. 
To work out the ideal default settings for the server we'd have to run 
tests that vary all of the following in a sufficiently broad range to 
capture most common rabbit deployments ...

- client buffer sizes
- network characteristics (latency and bandwidth)
- operating system
- message size

...and plot the latency stats achieved for various message rates (we may 
find that certain settings improve latency for low throughput but 
actually reduce overall throughput capacity).

Performing these tests and producing a report would make an ideal 
community project since it requires very little knowledge of the server 
or client internals.

Holger, do you want to have a first stab at it?


Matthias.



From sennol at student.ethz.ch  Tue Feb  2 12:54:18 2010
From: sennol at student.ethz.ch (Oliver Senn)
Date: Tue, 2 Feb 2010 13:54:18 +0100
Subject: [rabbitmq-discuss] RabbitHub: Binding a queue to an exchange
Message-ID: <4B68207A.7030506@student.ethz.ch>

Hi all,

My question is about the RabbitHub plugin. I know it's not 
officially supported but maybe somebody used it before and can tell 
me how to do it:

How do I bind a queue to an exchange? From the example scripts 
provided with RabbitHub it is clear how to declare exchanges and 
queues but not how to bind them together...

Any idea how to do this?

Thanks a lot.

Oliver



From aquino.gustavo at gmail.com  Tue Feb  2 13:12:23 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 2 Feb 2010 11:12:23 -0200
Subject: [rabbitmq-discuss] Garbage Collection Problem in Consumer
In-Reply-To: <558967a41002020429v58777247rd2872ce50d12ed83@mail.gmail.com>
References: <558967a41002012148u60c8b8c4sae08ad2e1fc67803@mail.gmail.com>
	<5ef296b31002020331m6b7ab085xef85425a21b0c66e@mail.gmail.com>
	<558967a41002020429v58777247rd2872ce50d12ed83@mail.gmail.com>
Message-ID: <5ef296b31002020512n2b58e308ibc0f1f949bfa23fd@mail.gmail.com>

Seema,

I think that your performance problem is in piece of code that you dropped,
this dropped code probably are reusing Rabbitmq objects references, and this
guys are going to Old memory and will be collected in different time, this
cause your feeling about "Rabbit object aren't eligible to GC".

Take a look about how you are using Rabbit objects inside your code. Try to
use only the message like a TO.

About republish message, If you are publishing it in the same queue that you
consume, you can just get message, process it and if OK remove it from queue
using ..ask instead publish it in the end of your flow.

I don't saw any performance problems in this piece of code posted here.

On Tue, Feb 2, 2010 at 10:29 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Hi ,
>
> Please find the attached code for Consumer.java.
>
> public class SingleConsumer{
>
>  public static void main(String args[]) {
>
>
>  ConnectionParameters params = new ConnectionParameters();
>
> params.setUsername(janusProperties.getProperty("rabbitmq_userName").trim());
>
> params.setPassword(janusProperties.getProperty("rabbitmq_password").trim());
>             params.setVirtualHost("/");
>             params.setRequestedHeartbeat(0);
>             ConnectionFactory factory = new ConnectionFactory(params);
>             com.rabbitmq.client.Connection connRMQ =
> factory.newConnection(janusProperties.getProperty("rabbitmq_server_ip").trim(),
> Integer.parseInt(janusProperties.getProperty("rabbitmq_server_port").trim()));
>
>
>             Channel channel = connRMQ.createChannel();
>
>             String exchangeName =
> janusProperties.getProperty("rabbitmq_exchangeName").trim();
>             String queueName =
> janusProperties.getProperty("rabbitmq_queueName").trim();
>             String routingKey =
> janusProperties.getProperty("rabbitmq_routingKey").trim();
>
>             QueueingConsumer consumer = new QueueingConsumer(channel);
>
>             channel.basicConsume(queueName, true, consumer);
>            QueueingConsumer.Delivery delivery;
>             while (!runInfinite)
>             {
>                       try {
>
>                      delivery = consumer.nextDelivery();
>
>                          } catch (InterruptedException ie) {
>                     log.debug("Problem in Deliverying the message");
>                     continue;
>                 }
>
>                   /* 1 . Do some operation on the consumed data which will
> take 2 -3 sec of time.
>                       2. if above operation is success than continue to
> receive next data
>                       3. if above operation fails than resend the message
> back to the queue( Consumer acting as Producer) using channel.basicPublish
>
>                   */
>                     channel.basicPublish(exchangeName, routingKey, true,
> false, MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray());
>
> }
>
> }
>         }
>
> Memory leakage is because of operating on the data which take times. In
> that time the QueueingDelivery objects are created as many as the the
> messages sent by the Producer.
>
> Thanks,
> Seema
> On Tue, Feb 2, 2010 at 5:01 PM, Gustavo Aquino <aquino.gustavo at gmail.com>wrote:
>
>> Seema,
>>
>> You can't control when your GC will run, if you declare this objects into
>> loop and don't are using hash tables or maps to reutilize it, so it will
>> be eligible to GC automatically, because your life cycle over in next loop.
>>
>> Today I have a consumer in Java consuming about 1.000 m/s and never used
>> more than 15Mb and this objects never go throw eden memory, if you don't
>> forward this objects created inside consumer loop, this objects will be
>> automatic eligible for GC but GC don't run immediately you need to wait.
>>
>> Can you post your consumer code ?
>>
>>
>>
>>   On Tue, Feb 2, 2010 at 3:48 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>
>>>   Hi All,
>>>
>>> i tried the rabbit MQ with Producer and Consumer Program.
>>>
>>> in Consumer side i am getting the all the Message, but the following
>>> objects
>>>
>>> com.rabbitmq.client.QueueingConsumer.Delivery
>>> com.rabbitmq.client.Envelop
>>> com.rabbitmq.client.AMQP.BasicProperties
>>>
>>> are created for each message and not garbage collected immediately after
>>> consuming.
>>>
>>> *in Producer.java
>>> *
>>> used basic publish as shown below.
>>>
>>> channel.basicPublish(exchangeName, routingKey, true, false,
>>> MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray()) ;
>>>
>>>
>>> *Consumer.java
>>> *
>>> channel.basicConsume(queueName, true, consumer);
>>>
>>> with no-acknowledgement *true*.
>>>
>>> Please let me know, how to make the above object eligible for garbage
>>> collection immediately after consuming.
>>> for Consumer program The Heap Memory allocated is more , as this is
>>> performace issue
>>>
>>>
>>> Thanks,
>>> Seema
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100202/face606d/attachment.htm 

From seemasbiradar at gmail.com  Tue Feb  2 13:29:22 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Tue, 2 Feb 2010 18:59:22 +0530
Subject: [rabbitmq-discuss] Garbage Collection Problem in Consumer
In-Reply-To: <5ef296b31002020512n2b58e308ibc0f1f949bfa23fd@mail.gmail.com>
References: <558967a41002012148u60c8b8c4sae08ad2e1fc67803@mail.gmail.com>
	<5ef296b31002020331m6b7ab085xef85425a21b0c66e@mail.gmail.com>
	<558967a41002020429v58777247rd2872ce50d12ed83@mail.gmail.com>
	<5ef296b31002020512n2b58e308ibc0f1f949bfa23fd@mail.gmail.com>
Message-ID: <558967a41002020529i2e4ce59ao7f4ab95e2b2c05ac@mail.gmail.com>

Thanks for the information.

On Tue, Feb 2, 2010 at 6:42 PM, Gustavo Aquino <aquino.gustavo at gmail.com>wrote:

> Seema,
>
> I think that your performance problem is in piece of code that you dropped,
> this dropped code probably are reusing Rabbitmq objects references, and this
> guys are going to Old memory and will be collected in different time, this
> cause your feeling about "Rabbit object aren't eligible to GC".
>
> Take a look about how you are using Rabbit objects inside your code. Try to
> use only the message like a TO.
>
> About republish message, If you are publishing it in the same queue that
> you consume, you can just get message, process it and if OK remove it from
> queue using ..ask instead publish it in the end of your flow.
>
> I don't saw any performance problems in this piece of code posted here.
>
>
> On Tue, Feb 2, 2010 at 10:29 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>
>> Hi ,
>>
>> Please find the attached code for Consumer.java.
>>
>> public class SingleConsumer{
>>
>>  public static void main(String args[]) {
>>
>>
>>  ConnectionParameters params = new ConnectionParameters();
>>
>> params.setUsername(janusProperties.getProperty("rabbitmq_userName").trim());
>>
>> params.setPassword(janusProperties.getProperty("rabbitmq_password").trim());
>>             params.setVirtualHost("/");
>>             params.setRequestedHeartbeat(0);
>>             ConnectionFactory factory = new ConnectionFactory(params);
>>             com.rabbitmq.client.Connection connRMQ =
>> factory.newConnection(janusProperties.getProperty("rabbitmq_server_ip").trim(),
>> Integer.parseInt(janusProperties.getProperty("rabbitmq_server_port").trim()));
>>
>>
>>             Channel channel = connRMQ.createChannel();
>>
>>             String exchangeName =
>> janusProperties.getProperty("rabbitmq_exchangeName").trim();
>>             String queueName =
>> janusProperties.getProperty("rabbitmq_queueName").trim();
>>             String routingKey =
>> janusProperties.getProperty("rabbitmq_routingKey").trim();
>>
>>             QueueingConsumer consumer = new QueueingConsumer(channel);
>>
>>             channel.basicConsume(queueName, true, consumer);
>>            QueueingConsumer.Delivery delivery;
>>             while (!runInfinite)
>>             {
>>                       try {
>>
>>                      delivery = consumer.nextDelivery();
>>
>>                          } catch (InterruptedException ie) {
>>                     log.debug("Problem in Deliverying the message");
>>                     continue;
>>                 }
>>
>>                   /* 1 . Do some operation on the consumed data which will
>> take 2 -3 sec of time.
>>                       2. if above operation is success than continue to
>> receive next data
>>                       3. if above operation fails than resend the message
>> back to the queue( Consumer acting as Producer) using channel.basicPublish
>>
>>                   */
>>                      channel.basicPublish(exchangeName, routingKey, true,
>> false, MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray());
>>
>> }
>>
>> }
>>         }
>>
>> Memory leakage is because of operating on the data which take times. In
>> that time the QueueingDelivery objects are created as many as the the
>> messages sent by the Producer.
>>
>> Thanks,
>> Seema
>>   On Tue, Feb 2, 2010 at 5:01 PM, Gustavo Aquino <
>> aquino.gustavo at gmail.com> wrote:
>>
>>> Seema,
>>>
>>> You can't control when your GC will run, if you declare this objects into
>>> loop and don't are using hash tables or maps to reutilize it, so it will
>>> be eligible to GC automatically, because your life cycle over in next loop.
>>>
>>> Today I have a consumer in Java consuming about 1.000 m/s and never used
>>> more than 15Mb and this objects never go throw eden memory, if you don't
>>> forward this objects created inside consumer loop, this objects will be
>>> automatic eligible for GC but GC don't run immediately you need to wait.
>>>
>>> Can you post your consumer code ?
>>>
>>>
>>>
>>>   On Tue, Feb 2, 2010 at 3:48 AM, Seema Biradar <seemasbiradar at gmail.com
>>> > wrote:
>>>
>>>>   Hi All,
>>>>
>>>> i tried the rabbit MQ with Producer and Consumer Program.
>>>>
>>>> in Consumer side i am getting the all the Message, but the following
>>>> objects
>>>>
>>>> com.rabbitmq.client.QueueingConsumer.Delivery
>>>> com.rabbitmq.client.Envelop
>>>> com.rabbitmq.client.AMQP.BasicProperties
>>>>
>>>> are created for each message and not garbage collected immediately after
>>>> consuming.
>>>>
>>>> *in Producer.java
>>>> *
>>>> used basic publish as shown below.
>>>>
>>>> channel.basicPublish(exchangeName, routingKey, true, false,
>>>> MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray()) ;
>>>>
>>>>
>>>> *Consumer.java
>>>> *
>>>> channel.basicConsume(queueName, true, consumer);
>>>>
>>>> with no-acknowledgement *true*.
>>>>
>>>> Please let me know, how to make the above object eligible for garbage
>>>> collection immediately after consuming.
>>>> for Consumer program The Heap Memory allocated is more , as this is
>>>> performace issue
>>>>
>>>>
>>>> Thanks,
>>>> Seema
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100202/e8330e24/attachment.htm 

From matthew at lshift.net  Tue Feb  2 13:57:35 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 2 Feb 2010 13:57:35 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
Message-ID: <20100202135735.GA8318@mrnibble.lshift.net>

Hi,

On Thu, Jan 28, 2010 at 04:26:24PM +0100, Ergeerts Glenn wrote:
> This is the output:
> 
> 3> os_mon_sysinfo:get_mem_info().
> ["76 -1658880 1016913920 -1 -1021628416 2147352576 2134794240\n"]

The plot thickens.

I have a 64-bit Vista virtual image which I've just tested, using R13B03
grabbed from erlang.org, and amounts of RAM of 2GB, 3GB, 4GB and 5GB.

In all cases, os_mon_sysinfo:get_mem_info() reports the correct thing.

You've said you're running 64-bit Windows 7. Which version of Erlang are
you running, and did you compile yourself, or did you grab it from
erlang.org?

You'll find the win32sysinfo in
c:\program files (x86)\erl5.7.4\libs\os_mon-2.2.4\priv\bin

(assuming you're using R13B03)

If you also happen to have cygwin installed, and can open up a bash
shell, cd to that dir, and then run ldd and sha1sum, I'm curious as to
whether your results match mine:

matthew at vista ~
$ ldd win32sysinfo.exe
        ntdll.dll => /cygdrive/c/Windows/SysWOW64/ntdll.dll (0x76eb0000)
        kernel32.dll => /cygdrive/c/Windows/syswow64/kernel32.dll
(0x75460000)
        MSVCR80.dll =>
/cygdrive/c/Windows/WinSxS/x86_microsoft.vc80.crt_1fc8b3b
9a1e18e3b_8.0.50727.4053_none_d08d7da0442a985d/MSVCR80.dll (0x73bb0000)
        msvcrt.dll => /cygdrive/c/Windows/syswow64/msvcrt.dll
(0x768f0000)

matthew at vista ~
$ sha1sum win32sysinfo.exe
0c059b1649f250a362c75ccc5438a44dddbe1fad *win32sysinfo.exe

Best wishes,

Matthew



From matthew at lshift.net  Tue Feb  2 15:04:18 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 2 Feb 2010 15:04:18 +0000
Subject: [rabbitmq-discuss] Important: Windows users of RabbitMQ v1.7.1
Message-ID: <20100202150418.GB8318@mrnibble.lshift.net>

We would strongly recommend you upgrade the version of Erlang to the
latest: R13B03. The Windows bundle of RabbitMQ includes Erlang version
R12B-5, which contains a bug resulting in incorrect amounts of memory
being reported to Rabbit. This can in some cases, cause Rabbit to
believe there is negative amounts of RAM installed, and thus refuse to
accept any messages at all.

Erlang R13B03 for Windows can be downloaded from
http://www.erlang.org/download/otp_win32_R13B03.exe

After installing, you need to update the environment variable
ERLANG_HOME. To do this:

Click start; right-click on Computer; click Properties; click "Advanced
System Settings"; click "Environment Variables".

In the bottom half of the window, you should have list containing an
entry for ERLANG_HOME. This should be updated so that the final
component is erl5.7.4 (which corresponds to Erlang R13B03). Verify that
the path here is the path where you installed Erlang R13B03.

However, whilst Erlang R13B03 is able to correctly detect the amount of
RAM installed in Windows (in fact, the fix arrived in Erlang R13B), it
does not take into account the fact that Windows commonly does not allow
32-bit applications (which includes Erlang) to use more than 2GB of RAM.

Thus you may still see Rabbit crashing with "unable to allocate memory"
type errors. Thus for Windows users who have more than 2GB RAM
installed, after upgrading to Erlang R13B03, we would recommend you do
the following:

1) calculate the following: X = 820 / total-RAM-in-MB. Eg if you have
4GB installed then X = 820 / 4096 = 0.2. It doesn't have to be super
accurate, just close enough.

2) open a cmd shell:
> cd %APPDATA%\RabbitMQ
> notepad rabbitmq.config

Note the cd may fail if the directory doesn't exist. In that case,
> cd %APPDATA%
> mkdir RabbitMQ
> cd RabbitMQ
> notepad rabbitmq.config

3) into notepad, type:
[{rabbit, [{vm_memory_high_watermark, X}]}].
where X is replaced by the value you calculated in step 1. This assumes
that you don't already have a configuration file for rabbitmq. If you
do, then you need to add the {vm_memory_high_watermark, X} or adjust an
existing entry for vm_memory_high_watermark, again, where X is replaced
by the value you calculated in step 1.

4) save the file in notepad.

5) Restart RabbitMQ.

6) Check rabbit's logs. The location of these are displayed when
rabbit starts up. They should contain an entry like:

=INFO REPORT====30-Feb-2010::15:43:60 ===
Memory limit set to 820MB.

If the limit is way off 820MB then you've either mis-calculated X in
step 1, or you've edited the wrong file.


Notes
-----

a) This issue only affects Rabbit running under Windows
b) It only affects RabbitMQ v1.7.1
c) A fix for this bug will be included in the next release of RabbitMQ
which we expect to release soon.
d) As ever, please let us know of any issues you come across with
Rabbit.

Matthew



From Franck.Boisson at mlp.com  Tue Feb  2 16:09:13 2010
From: Franck.Boisson at mlp.com (Boisson, Franck)
Date: Wed, 3 Feb 2010 00:09:13 +0800
Subject: [rabbitmq-discuss] Simple client/server running on different OS are
	lagging
Message-ID: <1590A5C25AF3E9438F4232897EEFA51401028A12@EXCHSI001.AD.MLP.COM>

Hello,

 

I am facing a strange issue with the Rabbitmq environment.

I try to run two simple processes written in Python (with amqplib): One
publisher and one subscriber.

The publisher is publishing a 10Meg data (not exactly 10Meg but
10,000,000 * 'A') and the subscriber is receiving it.

When all these three processes (including rabbitmq) are running under
the same OS  (not especially the same computer but the same OS),
everything is working correctly but when one of them is running on a
different OS, it is lagging a lot.

Hereunder is a king of matrix giving you a rough idea of what is
happening:

 

-          Publisher-OS: WIN ; RabbitMQ-OS: WIN ; Subscriber-OS: WIN =>
OK (less than a sec for the transfert)

-          Publisher-OS: WIN ; RabbitMQ-OS: WIN ; Subscriber-OS: LIN =>
NOK (Subscriber is lagging)

-          Publisher-OS: WIN ; RabbitMQ-OS: LIN ; Subscriber-OS: WIN =>
NOK (At least publisher is lagging - more than 4min to publish)

-          Publisher-OS: WIN ; RabbitMQ-OS: LIN ; Subscriber-OS: LIN =>
NOK (Publisher is lagging - more than 4min to publish)

-          Publisher-OS: LIN ; RabbitMQ-OS: WIN ; Subscriber-OS: WIN =>
NOK (Publisher is lagging - more than 4min to publish)

-          Publisher-OS: LIN ; RabbitMQ-OS: LIN ; Subscriber-OS: LIN =>
OK (less than a sec for the transfert)

-          ...

 

I am using RabbitMQ V1.7.0

 

Regards

Franck

 


######################################################################
The information contained in this communication is confidential and
may contain information that is privileged or exempt from disclosure
under applicable law. If you are not a named addressee, please notify
the sender immediately and delete this email from your system.
If you have received this communication, and are not a named
recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited.
######################################################################
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/79678cec/attachment.htm 

From matthew at lshift.net  Tue Feb  2 16:26:58 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 2 Feb 2010 16:26:58 +0000
Subject: [rabbitmq-discuss] Simple client/server running on different OS
 are lagging
In-Reply-To: <1590A5C25AF3E9438F4232897EEFA51401028A12@EXCHSI001.AD.MLP.COM>
References: <1590A5C25AF3E9438F4232897EEFA51401028A12@EXCHSI001.AD.MLP.COM>
Message-ID: <20100202162658.GD8318@mrnibble.lshift.net>

Hi Frank,

Not really too sure what to suggest, but others on the list have
reported better throughput when increasing buffers in Rabbit:

Vladimir Balandin wrote:
> We have fixed the problem by set send/receive buffers on server side.
> 
> -kernel inet_default_listen_options
> [{nodelay,true},{sndbuf,65535},{recbuf,65535}]

The easiest way to set these is to edit rabbitmq-server(.bat) directly -
these values are set near the top of rabbitmq-server and near the bottom
of rabbitmq-server.bat.

That may or may not solve these issues, but it's certainly worth trying.

On Wed, Feb 03, 2010 at 12:09:13AM +0800, Boisson, Franck wrote:
> The publisher is publishing a 10Meg data (not exactly 10Meg but
> 10,000,000 * 'A') and the subscriber is receiving it.

If that's all one message, then the message must be fully received by
the broker before it starts being streamed out to the client.

Matthew



From matthew at lshift.net  Tue Feb  2 16:48:17 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 2 Feb 2010 16:48:17 +0000
Subject: [rabbitmq-discuss] Simple client/server running on different OS
 are lagging
In-Reply-To: <20100202162658.GD8318@mrnibble.lshift.net>
References: <1590A5C25AF3E9438F4232897EEFA51401028A12@EXCHSI001.AD.MLP.COM>
	<20100202162658.GD8318@mrnibble.lshift.net>
Message-ID: <20100202164817.GE8318@mrnibble.lshift.net>

Hi Frank,

On Tue, Feb 02, 2010 at 04:26:58PM +0000, Matthew Sackman wrote:
> Not really too sure what to suggest, but others on the list have
> reported better throughput when increasing buffers in Rabbit

Also, you're using the python client, to do performance testing, which
is a little questionable - in our experience the python clients tend to
perform badly. I'd suggest you test using our Java client which contains
an example program called MulticastMain which is pretty flexible for
testing performance and sustainable throughput.

>From the rabbitmq-java-client directory:
ant clean dist
cd build/dist
sh runjava.sh com/rabbitmq/examples/MulticastMain -s 1000000 -r 25 -a -z 20 -q 1

where the -s parameter specifies the size, in bytes, the -r parameter
specifies the sending rate, -a turns on auto-ack, which you may want for
this, -z says how long to run the test for (in seconds) and -q sets the
qos on the consumer to 1.

This will create one producer and one consumer on the same box. You
should vary the rate (-r) until the sending rates and receiving rates
are balanced and sustainable (I tend to watch the reported latencies -
if they keep increasing, then it's not balanced).

Other if you just provide -? then it'll print out all the options. If
you want to use different machines for producer and consumer then you
can use -x 0 to turn off producers, and -y 0 to turn off consumers on
each box respectively. If you do do that, then you'll also need to
specify at least -e to name the exchange, and likely set -t to fanout
otherwise it'll attempt to use a private queue of the default direct
exchange and thus not route messages to the consumer. Also, start the
consumer first.

So, the consumer might look like this:

sh runjava.sh com/rabbitmq/examples/MulticastMain -s 10000000 -r 1 -a -z 20 -q 1 -x 0 -e my_exchage -t fanout

whilst the producer looks like:

sh runjava.sh com/rabbitmq/examples/MulticastMain -s 10000000 -r 1 -a -z 20 -q 1 -y 0 -e my_exchage -t fanout

These certainly work for me.

Matthew



From alexis.richardson at gmail.com  Tue Feb  2 17:06:22 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 2 Feb 2010 17:06:22 +0000
Subject: [rabbitmq-discuss] RabbitHub: Binding a queue to an exchange
In-Reply-To: <4B68207A.7030506@student.ethz.ch>
References: <4B68207A.7030506@student.ethz.ch>
Message-ID: <167204d21002020906n7d16b36aw7e9326882f60f89d@mail.gmail.com>

Oliver

The author of that plugin is on vacation and told me that he may not
check email until the 9th.  I have bcc'd him just in case ;-)

alexis




On Tue, Feb 2, 2010 at 12:54 PM, Oliver Senn <sennol at student.ethz.ch> wrote:
> Hi all,
>
> My question is about the RabbitHub plugin. I know it's not
> officially supported but maybe somebody used it before and can tell
> me how to do it:
>
> How do I bind a queue to an exchange? From the example scripts
> provided with RabbitHub it is clear how to declare exchanges and
> queues but not how to bind them together...
>
> Any idea how to do this?
>
> Thanks a lot.
>
> Oliver
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From holger.hoffstaette at googlemail.com  Tue Feb  2 17:26:54 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Tue, 02 Feb 2010 18:26:54 +0100
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
	connection on high-latency networks
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
	<20100201133316.GQ11819@mrnibble.lshift.net>
	<pan.2010.02.01.13.59.14.948750@googlemail.com>
	<20100201145037.GU11819@mrnibble.lshift.net>
	<4B681C00.10408@lshift.net>
Message-ID: <pan.2010.02.02.17.26.54.249500@googlemail.com>

On Tue, 02 Feb 2010 12:35:12 +0000, Matthias Radestock wrote:

> Matthew Sackman wrote:
>> I wonder whether Matthias or Tony may recall why our server options are
>> set as they are.
> 
> We don't want to set very large buffer sizes since we do not want to
> increase the memory footprint of connections unnecessarily. The figures we
> currently use are the minimum numbers above which I saw no significant
> performance improvements in the tests I ran ~2 years ago. But those tests
> weren't very extensive.

Fair enough, but I'm not sure why the values have to be even smaller than
e.g. Linux' vanilla defaults. Ideally - and given that Rabbit is mostly
used on Linux/Unix - they should not be necessary at all, especially as
they prevent any client-side settings from taking effect (I think - would
have to check with wireshark).

But in principle you're right, there are so many first- and second-order
effects and OS/network permutations at play here that it's impossible to
find the one perfect default. XP is different from Vista from Win7, and
RedHat's kernels have little in common with the mainline release. Even the
latest few mainline releases have seen an insane number of back-and-forth
fixes for all sorts of TCP behaviour, timers, CPU scheduling and whatnot.

That's why I think the defaults should ideally just be removed.
Platform/language-specific tuning recommendations can then be created for
different usage scenarios on the wiki by any users on their respective
platforms..provided it's easy enough to arrive at meaningful numbers and
submit them.

The comment re. memory usage with a lot of connections is interesting
though - is this really a problem even with epoll (aka kernel polling)?
What would be a large number of connections - 100? 1000?

I cannot really afford to take a few weeks off just for this, even if it
is an interesting project. Can't you get an intern or student ;)

Holger





From groundduckleg at gmail.com  Tue Feb  2 18:04:42 2010
From: groundduckleg at gmail.com (Bob)
Date: Tue, 2 Feb 2010 12:04:42 -0600
Subject: [rabbitmq-discuss] file chunking for .net client?
Message-ID: <0A64CDD6AB0F4621A108920E60264066@matdev40b>

Hey guys, I heard there were file chunking clients out there to help break apart large messages. Does anyone know of one for .net or even what the best way to handle large messages is?

Thanks guys!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100202/940fb85d/attachment.htm 

From bsullivan at lindenlab.com  Tue Feb  2 21:45:48 2010
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Tue, 2 Feb 2010 13:45:48 -0800
Subject: [rabbitmq-discuss] routing threads on a rabbitmq node
In-Reply-To: <20100201144215.GS11819@mrnibble.lshift.net>
References: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com> 
	<20100201144215.GS11819@mrnibble.lshift.net>
Message-ID: <b93cb8621002021345l59d1f1adt3cd3c3773a5545a9@mail.gmail.com>

Hi Matthew,

Thanks for the speedy response.  Answers below.  And yes, this is all memory
growth on the rabbitmq side, the clients are able to burn through their
catchup logs pretty quickly, then coast along as regular rates, meanwhile
the server is chewing on it's work to catch up, sometimes for *hours*.

1) How many msgs/second are being published for this issue to occur?
>From a single producer, about 900 messages/sec during these burst catchup
periods.  Normal volumes then drop down to 300-500 mps throughout the day,
which we can keep up with for the most part.  Note that there are 8-9 such
producers, distributed across 2 nodes.

2) How big are those messages?
They vary in size, but in the neighborhood of 500 bytes each.  Pretty small.

3) Can you give an example of the routing key used?
We were originally looking to do <domain>.<eventname>, but really everything
subscribes to "#.<eventname>".  It's a little wasted and I think I would
like to at some point switch back to a direct exchange and partition our
traffic by domain another way, since we don't subscribe to things across all
domains like I expected we might.  There are on the order of about 100
eventnames at this point, of varying frequencies.

4) How many queues do messages end up in, on average?
About the same number of bindings - 75.  We don't do many multiple bindings
per queue (if any).

5) Are the consumers setting qos, and are they using subscriptions or just
basic.get? What about acknowledgements?
Consumers are using the Java client, no qos settings, via subscriptions (via
QueueingConsumer.nextDelivery()).

Acknowledgements are sent after each message is retrieved via
QueueingConsumer.getChannel().basicAck(envelope.getDeliveryTag(), false);

Like I said, there is no queue backup, so I don't think it's on the
consuming side.  In fact, I can pull up a new client that just does a simple
subscription and it will instantly start showing the current place in the
routing, which could be that past hour of messages.

Does that help?  Thanks again for digging into this with me, this has been a
growing problem for us that I need to understand better to help rearchitect
our configuration.

Thanks,
Brian


On Mon, Feb 1, 2010 at 6:42 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Brian,
>
> On Sun, Jan 31, 2010 at 10:41:01PM -0800, Brian Sullivan wrote:
> > I am curious if anyone on the rabbitmq team can confirm/clarify what we
> are
> > seeing with respect to some throughput issues on our RMQ cluster.
> >
> > The config:
> > - 2-node RMQ cluster, running a topic-based exchange
> > - 8 publishers, running on different hosts
> > - dozens of consumers, ~75 wildcard topic bindings, mostly running on
> > different hosts (there are a couple running on the RMQ hosts for stats,
> etc)
> >
> > The issue:
> > When we publish at a higher rate than normal, there appears to be a
> > significant delay in the pipeline between when we publish the messages
> and
> > when we receive them on the consuming side.
>
> Although what you later say about memory growth suggests it's not this,
> it could be some sort of buffering or nagle algorithm which is causing
> batching of more messages, up until some buffer is full, before passing
> them onto the network. On the other hand, if you're seeing memory growth
> heavily in RabbitMQ-server itself, then that suggests it's nowt to do
> with buffering in the clients.
>
> > Since publishing is
> > asynchronous, the publisher applications send as fast as they can,
> meanwhile
> > we see an increasing delay in when we see those same messages come out on
> > the other side.  My guess (gathered from
> > http://www.rabbitmq.com/faq.html#node-per-CPU-core) is that there is
> either
> > a single routing thread per publisher (channel), or even worse a single
> > routing bottleneck per node.  Either way, this thread cannot route fast
> > enough in a topic exchange (we have about 75 bindings, using wildcards)
> and
> > there is a backup of messages to be routed.
>
> Each channel can only route one message at a time. The topic exchanges,
> with wildcards are inefficient, and are O(N) where N is the number of
> bindings. This is sub optimal - there are ways in which we are planning
> on fixing this, we've just not got around to implementing this yet.
> However, if you really just have approx 75 bindings with wildcards in
> total, I'm somewhat astonished this can be causing issues. What kind of
> rates are you publishing at?
>
> > The question:
> > Can you please elaborate on where the routing backup could be occurring,
> and
> > what steps might be best to prevent this from happening?  It appears from
> > the fact that I am waiting on the routing to happen that using flags like
> > "mandatory" on messages is not going to help me here (though I have not
> > tested this).
>
> I suspect it's in the channel processes. I'm not really sure what you
> could do to help, but could you provide some more information please?:
>
> 1) How many msgs/second are being published for this issue to occur?
> 2) How big are those messages?
> 3) Can you give an example of the routing key used?
> 4) How many queues do messages end up in, on average?
> 5) Are the consumers setting qos, and are they using subscriptions or
> just basic.get? What about acknowledgements?
>
> > One idea:
> > If it is truly the case that a single thread per node might be causing
> this
> > problem, then perhaps we can run a small rabbitmq node on each publisher
> > (joined to the cluster), with the sole purpose of doing the routing load?
> > If we publish locally, all it would need to do is keep up with it's own
> > routing load, not the combine routing load of 3 other publishers.  It
> > doesn't really prevent the problem from happening though, if I can
> produce
> > messages faster in a single thread than even a dedicated node can route.
> > Would this even help?
>
> Yeah, it may help, but without some more details, I'm not quite sure
> just yet what to suggest.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100202/69205aea/attachment.htm 

From matthias at lshift.net  Wed Feb  3 02:00:37 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 03 Feb 2010 02:00:37 +0000
Subject: [rabbitmq-discuss] routing threads on a rabbitmq node
In-Reply-To: <b93cb8621002021345l59d1f1adt3cd3c3773a5545a9@mail.gmail.com>
References: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com>
	<20100201144215.GS11819@mrnibble.lshift.net>
	<b93cb8621002021345l59d1f1adt3cd3c3773a5545a9@mail.gmail.com>
Message-ID: <4B68D8C5.3030003@lshift.net>

Brian,

Brian Sullivan wrote:
> 1) How many msgs/second are being published for this issue to occur?
>  From a single producer, about 900 messages/sec during these burst 
> catchup periods.  Normal volumes then drop down to 300-500 mps 
> throughout the day, which we can keep up with for the most part.  Note 
> that there are 8-9 such producers, distributed across 2 nodes.

So that's a 900Hz * 9 = 8.1kHz peak inbound rate?

> 4) How many queues do messages end up in, on average?
> About the same number of bindings - 75.  We don't do many multiple 
> bindings per queue (if any).

8.1kHz inbound with a 75x fan-out ratio would require an outbound rate 
of >600kHz, which is way more than a two-node rabbit cluster can handle. 
So some backlog will certainly build up.

It will take a while for messages to make it into queues. This isn't 
helped by lack of optimisation in two areas of the server code:

- topic exchanges. As you know, they are currently totally unoptimised 
and the cost of determining the queues a message should be routed to is 
linear in the total number of bindings on the exchage. How many bindings 
are there in total in your case? If you can, please use a direct exchange.

- cross-node routing in a cluster. A while ago we had to remove 
optimised cross-node routing since it turned out to break certain effect 
visibility guarantees required by AMQP. As a result, routing a message 
to N queues residing on a different node will result in N network 
transmissions of the message to that node, and N copies of the message 
at the node. If you can, don't use clustering or at least avoid 
configurations where producers and consumers connect to different nodes.


Regards,

Matthias.



From matthias at lshift.net  Wed Feb  3 02:56:40 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 03 Feb 2010 02:56:40 +0000
Subject: [rabbitmq-discuss] Poor performance using a single
 RabbitMQ	connection on high-latency networks
In-Reply-To: <pan.2010.02.02.17.26.54.249500@googlemail.com>
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>	<pan.2010.01.30.21.38.58.153375@googlemail.com>	<pan.2010.02.01.13.23.37.24000@googlemail.com>	<20100201133316.GQ11819@mrnibble.lshift.net>	<pan.2010.02.01.13.59.14.948750@googlemail.com>	<20100201145037.GU11819@mrnibble.lshift.net>	<4B681C00.10408@lshift.net>
	<pan.2010.02.02.17.26.54.249500@googlemail.com>
Message-ID: <4B68E5E8.2080300@lshift.net>

Holger,

Holger Hoffstaette wrote:
> I'm not sure why the values have to be even smaller than e.g. Linux'
> vanilla defaults. Ideally - and given that Rabbit is mostly used on
> Linux/Unix - they should not be necessary at all, especially as they
> prevent any client-side settings from taking effect (I think - would
> have to check with wireshark).

Our sndbuf setting actually is the same as gets reported by Erlang by 
default on the systems I've tried - 16k. OTOH, the recbuf setting of 4k 
is significantly smaller than the 85k Erlang reports by default.

As I mentioned before, I tried to minimise per-connection memory usage. 
So the figures are the lowest I could find that showed good performance 
in my tests.

But yes, I'd rather stick to the defaults too. See below.

> The comment re. memory usage with a lot of connections is interesting
> though - is this really a problem even with epoll (aka kernel polling)?
> What would be a large number of connections - 100? 1000?

Depends what you are running on. A linksys slug - the smallest device 
we've run rabbit on - can quite happily handle thousands of connections, 
but not if they each take up >100k off memory.

OTOH, if you are running rabbit under extreme conditions then perhaps 
it's not too much to ask for some manual parameter tweaking.

So I think we should investigate sticking to the defaults, and let users 
tweak the settings when they need to. That's also what decided to do in 
the client libraries.


Matthias.



From techabc at gmail.com  Wed Feb  3 04:57:57 2010
From: techabc at gmail.com (techabc)
Date: Wed, 3 Feb 2010 12:57:57 +0800
Subject: [rabbitmq-discuss] Is there more infos about AMQP 1.0 and rabbitmq
	roadmap towards it?
Message-ID: <acc7b4fd1002022057n2a4159f6hdb3011353c8ff14b@mail.gmail.com>

AMQP 1.0 reached PR 2 stage, and what plans after that? When final release?
According to the amqp bussiness requrement, must be 1.0 final after a
few implementations finished, rabbitmq ready for it?

best regards,



From pradeep.gatram at gmail.com  Wed Feb  3 05:12:52 2010
From: pradeep.gatram at gmail.com (Pradeep Gatram)
Date: Wed, 3 Feb 2010 10:42:52 +0530
Subject: [rabbitmq-discuss] Garbage Collection Problem in Consumer
In-Reply-To: <558967a41002020529i2e4ce59ao7f4ab95e2b2c05ac@mail.gmail.com>
References: <558967a41002012148u60c8b8c4sae08ad2e1fc67803@mail.gmail.com> 
	<5ef296b31002020331m6b7ab085xef85425a21b0c66e@mail.gmail.com> 
	<558967a41002020429v58777247rd2872ce50d12ed83@mail.gmail.com> 
	<5ef296b31002020512n2b58e308ibc0f1f949bfa23fd@mail.gmail.com> 
	<558967a41002020529i2e4ce59ao7f4ab95e2b2c05ac@mail.gmail.com>
Message-ID: <9a2d8f781002022112k7f0c700ar9cc0a10827030d35@mail.gmail.com>

I wonder if you are running into a problem where you are fetching far too
many messages to consume, while each/some of your messages spend 2-3 seconds
in processing.

Explore the prefetch options. I ran into something similar and started
using

http://gist.github.com/293346

Pradeep
www.masplantiz.com

On Tue, Feb 2, 2010 at 6:59 PM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Thanks for the information.
>
>
> On Tue, Feb 2, 2010 at 6:42 PM, Gustavo Aquino <aquino.gustavo at gmail.com>wrote:
>
>> Seema,
>>
>> I think that your performance problem is in piece of code that you
>> dropped, this dropped code probably are reusing Rabbitmq objects references,
>> and this guys are going to Old memory and will be collected in different
>> time, this cause your feeling about "Rabbit object aren't eligible to GC".
>>
>> Take a look about how you are using Rabbit objects inside your code. Try
>> to use only the message like a TO.
>>
>> About republish message, If you are publishing it in the same queue that
>> you consume, you can just get message, process it and if OK remove it from
>> queue using ..ask instead publish it in the end of your flow.
>>
>> I don't saw any performance problems in this piece of code posted here.
>>
>>
>> On Tue, Feb 2, 2010 at 10:29 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>
>>> Hi ,
>>>
>>> Please find the attached code for Consumer.java.
>>>
>>> public class SingleConsumer{
>>>
>>>  public static void main(String args[]) {
>>>
>>>
>>>  ConnectionParameters params = new ConnectionParameters();
>>>
>>> params.setUsername(janusProperties.getProperty("rabbitmq_userName").trim());
>>>
>>> params.setPassword(janusProperties.getProperty("rabbitmq_password").trim());
>>>             params.setVirtualHost("/");
>>>             params.setRequestedHeartbeat(0);
>>>             ConnectionFactory factory = new ConnectionFactory(params);
>>>             com.rabbitmq.client.Connection connRMQ =
>>> factory.newConnection(janusProperties.getProperty("rabbitmq_server_ip").trim(),
>>> Integer.parseInt(janusProperties.getProperty("rabbitmq_server_port").trim()));
>>>
>>>
>>>             Channel channel = connRMQ.createChannel();
>>>
>>>             String exchangeName =
>>> janusProperties.getProperty("rabbitmq_exchangeName").trim();
>>>             String queueName =
>>> janusProperties.getProperty("rabbitmq_queueName").trim();
>>>             String routingKey =
>>> janusProperties.getProperty("rabbitmq_routingKey").trim();
>>>
>>>             QueueingConsumer consumer = new QueueingConsumer(channel);
>>>
>>>             channel.basicConsume(queueName, true, consumer);
>>>            QueueingConsumer.Delivery delivery;
>>>             while (!runInfinite)
>>>             {
>>>                       try {
>>>
>>>                      delivery = consumer.nextDelivery();
>>>
>>>                          } catch (InterruptedException ie) {
>>>                     log.debug("Problem in Deliverying the message");
>>>                     continue;
>>>                 }
>>>
>>>                   /* 1 . Do some operation on the consumed data which
>>> will take 2 -3 sec of time.
>>>                       2. if above operation is success than continue to
>>> receive next data
>>>                       3. if above operation fails than resend the message
>>> back to the queue( Consumer acting as Producer) using channel.basicPublish
>>>
>>>                   */
>>>                      channel.basicPublish(exchangeName, routingKey,
>>> true, false, MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray());
>>>
>>> }
>>>
>>> }
>>>         }
>>>
>>> Memory leakage is because of operating on the data which take times. In
>>> that time the QueueingDelivery objects are created as many as the the
>>> messages sent by the Producer.
>>>
>>> Thanks,
>>> Seema
>>>   On Tue, Feb 2, 2010 at 5:01 PM, Gustavo Aquino <
>>> aquino.gustavo at gmail.com> wrote:
>>>
>>>> Seema,
>>>>
>>>> You can't control when your GC will run, if you declare this objects
>>>> into loop and don't are using hash tables or maps to reutilize it, so it
>>>> will be eligible to GC automatically, because your life cycle over in next
>>>> loop.
>>>>
>>>> Today I have a consumer in Java consuming about 1.000 m/s and never used
>>>> more than 15Mb and this objects never go throw eden memory, if you don't
>>>> forward this objects created inside consumer loop, this objects will be
>>>> automatic eligible for GC but GC don't run immediately you need to wait.
>>>>
>>>> Can you post your consumer code ?
>>>>
>>>>
>>>>
>>>>   On Tue, Feb 2, 2010 at 3:48 AM, Seema Biradar <
>>>> seemasbiradar at gmail.com> wrote:
>>>>
>>>>>   Hi All,
>>>>>
>>>>> i tried the rabbit MQ with Producer and Consumer Program.
>>>>>
>>>>> in Consumer side i am getting the all the Message, but the following
>>>>> objects
>>>>>
>>>>> com.rabbitmq.client.QueueingConsumer.Delivery
>>>>> com.rabbitmq.client.Envelop
>>>>> com.rabbitmq.client.AMQP.BasicProperties
>>>>>
>>>>> are created for each message and not garbage collected immediately
>>>>> after consuming.
>>>>>
>>>>> *in Producer.java
>>>>> *
>>>>> used basic publish as shown below.
>>>>>
>>>>> channel.basicPublish(exchangeName, routingKey, true, false,
>>>>> MessageProperties.PERSISTENT_TEXT_PLAIN, bao.toByteArray()) ;
>>>>>
>>>>>
>>>>> *Consumer.java
>>>>> *
>>>>> channel.basicConsume(queueName, true, consumer);
>>>>>
>>>>> with no-acknowledgement *true*.
>>>>>
>>>>> Please let me know, how to make the above object eligible for garbage
>>>>> collection immediately after consuming.
>>>>> for Consumer program The Heap Memory allocated is more , as this is
>>>>> performace issue
>>>>>
>>>>>
>>>>> Thanks,
>>>>> Seema
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/5520aad4/attachment.htm 

From pradeep.gatram at gmail.com  Wed Feb  3 05:16:52 2010
From: pradeep.gatram at gmail.com (Pradeep Gatram)
Date: Wed, 3 Feb 2010 10:46:52 +0530
Subject: [rabbitmq-discuss] Simple client/server running on different OS
	are lagging
In-Reply-To: <20100202164817.GE8318@mrnibble.lshift.net>
References: <1590A5C25AF3E9438F4232897EEFA51401028A12@EXCHSI001.AD.MLP.COM> 
	<20100202162658.GD8318@mrnibble.lshift.net>
	<20100202164817.GE8318@mrnibble.lshift.net>
Message-ID: <9a2d8f781002022116k19c781b7xe66497f78daa876d@mail.gmail.com>

Franck,

Have you checked the timestamps of the involved machines? Sounds like a 4min
time difference between the two clocks.

Pradeep
www.masplantiz.com

On Tue, Feb 2, 2010 at 10:18 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Frank,
>
> On Tue, Feb 02, 2010 at 04:26:58PM +0000, Matthew Sackman wrote:
> > Not really too sure what to suggest, but others on the list have
> > reported better throughput when increasing buffers in Rabbit
>
> Also, you're using the python client, to do performance testing, which
> is a little questionable - in our experience the python clients tend to
> perform badly. I'd suggest you test using our Java client which contains
> an example program called MulticastMain which is pretty flexible for
> testing performance and sustainable throughput.
>
> From the rabbitmq-java-client directory:
> ant clean dist
> cd build/dist
> sh runjava.sh com/rabbitmq/examples/MulticastMain -s 1000000 -r 25 -a -z 20
> -q 1
>
> where the -s parameter specifies the size, in bytes, the -r parameter
> specifies the sending rate, -a turns on auto-ack, which you may want for
> this, -z says how long to run the test for (in seconds) and -q sets the
> qos on the consumer to 1.
>
> This will create one producer and one consumer on the same box. You
> should vary the rate (-r) until the sending rates and receiving rates
> are balanced and sustainable (I tend to watch the reported latencies -
> if they keep increasing, then it's not balanced).
>
> Other if you just provide -? then it'll print out all the options. If
> you want to use different machines for producer and consumer then you
> can use -x 0 to turn off producers, and -y 0 to turn off consumers on
> each box respectively. If you do do that, then you'll also need to
> specify at least -e to name the exchange, and likely set -t to fanout
> otherwise it'll attempt to use a private queue of the default direct
> exchange and thus not route messages to the consumer. Also, start the
> consumer first.
>
> So, the consumer might look like this:
>
> sh runjava.sh com/rabbitmq/examples/MulticastMain -s 10000000 -r 1 -a -z 20
> -q 1 -x 0 -e my_exchage -t fanout
>
> whilst the producer looks like:
>
> sh runjava.sh com/rabbitmq/examples/MulticastMain -s 10000000 -r 1 -a -z 20
> -q 1 -y 0 -e my_exchage -t fanout
>
> These certainly work for me.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/79ba2a19/attachment.htm 

From meyer at paperplanes.de  Wed Feb  3 09:50:13 2010
From: meyer at paperplanes.de (Mathias Meyer)
Date: Wed, 3 Feb 2010 10:50:13 +0100
Subject: [rabbitmq-discuss] Dead but still established connections in
	RabbitMQ on EC2
Message-ID: <fce2e45e1002030150g6d8996d6uf70d0678e6358bbf@mail.gmail.com>

Mornin,

we had an odd situation yesterday where we fired up an EC2 instance
with a Ruby-based client (using the EventMachine-based AMQP lib) that
connected to our Rabbit (also running on an EC2 host) using its
external IP address. Some time after the client connected its host got
a new (elastic) IP address assigned. One of the two active connections
from the old IP was dropped as Rabbit received an according exception
on it, but the other wasn't, and is still established according to
lsof -i and netstat almost 24 hours later. Problem is that Rabbit
apparently tried to deliver messages to these sockets and noone picked
up. The client that reconnected from the new IP in the meantime did
not get the messages, only when I killed it and restarted it.

We've had that situation twice already, and while there's some ways to
work around that I'm wondering if there's some way to work around
that, some configuration tweak (like heartbeats or something) so that
Rabbit will recognize dead connections and close them?

We're using 1.7 (will try updating to 1.7.1 later today) without any
particular configuration tweaks.

Any help or pointers would be much appreciated.

Cheers, Mathias
-- 
http://paperplanes.de | http://holgarific.net
http://twitter.com/roidrage



From alexis.richardson at gmail.com  Wed Feb  3 10:34:36 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 3 Feb 2010 10:34:36 +0000
Subject: [rabbitmq-discuss] Is there more infos about AMQP 1.0 and
	rabbitmq roadmap towards it?
In-Reply-To: <acc7b4fd1002022057n2a4159f6hdb3011353c8ff14b@mail.gmail.com>
References: <acc7b4fd1002022057n2a4159f6hdb3011353c8ff14b@mail.gmail.com>
Message-ID: <167204d21002030234r5c193ab1h8ca9486aea4000c8@mail.gmail.com>

Hi

On Wed, Feb 3, 2010 at 4:57 AM, techabc <techabc at gmail.com> wrote:
> AMQP 1.0 reached PR 2 stage, and what plans after that?

The plan is to develop 1.0 to a "recommended" or "Commitee Draft"
spec, after which full AMQP 1.0 broker implementations should be
developed.  When two independent, proven conformant and interoperable
broker implementations exist, then 1.0 can be declared "final".
Changes *may* occur between "Commitee Draft" and "final" but they
should be *minor*.

See: http://www.amqp.org/confluence/display/AMQP/AMQP1.0+SIG


> When final release?

We hope all the spec releases can be in 2010.  Obviously "final" is
contingent on seeing proven broker interop and conformance.  We
wouldn't want to rush that and mess it up.  So that may be a practical
factor in slowing things down.  But, in my personal view, the major
spec to keep an eye on is the *next* release aka "Commitee Draft".


> According to the amqp bussiness requrement, must be 1.0 final after a
> few implementations finished

Yes.  To be precise: "The Committee Draft will only be promoted to
AMQP 1.0 Final once two materially independent implementations have
been developed and demonstrated to interoperate."


> rabbitmq ready for it?

We are at least as ready as anyone else is.

alexis



>
> best regards,
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From ben.browitt at gmail.com  Wed Feb  3 11:06:56 2010
From: ben.browitt at gmail.com (Ben Browitt)
Date: Wed, 3 Feb 2010 13:06:56 +0200
Subject: [rabbitmq-discuss] does native web xmpp plugin in rabbitmq makes
	sense?
Message-ID: <b0200d7f1002030306g110fc309sa2a70f2d54571f60@mail.gmail.com>

Hi

There is the xmpp bridge with ejabberd but I wonder if native xmpp bosh
support in rabbitmq makes sense.
Let's say mochiweb accept xmpp http requests, a process per user receive a
request and decide what to do with it.
Each process will use the amqp erlang client to create a channel and then
exchanges, queues and bindings when needed.

If mochiweb handles the connections and a plugin handles the logic do I
really gain anything by using rabbitmq?
I have a feeling that rabbitmq is the way to go but I don't know why.
What benefits do I get by using rabbitmq in this scenario?

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/373922b2/attachment.htm 

From alexis.richardson at gmail.com  Wed Feb  3 11:43:23 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 3 Feb 2010 11:43:23 +0000
Subject: [rabbitmq-discuss] does native web xmpp plugin in rabbitmq
	makes sense?
In-Reply-To: <b0200d7f1002030306g110fc309sa2a70f2d54571f60@mail.gmail.com>
References: <b0200d7f1002030306g110fc309sa2a70f2d54571f60@mail.gmail.com>
Message-ID: <167204d21002030343y73af5e8emaac32bf6dbd24e5b@mail.gmail.com>

Ben

Let me have a stab at this.  Others may have more useful comments.

The main benefit of using RabbitMQ in these cases is twofold:

1. You want to do pubsub and/or queueing, perhaps "at scale"

2. You want to make use of a RabbitMQ client (or clients) for an
'integration scenario'.

For example you may wish to combine both 1 and 2 to scale up your web
or IM server by using queues to decouple user requests, from back end
services that fulfil them, and then gather the results of the work on
another queue before returning aggregate results to the user.

Does this help?

alexis



On Wed, Feb 3, 2010 at 11:06 AM, Ben Browitt <ben.browitt at gmail.com> wrote:
> Hi
>
> There is the xmpp bridge with ejabberd but I wonder if native xmpp bosh
> support in rabbitmq makes sense.
> Let's say mochiweb accept xmpp http requests, a process per user receive a
> request and decide what to do with it.
> Each process will use the amqp erlang client to create a channel and then
> exchanges, queues and bindings when needed.
>
> If mochiweb handles the connections and a plugin handles the logic do I
> really gain anything by using rabbitmq?
> I have a feeling that rabbitmq is the way to go but I don't know why.
> What benefits do I get by using rabbitmq in this scenario?
>
> Ben
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From ben.browitt at gmail.com  Wed Feb  3 11:55:48 2010
From: ben.browitt at gmail.com (Ben Browitt)
Date: Wed, 3 Feb 2010 13:55:48 +0200
Subject: [rabbitmq-discuss] does native web xmpp plugin in rabbitmq
	makes sense?
In-Reply-To: <167204d21002030343y73af5e8emaac32bf6dbd24e5b@mail.gmail.com>
References: <b0200d7f1002030306g110fc309sa2a70f2d54571f60@mail.gmail.com>
	<167204d21002030343y73af5e8emaac32bf6dbd24e5b@mail.gmail.com>
Message-ID: <b0200d7f1002030355g64ad9773r1129aa15c4b2d910@mail.gmail.com>

Alexis

Let's take Facebook chat as an example. You only have web interface with
xmpp or a custom protocol.
You have several servers that need to sync.
How RabbitMQ can be usefull in this scenario? Do you mean that each IM
server will have a RabbitMQ node
that will send and receive sync messages from other RabbitMQ nodes on other
IM servers?

ben

On Wed, Feb 3, 2010 at 1:43 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Ben
>
> Let me have a stab at this.  Others may have more useful comments.
>
> The main benefit of using RabbitMQ in these cases is twofold:
>
> 1. You want to do pubsub and/or queueing, perhaps "at scale"
>
> 2. You want to make use of a RabbitMQ client (or clients) for an
> 'integration scenario'.
>
> For example you may wish to combine both 1 and 2 to scale up your web
> or IM server by using queues to decouple user requests, from back end
> services that fulfil them, and then gather the results of the work on
> another queue before returning aggregate results to the user.
>
> Does this help?
>
> alexis
>
>
>
> On Wed, Feb 3, 2010 at 11:06 AM, Ben Browitt <ben.browitt at gmail.com>
> wrote:
> > Hi
> >
> > There is the xmpp bridge with ejabberd but I wonder if native xmpp bosh
> > support in rabbitmq makes sense.
> > Let's say mochiweb accept xmpp http requests, a process per user receive
> a
> > request and decide what to do with it.
> > Each process will use the amqp erlang client to create a channel and then
> > exchanges, queues and bindings when needed.
> >
> > If mochiweb handles the connections and a plugin handles the logic do I
> > really gain anything by using rabbitmq?
> > I have a feeling that rabbitmq is the way to go but I don't know why.
> > What benefits do I get by using rabbitmq in this scenario?
> >
> > Ben
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/5cf85453/attachment.htm 

From peter.fitzgibbons at gmail.com  Wed Feb  3 12:21:24 2010
From: peter.fitzgibbons at gmail.com (Peter Fitzgibbons)
Date: Wed, 3 Feb 2010 06:21:24 -0600
Subject: [rabbitmq-discuss] Fwd: Client-connection failover workarounds
	(ruby)
In-Reply-To: <1665d41e-b998-4d73-a17c-d8da649375b4@19g2000yql.googlegroups.com>
References: <1665d41e-b998-4d73-a17c-d8da649375b4@19g2000yql.googlegroups.com>
Message-ID: <670a00381002030421w53fce458k21c1b0a5df8cb2ce@mail.gmail.com>

Hello All,

I'm thinking about how to handle client-connection failover.  By this
I mean clientA has a producerP that needs to have reliable and
tolerant connections to rabbitA and rabbitB.  This is so that if the
connection/pid of rabbitA goes down, producerP sends it's next message
to rabbitB with as little handling (and wall-clock time) as possible.

I have read many of the threads around durable queue, the howto, the
'pedantics', etc.  I am trying to see how I can answer a network-
failover requirement with RabbitMQ.

The best solution I can think of right now is to have a rabbitP on the
same machine as producerP, which is clustered to the "real" cluster,
so if rabbitA goes down, the built-in clustering failover will handle
the proper interaction.  My issue with this is considering how this is
configured and maintained when the farm of servers with producerP gets
to be 1000+.  Even if this doesn't scale to the google-farm level,
what about farm = 10, 30 ?


Any thoughts on this would be very appreciated.

Peter Fitzgibbons
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/5fde88bd/attachment.htm 

From alexis.richardson at gmail.com  Wed Feb  3 12:29:14 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 3 Feb 2010 12:29:14 +0000
Subject: [rabbitmq-discuss] does native web xmpp plugin in rabbitmq
	makes sense?
In-Reply-To: <b0200d7f1002030355g64ad9773r1129aa15c4b2d910@mail.gmail.com>
References: <b0200d7f1002030306g110fc309sa2a70f2d54571f60@mail.gmail.com>
	<167204d21002030343y73af5e8emaac32bf6dbd24e5b@mail.gmail.com>
	<b0200d7f1002030355g64ad9773r1129aa15c4b2d910@mail.gmail.com>
Message-ID: <167204d21002030429p7655dfccx901b21f872af78e0@mail.gmail.com>

Ben,

I have taken the liberty of bcc'ing a couple of people with experience
of both XMPP and AMQP.  They may have some better answers to your
questions.


On Wed, Feb 3, 2010 at 11:55 AM, Ben Browitt <ben.browitt at gmail.com> wrote:
> Alexis
>
> Let's take Facebook chat as an example. You only have web interface with
> xmpp or a custom protocol.
> You have several servers that need to sync.
> How RabbitMQ can be usefull in this scenario?

I think there are several ways that RabbitMQ can be useful here.
First of all though, please do note that 'xmpp chat' is after all
*the* core use case for ejabberd and I would very much expect that it
would do the best job in many of these cases.

That said: RabbitMQ could be useful if you want to use a proprietary
or 'custom' protocol, eg roll-your-own for the web interface, and a
binary back end.  No use of XML.  And by the same token, RabbitMQ
could be useful if you want to combine XMPP with this.


> Do you mean that each IM
> server will have a RabbitMQ node
> that will send and receive sync messages from other RabbitMQ nodes on other
> IM servers?

Well, that is not a use case I had considered since I would imagine
that XMPP IM servers should federate happily OOTB.

I don't have much experience of the load patterns that might make a
person favour AMQP in the way that Jack tweeted about here:
http://tweeteorites.com/tweet/8198995879

I keep a list of links here that you may find useful:
http://delicious.com/alexisrichardson/rabbitmq+xmpp

Best wishes

alexis






>
> ben
>
> On Wed, Feb 3, 2010 at 1:43 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Ben
>>
>> Let me have a stab at this. ?Others may have more useful comments.
>>
>> The main benefit of using RabbitMQ in these cases is twofold:
>>
>> 1. You want to do pubsub and/or queueing, perhaps "at scale"
>>
>> 2. You want to make use of a RabbitMQ client (or clients) for an
>> 'integration scenario'.
>>
>> For example you may wish to combine both 1 and 2 to scale up your web
>> or IM server by using queues to decouple user requests, from back end
>> services that fulfil them, and then gather the results of the work on
>> another queue before returning aggregate results to the user.
>>
>> Does this help?
>>
>> alexis
>>
>>
>>
>> On Wed, Feb 3, 2010 at 11:06 AM, Ben Browitt <ben.browitt at gmail.com>
>> wrote:
>> > Hi
>> >
>> > There is the xmpp bridge with ejabberd but I wonder if native xmpp bosh
>> > support in rabbitmq makes sense.
>> > Let's say mochiweb accept xmpp http requests, a process per user receive
>> > a
>> > request and decide what to do with it.
>> > Each process will use the amqp erlang client to create a channel and
>> > then
>> > exchanges, queues and bindings when needed.
>> >
>> > If mochiweb handles the connections and a plugin handles the logic do I
>> > really gain anything by using rabbitmq?
>> > I have a feeling that rabbitmq is the way to go but I don't know why.
>> > What benefits do I get by using rabbitmq in this scenario?
>> >
>> > Ben
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>



From mikeb at lshift.net  Wed Feb  3 12:44:14 2010
From: mikeb at lshift.net (Michael Bridgen)
Date: Wed, 03 Feb 2010 12:44:14 +0000
Subject: [rabbitmq-discuss] RabbitHub: Binding a queue to an exchange
In-Reply-To: <4B68207A.7030506@student.ethz.ch>
References: <4B68207A.7030506@student.ethz.ch>
Message-ID: <4B696F9E.1020804@lshift.net>

> How do I bind a queue to an exchange? From the example scripts 
> provided with RabbitHub it is clear how to declare exchanges and 
> queues but not how to bind them together...

As I understand it, you subscribe the queue's endpoint facet (something 
like ../rabbithub/endpoint/q/some_queue_name) to the exchange's 
subscription facet (something like /rabbithub/subscribe/x/some_queue_name).

In other words, you POST to the latter, with hub.callback set to the 
former and hub.mode "subscribe" (and hub.topic as the binding key), as 
in 
http://pubsubhubbub.googlecode.com/svn/trunk/pubsubhubbub-core-0.2.html#anchor5

RabbitHub is smart enough to recognise that the URLs are an exchange and 
a queue that it controls, and will create a normal AMQP binding.  You 
can subscribe exchanges and queues in other combinations, but it won't 
correspond to an AMQP binding -- in these cases RabbitHub will make 
Other Arrangements.

HTH
Michael



From alexis.richardson at gmail.com  Wed Feb  3 12:50:49 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 3 Feb 2010 12:50:49 +0000
Subject: [rabbitmq-discuss] file chunking for .net client?
In-Reply-To: <0A64CDD6AB0F4621A108920E60264066@matdev40b>
References: <0A64CDD6AB0F4621A108920E60264066@matdev40b>
Message-ID: <167204d21002030450k7bc3f741uf91afa61aa6ab4eb@mail.gmail.com>

Bob,

On Tue, Feb 2, 2010 at 6:04 PM, Bob <groundduckleg at gmail.com> wrote:
> Hey guys, I heard there were file chunking clients out there to help break
> apart large messages.

As I recall someone wrote one of these for Java but - annoyingly - I
cannot find it in my link store.

However, if you can read Ruby you could look at Nanite which supports
this mode of dealing with files as chunks.

AMQP 0-8 included mention of a "stream" transfer class. However, no one
implements it, and it's gone in AMQP 0-9-1. It is the responsibility of
applications to chunk large messages if they need to.


> Does anyone know of one for .net or even what the best
> way to handle large messages is?

I do not know of one for .NET but I cannot imagine it would be that
hard to write if you take our C# client as a starting point.

Now, you may not need file chunking at all:

A single AMQP message is an atomic unit within RabbitMQ: whilst it can
be broken up into frames and interleaved with other messages on the
wire, once it's taken off the wire and exists within Rabbit, it is
atomic: in particular, we do not start routing and sending out a
message before we've finished receiving it.

As a rule of thumb, assume that the largest message that RabbitMQ can
cope with as an AMQP message is not more than 25% of your available
RAM, assuming that no other messages are consuming RAM at the same
time.  But, I would test this out.  You may find that the limit in
practice is lower than 25%.

How big are your messages?

alexis






>
> Thanks guys!
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From majek04 at gmail.com  Wed Feb  3 14:59:23 2010
From: majek04 at gmail.com (majek04)
Date: Wed, 3 Feb 2010 14:59:23 +0000
Subject: [rabbitmq-discuss] Dead but still established connections in
	RabbitMQ on EC2
In-Reply-To: <fce2e45e1002030150g6d8996d6uf70d0678e6358bbf@mail.gmail.com>
References: <fce2e45e1002030150g6d8996d6uf70d0678e6358bbf@mail.gmail.com>
Message-ID: <3bb0d9711002030659w261f0a05xc257947c95b1ecb@mail.gmail.com>

On Wed, Feb 3, 2010 at 09:50, Mathias Meyer <meyer at paperplanes.de> wrote:
> [..] Some time after the client connected its host got
> a new (elastic) IP address assigned. One of the two active connections
> from the old IP was dropped as Rabbit received an according exception
> on it, but the other wasn't, and is still established according to
> lsof -i and netstat almost 24 hours later.

Mathias,

from what you say it appears as a TCP/IP layer issue.
Please play with keepalives on AMQP or TCP/IP layer,
and tell us if that solves the problem.

Cheers,
   Marek Majkowski



From meyer at paperplanes.de  Wed Feb  3 15:12:57 2010
From: meyer at paperplanes.de (Mathias Meyer)
Date: Wed, 3 Feb 2010 16:12:57 +0100
Subject: [rabbitmq-discuss] Dead but still established connections in
	RabbitMQ on EC2
In-Reply-To: <3bb0d9711002030659w261f0a05xc257947c95b1ecb@mail.gmail.com>
References: <fce2e45e1002030150g6d8996d6uf70d0678e6358bbf@mail.gmail.com>
	<3bb0d9711002030659w261f0a05xc257947c95b1ecb@mail.gmail.com>
Message-ID: <fce2e45e1002030712m16c92e1do4b42e4bce7a78036@mail.gmail.com>

On Wed, Feb 3, 2010 at 3:59 PM, majek04 <majek04 at gmail.com> wrote:

> Mathias,
>
> from what you say it appears as a TCP/IP layer issue.
> Please play with keepalives on AMQP or TCP/IP layer,
> and tell us if that solves the problem.
>
I figured heartbeats would be the way to go in this case. Just found a
message in the archives [1] on a similar issue and a patch for
tmm1-amqp [2] to deal with that. Will give that a go, thanks!

Cheers, Mathias

[1] http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-August/004482.html
[2] http://github.com/donv/amqp/commit/eadeaee40d6db48636b71fbcb9d3706f5749a8bc
-- 
http://paperplanes.de | http://holgarific.net
http://twitter.com/roidrage



From bmurphy1976 at gmail.com  Wed Feb  3 16:52:59 2010
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 3 Feb 2010 10:52:59 -0600
Subject: [rabbitmq-discuss] file chunking for .net client?
In-Reply-To: <0A64CDD6AB0F4621A108920E60264066@matdev40b>
References: <0A64CDD6AB0F4621A108920E60264066@matdev40b>
Message-ID: <7fd310d11002030852j2d021122qcab685d61bb935c3@mail.gmail.com>

You don't necessarily have to push large messages around over the bus.  We
routinely shuffle around multi-gig files.  We sync them up to a permanent
storage service (in our case, Amazon S3) and then send small messages with
pointers to the large files.

Other options include using network shares, distributed file systems, or
pointers back to the server where the file current resides (get filex from
machiney via protocalz, usually http).

Bryan

On Tue, Feb 2, 2010 at 12:04 PM, Bob <groundduckleg at gmail.com> wrote:

>  Hey guys, I heard there were file chunking clients out there to help
> break apart large messages. Does anyone know of one for .net or even what
> the best way to handle large messages is?
>
> Thanks guys!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/a181152d/attachment.htm 

From splisson at veodia.com  Wed Feb  3 18:04:18 2010
From: splisson at veodia.com (Sebastien Plisson)
Date: Wed, 3 Feb 2010 10:04:18 -0800
Subject: [rabbitmq-discuss] EC2 clustering issue
In-Reply-To: <C78EFA08.9EA4%splisson@veodia.com>
Message-ID: <C78EFAA2.9EA9%splisson@veodia.com>

Hi,

I'm trying to setup a cluster of rabbit nodes with 2 ec2 instances:

I installed rabbitmq with apt-get.
I use the same erlang cookie on both machine,
I setup the hostname of the instances to be rabbit1 and rabbit2.
I configured the clustering through configuration file /etc/rabbitmq/rabbitmq_cluster.config on both machine containing:
[rabbit at rabbit1, rabbit at rabbit2].

The node starts fine on rabbit1 but I keep getting timeout when I try to start rabbitmqserver on rabbit2 :
Startup_log:

Starting all nodes...
Starting node rabbit at rabbit2...

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at rabbit2
app descriptor: /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : P3hRIQU6rcvxMCzOSrBi7w==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit

starting database             ...timeout
{"init terminating in do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}

What's wrong with this setup ?

Thank you

Sebastien Plisson

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/f0be0a42/attachment.htm 

From pauljones23 at gmail.com  Wed Feb  3 18:34:05 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 3 Feb 2010 18:34:05 +0000
Subject: [rabbitmq-discuss] EC2 clustering issue
In-Reply-To: <C78EFAA2.9EA9%splisson@veodia.com>
References: <C78EFA08.9EA4%splisson@veodia.com>
	<C78EFAA2.9EA9%splisson@veodia.com>
Message-ID: <29598b611002031034j77a91d4ehed0455103ce82b9f@mail.gmail.com>

Hi Sebastien,

Have you added host file entries to both machines for rabbit1 and rabbit2?
Unless you do that, I don't believe they are gong to be able to find each
other. If pinging rabbit1 from rabbit2 and vice-versa doesn't work, then the
clustering won't be able to start.

Paul.

On Wed, Feb 3, 2010 at 6:04 PM, Sebastien Plisson <splisson at veodia.com>wrote:

>  Hi,
>
> I?m trying to setup a cluster of rabbit nodes with 2 ec2 instances:
>
> I installed rabbitmq with apt-get.
> I use the same erlang cookie on both machine,
> I setup the hostname of the instances to be rabbit1 and rabbit2.
> I configured the clustering through configuration file
> /etc/rabbitmq/rabbitmq_cluster.config on both machine containing:
> [rabbit at rabbit1, rabbit at rabbit2].
>
> The node starts fine on rabbit1 but I keep getting timeout when I try to
> start rabbitmqserver on rabbit2 :
> Startup_log:
>
> Starting all nodes...
> Starting node rabbit at rabbit2...
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.1  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
> and Rabbit Technologies Ltd.
> Licensed under the MPL.  See *http://www.rabbitmq.com/
> *
> node          : rabbit at rabbit2
> app descriptor:
> /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
> home dir      : /var/lib/rabbitmq
> cookie hash   : P3hRIQU6rcvxMCzOSrBi7w==
> log           : /var/log/rabbitmq/rabbit.log
> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>
> starting database             ...timeout
> {"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
>
> What?s wrong with this setup ?
>
> Thank you
>
> Sebastien Plisson
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/508ce328/attachment.htm 

From splisson at veodia.com  Wed Feb  3 18:45:37 2010
From: splisson at veodia.com (Sebastien Plisson)
Date: Wed, 3 Feb 2010 10:45:37 -0800
Subject: [rabbitmq-discuss] EC2 clustering issue
In-Reply-To: <29598b611002031034j77a91d4ehed0455103ce82b9f@mail.gmail.com>
Message-ID: <C78F0451.9EB0%splisson@veodia.com>

Yes I added the entries in hosts file on both machine.


On 2/3/10 10:34 AM, "Paul Jones" <pauljones23 at gmail.com> wrote:

Hi Sebastien,

Have you added host file entries to both machines for rabbit1 and rabbit2? Unless you do that, I don't believe they are gong to be able to find each other. If pinging rabbit1 from rabbit2 and vice-versa doesn't work, then the clustering won't be able to start.

Paul.

On Wed, Feb 3, 2010 at 6:04 PM, Sebastien Plisson <splisson at veodia.com> wrote:
Hi,

I'm trying to setup a cluster of rabbit nodes with 2 ec2 instances:

I installed rabbitmq with apt-get.
I use the same erlang cookie on both machine,
I setup the hostname of the instances to be rabbit1 and rabbit2.
I configured the clustering through configuration file /etc/rabbitmq/rabbitmq_cluster.config on both machine containing:
[rabbit at rabbit1, rabbit at rabbit2].

The node starts fine on rabbit1 but I keep getting timeout when I try to start rabbitmqserver on rabbit2 :
Startup_log:

Starting all nodes...
Starting node rabbit at rabbit2...

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at rabbit2
app descriptor: /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : P3hRIQU6rcvxMCzOSrBi7w==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit

starting database             ...timeout
{"init terminating in do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}

What's wrong with this setup ?

Thank you

Sebastien Plisson


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/a6da8acd/attachment.htm 

From splisson at veodia.com  Wed Feb  3 19:32:57 2010
From: splisson at veodia.com (Sebastien Plisson)
Date: Wed, 3 Feb 2010 11:32:57 -0800
Subject: [rabbitmq-discuss] EC2 clustering issue
In-Reply-To: <C78F0451.9EB0%splisson@veodia.com>
Message-ID: <C78F0F69.9EB4%splisson@veodia.com>


I found out that the issue came from the fact I cloned the instance to create my second instance and that instance was containing a mnesia db for the first node rabbit1. After deleting the
Mnesia/rabbitmq folder I was able to start the node.
Though the cluster is not created despite my configuration.

I tried to create the cluster manually but it did not work even if the cluster command returned Done

Sebastien

On 2/3/10 10:45 AM, "Sebastien Plisson" <splisson at veodia.com> wrote:

Yes I added the entries in hosts file on both machine.


On 2/3/10 10:34 AM, "Paul Jones" <pauljones23 at gmail.com> wrote:

Hi Sebastien,

Have you added host file entries to both machines for rabbit1 and rabbit2? Unless you do that, I don't believe they are gong to be able to find each other. If pinging rabbit1 from rabbit2 and vice-versa doesn't work, then the clustering won't be able to start.

Paul.

On Wed, Feb 3, 2010 at 6:04 PM, Sebastien Plisson <splisson at veodia.com> wrote:
Hi,

I'm trying to setup a cluster of rabbit nodes with 2 ec2 instances:

I installed rabbitmq with apt-get.
I use the same erlang cookie on both machine,
I setup the hostname of the instances to be rabbit1 and rabbit2.
I configured the clustering through configuration file /etc/rabbitmq/rabbitmq_cluster.config on both machine containing:
[rabbit at rabbit1, rabbit at rabbit2].

The node starts fine on rabbit1 but I keep getting timeout when I try to start rabbitmqserver on rabbit2 :
Startup_log:

Starting all nodes...
Starting node rabbit at rabbit2...

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at rabbit2
app descriptor: /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : P3hRIQU6rcvxMCzOSrBi7w==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit

starting database             ...timeout
{"init terminating in do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}

What's wrong with this setup ?

Thank you

Sebastien Plisson


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/a23a7367/attachment.htm 

From bsullivan at lindenlab.com  Wed Feb  3 20:05:23 2010
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 3 Feb 2010 12:05:23 -0800
Subject: [rabbitmq-discuss] routing threads on a rabbitmq node
In-Reply-To: <4B68D8C5.3030003@lshift.net>
References: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com> 
	<20100201144215.GS11819@mrnibble.lshift.net>
	<b93cb8621002021345l59d1f1adt3cd3c3773a5545a9@mail.gmail.com> 
	<4B68D8C5.3030003@lshift.net>
Message-ID: <b93cb8621002031205o7049222l3cdc2ba0715b27c9@mail.gmail.com>

Hi Matthias,

That's good to know that those numbers look high to you.  Knowing where our
bounds are will help me readjust out configuration.

We have ~75 bindings, same as the number of queues.  We don't do many
multiple bindings per queue (if any).  This has increased faster than our
message volumes (more consuming applications to make use of the data), so I
believe this is the primary reason things are harder now than they used to
be.

Unfortunately, moving to a direct exchange is in the works but not a quick
for us at this point.

What I would like to figure out is how to reorient my cluster to make things
more stable.  Knowing that the routing time is increasing due to the number
of bindings, I am not convinced that my plan of adding a rabbitmq node to
each producer is going to make things all that much better - the routing
table will still be the same, and it will need to do that cross-routing
you're talking about avoiding.  Even when we have a single producer catching
up in our current system, the node can only route at a certain rate, and
this is definitely not CPU bound.  I am curious why Erlang cannot spend more
time in that thread, but I don't know much about it - does that seem right
to you?

I am not sure what I can do to minimize cross-routing, other than to try to
keep our producers consolidated and keep the heaviest consumers (meaning the
ones with a binding to the most active topics - remember that all queues
bind to only one topic expression) separated on their own nodes, to remove
their queue management processing on the core routing function.  Ironically,
I was originally trying to keep the heaviest consumers on the routing nodes,
to minimize forwarding of messages - but if the cost magnifies with the
number of consumer queues, then it's likely that keeping the larger fanout
(but smaller throughput) of consumers on the routing nodes might be best.

The thing that concerns me is that my scalability here seems to be limited -
the only other thing I can think of doing is increasing my number of
producers to distribute the load even further and possibly do the local node
thing - then if our routing table keeps growing, I can manage scaling at the
producer level - not efficient maybe, but at least it can grow past the
threshold I appear to be running into.

Thanks for the background.  I would love to see more documentation on how
the process model works.  Let me know if the above triggers any other
solutions.

Thanks,
Brian


On Tue, Feb 2, 2010 at 6:00 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Brian,
>
>
> Brian Sullivan wrote:
>
>> 1) How many msgs/second are being published for this issue to occur?
>>  From a single producer, about 900 messages/sec during these burst catchup
>> periods.  Normal volumes then drop down to 300-500 mps throughout the day,
>> which we can keep up with for the most part.  Note that there are 8-9 such
>> producers, distributed across 2 nodes.
>>
>
> So that's a 900Hz * 9 = 8.1kHz peak inbound rate?
>
>
>  4) How many queues do messages end up in, on average?
>> About the same number of bindings - 75.  We don't do many multiple
>> bindings per queue (if any).
>>
>
> 8.1kHz inbound with a 75x fan-out ratio would require an outbound rate of
> >600kHz, which is way more than a two-node rabbit cluster can handle. So
> some backlog will certainly build up.
>
> It will take a while for messages to make it into queues. This isn't helped
> by lack of optimisation in two areas of the server code:
>
> - topic exchanges. As you know, they are currently totally unoptimised and
> the cost of determining the queues a message should be routed to is linear
> in the total number of bindings on the exchage. How many bindings are there
> in total in your case? If you can, please use a direct exchange.
>
> - cross-node routing in a cluster. A while ago we had to remove optimised
> cross-node routing since it turned out to break certain effect visibility
> guarantees required by AMQP. As a result, routing a message to N queues
> residing on a different node will result in N network transmissions of the
> message to that node, and N copies of the message at the node. If you can,
> don't use clustering or at least avoid configurations where producers and
> consumers connect to different nodes.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100203/f425fbce/attachment.htm 

From sennol at student.ethz.ch  Wed Feb  3 21:15:31 2010
From: sennol at student.ethz.ch (Oliver Senn)
Date: Wed, 3 Feb 2010 22:15:31 +0100
Subject: [rabbitmq-discuss] RabbitHub: Binding a queue to an exchange
In-Reply-To: <4B696F9E.1020804@lshift.net>
References: <4B68207A.7030506@student.ethz.ch> <4B696F9E.1020804@lshift.net>
Message-ID: <4B69E773.5020702@student.ethz.ch>

Thanks for the hint, Michael.

The principle of subscribing a queue to an exchange makes sense in 
my opinion and so I tried it but it didn't work. The problem seems 
to be the verification ('hub.verify'):
1) if left away      -> 400 Missing required parameter
2) if set to 'sync'  -> 400 Request verification failed
3) if set to 'async' -> 202 but the binding never shows up (checked
    with 'sudo rabbitmqctl list_bindings'

I am directing the POST to
   http://localhost:8000/subscribe/x/exchange_OrderEvent_shop1
with
hub.callback equal to
   http://localhost:8000/endpoint/q/queue_ShopCheckout
and
hub.topic equal to
   shop1

Any idea what's wrong?

Oliver

Michael Bridgen wrote:
  > As I understand it, you subscribe the queue's endpoint facet 
(something
> like ../rabbithub/endpoint/q/some_queue_name) to the exchange's 
> subscription facet (something like /rabbithub/subscribe/x/some_queue_name).
> 
> In other words, you POST to the latter, with hub.callback set to the 
> former and hub.mode "subscribe" (and hub.topic as the binding key), as 
> in 
> http://pubsubhubbub.googlecode.com/svn/trunk/pubsubhubbub-core-0.2.html#anchor5
> 
> RabbitHub is smart enough to recognise that the URLs are an exchange and 
> a queue that it controls, and will create a normal AMQP binding.  You 
> can subscribe exchanges and queues in other combinations, but it won't 
> correspond to an AMQP binding -- in these cases RabbitHub will make 
> Other Arrangements.
> 
> HTH
> Michael



From techabc at gmail.com  Thu Feb  4 02:11:33 2010
From: techabc at gmail.com (techabc)
Date: Thu, 4 Feb 2010 10:11:33 +0800
Subject: [rabbitmq-discuss] Is there more infos about AMQP 1.0 and
	rabbitmq roadmap towards it?
In-Reply-To: <167204d21002030234r5c193ab1h8ca9486aea4000c8@mail.gmail.com>
References: <acc7b4fd1002022057n2a4159f6hdb3011353c8ff14b@mail.gmail.com>
	<167204d21002030234r5c193ab1h8ca9486aea4000c8@mail.gmail.com>
Message-ID: <acc7b4fd1002031811j4f426f9ej4ab38c36c231dfdd@mail.gmail.com>

thank a lot.
I have read the PMC of 03,Feb
(http://www.amqp.org/confluence/display/AMQP/PMC+Minutes+for+2010-02-03),
things just as you mentioned.
It sames that in two time points ( End of Feb and May ) progress would
be happen.

2010/2/3 Alexis Richardson <alexis.richardson at gmail.com>:
> Hi
>
> On Wed, Feb 3, 2010 at 4:57 AM, techabc <techabc at gmail.com> wrote:
>> AMQP 1.0 reached PR 2 stage, and what plans after that?
>
> The plan is to develop 1.0 to a "recommended" or "Commitee Draft"
> spec, after which full AMQP 1.0 broker implementations should be
> developed. ?When two independent, proven conformant and interoperable
> broker implementations exist, then 1.0 can be declared "final".
> Changes *may* occur between "Commitee Draft" and "final" but they
> should be *minor*.
>
> See: http://www.amqp.org/confluence/display/AMQP/AMQP1.0+SIG
>
>
>> When final release?
>
> We hope all the spec releases can be in 2010. ?Obviously "final" is
> contingent on seeing proven broker interop and conformance. ?We
> wouldn't want to rush that and mess it up. ?So that may be a practical
> factor in slowing things down. ?But, in my personal view, the major
> spec to keep an eye on is the *next* release aka "Commitee Draft".
>
>
>> According to the amqp bussiness requrement, must be 1.0 final after a
>> few implementations finished
>
> Yes. ?To be precise: "The Committee Draft will only be promoted to
> AMQP 1.0 Final once two materially independent implementations have
> been developed and demonstrated to interoperate."
>
>
>> rabbitmq ready for it?
>
> We are at least as ready as anyone else is.
>
> alexis
>
>
>
>>
>> best regards,
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From ben.browitt at gmail.com  Thu Feb  4 09:11:45 2010
From: ben.browitt at gmail.com (Ben Browitt)
Date: Thu, 4 Feb 2010 11:11:45 +0200
Subject: [rabbitmq-discuss] does native web xmpp plugin in rabbitmq
	makes sense?
In-Reply-To: <167204d21002030429p7655dfccx901b21f872af78e0@mail.gmail.com>
References: <b0200d7f1002030306g110fc309sa2a70f2d54571f60@mail.gmail.com>
	<167204d21002030343y73af5e8emaac32bf6dbd24e5b@mail.gmail.com>
	<b0200d7f1002030355g64ad9773r1129aa15c4b2d910@mail.gmail.com>
	<167204d21002030429p7655dfccx901b21f872af78e0@mail.gmail.com>
Message-ID: <b0200d7f1002040111i4fe52b2dq87e07e31f4558677@mail.gmail.com>

Thank you

On Wed, Feb 3, 2010 at 2:29 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Ben,
>
> I have taken the liberty of bcc'ing a couple of people with experience
> of both XMPP and AMQP.  They may have some better answers to your
> questions.
>
>
> On Wed, Feb 3, 2010 at 11:55 AM, Ben Browitt <ben.browitt at gmail.com>
> wrote:
> > Alexis
> >
> > Let's take Facebook chat as an example. You only have web interface with
> > xmpp or a custom protocol.
> > You have several servers that need to sync.
> > How RabbitMQ can be usefull in this scenario?
>
> I think there are several ways that RabbitMQ can be useful here.
> First of all though, please do note that 'xmpp chat' is after all
> *the* core use case for ejabberd and I would very much expect that it
> would do the best job in many of these cases.
>
> That said: RabbitMQ could be useful if you want to use a proprietary
> or 'custom' protocol, eg roll-your-own for the web interface, and a
> binary back end.  No use of XML.  And by the same token, RabbitMQ
> could be useful if you want to combine XMPP with this.
>
>
> > Do you mean that each IM
> > server will have a RabbitMQ node
> > that will send and receive sync messages from other RabbitMQ nodes on
> other
> > IM servers?
>
> Well, that is not a use case I had considered since I would imagine
> that XMPP IM servers should federate happily OOTB.
>
> I don't have much experience of the load patterns that might make a
> person favour AMQP in the way that Jack tweeted about here:
> http://tweeteorites.com/tweet/8198995879
>
> I keep a list of links here that you may find useful:
> http://delicious.com/alexisrichardson/rabbitmq+xmpp
>
> Best wishes
>
> alexis
>
>
>
>
>
>
> >
> > ben
> >
> > On Wed, Feb 3, 2010 at 1:43 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Ben
> >>
> >> Let me have a stab at this.  Others may have more useful comments.
> >>
> >> The main benefit of using RabbitMQ in these cases is twofold:
> >>
> >> 1. You want to do pubsub and/or queueing, perhaps "at scale"
> >>
> >> 2. You want to make use of a RabbitMQ client (or clients) for an
> >> 'integration scenario'.
> >>
> >> For example you may wish to combine both 1 and 2 to scale up your web
> >> or IM server by using queues to decouple user requests, from back end
> >> services that fulfil them, and then gather the results of the work on
> >> another queue before returning aggregate results to the user.
> >>
> >> Does this help?
> >>
> >> alexis
> >>
> >>
> >>
> >> On Wed, Feb 3, 2010 at 11:06 AM, Ben Browitt <ben.browitt at gmail.com>
> >> wrote:
> >> > Hi
> >> >
> >> > There is the xmpp bridge with ejabberd but I wonder if native xmpp
> bosh
> >> > support in rabbitmq makes sense.
> >> > Let's say mochiweb accept xmpp http requests, a process per user
> receive
> >> > a
> >> > request and decide what to do with it.
> >> > Each process will use the amqp erlang client to create a channel and
> >> > then
> >> > exchanges, queues and bindings when needed.
> >> >
> >> > If mochiweb handles the connections and a plugin handles the logic do
> I
> >> > really gain anything by using rabbitmq?
> >> > I have a feeling that rabbitmq is the way to go but I don't know why.
> >> > What benefits do I get by using rabbitmq in this scenario?
> >> >
> >> > Ben
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100204/9a869cf4/attachment.htm 

From alexis.richardson at gmail.com  Thu Feb  4 09:45:44 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 4 Feb 2010 09:45:44 +0000
Subject: [rabbitmq-discuss] Is there more infos about AMQP 1.0 and
	rabbitmq roadmap towards it?
In-Reply-To: <acc7b4fd1002031811j4f426f9ej4ab38c36c231dfdd@mail.gmail.com>
References: <acc7b4fd1002022057n2a4159f6hdb3011353c8ff14b@mail.gmail.com>
	<167204d21002030234r5c193ab1h8ca9486aea4000c8@mail.gmail.com>
	<acc7b4fd1002031811j4f426f9ej4ab38c36c231dfdd@mail.gmail.com>
Message-ID: <167204d21002040145q2956a99l9654bd8eb5615904@mail.gmail.com>

Hi

The PMC minutes on the amqp.org are notes of the weekly AMQP Working
Group meeting, which took place yesterday after my last email to you.
So, yes, they do indeed say that!  But, please note that these
deadlines are subject to an ongoing conversation between the AMQP
Members.  Keep an eye on the web site for further information.  Our
current hope is that we can promote the 1.0 spec draft from PR2 status
to 'recommended' quite soon, allowing time for serious implementation
work in 2010.

Cheers

alexis


On Thu, Feb 4, 2010 at 2:11 AM, techabc <techabc at gmail.com> wrote:
> thank a lot.
> I have read the PMC of 03,Feb
> (http://www.amqp.org/confluence/display/AMQP/PMC+Minutes+for+2010-02-03),
> things just as you mentioned.
> It sames that in two time points ( End of Feb and May ) progress would
> be happen.
>
> 2010/2/3 Alexis Richardson <alexis.richardson at gmail.com>:
>> Hi
>>
>> On Wed, Feb 3, 2010 at 4:57 AM, techabc <techabc at gmail.com> wrote:
>>> AMQP 1.0 reached PR 2 stage, and what plans after that?
>>
>> The plan is to develop 1.0 to a "recommended" or "Commitee Draft"
>> spec, after which full AMQP 1.0 broker implementations should be
>> developed. ?When two independent, proven conformant and interoperable
>> broker implementations exist, then 1.0 can be declared "final".
>> Changes *may* occur between "Commitee Draft" and "final" but they
>> should be *minor*.
>>
>> See: http://www.amqp.org/confluence/display/AMQP/AMQP1.0+SIG
>>
>>
>>> When final release?
>>
>> We hope all the spec releases can be in 2010. ?Obviously "final" is
>> contingent on seeing proven broker interop and conformance. ?We
>> wouldn't want to rush that and mess it up. ?So that may be a practical
>> factor in slowing things down. ?But, in my personal view, the major
>> spec to keep an eye on is the *next* release aka "Commitee Draft".
>>
>>
>>> According to the amqp bussiness requrement, must be 1.0 final after a
>>> few implementations finished
>>
>> Yes. ?To be precise: "The Committee Draft will only be promoted to
>> AMQP 1.0 Final once two materially independent implementations have
>> been developed and demonstrated to interoperate."
>>
>>
>>> rabbitmq ready for it?
>>
>> We are at least as ready as anyone else is.
>>
>> alexis
>>
>>
>>
>>>
>>> best regards,
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthew at lshift.net  Thu Feb  4 11:39:29 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 4 Feb 2010 11:39:29 +0000
Subject: [rabbitmq-discuss] routing threads on a rabbitmq node
In-Reply-To: <b93cb8621002031205o7049222l3cdc2ba0715b27c9@mail.gmail.com>
References: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com>
	<20100201144215.GS11819@mrnibble.lshift.net>
	<b93cb8621002021345l59d1f1adt3cd3c3773a5545a9@mail.gmail.com>
	<4B68D8C5.3030003@lshift.net>
	<b93cb8621002031205o7049222l3cdc2ba0715b27c9@mail.gmail.com>
Message-ID: <20100204113929.GA15932@mrnibble.lshift.net>

Hi Brian,

On Wed, Feb 03, 2010 at 12:05:23PM -0800, Brian Sullivan wrote:
> We have ~75 bindings, same as the number of queues.  We don't do many
> multiple bindings per queue (if any).  This has increased faster than our
> message volumes (more consuming applications to make use of the data), so I
> believe this is the primary reason things are harder now than they used to
> be.

If you pretty have every message going to every queue, it may be much
simpler for you to use a fanout and then drop messages at the consumer.
However, we're all in agreement that the use of topic exchanges here
isn't likely to be the problem.

> What I would like to figure out is how to reorient my cluster to make things
> more stable.  Knowing that the routing time is increasing due to the number
> of bindings, I am not convinced that my plan of adding a rabbitmq node to
> each producer is going to make things all that much better - the routing
> table will still be the same, and it will need to do that cross-routing
> you're talking about avoiding.

What I would recommend is to use the recently announced shovel. Have one
node, which the publishers send to. They send to a fanout exchange. You
then have some leaf nodes, which run the shovel. The shovel connects to
the central node, creates a queue and binds to the fanout exchange, and
republishes messages to a topic exchange on the leaf nodes.

You then split your various other queues over the exchanges on the leaf
nodes, thus dividing the outbound rate over the various leaf nodes.

The only thing that changes is that you need to somehow load balance
your consumers so that they know which leaf nodes to connect to. All the
leaf nodes would receive the same messages so there's no issue about
only being able to connect to certain nodes, but you do want to spread
the load evenly.

This would avoid using a cluster, and has the further advantage that as
your load grows, you can add further leaf nodes to share the load
seemlessly, without taking anything down.

> Even when we have a single producer catching
> up in our current system, the node can only route at a certain rate, and
> this is definitely not CPU bound.  I am curious why Erlang cannot spend more
> time in that thread, but I don't know much about it - does that seem right
> to you?

That is interesting. Did you mean "consumer" rather than "producer" at
the top there? Assuming you did, there could be a few reasons:

1. The client itself could be the bottle neck. In the absence of a QoS
setting, Rabbit will send messages to the consumer as fast as possible.
These messages arriving at the consumer obviously take up some CPU
resources to take them off the wire. Thus setting a QoS can limit the
loading on the consumer. However, setting it too low (eg 1) can mean
that the consumer is waiting for a little while after sending back an
ack before the next message arrives. Some basic tuning may be useful
here, depending on the structure of your clients (eg are they internally
multithreaded etc).

2. TCP Buffers on client and RabbitMQ. There have been a couple of threads
recently on this list about buffer sizes. You may wish to try increasing
the TCP buffers of RabbitMQ so that it can load more data into the
buffers and pass it off to the network. You might wish to measure the
amount of network throughput you're seeing.

3. If QoS is off, and a queue has grown to a good length, then it's
possible for acks to be "stalled" whilst the queue tries to push
messages as fast as possible to the consumer. A build up of acks can
hurt throughput. This has been fixed in 1.7.1. Now given that you're
saying the RabbitMQ node doesn't seem to be CPU bound here, I don't
think this is it, but I'd still suggest trying 1.7.1 when you can.

> I am not sure what I can do to minimize cross-routing, other than to try to
> keep our producers consolidated and keep the heaviest consumers (meaning the
> ones with a binding to the most active topics - remember that all queues
> bind to only one topic expression) separated on their own nodes, to remove
> their queue management processing on the core routing function.  Ironically,
> I was originally trying to keep the heaviest consumers on the routing nodes,
> to minimize forwarding of messages - but if the cost magnifies with the
> number of consumer queues, then it's likely that keeping the larger fanout
> (but smaller throughput) of consumers on the routing nodes might be best.

With the design I propose above, without the cluster, but with several
leaf nodes, I would suggest that you try to ensure the most active
queues are evenly distributed. across the array of leaf nodes.

> The thing that concerns me is that my scalability here seems to be limited -
> the only other thing I can think of doing is increasing my number of
> producers to distribute the load even further and possibly do the local node
> thing - then if our routing table keeps growing, I can manage scaling at the
> producer level - not efficient maybe, but at least it can grow past the
> threshold I appear to be running into.

Using the shovel and spreading out load to a number of leaf nodes (and
this hierarchy can be several layers deep if necessary) reduces the
amount of fanout on each node, and shares out the amount of data each
node needs to send out. This is more manual and involved, but more
efficient than a cluster.

Please let us know how you get on.

Matthew



From seemasbiradar at gmail.com  Thu Feb  4 11:40:53 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Thu, 4 Feb 2010 17:10:53 +0530
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with pluggins
	BQL and Shovel
Message-ID: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>

Hi All,

I am getting the Following error while running the Rabbitmq along with
shovel and BQL pluggin.

broker running
Erlang has closed
                 {"Kernel pid
terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
make: *** [run] Error 1
 here are the steps I followed while running Shovel and RabbitMQ BQL
pluggins.


1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
2 .cd rabbitmq-public-umbrella
3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
8. cd rabbitmq-server
9. hg up -C bug16653
10.make -j
11. mkdir -p plugins
12. cd plugins
13. ln -s ../../rabbitmq-erlang-client
14. ln -s ../../rabbitmq-shovel
15. ln -s ../../rabbitmq-bql
16. cd ../../rabbitmq-erlang-client
17. make
18. cd ../rabbitmq-shovel
19. make
18. cd ../rabbitmq-bql
19. make
20. cd ../rabbitmq-server
21. ./scripts/rabbitmq-activate-plugins
22. make cleandb run



Please let me know your suggestions.

Thanks in adavance.
Seema
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100204/e3145b85/attachment.htm 

From matthew at lshift.net  Thu Feb  4 11:48:24 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 4 Feb 2010 11:48:24 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
 pluggins BQL and Shovel
In-Reply-To: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
Message-ID: <20100204114823.GB15932@mrnibble.lshift.net>

Hi Seema,

On Thu, Feb 04, 2010 at 05:10:53PM +0530, Seema Biradar wrote:
> I am getting the Following error while running the Rabbitmq along with
> shovel and BQL pluggin.

You're missing the erlang-rfc4627 package. The Makefile in bql shows
that it depends on the erlang-rfc4627 package.

In rabbitmq-public-umbrella, just run make co. That should get you the
erlang-rfc4627 package. Annoyingly, after building in there, you'll then
need to make clean and make in the bql dir. You'll also need the extra
symlink I think.

Do let us know how you get on.

Matthew



From matthew at lshift.net  Thu Feb  4 11:49:33 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 4 Feb 2010 11:49:33 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
 pluggins BQL and Shovel
In-Reply-To: <20100204114823.GB15932@mrnibble.lshift.net>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<20100204114823.GB15932@mrnibble.lshift.net>
Message-ID: <20100204114933.GC15932@mrnibble.lshift.net>

On Thu, Feb 04, 2010 at 11:48:24AM +0000, Matthew Sackman wrote:
> You'll also need the extra symlink I think.

Actually, the erlang-rfc4627 .ez does seem to end up in the dist dir of
bql, so maybe you won't need the extra symlink. Probably won't hurt
either way ;)

Matthew



From matthew at lshift.net  Thu Feb  4 11:59:36 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 4 Feb 2010 11:59:36 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
 pluggins BQL and Shovel
In-Reply-To: <20100204114933.GC15932@mrnibble.lshift.net>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<20100204114823.GB15932@mrnibble.lshift.net>
	<20100204114933.GC15932@mrnibble.lshift.net>
Message-ID: <20100204115935.GD15932@mrnibble.lshift.net>

On Thu, Feb 04, 2010 at 11:49:33AM +0000, Matthew Sackman wrote:
> On Thu, Feb 04, 2010 at 11:48:24AM +0000, Matthew Sackman wrote:
> > You'll also need the extra symlink I think.
> 
> Actually, the erlang-rfc4627 .ez does seem to end up in the dist dir of
> bql, so maybe you won't need the extra symlink. Probably won't hurt
> either way ;)

Hmm, further testing reveals I just can't make bql work at all atm. Paul
Jones may be able to help you out with this later. Sorry.

Matthew



From mccraigmccraig.lists at googlemail.com  Thu Feb  4 12:42:13 2010
From: mccraigmccraig.lists at googlemail.com (mccraigmccraig)
Date: Thu, 04 Feb 2010 12:42:13 +0000
Subject: [rabbitmq-discuss] a reliable single consumer in rabbitmq ?
Message-ID: <4B6AC0A5.2060309@googlemail.com>

hi,

i have some messages which must be processed in order, i.e. by a single 
consumer, but i also would like the reliability that comes from having 
multiple consumers in a cluster

activemq has a feature called "exclusive consumer" whereby the broker 
delivers messages to only a single consumer of all the consumers 
subscribed to a queue, only switching consumers when the currently 
chosen one fails

http://activemq.apache.org/exclusive-consumer.html

can i achieve the same with rabbitmq/amqp ?

thanks

mccraig



From ofirr.dev at gmail.com  Thu Feb  4 13:33:01 2010
From: ofirr.dev at gmail.com (ofir r)
Date: Thu, 4 Feb 2010 15:33:01 +0200
Subject: [rabbitmq-discuss] does native web xmpp plugin in rabbitmq
	makes sense?
Message-ID: <3016be0a1002040533qc8ec21ehaa9f01886222c04c@mail.gmail.com>

Ben

As I see it, RabbitMQ is best used for routing messages with minimal or no
processing.
You might compare it to Nginx that can modify URLs and http headers but you
don't want to put your application logic there.

AMQP with RabbitMQ can provide the basic features of XMPP.
An app server or a RabbitMQ plugin is needed to handles some logic and db
integration.
Presence:
------------------
- Each user have a fanout exchange.
- Each online user has bindings to fanout exchanges of users in his roster.
- When a user changes his presence he publishes it to his exchange.
One To One:
------------------
- Each user has a queue named as his jid.
- Messages published to the direct exchange with the user jid.
- You can name the queue with unguessable string if you want them to be
private.
Muc:
-----------------
- A fanout exchange with bindings to participants queues.

If you need more advanced XEPs, using AMQP might not be a good idea.
MUC, for example, support affiliations, roles and privileges (owner,
moderator, member, guest, room history, nickname...).
The same message might be sent with a different syntax to different users
according to their privileges.
When messages need processing and complex ACL you loose the power of AMQP.

ofir
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100204/f1f23a3d/attachment.htm 

From lionel.cons at cern.ch  Thu Feb  4 13:53:58 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Thu, 4 Feb 2010 14:53:58 +0100
Subject: [rabbitmq-discuss] Shoveling & Security
Message-ID: <20100204142458.f44a.abe10f7e5afbbb3a79ce619739541149@cern.ch>

The recently announced RabbitMQ-shovel plugin
(http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-February/006113.html)
brings interesting security questions.

The current RabbitMQ security model
(http://www.rabbitmq.com/admin-guide.html#access-control) requires
the user identity to be known by the broker so that it can then
enforce ACLs.

If you shovel from Broker1 to Broker2, with messages ending up in a
resource protected by ACLs, what should Broker2 use to perform
security checks: the identity of the shovel source (i.e. Broker1) or
the identity of the real user who connected to Broker1?

It would make sense to use the identity of the real user but in this
case the shovel must be a special connection, allowing the source to
tag messages with the identity of the user who produced the messages,
i.e. JMSXUserID in the JMS world.

And it's getting worse with read access. If the source queue on
Broker1 is protected, how does Broker1 know that Broker2 will not
violate its security policy? It probably only works if all brokers
share the same security policy.

Reading the RabbitMQ-shovel documentation, it seems that the plugin
does not need to run on one end of the link. So maybe you could shovel
from Broker1 to Broker2 but run the plugin on Broker3. A kind of
man-in-the middle attack...

Cheers,
__________________________________________________________
Lionel Cons        http://cern.ch/lionel.cons
CERN               http://cern.ch



From mikeb at lshift.net  Thu Feb  4 14:04:00 2010
From: mikeb at lshift.net (Michael Bridgen)
Date: Thu, 04 Feb 2010 14:04:00 +0000
Subject: [rabbitmq-discuss] RabbitHub: Binding a queue to an exchange
In-Reply-To: <4B69E773.5020702@student.ethz.ch>
References: <4B68207A.7030506@student.ethz.ch> <4B696F9E.1020804@lshift.net>
	<4B69E773.5020702@student.ethz.ch>
Message-ID: <4B6AD3D0.2080509@lshift.net>

> The principle of subscribing a queue to an exchange makes sense in my 
> opinion and so I tried it but it didn't work. The problem seems to be 
> the verification ('hub.verify'):
> 1) if left away      -> 400 Missing required parameter
> 2) if set to 'sync'  -> 400 Request verification failed
> 3) if set to 'async' -> 202 but the binding never shows up (checked
>    with 'sudo rabbitmqctl list_bindings'

Part of the "endpoint" facet is the ability to generate tokens for this 
purpose.  This isn't part of the PubSubHubBub spec, but necessary 
because of the way RabbitHub generalises from it.

So in theory[1] you'll need something like
GET 
http://localhost:8000/endpoint/q/queue_ShopCheckout?hub.mode=generate_token&hub.intended_use=subscribe

which will respond with a token which you can then use as 
hub.verify_token when you subscribe.
(You may well have discovered this, but in general, if you browse to a 
RabbitHub URL you'll get API documentation)

[1] I just tried this myself locally, and it doesn't appear to work as 
I've described -- but I may have got quoting or something wrong, or be 
running some freaky experimental revision of rabbitmq-server, so please 
do try yourself.
Hence or otherwise I'm going to have a bit more of a look at the code.

HTH,
Michael

> I am directing the POST to
>   http://localhost:8000/subscribe/x/exchange_OrderEvent_shop1
> with
> hub.callback equal to
>   http://localhost:8000/endpoint/q/queue_ShopCheckout
> and
> hub.topic equal to
>   shop1
> 
> Any idea what's wrong?
> 
> Oliver
> 
> Michael Bridgen wrote:
>  > As I understand it, you subscribe the queue's endpoint facet (something
>> like ../rabbithub/endpoint/q/some_queue_name) to the exchange's 
>> subscription facet (something like 
>> /rabbithub/subscribe/x/some_queue_name).
>>
>> In other words, you POST to the latter, with hub.callback set to the 
>> former and hub.mode "subscribe" (and hub.topic as the binding key), as 
>> in 
>> http://pubsubhubbub.googlecode.com/svn/trunk/pubsubhubbub-core-0.2.html#anchor5 
>>
>>
>> RabbitHub is smart enough to recognise that the URLs are an exchange 
>> and a queue that it controls, and will create a normal AMQP binding.  
>> You can subscribe exchanges and queues in other combinations, but it 
>> won't correspond to an AMQP binding -- in these cases RabbitHub will 
>> make Other Arrangements.
>>
>> HTH
>> Michael



From matthew at lshift.net  Thu Feb  4 14:09:43 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 4 Feb 2010 14:09:43 +0000
Subject: [rabbitmq-discuss] Shoveling & Security
In-Reply-To: <20100204142458.f44a.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20100204142458.f44a.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <20100204140942.GA30925@mrnibble.lshift.net>

Hi Lionel,

On Thu, Feb 04, 2010 at 02:53:58PM +0100, Lionel Cons wrote:
> The recently announced RabbitMQ-shovel plugin
> (http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-February/006113.html)
> brings interesting security questions.
> 
> The current RabbitMQ security model
> (http://www.rabbitmq.com/admin-guide.html#access-control) requires
> the user identity to be known by the broker so that it can then
> enforce ACLs.
> 
> If you shovel from Broker1 to Broker2, with messages ending up in a
> resource protected by ACLs, what should Broker2 use to perform
> security checks: the identity of the shovel source (i.e. Broker1) or
> the identity of the real user who connected to Broker1?

The shovel is nothing more than a (slightly fancy) client. Thus the
shovel must authenticate to both brokers just like a normal client
would. Thus each broker is still its own administrative domain, and is
responsible for validating clients.

> It would make sense to use the identity of the real user but in this
> case the shovel must be a special connection, allowing the source to
> tag messages with the identity of the user who produced the messages,
> i.e. JMSXUserID in the JMS world.

Messages that are received by a client have no information in them by
default as to who sent them or what user credentials were used when the
publisher connected to the broker.

> Reading the RabbitMQ-shovel documentation, it seems that the plugin
> does not need to run on one end of the link. So maybe you could shovel
> from Broker1 to Broker2 but run the plugin on Broker3. A kind of
> man-in-the middle attack...

Yes, you can definitely do that. However, it's not a MitM attack on the
grounds that the shovel can't steal messages from Broker1 any more
easily than any other client can.

Matthew



From pauljones23 at gmail.com  Thu Feb  4 15:00:53 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Thu, 4 Feb 2010 15:00:53 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
Message-ID: <29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>

Hi Seema,

It turns out there were two problems in play here. Firstly, as Matthew said
in his emails, you'll also need the erlang-rfc4627 package. You'll also need
to pull in the latest change for rabbitmq-bql, since unfortunately a change
in the erlang client resulted in the plugin breaking. I've corrected this,
and after being able to reproduce the problem before, it is now working for
me.

Cheers,
Paul.

On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Hi All,
>
> I am getting the Following error while running the Rabbitmq along with
> shovel and BQL pluggin.
>
> broker running
> Erlang has closed
>                  {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
> make: *** [run] Error 1
>   here are the steps I followed while running Shovel and RabbitMQ BQL
> pluggins.
>
>
> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
> 2 .cd rabbitmq-public-umbrella
> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
> 8. cd rabbitmq-server
> 9. hg up -C bug16653
> 10.make -j
> 11. mkdir -p plugins
> 12. cd plugins
> 13. ln -s ../../rabbitmq-erlang-client
> 14. ln -s ../../rabbitmq-shovel
> 15. ln -s ../../rabbitmq-bql
> 16. cd ../../rabbitmq-erlang-client
> 17. make
> 18. cd ../rabbitmq-shovel
> 19. make
> 18. cd ../rabbitmq-bql
> 19. make
> 20. cd ../rabbitmq-server
> 21. ./scripts/rabbitmq-activate-plugins
> 22. make cleandb run
>
>
>
> Please let me know your suggestions.
>
> Thanks in adavance.
> Seema
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100204/d02d29b9/attachment.htm 

From sennol at student.ethz.ch  Thu Feb  4 15:42:03 2010
From: sennol at student.ethz.ch (Oliver Senn)
Date: Thu, 4 Feb 2010 16:42:03 +0100
Subject: [rabbitmq-discuss] RabbitHub: Binding a queue to an exchange
In-Reply-To: <4B6AD3D0.2080509@lshift.net>
References: <4B68207A.7030506@student.ethz.ch> <4B696F9E.1020804@lshift.net>
	<4B69E773.5020702@student.ethz.ch> <4B6AD3D0.2080509@lshift.net>
Message-ID: <4B6AEACB.3010601@student.ethz.ch>

Thanks Michael! It works now.

Oliver

Michael Bridgen wrote:
>> The principle of subscribing a queue to an exchange makes sense in my 
>> opinion and so I tried it but it didn't work. The problem seems to be 
>> the verification ('hub.verify'):
>> 1) if left away      -> 400 Missing required parameter
>> 2) if set to 'sync'  -> 400 Request verification failed
>> 3) if set to 'async' -> 202 but the binding never shows up (checked
>>    with 'sudo rabbitmqctl list_bindings'
> 
> Part of the "endpoint" facet is the ability to generate tokens for this 
> purpose.  This isn't part of the PubSubHubBub spec, but necessary 
> because of the way RabbitHub generalises from it.
> 
> So in theory[1] you'll need something like
> GET 
> http://localhost:8000/endpoint/q/queue_ShopCheckout?hub.mode=generate_token&hub.intended_use=subscribe
> 
> which will respond with a token which you can then use as 
> hub.verify_token when you subscribe.
> (You may well have discovered this, but in general, if you browse to a 
> RabbitHub URL you'll get API documentation)
> 
> [1] I just tried this myself locally, and it doesn't appear to work as 
> I've described -- but I may have got quoting or something wrong, or be 
> running some freaky experimental revision of rabbitmq-server, so please 
> do try yourself.
> Hence or otherwise I'm going to have a bit more of a look at the code.
> 
> HTH,
> Michael



From matthew at lshift.net  Thu Feb  4 17:36:02 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 4 Feb 2010 17:36:02 +0000
Subject: [rabbitmq-discuss] a reliable single consumer in rabbitmq ?
In-Reply-To: <4B6AC0A5.2060309@googlemail.com>
References: <4B6AC0A5.2060309@googlemail.com>
Message-ID: <20100204173602.GD30925@mrnibble.lshift.net>

On Thu, Feb 04, 2010 at 12:42:13PM +0000, mccraigmccraig wrote:
> activemq has a feature called "exclusive consumer" whereby the broker 
> delivers messages to only a single consumer of all the consumers 
> subscribed to a queue, only switching consumers when the currently 
> chosen one fails

AMQP doesn't support this use case directly. However, basic.consume does
have an exclusive flag. You can use this to ensure that no more than one
consumer successfully consumes from a queue at the same time.

The other consumers would have to poll though - maybe trying to set up
an exclusive basic.consume every 10 seconds or so; unless you have some
other way of signalling to the other consumers when the one active
consumer dies.

Matthew



From david_sansot at playstation.sony.com  Thu Feb  4 22:05:08 2010
From: david_sansot at playstation.sony.com (david_sansot at playstation.sony.com)
Date: Thu, 04 Feb 2010 14:05:08 -0800
Subject: [rabbitmq-discuss] Running RabbitMQ with Erlware
Message-ID: <4B6B4494.8040007@playstation.sony.com>

Hello,

We are in the process of updating our versions of rabbitmq and erlang.  
To get the latest erlang on our box we decided to try erlware (We're 
running CentOS 5.4 and the latest we can get through ERPL is R12B).  
Installing erl from erlware seemed to work fine (R13B03).  We installed 
rabbitmq 1.7.1 from the rpm.

When we try to start the server, we get an error that os_mon can not be 
started (yes, os_mon is installed):

    {"init terminating in
    do_boot",{{nocatch,{error,{cannot_start_application,os_mon,{not_started,sasl}}}},[{init,start_it,1},{init,start_em,1}]}}

We are able to start os_mon from the erl shell.

Has anyone already faced this (and hopefully has an easy solution)?  
Does anyone else use erlware for the erlang distribution?  I'm not that 
familiar with erlang, so I am at a bit of a loss.

Yours,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100204/01392b38/attachment.htm 

From splisson at veodia.com  Thu Feb  4 22:13:29 2010
From: splisson at veodia.com (Sebastien Plisson)
Date: Thu, 4 Feb 2010 14:13:29 -0800
Subject: [rabbitmq-discuss] Connection issue
Message-ID: <C7908689.9EE5%splisson@veodia.com>

Hello,

When my client tries to connect to rabbitmq server this one closes the connection,
The rabbit.log says:
=INFO REPORT==== 4-Feb-2010::21:53:47 ===
starting TCP connection <0.9904.0> from 174.129.177.175:46805

=ERROR REPORT==== 4-Feb-2010::21:53:57 ===
exception on TCP connection <0.9904.0> from 174.129.177.175:46805
{handshake_timeout,frame_header}

=INFO REPORT==== 4-Feb-2010::21:53:57 ===
closing TCP connection <0.9904.0> from 174.129.177.175:46805

I can't figure out what's wrong with my setup.

Help much appreciated

Sebastien
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100204/4aeec565/attachment.htm 

From bsullivan at lindenlab.com  Fri Feb  5 06:23:26 2010
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Thu, 4 Feb 2010 22:23:26 -0800
Subject: [rabbitmq-discuss] routing threads on a rabbitmq node
In-Reply-To: <20100204113929.GA15932@mrnibble.lshift.net>
References: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com>
	<20100201144215.GS11819@mrnibble.lshift.net>
	<b93cb8621002021345l59d1f1adt3cd3c3773a5545a9@mail.gmail.com>
	<4B68D8C5.3030003@lshift.net>
	<b93cb8621002031205o7049222l3cdc2ba0715b27c9@mail.gmail.com>
	<20100204113929.GA15932@mrnibble.lshift.net>
Message-ID: <b93cb8621002042223qb202095o96a06310c2afeb42@mail.gmail.com>

Hi Matthew,

so in the shovel model, what happens if one of the downstream
topic-based nodes crashes? Seems like all consumers on that node would
lose messages until we shut down the producing side, correct? The
volume is likely too high to buffer in memory even if the shovel
queues were able to survive until reconnect.

I've never used shovel before so maybe I am missing something fundamental here.

Thanks,
Brian


On Thursday, February 4, 2010, Matthew Sackman <matthew at lshift.net> wrote:
> Hi Brian,
>
> On Wed, Feb 03, 2010 at 12:05:23PM -0800, Brian Sullivan wrote:
>> We have ~75 bindings, same as the number of queues. ?We don't do many
>> multiple bindings per queue (if any). ?This has increased faster than our
>> message volumes (more consuming applications to make use of the data), so I
>> believe this is the primary reason things are harder now than they used to
>> be.
>
> If you pretty have every message going to every queue, it may be much
> simpler for you to use a fanout and then drop messages at the consumer.
> However, we're all in agreement that the use of topic exchanges here
> isn't likely to be the problem.
>
>> What I would like to figure out is how to reorient my cluster to make things
>> more stable. ?Knowing that the routing time is increasing due to the number
>> of bindings, I am not convinced that my plan of adding a rabbitmq node to
>> each producer is going to make things all that much better - the routing
>> table will still be the same, and it will need to do that cross-routing
>> you're talking about avoiding.
>
> What I would recommend is to use the recently announced shovel. Have one
> node, which the publishers send to. They send to a fanout exchange. You
> then have some leaf nodes, which run the shovel. The shovel connects to
> the central node, creates a queue and binds to the fanout exchange, and
> republishes messages to a topic exchange on the leaf nodes.
>
> You then split your various other queues over the exchanges on the leaf
> nodes, thus dividing the outbound rate over the various leaf nodes.
>
> The only thing that changes is that you need to somehow load balance
> your consumers so that they know which leaf nodes to connect to. All the
> leaf nodes would receive the same messages so there's no issue about
> only being able to connect to certain nodes, but you do want to spread
> the load evenly.
>
> This would avoid using a cluster, and has the further advantage that as
> your load grows, you can add further leaf nodes to share the load
> seemlessly, without taking anything down.
>
>> Even when we have a single producer catching
>> up in our current system, the node can only route at a certain rate, and
>> this is definitely not CPU bound. ?I am curious why Erlang cannot spend more
>> time in that thread, but I don't know much about it - does that seem right
>> to you?
>
> That is interesting. Did you mean "consumer" rather than "producer" at
> the top there? Assuming you did, there could be a few reasons:
>
> 1. The client itself could be the bottle neck. In the absence of a QoS
> setting, Rabbit will send messages to the consumer as fast as possible.
> These messages arriving at the consumer obviously take up some CPU
> resources to take them off the wire. Thus setting a QoS can limit the
> loading on the consumer. However, setting it too low (eg 1) can mean
> that the consumer is waiting for a little while after sending back an
> ack before the next message arrives. Some basic tuning may be useful
> here, depending on the structure of your clients (eg are they internally
> multithreaded etc).
>
> 2. TCP Buffers on client and RabbitMQ. There have been a couple of threads
> recently on this list about buffer sizes. You may wish to try increasing
> the TCP buffers of RabbitMQ so that it can load more data into the
> buffers and pass it off to the network. You might wish to measure the
> amount of network throughput you're seeing.
>
> 3. If QoS is off, and a queue has grown to a good length, then it's
> possible for acks to be "stalled" whilst the queue tries to push
> messages as fast as possible to the consumer. A build up of acks can
> hurt throughput. This has been fixed in 1.7.1. Now given that you're
> saying the RabbitMQ node doesn't seem to be CPU bound here, I don't
> think this is it, but I'd still suggest trying 1.7.1 when you can.
>
>> I am not sure what I can do to minimize cross-routing, other than to try to
>> keep our producers consolidated and keep the heaviest consumers (meaning the
>> ones with a binding to the most active topics - remember that all queues
>> bind to only one topic expression) separated on their own nodes, to remove
>> their queue management processing on the core routing function. ?Ironically,
>> I was originally trying to keep the heaviest consumers on the routing nodes,
>> to minimize forwarding of messages - but if the cost magnifies with the
>> number of consumer queues, then it's likely that keeping the larger fanout
>> (but smaller throughput) of consumers on the routing nodes might be best.
>
> With the design I propose above, without the cluster, but with several
> leaf nodes, I would suggest that you try to ensure the most active
> queues are evenly distributed. across the array of leaf nodes.
>
>> The thing that concerns me is that my scalability here seems to be limited -
>> the only other thing I can think of doing is increasing my number of
>> producers to distribute the load even further and possibly do the local node
>> thing - then if our routing table keeps growing, I can manage scaling at the
>> producer level - not efficient maybe, but at least it can grow past the
>> threshold I appear to be running into.
>
> Using the shovel and spreading out load to a number of leaf nodes (and
> this hierarchy can be several layers deep if necessary) reduces the
> amount of fanout on each node, and shares out the amount of data each
> node needs to send out. This is more manual and involved, but more
> efficient than a cluster.
>
> Please let us know how you get on.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From seemasbiradar at gmail.com  Fri Feb  5 07:47:11 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Fri, 5 Feb 2010 13:17:11 +0530
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
Message-ID: <558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>

Hi all,

Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am still
facing the same error.

I have downloded  erlang-rfc4627  from the site
http://hg.opensource.lshift.net/erlang-rfc4627/

rabbitmq-bql from
http://hg.rabbitmq.com/rabbitmq-bql/.

my folder structure is like

RabbitMQ server :
 /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server

Rabbitmq -BQL
/usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql

Plugin folder of rabbitmq-server contains.

lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
 rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
-rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
 rfc4627_jsonrpc.ez
-rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37              rabbitmq-bql.ez
-rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37              amqp_client.ez
lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17                 rabbitmq-bql
-> ../../rabbitmq-bql.

Please help me on this.

Thanks in advance
Seema






On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Seema,
>
> It turns out there were two problems in play here. Firstly, as Matthew said
> in his emails, you'll also need the erlang-rfc4627 package. You'll also need
> to pull in the latest change for rabbitmq-bql, since unfortunately a change
> in the erlang client resulted in the plugin breaking. I've corrected this,
> and after being able to reproduce the problem before, it is now working for
> me.
>
> Cheers,
> Paul.
>
>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>
>>   Hi All,
>>
>> I am getting the Following error while running the Rabbitmq along with
>> shovel and BQL pluggin.
>>
>> broker running
>> Erlang has closed
>>                  {"Kernel pid
>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>> make: *** [run] Error 1
>>  here are the steps I followed while running Shovel and RabbitMQ BQL
>> pluggins.
>>
>>
>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>> 2 .cd rabbitmq-public-umbrella
>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>> 8. cd rabbitmq-server
>> 9. hg up -C bug16653
>> 10.make -j
>> 11. mkdir -p plugins
>> 12. cd plugins
>> 13. ln -s ../../rabbitmq-erlang-client
>> 14. ln -s ../../rabbitmq-shovel
>> 15. ln -s ../../rabbitmq-bql
>> 16. cd ../../rabbitmq-erlang-client
>> 17. make
>> 18. cd ../rabbitmq-shovel
>> 19. make
>> 18. cd ../rabbitmq-bql
>> 19. make
>> 20. cd ../rabbitmq-server
>> 21. ./scripts/rabbitmq-activate-plugins
>> 22. make cleandb run
>>
>>
>>
>> Please let me know your suggestions.
>>
>> Thanks in adavance.
>> Seema
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/3505d824/attachment.htm 

From pauljones23 at gmail.com  Fri Feb  5 08:18:24 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 5 Feb 2010 08:18:24 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
	<558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
Message-ID: <29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>

As a starting point, you should remove the two symlinks in the directory -
with the .ez files and the symlinks, you now have the erlang client and bql
installed as plugins twice.

Once you've done this, are you seeing the exact same error message?

On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Hi all,
>
> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am still
> facing the same error.
>
> I have downloded  erlang-rfc4627  from the site
> http://hg.opensource.lshift.net/erlang-rfc4627/
>
> rabbitmq-bql from
> http://hg.rabbitmq.com/rabbitmq-bql/.
>
> my folder structure is like
>
> RabbitMQ server :
>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>
> Rabbitmq -BQL
> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>
> Plugin folder of rabbitmq-server contains.
>
> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>  rfc4627_jsonrpc.ez
> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
> rabbitmq-bql.ez
> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37              amqp_client.ez
> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
> rabbitmq-bql -> ../../rabbitmq-bql.
>
> Please help me on this.
>
> Thanks in advance
> Seema
>
>
>
>
>
>
> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>
>> Hi Seema,
>>
>> It turns out there were two problems in play here. Firstly, as Matthew
>> said in his emails, you'll also need the erlang-rfc4627 package. You'll also
>> need to pull in the latest change for rabbitmq-bql, since unfortunately a
>> change in the erlang client resulted in the plugin breaking. I've corrected
>> this, and after being able to reproduce the problem before, it is now
>> working for me.
>>
>> Cheers,
>> Paul.
>>
>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <seemasbiradar at gmail.com
>> > wrote:
>>
>>>   Hi All,
>>>
>>> I am getting the Following error while running the Rabbitmq along with
>>> shovel and BQL pluggin.
>>>
>>> broker running
>>> Erlang has closed
>>>                  {"Kernel pid
>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>> Crash dump was written to: erl_crash.dump
>>> Kernel pid terminated (application_controller)
>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>> make: *** [run] Error 1
>>>   here are the steps I followed while running Shovel and RabbitMQ BQL
>>> pluggins.
>>>
>>>
>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>> 2 .cd rabbitmq-public-umbrella
>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>> 8. cd rabbitmq-server
>>> 9. hg up -C bug16653
>>> 10.make -j
>>> 11. mkdir -p plugins
>>> 12. cd plugins
>>> 13. ln -s ../../rabbitmq-erlang-client
>>> 14. ln -s ../../rabbitmq-shovel
>>> 15. ln -s ../../rabbitmq-bql
>>> 16. cd ../../rabbitmq-erlang-client
>>> 17. make
>>> 18. cd ../rabbitmq-shovel
>>> 19. make
>>> 18. cd ../rabbitmq-bql
>>> 19. make
>>> 20. cd ../rabbitmq-server
>>> 21. ./scripts/rabbitmq-activate-plugins
>>> 22. make cleandb run
>>>
>>>
>>>
>>> Please let me know your suggestions.
>>>
>>> Thanks in adavance.
>>> Seema
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/81d597ce/attachment.htm 

From seemasbiradar at gmail.com  Fri Feb  5 08:22:17 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Fri, 5 Feb 2010 13:52:17 +0530
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
	<558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
	<29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
Message-ID: <558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>

Hi Paul,

Even after removing the symlink in the plugin folder i am getting the same
error.


node          : rabbit at linux
app descriptor:
/usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir      : /home/
cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit
starting internal event notification system
...done
starting logging server
...done
starting database
...done
-- kernel ready
starting alarm handler
...done
starting queue supervisor
...done
starting node monitor
...done
starting cluster router
...done
-- core initialized
starting empty DB check
...done
starting codec correctness check
...done
starting exchange recovery
...done
starting queue recovery
...done
starting persister
...done
starting guid generator
...done
-- message delivery logic ready
starting error log relay
...done
starting networking
...done
-- network listeners available

broker running
Erlang has closed
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})

Thanks,
seema
On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> As a starting point, you should remove the two symlinks in the directory -
> with the .ez files and the symlinks, you now have the erlang client and bql
> installed as plugins twice.
>
> Once you've done this, are you seeing the exact same error message?
>
>
> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>
>> Hi all,
>>
>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am still
>> facing the same error.
>>
>> I have downloded  erlang-rfc4627  from the site
>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>
>> rabbitmq-bql from
>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>
>> my folder structure is like
>>
>> RabbitMQ server :
>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>
>> Rabbitmq -BQL
>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>
>> Plugin folder of rabbitmq-server contains.
>>
>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>  rfc4627_jsonrpc.ez
>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>> rabbitmq-bql.ez
>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>> amqp_client.ez
>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>> rabbitmq-bql -> ../../rabbitmq-bql.
>>
>> Please help me on this.
>>
>> Thanks in advance
>> Seema
>>
>>
>>
>>
>>
>>
>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>>
>>> Hi Seema,
>>>
>>> It turns out there were two problems in play here. Firstly, as Matthew
>>> said in his emails, you'll also need the erlang-rfc4627 package. You'll also
>>> need to pull in the latest change for rabbitmq-bql, since unfortunately a
>>> change in the erlang client resulted in the plugin breaking. I've corrected
>>> this, and after being able to reproduce the problem before, it is now
>>> working for me.
>>>
>>> Cheers,
>>> Paul.
>>>
>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>> seemasbiradar at gmail.com> wrote:
>>>
>>>>   Hi All,
>>>>
>>>> I am getting the Following error while running the Rabbitmq along with
>>>> shovel and BQL pluggin.
>>>>
>>>> broker running
>>>> Erlang has closed
>>>>                  {"Kernel pid
>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>> Crash dump was written to: erl_crash.dump
>>>> Kernel pid terminated (application_controller)
>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>> make: *** [run] Error 1
>>>>  here are the steps I followed while running Shovel and RabbitMQ BQL
>>>> pluggins.
>>>>
>>>>
>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>> 2 .cd rabbitmq-public-umbrella
>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>> 8. cd rabbitmq-server
>>>> 9. hg up -C bug16653
>>>> 10.make -j
>>>> 11. mkdir -p plugins
>>>> 12. cd plugins
>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>> 14. ln -s ../../rabbitmq-shovel
>>>> 15. ln -s ../../rabbitmq-bql
>>>> 16. cd ../../rabbitmq-erlang-client
>>>> 17. make
>>>> 18. cd ../rabbitmq-shovel
>>>> 19. make
>>>> 18. cd ../rabbitmq-bql
>>>> 19. make
>>>> 20. cd ../rabbitmq-server
>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>> 22. make cleandb run
>>>>
>>>>
>>>>
>>>> Please let me know your suggestions.
>>>>
>>>> Thanks in adavance.
>>>> Seema
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/2225dbd2/attachment.htm 

From pauljones23 at gmail.com  Fri Feb  5 08:27:39 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 5 Feb 2010 08:27:39 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
	<558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
	<29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
	<558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
Message-ID: <29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>

So just to verify, you've done the following in rabbitmq-bql:
  hg pull
  hg up
  make clean
  make

and then copied the .ez files into your plugins directory?

On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Hi Paul,
>
> Even after removing the symlink in the plugin folder i am getting the same
> error.
>
>
> node          : rabbit at linux
> app descriptor:
> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
> home dir      : /home/
> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
> log           : /var/log/rabbitmq/rabbit.log
> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit
> starting internal event notification system
> ...done
> starting logging server
> ...done
> starting database
> ...done
> -- kernel ready
> starting alarm handler
> ...done
> starting queue supervisor
> ...done
> starting node monitor
> ...done
> starting cluster router
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting codec correctness check
> ...done
> starting exchange recovery
> ...done
> starting queue recovery
> ...done
> starting persister
> ...done
> starting guid generator
> ...done
> -- message delivery logic ready
> starting error log relay
> ...done
> starting networking
> ...done
> -- network listeners available
>
> broker running
> Erlang has closed
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>
> Thanks,
> seema
> On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>
>> As a starting point, you should remove the two symlinks in the directory -
>> with the .ez files and the symlinks, you now have the erlang client and bql
>> installed as plugins twice.
>>
>> Once you've done this, are you seeing the exact same error message?
>>
>>
>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>
>>> Hi all,
>>>
>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am still
>>> facing the same error.
>>>
>>> I have downloded  erlang-rfc4627  from the site
>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>
>>> rabbitmq-bql from
>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>
>>> my folder structure is like
>>>
>>> RabbitMQ server :
>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>
>>> Rabbitmq -BQL
>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>
>>> Plugin folder of rabbitmq-server contains.
>>>
>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>  rfc4627_jsonrpc.ez
>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>> rabbitmq-bql.ez
>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>> amqp_client.ez
>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>
>>> Please help me on this.
>>>
>>> Thanks in advance
>>> Seema
>>>
>>>
>>>
>>>
>>>
>>>
>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>
>>>> Hi Seema,
>>>>
>>>> It turns out there were two problems in play here. Firstly, as Matthew
>>>> said in his emails, you'll also need the erlang-rfc4627 package. You'll also
>>>> need to pull in the latest change for rabbitmq-bql, since unfortunately a
>>>> change in the erlang client resulted in the plugin breaking. I've corrected
>>>> this, and after being able to reproduce the problem before, it is now
>>>> working for me.
>>>>
>>>> Cheers,
>>>> Paul.
>>>>
>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>> seemasbiradar at gmail.com> wrote:
>>>>
>>>>>   Hi All,
>>>>>
>>>>> I am getting the Following error while running the Rabbitmq along with
>>>>> shovel and BQL pluggin.
>>>>>
>>>>> broker running
>>>>> Erlang has closed
>>>>>                  {"Kernel pid
>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>> Crash dump was written to: erl_crash.dump
>>>>> Kernel pid terminated (application_controller)
>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>> make: *** [run] Error 1
>>>>>   here are the steps I followed while running Shovel and RabbitMQ BQL
>>>>> pluggins.
>>>>>
>>>>>
>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>> 2 .cd rabbitmq-public-umbrella
>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>> 8. cd rabbitmq-server
>>>>> 9. hg up -C bug16653
>>>>> 10.make -j
>>>>> 11. mkdir -p plugins
>>>>> 12. cd plugins
>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>> 15. ln -s ../../rabbitmq-bql
>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>> 17. make
>>>>> 18. cd ../rabbitmq-shovel
>>>>> 19. make
>>>>> 18. cd ../rabbitmq-bql
>>>>> 19. make
>>>>> 20. cd ../rabbitmq-server
>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>> 22. make cleandb run
>>>>>
>>>>>
>>>>>
>>>>> Please let me know your suggestions.
>>>>>
>>>>> Thanks in adavance.
>>>>> Seema
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/2a050108/attachment.htm 

From pauljones23 at gmail.com  Fri Feb  5 08:46:12 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 5 Feb 2010 08:46:12 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
	<558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
	<29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
	<558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
	<29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
Message-ID: <29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>

Hi Seema,

I've just done a fresh checkout with the following steps:
- hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
- cd rabbitmq-public-umbrella
- make co
- make
- cd rabbitmq-bql
- make clean
- make
- mkdir ../rabbitmq-server/plugins
- cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
../rabbitmq-server/plugins
- cd ../rabbitmq-server
- make cleandb run

These steps are working for me. Can you confirm what version of Erlang you
have installed?

On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:

>
> Hi
>
> Yes , I have follwed the same steps mentioned by you......still error
> exists.
>
>
>
> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>
>> So just to verify, you've done the following in rabbitmq-bql:
>>   hg pull
>>   hg up
>>   make clean
>>   make
>>
>> and then copied the .ez files into your plugins directory?
>>
>>
>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>
>>> Hi Paul,
>>>
>>> Even after removing the symlink in the plugin folder i am getting the
>>> same error.
>>>
>>>
>>> node          : rabbit at linux
>>> app descriptor:
>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>> home dir      : /home/
>>> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
>>> log           : /var/log/rabbitmq/rabbit.log
>>> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
>>> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>>> starting internal event notification system
>>> ...done
>>> starting logging server
>>> ...done
>>> starting database
>>> ...done
>>> -- kernel ready
>>> starting alarm handler
>>> ...done
>>> starting queue supervisor
>>> ...done
>>> starting node monitor
>>> ...done
>>> starting cluster router
>>> ...done
>>> -- core initialized
>>> starting empty DB check
>>> ...done
>>> starting codec correctness check
>>> ...done
>>> starting exchange recovery
>>> ...done
>>> starting queue recovery
>>> ...done
>>> starting persister
>>> ...done
>>> starting guid generator
>>> ...done
>>> -- message delivery logic ready
>>> starting error log relay
>>> ...done
>>> starting networking
>>> ...done
>>> -- network listeners available
>>>
>>> broker running
>>> Erlang has closed
>>> {"Kernel pid
>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>> Crash dump was written to: erl_crash.dump
>>> Kernel pid terminated (application_controller)
>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>
>>> Thanks,
>>> seema
>>>   On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>
>>>> As a starting point, you should remove the two symlinks in the directory
>>>> - with the .ez files and the symlinks, you now have the erlang client and
>>>> bql installed as plugins twice.
>>>>
>>>> Once you've done this, are you seeing the exact same error message?
>>>>
>>>>
>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>>>
>>>>> Hi all,
>>>>>
>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am
>>>>> still facing the same error.
>>>>>
>>>>> I have downloded  erlang-rfc4627  from the site
>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>
>>>>> rabbitmq-bql from
>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>
>>>>> my folder structure is like
>>>>>
>>>>> RabbitMQ server :
>>>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>
>>>>> Rabbitmq -BQL
>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>
>>>>> Plugin folder of rabbitmq-server contains.
>>>>>
>>>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>>>  rfc4627_jsonrpc.ez
>>>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>>>> rabbitmq-bql.ez
>>>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>>>> amqp_client.ez
>>>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>
>>>>> Please help me on this.
>>>>>
>>>>> Thanks in advance
>>>>> Seema
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>
>>>>>> Hi Seema,
>>>>>>
>>>>>> It turns out there were two problems in play here. Firstly, as Matthew
>>>>>> said in his emails, you'll also need the erlang-rfc4627 package. You'll also
>>>>>> need to pull in the latest change for rabbitmq-bql, since unfortunately a
>>>>>> change in the erlang client resulted in the plugin breaking. I've corrected
>>>>>> this, and after being able to reproduce the problem before, it is now
>>>>>> working for me.
>>>>>>
>>>>>> Cheers,
>>>>>> Paul.
>>>>>>
>>>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>
>>>>>>>   Hi All,
>>>>>>>
>>>>>>> I am getting the Following error while running the Rabbitmq along
>>>>>>> with shovel and BQL pluggin.
>>>>>>>
>>>>>>> broker running
>>>>>>> Erlang has closed
>>>>>>>                  {"Kernel pid
>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>> Kernel pid terminated (application_controller)
>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>> make: *** [run] Error 1
>>>>>>>   here are the steps I followed while running Shovel and RabbitMQ
>>>>>>> BQL pluggins.
>>>>>>>
>>>>>>>
>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>> 8. cd rabbitmq-server
>>>>>>> 9. hg up -C bug16653
>>>>>>> 10.make -j
>>>>>>> 11. mkdir -p plugins
>>>>>>> 12. cd plugins
>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>> 17. make
>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>> 19. make
>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>> 19. make
>>>>>>> 20. cd ../rabbitmq-server
>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>> 22. make cleandb run
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Please let me know your suggestions.
>>>>>>>
>>>>>>> Thanks in adavance.
>>>>>>> Seema
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> rabbitmq-discuss mailing list
>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/eed12509/attachment.htm 

From seemasbiradar at gmail.com  Fri Feb  5 11:24:28 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Fri, 5 Feb 2010 16:54:28 +0530
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
	<558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
	<29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
	<558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
	<29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
	<29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
Message-ID: <558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>

Hi Paul,

Thanks a lot for detailed steps....now RabbitMq server is running fine , I
am not getting any error while running the server.

But when i am trying to BQL script i am getting the following error.

[Scripts]$ ./bql
{"init terminating in
do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
init terminating in do_boot ()
Regards
Seema
On Fri, Feb 5, 2010 at 2:16 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Seema,
>
> I've just done a fresh checkout with the following steps:
>
> - hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
> - cd rabbitmq-public-umbrella
> - make co
> - make
> - cd rabbitmq-bql
> - make clean
> - make
> - mkdir ../rabbitmq-server/plugins
> - cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
> ../rabbitmq-server/plugins
> - cd ../rabbitmq-server
> - make cleandb run
>
> These steps are working for me. Can you confirm what version of Erlang you
> have installed?
>
>
> On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>
>>
>> Hi
>>
>> Yes , I have follwed the same steps mentioned by you......still error
>> exists.
>>
>>
>>
>> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>>
>>> So just to verify, you've done the following in rabbitmq-bql:
>>>   hg pull
>>>   hg up
>>>   make clean
>>>   make
>>>
>>> and then copied the .ez files into your plugins directory?
>>>
>>>
>>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>>
>>>> Hi Paul,
>>>>
>>>> Even after removing the symlink in the plugin folder i am getting the
>>>> same error.
>>>>
>>>>
>>>> node          : rabbit at linux
>>>> app descriptor:
>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>>> home dir      : /home/
>>>> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
>>>> log           : /var/log/rabbitmq/rabbit.log
>>>> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
>>>> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>>>> starting internal event notification system
>>>> ...done
>>>> starting logging server
>>>> ...done
>>>> starting database
>>>> ...done
>>>> -- kernel ready
>>>> starting alarm handler
>>>> ...done
>>>> starting queue supervisor
>>>> ...done
>>>> starting node monitor
>>>> ...done
>>>> starting cluster router
>>>> ...done
>>>> -- core initialized
>>>> starting empty DB check
>>>> ...done
>>>> starting codec correctness check
>>>> ...done
>>>> starting exchange recovery
>>>> ...done
>>>> starting queue recovery
>>>> ...done
>>>> starting persister
>>>> ...done
>>>> starting guid generator
>>>> ...done
>>>> -- message delivery logic ready
>>>> starting error log relay
>>>> ...done
>>>> starting networking
>>>> ...done
>>>> -- network listeners available
>>>>
>>>> broker running
>>>> Erlang has closed
>>>> {"Kernel pid
>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>> Crash dump was written to: erl_crash.dump
>>>> Kernel pid terminated (application_controller)
>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>
>>>> Thanks,
>>>> seema
>>>>   On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>
>>>>> As a starting point, you should remove the two symlinks in the
>>>>> directory - with the .ez files and the symlinks, you now have the erlang
>>>>> client and bql installed as plugins twice.
>>>>>
>>>>> Once you've done this, are you seeing the exact same error message?
>>>>>
>>>>>
>>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <seemasbiradar at gmail.com
>>>>> > wrote:
>>>>>
>>>>>> Hi all,
>>>>>>
>>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am
>>>>>> still facing the same error.
>>>>>>
>>>>>> I have downloded  erlang-rfc4627  from the site
>>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>>
>>>>>> rabbitmq-bql from
>>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>>
>>>>>> my folder structure is like
>>>>>>
>>>>>> RabbitMQ server :
>>>>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>>
>>>>>> Rabbitmq -BQL
>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>>
>>>>>> Plugin folder of rabbitmq-server contains.
>>>>>>
>>>>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>>>>  rfc4627_jsonrpc.ez
>>>>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>>>>> rabbitmq-bql.ez
>>>>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>>>>> amqp_client.ez
>>>>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>>
>>>>>> Please help me on this.
>>>>>>
>>>>>> Thanks in advance
>>>>>> Seema
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>
>>>>>>> Hi Seema,
>>>>>>>
>>>>>>> It turns out there were two problems in play here. Firstly, as
>>>>>>> Matthew said in his emails, you'll also need the erlang-rfc4627 package.
>>>>>>> You'll also need to pull in the latest change for rabbitmq-bql, since
>>>>>>> unfortunately a change in the erlang client resulted in the plugin breaking.
>>>>>>> I've corrected this, and after being able to reproduce the problem before,
>>>>>>> it is now working for me.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Paul.
>>>>>>>
>>>>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>
>>>>>>>>   Hi All,
>>>>>>>>
>>>>>>>> I am getting the Following error while running the Rabbitmq along
>>>>>>>> with shovel and BQL pluggin.
>>>>>>>>
>>>>>>>> broker running
>>>>>>>> Erlang has closed
>>>>>>>>                  {"Kernel pid
>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>> make: *** [run] Error 1
>>>>>>>>  here are the steps I followed while running Shovel and RabbitMQ BQL
>>>>>>>> pluggins.
>>>>>>>>
>>>>>>>>
>>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>>> 8. cd rabbitmq-server
>>>>>>>> 9. hg up -C bug16653
>>>>>>>> 10.make -j
>>>>>>>> 11. mkdir -p plugins
>>>>>>>> 12. cd plugins
>>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>>> 17. make
>>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>>> 19. make
>>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>>> 19. make
>>>>>>>> 20. cd ../rabbitmq-server
>>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>>> 22. make cleandb run
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> Please let me know your suggestions.
>>>>>>>>
>>>>>>>> Thanks in adavance.
>>>>>>>> Seema
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/f5d99471/attachment.htm 

From matthew at lshift.net  Fri Feb  5 11:41:02 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 5 Feb 2010 11:41:02 +0000
Subject: [rabbitmq-discuss] routing threads on a rabbitmq node
In-Reply-To: <b93cb8621002042223qb202095o96a06310c2afeb42@mail.gmail.com>
References: <b93cb8621001312241u20a9810tf344bc547ecbd058@mail.gmail.com>
	<20100201144215.GS11819@mrnibble.lshift.net>
	<b93cb8621002021345l59d1f1adt3cd3c3773a5545a9@mail.gmail.com>
	<4B68D8C5.3030003@lshift.net>
	<b93cb8621002031205o7049222l3cdc2ba0715b27c9@mail.gmail.com>
	<20100204113929.GA15932@mrnibble.lshift.net>
	<b93cb8621002042223qb202095o96a06310c2afeb42@mail.gmail.com>
Message-ID: <20100205114102.GF30925@mrnibble.lshift.net>

On Thu, Feb 04, 2010 at 10:23:26PM -0800, Brian Sullivan wrote:
> so in the shovel model, what happens if one of the downstream
> topic-based nodes crashes? Seems like all consumers on that node would
> lose messages until we shut down the producing side, correct?

If you use named queues on the central node, there is nothing to stop
the leaf node reconnecting to it and draining it when it comes back up.
Obviously if you use anonymous queues then that gets somewhat harder.
Thus again, you'd have to manage some naming scheme yourself.

> The
> volume is likely too high to buffer in memory even if the shovel
> queues were able to survive until reconnect.

Hmm, you're very welcome to try the new persister, branch bug21673,
which will be in the next major release of RabbitMQ. The branch
certainly will be able to manage memory effectively and push messages to
disk. Unfortunately, until that branch is QA'd and is released, I'm not
sure what else to suggest.

Matthew



From pauljones23 at gmail.com  Fri Feb  5 13:03:13 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 5 Feb 2010 13:03:13 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
	<558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
	<29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
	<558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
	<29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
	<29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
	<558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>
Message-ID: <29598b611002050503g21c3f717wcf1c7b41b3fb33c5@mail.gmail.com>

Seema,

Did you unpack the client from the zip file, as per the install
instructions? The bql script cannot be invoked directly in the source tree -
it expects to have approach files put in the right places.

Paul.

On Fri, Feb 5, 2010 at 11:24 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Hi Paul,
>
> Thanks a lot for detailed steps....now RabbitMq server is running fine , I
> am not getting any error while running the server.
>
> But when i am trying to BQL script i am getting the following error.
>
> [Scripts]$ ./bql
> {"init terminating in
> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
> init terminating in do_boot ()
> Regards
> Seema
> On Fri, Feb 5, 2010 at 2:16 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>
>> Hi Seema,
>>
>> I've just done a fresh checkout with the following steps:
>>
>> - hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>> - cd rabbitmq-public-umbrella
>> - make co
>> - make
>> - cd rabbitmq-bql
>> - make clean
>> - make
>> - mkdir ../rabbitmq-server/plugins
>> - cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
>> ../rabbitmq-server/plugins
>> - cd ../rabbitmq-server
>> - make cleandb run
>>
>> These steps are working for me. Can you confirm what version of Erlang you
>> have installed?
>>
>>
>> On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>
>>>
>>> Hi
>>>
>>> Yes , I have follwed the same steps mentioned by you......still error
>>> exists.
>>>
>>>
>>>
>>> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>
>>>> So just to verify, you've done the following in rabbitmq-bql:
>>>>   hg pull
>>>>   hg up
>>>>   make clean
>>>>   make
>>>>
>>>> and then copied the .ez files into your plugins directory?
>>>>
>>>>
>>>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>>>
>>>>> Hi Paul,
>>>>>
>>>>> Even after removing the symlink in the plugin folder i am getting the
>>>>> same error.
>>>>>
>>>>>
>>>>> node          : rabbit at linux
>>>>> app descriptor:
>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>>>> home dir      : /home/
>>>>> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
>>>>> log           : /var/log/rabbitmq/rabbit.log
>>>>> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
>>>>> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>>>>> starting internal event notification system
>>>>> ...done
>>>>> starting logging server
>>>>> ...done
>>>>> starting database
>>>>> ...done
>>>>> -- kernel ready
>>>>> starting alarm handler
>>>>> ...done
>>>>> starting queue supervisor
>>>>> ...done
>>>>> starting node monitor
>>>>> ...done
>>>>> starting cluster router
>>>>> ...done
>>>>> -- core initialized
>>>>> starting empty DB check
>>>>> ...done
>>>>> starting codec correctness check
>>>>> ...done
>>>>> starting exchange recovery
>>>>> ...done
>>>>> starting queue recovery
>>>>> ...done
>>>>> starting persister
>>>>> ...done
>>>>> starting guid generator
>>>>> ...done
>>>>> -- message delivery logic ready
>>>>> starting error log relay
>>>>> ...done
>>>>> starting networking
>>>>> ...done
>>>>> -- network listeners available
>>>>>
>>>>> broker running
>>>>> Erlang has closed
>>>>> {"Kernel pid
>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>> Crash dump was written to: erl_crash.dump
>>>>> Kernel pid terminated (application_controller)
>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>
>>>>> Thanks,
>>>>> seema
>>>>>   On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>
>>>>>> As a starting point, you should remove the two symlinks in the
>>>>>> directory - with the .ez files and the symlinks, you now have the erlang
>>>>>> client and bql installed as plugins twice.
>>>>>>
>>>>>> Once you've done this, are you seeing the exact same error message?
>>>>>>
>>>>>>
>>>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <
>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>
>>>>>>> Hi all,
>>>>>>>
>>>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am
>>>>>>> still facing the same error.
>>>>>>>
>>>>>>> I have downloded  erlang-rfc4627  from the site
>>>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>>>
>>>>>>> rabbitmq-bql from
>>>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>>>
>>>>>>> my folder structure is like
>>>>>>>
>>>>>>> RabbitMQ server :
>>>>>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>>>
>>>>>>> Rabbitmq -BQL
>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>>>
>>>>>>> Plugin folder of rabbitmq-server contains.
>>>>>>>
>>>>>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>>>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>>>>>  rfc4627_jsonrpc.ez
>>>>>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>>>>>> rabbitmq-bql.ez
>>>>>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>>>>>> amqp_client.ez
>>>>>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>>>
>>>>>>> Please help me on this.
>>>>>>>
>>>>>>> Thanks in advance
>>>>>>> Seema
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>>
>>>>>>>> Hi Seema,
>>>>>>>>
>>>>>>>> It turns out there were two problems in play here. Firstly, as
>>>>>>>> Matthew said in his emails, you'll also need the erlang-rfc4627 package.
>>>>>>>> You'll also need to pull in the latest change for rabbitmq-bql, since
>>>>>>>> unfortunately a change in the erlang client resulted in the plugin breaking.
>>>>>>>> I've corrected this, and after being able to reproduce the problem before,
>>>>>>>> it is now working for me.
>>>>>>>>
>>>>>>>> Cheers,
>>>>>>>> Paul.
>>>>>>>>
>>>>>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>
>>>>>>>>>   Hi All,
>>>>>>>>>
>>>>>>>>> I am getting the Following error while running the Rabbitmq along
>>>>>>>>> with shovel and BQL pluggin.
>>>>>>>>>
>>>>>>>>> broker running
>>>>>>>>> Erlang has closed
>>>>>>>>>                  {"Kernel pid
>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>> make: *** [run] Error 1
>>>>>>>>>   here are the steps I followed while running Shovel and RabbitMQ
>>>>>>>>> BQL pluggins.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>>>> 8. cd rabbitmq-server
>>>>>>>>> 9. hg up -C bug16653
>>>>>>>>> 10.make -j
>>>>>>>>> 11. mkdir -p plugins
>>>>>>>>> 12. cd plugins
>>>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>>>> 17. make
>>>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>>>> 19. make
>>>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>>>> 19. make
>>>>>>>>> 20. cd ../rabbitmq-server
>>>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>>>> 22. make cleandb run
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Please let me know your suggestions.
>>>>>>>>>
>>>>>>>>> Thanks in adavance.
>>>>>>>>> Seema
>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/0050e77e/attachment.htm 

From seemasbiradar at gmail.com  Fri Feb  5 13:14:37 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Fri, 5 Feb 2010 18:44:37 +0530
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <29598b611002050503g21c3f717wcf1c7b41b3fb33c5@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002040700l6874b7b5wf7f3808f77c7c37f@mail.gmail.com>
	<558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
	<29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
	<558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
	<29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
	<29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
	<558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>
	<29598b611002050503g21c3f717wcf1c7b41b3fb33c5@mail.gmail.com>
Message-ID: <558967a41002050514j6634a371xd5663f1d2a8ae64d@mail.gmail.com>

I have unpack the rabbitmq-bql-client.zip and ran.

$ sh bql
{"init terminating in
do_boot",{{badmatch,{error,econnrefused}},[{amqp_connection,start_network_internal,2},{bql_client,connect,5},{bql_shell,start,0},{init,start_it,1},{init,start_em,1}]}}
Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

On Fri, Feb 5, 2010 at 6:33 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Seema,
>
> Did you unpack the client from the zip file, as per the install
> instructions? The bql script cannot be invoked directly in the source tree -
> it expects to have approach files put in the right places.
>
> Paul.
>
>
> On Fri, Feb 5, 2010 at 11:24 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>
>> Hi Paul,
>>
>> Thanks a lot for detailed steps....now RabbitMq server is running fine , I
>> am not getting any error while running the server.
>>
>> But when i am trying to BQL script i am getting the following error.
>>
>> [Scripts]$ ./bql
>> {"init terminating in
>> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>> init terminating in do_boot ()
>> Regards
>> Seema
>>   On Fri, Feb 5, 2010 at 2:16 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>
>>> Hi Seema,
>>>
>>> I've just done a fresh checkout with the following steps:
>>>
>>> - hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>> - cd rabbitmq-public-umbrella
>>> - make co
>>> - make
>>> - cd rabbitmq-bql
>>> - make clean
>>> - make
>>> - mkdir ../rabbitmq-server/plugins
>>> - cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
>>> ../rabbitmq-server/plugins
>>> - cd ../rabbitmq-server
>>> - make cleandb run
>>>
>>> These steps are working for me. Can you confirm what version of Erlang
>>> you have installed?
>>>
>>>
>>> On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>>
>>>>
>>>> Hi
>>>>
>>>> Yes , I have follwed the same steps mentioned by you......still error
>>>> exists.
>>>>
>>>>
>>>>
>>>> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>
>>>>> So just to verify, you've done the following in rabbitmq-bql:
>>>>>   hg pull
>>>>>   hg up
>>>>>   make clean
>>>>>   make
>>>>>
>>>>> and then copied the .ez files into your plugins directory?
>>>>>
>>>>>
>>>>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <seemasbiradar at gmail.com
>>>>> > wrote:
>>>>>
>>>>>> Hi Paul,
>>>>>>
>>>>>> Even after removing the symlink in the plugin folder i am getting the
>>>>>> same error.
>>>>>>
>>>>>>
>>>>>> node          : rabbit at linux
>>>>>> app descriptor:
>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>>>>> home dir      : /home/
>>>>>> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
>>>>>> log           : /var/log/rabbitmq/rabbit.log
>>>>>> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
>>>>>> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>>>>>> starting internal event notification system
>>>>>> ...done
>>>>>> starting logging server
>>>>>> ...done
>>>>>> starting database
>>>>>> ...done
>>>>>> -- kernel ready
>>>>>> starting alarm handler
>>>>>> ...done
>>>>>> starting queue supervisor
>>>>>> ...done
>>>>>> starting node monitor
>>>>>> ...done
>>>>>> starting cluster router
>>>>>> ...done
>>>>>> -- core initialized
>>>>>> starting empty DB check
>>>>>> ...done
>>>>>> starting codec correctness check
>>>>>> ...done
>>>>>> starting exchange recovery
>>>>>> ...done
>>>>>> starting queue recovery
>>>>>> ...done
>>>>>> starting persister
>>>>>> ...done
>>>>>> starting guid generator
>>>>>> ...done
>>>>>> -- message delivery logic ready
>>>>>> starting error log relay
>>>>>> ...done
>>>>>> starting networking
>>>>>> ...done
>>>>>> -- network listeners available
>>>>>>
>>>>>> broker running
>>>>>> Erlang has closed
>>>>>> {"Kernel pid
>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>> Crash dump was written to: erl_crash.dump
>>>>>> Kernel pid terminated (application_controller)
>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>
>>>>>> Thanks,
>>>>>> seema
>>>>>>   On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>
>>>>>>> As a starting point, you should remove the two symlinks in the
>>>>>>> directory - with the .ez files and the symlinks, you now have the erlang
>>>>>>> client and bql installed as plugins twice.
>>>>>>>
>>>>>>> Once you've done this, are you seeing the exact same error message?
>>>>>>>
>>>>>>>
>>>>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <
>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>
>>>>>>>> Hi all,
>>>>>>>>
>>>>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am
>>>>>>>> still facing the same error.
>>>>>>>>
>>>>>>>> I have downloded  erlang-rfc4627  from the site
>>>>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>>>>
>>>>>>>> rabbitmq-bql from
>>>>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>>>>
>>>>>>>> my folder structure is like
>>>>>>>>
>>>>>>>> RabbitMQ server :
>>>>>>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>>>>
>>>>>>>> Rabbitmq -BQL
>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>>>>
>>>>>>>> Plugin folder of rabbitmq-server contains.
>>>>>>>>
>>>>>>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>>>>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>>>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>>>>>>  rfc4627_jsonrpc.ez
>>>>>>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>>>>>>> rabbitmq-bql.ez
>>>>>>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>>>>>>> amqp_client.ez
>>>>>>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>>>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>>>>
>>>>>>>> Please help me on this.
>>>>>>>>
>>>>>>>> Thanks in advance
>>>>>>>> Seema
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>>>
>>>>>>>>> Hi Seema,
>>>>>>>>>
>>>>>>>>> It turns out there were two problems in play here. Firstly, as
>>>>>>>>> Matthew said in his emails, you'll also need the erlang-rfc4627 package.
>>>>>>>>> You'll also need to pull in the latest change for rabbitmq-bql, since
>>>>>>>>> unfortunately a change in the erlang client resulted in the plugin breaking.
>>>>>>>>> I've corrected this, and after being able to reproduce the problem before,
>>>>>>>>> it is now working for me.
>>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Paul.
>>>>>>>>>
>>>>>>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>>>   Hi All,
>>>>>>>>>>
>>>>>>>>>> I am getting the Following error while running the Rabbitmq along
>>>>>>>>>> with shovel and BQL pluggin.
>>>>>>>>>>
>>>>>>>>>> broker running
>>>>>>>>>> Erlang has closed
>>>>>>>>>>                  {"Kernel pid
>>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>> make: *** [run] Error 1
>>>>>>>>>>  here are the steps I followed while running Shovel and RabbitMQ
>>>>>>>>>> BQL pluggins.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>>>>> 8. cd rabbitmq-server
>>>>>>>>>> 9. hg up -C bug16653
>>>>>>>>>> 10.make -j
>>>>>>>>>> 11. mkdir -p plugins
>>>>>>>>>> 12. cd plugins
>>>>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>>>>> 17. make
>>>>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>>>>> 19. make
>>>>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>>>>> 19. make
>>>>>>>>>> 20. cd ../rabbitmq-server
>>>>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>>>>> 22. make cleandb run
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Please let me know your suggestions.
>>>>>>>>>>
>>>>>>>>>> Thanks in adavance.
>>>>>>>>>> Seema
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>>>
>>>>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/4da062ec/attachment.htm 

From pauljones23 at gmail.com  Fri Feb  5 13:22:25 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 5 Feb 2010 13:22:25 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <558967a41002050514j6634a371xd5663f1d2a8ae64d@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<558967a41002042347q7d5a7505pa3868165ec9417d0@mail.gmail.com>
	<29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
	<558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
	<29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
	<29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
	<558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>
	<29598b611002050503g21c3f717wcf1c7b41b3fb33c5@mail.gmail.com>
	<558967a41002050514j6634a371xd5663f1d2a8ae64d@mail.gmail.com>
Message-ID: <29598b611002050522qf35bea9kd3ad3d7b1645eaa7@mail.gmail.com>

That is indicating that you don't have Rabbit running on the same machine
using the default port. If it is on an alternate page, please refer to the
documentation on the web page for connecting to alternate machines/ports.

On Fri, Feb 5, 2010 at 1:14 PM, Seema Biradar <seemasbiradar at gmail.com>wrote:

>
> I have unpack the rabbitmq-bql-client.zip and ran.
>
> $ sh bql
> {"init terminating in
> do_boot",{{badmatch,{error,econnrefused}},[{amqp_connection,start_network_internal,2},{bql_client,connect,5},{bql_shell,start,0},{init,start_it,1},{init,start_em,1}]}}
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
>
> On Fri, Feb 5, 2010 at 6:33 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>
>> Seema,
>>
>> Did you unpack the client from the zip file, as per the install
>> instructions? The bql script cannot be invoked directly in the source tree -
>> it expects to have approach files put in the right places.
>>
>> Paul.
>>
>>
>> On Fri, Feb 5, 2010 at 11:24 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>
>>> Hi Paul,
>>>
>>> Thanks a lot for detailed steps....now RabbitMq server is running fine ,
>>> I am not getting any error while running the server.
>>>
>>> But when i am trying to BQL script i am getting the following error.
>>>
>>> [Scripts]$ ./bql
>>> {"init terminating in
>>> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>> init terminating in do_boot ()
>>> Regards
>>> Seema
>>>   On Fri, Feb 5, 2010 at 2:16 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>
>>>> Hi Seema,
>>>>
>>>> I've just done a fresh checkout with the following steps:
>>>>
>>>> - hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>> - cd rabbitmq-public-umbrella
>>>> - make co
>>>> - make
>>>> - cd rabbitmq-bql
>>>> - make clean
>>>> - make
>>>> - mkdir ../rabbitmq-server/plugins
>>>> - cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
>>>> ../rabbitmq-server/plugins
>>>> - cd ../rabbitmq-server
>>>> - make cleandb run
>>>>
>>>> These steps are working for me. Can you confirm what version of Erlang
>>>> you have installed?
>>>>
>>>>
>>>> On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>>>
>>>>>
>>>>> Hi
>>>>>
>>>>> Yes , I have follwed the same steps mentioned by you......still error
>>>>> exists.
>>>>>
>>>>>
>>>>>
>>>>> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>
>>>>>> So just to verify, you've done the following in rabbitmq-bql:
>>>>>>   hg pull
>>>>>>   hg up
>>>>>>   make clean
>>>>>>   make
>>>>>>
>>>>>> and then copied the .ez files into your plugins directory?
>>>>>>
>>>>>>
>>>>>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <
>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>
>>>>>>> Hi Paul,
>>>>>>>
>>>>>>> Even after removing the symlink in the plugin folder i am getting the
>>>>>>> same error.
>>>>>>>
>>>>>>>
>>>>>>> node          : rabbit at linux
>>>>>>> app descriptor:
>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>>>>>> home dir      : /home/
>>>>>>> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
>>>>>>> log           : /var/log/rabbitmq/rabbit.log
>>>>>>> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
>>>>>>> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>>>>>>> starting internal event notification system
>>>>>>> ...done
>>>>>>> starting logging server
>>>>>>> ...done
>>>>>>> starting database
>>>>>>> ...done
>>>>>>> -- kernel ready
>>>>>>> starting alarm handler
>>>>>>> ...done
>>>>>>> starting queue supervisor
>>>>>>> ...done
>>>>>>> starting node monitor
>>>>>>> ...done
>>>>>>> starting cluster router
>>>>>>> ...done
>>>>>>> -- core initialized
>>>>>>> starting empty DB check
>>>>>>> ...done
>>>>>>> starting codec correctness check
>>>>>>> ...done
>>>>>>> starting exchange recovery
>>>>>>> ...done
>>>>>>> starting queue recovery
>>>>>>> ...done
>>>>>>> starting persister
>>>>>>> ...done
>>>>>>> starting guid generator
>>>>>>> ...done
>>>>>>> -- message delivery logic ready
>>>>>>> starting error log relay
>>>>>>> ...done
>>>>>>> starting networking
>>>>>>> ...done
>>>>>>> -- network listeners available
>>>>>>>
>>>>>>> broker running
>>>>>>> Erlang has closed
>>>>>>> {"Kernel pid
>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>> Kernel pid terminated (application_controller)
>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>
>>>>>>> Thanks,
>>>>>>> seema
>>>>>>>   On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>>
>>>>>>>> As a starting point, you should remove the two symlinks in the
>>>>>>>> directory - with the .ez files and the symlinks, you now have the erlang
>>>>>>>> client and bql installed as plugins twice.
>>>>>>>>
>>>>>>>> Once you've done this, are you seeing the exact same error message?
>>>>>>>>
>>>>>>>>
>>>>>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <
>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>
>>>>>>>>> Hi all,
>>>>>>>>>
>>>>>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am
>>>>>>>>> still facing the same error.
>>>>>>>>>
>>>>>>>>> I have downloded  erlang-rfc4627  from the site
>>>>>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>>>>>
>>>>>>>>> rabbitmq-bql from
>>>>>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>>>>>
>>>>>>>>> my folder structure is like
>>>>>>>>>
>>>>>>>>> RabbitMQ server :
>>>>>>>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>>>>>
>>>>>>>>> Rabbitmq -BQL
>>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>>>>>
>>>>>>>>> Plugin folder of rabbitmq-server contains.
>>>>>>>>>
>>>>>>>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>>>>>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>>>>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>>>>>>>  rfc4627_jsonrpc.ez
>>>>>>>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>>>>>>>> rabbitmq-bql.ez
>>>>>>>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>>>>>>>> amqp_client.ez
>>>>>>>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>>>>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>>>>>
>>>>>>>>> Please help me on this.
>>>>>>>>>
>>>>>>>>> Thanks in advance
>>>>>>>>> Seema
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>>>>
>>>>>>>>>> Hi Seema,
>>>>>>>>>>
>>>>>>>>>> It turns out there were two problems in play here. Firstly, as
>>>>>>>>>> Matthew said in his emails, you'll also need the erlang-rfc4627 package.
>>>>>>>>>> You'll also need to pull in the latest change for rabbitmq-bql, since
>>>>>>>>>> unfortunately a change in the erlang client resulted in the plugin breaking.
>>>>>>>>>> I've corrected this, and after being able to reproduce the problem before,
>>>>>>>>>> it is now working for me.
>>>>>>>>>>
>>>>>>>>>> Cheers,
>>>>>>>>>> Paul.
>>>>>>>>>>
>>>>>>>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>>
>>>>>>>>>>>   Hi All,
>>>>>>>>>>>
>>>>>>>>>>> I am getting the Following error while running the Rabbitmq along
>>>>>>>>>>> with shovel and BQL pluggin.
>>>>>>>>>>>
>>>>>>>>>>> broker running
>>>>>>>>>>> Erlang has closed
>>>>>>>>>>>                  {"Kernel pid
>>>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>>> make: *** [run] Error 1
>>>>>>>>>>>   here are the steps I followed while running Shovel and
>>>>>>>>>>> RabbitMQ BQL pluggins.
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>>>>>> 8. cd rabbitmq-server
>>>>>>>>>>> 9. hg up -C bug16653
>>>>>>>>>>> 10.make -j
>>>>>>>>>>> 11. mkdir -p plugins
>>>>>>>>>>> 12. cd plugins
>>>>>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>>>>>> 17. make
>>>>>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>>>>>> 19. make
>>>>>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>>>>>> 19. make
>>>>>>>>>>> 20. cd ../rabbitmq-server
>>>>>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>>>>>> 22. make cleandb run
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> Please let me know your suggestions.
>>>>>>>>>>>
>>>>>>>>>>> Thanks in adavance.
>>>>>>>>>>> Seema
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>>>>
>>>>>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/ac670e28/attachment.htm 

From sigurd.hogsbro at museeka.com  Fri Feb  5 13:37:34 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Fri, 5 Feb 2010 13:37:34 +0000
Subject: [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET) writing to
	queue
In-Reply-To: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>
References: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>
Message-ID: <ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>

We have a small transcoder python app running on Windows XP (SP3)
within VirtualBox 3.1.2 (1 cpu) on Ubuntu Karmic. Python version
2.6.4. It uses amqplib v0.6.1 to speak with Rabbitmq (rabbitmq-
server_1.7.1-1_all.deb from rabbitmq debian repo).

The python app:
1. waits for WMA lossless files in messages sent on a queue, which it
saves to disk
2. runs a transcoding cmdline app to convert WMA to FLAC
3. sends back the FLAC file to the response-queue specified in the
incoming request
4. Acks the message incoming request

This worked fine on a few small test files, but when used in anger
sending the response in step #3 fails with:
[Errno 10054] An existing connection was forcibly closed by the remote
host

The AMQP server and sending app and transcoding instance within
VirtualBox runs on the same 4GB Core2Duo laptop, so there are no
obvious external network factors affecting this.

Any ideas?

Sigurd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/4ddde03e/attachment.htm 

From nico.meyer at adition.com  Fri Feb  5 14:33:00 2010
From: nico.meyer at adition.com (Nico Meyer)
Date: Fri, 05 Feb 2010 15:33:00 +0100
Subject: [rabbitmq-discuss] Monitoring Message Throughput
Message-ID: <1265380380.3017.139.camel@erdnuss1.virtualminds-office.de>

Hi,
        
are there any good solutions to monitor the message throughput of
RabbitMQ? Preferably broken down by queues. I have quickly checked the
monitoring solutions on the webpage, but none seem to have that feature.
Also there is probably not enough data exported by RabbitMQ to do this.
Or did I miss something?
       
Bye,
Nico


.



From gcorominas at dexmatech.com  Fri Feb  5 15:31:45 2010
From: gcorominas at dexmatech.com (Guillem Corominas)
Date: Fri, 5 Feb 2010 16:31:45 +0100
Subject: [rabbitmq-discuss] connecting to multiple rabbitmq servers
	(point-multipoint)
Message-ID: <6d0427481002050731u2e88d22o2963d055c290950d@mail.gmail.com>

Hi all,

I have a problem regarding the use of multiple rabbitmq servers installed in
lots of machines (one in each).
My architecture is based on diferent machines that produce data and send its
local rabbitmq server.
Then there is a master machine which connects to all the producers'
rabbitmqs using the Java client and consumes all the data, by extending the
DefaultConsumer and overriding the handleDelivery method.

My scenario with one producer and one consumer works like a charm. However
when I start consuming from a second producer,
it works well during a small period of time (about 2h) and then suddenly
stops consuming the data from the producers (stops both at the same time)
and queues start to fill.

I supose it's a problem with the connection & or channel but there is
nothing on the logs (neither in the java client nor in the rabbitmq).
If I then try to perform a basicCancel to any of my consumer instances, the
call becomes blocked and never returns a response neither an error.

I have one open connection and one open channel per producer, however I have
3 consumers that consume different kinds of message (topic dependent) that
share the Channel.
Can this be the problem? if not, anybody can tell me what considerations
(about connections, channels, consumers & co) I have to take into account
when doing this point-multipoint aproaches?

thanks a lot in advance, I'm really stuck and don't know where to head to.

guillem
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/e1821e35/attachment.htm 

From matthew at lshift.net  Fri Feb  5 16:59:50 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 5 Feb 2010 16:59:50 +0000
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
 connection on high-latency networks
In-Reply-To: <pan.2010.02.02.17.26.54.249500@googlemail.com>
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
	<20100201133316.GQ11819@mrnibble.lshift.net>
	<pan.2010.02.01.13.59.14.948750@googlemail.com>
	<20100201145037.GU11819@mrnibble.lshift.net>
	<4B681C00.10408@lshift.net>
	<pan.2010.02.02.17.26.54.249500@googlemail.com>
Message-ID: <20100205165950.GA24129@mrnibble.lshift.net>

Hi Holger,

On Tue, Feb 02, 2010 at 06:26:54PM +0100, Holger Hoffstaette wrote:
> Fair enough, but I'm not sure why the values have to be even smaller than
> e.g. Linux' vanilla defaults. Ideally - and given that Rabbit is mostly
> used on Linux/Unix - they should not be necessary at all, especially as
> they prevent any client-side settings from taking effect (I think - would
> have to check with wireshark).

I've just done some testing and found that removing our settings and
relying on the OS to set them does not, in any case I can come up with,
improve performance. I'm curious - you've said that you always set them
to 65536, and there certainly seems to be evidence that that helps over
WANs. But what about with no explicit setting of sndbuf and recbuf over
WANs. Is the performance the same as manually setting to 65536, or the
same as our explicit defaults, or something else?

Many thanks,

Matthew



From erikba at odysseus.anderson.name  Fri Feb  5 18:14:40 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Fri, 5 Feb 2010 10:14:40 -0800 (PST)
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++
	2005?
In-Reply-To: <20100129104223.GB11306@wellquite.org>
References: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com> 
	<20100129104223.GB11306@wellquite.org>
Message-ID: <d019f6ad-d4e9-48fd-815c-66fa4caf8612@k2g2000pro.googlegroups.com>

Going through the list of digests, missed this thread.  I do have a
**basic** compile of rabbitmq-c working, but I still need to do some
massive code review, I don't believe that it's doing any error
checking at all right now for instance.  Plus as I did it as part of
my job, I'm going to be a bit slow in releasing source
(unfortunately).  I can tell you the issues that I ran into however.

amqp_framing.[ch] are not included in the source and must be
generated.  This cannot be done on a Windows machine.  Find a linux
box and follow at least part of the instructions to build these files

There are a number of references to use of a block as the result of an
expression i.e. expressions of the form "myThing = ({var innerVar;
innerVar=someFunc(); func2(); innerVar });  This structure is unknown
to MS and must be removed.  I rewrote some macros including
AMQP_SIMPLE_RPC, AMQP_MULTIPLE_RESPONSE_RPC to either push casts into
the caller or into a new wrapper function)

Many of the D_ and E_ macros had similar issues and needed to be
changed to functions.

All code calls to AMQP_CHECK_RESULT that expected a response needed to
be rewritten.

There are a number of refrerences in amqp_framing to empty
structures.  These need to be modified as follows:
when declaring, the braces { } must be removed
in amqp_decode_method, any attempt to dereference an empty structure
must be replaced with "*decoded = NULL"

All the datatypes in use must be typedef'ed against the MS-specific
types.  For example, "typedef unsigned __int64 uint64_t"

All socket operations must be translated to use Winsock.  The data
type of a socket changes from "int" to "SOCKET", all references to
read(),write(), close(), and errno must be changed to send(), recv(),
closesocket(), and something I haven't looked for yet

A shortcut is used to initialize structs that is not supported by MS.
The members of a struct must be initialized explicitly.  #defines
describing common structs have been changed to "static const".

Other than some of the usual porting dust, those were the highlights.
Still wanna do it?

On Jan 29, 2:42?am, Matthew Sackman <matt... at lshift.net> wrote:
> On Fri, Jan 29, 2010 at 05:32:10PM +0800, techabc wrote:
> > Can rabbitmq-c be compiled use microsoft vc8, and how?
> > My application developed with vc++, so I want it.
>
> It's unlikely. Rabbitmq-c is in a highly experimental state and I
> believe it contains some features of C that are specific to gcc.
>
> Yesterday someone else reported on this list that they managed to get
> Rabbitmq-c to compile under Windows, but it took them two weeks of
> effort. You might like to liaise with them to share the necessary
> details.
>
> This was mentioned near the bottom ofhttp://old.nabble.com/Re:-error-message-trying-to-start-stomp-adapter...
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From erikba at odysseus.anderson.name  Fri Feb  5 18:35:26 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Fri, 5 Feb 2010 10:35:26 -0800 (PST)
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <4B6444B4.3020001@lshift.net>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>
	<20100128122215.GD4613@wellquite.org>
	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>
	<4B62BF0C.8000001@lshift.net>
	<3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>
	<4B6444B4.3020001@lshift.net>
Message-ID: <a7768fce-7fce-406a-a53e-861956e33594@b9g2000pri.googlegroups.com>

Sorry for taking so long to get back, it's been a long week...

These are the env variables I have at the top of the file (I tried to
minimize changes to the launch script this time around):

set ERLANG_HOME=C:\Program Files\erl5.7.3
set RABBITMQ_BASE=c:\tw\comet\rabbitmq-data
set RABBITMQ_NODE_IP_ADDRESS=127.0.0.1

...and this is the launch line:

"C:\Program Files\erl5.7.3\bin\erl.exe"
-noinput
-boot "C:\tw\comet\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit"
-sname rabbit
-s rabbit
+W w
+A30
-kernel inet_default_listen_options "[{nodelay, true}, {sndbuf,
16384}, {recbuf, 4096}]"
-kernel inet_default_connect_options "[{nodelay, true}]"
-rabbit tcp_listeners [{\""127.0.0.1"\","5672"}] stomp_listeners
[{\""127.0.0.1"\","61600"}]
-kernel error_logger {file,\""c:/tw/comet/rabbitmq-data/log/
rabbit.log"\"}
-sasl errlog_type error
-sasl sasl_error_logger {file,\""c:/tw/comet/rabbitmq-data/log/rabbit-
sasl.log"\"}
-os_mon start_cpu_sup true
-os_mon start_disksup false
-os_mon start_memsup false
-mnesia dir \""c:/tw/comet/rabbitmq-data/db/rabbit-mnesia"\"

The machine I am running this on has 4GB of RAM (and 4 IP addresses).
I have repeatedly wiped the c:\tw\comet\rabbitmq-data folder in an
attempt to remove any unknown/unexpected configuration files from
affecting the program.  Note that I changed the port to "61600" above,
but it's still launching on the original port, the IP address is
ignored as well.

Of course, in the end I'd like to figure out why this thing is
refusing to do a socket bind, instead reporting that the IP address is
invalid...

On Jan 30, 6:39?am, Matthias Radestock <matth... at lshift.net> wrote:
> Erik,
>
> Erik Anderson wrote:
> > ProcessExplorer trace shows no registry or file activity during the
> > "timeouts", the next action after the first one is a load of
> > stomp.beam, the action after the second is a write to the log file.
> > The only attempt to access %APPDATA% is to write a file
> > named .erlang.cookie - no other file or folder existence check is
> > made.
>
> > Modifying the stomp_listener line to change the ip address to 0.0.0.0
> > or scramble to a dummy port has no effect (is this thing hardcoded to
> > {"127.0.0.1",61613} or something?)
>
> Where are you modifying that line? In the rabbitmq.config? If so then
> from ...
>
> > log ? ? ? ? ? : c:/tw/comet/rabbitmq-data/log/rabbit.log
> > sasl log ? ? ?: c:/tw/comet/rabbitmq-data/log/rabbit-sasl.log
> > database dir ?: c:/tw/comet/rabbitmq-data/db/rabbit-mnesia
>
> ...it looks like you have changed the setting of %RABBITMQ_BASE% to
> C:\tw\comet\rabbitmq-data. In that case the rabbitmq.config file needs
> to go into that dir. If that still makes no difference, I suggest you
> add some debug output to the rabbitmq-server.bat script to display the
> value of %RABBITMQ_CONFIG_FILE% around line 120. That will tell you for
> certain where rabbit is looking for it (minus the .config extension).
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From pdezwart at rubiconproject.com  Fri Feb  5 20:04:13 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 05 Feb 2010 12:04:13 -0800
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <6d0427481002050731u2e88d22o2963d055c290950d@mail.gmail.com>
Message-ID: <C791B9BD.5B5F%pdezwart@rubiconproject.com>

Hi everyone,

We are having some issues here with PHP clients. We have the following
options:
Php-amqp (PHP module written in C)
Php-rabbit (PHP module written in C)
AMQP (Pure PHP implementation, which is a port of port)

The pure PHP implementation is working for us, but it is too slow to really
serve our purposes. As a result, we are looking at the PHP modules.
After doing some patching thanks to madcoder on Google groups, the php-amqp
library works well, but does not have consumer functionality. The php-rabbit
module is unfortunately bug ridden.

Does anyone have a working php module that contains consumer functionality?

Thanks,
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100205/8250e81d/attachment.htm 

From holger.hoffstaette at googlemail.com  Sat Feb  6 03:32:35 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Sat, 06 Feb 2010 04:32:35 +0100
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
	connection on high-latency networks
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
	<20100201133316.GQ11819@mrnibble.lshift.net>
	<pan.2010.02.01.13.59.14.948750@googlemail.com>
	<20100201145037.GU11819@mrnibble.lshift.net>
	<4B681C00.10408@lshift.net>
	<pan.2010.02.02.17.26.54.249500@googlemail.com>
	<20100205165950.GA24129@mrnibble.lshift.net>
Message-ID: <pan.2010.02.06.03.32.35.788000@googlemail.com>

On Fri, 05 Feb 2010 16:59:50 +0000, Matthew Sackman wrote:

> I've just done some testing and found that removing our settings and
> relying on the OS to set them does not, in any case I can come up with,
> improve performance. I'm curious - you've said that you always set them to
> 65536, and there certainly seems to be evidence that that helps over
> WANs.

I just tend to remove them and use the host defaults out of
habit; this gave the best results in the one case where I needed to have
an eye on production performance. That was over a year ago though.

The part that I found curious was why fixing the server values worked
for Vladimir, whereas changing the client did apparently not - even though
that's where the connection originated. This could have been caused by a
peculiar behaviour of the broker, erlang or something else. Don't know
really.

> But what about with no explicit setting of sndbuf and recbuf over WANs. Is
> the performance the same as manually setting to 65536, or the same as our
> explicit defaults, or something else?

Err..I wasn't the original poster of this thread and don't even have
Rabbit running over a WAN. I guess that's for Vladimir to answer.

FWIW the max initial window size without window scaling is 65535 (16 bit)
so anything larger may or may not work out correctly, especially through
routers or firewalls. If you really want to know what a client and server
agree on you'll need to fire up Wireshark and look at the first SYN/ACK
sequence on connection establishment. This may (hopefully will) then be
scaled up dynamically as data starts to flow.
See e.g.: http://support.novell.com/techcenter/articles/ana20021203.html
(ignore the Netware bits ;)

This rabbit hole goes deep..

Holger





From matthias at lshift.net  Sat Feb  6 17:53:32 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 17:53:32 +0000
Subject: [rabbitmq-discuss] messages get stuck when using rabbitmq on
 windows, but not on osx or ubuntu
In-Reply-To: <9dbfb671002012125s17c53922n4bda3699b92f3ce4@mail.gmail.com>
References: <9dbfb671002012125s17c53922n4bda3699b92f3ce4@mail.gmail.com>
Message-ID: <4B6DAC9C.9070709@lshift.net>

Matthew,

Matthew Scott wrote:
> I'm experiencing a problem with messages getting "stalled" when serving 
> RabbitMQ with Windows XP.
> 
> The context is a distributed job processing system, wherein some message 
> payloads can be around 250-500 kB.  The clients connecting to the broker 
> are several programs written in Python using the txAMQP library and the 
> AMQP 0-8 protocol.  (*)
> 
> We can submit one job in our system, which results in several small 
> messages, and four larger messages being routed through RabbitMQ with 
> the size ranges noted above, and this succeeds.  However, when we submit 
> an identical job, one message with a larger payload is successfully 
> routed, but the second one is not.  I can see that it successfully 
> reaches the broker but never reaches the intended destination, because I 
> get this output:
> 
> C:\rabbitmq_server-1.7.1\sbin>rabbitmqctl list_connections send_oct 
> send_pend
> Listing connections ...
> 594     0
> 1183650 0
> 236655  0
> 616     0
> 610     0
> 2492155 256809    <-- here is the stuck message
> 616     0
> 616     0
> 367     0

On the surface this does look like a client problem, namely that for
some reason the client has stopped reading data from the socket, causing
the tcp flow control to stall the connection and thus data backing up in
the server's tcp buffers.

It could also be some weird networking problem in the O/S.

I suggest sticking the AMQP tracer
(http://www.rabbitmq.com/examples.html#tracer) inbetween the broker and
the client, running it on either the client or server machine (it's
worth trying both options). That will tell you what's going on at the
AMQP protocol level. If you need help interpreting the output, feel free
to post it here.

It's possible that inserting the tracer alters the behaviour, and
"fixes" the problem. If so then a lower-level tool to capture the
network traffic, such as wireshark, is your best bet.


Regards,

Matthias.



From matthias at lshift.net  Sat Feb  6 18:42:19 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 18:42:19 +0000
Subject: [rabbitmq-discuss] Fwd: Client-connection failover workarounds
 (ruby)
In-Reply-To: <670a00381002030421w53fce458k21c1b0a5df8cb2ce@mail.gmail.com>
References: <1665d41e-b998-4d73-a17c-d8da649375b4@19g2000yql.googlegroups.com>
	<670a00381002030421w53fce458k21c1b0a5df8cb2ce@mail.gmail.com>
Message-ID: <4B6DB80B.6040908@lshift.net>

Peter,

Peter Fitzgibbons wrote:
> I'm thinking about how to handle client-connection failover.  By this
> I mean clientA has a producerP that needs to have reliable and
> tolerant connections to rabbitA and rabbitB.  This is so that if the
> connection/pid of rabbitA goes down, producerP sends it's next message
> to rabbitB with as little handling (and wall-clock time) as possible.
> [...]
> The best solution I can think of right now is to have a rabbitP on the
> same machine as producerP, which is clustered to the "real" cluster,
> so if rabbitA goes down, the built-in clustering failover will handle
> the proper interaction.  My issue with this is considering how this is
> configured and maintained when the farm of servers with producerP gets
> to be 1000+.  Even if this doesn't scale to the google-farm level,
> what about farm = 10, 30 ?

Having a local broker is indeed a common approach to get higher 
resilience, particularly since it allows producers to offload messages 
even when the connection to the main brokers is down for prolonged 
periods of time, e.g. in the event the main brokers are across a WAN and 
there is a WAN failure.

As you suspect, making all these brokers part of a cluster would indeed 
be problematic for high node counts, even more so when going across a 
WAN. Besides, RabbitMQ's clustering is really designed for scaling, not 
improved reliability.

But you do not need to cluster the brokers. Instead you could stick our 
experimental shovel (see 
http://www.lshift.net/blog/2010/02/01/rabbitmq-shovel-message-relocation-equipment) 
onto each local node and configure it to shovel messages to the main 
broker pair. The shovel has built-in re-connection and failover logic 
for that.

Of course having a local broker is no panacea for reliability, since 
that broker itself becomes a point of failure. Whether that is a problem 
depends on how high you place the reliability bar.

An alternative approachh is to make the clients themselves deal with 
re-connection and failover. Check out the experimental 
http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/ and 
http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/ libraries which 
do that for a specific type of messaging (point-to-point, though most of 
the logic should be easily ported to other types).


Regards,

Matthias



From matthias at lshift.net  Sat Feb  6 18:55:19 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 18:55:19 +0000
Subject: [rabbitmq-discuss] EC2 clustering issue
In-Reply-To: <C78F0F69.9EB4%splisson@veodia.com>
References: <C78F0F69.9EB4%splisson@veodia.com>
Message-ID: <4B6DBB17.5040503@lshift.net>

Sebastien,

Sebastien Plisson wrote:
> I found out that the issue came from the fact I cloned the instance to 
> create my second instance and that instance was containing a mnesia db 
> for the first node rabbit1.

Ah, that certainly would cause rabbit to complain.

> After deleting the Mnesia/rabbitmq folder I was able to start the node.
> Though the cluster is not created despite my configuration.

I suggest you
1) stop both rabbits
2) delete the rabbit db folder (as you did above), on *both* nodes
3) check that the cluster config file looks sane on both nodes
4) start one node, and then the other
5) use the 'rabbitmqctl status' command to check on the clustering 
status on both nodes. If that doesn't show what you expect, or one of 
the nodes failed to start, try running 'rabbitmqctl status' from one 
node against the other (using the -n option), and vice versa. If that 
fails then the diagnostics output might provide some clues as to what is 
going wrong.


Regards,

Matthias.



From matthias at lshift.net  Sat Feb  6 19:56:21 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 19:56:21 +0000
Subject: [rabbitmq-discuss] Connection issue
In-Reply-To: <C7908689.9EE5%splisson@veodia.com>
References: <C7908689.9EE5%splisson@veodia.com>
Message-ID: <4B6DC965.1040806@lshift.net>

Sebastien,

Sebastien Plisson wrote:
> When my client tries to connect to rabbitmq server this one closes the 
> connection,
> The rabbit.log says:
> =INFO REPORT==== 4-Feb-2010::21:53:47 ===
> starting TCP connection <0.9904.0> from 174.129.177.175:46805
> 
> =ERROR REPORT==== 4-Feb-2010::21:53:57 ===
> exception on TCP connection <0.9904.0> from 174.129.177.175:46805
> {handshake_timeout,frame_header}
> 
> =INFO REPORT==== 4-Feb-2010::21:53:57 ===
> closing TCP connection <0.9904.0> from 174.129.177.175:46805
> 
> I can?t figure out what?s wrong with my setup.

The most likely explanation for the above log trace is that the client 
is establishing a tcp connection to the server but is then not sending 
the required AMQP protocol header. So eventually (after 10 seconds) the 
server closes the connection.

What client are you using?

You may want to use a tool like wireshark to sniff the traffic.


Matthias.



From matthias at lshift.net  Sat Feb  6 20:11:53 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 20:11:53 +0000
Subject: [rabbitmq-discuss] Running RabbitMQ with Erlware
In-Reply-To: <4B6B4494.8040007@playstation.sony.com>
References: <4B6B4494.8040007@playstation.sony.com>
Message-ID: <4B6DCD09.5000204@lshift.net>

David,

david_sansot at playstation.sony.com wrote:
> We are in the process of updating our versions of rabbitmq and erlang.  
> To get the latest erlang on our box we decided to try erlware (We're 
> running CentOS 5.4 and the latest we can get through ERPL is R12B).  
> Installing erl from erlware seemed to work fine (R13B03).  We installed 
> rabbitmq 1.7.1 from the rpm.
> 
> When we try to start the server, we get an error that os_mon can not be 
> started (yes, os_mon is installed):
> 
>     {"init terminating in
>     do_boot",{{nocatch,{error,{cannot_start_application,os_mon,{not_started,sasl}}}},[{init,start_it,1},{init,start_em,1}]}}

os_mon depends on sasl, and the above error indicates that sasl hasn't 
been started.

All the rabbit startup scripts we ship do start sasl automatically, so 
it's strange that you see the above. What startup script are you invoking?

 > We are able to start os_mon from the erl shell.

Without starting sasl? If I try that I get the following:

$ erl
Erlang R13B03 (erts-5.7.4) [source] [smp:2:2] [rq:2] [async-threads:0] 
[hipe] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
1> application:start(os_mon).
{error,{not_started,sasl}}

which is exactly the same error as above.

By contrast, when starting erlang with sasl enabled (in the same way our 
startup scripts do) I get:

$ erl -boot start_sasl
Erlang R13B03 (erts-5.7.4) [source] [smp:2:2] [rq:2] [async-threads:0] 
[hipe] [kernel-poll:false]

[lots of PROGRESS_REPORTs ...]

1> application:start(os_mon).

[lots more PROGRESS_REPORTs ...]

ok


So I suspect there is something wrong with your startup script.


Regards,

Matthias



From matthias at lshift.net  Sat Feb  6 20:19:00 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 20:19:00 +0000
Subject: [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)
 writing to	queue
In-Reply-To: <ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>
References: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>
	<ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>
Message-ID: <4B6DCEB4.4050309@lshift.net>

Sigurd,

Sigurd H?gsbro wrote:
> when used in anger sending the response [...] fails with:
> [Errno 10054] An existing connection was forcibly closed by the remote
> host

Is there anything unusual in the server logs (rabbit.log and 
rabbit-sasl.log)?


Regards,

Matthias.



From matthias at lshift.net  Sat Feb  6 20:50:50 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 20:50:50 +0000
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <a7768fce-7fce-406a-a53e-861956e33594@b9g2000pri.googlegroups.com>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>	<20100128122215.GD4613@wellquite.org>	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>	<4B62BF0C.8000001@lshift.net>	<3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>	<4B6444B4.3020001@lshift.net>
	<a7768fce-7fce-406a-a53e-861956e33594@b9g2000pri.googlegroups.com>
Message-ID: <4B6DD62A.6080300@lshift.net>

Erik,

Erik Anderson wrote:
> this is the launch line:
> [...]
> -rabbit tcp_listeners [{\""127.0.0.1"\","5672"}] stomp_listeners
> [{\""127.0.0.1"\","61600"}]

You must prefix the stomp_listeners option with -rabbit, just like it's 
done for the tcp_listeners option.

However, that's actually the pre-plugin way of starting stomp. As noted 
in the README of the current version, installing and activating the 
plug-in is all you need to do now to get the stomp adapter wired in and 
started on rabbit startup. And if you want to tweak the listener 
settings then, as Matthew suggested, the best way to do so is by placing 
something like

[{rabbit_stomp, [{listeners, [{"127.0.0.1",6100}]}]}].

into the rabbitmq.config file (which, given your RABBITMQ_BASE setting, 
should live in c:\tw\comet\rabbitmq-data\rabbitmq.config).

Regards,

Matthias.



From matthias at lshift.net  Sat Feb  6 21:17:02 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 21:17:02 +0000
Subject: [rabbitmq-discuss] Monitoring Message Throughput
In-Reply-To: <1265380380.3017.139.camel@erdnuss1.virtualminds-office.de>
References: <1265380380.3017.139.camel@erdnuss1.virtualminds-office.de>
Message-ID: <4B6DDC4E.1050403@lshift.net>

Nico,

Nico Meyer wrote:
> are there any good solutions to monitor the message throughput of
> RabbitMQ? Preferably broken down by queues. I have quickly checked the
> monitoring solutions on the webpage, but none seem to have that feature.
> Also there is probably not enough data exported by RabbitMQ to do this.

The closest you can get at the moment is the various socket stats 
reported by 'rabbitmqctl list_connections', but that is clearly quite a 
long way from per-queue message throughput stats.

We will add more stats (and more ways of getting at them) in the future, 
so your input is appreciated in defining what exactly it is that you and 
other users are looking for. So, regarding your specific request ...

By "throughput" do you mean:
- rate at which messages are enqueued?
- rate at which messages are dequeued?

If it's "messages enqueued", what happens to messages that are part of a 
transaction? Are they included in the figure immediately or only when 
the tx has committed?

If it's "messages dequeued", what happens to message redeliveries (e.g. 
when a message has been delivered but then the client disconnected w/o 
acking them and the message is subsequently redelivered to another 
client)? Are they included in the figure?

Also,
- are you interested in message counts, i.e. messages per second, or 
data volumes, i.e. octets per second?
- over what period of time should the figures be averaged?
- do the stats of a durable queue need to survive a broker restart?
- do the stats still need to be accessible after a queue has been deleted?
- what stats other than per-queue throughputs would you like to see?

I realise these are a lot of questions. But answering them will help us 
shape our future stats architecture.


Regards,

Matthias.



From matthias at lshift.net  Sat Feb  6 21:38:24 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Feb 2010 21:38:24 +0000
Subject: [rabbitmq-discuss] connecting to multiple rabbitmq
	servers	(point-multipoint)
In-Reply-To: <6d0427481002050731u2e88d22o2963d055c290950d@mail.gmail.com>
References: <6d0427481002050731u2e88d22o2963d055c290950d@mail.gmail.com>
Message-ID: <4B6DE150.3060201@lshift.net>

Guillem,

Guillem Corominas wrote:
> when I start consuming from a second producer, it works well during a
> small period of time (about 2h) and then suddenly stops consuming the
> data from the producers (stops both at the same time) and queues
> start to fill.
> 
> I supose it's a problem with the connection & or channel but there is
>  nothing on the logs (neither in the java client nor in the
> rabbitmq).

I suggest you do a 'rabbitmqctl list_connections peer_address peer_port
state channels send_pend' on all the brokers to check that you have the
connections and number of channels you expect to see and that there
is no send backlog (that's what the send_pend count
shows).

> If I then try to perform a basicCancel to any of my consumer
> instances, the call becomes blocked and never returns a response
> neither an error.

Getting a stack trace of all the Java threads at that point might
provide some clues as to why things are stuck.

> I have one open connection and one open channel per producer, however
> I have 3 consumers that consume different kinds of message (topic 
> dependent) that share the Channel. Can this be the problem?

That's perfectly ok.


Regards,

Matthias.



From gmr at myyearbook.com  Sat Feb  6 21:40:02 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 6 Feb 2010 16:40:02 -0500
Subject: [rabbitmq-discuss] Monitoring Message Throughput
In-Reply-To: <4B6DDC4E.1050403@lshift.net>
References: <1265380380.3017.139.camel@erdnuss1.virtualminds-office.de> 
	<4B6DDC4E.1050403@lshift.net>
Message-ID: <af1bce591002061340u1c84f840i300464eb647ffcf3@mail.gmail.com>

Hey Matthias,

On Sat, Feb 6, 2010 at 4:17 PM, Matthias Radestock <matthias at lshift.net>wrote:

> By "throughput" do you mean:
> - rate at which messages are enqueued?
>

For me, yes


> - rate at which messages are dequeued?
>

For me, yes

If it's "messages enqueued", what happens to messages that are part of a
> transaction? Are they included in the figure immediately or only when
> the tx has committed?
>

tx committed


>
> If it's "messages dequeued", what happens to message redeliveries (e.g.
> when a message has been delivered but then the client disconnected w/o
> acking them and the message is subsequently redelivered to another
> client)? Are they included in the figure?
>

Only acked messages, though redeliveries would be a good counter to keep as
well.

>
> Also,
> - are you interested in message counts, i.e. messages per second, or
> data volumes, i.e. octets per second?
>

messages per second, though I could see benefit in data volume as well.


> - over what period of time should the figures be averaged?
>

I'd not have Rabbit provide the averaging and aggregation, just straight out
counters.

- do the stats of a durable queue need to survive a broker restart?
>

Yes


> - do the stats still need to be accessible after a queue has been deleted?
>

No


> - what stats other than per-queue throughputs would you like to see?
>

Perhaps per exchange?

Thanks,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100206/5f651873/attachment.htm 

From g at rre.tt  Sat Feb  6 22:54:37 2010
From: g at rre.tt (Garrett Smith)
Date: Sat, 6 Feb 2010 16:54:37 -0600
Subject: [rabbitmq-discuss] Monitoring Message Throughput
In-Reply-To: <4B6DDC4E.1050403@lshift.net>
References: <1265380380.3017.139.camel@erdnuss1.virtualminds-office.de>
	<4B6DDC4E.1050403@lshift.net>
Message-ID: <ce2570e21002061454j732f8e3ct810097129353d249@mail.gmail.com>

On Sat, Feb 6, 2010 at 3:17 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Nico,
>
> Nico Meyer wrote:
>> are there any good solutions to monitor the message throughput of
>> RabbitMQ? Preferably broken down by queues. I have quickly checked the
>> monitoring solutions on the webpage, but none seem to have that feature.
>> Also there is probably not enough data exported by RabbitMQ to do this.

-snip-

> - are you interested in message counts, i.e. messages per second, or
> data volumes, i.e. octets per second?
> - over what period of time should the figures be averaged?
> - do the stats of a durable queue need to survive a broker restart?
> - do the stats still need to be accessible after a queue has been deleted?
> - what stats other than per-queue throughputs would you like to see?

I don't have an immediate need for "throughput" stats, but I wanted to
relay my experience in monitoring MySQL, which relies almost
exclusively on counters to provide performance metrics.

IMO, this is a good approach as it's generally cheap to implement and
provides a lot of flexibility.

A single dets or Mnesia table could be used to store counter, which
you'd typically want to survive a restart.

Monitor tools like rrdtool can typically generate rate stats using
counters and can compensate for counter reset.

I personally would rather rabbitmq keep things as simple as possible
internally and defer the cost of aggregation, summary, etc. to
external tools.

Garrett



From aquino.gustavo at gmail.com  Sat Feb  6 23:15:59 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sat, 6 Feb 2010 21:15:59 -0200
Subject: [rabbitmq-discuss] Anybody are using or know about RabbitMQ with
	Perl ?
Message-ID: <5ef296b31002061515w5a54b75ek4152f25c014c2622@mail.gmail.com>

Hi,

Anybody here are using or know library Net::RabbitMQ to Perl ?

Well for me it doesn't work fine, I don't know why but It's work just for
send a simple message but if I use the same code but put a simple loop
(foreach) it stop to work.

Regards.

Gustavo Aquino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100206/0bdad4cd/attachment.htm 

From norbu09 at googlemail.com  Sun Feb  7 01:48:29 2010
From: norbu09 at googlemail.com (lenz)
Date: Sun, 7 Feb 2010 14:48:29 +1300
Subject: [rabbitmq-discuss] Anybody are using or know about RabbitMQ
	with Perl ?
In-Reply-To: <5ef296b31002061515w5a54b75ek4152f25c014c2622@mail.gmail.com>
References: <5ef296b31002061515w5a54b75ek4152f25c014c2622@mail.gmail.com>
Message-ID: <e25246b61002061748o7bff475ckc4eb0a0192e69c68@mail.gmail.com>

hi, use Net::AMQP::Simple which is only in my github repository in the
moment and a wrapper arount Net::AMQP which by the time could be on
CPAN. i run my own package builds for our environment and have never
pushed my packages to CPAN therefor.

have a look at http://github.com/norbu09 for some related
repositories, play with that and drop me a line if you need help. i
use RabbitMQ quite a bit from perl and it works quite nicely for me.
in case you want to use it from catalyst i can probably push my
rabbitmq catayst controller somewhere.

cheers
lenz

On Sun, Feb 7, 2010 at 12:15 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Hi,
> Anybody here are using or know library Net::RabbitMQ to Perl ?
> Well for me it doesn't work fine, I don't know why but It's work just for
> send a simple message but if I use the same code but put a simple loop
> (foreach) it stop to work.
> Regards.
> Gustavo Aquino
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
iWantMyName.com
painless domain registration (finally)



From sigurd.hogsbro at museeka.com  Sun Feb  7 11:33:29 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Sun, 7 Feb 2010 11:33:29 +0000
Subject: [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)
	writing to queue
In-Reply-To: <4B6DCEB4.4050309@lshift.net>
References: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>
	<ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>
	<4B6DCEB4.4050309@lshift.net>
Message-ID: <ebcef6281002070333x11c756bfq3d033093ce522fef@mail.gmail.com>

Hello Matthias,

The below extract from rabbit.log is from a problematic run. It appears the
python instance running with Windows XP within VirtualBox aborts the
connection.

The message bodies being sent are 6-25Mb each, which isn't immaterial but
AFAICT should work.

I used to have immediate and mandatory flags set but I've removed these to
make the connection as plain vanilla as possible.

Regards,

Sigurd

=INFO REPORT==== 7-Feb-2010::09:55:33 ===
accepted TCP connection on 0.0.0.0:5672 from 192.168.66.61:54000

=INFO REPORT==== 7-Feb-2010::09:55:33 ===
starting TCP connection <0.809.5> from 192.168.66.61:54000

=INFO REPORT==== 7-Feb-2010::09:55:51 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:47539

=INFO REPORT==== 7-Feb-2010::09:55:51 ===
starting TCP connection <0.835.5> from 127.0.0.1:47539

=INFO REPORT==== 7-Feb-2010::09:55:51 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:47540

=INFO REPORT==== 7-Feb-2010::09:55:51 ===
starting TCP connection <0.841.5> from 127.0.0.1:47540

=WARNING REPORT==== 7-Feb-2010::09:56:35 ===
exception on TCP connection <0.835.5> from 127.0.0.1:47539
connection_closed_abruptly

=INFO REPORT==== 7-Feb-2010::09:56:35 ===
closing TCP connection <0.835.5> from 127.0.0.1:47539

=WARNING REPORT==== 7-Feb-2010::09:56:35 ===
exception on TCP connection <0.841.5> from 127.0.0.1:47540
connection_closed_abruptly

=INFO REPORT==== 7-Feb-2010::09:56:35 ===
closing TCP connection <0.841.5> from 127.0.0.1:47540

2010/2/6 Matthias Radestock <matthias at lshift.net>

> Sigurd,
>
> Sigurd H?gsbro wrote:
>
>> when used in anger sending the response [...] fails with:
>>
>> [Errno 10054] An existing connection was forcibly closed by the remote
>> host
>>
>
> Is there anything unusual in the server logs (rabbit.log and
> rabbit-sasl.log)?
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100207/f4a3830e/attachment.htm 

From aquino.gustavo at gmail.com  Sun Feb  7 13:34:02 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 7 Feb 2010 11:34:02 -0200
Subject: [rabbitmq-discuss] Anybody are using or know about RabbitMQ
	with Perl ?
In-Reply-To: <e25246b61002061748o7bff475ckc4eb0a0192e69c68@mail.gmail.com>
References: <5ef296b31002061515w5a54b75ek4152f25c014c2622@mail.gmail.com>
	<e25246b61002061748o7bff475ckc4eb0a0192e69c68@mail.gmail.com>
Message-ID: <5ef296b31002070534g457e9117k9e649ad90bbd28b7@mail.gmail.com>

Hi Lenz,

Can you send me the docs of module or how to use it ? I've tried find it in
cpan, git, perldoc and etc but no have success.

Best Regards.

Gustavo

On Sat, Feb 6, 2010 at 11:48 PM, lenz <norbu09 at googlemail.com> wrote:

> hi, use Net::AMQP::Simple which is only in my github repository in the
> moment and a wrapper arount Net::AMQP which by the time could be on
> CPAN. i run my own package builds for our environment and have never
> pushed my packages to CPAN therefor.
>
> have a look at http://github.com/norbu09 for some related
> repositories, play with that and drop me a line if you need help. i
> use RabbitMQ quite a bit from perl and it works quite nicely for me.
> in case you want to use it from catalyst i can probably push my
> rabbitmq catayst controller somewhere.
>
> cheers
> lenz
>
> On Sun, Feb 7, 2010 at 12:15 PM, Gustavo Aquino
> <aquino.gustavo at gmail.com> wrote:
> > Hi,
> > Anybody here are using or know library Net::RabbitMQ to Perl ?
> > Well for me it doesn't work fine, I don't know why but It's work just for
> > send a simple message but if I use the same code but put a simple loop
> > (foreach) it stop to work.
> > Regards.
> > Gustavo Aquino
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
>
>
> --
> iWantMyName.com
> painless domain registration (finally)
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100207/d0f91e0a/attachment.htm 

From glenn.ergeerts at artesis.be  Sun Feb  7 14:04:07 2010
From: glenn.ergeerts at artesis.be (glenner)
Date: Sun, 7 Feb 2010 06:04:07 -0800 (PST)
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <20100202135735.GA8318@mrnibble.lshift.net>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
	<20100202135735.GA8318@mrnibble.lshift.net>
Message-ID: <27488901.post@talk.nabble.com>



Matthew Sackman wrote:
> 
> Hi,
> 
> On Thu, Jan 28, 2010 at 04:26:24PM +0100, Ergeerts Glenn wrote:
>> This is the output:
>> 
>> 3> os_mon_sysinfo:get_mem_info().
>> ["76 -1658880 1016913920 -1 -1021628416 2147352576 2134794240\n"]
> 
> The plot thickens.
> 
> I have a 64-bit Vista virtual image which I've just tested, using R13B03
> grabbed from erlang.org, and amounts of RAM of 2GB, 3GB, 4GB and 5GB.
> 
> In all cases, os_mon_sysinfo:get_mem_info() reports the correct thing.
> 
> You've said you're running 64-bit Windows 7. Which version of Erlang are
> you running, and did you compile yourself, or did you grab it from
> erlang.org?
> 
> 

I was using the otp_win32_R12B-5.exe from the
complete-rabbitmq-bundle-1.7.1.zip package.
Installing R13B03 from erlang.org seems to fix the issue, so apparently the
bug i was experiencing was already fixed..

os_mon_sysinfo:get_mem_info(). now gives:
["64 4293308416 1519058944 8584675328 5498245120 2147352576 2134794240\n"]

and rabbitMQ 1.7.1 runs without a problem now..

thanks,
Glenn
-- 
View this message in context: http://old.nabble.com/BasicPublish%28%29-from-.NET-client-hangs-after-upgrading-server-to-1.7.1-tp27335731p27488901.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthew at lshift.net  Sun Feb  7 18:13:40 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 7 Feb 2010 18:13:40 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <27488901.post@talk.nabble.com>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
	<20100202135735.GA8318@mrnibble.lshift.net>
	<27488901.post@talk.nabble.com>
Message-ID: <20100207181340.GA6021@wellquite.org>

Hi Glenn,

On Sun, Feb 07, 2010 at 06:04:07AM -0800, glenner wrote:
> I was using the otp_win32_R12B-5.exe from the
> complete-rabbitmq-bundle-1.7.1.zip package.
> Installing R13B03 from erlang.org seems to fix the issue, so apparently the
> bug i was experiencing was already fixed..

Good to hear - that was our conclusion too. Our next release will switch
the Windows to R13B03 to solve this problem.

> os_mon_sysinfo:get_mem_info(). now gives:
> ["64 4293308416 1519058944 8584675328 5498245120 2147352576 2134794240\n"]
> 
> and rabbitMQ 1.7.1 runs without a problem now..

Good. Though you may like to note that as per my warning in another email
sent both to -discuss and -announce, you may find Rabbit still runs out of
memory as it thinks Windows will give it 4GB, but being a 32-bit
application, and Windows being Windows, it's highly likely to only have
2GB available. Adjusting the vm_memory_high_watermark configuration may
be necessary.

Matthew



From norbu09 at googlemail.com  Sun Feb  7 19:35:18 2010
From: norbu09 at googlemail.com (lenz)
Date: Mon, 8 Feb 2010 08:35:18 +1300
Subject: [rabbitmq-discuss] Anybody are using or know about RabbitMQ
	with Perl ?
In-Reply-To: <5ef296b31002070534g457e9117k9e649ad90bbd28b7@mail.gmail.com>
References: <5ef296b31002061515w5a54b75ek4152f25c014c2622@mail.gmail.com>
	<e25246b61002061748o7bff475ckc4eb0a0192e69c68@mail.gmail.com>
	<5ef296b31002070534g457e9117k9e649ad90bbd28b7@mail.gmail.com>
Message-ID: <e25246b61002071135n3dbc785fje9365e7e547af220@mail.gmail.com>

hi,

i just added an annotated example to the repository that hopefully
sheds some light to what the module does. i am sorry to not have any
formal documentation yet, only code samples.

what for do you want to use it? maybe i can give you more working code
if i know roughly what you are after :-)

cheers
lenz

On Mon, Feb 8, 2010 at 2:34 AM, Gustavo Aquino <aquino.gustavo at gmail.com> wrote:
> Hi Lenz,
> Can you send me the docs of module or how to use it ? I've tried find it in
> cpan, git, perldoc and etc but no have success.
>
> Best Regards.
> Gustavo
> On Sat, Feb 6, 2010 at 11:48 PM, lenz <norbu09 at googlemail.com> wrote:
>>
>> hi, use Net::AMQP::Simple which is only in my github repository in the
>> moment and a wrapper arount Net::AMQP which by the time could be on
>> CPAN. i run my own package builds for our environment and have never
>> pushed my packages to CPAN therefor.
>>
>> have a look at http://github.com/norbu09 for some related
>> repositories, play with that and drop me a line if you need help. i
>> use RabbitMQ quite a bit from perl and it works quite nicely for me.
>> in case you want to use it from catalyst i can probably push my
>> rabbitmq catayst controller somewhere.
>>
>> cheers
>> lenz
>>
>> On Sun, Feb 7, 2010 at 12:15 PM, Gustavo Aquino
>> <aquino.gustavo at gmail.com> wrote:
>> > Hi,
>> > Anybody here are using or know library Net::RabbitMQ to Perl ?
>> > Well for me it doesn't work fine, I don't know why but It's work just
>> > for
>> > send a simple message but if I use the same code but put a simple loop
>> > (foreach) it stop to work.
>> > Regards.
>> > Gustavo Aquino
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>>
>>
>> --
>> iWantMyName.com
>> painless domain registration (finally)
>
>



-- 
iWantMyName.com
painless domain registration (finally)



From seemasbiradar at gmail.com  Mon Feb  8 07:28:21 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Mon, 8 Feb 2010 12:58:21 +0530
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <29598b611002050522qf35bea9kd3ad3d7b1645eaa7@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002050018s32fe1776j52918b63db206100@mail.gmail.com>
	<558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
	<29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
	<29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
	<558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>
	<29598b611002050503g21c3f717wcf1c7b41b3fb33c5@mail.gmail.com>
	<558967a41002050514j6634a371xd5663f1d2a8ae64d@mail.gmail.com>
	<29598b611002050522qf35bea9kd3ad3d7b1645eaa7@mail.gmail.com>
Message-ID: <558967a41002072328xce3470dr4115c7925a1bb050@mail.gmail.com>

Hi,

I have Rabbitmq running on the same machine and i am trying to execute the
BQL script I am getting the follwing error.

*{"init terminating in
do_boot",{{badmatch,{error,{{anonymous_queue_empty,<<33
bytes>>},{gen_server,call,[<0.41.0>,{call,{'basic.consume',
1,<<32 bytes>>,<<0
bytes>>,false,true,false,false},none},infinity]}}}},[{bql_amqp_rpc_client,start,2},{bql_client,connect,5},{bql_shell,s
tart,0},{init,start_it,1},{init,start_em,1}]}}*
*Crash dump was written to: erl_crash.dump*
*init terminating in do_boot ()* <rabbitmq-discuss at lists.rabbitmq.com>

On Fri, Feb 5, 2010 at 6:52 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> That is indicating that you don't have Rabbit running on the same machine
> using the default port. If it is on an alternate page, please refer to the
> documentation on the web page for connecting to alternate machines/ports.
>
>
> On Fri, Feb 5, 2010 at 1:14 PM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>
>>
>> I have unpack the rabbitmq-bql-client.zip and ran.
>>
>> $ sh bql
>> {"init terminating in
>> do_boot",{{badmatch,{error,econnrefused}},[{amqp_connection,start_network_internal,2},{bql_client,connect,5},{bql_shell,start,0},{init,start_it,1},{init,start_em,1}]}}
>>  Crash dump was written to: erl_crash.dump
>> init terminating in do_boot ()
>>
>>   On Fri, Feb 5, 2010 at 6:33 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>
>>> Seema,
>>>
>>> Did you unpack the client from the zip file, as per the install
>>> instructions? The bql script cannot be invoked directly in the source tree -
>>> it expects to have approach files put in the right places.
>>>
>>> Paul.
>>>
>>>
>>> On Fri, Feb 5, 2010 at 11:24 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>>
>>>> Hi Paul,
>>>>
>>>> Thanks a lot for detailed steps....now RabbitMq server is running fine ,
>>>> I am not getting any error while running the server.
>>>>
>>>> But when i am trying to BQL script i am getting the following error.
>>>>
>>>> [Scripts]$ ./bql
>>>> {"init terminating in
>>>> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>>> init terminating in do_boot ()
>>>> Regards
>>>> Seema
>>>>   On Fri, Feb 5, 2010 at 2:16 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>
>>>>> Hi Seema,
>>>>>
>>>>> I've just done a fresh checkout with the following steps:
>>>>>
>>>>> - hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>> - cd rabbitmq-public-umbrella
>>>>> - make co
>>>>> - make
>>>>> - cd rabbitmq-bql
>>>>> - make clean
>>>>> - make
>>>>> - mkdir ../rabbitmq-server/plugins
>>>>> - cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
>>>>> ../rabbitmq-server/plugins
>>>>> - cd ../rabbitmq-server
>>>>> - make cleandb run
>>>>>
>>>>> These steps are working for me. Can you confirm what version of Erlang
>>>>> you have installed?
>>>>>
>>>>>
>>>>> On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar <seemasbiradar at gmail.com
>>>>> > wrote:
>>>>>
>>>>>>
>>>>>> Hi
>>>>>>
>>>>>> Yes , I have follwed the same steps mentioned by you......still error
>>>>>> exists.
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>
>>>>>>> So just to verify, you've done the following in rabbitmq-bql:
>>>>>>>   hg pull
>>>>>>>   hg up
>>>>>>>   make clean
>>>>>>>   make
>>>>>>>
>>>>>>> and then copied the .ez files into your plugins directory?
>>>>>>>
>>>>>>>
>>>>>>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <
>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>
>>>>>>>> Hi Paul,
>>>>>>>>
>>>>>>>> Even after removing the symlink in the plugin folder i am getting
>>>>>>>> the same error.
>>>>>>>>
>>>>>>>>
>>>>>>>> node          : rabbit at linux
>>>>>>>> app descriptor:
>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>>>>>>> home dir      : /home/
>>>>>>>> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
>>>>>>>> log           : /var/log/rabbitmq/rabbit.log
>>>>>>>> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
>>>>>>>> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>>>>>>>> starting internal event notification
>>>>>>>> system                           ...done
>>>>>>>> starting logging
>>>>>>>> server                                               ...done
>>>>>>>> starting
>>>>>>>> database                                                     ...done
>>>>>>>> -- kernel ready
>>>>>>>> starting alarm
>>>>>>>> handler                                                ...done
>>>>>>>> starting queue
>>>>>>>> supervisor                                             ...done
>>>>>>>> starting node
>>>>>>>> monitor                                                 ...done
>>>>>>>> starting cluster
>>>>>>>> router                                               ...done
>>>>>>>> -- core initialized
>>>>>>>> starting empty DB
>>>>>>>> check                                               ...done
>>>>>>>> starting codec correctness
>>>>>>>> check                                      ...done
>>>>>>>> starting exchange
>>>>>>>> recovery                                            ...done
>>>>>>>> starting queue
>>>>>>>> recovery                                               ...done
>>>>>>>> starting
>>>>>>>> persister                                                    ...done
>>>>>>>> starting guid
>>>>>>>> generator                                               ...done
>>>>>>>> -- message delivery logic ready
>>>>>>>> starting error log
>>>>>>>> relay                                              ...done
>>>>>>>> starting
>>>>>>>> networking                                                   ...done
>>>>>>>> -- network listeners available
>>>>>>>>
>>>>>>>> broker running
>>>>>>>> Erlang has closed
>>>>>>>> {"Kernel pid
>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>
>>>>>>>> Thanks,
>>>>>>>> seema
>>>>>>>>   On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <pauljones23 at gmail.com
>>>>>>>> > wrote:
>>>>>>>>
>>>>>>>>> As a starting point, you should remove the two symlinks in the
>>>>>>>>> directory - with the .ez files and the symlinks, you now have the erlang
>>>>>>>>> client and bql installed as plugins twice.
>>>>>>>>>
>>>>>>>>> Once you've done this, are you seeing the exact same error message?
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <
>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>>> Hi all,
>>>>>>>>>>
>>>>>>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I am
>>>>>>>>>> still facing the same error.
>>>>>>>>>>
>>>>>>>>>> I have downloded  erlang-rfc4627  from the site
>>>>>>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>>>>>>
>>>>>>>>>> rabbitmq-bql from
>>>>>>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>>>>>>
>>>>>>>>>> my folder structure is like
>>>>>>>>>>
>>>>>>>>>> RabbitMQ server :
>>>>>>>>>>
>>>>>>>>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>>>>>>
>>>>>>>>>> Rabbitmq -BQL
>>>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>>>>>>
>>>>>>>>>> Plugin folder of rabbitmq-server contains.
>>>>>>>>>>
>>>>>>>>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>>>>>>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>>>>>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>>>>>>>>  rfc4627_jsonrpc.ez
>>>>>>>>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>>>>>>>>> rabbitmq-bql.ez
>>>>>>>>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>>>>>>>>> amqp_client.ez
>>>>>>>>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>>>>>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>>>>>>
>>>>>>>>>> Please help me on this.
>>>>>>>>>>
>>>>>>>>>> Thanks in advance
>>>>>>>>>> Seema
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <pauljones23 at gmail.com
>>>>>>>>>> > wrote:
>>>>>>>>>>
>>>>>>>>>>> Hi Seema,
>>>>>>>>>>>
>>>>>>>>>>> It turns out there were two problems in play here. Firstly, as
>>>>>>>>>>> Matthew said in his emails, you'll also need the erlang-rfc4627 package.
>>>>>>>>>>> You'll also need to pull in the latest change for rabbitmq-bql, since
>>>>>>>>>>> unfortunately a change in the erlang client resulted in the plugin breaking.
>>>>>>>>>>> I've corrected this, and after being able to reproduce the problem before,
>>>>>>>>>>> it is now working for me.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Paul.
>>>>>>>>>>>
>>>>>>>>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>>>
>>>>>>>>>>>>   Hi All,
>>>>>>>>>>>>
>>>>>>>>>>>> I am getting the Following error while running the Rabbitmq
>>>>>>>>>>>> along with shovel and BQL pluggin.
>>>>>>>>>>>>
>>>>>>>>>>>> broker running
>>>>>>>>>>>> Erlang has closed
>>>>>>>>>>>>                  {"Kernel pid
>>>>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>>>> make: *** [run] Error 1
>>>>>>>>>>>>  here are the steps I followed while running Shovel and RabbitMQ
>>>>>>>>>>>> BQL pluggins.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>>>>>>> 8. cd rabbitmq-server
>>>>>>>>>>>> 9. hg up -C bug16653
>>>>>>>>>>>> 10.make -j
>>>>>>>>>>>> 11. mkdir -p plugins
>>>>>>>>>>>> 12. cd plugins
>>>>>>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>>>>>>> 17. make
>>>>>>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>>>>>>> 19. make
>>>>>>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>>>>>>> 19. make
>>>>>>>>>>>> 20. cd ../rabbitmq-server
>>>>>>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>>>>>>> 22. make cleandb run
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> Please let me know your suggestions.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks in adavance.
>>>>>>>>>>>> Seema
>>>>>>>>>>>>
>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>>>>>
>>>>>>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/9b90bfb4/attachment.htm 

From sigurd.hogsbro at museeka.com  Mon Feb  8 07:54:02 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Mon, 8 Feb 2010 07:54:02 +0000
Subject: [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)
	writing to queue
In-Reply-To: <ebcef6281002070333x11c756bfq3d033093ce522fef@mail.gmail.com>
References: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>
	<ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>
	<4B6DCEB4.4050309@lshift.net>
	<ebcef6281002070333x11c756bfq3d033093ce522fef@mail.gmail.com>
Message-ID: <ebcef6281002072354h2d53613bj3c4041b8b8cf9259@mail.gmail.com>

Matthias,

I injected the java Tracer into the path, and spotted a Connection.tune
method with interesting parameters:

1265609050931: conn#0 ch#0 ->
{#method<connection.start-ok>(client-properties={library_version=0.6.1,
library=Python
amqplib},mechanism=AMQPLAIN,response=LOGINSguesPASSWORDSguest,locale=en_US),null,""}
1265609050961: conn#0 ch#0 <-
{#method<connection.tune>(channel-max=0,frame-max=131072,heartbeat=0),null,""}
1265609051002: conn#0 ch#0 ->
{#method<connection.tune-ok>(channel-max=65535,frame-max=131072,heartbeat=0),null,""}
1265609051003: conn#0 ch#0 ->
{#method<connection.open>(virtual-host=/,capabilities=,insist=false),null,""}
1265609051041: conn#0 ch#0 <-
{#method<connection.open-ok>(known-hosts=localhost:5672),null,""}
1265609051081: conn#0 ch#1 -> {#method<channel.open>(out-of-band=),null,""}
1265609051121: conn#0 ch#1 <- {#method<channel.open-ok>(),null,""}
1265609051161: conn#0 ch#1 ->
{#method<access.request>(realm=/data,exclusive=false,passive=false,active=true,write=true,read=false),null,""}
1265609051200: conn#0 ch#1 <- {#method<access.request-ok>(ticket=1),null,""}
1265609051242: conn#0 ch#2 -> {#method<channel.open>(out-of-band=),null,""}
1265609051290: conn#0 ch#2 <- {#method<channel.open-ok>(),null,""}
1265609051331: conn#0 ch#2 ->
{#method<access.request>(realm=/data,exclusive=false,passive=false,active=true,write=false,read=true),null,""}
1265609051370: conn#0 ch#2 <- {#method<access.request-ok>(ticket=1),null,""}
1265609051412: conn#0 ch#2 ->
{#method<queue.declare>(ticket=1,queue=transcode.wmal,passive=false,durable=false,exclusive=false,auto-delete=true,nowait=false,arguments={}),null,""}
1265609051451: conn#0 ch#2 <-
{#method<queue.declare-ok>(queue=transcode.wmal,message-count=0,consumer-count=0),null,""}
1265609051490: conn#0 ch#2 ->
{#method<basic.consume>(ticket=1,queue=transcode.wmal,consumer-tag=,no-local=false,no-ack=false,exclusive=false,nowait=false),null,""}
1265609051531: conn#0 ch#2 <-
{#method<basic.consume-ok>(consumer-tag=amq.ctag-GmOHWY3xtNeQ9+9WvAo3oA==),null,""}


This led me to the discussion on http://www.amqp.org/jira/browse/AMQP-108,
suggesting that there is an upper limit on AMQP payload of a 16-bit number
in versions 0.8/0.9.

I'll try patching py-amqplib to take frame-max in kwargs, but any other
gotchas you can think of would be appreciated? Would I be better off trying
Tony's PIKA?

Sigurd

2010/2/7 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>

> Hello Matthias,
>
> The below extract from rabbit.log is from a problematic run. It appears the
> python instance running with Windows XP within VirtualBox aborts the
> connection.
>
> The message bodies being sent are 6-25Mb each, which isn't immaterial but
> AFAICT should work.
>
> I used to have immediate and mandatory flags set but I've removed these to
> make the connection as plain vanilla as possible.
>
> Regards,
>
> Sigurd
>
> =INFO REPORT==== 7-Feb-2010::09:55:33 ===
> accepted TCP connection on 0.0.0.0:5672 from 192.168.66.61:54000
>
> =INFO REPORT==== 7-Feb-2010::09:55:33 ===
> starting TCP connection <0.809.5> from 192.168.66.61:54000
>
> =INFO REPORT==== 7-Feb-2010::09:55:51 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:47539
>
> =INFO REPORT==== 7-Feb-2010::09:55:51 ===
> starting TCP connection <0.835.5> from 127.0.0.1:47539
>
> =INFO REPORT==== 7-Feb-2010::09:55:51 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:47540
>
> =INFO REPORT==== 7-Feb-2010::09:55:51 ===
> starting TCP connection <0.841.5> from 127.0.0.1:47540
>
> =WARNING REPORT==== 7-Feb-2010::09:56:35 ===
> exception on TCP connection <0.835.5> from 127.0.0.1:47539
> connection_closed_abruptly
>
> =INFO REPORT==== 7-Feb-2010::09:56:35 ===
>  closing TCP connection <0.835.5> from 127.0.0.1:47539
>
> =WARNING REPORT==== 7-Feb-2010::09:56:35 ===
> exception on TCP connection <0.841.5> from 127.0.0.1:47540
> connection_closed_abruptly
>
> =INFO REPORT==== 7-Feb-2010::09:56:35 ===
> closing TCP connection <0.841.5> from 127.0.0.1:47540
>
> 2010/2/6 Matthias Radestock <matthias at lshift.net>
>
>> Sigurd,
>>
>>
>> Sigurd H?gsbro wrote:
>>
>>> when used in anger sending the response [...] fails with:
>>>
>>> [Errno 10054] An existing connection was forcibly closed by the remote
>>> host
>>>
>>
>> Is there anything unusual in the server logs (rabbit.log and
>> rabbit-sasl.log)?
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/23b56e7a/attachment.htm 

From pauljones23 at gmail.com  Mon Feb  8 08:22:41 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 8 Feb 2010 08:22:41 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <558967a41002072328xce3470dr4115c7925a1bb050@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<558967a41002050022i84ea00dt68c7d2e98c10ae7e@mail.gmail.com>
	<29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
	<29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
	<558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>
	<29598b611002050503g21c3f717wcf1c7b41b3fb33c5@mail.gmail.com>
	<558967a41002050514j6634a371xd5663f1d2a8ae64d@mail.gmail.com>
	<29598b611002050522qf35bea9kd3ad3d7b1645eaa7@mail.gmail.com>
	<558967a41002072328xce3470dr4115c7925a1bb050@mail.gmail.com>
Message-ID: <29598b611002080022g18765788kb97e75acf20a62df@mail.gmail.com>

Hi Seema,

It looks like the same problem was in the client too. I've fixed that as
well - so please do the following in your rabbitmq-bql directory:
  make clean
  hg pull
  hg up
  make

For note, to make it easier to use the client in this circumstance, the
client is automatically unpacked in the directory "build/client".

Paul.

On Mon, Feb 8, 2010 at 7:28 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Hi,
>
> I have Rabbitmq running on the same machine and i am trying to execute the
> BQL script I am getting the follwing error.
>
> *{"init terminating in
> do_boot",{{badmatch,{error,{{anonymous_queue_empty,<<33
> bytes>>},{gen_server,call,[<0.41.0>,{call,{'basic.consume',
> 1,<<32 bytes>>,<<0
> bytes>>,false,true,false,false},none},infinity]}}}},[{bql_amqp_rpc_client,start,2},{bql_client,connect,5},{bql_shell,s
>
> tart,0},{init,start_it,1},{init,start_em,1}]}}
> *
> *Crash dump was written to: erl_crash.dump*
> *init terminating in do_boot ()* <rabbitmq-discuss at lists.rabbitmq.com>
>
> On Fri, Feb 5, 2010 at 6:52 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>
>> That is indicating that you don't have Rabbit running on the same machine
>> using the default port. If it is on an alternate page, please refer to the
>> documentation on the web page for connecting to alternate machines/ports.
>>
>>
>> On Fri, Feb 5, 2010 at 1:14 PM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>
>>>
>>> I have unpack the rabbitmq-bql-client.zip and ran.
>>>
>>> $ sh bql
>>> {"init terminating in
>>> do_boot",{{badmatch,{error,econnrefused}},[{amqp_connection,start_network_internal,2},{bql_client,connect,5},{bql_shell,start,0},{init,start_it,1},{init,start_em,1}]}}
>>>  Crash dump was written to: erl_crash.dump
>>> init terminating in do_boot ()
>>>
>>>   On Fri, Feb 5, 2010 at 6:33 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>
>>>> Seema,
>>>>
>>>> Did you unpack the client from the zip file, as per the install
>>>> instructions? The bql script cannot be invoked directly in the source tree -
>>>> it expects to have approach files put in the right places.
>>>>
>>>> Paul.
>>>>
>>>>
>>>> On Fri, Feb 5, 2010 at 11:24 AM, Seema Biradar <seemasbiradar at gmail.com
>>>> > wrote:
>>>>
>>>>> Hi Paul,
>>>>>
>>>>> Thanks a lot for detailed steps....now RabbitMq server is running fine
>>>>> , I am not getting any error while running the server.
>>>>>
>>>>> But when i am trying to BQL script i am getting the following error.
>>>>>
>>>>> [Scripts]$ ./bql
>>>>> {"init terminating in
>>>>> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>>>> init terminating in do_boot ()
>>>>> Regards
>>>>> Seema
>>>>>   On Fri, Feb 5, 2010 at 2:16 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>
>>>>>> Hi Seema,
>>>>>>
>>>>>> I've just done a fresh checkout with the following steps:
>>>>>>
>>>>>> - hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>> - cd rabbitmq-public-umbrella
>>>>>> - make co
>>>>>> - make
>>>>>> - cd rabbitmq-bql
>>>>>> - make clean
>>>>>> - make
>>>>>> - mkdir ../rabbitmq-server/plugins
>>>>>> - cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
>>>>>> ../rabbitmq-server/plugins
>>>>>> - cd ../rabbitmq-server
>>>>>> - make cleandb run
>>>>>>
>>>>>> These steps are working for me. Can you confirm what version of Erlang
>>>>>> you have installed?
>>>>>>
>>>>>>
>>>>>> On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar <
>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>
>>>>>>>
>>>>>>> Hi
>>>>>>>
>>>>>>> Yes , I have follwed the same steps mentioned by you......still error
>>>>>>> exists.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>>
>>>>>>>> So just to verify, you've done the following in rabbitmq-bql:
>>>>>>>>   hg pull
>>>>>>>>   hg up
>>>>>>>>   make clean
>>>>>>>>   make
>>>>>>>>
>>>>>>>> and then copied the .ez files into your plugins directory?
>>>>>>>>
>>>>>>>>
>>>>>>>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <
>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>
>>>>>>>>> Hi Paul,
>>>>>>>>>
>>>>>>>>> Even after removing the symlink in the plugin folder i am getting
>>>>>>>>> the same error.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> node          : rabbit at linux
>>>>>>>>> app descriptor:
>>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>>>>>>>> home dir      : /home/
>>>>>>>>> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
>>>>>>>>> log           : /var/log/rabbitmq/rabbit.log
>>>>>>>>> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
>>>>>>>>> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>>>>>>>>> starting internal event notification
>>>>>>>>> system                           ...done
>>>>>>>>> starting logging
>>>>>>>>> server                                               ...done
>>>>>>>>> starting
>>>>>>>>> database                                                     ...done
>>>>>>>>> -- kernel ready
>>>>>>>>> starting alarm
>>>>>>>>> handler                                                ...done
>>>>>>>>> starting queue
>>>>>>>>> supervisor                                             ...done
>>>>>>>>> starting node
>>>>>>>>> monitor                                                 ...done
>>>>>>>>> starting cluster
>>>>>>>>> router                                               ...done
>>>>>>>>> -- core initialized
>>>>>>>>> starting empty DB
>>>>>>>>> check                                               ...done
>>>>>>>>> starting codec correctness
>>>>>>>>> check                                      ...done
>>>>>>>>> starting exchange
>>>>>>>>> recovery                                            ...done
>>>>>>>>> starting queue
>>>>>>>>> recovery                                               ...done
>>>>>>>>> starting
>>>>>>>>> persister                                                    ...done
>>>>>>>>> starting guid
>>>>>>>>> generator                                               ...done
>>>>>>>>> -- message delivery logic ready
>>>>>>>>> starting error log
>>>>>>>>> relay                                              ...done
>>>>>>>>> starting
>>>>>>>>> networking                                                   ...done
>>>>>>>>> -- network listeners available
>>>>>>>>>
>>>>>>>>> broker running
>>>>>>>>> Erlang has closed
>>>>>>>>> {"Kernel pid
>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>
>>>>>>>>> Thanks,
>>>>>>>>> seema
>>>>>>>>>   On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <
>>>>>>>>> pauljones23 at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>>> As a starting point, you should remove the two symlinks in the
>>>>>>>>>> directory - with the .ez files and the symlinks, you now have the erlang
>>>>>>>>>> client and bql installed as plugins twice.
>>>>>>>>>>
>>>>>>>>>> Once you've done this, are you seeing the exact same error
>>>>>>>>>> message?
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <
>>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>>
>>>>>>>>>>> Hi all,
>>>>>>>>>>>
>>>>>>>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I
>>>>>>>>>>> am still facing the same error.
>>>>>>>>>>>
>>>>>>>>>>> I have downloded  erlang-rfc4627  from the site
>>>>>>>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>>>>>>>
>>>>>>>>>>> rabbitmq-bql from
>>>>>>>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>>>>>>>
>>>>>>>>>>> my folder structure is like
>>>>>>>>>>>
>>>>>>>>>>> RabbitMQ server :
>>>>>>>>>>>
>>>>>>>>>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>>>>>>>
>>>>>>>>>>> Rabbitmq -BQL
>>>>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>>>>>>>
>>>>>>>>>>> Plugin folder of rabbitmq-server contains.
>>>>>>>>>>>
>>>>>>>>>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>>>>>>>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>>>>>>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>>>>>>>>>  rfc4627_jsonrpc.ez
>>>>>>>>>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>>>>>>>>>> rabbitmq-bql.ez
>>>>>>>>>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>>>>>>>>>> amqp_client.ez
>>>>>>>>>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>>>>>>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>>>>>>>
>>>>>>>>>>> Please help me on this.
>>>>>>>>>>>
>>>>>>>>>>> Thanks in advance
>>>>>>>>>>> Seema
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <
>>>>>>>>>>> pauljones23 at gmail.com> wrote:
>>>>>>>>>>>
>>>>>>>>>>>> Hi Seema,
>>>>>>>>>>>>
>>>>>>>>>>>> It turns out there were two problems in play here. Firstly, as
>>>>>>>>>>>> Matthew said in his emails, you'll also need the erlang-rfc4627 package.
>>>>>>>>>>>> You'll also need to pull in the latest change for rabbitmq-bql, since
>>>>>>>>>>>> unfortunately a change in the erlang client resulted in the plugin breaking.
>>>>>>>>>>>> I've corrected this, and after being able to reproduce the problem before,
>>>>>>>>>>>> it is now working for me.
>>>>>>>>>>>>
>>>>>>>>>>>> Cheers,
>>>>>>>>>>>> Paul.
>>>>>>>>>>>>
>>>>>>>>>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>>>>
>>>>>>>>>>>>>   Hi All,
>>>>>>>>>>>>>
>>>>>>>>>>>>> I am getting the Following error while running the Rabbitmq
>>>>>>>>>>>>> along with shovel and BQL pluggin.
>>>>>>>>>>>>>
>>>>>>>>>>>>> broker running
>>>>>>>>>>>>> Erlang has closed
>>>>>>>>>>>>>                  {"Kernel pid
>>>>>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>>>>> make: *** [run] Error 1
>>>>>>>>>>>>>   here are the steps I followed while running Shovel and
>>>>>>>>>>>>> RabbitMQ BQL pluggins.
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>>>>>>>> 8. cd rabbitmq-server
>>>>>>>>>>>>> 9. hg up -C bug16653
>>>>>>>>>>>>> 10.make -j
>>>>>>>>>>>>> 11. mkdir -p plugins
>>>>>>>>>>>>> 12. cd plugins
>>>>>>>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>>>>>>>> 17. make
>>>>>>>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>>>>>>>> 19. make
>>>>>>>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>>>>>>>> 19. make
>>>>>>>>>>>>> 20. cd ../rabbitmq-server
>>>>>>>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>>>>>>>> 22. make cleandb run
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>> Please let me know your suggestions.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Thanks in adavance.
>>>>>>>>>>>>> Seema
>>>>>>>>>>>>>
>>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>>>>>>
>>>>>>>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/93f8091b/attachment.htm 

From seemasbiradar at gmail.com  Mon Feb  8 09:20:11 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Mon, 8 Feb 2010 14:50:11 +0530
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <29598b611002080022g18765788kb97e75acf20a62df@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<29598b611002050027k2d26d9dfu98d6f3c96a13ec77@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
	<29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
	<558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>
	<29598b611002050503g21c3f717wcf1c7b41b3fb33c5@mail.gmail.com>
	<558967a41002050514j6634a371xd5663f1d2a8ae64d@mail.gmail.com>
	<29598b611002050522qf35bea9kd3ad3d7b1645eaa7@mail.gmail.com>
	<558967a41002072328xce3470dr4115c7925a1bb050@mail.gmail.com>
	<29598b611002080022g18765788kb97e75acf20a62df@mail.gmail.com>
Message-ID: <558967a41002080120j5fafd8bcl73c8ca0bbe344219@mail.gmail.com>

Thanks a lot.
It's working fine now... :)



On Mon, Feb 8, 2010 at 1:52 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Seema,
>
> It looks like the same problem was in the client too. I've fixed that as
> well - so please do the following in your rabbitmq-bql directory:
>   make clean
>
>   hg pull
>   hg up
>   make
>
> For note, to make it easier to use the client in this circumstance, the
> client is automatically unpacked in the directory "build/client".
>
> Paul.
>
>
> On Mon, Feb 8, 2010 at 7:28 AM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>
>> Hi,
>>
>> I have Rabbitmq running on the same machine and i am trying to execute the
>> BQL script I am getting the follwing error.
>>
>> *{"init terminating in
>> do_boot",{{badmatch,{error,{{anonymous_queue_empty,<<33
>> bytes>>},{gen_server,call,[<0.41.0>,{call,{'basic.consume',
>> 1,<<32 bytes>>,<<0
>> bytes>>,false,true,false,false},none},infinity]}}}},[{bql_amqp_rpc_client,start,2},{bql_client,connect,5},{bql_shell,s
>>
>>
>> tart,0},{init,start_it,1},{init,start_em,1}]}}
>> *
>>  *Crash dump was written to: erl_crash.dump*
>> *init terminating in do_boot ()* <rabbitmq-discuss at lists.rabbitmq.com>
>>
>>   On Fri, Feb 5, 2010 at 6:52 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>
>>> That is indicating that you don't have Rabbit running on the same machine
>>> using the default port. If it is on an alternate page, please refer to the
>>> documentation on the web page for connecting to alternate machines/ports.
>>>
>>>
>>> On Fri, Feb 5, 2010 at 1:14 PM, Seema Biradar <seemasbiradar at gmail.com>wrote:
>>>
>>>>
>>>> I have unpack the rabbitmq-bql-client.zip and ran.
>>>>
>>>> $ sh bql
>>>> {"init terminating in
>>>> do_boot",{{badmatch,{error,econnrefused}},[{amqp_connection,start_network_internal,2},{bql_client,connect,5},{bql_shell,start,0},{init,start_it,1},{init,start_em,1}]}}
>>>>  Crash dump was written to: erl_crash.dump
>>>> init terminating in do_boot ()
>>>>
>>>>   On Fri, Feb 5, 2010 at 6:33 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>
>>>>> Seema,
>>>>>
>>>>> Did you unpack the client from the zip file, as per the install
>>>>> instructions? The bql script cannot be invoked directly in the source tree -
>>>>> it expects to have approach files put in the right places.
>>>>>
>>>>> Paul.
>>>>>
>>>>>
>>>>> On Fri, Feb 5, 2010 at 11:24 AM, Seema Biradar <
>>>>> seemasbiradar at gmail.com> wrote:
>>>>>
>>>>>> Hi Paul,
>>>>>>
>>>>>> Thanks a lot for detailed steps....now RabbitMq server is running fine
>>>>>> , I am not getting any error while running the server.
>>>>>>
>>>>>> But when i am trying to BQL script i am getting the following error.
>>>>>>
>>>>>> [Scripts]$ ./bql
>>>>>> {"init terminating in
>>>>>> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>>>>> init terminating in do_boot ()
>>>>>> Regards
>>>>>> Seema
>>>>>>   On Fri, Feb 5, 2010 at 2:16 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>
>>>>>>> Hi Seema,
>>>>>>>
>>>>>>> I've just done a fresh checkout with the following steps:
>>>>>>>
>>>>>>> - hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>> - cd rabbitmq-public-umbrella
>>>>>>> - make co
>>>>>>> - make
>>>>>>> - cd rabbitmq-bql
>>>>>>> - make clean
>>>>>>> - make
>>>>>>> - mkdir ../rabbitmq-server/plugins
>>>>>>> - cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
>>>>>>> ../rabbitmq-server/plugins
>>>>>>> - cd ../rabbitmq-server
>>>>>>> - make cleandb run
>>>>>>>
>>>>>>> These steps are working for me. Can you confirm what version of
>>>>>>> Erlang you have installed?
>>>>>>>
>>>>>>>
>>>>>>> On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar <
>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>
>>>>>>>>
>>>>>>>> Hi
>>>>>>>>
>>>>>>>> Yes , I have follwed the same steps mentioned by you......still
>>>>>>>> error exists.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>>>>>>
>>>>>>>>> So just to verify, you've done the following in rabbitmq-bql:
>>>>>>>>>   hg pull
>>>>>>>>>   hg up
>>>>>>>>>   make clean
>>>>>>>>>   make
>>>>>>>>>
>>>>>>>>> and then copied the .ez files into your plugins directory?
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar <
>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>>> Hi Paul,
>>>>>>>>>>
>>>>>>>>>> Even after removing the symlink in the plugin folder i am getting
>>>>>>>>>> the same error.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> node          : rabbit at linux
>>>>>>>>>> app descriptor:
>>>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>>>>>>>>> home dir      : /home/
>>>>>>>>>> cookie hash   : fISy4G9tmNyABJwnAvHjrQ==
>>>>>>>>>> log           : /var/log/rabbitmq/rabbit.log
>>>>>>>>>> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
>>>>>>>>>> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>>>>>>>>>> starting internal event notification
>>>>>>>>>> system                           ...done
>>>>>>>>>> starting logging
>>>>>>>>>> server                                               ...done
>>>>>>>>>> starting
>>>>>>>>>> database                                                     ...done
>>>>>>>>>> -- kernel ready
>>>>>>>>>> starting alarm
>>>>>>>>>> handler                                                ...done
>>>>>>>>>> starting queue
>>>>>>>>>> supervisor                                             ...done
>>>>>>>>>> starting node
>>>>>>>>>> monitor                                                 ...done
>>>>>>>>>> starting cluster
>>>>>>>>>> router                                               ...done
>>>>>>>>>> -- core initialized
>>>>>>>>>> starting empty DB
>>>>>>>>>> check                                               ...done
>>>>>>>>>> starting codec correctness
>>>>>>>>>> check                                      ...done
>>>>>>>>>> starting exchange
>>>>>>>>>> recovery                                            ...done
>>>>>>>>>> starting queue
>>>>>>>>>> recovery                                               ...done
>>>>>>>>>> starting
>>>>>>>>>> persister                                                    ...done
>>>>>>>>>> starting guid
>>>>>>>>>> generator                                               ...done
>>>>>>>>>> -- message delivery logic ready
>>>>>>>>>> starting error log
>>>>>>>>>> relay                                              ...done
>>>>>>>>>> starting
>>>>>>>>>> networking                                                   ...done
>>>>>>>>>> -- network listeners available
>>>>>>>>>>
>>>>>>>>>> broker running
>>>>>>>>>> Erlang has closed
>>>>>>>>>> {"Kernel pid
>>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>>
>>>>>>>>>> Thanks,
>>>>>>>>>> seema
>>>>>>>>>>   On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones <
>>>>>>>>>> pauljones23 at gmail.com> wrote:
>>>>>>>>>>
>>>>>>>>>>> As a starting point, you should remove the two symlinks in the
>>>>>>>>>>> directory - with the .ez files and the symlinks, you now have the erlang
>>>>>>>>>>> client and bql installed as plugins twice.
>>>>>>>>>>>
>>>>>>>>>>> Once you've done this, are you seeing the exact same error
>>>>>>>>>>> message?
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar <
>>>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>>>
>>>>>>>>>>>> Hi all,
>>>>>>>>>>>>
>>>>>>>>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I
>>>>>>>>>>>> am still facing the same error.
>>>>>>>>>>>>
>>>>>>>>>>>> I have downloded  erlang-rfc4627  from the site
>>>>>>>>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>>>>>>>>
>>>>>>>>>>>> rabbitmq-bql from
>>>>>>>>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>>>>>>>>
>>>>>>>>>>>> my folder structure is like
>>>>>>>>>>>>
>>>>>>>>>>>> RabbitMQ server :
>>>>>>>>>>>>
>>>>>>>>>>>>  /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>>>>>>>>
>>>>>>>>>>>> Rabbitmq -BQL
>>>>>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>>>>>>>>
>>>>>>>>>>>> Plugin folder of rabbitmq-server contains.
>>>>>>>>>>>>
>>>>>>>>>>>> lrwxrwxrwx  1 root rootuser     28 Feb  4 13:44
>>>>>>>>>>>>  rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>>>>>>>>> -rwxrwxrwx  1 root rootuser  41041 Feb  5 12:35
>>>>>>>>>>>>  rfc4627_jsonrpc.ez
>>>>>>>>>>>> -rwxrwxrwx  1 root rootuser 238092 Feb  5 12:37
>>>>>>>>>>>> rabbitmq-bql.ez
>>>>>>>>>>>> -rwxrwxrwx  1 root rootuser 104210 Feb  5 12:37
>>>>>>>>>>>> amqp_client.ez
>>>>>>>>>>>> lrwxrwxrwx  1 root rootuser     18 Feb  5 13:17
>>>>>>>>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>>>>>>>>
>>>>>>>>>>>> Please help me on this.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks in advance
>>>>>>>>>>>> Seema
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones <
>>>>>>>>>>>> pauljones23 at gmail.com> wrote:
>>>>>>>>>>>>
>>>>>>>>>>>>> Hi Seema,
>>>>>>>>>>>>>
>>>>>>>>>>>>> It turns out there were two problems in play here. Firstly, as
>>>>>>>>>>>>> Matthew said in his emails, you'll also need the erlang-rfc4627 package.
>>>>>>>>>>>>> You'll also need to pull in the latest change for rabbitmq-bql, since
>>>>>>>>>>>>> unfortunately a change in the erlang client resulted in the plugin breaking.
>>>>>>>>>>>>> I've corrected this, and after being able to reproduce the problem before,
>>>>>>>>>>>>> it is now working for me.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Cheers,
>>>>>>>>>>>>> Paul.
>>>>>>>>>>>>>
>>>>>>>>>>>>>   On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar <
>>>>>>>>>>>>> seemasbiradar at gmail.com> wrote:
>>>>>>>>>>>>>
>>>>>>>>>>>>>>   Hi All,
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> I am getting the Following error while running the Rabbitmq
>>>>>>>>>>>>>> along with shovel and BQL pluggin.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> broker running
>>>>>>>>>>>>>> Erlang has closed
>>>>>>>>>>>>>>                  {"Kernel pid
>>>>>>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>>>>>> make: *** [run] Error 1
>>>>>>>>>>>>>>  here are the steps I followed while running Shovel and
>>>>>>>>>>>>>> RabbitMQ BQL pluggins.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>>>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>>>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>>>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>>>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>>>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>>>>>>>>> 8. cd rabbitmq-server
>>>>>>>>>>>>>> 9. hg up -C bug16653
>>>>>>>>>>>>>> 10.make -j
>>>>>>>>>>>>>> 11. mkdir -p plugins
>>>>>>>>>>>>>> 12. cd plugins
>>>>>>>>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>>>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>>>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>>>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>>>>>>>>> 17. make
>>>>>>>>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>>>>>>>>> 19. make
>>>>>>>>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>>>>>>>>> 19. make
>>>>>>>>>>>>>> 20. cd ../rabbitmq-server
>>>>>>>>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>>>>>>>>> 22. make cleandb run
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Please let me know your suggestions.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Thanks in adavance.
>>>>>>>>>>>>>> Seema
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/529ce40a/attachment.htm 

From gcorominas at dexmatech.com  Mon Feb  8 10:58:45 2010
From: gcorominas at dexmatech.com (Guillem Corominas)
Date: Mon, 8 Feb 2010 11:58:45 +0100
Subject: [rabbitmq-discuss] connecting to multiple rabbitmq servers
	(point-multipoint)
In-Reply-To: <4B6DE150.3060201@lshift.net>
References: <6d0427481002050731u2e88d22o2963d055c290950d@mail.gmail.com>
	<4B6DE150.3060201@lshift.net>
Message-ID: <6d0427481002080258o41775779y92dec37d8930da96@mail.gmail.com>

Thank you Mathias,
Yesterday I noticed that when the consumer stops receiving messages, the
rabbitmqctl list_connections shows that the connection no longer exists.
However in the Java Client, the Connection object and it's associated
Channel objects don't seem to notice about that. I tried logging it's status
by printing if either the Connection or the Channel is null, or if any of
those isOpen(), but they says they are both open. The client doesn't seem to
notice that the connection is down.

How can I ask the client about the connection in order to realize that it's
eventually down and it needs to be reconnected?

thanks in advance for your help,

guillem




On Sat, Feb 6, 2010 at 10:38 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Guillem,
>
>
> Guillem Corominas wrote:
>
>> when I start consuming from a second producer, it works well during a
>> small period of time (about 2h) and then suddenly stops consuming the
>> data from the producers (stops both at the same time) and queues
>> start to fill.
>>
>> I supose it's a problem with the connection & or channel but there is
>>  nothing on the logs (neither in the java client nor in the
>> rabbitmq).
>>
>
> I suggest you do a 'rabbitmqctl list_connections peer_address peer_port
> state channels send_pend' on all the brokers to check that you have the
> connections and number of channels you expect to see and that there
> is no send backlog (that's what the send_pend count
> shows).
>
>
>  If I then try to perform a basicCancel to any of my consumer
>> instances, the call becomes blocked and never returns a response
>> neither an error.
>>
>
> Getting a stack trace of all the Java threads at that point might
> provide some clues as to why things are stuck.
>
>
>  I have one open connection and one open channel per producer, however
>> I have 3 consumers that consume different kinds of message (topic
>> dependent) that share the Channel. Can this be the problem?
>>
>
> That's perfectly ok.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/cb9f828f/attachment.htm 

From lionel.cons at cern.ch  Mon Feb  8 11:27:37 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 8 Feb 2010 12:27:37 +0100
Subject: [rabbitmq-discuss] New Perl STOMP Module
Message-ID: <20100208121531.8959.abe10f7e5afbbb3a79ce619739541149@cern.ch>

For your information, I've uploaded today a new module to CPAN
allowing a Perl client to interact with a STOMP server. I tested it
against RabbitMQ and it worked fine.

See: http://search.cpan.org/~lcons/Net-STOMP.

This module provides an object oriented client interface to interact
with servers supporting STOMP (Streaming Text Orientated Messaging
Protocol). It supports the major features of messaging brokers: SSL,
asynchronous I/O, receipts and transactions.

I'm aware of the existence of Net::Stomp but this module does not
provide the functionality that we need and seems to be unsupported
(no reply from the maintainer).

If you use Perl and STOMP, feel free to give it a try and give me your
feedback.

Cheers,
__________________________________________________________
Lionel Cons        http://cern.ch/lionel.cons
CERN               http://cern.ch



From alexis.richardson at gmail.com  Mon Feb  8 11:28:54 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 8 Feb 2010 11:28:54 +0000
Subject: [rabbitmq-discuss] Error while Running RabbitMQ along with
	pluggins BQL and Shovel
In-Reply-To: <558967a41002080120j5fafd8bcl73c8ca0bbe344219@mail.gmail.com>
References: <558967a41002040340r4a5e7680n66e2e4b2ce8e61b@mail.gmail.com>
	<558967a41002050033j6475ab92p2b10ac3a39b2e881@mail.gmail.com>
	<29598b611002050046y514ddd49l726463994c5abdc6@mail.gmail.com>
	<558967a41002050324l61602d07hfae2806d6d395e1b@mail.gmail.com>
	<29598b611002050503g21c3f717wcf1c7b41b3fb33c5@mail.gmail.com>
	<558967a41002050514j6634a371xd5663f1d2a8ae64d@mail.gmail.com>
	<29598b611002050522qf35bea9kd3ad3d7b1645eaa7@mail.gmail.com>
	<558967a41002072328xce3470dr4115c7925a1bb050@mail.gmail.com>
	<29598b611002080022g18765788kb97e75acf20a62df@mail.gmail.com>
	<558967a41002080120j5fafd8bcl73c8ca0bbe344219@mail.gmail.com>
Message-ID: <167204d21002080328m6a62e51bi6205a5baf1b4574c@mail.gmail.com>

Hooray!

Thanks Paul.


On Mon, Feb 8, 2010 at 9:20 AM, Seema Biradar <seemasbiradar at gmail.com> wrote:
> Thanks a lot.
> It's working fine now... :)
>
>
> On Mon, Feb 8, 2010 at 1:52 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>>
>> Hi Seema,
>>
>> It looks like the same problem was in the client too. I've fixed that as
>> well - so please do the following in your rabbitmq-bql directory:
>> ? make clean
>> ? hg pull
>> ? hg up
>> ? make
>>
>> For note, to make it easier to use the client in this circumstance, the
>> client is automatically unpacked in the directory "build/client".
>>
>> Paul.
>>
>> On Mon, Feb 8, 2010 at 7:28 AM, Seema Biradar <seemasbiradar at gmail.com>
>> wrote:
>>>
>>> Hi,
>>>
>>> I have Rabbitmq running on the same machine and i am trying to execute
>>> the BQL script I am getting the follwing error.
>>>
>>> {"init terminating in
>>> do_boot",{{badmatch,{error,{{anonymous_queue_empty,<<33
>>> bytes>>},{gen_server,call,[<0.41.0>,{call,{'basic.consume',
>>> 1,<<32 bytes>>,<<0
>>> bytes>>,false,true,false,false},none},infinity]}}}},[{bql_amqp_rpc_client,start,2},{bql_client,connect,5},{bql_shell,s
>>> tart,0},{init,start_it,1},{init,start_em,1}]}}
>>> Crash dump was written to: erl_crash.dump
>>> init terminating in do_boot ()
>>>
>>> On Fri, Feb 5, 2010 at 6:52 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>>>>
>>>> That is indicating that you don't have Rabbit running on the same
>>>> machine using the default port. If it is on an alternate page, please refer
>>>> to the documentation on the web page for connecting to alternate
>>>> machines/ports.
>>>>
>>>> On Fri, Feb 5, 2010 at 1:14 PM, Seema Biradar <seemasbiradar at gmail.com>
>>>> wrote:
>>>>>
>>>>> I have unpack the rabbitmq-bql-client.zip and ran.
>>>>>
>>>>> $ sh bql
>>>>> {"init terminating in
>>>>> do_boot",{{badmatch,{error,econnrefused}},[{amqp_connection,start_network_internal,2},{bql_client,connect,5},{bql_shell,start,0},{init,start_it,1},{init,start_em,1}]}}
>>>>> Crash dump was written to: erl_crash.dump
>>>>> init terminating in do_boot ()
>>>>>
>>>>> On Fri, Feb 5, 2010 at 6:33 PM, Paul Jones <pauljones23 at gmail.com>
>>>>> wrote:
>>>>>>
>>>>>> Seema,
>>>>>>
>>>>>> Did you unpack the client from the zip file, as per the install
>>>>>> instructions? The bql script cannot be invoked directly in the source tree -
>>>>>> it expects to have approach files put in the right places.
>>>>>>
>>>>>> Paul.
>>>>>>
>>>>>> On Fri, Feb 5, 2010 at 11:24 AM, Seema Biradar
>>>>>> <seemasbiradar at gmail.com> wrote:
>>>>>>>
>>>>>>> Hi Paul,
>>>>>>>
>>>>>>> Thanks a lot for detailed steps....now RabbitMq server is running
>>>>>>> fine , I am not getting any error while running the server.
>>>>>>> But when i am trying to BQL script i am getting the following error.
>>>>>>>
>>>>>>> [Scripts]$ ./bql
>>>>>>> {"init terminating in
>>>>>>> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>>>>>> init terminating in do_boot ()
>>>>>>> Regards
>>>>>>> Seema
>>>>>>> On Fri, Feb 5, 2010 at 2:16 PM, Paul Jones <pauljones23 at gmail.com>
>>>>>>> wrote:
>>>>>>>>
>>>>>>>> Hi Seema,
>>>>>>>>
>>>>>>>> I've just done a fresh checkout with the following steps:
>>>>>>>> - hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>> - cd rabbitmq-public-umbrella
>>>>>>>> - make co
>>>>>>>> - make
>>>>>>>> - cd rabbitmq-bql
>>>>>>>> - make clean
>>>>>>>> - make
>>>>>>>> - mkdir ../rabbitmq-server/plugins
>>>>>>>> - cp dist/{amqp_client.ez,rabbitmq-bql.ez,rfc4627_jsonrpc.ez}
>>>>>>>> ../rabbitmq-server/plugins
>>>>>>>> - cd ../rabbitmq-server
>>>>>>>> - make cleandb run
>>>>>>>>
>>>>>>>> These steps are working for me. Can you confirm what version of
>>>>>>>> Erlang you have installed?
>>>>>>>>
>>>>>>>> On Fri, Feb 5, 2010 at 8:33 AM, Seema Biradar
>>>>>>>> <seemasbiradar at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Hi
>>>>>>>>>
>>>>>>>>> Yes , I have follwed the same steps mentioned by you......still
>>>>>>>>> error exists.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Fri, Feb 5, 2010 at 1:57 PM, Paul Jones <pauljones23 at gmail.com>
>>>>>>>>> wrote:
>>>>>>>>>>
>>>>>>>>>> So just to verify, you've done the following in rabbitmq-bql:
>>>>>>>>>> ? hg pull
>>>>>>>>>> ? hg up
>>>>>>>>>> ? make clean
>>>>>>>>>> ? make
>>>>>>>>>>
>>>>>>>>>> and then copied the .ez files into your plugins directory?
>>>>>>>>>>
>>>>>>>>>> On Fri, Feb 5, 2010 at 8:22 AM, Seema Biradar
>>>>>>>>>> <seemasbiradar at gmail.com> wrote:
>>>>>>>>>>>
>>>>>>>>>>> Hi Paul,
>>>>>>>>>>>
>>>>>>>>>>> Even after removing the symlink in the plugin folder i am getting
>>>>>>>>>>> the same error.
>>>>>>>>>>>
>>>>>>>>>>> node????????? : rabbit at linux
>>>>>>>>>>> app descriptor:
>>>>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
>>>>>>>>>>> home dir????? : /home/
>>>>>>>>>>> cookie hash?? : fISy4G9tmNyABJwnAvHjrQ==
>>>>>>>>>>> log?????????? : /var/log/rabbitmq/rabbit.log
>>>>>>>>>>> sasl log????? : /var/log/rabbitmq/rabbit-sasl.log
>>>>>>>>>>> database dir? : /var/lib/rabbitmq/mnesia/rabbit
>>>>>>>>>>> starting internal event notification
>>>>>>>>>>> system?????????????????????????? ...done
>>>>>>>>>>> starting logging
>>>>>>>>>>> server?????????????????????????????????????????????? ...done
>>>>>>>>>>> starting
>>>>>>>>>>> database???????????????????????????????????????????????????? ...done
>>>>>>>>>>> -- kernel ready
>>>>>>>>>>> starting alarm
>>>>>>>>>>> handler??????????????????????????????????????????????? ...done
>>>>>>>>>>> starting queue
>>>>>>>>>>> supervisor???????????????????????????????????????????? ...done
>>>>>>>>>>> starting node
>>>>>>>>>>> monitor???????????????????????????????????????????????? ...done
>>>>>>>>>>> starting cluster
>>>>>>>>>>> router?????????????????????????????????????????????? ...done
>>>>>>>>>>> -- core initialized
>>>>>>>>>>> starting empty DB
>>>>>>>>>>> check?????????????????????????????????????????????? ...done
>>>>>>>>>>> starting codec correctness
>>>>>>>>>>> check????????????????????????????????????? ...done
>>>>>>>>>>> starting exchange
>>>>>>>>>>> recovery??????????????????????????????????????????? ...done
>>>>>>>>>>> starting queue
>>>>>>>>>>> recovery?????????????????????????????????????????????? ...done
>>>>>>>>>>> starting
>>>>>>>>>>> persister??????????????????????????????????????????????????? ...done
>>>>>>>>>>> starting guid
>>>>>>>>>>> generator?????????????????????????????????????????????? ...done
>>>>>>>>>>> -- message delivery logic ready
>>>>>>>>>>> starting error log
>>>>>>>>>>> relay????????????????????????????????????????????? ...done
>>>>>>>>>>> starting
>>>>>>>>>>> networking?????????????????????????????????????????????????? ...done
>>>>>>>>>>> -- network listeners available
>>>>>>>>>>>
>>>>>>>>>>> broker running
>>>>>>>>>>> Erlang has closed
>>>>>>>>>>> {"Kernel pid
>>>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>>>
>>>>>>>>>>> Thanks,
>>>>>>>>>>> seema
>>>>>>>>>>> On Fri, Feb 5, 2010 at 1:48 PM, Paul Jones
>>>>>>>>>>> <pauljones23 at gmail.com> wrote:
>>>>>>>>>>>>
>>>>>>>>>>>> As a starting point, you should remove the two symlinks in the
>>>>>>>>>>>> directory - with the .ez files and the symlinks, you now have the erlang
>>>>>>>>>>>> client and bql installed as plugins twice.
>>>>>>>>>>>>
>>>>>>>>>>>> Once you've done this, are you seeing the exact same error
>>>>>>>>>>>> message?
>>>>>>>>>>>>
>>>>>>>>>>>> On Fri, Feb 5, 2010 at 7:47 AM, Seema Biradar
>>>>>>>>>>>> <seemasbiradar at gmail.com> wrote:
>>>>>>>>>>>>>
>>>>>>>>>>>>> Hi all,
>>>>>>>>>>>>>
>>>>>>>>>>>>> Even after downloading erlang-rfc4627 and latest rabbitmq-bql I
>>>>>>>>>>>>> am still facing the same error.
>>>>>>>>>>>>>
>>>>>>>>>>>>> I have downloded? erlang-rfc4627? from the site
>>>>>>>>>>>>> http://hg.opensource.lshift.net/erlang-rfc4627/
>>>>>>>>>>>>>
>>>>>>>>>>>>> rabbitmq-bql from
>>>>>>>>>>>>> http://hg.rabbitmq.com/rabbitmq-bql/.
>>>>>>>>>>>>>
>>>>>>>>>>>>> my folder structure is like
>>>>>>>>>>>>>
>>>>>>>>>>>>> RabbitMQ server :
>>>>>>>>>>>>>
>>>>>>>>>>>>> ?/usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-server
>>>>>>>>>>>>>
>>>>>>>>>>>>> Rabbitmq -BQL
>>>>>>>>>>>>> /usr/local/lib/erlang/lib/rabbitmq-public-umbrella/rabbitmq-bql
>>>>>>>>>>>>>
>>>>>>>>>>>>> Plugin folder of rabbitmq-server contains.
>>>>>>>>>>>>>
>>>>>>>>>>>>> lrwxrwxrwx? 1 root rootuser???? 28 Feb? 4 13:44
>>>>>>>>>>>>> ?rabbitmq-erlang-client -> ../../rabbitmq-erlang-client
>>>>>>>>>>>>> -rwxrwxrwx? 1 root rootuser? 41041 Feb? 5 12:35
>>>>>>>>>>>>> ?rfc4627_jsonrpc.ez
>>>>>>>>>>>>> -rwxrwxrwx? 1 root rootuser 238092 Feb? 5 12:37
>>>>>>>>>>>>> rabbitmq-bql.ez
>>>>>>>>>>>>> -rwxrwxrwx? 1 root rootuser 104210 Feb? 5 12:37
>>>>>>>>>>>>> amqp_client.ez
>>>>>>>>>>>>> lrwxrwxrwx? 1 root rootuser???? 18 Feb? 5 13:17
>>>>>>>>>>>>> rabbitmq-bql -> ../../rabbitmq-bql.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Please help me on this.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Thanks in advance
>>>>>>>>>>>>> Seema
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>> On Thu, Feb 4, 2010 at 8:30 PM, Paul Jones
>>>>>>>>>>>>> <pauljones23 at gmail.com> wrote:
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Hi Seema,
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> It turns out there were two problems in play here. Firstly, as
>>>>>>>>>>>>>> Matthew said in his emails, you'll also need the erlang-rfc4627 package.
>>>>>>>>>>>>>> You'll also need to pull in the latest change for rabbitmq-bql, since
>>>>>>>>>>>>>> unfortunately a change in the erlang client resulted in the plugin breaking.
>>>>>>>>>>>>>> I've corrected this, and after being able to reproduce the problem before,
>>>>>>>>>>>>>> it is now working for me.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Cheers,
>>>>>>>>>>>>>> Paul.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> On Thu, Feb 4, 2010 at 11:40 AM, Seema Biradar
>>>>>>>>>>>>>> <seemasbiradar at gmail.com> wrote:
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> Hi All,
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> I am getting the Following error while running the Rabbitmq
>>>>>>>>>>>>>>> along with shovel and BQL pluggin.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> broker running
>>>>>>>>>>>>>>> Erlang has closed
>>>>>>>>>>>>>>> ???????????????? {"Kernel pid
>>>>>>>>>>>>>>> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
>>>>>>>>>>>>>>> Crash dump was written to: erl_crash.dump
>>>>>>>>>>>>>>> Kernel pid terminated (application_controller)
>>>>>>>>>>>>>>> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
>>>>>>>>>>>>>>> make: *** [run] Error 1
>>>>>>>>>>>>>>> ?here are the steps I followed while running Shovel and
>>>>>>>>>>>>>>> RabbitMQ BQL pluggins.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> 1. hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
>>>>>>>>>>>>>>> 2 .cd rabbitmq-public-umbrella
>>>>>>>>>>>>>>> 3 .hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>>>>>>>>>>>>>>> 4 .hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
>>>>>>>>>>>>>>> 5 .hg clone http://hg.rabbitmq.com/rabbitmq-server
>>>>>>>>>>>>>>> 6. hg clone http://hg.rabbitmq.com/rabbitmq-shovel
>>>>>>>>>>>>>>> 7. hg clone http://hg.rabbitmq.com/rabbitmq-bql
>>>>>>>>>>>>>>> 8. cd rabbitmq-server
>>>>>>>>>>>>>>> 9. hg up -C bug16653
>>>>>>>>>>>>>>> 10.make -j
>>>>>>>>>>>>>>> 11. mkdir -p plugins
>>>>>>>>>>>>>>> 12. cd plugins
>>>>>>>>>>>>>>> 13. ln -s ../../rabbitmq-erlang-client
>>>>>>>>>>>>>>> 14. ln -s ../../rabbitmq-shovel
>>>>>>>>>>>>>>> 15. ln -s ../../rabbitmq-bql
>>>>>>>>>>>>>>> 16. cd ../../rabbitmq-erlang-client
>>>>>>>>>>>>>>> 17. make
>>>>>>>>>>>>>>> 18. cd ../rabbitmq-shovel
>>>>>>>>>>>>>>> 19. make
>>>>>>>>>>>>>>> 18. cd ../rabbitmq-bql
>>>>>>>>>>>>>>> 19. make
>>>>>>>>>>>>>>> 20. cd ../rabbitmq-server
>>>>>>>>>>>>>>> 21. ./scripts/rabbitmq-activate-plugins
>>>>>>>>>>>>>>> 22. make cleandb run
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> Please let me know your suggestions.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> Thanks in adavance.
>>>>>>>>>>>>>>> Seema
>>>>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From meyer at paperplanes.de  Mon Feb  8 11:40:53 2010
From: meyer at paperplanes.de (Mathias Meyer)
Date: Mon, 8 Feb 2010 12:40:53 +0100
Subject: [rabbitmq-discuss] Dead but still established connections in
	RabbitMQ on EC2
In-Reply-To: <fce2e45e1002030712m16c92e1do4b42e4bce7a78036@mail.gmail.com>
References: <fce2e45e1002030150g6d8996d6uf70d0678e6358bbf@mail.gmail.com>
	<3bb0d9711002030659w261f0a05xc257947c95b1ecb@mail.gmail.com>
	<fce2e45e1002030712m16c92e1do4b42e4bce7a78036@mail.gmail.com>
Message-ID: <fce2e45e1002080340y7272ac6cm335aa6ee347a49c1@mail.gmail.com>

On Wed, Feb 3, 2010 at 4:12 PM, Mathias Meyer <meyer at paperplanes.de> wrote:

> I figured heartbeats would be the way to go in this case. Just found a
> message in the archives [1] on a similar issue and a patch for
> tmm1-amqp [2] to deal with that. Will give that a go, thanks!
>
Just a quick update on this. Configuring heartbeats on both active
connections solved this issue. They properly went away and the client
reconnected after the next heartbeat timed out after the Elastic IP
was assigned.

Cheers, Mathias
-- 
http://paperplanes.de | http://holgarific.net
http://twitter.com/roidrage



From krummas at gmail.com  Mon Feb  8 12:03:31 2010
From: krummas at gmail.com (Marcus Eriksson)
Date: Mon, 8 Feb 2010 13:03:31 +0100
Subject: [rabbitmq-discuss] Licensing of librabbitmq
Message-ID: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>

Hi

I am building a plugin for Drizzle to be able to replicate transactions
directly to rabbitmq using librabbitmq (http://hg.rabbitmq.com/rabbitmq-c/)
but there is an issue with the licensing of librabbitmq;

Drizzle is a fork off mysql and therefor GPL and librabbitmq is MPL. The MPL
states that it cannot be linked to GPL software (
http://www.fsf.org/licensing/licenses/index_html#MPL).

Is there any way round this?

/Marcus Eriksson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/abee8828/attachment.htm 

From matthew at lshift.net  Mon Feb  8 12:24:45 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 8 Feb 2010 12:24:45 +0000
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
 connection on high-latency networks
In-Reply-To: <pan.2010.02.06.03.32.35.788000@googlemail.com>
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.01.30.21.38.58.153375@googlemail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
	<20100201133316.GQ11819@mrnibble.lshift.net>
	<pan.2010.02.01.13.59.14.948750@googlemail.com>
	<20100201145037.GU11819@mrnibble.lshift.net>
	<4B681C00.10408@lshift.net>
	<pan.2010.02.02.17.26.54.249500@googlemail.com>
	<20100205165950.GA24129@mrnibble.lshift.net>
	<pan.2010.02.06.03.32.35.788000@googlemail.com>
Message-ID: <20100208122445.GB14470@mrnibble.lshift.net>

On Sat, Feb 06, 2010 at 04:32:35AM +0100, Holger Hoffstaette wrote:
> This rabbit hole goes deep..

Indeed it does. I repeated all my tests this morning with the buffers
all hard set to 65536 and things got slightly better with large
messages (~1kB), but worse with small messages.

I then set up a high latency loopback:
# tc qdisc add dev lo root netem delay 100ms 20ms distribution pareto loss 0.01%

So a 100ms delay, ?20ms on a pareto distribution, with 0.01% packet
loss.

With our default buffer sizes:
rabbitmq-java-client/build/dist$ sh runjava.sh com/rabbitmq/examples/MulticastMain -a -z 60 -i 10 -s 1024 -r 12000
starting consumer #0
starting producer #0
recving rate: 8 msg/s, min/avg/max latency: 207432/3279948/6437079 microseconds
sending rate: 322 msg/s
recving rate: 13 msg/s, min/avg/max latency: 6437120/11372211/16522991 microseconds
sending rate: 14 msg/s
recving rate: 14 msg/s, min/avg/max latency: 16522969/21456014/26551356 microseconds
sending rate: 13 msg/s
recving rate: 13 msg/s, min/avg/max latency: 26551374/31650558/36685934 microseconds
sending rate: 13 msg/s
recving rate: 13 msg/s, min/avg/max latency: 36687449/41818269/46842999 microseconds
sending rate: 13 msg/s
recving rate: 13 msg/s, min/avg/max latency: 46851173/51931717/56934090 microseconds
recving rate avg: 13 msg/s
sending rate avg: 67 msg/s

With buffers set to 65536 and 65536:
recving rate: 180 msg/s, min/avg/max latency: 220489/3300700/6318430 microseconds
sending rate: 648 msg/s
recving rate: 286 msg/s, min/avg/max latency: 6318355/10433052/12858930 microseconds
sending rate: 256 msg/s
recving rate: 264 msg/s, min/avg/max latency: 12676703/13635080/14137168 microseconds
sending rate: 294 msg/s
recving rate: 282 msg/s, min/avg/max latency: 12437468/13308885/14238964 microseconds
sending rate: 275 msg/s
recving rate: 272 msg/s, min/avg/max latency: 12971076/13367869/13966905 microseconds
sending rate: 262 msg/s
recving rate: 251 msg/s, min/avg/max latency: 13644724/14051244/14746586 microseconds
recving rate avg: 265 msg/s
sending rate avg: 332 msg/s

With no buffers set (thus allowing auto resizing to take place):
recving rate: 1012 msg/s, min/avg/max latency: 196813/2498703/3712777 microseconds
sending rate: 6146 msg/s
recving rate: 6104 msg/s, min/avg/max latency: 2782802/4983136/5602666 microseconds
sending rate: 10466 msg/s
recving rate: 9649 msg/s, min/avg/max latency: 5440633/5971475/6431049 microseconds
sending rate: 10637 msg/s
recving rate: 9970 msg/s, min/avg/max latency: 6204889/6718248/7106264 microseconds
sending rate: 6681 msg/s
recving rate: 9535 msg/s, min/avg/max latency: 3934919/4661861/7229773 microseconds
sending rate: 10795 msg/s
recving rate: 8960 msg/s, min/avg/max latency: 4055794/4703495/5892391 microseconds
recving rate avg: 7755 msg/s
sending rate avg: 9121 msg/s

Needless to say, my flabber has been ghasted. Many thanks for bringing
this issue to our attention. Unless there are further revelations, it's
very likely we'll remove this setting in the next release.

Matthew



From peter.fitzgibbons at gmail.com  Mon Feb  8 12:29:45 2010
From: peter.fitzgibbons at gmail.com (Peter Fitzgibbons)
Date: Mon, 8 Feb 2010 06:29:45 -0600
Subject: [rabbitmq-discuss] Fwd: Client-connection failover workarounds
	(ruby)
In-Reply-To: <4B6DB80B.6040908@lshift.net>
References: <1665d41e-b998-4d73-a17c-d8da649375b4@19g2000yql.googlegroups.com>
	<670a00381002030421w53fce458k21c1b0a5df8cb2ce@mail.gmail.com>
	<4B6DB80B.6040908@lshift.net>
Message-ID: <670a00381002080429y2a5c6b71qae7f1a983193cbfd@mail.gmail.com>

HI Matthias,

Could you direct me to an example of how to set up a "stand alone" shovel?
The only example[1] i found is demonstrating an embedded shovel as rabbitmq
plugin.  This seems to be my degenerate case all over again.  No?

[1]
http://hopper.squarespace.com/blog/2008/6/22/introducing-shovel-an-amqp-relay.html

Peter Fitzgibbons
(847) 859-9550
Email: peter.fitzgibbons at gmail.com
IM GTalk: peter.fitzgibbons
IM AOL: peter.fitzgibbons at gmail.com


On Sat, Feb 6, 2010 at 12:42 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Peter,
>
> Peter Fitzgibbons wrote:
>
>> I'm thinking about how to handle client-connection failover.  By this
>> I mean clientA has a producerP that needs to have reliable and
>> tolerant connections to rabbitA and rabbitB.  This is so that if the
>> connection/pid of rabbitA goes down, producerP sends it's next message
>> to rabbitB with as little handling (and wall-clock time) as possible.
>> [...]
>>
>> The best solution I can think of right now is to have a rabbitP on the
>> same machine as producerP, which is clustered to the "real" cluster,
>> so if rabbitA goes down, the built-in clustering failover will handle
>> the proper interaction.  My issue with this is considering how this is
>> configured and maintained when the farm of servers with producerP gets
>> to be 1000+.  Even if this doesn't scale to the google-farm level,
>> what about farm = 10, 30 ?
>>
>
> Having a local broker is indeed a common approach to get higher resilience,
> particularly since it allows producers to offload messages even when the
> connection to the main brokers is down for prolonged periods of time, e.g.
> in the event the main brokers are across a WAN and there is a WAN failure.
>
> As you suspect, making all these brokers part of a cluster would indeed be
> problematic for high node counts, even more so when going across a WAN.
> Besides, RabbitMQ's clustering is really designed for scaling, not improved
> reliability.
>
> But you do not need to cluster the brokers. Instead you could stick our
> experimental shovel (see
> http://www.lshift.net/blog/2010/02/01/rabbitmq-shovel-message-relocation-equipment)
> onto each local node and configure it to shovel messages to the main broker
> pair. The shovel has built-in re-connection and failover logic for that.
>
> Of course having a local broker is no panacea for reliability, since that
> broker itself becomes a point of failure. Whether that is a problem depends
> on how high you place the reliability bar.
>
> An alternative approachh is to make the clients themselves deal with
> re-connection and failover. Check out the experimental
> http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/ and
> http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/ libraries which do
> that for a specific type of messaging (point-to-point, though most of the
> logic should be easily ported to other types).
>
>
> Regards,
>
> Matthias
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/341412d8/attachment.htm 

From matthew at lshift.net  Mon Feb  8 12:42:06 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 8 Feb 2010 12:42:06 +0000
Subject: [rabbitmq-discuss] Fwd: Client-connection failover workarounds
 (ruby)
In-Reply-To: <670a00381002080429y2a5c6b71qae7f1a983193cbfd@mail.gmail.com>
References: <1665d41e-b998-4d73-a17c-d8da649375b4@19g2000yql.googlegroups.com>
	<670a00381002030421w53fce458k21c1b0a5df8cb2ce@mail.gmail.com>
	<4B6DB80B.6040908@lshift.net>
	<670a00381002080429y2a5c6b71qae7f1a983193cbfd@mail.gmail.com>
Message-ID: <20100208124206.GA12002@mrnibble.lshift.net>

Hi Peter,

On Mon, Feb 08, 2010 at 06:29:45AM -0600, Peter Fitzgibbons wrote:
> Could you direct me to an example of how to set up a "stand alone" shovel?

The shovel does not run stand-alone - it is a plugin. The old shovel
that you found at [1] is very old, unsupported and deprecated. The new
shovel that Matthias linked to is the "way forward" ;)

> The only example[1] i found is demonstrating an embedded shovel as rabbitmq
> plugin.  This seems to be my degenerate case all over again.  No?

Nope. To use your terminology, if you have rabbitP, which is local to
producerP, then you then have the option to run the shovel inside
rabbitP. This is configured to know about rabbitA, rabbitB? and so if
any of those rabbits go down, the shovel will automatically try to
reconnect, trying all the rabbits it knows about until it finds one that
works. Whilst the shovel is trying to find a rabbit to connect to,
messages queue up inside rabbitP, from producerP, in the normal way -
the interruption is totally invisible to producerP.

> [1]
> http://hopper.squarespace.com/blog/2008/6/22/introducing-shovel-an-amqp-relay.html

Matthew



From johndapps at gmail.com  Mon Feb  8 13:10:05 2010
From: johndapps at gmail.com (John Apps)
Date: Mon, 8 Feb 2010 14:10:05 +0100
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
	connection on high-latency networks
In-Reply-To: <20100208122445.GB14470@mrnibble.lshift.net>
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
	<pan.2010.02.01.13.23.37.24000@googlemail.com>
	<20100201133316.GQ11819@mrnibble.lshift.net>
	<pan.2010.02.01.13.59.14.948750@googlemail.com>
	<20100201145037.GU11819@mrnibble.lshift.net>
	<4B681C00.10408@lshift.net>
	<pan.2010.02.02.17.26.54.249500@googlemail.com>
	<20100205165950.GA24129@mrnibble.lshift.net>
	<pan.2010.02.06.03.32.35.788000@googlemail.com>
	<20100208122445.GB14470@mrnibble.lshift.net>
Message-ID: <173a1edc1002080510t122e2fe8u1bc266c1517ac55e@mail.gmail.com>

Fascinating...not sure if the subject has been beaten to death yet, but, my
results are somewhat different.

The following are on Windows 7 X64:
------------------------------------------------------------------------------------------------------------------------------------------
Fixed send and receive buffers at 65535:

c:\AMQP\RabbitMQ\rabbitmq-java-client-1.7.1\test\src>java -server
com.rabbitmq.e
xamples.MulticastMain -hlocalhost -p5672 -a -z 60 -i 10 -s 1024 -r 12000
starting consumer #0
starting producer #0
recving rate: 4095 msg/s, min/avg/max latency: 449/489755/1646688
microseconds
sending rate: 4849 msg/s
recving rate: 5395 msg/s, min/avg/max latency: 1566/374119/1485288
microseconds
sending rate: 5226 msg/s
recving rate: 4620 msg/s, min/avg/max latency: 785/299498/1330197
microseconds
sending rate: 5176 msg/s
recving rate: 5137 msg/s, min/avg/max latency: 918/381703/1385686
microseconds
sending rate: 5357 msg/s
recving rate: 5873 msg/s, min/avg/max latency: 379/445433/1677491
microseconds
sending rate: 5192 msg/s
recving rate: 5274 msg/s, min/avg/max latency: 426/244059/1061180
microseconds
recving rate avg: 5193 msg/s
sending rate avg: 5211 msg/s
------------------------------------------------------------------------------------------------------------------------------------------
This is with no buffers specified on the same machine:

c:\AMQP\RabbitMQ\rabbitmq-java-client-1.7.1\test\src>java -server
com.rabbitmq.e
xamples.MulticastMain -hlocalhost -p5672 -a -z 60 -i 10 -s 1024 -r 12000
starting consumer #0
starting producer #0
recving rate: 3302 msg/s, min/avg/max latency: 6666/493540/1274826
microseconds
sending rate: 3461 msg/s
recving rate: 3696 msg/s, min/avg/max latency: 6462/270603/1022742
microseconds
sending rate: 3688 msg/s
recving rate: 3684 msg/s, min/avg/max latency: 707/903615/2256495
microseconds
sending rate: 3836 msg/s
recving rate: 3923 msg/s, min/avg/max latency: 801/387877/1060920
microseconds
sending rate: 4052 msg/s
recving rate: 3594 msg/s, min/avg/max latency: 2566/253710/1099121
microseconds
sending rate: 3473 msg/s
recving rate: 3900 msg/s, min/avg/max latency: 2045/308265/658904
microseconds
recving rate avg: 3708 msg/s
sending rate avg: 3715 msg/s

------------------------------------------------------------------------------------------------------------------------------------------
On Mon, Feb 8, 2010 at 13:24, Matthew Sackman <matthew at lshift.net> wrote:

> On Sat, Feb 06, 2010 at 04:32:35AM +0100, Holger Hoffstaette wrote:
> > This rabbit hole goes deep..
>
> Indeed it does. I repeated all my tests this morning with the buffers
> all hard set to 65536 and things got slightly better with large
> messages (~1kB), but worse with small messages.
>
> I then set up a high latency loopback:
> # tc qdisc add dev lo root netem delay 100ms 20ms distribution pareto loss
> 0.01%
>
> So a 100ms delay, ?20ms on a pareto distribution, with 0.01% packet
> loss.
>
> With our default buffer sizes:
> rabbitmq-java-client/build/dist$ sh runjava.sh
> com/rabbitmq/examples/MulticastMain -a -z 60 -i 10 -s 1024 -r 12000
> starting consumer #0
> starting producer #0
> recving rate: 8 msg/s, min/avg/max latency: 207432/3279948/6437079
> microseconds
> sending rate: 322 msg/s
> recving rate: 13 msg/s, min/avg/max latency: 6437120/11372211/16522991
> microseconds
> sending rate: 14 msg/s
> recving rate: 14 msg/s, min/avg/max latency: 16522969/21456014/26551356
> microseconds
> sending rate: 13 msg/s
> recving rate: 13 msg/s, min/avg/max latency: 26551374/31650558/36685934
> microseconds
> sending rate: 13 msg/s
> recving rate: 13 msg/s, min/avg/max latency: 36687449/41818269/46842999
> microseconds
> sending rate: 13 msg/s
> recving rate: 13 msg/s, min/avg/max latency: 46851173/51931717/56934090
> microseconds
> recving rate avg: 13 msg/s
> sending rate avg: 67 msg/s
>
> With buffers set to 65536 and 65536:
> recving rate: 180 msg/s, min/avg/max latency: 220489/3300700/6318430
> microseconds
> sending rate: 648 msg/s
> recving rate: 286 msg/s, min/avg/max latency: 6318355/10433052/12858930
> microseconds
> sending rate: 256 msg/s
> recving rate: 264 msg/s, min/avg/max latency: 12676703/13635080/14137168
> microseconds
> sending rate: 294 msg/s
> recving rate: 282 msg/s, min/avg/max latency: 12437468/13308885/14238964
> microseconds
> sending rate: 275 msg/s
> recving rate: 272 msg/s, min/avg/max latency: 12971076/13367869/13966905
> microseconds
> sending rate: 262 msg/s
> recving rate: 251 msg/s, min/avg/max latency: 13644724/14051244/14746586
> microseconds
> recving rate avg: 265 msg/s
> sending rate avg: 332 msg/s
>
> With no buffers set (thus allowing auto resizing to take place):
> recving rate: 1012 msg/s, min/avg/max latency: 196813/2498703/3712777
> microseconds
> sending rate: 6146 msg/s
> recving rate: 6104 msg/s, min/avg/max latency: 2782802/4983136/5602666
> microseconds
> sending rate: 10466 msg/s
> recving rate: 9649 msg/s, min/avg/max latency: 5440633/5971475/6431049
> microseconds
> sending rate: 10637 msg/s
> recving rate: 9970 msg/s, min/avg/max latency: 6204889/6718248/7106264
> microseconds
> sending rate: 6681 msg/s
> recving rate: 9535 msg/s, min/avg/max latency: 3934919/4661861/7229773
> microseconds
> sending rate: 10795 msg/s
> recving rate: 8960 msg/s, min/avg/max latency: 4055794/4703495/5892391
> microseconds
> recving rate avg: 7755 msg/s
> sending rate avg: 9121 msg/s
>
> Needless to say, my flabber has been ghasted. Many thanks for bringing
> this issue to our attention. Unless there are further revelations, it's
> very likely we'll remove this setting in the next release.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/1e8e8d6d/attachment.htm 

From seemasbiradar at gmail.com  Mon Feb  8 13:10:47 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Mon, 8 Feb 2010 18:40:47 +0530
Subject: [rabbitmq-discuss] Is it possible to Query the Contents of Exchange
	or Queue in Rabbitmq?
Message-ID: <558967a41002080510n1680e89hea0f21bcc112e94e@mail.gmail.com>

Hi ,

Is it  possible that  at a given time can we Query the Queue or Exchange to
know which message (i.e Messgae content ) is residing in it?


Thanks in advance
Seema
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/51317a85/attachment.htm 

From rajesh.reddy at baml.com  Mon Feb  8 13:38:55 2010
From: rajesh.reddy at baml.com (Reddy, Rajesh (GPT EMEA))
Date: Mon, 08 Feb 2010 13:38:55 +0000
Subject: [rabbitmq-discuss] AMQP Connection gets forcibly closed : .Net
	client
In-Reply-To: <4B5F3059.8060006@lshift.net>
Message-ID: <03FC0D29D4E88943AB7420C524BE8489027C3D81@mllnc20mb056.emea.win.ml.com>

Hi,

We are using the .NET client and the heartbeat is set to 60 sec for the
connection. We are getting the following exception some times and the
client losses the connection.

AMQP Connection closed. Initiator:Peer Reason:CONNECTION_FORCED - broker
forced connection closure with reason 'shutdown'

Could this be because of delay in processing of messages at the
subscriber's end.

Thanks
Rajesh

--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. The information contained in this e-mail was obtained from sources believed to be reliable; however, the accuracy or completeness of this information is not guaranteed. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Past performance is no guarantee of future results. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 



From flatline at stresstiming.de  Mon Feb  8 13:46:33 2010
From: flatline at stresstiming.de (diez)
Date: Mon, 08 Feb 2010 14:46:33 +0100
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <C791B9BD.5B5F%pdezwart@rubiconproject.com>
References: <C791B9BD.5B5F%pdezwart@rubiconproject.com>
Message-ID: <4B7015B9.3060103@stresstiming.de>

Am 05.02.2010 21:04, schrieb Pieter de Zwart:
> Hi everyone,
>
> We are having some issues here with PHP clients. We have the following 
> options:
> Php-amqp (PHP module written in C)
> Php-rabbit (PHP module written in C)
> AMQP (Pure PHP implementation, which is a port of port)
>
> The pure PHP implementation is working for us, but it is too slow to 
> really serve our purposes. As a result, we are looking at the PHP modules.
> After doing some patching thanks to madcoder on Google groups, the 
> php-amqp library works well, but does not have consumer functionality. 
> The php-rabbit module is unfortunately bug ridden.
Am 05.02.2010 21:04, schrieb Pieter de Zwart:
> Hi everyone,
>
> We are having some issues here with PHP clients. We have the following 
> options:
> Php-amqp (PHP module written in C)
> Php-rabbit (PHP module written in C)
> AMQP (Pure PHP implementation, which is a port of port)
>
> The pure PHP implementation is working for us, but it is too slow to 
> really serve our purposes. As a result, we are looking at the PHP modules.
> After doing some patching thanks to madcoder on Google groups, the 
> php-amqp library works well, but does not have consumer functionality. 
> The php-rabbit module is unfortunately bug ridden.
>
> Does anyone have a working php module that contains consumer 
> functionality?
Hi Pieter, hi @all

I lost the track to the answers to your message.
What does it mean, "it lacks the consumer functionality" ?

Did You find a solution for the php-client?
Can you provide a link to the patched PHP module from madcoder?
Can I use it in production?

It would be cool if you can tell us (me) which bugs you ran into, so we 
could propably help to fix some of them and get a working library.

We tried using the Pure PHP-AMQP Library and we also discovered that's 
too slow for our scenario.

Greetings,

Dieter


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/fe9d714d/attachment.htm 

From mail at sebastian-latza.de  Mon Feb  8 15:11:18 2010
From: mail at sebastian-latza.de (Sebastian Latza)
Date: Mon, 8 Feb 2010 16:11:18 +0100
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <C791B9BD.5B5F%pdezwart@rubiconproject.com>
References: <C791B9BD.5B5F%pdezwart@rubiconproject.com>
Message-ID: <E8F48092-EB1E-43AA-9C0F-B72EF50AF3FA@sebastian-latza.de>

Pieter,

Pieter de Zwart wrote:

> Php-amqp (PHP module written in C)

As for sending messages this module is probably the best choice. Consuming is a bit more complicated due to the short-lived nature of PHP scripts within the webserver . However if you want to run some kind of PHP shell daemon in my experience you can achieve the best results using the rabbitmq Stomp gateway in conjunction with the pecl stomp extensions.

Sebastian


From peter.fitzgibbons at gmail.com  Mon Feb  8 15:22:32 2010
From: peter.fitzgibbons at gmail.com (Peter Fitzgibbons)
Date: Mon, 8 Feb 2010 09:22:32 -0600
Subject: [rabbitmq-discuss] Fwd: Client-connection failover workarounds
	(ruby)
In-Reply-To: <20100208124206.GA12002@mrnibble.lshift.net>
References: <1665d41e-b998-4d73-a17c-d8da649375b4@19g2000yql.googlegroups.com>
	<670a00381002030421w53fce458k21c1b0a5df8cb2ce@mail.gmail.com>
	<4B6DB80B.6040908@lshift.net>
	<670a00381002080429y2a5c6b71qae7f1a983193cbfd@mail.gmail.com>
	<20100208124206.GA12002@mrnibble.lshift.net>
Message-ID: <670a00381002080722r17eff34ak885ab3ab172841c7@mail.gmail.com>

On Mon, Feb 8, 2010 at 6:42 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Peter,
>

HI Matthew,

Thanks for joining the thread.


>
> On Mon, Feb 08, 2010 at 06:29:45AM -0600, Peter Fitzgibbons wrote:
> > Could you direct me to an example of how to set up a "stand alone"
> shovel?
>
> The shovel does not run stand-alone - it is a plugin. The old shovel
> that you found at [1] is very old, unsupported and deprecated. The new
> shovel that Matthias linked to is the "way forward" ;)
>
Got it


>
> > The only example[1] i found is demonstrating an embedded shovel as
> rabbitmq
> > plugin.  This seems to be my degenerate case all over again.  No?
>
> Nope. To use your terminology, if you have rabbitP, which is local to
> producerP, then you then have the option to run the shovel inside
> rabbitP. This is configured to know about rabbitA, rabbitB? and so if
> any of those rabbits go down, the shovel will automatically try to
> reconnect, trying all the rabbits it knows about until it finds one that
> works. Whilst the shovel is trying to find a rabbit to connect to,
> messages queue up inside rabbitP, from producerP, in the normal way -
> the interruption is totally invisible to producerP.
>
> How is this different from configuring a rabbit cluster that includes my
"local" node?
Matthias warned me that this is a degenerate case, where the cluster will
struggle to support 10's (100's in a farm) of clustered servers.

To extend my understanding (and offer an opportunity to correct my
understanding),
Shovel is preferred because the local rabbitP is not clustered, does not
have to be "aware" of the cluster, and shovel has the proper failover
routines to handle it when times get tough.

What about consumerA, consumerB, etc?  Are these theoretically expected to
be "protected" from harm?  I think this question is pointing toward my
potential misunderstanding of how consumer push or pull is handled.

Thanks for your time!


Peter Fitzgibbons
(847) 859-9550
Email: peter.fitzgibbons at gmail.com
IM GTalk: peter.fitzgibbons
IM AOL: peter.fitzgibbons at gmail.com




> > [1]
> >
> http://hopper.squarespace.com/blog/2008/6/22/introducing-shovel-an-amqp-relay.html
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/cee65a84/attachment.htm 

From matthew at lshift.net  Mon Feb  8 15:49:07 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 8 Feb 2010 15:49:07 +0000
Subject: [rabbitmq-discuss] Fwd: Client-connection failover workarounds
 (ruby)
In-Reply-To: <670a00381002080722r17eff34ak885ab3ab172841c7@mail.gmail.com>
References: <1665d41e-b998-4d73-a17c-d8da649375b4@19g2000yql.googlegroups.com>
	<670a00381002030421w53fce458k21c1b0a5df8cb2ce@mail.gmail.com>
	<4B6DB80B.6040908@lshift.net>
	<670a00381002080429y2a5c6b71qae7f1a983193cbfd@mail.gmail.com>
	<20100208124206.GA12002@mrnibble.lshift.net>
	<670a00381002080722r17eff34ak885ab3ab172841c7@mail.gmail.com>
Message-ID: <20100208154906.GE12002@mrnibble.lshift.net>

On Mon, Feb 08, 2010 at 09:22:32AM -0600, Peter Fitzgibbons wrote:
> > Nope. To use your terminology, if you have rabbitP, which is local to
> > producerP, then you then have the option to run the shovel inside
> > rabbitP. This is configured to know about rabbitA, rabbitB? and so if
> > any of those rabbits go down, the shovel will automatically try to
> > reconnect, trying all the rabbits it knows about until it finds one that
> > works. Whilst the shovel is trying to find a rabbit to connect to,
> > messages queue up inside rabbitP, from producerP, in the normal way -
> > the interruption is totally invisible to producerP.
> >
> > How is this different from configuring a rabbit cluster that includes my
> "local" node?
> Matthias warned me that this is a degenerate case, where the cluster will
> struggle to support 10's (100's in a farm) of clustered servers.

Clustering Rabbit achieves scalability, not reliability. With a cluster,
queues are not replicated, whilst the meta data associated with queues,
exchanges and bindings are shared across all nodes of the cluster.

It's rather tricky, at the moment, to do any sort of high availability,
active/passive fail-over type stuff with clusters.

> To extend my understanding (and offer an opportunity to correct my
> understanding),
> Shovel is preferred because the local rabbitP is not clustered, does not
> have to be "aware" of the cluster, and shovel has the proper failover
> routines to handle it when times get tough.

Yes. In general, the lower the coupling and higher the independence, the
better, from the pov of resiliance and availability.

> What about consumerA, consumerB, etc?  Are these theoretically expected to
> be "protected" from harm?  I think this question is pointing toward my
> potential misunderstanding of how consumer push or pull is handled.

Err, well, I don't see from your past emails how you think the consumers
are connected in. Again, you could do a local rabbit to each of the
consumers, again with a shovel, if you wanted to. Or wire the consumers
themselves with knowledge of which central servers you have to connect
to. Or stick a TCP load balancer between the consumers and the central
servers. It all depends on how you provision the central servers - if
it's known that a certain messages will be sent to a particular server
(or set of servers, given an HA setup) then it's sufficient to wire the
consumers to continually try to connect to those servers. If you need more
dynamic control over where the consumers connect to to find the messages
they're interested in, then dynamic DNS, or a TCP load balancer, or even
things like IP or MAC -address stealing may be more appropriate.

Matthew



From pdezwart at rubiconproject.com  Mon Feb  8 16:27:42 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 8 Feb 2010 11:27:42 -0500
Subject: [rabbitmq-discuss] PHP Client libraries
Message-ID: <7C1046148D91C244A98F4C146735886701BA2C5F@BE43.exg3.exghost.com>

Hey Dieter,

1) The php-amqp library does not have any "consume" method, and as far as I could tell, nothing else that could serve as a replacement. The publishing side was fast, but without the ability to read from the queue, it was useless to us. I did some reconnaissance to determine how much work it would take to port something over but my C was far too rusty to write something that worked in production.
2) The "php-rabbit is bug ridden" statement stemmed from the typos (AQPM instead of AMQP) and the fact that the module would not load due to an improper DEFINE. If the owner hadn't compiled it and tested it, I felt safe in assuming there were more issues down the road.

After Alexandre asked me for some demos, I went back and tried to generate a sample script detailing the bug I was encountering (all exchanges were being declared and 'direct' and I couldn't publish). After plodding through the code and fixing the fucntion signatures and improper dereferencing, I think I have something that works, but I haven't had a chance to fully vet it (Super Bowl.) Let me see if I can't get it working, and I will keep the list informed of my progress.

Pieter



________________________________

From: rabbitmq-discuss-bounces at lists.rabbitmq.com <rabbitmq-discuss-bounces at lists.rabbitmq.com> 
To: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Mon Feb 08 08:46:33 2010
Subject: Re: [rabbitmq-discuss] PHP Client libraries 


Am 05.02.2010 21:04, schrieb Pieter de Zwart: 

	Hi everyone,
	
	We are having some issues here with PHP clients. We have the following options:
	Php-amqp (PHP module written in C)
	Php-rabbit (PHP module written in C)
	AMQP (Pure PHP implementation, which is a port of port)
	
	The pure PHP implementation is working for us, but it is too slow to really serve our purposes. As a result, we are looking at the PHP modules.
	After doing some patching thanks to madcoder on Google groups, the php-amqp library works well, but does not have consumer functionality. The php-rabbit module is unfortunately bug ridden.
	

Am 05.02.2010 21:04, schrieb Pieter de Zwart: 

	Hi everyone,
	
	We are having some issues here with PHP clients. We have the following options:
	Php-amqp (PHP module written in C)
	Php-rabbit (PHP module written in C)
	AMQP (Pure PHP implementation, which is a port of port)
	
	The pure PHP implementation is working for us, but it is too slow to really serve our purposes. As a result, we are looking at the PHP modules.
	After doing some patching thanks to madcoder on Google groups, the php-amqp library works well, but does not have consumer functionality. The php-rabbit module is unfortunately bug ridden.
	
	Does anyone have a working php module that contains consumer functionality?
	

Hi Pieter, hi @all

I lost the track to the answers to your message. 
What does it mean, "it lacks the consumer functionality" ?

Did You find a solution for the php-client? 
Can you provide a link to the patched PHP module from madcoder? 
Can I use it in production?

It would be cool if you can tell us (me) which bugs you ran into, so we could propably help to fix some of them and get a working library.

We tried using the Pure PHP-AMQP Library and we also discovered that's too slow for our scenario.

Greetings,

Dieter



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/ae5ea8f7/attachment.htm 

From groundduckleg at gmail.com  Mon Feb  8 18:04:11 2010
From: groundduckleg at gmail.com (Bob Brown)
Date: Mon, 8 Feb 2010 12:04:11 -0600
Subject: [rabbitmq-discuss] Subscriber Message Received event?
Message-ID: <97229E0D147446BD9545C5F0AA02606B@matdev40b>


 
Good Afternoon,

We are using C# and Rabbit MQ and will be using Pub Sub. Is there an "onMessageReceived" event that will fire once a message is received? Currently we are having to use a background worker thread that runs and checks if there are any messages in the queue. But a messageReceived event would be more ideal. Thanks for any input!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/57a1348e/attachment.htm 

From matthias at lshift.net  Mon Feb  8 18:10:29 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Feb 2010 18:10:29 +0000
Subject: [rabbitmq-discuss] Subscriber Message Received event?
In-Reply-To: <97229E0D147446BD9545C5F0AA02606B@matdev40b>
References: <97229E0D147446BD9545C5F0AA02606B@matdev40b>
Message-ID: <4B705395.9030401@lshift.net>

Bob,

Bob Brown wrote:
> We are using C# and Rabbit MQ and will be using Pub Sub. Is there an 
> "onMessageReceived" event that will fire once a message is received? 
> Currently we are having to use a background worker thread that runs and 
> checks if there are any messages in the queue. But a messageReceived 
> event would be more ideal. Thanks for any input!

There isn't a C# event, but there is a callback HandleBasicDeliver 
method on IBasicConsumer that serves the same purpose. See 
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.7.1/rabbitmq-dotnet-client-1.7.1-client-htmldoc/html/type-RabbitMQ.Client.IBasicConsumer.html#method-M:RabbitMQ.Client.IBasicConsumer.HandleBasicDeliver%28System.String,System.UInt64,System.Boolean,System.String,System.String,RabbitMQ.Client.IBasicProperties,System.Byte[]%29 



Regards,

Matthias.



From groundduckleg at gmail.com  Mon Feb  8 19:09:11 2010
From: groundduckleg at gmail.com (Bob Brown)
Date: Mon, 8 Feb 2010 13:09:11 -0600
Subject: [rabbitmq-discuss] Subscriber Message Received event?
In-Reply-To: <4B705395.9030401@lshift.net>
References: <97229E0D147446BD9545C5F0AA02606B@matdev40b>
	<4B705395.9030401@lshift.net>
Message-ID: <18DFDD0E8D354E1F8EA29E0E176D8F1E@matdev40b>

Thanks Matthias!

Do you have any actual implementation code examples of the best way to 
implement this?

Also, I am assuming that my subscriber will have to implement 
IBasicConsumer...how should I handle the other methods on the interface?

Thanks again!

--------------------------------------------------
From: "Matthias Radestock" <matthias at lshift.net>
Sent: Monday, February 08, 2010 12:10 PM
To: "Bob Brown" <groundduckleg at gmail.com>
Cc: <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Subscriber Message Received event?

> Bob,
>
> Bob Brown wrote:
>> We are using C# and Rabbit MQ and will be using Pub Sub. Is there an 
>> "onMessageReceived" event that will fire once a message is received? 
>> Currently we are having to use a background worker thread that runs and 
>> checks if there are any messages in the queue. But a messageReceived 
>> event would be more ideal. Thanks for any input!
>
> There isn't a C# event, but there is a callback HandleBasicDeliver method 
> on IBasicConsumer that serves the same purpose. See 
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.7.1/rabbitmq-dotnet-client-1.7.1-client-htmldoc/html/type-RabbitMQ.Client.IBasicConsumer.html#method-M:RabbitMQ.Client.IBasicConsumer.HandleBasicDeliver%28System.String,System.UInt64,System.Boolean,System.String,System.String,RabbitMQ.Client.IBasicProperties,System.Byte[]%29
>
>
> Regards,
>
> Matthias.
> 



From matthias at lshift.net  Mon Feb  8 19:28:54 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Feb 2010 19:28:54 +0000
Subject: [rabbitmq-discuss] Subscriber Message Received event?
In-Reply-To: <18DFDD0E8D354E1F8EA29E0E176D8F1E@matdev40b>
References: <97229E0D147446BD9545C5F0AA02606B@matdev40b>
	<4B705395.9030401@lshift.net>
	<18DFDD0E8D354E1F8EA29E0E176D8F1E@matdev40b>
Message-ID: <4B7065F6.2010907@lshift.net>

Bob,

Bob Brown wrote:
> Do you have any actual implementation code examples of the best way to 
> implement this?

Check out the LowlevelLogTail example.

> Also, I am assuming that my subscriber will have to implement 
> IBasicConsumer...how should I handle the other methods on the interface?

You'd sub-class DefaultBasicConsumer, which contains sensible defaults 
for the other methods.

Btw, have you read the .net client library user guide 
(http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.7.1/rabbitmq-dotnet-client-1.7.1-user-guide.pdf)? 
In section 2.8. ("Retrieving messages by subscription") it explains the 
above.

It also turns out that there is in fact some experimental support for 
receiving messages as events. See 
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.7.1/rabbitmq-dotnet-client-1.7.1-client-htmldoc/html/type-RabbitMQ.Client.Events.EventingBasicConsumer.html


Regards,

Matthias.



From splisson at veodia.com  Mon Feb  8 19:33:05 2010
From: splisson at veodia.com (Sebastien Plisson)
Date: Mon, 8 Feb 2010 11:33:05 -0800
Subject: [rabbitmq-discuss] Connection issue
In-Reply-To: <4B6DC965.1040806@lshift.net>
Message-ID: <C795A6F1.9F51%splisson@veodia.com>

Hi,

It was indeed a client problem, a properties file not deployed.

Problem solved.

Sebastien


On 2/6/10 11:56 AM, "Matthias Radestock" <matthias at lshift.net> wrote:

Sebastien,

Sebastien Plisson wrote:
> When my client tries to connect to rabbitmq server this one closes the
> connection,
> The rabbit.log says:
> =INFO REPORT==== 4-Feb-2010::21:53:47 ===
> starting TCP connection <0.9904.0> from 174.129.177.175:46805
>
> =ERROR REPORT==== 4-Feb-2010::21:53:57 ===
> exception on TCP connection <0.9904.0> from 174.129.177.175:46805
> {handshake_timeout,frame_header}
>
> =INFO REPORT==== 4-Feb-2010::21:53:57 ===
> closing TCP connection <0.9904.0> from 174.129.177.175:46805
>
> I can't figure out what's wrong with my setup.

The most likely explanation for the above log trace is that the client
is establishing a tcp connection to the server but is then not sending
the required AMQP protocol header. So eventually (after 10 seconds) the
server closes the connection.

What client are you using?

You may want to use a tool like wireshark to sniff the traffic.


Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100208/fd58b67c/attachment.htm 

From matthias at lshift.net  Mon Feb  8 20:53:12 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Feb 2010 20:53:12 +0000
Subject: [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)
 writing to queue
In-Reply-To: <ebcef6281002072354h2d53613bj3c4041b8b8cf9259@mail.gmail.com>
References: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>	
	<ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>	
	<4B6DCEB4.4050309@lshift.net>	
	<ebcef6281002070333x11c756bfq3d033093ce522fef@mail.gmail.com>
	<ebcef6281002072354h2d53613bj3c4041b8b8cf9259@mail.gmail.com>
Message-ID: <4B7079B8.1030409@lshift.net>

Sigurd,

Sigurd H?gsbro wrote:
> =WARNING REPORT==== 7-Feb-2010::09:56:35 ===
> exception on TCP connection <0.835.5> from 127.0.0.1:47539
> connection_closed_abruptly

That indicates that the client closed the connection. Or the network died.

> I used to have immediate and mandatory flags set but I've removed
> these to make the connection as plain vanilla as possible.

With these flags set the server may send 'basic.return' commands to the 
client. Perhaps amqplib doesn't handle these and dies?

> I injected the java Tracer into the path, and spotted a Connection.tune 
> method with interesting parameters:

> 1265609050961: conn#0 ch#0 <- 
> {#method<connection.tune>(channel-max=0,frame-max=131072,heartbeat=0),null,""}
> 1265609051002: conn#0 ch#0 -> 
> {#method<connection.tune-ok>(channel-max=65535,frame-max=131072,heartbeat=0),null,""}

> This led me to the discussion 
> on http://www.amqp.org/jira/browse/AMQP-108, suggesting that there is an 
> upper limit on AMQP payload of a 16-bit number in versions 0.8/0.9. 

That discussion pertains to 0-10 work in progress at the time. In AMQP 
0-8/9/9-1 the frame size is encoded in a 32 bit field and the frame-max 
field in connection.tune/tune-ok is 32 bit wide too. So the above values 
are perfectly fine.

Also note that the frame size does not limit the message size, since 
messages can be split across multiple frames. All our supported client 
libraries do that automatically but it's possible that amqplib doesn't.

> I'll try patching py-amqplib to take frame-max in kwargs, but any other 
> gotchas you can think of would be appreciated?

Try to get a trace that includes the connection disappearance. The 
pattern of commands just prior to that might shed some light on what 
causes the client to trip up.

> Would I be better off trying Tony's PIKA?

Feel free to give it a try, but since we do not know what the problem is 
there is no way to tell in advance whether it will fare any better.


Regards,

Matthias.



From matthias at lshift.net  Mon Feb  8 21:01:32 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Feb 2010 21:01:32 +0000
Subject: [rabbitmq-discuss] connecting to multiple rabbitmq servers
	(point-multipoint)
In-Reply-To: <6d0427481002080258o41775779y92dec37d8930da96@mail.gmail.com>
References: <6d0427481002050731u2e88d22o2963d055c290950d@mail.gmail.com>	
	<4B6DE150.3060201@lshift.net>
	<6d0427481002080258o41775779y92dec37d8930da96@mail.gmail.com>
Message-ID: <4B707BAC.30202@lshift.net>

Guillem,

Guillem Corominas wrote:
> Yesterday I noticed that when the consumer stops receiving messages, the 
> rabbitmqctl list_connections shows that the connection no longer exists. 
> However in the Java Client, the Connection object and it's associated 
> Channel objects don't seem to notice about that. I tried logging it's 
> status by printing if either the Connection or the Channel is null, or 
> if any of those isOpen(), but they says they are both open. The client 
> doesn't seem to notice that the connection is down.

What you are seeing is not uncommon in TCP/IP networks - it can take a 
while (minutes, sometimes hours) for both sides of a dead connection to 
realise the connection is down.

> How can I ask the client about the connection in order to realize that 
> it's eventually down and it needs to be reconnected?

AMQP contains a mechanism to deal with the above situation: heartbeats. 
By default they are turned off but can be enabled by the client during 
connection establishment. See
http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.7.1/rabbitmq-java-client-javadoc-1.7.1/http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.7.1/rabbitmq-java-client-javadoc-1.7.1/com/rabbitmq/client/ConnectionParameters.html#setRequestedHeartbeat(int)


Regards,

Matthias.



From matthias at lshift.net  Mon Feb  8 21:11:51 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Feb 2010 21:11:51 +0000
Subject: [rabbitmq-discuss] Is it possible to Query the Contents of
 Exchange or Queue in Rabbitmq?
In-Reply-To: <558967a41002080510n1680e89hea0f21bcc112e94e@mail.gmail.com>
References: <558967a41002080510n1680e89hea0f21bcc112e94e@mail.gmail.com>
Message-ID: <4B707E17.90801@lshift.net>

Seema,

Seema Biradar wrote:
> Is it  possible that  at a given time can we Query the Queue or Exchange 
> to know which message (i.e Messgae content ) is residing in it?

This feature is also known as "queue browsing" and is something we are 
thinking about adding to RabbitMQ.

Meanwhile you can do the following:
- establish a new AMQP connection & channel
- drain all the messages from the queue using a consumer or basic.get
- close the channel without ack'ing the messages

The main difference between that and queue browsing is that
- the drained messages are not available to other consumers until the 
last step
- the order of the requeued messages may be different to what it was before


Regards,

Matthias.



From matthias at lshift.net  Mon Feb  8 21:17:41 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Feb 2010 21:17:41 +0000
Subject: [rabbitmq-discuss] AMQP Connection gets forcibly closed : .Net
 client
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C3D81@mllnc20mb056.emea.win.ml.com>
References: <03FC0D29D4E88943AB7420C524BE8489027C3D81@mllnc20mb056.emea.win.ml.com>
Message-ID: <4B707F75.8000909@lshift.net>

Rajesh,


Reddy, Rajesh (GPT EMEA) wrote:
> We are using the .NET client and the heartbeat is set to 60 sec for the
> connection. We are getting the following exception some times and the
> client losses the connection.
> 
> AMQP Connection closed. Initiator:Peer Reason:CONNECTION_FORCED - broker
> forced connection closure with reason 'shutdown'

That message originates at the broker when it performs a controlled 
shutdown. So it should not come as a surprise, unless somebody is 
shutting down your rabbit broker without telling you.


Regards,

Matthias.



From david_sansot at playstation.sony.com  Mon Feb  8 21:48:03 2010
From: david_sansot at playstation.sony.com (david_sansot at playstation.sony.com)
Date: Mon, 08 Feb 2010 13:48:03 -0800
Subject: [rabbitmq-discuss] Running RabbitMQ with Erlware
In-Reply-To: <4B6DCD09.5000204@lshift.net>
References: <4B6B4494.8040007@playstation.sony.com>
	<4B6DCD09.5000204@lshift.net>
Message-ID: <4B708693.4000600@playstation.sony.com>

Thanks for your reply.

On 2/6/2010 12:11 PM, Matthias Radestock wrote:
> David,
>
> david_sansot at playstation.sony.com wrote:
>> We are in the process of updating our versions of rabbitmq and 
>> erlang.  To get the latest erlang on our box we decided to try 
>> erlware (We're running CentOS 5.4 and the latest we can get through 
>> ERPL is R12B).  Installing erl from erlware seemed to work fine 
>> (R13B03).  We installed rabbitmq 1.7.1 from the rpm.
>>
>> When we try to start the server, we get an error that os_mon can not 
>> be started (yes, os_mon is installed):
>>
>>     {"init terminating in
>>     
>> do_boot",{{nocatch,{error,{cannot_start_application,os_mon,{not_started,sasl}}}},[{init,start_it,1},{init,start_em,1}]}} 
>>
>
> os_mon depends on sasl, and the above error indicates that sasl hasn't 
> been started.
>
> All the rabbit startup scripts we ship do start sasl automatically, so 
> it's strange that you see the above. What startup script are you 
> invoking?

/usr/lib64/rabbitmq/bin/rabbitmq-server

>
> > We are able to start os_mon from the erl shell.
>
> Without starting sasl? If I try that I get the following:
>
> $ erl
> Erlang R13B03 (erts-5.7.4) [source] [smp:2:2] [rq:2] [async-threads:0] 
> [hipe] [kernel-poll:false]
>
> Eshell V5.7.4  (abort with ^G)
> 1> application:start(os_mon).
> {error,{not_started,sasl}}
>
> which is exactly the same error as above.
You caught me.  I was told this worked, but I didn't actually try it.  I 
just did try and got the same error you did.

>
> By contrast, when starting erlang with sasl enabled (in the same way 
> our startup scripts do) I get:
>
> $ erl -boot start_sasl
This looks to be the problem.  I don't have a start_sasl.boot file on 
the system.  I assume this should have come from erlware.  I need to 
look into this.  I can start sasl and then os_mon in the shell just fine.

Thanks Again,
David




From akalend at mail.ru  Mon Feb  8 22:45:40 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Tue, 09 Feb 2010 01:45:40 +0300
Subject: [rabbitmq-discuss] =?windows-1251?q?PHP_Client_libraries?=
In-Reply-To: <7C1046148D91C244A98F4C146735886701BA2C5F@BE43.exg3.exghost.com>
References: <7C1046148D91C244A98F4C146735886701BA2C5F@BE43.exg3.exghost.com>
Message-ID: <E1NecMO-000725-00.akalend-mail-ru@f254.mail.ru>


> 2) The "php-rabbit is bug ridden" statement stemmed from the typos (AQPM instead of AMQP) and the fact that the 
module would not load due to an improper DEFINE. If the owner hadn't compiled it and tested it, I felt safe in assuming 
there were more issues down the road.
> 
> After Alexandre asked me for some demos, I went back and tried to generate a sample script detailing the bug I was 
encountering (all exchanges were being declared and 'direct' and I couldn't publish). After plodding through the code and 
fixing the fucntion signatures and improper dereferencing, I think I have something that works, but I haven't had a chance 
to fully vet it (Super Bowl.) Let me see if I can't get it working, and I will keep the list informed of my progress.

the exchange have type direct by default. You can  declare any type for exchange or queue. 

Example:

$msg = "my news in the Spb...";
$cnn = new APMQConection(array ('port'=>5673, 'login' => 'sector1' ));
$exchange = new AMQPExchange($cnn);

$exchange->declare( 'ex_name', 'topic');
$exchange->bind('mylogin','spb.*');
$res = $exchange->publish( $msg, 'spb.news');

//Queue declare
$queue = new AMQPQueue($cnn);  
$queue->declare('chat_12', AMQP_AUTEDELETE | AMQP_DURABLE); 


The more documentation is writing  at time and sometime will on the project page.
I use it on the prodaction and it the work is very well.  I know one bug:  the so modules dont downloaded , but if 
configure with option  --with-rabbit  and compile as static, the compilation is successfull.

If You find any bug, please send email.
Thanks,


Alexandre




From alexis.richardson at gmail.com  Tue Feb  9 01:56:12 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 9 Feb 2010 01:56:12 +0000
Subject: [rabbitmq-discuss] Licensing of librabbitmq
In-Reply-To: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>
References: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>
Message-ID: <167204d21002081756gd65cc8fwed1ec3179f00d958@mail.gmail.com>

Marcus

That sounds great and we would love to help.  Can you tell me what
licenses are used for Drizzle plugins?  Must they all be GPL?

alexis


On Mon, Feb 8, 2010 at 12:03 PM, Marcus Eriksson <krummas at gmail.com> wrote:
> Hi
> I am building a plugin for Drizzle to be able to replicate transactions
> directly to rabbitmq using librabbitmq (http://hg.rabbitmq.com/rabbitmq-c/)
> but there is an issue with the licensing of librabbitmq;
> Drizzle is a fork off mysql and therefor GPL and librabbitmq is MPL. The MPL
> states that it cannot be linked to GPL software
> (http://www.fsf.org/licensing/licenses/index_html#MPL).
> Is there any way round this?
> /Marcus Eriksson
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From chen650 at yahoo.com  Tue Feb  9 03:30:52 2010
From: chen650 at yahoo.com (alex chen)
Date: Mon, 8 Feb 2010 19:30:52 -0800 (PST)
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages from
	multiple queues
Message-ID: <923687.80767.qm@web31814.mail.mud.yahoo.com>

Hi,

We are testing the new persister (bug21637).  It hangs for the following test case:

1) create 5 persistent queues, each queue bind to a different topic.
2) without consumer running, publish 20000 messages to each queue.
each message has size 20KB.
   the list_queues command shows each queue has 20000 messages in it.
3) start 5 consumers.  each consumer consumes messages from one queue.
  after consuming some messages, broker hangs (not responding to list_queues).


this bug happens when publisher does not use tx_commit.
if publisher calls tx_commit for each message, then there is no problem.
if publisher calls tx_select, then basic_publish 100 messages, then tx_commit, the broker may also hang.

Is this a known problem or i am missing something?
thanks.

-alex


      



From seemasbiradar at gmail.com  Tue Feb  9 05:35:49 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Tue, 9 Feb 2010 11:05:49 +0530
Subject: [rabbitmq-discuss] How can we increase the memory size of rabbitmq
	server?
Message-ID: <558967a41002082135kd6cda00i1d807d191ac579fc@mail.gmail.com>

Hi,

Using Rabbitmq , we trying to send huge data .
While running the program I got the following error.

*broker running
Erlang has closed

Crash dump was written to: erl_crash.dump
binary_alloc: Cannot allocate 218590962 bytes of memory (of type "binary").
Aborted*
**
**
*Please let us know how to increase the size of memory allocation for
Rabbitmq?*
**
*thanks*
*Seema*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/bfdf7a45/attachment.htm 

From sigurd.hogsbro at museeka.com  Tue Feb  9 05:41:26 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Tue, 9 Feb 2010 05:41:26 +0000
Subject: [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)
	writing to queue
In-Reply-To: <4B7079B8.1030409@lshift.net>
References: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>
	<ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>
	<4B6DCEB4.4050309@lshift.net>
	<ebcef6281002070333x11c756bfq3d033093ce522fef@mail.gmail.com>
	<ebcef6281002072354h2d53613bj3c4041b8b8cf9259@mail.gmail.com>
	<4B7079B8.1030409@lshift.net>
Message-ID: <ebcef6281002082141k23ab03b1nbafbcd18995eadc9@mail.gmail.com>

Matthias,

2010/2/8 Matthias Radestock <matthias at lshift.net>

> That indicates that the client closed the connection. Or the network died.

Yep; I also reached that conclusion.

>
>  I used to have immediate and mandatory flags set but I've removed
>> these to make the connection as plain vanilla as possible.
>>
>
> With these flags set the server may send 'basic.return' commands to the
> client. Perhaps amqplib doesn't handle these and dies?


As the problem manifests itself with a plain connection this is not likely
to be the cause.

>
> Also note that the frame size does not limit the message size, since
> messages can be split across multiple frames. All our supported client
> libraries do that automatically but it's possible that amqplib doesn't.


I've found out that pika takes the min() of the server-mandated framesize
(128k) and the one I specified in the ConnectionParameters() meaning that I
cannot set a larger frame-size.

>From reviewing the pika & amqplib code it seems that:
- pika takes the header/footer sizes into account when computing the
frame-max to use
- pika actually writes in frame-max blocks, which I don't believe amqplib
does. Not sure yet whether this could cause the issue observed.

When I finish translating my threaded amqplib app into pika using asyncore I
hope to find that it solves the problem.

>
>> Try to get a trace that includes the connection disappearance. The pattern
> of commands just prior to that might shed some light on what causes the
> client to trip up.


Tracer writes the full message-body to stdout which isn't helpful when
sending multi-megabyte bodies. I'll try using wireshark for diagnostics
instead.

>
> Feel free to give it a try, but since we do not know what the problem is
> there is no way to tell in advance whether it will fare any better.
>
> I like the design principles of pika, but the example of demo_relay.py is a
little hard going. Can you point me at any other real-world examples of
asyncore-based connection handling? And what is the recommended way to
detect/handle connection-failure?

Regards,

Sigurd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/b2d9bd9c/attachment.htm 

From krummas at gmail.com  Tue Feb  9 08:24:02 2010
From: krummas at gmail.com (Marcus Eriksson)
Date: Tue, 9 Feb 2010 09:24:02 +0100
Subject: [rabbitmq-discuss] Licensing of librabbitmq
In-Reply-To: <167204d21002081756gd65cc8fwed1ec3179f00d958@mail.gmail.com>
References: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>
	<167204d21002081756gd65cc8fwed1ec3179f00d958@mail.gmail.com>
Message-ID: <7ab768b11002090024l475168abr6d844d898f259b97@mail.gmail.com>

Hi

No, I dont think they have to be GPL. Is, for example, BSD licensing my
plugin a solution to this problem?

/Marcus

On Tue, Feb 9, 2010 at 2:56 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Marcus
>
> That sounds great and we would love to help.  Can you tell me what
> licenses are used for Drizzle plugins?  Must they all be GPL?
>
> alexis
>
>
> On Mon, Feb 8, 2010 at 12:03 PM, Marcus Eriksson <krummas at gmail.com>
> wrote:
> > Hi
> > I am building a plugin for Drizzle to be able to replicate transactions
> > directly to rabbitmq using librabbitmq (
> http://hg.rabbitmq.com/rabbitmq-c/)
> > but there is an issue with the licensing of librabbitmq;
> > Drizzle is a fork off mysql and therefor GPL and librabbitmq is MPL. The
> MPL
> > states that it cannot be linked to GPL software
> > (http://www.fsf.org/licensing/licenses/index_html#MPL).
> > Is there any way round this?
> > /Marcus Eriksson
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/d783e58a/attachment.htm 

From alexis.richardson at gmail.com  Tue Feb  9 08:44:54 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 9 Feb 2010 08:44:54 +0000
Subject: [rabbitmq-discuss] Licensing of librabbitmq
In-Reply-To: <7ab768b11002090024l475168abr6d844d898f259b97@mail.gmail.com>
References: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>
	<167204d21002081756gd65cc8fwed1ec3179f00d958@mail.gmail.com>
	<7ab768b11002090024l475168abr6d844d898f259b97@mail.gmail.com>
Message-ID: <167204d21002090044w3c268697w13c3c17d72a744ea@mail.gmail.com>

Marcus

On Tue, Feb 9, 2010 at 8:24 AM, Marcus Eriksson <krummas at gmail.com> wrote:
> Hi
> No, I dont think they have to be GPL. Is, for example, BSD licensing my
> plugin a solution to this problem?

It might be, if librabbitmq could be BSD licensed.  That's one route.
Equally we could use 'section 13' of the MPL to allow use of
librabbitmq under the GPL, or if we felt perverse, the LGPL.  Or, it
may be possible to use MPL here.

Can you tell me:

1. if your plugin must be distributed with Drizzle?
2. how your plugin uses librabbitmq?

alexis



> /Marcus
> On Tue, Feb 9, 2010 at 2:56 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Marcus
>>
>> That sounds great and we would love to help. ?Can you tell me what
>> licenses are used for Drizzle plugins? ?Must they all be GPL?
>>
>> alexis
>>
>>
>> On Mon, Feb 8, 2010 at 12:03 PM, Marcus Eriksson <krummas at gmail.com>
>> wrote:
>> > Hi
>> > I am building a plugin for Drizzle to be able to replicate transactions
>> > directly to rabbitmq using librabbitmq
>> > (http://hg.rabbitmq.com/rabbitmq-c/)
>> > but there is an issue with the licensing of librabbitmq;
>> > Drizzle is a fork off mysql and therefor GPL and librabbitmq is MPL. The
>> > MPL
>> > states that it cannot be linked to GPL software
>> > (http://www.fsf.org/licensing/licenses/index_html#MPL).
>> > Is there any way round this?
>> > /Marcus Eriksson
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>



From krummas at gmail.com  Tue Feb  9 08:55:58 2010
From: krummas at gmail.com (Marcus Eriksson)
Date: Tue, 9 Feb 2010 09:55:58 +0100
Subject: [rabbitmq-discuss] Licensing of librabbitmq
In-Reply-To: <167204d21002090044w3c268697w13c3c17d72a744ea@mail.gmail.com>
References: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>
	<167204d21002081756gd65cc8fwed1ec3179f00d958@mail.gmail.com>
	<7ab768b11002090024l475168abr6d844d898f259b97@mail.gmail.com>
	<167204d21002090044w3c268697w13c3c17d72a744ea@mail.gmail.com>
Message-ID: <7ab768b11002090055w72fff057p579521bc51c257c2@mail.gmail.com>

On Tue, Feb 9, 2010 at 9:44 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Marcus
>
> On Tue, Feb 9, 2010 at 8:24 AM, Marcus Eriksson <krummas at gmail.com> wrote:
> > Hi
> > No, I dont think they have to be GPL. Is, for example, BSD licensing my
> > plugin a solution to this problem?
>
> It might be, if librabbitmq could be BSD licensed.  That's one route.
> Equally we could use 'section 13' of the MPL to allow use of
> librabbitmq under the GPL, or if we felt perverse, the LGPL.  Or, it
> may be possible to use MPL here.
>
> Can you tell me:
>
> 1. if your plugin must be distributed with Drizzle?
>

Not really, but it would be nice of course. The long term plan for drizzle
is to have a plugin site where users can download plugins (like
https://addons.mozilla.org/en-US/firefox/).



> 2. how your plugin uses librabbitmq?
>

http://bazaar.launchpad.net/~krummas/drizzle/rabbitmq/annotate/head:/plugin/rabbitmq/rabbitmq_handler.cc

May I ask why you picked MPL? I'm a total newbie on licensing issues, but to
me it feels quite hostile, I would expect client libs to be as open as
possible to enable more products using the "main" product.

/Marcus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/d07d1870/attachment.htm 

From alexis.richardson at gmail.com  Tue Feb  9 09:08:44 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 9 Feb 2010 09:08:44 +0000
Subject: [rabbitmq-discuss] Licensing of librabbitmq
In-Reply-To: <7ab768b11002090055w72fff057p579521bc51c257c2@mail.gmail.com>
References: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>
	<167204d21002081756gd65cc8fwed1ec3179f00d958@mail.gmail.com>
	<7ab768b11002090024l475168abr6d844d898f259b97@mail.gmail.com>
	<167204d21002090044w3c268697w13c3c17d72a744ea@mail.gmail.com>
	<7ab768b11002090055w72fff057p579521bc51c257c2@mail.gmail.com>
Message-ID: <167204d21002090108w18304ec4qfe0889cf99346e2f@mail.gmail.com>

Marcus

On Tue, Feb 9, 2010 at 8:55 AM, Marcus Eriksson <krummas at gmail.com> wrote:
>
>>
>> 1. if your plugin must be distributed with Drizzle?
>
> Not really, but it would be nice of course. The long term plan for drizzle
> is to have a plugin site where users can download plugins
> (like?https://addons.mozilla.org/en-US/firefox/).

OK.  So, in fact the only (perceived) inconsistencies between GPL and
MPL arise when there is 'redistribution' of the code.  So you could
license your plugin as MPL and people could use it with Drizzle, no
problem.  I am not recommending this btw.  It's one option.



>> 2. how your plugin uses librabbitmq?
>
> http://bazaar.launchpad.net/~krummas/drizzle/rabbitmq/annotate/head:/plugin/rabbitmq/rabbitmq_handler.cc
> May I ask why you picked MPL? I'm a total newbie on licensing issues, but to
> me it feels quite hostile, I would expect client libs to be as open as
> possible to enable more products using the "main" product.

MPL is a very open license and not (IMO) in any way 'hostile'.

There were lots of reasons, not least that Erlang uses MPL.   But we
also liked its mix of copyleft (on lines of code but not, unlike GPL,
whole packages) and liberal copyright.  MPL is a lot like LGPL, but
unlike LGPL is quite clearly written.  It's also like EPL but without
the need to join the ESF ;-)

But that's all for the server.  I am thinking the easiest thing would
be to dual license the librabbitmq client.

alexis



From rajesh.reddy at baml.com  Tue Feb  9 10:26:33 2010
From: rajesh.reddy at baml.com (Reddy, Rajesh (GPT EMEA))
Date: Tue, 09 Feb 2010 10:26:33 +0000
Subject: [rabbitmq-discuss] QueueingBasicConsumer
In-Reply-To: <167204d21002090108w18304ec4qfe0889cf99346e2f@mail.gmail.com>
Message-ID: <03FC0D29D4E88943AB7420C524BE8489027C3D8E@mllnc20mb056.emea.win.ml.com>

Hi

According to the rabbit .Net client documentation,QueueingBasicConsumer
is the safest way of subscribing to a queue, because its
implementation uses RabbitMQ.Util.SharedQueue to pass deliveries over to
the application thread,where all processing of received deliveries is
done, and where any AMQP IModel operation is safe.

But, when I checked the sourcecode it is just accumulating the messages
on a shared queue and doesn't route the messages to application thread.
So when iam using the QueueingBasicConsumer, the messages arrive on the
rabbit thread and processed on the same thread.

Is this some thing already known or left to the users to implement.

Thanks
Rajesh

--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. The information contained in this e-mail was obtained from sources believed to be reliable; however, the accuracy or completeness of this information is not guaranteed. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Past performance is no guarantee of future results. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 



From akalend at mail.ru  Tue Feb  9 11:00:07 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Tue, 09 Feb 2010 14:00:07 +0300
Subject: [rabbitmq-discuss] =?windows-1251?q?PHP_Client_libraries?=
In-Reply-To: <4B711AF9.4010304@stresstiming.de>
References: <4B711AF9.4010304@stresstiming.de>
Message-ID: <E1Nenp9-0000yu-00.akalend-mail-ru@f92.mail.ru>

Hi Dieter,

> thank you for your reply. Am I right, the module does not support 
> consuming messages? 

The module is support Consume and Get methods. But Consume 
methods is sync and GET is async.

If You use the  the consume in the WEB pages, the HTTP protocol is async and You can't wait if you have not commet technology.
My recomendation  is use the series of GET method:

// get queue items
$queue = new AMQPQueue(APMQConection(), 'my_queue');
$i=0;
$res = true;
while ($res = $queue->get() !== false  ){
    $i++;
    echo "$i : {$res['msg']}<br>\n";
}

But, You can use the Consume, You must the read queue lenght and make Consume of len messages. 
It is guarantie of absent waiting new messages.


// consume
$i=0;
$queue = new AMQPQueue(APMQConection());

$n = $queue->declare('my_queue');  // we get the lenght of queue
   
$queueMessages = $queue->consume( $n ); // we reading $n messages,  all queue.
foreach($queueMessages as $item){
  $i++;
  echo "$i.$item";
}

If $n less lenght of queue, the all nonreaded messages will be gone.

The Consume method is faster.

>Or Am i mixing up the Modules?
the module php-amqp  http://code.google.com/p/php-amqp/   don't support consume, bind and queue. It is only publish.

If You have any questions send me, I will very happeness ask You. Sorry for my English.

Alexandre



From krummas at gmail.com  Tue Feb  9 11:09:52 2010
From: krummas at gmail.com (Marcus Eriksson)
Date: Tue, 9 Feb 2010 12:09:52 +0100
Subject: [rabbitmq-discuss] Licensing of librabbitmq
In-Reply-To: <167204d21002090108w18304ec4qfe0889cf99346e2f@mail.gmail.com>
References: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>
	<167204d21002081756gd65cc8fwed1ec3179f00d958@mail.gmail.com>
	<7ab768b11002090024l475168abr6d844d898f259b97@mail.gmail.com>
	<167204d21002090044w3c268697w13c3c17d72a744ea@mail.gmail.com>
	<7ab768b11002090055w72fff057p579521bc51c257c2@mail.gmail.com>
	<167204d21002090108w18304ec4qfe0889cf99346e2f@mail.gmail.com>
Message-ID: <7ab768b11002090309u37668e1fjf80360cd43ae2188@mail.gmail.com>

On Tue, Feb 9, 2010 at 10:08 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Marcus
>
> On Tue, Feb 9, 2010 at 8:55 AM, Marcus Eriksson <krummas at gmail.com> wrote:
> >
> >>
> >> 1. if your plugin must be distributed with Drizzle?
> >
> > Not really, but it would be nice of course. The long term plan for
> drizzle
> > is to have a plugin site where users can download plugins
> > (like https://addons.mozilla.org/en-US/firefox/).
>
> OK.  So, in fact the only (perceived) inconsistencies between GPL and
> MPL arise when there is 'redistribution' of the code.  So you could
> license your plugin as MPL and people could use it with Drizzle, no
> problem.  I am not recommending this btw.  It's one option.
>

But the fact that MPL code cannot be linked against GPL code?
http://www.fsf.org/licensing/licenses/index_html#MPL (ok maybe a bit biased
source, but anyway)


>
>
> >> 2. how your plugin uses librabbitmq?
> >
> >
> http://bazaar.launchpad.net/~krummas/drizzle/rabbitmq/annotate/head:/plugin/rabbitmq/rabbitmq_handler.cc
> > May I ask why you picked MPL? I'm a total newbie on licensing issues, but
> to
> > me it feels quite hostile, I would expect client libs to be as open as
> > possible to enable more products using the "main" product.
>
> MPL is a very open license and not (IMO) in any way 'hostile'.
>
> There were lots of reasons, not least that Erlang uses MPL.   But we
> also liked its mix of copyleft (on lines of code but not, unlike GPL,
> whole packages) and liberal copyright.  MPL is a lot like LGPL, but
> unlike LGPL is quite clearly written.  It's also like EPL but without
> the need to join the ESF ;-)
>
> But that's all for the server.  I am thinking the easiest thing would
> be to dual license the librabbitmq client.
>

yep, sounds great!

/Marcus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/13c80755/attachment.htm 

From matthew at lshift.net  Tue Feb  9 11:20:24 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 9 Feb 2010 11:20:24 +0000
Subject: [rabbitmq-discuss] How can we increase the memory size of
 rabbitmq server?
In-Reply-To: <558967a41002082135kd6cda00i1d807d191ac579fc@mail.gmail.com>
References: <558967a41002082135kd6cda00i1d807d191ac579fc@mail.gmail.com>
Message-ID: <20100209112024.GG12002@mrnibble.lshift.net>

Hi Seema,

Which version of RabbitMQ are you using, and on which platform?

RabbitMQ from 1.7.1 is fairly sensible (though buggy under Windows with
older versions of Erlang - fixed in the next release) about limiting
itself to not use more than the available amount of RAM. Thus simply
putting in more RAM is the best way to allow RabbitMQ to use more RAM.

Until the new persister lands (bug21673 - it's currently going through
QA), all messages are held in RAM all the time. The new persister is
able to spill messages to disk and forget about them from RAM and so
can, in some modes of operation, exhibit no RAM-cost-per-message - thus
you end up being only limited by disk space. If you're comfortable
compiling from source, you may wish to try that.

Matthew



From aquino.gustavo at gmail.com  Tue Feb  9 12:46:37 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 9 Feb 2010 10:46:37 -0200
Subject: [rabbitmq-discuss] Controlling queue size
Message-ID: <5ef296b31002090446leb9bb01j7469e05bcff4705a@mail.gmail.com>

Hi,

I would like to control my queue size, due to the fact that RabbitMQ crash
if you don't consume queue and continuing posting messages.

RabbitMQ can control queue size by reject, disk, old messages...... etc ?

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/b86a4721/attachment.htm 

From alexis.richardson at gmail.com  Tue Feb  9 13:42:16 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 9 Feb 2010 13:42:16 +0000
Subject: [rabbitmq-discuss] Licensing of librabbitmq
In-Reply-To: <7ab768b11002090309u37668e1fjf80360cd43ae2188@mail.gmail.com>
References: <7ab768b11002080403y438d194dh9268fdedee07978@mail.gmail.com>
	<167204d21002081756gd65cc8fwed1ec3179f00d958@mail.gmail.com>
	<7ab768b11002090024l475168abr6d844d898f259b97@mail.gmail.com>
	<167204d21002090044w3c268697w13c3c17d72a744ea@mail.gmail.com>
	<7ab768b11002090055w72fff057p579521bc51c257c2@mail.gmail.com>
	<167204d21002090108w18304ec4qfe0889cf99346e2f@mail.gmail.com>
	<7ab768b11002090309u37668e1fjf80360cd43ae2188@mail.gmail.com>
Message-ID: <167204d21002090542t27aacb70vc4c9a3e92f7771dd@mail.gmail.com>

Marcus

On Tue, Feb 9, 2010 at 11:09 AM, Marcus Eriksson <krummas at gmail.com> wrote:
>
>> OK. ?So, in fact the only (perceived) inconsistencies between GPL and
>> MPL arise when there is 'redistribution' of the code. ?So you could
>> license your plugin as MPL and people could use it with Drizzle, no
>> problem. ?I am not recommending this btw. ?It's one option.
>
> But the fact that MPL code cannot be linked against GPL code?

MPL *can* be linked with GPL code, you just cannot then distribute the
whole package under the GPL.

GPL's virality only kicks in when derived works are distributed.



> http://www.fsf.org/licensing/licenses/index_html#MPL (ok maybe a bit biased
> source, but anyway)

Yes, the source is unhelpful.  Nonetheless in open source licensing it
is usually best to leave no room for doubt, uncertainty and fear.
("fudleft" ;-)



>> But that's all for the server. ?I am thinking the easiest thing would
>> be to dual license the librabbitmq client.
>
> yep, sounds great!

I agree.  We'll look into this.

*For now* I suggest you license your own code however you like.
People wishing to run your code with Drizzle will have to build from
source and other annoyances due to the GPL/MPL impedance.

Willfix.

alexis



From matthew at lshift.net  Tue Feb  9 15:27:01 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 9 Feb 2010 15:27:01 +0000
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages
 from multiple queues
In-Reply-To: <923687.80767.qm@web31814.mail.mud.yahoo.com>
References: <923687.80767.qm@web31814.mail.mud.yahoo.com>
Message-ID: <20100209152701.GH12002@mrnibble.lshift.net>

Hi Alex,

On Mon, Feb 08, 2010 at 07:30:52PM -0800, alex chen wrote:
> We are testing the new persister (bug21637).  It hangs for the following test case:
> 1) create 5 persistent queues, each queue bind to a different topic.
> 2) without consumer running, publish 20000 messages to each queue.
> each message has size 20KB.
>    the list_queues command shows each queue has 20000 messages in it.
> 3) start 5 consumers.  each consumer consumes messages from one queue.
>   after consuming some messages, broker hangs (not responding to list_queues).

I'm just trying to replicate this here. Are you publishing persistent or
non-persistent msgs?

Cheers,

Matthew



From matthew at lshift.net  Tue Feb  9 15:34:55 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 9 Feb 2010 15:34:55 +0000
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages
 from multiple queues
In-Reply-To: <20100209152701.GH12002@mrnibble.lshift.net>
References: <923687.80767.qm@web31814.mail.mud.yahoo.com>
	<20100209152701.GH12002@mrnibble.lshift.net>
Message-ID: <20100209153455.GI12002@mrnibble.lshift.net>

On Tue, Feb 09, 2010 at 03:27:01PM +0000, Matthew Sackman wrote:
> Hi Alex,
> 
> On Mon, Feb 08, 2010 at 07:30:52PM -0800, alex chen wrote:
> > We are testing the new persister (bug21637).  It hangs for the following test case:
> > 1) create 5 persistent queues, each queue bind to a different topic.
> > 2) without consumer running, publish 20000 messages to each queue.
> > each message has size 20KB.
> >    the list_queues command shows each queue has 20000 messages in it.
> > 3) start 5 consumers.  each consumer consumes messages from one queue.
> >   after consuming some messages, broker hangs (not responding to list_queues).
> 
> I'm just trying to replicate this here. Are you publishing persistent or
> non-persistent msgs?

Also, are your consumers acknowledging messages as they're going, or do
you have noAck/autoAck set, or are you building up lots of unackd msgs
in the server?

Matthew



From matthew at lshift.net  Tue Feb  9 15:53:24 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 9 Feb 2010 15:53:24 +0000
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages
 from multiple queues
In-Reply-To: <20100209153455.GI12002@mrnibble.lshift.net>
References: <923687.80767.qm@web31814.mail.mud.yahoo.com>
	<20100209152701.GH12002@mrnibble.lshift.net>
	<20100209153455.GI12002@mrnibble.lshift.net>
Message-ID: <20100209155324.GJ12002@mrnibble.lshift.net>

On Tue, Feb 09, 2010 at 03:34:55PM +0000, Matthew Sackman wrote:
> > I'm just trying to replicate this here.

And indeed I can. Non persistent msgs and ack as we go. Working on it
now.



From pdezwart at rubiconproject.com  Tue Feb  9 16:47:23 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 09 Feb 2010 08:47:23 -0800
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <E1Nenp9-0000yu-00.akalend-mail-ru@f92.mail.ru>
Message-ID: <C796D19B.5D47%pdezwart@rubiconproject.com>

Hey guys,

Just FYI, I have a mostly working php-rabbit patch. Using the demo script I
can declare, bind, publish and consume. I ran into a segfault when I tried
to incorporate it into our framework, so there is still some debugging to do
there.
I will submit a patch to everyone later today, with the understanding that I
make no guarantees as to whether it is production ready.

Pieter


On 2/9/10 3:00 AM, "Alexandre Kalendarev" <akalend at mail.ru> wrote:

> Hi Dieter,
> 
>> > thank you for your reply. Am I right, the module does not support
>> > consuming messages?
> 
> The module is support Consume and Get methods. But Consume
> methods is sync and GET is async.
> 
> If You use the  the consume in the WEB pages, the HTTP protocol is async and
> You can't wait if you have not commet technology.
> My recomendation  is use the series of GET method:
> 
> // get queue items
> $queue = new AMQPQueue(APMQConection(), 'my_queue');
> $i=0;
> $res = true;
> while ($res = $queue->get() !== false  ){
>     $i++;
>     echo "$i : {$res['msg']}<br>\n";
> }
> 
> But, You can use the Consume, You must the read queue lenght and make Consume
> of len messages.
> It is guarantie of absent waiting new messages.
> 
> 
> // consume
> $i=0;
> $queue = new AMQPQueue(APMQConection());
> 
> $n = $queue->declare('my_queue');  // we get the lenght of queue
>   
> $queueMessages = $queue->consume( $n ); // we reading $n messages,  all queue.
> foreach($queueMessages as $item){
>   $i++;
>   echo "$i.$item";
> }
> 
> If $n less lenght of queue, the all nonreaded messages will be gone.
> 
> The Consume method is faster.
> 
>> >Or Am i mixing up the Modules?
> the module php-amqp  http://code.google.com/p/php-amqp/   don't support
> consume, bind and queue. It is only publish.
> 
> If You have any questions send me, I will very happeness ask You. Sorry for my
> English.
> 
> Alexandre
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-- 
the rubicon project

PIETER DE ZWART | INTERFACES ENGINEER

??? P 310 207 0272 | x224
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/33049bcc/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/33049bcc/attachment.png 

From chen650 at yahoo.com  Tue Feb  9 18:31:57 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 9 Feb 2010 10:31:57 -0800 (PST)
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages
	from multiple queues
In-Reply-To: <20100209155324.GJ12002@mrnibble.lshift.net>
References: <923687.80767.qm@web31814.mail.mud.yahoo.com>
	<20100209152701.GH12002@mrnibble.lshift.net>
	<20100209153455.GI12002@mrnibble.lshift.net>
	<20100209155324.GJ12002@mrnibble.lshift.net>
Message-ID: <690386.52577.qm@web31807.mail.mud.yahoo.com>

Thanks Matthew for the quick response!  It is greatly appreciated.
We are using persistent msgs and ack.  I also tried using basic_qos to set prefetch_count=1, but the broker still hanged.  If we call tx_commit for each basic_publish which loading up the queue, then consumers can finish consuming all messages without any problem.
thanks.

-alex




On Tue, Feb 09, 2010 at 03:34:55PM +0000, Matthew Sackman wrote:
> > I'm just trying to replicate this here.

And indeed I can. Non persistent msgs and ack as we go. Working on it
now.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      



From matthew at lshift.net  Tue Feb  9 19:04:19 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 9 Feb 2010 19:04:19 +0000
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages
 from multiple queues
In-Reply-To: <690386.52577.qm@web31807.mail.mud.yahoo.com>
References: <923687.80767.qm@web31814.mail.mud.yahoo.com>
	<20100209152701.GH12002@mrnibble.lshift.net>
	<20100209153455.GI12002@mrnibble.lshift.net>
	<20100209155324.GJ12002@mrnibble.lshift.net>
	<690386.52577.qm@web31807.mail.mud.yahoo.com>
Message-ID: <20100209190419.GA16616@mrnibble.lshift.net>

Hi Alex,

On Tue, Feb 09, 2010 at 10:31:57AM -0800, alex chen wrote:
> Thanks Matthew for the quick response!  It is greatly appreciated.
> We are using persistent msgs and ack.  I also tried using basic_qos to set prefetch_count=1, but the broker still hanged.  If we call tx_commit for each basic_publish which loading up the queue, then consumers can finish consuming all messages without any problem.

I've tracked this down and fixed it. Many thanks for reporting this - it
was nothing suspicious - just my own fault for mixing up atomic and
non-atomic operations.

Please pull and hg up -C bug21673 and let me know if it works for you.

Matthew



From pdezwart at rubiconproject.com  Tue Feb  9 19:20:29 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 09 Feb 2010 11:20:29 -0800
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <C796D19B.5D47%pdezwart@rubiconproject.com>
Message-ID: <C796F580.5D6C%pdezwart@rubiconproject.com>

Good news. Seems like have a mostly working php-rabbit PHP module. Attached
is the patch to make it work with RabbitMQ 1.7*. For those of you less
familiar with building/managing PHP clients, perform the following commands:

$ wget http://php-rabbit.googlecode.com/files/php-rabbit.zip
$ unzip php-rabbit.zip
$ cd php-rabbit
$ phpize
$ php ?I | head
Copy the current ./configure statement and execute it
$ patch rabbit.c php-rabbit.patch
$ make && sudo make install
$ echo ?extension = /path/to/lib/folder/rabbit.so? > /etc/php.d/rabbit.ini
$ php ?m | grep rabbit
The last command should display ?rabbit?, meaning that the library was
recognized.

I have also included a very basic test script that you can use to validate
that things are working. I tweaked it post test, so there might be some
typos in it.

I had to run:
$ sudo /sbin/ldconfig
to get the librabbitmq.so library to be pulled in, so please keep that in
mind.

If you have any questions, please let me know. There are still a few bugs,
two of which are:
1. During connection, if you specify additional parameters like
AMQP_DURABLE, the exchange type length is seen as 0, even if you specify
one, and it therefore defaults all new exchange types to ?direct?. We use
topic exchanges here, so I tweaked it to default to ?topic? until that gets
fixed. 
2. I managed to make it segfault by passing in a weird exchange name. I will
put together a demonstration script asap.

This patch fixes:
1. Names and typos. Everything is AMQP (not AQPM, etc..) and the connection
class is AMQPConnection, not AQMPConnect.
2. The library is now defined correctly, and should therefore load without
tweaking the configure or doing any other wonky things.
3. All of the METHOD_OK parameters are no longer dereferenced improperly
4. I added the heartbeat parameter to provide the valid number of parameters
to amqp_login

I am now going to go load test this thing to see if I can make it crash.

Pieter


On 2/9/10 8:47 AM, "Pieter de Zwart" <pdezwart at rubiconproject.com> wrote:

> Hey guys,
> 
> Just FYI, I have a mostly working php-rabbit patch. Using the demo script I
> can declare, bind, publish and consume. I ran into a segfault when I tried to
> incorporate it into our framework, so there is still some debugging to do
> there.
> I will submit a patch to everyone later today, with the understanding that I
> make no guarantees as to whether it is production ready.
> 
> Pieter
> 
> 
> On 2/9/10 3:00 AM, "Alexandre Kalendarev" <akalend at mail.ru> wrote:
> 
>> Hi Dieter,
>> 
>>> > thank you for your reply. Am I right, the module does not support
>>> > consuming messages?
>> 
>> The module is support Consume and Get methods. But Consume
>> methods is sync and GET is async.
>> 
>> If You use the  the consume in the WEB pages, the HTTP protocol is async and
>> You can't wait if you have not commet technology.
>> My recomendation  is use the series of GET method:
>> 
>> // get queue items
>> $queue = new AMQPQueue(APMQConection(), 'my_queue');
>> $i=0;
>> $res = true;
>> while ($res = $queue->get() !== false  ){
>>     $i++;
>>     echo "$i : {$res['msg']}<br>\n";
>> }
>> 
>> But, You can use the Consume, You must the read queue lenght and make Consume
>> of len messages.
>> It is guarantie of absent waiting new messages.
>> 
>> 
>> // consume
>> $i=0;
>> $queue = new AMQPQueue(APMQConection());
>> 
>> $n = $queue->declare('my_queue');  // we get the lenght of queue
>>   
>> $queueMessages = $queue->consume( $n ); // we reading $n messages,  all
>> queue.
>> foreach($queueMessages as $item){
>>   $i++;
>>   echo "$i.$item";
>> }
>> 
>> If $n less lenght of queue, the all nonreaded messages will be gone.
>> 
>> The Consume method is faster.
>> 
>>> >Or Am i mixing up the Modules?
>> the module php-amqp  http://code.google.com/p/php-amqp/   don't support
>> consume, bind and queue. It is only publish.
>> 
>> If You have any questions send me, I will very happeness ask You. Sorry for
>> my English.
>> 
>> Alexandre
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 

-- 
the rubicon project

PIETER DE ZWART | INTERFACES ENGINEER

??? P 310 207 0272 | x224
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: php-rabbit.patch
Type: application/octet-stream
Size: 5660 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-rabbit.php
Type: application/octet-stream
Size: 770 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment-0001.obj 

From chen650 at yahoo.com  Tue Feb  9 19:53:21 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 9 Feb 2010 11:53:21 -0800 (PST)
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages
	from multiple queues
In-Reply-To: <20100209190419.GA16616@mrnibble.lshift.net>
References: <923687.80767.qm@web31814.mail.mud.yahoo.com>
	<20100209152701.GH12002@mrnibble.lshift.net>
	<20100209153455.GI12002@mrnibble.lshift.net>
	<20100209155324.GJ12002@mrnibble.lshift.net>
	<690386.52577.qm@web31807.mail.mud.yahoo.com>
	<20100209190419.GA16616@mrnibble.lshift.net>
Message-ID: <4965.1406.qm@web31802.mail.mud.yahoo.com>

Hi Matthew,

I just tested it using the latest code and it works!  Thanks a lot for fixing it so fast!  
Finally your work has made it possible to remove the memory limit of the previous persister.
Go Rabbit!  :)

-alex



----- Original Message ----
From: Matthew Sackman <matthew at lshift.net>
To: alex chen <chen650 at yahoo.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tue, February 9, 2010 11:04:19 AM
Subject: Re: [rabbitmq-discuss] new persiter hangs while consuming messages from multiple queues

Hi Alex,

On Tue, Feb 09, 2010 at 10:31:57AM -0800, alex chen wrote:
> Thanks Matthew for the quick response!  It is greatly appreciated.
> We are using persistent msgs and ack.  I also tried using basic_qos to set prefetch_count=1, but the broker still hanged.  If we call tx_commit for each basic_publish which loading up the queue, then consumers can finish consuming all messages without any problem.

I've tracked this down and fixed it. Many thanks for reporting this - it
was nothing suspicious - just my own fault for mixing up atomic and
non-atomic operations.

Please pull and hg up -C bug21673 and let me know if it works for you.

Matthew



      



From pdezwart at rubiconproject.com  Tue Feb  9 21:26:09 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 09 Feb 2010 13:26:09 -0800
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <C796F580.5D6C%pdezwart@rubiconproject.com>
Message-ID: <C79712F2.5D85%pdezwart@rubiconproject.com>

Hey guys,

Please find an added patch to fix the queue->get method, which was returning
the wrong associative array key for the message. This should be combined
with the previous patch.

Pieter


On 2/9/10 11:20 AM, "Pieter de Zwart" <pdezwart at rubiconproject.com> wrote:

> Good news. Seems like have a mostly working php-rabbit PHP module. Attached is
> the patch to make it work with RabbitMQ 1.7*. For those of you less familiar
> with building/managing PHP clients, perform the following commands:
> 
> $ wget http://php-rabbit.googlecode.com/files/php-rabbit.zip
> $ unzip php-rabbit.zip
> $ cd php-rabbit
> $ phpize
> $ php ?I | head
> Copy the current ./configure statement and execute it
> $ patch rabbit.c php-rabbit.patch
> $ make && sudo make install
> $ echo ?extension = /path/to/lib/folder/rabbit.so? > /etc/php.d/rabbit.ini
> $ php ?m | grep rabbit
> The last command should display ?rabbit?, meaning that the library was
> recognized.
> 
> I have also included a very basic test script that you can use to validate
> that things are working. I tweaked it post test, so there might be some typos
> in it.
> 
> I had to run:
> $ sudo /sbin/ldconfig
> to get the librabbitmq.so library to be pulled in, so please keep that in
> mind.
> 
> If you have any questions, please let me know. There are still a few bugs, two
> of which are:
> 1. During connection, if you specify additional parameters like AMQP_DURABLE,
> the exchange type length is seen as 0, even if you specify one, and it
> therefore defaults all new exchange types to ?direct?. We use topic exchanges
> here, so I tweaked it to default to ?topic? until that gets fixed.
> 2. I managed to make it segfault by passing in a weird exchange name. I will
> put together a demonstration script asap.
> 
> This patch fixes:
> 1. Names and typos. Everything is AMQP (not AQPM, etc..) and the connection
> class is AMQPConnection, not AQMPConnect.
> 2. The library is now defined correctly, and should therefore load without
> tweaking the configure or doing any other wonky things.
> 3. All of the METHOD_OK parameters are no longer dereferenced improperly
> 4. I added the heartbeat parameter to provide the valid number of parameters
> to amqp_login
> 
> I am now going to go load test this thing to see if I can make it crash.
> 
> Pieter
> 
> 
> On 2/9/10 8:47 AM, "Pieter de Zwart" <pdezwart at rubiconproject.com> wrote:
> 
>> Hey guys,
>> 
>> Just FYI, I have a mostly working php-rabbit patch. Using the demo script I
>> can declare, bind, publish and consume. I ran into a segfault when I tried to
>> incorporate it into our framework, so there is still some debugging to do
>> there.
>> I will submit a patch to everyone later today, with the understanding that I
>> make no guarantees as to whether it is production ready.
>> 
>> Pieter
>> 
>> 
>> On 2/9/10 3:00 AM, "Alexandre Kalendarev" <akalend at mail.ru> wrote:
>> 
>>> Hi Dieter,
>>> 
>>>> > thank you for your reply. Am I right, the module does not support
>>>> > consuming messages?
>>> 
>>> The module is support Consume and Get methods. But Consume
>>> methods is sync and GET is async.
>>> 
>>> If You use the  the consume in the WEB pages, the HTTP protocol is async and
>>> You can't wait if you have not commet technology.
>>> My recomendation  is use the series of GET method:
>>> 
>>> // get queue items
>>> $queue = new AMQPQueue(APMQConection(), 'my_queue');
>>> $i=0;
>>> $res = true;
>>> while ($res = $queue->get() !== false  ){
>>>     $i++;
>>>     echo "$i : {$res['msg']}<br>\n";
>>> }
>>> 
>>> But, You can use the Consume, You must the read queue lenght and make
>>> Consume of len messages.
>>> It is guarantie of absent waiting new messages.
>>> 
>>> 
>>> // consume
>>> $i=0;
>>> $queue = new AMQPQueue(APMQConection());
>>> 
>>> $n = $queue->declare('my_queue');  // we get the lenght of queue
>>>   
>>> $queueMessages = $queue->consume( $n ); // we reading $n messages,  all
>>> queue.
>>> foreach($queueMessages as $item){
>>>   $i++;
>>>   echo "$i.$item";
>>> }
>>> 
>>> If $n less lenght of queue, the all nonreaded messages will be gone.
>>> 
>>> The Consume method is faster.
>>> 
>>>> >Or Am i mixing up the Modules?
>>> the module php-amqp  http://code.google.com/p/php-amqp/   don't support
>>> consume, bind and queue. It is only publish.
>>> 
>>> If You have any questions send me, I will very happeness ask You. Sorry for
>>> my English.
>>> 
>>> Alexandre
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 

-- 
the rubicon project

PIETER DE ZWART | INTERFACES ENGINEER

??? P 310 207 0272 | x224
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/d519a21e/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/d519a21e/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: queue_get.patch
Type: application/octet-stream
Size: 436 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/d519a21e/attachment.obj 

From aquino.gustavo at gmail.com  Tue Feb  9 21:31:38 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 9 Feb 2010 19:31:38 -0200
Subject: [rabbitmq-discuss] Controlling queue size
In-Reply-To: <5ef296b31002090446leb9bb01j7469e05bcff4705a@mail.gmail.com>
References: <5ef296b31002090446leb9bb01j7469e05bcff4705a@mail.gmail.com>
Message-ID: <5ef296b31002091331j62ee36dbs568c00c940cfe331@mail.gmail.com>

Anybody ?

On Tue, Feb 9, 2010 at 10:46 AM, Gustavo Aquino <aquino.gustavo at gmail.com>wrote:

> Hi,
>
> I would like to control my queue size, due to the fact that RabbitMQ crash
> if you don't consume queue and continuing posting messages.
>
> RabbitMQ can control queue size by reject, disk, old messages...... etc ?
>
> Regards.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/e6a597e7/attachment.htm 

From jdunck at gmail.com  Tue Feb  9 21:51:56 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Tue, 9 Feb 2010 15:51:56 -0600
Subject: [rabbitmq-discuss] Controlling queue size
In-Reply-To: <5ef296b31002091331j62ee36dbs568c00c940cfe331@mail.gmail.com>
References: <5ef296b31002090446leb9bb01j7469e05bcff4705a@mail.gmail.com>
	<5ef296b31002091331j62ee36dbs568c00c940cfe331@mail.gmail.com>
Message-ID: <2545a92c1002091351w24cda4a8we9e82c49115ac349@mail.gmail.com>

This might help:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-April/003317.html

On Tue, Feb 9, 2010 at 3:31 PM, Gustavo Aquino <aquino.gustavo at gmail.com> wrote:
> Anybody ?
>
> On Tue, Feb 9, 2010 at 10:46 AM, Gustavo Aquino <aquino.gustavo at gmail.com>
> wrote:
>>
>> Hi,
>> I would like to control my queue size, due to the fact that RabbitMQ crash
>> if you don't consume queue and continuing posting messages.
>> RabbitMQ can control queue size by reject, disk, old messages...... etc ?
>> Regards.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthew at lshift.net  Tue Feb  9 22:14:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 9 Feb 2010 22:14:15 +0000
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages
 from multiple queues
In-Reply-To: <401b577e1002091327g7173118x96653ac3d666ae35@mail.gmail.com>
References: <923687.80767.qm@web31814.mail.mud.yahoo.com>
	<20100209152701.GH12002@mrnibble.lshift.net>
	<20100209153455.GI12002@mrnibble.lshift.net>
	<20100209155324.GJ12002@mrnibble.lshift.net>
	<690386.52577.qm@web31807.mail.mud.yahoo.com>
	<20100209190419.GA16616@mrnibble.lshift.net>
	<401b577e1002091327g7173118x96653ac3d666ae35@mail.gmail.com>
Message-ID: <20100209221415.GA30573@wellquite.org>

Hi Scott,

On Tue, Feb 09, 2010 at 01:27:12PM -0800, scott w wrote:
> Is there an easy way to backport bug21673 to 1.7.1 or do I have to go
> against trunk to use it? And if so, is trunk stable right now?

bug21673 contains everything that you need - every few days I merge from
default into bug21673 so yes, it keeps up with all the developments and
fixes going on in default. Default is very stable just at the moment.

So in short, you shouldn't need to do any merging yourself - you should
find that running straight off bug21673 is stable, and if you find bugs,
please do let us know - we're normally pretty quick at tracking them
down and fixing them.

Matthew



From pdezwart at rubiconproject.com  Tue Feb  9 16:47:23 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 09 Feb 2010 08:47:23 -0800
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <E1Nenp9-0000yu-00.akalend-mail-ru@f92.mail.ru>
Message-ID: <C796D19B.5D47%pdezwart@rubiconproject.com>

Hey guys,

Just FYI, I have a mostly working php-rabbit patch. Using the demo script I
can declare, bind, publish and consume. I ran into a segfault when I tried
to incorporate it into our framework, so there is still some debugging to do
there.
I will submit a patch to everyone later today, with the understanding that I
make no guarantees as to whether it is production ready.

Pieter


On 2/9/10 3:00 AM, "Alexandre Kalendarev" <akalend at mail.ru> wrote:

> Hi Dieter,
> 
>> > thank you for your reply. Am I right, the module does not support
>> > consuming messages?
> 
> The module is support Consume and Get methods. But Consume
> methods is sync and GET is async.
> 
> If You use the  the consume in the WEB pages, the HTTP protocol is async and
> You can't wait if you have not commet technology.
> My recomendation  is use the series of GET method:
> 
> // get queue items
> $queue = new AMQPQueue(APMQConection(), 'my_queue');
> $i=0;
> $res = true;
> while ($res = $queue->get() !== false  ){
>     $i++;
>     echo "$i : {$res['msg']}<br>\n";
> }
> 
> But, You can use the Consume, You must the read queue lenght and make Consume
> of len messages.
> It is guarantie of absent waiting new messages.
> 
> 
> // consume
> $i=0;
> $queue = new AMQPQueue(APMQConection());
> 
> $n = $queue->declare('my_queue');  // we get the lenght of queue
>   
> $queueMessages = $queue->consume( $n ); // we reading $n messages,  all queue.
> foreach($queueMessages as $item){
>   $i++;
>   echo "$i.$item";
> }
> 
> If $n less lenght of queue, the all nonreaded messages will be gone.
> 
> The Consume method is faster.
> 
>> >Or Am i mixing up the Modules?
> the module php-amqp  http://code.google.com/p/php-amqp/   don't support
> consume, bind and queue. It is only publish.
> 
> If You have any questions send me, I will very happeness ask You. Sorry for my
> English.
> 
> Alexandre
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-- 
the rubicon project

PIETER DE ZWART | INTERFACES ENGINEER

??? P 310 207 0272 | x224
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/33049bcc/attachment-0001.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/33049bcc/attachment-0001.png 

From scottblanc at gmail.com  Tue Feb  9 22:35:45 2010
From: scottblanc at gmail.com (scott w)
Date: Tue, 9 Feb 2010 14:35:45 -0800
Subject: [rabbitmq-discuss] new persiter hangs while consuming messages
	from multiple queues
In-Reply-To: <20100209221415.GA30573@wellquite.org>
References: <923687.80767.qm@web31814.mail.mud.yahoo.com>
	<20100209152701.GH12002@mrnibble.lshift.net>
	<20100209153455.GI12002@mrnibble.lshift.net>
	<20100209155324.GJ12002@mrnibble.lshift.net>
	<690386.52577.qm@web31807.mail.mud.yahoo.com>
	<20100209190419.GA16616@mrnibble.lshift.net>
	<401b577e1002091327g7173118x96653ac3d666ae35@mail.gmail.com>
	<20100209221415.GA30573@wellquite.org>
Message-ID: <401b577e1002091435y23eaadbof50303ed1e685120@mail.gmail.com>

Great, thanks!

On Tue, Feb 9, 2010 at 2:14 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Scott,
>
> On Tue, Feb 09, 2010 at 01:27:12PM -0800, scott w wrote:
> > Is there an easy way to backport bug21673 to 1.7.1 or do I have to go
> > against trunk to use it? And if so, is trunk stable right now?
>
> bug21673 contains everything that you need - every few days I merge from
> default into bug21673 so yes, it keeps up with all the developments and
> fixes going on in default. Default is very stable just at the moment.
>
> So in short, you shouldn't need to do any merging yourself - you should
> find that running straight off bug21673 is stable, and if you find bugs,
> please do let us know - we're normally pretty quick at tracking them
> down and fixing them.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/2f142d9d/attachment.htm 

From aquino.gustavo at gmail.com  Tue Feb  9 22:42:40 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 9 Feb 2010 20:42:40 -0200
Subject: [rabbitmq-discuss] Controlling queue size
In-Reply-To: <2545a92c1002091351w24cda4a8we9e82c49115ac349@mail.gmail.com>
References: <5ef296b31002090446leb9bb01j7469e05bcff4705a@mail.gmail.com>
	<5ef296b31002091331j62ee36dbs568c00c940cfe331@mail.gmail.com>
	<2545a92c1002091351w24cda4a8we9e82c49115ac349@mail.gmail.com>
Message-ID: <5ef296b31002091442k7b357ab8u6f72bc459995783c@mail.gmail.com>

Jeremy,

Thanks, but I need another way to control the queue size,  I'm very scared
with memory limitation in RabbitMQ. I'm doing some testes and all the time
that RabbitMQ consume all server's memory, caused by one producer without
consumer, it crashes. Therefore we need a way to monitoring this or one
configuration that solve it, I would prefer a solution to put a limitation
by server side, persisting this message on disk, or reject message, or other
algorithm while memory still full that don't crash server.

Some queues can loose messages, but others can't loose about that I'm trying
to found some solutions to cover this problem.

Regards.


On Tue, Feb 9, 2010 at 7:51 PM, Jeremy Dunck <jdunck at gmail.com> wrote:

> This might help:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-April/003317.html
>
> On Tue, Feb 9, 2010 at 3:31 PM, Gustavo Aquino <aquino.gustavo at gmail.com>
> wrote:
> > Anybody ?
> >
> > On Tue, Feb 9, 2010 at 10:46 AM, Gustavo Aquino <
> aquino.gustavo at gmail.com>
> > wrote:
> >>
> >> Hi,
> >> I would like to control my queue size, due to the fact that RabbitMQ
> crash
> >> if you don't consume queue and continuing posting messages.
> >> RabbitMQ can control queue size by reject, disk, old messages...... etc
> ?
> >> Regards.
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/68d0f7ea/attachment.htm 

From akalend at mail.ru  Wed Feb 10 07:55:39 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Wed, 10 Feb 2010 10:55:39 +0300
Subject: [rabbitmq-discuss] =?windows-1251?q?PHP_Client_libraries?=
In-Reply-To: <C796F580.5D6Cpdezwart@rubiconproject.com>
References: <C796F580.5D6Cpdezwart@rubiconproject.com>
Message-ID: <E1Nf7QB-0003LK-00.akalend-mail-ru@f13.mail.ru>


> Good news. Seems like have a mostly working php-rabbit PHP module. Attached
> is the patch to make it work with RabbitMQ 1.7*. For those of you less
> familiar with building/managing PHP clients, perform the following commands:
> 
> $ wget http://php-rabbit.googlecode.com/files/php-rabbit.zip

Pieter,

the *.zip is old version.
the last update into svn: 

# Non-members may check out a read-only working copy anonymously over HTTP.
svn checkout http://php-rabbit.googlecode.com/svn/trunk/ php-rabbit-read-only

I can add You into project as commiter and You can patching code and examples.


Thanks all for attention of the project,
You noties is very importent for me,
I will stady You emails.




Alexandre



From flatline at stresstiming.de  Wed Feb 10 08:55:50 2010
From: flatline at stresstiming.de (diez)
Date: Wed, 10 Feb 2010 09:55:50 +0100
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <C79712F2.5D85%pdezwart@rubiconproject.com>
References: <C79712F2.5D85%pdezwart@rubiconproject.com>
Message-ID: <4B727496.9090904@stresstiming.de>


Hey Pieter,

seem if you have forgotten to include the php-rabbit.patch file into 
your zip :)

Can you please check it!

Greetings

Dieter
> Copy the current ./configure statement and execute it
> $ patch rabbit.c php-rabbit.patch


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100210/378ff5e4/attachment.htm 

From flatline at stresstiming.de  Wed Feb 10 09:46:35 2010
From: flatline at stresstiming.de (diez)
Date: Wed, 10 Feb 2010 10:46:35 +0100
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <4B727496.9090904@stresstiming.de>
References: <C79712F2.5D85%pdezwart@rubiconproject.com>
	<4B727496.9090904@stresstiming.de>
Message-ID: <4B72807B.9010906@stresstiming.de>

Hey ho,

After doing this :

/update/rabbit# phpize5 && ./configure --with-rabbit && make && make install
/update/rabbit# ldconfig

I get:

PHP Warning:  PHP Startup: Invalid library (maybe not a PHP library) 
'rabbit.so'  in Unknown on line 0
Exception: Extension rabbit does not exist


I used Alex's trunk from subversion and I have ubuntu with php 5.2.6 
without any special options!

Ideas?

Dieter






From aj.mckee at druid-dns.com  Wed Feb 10 09:51:35 2010
From: aj.mckee at druid-dns.com (AJ McKee)
Date: Wed, 10 Feb 2010 09:51:35 +0000
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <4B72807B.9010906@stresstiming.de>
References: <C79712F2.5D85%pdezwart@rubiconproject.com>
	<4B727496.9090904@stresstiming.de> 
	<4B72807B.9010906@stresstiming.de>
Message-ID: <75ea54211002100151o70d9c3f5vb931ed8333bceabd@mail.gmail.com>

Hi Dieter,
http://code.google.com/p/php-rabbit/source/browse/trunk/rabbit.c#154
Change
#ifdef COMPILE_DL_AMQP
to
#ifdef COMPILE_DL_RABBIT
AJ

On 10 February 2010 09:46, diez <flatline at stresstiming.de> wrote:
>
> Hey ho,
>
> After doing this :
>
> /update/rabbit# phpize5 && ./configure --with-rabbit && make && make install
> /update/rabbit# ldconfig
>
> I get:
>
> PHP Warning: ?PHP Startup: Invalid library (maybe not a PHP library)
> 'rabbit.so' ?in Unknown on line 0
> Exception: Extension rabbit does not exist
>
>
> I used Alex's trunk from subversion and I have ubuntu with php 5.2.6
> without any special options!
>
> Ideas?
>
> Dieter
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



--
AJ McKee
phone: +353 (0)86 380 50 70
profile: ?http://linkedin.com/in/ajmkee
jid: ? ? ? aj.mckee at druid-dns.com
blog: ? ?http://aj.mc-kee.com/
twitter: @ajmckee



From akalend at mail.ru  Wed Feb 10 10:35:53 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Wed, 10 Feb 2010 13:35:53 +0300
Subject: [rabbitmq-discuss] =?windows-1251?q?PHP_Client_libraries?=
In-Reply-To: <75ea54211002100151o70d9c3f5vb931ed8333bceabd@mail.gmail.com>
References: <75ea54211002100151o70d9c3f5vb931ed8333bceabd@mail.gmail.com>
Message-ID: <E1Nf9vF-0005sL-00.akalend-mail-ru@f13.mail.ru>


> http://code.google.com/p/php-rabbit/source/browse/trunk/rabbit.c#154
> Change
> #ifdef COMPILE_DL_AMQP
> to
> #ifdef COMPILE_DL_RABBIT
> AJ
> 

 fix in svn

Alexandre



From flatline at stresstiming.de  Wed Feb 10 11:25:05 2010
From: flatline at stresstiming.de (diez)
Date: Wed, 10 Feb 2010 12:25:05 +0100
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <E1Nf9vF-0005sL-00.akalend-mail-ru@f13.mail.ru>
References: <75ea54211002100151o70d9c3f5vb931ed8333bceabd@mail.gmail.com>
	<E1Nf9vF-0005sL-00.akalend-mail-ru@f13.mail.ru>
Message-ID: <4B729791.1080605@stresstiming.de>

Hi Alex!

So module  works now so far. But there is the next Problem :)

If I follow this Example my code stops and does not return

<?php

$cnn = new AMQPConnect (array ('port'=>5672, 'login' => 
'live_rabbit','password'=>'lostpassword','vhost'=>'/testhost' ));
$exchange = new AMQPExchange($cnn);

$queue = new AMQPQueue($cnn);
$queue->declare('me', AMQP_AUTEDELETE | AMQP_DURABLE);
print "new Exchange".PHP_EOL;
$exchange->declare('ex_name','topic');
print "declare Exchange".PHP_EOL;
$exchange->bind('me','beta.*');
print "bind Exchange".PHP_EOL;
$msg = "Hello World";
$res = $exchange->publish( $msg, 'beta.me');


#########

>  php rabbit.php
new Exchange
declare Exchange

###########

It never reaches the bind Exchange line. I attached the log of my 
RabbitMQ Server

Logfile RabbitMQ

###########

=INFO REPORT==== 10-Feb-2010::12:19:42 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:44776

=INFO REPORT==== 10-Feb-2010::12:19:42 ===
starting TCP connection<0.8351.0>  from 127.0.0.1:44776

########## after pressing ctrl-c within the shell with the running rabbit.php testscript. #############


=WARNING REPORT==== 10-Feb-2010::12:19:48 ===
exception on TCP connection<0.8351.0>  from 127.0.0.1:44776
connection_closed_abruptly

=INFO REPORT==== 10-Feb-2010::12:19:48 ===
closing TCP connection<0.8351.0>  from 127.0.0.1:44776


#############



>    
>> Hey ho,
>>
>> After doing this :
>>
>> /update/rabbit# phpize5&&  ./configure --with-rabbit&&  make&&  make install
>> /update/rabbit# ldconfig
>>
>> I get:
>>
>> PHP Warning:  PHP Startup: Invalid library (maybe not a PHP library)
>> 'rabbit.so'  in Unknown on line 0
>> Exception: Extension rabbit does not exist
>>
>>
>> I used Alex's trunk from subversion and I have ubuntu with php 5.2.6
>> without any special options!
>>
>> Ideas?
>>      
> I will stady, why cannot compile module.
>
> Can are You comlipe PHP static ?
> ./configure --with-rabbit ....
>
>
> Alexandre
>    



Am 10.02.2010 11:35, schrieb Alexandre Kalendarev:
>    
>> http://code.google.com/p/php-rabbit/source/browse/trunk/rabbit.c#154
>> Change
>> #ifdef COMPILE_DL_AMQP
>> to
>> #ifdef COMPILE_DL_RABBIT
>> AJ
>>
>>      
>   fix in svn
>
> Alexandre
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100210/d1986357/attachment.htm 

From aj.mckee at druid-dns.com  Wed Feb 10 11:49:16 2010
From: aj.mckee at druid-dns.com (AJ McKee)
Date: Wed, 10 Feb 2010 11:49:16 +0000
Subject: [rabbitmq-discuss] PHP Client libraries
In-Reply-To: <4B729791.1080605@stresstiming.de>
References: <75ea54211002100151o70d9c3f5vb931ed8333bceabd@mail.gmail.com> 
	<E1Nf9vF-0005sL-00.akalend-mail-ru@f13.mail.ru>
	<4B729791.1080605@stresstiming.de>
Message-ID: <75ea54211002100349i6ebd7ceh2596c61a6c8553ed@mail.gmail.com>

Try the following;

$queue->declare('myex','topic',AMQP_AUTEDELETE | AMQP_DURABLE);

Aj



From seemasbiradar at gmail.com  Wed Feb 10 11:54:30 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Wed, 10 Feb 2010 17:24:30 +0530
Subject: [rabbitmq-discuss] Error while Consuming data from the rabbitmq
	server( along with bug21673 ) & erlang R13B03
Message-ID: <558967a41002100354k7487124aqd981305df6a7df94@mail.gmail.com>

Hi ,

I am using Erlang R13B03 and RabbitMQ server I have update it with a bug  *
bug21673*  using command
*hg up -C bug21673.*
I built the server.

Scenario.

Producer sending  48060 persistent messages each one of size 3463 bytes.
Consumer is offline.

When consumer is online , Consumer consumes message 30000 and hangs.

When i tried to check the status of the rabbitmq server using rabbitmqctl ,
i got  the following error message

*C:\febRabbitmq\Today\rabbitmq-server\scripts>rabbitmqctl list_queues
messages_ready
Listing queues ...
Error:
{{badarg,[{ets,update_counter,[rabbit_msg_store_file_summary,4,{9,-1}]},
                 {rabbit_msg_store,'-client_read1/3-fun-0-',1},
                 {rabbit_msg_store,client_read1,3},
                 {rabbit_variable_queue,fetch_from_q3_or_delta,1},
                 {rabbit_amqqueue_process,deliver_from_queue_deliver,3},
                 {rabbit_amqqueue_process,deliver_msgs_to_consumers,3},
                 {rabbit_amqqueue_process,run_message_queue,1},
                 {rabbit_amqqueue_process,handle_cast,2}]},

{gen_server2,pcall,[<4572.335.0>,9,{info,[messages_ready]},infinity]}}.*
**
*Got the following error message in the server consloe.*
**
Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 373662860 bytes of memory (of type "heap").
This application has requested the Runtime to terminate it in an unusual
way.
Please contact the application's support team for more information.
Please help me on this.

Thanks
Seema
*
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100210/52332e0c/attachment.htm 

From akalend at mail.ru  Wed Feb 10 12:34:48 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Wed, 10 Feb 2010 15:34:48 +0300
Subject: [rabbitmq-discuss] =?windows-1251?q?PHP_Client_libraries?=
In-Reply-To: <4B729791.1080605@stresstiming.de>
References: <4B729791.1080605@stresstiming.de>
Message-ID: <E1NfBmK-00089H-00.akalend-mail-ru@f227.mail.ru>


> $cnn = new AMQPConnect (array ('port'=>5672, 'login' => 
> 'live_rabbit','password'=>'lostpassword','vhost'=>'/testhost' ));
> $exchange = new AMQPExchange($cnn);
> 
> $queue = new AMQPQueue($cnn);
> $queue->declare('me', AMQP_AUTEDELETE | AMQP_DURABLE);
> print "new Exchange".PHP_EOL;
> $exchange->declare('ex_name','topic');
> print "declare Exchange".PHP_EOL;


> $exchange->bind('me','beta.*');

the queue "me" must be exist, else rise Exception.

> print "bind Exchange".PHP_EOL;
> $msg = "Hello World";
> $res = $exchange->publish( $msg, 'beta.me');

You could be like to use rabbit Tracer for debug.  The tracer You can find install ( unpack )  the java client library.
 rabbitmq-java-client package  include class  Tracer.

start:
java -cp rabbitmq-client.jar:commons-io-1.2.jar:commons-cli-1.1.jar com.rabbitmq.tools.Tracer 
or
runjava.sh com.rabbitmq.tools.Tracer listenPort connectHost connectPort listenPort

You must have  connection on the proxy  port 5673

Code:
$cnn = new APMQConection(  array(  port=>5673 ) );

tracer output:
1257461452674: conn#74 ch#0 <- {#method<connection.start>(version-major=8,version-minor=0,server 
properties={product=RabbitMQ, platform=Erlang/OTP, information=Licensed under the MPL. See www.rabbitmq.com/, 
copyright=Copyright ? 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd., 
version=1.5.4},mechanisms=PLAIN AMQPLAIN,locales=en_US),null,""}
1257461452681: conn#74 ch#0 -> {#method<connection.start-ok>(client-
properties={},mechanism=PLAIN,response=guestguest,locale=en_US),null,""}
1257461452682: conn#74 ch#0 <- {#method<connection.tune>(channel-max=0,frame-max=131072,heartbeat=0),null,""}
etc ...

code:
$queue = new AMQPQueue($cnn, 'Habrauser')

output trace:
1257461452685: conn#74 ch#1 -> 
{#method<queue.declare>(ticket=0,queue=Habrauser,passive=false,durable=false,exclusive=false,auto-
delete=true,nowait=false,arguments={}),null,""}
1257461452686: conn#74 ch#1 <- {#method<queue.declare-ok>(queue=Habrauser,message-count=0,consumer-count=0),null,""}

By trace info You can to find the server errors. So, You can test how the work  the php-client by rabbitmqctl tools:

rabbitmqctl list_queues       // show   list queue
rabbitmqctl list_exchanges  // show  list exchanges
rabbitmqctl list_bindings     // show   list bindings



Good luke of  tracing



Alexandre






From alexis.richardson at gmail.com  Wed Feb 10 13:00:48 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 10 Feb 2010 13:00:48 +0000
Subject: [rabbitmq-discuss] New Perl STOMP Module
In-Reply-To: <20100208121531.8959.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20100208121531.8959.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <167204d21002100500o35b2d7baqc8d7b20c809cc5a4@mail.gmail.com>

Thanks Lionel, I have added this to:
http://delicious.com/alexisrichardson/rabbitmq+perl

alexis


On Mon, Feb 8, 2010 at 11:27 AM, Lionel Cons <lionel.cons at cern.ch> wrote:
> For your information, I've uploaded today a new module to CPAN
> allowing a Perl client to interact with a STOMP server. I tested it
> against RabbitMQ and it worked fine.
>
> See: http://search.cpan.org/~lcons/Net-STOMP.
>
> This module provides an object oriented client interface to interact
> with servers supporting STOMP (Streaming Text Orientated Messaging
> Protocol). It supports the major features of messaging brokers: SSL,
> asynchronous I/O, receipts and transactions.
>
> I'm aware of the existence of Net::Stomp but this module does not
> provide the functionality that we need and seems to be unsupported
> (no reply from the maintainer).
>
> If you use Perl and STOMP, feel free to give it a try and give me your
> feedback.
>
> Cheers,
> __________________________________________________________
> Lionel Cons ? ? ? ?http://cern.ch/lionel.cons
> CERN ? ? ? ? ? ? ? http://cern.ch
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Wed Feb 10 13:05:20 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 10 Feb 2010 13:05:20 +0000
Subject: [rabbitmq-discuss] Controlling queue size
In-Reply-To: <5ef296b31002091442k7b357ab8u6f72bc459995783c@mail.gmail.com>
References: <5ef296b31002090446leb9bb01j7469e05bcff4705a@mail.gmail.com>
	<5ef296b31002091331j62ee36dbs568c00c940cfe331@mail.gmail.com>
	<2545a92c1002091351w24cda4a8we9e82c49115ac349@mail.gmail.com>
	<5ef296b31002091442k7b357ab8u6f72bc459995783c@mail.gmail.com>
Message-ID: <167204d21002100505me50005at3cee072927170723@mail.gmail.com>

Gustavo,

On Tue, Feb 9, 2010 at 10:42 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Jeremy,
> Thanks, but I need another way to control the queue size, ?I'm very scared
> with memory limitation in RabbitMQ. I'm doing some testes and all the time
> that RabbitMQ consume all server's memory, caused by one producer without
> consumer, it crashes. Therefore we need a way to monitoring this or one
> configuration that solve it, I?would prefer a solution?to put a limitation
> by server side, persisting this message on disk, or reject message, or other
> algorithm while memory still full that don't crash server.

There is more info about channel.flow here:
http://www.rabbitmq.com/extensions.html

This should give you a way to monitor memory use and tell producers to back off.




> Some queues can loose messages, but others can't loose about that I'm trying
> to found some solutions to cover this problem.

Can you describe what you are doing in more detail?

That will help us address your problem and (I hope) help you fix them.

alexis




> Regards.
>
> On Tue, Feb 9, 2010 at 7:51 PM, Jeremy Dunck <jdunck at gmail.com> wrote:
>>
>> This might help:
>>
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-April/003317.html
>>
>> On Tue, Feb 9, 2010 at 3:31 PM, Gustavo Aquino <aquino.gustavo at gmail.com>
>> wrote:
>> > Anybody ?
>> >
>> > On Tue, Feb 9, 2010 at 10:46 AM, Gustavo Aquino
>> > <aquino.gustavo at gmail.com>
>> > wrote:
>> >>
>> >> Hi,
>> >> I would like to control my queue size, due to the fact that RabbitMQ
>> >> crash
>> >> if you don't consume queue and continuing posting messages.
>> >> RabbitMQ can control queue size by reject, disk, old messages...... etc
>> >> ?
>> >> Regards.
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthew at lshift.net  Wed Feb 10 13:24:07 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 10 Feb 2010 13:24:07 +0000
Subject: [rabbitmq-discuss] Error while Consuming data from the rabbitmq
 server( along with bug21673 ) & erlang R13B03
In-Reply-To: <558967a41002100354k7487124aqd981305df6a7df94@mail.gmail.com>
References: <558967a41002100354k7487124aqd981305df6a7df94@mail.gmail.com>
Message-ID: <20100210132406.GA27127@mrnibble.lshift.net>

Hi Seema,

On Wed, Feb 10, 2010 at 05:24:30PM +0530, Seema Biradar wrote:
> I am using Erlang R13B03 and RabbitMQ server I have update it with a bug  *
> bug21673*  using command

Many thanks for the report. Unfortunately, whilst the erlang trace you
supplied shows exactly which line is exploding, I can't replicate the
problem, despite quite some time testing. This is because it's a
concurrency bug and obviously that makes it dependent on everything from
your CPU to your hard disc, from to your OS to the weather outside.

However, from inspecting the code, I've identified a few places where I
slipped up and failed to spot races of various sorts. Please pull from
our hg repo, and hg up -C bug21673, rebuild and retest. Hopefully you'll
find everything working now, but please do let us know if you find
further issues.

Many thanks,

Matthew



From a.raghu001 at gmail.com  Wed Feb 10 17:41:49 2010
From: a.raghu001 at gmail.com (raghu a)
Date: Wed, 10 Feb 2010 17:41:49 +0000
Subject: [rabbitmq-discuss] amqp_channel_open issue
Message-ID: <b2514e8a1002100941p43a5c75fs446ea35701220789@mail.gmail.com>

Hi,

I am very new to RabbitMQ. we are using Rabbit MQ C API to talk with the
broker.
We are playing with the examples(with few modifications) given by RabbitMQ.
We created one producer and one consumer with the same connection but
difference channels.
In the following code amqp_channel_open(conn, 2) statement is causing the my
main thread to block
but if i move this statement before creating of consumer thread then every
thing seems to be working.

My code is as follows.
static void send_batch(amqp_connection_
state_t conn,
                       char const *queue_name,
                       int rate_limit,
                       int message_count)
{
  char message[256] = "test";
  die_on_error(amqp_basic_publish(conn,
                                    2,
                                    amqp_cstring_bytes("amq.direct"),
                                    amqp_cstring_bytes(queue_name),
                                    0,
                                    0,
                                    NULL,
                                    (amqp_bytes_t) {.len = sizeof(message),
.bytes = message}),
                 "Publishing");
    printf("Message sent by producer\n");
}

static void run(amqp_connection_state_t conn)
{
  amqp_frame_t frame;
  int result;
  size_t body_received;
  size_t body_target;
  int  received = 0;
  while (1) {
    amqp_maybe_release_buffers(conn);
    result = amqp_simple_wait_frame(conn, &frame);
    if (result <= 0) return;
    if (frame.frame_type != AMQP_FRAME_METHOD)
      continue;
    if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
      continue;
    result = amqp_simple_wait_frame(conn, &frame);
    if (result <= 0) return;
    if (frame.frame_type != AMQP_FRAME_HEADER) {
      abort();
    }
    body_target = frame.payload.properties.body_size;
    body_received = 0;
    while (body_received < body_target) {
      result = amqp_simple_wait_frame(conn, &frame);
      if (result <= 0) return;
      if (frame.frame_type != AMQP_FRAME_BODY) {
    abort();
      }
      body_received += frame.payload.body_fragment.len;
      assert(body_received <= body_target);
    }
    received++;
    printf("received=%d\n",received);
  }
}
void*  consume(void* conn){
  run(*((amqp_connection_state_t*)conn));
}
int main(int argc, char const * const *argv) {
  char const *hostname="127.0.0.1";
  int port="5672";
  char const *exchange;
  char const *bindingkey;
  int sockfd;
  amqp_connection_state_t conn;
  amqp_bytes_t queuename;
  exchange = "amq.direct"; //argv[3];
  bindingkey = "test queue"; //argv[4];
  int rate_limit = 100;
  int message_count = 10000;
  conn = amqp_new_connection();
  die_on_error(sockfd = amqp_open_socket(hostname, port), "Opening socket");
  amqp_set_sockfd(conn, sockfd);
  die_on_amqp_error(amqp_login(conn, "/", 0, 131072, 0,
AMQP_SASL_METHOD_PLAIN, "guest", "guest"),
            "Logging in");
  amqp_channel_open(conn, 1);
  die_on_amqp_error(amqp_rpc_reply, "Opening channel");
  {
    amqp_queue_declare_ok_t *r = amqp_queue_declare(conn, 1,
AMQP_EMPTY_BYTES, 0, 0, 0, 1,
                            AMQP_EMPTY_TABLE);
    die_on_amqp_error(amqp_rpc_reply, "Declaring queue");
    queuename = amqp_bytes_malloc_dup(r->queue);
    if (queuename.bytes == NULL) {
      die_on_error(-ENOMEM, "Copying queue name");
    }
  }
  amqp_queue_bind(conn, 1, queuename, amqp_cstring_bytes(exchange),
amqp_cstring_bytes(bindingkey),
          AMQP_EMPTY_TABLE);
  die_on_amqp_error(amqp_rpc_reply, "Binding queue");

  amqp_basic_consume(conn, 1, queuename, AMQP_EMPTY_BYTES, 0, 1, 0);
  die_on_amqp_error(amqp_rpc_reply, "Consuming");
  pthread_t threadId;
  pthread_create(&threadId,NULL,consume,(void*)&conn);
  sleep(1);
  amqp_channel_open(conn, 2);
  send_batch(conn, "test queue", rate_limit, message_count);
  die_on_amqp_error(amqp_channel_close(conn, 1, AMQP_REPLY_SUCCESS),
"Closing channel");
  die_on_amqp_error(amqp_connection_close(conn, AMQP_REPLY_SUCCESS),
"Closing connection");
  amqp_destroy_connection(conn);
  die_on_error(close(sockfd), "Closing socket");
  return 0;
}

Please provide me the reasons for blocking.

Thanks,
Ragavendra.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100210/f6ed3703/attachment.htm 

From groundduckleg at gmail.com  Wed Feb 10 18:06:49 2010
From: groundduckleg at gmail.com (Bob Brown)
Date: Wed, 10 Feb 2010 12:06:49 -0600
Subject: [rabbitmq-discuss] Can Rabbit MQ subscribe to an Active MQ queue??
Message-ID: <4B5A5254678E414F8A17328F8449C3DA@matdev40b>

Guys,

Crazy question for you. Can Rabbit MQ subscribe to an Active MQ queue?? And if so, what's the best way to go about doing this?

Thanks!

V/R

Bob B
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100210/8988ecfa/attachment.htm 

From alexis.richardson at gmail.com  Wed Feb 10 18:25:38 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 10 Feb 2010 18:25:38 +0000
Subject: [rabbitmq-discuss] Can Rabbit MQ subscribe to an Active MQ
	queue??
In-Reply-To: <4B5A5254678E414F8A17328F8449C3DA@matdev40b>
References: <4B5A5254678E414F8A17328F8449C3DA@matdev40b>
Message-ID: <167204d21002101025j1b5a8070n550450d5ca17f426@mail.gmail.com>

Bob,

I don't think anyone has tried to do such a thing, but were you to
attempt this then perhaps some sort of STOMP relay would be the way to
go.

alexis


On Wed, Feb 10, 2010 at 6:06 PM, Bob Brown <groundduckleg at gmail.com> wrote:
> Guys,
>
> Crazy question for you. Can Rabbit MQ subscribe to an Active MQ queue?? And
> if so, what's the best way to go about doing this?
>
> Thanks!
>
> V/R
>
> Bob B
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From gmr at myyearbook.com  Wed Feb 10 18:33:58 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 10 Feb 2010 13:33:58 -0500
Subject: [rabbitmq-discuss] Can Rabbit MQ subscribe to an Active MQ
	queue??
In-Reply-To: <4B5A5254678E414F8A17328F8449C3DA@matdev40b>
References: <4B5A5254678E414F8A17328F8449C3DA@matdev40b>
Message-ID: <af1bce591002101033p1deef438mee93d405154abc6f@mail.gmail.com>

Bob, we've released an ActiveMQ -> RabbitMQ requeue system called Siphon:

http://github.com/myyearbook/siphon

We've been using this to facilitate our migration from ActiveMQ to RabbitMQ.

Regards,

Gavin

On Wed, Feb 10, 2010 at 1:06 PM, Bob Brown <groundduckleg at gmail.com> wrote:
> Guys,
>
> Crazy question for you. Can Rabbit MQ subscribe to an Active MQ queue?? And
> if so, what's the best way to go about doing this?
>
> Thanks!
>
> V/R
>
> Bob B
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From mtodd at highgroove.com  Wed Feb 10 19:07:29 2010
From: mtodd at highgroove.com (Matt Todd)
Date: Wed, 10 Feb 2010 14:07:29 -0500
Subject: [rabbitmq-discuss] Monitoring Message Throughput
In-Reply-To: <4B6DDC4E.1050403@lshift.net>
References: <1265380380.3017.139.camel@erdnuss1.virtualminds-office.de> 
	<4B6DDC4E.1050403@lshift.net>
Message-ID: <2a8d4a711002101107s640fca8av1559eb614f13ad5d@mail.gmail.com>

I agree with both Garrett and Gavin with some minor additions:

I think pure throughput should include messages failed to be ack'd and
having to be resent since it is technically output. They could be reported
separately and combined manually for those that don't mind the difference.

I think it would be cool to see something similar to Unix load that reports
on the last minute averages, the last 5 minute's average, and the last 15
minute's average. But, this goes back to the discussion on counters and how
easy it is for us to do this on our end since many tools do this for us
already.

So, in this regard, it would be much more useful for the data to just be
handed back to us whenever we request it as a pure count. Let us do the
hard/interesting work of calculating averages over specific time intervals,
etc.

RE: throughput, I think we should show both enqueued and dequeued throughput
separately, but do definitely want to include both.

Matt



On Sat, Feb 6, 2010 at 4:17 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Nico,
>
> Nico Meyer wrote:
> > are there any good solutions to monitor the message throughput of
> > RabbitMQ? Preferably broken down by queues. I have quickly checked the
> > monitoring solutions on the webpage, but none seem to have that feature.
> > Also there is probably not enough data exported by RabbitMQ to do this.
>
> The closest you can get at the moment is the various socket stats
> reported by 'rabbitmqctl list_connections', but that is clearly quite a
> long way from per-queue message throughput stats.
>
> We will add more stats (and more ways of getting at them) in the future,
> so your input is appreciated in defining what exactly it is that you and
> other users are looking for. So, regarding your specific request ...
>
> By "throughput" do you mean:
> - rate at which messages are enqueued?
> - rate at which messages are dequeued?
>
> If it's "messages enqueued", what happens to messages that are part of a
> transaction? Are they included in the figure immediately or only when
> the tx has committed?
>
> If it's "messages dequeued", what happens to message redeliveries (e.g.
> when a message has been delivered but then the client disconnected w/o
> acking them and the message is subsequently redelivered to another
> client)? Are they included in the figure?
>
> Also,
> - are you interested in message counts, i.e. messages per second, or
> data volumes, i.e. octets per second?
> - over what period of time should the figures be averaged?
> - do the stats of a durable queue need to survive a broker restart?
> - do the stats still need to be accessible after a queue has been deleted?
> - what stats other than per-queue throughputs would you like to see?
>
> I realise these are a lot of questions. But answering them will help us
> shape our future stats architecture.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Matt Todd
Highgroove Studios
www.highgroove.com
cell: 404-314-2612
blog: maraby.org

Scout - Web Monitoring and Reporting Software
www.scoutapp.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100210/7a7bdd56/attachment.htm 

From akleak at gmail.com  Wed Feb 10 23:44:26 2010
From: akleak at gmail.com (Arco)
Date: Wed, 10 Feb 2010 15:44:26 -0800 (PST)
Subject: [rabbitmq-discuss] Plugin Hooks / Callbacks
Message-ID: <92f72134-5eb6-483c-a9ec-77d32a4af010@q2g2000pre.googlegroups.com>

Hi Folks -

I'd like to write a RabbitMQ plugin that collects traffic counts and
stats.  (I suppose this is related to another thread "Monitoring
Message Thruput").

I figured out how to write a 'counter' plugin that does what I want.

Now my question is - how to invoke the plugin from RabbitMQ?  I'd like
the plugin to be called whenever a message enters an exchange, and
also whenever a message leaves a queue.

Does RabbitMQ have hooks to register plugin callbacks like this, or do
I have to modify the RabbitMQ source directly??

It's my first day of hands-on Erlang!  Hope this makes sense!  :-)

Cheers, Andy



From lionel.cons at cern.ch  Thu Feb 11 07:36:14 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Thu, 11 Feb 2010 08:36:14 +0100
Subject: [rabbitmq-discuss] STOMP & AMPQ
Message-ID: <20100211082039.3959.abe10f7e5afbbb3a79ce619739541149@cern.ch>

First of all, I've tried to use the RabbitMQ STOMP gateway and it
worked flawlessly.

This said, the way it works (see for instance the topic example in
http://dev.rabbitmq.com/wiki/StompGateway#section_2) looks like
bricolage to me.

As an illustration, using my Net::STOMP Perl module, a topic
subscription in ActiveMQ would look like:

  $stomp->subscribe(destination => "/topic/some.test");

but in RabbitMQ you would have to write:

  $some_test_id = $stomp->uuid();
  $stomp->subscribe(
      destination => "",
      exchange    => "amq.topic",
      routing_key => "some.test"
      id          => $some_test_id,
  );

Several different brokers support STOMP but unfortunately it is very
hard to write broker independent code on top of STOMP.

Coming back to AMQP, since objects could be created dynamically via a
simple STOMP SUBSCRIBE frame, it would be good to be able to control
some attributes _explicitly_ rather than relying on hacks like
"destination:" to create a private queue. FWIW, similar hacks exist
also outside the AMQP world, like "destination:/temp-queue/foo" in
ActiveMQ.

In any case AMQP 1-0 will require a change of the STOMP gateway to
expose the new nodes, links, filters... Time for a clean mapping
between AMQP and STOMP?

Cheers,
__________________________________________________________
Lionel Cons        http://cern.ch/lionel.cons
CERN               http://cern.ch



From matthew at lshift.net  Thu Feb 11 15:55:08 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 11 Feb 2010 15:55:08 +0000
Subject: [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)
 writing to queue
In-Reply-To: <ebcef6281002082141k23ab03b1nbafbcd18995eadc9@mail.gmail.com>
References: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>
	<ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>
	<4B6DCEB4.4050309@lshift.net>
	<ebcef6281002070333x11c756bfq3d033093ce522fef@mail.gmail.com>
	<ebcef6281002072354h2d53613bj3c4041b8b8cf9259@mail.gmail.com>
	<4B7079B8.1030409@lshift.net>
	<ebcef6281002082141k23ab03b1nbafbcd18995eadc9@mail.gmail.com>
Message-ID: <20100211155508.GA2942@mrnibble.lshift.net>

Hi Sigurd,

On Tue, Feb 09, 2010 at 05:41:26AM +0000, Sigurd H?gsbro wrote:
> >> Try to get a trace that includes the connection disappearance. The pattern
> > of commands just prior to that might shed some light on what causes the
> > client to trip up.
> 
> Tracer writes the full message-body to stdout which isn't helpful when
> sending multi-megabyte bodies. I'll try using wireshark for diagnostics
> instead.

Actually, our java Tracer has just received quite a lot of attention and
you can now turn off decoding of bodies, along with several other
options. It's also now much faster. If you grab our java client from hg
(http://hg.rabbitmq.com/rabbitmq-java-client/ latest default) then you
should find it's a bit more helpful now (and robust).

> > Feel free to give it a try, but since we do not know what the problem is
> > there is no way to tell in advance whether it will fare any better.
> >
> > I like the design principles of pika, but the example of demo_relay.py is a
> little hard going. Can you point me at any other real-world examples of
> asyncore-based connection handling? And what is the recommended way to
> detect/handle connection-failure?

Sadly pika falls into the category of highly experimental. Tony, who
wrote it, is currently on holiday, but Majek has done some work with it
and I've prodded him to take a look at this. In general, highly
experimental things are notable for their lack of documentation I'm
afraid.

Matthew



From matthew at lshift.net  Thu Feb 11 16:07:33 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 11 Feb 2010 16:07:33 +0000
Subject: [rabbitmq-discuss] amqp_channel_open issue
In-Reply-To: <b2514e8a1002100941p43a5c75fs446ea35701220789@mail.gmail.com>
References: <b2514e8a1002100941p43a5c75fs446ea35701220789@mail.gmail.com>
Message-ID: <20100211160733.GB2942@mrnibble.lshift.net>

Hi,

I'm afraid the RabbitMQ-C client is highly experimental and not really
receiving much development attention at the moment. We would not
recommend it for production use - it has not been through our QA
processes. I'm fairly sure that you need to make sure that you don't use
a channel from more than one thread, but I have a feeling there are even
more constraints than that. I'm afraid, if in doubt, don't use the C
client, at the moment.

Matthew

On Wed, Feb 10, 2010 at 05:41:49PM +0000, raghu a wrote:
> Hi,
> 
> I am very new to RabbitMQ. we are using Rabbit MQ C API to talk with the
> broker.
> We are playing with the examples(with few modifications) given by RabbitMQ.
> We created one producer and one consumer with the same connection but
> difference channels.
> In the following code amqp_channel_open(conn, 2) statement is causing the my
> main thread to block
> but if i move this statement before creating of consumer thread then every
> thing seems to be working.
> 
> My code is as follows.
> static void send_batch(amqp_connection_
> state_t conn,
>                        char const *queue_name,
>                        int rate_limit,
>                        int message_count)
> {
>   char message[256] = "test";
>   die_on_error(amqp_basic_publish(conn,
>                                     2,
>                                     amqp_cstring_bytes("amq.direct"),
>                                     amqp_cstring_bytes(queue_name),
>                                     0,
>                                     0,
>                                     NULL,
>                                     (amqp_bytes_t) {.len = sizeof(message),
> .bytes = message}),
>                  "Publishing");
>     printf("Message sent by producer\n");
> }
> 
> static void run(amqp_connection_state_t conn)
> {
>   amqp_frame_t frame;
>   int result;
>   size_t body_received;
>   size_t body_target;
>   int  received = 0;
>   while (1) {
>     amqp_maybe_release_buffers(conn);
>     result = amqp_simple_wait_frame(conn, &frame);
>     if (result <= 0) return;
>     if (frame.frame_type != AMQP_FRAME_METHOD)
>       continue;
>     if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
>       continue;
>     result = amqp_simple_wait_frame(conn, &frame);
>     if (result <= 0) return;
>     if (frame.frame_type != AMQP_FRAME_HEADER) {
>       abort();
>     }
>     body_target = frame.payload.properties.body_size;
>     body_received = 0;
>     while (body_received < body_target) {
>       result = amqp_simple_wait_frame(conn, &frame);
>       if (result <= 0) return;
>       if (frame.frame_type != AMQP_FRAME_BODY) {
>     abort();
>       }
>       body_received += frame.payload.body_fragment.len;
>       assert(body_received <= body_target);
>     }
>     received++;
>     printf("received=%d\n",received);
>   }
> }
> void*  consume(void* conn){
>   run(*((amqp_connection_state_t*)conn));
> }
> int main(int argc, char const * const *argv) {
>   char const *hostname="127.0.0.1";
>   int port="5672";
>   char const *exchange;
>   char const *bindingkey;
>   int sockfd;
>   amqp_connection_state_t conn;
>   amqp_bytes_t queuename;
>   exchange = "amq.direct"; //argv[3];
>   bindingkey = "test queue"; //argv[4];
>   int rate_limit = 100;
>   int message_count = 10000;
>   conn = amqp_new_connection();
>   die_on_error(sockfd = amqp_open_socket(hostname, port), "Opening socket");
>   amqp_set_sockfd(conn, sockfd);
>   die_on_amqp_error(amqp_login(conn, "/", 0, 131072, 0,
> AMQP_SASL_METHOD_PLAIN, "guest", "guest"),
>             "Logging in");
>   amqp_channel_open(conn, 1);
>   die_on_amqp_error(amqp_rpc_reply, "Opening channel");
>   {
>     amqp_queue_declare_ok_t *r = amqp_queue_declare(conn, 1,
> AMQP_EMPTY_BYTES, 0, 0, 0, 1,
>                             AMQP_EMPTY_TABLE);
>     die_on_amqp_error(amqp_rpc_reply, "Declaring queue");
>     queuename = amqp_bytes_malloc_dup(r->queue);
>     if (queuename.bytes == NULL) {
>       die_on_error(-ENOMEM, "Copying queue name");
>     }
>   }
>   amqp_queue_bind(conn, 1, queuename, amqp_cstring_bytes(exchange),
> amqp_cstring_bytes(bindingkey),
>           AMQP_EMPTY_TABLE);
>   die_on_amqp_error(amqp_rpc_reply, "Binding queue");
> 
>   amqp_basic_consume(conn, 1, queuename, AMQP_EMPTY_BYTES, 0, 1, 0);
>   die_on_amqp_error(amqp_rpc_reply, "Consuming");
>   pthread_t threadId;
>   pthread_create(&threadId,NULL,consume,(void*)&conn);
>   sleep(1);
>   amqp_channel_open(conn, 2);
>   send_batch(conn, "test queue", rate_limit, message_count);
>   die_on_amqp_error(amqp_channel_close(conn, 1, AMQP_REPLY_SUCCESS),
> "Closing channel");
>   die_on_amqp_error(amqp_connection_close(conn, AMQP_REPLY_SUCCESS),
> "Closing connection");
>   amqp_destroy_connection(conn);
>   die_on_error(close(sockfd), "Closing socket");
>   return 0;
> }
> 
> Please provide me the reasons for blocking.
> 
> Thanks,
> Ragavendra.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From matthew at lshift.net  Thu Feb 11 16:17:26 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 11 Feb 2010 16:17:26 +0000
Subject: [rabbitmq-discuss] Monitoring Message Throughput
In-Reply-To: <af1bce591002061340u1c84f840i300464eb647ffcf3@mail.gmail.com>
References: <1265380380.3017.139.camel@erdnuss1.virtualminds-office.de>
	<4B6DDC4E.1050403@lshift.net>
	<af1bce591002061340u1c84f840i300464eb647ffcf3@mail.gmail.com>
Message-ID: <20100211161726.GC2942@mrnibble.lshift.net>

On Sat, Feb 06, 2010 at 04:40:02PM -0500, Gavin M. Roy wrote:
> On Sat, Feb 6, 2010 at 4:17 PM, Matthias Radestock <matthias at lshift.net>wrote:
> 
> > By "throughput" do you mean:
> > - rate at which messages are enqueued?
> 
> For me, yes
> 
> > - rate at which messages are dequeued?
> 
> For me, yes

Ironically enough, in the new persister, we actually use these rates
(ingress and egress rates) internally to make various decisions.
Currently, you can get hold of them (if you're using the new persister -
branch bug21673) by the magic name "raw_vq_status". Note this is
undocumented and will not last too much longer - it exists for debugging
purposes only. However:

rabbitmqctl list_queues name messages messages_unacknowledged durable memory raw_vq_status
testA   3503    0       true    6657424  [{q1,0},{q2,0},{delta,{delta,undefined,0,undefined}},{q3,0},{q4,3503},{len,3503},{outstanding_txns,0},{target_ram_msg_count,undefined},{ram_msg_count,3503},{ram_index_count,0},{avg_egress_rate,0},{avg_ingress_rate,0},{next_seq_id,3503}]

the two fields there you're interested in are the avg_egress_rate and
avg_ingress_rate. It's a rolling average, smoothed over the last two
sample periods, where a period length is nominally 5 seconds.

Matthew



From david.maciver at lshift.net  Thu Feb 11 16:30:53 2010
From: david.maciver at lshift.net (David R. MacIver)
Date: Thu, 11 Feb 2010 16:30:53 +0000
Subject: [rabbitmq-discuss] QueueingBasicConsumer
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C3D8E@mllnc20mb056.emea.win.ml.com>
References: <167204d21002090108w18304ec4qfe0889cf99346e2f@mail.gmail.com>
	<03FC0D29D4E88943AB7420C524BE8489027C3D8E@mllnc20mb056.emea.win.ml.com>
Message-ID: <20100211163053.GD323@missbossy>

On Tue, Feb 09, 2010 at 10:26:33AM +0000, Reddy, Rajesh (GPT EMEA) wrote:
> Hi
> 
> According to the rabbit .Net client documentation,QueueingBasicConsumer
> is the safest way of subscribing to a queue, because its
> implementation uses RabbitMQ.Util.SharedQueue to pass deliveries over to
> the application thread,where all processing of received deliveries is
> done, and where any AMQP IModel operation is safe.
> 
> But, when I checked the sourcecode it is just accumulating the messages
> on a shared queue and doesn't route the messages to application thread.
> So when iam using the QueueingBasicConsumer, the messages arrive on the
> rabbit thread and processed on the same thread.
> 
> Is this some thing already known or left to the users to implement.

Hi Rajesh,

Rather by its nature, message processing is something left to the users to
implement. Rabbit is just there to make sure the messages get delivered. 
What you do with them when they arrive is up to you. 

With normal BasicConsumers you write the code that processes the message in the
consumer implementation and it gets run in the rabbit thread. With 
QueueingBasicConsumer the only "processing" it does is to enqueue the messages 
in a SharedQueue, so you instead write the message processing code in whatever
is using the consumer by pulling things off that queue, and it runs in whatever 
thread you tell it to.

Regards,
David



From matthew at lshift.net  Thu Feb 11 16:47:24 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 11 Feb 2010 16:47:24 +0000
Subject: [rabbitmq-discuss] Plugin Hooks / Callbacks
In-Reply-To: <92f72134-5eb6-483c-a9ec-77d32a4af010@q2g2000pre.googlegroups.com>
References: <92f72134-5eb6-483c-a9ec-77d32a4af010@q2g2000pre.googlegroups.com>
Message-ID: <20100211164724.GE2942@mrnibble.lshift.net>

Hi Andy,

On Wed, Feb 10, 2010 at 03:44:26PM -0800, Arco wrote:
> Now my question is - how to invoke the plugin from RabbitMQ?  I'd like
> the plugin to be called whenever a message enters an exchange, and
> also whenever a message leaves a queue.

Yes, that kind of thing is high on our todo list. The simple fact is
that it's very very hard to do this kind of thing without hurting
performance, and it's also very hard to add enough hooks everywhere to
satisfy everyone.

> Does RabbitMQ have hooks to register plugin callbacks like this, or do
> I have to modify the RabbitMQ source directly??

Because of the difficulty of working out the "right" way to do it, we
haven't done it yet ;) As a result, you'd have to alter the RabbitMQ
source directly.

Personally, I think the best way to do this is to use the dbg module.
With enough care in the match specs and some careful book keeping, I
think this is by far the easiest and most flexible way to insert such
hooks dynamically into the system.

Matthew



From matthew at lshift.net  Thu Feb 11 16:55:39 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 11 Feb 2010 16:55:39 +0000
Subject: [rabbitmq-discuss] STOMP & AMPQ
In-Reply-To: <20100211082039.3959.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20100211082039.3959.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <20100211165539.GA17938@mrnibble.lshift.net>

On Thu, Feb 11, 2010 at 08:36:14AM +0100, Lionel Cons wrote:
> In any case AMQP 1-0 will require a change of the STOMP gateway to
> expose the new nodes, links, filters... Time for a clean mapping
> between AMQP and STOMP?

Sure, and feel free to propose one. In reality, it's highly unlikely
that a version of RabbitMQ will be released this year which implements
AMQP 1-0, even if AMQP 1-0 is a finalised specification (or for that
matter, even if it's sufficiently stable that we'd consider starting
work on implementing it).

Matthew



From adam.crain at plymouthsystems.com  Thu Feb 11 22:15:45 2010
From: adam.crain at plymouthsystems.com (Adam Crain)
Date: Thu, 11 Feb 2010 17:15:45 -0500
Subject: [rabbitmq-discuss] more complex java client examples
Message-ID: <B408C3622F5D2B4AB861EB388F3E4F9631AC8A@psi-srv01.PSIINC.local>

I've been using the java client and am looking for more detailed
examples that will show how to correctly use the library for robust
applications.

 

I've looked through pretty much everything in:

 

rabbitmq-java-client-1.7.1\test\src\com\rabbitmq\examples

 

Specifically, I'd like to see some sample code that shows how to
gracefully handle failover and reconnect.

 

Ideas?

 

Thanks,

Adam

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100211/a7a27ab6/attachment.htm 

From scott.brooks at epicadvertising.com  Thu Feb 11 23:20:50 2010
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Thu, 11 Feb 2010 17:20:50 -0600
Subject: [rabbitmq-discuss] RabbitMQ SNMP Plugin Updates: Now with a counter
 for total messages delivered to queues
Message-ID: <8DA0F323-EAE4-4BC3-9F0D-648250ABD774@epicadvertising.com>

I've updated the RabbitMQ SNMP plugin available at
http://github.com/epicadvertising/rabbitmq_snmp_plugin

Highlights: 
	Tracing delivery messages to queues so you can pull the total number of messages delivered.
	a patch by ddssot for aggregate stats for the vhost.
	a patch by ddssot to adjust the update interval.


The tracing will probably be quite brittle when it comes to the version of rabbit you are using, it's currently tested on 1.7.1

RabbitMQ guys: Any thoughts on using a gen_event we could add handlers to get this info?


---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
scott.brooks at epicadvertising.com




From 0x6e6562 at gmail.com  Thu Feb 11 23:21:54 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 12 Feb 2010 09:21:54 +1000
Subject: [rabbitmq-discuss] more complex java client examples
In-Reply-To: <B408C3622F5D2B4AB861EB388F3E4F9631AC8A@psi-srv01.PSIINC.local>
References: <B408C3622F5D2B4AB861EB388F3E4F9631AC8A@psi-srv01.PSIINC.local>
Message-ID: <592117685388053157@unknownmsgid>

Adam,

On 12 Feb 2010, at 08:15, "Adam Crain"
<adam.crain at plymouthsystems.com> wrote:

> I?ve been using the java client and am looking for more detailed exa
> mples that will show how to correctly use the library for robust app
> lications.
>
>
>
> I?ve looked through pretty much everything in:
>
>
>
> rabbitmq-java-client-1.7.1\test\src\com\rabbitmq\examples
>
>
>
> Specifically, I?d like to see some sample code that shows how to gra
> cefully handle failover and reconnect.
>
>

Have you looked at the rabbitmq-java-messagepatterns library? Whilst
it's not a supported library (i.e. WIP), it will provide you with a
reliability layer for transparent reconnections.

Cheers,

Ben



From a.raghu001 at gmail.com  Fri Feb 12 13:48:40 2010
From: a.raghu001 at gmail.com (raghu a)
Date: Fri, 12 Feb 2010 19:18:40 +0530
Subject: [rabbitmq-discuss] amqp_channel_open issue
In-Reply-To: <20100211160733.GB2942@mrnibble.lshift.net>
References: <b2514e8a1002100941p43a5c75fs446ea35701220789@mail.gmail.com>
	<20100211160733.GB2942@mrnibble.lshift.net>
Message-ID: <b2514e8a1002120548s5f26f01fxef6efc2e8058675e@mail.gmail.com>

Thanks for your response.
As per my code each thread is using different channel.
May I get any  multi threaded C client samples?
Could you please let me know the constraints also?

thanks,
Ragavendra.


On Thu, Feb 11, 2010 at 9:37 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi,
>
> I'm afraid the RabbitMQ-C client is highly experimental and not really
> receiving much development attention at the moment. We would not
> recommend it for production use - it has not been through our QA
> processes. I'm fairly sure that you need to make sure that you don't use
> a channel from more than one thread, but I have a feeling there are even
> more constraints than that. I'm afraid, if in doubt, don't use the C
> client, at the moment.
>
> Matthew
>
> On Wed, Feb 10, 2010 at 05:41:49PM +0000, raghu a wrote:
> > Hi,
> >
> > I am very new to RabbitMQ. we are using Rabbit MQ C API to talk with the
> > broker.
> > We are playing with the examples(with few modifications) given by
> RabbitMQ.
> > We created one producer and one consumer with the same connection but
> > difference channels.
> > In the following code amqp_channel_open(conn, 2) statement is causing the
> my
> > main thread to block
> > but if i move this statement before creating of consumer thread then
> every
> > thing seems to be working.
> >
> > My code is as follows.
> > static void send_batch(amqp_connection_
> > state_t conn,
> >                        char const *queue_name,
> >                        int rate_limit,
> >                        int message_count)
> > {
> >   char message[256] = "test";
> >   die_on_error(amqp_basic_publish(conn,
> >                                     2,
> >                                     amqp_cstring_bytes("amq.direct"),
> >                                     amqp_cstring_bytes(queue_name),
> >                                     0,
> >                                     0,
> >                                     NULL,
> >                                     (amqp_bytes_t) {.len =
> sizeof(message),
> > .bytes = message}),
> >                  "Publishing");
> >     printf("Message sent by producer\n");
> > }
> >
> > static void run(amqp_connection_state_t conn)
> > {
> >   amqp_frame_t frame;
> >   int result;
> >   size_t body_received;
> >   size_t body_target;
> >   int  received = 0;
> >   while (1) {
> >     amqp_maybe_release_buffers(conn);
> >     result = amqp_simple_wait_frame(conn, &frame);
> >     if (result <= 0) return;
> >     if (frame.frame_type != AMQP_FRAME_METHOD)
> >       continue;
> >     if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
> >       continue;
> >     result = amqp_simple_wait_frame(conn, &frame);
> >     if (result <= 0) return;
> >     if (frame.frame_type != AMQP_FRAME_HEADER) {
> >       abort();
> >     }
> >     body_target = frame.payload.properties.body_size;
> >     body_received = 0;
> >     while (body_received < body_target) {
> >       result = amqp_simple_wait_frame(conn, &frame);
> >       if (result <= 0) return;
> >       if (frame.frame_type != AMQP_FRAME_BODY) {
> >     abort();
> >       }
> >       body_received += frame.payload.body_fragment.len;
> >       assert(body_received <= body_target);
> >     }
> >     received++;
> >     printf("received=%d\n",received);
> >   }
> > }
> > void*  consume(void* conn){
> >   run(*((amqp_connection_state_t*)conn));
> > }
> > int main(int argc, char const * const *argv) {
> >   char const *hostname="127.0.0.1";
> >   int port="5672";
> >   char const *exchange;
> >   char const *bindingkey;
> >   int sockfd;
> >   amqp_connection_state_t conn;
> >   amqp_bytes_t queuename;
> >   exchange = "amq.direct"; //argv[3];
> >   bindingkey = "test queue"; //argv[4];
> >   int rate_limit = 100;
> >   int message_count = 10000;
> >   conn = amqp_new_connection();
> >   die_on_error(sockfd = amqp_open_socket(hostname, port), "Opening
> socket");
> >   amqp_set_sockfd(conn, sockfd);
> >   die_on_amqp_error(amqp_login(conn, "/", 0, 131072, 0,
> > AMQP_SASL_METHOD_PLAIN, "guest", "guest"),
> >             "Logging in");
> >   amqp_channel_open(conn, 1);
> >   die_on_amqp_error(amqp_rpc_reply, "Opening channel");
> >   {
> >     amqp_queue_declare_ok_t *r = amqp_queue_declare(conn, 1,
> > AMQP_EMPTY_BYTES, 0, 0, 0, 1,
> >                             AMQP_EMPTY_TABLE);
> >     die_on_amqp_error(amqp_rpc_reply, "Declaring queue");
> >     queuename = amqp_bytes_malloc_dup(r->queue);
> >     if (queuename.bytes == NULL) {
> >       die_on_error(-ENOMEM, "Copying queue name");
> >     }
> >   }
> >   amqp_queue_bind(conn, 1, queuename, amqp_cstring_bytes(exchange),
> > amqp_cstring_bytes(bindingkey),
> >           AMQP_EMPTY_TABLE);
> >   die_on_amqp_error(amqp_rpc_reply, "Binding queue");
> >
> >   amqp_basic_consume(conn, 1, queuename, AMQP_EMPTY_BYTES, 0, 1, 0);
> >   die_on_amqp_error(amqp_rpc_reply, "Consuming");
> >   pthread_t threadId;
> >   pthread_create(&threadId,NULL,consume,(void*)&conn);
> >   sleep(1);
> >   amqp_channel_open(conn, 2);
> >   send_batch(conn, "test queue", rate_limit, message_count);
> >   die_on_amqp_error(amqp_channel_close(conn, 1, AMQP_REPLY_SUCCESS),
> > "Closing channel");
> >   die_on_amqp_error(amqp_connection_close(conn, AMQP_REPLY_SUCCESS),
> > "Closing connection");
> >   amqp_destroy_connection(conn);
> >   die_on_error(close(sockfd), "Closing socket");
> >   return 0;
> > }
> >
> > Please provide me the reasons for blocking.
> >
> > Thanks,
> > Ragavendra.
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100212/220ff64a/attachment.htm 

From peter.fitzgibbons at gmail.com  Fri Feb 12 15:13:58 2010
From: peter.fitzgibbons at gmail.com (Peter Fitzgibbons)
Date: Fri, 12 Feb 2010 09:13:58 -0600
Subject: [rabbitmq-discuss] Changing hostname under rabbitmq-server
Message-ID: <670a00381002120713s3b446c53v8ac345900f84cb5@mail.gmail.com>

HI Folks,

My newbie status is visible in this problem.
I'm wanting to use Alice/Wonderland to monitor my RabbitMQ instance.
Unfortunately, my hostname at the time if RabbitMQ install was
'vm-peter-u804B'  -- no domain
So, I changed the system hostname to 'vm-peter-u804B.peter' (/etc/hosts and
/etc/hostname).  hostname and hostname -s show 'vm-peter-u804B.peter' and
'vm-peter-u804B'
I have rebooted several times.

Now rabbit fails to start with /var/log/rabbitmq/startup_log :

node          : rabbit at vm-peter-u804B
app descriptor:
/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : x3xctmeBS7wtsHr18+Og1w==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit

starting database             ...timeout
{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_durable_route,rabbit_durable_exchange,rabbit_durable_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}

Could anyone shed light on how to make Rabbit/Mnesia happy again?

Peter Fitzgibbons
(847) 859-9550
Email: peter.fitzgibbons at gmail.com
IM GTalk: peter.fitzgibbons
IM AOL: peter.fitzgibbons at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100212/38b0d740/attachment.htm 

From rtrlists at googlemail.com  Fri Feb 12 15:51:34 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Fri, 12 Feb 2010 15:51:34 +0000
Subject: [rabbitmq-discuss] Changing hostname under rabbitmq-server
In-Reply-To: <670a00381002120713s3b446c53v8ac345900f84cb5@mail.gmail.com>
References: <670a00381002120713s3b446c53v8ac345900f84cb5@mail.gmail.com>
Message-ID: <6a3ae47e1002120751h7c5372d9tf0d3642de1e36901@mail.gmail.com>

On Fri, Feb 12, 2010 at 3:13 PM, Peter Fitzgibbons <
peter.fitzgibbons at gmail.com> wrote:

> HI Folks,
>
> My newbie status is visible in this problem.
> I'm wanting to use Alice/Wonderland to monitor my RabbitMQ instance.
> Unfortunately, my hostname at the time if RabbitMQ install was
> 'vm-peter-u804B'  -- no domain
> So, I changed the system hostname to 'vm-peter-u804B.peter' (/etc/hosts and
> /etc/hostname).  hostname and hostname -s show 'vm-peter-u804B.peter' and
> 'vm-peter-u804B'
> I have rebooted several times.
>
> Now rabbit fails to start with /var/log/rabbitmq/startup_log :
>
> node          : rabbit at vm-peter-u804B
> app descriptor:
> /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
> home dir      : /var/lib/rabbitmq
> cookie hash   : x3xctmeBS7wtsHr18+Og1w==
> log           : /var/log/rabbitmq/rabbit.log
> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>
> starting database             ...timeout
> {"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_durable_route,rabbit_durable_exchange,rabbit_durable_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
>
> Could anyone shed light on how to make Rabbit/Mnesia happy again?
>
>
>
The Erlang Mnesia database is host specific (because it is a distributed
DB). The simplest way to get you fixed is to clear out the database dir.
That's assuming that you can stand losing any persisted exchanges etc. The
persisted messages are also stored in that folder, but not in Mnesia.

If you need to keep any persisted exchanges, queues, message etc. then that
is a bit harder.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100212/28c1d02c/attachment.htm 

From matthias at lshift.net  Fri Feb 12 17:15:15 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 12 Feb 2010 17:15:15 +0000
Subject: [rabbitmq-discuss] RabbitMQ SNMP Plugin Updates: Now with a
 counter for total messages delivered to queues
In-Reply-To: <8DA0F323-EAE4-4BC3-9F0D-648250ABD774@epicadvertising.com>
References: <8DA0F323-EAE4-4BC3-9F0D-648250ABD774@epicadvertising.com>
Message-ID: <4B758CA3.2050504@lshift.net>

Scott,

Scott Brooks wrote:
> I've updated the RabbitMQ SNMP plugin available at
> http://github.com/epicadvertising/rabbitmq_snmp_plugin
> 
> Highlights: 
> Tracing delivery messages to queues so you can pull the total number
> of messages delivered.

I see you are using erlang:trace for that. Neat! Ultimately I don't 
think we'll go that route for high-churn stats like message counts, 
since tracing is probably not sufficiently efficient for that. And, as 
you say, it is brittle w.r.t. broker API changes. But until we have 
baked better stats gathering into the broker core, erlang:trace is hard 
to beat in terms of concision and non-intrusiveness.


Regards,

Matthias.



From majek04 at gmail.com  Fri Feb 12 17:33:02 2010
From: majek04 at gmail.com (majek04)
Date: Fri, 12 Feb 2010 17:33:02 +0000
Subject: [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)
	writing to queue
In-Reply-To: <ebcef6281002082141k23ab03b1nbafbcd18995eadc9@mail.gmail.com>
References: <50813759-fff9-4b51-9ecd-6cefa3610e21@o3g2000yqb.googlegroups.com>
	<ebcef6281002050537g21d3b018y94518f0036e35bc3@mail.gmail.com>
	<4B6DCEB4.4050309@lshift.net>
	<ebcef6281002070333x11c756bfq3d033093ce522fef@mail.gmail.com>
	<ebcef6281002072354h2d53613bj3c4041b8b8cf9259@mail.gmail.com>
	<4B7079B8.1030409@lshift.net>
	<ebcef6281002082141k23ab03b1nbafbcd18995eadc9@mail.gmail.com>
Message-ID: <3bb0d9711002120933k6b0f01c5h45fc579aebab0ec0@mail.gmail.com>

> I like the design principles of pika, but the example of demo_relay.py is a
> little hard going. Can you point me at any other real-world examples of
> asyncore-based connection handling? And what is the recommended way to
> detect/handle connection-failure?

1. There are no real-world examples of Pika deployment. It's still
very experimental as far as I know.

2. There is no recommended way to handle connection failure.
For the connect phase, I sometimes use:
    conn = pika.AsyncoreConnection(params)
    try:
        ch = conn.channel()
    except pika.exceptions.ConnectionClosed:
        do stuff

But the bigger problem is if connection is killed once you connected.
Feel free to tweak the sources and let us know what works best
for you.

Cheers,
   Marek Majkowski



From peter.fitzgibbons at gmail.com  Fri Feb 12 23:32:26 2010
From: peter.fitzgibbons at gmail.com (Peter Fitzgibbons)
Date: Fri, 12 Feb 2010 17:32:26 -0600
Subject: [rabbitmq-discuss] Bad cookie when clustering
Message-ID: <670a00381002121532l44115794q70dff26fc08bc70b@mail.gmail.com>

Hello All,

I have servers : vmrabbita, vmrabbitb, vmrabbitc
RabbitMQ 1.7.1
All 3 have the same /var/lib/rabbitmq/.erlang.cookie

a and c are clustered successfully.

b gives me this

 rabbitmqctl cluster rabbit at vmrabbita
Clustering node rabbit at vmrabbitb with [rabbit at vmrabbita] ...
Error: {unable_to_join_cluster,
           [rabbit at vmrabbita],
           {merge_schema_failed,
               "Bad cookie in table definition rabbit_durable_queue:
rabbit at vmrabbitb = {cstruct,rabbit_durable_queue,set,[],[rabbit at vmrabbitb
],[],0,read_write,[],[],false,amqqueue,[name,durable,auto_delete,arguments,pid],[],[],{{1266,16863,365586},rabbit at vmrabbitb},{{2,0},[]}},
rabbit at vmrabbita = {cstruct,rabbit_durable_queue,set,[],[rabbit at vmrabbitc
,rabbit at vmrabbita
],[],0,read_write,[],[],false,amqqueue,[name,durable,auto_delete,arguments,pid],[],[],{{1266,14484,94839},rabbit at vmrabbita
},{{4,0},{rabbit at vmrabbitc,{1266,16151,144423}}}}\n"}}

The machines are VMs and actually clones of each other, so I have no belief
that there is any "corruption" going on.
I have uninstalled and reinstalled rabbitmq-server on b.

I have removed the Mnesia db at /var/lib/rabbitmq/mnesia/rabbit and
restarted rabbitmq-server

There is nothing important on the servers.  Any forceful-reset including
data-deletion is welcome.

Could someone direct me to the appropriate change to try to fix this?


Peter Fitzgibbons
(847) 859-9550
Email: peter.fitzgibbons at gmail.com
IM GTalk: peter.fitzgibbons
IM AOL: peter.fitzgibbons at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100212/a5472082/attachment.htm 

From 0x6e6562 at gmail.com  Sat Feb 13 02:45:43 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 13 Feb 2010 12:45:43 +1000
Subject: [rabbitmq-discuss] more complex java client examples
In-Reply-To: <B408C3622F5D2B4AB861EB388F3E4F9631AC91@psi-srv01.PSIINC.local>
References: <B408C3622F5D2B4AB861EB388F3E4F9631AC8A@psi-srv01.PSIINC.local> 
	<09A652A655774D899593FFA2F0631C56@PSIINC.local>
	<B408C3622F5D2B4AB861EB388F3E4F9631AC91@psi-srv01.PSIINC.local>
Message-ID: <-1496826391421288612@unknownmsgid>

Adam,

On 13 Feb 2010, at 00:33, "Adam Crain"
<adam.crain at plymouthsystems.com> wrote:

> Hi Ben,
>
> No I haven't, but thanks for the tip. Is it written on top of the
> support client as an optional layer?


Yes, it's an attempt at providing some generic patterns that people
tend to implement themselves on top of the core client library. The
Java message patterns library began life as a port of the .NET message
patterns library.
>

Ben



From mabrek at gmail.com  Sat Feb 13 13:01:07 2010
From: mabrek at gmail.com (mabrek)
Date: Sat, 13 Feb 2010 16:01:07 +0300
Subject: [rabbitmq-discuss] Erlang coding style convention and emacs setup
Message-ID: <4B76A293.3060204@gmail.com>

Hello!

Is there a coding style convention (indentation, tabs/spaces, names, etc.) for RabbitMQ and plugins? What kind of tools (emacs settings) do you use to format your code accordingly?

Regards,
Anton Lebedevich.



From mmistroni at gmail.com  Sat Feb 13 15:03:08 2010
From: mmistroni at gmail.com (Marco Mistroni)
Date: Sat, 13 Feb 2010 15:03:08 +0000
Subject: [rabbitmq-discuss] rabbitmq console
Message-ID: <7e346e131002130703h4158a3f5tee613efb3e58124c@mail.gmail.com>

Hello all
 is there a rabbitmq console, for administering queues etc?

thanks and regards
marco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100213/38d32399/attachment.htm 

From pauljones23 at gmail.com  Sat Feb 13 15:25:49 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Sat, 13 Feb 2010 15:25:49 +0000
Subject: [rabbitmq-discuss] rabbitmq console
In-Reply-To: <7e346e131002130703h4158a3f5tee613efb3e58124c@mail.gmail.com>
References: <7e346e131002130703h4158a3f5tee613efb3e58124c@mail.gmail.com>
Message-ID: <29598b611002130725o4912699x4635e5fe086537de@mail.gmail.com>

Hi Marco,

Have a look at BQL (http://www.rabbitmq.com/rabbitmq-bql.html).

At the moment you still need to build it from source, but once you've done
that, it gives you a SQL-like language for administering the broker.

Paul.

On Sat, Feb 13, 2010 at 3:03 PM, Marco Mistroni <mmistroni at gmail.com> wrote:

> Hello all
>  is there a rabbitmq console, for administering queues etc?
>
> thanks and regards
> marco
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100213/80454160/attachment.htm 

From gmr at myyearbook.com  Sat Feb 13 15:26:41 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 13 Feb 2010 10:26:41 -0500
Subject: [rabbitmq-discuss] rabbitmq console
In-Reply-To: <7e346e131002130703h4158a3f5tee613efb3e58124c@mail.gmail.com>
References: <7e346e131002130703h4158a3f5tee613efb3e58124c@mail.gmail.com>
Message-ID: <af1bce591002130726h6ea3c254s988918afb4744339@mail.gmail.com>

Hi Marco,

We released something to augment rabbitmq_ctl called bunny which lets
you administer queues, bindings, etc.

http://github.com/myYearbook/bunny

Regards,

Gavin

On Sat, Feb 13, 2010 at 10:03 AM, Marco Mistroni <mmistroni at gmail.com> wrote:
> Hello all
> ?is there a rabbitmq console, for administering queues etc?
>
> thanks and regards
> marco
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthew at lshift.net  Sat Feb 13 18:12:48 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sat, 13 Feb 2010 18:12:48 +0000
Subject: [rabbitmq-discuss] Erlang coding style convention and emacs
 setup
In-Reply-To: <4B76A293.3060204@gmail.com>
References: <4B76A293.3060204@gmail.com>
Message-ID: <20100213181248.GA13780@wellquite.org>

Hi Anton,

On Sat, Feb 13, 2010 at 04:01:07PM +0300, mabrek wrote:
> Is there a coding style convention (indentation, tabs/spaces, names, etc.) for RabbitMQ and plugins? What kind of tools (emacs settings) do you use to format your code accordingly?

Obviously you're free to do your own thing. We just use emacs, with its
erlang-mode and its default indentation style. Tabs are the work of the
devil, and names should be as descriptive as possible. No real surprises
there at all.

Matthew



From roman.yakovenko at gmail.com  Sun Feb 14 20:08:58 2010
From: roman.yakovenko at gmail.com (Roman Yakovenko)
Date: Sun, 14 Feb 2010 22:08:58 +0200
Subject: [rabbitmq-discuss] starting rabbitmq server as a regular user
Message-ID: <7465b6171002141208v894c527ke8eb111430b24571@mail.gmail.com>

Hello.

I am developing client for RabbitMQ. Actually I am wrapping an
existing one. For testing purpose, I would like to start/stop server
as a regular user.

Is it possible to achieve this?

Any help is appreciated.

Thank you.

-- 
Roman Yakovenko
C++ Python language binding
http://www.language-binding.net/



From 0x6e6562 at gmail.com  Mon Feb 15 04:31:45 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 15 Feb 2010 04:31:45 +0000
Subject: [rabbitmq-discuss] Codegen and Python 3.x (was: more complex java
	client examples)
Message-ID: <269388e31002142031i156549b8sc307cdcd00b660a@mail.gmail.com>

John,

On Sun, Feb 14, 2010 at 10:34 AM, John Apps <johndapps at gmail.com> wrote:
> Am I right in assuming that codegen.py requires Python 2.6 and NOT Python
> 3.1? The latter throws lots of syntax error messages, especially on the
> print statements as these do not use brackets "(".
> Or did I miss a qualifier when starting Python?

I don't quite follow how this question relates to the message patterns
library, hence I'm de-threading it.

I can't recall running the codegen under Python 3.x myself, but
potentially others have. Because of this, it is generally a good idea
to CC the list for all correspondence, somebody else might be able to
answer your question.

Ben



From a.raghu001 at gmail.com  Mon Feb 15 06:35:34 2010
From: a.raghu001 at gmail.com (raghu a)
Date: Mon, 15 Feb 2010 12:05:34 +0530
Subject: [rabbitmq-discuss] rabbit mq C++ client library
Message-ID: <b2514e8a1002142235g197aa71ajc59638b9b2b9ffaa@mail.gmail.com>

Hi,

We will develop telecoms billing software for the clients.
Our application is implemented in C++.
we are thinking of using Rabbit MQ messaging services between different
processes of our application.

Did you implement C++ client API to talk with the broker?

Thanks,
Ragavendra.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/9eff814e/attachment.htm 

From akalend at mail.ru  Mon Feb 15 08:25:46 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Mon, 15 Feb 2010 11:25:46 +0300
Subject: [rabbitmq-discuss]
	=?windows-1251?q?rabbit_mq_C++_client_library?=
In-Reply-To: <b2514e8a1002142235g197aa71ajc59638b9b2b9ffaa@mail.gmail.com>
References: <b2514e8a1002142235g197aa71ajc59638b9b2b9ffaa@mail.gmail.com>
Message-ID: <E1NgwH4-00057s-00.akalend-mail-ru@f272.mail.ru>


> Hi,
> 
> We will develop telecoms billing software for the clients.
> Our application is implemented in C++.
> we are thinking of using Rabbit MQ messaging services between different
> processes of our application.
> 
> Did you implement C++ client API to talk with the broker?
> 
> Thanks,
> Ragavendra.

The two realozation
- librabbitmq implement C
- carrot  project implement C++  http://code.google.com/p/carrot-rabbit/

Alexandre



From alexis.richardson at gmail.com  Mon Feb 15 08:32:35 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 15 Feb 2010 08:32:35 +0000
Subject: [rabbitmq-discuss] rabbit mq C++ client library
In-Reply-To: <E1NgwH4-00057s-00.akalend-mail-ru@f272.mail.ru>
References: <b2514e8a1002142235g197aa71ajc59638b9b2b9ffaa@mail.gmail.com>
	<E1NgwH4-00057s-00.akalend-mail-ru@f272.mail.ru>
Message-ID: <167204d21002150032u73a083d2j2d16d5d8a641fd70@mail.gmail.com>

Alexandre

On Mon, Feb 15, 2010 at 8:25 AM, Alexandre Kalendarev <akalend at mail.ru> wrote:
>
> - carrot ?project implement C++ ?http://code.google.com/p/carrot-rabbit/

I cannot find any code here - do you know where it is?

alexis



From a.raghu001 at gmail.com  Mon Feb 15 09:41:17 2010
From: a.raghu001 at gmail.com (raghu a)
Date: Mon, 15 Feb 2010 15:11:17 +0530
Subject: [rabbitmq-discuss] rabbit mq C++ client library
In-Reply-To: <167204d21002150032u73a083d2j2d16d5d8a641fd70@mail.gmail.com>
References: <b2514e8a1002142235g197aa71ajc59638b9b2b9ffaa@mail.gmail.com>
	<E1NgwH4-00057s-00.akalend-mail-ru@f272.mail.ru>
	<167204d21002150032u73a083d2j2d16d5d8a641fd70@mail.gmail.com>
Message-ID: <b2514e8a1002150141l11b23198tf5e875507dc70e44@mail.gmail.com>

Hi,

We are playing with the C examples(with few modifications) given by
RabbitMQ.
We created one producer and one consumer with the same connection but
difference channels. Every thing seems to be working fine.

Then I modified the code to create 2 producers and 2 consumers in different
threads(i.e. total 4 threads)
which caused my application is in to deadlock situation. Here each producer
and consumer are sharing the same connection
but are using different channels.

I would like to know which API calls are blocking and needs to handle
specially?

May i get any multi threaded C API samples?

thanks,
Ragavendra


On Mon, Feb 15, 2010 at 2:02 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Alexandre
>
> On Mon, Feb 15, 2010 at 8:25 AM, Alexandre Kalendarev <akalend at mail.ru>
> wrote:
> >
> > - carrot  project implement C++  http://code.google.com/p/carrot-rabbit/
>
> I cannot find any code here - do you know where it is?
>
> alexis
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/0622c550/attachment.htm 

From Alister.Morton at tradition.com  Mon Feb 15 10:15:24 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 15 Feb 2010 10:15:24 +0000
Subject: [rabbitmq-discuss] rabbit mq C++ client library
In-Reply-To: <167204d21002150032u73a083d2j2d16d5d8a641fd70@mail.gmail.com>
References: <b2514e8a1002142235g197aa71ajc59638b9b2b9ffaa@mail.gmail.com>
	<E1NgwH4-00057s-00.akalend-mail-ru@f272.mail.ru>
	<167204d21002150032u73a083d2j2d16d5d8a641fd70@mail.gmail.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066F23667648@SVR-2K3-BH-EMC.tradition.int>


> I cannot find any code here - do you know where it is?

When I did a subversion checkout form there all I got was an empty directory. So it looks like it's a WIP and currently hasn't been updated.

I'm also considering looking at a C++ interface to Rabbit as we use systems written in Java, C# and C++ simultaneously and a common messaging interface would be good. I don't really fancy trying to wrap a COM interface around the rabbit.net libraries to make them work with (MS) C++

Alister Morton
Tradition
Tel: 020 7198 5821

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From alexis.richardson at gmail.com  Mon Feb 15 10:18:37 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 15 Feb 2010 10:18:37 +0000
Subject: [rabbitmq-discuss] rabbit mq C++ client library
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891066F23667648@SVR-2K3-BH-EMC.tradition.int>
References: <b2514e8a1002142235g197aa71ajc59638b9b2b9ffaa@mail.gmail.com>
	<E1NgwH4-00057s-00.akalend-mail-ru@f272.mail.ru>
	<167204d21002150032u73a083d2j2d16d5d8a641fd70@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E7891066F23667648@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <167204d21002150218s15e1bebane12cb7785255ff6d@mail.gmail.com>

According to Alexandre, in a conv that slipped off-list, the owner of
the project seems to have removed the code.

So - who is up for taking a lead on a C++ client, perhaps based on
Tony's C client?

a



On Mon, Feb 15, 2010 at 10:15 AM, Alister Morton
<Alister.Morton at tradition.com> wrote:
>
>> I cannot find any code here - do you know where it is?
>
> When I did a subversion checkout form there all I got was an empty directory. So it looks like it's a WIP and currently hasn't been updated.
>
> I'm also considering looking at a C++ interface to Rabbit as we use systems written in Java, C# and C++ simultaneously and a common messaging interface would be good. I don't really fancy trying to wrap a COM interface around the rabbit.net libraries to make them work with (MS) C++
>
> Alister Morton
> Tradition
> Tel: 020 7198 5821
>
> The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthew at lshift.net  Mon Feb 15 11:37:23 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Feb 2010 11:37:23 +0000
Subject: [rabbitmq-discuss] starting rabbitmq server as a regular user
In-Reply-To: <7465b6171002141208v894c527ke8eb111430b24571@mail.gmail.com>
References: <7465b6171002141208v894c527ke8eb111430b24571@mail.gmail.com>
Message-ID: <20100215113720.GA26772@mrnibble.lshift.net>

On Sun, Feb 14, 2010 at 10:08:58PM +0200, Roman Yakovenko wrote:
> I am developing client for RabbitMQ. Actually I am wrapping an
> existing one. For testing purpose, I would like to start/stop server
> as a regular user.
> 
> Is it possible to achieve this?

Yes. We internally develop Rabbit as normal users. Rabbit needs no
special permissions at all to run. All it needs is to be able to write
to its logs and mnesia and various other files. Due to tradition, under
most sensible platforms, this is installed as the "rabbitmq" user, which
is a perfectly normal (albeit daemon) user. However, if you're building
from source, then a make run from the rabbitmq-server directory will
suffice to start Rabbit up as yourself. You may or may not consider that
a security risk - up to you!

Matthew



From roman.yakovenko at gmail.com  Mon Feb 15 13:40:29 2010
From: roman.yakovenko at gmail.com (Roman Yakovenko)
Date: Mon, 15 Feb 2010 15:40:29 +0200
Subject: [rabbitmq-discuss] starting rabbitmq server as a regular user
In-Reply-To: <20100215113720.GA26772@mrnibble.lshift.net>
References: <7465b6171002141208v894c527ke8eb111430b24571@mail.gmail.com>
	<20100215113720.GA26772@mrnibble.lshift.net>
Message-ID: <7465b6171002150540l1e85f83fy41f92444b6c18118@mail.gmail.com>

On Mon, Feb 15, 2010 at 1:37 PM, Matthew Sackman <matthew at lshift.net> wrote:
> On Sun, Feb 14, 2010 at 10:08:58PM +0200, Roman Yakovenko wrote:
>> I am developing client for RabbitMQ. Actually I am wrapping an
>> existing one. For testing purpose, I would like to start/stop server
>> as a regular user.
>>
>> Is it possible to achieve this?
>
> Yes. We internally develop Rabbit as normal users. Rabbit needs no
> special permissions at all to run. All it needs is to be able to write
> to its logs and mnesia and various other files. Due to tradition, under
> most sensible platforms, this is installed as the "rabbitmq" user, which
> is a perfectly normal (albeit daemon) user. However, if you're building
> from source, then a make run from the rabbitmq-server directory will
> suffice to start Rabbit up as yourself. You may or may not consider that
> a security risk - up to you!

Thanks. I've managed to build and run Rabbit from the source,

The only place, I was forced to modify Rabbit source, was
"rabbitmq-multi" file to change PIDS_FILE location:

sed -i "s%PIDS_FILE=/var/lib/rabbitmq/pids%PIDS_FILE=$SOME_DIR/var/lib/rabbitmq/pids%"
$SOME_DIR/bin/rabbitmq-multi

Other than that everything looks very nice.

Thank you.

-- 
Roman Yakovenko
C++ Python language binding
http://www.language-binding.net/



From matthew at lshift.net  Mon Feb 15 18:21:58 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Feb 2010 18:21:58 +0000
Subject: [rabbitmq-discuss] Bad cookie when clustering
In-Reply-To: <670a00381002121532l44115794q70dff26fc08bc70b@mail.gmail.com>
References: <670a00381002121532l44115794q70dff26fc08bc70b@mail.gmail.com>
Message-ID: <20100215182158.GB23769@mrnibble.lshift.net>

Hi Peter,

On Fri, Feb 12, 2010 at 05:32:26PM -0600, Peter Fitzgibbons wrote:
> I have servers : vmrabbita, vmrabbitb, vmrabbitc
> RabbitMQ 1.7.1
> All 3 have the same /var/lib/rabbitmq/.erlang.cookie
> 
> a and c are clustered successfully.
> 
> b gives me this
> 
>  rabbitmqctl cluster rabbit at vmrabbita
> Clustering node rabbit at vmrabbitb with [rabbit at vmrabbita] ...
> Error: {unable_to_join_cluster,
>            [rabbit at vmrabbita],
>            {merge_schema_failed,

That normally suggests mnesia is not empty. On vmrabbitb, run
rabbitmqctl stop_app
rabbitmqctl reset

You should then be able to cluster
rabbitmqctl cluster vmrabbita vmrabbitb
rabbitmqctl start_app

Do let us know how you get on.

Matthew



From scottblanc at gmail.com  Mon Feb 15 18:54:13 2010
From: scottblanc at gmail.com (scott w)
Date: Mon, 15 Feb 2010 10:54:13 -0800
Subject: [rabbitmq-discuss] Problem stopping and starting rabbitmq (branch
	bug21673)
Message-ID: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>

We've been using bug21673 and we are having trouble stopping and starting a
rabbitmq instance. Looking in the logs, we get the output below after
running rabbitmq-server stop. Also in the past I have seen "bad rpc node
down" and never knew what that meant or how to fix it. Does rabbitmqctrl
stop-app and rabbitmq-server stop do the same or fundamentally diffferent
things? An explanation of the difference would be helpful.

thanks,
Scott

{error_logger,{{2010,2,15},{18,7,57}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}^M
{error_logger,{{2010,2,15},{18,7,57}},crash_report,[[{pid,<0.22.0>},{registered_name,net_kernel},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p,5}]}},{initial_call,{gen,init_it,[gen_server,<0.19.0>,<0.19.0>,{local,net_kernel},net_kernel,{rabbit,shortnames,15000},[]]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.8>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,23},{reductions,484}],[]]}^M
{error_logger,{{2010,2,15},{18,7,57}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}^M
{error_logger,{{2010,2,15},{18,7,57}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}^M
{error_logger,{{2010,2,15},{18,7,57}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{exit,{shutdown,{kernel,start,[normal,[]]}},[{application_master,init,4},{proc_lib,init_p,5}]}},{initial_call,{application_master,init,[<0.6.0>,<0.7.0>,{appl_data,kernel,[application_controller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_sup,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,global_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[application,application_controller,application_master,application_starter,auth,code,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_server,file_io_server,prim_file,global,global_group,global_search,group,heart,hipe_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,inet_gethost_native,inet_tcp_dist,init,kernel,kernel_config,net,net_adm,net_kernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_server,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,gen_sctp,prim_inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,inet_sctp,pg2,seq_trace,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,23},{reductions,127}],[]]}^M
{error_logger,{{2010,2,15},{18,7,57}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}^M
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}^
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/269c54a6/attachment.htm 

From scottblanc at gmail.com  Mon Feb 15 19:40:20 2010
From: scottblanc at gmail.com (scott w)
Date: Mon, 15 Feb 2010 11:40:20 -0800
Subject: [rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch
	bug21673)
Message-ID: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>

We are also noticing that rabbitmq branch bug 21673 seems to hang after
placing a severe amount of load on it. I don't know erlang but is there some
way I can do a thread dump to send to you guys to help determine what the
problem might be?

thanks,
Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/b6a802de/attachment.htm 

From matthew at lshift.net  Mon Feb 15 20:03:33 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Feb 2010 20:03:33 +0000
Subject: [rabbitmq-discuss] Problem stopping and starting rabbitmq
 (branch bug21673)
In-Reply-To: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>
References: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>
Message-ID: <20100215200332.GA7472@wellquite.org>

Hi Scott,

On Mon, Feb 15, 2010 at 10:54:13AM -0800, scott w wrote:
> We've been using bug21673 and we are having trouble stopping and starting a
> rabbitmq instance. Looking in the logs, we get the output below after
> running rabbitmq-server stop. Also in the past I have seen "bad rpc node
> down" and never knew what that meant or how to fix it. Does rabbitmqctrl
> stop-app and rabbitmq-server stop do the same or fundamentally diffferent
> things? An explanation of the difference would be helpful.

They should do the same thing. This one is very odd - it looks like tcp
listeners are being started as the Erlang VM kernel is being shutdown.
I've never seen this before, but I'd be slightly surprised if it's
unique to 21673. Can you reproduce this at all on the default branch?
Also, which version of Erlang are you running? 12B3 is the minimum for
that branch, and 13B03 is recommended.

Matthew



From matthew at lshift.net  Mon Feb 15 20:10:14 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Feb 2010 20:10:14 +0000
Subject: [rabbitmq-discuss] Problem concurrency isue with rabbitmq
 (branch bug21673)
In-Reply-To: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>
References: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>
Message-ID: <20100215201014.GB7472@wellquite.org>

On Mon, Feb 15, 2010 at 11:40:20AM -0800, scott w wrote:
> We are also noticing that rabbitmq branch bug 21673 seems to hang after
> placing a severe amount of load on it. I don't know erlang but is there some
> way I can do a thread dump to send to you guys to help determine what the
> problem might be?

Let me guess. You send an awful lot of messages into RabbitMQ, and then
you start reading from the queue, and you find it takes some time before
the first message pops out?

If so, that's entirely expected. What you're seeing is the fact that
writes, being async, allow a large backlog of pending disk activity to
grow, bounded by available RAM. When a read occurs, except in some
special circumstances, you have no choice but to let those writes hit
disk before you can read them - you can't risk a read overtaking a
write.

However, that said, I'm now thinking that there are some situations in
which allowing a read to have a higher priority than a write would be
safe... I shall have a play. If you could confirm that this is the
scenario you're seeing that'd be great. In general, you should be able
to identify this situation by a high(ish) load average, but no CPU
activity and your disks being burnt to a cinder. A 15kRPM SAS Fiber
Channel 8-disk RAID 0 array /may/ help here :P

Matthew



From akhil.kodali at gmail.com  Mon Feb 15 20:14:32 2010
From: akhil.kodali at gmail.com (akhil)
Date: Mon, 15 Feb 2010 12:14:32 -0800 (PST)
Subject: [rabbitmq-discuss] message in queue
Message-ID: <99f8bdb8-15ec-4786-bac5-1dbf2388770f@u5g2000prd.googlegroups.com>

Hi,

I am using mq through nanite.
I have noticed that a few messages spend way too much in the queue,
due to which duplicate reposting of message occurs.
Is there any way to track the life cycle of a message in the queue.
For eg how much time the message has spent in the queue.

Thank you.
Akhil



From scottblanc at gmail.com  Mon Feb 15 20:24:00 2010
From: scottblanc at gmail.com (scott w)
Date: Mon, 15 Feb 2010 12:24:00 -0800
Subject: [rabbitmq-discuss] Problem stopping and starting rabbitmq
	(branch bug21673)
In-Reply-To: <20100215200332.GA7472@wellquite.org>
References: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>
	<20100215200332.GA7472@wellquite.org>
Message-ID: <401b577e1002151224g41ac47b4y7414d5cb5be0e4c0@mail.gmail.com>

On Mon, Feb 15, 2010 at 12:03 PM, Matthew Sackman <matthew at lshift.net>wrote:

> Hi Scott,
>
> On Mon, Feb 15, 2010 at 10:54:13AM -0800, scott w wrote:
> > We've been using bug21673 and we are having trouble stopping and starting
> a
> > rabbitmq instance. Looking in the logs, we get the output below after
> > running rabbitmq-server stop. Also in the past I have seen "bad rpc node
> > down" and never knew what that meant or how to fix it. Does rabbitmqctrl
> > stop-app and rabbitmq-server stop do the same or fundamentally diffferent
> > things? An explanation of the difference would be helpful.
>
> They should do the same thing. This one is very odd - it looks like tcp
> listeners are being started as the Erlang VM kernel is being shutdown.
> I've never seen this before, but I'd be slightly surprised if it's
> unique to 21673. Can you reproduce this at all on the default branch?
>

Unfortunately no. To be honest, everything works fine on small loads. We are
using that branch for very large loads where the number of tasks don't fit
into memory. So while the problem itself may not be specific to this branch,
I haven't seen this problem in the default branch because the default can't
handle the loads we're generating.


> Also, which version of Erlang are you running? 12B3 is the minimum for
> that branch, and 13B03 is recommended.
>

12B-4 is what we're building from source. What benefits would we get from
upgrading to 13B03?

Btw, are there any special rabbitmq/erlang commands or tools we can run to
verify that rabbimq is healthy beyond running rabbitmqctl and looking at
logs? I find the logs rather cryptic sometimes.

thanks,
Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/6e8f9b05/attachment.htm 

From matthew at lshift.net  Mon Feb 15 20:29:42 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Feb 2010 20:29:42 +0000
Subject: [rabbitmq-discuss] Problem stopping and starting rabbitmq
 (branch bug21673)
In-Reply-To: <401b577e1002151224g41ac47b4y7414d5cb5be0e4c0@mail.gmail.com>
References: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>
	<20100215200332.GA7472@wellquite.org>
	<401b577e1002151224g41ac47b4y7414d5cb5be0e4c0@mail.gmail.com>
Message-ID: <20100215202942.GC7472@wellquite.org>

Hi Scott,

On Mon, Feb 15, 2010 at 12:24:00PM -0800, scott w wrote:
> On Mon, Feb 15, 2010 at 12:03 PM, Matthew Sackman <matthew at lshift.net>wrote:
> > They should do the same thing. This one is very odd - it looks like tcp
> > listeners are being started as the Erlang VM kernel is being shutdown.
> > I've never seen this before, but I'd be slightly surprised if it's
> > unique to 21673. Can you reproduce this at all on the default branch?
> 
> Unfortunately no. To be honest, everything works fine on small loads. We are
> using that branch for very large loads where the number of tasks don't fit
> into memory. So while the problem itself may not be specific to this branch,
> I haven't seen this problem in the default branch because the default can't
> handle the loads we're generating.

Right. We have another suspicion, that you may be stopping rabbit with
rabbitmqctl stop_app and then using something in /etc/init.d to start
Rabbit. stop_app only stops the rabbit application running within the
Erlang VM. It doesn't stop the erlang VM itself. Hence the difference
between rabbitmqctl stop and rabbitmqctl stop_app. Could that be what's
going on?

> > Also, which version of Erlang are you running? 12B3 is the minimum for
> > that branch, and 13B03 is recommended.
> >
> 
> 12B-4 is what we're building from source. What benefits would we get from
> upgrading to 13B03?

Thousands of bug fixes, and a much better GC.

> Btw, are there any special rabbitmq/erlang commands or tools we can run to
> verify that rabbimq is healthy beyond running rabbitmqctl and looking at
> logs? I find the logs rather cryptic sometimes.

Generally, provided something like rabbitmqctl list_queues is
responsive, all is well. If that starts taking several seconds to
respond then Rabbit's under heavy load, but that doesn't mean anything's
going wrong, just that it's got a lot to do.

We've always written Rabbit very defensively - if it starts to go wrong,
it'll explode hard, quickly. So in general, if it's up and running and
doing something, then it's usually quite happy.

Matthew



From scottblanc at gmail.com  Mon Feb 15 20:36:12 2010
From: scottblanc at gmail.com (scott w)
Date: Mon, 15 Feb 2010 12:36:12 -0800
Subject: [rabbitmq-discuss] Problem concurrency isue with rabbitmq
	(branch bug21673)
In-Reply-To: <20100215201014.GB7472@wellquite.org>
References: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>
	<20100215201014.GB7472@wellquite.org>
Message-ID: <401b577e1002151236k7e9895d5xff1b12ed64a11d29@mail.gmail.com>

Hi Matthew --

I'm not sure that's the problem. Things were running fine for a day or so
and then all the sudden we found our ruby and java clients could not longer
pull things out of the queue. I have a little multi-threaded performance
tool I use which just writes out some messages and reads back the same
messages on a single queue and I have never had a problem with it before.
When I pointed it at the machine that had high load and which the clients
weren't able to connect to, it was not able to receive any messages at all
even after sitting there for a minute. When I pointed it at the other
machine it was working fine. Interestingly, after some time the 2nd machine
which had similarly high load (we round robin queue tasks across two
machines) stopped working after a few hours as well.

Let me know what other info I can give you to help diagnose this.

thanks,
Scott

On Mon, Feb 15, 2010 at 12:10 PM, Matthew Sackman <matthew at lshift.net>wrote:

> On Mon, Feb 15, 2010 at 11:40:20AM -0800, scott w wrote:
> > We are also noticing that rabbitmq branch bug 21673 seems to hang after
> > placing a severe amount of load on it. I don't know erlang but is there
> some
> > way I can do a thread dump to send to you guys to help determine what the
> > problem might be?
>
> Let me guess. You send an awful lot of messages into RabbitMQ, and then
> you start reading from the queue, and you find it takes some time before
> the first message pops out?
>
> If so, that's entirely expected. What you're seeing is the fact that
> writes, being async, allow a large backlog of pending disk activity to
> grow, bounded by available RAM. When a read occurs, except in some
> special circumstances, you have no choice but to let those writes hit
> disk before you can read them - you can't risk a read overtaking a
> write.
>
> However, that said, I'm now thinking that there are some situations in
> which allowing a read to have a higher priority than a write would be
> safe... I shall have a play. If you could confirm that this is the
> scenario you're seeing that'd be great. In general, you should be able
> to identify this situation by a high(ish) load average, but no CPU
> activity and your disks being burnt to a cinder. A 15kRPM SAS Fiber
> Channel 8-disk RAID 0 array /may/ help here :P
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/f634f7dc/attachment.htm 

From matthew at lshift.net  Mon Feb 15 20:41:28 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Feb 2010 20:41:28 +0000
Subject: [rabbitmq-discuss] Problem concurrency isue with rabbitmq
 (branch bug21673)
In-Reply-To: <401b577e1002151236k7e9895d5xff1b12ed64a11d29@mail.gmail.com>
References: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>
	<20100215201014.GB7472@wellquite.org>
	<401b577e1002151236k7e9895d5xff1b12ed64a11d29@mail.gmail.com>
Message-ID: <20100215204128.GD7472@wellquite.org>

Hi Scott,

Thanks for the extra information. There was a bug which I fixed today
which maybe could have been causing you issues. Please make sure you
update to the latest on 21673 and do let me know if you see it again.

Of course, it could just be that at that time, all the channels were
blocked, preventing publishes, due to high memory loads. This can take a
little while to dealt with, especially in Erlang prior to R13 - the GC
in R13 is much faster at reclaiming and releasing memory, thus the
throttling doesn't tend to stay active for as long.

Matthew



From scottblanc at gmail.com  Mon Feb 15 20:47:19 2010
From: scottblanc at gmail.com (scott w)
Date: Mon, 15 Feb 2010 12:47:19 -0800
Subject: [rabbitmq-discuss] Problem concurrency isue with rabbitmq
	(branch bug21673)
In-Reply-To: <20100215204128.GD7472@wellquite.org>
References: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>
	<20100215201014.GB7472@wellquite.org>
	<401b577e1002151236k7e9895d5xff1b12ed64a11d29@mail.gmail.com>
	<20100215204128.GD7472@wellquite.org>
Message-ID: <401b577e1002151247y4e754d4av43519baef9ae24e6@mail.gmail.com>

Ok thanks. I will update to tip and also update erlang. You mention all the
channels were blocked. Is there a way to up the # channels?

On Mon, Feb 15, 2010 at 12:41 PM, Matthew Sackman <matthew at lshift.net>wrote:

> Hi Scott,
>
> Thanks for the extra information. There was a bug which I fixed today
> which maybe could have been causing you issues. Please make sure you
> update to the latest on 21673 and do let me know if you see it again.
>
> Of course, it could just be that at that time, all the channels were
> blocked, preventing publishes, due to high memory loads. This can take a
> little while to dealt with, especially in Erlang prior to R13 - the GC
> in R13 is much faster at reclaiming and releasing memory, thus the
> throttling doesn't tend to stay active for as long.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/111c73bc/attachment.htm 

From matthew at lshift.net  Mon Feb 15 20:51:40 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Feb 2010 20:51:40 +0000
Subject: [rabbitmq-discuss] Problem concurrency isue with rabbitmq
 (branch bug21673)
In-Reply-To: <401b577e1002151247y4e754d4av43519baef9ae24e6@mail.gmail.com>
References: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>
	<20100215201014.GB7472@wellquite.org>
	<401b577e1002151236k7e9895d5xff1b12ed64a11d29@mail.gmail.com>
	<20100215204128.GD7472@wellquite.org>
	<401b577e1002151247y4e754d4av43519baef9ae24e6@mail.gmail.com>
Message-ID: <20100215205140.GA12051@wellquite.org>

On Mon, Feb 15, 2010 at 12:47:19PM -0800, scott w wrote:
> Ok thanks. I will update to tip and also update erlang. You mention all the
> channels were blocked. Is there a way to up the # channels?

Err yes. Make more channels in the client. But the blocking of publishers
is a global thing, in order to stop Rabbit running out of memory, and to
give it a chance to process load. You really have no choice but to sit
it out. I would recommend you try and measure the throughput you're
getting out of your disk drives. There may be some tuning that can be
done there (or just throw more hardware at the problem).

Matthew



From scottblanc at gmail.com  Mon Feb 15 20:59:47 2010
From: scottblanc at gmail.com (scott w)
Date: Mon, 15 Feb 2010 12:59:47 -0800
Subject: [rabbitmq-discuss] Problem concurrency isue with rabbitmq
	(branch bug21673)
In-Reply-To: <20100215205140.GA12051@wellquite.org>
References: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>
	<20100215201014.GB7472@wellquite.org>
	<401b577e1002151236k7e9895d5xff1b12ed64a11d29@mail.gmail.com>
	<20100215204128.GD7472@wellquite.org>
	<401b577e1002151247y4e754d4av43519baef9ae24e6@mail.gmail.com>
	<20100215205140.GA12051@wellquite.org>
Message-ID: <401b577e1002151259j392434e8i3de5c3a1b8b5eeb@mail.gmail.com>

On Mon, Feb 15, 2010 at 12:51 PM, Matthew Sackman <matthew at lshift.net>wrote:

> On Mon, Feb 15, 2010 at 12:47:19PM -0800, scott w wrote:
> > Ok thanks. I will update to tip and also update erlang. You mention all
> the
> > channels were blocked. Is there a way to up the # channels?
>
> Err yes. Make more channels in the client.


Nevermind I was thinking of something else.



> But the blocking of publishers
> is a global thing, in order to stop Rabbit running out of memory, and to
> give it a chance to process load. You really have no choice but to sit
> it out. I would recommend you try and measure the throughput you're
> getting out of your disk drives. There may be some tuning that can be
> done there (or just throw more hardware at the problem).
>

Ok thanks for the info.

cheers,
Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/996eaf46/attachment.htm 

From scottblanc at gmail.com  Mon Feb 15 21:55:09 2010
From: scottblanc at gmail.com (scott w)
Date: Mon, 15 Feb 2010 13:55:09 -0800
Subject: [rabbitmq-discuss] Problem stopping and starting rabbitmq
	(branch bug21673)
In-Reply-To: <20100215202942.GC7472@wellquite.org>
References: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>
	<20100215200332.GA7472@wellquite.org>
	<401b577e1002151224g41ac47b4y7414d5cb5be0e4c0@mail.gmail.com>
	<20100215202942.GC7472@wellquite.org>
Message-ID: <401b577e1002151355g6ef895c5nda81177433d773e0@mail.gmail.com>

On Mon, Feb 15, 2010 at 12:29 PM, Matthew Sackman <matthew at lshift.net>wrote:

> Hi Scott,
>
> On Mon, Feb 15, 2010 at 12:24:00PM -0800, scott w wrote:
> > On Mon, Feb 15, 2010 at 12:03 PM, Matthew Sackman <matthew at lshift.net
> >wrote:
> > > They should do the same thing. This one is very odd - it looks like tcp
> > > listeners are being started as the Erlang VM kernel is being shutdown.
> > > I've never seen this before, but I'd be slightly surprised if it's
> > > unique to 21673. Can you reproduce this at all on the default branch?
> >
> > Unfortunately no. To be honest, everything works fine on small loads. We
> are
> > using that branch for very large loads where the number of tasks don't
> fit
> > into memory. So while the problem itself may not be specific to this
> branch,
> > I haven't seen this problem in the default branch because the default
> can't
> > handle the loads we're generating.
>
> Right. We have another suspicion, that you may be stopping rabbit with
> rabbitmqctl stop_app and then using something in /etc/init.d to start
> Rabbit. stop_app only stops the rabbit application running within the
> Erlang VM. It doesn't stop the erlang VM itself. Hence the difference
> between rabbitmqctl stop and rabbitmqctl stop_app. Could that be what's
> going on?
>

I don't think so. I haven't been using that command on these machines. But
it's possible someone else tried running that command without telling me :)


>
> > > Also, which version of Erlang are you running? 12B3 is the minimum for
> > > that branch, and 13B03 is recommended.
> > >
> >
> > 12B-4 is what we're building from source. What benefits would we get from
> > upgrading to 13B03?
>
> Thousands of bug fixes, and a much better GC.
>

Great.


>
> > Btw, are there any special rabbitmq/erlang commands or tools we can run
> to
> > verify that rabbimq is healthy beyond running rabbitmqctl and looking at
> > logs? I find the logs rather cryptic sometimes.
>
> Generally, provided something like rabbitmqctl list_queues is
> responsive, all is well. If that starts taking several seconds to
> respond then Rabbit's under heavy load, but that doesn't mean anything's
> going wrong, just that it's got a lot to do.
>
> We've always written Rabbit very defensively - if it starts to go wrong,
> it'll explode hard, quickly. So in general, if it's up and running and
> doing something, then it's usually quite happy.
>

Ok good to know.

thanks,
Scott


>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/3af8432e/attachment.htm 

From joelh at planetjoel.com  Mon Feb 15 23:51:31 2010
From: joelh at planetjoel.com (Joel Heenan)
Date: Tue, 16 Feb 2010 10:51:31 +1100
Subject: [rabbitmq-discuss] beam process using 100% cpu and lots of memory
Message-ID: <4f89225b1002151551p1cccdf63uccb1a44fb902d320@mail.gmail.com>

We are having a situation where when we put lots of data through a
RabbitMQ queue we sometimes we see a beam process running using 100%
cpu and up to 1.5GB (RSS) of memory. The only way to resolve this
situation is to restart RabbitMQ.

We are trying to trace down the exact conditions that cause the
problem, and I hope to also post up an strace and lsof of what it is
doing during this time and log messages.

I could not find anything particularly interesting in the rabbitmq.log file.

We are talking a very large number of connections here, 1807334
connections in 17 hours, or 29/second.

We started using RabbitMQ Stomp Server 1.6.0-5 then moved to version
latest public umbrella (as of 24 hours ago). OS is Centos 5.4 x86_64
Xen domU with 4GB of RAM and 1VCPU.

We are using persistent mode on the queues, currently testing with
non-persistent.

Joel



From joelh at planetjoel.com  Tue Feb 16 00:15:05 2010
From: joelh at planetjoel.com (Joel Heenan)
Date: Tue, 16 Feb 2010 11:15:05 +1100
Subject: [rabbitmq-discuss] beam process using 100% cpu and lots of
	memory
In-Reply-To: <4f89225b1002151551p1cccdf63uccb1a44fb902d320@mail.gmail.com>
References: <4f89225b1002151551p1cccdf63uccb1a44fb902d320@mail.gmail.com>
Message-ID: <4f89225b1002151615m3fe28c2aka16141d1cf34aa7b@mail.gmail.com>

Here is the memory stats over the period of the test, it looks like
either a memory leak or an overwhelmed queue

05:30:01 AM   1763568   2430736     57.95     69700   1600004
524224        56      0.01        28
05:40:02 AM   1726492   2467812     58.84     71920   1602944
524224        56      0.01        28
05:50:01 AM   1685448   2508856     59.82     74044   1600452
524224        56      0.01        28
06:00:01 AM   1642048   2552256     60.85     76196   1603092
524224        56      0.01        28
06:10:01 AM   1705784   2488520     59.33     78352   1605564
524224        56      0.01        28
06:20:01 AM   1637576   2556728     60.96     80492   1603172
524224        56      0.01        28
06:30:01 AM   1640544   2553760     60.89     82628   1605768
524224        56      0.01        28
06:40:01 AM   1583628   2610676     62.24     84812   1608044
524224        56      0.01        28
06:50:01 AM   1549156   2645148     63.07     86988   1609996
524224        56      0.01        28
07:00:02 AM   1511584   2682720     63.96     89096   1608384
524224        56      0.01        28
07:10:01 AM   1540352   2653952     63.28     91232   1610184
524224        56      0.01        28
07:20:01 AM   1459132   2735172     65.21     93348   1612432
524224        56      0.01        28
07:30:01 AM   1451352   2742952     65.40     95508   1610720
524224        56      0.01        28
07:40:01 AM   1432380   2761924     65.85     97584   1612848
524224        56      0.01        28
07:50:01 AM   1428536   2765768     65.94     99688   1614412
524224        56      0.01        28
08:00:01 AM   1368272   2826032     67.38    101796   1613104
524224        56      0.01        28
08:10:01 AM   1465116   2729188     65.07    103880   1615952
524224        56      0.01        28
08:20:01 AM   1297096   2897208     69.07    105996   1616300
524224        56      0.01        28

08:20:01 AM kbmemfree kbmemused  %memused kbbuffers  kbcached
kbswpfree kbswpused  %swpused  kbswpcad
08:30:01 AM   1430024   2764280     65.91    108100   1614892
524224        56      0.01        28
08:40:01 AM   1434116   2760188     65.81    110192   1616732
524224        56      0.01        28
08:50:01 AM   1355624   2838680     67.68    112292   1618260
524224        56      0.01        28
09:00:01 AM   1384888   2809416     66.98    114392   1616824
524224        56      0.01        28
09:10:01 AM   1322020   2872284     68.48    116512   1618640
524224        56      0.01        28
09:20:01 AM   1350416   2843888     67.80    118588   1620196
524224        56      0.01        28
09:30:01 AM   1288168   2906136     69.29    120552   1618764
524224        56      0.01        28
09:40:01 AM   1316688   2877616     68.61    122464   1621272
524224        56      0.01        28
09:50:01 AM   1264980   2929324     69.84    124332   1621928
524224        56      0.01        28
10:00:01 AM   1208312   2985992     71.19    126224   1620688
524224        56      0.01        28
10:10:01 AM   1248612   2945692     70.23    128116   1622132
524224        56      0.01        28
10:20:01 AM   1203352   2990952     71.31    129988   1623552
524224        56      0.01        28
10:30:01 AM   1150900   3043404     72.56    131956   1624752
524224        56      0.01        28
10:40:01 AM   1206052   2988252     71.25    133784   1623780
524224        56      0.01        28
10:50:01 AM   1165628   3028676     72.21    135696   1625208
524224        56      0.01        28
11:00:01 AM   1116516   3077788     73.38    137752   1626512
524224        56      0.01        28
11:10:01 AM   1083664   3110640     74.16    139676   1625464
524224        56      0.01        28
11:20:02 AM   1136612   3057692     72.90    141476   1626764
524224        56      0.01        28
11:30:01 AM   1086816   3107488     74.09    143212   1628084
524224        56      0.01        28
11:40:01 AM   1064444   3129860     74.62    144904   1627028
524224        56      0.01        28
11:50:01 AM   1022780   3171524     75.62    146432   1628300
524224        56      0.01        28
12:00:01 PM    994012   3200292     76.30    147836   1629516
524224        56      0.01        28
12:10:01 PM    959664   3234640     77.12    149232   1628632
524224        56      0.01        28
12:20:01 PM   1020424   3173880     75.67    150804   1629820
524224        56      0.01        28
12:30:01 PM    995128   3199176     76.27    152356   1631076
524224        56      0.01        28
12:40:01 PM    964624   3229680     77.00    153756   1630080
524224        56      0.01        28
12:50:01 PM    941808   3252496     77.55    155244   1631252
524224        56      0.01        28
01:00:01 PM   1073620   3120684     74.40    156788   1632452
524224        56      0.01        28
01:10:01 PM    955820   3238484     77.21    158220   1634520
524224        56      0.01        28
01:20:01 PM    845956   3348348     79.83    159824   1632592
524224        56      0.01        28
01:30:01 PM   1102916   3091388     73.70    161404   1599240
524224        56      0.01        28
01:40:02 PM   1121392   3072912     73.26    162788   1600240
524224        56      0.01        28
01:50:01 PM   1009040   3185264     75.94    164124   1599448
524224        56      0.01        28
02:00:01 PM   1012024   3182280     75.87    165396   1600556
524224        56      0.01        28
02:10:01 PM   1057160   3137144     74.80    167168   1601672
524224        56      0.01        28
02:20:01 PM    948412   3245892     77.39    168644   1600828
524224        56      0.01        28
02:30:01 PM    976064   3218240     76.73    170444   1601896
524224        56      0.01        28
02:40:01 PM   1020828   3173476     75.66    172188   1602980
524224        56      0.01        28
02:50:01 PM    915180   3279124     78.18    173896   1602140
524224        56      0.01        28
03:00:01 PM    943700   3250604     77.50    175272   1603268
524224        56      0.01        28
03:10:01 PM    991440   3202864     76.36    176732   1604232
524224        56      0.01        28
03:20:01 PM    887776   3306528     78.83    178040   1603504
524224        56      0.01        28
03:30:01 PM    919024   3275280     78.09    179368   1604472
524224        56      0.01        28
03:40:01 PM    814492   3379812     80.58    180856   1605532
524224        56      0.01        28
03:50:02 PM    867440   3326864     79.32    182364   1604792
524224        56      0.01        28
04:00:01 PM    901044   3293260     78.52    184036   1605716
524224        56      0.01        28
04:10:01 PM    798116   3396188     80.97    185396   1606836
524224        56      0.01        28
04:20:01 PM    853428   3340876     79.65    187016   1606068
524224        56      0.01        28
04:30:01 PM    889140   3305164     78.80    188584   1606852
524224        56      0.01        28
04:40:01 PM    787460   3406844     81.23    190032   1608104
524224        56      0.01        28

04:40:01 PM kbmemfree kbmemused  %memused kbbuffers  kbcached
kbswpfree kbswpused  %swpused  kbswpcad
04:50:01 PM    843260   3351044     79.90    191384   1608968
524224        56      0.01        28
05:00:01 PM    745672   3448632     82.22    192864   1608036
524224        56      0.01        28
05:10:01 PM    783120   3411184     81.33    194204   1609228
524224        56      0.01        28
05:20:01 PM    685656   3508648     83.65    195528   1610068
524224        56      0.01        28
05:30:01 PM    745176   3449128     82.23    196644   1609552
524224        56      0.01        28
05:40:01 PM    785104   3409200     81.28    197992   1610360
524224        56      0.01        28
05:50:01 PM    688508   3505796     83.58    199256   1611276
524224        56      0.01        28
06:00:01 PM    750508   3443796     82.11    200444   1610540
524224        56      0.01        28
06:10:01 PM    655276   3539028     84.38    202000   1611308
524224        56      0.01        28
06:20:01 PM    696816   3497488     83.39    203356   1612440
524224        56      0.01        28
06:30:01 PM    605924   3588380     85.55    204868   1611632
524224        56      0.01        28
06:40:01 PM    664700   3529604     84.15    206040   1612872
524224        56      0.01        28
06:50:01 PM    708472   3485832     83.11    207052   1613604
524224        56      0.01        28
07:00:01 PM    612384   3581920     85.40    208612   1612908
524224        56      0.01        28
07:10:01 PM    681564   3512740     83.75    209772   1613916
524224        56      0.01        28
07:20:01 PM    589928   3604376     85.94    210796   1614784
524224        56      0.01        28
07:30:01 PM    638660   3555644     84.77    212148   1613904
524224        56      0.01        28
07:40:01 PM    548512   3645792     86.92    213160   1614812
524224        56      0.01        28
07:50:01 PM    613240   3581064     85.38    214260   1615740
524224        56      0.01        28
08:00:01 PM    524828   3669476     87.49    215192   1616544
524224        56      0.01        28
08:10:01 PM    574180   3620124     86.31    216300   1615872
524224        56      0.01        28
08:20:01 PM    486140   3708164     88.41    217480   1616728
524224        56      0.01        28
08:30:01 PM    552480   3641824     86.83    218604   1617680
524224        56      0.01        28
08:40:01 PM    467788   3726516     88.85    219584   1617024
524224        56      0.01        28
08:50:01 PM    517512   3676792     87.66    220584   1617820
524224        56      0.01        28
09:00:01 PM    431332   3762972     89.72    221584   1618672
524224        56      0.01        28
09:10:01 PM    501888   3692416     88.03    222616   1618176
524224        56      0.01        28
09:20:02 PM    416196   3778108     90.08    223896   1619036
524224        56      0.01        28
09:30:01 PM    467664   3726640     88.85    225136   1619768
524224        56      0.01        28
09:40:01 PM    385452   3808852     90.81    226184   1619152
524224        56      0.01        28
09:50:01 PM    455264   3739040     89.15    227420   1619992
524224        56      0.01        28
10:00:01 PM    371688   3822616     91.14    228248   1620744
524224        56      0.01        28
10:10:01 PM    427364   3766940     89.81    229184   1620160
524224        56      0.01        28
10:20:01 PM    344532   3849772     91.79    230028   1620968
524224        56      0.01        28
10:30:02 PM    416328   3777976     90.07    230912   1621764
524224        56      0.01        28
10:40:01 PM    336596   3857708     91.97    231980   1621176
524224        56      0.01        28
10:50:01 PM    410344   3783960     90.22    233020   1603676
524224        56      0.01        28


On Tue, Feb 16, 2010 at 10:51 AM, Joel Heenan <joelh at planetjoel.com> wrote:
> We are having a situation where when we put lots of data through a
> RabbitMQ queue we sometimes we see a beam process running using 100%
> cpu and up to 1.5GB (RSS) of memory. The only way to resolve this
> situation is to restart RabbitMQ.
>
> We are trying to trace down the exact conditions that cause the
> problem, and I hope to also post up an strace and lsof of what it is
> doing during this time and log messages.
>
> I could not find anything particularly interesting in the rabbitmq.log file.
>
> We are talking a very large number of connections here, 1807334
> connections in 17 hours, or 29/second.
>
> We started using RabbitMQ Stomp Server 1.6.0-5 then moved to version
> latest public umbrella (as of 24 hours ago). OS is Centos 5.4 x86_64
> Xen domU with 4GB of RAM and 1VCPU.
>
> We are using persistent mode on the queues, currently testing with
> non-persistent.
>
> Joel
>



From james.anderson at setf.de  Tue Feb 16 01:58:08 2010
From: james.anderson at setf.de (james anderson)
Date: Tue, 16 Feb 2010 02:58:08 +0100
Subject: [rabbitmq-discuss] ? about rabbitmq 1.7.1 and 7-byte frame headers
Message-ID: <406ADD34-5208-4CA8-A341-F8374F57AAE4@setf.de>

good morning;

a recently built rabbitmq server server indicates - even to the level  
of the response server properties, that it implements "amqp 8-0", but
a. if one connects with a 9-1 version token, it does not disconnect.  
it proceeds to negotiate the connection.
b. it does not use the 8-byte frame headers which appear in every  
instance of the amqp0-8 specification the net had yielded, but rather  
7-byte headers that are specified for 9-1.

neither a scan of the mailing list, nor anything the net could say  
about amqp and errata, of r9.1 v/s r8.0, or ... shed any light on this.
the code in the client frame class suggests that this is somehow the  
way things are supposed to be, but the question remains: why?
does this imply that the r8-0 specification is useful as a dictionary  
for classes/methods/fields, but otherwise obsolete?

thanks,




From matthias at lshift.net  Tue Feb 16 06:04:32 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 16 Feb 2010 06:04:32 +0000
Subject: [rabbitmq-discuss] ? about rabbitmq 1.7.1 and 7-byte frame
	headers
In-Reply-To: <406ADD34-5208-4CA8-A341-F8374F57AAE4@setf.de>
References: <406ADD34-5208-4CA8-A341-F8374F57AAE4@setf.de>
Message-ID: <4B7A3570.80103@lshift.net>

James,

james anderson wrote:
> a recently built rabbitmq server server indicates - even to the level  
> of the response server properties, that it implements "amqp 8-0", but
> a. if one connects with a 9-1 version token, it does not disconnect.  
> it proceeds to negotiate the connection.

That is expected behaviour for a 0-8 broker, at the least by some 
interpretations of the spec - if the client specifies a higher version 
number than supported by the server then negotiation proceeds with the 
server sending the version it supports.

NB: the correct protocol header for 0-9-1 is in fact AMQP 0-0-9-1, 
whereas for 0-8 it is AMQP 1-1-8-0, and for 0-9 it is AMQP 1-1-0-9. Yes, 
that is crazy.

> b. it does not use the 8-byte frame headers which appear in every  
> instance of the amqp0-8 specification the net had yielded, but rather  
> 7-byte headers that are specified for 9-1.

All implementations of 0-8 actually use a 7-byte header. Hence the 
correction in 0-9-1.


Regards,

Matthias.



From james.anderson at setf.de  Tue Feb 16 10:49:47 2010
From: james.anderson at setf.de (james anderson)
Date: Tue, 16 Feb 2010 11:49:47 +0100
Subject: [rabbitmq-discuss] ? about rabbitmq 1.7.1 and 7-byte frame
	headers
In-Reply-To: <4B7A3570.80103@lshift.net>
References: <406ADD34-5208-4CA8-A341-F8374F57AAE4@setf.de>
	<4B7A3570.80103@lshift.net>
Message-ID: <39A3F001-E073-452F-8E81-9A751E2C9A92@setf.de>

good morning;

thank you for clarifying.

On 2010-02-16, at 07:04 , Matthias Radestock wrote:

> James,
>
> james anderson wrote:
>> a recently built rabbitmq server server indicates - even to the  
>> level  of the response server properties, that it implements "amqp  
>> 8-0", but
>> a. if one connects with a 9-1 version token, it does not  
>> disconnect.  it proceeds to negotiate the connection.
>
> That is expected behaviour for a 0-8 broker, at the least by some  
> interpretations of the spec - if the client specifies a higher  
> version number than supported by the server then negotiation  
> proceeds with the server sending the version it supports.

that is to say, page-52/line-38 and the diagrams at page-52/line32  
and page-53/line-11 of amqp8-0.pdf are no more a misrepresentation of  
"accordingly" for a purported r8.0 broker than the indication in  
`amqp-xml-doc0-8.pdf` that it applies to "AMQ Protocol (major=10,  
minor=3)"?

>
> NB: the correct protocol header for 0-9-1 is in fact AMQP 0-0-9-1,  
> whereas for 0-8 it is AMQP 1-1-8-0, and for 0-9 it is AMQP 1-1-0-9.  
> Yes, that is crazy.

cool.
hmmm... what does the ampq 1-1-9-1 protocol header from the r8.0 and  
the r9.1 specs actually mean?
is that what you intended, above, with "AMQP 0-0-9-1"?

>
>> b. it does not use the 8-byte frame headers which appear in every   
>> instance of the amqp0-8 specification the net had yielded, but  
>> rather  7-byte headers that are specified for 9-1.
>
> All implementations of 0-8 actually use a 7-byte header. Hence the  
> correction in 0-9-1.

do these two sentences boggle any other minds?
a naive reader of the r8.0 specification might misconstrue it to  
require, that such a correction would apply to a broker which  
purports to follow the r9.1 spec, but not to broker which purports to  
follow the r8.0 spec. in this light, i have rescanned the r8.0 spec,  
but did not observe any formulations of the order "or any later  
protocol version." ok. anyway, i gather that page-35/line-26 and  
page-53/line-29 of amqp8-0.pdf are history. is there anything else of  
which a naive implementor should be aware?

? is there an amqp8-0-bis.pdf which describes the protocol which  
nominal r8.0 brokers purport to follow?

? is there a document which describes the protocol which the rabbitmq  
broker purports to follows?

? the rabbitmq site did yield a description[1] of r8.0 to r9.1. it  
might make sense were at least that document to indicate differences  
between r8.0  as specified and as implemented. If one is to follow  
this line from that differences document,

  "Framing and connection establishment (modulo the removed frame- 
types and the spec version number advertisement, respectively) are  
identical."

literally rather than respective the specification texts, and if  
there is to be no revision to the r8.0 specification document, there  
would be some value to taking amqp8-0.pdf down, as it requires  
evidently false performance.

? are there actually any r9.0 brokers in the wild?

on a meta level: how does this community achieve interoperability,  
other by knowing each other's code?


------

[1] :  http://dev.rabbitmq.com/wiki/Amqp08To091

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100216/a5a6755e/attachment.htm 

From james.anderson at setf.de  Tue Feb 16 12:01:18 2010
From: james.anderson at setf.de (james anderson)
Date: Tue, 16 Feb 2010 13:01:18 +0100
Subject: [rabbitmq-discuss] ? about rabbitmq 1.7.1 and 7-byte frame
	headers (2)
In-Reply-To: <4B7A3570.80103@lshift.net>
References: <406ADD34-5208-4CA8-A341-F8374F57AAE4@setf.de>
	<4B7A3570.80103@lshift.net>
Message-ID: <6056D360-82FB-4C8E-82F6-D1E3B433BF36@setf.de>

good morning;

still trying to get this straight.

On 2010-02-16, at 07:04 , Matthias Radestock wrote:

> James,
>
> james anderson wrote:
>> a recently built rabbitmq server server indicates - even to the  
>> level  of the response server properties, that it implements "amqp  
>> 8-0", but
>> a. if one connects with a 9-1 version token, it does not  
>> disconnect.  it proceeds to negotiate the connection.
>
> That is expected behaviour for a 0-8 broker, at the least by some  
> interpretations of the spec - if the client specifies a higher  
> version number than supported by the server then negotiation  
> proceeds with the server sending the version it supports.

the phrase, "proceeds with the server sending the version it  
supports", is to mean that the specification's notion of "accepts"  
permits a broker to reply with a Connection.Start with the major and  
minor server properties set to reflect the version it supports, but  
with no required relation to the requested version, and that standard  
practice is to permit just values less than that requested? is the  
behavior specific to rabbitmq? universal to all r8.0 brokers?




From matthew at lshift.net  Tue Feb 16 12:11:04 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 16 Feb 2010 12:11:04 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.7.2 release
Message-ID: <20100216121104.GC23769@mrnibble.lshift.net>

The RabbitMQ team is pleased to announce the release of RabbitMQ 1.7.2.

This release fixes yet more bugs specific to Windows in regards to
memory monitoring, and works around various bat inadequacies.
Other fixes include enforcing codec size limits, and handling some
corner cases of basic.qos.

The rabbitmqctl tool has been extended with several new commands.
There have also been enhancements to the plugin system, and network
performance over high-latency links. The exception reporting in the
Java client has been improved and there are several bug fixes and
enhancements to the AMQP Tracer tool.

For details see the attached release notes.

Binary and source distributions of the new release can be found in the
usual place, at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback
on this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.


Regards,

The RabbitMQ Team



Release: RabbitMQ 1.7.2

Release Highlights
==================

server
------
bug fixes
- fix a number of problems with memory monitoring under Windows,
  including compatibility issues with versions of Erlang/OTP older
  than R13, and 64-bit versions of Windows. See the updated
  documentation at http://www.rabbitmq.com/extensions.html#memsup
- correct various path escaping bugs under Windows that could result
  in RabbitMQ failing to start
- make 'rabbitmq-multi start_all <n>' work again for n>1
- issuing a basic.qos when there are outstanding acks can no longer
  result in a higher limit than requested
- enforce codec size limits, thus preventing the server from sending
  invalid AMQP frames

enhancements
- add rabbitmqctl list_channels and list_consumers commands, and add
  exclusivity information to list_queues. Also introduce a
  close_connection command to allow an administrator to selectively
  terminate client connections. See the updated admin guide at
  http://www.rabbitmq.com/admin-guide.html for details on these new
  features.
- remove the explicit setting of TCP buffer sizes in the server, thus
  allowing auto-(re)sizing to occur. This generally results in
  substantially improved throughput over high-latency links, and makes
  manual fine-tuning easier.
- introduce declarative boot sequencing, which allows plugins to be
  started at arbitrary chosen points during the sequence

Java client
-----------
bug fixes
- ensure that QueuingConsumer throws an ShutdownSignalException in
  *all* consuming threads, not just one
- fix race conditions in 'tracer' tool that could cause it to fail

enhancements
- make exception stack traces more meaningful
- allow overriding of several RpcClient methods, for easier extension
  and re-use
- improve performance of channel creation for high channel counts
- improve performance of 'tracer' tool
- add option to 'tracer' tool to suppress content bodies, which is
  useful for tracing connections carrying a high data volume
- better exception reporting in 'tracer' tool

.net client
-----------
enhancements 
- improve performance of channel creation for high channel counts

building & packaging
--------------------
bug fixes
- under macports, ensure env var settings are passed to the various
  startup and control scripts


Upgrading
=========
The database schema has not changed since the 1.6.0 release, so user
accounts, durable exchanges and queues, and persistent messages will
all be retained during the upgrade.

If, however, you are upgrading from a release prior to 1.6.0, when the
RabbitMQ server detects the presence of an old database, it moves it
to a backup location, creates a fresh, empty database, and logs a
warning. If your RabbitMQ installation contains important data then we
recommend you contact support at rabbitmq.com for assistance with the
upgrade.




From mikeb at lshift.net  Tue Feb 16 12:38:56 2010
From: mikeb at lshift.net (Michael Bridgen)
Date: Tue, 16 Feb 2010 12:38:56 +0000
Subject: [rabbitmq-discuss] ? about rabbitmq 1.7.1 and 7-byte
	frame	headers
In-Reply-To: <39A3F001-E073-452F-8E81-9A751E2C9A92@setf.de>
References: <406ADD34-5208-4CA8-A341-F8374F57AAE4@setf.de>	<4B7A3570.80103@lshift.net>
	<39A3F001-E073-452F-8E81-9A751E2C9A92@setf.de>
Message-ID: <4B7A91E0.10409@lshift.net>

James,

As a preface, let me note that 0-9-1 is in part a rationalisation of the 
specification, and in part an encoding of what brokers actually 
implement.  0-8 had ambiguities and inconsistencies quite aside from the 
more obvious mistakes (like the grammar for the protocol header), but 
what the brokers ended up implementing was by and large consistent.

If you're planning to implement an AMQP peer, personally speaking I 
would go for 0-9-1 and forget about 0-8.  Not only has it fewer 
mistakes, but it is also (or will be soon, see below) a stable point of 
interoperability.

>> james anderson wrote:
>>> a recently built rabbitmq server server indicates - even to the 
>>> level  of the response server properties, that it implements "amqp 
>>> 8-0", but
>>> a. if one connects with a 9-1 version token, it does not disconnect.  
>>> it proceeds to negotiate the connection.
>>
>> That is expected behaviour for a 0-8 broker, at the least by some 
>> interpretations of the spec - if the client specifies a higher version 
>> number than supported by the server then negotiation proceeds with the 
>> server sending the version it supports.

The protocol negotiation is a bit odd.  In the technical spec (PDF) it 
says what you have said above; in the XML it adds the rule "The server 
MUST provide a protocol version that is lower than or equal to that 
requested by the client in the protocol header."

Hence you can have a negotiation which goes:
Client: Hi, I would like to use protocol 0-9-1
Server: Sure!  I support that.  OK, let's use version 0-8
Client: WTF?

So yeah, a bit nuts.

> that is to say, page-52/line-38 and the diagrams at page-52/line32 and 
> page-53/line-11 of amqp8-0.pdf are no more a misrepresentation of 
> "accordingly" for a purported r8.0 broker than the indication in 
> `amqp-xml-doc0-8.pdf` that it applies to "AMQ Protocol (major=10, minor=3)"?
> 
>>
>> NB: the correct protocol header for 0-9-1 is in fact AMQP 0-0-9-1, 
>> whereas for 0-8 it is AMQP 1-1-8-0, and for 0-9 it is AMQP 1-1-0-9. 
>> Yes, that is crazy.
> 
> cool.
> hmmm... what does the ampq 1-1-9-1 protocol header from the r8.0 and the 
> r9.1 specs actually mean?
> is that what you intended, above, with "AMQP 0-0-9-1"?

In 0-9-1 the protocol header is 'AMQP0091'.  The last four digits are 
the constant 0 (protocol-id, whatever that is), then the major, minor 
and revision numbers.  The 0-8 and 0-9 specs gave these digits a 
different meaning (and the first two were effectively constants).

I just tried connecting to a RabbitMQ from default branch and giving a 
0-9-1 header, and it wrote AMQP1180 and closed the connection, as 
specified.  From which branch did you build?

>>> b. it does not use the 8-byte frame headers which appear in every  
>>> instance of the amqp0-8 specification the net had yielded, but 
>>> rather  7-byte headers that are specified for 9-1.
 >>
>> All implementations of 0-8 actually use a 7-byte header. Hence the 
>> correction in 0-9-1.
> 
> do these two sentences boggle any other minds?
> a naive reader of the r8.0 specification might misconstrue it to 
> require, that such a correction would apply to a broker which purports 
> to follow the r9.1 spec, but not to broker which purports to follow the 
> r8.0 spec. in this light, i have rescanned the r8.0 spec, but did not 
> observe any formulations of the order "or any later protocol version." 
> ok. anyway, i gather that page-35/line-26 and page-53/line-29 of 
> amqp8-0.pdf are history. is there anything else of which a naive 
> implementor should be aware?

Many things, I should think, sadly.  The things corrected, or cleared 
up, in 0-9-1 give some indication.

 > [...]

> ? are there actually any r9.0 brokers in the wild?

Qpid's Java broker implements 0-9 and 0-9-1, inter alia.  RabbitMQ has a 
branch implementing 0-9-1 (amqp_0_9_1 in the broker and most of the 
client repos), which should make its way into releases once work on the 
new persister is done.

> on a meta level: how does this community achieve interoperability, other 
> by knowing each other's code?

Also by using each other's code; e.g., we use Qpid's (Python) test 
suites, in part, and they have been using our 0-9-1 (Java) test suite.


mikeb.



From matthew at lshift.net  Tue Feb 16 14:39:23 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 16 Feb 2010 14:39:23 +0000
Subject: [rabbitmq-discuss] Problem stopping and starting rabbitmq
 (branch bug21673)
In-Reply-To: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>
References: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>
Message-ID: <20100216143923.GE23769@mrnibble.lshift.net>

Hi Scott,

Just got *exactly* this error when starting RabbitMQ. There was still a
Rabbit node running with -sname rabbit. Make sure rabbit really has
stopped before starting it up again. ps ax | grep [r]abbit etc etc

Matthew

On Mon, Feb 15, 2010 at 10:54:13AM -0800, scott w wrote:
> We've been using bug21673 and we are having trouble stopping and starting a
> rabbitmq instance. Looking in the logs, we get the output below after
> running rabbitmq-server stop. Also in the past I have seen "bad rpc node
> down" and never knew what that meant or how to fix it. Does rabbitmqctrl
> stop-app and rabbitmq-server stop do the same or fundamentally diffferent
> things? An explanation of the difference would be helpful.
> 
> thanks,
> Scott
> 
> {error_logger,{{2010,2,15},{18,7,57}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}^M
> {error_logger,{{2010,2,15},{18,7,57}},crash_report,[[{pid,<0.22.0>},{registered_name,net_kernel},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p,5}]}},{initial_call,{gen,init_it,[gen_server,<0.19.0>,<0.19.0>,{local,net_kernel},net_kernel,{rabbit,shortnames,15000},[]]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.8>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,23},{reductions,484}],[]]}^M
> {error_logger,{{2010,2,15},{18,7,57}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}^M
> {error_logger,{{2010,2,15},{18,7,57}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}^M
> {error_logger,{{2010,2,15},{18,7,57}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{exit,{shutdown,{kernel,start,[normal,[]]}},[{application_master,init,4},{proc_lib,init_p,5}]}},{initial_call,{application_master,init,[<0.6.0>,<0.7.0>,{appl_data,kernel,[application_controller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_sup,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,global_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[application,application_controller,application_master,application_starter,auth,code,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_server,file_io_server,prim_file,global,global_group,global_search,group,heart,hipe_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,inet_gethost_native,inet_tcp_dist,init,kernel,kernel_con
> fig,net,net_adm,net_kernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_server,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,gen_sctp,prim_inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,inet_sctp,pg2,seq_trace,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,23},{reductions,127}],[]]}^M
> {error_logger,{{2010,2,15},{18,7,57}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}^M
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}^

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From akleak at gmail.com  Tue Feb 16 16:34:00 2010
From: akleak at gmail.com (Arco)
Date: Tue, 16 Feb 2010 08:34:00 -0800 (PST)
Subject: [rabbitmq-discuss] Live Upgrade ??
Message-ID: <c35894f0-e0b5-45a4-b088-6c8407c1b29a@x1g2000prb.googlegroups.com>

I'm an Erlang newbie and am aware of the Erlang features for upgrading
code on a production system with zero downtime.

Does RabbitMQ make use of these features?  Is there any documentation
which shows how to do upgrade a live system, say from 1.7.1 to 1.7.2??

Thanks, Andy



From mark.fine at gmail.com  Tue Feb 16 16:39:01 2010
From: mark.fine at gmail.com (Mark Fine)
Date: Tue, 16 Feb 2010 08:39:01 -0800
Subject: [rabbitmq-discuss] How to change listening port from AMQP default
	on an EC2 AMI?
Message-ID: <fdbe406c1002160839y7a1a0bb3n8c52ce78cabb9329@mail.gmail.com>

Before I go looking through the source code more thoroughly, does anyone know
if there is a minimal change possible to have RabbitMQ listen on a different
port?? I'm using the EC2 AMI and want to avoid having to build RabbitMQ from
scratch to pick up this simple configuration change. I see a handful of
files where the 5672 is hardcoded, but haven't had any luck moving it
around. Thanks!

Mark



From majek04 at gmail.com  Tue Feb 16 17:12:09 2010
From: majek04 at gmail.com (majek04)
Date: Tue, 16 Feb 2010 17:12:09 +0000
Subject: [rabbitmq-discuss] How to change listening port from AMQP
	default on an EC2 AMI?
In-Reply-To: <fdbe406c1002160839y7a1a0bb3n8c52ce78cabb9329@mail.gmail.com>
References: <fdbe406c1002160839y7a1a0bb3n8c52ce78cabb9329@mail.gmail.com>
Message-ID: <3bb0d9711002160912h4029490ofcb0f2c7c5bcd90a@mail.gmail.com>

On Tue, Feb 16, 2010 at 16:39, Mark Fine <mark.fine at gmail.com> wrote:
> Before I go looking through the source code more thoroughly, does anyone know
> if there is a minimal change possible to have RabbitMQ listen on a different
> port?? I'm using the EC2 AMI and want to avoid having to build RabbitMQ from
> scratch to pick up this simple configuration change. I see a handful of
> files where the 5672 is hardcoded, but haven't had any luck moving it
> around. Thanks!

Mark,

RabbitMQ EC2 AMI is just Rabbit .deb package installed on Ubuntu.
The configuration is exactly the same as for Ubuntu/Debian.

In your case, please put
  NODE_PORT=XXXX
into file:
  /etc/rabbitmq/rabbitmq.conf

[1] http://manpages.ubuntu.com/manpages/jaunty/man5/rabbitmq.conf.5.html
[2] http://www.rabbitmq.com/install.html

Cheers,
   Marek Majkowski



From james.anderson at setf.de  Tue Feb 16 18:13:03 2010
From: james.anderson at setf.de (james anderson)
Date: Tue, 16 Feb 2010 19:13:03 +0100
Subject: [rabbitmq-discuss] ? about rabbitmq 1.7.1 and 7-byte
	frame	headers
In-Reply-To: <4B7A91E0.10409@lshift.net>
References: <406ADD34-5208-4CA8-A341-F8374F57AAE4@setf.de>	<4B7A3570.80103@lshift.net>
	<39A3F001-E073-452F-8E81-9A751E2C9A92@setf.de>
	<4B7A91E0.10409@lshift.net>
Message-ID: <34AB5F29-3543-4709-8FF8-4604CDE392BA@setf.de>


On 2010-02-16, at 13:38 , Michael Bridgen wrote:

> James,
>
> As a preface, let me note that 0-9-1 is in part a rationalisation  
> of the specification, and in part an encoding of what brokers  
> actually implement.  0-8 had ambiguities and inconsistencies quite  
> aside from the more obvious mistakes (like the grammar for the  
> protocol header), but what the brokers ended up implementing was by  
> and large consistent.
>
> If you're planning to implement an AMQP peer, personally speaking I  
> would go for 0-9-1 and forget about 0-8.

your note, below, refers to rabbitmq's imminent plans. how does this  
reflect the state and intentions of other brokers?

>   Not only has it fewer mistakes, but it is also (or will be soon,  
> see below) a stable point of interoperability.
>
>>> james anderson wrote:
>>>> a recently built rabbitmq server server indicates - even to the  
>>>> level  of the response server properties, that it implements  
>>>> "amqp 8-0", but
>>>> a. if one connects with a 9-1 version token, it does not  
>>>> disconnect.  it proceeds to negotiate the connection.
>>>
>>> That is expected behaviour for a 0-8 broker, at the least by some  
>>> interpretations of the spec - if the client specifies a higher  
>>> version number than supported by the server then negotiation  
>>> proceeds with the server sending the version it supports.
>
> The protocol negotiation is a bit odd.  In the technical spec (PDF)  
> it says what you have said above; in the XML it adds the rule "The  
> server MUST provide a protocol version that is lower than or equal  
> to that requested by the client in the protocol header."

i must admit, page-8/lines-3-5 of amqp-xml-doc0-8.pdf resisted  
comprehension. in the end, however, the second sentence, can be  
interpreted to restrict the meaning of a lower protocol number to  
indicate only how far down the broker can go, as that sentence  
precludes the broker from sending the start command if it can not  
support the requested - higher - version.
anyway, i take from your remarks, that other implementors reached  
different conclusions.

>
> Hence you can have a negotiation which goes:
> Client: Hi, I would like to use protocol 0-9-1
> Server: Sure!  I support that.  OK, let's use version 0-8
> Client: WTF?
>
> So yeah, a bit nuts.
>
>> that is to say, page-52/line-38 and the diagrams at page-52/line32  
>> and page-53/line-11 of amqp8-0.pdf are no more a misrepresentation  
>> of "accordingly" for a purported r8.0 broker than the indication  
>> in `amqp-xml-doc0-8.pdf` that it applies to "AMQ Protocol  
>> (major=10, minor=3)"?
>>>
>>> NB: the correct protocol header for 0-9-1 is in fact AMQP  
>>> 0-0-9-1, whereas for 0-8 it is AMQP 1-1-8-0, and for 0-9 it is  
>>> AMQP 1-1-0-9. Yes, that is crazy.
>> cool.
>> hmmm... what does the ampq 1-1-9-1 protocol header from the r8.0  
>> and the r9.1 specs actually mean?
>> is that what you intended, above, with "AMQP 0-0-9-1"?
>
> In 0-9-1 the protocol header is 'AMQP0091'.  The last four digits  
> are the constant 0 (protocol-id, whatever that is), then the major,  
> minor and revision numbers.  The 0-8 and 0-9 specs gave these  
> digits a different meaning (and the first two were effectively  
> constants).
>
> I just tried connecting to a RabbitMQ from default branch and  
> giving a 0-9-1 header, and it wrote AMQP1180 and closed the  
> connection, as specified.  From which branch did you build?

from the 1.7.1 release.
i had misunderstood the version-to-header mapping and had, in fact,  
sent it a 0.9r0 protocol header, not a 0.9r1 header. to wit:

? (defparameter *c* (make-instance 'amqp:connection :uri "amqp:// 
guest:guest at localhost/"))
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: open-connection:  
requesting version: #(65 77 81 80 1 1 0 9)/:AMQP-1-1-0-9-1.
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: open-connection:  
byte-zero: 1, updated class to AMQP-1-1-0-9-1:CONNECTION.
[20100216T123124Z00] DEBUG #<CHANNEL [amqp://localhost/].0  
#xF757B2E>: process-command: #<CONNECTION #xF753016>  
#<CONNECTION.START #xF759DEE> . (:VERSION-MAJOR 8 :VERSION-MINOR  
0 :SERVER-PROPERTIES (:|product| "RabbitMQ" :|version| "1.7.1" :| 
platform| "Erlang/OTP" :|copyright| "Copyright (C) 2007-2009 LShift  
Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies  
Ltd." :|information| "Licensed under the MPL.  See http:// 
www.rabbitmq.com/") :MECHANISMS "PLAIN AMQPLAIN" :LOCALES "en_US")
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method:  
START-OK . (:CLIENT-PROPERTIES NIL :MECHANISM "PLAIN" :RESPONSE  
"guestguest" :LOCALE "en_US")
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: encoding:  
CONNECTION.START-OK . (:CLIENT-PROPERTIES NIL :MECHANISM  
"PLAIN" :RESPONSE "guestguest" :LOCALE "en_US")
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method:  
#<CONNECTION.START-OK #xF75A34E>  #<OUTPUT-FRAME [(+)METHOD|0|c.0|t. 
0].{CONNECTION.START-OK}[36/4088: 0 10 0 11 0 0 0 0 ... 115 116 5 101  
110 95 85 83] #xF75A446>
[20100216T123124Z00] DEBUG #<CHANNEL [amqp://localhost/].0  
#xF757B2E>: process-command: #<CONNECTION #xF753016>  
#<CONNECTION.TUNE #xF75B67E> . (:CHANNEL-MAX 0 :FRAME-MAX  
131072 :HEARTBEAT 0)
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method: TUNE- 
OK . (:CHANNEL-MAX 0 :FRAME-MAX 131072 :HEARTBEAT 0)
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: encoding:  
CONNECTION.TUNE-OK . (:CHANNEL-MAX 0 :FRAME-MAX 131072 :HEARTBEAT 0)
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method:  
#<CONNECTION.TUNE-OK #xF75B886>  #<OUTPUT-FRAME [(+)METHOD|0|c.0|t.0]. 
{CONNECTION.TUNE-OK}[12/4088: 0 10 0 31 0 0 0 2 0 0 0 0] #xF75A446>
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method:  
OPEN . (:VIRTUAL-HOST "/")
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: encoding:  
CONNECTION.OPEN . (:VIRTUAL-HOST "/")
[20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method:  
#<CONNECTION.OPEN #xF75BBEE>  #<OUTPUT-FRAME [(+)METHOD|0|c.0|t.0]. 
{CONNECTION.OPEN}[8/4088: 0 10 0 40 1 47 0 0] #xF75A446>
[20100216T123124Z00] DEBUG #<CHANNEL [amqp://localhost/].0  
#xF757B2E>: process-command: #<CONNECTION #xF753016>  
#<CONNECTION.OPEN-OK #xF75BE5E> . NIL
*C*
? (type-of *c*)
AMQP-1-1-0-9-1:CONNECTION

to which it responded with a Connection.Start with a version 8 in the  
properties.
having now rewired it to follow the suggested version->header mapping  
i observe the expected response to a 'standard' 0.9r1 header:

? (defparameter *c* (make-instance 'amqp:connection :uri "amqp:// 
guest:guest at localhost/"))
[20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:  
requesting version: #(65 77 81 80 0 0 9 1)/:AMQP-1-1-0-9-1.
[20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:  
parsed version: #(65 77 81 80 1 1 8 0) / :AMQP-1-1-0-8-0.
[20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:  
updated class to AMQP-1-1-0-8-0:CONNECTION.
[20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:  
requesting version: #(65 77 81 80 1 1 8 0)/:AMQP-1-1-0-8-0.
[20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:  
byte-zero: 1, connection class AMQP-1-1-0-8-0:CONNECTION.
 > Error: Frame length exceeds buffer size: 73728, #<VECTOR 4087 type  
(UNSIGNED-BYTE 8), simple>
 > While executing: CCL::%ASSERTION-FAILURE
 > Type Command-/ to continue, Command-. to abort.
 > If continued: test the assertion again.
See the Restarts? menu item for further choices.
1 >

the frame size error being the same as that which had led yesterday  
to the realization that it was using 7-byte headers.

>
>>>> b. it does not use the 8-byte frame headers which appear in  
>>>> every  instance of the amqp0-8 specification the net had  
>>>> yielded, but rather  7-byte headers that are specified for 9-1.
> >>
>>> All implementations of 0-8 actually use a 7-byte header. Hence  
>>> the correction in 0-9-1.
>> do these two sentences boggle any other minds?
>> a naive reader of the r8.0 specification might misconstrue it to  
>> require, that such a correction would apply to a broker which  
>> purports to follow the r9.1 spec, but not to broker which purports  
>> to follow the r8.0 spec. in this light, i have rescanned the r8.0  
>> spec, but did not observe any formulations of the order "or any  
>> later protocol version." ok. anyway, i gather that page-35/line-26  
>> and page-53/line-29 of amqp8-0.pdf are history. is there anything  
>> else of which a naive implementor should be aware?
>
> Many things, I should think, sadly.  The things corrected, or  
> cleared up, in 0-9-1 give some indication.

what does this imply for the way the broker handles realms and tickets?

is is that
1. every 0.8r0 and 0.9r* broker follows 0.9r1 framing specifications.
2. the respective 0.8 and 0.9 brokers each otherwise implement the  
classes/methods/arguments/rules in the respective .xml version of the  
specification.

?

>
> > [...]
>
>> ? are there actually any r9.0 brokers in the wild?
>
> Qpid's Java broker implements 0-9 and 0-9-1, inter alia.  RabbitMQ  
> has a branch implementing 0-9-1 (amqp_0_9_1 in the broker and most  
> of the client repos), which should make its way into releases once  
> work on the new persister is done.
>
>> on a meta level: how does this community achieve interoperability,  
>> other by knowing each other's code?
>
> Also by using each other's code; e.g., we use Qpid's (Python) test  
> suites, in part, and they have been using our 0-9-1 (Java) test suite.
>
>
> mikeb.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100216/238581fb/attachment.htm 

From alexis.richardson at gmail.com  Tue Feb 16 18:24:38 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 16 Feb 2010 18:24:38 +0000
Subject: [rabbitmq-discuss] ? about rabbitmq 1.7.1 and 7-byte frame
	headers
In-Reply-To: <34AB5F29-3543-4709-8FF8-4604CDE392BA@setf.de>
References: <406ADD34-5208-4CA8-A341-F8374F57AAE4@setf.de>
	<4B7A3570.80103@lshift.net>
	<39A3F001-E073-452F-8E81-9A751E2C9A92@setf.de>
	<4B7A91E0.10409@lshift.net>
	<34AB5F29-3543-4709-8FF8-4604CDE392BA@setf.de>
Message-ID: <167204d21002161024j5c73ad0cpa6b94b7e0495f02f@mail.gmail.com>

James

Just to address your first question, our aim is convergence to 0-91
and this is mutual in that Qpid 0.6 (Java) and OpenAMQ pass enough
0-91 tests to be able to call themselves 0-91 brokers.  Each one has
some unimplemented parts eg OpenAMQ don't do persistence IIRC.  I have
cc'd the relevant folks.  I'm sorry it's taken us so long - there are
some reasons for this but nothing surprising.  Do also note that Qpid
C++ is on 0-10 and will stay there.  In the future there will be an
AMQP 1-0 which will enable even greater convergence, and a wider set
of implementations.

I hope someone else will pick up on your other questions.

Let me know if this helps.

alexis




On Tue, Feb 16, 2010 at 6:13 PM, james anderson <james.anderson at setf.de> wrote:
>
> On 2010-02-16, at 13:38 , Michael Bridgen wrote:
>
> James,
> As a preface, let me note that 0-9-1 is in part a rationalisation of the
> specification, and in part an encoding of what brokers actually implement.
> 0-8 had ambiguities and inconsistencies quite aside from the more obvious
> mistakes (like the grammar for the protocol header), but what the brokers
> ended up implementing was by and large consistent.
> If you're planning to implement an AMQP peer, personally speaking I would go
> for 0-9-1 and forget about 0-8.
>
> your note, below, refers to rabbitmq's imminent plans. how does this reflect
> the state and intentions of other brokers?
>
> ??Not only has it fewer mistakes, but it is also (or will be soon, see
> below) a stable point of interoperability.
>
> james anderson wrote:
>
> a recently built rabbitmq server server indicates - even to the level? of
> the response server properties, that it implements "amqp 8-0", but
> a. if one connects with a 9-1 version token, it does not disconnect.? it
> proceeds to negotiate the connection.
>
> That is expected behaviour for a 0-8 broker, at the least by some
> interpretations of the spec - if the client specifies a higher version
> number than supported by the server then negotiation proceeds with the
> server sending the version it supports.
>
> The protocol negotiation is a bit odd.? In the technical spec (PDF) it says
> what you have said above; in the XML it adds the rule "The server MUST
> provide a protocol version that is lower than or equal to that requested by
> the client in the protocol header."
>
> i must admit, page-8/lines-3-5 of amqp-xml-doc0-8.pdf resisted
> comprehension. in the end, however, the second sentence, can be interpreted
> to restrict the meaning of a lower protocol number to indicate only how far
> down the broker can go, as that sentence precludes the broker from sending
> the start command if it can not support the requested - higher - version.
> anyway, i take from your remarks, that other implementors reached different
> conclusions.
>
> Hence you can have a negotiation which goes:
> Client: Hi, I would like to use protocol 0-9-1
> Server: Sure!? I support that.? OK, let's use version 0-8
> Client: WTF?
> So yeah, a bit nuts.
>
> that is to say, page-52/line-38 and the diagrams at page-52/line32 and
> page-53/line-11 of amqp8-0.pdf are no more a misrepresentation of
> "accordingly" for a purported r8.0 broker than the indication in
> `amqp-xml-doc0-8.pdf` that it applies to "AMQ Protocol (major=10, minor=3)"?
>
> NB: the correct protocol header for 0-9-1 is in fact AMQP 0-0-9-1, whereas
> for 0-8 it is AMQP 1-1-8-0, and for 0-9 it is AMQP 1-1-0-9. Yes, that is
> crazy.
>
> cool.
> hmmm... what does the ampq 1-1-9-1 protocol header from the r8.0 and the
> r9.1 specs actually mean?
> is that what you intended, above, with "AMQP 0-0-9-1"?
>
> In 0-9-1 the protocol header is 'AMQP0091'.? The last four digits are the
> constant 0 (protocol-id, whatever that is), then the major, minor and
> revision numbers.? The 0-8 and 0-9 specs gave these digits a different
> meaning (and the first two were effectively constants).
> I just tried connecting to a RabbitMQ from default branch and giving a 0-9-1
> header, and it wrote AMQP1180 and closed the connection, as specified.? From
> which branch did you build?
>
> from the 1.7.1 release.
> i had misunderstood the version-to-header mapping and had, in fact, sent it
> a 0.9r0 protocol header, not a 0.9r1 header. to wit:
> ? (defparameter *c* (make-instance 'amqp:connection :uri
> "amqp://guest:guest at localhost/"))
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: open-connection:
> requesting version: #(65 77 81 80 1 1 0 9)/:AMQP-1-1-0-9-1.
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: open-connection:
> byte-zero: 1, updated class to AMQP-1-1-0-9-1:CONNECTION.
> [20100216T123124Z00] DEBUG #<CHANNEL [amqp://localhost/].0 #xF757B2E>:
> process-command: #<CONNECTION #xF753016> #<CONNECTION.START #xF759DEE> .
> (:VERSION-MAJOR 8 :VERSION-MINOR 0 :SERVER-PROPERTIES (:|product| "RabbitMQ"
> :|version| "1.7.1" :|platform| "Erlang/OTP" :|copyright| "Copyright (C)
> 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit
> Technologies Ltd." :|information| "Licensed under the MPL.? See
> http://www.rabbitmq.com/") :MECHANISMS "PLAIN AMQPLAIN" :LOCALES "en_US")
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method: START-OK .
> (:CLIENT-PROPERTIES NIL :MECHANISM "PLAIN" :RESPONSE "guestguest" :LOCALE
> "en_US")
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: encoding:
> CONNECTION.START-OK . (:CLIENT-PROPERTIES NIL :MECHANISM "PLAIN"
> :RESPONSE?"guestguest" :LOCALE "en_US")
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method:
> #<CONNECTION.START-OK #xF75A34E>? #<OUTPUT-FRAME
> [(+)METHOD|0|c.0|t.0].{CONNECTION.START-OK}[36/4088: 0 10 0 11 0 0 0 0 ...
> 115 116 5 101 110 95 85 83] #xF75A446>
> [20100216T123124Z00] DEBUG #<CHANNEL [amqp://localhost/].0 #xF757B2E>:
> process-command: #<CONNECTION #xF753016> #<CONNECTION.TUNE #xF75B67E> .
> (:CHANNEL-MAX 0 :FRAME-MAX 131072 :HEARTBEAT 0)
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method: TUNE-OK .
> (:CHANNEL-MAX 0 :FRAME-MAX 131072 :HEARTBEAT 0)
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: encoding:
> CONNECTION.TUNE-OK . (:CHANNEL-MAX 0 :FRAME-MAX 131072 :HEARTBEAT 0)
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method:
> #<CONNECTION.TUNE-OK #xF75B886>? #<OUTPUT-FRAME
> [(+)METHOD|0|c.0|t.0].{CONNECTION.TUNE-OK}[12/4088: 0 10 0 31 0 0 0 2 0 0 0
> 0] #xF75A446>
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method: OPEN .
> (:VIRTUAL-HOST "/")
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: encoding:
> CONNECTION.OPEN . (:VIRTUAL-HOST "/")
> [20100216T123124Z00] DEBUG #<CONNECTION #xF753016>: send-method:
> #<CONNECTION.OPEN #xF75BBEE>? #<OUTPUT-FRAME
> [(+)METHOD|0|c.0|t.0].{CONNECTION.OPEN}[8/4088: 0 10 0 40 1 47 0 0]
> #xF75A446>
> [20100216T123124Z00] DEBUG #<CHANNEL [amqp://localhost/].0 #xF757B2E>:
> process-command: #<CONNECTION #xF753016> #<CONNECTION.OPEN-OK #xF75BE5E> .
> NIL
> *C*
> ? (type-of *c*)
> AMQP-1-1-0-9-1:CONNECTION
> to which it responded with a Connection.Start with a version 8 in the
> properties.
> having now rewired it to follow the suggested version->header mapping i
> observe the expected response to a 'standard' 0.9r1 header:
> ? (defparameter *c* (make-instance 'amqp:connection :uri
> "amqp://guest:guest at localhost/"))
> [20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:
> requesting version: #(65 77 81 80 0 0 9 1)/:AMQP-1-1-0-9-1.
> [20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection: parsed
> version: #(65 77 81 80 1 1 8 0) / :AMQP-1-1-0-8-0.
> [20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:
> updated class to AMQP-1-1-0-8-0:CONNECTION.
> [20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:
> requesting version: #(65 77 81 80 1 1 8 0)/:AMQP-1-1-0-8-0.
> [20100216T180229Z00] DEBUG #<CONNECTION #x102F73F6>: open-connection:
> byte-zero: 1, connection class AMQP-1-1-0-8-0:CONNECTION.
>> Error: Frame length exceeds buffer size: 73728, #<VECTOR 4087 type
>> (UNSIGNED-BYTE 8), simple>
>> While executing: CCL::%ASSERTION-FAILURE
>> Type Command-/ to continue, Command-. to abort.
>> If continued: test the assertion again.
> See the Restarts? menu item for further choices.
> 1 >
> the frame size error being the same as that which had led yesterday to the
> realization that it was using 7-byte headers.
>
> b. it does not use the 8-byte frame headers which appear in every? instance
> of the amqp0-8 specification the net had yielded, but rather? 7-byte headers
> that are specified for 9-1.
>
>>>
>
> All implementations of 0-8 actually use a 7-byte header. Hence the
> correction in 0-9-1.
>
> do these two sentences boggle any other minds?
> a naive reader of the r8.0 specification might misconstrue it to require,
> that such a correction would apply to a broker which purports to follow the
> r9.1 spec, but not to broker which purports to follow the r8.0 spec. in this
> light, i have rescanned the r8.0 spec, but did not observe any formulations
> of the order "or any later protocol version." ok. anyway, i gather that
> page-35/line-26 and page-53/line-29 of amqp8-0.pdf are history. is there
> anything else of which a naive implementor should be aware?
>
> Many things, I should think, sadly.? The things corrected, or cleared up, in
> 0-9-1 give some indication.
>
> what does this imply for the way the broker handles realms and tickets?
> is is that
> 1. every 0.8r0 and 0.9r* broker follows 0.9r1 framing specifications.
> 2. the respective 0.8 and 0.9 brokers each otherwise implement the
> classes/methods/arguments/rules in the respective .xml version of the
> specification.
> ?
>
>> [...]
>
> ? are there actually any r9.0 brokers in the wild?
>
> Qpid's Java broker implements 0-9 and 0-9-1, inter alia.? RabbitMQ has a
> branch implementing 0-9-1 (amqp_0_9_1 in the broker and most of the client
> repos), which should make its way into releases once work on the new
> persister is done.
>
> on a meta level: how does this community achieve interoperability, other by
> knowing each other's code?
>
> Also by using each other's code; e.g., we use Qpid's (Python) test suites,
> in part, and they have been using our 0-9-1 (Java) test suite.
>
> mikeb.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From scottblanc at gmail.com  Tue Feb 16 23:27:51 2010
From: scottblanc at gmail.com (scott w)
Date: Tue, 16 Feb 2010 15:27:51 -0800
Subject: [rabbitmq-discuss] Problem stopping and starting rabbitmq
	(branch bug21673)
In-Reply-To: <20100216143923.GE23769@mrnibble.lshift.net>
References: <401b577e1002151054s2ec7f081v5aeadea1ffbad54b@mail.gmail.com>
	<20100216143923.GE23769@mrnibble.lshift.net>
Message-ID: <401b577e1002161527j3de31b28ybdbf96124dca7467@mail.gmail.com>

Hi Matthew --

I'm normally pretty careful about checking ps but when I get back over to it
I will verify.

thanks,
Scott

On Tue, Feb 16, 2010 at 6:39 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Scott,
>
> Just got *exactly* this error when starting RabbitMQ. There was still a
> Rabbit node running with -sname rabbit. Make sure rabbit really has
> stopped before starting it up again. ps ax | grep [r]abbit etc etc
>
> Matthew
>
> On Mon, Feb 15, 2010 at 10:54:13AM -0800, scott w wrote:
> > We've been using bug21673 and we are having trouble stopping and starting
> a
> > rabbitmq instance. Looking in the logs, we get the output below after
> > running rabbitmq-server stop. Also in the past I have seen "bad rpc node
> > down" and never knew what that meant or how to fix it. Does rabbitmqctrl
> > stop-app and rabbitmq-server stop do the same or fundamentally diffferent
> > things? An explanation of the difference would be helpful.
> >
> > thanks,
> > Scott
> >
> > {error_logger,{{2010,2,15},{18,7,57}},"Protocol: ~p: register error:
> >
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}^M
> >
> {error_logger,{{2010,2,15},{18,7,57}},crash_report,[[{pid,<0.22.0>},{registered_name,net_kernel},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p,5}]}},{initial_call,{gen,init_it,[gen_server,<0.19.0>,<0.19.0>,{local,net_kernel},net_kernel,{rabbit,shortnames,15000},[]]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.8>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,23},{reductions,484}],[]]}^M
> >
> {error_logger,{{2010,2,15},{18,7,57}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}^M
> >
> {error_logger,{{2010,2,15},{18,7,57}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}^M
> >
> {error_logger,{{2010,2,15},{18,7,57}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{exit,{shutdown,{kernel,start,[normal,[]]}},[{application_master,init,4},{proc_lib,init_p,5}]}},{initial_call,{application_master,init,[<0.6.0>,<0.7.0>,{appl_data,kernel,[application_controller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_sup,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,global_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[application,application_controller,application_master,application_starter,auth,code,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_server,file_io_server,prim_file,global,global_group,global_search,group,heart,hipe_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,inet_gethost_native,inet_tcp_dist,init,kernel,kernel_con
> >
> fig,net,net_adm,net_kernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_server,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,gen_sctp,prim_inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,inet_sctp,pg2,seq_trace,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,23},{reductions,127}],[]]}^M
> >
> {error_logger,{{2010,2,15},{18,7,57}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}^M
> > {"Kernel pid
> >
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}^
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100216/a2c4c63d/attachment.htm 

From james.anderson at setf.de  Wed Feb 17 02:26:58 2010
From: james.anderson at setf.de (james anderson)
Date: Wed, 17 Feb 2010 03:26:58 +0100
Subject: [rabbitmq-discuss] a common-lisp amqp client
Message-ID: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>

good morning;

with adjustments made as per the responses to my earlier questions  
about rabbitmq and 0.8r0 brokers in general, i was able to connect  
and exchange elementary messages with the 1.7.1 version of the  
rabbitmq broker[1]. thank you for your assistance.

---
[1]: http://github.com/lisp/de.setf.amqp/blob/master/examples/README- 
rabbitmq.md




From tonyg at lshift.net  Wed Feb 17 06:44:22 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 17 Feb 2010 19:44:22 +1300
Subject: [rabbitmq-discuss] Will this work?
In-Reply-To: <960996F6EFBCB843BFD62DAA96BD1DD81808BE599F@esmail10>
References: <26875409.post@talk.nabble.com>	<167204d21001050554k6f6646d2q53a0fd73d8cb9d77@mail.gmail.com>	<960996F6EFBCB843BFD62DAA96BD1DD818060D1B48@esmail10>	<167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>	<960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>	<4B560E7E.703@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD81808BE5964@esmail10>
	<4B583D16.4030101@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD81808BE599F@esmail10>
Message-ID: <4B7B9046.9000700@lshift.net>

Dinabandhu Mitra wrote:
> Thanks. I must have misunderstood the post. I will change my code to
> have a single shared socket, single shared connection but per thread
> channel.

I would be extremely careful here. The rabbitmq-c library is built with
event-driven, single-threaded applications in mind, and does not yet
cater to any of the requirements of pthreaded applications. I do not
think you will have much luck sharing a single connection between
multiple threads, even using multiple channels. Instead, I would
recommend a separate full *connection* per thread when using the
rabbitmq-c library.

Regards,
  Tony




From tonyg at lshift.net  Wed Feb 17 06:51:12 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 17 Feb 2010 19:51:12 +1300
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
Message-ID: <4B7B91E0.8000805@lshift.net>

Chris Duncan wrote:
> Transactions may give me what I want but I don't think that I should be
> enforcing the use of transactions in my client library just so that it
> will handle Channel.Flow methods properly.

The way channel.flow works, if I understand it correctly, is that the
server sends channel.flow, the client receives it, and eventually sends
a channel.flow-ok in response, which acts as a promise not to send any
more content until another channel.flow lets it continue. The key word
is "eventually", meaning that the server has to give it a little slack,
and sometimes quite a lot of slack, heuristically.

Clients must be permitted to continue sending content frames, and
servers should probably go to reasonable lengths to handle such content
frames, after the channel.flow is sent and before the channel.flow-ok is
received by the server, simply because of the separation between the two
parties.

If you defer emitting your channel.flow-ok until all in-progress
channel.publish operations have cleared the line, then you should be
cool. There should be no need to interact with the transaction machinery
at all. Your client library API should reflect the fact that the client
has been asked and has promised to be silent, perhaps by indicating
failure somehow for *subsequent* publish operations after the
channel.flow is received.

Um. I'm not sure that was the clearest explanation of what I mean :-)
I'm basically trying to get at the fact that you don't have to stop
sending content until you've sent the channel.flow-ok, and you can use
that to make a clean switch from XON to XOFF state, more or less. Does
that make sense?

Tony




From tonyg at lshift.net  Wed Feb 17 07:12:08 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 17 Feb 2010 20:12:08 +1300
Subject: [rabbitmq-discuss] amqp_login -> AMQP_RESPONSE_NONE (RabbitMQ
 C	Client)
In-Reply-To: <D2EDA5E6-B26E-48E6-92F3-728BB218C54B@consequor.de>
References: <D2EDA5E6-B26E-48E6-92F3-728BB218C54B@consequor.de>
Message-ID: <4B7B96C8.40108@lshift.net>

Hi Frank,

Frank Goenninger - Consequor Consulting AG wrote:
> Being new to RabbitMQ I am using the C client to write an abstraction  
> layer on top of RabbitMQ. I am trying to do an amqp_login call but  
> always get a AMQP_RESPONSE_NONE in amqp_rpc_reply.

That looks like a bug in the library to me. Looking at the code paths, I
notice two things:

 1. I'm ignoring the result of amqp_login_inner(). If there's a reason
    for that, I've forgotten it!

 2. Setting aside (1), if the code proceeds to the call to
    amqp_simple_rpc() in amqp_login(), there seems not to be a path
    that can avoid setting reply_type to some non-zero value, which
    makes your AMQP_RESPONSE_NONE result unusual to say the least.

> Is this normal, i.e. this is NOT an error? Do I get a server error if  
> the login fails or do I get this AMQP_RESPONSE_NONE if the login fails?

You ought to get some non-zero reply_type that is not
AMQP_RESPONSE_NORMAL. AMQP_RESPONSE_NONE is probably a bug in the
library. Unfortunately, during the login procedure, the server is not
allowed to tell you the cause of the problem if it decides it is going
to hang up on you: it will simply drop the connection. So check the
server's error logs to get a clue as to what is going wrong.

Can you post the code you're using for connecting to and logging in to
the broker? It would help in figuring out how you can possibly be seeing
AMQP_RESPONSE_NONE here.

Regards,
  Tony




From Dinabandhu.Mitra at tecnotree.com  Wed Feb 17 08:17:15 2010
From: Dinabandhu.Mitra at tecnotree.com (Dinabandhu Mitra)
Date: Wed, 17 Feb 2010 10:17:15 +0200
Subject: [rabbitmq-discuss] Will this work?
In-Reply-To: <4B7B9046.9000700@lshift.net>
References: <26875409.post@talk.nabble.com>
	<167204d21001050554k6f6646d2q53a0fd73d8cb9d77@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD818060D1B48@esmail10>
	<167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>
	<4B560E7E.703@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD81808BE5964@esmail10>
	<4B583D16.4030101@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD81808BE599F@esmail10>
	<4B7B9046.9000700@lshift.net>
Message-ID: <960996F6EFBCB843BFD62DAA96BD1DD8189CEE724D@esmail10>

Hi Tony,

First let me thank you for answering this on a vacation.

1. What do you mean by full Connection? Should I create a completely separate socket per thread? Or does it mean AMQP level connection?
2. If it is AMQP level connection, I have tried that before but it did not seem to work. I can try again if you feel it should work.
3. If it is completely separate socket, that is separate socket for each consumer and producer I seem to land in interaction between nagle and delayed ack which is playing havoc with response times. Disabling nagle does not help. 
4. If I share a (single socket + AMQP connection) between one producer and one consumer each on a different thread in same application using different channels seem to give best results. But in this configuration total message throughput that I can achieve with a reasonable latency (sub millisecond) on 1 KB message size is around 1000/sec. This throughput is somewhat restrictive.
5. Of course I can use multiple "pairs" of such consumers and producers to scale up but from the application point of view producers and consumers are not really paired, that is one application instance will have m producers and n consumers.

As you said, the library is not designed to work with pthreaded applications and possibly won't really work for our application at the end. I am just trying to see much can we do with this as I don't have any alternative at the moment.

Regards,
Dinabandhu 

> -----Original Message-----
> From: Tony Garnock-Jones [mailto:tonyg at lshift.net]
> Sent: Wednesday, February 17, 2010 12:14 PM
> To: Dinabandhu Mitra
> Cc: rabbitmq-discuss at lists.rabbitmq.com; rabbitmq info
> Subject: Re: [rabbitmq-discuss] Will this work?
> 
> Dinabandhu Mitra wrote:
> > Thanks. I must have misunderstood the post. I will change my code to
> > have a single shared socket, single shared connection but per thread
> > channel.
> 
> I would be extremely careful here. The rabbitmq-c library is built with
> event-driven, single-threaded applications in mind, and does not yet
> cater to any of the requirements of pthreaded applications. I do not
> think you will have much luck sharing a single connection between
> multiple threads, even using multiple channels. Instead, I would
> recommend a separate full *connection* per thread when using the
> rabbitmq-c library.
> 
> Regards,
>   Tony




From alexis.richardson at gmail.com  Wed Feb 17 10:10:05 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 17 Feb 2010 10:10:05 +0000
Subject: [rabbitmq-discuss] a common-lisp amqp client
In-Reply-To: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>
References: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>
Message-ID: <167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>

James

Thanks very much.  Your docs seem very thorough.  One niggle: you may
wish to change "Apache ActiveMQ" to "OpenAMQ" since the former does
not implement AMQP, while the latter was in fact the first
implementation.

If you have more comments about interoperability please do keep
posting them here.  As we converge on 0-91 implementations, your work
will be increasingly helpful in establishing cross-broker conformance.

alexis




On Wed, Feb 17, 2010 at 2:26 AM, james anderson <james.anderson at setf.de> wrote:
> good morning;
>
> with adjustments made as per the responses to my earlier questions
> about rabbitmq and 0.8r0 brokers in general, i was able to connect
> and exchange elementary messages with the 1.7.1 version of the
> rabbitmq broker[1]. thank you for your assistance.
>
> ---
> [1]: http://github.com/lisp/de.setf.amqp/blob/master/examples/README-
> rabbitmq.md
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Wed Feb 17 10:16:13 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 17 Feb 2010 10:16:13 +0000
Subject: [rabbitmq-discuss] a common-lisp amqp client
In-Reply-To: <167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>
References: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>
	<167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>
Message-ID: <167204d21002170216k3c69147fv53e94e28ef525900@mail.gmail.com>

James

I also note your comment "The implementation architecture should also
accommodate a control structure appropriate for the prospective 1.0
version - as least as described in preliminary drafts."

If you want to get involved in any 1.0 work, please do let me know.

alexis


On Wed, Feb 17, 2010 at 10:10 AM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> James
>
> Thanks very much. ?Your docs seem very thorough. ?One niggle: you may
> wish to change "Apache ActiveMQ" to "OpenAMQ" since the former does
> not implement AMQP, while the latter was in fact the first
> implementation.
>
> If you have more comments about interoperability please do keep
> posting them here. ?As we converge on 0-91 implementations, your work
> will be increasingly helpful in establishing cross-broker conformance.
>
> alexis
>
>
>
>
> On Wed, Feb 17, 2010 at 2:26 AM, james anderson <james.anderson at setf.de> wrote:
>> good morning;
>>
>> with adjustments made as per the responses to my earlier questions
>> about rabbitmq and 0.8r0 brokers in general, i was able to connect
>> and exchange elementary messages with the 1.7.1 version of the
>> rabbitmq broker[1]. thank you for your assistance.
>>
>> ---
>> [1]: http://github.com/lisp/de.setf.amqp/blob/master/examples/README-
>> rabbitmq.md
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From frank.goenninger at consequor.de  Wed Feb 17 10:55:16 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Wed, 17 Feb 2010 11:55:16 +0100
Subject: [rabbitmq-discuss] amqp_login -> AMQP_RESPONSE_NONE (RabbitMQ
	C	Client)
In-Reply-To: <4B7B96C8.40108@lshift.net>
References: <D2EDA5E6-B26E-48E6-92F3-728BB218C54B@consequor.de>
	<4B7B96C8.40108@lshift.net>
Message-ID: <1A6BDC58-4FDB-4182-83EB-8ED3F262F686@consequor.de>

Hi Tony,

Am 17.02.2010 um 08:12 schrieb Tony Garnock-Jones:

> Hi Frank,
> 
> Frank Goenninger - Consequor Consulting AG wrote:
>> Being new to RabbitMQ I am using the C client to write an abstraction  
>> layer on top of RabbitMQ. I am trying to do an amqp_login call but  
>> always get a AMQP_RESPONSE_NONE in amqp_rpc_reply.
> 
> That looks like a bug in the library to me.

Thought so, too ;-)

> Looking at the code paths, I
> notice two things:
> 
> 1. I'm ignoring the result of amqp_login_inner(). If there's a reason
>    for that, I've forgotten it!
> 
> 2. Setting aside (1), if the code proceeds to the call to
>    amqp_simple_rpc() in amqp_login(), there seems not to be a path
>    that can avoid setting reply_type to some non-zero value, which
>    makes your AMQP_RESPONSE_NONE result unusual to say the least.
> 
>> Is this normal, i.e. this is NOT an error? Do I get a server error if  
>> the login fails or do I get this AMQP_RESPONSE_NONE if the login fails?
> 
> You ought to get some non-zero reply_type that is not
> AMQP_RESPONSE_NORMAL. AMQP_RESPONSE_NONE is probably a bug in the
> library. Unfortunately, during the login procedure, the server is not
> allowed to tell you the cause of the problem if it decides it is going
> to hang up on you: it will simply drop the connection. So check the
> server's error logs to get a clue as to what is going wrong.
> 
> Can you post the code you're using for connecting to and logging in to
> the broker? It would help in figuring out how you can possibly be seeing
> AMQP_RESPONSE_NONE here.

No problem, here you go: (posting inline here and not as attachment to avoid the list server stripping it):

/* PIB stands for "Process Integration Bridge" - a product 
   we're about to launch.
   
   The "Context" is a central struct that holds all connection
   related info and properties needed to exchange data via RabbitMQ. */

static tPIBAMQPrc nEstablishConnection( tsPIBAMQPContextPtr psContext )
{
  tPIBAMQPrc nRC = PIB_OK;

  amqp_connection_state_t psConnection = NULL;

  psConnection = amqp_new_connection();

  psContext->psPIBAMQPConnection->psConnection = psConnection;
   
  if( psConnection == NULL )
    nRC = PIB_ERR_AMQP_CANNOT_CREATE_CONNECTION;
  else
    psContext->psPIBAMQPConnection->nConnectionState = 
      PIB_AMQP_CONNECTION_STATE_CONNECTION_ESTABLISHED;

  return nRC;
}

static tPIBAMQPrc nCreateSocket( tsPIBAMQPContextPtr psContext )
{
  tPIBAMQPrc nRC      = PIB_OK;
  int        nSockFD  = 0;

  nSockFD = amqp_open_socket( psContext->psPIBAMQPConnection->pcAMQPServerHostname,
                              psContext->psPIBAMQPConnection->nAMQPServerPort );
  if( nSockFD >= 0 )
  {
    amqp_set_sockfd( psContext->psPIBAMQPConnection->psConnection,
                     nSockFD );
    psContext->psPIBAMQPConnection->nConnectionState = 
      PIB_AMQP_CONNECTION_STATE_SOCKET_CREATED;
  }
  else
  {
    nRC = PIB_ERR_AMQP_CANNOT_CREATE_SOCKET;
  }

  return nRC;
}

/* THIS FUNCTION NOW HAS A HACK IN IT TO CIRCUMVENT THE 
   AMQP_RESPONSE_NONE SITUATION ... See SET_BIT ;-) */

static tPIBAMQPrc nLogin( tsPIBAMQPContextPtr psContext )
{
  tPIBAMQPrc nRC                = PIB_OK;
  int        nAMQPIgnoredErrors = 0;
  
  nAMQPIgnoredErrors = gAMQPIgnoredErrors;
  SET_BIT(gAMQPIgnoredErrors,PIB_AMQP_IGNORE_AMQP_RESPONSE_NONE);
  
  amqp_login( psContext->psPIBAMQPConnection->psConnection,
              psContext->psPIBAMQPConnection->pcAMQPVirtualHost,
              psContext->psPIBAMQPConnection->nAMQPChannelMax,
              psContext->psPIBAMQPConnection->nAMQPFrameMax,
              psContext->psPIBAMQPConnection->nAMQPHeartbeat,
              psContext->psPIBAMQPConnection->nAMQPSaslMethod,
              psContext->psPIBAMQPConnection->pcAMQPUser,
              psContext->psPIBAMQPConnection->pcAMQPPassword );

  nRC = nCheckAMQPRpcReply( psContext, amqp_get_rpc_reply(),
                            __FILE__, __LINE__, __func__ );
  if( nRC == PIB_OK )
  {
    psContext->psPIBAMQPConnection->nConnectionState = 
      PIB_AMQP_CONNECTION_STATE_LOGGED_IN;
  }

  gAMQPIgnoredErrors = nAMQPIgnoredErrors;

  return nRC;
}

static tPIBAMQPrc nOpenChannel( tsPIBAMQPContextPtr psContext )
{
  tPIBAMQPrc nRC = PIB_OK;

  (void) amqp_channel_open( psContext->psPIBAMQPConnection->psConnection,
                            psContext->psPIBAMQPConnection->nAMQPChannel );

  nRC = nCheckAMQPRpcReply( psContext,
                            amqp_get_rpc_reply(),
                            __FILE__, __LINE__, __func__ );

  if( nRC != PIB_OK )
  {
    nRC = PIB_ERR_AMQP_CANNOT_OPEN_CHANNEL;

    /* frgo, 2010-01-24: TODO: Log error (idea: funcall callback) */

  }
  else
    psContext->psPIBAMQPConnection->nConnectionState = 
      PIB_AMQP_CONNECTION_STATE_CHANNEL_OPENED;
  
  return nRC;
}

static tPIBAMQPrc nConnect( tsPIBAMQPContextPtr psContext )
{
  tPIBAMQPrc nRC    = PIB_OK;
  int        nState = 0;

  nState = nPIBAMQPConnectionGetConnectionState( psContext );

  while(( nState != PIB_AMQP_CONNECTION_STATE_CHANNEL_OPENED ) && 
        ( nRC == PIB_OK ))
  {
    switch( nState )
    {
      /* Step 1 */
      case PIB_AMQP_CONNECTION_STATE_CLOSED :
   
        nRC = nEstablishConnection( psContext );
        break;;

      /* Step 2 */
      case PIB_AMQP_CONNECTION_STATE_CONNECTION_ESTABLISHED :

        nRC = nCreateSocket( psContext );
        break;;

      /* Step 3 */
      case PIB_AMQP_CONNECTION_STATE_SOCKET_CREATED :

        nRC = nLogin( psContext );
        break;;

      /* Step 4 */
      case PIB_AMQP_CONNECTION_STATE_LOGGED_IN :
       
        nRC = nOpenChannel( psContext );
        break;;

      default:
        nRC = PIB_CRIT_AMQP_SW_ERR_INVALID_CONNECTION_STATE;
        break;;
    }

    if( nRC == PIB_OK )
      nState = nPIBAMQPConnectionGetConnectionState( psContext );
  }

  return nRC;
}

That's it. The nConnect() function walks through the status net in 4 steps until the channel is opened successfully. nLogin() fails with AMQP_RESPONSE_NONE if I don't ignore this special error. Needless to say, everything after this just works. I can publish, consume, whatever.

Thanks for jumping in!

Cheers
  Frank


From pauljones23 at gmail.com  Wed Feb 17 11:31:53 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 17 Feb 2010 11:31:53 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.7.2 Available in Sonatype OSS Maven
	Repository
Message-ID: <29598b611002170331j7c53860ax31bb11f082a851f1@mail.gmail.com>

Hi,

Following the release of RabbitMQ 1.7.2, the Java client is available for
Maven users via the repository hosted by Sonatype at
http://oss.sonatype.org/content/repositories/releases. We're hoping to get
synching to central set up soon too, so specifically listing the repository
should only be necessary whilst we get that process completed.

For those wishing to use the client before this happens, you'll need to add
a repository element to your pom, such as:

<repositories>
  <repository>
      <id>sonatype-oss-releases</id>
      <name>Sonatype OSS Releases</name>
      <url>http://oss.sonatype.org/content/repositories/releases/</url>
    </repository>
</repositories>

If you already run an internal Maven mirror, you could also just configure
that repository as an upstream (instructions are left up to the reader on
that part though).

Cheers,
Paul.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100217/99e6a2b5/attachment.htm 

From glenn.ergeerts at artesis.be  Wed Feb 17 14:02:21 2010
From: glenn.ergeerts at artesis.be (glenner)
Date: Wed, 17 Feb 2010 06:02:21 -0800 (PST)
Subject: [rabbitmq-discuss] SimpleRpcServer send generated queue name to
 client
Message-ID: <27624063.post@talk.nabble.com>


I have one server application and multiple client applications. The server
can publish different kind of events to the interested clients. Clients
express their interest in a certain event type (together with a predicate
which describes in which situation they should get an event, so they can
filter events). From that moment on the server pushes events to the
subscribed clients when they occur and match the predicates.

For implementing this i thought to have the server listening (using
SimpleRpcServer) to one central queue where the subscription requests get
send to. A new queue matching that subscription is then constructed by the
server. The server publishes messages on the correct queues when certain
events occur. The clients listen on their specific queue(s) (also using a
SimpleRpcServer). The client knows which queue to listen to based on a
convention (name of the event etc). 

Now the question: i want to be able to let the server specify (generate) a
unique queue name for each client/event subscription and then send it back
to the client so the client knows which queue to subscribe to. Is something
like this possible? I could not find any support for replying inside the
SimpleRpcServer.

And, more general, is this a valid design using RabbitMQ/AMQP? I'm still new
to RabbitMQ/AMQP so maybe i overlooked a more approriate way to do this..
-- 
View this message in context: http://old.nabble.com/SimpleRpcServer-send-generated-queue-name-to-client-tp27624063p27624063.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From rtrlists at googlemail.com  Wed Feb 17 14:15:10 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 17 Feb 2010 14:15:10 +0000
Subject: [rabbitmq-discuss] SimpleRpcServer send generated queue name to
	client
In-Reply-To: <27624063.post@talk.nabble.com>
References: <27624063.post@talk.nabble.com>
Message-ID: <6a3ae47e1002170615i5f3805dcy34a837a59d3d2ad9@mail.gmail.com>

On Wed, Feb 17, 2010 at 2:02 PM, glenner <glenn.ergeerts at artesis.be> wrote:

>
> I have one server application and multiple client applications. The server
> can publish different kind of events to the interested clients. Clients
> express their interest in a certain event type (together with a predicate
> which describes in which situation they should get an event, so they can
> filter events). From that moment on the server pushes events to the
> subscribed clients when they occur and match the predicates.
>
> For implementing this i thought to have the server listening (using
> SimpleRpcServer) to one central queue where the subscription requests get
> send to. A new queue matching that subscription is then constructed by the
> server. The server publishes messages on the correct queues when certain
> events occur. The clients listen on their specific queue(s) (also using a
> SimpleRpcServer). The client knows which queue to listen to based on a
> convention (name of the event etc).
>
> Now the question: i want to be able to let the server specify (generate) a
> unique queue name for each client/event subscription and then send it back
> to the client so the client knows which queue to subscribe to. Is something
> like this possible? I could not find any support for replying inside the
> SimpleRpcServer.
>
> And, more general, is this a valid design using RabbitMQ/AMQP? I'm still
> new
> to RabbitMQ/AMQP so maybe i overlooked a more approriate way to do this..
>

The Erlang amqp client lib has an example RPC server.

In essence, when your client fires the "new subscription please" request it
also has to create a reply queue. The initial message from client to server
has to contain your "subscription request" plus your reply_to queue name
and, ideally, a correlation_id. The reply_to and correlation_id fields, I
think, are already part of the AMPQ message properties.

Your client can then receive the desired "new subscription" queue name as a
message from the server on the reply_to queue with the appropriate
correlation_id.

Hope this gets you into the right direction,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100217/2501a38d/attachment.htm 

From scott.brooks at epicadvertising.com  Wed Feb 17 19:05:58 2010
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Wed, 17 Feb 2010 13:05:58 -0600
Subject: [rabbitmq-discuss] Changelogs for releases?
Message-ID: <AB88476C-0A6A-46BC-9050-27A9CAAA8D77@epicadvertising.com>

I'm trying to find the changelogs, or release notes for 1.7.2.  I remember them being in the announcement e-mail, but can't find them anywhere online.

Are the posted somewhere?

The first place I went to look for them was under the table of downloads on the following page
http://www.rabbitmq.com/server.html

So if they are not online, and you're looking for a place to add the link, that's my vote :)


---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
scott.brooks at epicadvertising.com




From james.anderson at setf.de  Wed Feb 17 19:36:25 2010
From: james.anderson at setf.de (james anderson)
Date: Wed, 17 Feb 2010 20:36:25 +0100
Subject: [rabbitmq-discuss] a common-lisp amqp client
In-Reply-To: <167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>
References: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>
	<167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>
Message-ID: <A1538F31-E079-4CAE-A40C-9153CCD93485@setf.de>

good evening;

On 2010-02-17, at 11:10 , Alexis Richardson wrote:

> James
>
> [...]
>
> If you have more comments about interoperability please do keep
> posting them here.  As we converge on 0-91 implementations, your work
> will be increasingly helpful in establishing cross-broker conformance.

as it were, i do have one.

one may recall, i had enquired some time back, about the intended  
mechanism to stream data through a channel.
there were a few responses. of which one was a concrete suggestion,  
it was unsatisfactory.
upon reflection, it should be possible to do this portably, in a way  
which at least reflects standard practice elsewhere, and without an  
extra message.
in fact, the conceived mechanism does work with qpid.
the details - both an explanation of the mechanism and connection  
transcripts, are in a note online.[1]

the log output is dense, but the bottom line is, rabbitmq suppresses  
zero-length frames.
as demonstrated by this manner to implement chunking, these frames  
most definitely carry information.
in which case, i am surprised the broker is permitted to drop them.

is there a reason the server does this?
can this be corrected through reconfiguration?

---
[1] http://github.com/lisp/de.setf.amqp/blob/master/examples/README- 
streaming.md



From matthias at lshift.net  Wed Feb 17 19:40:45 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 17 Feb 2010 19:40:45 +0000
Subject: [rabbitmq-discuss] Changelogs for releases?
In-Reply-To: <AB88476C-0A6A-46BC-9050-27A9CAAA8D77@epicadvertising.com>
References: <AB88476C-0A6A-46BC-9050-27A9CAAA8D77@epicadvertising.com>
Message-ID: <4B7C463D.1040801@lshift.net>

Scott Brooks wrote:
> I'm trying to find the changelogs, or release notes for 1.7.2. I
> remember them being in the announcement e-mail, but can't find them
> anywhere online.
> 
> Are the posted somewhere?

http://www.rabbitmq.com/news.html#2010-02-16T00:00:00Z
(linked from 'Latest News on' front page)

or
http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2010-February/000023.html
(rabbitmq-announce archive)

or
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-February/006353.html
(rabbitmq-discuss archive)

or
http://old.nabble.com/RabbitMQ-1.7.2-release-td27607357.html
(as above, via nabble)

or
type "RabbitMQ 1.7.2 release notes" into google and click "I'm feeling 
Lucky"
(same as previous link)

or
go to http://freshmeat.net/projects/rabbitmq and click on the 
"Changelog" link
(points to mailing list post)

...and so on ;)


Regards,

Matthias



From matthias at lshift.net  Wed Feb 17 20:27:48 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 17 Feb 2010 20:27:48 +0000
Subject: [rabbitmq-discuss] a common-lisp amqp client
In-Reply-To: <A1538F31-E079-4CAE-A40C-9153CCD93485@setf.de>
References: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>	<167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>
	<A1538F31-E079-4CAE-A40C-9153CCD93485@setf.de>
Message-ID: <4B7C5144.7050605@lshift.net>

James,

james anderson wrote:
> rabbitmq suppresses zero-length frames.
> as demonstrated by this manner to implement chunking, these frames  
> most definitely carry information.
> in which case, i am surprised the broker is permitted to drop them.

This isn't a case of the broker dropping frames but 
re-chunking/re-framing content. That is something a broker is permitted 
to do and in some cases even has to do since the negotiated max frame 
size on the publisher connection and consumer connection may be different.


Regards,

Matthias.



From scottblanc at gmail.com  Wed Feb 17 20:28:01 2010
From: scottblanc at gmail.com (scott w)
Date: Wed, 17 Feb 2010 12:28:01 -0800
Subject: [rabbitmq-discuss] Problem concurrency isue with rabbitmq
	(branch bug21673)
In-Reply-To: <20100215204128.GD7472@wellquite.org>
References: <401b577e1002151140j654cfeepfcd87ed9eaefa7ea@mail.gmail.com>
	<20100215201014.GB7472@wellquite.org>
	<401b577e1002151236k7e9895d5xff1b12ed64a11d29@mail.gmail.com>
	<20100215204128.GD7472@wellquite.org>
Message-ID: <401b577e1002171228n769754c9l4910f23a17461ab2@mail.gmail.com>

HI Matthew --

Just want to let you know that we are no longer seeing the problems we were
seeing last week. We upgraded to erlang, picked up the new changes you made
and fixed some issues on the client side and everything seems to be working
rather well at high load. Thanks for your help and all your hard word on
21673.

thanks!
Scott

On Mon, Feb 15, 2010 at 12:41 PM, Matthew Sackman <matthew at lshift.net>wrote:

> Hi Scott,
>
> Thanks for the extra information. There was a bug which I fixed today
> which maybe could have been causing you issues. Please make sure you
> update to the latest on 21673 and do let me know if you see it again.
>
> Of course, it could just be that at that time, all the channels were
> blocked, preventing publishes, due to high memory loads. This can take a
> little while to dealt with, especially in Erlang prior to R13 - the GC
> in R13 is much faster at reclaiming and releasing memory, thus the
> throttling doesn't tend to stay active for as long.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100217/4aeb99de/attachment.htm 

From james.anderson at setf.de  Wed Feb 17 21:33:07 2010
From: james.anderson at setf.de (james anderson)
Date: Wed, 17 Feb 2010 22:33:07 +0100
Subject: [rabbitmq-discuss] a common-lisp amqp client
In-Reply-To: <4B7C5144.7050605@lshift.net>
References: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>	<167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>
	<A1538F31-E079-4CAE-A40C-9153CCD93485@setf.de>
	<4B7C5144.7050605@lshift.net>
Message-ID: <506E30CB-5E44-4E47-B2F2-137518B05328@setf.de>


On 2010-02-17, at 21:27 , Matthias Radestock wrote:

> James,
>
> james anderson wrote:
>> rabbitmq suppresses zero-length frames.
>> as demonstrated by this manner to implement chunking, these  
>> frames  most definitely carry information.
>> in which case, i am surprised the broker is permitted to drop them.
>
> This isn't a case of the broker dropping frames but re-chunking/re- 
> framing content.

the transcript did not indicate that there was any reframing.
the two frames with non-zero length were forwarded as published.

> That is something a broker is permitted to do and in some cases  
> even has to do since the negotiated max frame size on the publisher  
> connection and consumer connection may be different.

if that were to apply.
and where a writer and a reader agree on a frame size?
anyway, it seems quite peculiar for a broker to muck with the  
clients' data without cause.
is there any way to turn it off?





From matthias at lshift.net  Wed Feb 17 22:06:08 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 17 Feb 2010 22:06:08 +0000
Subject: [rabbitmq-discuss] a common-lisp amqp client
In-Reply-To: <506E30CB-5E44-4E47-B2F2-137518B05328@setf.de>
References: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>	<167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>	<A1538F31-E079-4CAE-A40C-9153CCD93485@setf.de>	<4B7C5144.7050605@lshift.net>
	<506E30CB-5E44-4E47-B2F2-137518B05328@setf.de>
Message-ID: <4B7C6850.8000509@lshift.net>

James,

james anderson wrote:
> the transcript did not indicate that there was any reframing.
> the two frames with non-zero length were forwarded as published.

That just means the re-framing in that case was sub-optimal - the broker 
only dropped the zero length frame but left the others unchanged. What 
version of rabbitmq are you running? In 1.7.2 the re-framing is more 
aggressive.

>> That is something a broker is permitted to do and in some cases  
>> even has to do since the negotiated max frame size on the publisher  
>> connection and consumer connection may be different.
> 
> if that were to apply.
> and where a writer and a reader agree on a frame size?

Even if the publisher and consumer connection happen to have the same 
negotiated frame size, the server is still entitled to re-frame the content.

> anyway, it seems quite peculiar for a broker to muck with the  
> clients' data without cause.

You are conflating layers here, which admittedly aren't particularly 
well-defined in the AMQP specs. Framing is a transport-level concern; it 
does not appear at the application level. Think of the framing as the 
same kind of thing your tcp stack does when deciding how to split up a 
data stream into packets.

Now, atm AMQP only defines one transport, but that will change. In fact 
RabbitMQ already exposes AMQP over other transports like HTTP and SMTP, 
and we have gateways to STOMP, etc. Most of these have no notion of framing.

> is there any way to turn it off?

Not without changing the code. If you want to experiment with this, the 
place to look is rabbit_binary_generator:build_content_frames, iirc.


Regards,

Matthias.



From james.anderson at setf.de  Wed Feb 17 23:03:25 2010
From: james.anderson at setf.de (james anderson)
Date: Thu, 18 Feb 2010 00:03:25 +0100
Subject: [rabbitmq-discuss] a common-lisp amqp client
In-Reply-To: <4B7C6850.8000509@lshift.net>
References: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>	<167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>	<A1538F31-E079-4CAE-A40C-9153CCD93485@setf.de>	<4B7C5144.7050605@lshift.net>
	<506E30CB-5E44-4E47-B2F2-137518B05328@setf.de>
	<4B7C6850.8000509@lshift.net>
Message-ID: <1839C46F-3D6A-4E9F-9021-F218DC36C377@setf.de>

good evening;

On 2010-02-17, at 23:06 , Matthias Radestock wrote:

> James,
>
> james anderson wrote:
>> the transcript did not indicate that there was any reframing.
>> the two frames with non-zero length were forwarded as published.
>
> That just means the re-framing in that case was sub-optimal - the  
> broker only dropped the zero length frame but left the others  
> unchanged. What version of rabbitmq are you running? In 1.7.2 the  
> re-framing is more aggressive.
>
>>> That is something a broker is permitted to do and in some cases   
>>> even has to do since the negotiated max frame size on the  
>>> publisher  connection and consumer connection may be different.
>> if that were to apply.
>> and where a writer and a reader agree on a frame size?
>
> Even if the publisher and consumer connection happen to have the  
> same negotiated frame size, the server is still entitled to re- 
> frame the content.
>
>> anyway, it seems quite peculiar for a broker to muck with the   
>> clients' data without cause.
>
> You are conflating layers here, which admittedly aren't  
> particularly well-defined in the AMQP specs. Framing is a transport- 
> level concern; it does not appear at the application level. Think  
> of the framing as the same kind of thing your tcp stack does when  
> deciding how to split up a data stream into packets.
>
> Now, atm AMQP only defines one transport, but that will change. In  
> fact RabbitMQ already exposes AMQP over other transports like HTTP  
> and SMTP, and we have gateways to STOMP, etc. Most of these have no  
> notion of framing.
>
>> is there any way to turn it off?
>
> Not without changing the code. If you want to experiment with this,  
> the place to look is rabbit_binary_generator:build_content_frames,  
> iirc.
>

ok. if there were any other way to do this without incurring  
unnecessary overhead, i'd not be so vocal.
problem is, as you note above, the layers are less than clear, and,  
in fact all thrown into the clients lap to disambiguate. in the  
process of which, i had gathered the following from the specifications.

i had read the passages at the bottom of amqp0-9-1.pdf/page 35 to  
imply that, if frames are strictly sequential, they would also  
continue to exist. frames sent as 1,2,3 and arriving as 1,3 don't  
fall in my classification of a strict order. it is difficult to think  
about a strict ordering between sets with - as you describe, disjoint  
constituents. if the intent is to specify an order for the content of  
the body frames, the specification could be rephrased to say that.

the next paragraph on that page implied that there might be an  
alternative to using a zero-length frame to carry early termination  
information, but i could not make out any command which could be sent  
proactively to actually have the described effect without additional  
disruption. what kind of termination was this passage intended to imply?

i had read the last paragraph of 3.1.1 on page 26 to limit, if not  
preclude, the actions which you describe. yes, there is a possible  
conflict between that paragraph and the passage at the close of  
4.2.6.2 on page 36, but the "MUST NOT"s in the earlier passage are  
neither lightweight nor contingent stipulations, and, as  
demonstrated, the practice most certainly removes information.

in any case, thank you for the pointer.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100218/f804393d/attachment.htm 

From tonyg at lshift.net  Wed Feb 17 23:17:59 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 12:17:59 +1300
Subject: [rabbitmq-discuss] Codegen and Python 3.x (was: more complex
 java	client examples)
In-Reply-To: <269388e31002142031i156549b8sc307cdcd00b660a@mail.gmail.com>
References: <269388e31002142031i156549b8sc307cdcd00b660a@mail.gmail.com>
Message-ID: <4B7C7927.7030202@lshift.net>

Hi John,

On Sun, Feb 14, 2010 at 10:34 AM, John Apps <johndapps at gmail.com> wrote:
> Am I right in assuming that codegen.py requires Python 2.6 and NOT Python
> 3.1? The latter throws lots of syntax error messages, especially on the
> print statements as these do not use brackets "(".
> Or did I miss a qualifier when starting Python?

The codegen was written when 2.5 was all the rage and 3.0 was a faraway
dream. No-one has yet taken the time to investigate porting it forward,
so for now, please use a 2.x-series python with the simplejson module
installed.

Regards,
  Tony



From tonyg at lshift.net  Wed Feb 17 23:21:05 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 12:21:05 +1300
Subject: [rabbitmq-discuss] Live Upgrade ??
In-Reply-To: <c35894f0-e0b5-45a4-b088-6c8407c1b29a@x1g2000prb.googlegroups.com>
References: <c35894f0-e0b5-45a4-b088-6c8407c1b29a@x1g2000prb.googlegroups.com>
Message-ID: <4B7C79E1.2060308@lshift.net>

Arco wrote:
> Does RabbitMQ make use of these features?

Not yet, I'm afraid. Sorry. You'll need to stop, upgrade, and restart
the server just like a non-OTP program.

There's a lot to learn in Erlang/OTP, and we're still finding new
things, three and a half years in. I still feel like an OTP beginner
most of the time!

Tony




From tonyg at lshift.net  Wed Feb 17 23:25:14 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 12:25:14 +1300
Subject: [rabbitmq-discuss] Changelogs for releases?
In-Reply-To: <4B7C463D.1040801@lshift.net>
References: <AB88476C-0A6A-46BC-9050-27A9CAAA8D77@epicadvertising.com>
	<4B7C463D.1040801@lshift.net>
Message-ID: <4B7C7ADA.8000704@lshift.net>

Matthias Radestock wrote:
> ...and so on ;)

... that said, having them hosted on the website might make sense too.
Yet another thing to add to the list for the Great Website
Reorganisation Plan :-)

Tony



From matthias at lshift.net  Wed Feb 17 23:26:19 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 17 Feb 2010 23:26:19 +0000
Subject: [rabbitmq-discuss] a common-lisp amqp client
In-Reply-To: <1839C46F-3D6A-4E9F-9021-F218DC36C377@setf.de>
References: <72540A35-0F33-4D9F-A76F-1C807B221481@setf.de>	<167204d21002170210r62585370r8fab4335a1482b0e@mail.gmail.com>	<A1538F31-E079-4CAE-A40C-9153CCD93485@setf.de>	<4B7C5144.7050605@lshift.net>	<506E30CB-5E44-4E47-B2F2-137518B05328@setf.de>	<4B7C6850.8000509@lshift.net>
	<1839C46F-3D6A-4E9F-9021-F218DC36C377@setf.de>
Message-ID: <4B7C7B1B.2010904@lshift.net>

James,

james anderson wrote:
> i had read the passages at the bottom of amqp0-9-1.pdf/page 35 to imply 
> that, if frames are strictly sequential, they would also continue to 
> exist. frames sent as 1,2,3 and arriving as 1,3 don't fall in my 
> classification of a strict order.

Indeed the frames do all arrive intact and in that order. But that is 
all happening within the context of a specific channel and in a specific 
direction, i.e. client-to-server or server-to-client.

> the next paragraph on that page implied that there might be an 
> alternative to using a zero-length frame to carry early termination 
> information, but i could not make out any command which could be sent 
> proactively to actually have the described effect without additional 
> disruption. what kind of termination was this passage intended to imply?

No idea, and note that the paragraph refers to *aborting* the sending of 
content, not terminating, so it wouldn't help in what you are trying to do.

> i had read the last paragraph of 3.1.1 on page 26 to limit, if not 
> preclude, the actions which you describe. yes, there is a possible 
> conflict between that paragraph and the passage at the close of 4.2.6.2 
> on page 36, but the "MUST NOT"s in the earlier passage are neither 
> lightweight nor contingent stipulations, and, as demonstrated, the 
> practice most certainly removes information.

The content bodies referred to in section 3.1.1. refer to logical AMQP 
method content, not any particular chunking of it into content frames.


Regards,

Matthias.



From tonyg at lshift.net  Thu Feb 18 03:34:57 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 16:34:57 +1300
Subject: [rabbitmq-discuss] amqp_login -> AMQP_RESPONSE_NONE (RabbitMQ
 C	Client)
In-Reply-To: <1A6BDC58-4FDB-4182-83EB-8ED3F262F686@consequor.de>
References: <D2EDA5E6-B26E-48E6-92F3-728BB218C54B@consequor.de>
	<4B7B96C8.40108@lshift.net>
	<1A6BDC58-4FDB-4182-83EB-8ED3F262F686@consequor.de>
Message-ID: <4B7CB561.6080301@lshift.net>

Hi Frank,

Thanks for posting the code. I think I see the problem.

Frank G?nninger wrote:
>   amqp_login( psContext->psPIBAMQPConnection->psConnection,
>               psContext->psPIBAMQPConnection->pcAMQPVirtualHost,
>               psContext->psPIBAMQPConnection->nAMQPChannelMax,
>               psContext->psPIBAMQPConnection->nAMQPFrameMax,
>               psContext->psPIBAMQPConnection->nAMQPHeartbeat,
>               psContext->psPIBAMQPConnection->nAMQPSaslMethod,
>               psContext->psPIBAMQPConnection->pcAMQPUser,
>               psContext->psPIBAMQPConnection->pcAMQPPassword );
> 
>   nRC = nCheckAMQPRpcReply( psContext, amqp_get_rpc_reply(),
>                             __FILE__, __LINE__, __func__ );

The problem is that amqp_get_rpc_reply() is only intended for use with
API operations that don't themselves return an amqp_rpc_reply_t. The
amqp_login function does return an amqp_rpc_reply_t value, so you should
be checking that instead of the result of amqp_get_rpc_reply(). It's
confusing and undocumented, I know; I'm working on making it less
confusing and improving the documentation too.

[Aside: everything after the SASL method argument to amqp_login is
varargs, so if you're hard-coding the username and password in those
positions, it makes sense to remove your nAMQPSaslMethod field and
instead hardcode AMQP_SASL_METHOD_PLAIN.]

I've also changed the code just now to no longer ignore the result of
amqp_login_inner. Thanks for the bug reports!

Regards,
  Tony



From arun.suresh at gmail.com  Thu Feb 18 04:06:00 2010
From: arun.suresh at gmail.com (Arun Suresh)
Date: Thu, 18 Feb 2010 09:36:00 +0530
Subject: [rabbitmq-discuss] Behaviour change from rabbitMQ v1.7.0 to v1.7.1
Message-ID: <9f4a617f1002172006p6b44d7cof739e68d5e5c3b15@mail.gmail.com>

Hi

We are currently using RabbitMQ 1.7.0 and we'd like to move to 1.7.2 but we
have noticed a fundamental behavior change across these versions. Let me
explain:

1) Assume we have a cluster of RabbitMQ nodes... 'rabbit at host1' and
'rabbit at host2'
2) 'client1' connects to 'rabbit at host1', declares an exchange 'test_x' and
then declares a q 'test_queue' and binds to it.
3) 'client2' being of the same codebase as 'client1' on starting up connects
to 'rabbit at host2' and does the same thing as 'client1'.

At this point of time, If we do a 'rabbitmqctl list_queues consumers name
node' the response we get is:

2        test_queue         rabbit at host1

Our reason for doing this was that a message sent to the 'test_x' exchange
would be consumed by either of the clients.

Now..

4) Assume 'rabbit at host1' node goes down (machine crash, becomes
unreachable... whatever)
5) 'client1' detects the outage and tries connecting to 'rabbit at host2'...
and the mq connection startup code kicks in.. thus.. the queue 'test_queue'
is recreated on 'rabbit at host2'

Now... If we do a 'rabbitmqctl list_queues consumers name node' the response
we get is:

1        test_queue         rabbit at host2

As u can see we have only one consumer...

To fix this isuue... we get 'client1' to notify all other clients of a
network outage.. 'client2' intercepts this message and promptly reconnects
to 'rabbit at host2' and again binds to 'test_queue'.
Everyone is happy...

Unfortunately... we have noticed that from 1.7.1, step 4 goes for a toss..

if 'rabbit at host1' goes down, 'client1' cannot recreate 'test_queue' on
'rabbit at host2'.
Do this imply that... all queues created on the node WILL be unavailable for
the duration of the nodes outage ??
Which means there wont be any consumers for messages sent to the exchange
for the duration of the outage..

I was wondering if anybody could probably shed some light on :
1) Why this change in behaviour ?
2) What is the suggested approach to tackle these types of availability
issues in rabbitMQ ?

Thanx in advance
-Arun Suresh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100218/09f5aada/attachment.htm 

From tonyg at lshift.net  Thu Feb 18 04:26:32 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 17:26:32 +1300
Subject: [rabbitmq-discuss] rabbitmq-c thread-safe
In-Reply-To: <4B014D1B.6030200@lshift.net>
References: <37EA636C-7DD4-4229-8B60-6C9526AA4A40@omniti.com>
	<4B014D1B.6030200@lshift.net>
Message-ID: <4B7CC178.3080007@lshift.net>

Tony Garnock-Jones wrote:
>> The second issue is that the library uses a global variable to track
>> the reply state on the a connection making it not thread safe.  I've
>> patched the tip, it is attached.
> 
> Would it work instead to put the amqp_rpc_reply variable in the
> amqp_connection_state_t?

I've just committed a patch that puts amqp_rpc_reply in the connection
state. Now the only way to access it is with amqp_get_rpc_reply().

Regards,
  Tony




From tonyg at lshift.net  Thu Feb 18 04:42:56 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 17:42:56 +1300
Subject: [rabbitmq-discuss] Will this work?
In-Reply-To: <960996F6EFBCB843BFD62DAA96BD1DD8189CEE724D@esmail10>
References: <26875409.post@talk.nabble.com>	<167204d21001050554k6f6646d2q53a0fd73d8cb9d77@mail.gmail.com>	<960996F6EFBCB843BFD62DAA96BD1DD818060D1B48@esmail10>	<167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>	<960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>	<4B560E7E.703@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD81808BE5964@esmail10>
	<4B583D16.4030101@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD81808BE599F@esmail10>
	<4B7B9046.9000700@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD8189CEE724D@esmail10>
Message-ID: <4B7CC550.5040305@lshift.net>

Hi Dinabandhu,

Dinabandhu Mitra wrote:
> 1. What do you mean by full Connection? Should I create a completely
> separate socket per thread? Or does it mean AMQP level connection?

You should create a separate socket per thread, with an AMQP-level
connection per socket.

> 2. If it is AMQP level connection, I have tried that before but it
> did not seem to work. I can try again if you feel it should work.

I understand. You will need to have a one-to-one relationship between
sockets and AMQP-level connections, and you should be extremely careful
about sharing a connection or its channels between threads, since
librabbitmq is written for event-driven, not threaded, use.

> 3. If it is completely separate socket, that is separate socket for
> each consumer and producer I seem to land in interaction between
> nagle and delayed ack which is playing havoc with response times.
> Disabling nagle does not help.

It is not necessarily a separate socket for each consumer: you can have
multiple consumers (in the sense of basic.consume) active on a single
channel. Your code would have a thread responsible for retrieving
messages from the connection and dispatching them out to any waiting
threads, which would not themselves manage and AMQP connection.

I'm not sure what the problem is with your response times. Could you
remind me which operating system you are using, please? If you have
special code for measuring latencies, I'd appreciate it if you could
send it through so I can try it myself to try to find out what the
problem is.

> 4. If I share a (single socket + AMQP connection) between one
> producer and one consumer each on a different thread in same
> application using different channels seem to give best results. But
> in this configuration total message throughput that I can achieve
> with a reasonable latency (sub millisecond) on 1 KB message size is
> around 1000/sec. This throughput is somewhat restrictive.

As you've noticed, it's difficult to simultaneously optimise for good
latency and good throughput. I'm glad you're running these experiments,
please do keep posting your findings to the list (and if you can post
the code at the same time so others can repeat the experiments, then
that's even better).

> 5. Of course I can use multiple "pairs" of such consumers and
> producers to scale up but from the application point of view
> producers and consumers are not really paired, that is one
> application instance will have m producers and n consumers.

What would be nice here would be a thin layer on top of librabbitmq
(perhaps part of it) that was aware of threads, and could manage a
connection on behalf of other threads. It would need to integrate with
some event source (perhaps blocking, perhaps libevent, etc etc), and
respond to message from other threads requesting services like exchange
declaration or message publication, and handle deliveries from the
server, passing out received messages to other threads and collecting
the resulting message acknowledgements to pass back to the server.

Regards,
  Tony




From tonyg at lshift.net  Thu Feb 18 05:17:09 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 18:17:09 +1300
Subject: [rabbitmq-discuss] problem with rabbitmq-activate-plugins
In-Reply-To: <390b0ef51001291832g5f9cd63fpb041d491b44e0ba6@mail.gmail.com>
References: <390b0ef51001290115v21c6cba6k9b2ed5b565fd3ad@mail.gmail.com>	<29598b611001290125s1382f0cav765455d331041052@mail.gmail.com>
	<390b0ef51001291832g5f9cd63fpb041d491b44e0ba6@mail.gmail.com>
Message-ID: <4B7CCD55.7050600@lshift.net>

Hi Roland,

Roland Reumerman wrote:
> Hi Paul,
> Thanks for the instruction, everything compiles now. I was looking for
> documentation on how to use the rabbitmq-stmp plugin, but (besides

Do you mean STOMP or SMTP? If the latter: how interesting! Yes, it's a
very experimental (and currently slightly dusty) plugin. Let me see if I
can gin up some documentation for it.

Regards,
  Tony



From tonyg at lshift.net  Thu Feb 18 05:18:33 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 18:18:33 +1300
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++
 2005?
In-Reply-To: <20100129104223.GB11306@wellquite.org>
References: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>
	<20100129104223.GB11306@wellquite.org>
Message-ID: <4B7CCDA9.7020109@lshift.net>

Matthew Sackman wrote:
> It's unlikely. Rabbitmq-c is in a highly experimental state and I
> believe it contains some features of C that are specific to gcc.

It does. Very much so. My guess is that for windows support, people
should try compiling it with mingw or cygwin, and use the resulting DLL
in a VC++ project.

Regards,
  Tony




From tonyg at lshift.net  Thu Feb 18 05:47:47 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 18:47:47 +1300
Subject: [rabbitmq-discuss] Using dbg to semi-invasively extend the broker
 (was Re: Plugin Hooks / Callbacks)
In-Reply-To: <20100211164724.GE2942@mrnibble.lshift.net>
References: <92f72134-5eb6-483c-a9ec-77d32a4af010@q2g2000pre.googlegroups.com>
	<20100211164724.GE2942@mrnibble.lshift.net>
Message-ID: <4B7CD483.9050807@lshift.net>

Matthew Sackman wrote:
> Personally, I think the best way to do this is to use the dbg module.
> With enough care in the match specs and some careful book keeping, I
> think this is by far the easiest and most flexible way to insert such
> hooks dynamically into the system.

Yeah, this is a really interesting approach. I must experiment with it.
First up would be a simple ets table for counting messages sent through
each exchange, I think...

Tony



From tonyg at lshift.net  Thu Feb 18 05:50:22 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 18:50:22 +1300
Subject: [rabbitmq-discuss] STOMP & AMPQ
In-Reply-To: <20100211082039.3959.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20100211082039.3959.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4B7CD51E.1000206@lshift.net>

Lionel Cons wrote:
> In any case AMQP 1-0 will require a change of the STOMP gateway to
> expose the new nodes, links, filters... Time for a clean mapping
> between AMQP and STOMP?

I really like STOMP's transfer syntax. Its model (what is a queue? what
is a topic? how does everything interact once a request is on the
server-side?) needs pretty serious work.

I'd love to see the AMQP model exposed *directly* as STOMP commands,
with commands like "BASIC.PUBLISH", "QUEUE.DECLARE" etc., and with the
normal STOMP verbs removed.

Obviously it wouldn't interoperate with other STOMP servers, but at
least you'd have a standardised model to work with. It's much much
easier to write a STOMP client library than it is to write an AMQP
client library.

Tony



From tonyg at lshift.net  Thu Feb 18 05:55:48 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 18:55:48 +1300
Subject: [rabbitmq-discuss] rabbit mq C++ client library
In-Reply-To: <167204d21002150218s15e1bebane12cb7785255ff6d@mail.gmail.com>
References: <b2514e8a1002142235g197aa71ajc59638b9b2b9ffaa@mail.gmail.com>	<E1NgwH4-00057s-00.akalend-mail-ru@f272.mail.ru>	<167204d21002150032u73a083d2j2d16d5d8a641fd70@mail.gmail.com>	<5A46D132C446C04B9EFE8AD14E7891066F23667648@SVR-2K3-BH-EMC.tradition.int>
	<167204d21002150218s15e1bebane12cb7785255ff6d@mail.gmail.com>
Message-ID: <4B7CD664.4020200@lshift.net>

Alexis Richardson wrote:
> So - who is up for taking a lead on a C++ client, perhaps based on
> Tony's C client?

To whomever is considering this: Providing a thin C++ class wrapper
around the C client ought to be quite straightforward.

It will be difficult to integrate smoothly with the various eventing
systems out there, though. Probably the best approach is to mimic
librabbitmq, and simply punt: let the user poke byte arrays in to the
client when data arrives.

It will also be difficult to do anything sensible around multithreading,
largely because librabbitmq is written for an evented system, not a
threaded system. As a jumping-off point, check out the (quite complex)
code in the Java and .NET client libraries that manages multithreading
support.

Regards,
  Tony



From tonyg at lshift.net  Thu Feb 18 06:05:08 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 19:05:08 +1300
Subject: [rabbitmq-discuss] amqp_channel_open issue
In-Reply-To: <b2514e8a1002120548s5f26f01fxef6efc2e8058675e@mail.gmail.com>
References: <b2514e8a1002100941p43a5c75fs446ea35701220789@mail.gmail.com>	<20100211160733.GB2942@mrnibble.lshift.net>
	<b2514e8a1002120548s5f26f01fxef6efc2e8058675e@mail.gmail.com>
Message-ID: <4B7CD894.8060709@lshift.net>

Hi Ragavendra,

raghu a wrote:
> As per my code each thread is using different channel.
> May I get any  multi threaded C client samples?

I'm sorry to say that multithreaded use of librabbitmq will not work
without quite a bit of effort. It is designed for event-based systems,
not multi-threaded systems. Its internal architecture is quite different
from our other client libraries, where sharing connections between
threads is just fine.

With that said, however, you *can* use librabbitmq with a connection per
thread; just don't try to share a connection or its channels between
threads at the moment.

Regards,
  Tony




From akalend at mail.ru  Thu Feb 18 07:49:30 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Thu, 18 Feb 2010 10:49:30 +0300
Subject: [rabbitmq-discuss]
	=?windows-1251?q?rabbit_mq_C++_client_library?=
In-Reply-To: <4B7CD664.4020200@lshift.net>
References: <4B7CD664.4020200@lshift.net>
Message-ID: <E1Ni18c-00016M-00.akalend-mail-ru@f29.mail.ru>

Hi all,

I think about how to  make C++ interface (CPP wrapper on librabbitmq ).
I don't use the threading, but I think that it possible over my wrapper.

So, next time  (one-two week) I send the draft of Interface.


Alexandre



-----Original Message-----
From: Tony Garnock-Jones <tonyg at lshift.net>
To: Alexis Richardson <alexis.richardson at gmail.com>
Date: Thu, 18 Feb 2010 18:55:48 +1300
Subject: Re: [rabbitmq-discuss] rabbit mq C++ client library

> Alexis Richardson wrote:
> > So - who is up for taking a lead on a C++ client, perhaps based on
> > Tony's C client?
> 
> To whomever is considering this: Providing a thin C++ class wrapper
> around the C client ought to be quite straightforward.
> 
> It will be difficult to integrate smoothly with the various eventing
> systems out there, though. Probably the best approach is to mimic
> librabbitmq, and simply punt: let the user poke byte arrays in to the
> client when data arrives.
> 
> It will also be difficult to do anything sensible around multithreading,
> largely because librabbitmq is written for an evented system, not a
> threaded system. As a jumping-off point, check out the (quite complex)
> code in the Java and .NET client libraries that manages multithreading
> support.
> 
> Regards,
>   Tony




From smirnov.andrey at gmail.com  Thu Feb 18 07:58:34 2010
From: smirnov.andrey at gmail.com (Andrey Smirnov)
Date: Thu, 18 Feb 2010 10:58:34 +0300
Subject: [rabbitmq-discuss] RabbitMQ (branch bug21673) running out of file
	descriptors
Message-ID: <ae4b61c1002172358pd38ae5dw36ca54e0e6730f36@mail.gmail.com>

Hello!

We're running RabbitMQ from branch bug21673 (built yesterday). We have
a lot of non-persisten queues (2k - 10k+) that are created/destroyed
all the time. Some queues have unconsumed messaged and they will get
destroyed with unconsumed messages.

When file descriptor limit for RabbitMQ was left to default 1024 files
it was dying in 2 hours. I've raised the limit to 10240 files and it
worked for 16 hours and crashed.

Crash for clients looks like "INTERNAL_ERROR" error on connections.
RabbitMQ is still running and eating 100% of CPU. Restarting RabbitMQ
helps to revive it.

Adding log file excerpt (log is huge, it contains dump of all internal
state, I have it if someone will be interested):

=INFO REPORT==== 16-Feb-2010::04:42:05 ===
Limiting to approx 10190 file handles

=INFO REPORT==== 16-Feb-2010::04:42:05 ===
Memory limit set to 3196MB.

=INFO REPORT==== 16-Feb-2010::04:42:05 ===
Using rabbit_msg_store_ets_index to provide index for message store

=INFO REPORT==== 16-Feb-2010::04:42:05 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 16-Feb-2010::04:42:26 ===
accepted TCP connection on 0.0.0.0:5672 from <redacted>:35525

.....

ERROR REPORT==== 17-Feb-2010::17:32:16 ===
** Generic server <0.7466.264> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'queue.declare',0,

<<"qik.item.session.83c5e30a-180e-4f2a-b59d-c6bd7938faac">>,
                                   false,false,false,false,false,[]},
                               none}}
** When Server state == {ch,running,3,<0.1622.0>,<0.7464.264>,undefined,none,
                            {set,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                            1,
                            {[],[]},
                            {[],[]},
                            <<"guest">>,<<"localhost">>,

<<"qik.item.session.6c6a3c8e-38d7-4c69-bb1c-26ae3cc00d67">>,
                            {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}}}
** Reason for termination ==
** {{badmatch,{error,{{badmatch,{error,emfile}},
                      [{rabbit_queue_index,get_journal_handle,1},
                       {rabbit_queue_index,load_journal,1},
                       {rabbit_queue_index,init,1},
                       {rabbit_variable_queue,init,1},
                       {rabbit_amqqueue_process,init,1},
                       {gen_server2,init_it,6},
                       {proc_lib,init_p_do_apply,3}]}}},
    [{rabbit_amqqueue,start_queue_process,1},
     {rabbit_amqqueue,declare,4},
     {rabbit_channel,handle_method,3},
     {rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,7},
     {proc_lib,wake_up,3}]}

=ERROR REPORT==== 17-Feb-2010::17:32:16 ===
connection <0.1622.0> (running), channel 3 - error:
{{badmatch,{error,{{badmatch,{error,emfile}},
                   [{rabbit_queue_index,get_journal_handle,1},
                    {rabbit_queue_index,load_journal,1},
                    {rabbit_queue_index,init,1},
                    {rabbit_variable_queue,init,1},
                    {rabbit_amqqueue_process,init,1},
                    {gen_server2,init_it,6},

....

=ERROR REPORT==== 17-Feb-2010::17:33:08 ===
Mnesia(rabbit at SM2): ** ERROR ** (core dumped to file:
"/usr/local/sbin/MnesiaCore.rabbit at SM2_1266_456788_594733")
 ** FATAL ** Cannot open log file
"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL":
{file_error,


"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",

                        emfile}

=ERROR REPORT==== 17-Feb-2010::17:33:08 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,<0.58.0>,
                       {<0.61.0>,
                        "Mnesia(~p): ** ERROR ** (core dumped to file:
~p)~n ** FATAL ** Cannot open log file ~p: ~p~n",
                        [rabbit at SM2,

"/usr/local/sbin/MnesiaCore.rabbit at SM2_1266_456788_594733",

"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
                         {file_error,

"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
                             emfile}]}}
** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
** Reason == {{function_clause,
               [{gen,call,
                 [{rex,{error,{node_not_running,rabbit at SM2}}},
                  '$gen_call',
                  {call,mnesia_lib,db_select_cont,
                   [ram_copies,
                    {rabbit_route,
                     {binding,
                      {resource,<<"localhost">>,exchange,
                       <<"qik.exc.session">>},

<<"qik.item.session.22ff9df4-c115-4cdf-a721-27f99eba9aaa">>,
                      {resource,<<"localhost">>,queue,

<<"qik.item.session.22ff9df4-c115-4cdf-a721-27f99eba9aaa">>},
                      []},
                     [],100,<<>>,[],0,0},
                    [{'$1',[],['$1']}]],
                   <0.0.0>},
                  infinity]},
                {gen_server,call,3},
                {rpc,do_call,3},
                {mnesia,do_dirty_rpc,5},
                {mnesia,select_cont,3},
                {mnesia,'-qlc_select/1-fun-0-',1},
                {rabbit_exchange,'-match_bindings/2-fun-1-',10},
    {rabbit_variable_queue,flush_journal,1},
     {rabbit_amqqueue_process,handle_pre_hibernate,1}]}

=ERROR REPORT==== 17-Feb-2010::17:33:08 ===
Mnesia(rabbit at SM2): ** ERROR ** (core dumped to file:
"/usr/local/sbin/MnesiaCore.rabbit at SM2_1266_456788_594733")
 ** FATAL ** Cannot open log file
"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL":
{file_error,


"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",

                        emfile}

=ERROR REPORT==== 17-Feb-2010::17:33:08 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,<0.58.0>,
                       {<0.61.0>,
                        "Mnesia(~p): ** ERROR ** (core dumped to file:
~p)~n ** FATAL ** Cannot open log file ~p: ~p~n",
                        [rabbit at SM2,

"/usr/local/sbin/MnesiaCore.rabbit at SM2_1266_456788_594733",

"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
                         {file_error,

"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
                             emfile}]}}

** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
** Reason == {{function_clause,
               [{gen,call,
                 [{rex,{error,{node_not_running,rabbit at SM2}}},
                  '$gen_call',
                  {call,mnesia_lib,db_select_cont,
                   [ram_copies,
                    {rabbit_route,
                     {binding,
                      {resource,<<"localhost">>,exchange,
                       <<"qik.exc.session">>},

<<"qik.item.session.22ff9df4-c115-4cdf-a721-27f99eba9aaa">>,
                      {resource,<<"localhost">>,queue,

<<"qik.item.session.22ff9df4-c115-4cdf-a721-27f99eba9aaa">>},
                      []},
                     [],100,<<>>,[],0,0},
                    [{'$1',[],['$1']}]],
                   <0.0.0>},
                  infinity]},
                {gen_server,call,3},
                {rpc,do_call,3},
                {mnesia,do_dirty_rpc,5},
                {mnesia,select_cont,3},
                {mnesia,'-qlc_select/1-fun-0-',1},
                {rabbit_exchange,'-match_bindings/2-fun-1-',10},
                {qlc,collect,1}]},
              {gen_server,call,
               [{rex,{error,{node_not_running,rabbit at SM2}}},
                {call,mnesia_lib,db_select_cont,
                 [ram_copies,
                  {rabbit_route,

.....


** Reason for termination ==
** {{badmatch,{error,emfile}},
    [{rabbit_queue_index,get_segment_handle,1},
     {rabbit_queue_index,append_journal_to_segment,2},
     {rabbit_queue_index,'-flush_journal/1-fun-0-',3},
     {lists,foldl,3},
     {rabbit_queue_index,segment_fold,3},
     {rabbit_queue_index,flush_journal,1},
     {rabbit_variable_queue,flush_journal,1},
     {rabbit_amqqueue_process,handle_pre_hibernate,1}]}



-- 
Andrey Smirnov



From smirnov.andrey at gmail.com  Thu Feb 18 08:02:42 2010
From: smirnov.andrey at gmail.com (Andrey Smirnov)
Date: Thu, 18 Feb 2010 11:02:42 +0300
Subject: [rabbitmq-discuss] RabbitMQ (branch bug21673) running out of
	file descriptors
In-Reply-To: <ae4b61c1002172358pd38ae5dw36ca54e0e6730f36@mail.gmail.com>
References: <ae4b61c1002172358pd38ae5dw36ca54e0e6730f36@mail.gmail.com>
Message-ID: <ae4b61c1002180002k630136bds20366bed36368517@mail.gmail.com>

Forgot to add: at the time of crash we had more than 10k queues...
(Looks like more than file descriptor limit)

2010/2/18 Andrey Smirnov <smirnov.andrey at gmail.com>:
> Hello!
>
> We're running RabbitMQ from branch bug21673 (built yesterday). We have
> a lot of non-persisten queues (2k - 10k+) that are created/destroyed
> all the time. Some queues have unconsumed messaged and they will get
> destroyed with unconsumed messages.
>
> When file descriptor limit for RabbitMQ was left to default 1024 files
> it was dying in 2 hours. I've raised the limit to 10240 files and it
> worked for 16 hours and crashed.
>
> Crash for clients looks like "INTERNAL_ERROR" error on connections.
> RabbitMQ is still running and eating 100% of CPU. Restarting RabbitMQ
> helps to revive it.
>
> Adding log file excerpt (log is huge, it contains dump of all internal
> state, I have it if someone will be interested):
>
> =INFO REPORT==== 16-Feb-2010::04:42:05 ===
> Limiting to approx 10190 file handles
>
> =INFO REPORT==== 16-Feb-2010::04:42:05 ===
> Memory limit set to 3196MB.
>
> =INFO REPORT==== 16-Feb-2010::04:42:05 ===
> Using rabbit_msg_store_ets_index to provide index for message store
>
> =INFO REPORT==== 16-Feb-2010::04:42:05 ===
> started TCP Listener on 0.0.0.0:5672
>
> =INFO REPORT==== 16-Feb-2010::04:42:26 ===
> accepted TCP connection on 0.0.0.0:5672 from <redacted>:35525
>
> .....
>
> ERROR REPORT==== 17-Feb-2010::17:32:16 ===
> ** Generic server <0.7466.264> terminating
> ** Last message in was {'$gen_cast',
> ? ? ? ? ? ? ? ? ? ? ? ? ? {method,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {'queue.declare',0,
>
> <<"qik.item.session.83c5e30a-180e-4f2a-b59d-c6bd7938faac">>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? false,false,false,false,false,[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? none}}
> ** When Server state == {ch,running,3,<0.1622.0>,<0.7464.264>,undefined,none,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{set,0,16,16,8,80,48,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]}}},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?1,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"guest">>,<<"localhost">>,
>
> <<"qik.item.session.6c6a3c8e-38d7-4c69-bb1c-26ae3cc00d67">>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{dict,0,16,16,8,80,48,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]}}}}
> ** Reason for termination ==
> ** {{badmatch,{error,{{badmatch,{error,emfile}},
> ? ? ? ? ? ? ? ? ? ? ?[{rabbit_queue_index,get_journal_handle,1},
> ? ? ? ? ? ? ? ? ? ? ? {rabbit_queue_index,load_journal,1},
> ? ? ? ? ? ? ? ? ? ? ? {rabbit_queue_index,init,1},
> ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,init,1},
> ? ? ? ? ? ? ? ? ? ? ? {rabbit_amqqueue_process,init,1},
> ? ? ? ? ? ? ? ? ? ? ? {gen_server2,init_it,6},
> ? ? ? ? ? ? ? ? ? ? ? {proc_lib,init_p_do_apply,3}]}}},
> ? ?[{rabbit_amqqueue,start_queue_process,1},
> ? ? {rabbit_amqqueue,declare,4},
> ? ? {rabbit_channel,handle_method,3},
> ? ? {rabbit_channel,handle_cast,2},
> ? ? {gen_server2,handle_msg,7},
> ? ? {proc_lib,wake_up,3}]}
>
> =ERROR REPORT==== 17-Feb-2010::17:32:16 ===
> connection <0.1622.0> (running), channel 3 - error:
> {{badmatch,{error,{{badmatch,{error,emfile}},
> ? ? ? ? ? ? ? ? ? [{rabbit_queue_index,get_journal_handle,1},
> ? ? ? ? ? ? ? ? ? ?{rabbit_queue_index,load_journal,1},
> ? ? ? ? ? ? ? ? ? ?{rabbit_queue_index,init,1},
> ? ? ? ? ? ? ? ? ? ?{rabbit_variable_queue,init,1},
> ? ? ? ? ? ? ? ? ? ?{rabbit_amqqueue_process,init,1},
> ? ? ? ? ? ? ? ? ? ?{gen_server2,init_it,6},
>
> ....
>
> =ERROR REPORT==== 17-Feb-2010::17:33:08 ===
> Mnesia(rabbit at SM2): ** ERROR ** (core dumped to file:
> "/usr/local/sbin/MnesiaCore.rabbit at SM2_1266_456788_594733")
> ?** FATAL ** Cannot open log file
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL":
> {file_error,
>
>
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
>
> ? ? ? ? ? ? ? ? ? ? ? ?emfile}
>
> =ERROR REPORT==== 17-Feb-2010::17:33:08 ===
> ** gen_event handler rabbit_error_logger crashed.
> ** Was installed in error_logger
> ** Last event was: {error,<0.58.0>,
> ? ? ? ? ? ? ? ? ? ? ? {<0.61.0>,
> ? ? ? ? ? ? ? ? ? ? ? ?"Mnesia(~p): ** ERROR ** (core dumped to file:
> ~p)~n ** FATAL ** Cannot open log file ~p: ~p~n",
> ? ? ? ? ? ? ? ? ? ? ? ?[rabbit at SM2,
>
> "/usr/local/sbin/MnesiaCore.rabbit at SM2_1266_456788_594733",
>
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
> ? ? ? ? ? ? ? ? ? ? ? ? {file_error,
>
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? emfile}]}}
> ** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
> ** Reason == {{function_clause,
> ? ? ? ? ? ? ? [{gen,call,
> ? ? ? ? ? ? ? ? [{rex,{error,{node_not_running,rabbit at SM2}}},
> ? ? ? ? ? ? ? ? ?'$gen_call',
> ? ? ? ? ? ? ? ? ?{call,mnesia_lib,db_select_cont,
> ? ? ? ? ? ? ? ? ? [ram_copies,
> ? ? ? ? ? ? ? ? ? ?{rabbit_route,
> ? ? ? ? ? ? ? ? ? ? {binding,
> ? ? ? ? ? ? ? ? ? ? ?{resource,<<"localhost">>,exchange,
> ? ? ? ? ? ? ? ? ? ? ? <<"qik.exc.session">>},
>
> <<"qik.item.session.22ff9df4-c115-4cdf-a721-27f99eba9aaa">>,
> ? ? ? ? ? ? ? ? ? ? ?{resource,<<"localhost">>,queue,
>
> <<"qik.item.session.22ff9df4-c115-4cdf-a721-27f99eba9aaa">>},
> ? ? ? ? ? ? ? ? ? ? ?[]},
> ? ? ? ? ? ? ? ? ? ? [],100,<<>>,[],0,0},
> ? ? ? ? ? ? ? ? ? ?[{'$1',[],['$1']}]],
> ? ? ? ? ? ? ? ? ? <0.0.0>},
> ? ? ? ? ? ? ? ? ?infinity]},
> ? ? ? ? ? ? ? ?{gen_server,call,3},
> ? ? ? ? ? ? ? ?{rpc,do_call,3},
> ? ? ? ? ? ? ? ?{mnesia,do_dirty_rpc,5},
> ? ? ? ? ? ? ? ?{mnesia,select_cont,3},
> ? ? ? ? ? ? ? ?{mnesia,'-qlc_select/1-fun-0-',1},
> ? ? ? ? ? ? ? ?{rabbit_exchange,'-match_bindings/2-fun-1-',10},
> ? ?{rabbit_variable_queue,flush_journal,1},
> ? ? {rabbit_amqqueue_process,handle_pre_hibernate,1}]}
>
> =ERROR REPORT==== 17-Feb-2010::17:33:08 ===
> Mnesia(rabbit at SM2): ** ERROR ** (core dumped to file:
> "/usr/local/sbin/MnesiaCore.rabbit at SM2_1266_456788_594733")
> ?** FATAL ** Cannot open log file
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL":
> {file_error,
>
>
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
>
> ? ? ? ? ? ? ? ? ? ? ? ?emfile}
>
> =ERROR REPORT==== 17-Feb-2010::17:33:08 ===
> ** gen_event handler rabbit_error_logger crashed.
> ** Was installed in error_logger
> ** Last event was: {error,<0.58.0>,
> ? ? ? ? ? ? ? ? ? ? ? {<0.61.0>,
> ? ? ? ? ? ? ? ? ? ? ? ?"Mnesia(~p): ** ERROR ** (core dumped to file:
> ~p)~n ** FATAL ** Cannot open log file ~p: ~p~n",
> ? ? ? ? ? ? ? ? ? ? ? ?[rabbit at SM2,
>
> "/usr/local/sbin/MnesiaCore.rabbit at SM2_1266_456788_594733",
>
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
> ? ? ? ? ? ? ? ? ? ? ? ? {file_error,
>
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.DCL",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? emfile}]}}
>
> ** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
> ** Reason == {{function_clause,
> ? ? ? ? ? ? ? [{gen,call,
> ? ? ? ? ? ? ? ? [{rex,{error,{node_not_running,rabbit at SM2}}},
> ? ? ? ? ? ? ? ? ?'$gen_call',
> ? ? ? ? ? ? ? ? ?{call,mnesia_lib,db_select_cont,
> ? ? ? ? ? ? ? ? ? [ram_copies,
> ? ? ? ? ? ? ? ? ? ?{rabbit_route,
> ? ? ? ? ? ? ? ? ? ? {binding,
> ? ? ? ? ? ? ? ? ? ? ?{resource,<<"localhost">>,exchange,
> ? ? ? ? ? ? ? ? ? ? ? <<"qik.exc.session">>},
>
> <<"qik.item.session.22ff9df4-c115-4cdf-a721-27f99eba9aaa">>,
> ? ? ? ? ? ? ? ? ? ? ?{resource,<<"localhost">>,queue,
>
> <<"qik.item.session.22ff9df4-c115-4cdf-a721-27f99eba9aaa">>},
> ? ? ? ? ? ? ? ? ? ? ?[]},
> ? ? ? ? ? ? ? ? ? ? [],100,<<>>,[],0,0},
> ? ? ? ? ? ? ? ? ? ?[{'$1',[],['$1']}]],
> ? ? ? ? ? ? ? ? ? <0.0.0>},
> ? ? ? ? ? ? ? ? ?infinity]},
> ? ? ? ? ? ? ? ?{gen_server,call,3},
> ? ? ? ? ? ? ? ?{rpc,do_call,3},
> ? ? ? ? ? ? ? ?{mnesia,do_dirty_rpc,5},
> ? ? ? ? ? ? ? ?{mnesia,select_cont,3},
> ? ? ? ? ? ? ? ?{mnesia,'-qlc_select/1-fun-0-',1},
> ? ? ? ? ? ? ? ?{rabbit_exchange,'-match_bindings/2-fun-1-',10},
> ? ? ? ? ? ? ? ?{qlc,collect,1}]},
> ? ? ? ? ? ? ?{gen_server,call,
> ? ? ? ? ? ? ? [{rex,{error,{node_not_running,rabbit at SM2}}},
> ? ? ? ? ? ? ? ?{call,mnesia_lib,db_select_cont,
> ? ? ? ? ? ? ? ? [ram_copies,
> ? ? ? ? ? ? ? ? ?{rabbit_route,
>
> .....
>
>
> ** Reason for termination ==
> ** {{badmatch,{error,emfile}},
> ? ?[{rabbit_queue_index,get_segment_handle,1},
> ? ? {rabbit_queue_index,append_journal_to_segment,2},
> ? ? {rabbit_queue_index,'-flush_journal/1-fun-0-',3},
> ? ? {lists,foldl,3},
> ? ? {rabbit_queue_index,segment_fold,3},
> ? ? {rabbit_queue_index,flush_journal,1},
> ? ? {rabbit_variable_queue,flush_journal,1},
> ? ? {rabbit_amqqueue_process,handle_pre_hibernate,1}]}
>
>
>
> --
> Andrey Smirnov
>



-- 
Andrey Smirnov,
phone. +7 (905) 769-83-20

From tonyg at lshift.net  Thu Feb 18 09:10:31 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 18 Feb 2010 22:10:31 +1300
Subject: [rabbitmq-discuss] rabbit mq C++ client library
In-Reply-To: <E1Ni18c-00016M-00.akalend-mail-ru@f29.mail.ru>
References: <4B7CD664.4020200@lshift.net>
	<E1Ni18c-00016M-00.akalend-mail-ru@f29.mail.ru>
Message-ID: <4B7D0407.8030103@lshift.net>

Alexandre Kalendarev wrote:
> So, next time  (one-two week) I send the draft of Interface.

Very cool! I'm looking forward to this.

Tony




From Alister.Morton at tradition.com  Thu Feb 18 11:02:06 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Thu, 18 Feb 2010 11:02:06 +0000
Subject: [rabbitmq-discuss] Codegen and Python 3.x (was: more complex
 java	client examples)
In-Reply-To: <4B7C7927.7030202@lshift.net>
References: <269388e31002142031i156549b8sc307cdcd00b660a@mail.gmail.com>
	<4B7C7927.7030202@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066F23667BC7@SVR-2K3-BH-EMC.tradition.int>

>>>
The codegen was written when 2.5 was all the rage and 3.0 was a faraway dream. No-one has yet taken the time to investigate porting it forward, so for now, please use a 2.x-series python with the simplejson module installed.
<<<

Where can I find a potted series of steps to follow to generate the code, please? I've used hg to pull down the latest, installed python 2. and the simplejson modules, but when I try to make or run amqp-codegen.py I can't see any output being generated (but I may be doing it in the wrong directory). I'm trying to end up with a build for VS2008 on windows XP - I'd a bit pushed at the moment for time, but this may become a proper project at some point.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From Alister.Morton at tradition.com  Thu Feb 18 11:08:23 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Thu, 18 Feb 2010 11:08:23 +0000
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++
 2005?
In-Reply-To: <4B7CCDA9.7020109@lshift.net>
References: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>
	<20100129104223.GB11306@wellquite.org> <4B7CCDA9.7020109@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066F23667BCB@SVR-2K3-BH-EMC.tradition.int>

> It does. Very much so. My guess is that for windows support, people should try compiling it with mingw or cygwin,
> and use the resulting DLL in a VC++ project.

Ah, that's a shame. That's, to say the least, sub-optimal.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From matthew at lshift.net  Thu Feb 18 15:05:36 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 18 Feb 2010 15:05:36 +0000
Subject: [rabbitmq-discuss] RabbitMQ (branch bug21673) running out of
 file descriptors
In-Reply-To: <ae4b61c1002172358pd38ae5dw36ca54e0e6730f36@mail.gmail.com>
References: <ae4b61c1002172358pd38ae5dw36ca54e0e6730f36@mail.gmail.com>
Message-ID: <20100218150536.GH23769@mrnibble.lshift.net>

Hi Andrey,

On Thu, Feb 18, 2010 at 10:58:34AM +0300, Andrey Smirnov wrote:
> We're running RabbitMQ from branch bug21673 (built yesterday). We have
> a lot of non-persisten queues (2k - 10k+) that are created/destroyed
> all the time. Some queues have unconsumed messaged and they will get
> destroyed with unconsumed messages.
> 
> When file descriptor limit for RabbitMQ was left to default 1024 files
> it was dying in 2 hours. I've raised the limit to 10240 files and it
> worked for 16 hours and crashed.
> 
> Crash for clients looks like "INTERNAL_ERROR" error on connections.
> RabbitMQ is still running and eating 100% of CPU. Restarting RabbitMQ
> helps to revive it.

Many thanks for the bug report. The short version is that this is now
Fixed - if you pull again and rebuild, it should all "just work" now.
The long version is in the commit comment
(http://hg.rabbitmq.com/rabbitmq-server/rev/56a0daed8b4e). I can now
artificially limit Rabbit to approx 3 file descriptors, and it still
runs some fairly aggressive tests perfectly well. Note that whilst on
branch bug21673, Rabbit is able to very flexibly redistribute file
handles as necessary, this obviously doesn't apply to sockets. So you
should make sure you always have at least, say, 100 more file
descriptors available to Rabbit than you need sockets.

Please try retesting - provided you don't have more than about 900
simultaneous connections open, you shouldn't need to raise the ulimit
above 1024, though you might find performance improves if you do.

Do let us know how you get on.

Matthew



From smirnov.andrey at gmail.com  Thu Feb 18 15:38:53 2010
From: smirnov.andrey at gmail.com (Andrey Smirnov)
Date: Thu, 18 Feb 2010 18:38:53 +0300
Subject: [rabbitmq-discuss] RabbitMQ (branch bug21673) running out of
	file descriptors
In-Reply-To: <20100218150536.GH23769@mrnibble.lshift.net>
References: <ae4b61c1002172358pd38ae5dw36ca54e0e6730f36@mail.gmail.com>
	<20100218150536.GH23769@mrnibble.lshift.net>
Message-ID: <ae4b61c1002180738x5b5c5bb2i5b8f845e33a94827@mail.gmail.com>

Thanks a lot, Matthew!

Rebuilt from source, running currently with new version. Will report
back how it goes.

Actually I have about 13 TCP connections to broker and this number is
pretty steady.

2010/2/18 Matthew Sackman <matthew at lshift.net>:
> Hi Andrey,
>
> On Thu, Feb 18, 2010 at 10:58:34AM +0300, Andrey Smirnov wrote:
>> We're running RabbitMQ from branch bug21673 (built yesterday). We have
>> a lot of non-persisten queues (2k - 10k+) that are created/destroyed
>> all the time. Some queues have unconsumed messaged and they will get
>> destroyed with unconsumed messages.
>>
>> When file descriptor limit for RabbitMQ was left to default 1024 files
>> it was dying in 2 hours. I've raised the limit to 10240 files and it
>> worked for 16 hours and crashed.
>>
>> Crash for clients looks like "INTERNAL_ERROR" error on connections.
>> RabbitMQ is still running and eating 100% of CPU. Restarting RabbitMQ
>> helps to revive it.
>
> Many thanks for the bug report. The short version is that this is now
> Fixed - if you pull again and rebuild, it should all "just work" now.
> The long version is in the commit comment
> (http://hg.rabbitmq.com/rabbitmq-server/rev/56a0daed8b4e). I can now
> artificially limit Rabbit to approx 3 file descriptors, and it still
> runs some fairly aggressive tests perfectly well. Note that whilst on
> branch bug21673, Rabbit is able to very flexibly redistribute file
> handles as necessary, this obviously doesn't apply to sockets. So you
> should make sure you always have at least, say, 100 more file
> descriptors available to Rabbit than you need sockets.
>
> Please try retesting - provided you don't have more than about 900
> simultaneous connections open, you shouldn't need to raise the ulimit
> above 1024, though you might find performance improves if you do.
>
> Do let us know how you get on.
>
> Matthew
>



-- 
Andrey Smirnov,
phone. +7 (905) 769-83-20



From irrer at umich.edu  Thu Feb 18 17:55:48 2010
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 18 Feb 2010 12:55:48 -0500
Subject: [rabbitmq-discuss] amqp_channel_open issue
In-Reply-To: <4B7CD894.8060709@lshift.net>
References: <b2514e8a1002100941p43a5c75fs446ea35701220789@mail.gmail.com>
	<20100211160733.GB2942@mrnibble.lshift.net>
	<b2514e8a1002120548s5f26f01fxef6efc2e8058675e@mail.gmail.com>
	<4B7CD894.8060709@lshift.net>
Message-ID: <3b6ef0791002180955s7f760043j979c0506a6b01f76@mail.gmail.com>

So the C client is different from the Java client implementation, which says
that multiple
threads can share a connection, but not a channel:

http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.6.0/rabbitmq-java-client-javadoc-1.6.0/com/rabbitmq/client/Channel.html

While a Channel can be used by multiple threads, it's important to ensure
that only one thread executes a command at once. Concurrent execution of
commands will likely cause an UnexpectedFrameError to be thrown.

Is my understanding correct?

If I have a multi-threaded Java client that needs many channels, then it is
ok (and more efficient)
to have one connection and construct many channels from it?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Feb 18, 2010 at 1:05 AM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Ragavendra,
>
> raghu a wrote:
> > As per my code each thread is using different channel.
> > May I get any  multi threaded C client samples?
>
> I'm sorry to say that multithreaded use of librabbitmq will not work
> without quite a bit of effort. It is designed for event-based systems,
> not multi-threaded systems. Its internal architecture is quite different
> from our other client libraries, where sharing connections between
> threads is just fine.
>
> With that said, however, you *can* use librabbitmq with a connection per
> thread; just don't try to share a connection or its channels between
> threads at the moment.
>
> Regards,
>   Tony
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100218/3a9be8a5/attachment.htm 

From tonyg at lshift.net  Thu Feb 18 19:35:30 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 19 Feb 2010 08:35:30 +1300
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++
 2005?
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891066F23667BCB@SVR-2K3-BH-EMC.tradition.int>
References: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>	<20100129104223.GB11306@wellquite.org>
	<4B7CCDA9.7020109@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891066F23667BCB@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <4B7D9682.4020300@lshift.net>

Alister Morton wrote:
> Ah, that's a shame. That's, to say the least, sub-optimal.

Yes; I'm not even sure that it'd work OK. Can mingw DLLs be used
seamlessly by VC++-compiled code?

Tony



From tonyg at lshift.net  Thu Feb 18 20:30:10 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 19 Feb 2010 09:30:10 +1300
Subject: [rabbitmq-discuss] Running codegen on its own (was Re: Codegen and
 Python 3.x)
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891066F23667BC7@SVR-2K3-BH-EMC.tradition.int>
References: <269388e31002142031i156549b8sc307cdcd00b660a@mail.gmail.com>
	<4B7C7927.7030202@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891066F23667BC7@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <4B7DA352.6060805@lshift.net>

Alister Morton wrote:
> Where can I find a potted series of steps to follow to generate the
> code, please? I've used hg to pull down the latest, installed python
> 2. and the simplejson modules, but when I try to make or run
> amqp-codegen.py I can't see any output being generated (but I may be
> doing it in the wrong directory). I'm trying to end up with a build
> for VS2008 on windows XP - I'd a bit pushed at the moment for time,
> but this may become a proper project at some point.

The rabbitmq-codegen module is generic code used by all the specific
language libraries. For example, rabbitmq-server and rabbitmq-c both
have different "codegen.py" modules in them which use amqp_codegen.py to
parse and preprocess the specification definitions.

So for rabbitmq-c, just as one example,

    hg clone http://hg.rabbitmq.com/rabbitmq-codegen
    hg clone http://hg.rabbitmq.com/rabbitmq-c
    (cd rabbitmq-c; autoreconf -i)
    (cd rabbitmq-c; ./configure)

and then

    make -C rabbitmq-c/librabbitmq amqp_framing.h amqp_framing.c

Take a look at rabbitmq-c/librabbitmq/codegen.py to get a feel for what
the various language-specific codegens are doing.

Regards,
  Tony




From tonyg at lshift.net  Thu Feb 18 20:32:19 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 19 Feb 2010 09:32:19 +1300
Subject: [rabbitmq-discuss] amqp_channel_open issue
In-Reply-To: <3b6ef0791002180955s7f760043j979c0506a6b01f76@mail.gmail.com>
References: <b2514e8a1002100941p43a5c75fs446ea35701220789@mail.gmail.com>	
	<20100211160733.GB2942@mrnibble.lshift.net>	
	<b2514e8a1002120548s5f26f01fxef6efc2e8058675e@mail.gmail.com>	
	<4B7CD894.8060709@lshift.net>
	<3b6ef0791002180955s7f760043j979c0506a6b01f76@mail.gmail.com>
Message-ID: <4B7DA3D3.5010704@lshift.net>

Jim Irrer wrote:
> So the C client is different from the Java client implementation, which
> says that multiple threads can share a connection, but not a channel

Yes, that's right.

> If I have a multi-threaded Java client that needs many channels, then
> it is ok (and more efficient) to have one connection and construct
> many channels from it?

It's certainly OK. Whether it's more efficient or not depends on exactly
what you're doing, but it is definitely more efficient in terms of
socket/TCP resource use. Bear in mind that all the channels are
multiplexed together onto a single TCP socket, and so one channel may
momentarily force another to wait.

Tony




From irrer at umich.edu  Thu Feb 18 21:57:56 2010
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 18 Feb 2010 16:57:56 -0500
Subject: [rabbitmq-discuss] amqp_channel_open issue
In-Reply-To: <4B7DA3D3.5010704@lshift.net>
References: <b2514e8a1002100941p43a5c75fs446ea35701220789@mail.gmail.com>
	<20100211160733.GB2942@mrnibble.lshift.net>
	<b2514e8a1002120548s5f26f01fxef6efc2e8058675e@mail.gmail.com>
	<4B7CD894.8060709@lshift.net>
	<3b6ef0791002180955s7f760043j979c0506a6b01f76@mail.gmail.com>
	<4B7DA3D3.5010704@lshift.net>
Message-ID: <3b6ef0791002181357n19a509a5od17430b546ad18b6@mail.gmail.com>

Excellent.  Thank you.

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Feb 18, 2010 at 3:32 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Jim Irrer wrote:
> > So the C client is different from the Java client implementation, which
> > says that multiple threads can share a connection, but not a channel
>
> Yes, that's right.
>
> > If I have a multi-threaded Java client that needs many channels, then
> > it is ok (and more efficient) to have one connection and construct
> > many channels from it?
>
> It's certainly OK. Whether it's more efficient or not depends on exactly
> what you're doing, but it is definitely more efficient in terms of
> socket/TCP resource use. Bear in mind that all the channels are
> multiplexed together onto a single TCP socket, and so one channel may
> momentarily force another to wait.
>
> Tony
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100218/06bbac4b/attachment.htm 

From erikba at odysseus.anderson.name  Thu Feb 18 22:02:35 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Thu, 18 Feb 2010 14:02:35 -0800 (PST)
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <4B6DD62A.6080300@lshift.net>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>
	<20100128122215.GD4613@wellquite.org>
	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>
	<4B62BF0C.8000001@lshift.net>
	<3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>
	<4B6444B4.3020001@lshift.net>
	<a7768fce-7fce-406a-a53e-861956e33594@b9g2000pri.googlegroups.com>
	<4B6DD62A.6080300@lshift.net>
Message-ID: <f0ff80cf-794e-4515-ab92-1c8160785521@p13g2000pre.googlegroups.com>

Okay, I have created a new rabbitmq.config folder and can confirm that
changing the values is affecting the configured startup.  The current
contents of the file are:

[
	{rabbit_stomp, [{listeners, [{"127.0.0.1",6100}]}]},
	{rabbit, [{vm_memory_high_watermark, 0.2}]}
].

However, there doesn't appear to be any change in the original failure-
to-launch behavior:

=INFO REPORT==== 18-Feb-2010::15:50:11 ===Memory limit set to
818MB.=INFO REPORT==== 18-Feb-2010::15:50:11 ===Rolling persister log
to "c:/tw/comet/rabbitmq-data/db/rabbit-mnesia/
rabbit_persister.LOG.previous"=INFO REPORT==== 18-Feb-2010::15:50:11
===started TCP Listener on 127.0.0.1:5672=ERROR REPORT==== 18-
Feb-2010::15:50:27 ===invalid host "127.0.0.1" - timeout=INFO
REPORT==== 18-Feb-2010::15:50:27 ===    application: rabbit_stomp
exited: {{invalid_host,"127.0.0.1",timeout},
{rabbit_stomp,start,[normal,[]]}}    type: permanent=INFO REPORT====
18-Feb-2010::15:50:27 ===stopped TCP Listener on 127.0.0.1:5672

Best guess with google came up with the following link:
http://www.erlang.org/cgi-bin/ezmlm-cgi?4:msp:45334:iebpbpcoopnniohcljij
There's not terribly much in this conversation though.

Whatever this is appears to be very system-specific, if I was able to
run it successfully on one machine but have it fail on another.

So, any other suggestions?

On Feb 6, 12:50?pm, Matthias Radestock <matth... at lshift.net> wrote:
> Erik,
>
> Erik Anderson wrote:
> > this is the launch line:
> > [...]
> > -rabbit tcp_listeners [{\""127.0.0.1"\","5672"}] stomp_listeners
> > [{\""127.0.0.1"\","61600"}]
>
> You must prefix the stomp_listeners option with -rabbit, just like it's
> done for the tcp_listeners option.
>
> However, that's actually the pre-plugin way of starting stomp. As noted
> in the README of the current version, installing and activating the
> plug-in is all you need to do now to get the stomp adapter wired in and
> started on rabbit startup. And if you want to tweak the listener
> settings then, as Matthew suggested, the best way to do so is by placing
> something like
>
> [{rabbit_stomp, [{listeners, [{"127.0.0.1",6100}]}]}].
>
> into the rabbitmq.config file (which, given your RABBITMQ_BASE setting,
> should live in c:\tw\comet\rabbitmq-data\rabbitmq.config).
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From erikba at odysseus.anderson.name  Thu Feb 18 22:14:25 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Thu, 18 Feb 2010 14:14:25 -0800 (PST)
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <f0ff80cf-794e-4515-ab92-1c8160785521@p13g2000pre.googlegroups.com>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>
	<20100128122215.GD4613@wellquite.org>
	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>
	<4B62BF0C.8000001@lshift.net>
	<3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>
	<4B6444B4.3020001@lshift.net>
	<a7768fce-7fce-406a-a53e-861956e33594@b9g2000pri.googlegroups.com>
	<4B6DD62A.6080300@lshift.net>
	<f0ff80cf-794e-4515-ab92-1c8160785521@p13g2000pre.googlegroups.com>
Message-ID: <9d73e2ec-3992-4b34-8b23-7790b7cbdcdd@l12g2000prg.googlegroups.com>

Bah!  okay, looks like I solved my own problem.

ALL instances of "127.0.0.1" in both the startup script and config
have been changed to {127,0,0,1}

I'm guessing success messages now.

That took way too long...

On Feb 18, 2:02?pm, Erik Anderson <eri... at odysseus.anderson.name>
wrote:
> Okay, I have created a new rabbitmq.config folder and can confirm that
> changing the values is affecting the configured startup. ?The current
> contents of the file are:
>
> [
> ? ? ? ? {rabbit_stomp, [{listeners, [{"127.0.0.1",6100}]}]},
> ? ? ? ? {rabbit, [{vm_memory_high_watermark, 0.2}]}
> ].
>
> However, there doesn't appear to be any change in the original failure-
> to-launch behavior:
>
> =INFO REPORT==== 18-Feb-2010::15:50:11 ===Memory limit set to
> 818MB.=INFO REPORT==== 18-Feb-2010::15:50:11 ===Rolling persister log
> to "c:/tw/comet/rabbitmq-data/db/rabbit-mnesia/
> rabbit_persister.LOG.previous"=INFO REPORT==== 18-Feb-2010::15:50:11
> ===started TCP Listener on 127.0.0.1:5672=ERROR REPORT==== 18-
> Feb-2010::15:50:27 ===invalid host "127.0.0.1" - timeout=INFO
> REPORT==== 18-Feb-2010::15:50:27 === ? ?application: rabbit_stomp
> exited: {{invalid_host,"127.0.0.1",timeout},
> {rabbit_stomp,start,[normal,[]]}} ? ?type: permanent=INFO REPORT====
> 18-Feb-2010::15:50:27 ===stopped TCP Listener on 127.0.0.1:5672
>
> Best guess with google came up with the following link:http://www.erlang.org/cgi-bin/ezmlm-cgi?4:msp:45334:iebpbpcoopnniohcljij
> There's not terribly much in this conversation though.
>
> Whatever this is appears to be very system-specific, if I was able to
> run it successfully on one machine but have it fail on another.
>
> So, any other suggestions?
>
> On Feb 6, 12:50?pm, Matthias Radestock <matth... at lshift.net> wrote:
>
>
>
>
>
> > Erik,
>
> > Erik Anderson wrote:
> > > this is the launch line:
> > > [...]
> > > -rabbit tcp_listeners [{\""127.0.0.1"\","5672"}] stomp_listeners
> > > [{\""127.0.0.1"\","61600"}]
>
> > You must prefix the stomp_listeners option with -rabbit, just like it's
> > done for the tcp_listeners option.
>
> > However, that's actually the pre-plugin way of starting stomp. As noted
> > in the README of the current version, installing and activating the
> > plug-in is all you need to do now to get the stomp adapter wired in and
> > started on rabbit startup. And if you want to tweak the listener
> > settings then, as Matthew suggested, the best way to do so is by placing
> > something like
>
> > [{rabbit_stomp, [{listeners, [{"127.0.0.1",6100}]}]}].
>
> > into the rabbitmq.config file (which, given your RABBITMQ_BASE setting,
> > should live in c:\tw\comet\rabbitmq-data\rabbitmq.config).
>
> > Regards,
>
> > Matthias.
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From frank.goenninger at consequor.de  Thu Feb 18 23:46:05 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Fri, 19 Feb 2010 00:46:05 +0100
Subject: [rabbitmq-discuss] amqp_login -> AMQP_RESPONSE_NONE (RabbitMQ
	C	Client)
In-Reply-To: <4B7CB561.6080301@lshift.net>
References: <D2EDA5E6-B26E-48E6-92F3-728BB218C54B@consequor.de>
	<4B7B96C8.40108@lshift.net>
	<1A6BDC58-4FDB-4182-83EB-8ED3F262F686@consequor.de>
	<4B7CB561.6080301@lshift.net>
Message-ID: <6CA816F2-15F5-41A1-A575-6FFE2ECDEAC7@consequor.de>

Hi Toni,

Am 18.02.2010 um 04:34 schrieb Tony Garnock-Jones:

> Hi Frank,
> 
> Thanks for posting the code. I think I see the problem.
> 
> Frank G?nninger wrote:
>>  amqp_login( psContext->psPIBAMQPConnection->psConnection,
>>              psContext->psPIBAMQPConnection->pcAMQPVirtualHost,
>>              psContext->psPIBAMQPConnection->nAMQPChannelMax,
>>              psContext->psPIBAMQPConnection->nAMQPFrameMax,
>>              psContext->psPIBAMQPConnection->nAMQPHeartbeat,
>>              psContext->psPIBAMQPConnection->nAMQPSaslMethod,
>>              psContext->psPIBAMQPConnection->pcAMQPUser,
>>              psContext->psPIBAMQPConnection->pcAMQPPassword );
>> 
>>  nRC = nCheckAMQPRpcReply( psContext, amqp_get_rpc_reply(),
>>                            __FILE__, __LINE__, __func__ );
> 
> The problem is that amqp_get_rpc_reply() is only intended for use with
> API operations that don't themselves return an amqp_rpc_reply_t. The
> amqp_login function does return an amqp_rpc_reply_t value, so you should
> be checking that instead of the result of amqp_get_rpc_reply(). It's
> confusing and undocumented, I know; I'm working on making it less
> confusing and improving the documentation too.

Ok, I see. Will change my code accordingly.

> 
> [Aside: everything after the SASL method argument to amqp_login is
> varargs, so if you're hard-coding the username and password in those
> positions, it makes sense to remove your nAMQPSaslMethod field and
> instead hardcode AMQP_SASL_METHOD_PLAIN.]
> 
> I've also changed the code just now to no longer ignore the result of
> amqp_login_inner. Thanks for the bug reports!
> 
> Regards,
>  Tony

Thank you for jumping in so quickly. I just *love* the support you guys are providing!

Cheers
  Frank

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446





From mrdunn at gmail.com  Fri Feb 19 05:10:24 2010
From: mrdunn at gmail.com (Matthew Dunn)
Date: Fri, 19 Feb 2010 15:40:24 +1030
Subject: [rabbitmq-discuss] WCF bindings support SOAP -- what would be
	invovled in others?
Message-ID: <4d260fa71002182110r54840346gf9283f79f9d20e2c@mail.gmail.com>

Hello everyone,

I'm reviewing suitability for RabbitMQ use within a credit union I'm working
for.

I read in the
Guide to the WCF binding and Service
Model<http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.7.2/rabbitmq-dotnet-client-1.7.2-wcf-service-model.pdf>that
presently only SOAP endpoints are supported.

Would anyone be able to tell me how much effort would be involved in
creating a custom binding that will support the same binary serializer used
by the net.tcp binding?

Is this only a configuraiton change or must custom code be developed?
It would be even better if someone can point me at existing code that also
implements the binary serializer for the RabbitMQ WCF binding?

We are hoping to support multiple endpoints listening on queues each
addressable with a different WCF binding, eg Soap, Binary, POX, JSON

But initially the main ones we are interested in is soap and binary

Thanks for your time,

Matthew Dunn.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100219/5393be47/attachment.htm 

From Alister.Morton at tradition.com  Fri Feb 19 08:52:05 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Fri, 19 Feb 2010 08:52:05 +0000
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++
 2005?
In-Reply-To: <4B7D9682.4020300@lshift.net>
References: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>
	<20100129104223.GB11306@wellquite.org> <4B7CCDA9.7020109@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891066F23667BCB@SVR-2K3-BH-EMC.tradition.int>
	<4B7D9682.4020300@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066F23667CBE@SVR-2K3-BH-EMC.tradition.int>

> Yes; I'm not even sure that it'd work OK. Can mingw DLLs be used seamlessly by VC++-compiled code?

TBH I haven't tried it, but not being able to step into the dll in the same debugger while debugging the wrapper would be tedious to say the least.

Al.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From Alister.Morton at tradition.com  Fri Feb 19 08:54:19 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Fri, 19 Feb 2010 08:54:19 +0000
Subject: [rabbitmq-discuss] Running codegen on its own (was Re: Codegen
 and Python 3.x)
In-Reply-To: <4B7DA352.6060805@lshift.net>
References: <269388e31002142031i156549b8sc307cdcd00b660a@mail.gmail.com>
	<4B7C7927.7030202@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891066F23667BC7@SVR-2K3-BH-EMC.tradition.int>
	<4B7DA352.6060805@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066F23667CBF@SVR-2K3-BH-EMC.tradition.int>

The rabbitmq-codegen module is generic code used by all the specific language libraries. For example, rabbitmq-server and rabbitmq-c both have different "codegen.py" modules in them which use amqp_codegen.py to parse and preprocess the specification definitions.

So for rabbitmq-c, just as one example,

    hg clone http://hg.rabbitmq.com/rabbitmq-codegen
    hg clone http://hg.rabbitmq.com/rabbitmq-c
    (cd rabbitmq-c; autoreconf -i)
    (cd rabbitmq-c; ./configure)

and then

    make -C rabbitmq-c/librabbitmq amqp_framing.h amqp_framing.c

Take a look at rabbitmq-c/librabbitmq/codegen.py to get a feel for what the various language-specific codegens are doing.

Regards,
  Tony


Thanks, I'll look into that.


Al.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From stuart.herbert at gradwell.com  Fri Feb 19 14:29:22 2010
From: stuart.herbert at gradwell.com (Stuart Herbert)
Date: Fri, 19 Feb 2010 14:29:22 +0000
Subject: [rabbitmq-discuss] Version numbers for librabbitmq-c?
Message-ID: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com>

Hi everyone,

I'm looking to work with RabbitMQ from PHP, and have run into several problems with getting the various PHP extensions to compile.

One of the causes of these problems is that (as far as I can tell) there are no versioned releases of librabbitmq-c for a PHP extension to state that it is compatible with.

Are there any plans to start versioning releases of librabbitmq-c?

Best regards,
Stu
--


From smirnov.andrey at gmail.com  Fri Feb 19 15:49:57 2010
From: smirnov.andrey at gmail.com (Andrey Smirnov)
Date: Fri, 19 Feb 2010 18:49:57 +0300
Subject: [rabbitmq-discuss] RabbitMQ (branch bug21673) running out of
	file descriptors
In-Reply-To: <ae4b61c1002180738x5b5c5bb2i5b8f845e33a94827@mail.gmail.com>
References: <ae4b61c1002172358pd38ae5dw36ca54e0e6730f36@mail.gmail.com>
	<20100218150536.GH23769@mrnibble.lshift.net>
	<ae4b61c1002180738x5b5c5bb2i5b8f845e33a94827@mail.gmail.com>
Message-ID: <ae4b61c1002190749g761b363boe2dfc4723d7156d9@mail.gmail.com>

24 hours with new version - still running fine.

Thanks for the quick fix!

2010/2/18 Andrey Smirnov <smirnov.andrey at gmail.com>:
> Thanks a lot, Matthew!
>
> Rebuilt from source, running currently with new version. Will report
> back how it goes.
>
> Actually I have about 13 TCP connections to broker and this number is
> pretty steady.
>
> 2010/2/18 Matthew Sackman <matthew at lshift.net>:
>> Hi Andrey,
>>
>> On Thu, Feb 18, 2010 at 10:58:34AM +0300, Andrey Smirnov wrote:
>>> We're running RabbitMQ from branch bug21673 (built yesterday). We have
>>> a lot of non-persisten queues (2k - 10k+) that are created/destroyed
>>> all the time. Some queues have unconsumed messaged and they will get
>>> destroyed with unconsumed messages.
>>>
>>> When file descriptor limit for RabbitMQ was left to default 1024 files
>>> it was dying in 2 hours. I've raised the limit to 10240 files and it
>>> worked for 16 hours and crashed.
>>>
>>> Crash for clients looks like "INTERNAL_ERROR" error on connections.
>>> RabbitMQ is still running and eating 100% of CPU. Restarting RabbitMQ
>>> helps to revive it.
>>
>> Many thanks for the bug report. The short version is that this is now
>> Fixed - if you pull again and rebuild, it should all "just work" now.
>> The long version is in the commit comment
>> (http://hg.rabbitmq.com/rabbitmq-server/rev/56a0daed8b4e). I can now
>> artificially limit Rabbit to approx 3 file descriptors, and it still
>> runs some fairly aggressive tests perfectly well. Note that whilst on
>> branch bug21673, Rabbit is able to very flexibly redistribute file
>> handles as necessary, this obviously doesn't apply to sockets. So you
>> should make sure you always have at least, say, 100 more file
>> descriptors available to Rabbit than you need sockets.
>>
>> Please try retesting - provided you don't have more than about 900
>> simultaneous connections open, you shouldn't need to raise the ulimit
>> above 1024, though you might find performance improves if you do.
>>
>> Do let us know how you get on.
>>
>> Matthew
>>
>
>
>
> --
> Andrey Smirnov,
> phone. +7 (905) 769-83-20
>



-- 
Andrey Smirnov,
phone. +7 (905) 769-83-20



From tonyg at lshift.net  Fri Feb 19 22:05:19 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 20 Feb 2010 11:05:19 +1300
Subject: [rabbitmq-discuss] Documentation for Rabbitmq-SMTP plugin
Message-ID: <4B7F0B1F.5060801@lshift.net>

Hi all,

I've just added a bit of documentation to the rabbitmq-smtp plugin.
Suggestions and critique welcome.

http://hg.rabbitmq.com/rabbitmq-smtp/file/default/README.md

Regards,
  Tony



From arun.suresh at gmail.com  Sat Feb 20 07:32:02 2010
From: arun.suresh at gmail.com (Arun Suresh)
Date: Sat, 20 Feb 2010 13:02:02 +0530
Subject: [rabbitmq-discuss] Re-creation of queues not allowed
Message-ID: <9f4a617f1002192332l47c647a3ofdcffa476579e4bb@mail.gmail.com>

Hello..

I noticed that  from RabbitMQ 1.7.1 onwards, re-creation of a queue on a
live node of a rabbit cluster when the node where the queue was initially
created goes down is disallowed.
I would be really great-full if somebody would explain to me the rationale
for this decision.. As we rely on this SPECIFIC property to address
availability issues since Queues are currently not replicated across the
cluster.

Also, It would be really awesome if somebody would explain to me what is the
recommended approach to a situation when a node goes down.

Thanx in advance
-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100220/45c24ef6/attachment.htm 

From matthias at lshift.net  Sat Feb 20 10:46:21 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 20 Feb 2010 10:46:21 +0000
Subject: [rabbitmq-discuss] Behaviour change from rabbitMQ v1.7.0 to
	v1.7.1
In-Reply-To: <9f4a617f1002172006p6b44d7cof739e68d5e5c3b15@mail.gmail.com>
References: <9f4a617f1002172006p6b44d7cof739e68d5e5c3b15@mail.gmail.com>
Message-ID: <4B7FBD7D.30207@lshift.net>

Arun,

apologies for the late reply. We have been rather busy (even more so 
than usual).

Arun Suresh wrote:
> We are currently using RabbitMQ 1.7.0 and we'd like to move to 1.7.2 but 
> we have noticed a fundamental behavior change across these versions. 
> [...]
> if 'rabbit at host1' goes down, 'client1' cannot recreate 'test_queue' on 
> 'rabbit at host2'.
> Do this imply that... all queues created on the node WILL be unavailable 
> for the duration of the nodes outage ??

It has always been the case that when a queue's host node goes down that 
the queue is unavailable for the duration of the outage. However, 
previously it was possible to create a queue *with the same name* on a 
different node. That queue was *not* the same logical queue, and its 
creation could result in observable client behaviour that violates the 
AMQP spec and is surprising to users (you'll find a few reports on the 
mailing list), e.g. messages suddenly vanish and re-appear on node 
restart. There were also cases where the persister would get confused, 
and message duplication could occur.

> 2) What is the suggested approach to tackle these types of availability 
> issues in rabbitMQ ?

The objective of RabbitMQ's current clustering approach is scalability. 
It does little to improve availability. For the latter there are several 
approaches, depending on what exactly you need to have available and 
whether short outages are acceptable. One common solution is to have a 
hot standby broker, i.e. have an active/passive setup. iirc this has 
been discussed on the list before, so a search should throw up some results.


Regards,

Matthias.



From matthew at lshift.net  Sat Feb 20 18:11:41 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sat, 20 Feb 2010 18:11:41 +0000
Subject: [rabbitmq-discuss] Re-creation of queues not allowed
In-Reply-To: <9f4a617f1002192332l47c647a3ofdcffa476579e4bb@mail.gmail.com>
References: <9f4a617f1002192332l47c647a3ofdcffa476579e4bb@mail.gmail.com>
Message-ID: <20100220181140.GA20598@wellquite.org>

Howdy,

On Sat, Feb 20, 2010 at 01:02:02PM +0530, Arun Suresh wrote:
> I noticed that  from RabbitMQ 1.7.1 onwards, re-creation of a queue on a
> live node of a rabbit cluster when the node where the queue was initially
> created goes down is disallowed.

Indeed.

> I would be really great-full if somebody would explain to me the rationale
> for this decision.. As we rely on this SPECIFIC property to address
> availability issues since Queues are currently not replicated across the
> cluster.

The rational is that in the event of the failed node coming back up, you
then have two queues with the same name. A consumer could then drain the
recovered queue, but the acks for that end up going to the newer queue,
and disappear. Thus any situation where you can end up with two queues
with the same name leads to a sudden on-rush of violent bears. The decision
was made that the most sensible thing to do was to return a 404 which is
literally saying "Yes, this looks to be a queue re-declaration, but we
*can't find* (hence 404) the queue because it's on a failed node".

> Also, It would be really awesome if somebody would explain to me what is the
> recommended approach to a situation when a node goes down.

Depends massively on your situation. Clustering in Rabbit is meant to
facilitate scalability, not high availability. If you could provide some
further details of your scenario, we'd be better able to advise.

Matthew



From matthew at lshift.net  Sat Feb 20 21:00:21 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sat, 20 Feb 2010 21:00:21 +0000
Subject: [rabbitmq-discuss] beam process using 100% cpu and lots of
 memory
In-Reply-To: <4f89225b1002151551p1cccdf63uccb1a44fb902d320@mail.gmail.com>
References: <4f89225b1002151551p1cccdf63uccb1a44fb902d320@mail.gmail.com>
Message-ID: <20100220210021.GB20598@wellquite.org>

Hi Joel,

On Tue, Feb 16, 2010 at 10:51:31AM +1100, Joel Heenan wrote:
> We are having a situation where when we put lots of data through a
> RabbitMQ queue we sometimes we see a beam process running using 100%
> cpu and up to 1.5GB (RSS) of memory. The only way to resolve this
> situation is to restart RabbitMQ.

Nah, if you leave it alone for a while, it'll probably recover. ;)

You may be just seeing a badly overwhelmed queue, which probably would
recover eventually. Or it could be that you're running out of RAM and
it's starting to thrash swap. You may wish to test using the new
persister branch as that is much better at dealing with memory pressure.
However, before you even try that, how long are the queues getting, what
is the average size of the messages being published, and at what rate
are the messages being published?

> We are talking a very large number of connections here, 1807334
> connections in 17 hours, or 29/second.

That's potentially a problem. We've recently discovered that the error
logger, as it logs a couple of messages for every connection, isn't very
fast, and its mailbox can rapidly grow. We only noticed this because of,
what looked like, a DDoS against a public installation - that was 1000s
of connections a second, and the error logger was effectively becoming a
memory leak.

Could you not do any sort of connection pooling? Making a connection +
channel just to publish a couple of messages is spectacularly
inefficient.

> We started using RabbitMQ Stomp Server 1.6.0-5 then moved to version
> latest public umbrella (as of 24 hours ago). OS is Centos 5.4 x86_64
> Xen domU with 4GB of RAM and 1VCPU.
> 
> We are using persistent mode on the queues, currently testing with
> non-persistent.

If you're not using the new persister (branch bug21673), that likely
won't make too much difference as all messages are always held in RAM.

If you could provide a few more details then we may have a better idea
of what to suggest.

Matthew



From arun.suresh at gmail.com  Sun Feb 21 05:18:37 2010
From: arun.suresh at gmail.com (Arun Suresh)
Date: Sun, 21 Feb 2010 10:48:37 +0530
Subject: [rabbitmq-discuss] Re-creation of queues not allowed
In-Reply-To: <20100220181140.GA20598@wellquite.org>
References: <9f4a617f1002192332l47c647a3ofdcffa476579e4bb@mail.gmail.com>
	<20100220181140.GA20598@wellquite.org>
Message-ID: <9f4a617f1002202118t3d758b57rda0b6325e624e0cb@mail.gmail.com>

Hello Mathew..

Thank you for your reply..


> Also, It would be really awesome if somebody would explain to me what is
> the
> > recommended approach to a situation when a node goes down.
>
> Depends massively on your situation. Clustering in Rabbit is meant to
> facilitate scalability, not high availability. If you could provide some
> further details of your scenario, we'd be better able to advise.
>
> Matthew
>
>
Ok.. Here is a very simplistic description of our setup..

Assume we have 2 rabbit nodes.. R1 and R2.
and 2 Clinets C1 and C2 (running the same code-base). C1 on startup creates
a connection to R1, creates and subscribes to a queue 'Q'. C2 on startup
creates connection to R2 and subscribes to the same Q. So now we have Q
created on R1 but 2 consumers subscribing to it.

Q is bound to a direct exchange X. The idea is that a producer might publish
an event on X.. which can be handled by either C1 or C2.

Up until now (since we were using Rabbit 1.7.0), If say R1 goes down, C1 is
notified (since it is connected to R1) so C1 reconnects to R2 and recreates
the Q on R2.. it also notifies C2.. so C2 can re-connect to R2 and
re-subscribe to the new queue (also named Q)..
Thus... Thus any event sent on X will still be routed to C1 or C2. (Only
caveat is... when R1 comes back, all messages that were in the Old queue is
appended to the New queue.... since we arnt really particular about the
ordering.. that should be fine..)

How do think we should tackle this situation now ?

Thanx in Advance
-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100221/464414e3/attachment.htm 

From matthias at lshift.net  Sun Feb 21 12:11:17 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 21 Feb 2010 12:11:17 +0000
Subject: [rabbitmq-discuss] Re-creation of queues not allowed
In-Reply-To: <9f4a617f1002202118t3d758b57rda0b6325e624e0cb@mail.gmail.com>
References: <9f4a617f1002192332l47c647a3ofdcffa476579e4bb@mail.gmail.com>	<20100220181140.GA20598@wellquite.org>
	<9f4a617f1002202118t3d758b57rda0b6325e624e0cb@mail.gmail.com>
Message-ID: <4B8122E5.8070202@lshift.net>

Arun,

Arun Suresh wrote:
> Thus... Thus any event sent on X will still be routed to C1 or C2. (Only 
> caveat is... when R1 comes back, all messages that were in the Old queue 
> is appended to the New queue.... since we arnt really particular about 
> the ordering.. that should be fine..)

This is not something the system was designed to do. It is not in the 
spirit of the AMQP spec and only ever half-worked by accident - messages 
recovered in that way would stay in R1's persister forever, resulting in 
message duplication on subsequent restarts. The list received some 
reports of this happening, which prompted us to change the behaviour.

> How do think we should tackle this situation now ?

Depends on whether you can afford to lose some messages in the event of 
a node outage. Presumably you can since even in your existing setup any 
publishes occurring between the time R1 goes down and the queue gets 
re-created on R2 are not enqueued.

Plus if your consumers can keep up then the queues will generally be 
empty anyway.

In that case simply make the queues non-durable and the messages 
non-persistent. That way when R1 goes down the queue well and truly 
disappears and you can re-create it on another node, i.e. your existing 
logic would work just fine.


Regards,

Matthias



From matthew at lshift.net  Sun Feb 21 12:50:03 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 21 Feb 2010 12:50:03 +0000
Subject: [rabbitmq-discuss] Re-creation of queues not allowed
In-Reply-To: <4B8122E5.8070202@lshift.net>
References: <9f4a617f1002192332l47c647a3ofdcffa476579e4bb@mail.gmail.com>
	<20100220181140.GA20598@wellquite.org>
	<9f4a617f1002202118t3d758b57rda0b6325e624e0cb@mail.gmail.com>
	<4B8122E5.8070202@lshift.net>
Message-ID: <20100221125003.GA14274@wellquite.org>

On Sun, Feb 21, 2010 at 12:11:17PM +0000, Matthias Radestock wrote:
> In that case simply make the queues non-durable and the messages 
> non-persistent. That way when R1 goes down the queue well and truly 
> disappears and you can re-create it on another node, i.e. your existing 
> logic would work just fine.

Yup. I was going to suggest not using a cluster, then having both
consumers create the queues and subscribe on *both* nodes. Then you
could stick a load balancer or just have a smart producer - provided
the producer can send a message to one of the two nodes, that message
well get to one of the clients. This seems to be more what you're
after - HA rather than scalability.

Matthew



From arun.suresh at gmail.com  Sun Feb 21 13:48:37 2010
From: arun.suresh at gmail.com (Arun Suresh)
Date: Sun, 21 Feb 2010 19:18:37 +0530
Subject: [rabbitmq-discuss] Re-creation of queues not allowed
In-Reply-To: <20100221125003.GA14274@wellquite.org>
References: <9f4a617f1002192332l47c647a3ofdcffa476579e4bb@mail.gmail.com>
	<20100220181140.GA20598@wellquite.org>
	<9f4a617f1002202118t3d758b57rda0b6325e624e0cb@mail.gmail.com>
	<4B8122E5.8070202@lshift.net> <20100221125003.GA14274@wellquite.org>
Message-ID: <9f4a617f1002210548p32ec4f1cyf460d1e5154efc90@mail.gmail.com>

Thanks for the suggestions guys..

Let me see if i can re-architect it the way u mentioned..

Regard
-Arun

On Sun, Feb 21, 2010 at 6:20 PM, Matthew Sackman <matthew at lshift.net> wrote:

> On Sun, Feb 21, 2010 at 12:11:17PM +0000, Matthias Radestock wrote:
> > In that case simply make the queues non-durable and the messages
> > non-persistent. That way when R1 goes down the queue well and truly
> > disappears and you can re-create it on another node, i.e. your existing
> > logic would work just fine.
>
> Yup. I was going to suggest not using a cluster, then having both
> consumers create the queues and subscribe on *both* nodes. Then you
> could stick a load balancer or just have a smart producer - provided
> the producer can send a message to one of the two nodes, that message
> well get to one of the clients. This seems to be more what you're
> after - HA rather than scalability.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100221/7186c600/attachment.htm 

From david.wragg at lshift.net  Mon Feb 22 01:23:06 2010
From: david.wragg at lshift.net (David Wragg)
Date: Mon, 22 Feb 2010 01:23:06 +0000
Subject: [rabbitmq-discuss] Version numbers for librabbitmq-c?
In-Reply-To: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com> (Stuart
	Herbert's message of "Fri\, 19 Feb 2010 14\:29\:22 +0000")
References: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com>
Message-ID: <k5ljemt66d.fsf@mrbraver.lshift.net>

Stuart Herbert <stuart.herbert at gradwell.com> writes:
> I'm looking to work with RabbitMQ from PHP, and have run into
> several problems with getting the various PHP extensions to compile.
>
> One of the causes of these problems is that (as far as I can tell)
> there are no versioned releases of librabbitmq-c for a PHP extension
> to state that it is compatible with.
>
> Are there any plans to start versioning releases of librabbitmq-c?

Despite the interesting things people have done with it, librabbitmq
remains experimental software.  At this point in time, it is not
mature enough for us to version and release it along with the
principal RabbitMQ components.

But perhaps there are other less significant steps we could take to
resolve the issue you mention.  I'm afraid I'm not familiar with PHP
extension development.  How are the dependencies of PHP extensions
expressed - is there some documentation you could point us to?

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From pauljones23 at gmail.com  Mon Feb 22 08:07:52 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 22 Feb 2010 08:07:52 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.7.2 Available in Sonatype OSS
	Maven Repository
In-Reply-To: <29598b611002170331j7c53860ax31bb11f082a851f1@mail.gmail.com>
References: <29598b611002170331j7c53860ax31bb11f082a851f1@mail.gmail.com>
Message-ID: <29598b611002220007k58211f8ag77c4a13f32460707@mail.gmail.com>

And following up on this, 1.7.2 is now available in central. So, as per the
website, you'll now be able to add:

<dependency>
  <groupId>com.rabbitmq</groupId>
  <artifactId>amqp-client</artifactId>
  <version>1.7.2</version>
</dependency>

to you pom, and RabbitMQ will be available.

Thanks to the kind folks at Sonatype for hosting the OSS repository, thus
making this whole process possible (with very little maintenance on our side
too!)

Cheers,
Paul.

On Wed, Feb 17, 2010 at 11:31 AM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi,
>
> Following the release of RabbitMQ 1.7.2, the Java client is available for
> Maven users via the repository hosted by Sonatype at
> http://oss.sonatype.org/content/repositories/releases. We're hoping to get
> synching to central set up soon too, so specifically listing the repository
> should only be necessary whilst we get that process completed.
>
> For those wishing to use the client before this happens, you'll need to add
> a repository element to your pom, such as:
>
> <repositories>
>   <repository>
>       <id>sonatype-oss-releases</id>
>       <name>Sonatype OSS Releases</name>
>       <url>http://oss.sonatype.org/content/repositories/releases/</url>
>     </repository>
> </repositories>
>
> If you already run an internal Maven mirror, you could also just configure
> that repository as an upstream (instructions are left up to the reader on
> that part though).
>
> Cheers,
> Paul.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100222/d4b1ced4/attachment.htm 

From david.maciver at lshift.net  Mon Feb 22 11:24:59 2010
From: david.maciver at lshift.net (David R. MacIver)
Date: Mon, 22 Feb 2010 11:24:59 +0000
Subject: [rabbitmq-discuss] topix
In-Reply-To: <764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>
References: <167204d21002191543t3dc86c25p978045e93ac67ad@mail.gmail.com>
	<E5B16948-B49D-40A0-BFAE-D2DFE1AC9F79@gmail.com>
	<167204d21002191604i16a23da6p46f0a93a6c33b529@mail.gmail.com>
	<4B7FB761.9010009@lshift.net>
	<392D5185-DE31-40B5-93D5-3673332BA6D2@gmail.com>
	<4B7FBE37.5070309@lshift.net>
	<764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>
Message-ID: <20100222112459.GA10988@missbossy>

For those just joining us, the discussion is on the implementation of topic 
exchanges.

On Sat, Feb 20, 2010 at 02:52:41AM -0800, Yurii Rashkovskii wrote:
> Matthias,
> 
> On 2010-02-20, at 2:49 AM, Matthias Radestock wrote:
> 
> > Yurii,
> > 
> > Yurii Rashkovskii wrote:
> >> Out of curiosity, how this finite state machine would work?
> > 
> > Let me hand you over to my colleagues Matthew Sackman and David MacIver, who have been discussing this recently.
> 
> Thanks!

Hi, 

There's still a bunch of discussion to be resolved about this (and will no doubt 
be more when we actually find time to implement it).

A couple points to consideri:

We essentially have three operations we need to optimise:

1. adding a binding
2. removing a binding
3. looking up a key against a set of bindings

Currently the first two are fast (probably O(log(n)). Depends what mnesia is doing)
but the third is O(length of key * number of bindings). This is sub-optimal.

The naive solution would be to recompile the bindings to a finite automaton every
time they change, but this is an O(number of bindings) operation, so this would
result in creating O(n) bindings being O(n^2), which isn't great. So the objective
is to build the tree incrementally in a way makes each operation relatively cheap.

The version I proposed (which is almost certainly not how it will look in the end)
is that we'd implement it as a mostly-optimized NFA (only mostly because it makes
 the cost of all binding modification operations way cheaper to do it this way 
while not hurting binding lookup that much). This actually ends up being relatively
close to the tree of topics you proposed in your earlier email. 

Essentially the way it would look is that you'd have the obvious NFA corresponding
to any given binding and then merge prefixes for these.

So e.g. the binding foo.bar.baz to queue 1 would simply look like:

1 -(foo)-> 2 -(bar)-> 3 -(baz)-> [queue-1]

while foo.#.baz to queue-2 would give

1 -(foo)-> 2 -(.)-> 2
            -(epsilon)-> 3 -(baz)-> [queue-2]

(where an epsilon transition is as usual one that doesn't consume any tokens)

And adding both would result in:

1 -(foo)-> 2 -(epsilon)-> 3 -(bar)-> 4 -(baz)-> [queue-1]
             -(epsilon)-> 5 -(.)-> 5
                            -(epsilon)-> 6 -(baz)-> [queue-2]

It's worth noting that although in principle if both bindings were to queue-1 we
would be able to merge nodes 6 and 7, we probably wouldn't do so: Because we want
these machines to be incrementally editable there will definitely be some redundant
nodes.

One thing we've discussed is the choice between an NFA and a DFA. On the one hand,
the DFA will be a lot faster on lookup for the cases it's well suited to (as well 
as constant factors, the DFA will be O(length of key) while the NFA will be more
like O(length of key * number of _matching_ bindings)), on the other hand it will 
be slower for binding deletion (because you have to scan multiplea branches of 
the tree to delete a single binding). 

Additionally there are pathological cases where a DFA ends up with an exponentially 
larger number of nodes than the equivalent DFA. For example:

#.foo{".*" k times} 

takes O(2^k) nodes to represent with a DFA but O(k) nodes with an NFA.

One thing that would help us to make these decisions as to the best approach would
be some feedback on how people are using topic exchanges in the real world: e.g.
if it turns out that basically all bindings are short then the space explosion 
isn't really an issue. If bindings are created rarely, or typically in big blocks,
then we could optimise for that. There's not going to be a universally "best" 
solution, so while the objective is of course to make everything as fast as possible
it always helps to know which operations we need to worry about the most. 

Hope that helps clarify some of our thoughts so far.

Regards,
David



From sustrik at 250bpm.com  Mon Feb 22 11:46:33 2010
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Mon, 22 Feb 2010 12:46:33 +0100
Subject: [rabbitmq-discuss] topix
In-Reply-To: <20100222112459.GA10988@missbossy>
References: <167204d21002191543t3dc86c25p978045e93ac67ad@mail.gmail.com>	<E5B16948-B49D-40A0-BFAE-D2DFE1AC9F79@gmail.com>	<167204d21002191604i16a23da6p46f0a93a6c33b529@mail.gmail.com>	<4B7FB761.9010009@lshift.net>	<392D5185-DE31-40B5-93D5-3673332BA6D2@gmail.com>	<4B7FBE37.5070309@lshift.net>	<764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>
	<20100222112459.GA10988@missbossy>
Message-ID: <4B826E99.3080105@250bpm.com>

Hi David,

 > One thing that would help us to make these decisions as to the best 
approach would
 > be some feedback on how people are using topic exchanges in the real 
world: e.g.
 > if it turns out that basically all bindings are short then the space 
explosion isn't really an issue. If bindings are created rarely, or 
typically in big blocks,
 > then we could optimise for that. There's not going to be a 
universally "best" solution, so while the objective is of course to make 
everything as fast as possible
 > it always helps to know which operations we need to worry about the most.
 > Hope that helps clarify some of our thoughts so far.

Very often the only subsciption type needed is subsciption for a 
specific sub-tree within the topic hierarchy, in other words 
subscription with literal prefix and # at the end, e.g. "x.y.z.#".

If that's the case, all three fundamental operations can be implemented 
in O(1) time where n is number of topics and/or bindings and O(n) time 
where n is length of the longest subscription.

Such an algorithm can be turned on by a specific hint passed to 
Exchange.Create 'arguments' parameter, or, more transparently, it can be 
used as long as subscriptions adhere to "x.y.z.#" pattern and once 
there's a non-compliant subscription, matching algorithm can switch 
dynamically to a more generic one.

Martin



From david.maciver at lshift.net  Mon Feb 22 12:02:49 2010
From: david.maciver at lshift.net (David R. MacIver)
Date: Mon, 22 Feb 2010 12:02:49 +0000
Subject: [rabbitmq-discuss] topix
In-Reply-To: <4B826DD2.5080507@fastmq.com>
References: <167204d21002191543t3dc86c25p978045e93ac67ad@mail.gmail.com>
	<E5B16948-B49D-40A0-BFAE-D2DFE1AC9F79@gmail.com>
	<167204d21002191604i16a23da6p46f0a93a6c33b529@mail.gmail.com>
	<4B7FB761.9010009@lshift.net>
	<392D5185-DE31-40B5-93D5-3673332BA6D2@gmail.com>
	<4B7FBE37.5070309@lshift.net>
	<764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>
	<20100222112459.GA10988@missbossy> <4B826DD2.5080507@fastmq.com>
Message-ID: <20100222120249.GB10988@missbossy>

On Mon, Feb 22, 2010 at 12:43:14PM +0100, Martin Sustrik wrote:
> Hi David,
> 
> > One thing that would help us to make these decisions as to the
> best approach would
> > be some feedback on how people are using topic exchanges in the
> real world: e.g.
> > if it turns out that basically all bindings are short then the
> space explosion isn't really an issue. If bindings are created
> rarely, or typically in big blocks,
> > then we could optimise for that. There's not going to be a
> universally "best" solution, so while the objective is of course to
> make everything as fast as possible
> > it always helps to know which operations we need to worry about the most.
> > Hope that helps clarify some of our thoughts so far.
> 
> Very often the only subsciption type needed is subsciption for a
> specific sub-tree within the topic hierarchy, in other words
> subscription with literal prefix and # at the end, e.g. "x.y.z.#".

Ah, that makes sense. Thanks. 

> If that's the case, all three fundamental operations can be
> implemented in O(1) time where n is number of topics and/or bindings

Well, O(log(branching rate for the tree)) (you need to do key lookups at
each level), but near enough. 

> and O(n) time where n is length of the longest subscription.
> Such an algorithm can be turned on by a specific hint passed to
> Exchange.Create 'arguments' parameter, or, more transparently, it
> can be used as long as subscriptions adhere to "x.y.z.#" pattern and
> once there's a non-compliant subscription, matching algorithm can
> switch dynamically to a more generic one.

I'm not sure this actually needs quite such specific logic. It should be possible
to add rules which means this behaviour falls out naturally rather than having a 
sharp transition between the two behaviours e.g. in the NFA approach suggested 
the only special handling needed would be to make sure that binding the pattern 
# was sensibly implemented as a "go straight to queue, do not pass go, do not 
collect O(key length) operations" node rather than doing a full scan of the rest
 of the key.

'though I guess that sparks another question: How long are the keys people are
actually using with this?  



From sustrik at 250bpm.com  Mon Feb 22 12:10:51 2010
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Mon, 22 Feb 2010 13:10:51 +0100
Subject: [rabbitmq-discuss] topix
In-Reply-To: <20100222120249.GB10988@missbossy>
References: <167204d21002191543t3dc86c25p978045e93ac67ad@mail.gmail.com>	<E5B16948-B49D-40A0-BFAE-D2DFE1AC9F79@gmail.com>	<167204d21002191604i16a23da6p46f0a93a6c33b529@mail.gmail.com>	<4B7FB761.9010009@lshift.net>	<392D5185-DE31-40B5-93D5-3673332BA6D2@gmail.com>	<4B7FBE37.5070309@lshift.net>	<764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>	<20100222112459.GA10988@missbossy>
	<4B826DD2.5080507@fastmq.com> <20100222120249.GB10988@missbossy>
Message-ID: <4B82744B.60600@250bpm.com>

David R. MacIver wrote:

 >> If that's the case, all three fundamental operations can be
 >> implemented in O(1) time where n is number of topics and/or bindings
 >
 > Well, O(log(branching rate for the tree)) (you need to do key lookups at
 > each level), but near enough.

Right. However, in ideal case you'll use hash table for the lookup which 
will get the average case down to a constant.

 >> and O(n) time where n is length of the longest subscription.
 >> Such an algorithm can be turned on by a specific hint passed to
 >> Exchange.Create 'arguments' parameter, or, more transparently, it
 >> can be used as long as subscriptions adhere to "x.y.z.#" pattern and
 >> once there's a non-compliant subscription, matching algorithm can
 >> switch dynamically to a more generic one.
 >
 > I'm not sure this actually needs quite such specific logic. It should 
be possible
 > to add rules which means this behaviour falls out naturally rather 
than having a sharp transition between the two behaviours e.g. in the 
NFA approach suggested the only special handling needed would be to make 
sure that binding the pattern # was sensibly implemented as a "go 
straight to queue, do not pass go, do not collect O(key length) 
operations" node rather than doing a full scan of the rest
 >  of the key.

Ack.

 > 'though I guess that sparks another question: How long are the keys 
people are
 > actually using with this?

My experience from stock trading sphere is that most keys are 3-5 items 
long, the longest being somewhere in the range of 15-20 items.

Martin



From david.maciver at lshift.net  Mon Feb 22 12:22:29 2010
From: david.maciver at lshift.net (David R. MacIver)
Date: Mon, 22 Feb 2010 12:22:29 +0000
Subject: [rabbitmq-discuss] topix
In-Reply-To: <4B82739F.4020701@fastmq.com>
References: <E5B16948-B49D-40A0-BFAE-D2DFE1AC9F79@gmail.com>
	<167204d21002191604i16a23da6p46f0a93a6c33b529@mail.gmail.com>
	<4B7FB761.9010009@lshift.net>
	<392D5185-DE31-40B5-93D5-3673332BA6D2@gmail.com>
	<4B7FBE37.5070309@lshift.net>
	<764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>
	<20100222112459.GA10988@missbossy> <4B826DD2.5080507@fastmq.com>
	<20100222120249.GB10988@missbossy> <4B82739F.4020701@fastmq.com>
Message-ID: <20100222122229.GC10988@missbossy>

On Mon, Feb 22, 2010 at 01:07:59PM +0100, Martin Sustrik wrote:
> David R. MacIver wrote:
> 
> >>If that's the case, all three fundamental operations can be
> >>implemented in O(1) time where n is number of topics and/or bindings
> >
> >Well, O(log(branching rate for the tree)) (you need to do key lookups at
> >each level), but near enough.
> 
> Right. However, in ideal case you'll use hash table for the lookup
> which will get the average case down to a constant.

True, although the worst case down to O(n) [we should probably take the resulting
vim vs. emacs style trees-vs-hash-tables debate that normally follows at this
point as read]
 
> >'though I guess that sparks another question: How long are the keys people are
> >actually using with this?
> 
> My experience from stock trading sphere is that most keys are 3-5
> items long, the longest being somewhere in the range of 15-20 items.

Thanks, that's good to know. 

Paul Jones just pointed me to an interesting use case here. 

http://github.com/paulj/trapeze

The keys being used correspond to URLS + methods and seem to look something like

GET.some.domain.//.foo.bar.baz

(I'm not sure if that's exactly right, but that's the idea)

so your routing would normally look something like 

*.some.domain.//.some.prefix.#

The keys are probably no longer than what you describe, but the initial * does
mean that they need to be able gracefully transition between simple prefixes
and the more general NFA.



From stuart.herbert at gradwell.com  Mon Feb 22 13:17:59 2010
From: stuart.herbert at gradwell.com (Stuart Herbert)
Date: Mon, 22 Feb 2010 13:17:59 +0000
Subject: [rabbitmq-discuss] Version numbers for librabbitmq-c?
In-Reply-To: <k5ljemt66d.fsf@mrbraver.lshift.net>
References: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com>
	<k5ljemt66d.fsf@mrbraver.lshift.net>
Message-ID: <BF306527-D19B-45B0-933B-3F4485FF00C8@gradwell.com>

Hi David,

Thanks for the response.

On 22 Feb 2010, at 01:23, David Wragg wrote:

> Despite the interesting things people have done with it, librabbitmq
> remains experimental software.  At this point in time, it is not
> mature enough for us to version and release it along with the
> principal RabbitMQ components.

I'm not suggesting that librabbitmq-c is versioned and released with RabbitMQ (yet ... :)

> But perhaps there are other less significant steps we could take to
> resolve the issue you mention.  I'm afraid I'm not familiar with PHP
> extension development.  How are the dependencies of PHP extensions
> expressed - is there some documentation you could point us to?

Just like any other C project ... you tell people which libraries they need to get, and where to get them from.  PHP extensions use autoconf, so having autoconf check for a supported version of librabbitmq-c would seem the way to go.

Versioning librabbitmq-c would be very useful to help with this. It would allow anyone putting effort into a working PHP extension to say "you need version X.Y.Z" of librabbitmq-c to compile against.  It would also provide a bit of help w/ backwards-compatibility of the C API, assuming the project uses the widely-accepted X.Y.Z meanings.

Would it be possible to start versioning librabbitmq-c?

Best regards,
Stu
--


From rajkumars at gmail.com  Mon Feb 22 16:22:39 2010
From: rajkumars at gmail.com (Rajkumar S)
Date: Mon, 22 Feb 2010 21:52:39 +0530
Subject: [rabbitmq-discuss] Channel.Flow in Java client
Message-ID: <64de5c8b1002220822k4b11622fs7dab998f76515367@mail.gmail.com>

Hello,

How does a java client (I am using rabbitmq 1.7.2) know when a server
has enabled Channel.Flow?

I have been using the stomp plugin to send messages to rabbitmq, since
stomp plugin does not handle Channel.Flow I am writing a stomp to amqp
gateway. But during my testing basicPublish method just waits when
server has enabled Channel.Flow. Is this the normal behavior?

I am now experimenting with TX. Is there any better way to take care
of situation when server has enabled Channel.Flow?

with regards,

raj



From matthias at lshift.net  Mon Feb 22 20:13:00 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 22 Feb 2010 20:13:00 +0000
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <9d73e2ec-3992-4b34-8b23-7790b7cbdcdd@l12g2000prg.googlegroups.com>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>	<20100128122215.GD4613@wellquite.org>	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>	<4B62BF0C.8000001@lshift.net>	<3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>	<4B6444B4.3020001@lshift.net>	<a7768fce-7fce-406a-a53e-861956e33594@b9g2000pri.googlegroups.com>	<4B6DD62A.6080300@lshift.net>	<f0ff80cf-794e-4515-ab92-1c8160785521@p13g2000pre.googlegroups.com>
	<9d73e2ec-3992-4b34-8b23-7790b7cbdcdd@l12g2000prg.googlegroups.com>
Message-ID: <4B82E54C.6060900@lshift.net>

Erik,

Erik Anderson wrote:
> Bah!  okay, looks like I solved my own problem.
> 
> ALL instances of "127.0.0.1" in both the startup script and config
> have been changed to {127,0,0,1}
> 
> I'm guessing success messages now.

That's interesting. The string version normally works. It goes through 
the Erlang/OTPs name resolver though, which might go wrong for various 
reasons.

I guess we should be using the tuple version in our default configs and 
examples since it's more efficient and is less likely to result in the 
kind of problems you have experiences. I have filed a bug to get that done.

Glad you got things working in the end, and thanks for your patience.


Regards,

Matthias.



From tonyg at lshift.net  Mon Feb 22 20:50:40 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 23 Feb 2010 09:50:40 +1300
Subject: [rabbitmq-discuss] topix
In-Reply-To: <20100222120249.GB10988@missbossy>
References: <167204d21002191543t3dc86c25p978045e93ac67ad@mail.gmail.com>
	<E5B16948-B49D-40A0-BFAE-D2DFE1AC9F79@gmail.com>
	<167204d21002191604i16a23da6p46f0a93a6c33b529@mail.gmail.com>
	<4B7FB761.9010009@lshift.net>
	<392D5185-DE31-40B5-93D5-3673332BA6D2@gmail.com>
	<4B7FBE37.5070309@lshift.net>
	<764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>
	<20100222112459.GA10988@missbossy> <4B826DD2.5080507@fastmq.com>
	<20100222120249.GB10988@missbossy>
Message-ID: <4B82EE20.30506@lshift.net>

David R. MacIver wrote:
> 'though I guess that sparks another question: How long are the keys people are
> actually using with this?  

256 bytes or fewer, as limited by the AMQP transfer syntax. :-/




From tonyg at lshift.net  Mon Feb 22 20:55:47 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 23 Feb 2010 09:55:47 +1300
Subject: [rabbitmq-discuss] topix
In-Reply-To: <4B82EE20.30506@lshift.net>
References: <167204d21002191543t3dc86c25p978045e93ac67ad@mail.gmail.com>	<E5B16948-B49D-40A0-BFAE-D2DFE1AC9F79@gmail.com>	<167204d21002191604i16a23da6p46f0a93a6c33b529@mail.gmail.com>	<4B7FB761.9010009@lshift.net>	<392D5185-DE31-40B5-93D5-3673332BA6D2@gmail.com>	<4B7FBE37.5070309@lshift.net>	<764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>	<20100222112459.GA10988@missbossy>
	<4B826DD2.5080507@fastmq.com>	<20100222120249.GB10988@missbossy>
	<4B82EE20.30506@lshift.net>
Message-ID: <4B82EF53.2060506@lshift.net>

Tony Garnock-Jones wrote:
> 256 bytes or fewer, as limited by the AMQP transfer syntax. :-/

Uh, oops, off by one. 255 bytes or fewer. Zero is a permitted length.
FTR :-)

Tony



From sduncan at wetafx.co.nz  Mon Feb 22 21:02:32 2010
From: sduncan at wetafx.co.nz (Samuel Duncan)
Date: Tue, 23 Feb 2010 10:02:32 +1300
Subject: [rabbitmq-discuss] Can't Determine Cause of 541 - INTERNAL_ERROR
Message-ID: <4B82F0E8.9050605@wetafx.co.nz>

Hi guys, we are running a few 1.7.1 servers under Linux, and I came 
across a 541 situation with an app we are developing. I was going 
through the testing hosts starting up ones that had died overnight for 
one reason or another (hardware/ network etc), and at a seemingly 
arbitrary point the server stopped allowing queues from a particular 
host to be declared/ used. An application instance uses one connection, 
four exchanges, one channel, and one queue bound to two of the 
exchanges. The queues are declared exclusive. On starting up this 
particular host, I got a 541 (INTERNAL_ERROR) at the point the queue was 
first checked for inbound messages (an outbound message had already been 
successfully sent via one of the four exchanges);

raw_msg = self.chan.basic_get(queue=self.queue, no_ack=True, 
ticket=self.access_ticket)
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", 
line 2032, in basic_get
  File 
"build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py", 
line 89, in wait
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py", 
line 218, in _wait_method
  File 
"build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py", 
line 105, in wait
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py", 
line 367, in _close
amqplib.client_0_8.exceptions.AMQPConnectionException: (541, 
u'INTERNAL_ERROR', (0, 0), '')


The rabbit server log shows the following. At first we thought it might 
have run out of processes, but I was subsequently able to successfully 
open another application instance on another host. It seems not to like 
this particular queue!

=INFO REPORT==== 23-Feb-2010::09:37:06 ===
accepted TCP connection on 0.0.0.0:5672 from 172.18.1.121:35050

=INFO REPORT==== 23-Feb-2010::09:37:06 ===
starting TCP connection <0.16017.82> from 172.18.1.121:35050

=ERROR REPORT==== 23-Feb-2010::09:37:06 ===
** Generic server <0.16037.82> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'queue.declare',1,
                                   <<"overwatch.control.avro105b">>,false,
                                   false,true,true,true,[]},
                               none}}
** When Server state == {ch,running,1,<0.16017.82>,<0.16026.82>,undefined,
                            none,
                            {set,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                            1,
                            {[],[]},
                            {[],[]},
                            <<"overwatch_admin">>,<<"/overwatch">>,<<>>,
                            {dict,0,16,16,8,80,48,
                                  
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}}}
** Reason for termination ==
** {{noproc,{gen_server2,call,
                         
[<0.7426.74>,{claim_queue,<0.16017.82>},infinity]}},
    [{gen_server2,call,3},
     {rabbit_channel,'-handle_method/3-fun-5-',3},
     {rabbit_channel,handle_method,3},
     {rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,7},
     {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 23-Feb-2010::09:37:06 ===
connection <0.16017.82> (running), channel 1 - error:
{{noproc,{gen_server2,call,[<0.7426.74>,{claim_queue,<0.16017.82>},infinity]}},
 [{gen_server2,call,3},
  {rabbit_channel,'-handle_method/3-fun-5-',3},
  {rabbit_channel,handle_method,3},
  {rabbit_channel,handle_cast,2},
  {gen_server2,handle_msg,7},
  {proc_lib,init_p_do_apply,3}]}

=WARNING REPORT==== 23-Feb-2010::09:37:06 ===
Non-AMQP exit reason '{{noproc,
                           {gen_server2,call,
                               [<0.7426.74>,
                                {claim_queue,<0.16017.82>},
                                infinity]}},
                       [{gen_server2,call,3},
                        {rabbit_channel,'-handle_method/3-fun-5-',3},
                        {rabbit_channel,handle_method,3},
                        {rabbit_channel,handle_cast,2},
                        {gen_server2,handle_msg,7},
                        {proc_lib,init_p_do_apply,3}]}'

I tried deleting the queue which, as expected, failed because it 
shouldn't exist until the host has started up the application instance - 
so doesn't seem to be a problem with exclusivity. I have checked with 
rabbitmqctl, and the queue is definitely not hanging around. Anyone have 
any ideas about what might be causing this, leads to follow etc?

Sam



From matthias at lshift.net  Mon Feb 22 21:11:31 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 22 Feb 2010 21:11:31 +0000
Subject: [rabbitmq-discuss] Can't Determine Cause of 541 - INTERNAL_ERROR
In-Reply-To: <4B82F0E8.9050605@wetafx.co.nz>
References: <4B82F0E8.9050605@wetafx.co.nz>
Message-ID: <4B82F303.9030705@lshift.net>

Sam,

Samuel Duncan wrote:
> The rabbit server log shows the following. At first we thought it might 
> have run out of processes, but I was subsequently able to successfully 
> open another application instance on another host. It seems not to like 
> this particular queue!

Can you post (or upload somewhere) the complete rabbit.log *and* 
rabbit-sasl.log?

I suspect/hope there will be something in the logs prior to the messages 
you posted that sheds some light on the problem.


Regards,

Matthias.



From sduncan at wetafx.co.nz  Mon Feb 22 21:16:12 2010
From: sduncan at wetafx.co.nz (Samuel Duncan)
Date: Tue, 23 Feb 2010 10:16:12 +1300
Subject: [rabbitmq-discuss] Can't Determine Cause of 541 - INTERNAL_ERROR
In-Reply-To: <4B82F303.9030705@lshift.net>
References: <4B82F0E8.9050605@wetafx.co.nz> <4B82F303.9030705@lshift.net>
Message-ID: <4B82F41C.1010102@wetafx.co.nz>

No problem, both attached.

Sam

Matthias Radestock wrote:
> Sam,
>
> Samuel Duncan wrote:
>> The rabbit server log shows the following. At first we thought it 
>> might have run out of processes, but I was subsequently able to 
>> successfully open another application instance on another host. It 
>> seems not to like this particular queue!
>
> Can you post (or upload somewhere) the complete rabbit.log *and* 
> rabbit-sasl.log?
>
> I suspect/hope there will be something in the logs prior to the 
> messages you posted that sheds some light on the problem.
>
>
> Regards,
>
> Matthias.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitlogs.zip
Type: application/zip
Size: 527547 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100223/2f06e781/attachment.zip 

From matthias at lshift.net  Mon Feb 22 22:48:49 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 22 Feb 2010 22:48:49 +0000
Subject: [rabbitmq-discuss] Can't Determine Cause of 541 - INTERNAL_ERROR
In-Reply-To: <4B82F41C.1010102@wetafx.co.nz>
References: <4B82F0E8.9050605@wetafx.co.nz> <4B82F303.9030705@lshift.net>
	<4B82F41C.1010102@wetafx.co.nz>
Message-ID: <4B8309D1.4070001@lshift.net>

Sam,

Samuel Duncan wrote:
> No problem, both attached.

Thanks. What triggered the fault is probably:

=ERROR REPORT==== 22-Feb-2010::18:16:42 ===
** Too many db tables **

Looking at the log, I can see a large number of connections getting 
closed abruptly just before then. That would probably have triggered a 
large number of queue auto-deletions, all happening in parallel and 
exceeding one of the built-in limits, resulting in the above error. As a 
consequence, some queue/binding records would not have been removed from 
the routing tables, causing subsequent queue declarations to find stale 
entries and return the errors you saw.

To increase the limit, edit/create /etc/rabbitmq/rabbitmq.conf and set
ERL_MAX_ETS_TABLES=10000
(the default is 1400; if it still fails try some higher values)


Regards,

Matthias.



From sduncan at wetafx.co.nz  Mon Feb 22 22:54:10 2010
From: sduncan at wetafx.co.nz (Samuel Duncan)
Date: Tue, 23 Feb 2010 11:54:10 +1300
Subject: [rabbitmq-discuss] Can't Determine Cause of 541 - INTERNAL_ERROR
In-Reply-To: <4B8309D1.4070001@lshift.net>
References: <4B82F0E8.9050605@wetafx.co.nz> <4B82F303.9030705@lshift.net>
	<4B82F41C.1010102@wetafx.co.nz> <4B8309D1.4070001@lshift.net>
Message-ID: <4B830B12.7040801@wetafx.co.nz>

Cool, thanks a lot Matthias. I'll give that a go. What is it that causes 
connection closing to be considered abrupt? Is there some preamble I am 
failing to do on shutdown of the application?

Sam

Matthias Radestock wrote:
> Sam,
>
> Samuel Duncan wrote:
>> No problem, both attached.
>
> Thanks. What triggered the fault is probably:
>
> =ERROR REPORT==== 22-Feb-2010::18:16:42 ===
> ** Too many db tables **
>
> Looking at the log, I can see a large number of connections getting 
> closed abruptly just before then. That would probably have triggered a 
> large number of queue auto-deletions, all happening in parallel and 
> exceeding one of the built-in limits, resulting in the above error. As 
> a consequence, some queue/binding records would not have been removed 
> from the routing tables, causing subsequent queue declarations to find 
> stale entries and return the errors you saw.
>
> To increase the limit, edit/create /etc/rabbitmq/rabbitmq.conf and set
> ERL_MAX_ETS_TABLES=10000
> (the default is 1400; if it still fails try some higher values)
>
>
> Regards,
>
> Matthias.




From matthias at lshift.net  Mon Feb 22 23:05:51 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 22 Feb 2010 23:05:51 +0000
Subject: [rabbitmq-discuss] Can't Determine Cause of 541 - INTERNAL_ERROR
In-Reply-To: <4B830B12.7040801@wetafx.co.nz>
References: <4B82F0E8.9050605@wetafx.co.nz> <4B82F303.9030705@lshift.net>
	<4B82F41C.1010102@wetafx.co.nz> <4B8309D1.4070001@lshift.net>
	<4B830B12.7040801@wetafx.co.nz>
Message-ID: <4B830DCF.6070806@lshift.net>

Sam,

Samuel Duncan wrote:
> What is it that causes connection closing to be considered abrupt? Is
> there some preamble I am failing to do on shutdown of the
> application?

AMQP defines a shutdown handshake as part of the protocol. Most client 
libraries take care of that when used correctly. What client library are 
you developing against?

Some abrupt closures are unavoidable, such as when there is a network 
fault or the client app crashed.

Note that whether or not the connection is shut down cleanly has no 
impact on the problem you observed.


Regards,

Matthias.



From sduncan at wetafx.co.nz  Mon Feb 22 23:16:09 2010
From: sduncan at wetafx.co.nz (Samuel Duncan)
Date: Tue, 23 Feb 2010 12:16:09 +1300
Subject: [rabbitmq-discuss] Can't Determine Cause of 541 - INTERNAL_ERROR
In-Reply-To: <4B830DCF.6070806@lshift.net>
References: <4B82F0E8.9050605@wetafx.co.nz> <4B82F303.9030705@lshift.net>
	<4B82F41C.1010102@wetafx.co.nz> <4B8309D1.4070001@lshift.net>
	<4B830B12.7040801@wetafx.co.nz> <4B830DCF.6070806@lshift.net>
Message-ID: <4B831039.4010803@wetafx.co.nz>

I'm using amqplib with python. On a scheduled shutdown, the clients will 
first close their channel, then the connection via the builtin methods, 
but that is all. I'll have a hunt in the source to see what that does 
under the hood. Obviously as you say, there are many times (especially 
in larger scale testing) where things don't go to plan, but good to know 
there are no lasting side effects in terms of server stability with 
regards to the abruptly closed connections. I've changed the rabbit 
config, so we'll fire it up and let you know. Thanks again.

Sam

Matthias Radestock wrote:
> Sam,
>
> Samuel Duncan wrote:
>> What is it that causes connection closing to be considered abrupt? Is
>> there some preamble I am failing to do on shutdown of the
>> application?
>
> AMQP defines a shutdown handshake as part of the protocol. Most client 
> libraries take care of that when used correctly. What client library 
> are you developing against?
>
> Some abrupt closures are unavoidable, such as when there is a network 
> fault or the client app crashed.
>
> Note that whether or not the connection is shut down cleanly has no 
> impact on the problem you observed.
>
>
> Regards,
>
> Matthias.




From matthias at lshift.net  Mon Feb 22 23:33:20 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 22 Feb 2010 23:33:20 +0000
Subject: [rabbitmq-discuss] Can't Determine Cause of 541 - INTERNAL_ERROR
In-Reply-To: <4B831039.4010803@wetafx.co.nz>
References: <4B82F0E8.9050605@wetafx.co.nz> <4B82F303.9030705@lshift.net>
	<4B82F41C.1010102@wetafx.co.nz> <4B8309D1.4070001@lshift.net>
	<4B830B12.7040801@wetafx.co.nz> <4B830DCF.6070806@lshift.net>
	<4B831039.4010803@wetafx.co.nz>
Message-ID: <4B831440.2080601@lshift.net>

Sam,

Samuel Duncan wrote:
> I'm using amqplib with python. On a scheduled shutdown, the clients will 
> first close their channel, then the connection via the builtin methods.

I don't know amqplib, but I would have thought that should do. If not I 
suggest you file a bug :)


Regards,

Matthias.



From erikba at odysseus.anderson.name  Tue Feb 23 03:43:19 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Mon, 22 Feb 2010 19:43:19 -0800
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <4B82E54C.6060900@lshift.net>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>
	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com> 
	<4B62BF0C.8000001@lshift.net>
	<3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>
	<4B6444B4.3020001@lshift.net>
	<a7768fce-7fce-406a-a53e-861956e33594@b9g2000pri.googlegroups.com>
	<4B6DD62A.6080300@lshift.net>
	<f0ff80cf-794e-4515-ab92-1c8160785521@p13g2000pre.googlegroups.com>
	<9d73e2ec-3992-4b34-8b23-7790b7cbdcdd@l12g2000prg.googlegroups.com> 
	<4B82E54C.6060900@lshift.net>
Message-ID: <56c0988e1002221943p51da360buc8fc8b9d97bb3c4b@mail.gmail.com>

On Mon, Feb 22, 2010 at 12:13 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Erik,
>
> Erik Anderson wrote:
>
>> Bah!  okay, looks like I solved my own problem.
>>
>> ALL instances of "127.0.0.1" in both the startup script and config
>> have been changed to {127,0,0,1}
>>
>> I'm guessing success messages now.
>>
>
> That's interesting. The string version normally works. It goes through the
> Erlang/OTPs name resolver though, which might go wrong for various reasons.
>
> I guess we should be using the tuple version in our default configs and
> examples since it's more efficient and is less likely to result in the kind
> of problems you have experiences. I have filed a bug to get that done.
>
> Glad you got things working in the end, and thanks for your patience.
>

Well, I did post a link in my previous response (wish Google Groups would
generally work better with this mailing list) to a bug report that someone
filed like six months ago that made it appear as though Windows 2003 (the
platform I'm using here) will start timing out all name resolve requests
after any network timeout occurs (and I do notice a timeout-like delay when
starting the TCP listeners).  I have nowhere near enough debugging
information on me (or any experience with erlang) to determine whether the
same thing is occurring here, but as using tuples seems to have resolved the
issue I strongly suspect that the issues might be related.  My thought is
that this issue will only come up when resolving items after the TCP
listeners have been brought up.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100222/47336226/attachment.htm 

From lgreg.meredith at gmail.com  Tue Feb 23 06:22:26 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Mon, 22 Feb 2010 22:22:26 -0800
Subject: [rabbitmq-discuss] cannot start rabbitmq-server
Message-ID: <5de3f5ca1002222222y291ea72ej9cc4c85b71eafcb4@mail.gmail.com>

Dear Warren,

All of a sudden rabbitmq-server fails to start.

bash-3.2$ sudo -H rabbitmq-server
{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,mnesia,{killed,{mnesia_sup,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
bash-3.2$

Best wishes,

--greg

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
1219 NW 83rd St
Seattle, WA 98117

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100222/4ca81af1/attachment.htm 

From ngocdaothanh at gmail.com  Tue Feb 23 06:36:47 2010
From: ngocdaothanh at gmail.com (Ngoc Dao)
Date: Tue, 23 Feb 2010 15:36:47 +0900
Subject: [rabbitmq-discuss] cannot start rabbitmq-server
In-Reply-To: <5de3f5ca1002222222y291ea72ej9cc4c85b71eafcb4@mail.gmail.com>
References: <5de3f5ca1002222222y291ea72ej9cc4c85b71eafcb4@mail.gmail.com>
Message-ID: <5c493e531002222236l4e8342aarcaadcfe65e0a8724@mail.gmail.com>

You may have to delete the data directory of RabbitMQ, then start again.


On Tue, Feb 23, 2010 at 3:22 PM, Meredith Gregory
<lgreg.meredith at gmail.com> wrote:
> Dear Warren,
> All of a sudden rabbitmq-server fails to start.
> bash-3.2$ sudo -H rabbitmq-server
> {"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,mnesia,{killed,{mnesia_sup,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> bash-3.2$
> Best wishes,
> --greg
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 1219 NW 83rd St
> Seattle, WA 98117
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From lgreg.meredith at gmail.com  Tue Feb 23 06:37:36 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Mon, 22 Feb 2010 22:37:36 -0800
Subject: [rabbitmq-discuss] cannot start rabbitmq-server
In-Reply-To: <5c493e531002222236l4e8342aarcaadcfe65e0a8724@mail.gmail.com>
References: <5de3f5ca1002222222y291ea72ej9cc4c85b71eafcb4@mail.gmail.com>
	<5c493e531002222236l4e8342aarcaadcfe65e0a8724@mail.gmail.com>
Message-ID: <5de3f5ca1002222237x530a50adt77810242d84815fb@mail.gmail.com>

Dear Ngoc,

Thanks for the note! Where is the data directory?

Best wishes,

--greg

On Mon, Feb 22, 2010 at 10:36 PM, Ngoc Dao <ngocdaothanh at gmail.com> wrote:

> You may have to delete the data directory of RabbitMQ, then start again.
>
>
> On Tue, Feb 23, 2010 at 3:22 PM, Meredith Gregory
> <lgreg.meredith at gmail.com> wrote:
> > Dear Warren,
> > All of a sudden rabbitmq-server fails to start.
> > bash-3.2$ sudo -H rabbitmq-server
> > {"init terminating in
> >
> do_boot",{{nocatch,{error,{cannot_start_application,mnesia,{killed,{mnesia_sup,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
> > Crash dump was written to: erl_crash.dump
> > init terminating in do_boot ()
> > bash-3.2$
> > Best wishes,
> > --greg
> >
> > --
> > L.G. Meredith
> > Managing Partner
> > Biosimilarity LLC
> > 1219 NW 83rd St
> > Seattle, WA 98117
> >
> > +1 206.650.3740
> >
> > http://biosimilarity.blogspot.com
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>



-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
1219 NW 83rd St
Seattle, WA 98117

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100222/35577511/attachment.htm 

From ngocdaothanh at gmail.com  Tue Feb 23 06:43:47 2010
From: ngocdaothanh at gmail.com (Ngoc Dao)
Date: Tue, 23 Feb 2010 15:43:47 +0900
Subject: [rabbitmq-discuss] cannot start rabbitmq-server
In-Reply-To: <5de3f5ca1002222237x530a50adt77810242d84815fb@mail.gmail.com>
References: <5de3f5ca1002222222y291ea72ej9cc4c85b71eafcb4@mail.gmail.com>
	<5c493e531002222236l4e8342aarcaadcfe65e0a8724@mail.gmail.com>
	<5de3f5ca1002222237x530a50adt77810242d84815fb@mail.gmail.com>
Message-ID: <5c493e531002222243o344000b3xc4dc5b0d87b4a4a9@mail.gmail.com>

I think it is the value of the RABBITMQ_MNESIA_DIR environment
variable. See the start script.


On Tue, Feb 23, 2010 at 3:37 PM, Meredith Gregory
<lgreg.meredith at gmail.com> wrote:
> Dear Ngoc,
> Thanks for the note! Where is the data directory?
> Best wishes,
> --greg
>
> On Mon, Feb 22, 2010 at 10:36 PM, Ngoc Dao <ngocdaothanh at gmail.com> wrote:
>>
>> You may have to delete the data directory of RabbitMQ, then start again.
>>
>>
>> On Tue, Feb 23, 2010 at 3:22 PM, Meredith Gregory
>> <lgreg.meredith at gmail.com> wrote:
>> > Dear Warren,
>> > All of a sudden rabbitmq-server fails to start.
>> > bash-3.2$ sudo -H rabbitmq-server
>> > {"init terminating in
>> >
>> > do_boot",{{nocatch,{error,{cannot_start_application,mnesia,{killed,{mnesia_sup,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
>> > Crash dump was written to: erl_crash.dump
>> > init terminating in do_boot ()
>> > bash-3.2$
>> > Best wishes,
>> > --greg
>> >
>> > --
>> > L.G. Meredith
>> > Managing Partner
>> > Biosimilarity LLC
>> > 1219 NW 83rd St
>> > Seattle, WA 98117
>> >
>> > +1 206.650.3740
>> >
>> > http://biosimilarity.blogspot.com
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 1219 NW 83rd St
> Seattle, WA 98117
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>



From david.wragg at lshift.net  Tue Feb 23 08:10:32 2010
From: david.wragg at lshift.net (David Wragg)
Date: Tue, 23 Feb 2010 08:10:32 +0000
Subject: [rabbitmq-discuss] cannot start rabbitmq-server
In-Reply-To: <5de3f5ca1002222237x530a50adt77810242d84815fb@mail.gmail.com>
	(Meredith Gregory's message of "Mon\, 22 Feb 2010 22\:37\:36 -0800")
References: <5de3f5ca1002222222y291ea72ej9cc4c85b71eafcb4@mail.gmail.com>
	<5c493e531002222236l4e8342aarcaadcfe65e0a8724@mail.gmail.com>
	<5de3f5ca1002222237x530a50adt77810242d84815fb@mail.gmail.com>
Message-ID: <k5aav01ifb.fsf@mrbraver.lshift.net>

Meredith Gregory <lgreg.meredith at gmail.com> writes:
> Thanks for the note! Where is the data directory?

I susect you are using the rabbitmq-server macport, where it's
/opt/local/var/lib/rabbitmq.

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From david.maciver at lshift.net  Tue Feb 23 10:32:52 2010
From: david.maciver at lshift.net (David R. MacIver)
Date: Tue, 23 Feb 2010 10:32:52 +0000
Subject: [rabbitmq-discuss] topix
In-Reply-To: <4B82EF53.2060506@lshift.net>
References: <167204d21002191604i16a23da6p46f0a93a6c33b529@mail.gmail.com>
	<4B7FB761.9010009@lshift.net>
	<392D5185-DE31-40B5-93D5-3673332BA6D2@gmail.com>
	<4B7FBE37.5070309@lshift.net>
	<764E80D5-AB79-404C-AC5C-B0E198A333B3@gmail.com>
	<20100222112459.GA10988@missbossy> <4B826DD2.5080507@fastmq.com>
	<20100222120249.GB10988@missbossy> <4B82EE20.30506@lshift.net>
	<4B82EF53.2060506@lshift.net>
Message-ID: <20100223103252.GD10988@missbossy>

Well, the byte count isn't actually that interesting (though thanks for the 
reminder). The question is how many tokens are used. 

e.g. #.{ 126 repetitions of a.} would produce quite an unfortunately large DFA.



From aquino.gustavo at gmail.com  Tue Feb 23 11:35:02 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 23 Feb 2010 08:35:02 -0300
Subject: [rabbitmq-discuss] Rabbitmqctl 1.7.2 doesn't work in Mac OS.
Message-ID: <5ef296b31002230335q76ec9431xde66e7964d57980b@mail.gmail.com>

Hi,

I upgraded my Rrabbitmq version to 1.7.2 and after that, rabbitmqctl stop to
works, apparently script have some error..

What's Happend ?

Nefertiti:~ $ sudo rabbitmqctl
sudo: illegal option `-E'
usage: sudo -K | -L | -V | -h | -k | -l | -v
usage: sudo [-HPSb] [-p prompt] [-u username|#uid]
            { -e file [...] | -i | -s | <command> }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100223/e8596287/attachment.htm 

From pauljones23 at gmail.com  Tue Feb 23 11:56:15 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Tue, 23 Feb 2010 11:56:15 +0000
Subject: [rabbitmq-discuss] Rabbitmqctl 1.7.2 doesn't work in Mac OS.
In-Reply-To: <5ef296b31002230335q76ec9431xde66e7964d57980b@mail.gmail.com>
References: <5ef296b31002230335q76ec9431xde66e7964d57980b@mail.gmail.com>
Message-ID: <29598b611002230356k1fc9e3ffm5d062089e2298ec@mail.gmail.com>

Hi Gustavo,

I'm assuming that you're running OS X 10.5 or earlier? It would appear that
we've introduced an 10.6+ only flag in our scripts with 1.7.2 (and
unfortunately, it must only have been tested on 10.6).

If you edit the scripts and remove the -E, it shouldn't do any harm - you
should be in no worse position than you were on 1.7.1. We'll raise a bug
internally to try to work out a way to solve this more permanently going
forward.

Cheers,
Paul.

On Tue, Feb 23, 2010 at 11:35 AM, Gustavo Aquino
<aquino.gustavo at gmail.com>wrote:

> Hi,
>
> I upgraded my Rrabbitmq version to 1.7.2 and after that, rabbitmqctl stop
> to works, apparently script have some error..
>
> What's Happend ?
>
> Nefertiti:~ $ sudo rabbitmqctl
> sudo: illegal option `-E'
> usage: sudo -K | -L | -V | -h | -k | -l | -v
> usage: sudo [-HPSb] [-p prompt] [-u username|#uid]
>             { -e file [...] | -i | -s | <command> }
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100223/78fc0b01/attachment.htm 

From aquino.gustavo at gmail.com  Tue Feb 23 12:18:13 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 23 Feb 2010 09:18:13 -0300
Subject: [rabbitmq-discuss] Rabbitmqctl 1.7.2 doesn't work in Mac OS.
In-Reply-To: <29598b611002230356k1fc9e3ffm5d062089e2298ec@mail.gmail.com>
References: <5ef296b31002230335q76ec9431xde66e7964d57980b@mail.gmail.com>
	<29598b611002230356k1fc9e3ffm5d062089e2298ec@mail.gmail.com>
Message-ID: <5ef296b31002230418n11e4be95te44c09d9c4180764@mail.gmail.com>

Hi Paul,

I'm using X 10.5. Removing -E option from scripts works fine.

Thanks.


On Tue, Feb 23, 2010 at 8:56 AM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Gustavo,
>
> I'm assuming that you're running OS X 10.5 or earlier? It would appear that
> we've introduced an 10.6+ only flag in our scripts with 1.7.2 (and
> unfortunately, it must only have been tested on 10.6).
>
> If you edit the scripts and remove the -E, it shouldn't do any harm - you
> should be in no worse position than you were on 1.7.1. We'll raise a bug
> internally to try to work out a way to solve this more permanently going
> forward.
>
> Cheers,
> Paul.
>
> On Tue, Feb 23, 2010 at 11:35 AM, Gustavo Aquino <aquino.gustavo at gmail.com
> > wrote:
>
>> Hi,
>>
>> I upgraded my Rrabbitmq version to 1.7.2 and after that, rabbitmqctl stop
>> to works, apparently script have some error..
>>
>> What's Happend ?
>>
>> Nefertiti:~ $ sudo rabbitmqctl
>> sudo: illegal option `-E'
>> usage: sudo -K | -L | -V | -h | -k | -l | -v
>> usage: sudo [-HPSb] [-p prompt] [-u username|#uid]
>>             { -e file [...] | -i | -s | <command> }
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100223/789d0fef/attachment.htm 

From matthew at lshift.net  Tue Feb 23 12:33:29 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 23 Feb 2010 12:33:29 +0000
Subject: [rabbitmq-discuss] Rabbitmqctl 1.7.2 doesn't work in Mac OS.
In-Reply-To: <5ef296b31002230418n11e4be95te44c09d9c4180764@mail.gmail.com>
References: <5ef296b31002230335q76ec9431xde66e7964d57980b@mail.gmail.com>
	<29598b611002230356k1fc9e3ffm5d062089e2298ec@mail.gmail.com>
	<5ef296b31002230418n11e4be95te44c09d9c4180764@mail.gmail.com>
Message-ID: <20100223123329.GK23769@mrnibble.lshift.net>

On Tue, Feb 23, 2010 at 09:18:13AM -0300, Gustavo Aquino wrote:
> I'm using X 10.5. Removing -E option from scripts works fine.

Be aware that by not having a working -E option, you won't be able to
configure Rabbit via env vars. Eg setting RABBITMQ_NODENAME in the
environment won't work. You'll need to set any such options in the
rabbitmq.conf file.

Matthew



From lgreg.meredith at gmail.com  Tue Feb 23 19:28:54 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 23 Feb 2010 11:28:54 -0800
Subject: [rabbitmq-discuss] cannot start rabbitmq-server
In-Reply-To: <k5aav01ifb.fsf@mrbraver.lshift.net>
References: <5de3f5ca1002222222y291ea72ej9cc4c85b71eafcb4@mail.gmail.com>
	<5c493e531002222236l4e8342aarcaadcfe65e0a8724@mail.gmail.com>
	<5de3f5ca1002222237x530a50adt77810242d84815fb@mail.gmail.com>
	<k5aav01ifb.fsf@mrbraver.lshift.net>
Message-ID: <5de3f5ca1002231128ne3bd434kc915596d410bba51@mail.gmail.com>

Dear Warren,

Thanks for the help! removing /opt/local/var/lib/rabbitmq and reinstalling
worked. i'm sure that many people have made this
joke<http://www.youtube.com/watch?v=2rDNzDmyuo4>before, but it's still
a good one.

Best wishes,

--greg

On Tue, Feb 23, 2010 at 12:10 AM, David Wragg <david.wragg at lshift.net>wrote:

> Meredith Gregory <lgreg.meredith at gmail.com> writes:
> > Thanks for the note! Where is the data directory?
>
> I susect you are using the rabbitmq-server macport, where it's
> /opt/local/var/lib/rabbitmq.
>
> --
>  [][][] David Wragg       | mail: david.wragg at lshift.net
>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
>  []  [] LShift Ltd        | web: www.lshift.net
>



-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
1219 NW 83rd St
Seattle, WA 98117

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100223/9a0fea92/attachment.htm 

From jdavis at gridpoint.com  Wed Feb 24 01:57:43 2010
From: jdavis at gridpoint.com (Davis, Jeremy)
Date: Tue, 23 Feb 2010 20:57:43 -0500
Subject: [rabbitmq-discuss] rabbitMQ/Beam only using one core.
Message-ID: <65AC5638854BD3459DA70DCE4B8FB49005107E986B@corp-it-exch01.gridpoint.com>


I have put together a simple producer (in java) that tries to push through as much data as possible.
I create many threads, and each has its own connection, own direct exchange, and own queue.
No matter how many connections, threads, exchanges, or queues, 'top' shows a single beam process at 100%, with remaining 7 cores idle.

I am running 1.7.2 on ubuntu hardy-heron.

Any thoughts?

------------------------------------------------------------------------------
//Simplified java below:

    private static ConnectionFactory    factory     = null;

    public RabbitMqProducer()
    {
        ConnectionParameters params = new ConnectionParameters();
        params.setUsername(userName);
        params.setPassword(password);
        params.setVirtualHost(virtualHost);
        params.setRequestedHeartbeat(0);
        factory = new ConnectionFactory(params);
    }

    public static String getExchangeName( int id )
    {
        return( "rabbitTestExchange-" + id );
    }

    public static String getQueueName( int id )
    {
        return( "rabbitTestQueue-" + id );
    }

    public void go()
        throws Exception
    {
        List<Writer> writers = new ArrayList<Writer>();
        for( int x=0;x<numThreads;x++)
        {
            writers.add(new Writer(x));
        }
        for( int x=0;x<numThreads;x++)
        {
            writers.get(x).start();
        }
    }

    private final class Writer
        extends Thread
    {
        private final int id;
        private Connection  connection  = null;
        private Channel     channel     = null;

        public Writer( int id)
            throws Exception
        {
            this.id = id;
            connect();
        }

        public void connect()
            throws Exception
        {
            connection  = factory.newConnection(hostName, portNumber);
            channel     = connection.createChannel();
            boolean durable = true;
            AMQP.Exchange.DeclareOk eok = channel.exchangeDeclare( getExchangeName(id), "direct", durable );
            AMQP.Queue.DeclareOk qok = channel.queueDeclare(getQueueName(id), durable);
            AMQP.Queue.BindOk    bok = channel.queueBind(getQueueName(id), getExchangeName(id), getQueueName(id) );
        }


        public void send()
            throws Exception
        {
            boolean mandatory = true;  //Returns error if can't send to queue. (and persisted for example).
            boolean immediate = false; //if true, error if can't be consumer immediately.
            StringBuilder b = new StringBuilder( msg.toString() );
            b.append("-"+id);
            byte[] data = b.toString().getBytes();

            for( int x=0;x<numRecords;x++)
            {
                AMQP.BasicProperties props = new AMQP.BasicProperties();
                props.setDeliveryMode(2); //persistent message.
                channel.basicPublish(getExchangeName(id), getQueueName(id), mandatory, immediate, props, data);
            }
        }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100223/9949d840/attachment.htm 

From jdavis at gridpoint.com  Wed Feb 24 02:58:00 2010
From: jdavis at gridpoint.com (Davis, Jeremy)
Date: Tue, 23 Feb 2010 21:58:00 -0500
Subject: [rabbitmq-discuss] rabbitMQ/Beam only using one core.
In-Reply-To: <65AC5638854BD3459DA70DCE4B8FB49005107E986B@corp-it-exch01.gridpoint.com>
References: <65AC5638854BD3459DA70DCE4B8FB49005107E986B@corp-it-exch01.gridpoint.com>
Message-ID: <65AC5638854BD3459DA70DCE4B8FB49005107E9877@corp-it-exch01.gridpoint.com>

I have the answer. Upgraded erlang vm to R13xx


From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Davis, Jeremy
Sent: Tuesday, February 23, 2010 5:58 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] rabbitMQ/Beam only using one core.


I have put together a simple producer (in java) that tries to push through as much data as possible.
I create many threads, and each has its own connection, own direct exchange, and own queue.
No matter how many connections, threads, exchanges, or queues, 'top' shows a single beam process at 100%, with remaining 7 cores idle.

I am running 1.7.2 on ubuntu hardy-heron.

Any thoughts?

------------------------------------------------------------------------------
//Simplified java below:

    private static ConnectionFactory    factory     = null;

    public RabbitMqProducer()
    {
        ConnectionParameters params = new ConnectionParameters();
        params.setUsername(userName);
        params.setPassword(password);
        params.setVirtualHost(virtualHost);
        params.setRequestedHeartbeat(0);
        factory = new ConnectionFactory(params);
    }

    public static String getExchangeName( int id )
    {
        return( "rabbitTestExchange-" + id );
    }

    public static String getQueueName( int id )
    {
        return( "rabbitTestQueue-" + id );
    }

    public void go()
        throws Exception
    {
        List<Writer> writers = new ArrayList<Writer>();
        for( int x=0;x<numThreads;x++)
        {
            writers.add(new Writer(x));
        }
        for( int x=0;x<numThreads;x++)
        {
            writers.get(x).start();
        }
    }

    private final class Writer
        extends Thread
    {
        private final int id;
        private Connection  connection  = null;
        private Channel     channel     = null;

        public Writer( int id)
            throws Exception
        {
            this.id = id;
            connect();
        }

        public void connect()
            throws Exception
        {
            connection  = factory.newConnection(hostName, portNumber);
            channel     = connection.createChannel();
            boolean durable = true;
            AMQP.Exchange.DeclareOk eok = channel.exchangeDeclare( getExchangeName(id), "direct", durable );
            AMQP.Queue.DeclareOk qok = channel.queueDeclare(getQueueName(id), durable);
            AMQP.Queue.BindOk    bok = channel.queueBind(getQueueName(id), getExchangeName(id), getQueueName(id) );
        }


        public void send()
            throws Exception
        {
            boolean mandatory = true;  //Returns error if can't send to queue. (and persisted for example).
            boolean immediate = false; //if true, error if can't be consumer immediately.
            StringBuilder b = new StringBuilder( msg.toString() );
            b.append("-"+id);
            byte[] data = b.toString().getBytes();

            for( int x=0;x<numRecords;x++)
            {
                AMQP.BasicProperties props = new AMQP.BasicProperties();
                props.setDeliveryMode(2); //persistent message.
                channel.basicPublish(getExchangeName(id), getQueueName(id), mandatory, immediate, props, data);
            }
        }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100223/96155008/attachment.htm 

From lgreg.meredith at gmail.com  Wed Feb 24 03:09:06 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 23 Feb 2010 19:09:06 -0800
Subject: [rabbitmq-discuss] Fwd: Point-to-point messaging with AMQP (was Re:
	rabbitmq-server failing to start?!)
In-Reply-To: <4B849686.9080203@lshift.net>
References: <5de3f5ca1002222020j43985860i39493599d7fdf0d3@mail.gmail.com>
	<5de3f5ca1002222131u57139a8cg163e07f9d8370eac@mail.gmail.com>
	<4B848D4C.3050306@lshift.net>
	<5de3f5ca1002231849n7f795715md5ce8a547853bee9@mail.gmail.com>
	<4B849686.9080203@lshift.net>
Message-ID: <5de3f5ca1002231909lbf76a1au685929381ba0a7ba@mail.gmail.com>

Dear Tony,

Thanks for the response! Unfortunately, i'm such a RabbitMQ noob that terms
like "bound to a separate exchange" don't mean anything to me in terms of
lines of code, *yet*. That's why i was hoping for a code sample ;-).

Best wishes,

--greg

---------- Forwarded message ----------
From: Tony Garnock-Jones <tonyg at lshift.net>
Date: Tue, Feb 23, 2010 at 7:01 PM
Subject: Point-to-point messaging with AMQP (was Re: rabbitmq-server failing
to start?!)
To: Meredith Gregory <lgreg.meredith at gmail.com>
Cc: legitimategrievance at rabbitmq.com


Meredith Gregory wrote:
> That was the ticket. i figured it out last night after some poking
> around. BTW, do you have code samples for the a simple two-way
> conversation? I.e., setting up a channel from A -> B and another from B
> -> A? i'm currently working with the Scala/Lift wrapper around what i
> believe to be the Java client.

At its simplest, this can be

 - one queue with a well-known name per party
 - messages sent to exchange "", routing_key = queue_name

For more flexibility (and compositionality! ;-) ) choose to use queues
without well-known names, that are bound to a separate exchange

 - one queue with a secret name per party
 - the party binds it to a direct exchange called "chat" or similar
  with routing_key/binding_key equal to the name it wishes to be
  known by
 - messages sent to exchange "chat", routing_key = public name

Fancy posting these questions to rabbitmq-discuss at all? We're always
looking to build up the archive for later mining for FAQs :-)

Tony




-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
1219 NW 83rd St
Seattle, WA 98117

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100223/75232870/attachment.htm 

From josh at z2live.com  Wed Feb 24 06:19:34 2010
From: josh at z2live.com (Josh Gruenberg)
Date: Tue, 23 Feb 2010 22:19:34 -0800
Subject: [rabbitmq-discuss] Is rabbitmq appropriate for messaging to
	thousands of transient clients?
Message-ID: <5704921d1002232219h597c34c3n6f12f49bd5383ceb@mail.gmail.com>

Hi there!

My team is responsible for updating a large-scale game-server platform
for mobile clients. ?We currently see peaks with ~1000 simultaneous
connected clients, with each session often relaying an average 1
message/sec (so, perhaps 2000 msg/sec bidirectionally). ?The current
implementation uses a proprietary socket protocol for client/server
communications, but we anticipate growing pains as we move toward our
targeted 10x growth for this platform. ?To better distribute the load
and virtualize the cluster, we are considering using rabbitmq for
messaging between the clients and servers.

Is this a good idea?


Here are some of our specific concerns (apologies if any of these have
been addressed in previous posts; I couldn't find much relevant
discussion):

1. The intuitive implementation would involve creating a private queue
for each client to receive messages. ?This would imply 10k
client-specific queues and 10k connections.  Any concerns there?

2. Mobile gaming sessions are typically short-lived; current
projections suggest we may sometimes see 10 sessions starting/ending
per second (implying 10 connections and queues being created and
destroyed per sec, with several associated bindings each).  Will this
thrashing be sustainable?

3. Mobile clients are notoriously bad at maintaining persistent
connections, so we see frequent disconnect/reconnect behavior. ?(This
is one of the primary reasons we're attracted to MQ in the first
place, BTW: the server can fire and forget!)  I expect this could
result in retransmission of messages that were sent from client to
rabbit just prior to connection-loss.  Will AMQP/rabbit help with
this, or would we need to implement our own deduplication logic?

4. Security is obviously a concern. We've brainstormed the following strategy:
    - provision temporary credentials for each client session to
authorize access to the shared vhost (revoked upon session expiry)
    - create each client queue from the server, sending its name to the client
    - manage all queue bindings from the server in response to client requests
This way, all routing configuration would be handled by the server,
and clients would only know the name of their one queue (and a few
exchanges for messaging specific server-side actors.)  Is this wise?


Do these characteristics spell trouble? ?Are there existing real-world
installations that successfully connect large client-bases directly to
rabbitmq?

Thanks in advance for any advice,
-joshng



From jdavis at gridpoint.com  Wed Feb 24 19:26:08 2010
From: jdavis at gridpoint.com (Davis, Jeremy)
Date: Wed, 24 Feb 2010 14:26:08 -0500
Subject: [rabbitmq-discuss] rabbitMQ/Beam only using one core.
Message-ID: <65AC5638854BD3459DA70DCE4B8FB49005107E9AA8@corp-it-exch01.gridpoint.com>

Upgraded erlang and all was fine.

From: Davis, Jeremy
Sent: Tuesday, February 23, 2010 5:58 PM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: rabbitMQ/Beam only using one core.


I have put together a simple producer (in java) that tries to push through as much data as possible.
I create many threads, and each has its own connection, own direct exchange, and own queue.
No matter how many connections, threads, exchanges, or queues, 'top' shows a single beam process at 100%, with remaining 7 cores idle.

I am running 1.7.2 on ubuntu hardy-heron.

Any thoughts?

------------------------------------------------------------------------------
//Simplified java below:

    private static ConnectionFactory    factory     = null;

    public RabbitMqProducer()
    {
        ConnectionParameters params = new ConnectionParameters();
        params.setUsername(userName);
        params.setPassword(password);
        params.setVirtualHost(virtualHost);
        params.setRequestedHeartbeat(0);
        factory = new ConnectionFactory(params);
    }

    public static String getExchangeName( int id )
    {
        return( "rabbitTestExchange-" + id );
    }

    public static String getQueueName( int id )
    {
        return( "rabbitTestQueue-" + id );
    }

    public void go()
        throws Exception
    {
        List<Writer> writers = new ArrayList<Writer>();
        for( int x=0;x<numThreads;x++)
        {
            writers.add(new Writer(x));
        }
        for( int x=0;x<numThreads;x++)
        {
            writers.get(x).start();
        }
    }

    private final class Writer
        extends Thread
    {
        private final int id;
        private Connection  connection  = null;
        private Channel     channel     = null;

        public Writer( int id)
            throws Exception
        {
            this.id = id;
            connect();
        }

        public void connect()
            throws Exception
        {
            connection  = factory.newConnection(hostName, portNumber);
            channel     = connection.createChannel();
            boolean durable = true;
            AMQP.Exchange.DeclareOk eok = channel.exchangeDeclare( getExchangeName(id), "direct", durable );
            AMQP.Queue.DeclareOk qok = channel.queueDeclare(getQueueName(id), durable);
            AMQP.Queue.BindOk    bok = channel.queueBind(getQueueName(id), getExchangeName(id), getQueueName(id) );
        }


        public void send()
            throws Exception
        {
            boolean mandatory = true;  //Returns error if can't send to queue. (and persisted for example).
            boolean immediate = false; //if true, error if can't be consumer immediately.
            StringBuilder b = new StringBuilder( msg.toString() );
            b.append("-"+id);
            byte[] data = b.toString().getBytes();

            for( int x=0;x<numRecords;x++)
            {
                AMQP.BasicProperties props = new AMQP.BasicProperties();
                props.setDeliveryMode(2); //persistent message.
                channel.basicPublish(getExchangeName(id), getQueueName(id), mandatory, immediate, props, data);
            }
        }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100224/68057141/attachment.htm 

From tonyg at lshift.net  Thu Feb 25 04:51:35 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 25 Feb 2010 17:51:35 +1300
Subject: [rabbitmq-discuss] Fwd: Point-to-point messaging with AMQP (was
 Re:	rabbitmq-server failing to start?!)
In-Reply-To: <5de3f5ca1002231909lbf76a1au685929381ba0a7ba@mail.gmail.com>
References: <5de3f5ca1002222020j43985860i39493599d7fdf0d3@mail.gmail.com>	<5de3f5ca1002222131u57139a8cg163e07f9d8370eac@mail.gmail.com>	<4B848D4C.3050306@lshift.net>	<5de3f5ca1002231849n7f795715md5ce8a547853bee9@mail.gmail.com>	<4B849686.9080203@lshift.net>
	<5de3f5ca1002231909lbf76a1au685929381ba0a7ba@mail.gmail.com>
Message-ID: <4B8601D7.7090401@lshift.net>

Aha. OK.

So for Java, it'd be:

  Channel ch;
  String myWellKnownPublicName = ...;
  ...
  ch.exchangeDeclare("chat", "direct");
  String privateQueueName = ch.queueDeclare().getQueue();
  ch.queueBind(privateQueueName, "chat", myWellKnownPublicName);
  ...
  // To send a message to someone else:
  ch.basicPublish("chat", otherPartysPublicName, ...);
  ...
  // To retrieve messages for me, one at a time, without needing
  // to ack them (that's the 'true' part):
  GetResponse deliveryOrNull = ch.basicGet(privateQueueName, true);
  ...
  // To retrieve them as they arrive via push, again without
  // needing to ack:
  QueueingConsumer consumer = new QueueingConsumer(ch);
  ch.basicConsume(privateQueueName, true, consumer);
  while (true) {
    QueueingConsumer.Delivery delivery = consumer.nextDelivery();
    ...
  }

That's the complex form. For the simple form, everything's the same,
except you replace "chat" with "", omit the queueBind, replace all uses
of privateQueueName with myWellKnownPublicName and declare the queue
like this instead:

  ch.queueDeclare(myWellKnownPublicName,
                  false, false, false, true, null);

Cheers,
  Tony


Meredith Gregory wrote:
> Dear Tony,
> 
> Thanks for the response! Unfortunately, i'm such a RabbitMQ noob that
> terms like "bound to a separate exchange" don't mean anything to me in
> terms of lines of code, */yet/*. That's why i was hoping for a code
> sample ;-).
> 
> Best wishes,
> 
> --greg
> 
> ---------- Forwarded message ----------
> From: *Tony Garnock-Jones* <tonyg at lshift.net <mailto:tonyg at lshift.net>>
> Date: Tue, Feb 23, 2010 at 7:01 PM
> Subject: Point-to-point messaging with AMQP (was Re: rabbitmq-server
> failing to start?!)
> To: Meredith Gregory <lgreg.meredith at gmail.com
> <mailto:lgreg.meredith at gmail.com>>
> Cc: legitimategrievance at rabbitmq.com
> <mailto:legitimategrievance at rabbitmq.com>
> 
> 
> Meredith Gregory wrote:
>> That was the ticket. i figured it out last night after some poking
>> around. BTW, do you have code samples for the a simple two-way
>> conversation? I.e., setting up a channel from A -> B and another from B
>> -> A? i'm currently working with the Scala/Lift wrapper around what i
>> believe to be the Java client.
> 
> At its simplest, this can be
> 
>  - one queue with a well-known name per party
>  - messages sent to exchange "", routing_key = queue_name
> 
> For more flexibility (and compositionality! ;-) ) choose to use queues
> without well-known names, that are bound to a separate exchange
> 
>  - one queue with a secret name per party
>  - the party binds it to a direct exchange called "chat" or similar
>   with routing_key/binding_key equal to the name it wishes to be
>   known by
>  - messages sent to exchange "chat", routing_key = public name
> 
> Fancy posting these questions to rabbitmq-discuss at all? We're always
> looking to build up the archive for later mining for FAQs :-)
> 
> Tony
> 
> 
> 
> 
> -- 
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 1219 NW 83rd St
> Seattle, WA 98117
> 
> +1 206.650.3740
> 
> http://biosimilarity.blogspot.com
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From tonyg at lshift.net  Thu Feb 25 05:05:00 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 25 Feb 2010 18:05:00 +1300
Subject: [rabbitmq-discuss] Is rabbitmq appropriate for messaging
 to	thousands of transient clients?
In-Reply-To: <5704921d1002232219h597c34c3n6f12f49bd5383ceb@mail.gmail.com>
References: <5704921d1002232219h597c34c3n6f12f49bd5383ceb@mail.gmail.com>
Message-ID: <4B8604FC.1060305@lshift.net>

Hi Josh,

Josh Gruenberg wrote:
> Is this a good idea?

OK, so we're looking at peaks of 10000 clients, each talking about once
a second. That message rate is fine, but you'll have to do the usual
kind of C10K tuning and tweaking to get your kernel and Erlang VM able
to accept that many connections at once.

> 1. The intuitive implementation would involve creating a private queue
> for each client to receive messages.  This would imply 10k
> client-specific queues and 10k connections.  Any concerns there?

Not on the queues front, and on the connections front, it should just be
down to kernel and erlang VM tuning. Should. If there are problems, we
definitely need to know so that they can be fixed! Your scale of
deployment is something Rabbit squarely aims to cover, IMO.

> 2. Mobile gaming sessions are typically short-lived; current
> projections suggest we may sometimes see 10 sessions starting/ending
> per second (implying 10 connections and queues being created and
> destroyed per sec, with several associated bindings each).  Will this
> thrashing be sustainable?

Oo. OK, that's interesting. It *should* be ok... but I haven't tried it
myself.

> Will AMQP/rabbit help with
> this, or would we need to implement our own deduplication logic?

Currently, deduplication is a pure client-side issue. We do support the
AMQP "redelivered" flag, though which

 - is guaranteed false if this is known by the server to be the very
   first time this message has been sent out from a queue to a consumer
   or getter

 - is guaranteed true if there's any doubt, that is, if there's even
   the slightest possibility a receiving client may have seen the
   message before

This lets you avoid any dedup buffer lookups for messages that are
guaranteed first-time deliveries.

> 4. Security is obviously a concern. We've brainstormed the following strategy:
>     - provision temporary credentials for each client session to
> authorize access to the shared vhost (revoked upon session expiry)
>     - create each client queue from the server, sending its name to the client
>     - manage all queue bindings from the server in response to client requests
> This way, all routing configuration would be handled by the server,
> and clients would only know the name of their one queue (and a few
> exchanges for messaging specific server-side actors.)  Is this wise?

It seems reasonable. Others may have more detailed comments. ;-)

> Do these characteristics spell trouble?  Are there existing real-world
> installations that successfully connect large client-bases directly to
> rabbitmq?

I believe so, but others can confirm or deny for sure.

Another approach you could take, given the high disconnect/reconnect
load you anticipate, and the custom security requirements you have, is
to hack your existing TCP transport so that it backs into the AMQP
routing, queueing and delivery model. That way you get to reuse the core
of RabbitMQ, and all of the careful design of AMQP, with a
lighter-weight and more domain-focussed wire protocol. How's your
Erlang? ;-) (See, e.g., the STOMP adapter for an example of how this
might be done.)

Regards,
  Tony



From tonyg at lshift.net  Thu Feb 25 05:13:51 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 25 Feb 2010 18:13:51 +1300
Subject: [rabbitmq-discuss] Channel.Flow in Java client
In-Reply-To: <64de5c8b1002220822k4b11622fs7dab998f76515367@mail.gmail.com>
References: <64de5c8b1002220822k4b11622fs7dab998f76515367@mail.gmail.com>
Message-ID: <4B86070F.6050209@lshift.net>

Hi Rajkumar,

There's currently no public API for checking whether channel.flow has
been asserted or not. Sorry about that. I've filed a bug to get it
looked at (bug 22412, fyi).

For now, you can use the internal implementation details to get hold of
the value. PLEASE BE WARNED, this can only be a temporary solution,
since we reserve the right to change implementation internals without
notice! So really, if you decide to do this, know that it will
eventually stop working. That said:

  // Gross encapsulation-violating temporary hack to work around
  // the lack of public API for retrieving Channel.Flow status
  Channel ch = ...;
  com.rabbitmq.client.impl.ChannelN chImpl
    = (com.rabbitmq.client.impl.ChannelN) ch;
  System.out.println("We are currently " +
                     (chImpl._blockContent ? "BLOCKED" : "NOT blocked")+
                     " from sending content.");

Regards,
  Tony

Rajkumar S wrote:
> Hello,
> 
> How does a java client (I am using rabbitmq 1.7.2) know when a server
> has enabled Channel.Flow?
> 
> I have been using the stomp plugin to send messages to rabbitmq, since
> stomp plugin does not handle Channel.Flow I am writing a stomp to amqp
> gateway. But during my testing basicPublish method just waits when
> server has enabled Channel.Flow. Is this the normal behavior?
> 
> I am now experimenting with TX. Is there any better way to take care
> of situation when server has enabled Channel.Flow?
> 
> with regards,
> 
> raj
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From glenn at rempe.us  Thu Feb 25 05:26:19 2010
From: glenn at rempe.us (Glenn Rempe)
Date: Wed, 24 Feb 2010 21:26:19 -0800
Subject: [rabbitmq-discuss] Erlang Client Example Code
Message-ID: <6cfccb3d1002242126y62352efahd95564b02d12c727@mail.gmail.com>

As I am busy learning the ins and outs of Erlang I wanted to make
direct connections between an Erlang Yaws Websockets program I am
developing and RabbitMQ.

As part of my (steep!) learning process I updated the
rabbitmq-erlang-code-examples project done by 'careo' on GitHub to
compile and work against the latest RabbitMQ and RabbitMQ Erlang
Client code. The examples now also include use of the 'direct client'
(which was really only a one line change).

Vlad thought this might be useful to others and recommended that I
post here.  I hope my fork of his example code is of use to others
trying to get the Erlang client working as I had a tough time finding
sample code to learn from that worked with the latest hg versions of
both the client and RabbitMQ.

Of course if you have any improvements please feel free to fork and
issue a GitHub pull request and I'll be happy to include
enhancements/fixes.  Suggestions for better ways to do things that
will help me learn are appreciated.

My fork of the sample code can be found here:

http://github.com/grempe/rabbitmq-erlang-client-examples

FYI, I've issued a pull request to merge this into 'careo's repository
as he did the vast majority of the work on this and deserves most of
the credit. You can find his original repo here, which may at some
point include my changes if he decides to merge them in.

http://github.com/careo/rabbitmq-erlang-client-examples

Cheers.

Glenn



From tonyg at lshift.net  Thu Feb 25 08:42:34 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 25 Feb 2010 21:42:34 +1300
Subject: [rabbitmq-discuss] Taking error_logger out of the "fast path" (was
 Re: beam process using 100% cpu and lots of memory)
In-Reply-To: <20100220210021.GB20598@wellquite.org>
References: <4f89225b1002151551p1cccdf63uccb1a44fb902d320@mail.gmail.com>
	<20100220210021.GB20598@wellquite.org>
Message-ID: <4B8637FA.9000105@lshift.net>

Matthew Sackman wrote:
> That's potentially a problem. We've recently discovered that the error
> logger, as it logs a couple of messages for every connection, isn't very
> fast, and its mailbox can rapidly grow.

That's very interesting. Should we avoid it? It's a tradeoff between the
nice features, flexibility & integration using the OTP error logging
mechanism gives us and the overhead of same. I'm sure we could gin up a
sane logger that's much quicker (but less flexible) fairly quickly.

What if, instead, we used syslog? Or simply logged everything only
through an internal exchange, avoiding the error_logger?

Tony



From tonyg at lshift.net  Thu Feb 25 08:51:11 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 25 Feb 2010 21:51:11 +1300
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++
 2005?
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891066F23667CBE@SVR-2K3-BH-EMC.tradition.int>
References: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>	<20100129104223.GB11306@wellquite.org>
	<4B7CCDA9.7020109@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891066F23667BCB@SVR-2K3-BH-EMC.tradition.int>
	<4B7D9682.4020300@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891066F23667CBE@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <4B8639FF.9060500@lshift.net>

Alister Morton wrote:
> TBH I haven't tried it, but not being able to step into the dll in the same debugger while debugging the wrapper would be tedious to say the least.

Golly! There's no standard debug-symbols format on Windows?

Tony




From tonyg at lshift.net  Thu Feb 25 08:54:45 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 25 Feb 2010 21:54:45 +1300
Subject: [rabbitmq-discuss] Version numbers for librabbitmq-c?
In-Reply-To: <BF306527-D19B-45B0-933B-3F4485FF00C8@gradwell.com>
References: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com>	<k5ljemt66d.fsf@mrbraver.lshift.net>
	<BF306527-D19B-45B0-933B-3F4485FF00C8@gradwell.com>
Message-ID: <4B863AD5.1000802@lshift.net>

Hi Stuart,

Stuart Herbert wrote:
> Would it be possible to start versioning librabbitmq-c?

Well... in a *way* it's versioned by way of mercurial revision IDs. It'd
*work* to refer to versions that way, but it might not be *acceptable*...

"This code requires rabbitmq-c. It has been tested most recently against
revision ce1eaceaee94 of 25 Feb 2010 from the rabbitmq-c Mercurial
repository."

Tony




From tonyg at lshift.net  Thu Feb 25 09:04:45 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 25 Feb 2010 22:04:45 +1300
Subject: [rabbitmq-discuss] message in queue
In-Reply-To: <99f8bdb8-15ec-4786-bac5-1dbf2388770f@u5g2000prd.googlegroups.com>
References: <99f8bdb8-15ec-4786-bac5-1dbf2388770f@u5g2000prd.googlegroups.com>
Message-ID: <4B863D2D.6040906@lshift.net>

akhil wrote:
> I have noticed that a few messages spend way too much in the queue,
> due to which duplicate reposting of message occurs.

Hmm. The only way that could happen is either if no-one is listening to
that queue, or if whoever receives the message for some reason fails to
acknowledge it before disconnecting. What could be causing that, in your
application?

> Is there any way to track the life cycle of a message in the queue.
> For eg how much time the message has spent in the queue.

I'm afraid there's nothing like that at present.

Regards,
  Tony




From Alister.Morton at tradition.com  Thu Feb 25 09:06:27 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Thu, 25 Feb 2010 09:06:27 +0000
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++
 2005?
In-Reply-To: <4B8639FF.9060500@lshift.net>
References: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>
	<20100129104223.GB11306@wellquite.org> <4B7CCDA9.7020109@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891066F23667BCB@SVR-2K3-BH-EMC.tradition.int>
	<4B7D9682.4020300@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891066F23667CBE@SVR-2K3-BH-EMC.tradition.int>
	<4B8639FF.9060500@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066F23668302@SVR-2K3-BH-EMC.tradition.int>

> Golly! There's no standard debug-symbols format on Windows?

As I say, I haven't tried it yet. If the gcc compiler outputs debug symbols that the MS debugger understands, which I guess would count as the standard format and as far as I know is COFF, it would be possible. If not, it wouldn't. I remember some years ago that it was troublesome stepping into dlls that had been built with say a Borland or Watcom compiler in the MS debugger, but they may have now converged.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From tonyg at lshift.net  Thu Feb 25 09:18:12 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 25 Feb 2010 22:18:12 +1300
Subject: [rabbitmq-discuss] WCF bindings support SOAP -- what would be
 invovled in others?
In-Reply-To: <4d260fa71002182110r54840346gf9283f79f9d20e2c@mail.gmail.com>
References: <4d260fa71002182110r54840346gf9283f79f9d20e2c@mail.gmail.com>
Message-ID: <4B864054.3070202@lshift.net>

Matthew Dunn wrote:
> Would anyone be able to tell me how much effort would be involved in
> creating a custom binding that will support the same binary serializer
> used by the net.tcp binding?

Interesting. It's a long, long time since I looked into the WCF binding.
Have you ever built custom extensions to the WCF core before? If so,
you're very likely the most qualified person on this list to attack the
problem :-)

> Is this only a configuraiton change or must custom code be developed?

I... actually don't know. It really *should* just be a configuration
change: the WCF binding implements Rabbity *channels*, which configure
their encoders (and their connections to the other elements of the WCF
stack) from the binding context given to them in their constructor so
it's perfectly possible there's a magic configuration stanza that'll do
the trick. It may even be straightforward. I no longer have access to a
windows box to try it out on :-(

Tony




From stuart.herbert at gradwell.com  Thu Feb 25 10:32:14 2010
From: stuart.herbert at gradwell.com (Stuart Herbert)
Date: Thu, 25 Feb 2010 10:32:14 +0000
Subject: [rabbitmq-discuss] Version numbers for librabbitmq-c?
In-Reply-To: <4B863AD5.1000802@lshift.net>
References: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com>	<k5ljemt66d.fsf@mrbraver.lshift.net>
	<BF306527-D19B-45B0-933B-3F4485FF00C8@gradwell.com>
	<4B863AD5.1000802@lshift.net>
Message-ID: <B72F8FA7-59D8-42E2-806C-BD5DB9F38555@gradwell.com>

Hi Tony,

On 25 Feb 2010, at 08:54, Tony Garnock-Jones wrote:

> Well... in a *way* it's versioned by way of mercurial revision IDs. It'd
> *work* to refer to versions that way, but it might not be *acceptable*...
> 
> "This code requires rabbitmq-c. It has been tested most recently against
> revision ce1eaceaee94 of 25 Feb 2010 from the rabbitmq-c Mercurial
> repository."

Mmm ... I see what you're saying, but I think it'd be a bit easier for folks if we had a numbered release we can point people to.  Having numbered releases following the X.Y.Z approach will also help w/ focusing on stabilisation of the C library :)

Best regards,
Stu
--


From akhil.kodali at gmail.com  Thu Feb 25 11:46:41 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Thu, 25 Feb 2010 17:16:41 +0530
Subject: [rabbitmq-discuss] message in queue
In-Reply-To: <4B863D2D.6040906@lshift.net>
References: <99f8bdb8-15ec-4786-bac5-1dbf2388770f@u5g2000prd.googlegroups.com>
	<4B863D2D.6040906@lshift.net>
Message-ID: <ffa595bc1002250346m7f99dd2cr276b11ccdcd43e29@mail.gmail.com>

Hi,

The queue doesnot duplicate the message, the application happens to post it
as it is unable to determine what is in the queue.

To avoid duplicates one way is to expire out the messages in the queue after
certain period of time, anyway to configure it.
Currently I am checking it at the application level.

----
Regards,
Akhil Kodali



On Thu, Feb 25, 2010 at 2:34 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> akhil wrote:
> > I have noticed that a few messages spend way too much in the queue,
> > due to which duplicate reposting of message occurs.
>
> Hmm. The only way that could happen is either if no-one is listening to
> that queue, or if whoever receives the message for some reason fails to
> acknowledge it before disconnecting. What could be causing that, in your
> application?
>
> > Is there any way to track the life cycle of a message in the queue.
> > For eg how much time the message has spent in the queue.
>
> I'm afraid there's nothing like that at present.
>
> Regards,
>   Tony
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100225/fce5e672/attachment.htm 

From majek04 at gmail.com  Thu Feb 25 16:49:47 2010
From: majek04 at gmail.com (majek04)
Date: Thu, 25 Feb 2010 16:49:47 +0000
Subject: [rabbitmq-discuss] Taking error_logger out of the "fast path"
	(was Re: beam process using 100% cpu and lots of memory)
In-Reply-To: <4B8637FA.9000105@lshift.net>
References: <4f89225b1002151551p1cccdf63uccb1a44fb902d320@mail.gmail.com>
	<20100220210021.GB20598@wellquite.org> <4B8637FA.9000105@lshift.net>
Message-ID: <3bb0d9711002250849p6795f634i2778083c83ce6994@mail.gmail.com>

On Thu, Feb 25, 2010 at 08:42, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Matthew Sackman wrote:
>> That's potentially a problem. We've recently discovered that the error
>> logger, as it logs a couple of messages for every connection, isn't very
>> fast, and its mailbox can rapidly grow.
>
> That's very interesting. Should we avoid it? It's a tradeoff between the
> nice features, flexibility & integration using the OTP error logging
> mechanism gives us and the overhead of same. I'm sure we could gin up a
> sane logger that's much quicker (but less flexible) fairly quickly.
>
> What if, instead, we used syslog? Or simply logged everything only
> through an internal exchange, avoiding the error_logger?

I think we can take several approaches:
 - use syslog and/or rewrite the logging infrastructure
 - invent filter on top of the logger, which would stop sending
   new errors if there are too many of them. Something similar
   to "last message repeated XX time(s)" from syslog.
 - move logger away from the critical path, by doing logging
   asynchronously. This can lead to out-of-memory crash.

Marek



From dane.jensen at gmail.com  Thu Feb 25 19:50:07 2010
From: dane.jensen at gmail.com (Dane Jensen)
Date: Thu, 25 Feb 2010 11:50:07 -0800
Subject: [rabbitmq-discuss] Erlang Client Example Code
In-Reply-To: <6cfccb3d1002242126y62352efahd95564b02d12c727@mail.gmail.com>
References: <6cfccb3d1002242126y62352efahd95564b02d12c727@mail.gmail.com>
Message-ID: <e40d4f541002251150v6b44946ayd19a5a4ab278a06b@mail.gmail.com>

On Wed, Feb 24, 2010 at 9:26 PM, Glenn Rempe <glenn at rempe.us> wrote:
> As I am busy learning the ins and outs of Erlang I wanted to make
> direct connections between an Erlang Yaws Websockets program I am
> developing and RabbitMQ.
>
> As part of my (steep!) learning process I updated the
> rabbitmq-erlang-code-examples project done by 'careo' on GitHub to
> compile and work against the latest RabbitMQ and RabbitMQ Erlang
> Client code. The examples now also include use of the 'direct client'
> (which was really only a one line change).

Excellent! Thank you for doing that. I've merged your fork in.

-Dane



From tonyg at lshift.net  Thu Feb 25 20:54:48 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 26 Feb 2010 09:54:48 +1300
Subject: [rabbitmq-discuss] Taking error_logger out of the "fast path"
 (was Re: beam process using 100% cpu and lots of memory)
In-Reply-To: <3bb0d9711002250849p6795f634i2778083c83ce6994@mail.gmail.com>
References: <4f89225b1002151551p1cccdf63uccb1a44fb902d320@mail.gmail.com>	
	<20100220210021.GB20598@wellquite.org>
	<4B8637FA.9000105@lshift.net>
	<3bb0d9711002250849p6795f634i2778083c83ce6994@mail.gmail.com>
Message-ID: <4B86E398.4080805@lshift.net>

majek04 wrote:
> I think we can take several approaches:
>  - use syslog and/or rewrite the logging infrastructure

I've been interested in syslog for a while; did you know there's a
syslog *protocol*? It'd be cool to have a syslog plugin, for in- and
outbound traffic, that spoke that protocol...

>  - invent filter on top of the logger, which would stop sending
>    new errors if there are too many of them. Something similar
>    to "last message repeated XX time(s)" from syslog.

Perhaps, but in the case of a high rate of connections/disconnections
such as the OP is experiencing, that's tantamount to throwing away most
of the information (namely, the IP address and port), which we could do
just as well by not logging it at all. Unless you really do have
something adaptive in mind. Sounds tricky to get right ;-)

>  - move logger away from the critical path, by doing logging
>    asynchronously. This can lead to out-of-memory crash.

Yep. So if, as Matthew says, the problem is a long error_logger message
queue, if we avoided *that* we might be OK even with the error_logger as
it stands: you know, the normal problems of O(n^2) for selective
receives. Perhaps dusting off the old buffering intermediary process?

Actually, since I think we're using rabbit_log *almost* everywhere we
need to (but, frustratingly, not in tcp_acceptor! perhaps because it is
for generic, non-rabbit use as well?), we might be able to bypass the
problem well enough by switching rabbit_log to being an instance of
gen_server2.

Tony



From tonyg at lshift.net  Thu Feb 25 21:06:36 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 26 Feb 2010 10:06:36 +1300
Subject: [rabbitmq-discuss] Version numbers for librabbitmq-c?
In-Reply-To: <B72F8FA7-59D8-42E2-806C-BD5DB9F38555@gradwell.com>
References: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com>	<k5ljemt66d.fsf@mrbraver.lshift.net>
	<BF306527-D19B-45B0-933B-3F4485FF00C8@gradwell.com>
	<4B863AD5.1000802@lshift.net>
	<B72F8FA7-59D8-42E2-806C-BD5DB9F38555@gradwell.com>
Message-ID: <4B86E65C.1010803@lshift.net>

Stuart Herbert wrote:
> Mmm ... I see what you're saying, but I think it'd be a bit easier
> for folks if we had a numbered release we can point people to.
> Having numbered releases following the X.Y.Z approach will also help
> w/ focusing on stabilisation of the C library :)

Fair enough :-)

For your delectation, two new tags:

	librabbitmq-0.1-amqp_0_9_1
	librabbitmq-0.1-amqp_0_8

The "0.1" is the version number, and the "amqp_0_8" indicates which
version of the spec each tag supports. Slightly odd, I know. So the tag
with the "amqp_0_8" suffix is against the default branch, and the one
with the "amqp_0_9_1" suffix is against the amqp_0_9_1 branch, which has
default merged into it regularly, so they hold roughly the "same" code,
up to the differences required by the differences in the spec versions.

Go with librabbitmq-XX.YY-amqp_0_8 for compatibility with
currently-released versions of RabbitMQ server.

Regards,
  Tony



From MVierling at attinteractive.com  Thu Feb 25 22:20:24 2010
From: MVierling at attinteractive.com (Michael Vierling)
Date: Thu, 25 Feb 2010 14:20:24 -0800
Subject: [rabbitmq-discuss] HA queues
Message-ID: <313F3102E02BDA4B8D68829F0D34882809813272@SFOEXM01.YELLOWPAGES.LOCAL>

We're using RabbitMQ for several internal projects.  However there have
been requests for HA Queues.  HA queues would leverage a design similar
to MasterSlave, i.e. http://activemq.apache.org/pure-master-slave.html
However, unlike ActiveMQ, the feature could operate at the queue level,
instead of the Broker level.  Currently when a RabbitMQ queue is
declared it has a primary node content owner.  If the node hardware
fails or is shutdown, clients will get a 404 error if they attempt to
subscribe or publish to this queue, on other cluster nodes.  
 
We're considering designing an Erlang patch to RabbitMQ to handle the
404 case, and support a MasterSlave queue failover.
 
Thoughts, comments?  Is this something already planned or prototyped?
 
Thanks,
Michael



From matthias at lshift.net  Thu Feb 25 22:52:32 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 25 Feb 2010 22:52:32 +0000
Subject: [rabbitmq-discuss] HA queues
In-Reply-To: <313F3102E02BDA4B8D68829F0D34882809813272@SFOEXM01.YELLOWPAGES.LOCAL>
References: <313F3102E02BDA4B8D68829F0D34882809813272@SFOEXM01.YELLOWPAGES.LOCAL>
Message-ID: <4B86FF30.7060106@lshift.net>

Michael,

Michael Vierling wrote:
> We're using RabbitMQ for several internal projects.  However there have
> been requests for HA Queues.  HA queues would leverage a design similar
> to MasterSlave, i.e. http://activemq.apache.org/pure-master-slave.html
> However, unlike ActiveMQ, the feature could operate at the queue level,
> instead of the Broker level.  Currently when a RabbitMQ queue is
> declared it has a primary node content owner.  If the node hardware
> fails or is shutdown, clients will get a 404 error if they attempt to
> subscribe or publish to this queue, on other cluster nodes.
>  
> We're considering designing an Erlang patch to RabbitMQ to handle the
> 404 case, and support a MasterSlave queue failover.
>  
> Thoughts, comments?  Is this something already planned or prototyped?

We have thought about this. A lot. And yes, we are planning to introduce 
queues-that-survive-node-failures at some point in the not too distant 
future, but it's not something we are working on right now, so patches 
are welcome.

Doing this properly, such that the observable behaviour is consistent 
with the queue never having been disturbed, is hard. Matthew has been 
looking into this most recently and may be able to provide some pointers 
on potential pitfalls - he's on holiday atm but will be back next week.


Regards,

Matthias.



From 0x6e6562 at gmail.com  Thu Feb 25 23:37:06 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 26 Feb 2010 09:37:06 +1000
Subject: [rabbitmq-discuss] Erlang Client Example Code
In-Reply-To: <e40d4f541002251150v6b44946ayd19a5a4ab278a06b@mail.gmail.com>
References: <6cfccb3d1002242126y62352efahd95564b02d12c727@mail.gmail.com>
	<e40d4f541002251150v6b44946ayd19a5a4ab278a06b@mail.gmail.com>
Message-ID: <269388e31002251537q57c400c5t3b128179be97ab87@mail.gmail.com>

Dane, Glenn,

On Fri, Feb 26, 2010 at 5:50 AM, Dane Jensen <dane.jensen at gmail.com> wrote:
> On Wed, Feb 24, 2010 at 9:26 PM, Glenn Rempe <glenn at rempe.us> wrote:
>> As I am busy learning the ins and outs of Erlang I wanted to make
>> direct connections between an Erlang Yaws Websockets program I am
>> developing and RabbitMQ.
>>
>> As part of my (steep!) learning process I updated the
>> rabbitmq-erlang-code-examples project done by 'careo' on GitHub to
>> compile and work against the latest RabbitMQ and RabbitMQ Erlang
>> Client code. The examples now also include use of the 'direct client'
>> (which was really only a one line change).
>
> Excellent! Thank you for doing that. I've merged your fork in.

I have a cursory glance at the examples and I'm suggesting some minor
improvements:

- Tickets, Realms and the access.request command are no longer in the
AMQP spec and hence are treated as NOOPs in Rabbit - you can safely
remove these;
- The codegen module creates sensible defaults for the command
records, so unless you need to override an attribute, you can make
your record definitions more concise;
- You can use amqp_connection:close/1 which is terser than
amqp_connection:close/3;

Ben



From aquino.gustavo at gmail.com  Fri Feb 26 01:08:16 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Thu, 25 Feb 2010 22:08:16 -0300
Subject: [rabbitmq-discuss] RabbitMQ on VM.
Message-ID: <5ef296b31002251708m344dfedbx584d0dc39695451a@mail.gmail.com>

Hi,

Anybody here are using Rabbit +Erlang on VM with more than 2 CPUs with 2
cores ?

Erlang doen't work in this environment for me,if I remove one CPU all works
fine, but putting other it's crash with the MONOTONIC CLOCK problem.


Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100225/9ac8d402/attachment.htm 

From tobert at gmail.com  Fri Feb 26 03:03:49 2010
From: tobert at gmail.com (Al Tobey)
Date: Thu, 25 Feb 2010 20:03:49 -0700
Subject: [rabbitmq-discuss] RabbitMQ on VM.
In-Reply-To: <5ef296b31002251708m344dfedbx584d0dc39695451a@mail.gmail.com>
References: <5ef296b31002251708m344dfedbx584d0dc39695451a@mail.gmail.com>
Message-ID: <5ac7acb11002251903s43abc313q4ed160a5b521eb65@mail.gmail.com>

On Thu, Feb 25, 2010 at 6:08 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Hi,
> Anybody here are using Rabbit +Erlang on VM with more than 2 CPUs with 2
> cores ?

I'm running a clustered instance on two Linux VM's with 1G RAM and 2
CPU's on top of Linux/KVM hypervisors (each instance is on a different
physical VM server).    It works fine and has done so for a long time.

> Erlang doen't work in this environment for me,if I remove one CPU all works
> fine, but putting other it's crash with the MONOTONIC?CLOCK?problem.

It's impossible to say what's going on without knowing what hypervisor
and guest you're using.  If it's KVM/Linux, you may try enabling the
paravirtual clock options in the guest kernel.     There are a
multitude of workarounds for clock problems in VM's and which one to
use depends entirely on your guest/hypervisor combination.

VMWare has a nice paper on the topic.
http://www.vmware.com/pdf/vmware_timekeeping.pdf

-Al Tobey

> Regards.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From glenn at rempe.us  Fri Feb 26 05:53:06 2010
From: glenn at rempe.us (Glenn Rempe)
Date: Thu, 25 Feb 2010 21:53:06 -0800
Subject: [rabbitmq-discuss] Erlang Client Example Code
In-Reply-To: <269388e31002251537q57c400c5t3b128179be97ab87@mail.gmail.com>
References: <6cfccb3d1002242126y62352efahd95564b02d12c727@mail.gmail.com> 
	<e40d4f541002251150v6b44946ayd19a5a4ab278a06b@mail.gmail.com> 
	<269388e31002251537q57c400c5t3b128179be97ab87@mail.gmail.com>
Message-ID: <6cfccb3d1002252153p5ba83d62hec0bbd10db255e86@mail.gmail.com>

Thanks Ben.  I've made your suggested changes, and I've sent Dane a
pull request.

You can take a look here.

http://github.com/grempe/rabbitmq-erlang-client-examples

It might be nice to figure out a way to pull these examples into the
Erlang client codebase so others can see it without hunting.

I'm struggling a bit with how I can best make use of the direct client
since it seems that it can only run on the same node as the RabbitMQ
server process (and not across nodes).  If I am mistaken please feel
free to correct me. :-)  I'll put together a new thread for that
question though when I dig a little more.

Cheers,

Glenn

On Thu, Feb 25, 2010 at 3:37 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Dane, Glenn,
>
> On Fri, Feb 26, 2010 at 5:50 AM, Dane Jensen <dane.jensen at gmail.com> wrote:
>> On Wed, Feb 24, 2010 at 9:26 PM, Glenn Rempe <glenn at rempe.us> wrote:
>>> As I am busy learning the ins and outs of Erlang I wanted to make
>>> direct connections between an Erlang Yaws Websockets program I am
>>> developing and RabbitMQ.
>>>
>>> As part of my (steep!) learning process I updated the
>>> rabbitmq-erlang-code-examples project done by 'careo' on GitHub to
>>> compile and work against the latest RabbitMQ and RabbitMQ Erlang
>>> Client code. The examples now also include use of the 'direct client'
>>> (which was really only a one line change).
>>
>> Excellent! Thank you for doing that. I've merged your fork in.
>
> I have a cursory glance at the examples and I'm suggesting some minor
> improvements:
>
> - Tickets, Realms and the access.request command are no longer in the
> AMQP spec and hence are treated as NOOPs in Rabbit - you can safely
> remove these;
> - The codegen module creates sensible defaults for the command
> records, so unless you need to override an attribute, you can make
> your record definitions more concise;
> - You can use amqp_connection:close/1 which is terser than
> amqp_connection:close/3;
>
> Ben
>



From 0x6e6562 at gmail.com  Fri Feb 26 07:18:07 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 26 Feb 2010 17:18:07 +1000
Subject: [rabbitmq-discuss] Erlang Client Example Code
In-Reply-To: <6cfccb3d1002252153p5ba83d62hec0bbd10db255e86@mail.gmail.com>
References: <6cfccb3d1002242126y62352efahd95564b02d12c727@mail.gmail.com>
	<e40d4f541002251150v6b44946ayd19a5a4ab278a06b@mail.gmail.com>
	<269388e31002251537q57c400c5t3b128179be97ab87@mail.gmail.com>
	<6cfccb3d1002252153p5ba83d62hec0bbd10db255e86@mail.gmail.com>
Message-ID: <269388e31002252318r27002d5r92bdf40794979990@mail.gmail.com>

Glenn,

On Fri, Feb 26, 2010 at 3:53 PM, Glenn Rempe <glenn at rempe.us> wrote:
> Thanks Ben. ?I've made your suggested changes, and I've sent Dane a
> pull request.
>
> You can take a look here.
>
> http://github.com/grempe/rabbitmq-erlang-client-examples

That looks a look terser :-)

On second glance here a few more comments:

- In analogy to amqp_connection:close/1, there is also the shorter
amqp_channel:close/1 as well;
- It doesn't seem like you need to declare a specific queue name - you
could potentially use a server generated queue name if you'd like;

> It might be nice to figure out a way to pull these examples into the
> Erlang client codebase so others can see it without hunting.

Fair point. ATM we do have a programmers guide for the Erlang client
and generated API docs, but this is not on the RabbitMQ website
because the Erlang client is not a officially supported client yet. So
that may follow at some stage.

If you did decide to include say an examples directory into the core
client source tree, you'd need to create a patch against this and
submit that. Having said that, you'd need to make sure of the
following in order for the patch to be seriously considered:

- It would have to bind in the current Makefile, i.e. you'd need to
have a target to run all of the examples;
- The examples would have to be reasonably canonical and expressive in
nature. In your stocks example you'd need to delve in to the routing
key matching mechanics a little bit more. Though they can be
informative, I'm not sure that the code verbosity introduced by the
log statements is a good thing. You may want to ask on the list what
the intention of the amqp_dbg module is;
- You'd need to document them as well :-(

So it may be less effort on your part to remain separate from the core
client source tree, but that's down to you.

In the meantime, I'm sure that Alexis will link your github tree into
an appropriate space on the community part of the RabbitMQ website.

> I'm struggling a bit with how I can best make use of the direct client
> since it seems that it can only run on the same node as the RabbitMQ
> server process (and not across nodes). ?If I am mistaken please feel
> free to correct me. :-)

The motivation behind the direct client is to provide the AMQP library
semantics transparently to an application that is co-located on the
same node as the server. The advantage of this is that you don't incur
the network and marshalling overhead (having said this, I don't think
anybody has actually benchmarked this yet). This provides the
application with a non-Rabbit specific API but lets you embed this
directly into a running instance of Rabbit.

One example use case of this is the rabbit_shovel plugin, which can
take advantage of the colocation if you configure it to do so.

HTH,

Ben



From stuart.herbert at gradwell.com  Fri Feb 26 13:14:11 2010
From: stuart.herbert at gradwell.com (Stuart Herbert)
Date: Fri, 26 Feb 2010 13:14:11 +0000
Subject: [rabbitmq-discuss] Version numbers for librabbitmq-c?
In-Reply-To: <4B86E65C.1010803@lshift.net>
References: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com>	<k5ljemt66d.fsf@mrbraver.lshift.net>
	<BF306527-D19B-45B0-933B-3F4485FF00C8@gradwell.com>
	<4B863AD5.1000802@lshift.net>
	<B72F8FA7-59D8-42E2-806C-BD5DB9F38555@gradwell.com>
	<4B86E65C.1010803@lshift.net>
Message-ID: <ED22C19D-4353-4E96-8DD8-0E4978C9D406@gradwell.com>

Hi Tony,

On 25 Feb 2010, at 21:06, Tony Garnock-Jones wrote:

> For your delectation, two new tags:
> 
> 	librabbitmq-0.1-amqp_0_9_1
> 	librabbitmq-0.1-amqp_0_8

Many thanks :)

> The "0.1" is the version number, and the "amqp_0_8" indicates which
> version of the spec each tag supports. Slightly odd, I know.

I haven't dug into the internals of the library yet, and AMQ is something that is still new to me. Why isn't it possible to support both protocols from the one release?

> Go with librabbitmq-XX.YY-amqp_0_8 for compatibility with
> currently-released versions of RabbitMQ server.

Will do.

Best regards,
Stu
--


From jmann at versatile.com  Fri Feb 26 15:10:23 2010
From: jmann at versatile.com (John Mann)
Date: Fri, 26 Feb 2010 10:10:23 -0500
Subject: [rabbitmq-discuss] Duplicate Messages received after
	basicRecoveryAsync() is called.
In-Reply-To: <4B87B3C3.9080203@lshift.net>
References: <B72F8B56-A8B0-409D-9297-2C3D6F37136E@versatile.com>
	<4B86FA53.6080700@lshift.net>
	<BDEF84F6-B09B-4DA3-AE7A-E92DF440852D@versatile.com>
	<4B87B3C3.9080203@lshift.net>
Message-ID: <0D8650CD-1B4F-4689-84AB-025A34EBD26C@versatile.com>

On Feb 26, 2010, at 6:42 AM, Matthias Radestock wrote:

> John Mann wrote:
>> From the client perspective, receiving messages that I've already
>> acknowledged is confusing.
> 
> Here is a possible trace, as observed at the server, with delivery tags and acks included:
> 
> -> publish(A)
> <- deliver(1, A)
> -> publish(B)
> <- deliver(2, B)
> -> recover
> <- deliver(3, A)
> <- deliver(4, B)
> -> ack(2)
> -> ack(3)
> 
> As you can see, the ack(2) isn't received by the server until after it has re-delivered both messages.

Ah!  I get it.

> 
>> Is there a way to recover unacknowledged messages without also
>> receiving previously acknowledged messages?
> 
> 'recover' should be a synchronous operation, and such an operation is introduced in the 0-9-1 version of the AMQP spec, which rabbit will implement soon.
> 
> The recover-ok reply of the synchronous operation acts as a marker in the delivery stream - all unacked messages received by the client before it are recovered.
> 
> There is still a problem though: there is no easy way to tell in the client API which messages were received before or after the recover-ok. I will raise a bug for that.

Yup, that's my problem.  I knew that the basicRecoverAsync method was asynchronous (the name helps! :) ), but I didn't know what to wait on.

> Can you elaborate on what you are trying to accomplish?

I have a component (RabbitMQConsumer) that is responsible for listening for messages from a RabbitMQ queue.  Upon receiving a message, the RabbitMQConsumer invokes a method on a configurable listener class that implements the RawConsumer interface. 

Here is the meat of the RabbitMQConsumer class:

...
while (isRunning()) {
  try {
     deliverToRawConsumer(consumer.nextDelivery());
  } catch (InterruptedException e) {
     break;
  }
}
...

private void deliverToRawConsumer(QueueingConsumer.Delivery delivery) {
  String rawMessage = new String(delivery.getBody());

  try {
     rawConsumer.consume(rawMessage);

     acknowledgeMessageDelivery(delivery);
  }
  catch (Exception e) {
     LOG.error("Problem consuming message.", e);
     LOG.info("Not acknowledging message delivery.");
  }
}

By design, the RabbitMQConsumer does not acknowledge a message if the RawConsumer throws an exception. 

The problem is that the behavior of the RawConsumer class can change during runtime.  This means that it can throw an exception while consuming some messages, then later in time it can "recover".  When it recovers, I need to be able to retry all of the previously unacknowledged messages.

> Would closing and re-opening the channel be an option?

I think I can do that.  Are there any pitfalls in this approach.  I don't want to lose any messages.

> PS: could we continue this discussion on rabbitmq-discuss?

Good idea.  Done.

Thanks Matthias.

-John




From matthias at lshift.net  Fri Feb 26 16:08:55 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 26 Feb 2010 16:08:55 +0000
Subject: [rabbitmq-discuss] Duplicate Messages received after
	basicRecoveryAsync() is called.
In-Reply-To: <0D8650CD-1B4F-4689-84AB-025A34EBD26C@versatile.com>
References: <B72F8B56-A8B0-409D-9297-2C3D6F37136E@versatile.com>
	<4B86FA53.6080700@lshift.net>
	<BDEF84F6-B09B-4DA3-AE7A-E92DF440852D@versatile.com>
	<4B87B3C3.9080203@lshift.net>
	<0D8650CD-1B4F-4689-84AB-025A34EBD26C@versatile.com>
Message-ID: <4B87F217.3010906@lshift.net>

John,

John Mann wrote:
> By design, the RabbitMQConsumer does not acknowledge a message if the
> RawConsumer throws an exception.
> 
> The problem is that the behavior of the RawConsumer class can change
> during runtime.  This means that it can throw an exception while
> consuming some messages, then later in time it can "recover".  When
> it recovers, I need to be able to retry all of the previously
> unacknowledged messages.
> 
>> Would closing and re-opening the channel be an option?
> 
> I think I can do that.  Are there any pitfalls in this approach.  I
> don't want to lose any messages.

Closing the channel will result in all unacknowledged messages getting 
requeued, so no messages will be lost.

Another option is to cancel the consumer before initiating the recover. 
The sequence of client actions would be something like this:
1) send basic.cancel
2) wait for basic.cancel-ok
3) send basic.recover
4) send basic.consume

The hook for step 2 is provided by overriding the handleCancelOk method 
on the consumer class.

Note that the basic.recover in step 3 can by async or sync - it doesn't 
matter.

While waiting for the basic.cancel-ok in step 2 you have a choice of 
either continuing to process and ack messages, or throw them away and 
let the server resend them to the client as part of the recovery.


Regards,

Matthias.



From tsuraan at gmail.com  Fri Feb 26 19:55:50 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 26 Feb 2010 13:55:50 -0600
Subject: [rabbitmq-discuss] Set 21673 memory limit
Message-ID: <84fb38e31002261155n584b2268y4afedd33b5485f93@mail.gmail.com>

I know that I've found this before, but I'm not having any luck now.
What's the argument to rabbit to set the memory limit?



From tsuraan at gmail.com  Fri Feb 26 19:59:04 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 26 Feb 2010 13:59:04 -0600
Subject: [rabbitmq-discuss] Queue durability
Message-ID: <84fb38e31002261159j2a2fb54as1e361a78da370746@mail.gmail.com>

Is the 21673 queue storage supposed to be durable?  I've had systems
run out of memory, invoke the OOM-killer, and nuke Rabbit a few times.
 At some point (possibly with code up to a few weeks old), I lost the
existence of a queue.  Has this been a known issue in the past few
weeks, or is it a known issue that rabbit isn't nuke-proof?  I don't
have anything repeatable yet, but if it's not something that's known,
and it's something that shouldn't ever be able to happen, I'll try to
get a repeatable test case.



From glenn at rempe.us  Fri Feb 26 22:14:41 2010
From: glenn at rempe.us (Glenn Rempe)
Date: Fri, 26 Feb 2010 14:14:41 -0800
Subject: [rabbitmq-discuss] Erlang Client Example Code
In-Reply-To: <269388e31002252318r27002d5r92bdf40794979990@mail.gmail.com>
References: <6cfccb3d1002242126y62352efahd95564b02d12c727@mail.gmail.com> 
	<e40d4f541002251150v6b44946ayd19a5a4ab278a06b@mail.gmail.com> 
	<269388e31002251537q57c400c5t3b128179be97ab87@mail.gmail.com> 
	<6cfccb3d1002252153p5ba83d62hec0bbd10db255e86@mail.gmail.com> 
	<269388e31002252318r27002d5r92bdf40794979990@mail.gmail.com>
Message-ID: <6cfccb3d1002261414x2cdbd761i293aab07a00a9846@mail.gmail.com>

On Thu, Feb 25, 2010 at 11:18 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Glenn,
>
> On Fri, Feb 26, 2010 at 3:53 PM, Glenn Rempe <glenn at rempe.us> wrote:
>> Thanks Ben. ?I've made your suggested changes, and I've sent Dane a
>> pull request.
>>
>> You can take a look here.
>>
>> http://github.com/grempe/rabbitmq-erlang-client-examples
>
> That looks a look terser :-)

Great.

>
> On second glance here a few more comments:
>
> - In analogy to amqp_connection:close/1, there is also the shorter
> amqp_channel:close/1 as well;
> - It doesn't seem like you need to declare a specific queue name - you
> could potentially use a server generated queue name if you'd like;

I'll look at making those changes.

>
>> It might be nice to figure out a way to pull these examples into the
>> Erlang client codebase so others can see it without hunting.
>
> Fair point. ATM we do have a programmers guide for the Erlang client
> and generated API docs, but this is not on the RabbitMQ website
> because the Erlang client is not a officially supported client yet. So
> that may follow at some stage.
>
> If you did decide to include say an examples directory into the core
> client source tree, you'd need to create a patch against this and
> submit that. Having said that, you'd need to make sure of the
> following in order for the patch to be seriously considered:
>
> - It would have to bind in the current Makefile, i.e. you'd need to
> have a target to run all of the examples;
> - The examples would have to be reasonably canonical and expressive in
> nature. In your stocks example you'd need to delve in to the routing
> key matching mechanics a little bit more. Though they can be
> informative, I'm not sure that the code verbosity introduced by the
> log statements is a good thing. You may want to ask on the list what
> the intention of the amqp_dbg module is;
> - You'd need to document them as well :-(
>
> So it may be less effort on your part to remain separate from the core
> client source tree, but that's down to you.

Yes, it would be more effort.  I don't think I'll be taking that on at
the moment.  :-)


> In the meantime, I'm sure that Alexis will link your github tree into
> an appropriate space on the community part of the RabbitMQ website.

That's great.  However please link to 'careo's github repo.  I forked
his and he has been pulling my changes in.  My intention in doing this
was both to aid in my own learning, as well as to provide at least one
working version of code for the community to look at.  I think I've
accomplished that.  Hopefully others will find it helpful.

http://github.com/careo/rabbitmq-erlang-client-examples

>
>> I'm struggling a bit with how I can best make use of the direct client
>> since it seems that it can only run on the same node as the RabbitMQ
>> server process (and not across nodes). ?If I am mistaken please feel
>> free to correct me. :-)
>
> The motivation behind the direct client is to provide the AMQP library
> semantics transparently to an application that is co-located on the
> same node as the server. The advantage of this is that you don't incur
> the network and marshalling overhead (having said this, I don't think
> anybody has actually benchmarked this yet). This provides the
> application with a non-Rabbit specific API but lets you embed this
> directly into a running instance of Rabbit.
>
> One example use case of this is the rabbit_shovel plugin, which can
> take advantage of the colocation if you configure it to do so.

Thanks.  I was a bit surprised of the limitations of the direct
client.  Being an Erlang noob I was naively hoping that it would allow
me to take advantage of the distributed nature of Erlang nodes to
communicate with a rabbit instance anywhere in the distributed erlang
node cloud.  That would be nice.  ;-)  I think I'll probably have to
use the network client despite its additional overhead.

I'm surprised too that the Erlang client isn't a first class supported
client.  I saw the same thing working with the CouchDB team even
though you've both created excellent 'poster children' applications
for Erlang.  That's too bad.  :-(

Cheers and thanks for the look at the code.

Glenn



From aquino.gustavo at gmail.com  Fri Feb 26 22:39:29 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Fri, 26 Feb 2010 19:39:29 -0300
Subject: [rabbitmq-discuss] RabbitMQ on VM.
In-Reply-To: <5ac7acb11002251903s43abc313q4ed160a5b521eb65@mail.gmail.com>
References: <5ef296b31002251708m344dfedbx584d0dc39695451a@mail.gmail.com>
	<5ac7acb11002251903s43abc313q4ed160a5b521eb65@mail.gmail.com>
Message-ID: <5ef296b31002261439m2b961ea6ib450f3c217367f7d@mail.gmail.com>

Tobey,

Thanks for share this informations, unfortunately I'm using Hyper-v 6.1
running Linux, I take a look about Hyper-v paravirtualization kernel for
Linux and drivers for hypervisor and it is a very big concern.

Thanks for paper, I will try to do some workaround for this environment and
report the result.

Regards.

On Fri, Feb 26, 2010 at 12:03 AM, Al Tobey <tobert at gmail.com> wrote:

> On Thu, Feb 25, 2010 at 6:08 PM, Gustavo Aquino
> <aquino.gustavo at gmail.com> wrote:
> > Hi,
> > Anybody here are using Rabbit +Erlang on VM with more than 2 CPUs with 2
> > cores ?
>
> I'm running a clustered instance on two Linux VM's with 1G RAM and 2
> CPU's on top of Linux/KVM hypervisors (each instance is on a different
> physical VM server).    It works fine and has done so for a long time.
>
> > Erlang doen't work in this environment for me,if I remove one CPU all
> works
> > fine, but putting other it's crash with the MONOTONIC CLOCK problem.
>
> It's impossible to say what's going on without knowing what hypervisor
> and guest you're using.  If it's KVM/Linux, you may try enabling the
> paravirtual clock options in the guest kernel.     There are a
> multitude of workarounds for clock problems in VM's and which one to
> use depends entirely on your guest/hypervisor combination.
>
> VMWare has a nice paper on the topic.
> http://www.vmware.com/pdf/vmware_timekeeping.pdf
>
> -Al Tobey
>
> > Regards.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100226/5a6f35e1/attachment.htm 

From matthias at lshift.net  Fri Feb 26 23:10:27 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 26 Feb 2010 23:10:27 +0000
Subject: [rabbitmq-discuss] Set 21673 memory limit
In-Reply-To: <84fb38e31002261155n584b2268y4afedd33b5485f93@mail.gmail.com>
References: <84fb38e31002261155n584b2268y4afedd33b5485f93@mail.gmail.com>
Message-ID: <4B8854E3.7030005@lshift.net>

Tsuraan,

tsuraan wrote:
> What's the argument to rabbit to set the memory limit?

vm_memory_high_watermark. See http://www.rabbitmq.com/extensions.html#memsup


Regards,

Matthias.



From matthias at lshift.net  Fri Feb 26 23:17:34 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 26 Feb 2010 23:17:34 +0000
Subject: [rabbitmq-discuss] Queue durability
In-Reply-To: <84fb38e31002261159j2a2fb54as1e361a78da370746@mail.gmail.com>
References: <84fb38e31002261159j2a2fb54as1e361a78da370746@mail.gmail.com>
Message-ID: <4B88568E.9040900@lshift.net>

Tsuraan,

tsuraan wrote:
> Is the 21673 queue storage supposed to be durable?

Yes, for queues marked as durable and messages contained in them that 
are marked as persistent.

> I've had systems run out of memory, invoke the OOM-killer, and nuke
> Rabbit a few times.

Do you know why your systems are running out of memory? It certainly 
shouldn't be due to rabbit, if you have the memory thresholds configured 
correctly.

> At some point (possibly with code up to a few weeks old), I lost the
> existence of a queue.  Has this been a known issue in the past few
> weeks, or is it a known issue that rabbit isn't nuke-proof?

It should be pretty nuke proof. Matthew may be able to elaborate once 
he's back from holiday next week.

You certainly shouldn't be losing entire queues, and if you do I would 
at the very least expect there to be some errors in the logs. Is there 
nothing of interest in the rabbit.log and rabbit-sasl.log?


Regards,

Matthias.



From tonyg at lshift.net  Sat Feb 27 00:47:10 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 27 Feb 2010 13:47:10 +1300
Subject: [rabbitmq-discuss] Version numbers for librabbitmq-c?
In-Reply-To: <ED22C19D-4353-4E96-8DD8-0E4978C9D406@gradwell.com>
References: <571CCA3A-5C2E-4CD4-A5A5-8D85DC048427@gradwell.com>	<k5ljemt66d.fsf@mrbraver.lshift.net>
	<BF306527-D19B-45B0-933B-3F4485FF00C8@gradwell.com>
	<4B863AD5.1000802@lshift.net>
	<B72F8FA7-59D8-42E2-806C-BD5DB9F38555@gradwell.com>
	<4B86E65C.1010803@lshift.net>
	<ED22C19D-4353-4E96-8DD8-0E4978C9D406@gradwell.com>
Message-ID: <4B886B8E.2010707@lshift.net>

Stuart Herbert wrote:
> I haven't dug into the internals of the library yet, and AMQ is
> something that is still new to me. Why isn't it possible to support
> both protocols from the one release?

Well; multi-protocol support is perfectly *possible*, but I didn't start
out with it in mind (my mistake!) and retrofitting it would be a lot of
effort, so in the interests of my laid-back beach lifestyle I'm letting
the separate variants live on separate branches for now :-)

I've done a 0-8/0-9/0-9-1 multiprotocol library once before---the .NET
library---and while it worked, it sure was bloody fiddly, largely
because of the deeply unpleasant type system. Actually, that's a lie,
I've done it twice before: the other time was in Smalltalk, and there it
worked like a dream, scarcely more effort than uniprotocol support.
Smalltalk rules.

Tony



From tonyg at lshift.net  Sat Feb 27 00:50:25 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 27 Feb 2010 13:50:25 +1300
Subject: [rabbitmq-discuss] Duplicate Messages received
 after	basicRecoveryAsync() is called.
In-Reply-To: <4B87F217.3010906@lshift.net>
References: <B72F8B56-A8B0-409D-9297-2C3D6F37136E@versatile.com>	<4B86FA53.6080700@lshift.net>	<BDEF84F6-B09B-4DA3-AE7A-E92DF440852D@versatile.com>	<4B87B3C3.9080203@lshift.net>	<0D8650CD-1B4F-4689-84AB-025A34EBD26C@versatile.com>
	<4B87F217.3010906@lshift.net>
Message-ID: <4B886C51.4090505@lshift.net>

Matthias Radestock wrote:
> 1) send basic.cancel
> 2) wait for basic.cancel-ok
> The hook for step 2 is provided by overriding the handleCancelOk method 
> on the consumer class.

Note also that basicCancel() doesn't return to the caller until the
basic.cancel-ok has been received and completely processed by the client
library and the Consumer object.

Regards,
  Tony



From tsuraan at gmail.com  Sat Feb 27 18:15:04 2010
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 27 Feb 2010 12:15:04 -0600
Subject: [rabbitmq-discuss] Set 21673 memory limit
In-Reply-To: <4B8854E3.7030005@lshift.net>
References: <84fb38e31002261155n584b2268y4afedd33b5485f93@mail.gmail.com>
	<4B8854E3.7030005@lshift.net>
Message-ID: <84fb38e31002271015x77b9575eqe0e665d47015b604@mail.gmail.com>

> vm_memory_high_watermark. See http://www.rabbitmq.com/extensions.html#memsup

I don't think this is what I'm looking for.  I remember seeing some
argument for the disk-based queues that will limit how many messages
rabbit actually keeps in RAM, where the rest of the messages are
stored on disk.  So I'm not thinking of how to trigger the
channel.flow command, but rather how to control the size of the RAM
cache of messages.



From tsuraan at gmail.com  Sat Feb 27 18:20:07 2010
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 27 Feb 2010 12:20:07 -0600
Subject: [rabbitmq-discuss] Queue durability
In-Reply-To: <4B88568E.9040900@lshift.net>
References: <84fb38e31002261159j2a2fb54as1e361a78da370746@mail.gmail.com>
	<4B88568E.9040900@lshift.net>
Message-ID: <84fb38e31002271020k537293b8y33c377641ca12612@mail.gmail.com>

> Do you know why your systems are running out of memory? It certainly
> shouldn't be due to rabbit, if you have the memory thresholds configured
> correctly.

They're running out of memory because they have too much stuff running
on them that uses memory :)  Rabbit is one of the processes
(apparently the hungriest single process), but it's far from the only
process.  To be honest, I'm not sure why it's the hungriest process
either, but perhaps my other thread will help resolve that.

> It should be pretty nuke proof. Matthew may be able to elaborate once
> he's back from holiday next week.
>
> You certainly shouldn't be losing entire queues, and if you do I would
> at the very least expect there to be some errors in the logs. Is there
> nothing of interest in the rabbit.log and rabbit-sasl.log?

That's another problem, I guess.  When rabbit starts, it truncates its
previous logs (at least by default).  Our system has a supervisor
process that restarts dead processes, so when rabbit dies it gets
restarted immediately, which loses the logs of the previous crash.  I
suppose I should put some log rotation in my rabbit startup code, but
I haven't done that yet.  Is there an option to have rabbit rotate its
old logs, instead of truncating them?



From tonyg at lshift.net  Sat Feb 27 19:57:53 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 28 Feb 2010 08:57:53 +1300
Subject: [rabbitmq-discuss] Queue durability
In-Reply-To: <84fb38e31002271020k537293b8y33c377641ca12612@mail.gmail.com>
References: <84fb38e31002261159j2a2fb54as1e361a78da370746@mail.gmail.com>	<4B88568E.9040900@lshift.net>
	<84fb38e31002271020k537293b8y33c377641ca12612@mail.gmail.com>
Message-ID: <4B897941.4070001@lshift.net>

tsuraan wrote:
> Is there an option to have rabbit rotate its
> old logs, instead of truncating them?

Hmm, another mark against continuing to use error_logger, perhaps?

Tony




From matthias at lshift.net  Sat Feb 27 21:11:43 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 27 Feb 2010 21:11:43 +0000
Subject: [rabbitmq-discuss] Queue durability
In-Reply-To: <4B897941.4070001@lshift.net>
References: <84fb38e31002261159j2a2fb54as1e361a78da370746@mail.gmail.com>	<4B88568E.9040900@lshift.net>
	<84fb38e31002271020k537293b8y33c377641ca12612@mail.gmail.com>
	<4B897941.4070001@lshift.net>
Message-ID: <4B898A8F.5060706@lshift.net>

Tony,

Tony Garnock-Jones wrote:
> tsuraan wrote:
>> Is there an option to have rabbit rotate its
>> old logs, instead of truncating them?
> 
> Hmm, another mark against continuing to use error_logger, perhaps?

rabbit *does not* truncate its logs on restart. At least not if you are 
using the supplied startup scripts, which contain code to append the old 
log to the backup log (.1).

Matthias.



From matthias at lshift.net  Sat Feb 27 21:16:35 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 27 Feb 2010 21:16:35 +0000
Subject: [rabbitmq-discuss] Set 21673 memory limit
In-Reply-To: <84fb38e31002271015x77b9575eqe0e665d47015b604@mail.gmail.com>
References: <84fb38e31002261155n584b2268y4afedd33b5485f93@mail.gmail.com>	
	<4B8854E3.7030005@lshift.net>
	<84fb38e31002271015x77b9575eqe0e665d47015b604@mail.gmail.com>
Message-ID: <4B898BB3.9040502@lshift.net>

Tsuraan,

tsuraan wrote:
>> vm_memory_high_watermark. See http://www.rabbitmq.com/extensions.html#memsup
> 
> I don't think this is what I'm looking for.  I remember seeing some
> argument for the disk-based queues that will limit how many messages
> rabbit actually keeps in RAM, where the rest of the messages are
> stored on disk.  So I'm not thinking of how to trigger the
> channel.flow command, but rather how to control the size of the RAM
> cache of messages.

The above parameter sets an overall memory limit. The memory available 
to queues is dynamically adjusted to keep within that overall limit.

Early versions of the persister had different controls, so perhaps 
that's what you remember.


Regards,

Matthias.



From glenn at rempe.us  Sat Feb 27 21:50:17 2010
From: glenn at rempe.us (Glenn Rempe)
Date: Sat, 27 Feb 2010 13:50:17 -0800
Subject: [rabbitmq-discuss] Erlang Client Example Code
In-Reply-To: <6cfccb3d1002261414x2cdbd761i293aab07a00a9846@mail.gmail.com>
References: <6cfccb3d1002242126y62352efahd95564b02d12c727@mail.gmail.com> 
	<e40d4f541002251150v6b44946ayd19a5a4ab278a06b@mail.gmail.com> 
	<269388e31002251537q57c400c5t3b128179be97ab87@mail.gmail.com> 
	<6cfccb3d1002252153p5ba83d62hec0bbd10db255e86@mail.gmail.com> 
	<269388e31002252318r27002d5r92bdf40794979990@mail.gmail.com> 
	<6cfccb3d1002261414x2cdbd761i293aab07a00a9846@mail.gmail.com>
Message-ID: <6cfccb3d1002271350j6fe74bf4x7a0515b18a7b0e43@mail.gmail.com>

>> On second glance here a few more comments:
>>
>> - In analogy to amqp_connection:close/1, there is also the shorter
>> amqp_channel:close/1 as well;
>> - It doesn't seem like you need to declare a specific queue name - you
>> could potentially use a server generated queue name if you'd like;
>
> I'll look at making those changes.

I made those changes Ben.  Thanks.

http://github.com/grempe/rabbitmq-erlang-client-examples

>> ... I'm not sure that the code verbosity introduced by the
>> log statements is a good thing. You may want to ask on the list what
>> the intention of the amqp_dbg module is;

I took a look at the amqp_dbq module in the client test dir.
Unfortunately, I'm not clear how I would make use of that module and
I've found no mention of it in my search of the mailing list (Google
finds only a single result which is the commit message).

Can someone enlighten me? :-)



From tsuraan at gmail.com  Sat Feb 27 22:03:28 2010
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 27 Feb 2010 16:03:28 -0600
Subject: [rabbitmq-discuss] Queue durability
In-Reply-To: <4B898A8F.5060706@lshift.net>
References: <84fb38e31002261159j2a2fb54as1e361a78da370746@mail.gmail.com>
	<4B88568E.9040900@lshift.net>
	<84fb38e31002271020k537293b8y33c377641ca12612@mail.gmail.com>
	<4B897941.4070001@lshift.net> <4B898A8F.5060706@lshift.net>
Message-ID: <84fb38e31002271403k696f713o178eb38f4b60a5e2@mail.gmail.com>

> rabbit *does not* truncate its logs on restart. At least not if you are
> using the supplied startup scripts, which contain code to append the old
> log to the backup log (.1).

Ah, we're not using the rabbit scripts; the supervisor system needs
its own stuff, so instead of using rabbitmqctl and rabbitmq-server, I
pulled the erl lines out and I exec them from my own startup script.
I guess I'll have to throw the log rotation into my own startup
scripts too :-)



From tsuraan at gmail.com  Sat Feb 27 22:04:39 2010
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 27 Feb 2010 16:04:39 -0600
Subject: [rabbitmq-discuss] Set 21673 memory limit
In-Reply-To: <4B898BB3.9040502@lshift.net>
References: <84fb38e31002261155n584b2268y4afedd33b5485f93@mail.gmail.com>
	<4B8854E3.7030005@lshift.net>
	<84fb38e31002271015x77b9575eqe0e665d47015b604@mail.gmail.com>
	<4B898BB3.9040502@lshift.net>
Message-ID: <84fb38e31002271404m70d971b5je3c1249d95b152eb@mail.gmail.com>

> The above parameter sets an overall memory limit. The memory available
> to queues is dynamically adjusted to keep within that overall limit.
>
> Early versions of the persister had different controls, so perhaps
> that's what you remember.

Ok, so the cache is now governed by the overall memory limit.  Under
what circumstances will channel.flow be issued now?



From matthias at lshift.net  Sun Feb 28 00:16:24 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 28 Feb 2010 00:16:24 +0000
Subject: [rabbitmq-discuss] Set 21673 memory limit
In-Reply-To: <84fb38e31002271404m70d971b5je3c1249d95b152eb@mail.gmail.com>
References: <84fb38e31002261155n584b2268y4afedd33b5485f93@mail.gmail.com>	
	<4B8854E3.7030005@lshift.net>	
	<84fb38e31002271015x77b9575eqe0e665d47015b604@mail.gmail.com>	
	<4B898BB3.9040502@lshift.net>
	<84fb38e31002271404m70d971b5je3c1249d95b152eb@mail.gmail.com>
Message-ID: <4B89B5D8.6000001@lshift.net>

Tsuraan,

tsuraan wrote:
>> The above parameter sets an overall memory limit. The memory available
>> to queues is dynamically adjusted to keep within that overall limit.
> 
> Ok, so the cache is now governed by the overall memory limit.  Under
> what circumstances will channel.flow be issued now?

The persister pushes messages out to disk when memory gets tight, but 
disks aren't as fast as networks, so we still need the channel.flow 
mechanism to throttle producers and allow the persister to catch up.


Regards,

Matthias.



From tsuraan at gmail.com  Sun Feb 28 02:12:34 2010
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 27 Feb 2010 20:12:34 -0600
Subject: [rabbitmq-discuss] Set 21673 memory limit
In-Reply-To: <4B89B5D8.6000001@lshift.net>
References: <84fb38e31002261155n584b2268y4afedd33b5485f93@mail.gmail.com>
	<4B8854E3.7030005@lshift.net>
	<84fb38e31002271015x77b9575eqe0e665d47015b604@mail.gmail.com>
	<4B898BB3.9040502@lshift.net>
	<84fb38e31002271404m70d971b5je3c1249d95b152eb@mail.gmail.com>
	<4B89B5D8.6000001@lshift.net>
Message-ID: <84fb38e31002271812g345e1e35s5cc0639082f4bad3@mail.gmail.com>

> The persister pushes messages out to disk when memory gets tight, but
> disks aren't as fast as networks, so we still need the channel.flow
> mechanism to throttle producers and allow the persister to catch up.

Ok, that makes sense.  Thanks!



From mmistroni at gmail.com  Sun Feb 28 17:46:31 2010
From: mmistroni at gmail.com (Marco Mistroni)
Date: Sun, 28 Feb 2010 17:46:31 +0000
Subject: [rabbitmq-discuss] durable rabbitmq queues on server
Message-ID: <7e346e131002280946n35fb720fu3f6964b67b36a5a5@mail.gmail.com>

Hello all,
 is it possible to create queues on server that will not die at restart?
I wrote a basic rabbitmq client/server program in java, but i am getting
tired of creating a queue every time the program starts.
I'd rather create a queue on server which i can use every single time..

Now i know the philosophy of RabbitMQ Is different from traditional IBM MQ,
giving you more control over queues.. but
i guess every commercial RabbitMQ application will have a set of predefined
queues/exchanges, to which clients can connect for
producing or consuming messages..... rather than creating a queue every time
the application starts up...

And i want to avoid to write a basic application that i run only once and
that will create a durable queue......

Or am i missing the whole concept of AMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100228/ef07bae8/attachment.htm 

From pauljones23 at gmail.com  Sun Feb 28 19:17:00 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Sun, 28 Feb 2010 19:17:00 +0000
Subject: [rabbitmq-discuss] durable rabbitmq queues on server
In-Reply-To: <7e346e131002280946n35fb720fu3f6964b67b36a5a5@mail.gmail.com>
References: <7e346e131002280946n35fb720fu3f6964b67b36a5a5@mail.gmail.com>
Message-ID: <29598b611002281117i665ecc3aweb7af4898ef941c6@mail.gmail.com>

Hi Marco,

If you set the durable flag when you create a queue, it will persist even
through a broker restart.

If you want to maintain queues, exchanges and bindings outside the scope of
your application, you could try adding the BQL plugin (
http://www.rabbitmq.com/rabbitmq-bql.html)

Cheers,
Paul.

On Sun, Feb 28, 2010 at 5:46 PM, Marco Mistroni <mmistroni at gmail.com> wrote:

>
> Hello all,
>  is it possible to create queues on server that will not die at restart?
> I wrote a basic rabbitmq client/server program in java, but i am getting
> tired of creating a queue every time the program starts.
> I'd rather create a queue on server which i can use every single time..
>
> Now i know the philosophy of RabbitMQ Is different from traditional IBM MQ,
> giving you more control over queues.. but
> i guess every commercial RabbitMQ application will have a set of predefined
> queues/exchanges, to which clients can connect for
> producing or consuming messages..... rather than creating a queue every
> time the application starts up...
>
> And i want to avoid to write a basic application that i run only once and
> that will create a durable queue......
>
> Or am i missing the whole concept of AMQ
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100228/4b8622a2/attachment.htm 

