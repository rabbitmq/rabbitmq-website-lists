<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Frame generation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Frame%20generation&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000084.html">
   <LINK REL="Next"  HREF="000081.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Frame generation</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Frame%20generation&In-Reply-To="
       TITLE="[rabbitmq-discuss] Frame generation">0x6e6562 at gmail.com
       </A><BR>
    <I>Mon Jul 30 15:39:41 BST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000084.html">[rabbitmq-discuss] Javascript client
</A></li>
        <LI>Next message: <A HREF="000081.html">[rabbitmq-discuss] Frame generation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#80">[ date ]</a>
              <a href="thread.html#80">[ thread ]</a>
              <a href="subject.html#80">[ subject ]</a>
              <a href="author.html#80">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I don't know whether this is a bug or not, but I think the encoding
for the start.connection_ok method may be wrong. The response field is
actually a table but is not being encoded as such. I've included a
patch for inspection. To provoke this problem, the use the following:

f() -&gt;
    rabbit_binary_generator:build_simple_method_frame(1, start_ok() ),

start_ok() -&gt;
    #'connection.start_ok'{
		client_properties = [
                            {&lt;&lt;&quot;product&quot;&gt;&gt;,longstr,&lt;&lt;&quot;Erlang-AMQC&quot;&gt;&gt;},
                            {&lt;&lt;&quot;version&quot;&gt;&gt;,longstr,&lt;&lt;&quot;0.1&quot;&gt;&gt;},
                            {&lt;&lt;&quot;platform&quot;&gt;&gt;,longstr,&lt;&lt;&quot;Erlang&quot;&gt;&gt;}
							],
        mechanism = &lt;&lt;&quot;AMQPLAIN&quot;&gt;&gt;,
        response = [
                    {&lt;&lt;&quot;LOGIN&quot;&gt;&gt;, longstr, &lt;&lt;&quot;a&quot;&gt;&gt; },
                    {&lt;&lt;&quot;PASSWORD&quot;&gt;&gt;, longstr, &lt;&lt;&quot;a&quot;&gt;&gt; }
                    ],
        locale = &lt;&lt;&quot;en_US&quot;&gt;&gt;
	}.

BTW, is there a bug database for rabbit rather than posting to the list?

HTH,

Ben

-------

diff -r fb6ff292558d src/rabbit_framing.erl
--- a/src/rabbit_framing.erl    Sun Jul 29 14:09:25 2007 +0100
+++ b/src/rabbit_framing.erl    Mon Jul 30 15:34:06 2007 +0100
@@ -1355,9 +1355,10 @@ encode_method_fields(#'connection.start_
   F0Tab = rabbit_binary_generator:generate_table(F0),
   F0Len = size(F0Tab),
   F1Len = size(F1),
-  F2Len = size(F2),
+  F2Tab = rabbit_binary_generator:generate_table(F2),
+  F2Len = size(F2Tab),
   F3Len = size(F3),
-  &lt;&lt;F0Len:32/unsigned, F0Tab:F0Len/binary, F1Len:8/unsigned,
F1:F1Len/binary, F2Len:32/unsigned, F2:F2Len/binary, F3Len:8/unsigned,
F3:F3Len/binary&gt;&gt;;
+  &lt;&lt;F0Len:32/unsigned, F0Tab:F0Len/binary, F1Len:8/unsigned,
F1:F1Len/binary, F2Len:32/unsigned, F2Tab:F2Len/binary,
F3Len:8/unsigned, F3:F3Len/binary&gt;&gt;;
 encode_method_fields(#'connection.secure'{challenge = F0}) -&gt;
   F0Len = size(F0),
   &lt;&lt;F0Len:32/unsigned, F0:F0Len/binary&gt;&gt;;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000084.html">[rabbitmq-discuss] Javascript client
</A></li>
	<LI>Next message: <A HREF="000081.html">[rabbitmq-discuss] Frame generation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#80">[ date ]</a>
              <a href="thread.html#80">[ thread ]</a>
              <a href="subject.html#80">[ subject ]</a>
              <a href="author.html#80">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
