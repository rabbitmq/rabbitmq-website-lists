<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Implementing an RPC backend
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Implementing%20an%20RPC%20backend&In-Reply-To=269388e30707080213x65f3ef1cl28bf27c045915caf%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000015.html">
   <LINK REL="Next"  HREF="000018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Implementing an RPC backend</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Implementing%20an%20RPC%20backend&In-Reply-To=269388e30707080213x65f3ef1cl28bf27c045915caf%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Implementing an RPC backend">matthias at lshift.net
       </A><BR>
    <I>Sun Jul  8 10:22:23 BST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000015.html">[rabbitmq-discuss] Implementing an RPC backend
</A></li>
        <LI>Next message: <A HREF="000018.html">[rabbitmq-discuss] Implementing an RPC backend
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16">[ date ]</a>
              <a href="thread.html#16">[ thread ]</a>
              <a href="subject.html#16">[ subject ]</a>
              <a href="author.html#16">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ben,

&quot;Ben Hood&quot; &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt; writes:

&gt;&gt;<i> I suspect that in the 1.0.0-alpha client the above results in a
</I>&gt;&gt;<i> deadlock. A thread dump should tell you whether that is the case.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One way to get around the deadlock is to let handleDelivery push
</I>&gt;&gt;<i> requests onto a Java queue, and process that from a different
</I>&gt;&gt;<i> thread.
</I>&gt;<i>
</I>&gt;<i> OK, I'll have a look.
</I>
This may be a red herring. I think it's only RPCs that should be avoided
inside handleDelivery, and basicPublish isn't an RPC. Also, your tests
seem to indicate that the reply does actually reach the server, and
fails at the routing stage.

&gt;<i> I debugged the route method in rabbit_exchange, which does a mnesia
</I>&gt;<i> lookup of the replyTo routing key:
</I>&gt;<i>
</I>&gt;<i> Handlers = case rabbit_misc:clean_read({binding, BindingKey}) of
</I>&gt;<i> 		   {error, not_found} -&gt;
</I>&gt;<i> 		       handlers_for_missing_binding_record(X, RoutingKey);
</I>&gt;<i> 		   {ok, #binding{handlers = H}} -&gt;
</I>&gt;<i> 		       H
</I>&gt;<i> 	       end,
</I>&gt;<i>
</I>&gt;<i> This returns [], so it seems to be at that point that the message is
</I>&gt;<i> unroutable. I found this last night, so I'll have a look to see what
</I>&gt;<i> the contents of the binding table in mnesia is. I tried initially with
</I>&gt;<i> TV, but it's difficult to see the actual content with that. I'll try
</I>&gt;<i> using the API.
</I>
I find mnesia:dump_to_textfile/1 quite useful in debugging this sort of
problem.

&gt;&gt;<i> The next version of the client API has a QueuingConsumer class
</I>&gt;&gt;<i> for that purpose, and is generally less prone to deadlocks.
</I>&gt;<i>
</I>&gt;<i> Is any of this code available in a repository?
</I>
No, but the new release will be out soon.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000015.html">[rabbitmq-discuss] Implementing an RPC backend
</A></li>
	<LI>Next message: <A HREF="000018.html">[rabbitmq-discuss] Implementing an RPC backend
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16">[ date ]</a>
              <a href="thread.html#16">[ thread ]</a>
              <a href="subject.html#16">[ subject ]</a>
              <a href="author.html#16">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
