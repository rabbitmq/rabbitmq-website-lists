<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Multiple consumers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Multiple%20consumers&In-Reply-To=lyejjhledi.fsf%40tanto.lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000040.html">
   <LINK REL="Next"  HREF="000046.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Multiple consumers</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Multiple%20consumers&In-Reply-To=lyejjhledi.fsf%40tanto.lshift.net"
       TITLE="[rabbitmq-discuss] Multiple consumers">0x6e6562 at gmail.com
       </A><BR>
    <I>Thu Jul 19 23:35:43 BST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000040.html">[rabbitmq-discuss] Multiple consumers
</A></li>
        <LI>Next message: <A HREF="000046.html">[rabbitmq-discuss] Multiple consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45">[ date ]</a>
              <a href="thread.html#45">[ thread ]</a>
              <a href="subject.html#45">[ subject ]</a>
              <a href="author.html#45">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,

&gt;<i> No. The code base is fairly small, so it won't bee too much of a burden
</I>&gt;<i> to carry forward any changes in this area. I just wanted to alert you to
</I>&gt;<i> the fact that the APIs will definitely change.
</I>
Sorry, its taken a while but I've been otherwise busy. I've made a
first cut of an erlang client AMQP with the necessary changes in
rabbit_reader, rabbit_channel0 and rabbit_channel (see attached
patch).

This patch is not complete, but I wanted to submit it for a sanity
check before I go off down the garden path.

The change consists of

1. an amqp_client module, which exports a similar API to the Java API.
The implementation uses the rabbit native API sparingly, in fact, the
call to any concrete rabbit function could be a init parameter making
it totally rabbit agnostic at compile time. It sends AMQP methods as
standard erlang messages, but it could be further abstracted to be
able to add framing if one wanted to connect to a foreign AMQP server
via TCP (should the need arise). At the moment this also includes some
preprocessor definitions from rabbit.hrl and rabbit_framing.hrl, but
these are AMQP specific and could be refactored away as well.

2. Changes to the rabbit_reader, rabbit_channel0 and rabbit_channel
modules to bypass socket I/O and framing. I've tried to keep the
amount of code duplication to a bar minimum.

To use it you load amqp_client into the same VM as rabbit, then

1. amqp_client:start_link().
2. amqp_client:open_channel(1, &quot;&quot;).
3. amqp_client:access_request(1, &quot;/data/REALM_NAME&quot;).

And that's where I stopped before this sanity check, but I would go on
in the same vain with the rest of the protocol.

The amqp_client uses the gen_server behaviour so that it can maintain
protocol state as well as the state of channel pids, user creditials
and tickets.

Also, the error handling is still quite agricultural (exits need to be
trapped) and the client lifecycle needs some thought as well (e.g. how
to stop it cleanly).

Anyway, any suggestions would be greatly appreciated,

Ben
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erlang_client_1.patch
Type: application/octet-stream
Size: 19242 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20070719/24a97075/attachment.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20070719/24a97075/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000040.html">[rabbitmq-discuss] Multiple consumers
</A></li>
	<LI>Next message: <A HREF="000046.html">[rabbitmq-discuss] Multiple consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45">[ date ]</a>
              <a href="thread.html#45">[ thread ]</a>
              <a href="subject.html#45">[ subject ]</a>
              <a href="author.html#45">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
