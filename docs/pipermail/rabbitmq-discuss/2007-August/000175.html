<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [Fwd: Re: basic.consume filter arg [was: Re:	AMQP v0-9]]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BFwd%3A%20Re%3A%20basic.consume%20filter%20arg%20%5Bwas%3A%20Re%3A%0A%09AMQP%20v0-9%5D%5D&In-Reply-To=99e30fe50708280944g72781bfcn301ea4debec60913%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000184.html">
   <LINK REL="Next"  HREF="000176.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [Fwd: Re: basic.consume filter arg [was: Re:	AMQP v0-9]]</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BFwd%3A%20Re%3A%20basic.consume%20filter%20arg%20%5Bwas%3A%20Re%3A%0A%09AMQP%20v0-9%5D%5D&In-Reply-To=99e30fe50708280944g72781bfcn301ea4debec60913%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] [Fwd: Re: basic.consume filter arg [was: Re:	AMQP v0-9]]">matthias at lshift.net
       </A><BR>
    <I>Tue Aug 28 18:35:49 BST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000184.html">[rabbitmq-discuss] Erlang AMQP Client?
</A></li>
        <LI>Next message: <A HREF="000176.html">[rabbitmq-discuss] [Fwd: Re: basic.consume filter arg [was: Re: AMQP v0-9]]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#175">[ date ]</a>
              <a href="thread.html#175">[ thread ]</a>
              <a href="subject.html#175">[ subject ]</a>
              <a href="author.html#175">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Martin,

Martin Ritchie wrote:
&gt;<i> On 28/08/07, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt; wrote:
</I>&gt;&gt;<i> Will the flag also work for the python test suite?
</I>&gt;<i> 
</I>&gt;<i> I haven't done any development work on the Python.
</I>&gt;<i> I only implemented the flag for the Java Client suite so the python
</I>&gt;<i> may need to be rebuilt against a true 0_8 spec file.
</I>
That is fine, in a way, and is what we are doing now.

The problem though is, again, the confusion arising from the fact that 
the test suite pulls in the Qpid-modified 0-8 spec - both by default and 
when specifying &quot;0-8&quot; as the specfile. We have had complaints from 
people who ran the test suite that way against RabbitMQ and were 
surprised to see errors.

&gt;&gt;<i> What about the server side of things, i.e. ensuring that a client which
</I>&gt;&gt;<i> conforms to the official 0-8 spec can talk to a Qpid server? Looking at
</I>&gt;&gt;<i> the differences between the official spec and the one in the qpid source
</I>&gt;&gt;<i> tree, there are two places where interop will get broken if the server
</I>&gt;&gt;<i> is not constrained to official 0-8 behaviour:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - it must accept basic.consume messages without the filter arg
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - it must not send a basic.recover-ok response
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How are you planning to handle this?
</I>&gt;&gt;<i>
</I>&gt;<i> Indeed this will be an issue for interop. Currently the broker always
</I>&gt;<i> sends a recover-ok and from what I can see taking a brief look the
</I>&gt;<i> Consume method always reads the arguments field from the consume body.
</I>&gt;<i> What I guess that the Qpid C++ and .Net clients work correctly with
</I>&gt;<i> the Java broker as they all use the same spec file.
</I>&gt;<i> 
</I>&gt;<i> Unfortunately we are to late to make changes to the M2 release which
</I>&gt;<i> should be just as soon as we can get it voted through... though there
</I>&gt;<i> is an argument that this is a fairly major interop issue and a similar
</I>&gt;<i> STRICT_AMQP flag should be added to the Java M2 Broker to facility
</I>&gt;<i> AMQP interop. The changes wouldn't take much work so I've copied the
</I>&gt;<i> Qpid-Dev list in to see if they are happy to make this change for M2.
</I>
A flag would be good but is still far from ideal, for two reasons:

1) as I mentioned above, it causes all sorts of headaches for other 
implementations and users when an AMQP broker advertises support for 0-8 
during protocol negotiation but the departs from the spec in crucial 
areas that break interop at fairly low levels of the protocol.

2) the protocol flavour (i.e. official 0-8 vs Qpid-modified 0-8) should 
be settable on a per-connection basis. Otherwise, for example, you will 
not be able to connect to a Qpid broker with a non-Qpid client unless a) 
the broker was started with that flag, and b) all Qpid clients are 
started with that flag.

The cleanest solution to all the above would be to use a version number 
other than 0-8 for the Qpid-modified 0-8 protocol, and for the broker 
and clients to support both that and the official 0-8, and negotiate an 
appropriate fit. That is problematic though because there isn't room in 
the version numbering scheme for, say, a 0-8-1.

An alternative might be for the Qpid clients and servers to detect each 
other via the product info passed as part of connection negotiation. 
Then, when a Qpid client meets a Qpid broker they could automatically 
speak Qpid-modified 0-8 whereas when paired up with anything else they 
would revert to standard 0-8.


Regards,

Matthias
PS: I have copied the rabbitmq-discuss list, where this thread originated.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000184.html">[rabbitmq-discuss] Erlang AMQP Client?
</A></li>
	<LI>Next message: <A HREF="000176.html">[rabbitmq-discuss] [Fwd: Re: basic.consume filter arg [was: Re: AMQP v0-9]]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#175">[ date ]</a>
              <a href="thread.html#175">[ thread ]</a>
              <a href="subject.html#175">[ subject ]</a>
              <a href="author.html#175">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
