<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20BasicPublish%28%29%20from%20.NET%20client%20hangs%20after%0A%09upgrading%20server%20to%201.7.1&In-Reply-To=5429EF528F02C34281C8573452C749431AB4EEE994%40ca-win-mbs02.artesis.be">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006079.html">
   <LINK REL="Next"  HREF="006076.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1</H1>
    <B>Gustavo Aquino</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20BasicPublish%28%29%20from%20.NET%20client%20hangs%20after%0A%09upgrading%20server%20to%201.7.1&In-Reply-To=5429EF528F02C34281C8573452C749431AB4EEE994%40ca-win-mbs02.artesis.be"
       TITLE="[rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1">aquino.gustavo at gmail.com
       </A><BR>
    <I>Thu Jan 28 15:07:21 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006079.html">[rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1
</A></li>
        <LI>Next message: <A HREF="006076.html">[rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6074">[ date ]</a>
              <a href="thread.html#6074">[ thread ]</a>
              <a href="subject.html#6074">[ subject ]</a>
              <a href="author.html#6074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glenn,

Are you sending a lot of messages ?, this source code that you post here are
in one class that are created all time that you send a new message ?

Because a lot of memory will be consumed if all the time you create
connection and forgot it there like you show your source, if it is your case
just open one connection and reuse the Rabbit Object connection, doing it
you will use a little memory and will increase performance of your
application.

If you get the example source coming with RabbitMQ.Net and just put one loop
to send a lot of messages you will get the same error reported.

Regards.



On Thu, Jan 28, 2010 at 11:32 AM, Ergeerts Glenn
&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">glenn.ergeerts at artesis.be</A>&gt;wrote:

&gt;<i> I have 4GB of RAM.
</I>&gt;<i> I tried running the command however it failed with
</I>&gt;<i> ** exception error: undefined function vm_memory_monitor:get_total_memory/0
</I>&gt;<i>
</I>&gt;<i> I'm new to rabbitMQ/erlang so I'm probably doing something wrong here.
</I>&gt;<i> (I set the environment variable, ran rabbitmq-server.bat, opened the erlang
</I>&gt;<i> emulator and typed in the command.)
</I>&gt;<i>
</I>&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;<i> Van: majek04 [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">majek04 at gmail.com</A>]
</I>&gt;<i> Verzonden: donderdag 28 januari 2010 14:14
</I>&gt;<i> Aan: Ergeerts Glenn
</I>&gt;<i> CC: Matthias Radestock; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs
</I>&gt;<i> after upgrading server to 1.7.1
</I>&gt;<i>
</I>&gt;<i> Sorry for that, my gmail decided to send email before I was done.
</I>&gt;<i>
</I>&gt;<i> So, I would be also interested in the output of
</I>&gt;<i> vm_memory_monitor:get_total_memory()
</I>&gt;<i> on your macine. Can I ask you to open erlang shell and type this command?
</I>&gt;<i>  (<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at debian</A>)2&gt; vm_memory_monitor:get_total_memory().
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; As a temporary workaround I can suggest setting
</I>&gt;<i> 'vm_memory_high_watermark' to 0,
</I>&gt;<i> &gt; which will effectively disable memory based flow control. You can do
</I>&gt;<i> &gt; it by adding
</I>&gt;<i> &gt; this line to erl parameters in rabbitmq-server:
</I>&gt;<i> &gt;    -rabbit vm_memory_high_watermark 0 \
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Alternatively you can set that variable in rabbitmq.config. There's an
</I>&gt;<i> &gt; example in docs:
</I>&gt;<i> &gt;  <A HREF="http://www.rabbitmq.com/extensions.html#memsup">http://www.rabbitmq.com/extensions.html#memsup</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Thu, Jan 28, 2010 at 12:53, Ergeerts Glenn &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">glenn.ergeerts at artesis.be</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt; It Looks like there is a problem indeed.. This is in rabbit.log after
</I>&gt;<i> starting:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; =INFO REPORT==== 28-Jan-2010::13:46:39 ===
</I>&gt;<i> &gt;&gt; Memory limit set to 0MB.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; =INFO REPORT==== 28-Jan-2010::13:46:39 ===
</I>&gt;<i> &gt;&gt; vm_memory_high_watermark set. Memory used:5285360 allowed:-663552
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; =INFO REPORT==== 28-Jan-2010::13:46:39 ===
</I>&gt;<i> &gt;&gt;    alarm_handler: {set,{vm_memory_high_watermark,[]}}
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I tried manually setting the memory limit using the config file and the
</I>&gt;<i> link you provided (I was using an empty config before),
</I>&gt;<i> &gt;&gt; but it doesn't seem to change anything, still the same output. I'm
</I>&gt;<i> probably doing something wrong here..
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; About the startup script: it is the 1.7.1 script indeed. The error i get
</I>&gt;<i> is:
</I>&gt;<i> &gt;&gt; \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at
</I>&gt;<i> this time.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I'm running on windows 7 64bit.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Regards,
</I>&gt;<i> &gt;&gt; Glenn
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; -----Oorspronkelijk bericht-----
</I>&gt;<i> &gt;&gt; Van: Matthias Radestock [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>]
</I>&gt;<i> &gt;&gt; Verzonden: donderdag 28 januari 2010 12:40
</I>&gt;<i> &gt;&gt; Aan: Ergeerts Glenn
</I>&gt;<i> &gt;&gt; CC: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs
</I>&gt;<i> after upgrading server to 1.7.1
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Glenn,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; glenner wrote:
</I>&gt;<i> &gt;&gt;&gt; After upgrading the server to 1.7.1 my client hangs forever on the
</I>&gt;<i> &gt;&gt;&gt; BasicPublish() line using the following code.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; That's probably due to the improved memory monitoring telling the
</I>&gt;<i> &gt;&gt; producers to pause in order to prevent the server from running out of
</I>&gt;<i> &gt;&gt; memory. Do you see any alarms in the rabbit.log?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; See <A HREF="http://www.rabbitmq.com/extensions.html#memsup">http://www.rabbitmq.com/extensions.html#memsup</A> for instructions on
</I>&gt;<i> &gt;&gt; how to adjust the memory limits.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Another unrelated issue: i had to add quotes to the following line in
</I>&gt;<i> &gt;&gt;&gt; rabbitmq-server.bat to get the script running:
</I>&gt;<i> &gt;&gt;&gt;     set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; changed to :    set RABBITMQ_BOOT_FILE=&quot;%RABBITMQ_EBIN_ROOT%\rabbit&quot;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Really? Even in the 1.7.1 script? What error do you get?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Regards,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Matthias.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/86e1dffe/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/86e1dffe/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006079.html">[rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1
</A></li>
	<LI>Next message: <A HREF="006076.html">[rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6074">[ date ]</a>
              <a href="thread.html#6074">[ thread ]</a>
              <a href="subject.html#6074">[ subject ]</a>
              <a href="author.html#6074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
