<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consuming from multiple queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Consuming%20from%20multiple%20queues&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006061.html">
   <LINK REL="Next"  HREF="006050.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consuming from multiple queues</H1>
    <B>Ilya Sterin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Consuming%20from%20multiple%20queues&In-Reply-To="
       TITLE="[rabbitmq-discuss] Consuming from multiple queues">sterini at gmail.com
       </A><BR>
    <I>Tue Jan 26 22:17:36 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006061.html">[rabbitmq-discuss] syntax and semantics of basic content	'expiration' field?
</A></li>
        <LI>Next message: <A HREF="006050.html">[rabbitmq-discuss] Consuming from multiple queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6049">[ date ]</a>
              <a href="thread.html#6049">[ thread ]</a>
              <a href="subject.html#6049">[ subject ]</a>
              <a href="author.html#6049">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a rather standard publish/subscriber architecture, where
publisher publishes messages into numerous queues.  Queues store
distinct message types.

The consumer currently connects to a single queue and processes these
messages.  I spin off multiple consumers, so each queue has at least
one consumer bound and awaiting messages.  A consumer is a distinct
thread, though say if I have 10 threads listening on a queue, these
threads are all blocking even though no deliveries are made to this
queue.

Although these threads are in wait mode and due not utilize any CPU,
I'd much prefer to put them to use.  So my question is, how can a
single consumer listen to multiple queues and process messages as they
arrive on either of the queues.  I don't care about the distinction
between queues on the consumer side, but I do on the producer side as
well as for other monitoring purposes.

I currently have something in the likes of... (I picked out bits and
pieces from my abstraction, so I might of missed something here)

############
Channel channel = conn.createChannel();
QueueingConsumer consumer = new QueueingConsumer(channel);
channel.basicConsume(queueName, false, consumer);

while (!Thread.currentThread().isInterrupted()) {
      QueueingConsumer.Delivery delivery;
      try {
        delivery = consumer.nextDelivery();
      }
      catch (InterruptedException e) {
        LOG.warn(&quot;Thread interrupted: &quot;, e);
        channel =
cleanupAndReestablishConnectionsFor(delivery.getProperties().get);
        continue;
      }
      .... do something with message and acknowledge it if OK
}

#############

I can't seem to find documentation related to this.  Is this possible?

Thanks.

Ilya


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006061.html">[rabbitmq-discuss] syntax and semantics of basic content	'expiration' field?
</A></li>
	<LI>Next message: <A HREF="006050.html">[rabbitmq-discuss] Consuming from multiple queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6049">[ date ]</a>
              <a href="thread.html#6049">[ thread ]</a>
              <a href="subject.html#6049">[ subject ]</a>
              <a href="author.html#6049">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
