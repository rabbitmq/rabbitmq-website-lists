<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] MulticastMain Java client causes Erlang	error eheap_alloc: Cannot allocate 467078560 bytes of memory	(of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20MulticastMain%20Java%20client%20causes%20Erlang%0A%09error%20eheap_alloc%3A%20Cannot%20allocate%20467078560%20bytes%20of%20memory%0A%09%28of%20type%20%22heap%22%29%20%28with%20RabbitMQ%201.7.1%29&In-Reply-To=4B5F0C63.3060806%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006034.html">
   <LINK REL="Next"  HREF="006041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] MulticastMain Java client causes Erlang	error eheap_alloc: Cannot allocate 467078560 bytes of memory	(of type &quot;heap&quot;) (with RabbitMQ 1.7.1)</H1>
    <B>John Apps</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20MulticastMain%20Java%20client%20causes%20Erlang%0A%09error%20eheap_alloc%3A%20Cannot%20allocate%20467078560%20bytes%20of%20memory%0A%09%28of%20type%20%22heap%22%29%20%28with%20RabbitMQ%201.7.1%29&In-Reply-To=4B5F0C63.3060806%40lshift.net"
       TITLE="[rabbitmq-discuss] MulticastMain Java client causes Erlang	error eheap_alloc: Cannot allocate 467078560 bytes of memory	(of type &quot;heap&quot;) (with RabbitMQ 1.7.1)">johndapps at gmail.com
       </A><BR>
    <I>Tue Jan 26 17:46:45 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006034.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
        <LI>Next message: <A HREF="006041.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6039">[ date ]</a>
              <a href="thread.html#6039">[ thread ]</a>
              <a href="subject.html#6039">[ subject ]</a>
              <a href="author.html#6039">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,

Here you go:
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
Memory limit set to 817MB.
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
disk_log: repairing
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/ra
bbit_persister.LOG&quot; ...
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
Repaired persister log - 1 recovered, 0 bad
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
Rolling persister log to
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous&quot;
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
started TCP Listener on 0.0.0.0:5672
=INFO REPORT==== 26-Jan-2010::17:57:07 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:39913
=INFO REPORT==== 26-Jan-2010::17:57:07 ===
starting TCP connection &lt;0.150.0&gt; from 127.0.0.1:39913
=INFO REPORT==== 26-Jan-2010::17:57:07 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:39914
=INFO REPORT==== 26-Jan-2010::17:57:07 ===
starting TCP connection &lt;0.156.0&gt; from 127.0.0.1:39914
=INFO REPORT==== 26-Jan-2010::17:57:51 ===
vm_memory_high_watermark set. Memory used:1002985248 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:57:51 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:57:52 ===
vm_memory_high_watermark clear. Memory used:684715512 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:57:52 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:04 ===
vm_memory_high_watermark set. Memory used:1066534848 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:04 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:05 ===
vm_memory_high_watermark clear. Memory used:772812808 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:05 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:06 ===
vm_memory_high_watermark set. Memory used:1264119968 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:06 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:08 ===
vm_memory_high_watermark clear. Memory used:739226624 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:08 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:11 ===
vm_memory_high_watermark set. Memory used:890590656 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:11 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:13 ===
vm_memory_high_watermark clear. Memory used:766122704 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:13 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:14 ===
vm_memory_high_watermark set. Memory used:890671408 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:14 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:17 ===
vm_memory_high_watermark clear. Memory used:776145328 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:17 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:18 ===
vm_memory_high_watermark set. Memory used:1300245088 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:18 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:21 ===
vm_memory_high_watermark clear. Memory used:784244032 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:21 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:22 ===
vm_memory_high_watermark set. Memory used:902589440 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:22 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:27 ===
vm_memory_high_watermark clear. Memory used:791158912 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:27 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:28 ===
vm_memory_high_watermark set. Memory used:918087056 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:28 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:34 ===
vm_memory_high_watermark clear. Memory used:800483800 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:34 ===

    alarm_handler: {clear,vm_memory_high_watermark}
The above log is from a run with 0.2 memory on a 4GB machine running Windows
7 X64. This is the first time I have seen the messages about memory high
watermark.

The attached image is a screen shot from the task manager showing the Erl
statistics right when it crashed using memory of .02. Not sure if it helps,
but hope so...

The following log is from a run with memory set to 0.3:
=INFO REPORT==== 26-Jan-2010::18:15:09 ===
Memory limit set to 1225MB.
=INFO REPORT==== 26-Jan-2010::18:15:09 ===
disk_log: repairing
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/ra
bbit_persister.LOG&quot; ...
=INFO REPORT==== 26-Jan-2010::18:15:09 ===
Repaired persister log - 1 recovered, 0 bad
=INFO REPORT==== 26-Jan-2010::18:15:09 ===
Rolling persister log to
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous&quot;
=INFO REPORT==== 26-Jan-2010::18:15:10 ===
started TCP Listener on 0.0.0.0:5672
=INFO REPORT==== 26-Jan-2010::18:15:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:40341
=INFO REPORT==== 26-Jan-2010::18:15:13 ===
starting TCP connection &lt;0.143.0&gt; from 127.0.0.1:40341
=INFO REPORT==== 26-Jan-2010::18:15:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:40342
INFO REPORT==== 26-Jan-2010::18:15:13 ===
starting TCP connection &lt;0.149.0&gt; from 127.0.0.1:40342

Last test was to run with 0.1 memory. This did not get very far and is now
hanging. The client managed only a few exchanges:

here we go at 18:23:03.19 2010-01-26
starting consumer #0
starting producer #0
sending rate: 11398 msg/s
sending rate: 10602 msg/s
sending rate: 6831 msg/s
sending rate: 2148 msg/s

The rabbit.log for the 0.1 memory run is attached.

Cheers, John
On Tue, Jan 26, 2010 at 16:38, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt;wrote:

&gt;<i> John,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> John Apps wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> This is rabbit.log after starting the server:
</I>&gt;&gt;<i> =INFO REPORT==== 26-Jan-2010::16:09:34 ===
</I>&gt;&gt;<i> Memory limit set to 1634MB.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Does that figure seem reasonable? How much physical memory and swap do you
</I>&gt;<i> have? And do you have other processes running that could be eating into
</I>&gt;<i> that?
</I>&gt;<i>
</I>&gt;<i> Basically, you need to make sure that the above figure is well below (&lt;40%)
</I>&gt;<i> the amount of memory the rabbit process can safely ask for from the O/S.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  =INFO REPORT==== 26-Jan-2010::16:09:34 ===
</I>&gt;&gt;<i> Rolling persister log to
</I>&gt;&gt;<i> &quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/db/rabbit-mnesi
</I>&gt;&gt;<i> a/rabbit_persister.LOG.previous&quot;
</I>&gt;&gt;<i> =INFO REPORT==== 26-Jan-2010::16:09:35 ===
</I>&gt;&gt;<i> started TCP Listener on 0.0.0.0:5672
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Have you got the rest of that log file?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i> PS: no need to attach further crash dumps.
</I>&gt;<i>
</I>


-- 
---
John Apps
(49) 171 869 1813
Sent from Traunstein, Bavaria, Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.htm</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl (2).png
Type: image/png
Size: 100288 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.png">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.png</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BIGPOOH.log
Type: application/octet-stream
Size: 3963 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006034.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
	<LI>Next message: <A HREF="006041.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6039">[ date ]</a>
              <a href="thread.html#6039">[ thread ]</a>
              <a href="subject.html#6039">[ subject ]</a>
              <a href="author.html#6039">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
