<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Poor%20performance%20using%20a%20single%20RabbitMQ%0A%09connection%20on%20high-latency%20networks&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006107.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks</H1>
    <B>Holger Hoffstaette</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Poor%20performance%20using%20a%20single%20RabbitMQ%0A%09connection%20on%20high-latency%20networks&In-Reply-To="
       TITLE="[rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks">holger.hoffstaette at googlemail.com
       </A><BR>
    <I>Sat Jan 30 21:38:58 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006107.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6108">[ date ]</a>
              <a href="thread.html#6108">[ thread ]</a>
              <a href="subject.html#6108">[ subject ]</a>
              <a href="author.html#6108">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 30 Jan 2010 20:24:35 +0300, Vladimir Balandin wrote:

&gt;<i> We are using single connection as recommended in RabbitMQ FAQ. It is work
</I>&gt;<i> fine in LAN but we have problems with WAN and high latency. RabbitMQ
</I>&gt;<i> client send packets (packet size is 64 kB) too slow. We have installed
</I>&gt;<i> RabbitMQ at remote server with ping from RabbitMQ client about 150-200 ms.
</I>&gt;<i> Each basicPublish call require about 3 seconds to complete. So we have a
</I>&gt;<i> throughput is about 20 kB/s. Increasing channel numbers does not affect
</I>&gt;<i> performance. If we use two or more connections performance is increase
</I>&gt;<i> linear, but it is not acceptable for us. We are unable to use so many
</I>&gt;<i> connections that required to arrive full bandwidth usage. Is it possible
</I>&gt;<i> to increase throughput using a single TCP connection?
</I>
Multiple connections are one way to help here; keep them in mind as an
option even if you don't want to open the full number of connections to
saturate your bandwidth.

Another thing to try is to increase the TCP send/receive buffers (and
therefore the negotiated TCP transmit windows) on the client.
Depending on the client's OS the default values of the TCP stack may or
may not be way too small for a connection with high latency. For example
they are outright pitiful on Windows XP.

An appropriate place would be to override (using the Java client as
example here) ConnectionFactory.configureSocket() and add the necessary
bits like setSend/ReceiveBufferSize etc. Usual values to try first are in
the range from 64k to 256k.

This should help. The behaviour with multiple channels will likely also be
improved. Changing the send/receive buffers on the broker side should not
be necessary, as the buffers are negotiated by the client.

Holger




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006107.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6108">[ date ]</a>
              <a href="thread.html#6108">[ thread ]</a>
              <a href="subject.html#6108">[ subject ]</a>
              <a href="author.html#6108">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
