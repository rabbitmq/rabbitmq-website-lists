<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] MulticastMain Java client causes Erlang	error eheap_alloc: Cannot allocate 467078560 bytes of memory	(of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20MulticastMain%20Java%20client%20causes%20Erlang%0A%09error%20eheap_alloc%3A%20Cannot%20allocate%20467078560%20bytes%20of%20memory%0A%09%28of%20type%20%22heap%22%29%20%28with%20RabbitMQ%201.7.1%29&In-Reply-To=4B5F3059.8060006%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006041.html">
   <LINK REL="Next"  HREF="006044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] MulticastMain Java client causes Erlang	error eheap_alloc: Cannot allocate 467078560 bytes of memory	(of type &quot;heap&quot;) (with RabbitMQ 1.7.1)</H1>
    <B>John Apps</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20MulticastMain%20Java%20client%20causes%20Erlang%0A%09error%20eheap_alloc%3A%20Cannot%20allocate%20467078560%20bytes%20of%20memory%0A%09%28of%20type%20%22heap%22%29%20%28with%20RabbitMQ%201.7.1%29&In-Reply-To=4B5F3059.8060006%40lshift.net"
       TITLE="[rabbitmq-discuss] MulticastMain Java client causes Erlang	error eheap_alloc: Cannot allocate 467078560 bytes of memory	(of type &quot;heap&quot;) (with RabbitMQ 1.7.1)">johndapps at gmail.com
       </A><BR>
    <I>Tue Jan 26 18:32:51 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006041.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
        <LI>Next message: <A HREF="006044.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6042">[ date ]</a>
              <a href="thread.html#6042">[ thread ]</a>
              <a href="subject.html#6042">[ subject ]</a>
              <a href="author.html#6042">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here are two runs, one with 0.4 and the other, below, with 0.3. Both crash.
The rabbit.log for the 0.3 test is attached. The 0.4 test did not log any
memory watermark messages, only the 0.3 test.
The page file on this machine is 8GB with a maximum size of 16GB.
_________________________________________________
The client:
here we go at 19:16:49.49 2010-01-26
starting consumer #0
starting producer #0
sending rate: 11280 msg/s
sending rate: 10228 msg/s
sending rate: 10017 msg/s
sending rate: 10069 msg/s
sending rate: 9613 msg/s
...
...Crash
...
The server with 0.4 memory:
eheap_alloc: Cannot allocate 298930300 bytes of memory (of type &quot;heap&quot;).
=INFO REPORT==== 26-Jan-2010::19:16:46 ===
Memory limit set to 1634MB.

=INFO REPORT==== 26-Jan-2010::19:16:46 ===
disk_log: repairing
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/rabbit_persister.LOG&quot;
...

=INFO REPORT==== 26-Jan-2010::19:16:46 ===
Repaired persister log - 1 recovered, 0 bad

=INFO REPORT==== 26-Jan-2010::19:16:46 ===
Rolling persister log to
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/rabbit_persister.LOG.previous&quot;

=INFO REPORT==== 26-Jan-2010::19:16:46 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 26-Jan-2010::19:16:49 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:42109

=INFO REPORT==== 26-Jan-2010::19:16:49 ===
starting TCP connection &lt;0.143.0&gt; from 127.0.0.1:42109

=INFO REPORT==== 26-Jan-2010::19:16:49 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:42110

=INFO REPORT==== 26-Jan-2010::19:16:49 ===
starting TCP connection &lt;0.149.0&gt; from 127.0.0.1:42110
______________________________________________________________
This is with 0.3 memory:
=INFO REPORT==== 26-Jan-2010::19:22:09 ===
Memory limit set to 1225MB.

=INFO REPORT==== 26-Jan-2010::19:22:09 ===
disk_log: repairing
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/rabbit_persister.LOG&quot;
...

=INFO REPORT==== 26-Jan-2010::19:22:09 ===
Repaired persister log - 1 recovered, 0 bad

=INFO REPORT==== 26-Jan-2010::19:22:09 ===
Rolling persister log to
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/rabbit_persister.LOG.previous&quot;

=INFO REPORT==== 26-Jan-2010::19:22:10 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 26-Jan-2010::19:22:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:42320

=INFO REPORT==== 26-Jan-2010::19:22:13 ===
starting TCP connection &lt;0.143.0&gt; from 127.0.0.1:42320

=INFO REPORT==== 26-Jan-2010::19:22:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:42321

=INFO REPORT==== 26-Jan-2010::19:22:13 ===
starting TCP connection &lt;0.149.0&gt; from 127.0.0.1:42321

___________________________________________________
here we go at 19:25:50.62 2010-01-26
starting consumer #0
starting producer #0
sending rate: 11216 msg/s
sending rate: 11214 msg/s
sending rate: 10332 msg/s
sending rate: 9481 msg/s
sending rate: 7449 msg/s
sending rate: 6095 msg/s
sending rate: 3217 msg/s
sending rate: 998 msg/s
...
...crash
...
temp_alloc: Cannot allocate 197209248 bytes of memory (of type &quot;tmp_heap&quot;).

Log file is attached.

________________________
*&gt;&gt;&gt;That's exactly what is supposed to happen. Rabbit has told the producer
to stop sending messages since it is under memory pressure. Once memory
becomes available again, e.g. when a consumer consumes enough messages, or
some queues get deleted/purged, or as a result of internal garbage
collection, Rabbit will tell the producer that it may resume.
*

The funny thing is that rabbitmqctl status returned a 'node down' message. I
suppose that is OK?
_______________

Cheers, John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/0225ebf1/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/0225ebf1/attachment.htm</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BIGPOOH.log
Type: application/octet-stream
Size: 4995 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/0225ebf1/attachment.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/0225ebf1/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006041.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
	<LI>Next message: <A HREF="006044.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6042">[ date ]</a>
              <a href="thread.html#6042">[ thread ]</a>
              <a href="subject.html#6042">[ subject ]</a>
              <a href="author.html#6042">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
