<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20BasicPublish%28%29%20from%20.NET%20client%20hangs%20after%0A%20upgrading%20server%20to%201.7.1&In-Reply-To=5ef296b31001280707r55b6f009kd8fc1911d442daa3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006074.html">
   <LINK REL="Next"  HREF="006083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1</H1>
    <B>Ergeerts Glenn</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20BasicPublish%28%29%20from%20.NET%20client%20hangs%20after%0A%20upgrading%20server%20to%201.7.1&In-Reply-To=5ef296b31001280707r55b6f009kd8fc1911d442daa3%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1">glenn.ergeerts at artesis.be
       </A><BR>
    <I>Thu Jan 28 15:27:15 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006074.html">[rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1
</A></li>
        <LI>Next message: <A HREF="006083.html">[rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6076">[ date ]</a>
              <a href="thread.html#6076">[ thread ]</a>
              <a href="subject.html#6076">[ subject ]</a>
              <a href="author.html#6076">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>No, i am only sending 1 message

Van: Gustavo Aquino [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aquino.gustavo at gmail.com</A>]
Verzonden: donderdag 28 januari 2010 16:07
Aan: Ergeerts Glenn
CC: majek04; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

Glenn,

Are you sending a lot of messages ?, this source code that you post here are in one class that are created all time that you send a new message ?

Because a lot of memory will be consumed if all the time you create connection and forgot it there like you show your source, if it is your case just open one connection and reuse the Rabbit Object connection, doing it you will use a little memory and will increase performance of your application.

If you get the example source coming with RabbitMQ.Net and just put one loop to send a lot of messages you will get the same error reported.

Regards.


On Thu, Jan 28, 2010 at 11:32 AM, Ergeerts Glenn &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">glenn.ergeerts at artesis.be</A>&lt;mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">glenn.ergeerts at artesis.be</A>&gt;&gt; wrote:
I have 4GB of RAM.
I tried running the command however it failed with
** exception error: undefined function vm_memory_monitor:get_total_memory/0

I'm new to rabbitMQ/erlang so I'm probably doing something wrong here.
(I set the environment variable, ran rabbitmq-server.bat, opened the erlang emulator and typed in the command.)

-----Oorspronkelijk bericht-----
Van: majek04 [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">majek04 at gmail.com</A>&lt;mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">majek04 at gmail.com</A>&gt;]
Verzonden: donderdag 28 januari 2010 14:14
Aan: Ergeerts Glenn
CC: Matthias Radestock; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

Sorry for that, my gmail decided to send email before I was done.

So, I would be also interested in the output of
vm_memory_monitor:get_total_memory()
on your macine. Can I ask you to open erlang shell and type this command?
 (<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at debian</A>)2&gt; vm_memory_monitor:get_total_memory().


&gt;<i> As a temporary workaround I can suggest setting 'vm_memory_high_watermark' to 0,
</I>&gt;<i> which will effectively disable memory based flow control. You can do
</I>&gt;<i> it by adding
</I>&gt;<i> this line to erl parameters in rabbitmq-server:
</I>&gt;<i>    -rabbit vm_memory_high_watermark 0 \
</I>&gt;<i>
</I>&gt;<i> Alternatively you can set that variable in rabbitmq.config. There's an
</I>&gt;<i> example in docs:
</I>&gt;<i>  <A HREF="http://www.rabbitmq.com/extensions.html#memsup">http://www.rabbitmq.com/extensions.html#memsup</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Jan 28, 2010 at 12:53, Ergeerts Glenn &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">glenn.ergeerts at artesis.be</A>&lt;mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">glenn.ergeerts at artesis.be</A>&gt;&gt; wrote:
</I>&gt;&gt;<i> It Looks like there is a problem indeed.. This is in rabbit.log after starting:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
</I>&gt;&gt;<i> Memory limit set to 0MB.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
</I>&gt;&gt;<i> vm_memory_high_watermark set. Memory used:5285360 allowed:-663552
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
</I>&gt;&gt;<i>    alarm_handler: {set,{vm_memory_high_watermark,[]}}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I tried manually setting the memory limit using the config file and the link you provided (I was using an empty config before),
</I>&gt;&gt;<i> but it doesn't seem to change anything, still the same output. I'm probably doing something wrong here..
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> About the startup script: it is the 1.7.1 script indeed. The error i get is:
</I>&gt;&gt;<i> \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at this time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm running on windows 7 64bit.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i> Glenn
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;&gt;<i> Van: Matthias Radestock [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&lt;mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt;]
</I>&gt;&gt;<i> Verzonden: donderdag 28 januari 2010 12:40
</I>&gt;&gt;<i> Aan: Ergeerts Glenn
</I>&gt;&gt;<i> CC: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Glenn,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> glenner wrote:
</I>&gt;&gt;&gt;<i> After upgrading the server to 1.7.1 my client hangs forever on the
</I>&gt;&gt;&gt;<i> BasicPublish() line using the following code.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That's probably due to the improved memory monitoring telling the
</I>&gt;&gt;<i> producers to pause in order to prevent the server from running out of
</I>&gt;&gt;<i> memory. Do you see any alarms in the rabbit.log?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> See <A HREF="http://www.rabbitmq.com/extensions.html#memsup">http://www.rabbitmq.com/extensions.html#memsup</A> for instructions on
</I>&gt;&gt;<i> how to adjust the memory limits.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Another unrelated issue: i had to add quotes to the following line in
</I>&gt;&gt;&gt;<i> rabbitmq-server.bat to get the script running:
</I>&gt;&gt;&gt;<i>     set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> changed to :    set RABBITMQ_BOOT_FILE=&quot;%RABBITMQ_EBIN_ROOT%\rabbit&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Really? Even in the 1.7.1 script? What error do you get?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Matthias.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>_______________________________________________
rabbitmq-discuss mailing list
<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/c2396c06/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/c2396c06/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006074.html">[rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1
</A></li>
	<LI>Next message: <A HREF="006083.html">[rabbitmq-discuss] BasicPublish() from .NET client hangs after	upgrading server to 1.7.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6076">[ date ]</a>
              <a href="thread.html#6076">[ thread ]</a>
              <a href="subject.html#6076">[ subject ]</a>
              <a href="author.html#6076">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
