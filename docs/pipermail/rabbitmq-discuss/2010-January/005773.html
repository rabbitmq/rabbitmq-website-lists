<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Single vs Multiple Queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Single%20vs%20Multiple%20Queues&In-Reply-To=c89c65ea1001060218i22f83b55t3ebaec36cc34949d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005772.html">
   <LINK REL="Next"  HREF="005774.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Single vs Multiple Queues</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Single%20vs%20Multiple%20Queues&In-Reply-To=c89c65ea1001060218i22f83b55t3ebaec36cc34949d%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Single vs Multiple Queues">alexis.richardson at gmail.com
       </A><BR>
    <I>Wed Jan  6 10:35:06 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="005772.html">[rabbitmq-discuss] Single vs Multiple Queues
</A></li>
        <LI>Next message: <A HREF="005774.html">[rabbitmq-discuss] adjusting timeout for non-acked messages to be requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5773">[ date ]</a>
              <a href="thread.html#5773">[ thread ]</a>
              <a href="subject.html#5773">[ subject ]</a>
              <a href="author.html#5773">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Vishnu,

On Wed, Jan 6, 2010 at 10:18 AM, vishnu &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pathsny at gmail.com</A>&gt; wrote:
&gt;<i> Hi Alexis
</I>&gt;<i> &#160; &#160; yeah, I see the argument about how using a single queue means I do the
</I>&gt;<i> filtering at the consumer end, but as I see it, it also means I no longer
</I>&gt;<i> have to figure out how to prioritise each of the tasks by providing a number
</I>&gt;<i> of consumers (though I can imagine that being useful at times).
</I>
Yes and no.

You could easily write your consumers so that they scheduled
themselves across queues on a by-need basis.  For example if a
consumer finds a queue to be empty, then it tries the next queue.  And
so on.  Many strategies are possible.


&gt;<i> But if I
</I>&gt;<i> expect all jobs to as important, but the number of messages to be variable.
</I>&gt;<i> Using a single queue seems to give me the advantage that all messages are of
</I>&gt;<i> equal priority and so if I get three times the number of messages of one
</I>&gt;<i> type as opposed to others, that task is automatically going to get three
</I>&gt;<i> times the number of consumers.
</I>
If all messages are of equal priority and you want them to be fairly
shared across all consumers, then using one queue makes sense.

You can always add more queues and more subtle behaviour later!



&gt;<i>  Do you have any thoughts about this?
</I>
See above :-)


&gt;<i> This prevents me from having to juggle numbers to optimise different queues
</I>&gt;<i> with different pool size. The cost of filtering seems easier if I can make
</I>&gt;<i> sure my messages carry that information. I'm trying to figure out if this
</I>&gt;<i> advantage I see is deceptive? Is there a way to achieve the same goal with
</I>&gt;<i> different queues? For example if I have multiple queues can I make the pool
</I>&gt;<i> of consumers subscribe to all queues and pick up the first message that
</I>&gt;<i> comes through no matter what? Or does this not make sense.
</I>
You can certainly have N queues and connect all M consumers to all N queues.


&gt;<i> Another question that might be related is the reason for the &quot;channel&quot;
</I>&gt;<i> abstraction. I have a connection over which I create a channel and then
</I>&gt;<i> register queues. What are channels for? Why would I have multiple channels
</I>&gt;<i> on one connection.
</I>
As I recall, others have asked this question.  IIRC the reason was to
create logically isolated communication links ('channels') without
compelling everyone to open lots of connections.

But perhaps someone can give a better answer.

alexis




&gt;<i> On Wed, Jan 6, 2010 at 12:37 PM, Alexis Richardson
</I>&gt;<i> &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Vishnu
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you hang multiple consumers off a single queue, then that queue's
</I>&gt;&gt;<i> state is shared and those consumers share the messages out between
</I>&gt;&gt;<i> them &quot;round robin&quot; style. &#160;This is good for the 'master worker'
</I>&gt;&gt;<i> pattern for example. &#160;Now, you can also have multiple queues doing a
</I>&gt;&gt;<i> master/worker type application. &#160;For example you could have four
</I>&gt;&gt;<i> queues, one for 'large' tasks (messages), one for 'medium', one for
</I>&gt;&gt;<i> 'small', and one more queue that gets a copy of all messages for
</I>&gt;&gt;<i> logging and management. &#160;Each of those queues could be private to one
</I>&gt;&gt;<i> consumer, or it could be shared among a 'pool' of consumers (eg worker
</I>&gt;&gt;<i> threads).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In the above 'large'. 'medium', 'small' tasks example, you can load
</I>&gt;&gt;<i> balance work by size by allocating different numbers of consumers to
</I>&gt;&gt;<i> each queue. &#160;So, if you want to filter your flows in the broker, use
</I>&gt;&gt;<i> many queues. &#160;Using just one queue forces you to manage any filtering
</I>&gt;&gt;<i> in your thread pool.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> alexis
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Wed, Jan 6, 2010 at 3:53 AM, vishnu &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pathsny at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; Hi
</I>&gt;&gt;<i> &gt; &#160; &#160;We're looking at building a back end which picks up 3 or 4 different
</I>&gt;&gt;<i> &gt; messages. Now we have the option of using a single queue and sending
</I>&gt;&gt;<i> &gt; different messages through it, or multiple queues each of which is
</I>&gt;&gt;<i> &gt; dedicated
</I>&gt;&gt;<i> &gt; for a single kind of message.
</I>&gt;&gt;<i> &gt; We're wondering what's more common. We're thinking of using Scala with
</I>&gt;&gt;<i> &gt; lift
</I>&gt;&gt;<i> &gt; amqp or the Java api to connect to RabbitMq. On one hand using multiple
</I>&gt;&gt;<i> &gt; queues makes it seem like we're going to have to prioritise the number
</I>&gt;&gt;<i> &gt; of
</I>&gt;&gt;<i> &gt; threads or processes per queue which seems like we're trying to optimise
</I>&gt;&gt;<i> &gt; that.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005772.html">[rabbitmq-discuss] Single vs Multiple Queues
</A></li>
	<LI>Next message: <A HREF="005774.html">[rabbitmq-discuss] adjusting timeout for non-acked messages to be requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5773">[ date ]</a>
              <a href="thread.html#5773">[ thread ]</a>
              <a href="subject.html#5773">[ subject ]</a>
              <a href="author.html#5773">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
