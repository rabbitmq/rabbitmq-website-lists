<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] suspending and resuming a QueueingConsumer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20suspending%20and%20resuming%20a%20QueueingConsumer&In-Reply-To=3b6ef0791001131106v785dc590gbe1aef31fe06d9f6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005862.html">
   <LINK REL="Next"  HREF="005889.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] suspending and resuming a QueueingConsumer</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20suspending%20and%20resuming%20a%20QueueingConsumer&In-Reply-To=3b6ef0791001131106v785dc590gbe1aef31fe06d9f6%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] suspending and resuming a QueueingConsumer">matthew at lshift.net
       </A><BR>
    <I>Thu Jan 14 11:24:59 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="005862.html">[rabbitmq-discuss] suspending and resuming a QueueingConsumer
</A></li>
        <LI>Next message: <A HREF="005889.html">[rabbitmq-discuss] suspending and resuming a QueueingConsumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5884">[ date ]</a>
              <a href="thread.html#5884">[ thread ]</a>
              <a href="subject.html#5884">[ subject ]</a>
              <a href="author.html#5884">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jim,

On Wed, Jan 13, 2010 at 02:06:57PM -0500, Jim Irrer wrote:
&gt;<i> I have several consumers reading from the same queue.  I would like
</I>&gt;<i> to be able to interrupt their pending read to suspend and resume any
</I>&gt;<i> one of them.   I've played around with:
</I>&gt;<i> 
</I>&gt;<i> Channel.basicCancel(consumerTag) : don't know how to resume
</I>&gt;<i> Channel.abort()    produces com.rabbitmq.client.ShutdownSignalException
</I>&gt;<i> Channel.close()   produces com.rabbitmq.client.ShutdownSignalException
</I>&gt;<i> 
</I>&gt;<i> The close() and abort() methods seem to act about the same.  I can resume
</I>&gt;<i> reading from the queue by creating a new channel and a new QueueingConsumer.
</I>&gt;<i> I could not figure out how to resume after a basicCancel.
</I>&gt;<i> 
</I>&gt;<i> Is using close() and then re-constructing the channel and QueueingConsumer
</I>&gt;<i> the right way to go?  Will resources be properly taken care of by garbage
</I>&gt;<i> collection?
</I>
What I would do is set QoS prefetch to 1, and make sure that you're
doing ack-ing manually (i.e. don't set noAck). Then, when you want to
&quot;suspend&quot;, just delay acking the last message you received. That'll
prevent further messages being sent to you. Once you want to resume,
send the ack and then the next message will be sent down to you. Does
that help?

&gt;<i> BTW - I use the consumerTag returned by Channel.basicConsume(queueName,
</I>&gt;<i> consumer)
</I>&gt;<i> for the argument to Channel.basicCancel, eg: *
</I>&gt;<i> amq.ctag-1m/H7+SDcZpbzTMgsUyhNg==* .
</I>&gt;<i> When called, it prints:
</I>&gt;<i> 
</I>&gt;<i> Consumer null method handleCancelOk for channel AMQChannel(amqp://
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">guest at 172.20.125.34</A>:5672/,1) threw an exception:
</I>&gt;<i> java.lang.NullPointerException
</I>&gt;<i>     at com.rabbitmq.client.impl.ChannelN$2.transformReply(ChannelN.java:728)
</I>&gt;<i>     at com.rabbitmq.client.impl.ChannelN$2.transformReply(ChannelN.java:721)
</I>&gt;<i>     at
</I>&gt;<i> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.handleCommand(AMQChannel.java:327)
</I>&gt;<i>     at
</I>&gt;<i> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:162)
</I>&gt;<i>     at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
</I>&gt;<i>     at
</I>&gt;<i> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:456)
</I>
The Javadoc says:

    /**
     * Cancel a consumer. Calls the consumer's {@link Consumer#handleCancelOk}
     * method before returning.
     * @param consumerTag a client- or server-generated consumer tag to establish context
     * @throws java.io.IOException if an error is encountered
     * @see com.rabbitmq.client.AMQP.Basic.Cancel
     * @see com.rabbitmq.client.AMQP.Basic.CancelOk
     */
    void basicCancel(String consumerTag) throws IOException;

The DefaultConsumer does have the handleCancelOk filled in, and Consumer
is an interface, so I'm a little alarmed by the possibility that it
can't find the handleCancelOk method. What consumer class are you using?
- in short, could you send us a small code example that exhibits this
behaviour?

Best wishes,

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005862.html">[rabbitmq-discuss] suspending and resuming a QueueingConsumer
</A></li>
	<LI>Next message: <A HREF="005889.html">[rabbitmq-discuss] suspending and resuming a QueueingConsumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5884">[ date ]</a>
              <a href="thread.html#5884">[ thread ]</a>
              <a href="subject.html#5884">[ subject ]</a>
              <a href="author.html#5884">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
