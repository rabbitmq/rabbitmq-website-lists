<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Exclusive queues and delete-on-disconnect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Exclusive%20queues%20and%20delete-on-disconnect&In-Reply-To=ce2570e21001192057y7fef72b4h6829427eae01b122%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005943.html">
   <LINK REL="Next"  HREF="005946.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Exclusive queues and delete-on-disconnect</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Exclusive%20queues%20and%20delete-on-disconnect&In-Reply-To=ce2570e21001192057y7fef72b4h6829427eae01b122%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Exclusive queues and delete-on-disconnect">matthias at lshift.net
       </A><BR>
    <I>Wed Jan 20 08:48:18 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="005943.html">[rabbitmq-discuss] Exclusive queues and delete-on-disconnect
</A></li>
        <LI>Next message: <A HREF="005946.html">[rabbitmq-discuss] Heartbeat configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5944">[ date ]</a>
              <a href="thread.html#5944">[ thread ]</a>
              <a href="subject.html#5944">[ subject ]</a>
              <a href="author.html#5944">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Garrett,

Garrett Smith wrote:
&gt;<i> My understanding is that declaring a queue as exclusive will cause the
</I>&gt;<i> queue to be deleted as soon as the declaring channel (or connection?)
</I>&gt;<i> is closed.
</I>
It's the declaring *connection*.

&gt;<i> I've observed cases when a channel/connection has not been closed
</I>&gt;<i> cleanly (e.g. sudden network failure) and the queue is not deleted.
</I>
That shouldn't happen, except ... certain types of network failure can 
take a while to be recognised as disconnects by the OS' network stack.

One way to counter that is to enable AMQP heartbeats, which most AMQP 
clients (including all the supported RabbitMQ clients) support. That 
will cause a peer to close the connection when it hasn't received any 
data from the server for the configured heartbeat interval and thus puts 
an application-configured upper bound on the length of time a disconnect 
may go unnoticed.

&gt;<i> When the consumer re-declares (e.g. on restart), the broker complains
</I>&gt;<i> about an exclusive queue already existing. The fix I'm using is to
</I>&gt;<i> manually delete the queue.
</I>&gt;<i> 
</I>&gt;<i> Are there any suggestions for dealing with this?
</I>
Even with heartbeats enabled you still essentially have a race since the 
re-declaration may happen before a heartbeat has been missed. When that 
happens, you could pause and re-try, or, as you say, explicitly delete 
the queue.

Or perhaps you could declare anonymous queues, i.e. create a queue with 
a fresh name every time you connect? See also the next point.

&gt;<i> Apart from the added complexity of restarting the consumer, I'm 
</I>&gt;<i> concerned that messages will pile up in the queue with on one to
</I>&gt;<i> consume them.
</I>
Unless the network is mis-configured or you are using broken network kit 
then even w/o a heartbeat the broker will eventually recognise the 
disconnect and thus delete the queue. It may take a while - seconds, 
minutes - but it will happen.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005943.html">[rabbitmq-discuss] Exclusive queues and delete-on-disconnect
</A></li>
	<LI>Next message: <A HREF="005946.html">[rabbitmq-discuss] Heartbeat configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5944">[ date ]</a>
              <a href="thread.html#5944">[ thread ]</a>
              <a href="subject.html#5944">[ subject ]</a>
              <a href="author.html#5944">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
