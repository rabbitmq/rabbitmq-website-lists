<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queuing for an application that does a fair	amount of synchronous processing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Queuing%20for%20an%20application%20that%20does%20a%20fair%0A%09amount%20of%20synchronous%20processing&In-Reply-To=c89c65ea0912311136y2813251ci68a9bc7a3a9002f5%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005790.html">
   <LINK REL="Next"  HREF="005834.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queuing for an application that does a fair	amount of synchronous processing</H1>
    <B>vishnu</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Queuing%20for%20an%20application%20that%20does%20a%20fair%0A%09amount%20of%20synchronous%20processing&In-Reply-To=c89c65ea0912311136y2813251ci68a9bc7a3a9002f5%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Queuing for an application that does a fair	amount of synchronous processing">pathsny at gmail.com
       </A><BR>
    <I>Wed Jan  6 14:16:45 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="005790.html">[rabbitmq-discuss] Transactions on acks
</A></li>
        <LI>Next message: <A HREF="005834.html">[rabbitmq-discuss] Queuing for an application that does a fair amount of synchronous processing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5781">[ date ]</a>
              <a href="thread.html#5781">[ thread ]</a>
              <a href="subject.html#5781">[ subject ]</a>
              <a href="author.html#5781">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We're also looking at about 3000 messages/second (high side), out of which
we need 1000 of these to be persistent (since they represent payments that
must happen). However all of these are currently meant to be synchronous,
meaning we have someone sitting on a browser waiting for us to deal with
this message and send a response back. So in the short term the only
advantage we're hoping to gain is in the case of the persistent queues. In
this case we're relying on the guarantee that the message will be dealt with
even if there is some temporary glitch, and our web based client gets a
timeout message.

The way we plan to implement these synchronous messages is, similar to the
RPC model, to create a temporary queue when we send out a request and
subscribe to that queue with a timeout for a response, deleting it after
we're done.

now, if the webserver thread breaks out of the wait before the message
returns, my understanding is that the temporary queue gets deleted and the
response from the backend server is sent to the exchange where it dies.
(which is fine)

if the webserver thread breaks out of the wait after the message returns,
the queue gets deleted anyway and the message should vanish.

If the webserver thread dies for some reason, the queue gets auto deleted
and so the  backend server again sends the response to the exchange to a non
existent queue.

However, the problem comes in when the webserver thread dies just as the
response returns on the temporary queue. When this race condition occurs,
the queue should remain on the rabbitmq-server forever. Is this right, or is
there something I'm missing?

On Fri, Jan 1, 2010 at 1:06 AM, vishnu &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pathsny at gmail.com</A>&gt; wrote:

&gt;<i> fair enough, let me come back with some numbers :), I just wanted to first
</I>&gt;<i> make sure I'm not doing something brain dead :).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Dec 31, 2009 at 8:51 PM, Chuck Remes &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cremes.devlist at mac.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Dec 31, 2009, at 9:15 AM, vishnu wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Hi
</I>&gt;&gt;<i> &gt;    We're looking at building an application that does a fair amount
</I>&gt;&gt;<i> &gt; of synchronous processing. However we are investigating using a
</I>&gt;&gt;<i> &gt; queuing system as a messaging bus because some of these processes
</I>&gt;&gt;<i> &gt; are meant to be reliable. Using a queue helps us guarantee that
</I>&gt;&gt;<i> &gt; messages are dealt with and avoids us having to right background
</I>&gt;&gt;<i> &gt; processes to clean up after us.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; There are, however, a fair number of operations that are not
</I>&gt;&gt;<i> &gt; required to be reliable and we are thinking of implementing these
</I>&gt;&gt;<i> &gt; also through the queue but use non persistent queues. Now the
</I>&gt;&gt;<i> &gt; concern we have is the kinds of latencies we might see. So I'd like
</I>&gt;&gt;<i> &gt; to get general feedback on using this approach.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Give us some idea of the data rates you are expecting. I regularly
</I>&gt;&gt;<i> publish 3000+ messages/second using ruby which isn't exactly known for
</I>&gt;&gt;<i> its performance. :)  Latency is a millisecond or so for topic
</I>&gt;&gt;<i> exchanges, and under 1 millisecond for direct and fanout exchanges.
</I>&gt;&gt;<i> (Exchange type matters due to matching overhead.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, since you say that all processing is synchronous, the length
</I>&gt;&gt;<i> of time to complete that process will be your gating factor.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> cr
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/23afa1ec/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/23afa1ec/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005790.html">[rabbitmq-discuss] Transactions on acks
</A></li>
	<LI>Next message: <A HREF="005834.html">[rabbitmq-discuss] Queuing for an application that does a fair amount of synchronous processing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5781">[ date ]</a>
              <a href="thread.html#5781">[ thread ]</a>
              <a href="subject.html#5781">[ subject ]</a>
              <a href="author.html#5781">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
