<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] .Net client foreground threads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20.Net%20client%20foreground%20threads&In-Reply-To=20100106113643.GG27068%40wellquite.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005777.html">
   <LINK REL="Next"  HREF="005797.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] .Net client foreground threads</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20.Net%20client%20foreground%20threads&In-Reply-To=20100106113643.GG27068%40wellquite.org"
       TITLE="[rabbitmq-discuss] .Net client foreground threads">matthew at lshift.net
       </A><BR>
    <I>Thu Jan  7 12:32:40 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="005777.html">[rabbitmq-discuss] .Net client foreground threads
</A></li>
        <LI>Next message: <A HREF="005797.html">[rabbitmq-discuss] Daemonizing connection threads (was Re: .Net client foreground threads)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5796">[ date ]</a>
              <a href="thread.html#5796">[ thread ]</a>
              <a href="subject.html#5796">[ subject ]</a>
              <a href="author.html#5796">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jeremy,

On Wed, Jan 06, 2010 at 11:36:43AM +0000, Matthew Sackman wrote:
&gt;<i> On Tue, Dec 29, 2009 at 06:39:28PM -0600, Jeremy Dunck wrote:
</I>&gt;<i> &gt; Is there a reason for the main loop and heartbeat threads to be
</I>&gt;<i> &gt; Foreground threads?  I was expecting my process to die when my last
</I>&gt;<i> &gt; app thread died, but the Rabbit threads are Foreground (the default)
</I>&gt;<i> &gt; so they keep the process alive.
</I>&gt;<i> 
</I>&gt;<i> Yes, we agree, the standard patterns of use for C# and Java suggest that
</I>&gt;<i> these threads should be background/daemon. We have a bug open to cover
</I>&gt;<i> this for the Java client, and I've added a not to it so that it covers
</I>&gt;<i> the C# thread too.
</I>&gt;<i> 
</I>&gt;<i> Although this may sound a bit like doing manual memory-management, it is
</I>&gt;<i> probably a good idea to think about how could could manually shutdown
</I>&gt;<i> the AMQP connection. That way you will get some guarantees about
</I>&gt;<i> messages which are sitting in buffers actually being flushed out (if you
</I>&gt;<i> just terminate abruptly, you /could/ lose publishes that have not made
</I>&gt;<i> it to the OS TCP buffers yet).
</I>
It would appear I can't read our own bugs. The conclusion of the bug is
that we should not set the threads in the Java or .Net clients as
daemon/background precisely because of the risk of losing messages. The
connection should always be explicitly closed. Furthermore, this offers
fewer surprises - if you find the application's hanging around too long
you know you've got connections left open. The alternative is that you
sometimes see messages disappear without trace which is far worse, and
much harder to debug.

My apologies for misleading you.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005777.html">[rabbitmq-discuss] .Net client foreground threads
</A></li>
	<LI>Next message: <A HREF="005797.html">[rabbitmq-discuss] Daemonizing connection threads (was Re: .Net client foreground threads)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5796">[ date ]</a>
              <a href="thread.html#5796">[ thread ]</a>
              <a href="subject.html#5796">[ subject ]</a>
              <a href="author.html#5796">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
