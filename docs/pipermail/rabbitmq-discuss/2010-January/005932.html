<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Running StressPersister.java client against RabbitMQ and finding the stress_persister.log file is being &quot;beaten to death&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Running%20StressPersister.java%20client%20against%0A%20RabbitMQ%20and%20finding%20the%20stress_persister.log%20file%20is%20being%20%22beaten%20to%0A%20death%22&In-Reply-To=173a1edc1001190122n397911c2occ9fba9c028385e8%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005923.html">
   <LINK REL="Next"  HREF="005934.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Running StressPersister.java client against RabbitMQ and finding the stress_persister.log file is being &quot;beaten to death&quot;</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Running%20StressPersister.java%20client%20against%0A%20RabbitMQ%20and%20finding%20the%20stress_persister.log%20file%20is%20being%20%22beaten%20to%0A%20death%22&In-Reply-To=173a1edc1001190122n397911c2occ9fba9c028385e8%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Running StressPersister.java client against RabbitMQ and finding the stress_persister.log file is being &quot;beaten to death&quot;">matthew at lshift.net
       </A><BR>
    <I>Tue Jan 19 14:03:22 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="005923.html">[rabbitmq-discuss] Running StressPersister.java client against	RabbitMQ and finding the stress_persister.log file is being	&quot;beaten to death&quot;
</A></li>
        <LI>Next message: <A HREF="005934.html">[rabbitmq-discuss] Running StressPersister.java client against RabbitMQ and finding the stress_persister.log file is being &quot;beaten to death&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5932">[ date ]</a>
              <a href="thread.html#5932">[ thread ]</a>
              <a href="subject.html#5932">[ subject ]</a>
              <a href="author.html#5932">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi John,

On Tue, Jan 19, 2010 at 10:22:29AM +0100, John Apps wrote:
&gt;<i> What parameters should one tweak in order to reduce the I/O to the log file
</I>&gt;<i> in the StressPersister test? And others with similar behaviour, of course.
</I>
A quick look at the code suggests changing the sample interval with s
should do the trick.

&gt;<i> The file grows to about 140MB using the default StressPersister parameters,
</I>&gt;<i> only to be renamed to stress_persister.log.previous and the whole cycle
</I>&gt;<i> starts again.
</I>&gt;<i> With smaller parameters than the default, i.e., smaller message size, lower
</I>&gt;<i> backlog etc., the pattern is the same, but the frequency with which the log
</I>&gt;<i> is renamed and recreated is faster.
</I>
That's very odd. I must confess to being totally unfamiliar with this
example - it's not one of the tests I've written to stress the new
persister.

Just running it, I get rather different results to you:

rabbitmq-java-client/build/dist$ sh runjava.sh com/rabbitmq/examples/StressPersister -C blah
... things happen ...
rabbitmq-java-client/build/dist$ ls -l
total 756
... stuff ...
-rw-r--r-- 1 matthew matthew   5077 Jan 19 13:54 stress-persister-b00005000-B0000016384-c00025000-s000100-blah.out

The results there are in a format suitable for plotting with graphviz or
similar. Digging back through our hg repo, Tony wrote this test in order
to replicate some of the results I was seeing using my Erlang-client
tests with the new persister.

&gt;<i> What would be ideal would be to be able to specify an initial (large)
</I>&gt;<i> allocation for the file (so it does not extend it all the time) along with
</I>&gt;<i> an extension quantity, should it have to be extended. In addition, if one
</I>&gt;<i> could specify how much should be retained in memory prior to be flushed to
</I>&gt;<i> disk, that would also make things move along.
</I>
Not really. Most modern file systems support holes in files, thus an
initial preallocation is virtually a noop, and buys you nothing later on.
Appending to a file is by far the best way to utilise disk bandwidth in
our experience. The OS is highly likely to be buffering pages of
outstanding writes anyway to disk.

Wrt buffering, the code is using a Java PrintWriter and using println on
it. Now it does call flush appropriately and not on every line.
Hopefully the Java libraries underneath understand that they're writing
to a file and not a terminal and are thus not doing a flush every line
themselves, but I'm not 100% sure about that.

I'm afraid I just can't replicate what you're seeing. How are you
running the example?

Best wishes,

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005923.html">[rabbitmq-discuss] Running StressPersister.java client against	RabbitMQ and finding the stress_persister.log file is being	&quot;beaten to death&quot;
</A></li>
	<LI>Next message: <A HREF="005934.html">[rabbitmq-discuss] Running StressPersister.java client against RabbitMQ and finding the stress_persister.log file is being &quot;beaten to death&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5932">[ date ]</a>
              <a href="thread.html#5932">[ thread ]</a>
              <a href="subject.html#5932">[ subject ]</a>
              <a href="author.html#5932">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
