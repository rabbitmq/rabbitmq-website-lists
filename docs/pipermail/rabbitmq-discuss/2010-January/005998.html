<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] MulticastMain Java client causes Erlang error	eheap_alloc: Cannot allocate 467078560 bytes of memory (of	type &quot;heap&quot;) (with RabbitMQ 1.7.1)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20MulticastMain%20Java%20client%20causes%20Erlang%20error%0A%09eheap_alloc%3A%20Cannot%20allocate%20467078560%20bytes%20of%20memory%20%28of%0A%09type%20%22heap%22%29%20%28with%20RabbitMQ%201.7.1%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006038.html">
   <LINK REL="Next"  HREF="006002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] MulticastMain Java client causes Erlang error	eheap_alloc: Cannot allocate 467078560 bytes of memory (of	type &quot;heap&quot;) (with RabbitMQ 1.7.1)</H1>
    <B>John Apps</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20MulticastMain%20Java%20client%20causes%20Erlang%20error%0A%09eheap_alloc%3A%20Cannot%20allocate%20467078560%20bytes%20of%20memory%20%28of%0A%09type%20%22heap%22%29%20%28with%20RabbitMQ%201.7.1%29&In-Reply-To="
       TITLE="[rabbitmq-discuss] MulticastMain Java client causes Erlang error	eheap_alloc: Cannot allocate 467078560 bytes of memory (of	type &quot;heap&quot;) (with RabbitMQ 1.7.1)">johndapps at gmail.com
       </A><BR>
    <I>Mon Jan 25 18:27:29 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006038.html">[rabbitmq-discuss] Is it possible to create/bind a queue so	that it has a limit of N messages
</A></li>
        <LI>Next message: <A HREF="006002.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of	type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5998">[ date ]</a>
              <a href="thread.html#5998">[ thread ]</a>
              <a href="subject.html#5998">[ subject ]</a>
              <a href="author.html#5998">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>'Tis with tongue in cheek that I send this along...as the last time I tried
this, it was not supposed to work (always) on Windows.

I have installed 1.7.1 in a new directory, recompiled the Java client and
tried this test again.

This is the contents of rabbitmq.config
[
  {rabbit, [{vm_memory_high_watermark, 3}]},
  {rabbit, [{memory_alarms, true}]},
  {mnesia, [{dump_log_write_threshold, 1000}]},
  {rabbit, []}
].
I have tried various options with the above vm_memory_high_watermark, e.g.,
.4, .6 and so forth, the 3 above being from the last try. Perhaps there more
options that I missed? It would not surprise me.

Running the MulticastMain (Java) test against RabbitMQ with the parameters
shown, leads to an Erlang crash after some time.
The data below is from a Windows 7 X64 machine running JDK 6 X64.

&quot;Cannot allocate 467078560 bytes&quot; is the error message.

C:\AMQP\RabbitMQ\rabbitmq-java-client-1.7.1\test\src&gt;java -server ^
com.rabbitmq.examples.MulticastMain ^
-hlocalhost -p5672 -tdirect -eex1 -i10 -m1024 ^
-n1024 -q20 -r1000 -s100 -x1 -y1
starting consumer #0
starting producer #0
sending rate: 997 msg/s
sending rate: 1000 msg/s
sending rate: 1000 msg/s
sending rate: 1000 msg/s
...
...
...
sending rate: 1000 msg/s
Exception in thread &quot;Thread-1&quot; java.lang.RuntimeException:
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.net.SocketException: Connection reset
        at
com.rabbitmq.examples.MulticastMain$Consumer.run(MulticastMain.java:385)
        at java.lang.Thread.run(Unknown Source)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
reason
:<i> java.net.SocketException: Connection reset
</I>        at
com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:588)
        at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:454)
Caused by: java.net.SocketException: Connection reset
        at java.net.SocketInputStream.read(Unknown Source)
        at java.io.BufferedInputStream.fill(Unknown Source)
        at java.io.BufferedInputStream.read(Unknown Source)
        at java.io.DataInputStream.readUnsignedByte(Unknown Source)
        at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:117)
        at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:151)
        at
com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:379)
        at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:420)
...
...
C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin&gt;&quot;C:\erl5.7.4\bin\erl.exe&quot; -pa
&quot;C:\AM
QP\RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin&quot; -enum_args -noinput -boot
start_
sasl &quot;&quot; -sname rabbit -s rabbit +W w +A30 -kernel
inet_default_listen_options &quot;[
{nodelay, true}, {sndbuf, 16384}, {recbuf, 4096}]&quot; -kernel
inet_default_connect_
options &quot;[{nodelay, true}]&quot; -rabbit tcp_listeners &quot;[{\&quot;0.0.0.0\&quot;, 5672}]&quot;
-kerne
l error_logger
{file,\&quot;&quot;C:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/log/rabbit.log&quot;\&quot;
}  -sasl errlog_type error -sasl sasl_error_logger
{file,\&quot;&quot;C:/AMQP/RabbitMQ/rab
bitmq_server-1.7.1/log/rabbit-sasl.log&quot;\&quot;} -os_mon start_cpu_sup true
-os_mon st
art_disksup false -os_mon start_memsup false -os_mon start_os_sup false
-os_mon
memsup_system_only true -os_mon system_memory_high_watermark 0.95 -mnesia
dir \&quot;
&quot;C:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/rabbit-mnesia&quot;\&quot;


+---+   +---+
|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   +---+   +-------+
</I>|<i>                   |
</I>|<i> RabbitMQ  +---+   |
</I>|<i>           |   |   |
</I>|<i>   v1.7.1  +---+   |
</I>|<i>                   |
</I>+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and R
abbit Technologies Ltd.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

node          : <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at BIGPOOH</A>
app descriptor:
c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
home dir      : C:\Users\AppsJ
cookie hash   : 1frVt/baXXdWZIsayTJJ8Q==
log           : C:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/log/rabbit.log
sasl log      : C:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/log/rabbit-sasl.log
database dir  : c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/db/rabbit-mnesia

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running

Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 467078560 bytes of memory (of type &quot;heap&quot;).

This application has requested the Runtime to terminate it in an unusual
way.
Please contact the application's support team for more information.

The crash dump is rather large, so I shall not post it here...but will make
it available if someone requires it.
=erl_crash_dump:0.1
Fri Jan 22 18:44:49 2010
Slogan: eheap_alloc: Cannot allocate 467078560 bytes of memory (of type
&quot;heap&quot;).
System version: Erlang R13B03 (erts-5.7.4) [smp:2:2] [rq:2]
[async-threads:30]
Compiled: Tue Nov 24 11:12:28 2009
-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/02cc1285/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/02cc1285/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006038.html">[rabbitmq-discuss] Is it possible to create/bind a queue so	that it has a limit of N messages
</A></li>
	<LI>Next message: <A HREF="006002.html">[rabbitmq-discuss] MulticastMain Java client causes Erlang error eheap_alloc: Cannot allocate 467078560 bytes of memory (of	type &quot;heap&quot;) (with RabbitMQ 1.7.1)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5998">[ date ]</a>
              <a href="thread.html#5998">[ thread ]</a>
              <a href="subject.html#5998">[ subject ]</a>
              <a href="author.html#5998">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
