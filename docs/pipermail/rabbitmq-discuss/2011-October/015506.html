<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] HA active/active cluster in a bad state
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20active/active%20cluster%20in%20a%20bad%20state&In-Reply-To=%3C20111013153328.GB22178%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015369.html">
   <LINK REL="Next"  HREF="015507.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] HA active/active cluster in a bad state</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20active/active%20cluster%20in%20a%20bad%20state&In-Reply-To=%3C20111013153328.GB22178%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] HA active/active cluster in a bad state">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Oct 13 16:33:29 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015369.html">[rabbitmq-discuss] HA active/active cluster in a bad state
</A></li>
        <LI>Next message: <A HREF="015507.html">[rabbitmq-discuss] HA active/active cluster in a bad state
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15506">[ date ]</a>
              <a href="thread.html#15506">[ thread ]</a>
              <a href="subject.html#15506">[ subject ]</a>
              <a href="author.html#15506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Bryan,

Sorry it's taken so long to get back to you... been swamped with other
things.

On Tue, Oct 04, 2011 at 08:10:09PM -0500, Bryan Murphy wrote:
&gt;<i> From another node:
</I>&gt;<i> 
</I>&gt;<i> Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at domU-12-31-39-06-72-50</A>' ...
</I>&gt;<i> [{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at domU-12-31-38-07-18-A6</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-202-209-83</A>',
</I>&gt;<i>                 '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at domU-12-31-39-06-72-50</A>']}]},
</I>&gt;<i>  {running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at domU-12-31-38-07-18-A6</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-202-209-83</A>',
</I>&gt;<i>                  '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at domU-12-31-39-06-72-50</A>']}]
</I>&gt;<i> ...done.
</I>&gt;<i> 
</I>&gt;<i> rabbitmqctl list_queues has the same behavior on the other nodes (never
</I>&gt;<i> returns).
</I>
Ok, that most likely suggests the master queue is stuck for some reason,
which is remarkably odd.

&gt;<i> &gt; How big were the queues? We recently fixed some bugs which had
</I>&gt;<i> &gt; previously been causing queue recovery to take a _very_ long time so it
</I>&gt;<i> &gt; might be one of those that's afflicting you. What is the CPU/disk doing
</I>&gt;<i> &gt; of the &quot;stuck&quot; node? If it's spinning then it's probably just taking a
</I>&gt;<i> &gt; very long time to recover.
</I>&gt;<i> 
</I>&gt;<i> Maybe 10-20 queues, probably about 15 messages queued at the time.  This
</I>&gt;<i> environment is a very *low* volume but very *critical* part of our
</I>&gt;<i> application.  I'd be surprised if the production servers saw more than a
</I>&gt;<i> couple hundred messages total per day and this was our test environment.
</I>&gt;<i> 
</I>&gt;<i> Right now the node is idle and it's been sitting there for four hours:
</I>&gt;<i> 
</I>&gt;<i>  01:08:33 up 8 days,  5:33,  1 user,  load average: 0.00, 0.01, 0.05
</I>&gt;<i> 
</I>&gt;<i> A bunch of messages were in an allocated but not-acked state as I was
</I>&gt;<i> testing some of our server processes at the time and they were crashing
</I>&gt;<i> before they could ack the messages.  I originally went to restart the node
</I>&gt;<i> to try and get those messages flowing again.
</I>
Right, there's nothing there that could possibly offer any explanation
as to why this has gone wrong. How repeatable is this, and is there a
simple set of steps that would allow us to recreate this? Failing that,
if you can repeat this, is there any way you could grant me (or one of
my colleagues) access to the machines running Rabbit so that we can
probe your rabbits in a variety of ways?

Best wishes,

Matthew
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015369.html">[rabbitmq-discuss] HA active/active cluster in a bad state
</A></li>
	<LI>Next message: <A HREF="015507.html">[rabbitmq-discuss] HA active/active cluster in a bad state
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15506">[ date ]</a>
              <a href="thread.html#15506">[ thread ]</a>
              <a href="subject.html#15506">[ subject ]</a>
              <a href="author.html#15506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
