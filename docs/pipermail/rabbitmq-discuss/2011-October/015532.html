<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Implementing Prioritised Queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Implementing%20Prioritised%20Queues&In-Reply-To=%3CCAEo4zpeYgkMtUsaNNsJBh-4KJ_3N7Wpe-%3DqJTApdEf%3DaJpCJHg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015526.html">
   <LINK REL="Next"  HREF="015527.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Implementing Prioritised Queues</H1>
    <B>James Dear</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Implementing%20Prioritised%20Queues&In-Reply-To=%3CCAEo4zpeYgkMtUsaNNsJBh-4KJ_3N7Wpe-%3DqJTApdEf%3DaJpCJHg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Implementing Prioritised Queues">jamesdear at gmail.com
       </A><BR>
    <I>Fri Oct 14 13:39:49 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015526.html">[rabbitmq-discuss] Implementing Prioritised Queues
</A></li>
        <LI>Next message: <A HREF="015527.html">[rabbitmq-discuss] Implementing Prioritised Queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15532">[ date ]</a>
              <a href="thread.html#15532">[ thread ]</a>
              <a href="subject.html#15532">[ subject ]</a>
              <a href="author.html#15532">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Then the feature would only work for qos channels. Such non-orthogonality is usually a bad idea.
</I>
Not too sure about this, but I can't see any reason why you *would*
want prioritization between queues and *wouldn't* want rate limiting
(QoS). With no rate limiting you would just suck up all of both queues
anyway(?), rendering prioritization irrelevant.

&gt;<i> It would probably be easier to implement priority queues instead.
</I>
Also I don't see prioritization *between queues* as solving the same
problem as prioritizing *within a single queue*. The former allows
recipient-defined priorities whereas the latter allows sender-defined
priority. The global 1-10 priority feature of AMQP looks kind of
deficient in this respect. Both Alice and Bob should be able to
prioritize their own messages as higher than their colleagues',
allowing them to share their compute resources while not surrendering
burst capacity and not suffering tragedy-of-commons. This isn't
possible with 'global' single-queue priorities, but is easily achieved
with 'subjective' prioritization between queues.

&gt;<i> And yes, that's quite difficult too.
</I>
I imagine that prioritization within a single queue is difficult to
implement efficiently because you are (very roughly speaking) doing a
kind of sort operation (or at least some kind of compare) on
potentially millions of items. By prioritizing between queues you are
only comparing between a handful of different queues (in this case
only two).

It's admittedly a bit of a hack, but you could (?) implement this
through the limiter by way of a prefetch *per queue*, similar in style
to Doug's client-side solution. If your low priority queue has a
prefetch of 1 and your high priority queue has a prefetch of 2 (or
higher), then low priority messages will be blocked until all the high
priority messages have gone through.

James

On 14 October 2011 11:42, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:
&gt;<i> James,
</I>&gt;<i>
</I>&gt;<i> On 14/10/11 11:09, James Dear wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Oh I see :(
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How does QoS manage to load-balance multiple queues within a channel?
</I>&gt;&gt;<i> I thought the queue consulted the limiter before delivering a new
</I>&gt;&gt;<i> message
</I>&gt;<i>
</I>&gt;<i> indeed they do, but only when qos is enabled.
</I>&gt;<i>
</I>&gt;&gt;<i> ...in that case could one add a little bit of logic to the
</I>&gt;&gt;<i> limiter to prefer one queue over another?
</I>&gt;<i>
</I>&gt;<i> Then the feature would only work for qos channels. Such non-orthogonality is
</I>&gt;<i> usually a bad idea.
</I>&gt;<i>
</I>&gt;<i> And it's not clear how this would work even in the restricted qos-only case.
</I>&gt;<i> For one, the limiter has no idea whether a queue contains more messages. I
</I>&gt;<i> can think of a few other complications too.
</I>&gt;<i>
</I>&gt;<i> It would probably be easier to implement priority queues instead. And yes,
</I>&gt;<i> that's quite difficult too.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i>
</I></PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015526.html">[rabbitmq-discuss] Implementing Prioritised Queues
</A></li>
	<LI>Next message: <A HREF="015527.html">[rabbitmq-discuss] Implementing Prioritised Queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15532">[ date ]</a>
              <a href="thread.html#15532">[ thread ]</a>
              <a href="subject.html#15532">[ subject ]</a>
              <a href="author.html#15532">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
