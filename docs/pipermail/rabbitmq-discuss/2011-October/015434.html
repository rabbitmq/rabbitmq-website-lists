<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Round-robin exchanges?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Round-robin%20exchanges%3F&In-Reply-To=%3C4E93DFFA.5080004%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015433.html">
   <LINK REL="Next"  HREF="015455.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Round-robin exchanges?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Round-robin%20exchanges%3F&In-Reply-To=%3C4E93DFFA.5080004%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Round-robin exchanges?">matthias at rabbitmq.com
       </A><BR>
    <I>Tue Oct 11 07:19:38 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015433.html">[rabbitmq-discuss] Round-robin exchanges?
</A></li>
        <LI>Next message: <A HREF="015455.html">[rabbitmq-discuss] Round-robin exchanges?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15434">[ date ]</a>
              <a href="thread.html#15434">[ thread ]</a>
              <a href="subject.html#15434">[ subject ]</a>
              <a href="author.html#15434">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Adam,

On 11/10/11 02:48, Adam Rabung wrote:
&gt;<i> Hello,
</I>&gt;<i> I am trying to implement a work queue in RabbitMQ.  I have several
</I>&gt;<i> machines that will act as worker pools for consuming my queues.  I would
</I>&gt;<i> like each job to be processed only once.  Some jobs
</I>&gt;<i> have environmental requirements, ie must be executed on a machine with
</I>&gt;<i> an SSD.  Not all worker pools will meet these requirements.  A first
</I>&gt;<i> approach would be to have a queue for every permutation of requirements:
</I>&gt;<i> &quot;No Requirements&quot;, &quot;Requires SSD&quot;, &quot;Requires Certificate&quot;, etc and have
</I>&gt;<i> each worker pool subscribe to all queues which it can handle.
</I>
That is a sound approach.

&gt;<i> A majority of the jobs will have no requirements, so many worker pools
</I>&gt;<i> will be underutilized.
</I>
As you say, the worker pools would subscribe to all the queues with 
combinations of requirements they can handle. That includes the &quot;No 
Requirements&quot; queue. The subscriptions can be active *simultaneously*, 
so work in the &quot;No Requirements&quot; queue would be round-robin routed to 
all workers, jobs in the &quot;Require SSD&quot; queue will be routed to all 
workers that have SSDs, etc.

If each worker uses a single channel with a basic.qos prefetch setting 
of 1 and subscribes to all the relevant queues on that channel, it will 
be fed work items one at a time from the subset of all these queues that 
have messages in them. There's some logic at the server that ensures 
this is reasonably fair, though you will most likely find that queues 
which can be handled by many workers drain faster than others.

Regards,

Matthias.
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015433.html">[rabbitmq-discuss] Round-robin exchanges?
</A></li>
	<LI>Next message: <A HREF="015455.html">[rabbitmq-discuss] Round-robin exchanges?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15434">[ date ]</a>
              <a href="thread.html#15434">[ thread ]</a>
              <a href="subject.html#15434">[ subject ]</a>
              <a href="author.html#15434">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
