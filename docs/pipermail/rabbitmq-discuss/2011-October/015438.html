<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fairness wrt queues under heavy load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fairness%20wrt%20queues%20under%20heavy%20load&In-Reply-To=%3C4E93F9B2.1060605%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015412.html">
   <LINK REL="Next"  HREF="015444.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fairness wrt queues under heavy load</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fairness%20wrt%20queues%20under%20heavy%20load&In-Reply-To=%3C4E93F9B2.1060605%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Fairness wrt queues under heavy load">matthias at rabbitmq.com
       </A><BR>
    <I>Tue Oct 11 09:09:22 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015412.html">[rabbitmq-discuss] Fairness wrt queues under heavy load
</A></li>
        <LI>Next message: <A HREF="015444.html">[rabbitmq-discuss] Fairness wrt queues under heavy load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15438">[ date ]</a>
              <a href="thread.html#15438">[ thread ]</a>
              <a href="subject.html#15438">[ subject ]</a>
              <a href="author.html#15438">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Eugene,

On 07/10/11 16:30, Eugene Kirpichov wrote:
&gt;<i> I've got a large cluster with many consumers, and several producers
</I>&gt;<i> who publish a very intense steady stream of messages in
</I>&gt;<i> publish/confirm mode.
</I>&gt;<i>
</I>&gt;<i> Some components occasionally submit a single but very important and
</I>&gt;<i> urgent message in transactional mode, which takes up to 5-10 minutes
</I>&gt;<i> to be delivered.
</I>&gt;<i>
</I>&gt;<i> Is this expected behavior?
</I>
Depends.

&gt;<i> How can I avoid these obscenely large delays?
</I>
Most likely due to backlogs. The cure depends on where the backlog is. 
Let's follow the path of a message from producer to consumer...

If the producer publishes at a high rate then backlogs will arise in the 
client buffers, network buffers, server-side network buffers and buffers 
inside rabbit. These backlogs can be substantial, though unlikely 
minutes worth. The way to avoid them is to ensure that high-priority 
messages are published on a separate connection from ordinary messages.

If the publishing rate exceeds the rabbit capacity, the broker will 
eventually hit its memory threshold and throttle producers. The logs 
will tell you when that happens. Memory pressure can take a while to 
dissipate, sometimes several minutes. The cure for this is to set up a 
bigger rabbit.

Messages pile up in queues when consumers don't consume them fast 
enough. Since queues are FIFO structures that manifests itself as a 
delay. To avoid this delay for high priority messages, make sure they 
get routed to a separate queue and code consumers s.t. they consume from 
that queue in addition to the regular queues.

At the consuming end messages can pile up in network buffers and, 
depending on the client library and its use, in client-side buffers. To 
avoid that set a basic.qos prefetch limit on the consuming channels.


Regards,

Matthias.
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015412.html">[rabbitmq-discuss] Fairness wrt queues under heavy load
</A></li>
	<LI>Next message: <A HREF="015444.html">[rabbitmq-discuss] Fairness wrt queues under heavy load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15438">[ date ]</a>
              <a href="thread.html#15438">[ thread ]</a>
              <a href="subject.html#15438">[ subject ]</a>
              <a href="author.html#15438">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
