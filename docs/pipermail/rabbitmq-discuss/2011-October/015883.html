<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Prevent queue flooding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Prevent%20queue%20flooding&In-Reply-To=%3CCAKhN_m7-V8MFCo-beZe7zkc4PwuMo-is68UPV6L%2B7a_NTNMfjg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015897.html">
   <LINK REL="Next"  HREF="015895.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Prevent queue flooding</H1>
    <B>Bill Moseley</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Prevent%20queue%20flooding&In-Reply-To=%3CCAKhN_m7-V8MFCo-beZe7zkc4PwuMo-is68UPV6L%2B7a_NTNMfjg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Prevent queue flooding">moseley at hank.org
       </A><BR>
    <I>Sun Oct 30 05:55:47 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015897.html">[rabbitmq-discuss] RabbitMQ network issue (IP change) on cluster
</A></li>
        <LI>Next message: <A HREF="015895.html">[rabbitmq-discuss] Prevent queue flooding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15883">[ date ]</a>
              <a href="thread.html#15883">[ thread ]</a>
              <a href="subject.html#15883">[ subject ]</a>
              <a href="author.html#15883">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have two usage questions;

First, we have customers submitting jobs (via a web app) at a pretty even
rate, and as such any individual customer's job gets done on a pretty
regular basis.  But, it's possible for a single customer to flood the queue
with requests, which leads to everyone else waiting on that one customer's
jobs to complete.  I would like it to reduce the effect of one customer's
actions on everyone else.

My plan was to use Memcached to track submission rates per customer and
when they exceed some rate publish their jobs to a secondary (low priority)
queue.  Then assign fewer workers to the low priority queue.

Is this a good approach?


Second, when the web app queues a message (to process some &quot;backend&quot; job)
the web app sets a &quot;pending&quot; state in the database.  What normally happens
is one worker processes the job, then this worker sends a new message that
a second worker picks up and completes the job on the web app side.  In the
most simple case &quot;completing&quot; the job means the state in the database is
changed from &quot;pending&quot; to &quot;complete&quot;.

Is this a common use pattern?

My question is how to handle failures and detect stale jobs.  For example,
what if the first worker dies and never sends the completed (or failed)
message to the second worker?  The database is then left indicating
&quot;pending&quot;.   I would tend to use cron for this. That is, have cron look for
old &quot;pending&quot; states and either re-queue the request or mark it as failed
(say after a few failed retry attempts).

Are there other approaches I should consider?

Thanks,



-- 
Bill Moseley
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">moseley at hank.org</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111030/c1cd2eb3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111030/c1cd2eb3/attachment.htm</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015897.html">[rabbitmq-discuss] RabbitMQ network issue (IP change) on cluster
</A></li>
	<LI>Next message: <A HREF="015895.html">[rabbitmq-discuss] Prevent queue flooding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15883">[ date ]</a>
              <a href="thread.html#15883">[ thread ]</a>
              <a href="subject.html#15883">[ subject ]</a>
              <a href="author.html#15883">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
