<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ writes non stop to disk
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20writes%20non%20stop%20to%20disk&In-Reply-To=%3CCAD7X3-kA0DZGgdh2U95oFx-FoVPHes-Bq5bSQ9CfVBzacHzxQQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015748.html">
   <LINK REL="Next"  HREF="015795.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ writes non stop to disk</H1>
    <B>Raphael Simon</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20writes%20non%20stop%20to%20disk&In-Reply-To=%3CCAD7X3-kA0DZGgdh2U95oFx-FoVPHes-Bq5bSQ9CfVBzacHzxQQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ writes non stop to disk">raphael at rightscale.com
       </A><BR>
    <I>Tue Oct 25 17:26:54 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015748.html">[rabbitmq-discuss] RabbitMQ writes non stop to disk
</A></li>
        <LI>Next message: <A HREF="015795.html">[rabbitmq-discuss] RabbitMQ writes non stop to disk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15752">[ date ]</a>
              <a href="thread.html#15752">[ thread ]</a>
              <a href="subject.html#15752">[ subject ]</a>
              <a href="author.html#15752">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Interesting we did not disable it. What is the flip side of doing this?

--
Raphael.

On Tue, Oct 25, 2011 at 8:57 AM, Aaron Westendorf &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aaron at agoragames.com</A>&gt;wrote:

&gt;<i> Did you disable vm_memory_high_watermark ?  I've attached graphs of
</I>&gt;<i> our disk usage before and after we enabled it.
</I>&gt;<i>
</I>&gt;<i> -Aaron
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mon, Oct 24, 2011 at 9:07 PM, Raphael Simon &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">raphael at rightscale.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; Hello all,
</I>&gt;<i> &gt; We are seeing an issue on a production broker where the RabbitMQ process
</I>&gt;<i> &gt; writes non stop to files in mnesia/&lt;node&gt;/msg_store_persistent. It keeps
</I>&gt;<i> &gt; creating new files and the problem seems to be getting worse. Listing the
</I>&gt;<i> &gt; files in that directory shows that it's creating a new 16 MB file every
</I>&gt;<i> 2 to
</I>&gt;<i> &gt; 4 minutes [1].
</I>&gt;<i> &gt; The throughput of persistent messages in this broker is orders of
</I>&gt;<i> magnitude
</I>&gt;<i> &gt; less (maybe 20 msg/sec at the most, each being in the 10s of KB) .
</I>&gt;<i> &gt; Attaching a shell to the broker process I can retrieve the process
</I>&gt;<i> status of
</I>&gt;<i> &gt; the msg_store_persistent server which is the process causing all the
</I>&gt;<i> writes,
</I>&gt;<i> &gt; not sure what to look for though [2].
</I>&gt;<i> &gt; There are about 100 messages sitting in queues on that broker so that
</I>&gt;<i> should
</I>&gt;<i> &gt; not cause that many writes, iostat shows about 6000 writes/s.
</I>&gt;<i> &gt; Any pointers to where we should be looking would be greatly appreciated.
</I>&gt;<i> &gt; Thanks!
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Raphael.
</I>&gt;<i> &gt; [1]
</I>&gt;<i> &gt; # ls -alt /mnt/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at broker1-1</A>/msg_store_persistent
</I>&gt;<i> &gt; total 453196
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq  2973011 2011-10-25 00:55 706.rdq
</I>&gt;<i> &gt; drwxr-xr-x 5 rabbitmq rabbitmq     4096 2011-10-25 00:54 ..
</I>&gt;<i> &gt; drwxr-xr-x 2 rabbitmq rabbitmq     4096 2011-10-25 00:53 .
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16779002 2011-10-25 00:49 704.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16779064 2011-10-25 00:44 703.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16778786 2011-10-25 00:39 702.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16780428 2011-10-25 00:33 701.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16779981 2011-10-25 00:28 700.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16779550 2011-10-25 00:24 699.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16780493 2011-10-25 00:21 698.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16777711 2011-10-25 00:17 697.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16782704 2011-10-25 00:13 696.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq     8991 2011-10-25 00:10 669.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq     8861 2011-10-25 00:10 667.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    10469 2011-10-25 00:10 665.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    54123 2011-10-25 00:10 662.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    61457 2011-10-25 00:10 658.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq     6040 2011-10-25 00:10 654.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 13115149 2011-10-25 00:10 634.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16779265 2011-10-25 00:09 695.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16808918 2011-10-25 00:03 694.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16802844 2011-10-24 23:55 690.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16793271 2011-10-24 23:55 689.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16810749 2011-10-24 23:54 688.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16780809 2011-10-24 23:51 683.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16779742 2011-10-24 23:49 682.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16778746 2011-10-24 23:44 681.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16793650 2011-10-24 23:40 680.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16782092 2011-10-24 23:35 679.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16788239 2011-10-24 23:31 678.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16780959 2011-10-24 23:26 677.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16779952 2011-10-24 23:17 675.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16777823 2011-10-24 23:05 672.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16779687 2011-10-24 23:02 671.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 17559554 2011-10-24 20:52 633.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    11847 2011-10-24 20:41 612.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 16100804 2011-10-24 20:41 523.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    11314 2011-10-24 18:39 576.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    28514 2011-10-24 18:16 565.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    17823 2011-10-24 17:24 561.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    14774 2011-10-24 13:25 528.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq 10864262 2011-10-24 13:25 0.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    35908 2011-10-24 13:15 491.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    48383 2011-10-24 13:06 487.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    11912 2011-10-24 12:50 484.rdq
</I>&gt;<i> &gt; -rw-r--r-- 1 rabbitmq rabbitmq    23881 2011-10-24 06:06 437.rdq
</I>&gt;<i> &gt; [2]
</I>&gt;<i> &gt; {status,&lt;0.237.0&gt;,
</I>&gt;<i> &gt;         {module,gen_server2},
</I>&gt;<i> &gt;         [[{{#Ref&lt;0.0.3588.227656&gt;,fhc_handle},
</I>&gt;<i> &gt;            {handle,{file_descriptor,prim_file,{#Port&lt;0.712982&gt;,109}},
</I>&gt;<i> &gt;                    14469207,14469207,false,0,1048576,[],true,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  &quot;/mnt/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at broker1-1</A>/msg_store_persistent/702.rdq&quot;,
</I>&gt;<i> &gt;                    [raw,binary,write],
</I>&gt;<i> &gt;                    [{write_buffer,1048576}],
</I>&gt;<i> &gt;                    true,false,
</I>&gt;<i> &gt;                    {1319,503146,31340}}},
</I>&gt;<i> &gt;           {'$ancestors',[rabbit_sup,&lt;0.73.0&gt;]},
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; {{&quot;/mnt/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at broker1-1</A>/msg_store_persistent/702.rdq&quot;,
</I>&gt;<i> &gt;             fhc_file},
</I>&gt;<i> &gt;            {file,0,true}},
</I>&gt;<i> &gt;           {fhc_age_tree,{1,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  {{1319,503146,31340},#Ref&lt;0.0.3588.227656&gt;,nil,nil}}},
</I>&gt;<i> &gt;           {'$initial_call',{gen,init_it,7}}],
</I>&gt;<i> &gt;          running,&lt;0.74.0&gt;,[],
</I>&gt;<i> &gt;          [{header,&quot;Status for generic server msg_store_persistent&quot;},
</I>&gt;<i> &gt;           {data,[{&quot;Status&quot;,running},
</I>&gt;<i> &gt;                  {&quot;Parent&quot;,&lt;0.74.0&gt;},
</I>&gt;<i> &gt;                  {&quot;Logged events&quot;,[]},
</I>&gt;<i> &gt;                  {&quot;Queued messages&quot;,[]}]},
</I>&gt;<i> &gt;           {data,[{&quot;State&quot;,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; {msstate,&quot;/mnt/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at broker1-1</A>/msg_store_persistent&quot;,
</I>&gt;<i> &gt;                            rabbit_msg_store_ets_index,
</I>&gt;<i> &gt;                            {state,262201,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &quot;/mnt/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at broker1-1</A>/msg_store_persistent&quot;},
</I>&gt;<i> &gt;                            702,#Ref&lt;0.0.3588.227656&gt;,
</I>&gt;<i> &gt;                            {dict,0,16,16,8,80,48,
</I>&gt;<i> &gt;
</I>&gt;<i>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                   [],[]},
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                    [],[]}}},
</I>&gt;<i> &gt;                            [],undefined,53527675,424756530,[],&lt;0.240.0&gt;,
</I>&gt;<i> &gt;                            266298,258104,270395,
</I>&gt;<i> &gt;                            {set,0,16,16,8,80,48,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                  []},
</I>&gt;<i> &gt;
</I>&gt;<i> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                   [],[]}}},
</I>&gt;<i> &gt;                            {dict,24974,6019,8192,4096,30095,18057,
</I>&gt;<i> &gt;
</I>&gt;<i>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                   [],[]},
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  {{[[&lt;&lt;109,81,35,172,101,10,100,5,139,235,37,
</I>&gt;<i> &gt;                                        207,134,159,97,123&gt;&gt;|
</I>&gt;<i> &gt;
</I>&gt;<i>  {#Fun&lt;rabbit_variable_queue.1.360644&gt;,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #Fun&lt;rabbit_variable_queue.20.77393657&gt;}],
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [&lt;&lt;98,60,3,61,105,99,34,128,158,37,55,121,
</I>&gt;<i> &gt;                                        53,68,253,77&gt;&gt;|
</I>&gt;<i> &gt;
</I>&gt;<i>  {#Fun&lt;rabbit_variable_queue.1.360644&gt;,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #Fun&lt;rabbit_variable_queue.20.77393657&gt;}],
</I>&gt;<i> &gt;
</I>&gt;<i> [&lt;&lt;224,253,10,145,132,16,186,61,192,63,
</I>&gt;<i> &gt; ..... lots of stuff snipped ....
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                    [],[]},
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                    [],[]}}},
</I>&gt;<i> &gt;                            false,16777216,
</I>&gt;<i> &gt;                            {dict,0,16,16,8,80,48,
</I>&gt;<i> &gt;
</I>&gt;<i>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                   [],[]},
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> &gt;                                    [],[]}}}}}]}]]}
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Aaron Westendorf
</I>&gt;<i> Senior Software Engineer
</I>&gt;<i> Agora Games
</I>&gt;<i> 359 Broadway
</I>&gt;<i> Troy, NY 12180
</I>&gt;<i> Phone: 518.268.1000
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aaron at agoragames.com</A>
</I>&gt;<i> www.agoragames.com
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/82fbd4df/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/82fbd4df/attachment.htm</A>&gt;
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015748.html">[rabbitmq-discuss] RabbitMQ writes non stop to disk
</A></li>
	<LI>Next message: <A HREF="015795.html">[rabbitmq-discuss] RabbitMQ writes non stop to disk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15752">[ date ]</a>
              <a href="thread.html#15752">[ thread ]</a>
              <a href="subject.html#15752">[ subject ]</a>
              <a href="author.html#15752">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
