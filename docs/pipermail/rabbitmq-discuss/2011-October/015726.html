<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ writes non stop to disk
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20writes%20non%20stop%20to%20disk&In-Reply-To=%3C4EA675C8.70903%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015721.html">
   <LINK REL="Next"  HREF="015749.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ writes non stop to disk</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20writes%20non%20stop%20to%20disk&In-Reply-To=%3C4EA675C8.70903%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ writes non stop to disk">emile at rabbitmq.com
       </A><BR>
    <I>Tue Oct 25 09:39:36 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015721.html">[rabbitmq-discuss] RabbitMQ writes non stop to disk
</A></li>
        <LI>Next message: <A HREF="015749.html">[rabbitmq-discuss] RabbitMQ writes non stop to disk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15726">[ date ]</a>
              <a href="thread.html#15726">[ thread ]</a>
              <a href="subject.html#15726">[ subject ]</a>
              <a href="author.html#15726">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Raphael,

On 25/10/11 02:07, Raphael Simon wrote:
&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> We are seeing an issue on a production broker where the RabbitMQ process
</I>&gt;<i> writes non stop to files in mnesia/&lt;node&gt;/msg_store_persistent. It keeps
</I>&gt;<i> creating new files and the problem seems to be getting worse. Listing
</I>&gt;<i> the files in that directory shows that it's creating a new 16 MB file
</I>&gt;<i> every 2 to 4 minutes [1].
</I>&gt;<i> 
</I>&gt;<i> The throughput of persistent messages in this broker is orders of
</I>&gt;<i> magnitude less (maybe 20 msg/sec at the most, each being in the 10s of KB) .
</I>
&gt;<i> There are about 100 messages sitting in queues on that broker so that
</I>&gt;<i> should not cause that many writes, iostat shows about 6000 writes/s.
</I>
How did you determine this number? Is it constant? I would expect the
behaviour you describe when some queues keep growing or when the broker
needs to free up alot of memory.

If the broker is running rabbit version 2.5.0 or later, could you please
supply the result of &quot;rabbitmqctl report&quot;?

If it is an older version please run &quot;rabbitmqctl list_queues&quot; with all
queueinfoitems, and supply both the query and the result. The result of
&quot;erlang:memory().&quot; from the Erlang shell will also be helpful, as well
as a copy of the rabbit configuration file, if you have made any
relevant changes.

Are there any unusual entries in the broker logfile? How often does the
memory alarm trigger? Are there any entries that appear at the onset of
the disk activity?


-Emile

</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015721.html">[rabbitmq-discuss] RabbitMQ writes non stop to disk
</A></li>
	<LI>Next message: <A HREF="015749.html">[rabbitmq-discuss] RabbitMQ writes non stop to disk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15726">[ date ]</a>
              <a href="thread.html#15726">[ thread ]</a>
              <a href="subject.html#15726">[ subject ]</a>
              <a href="author.html#15726">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
