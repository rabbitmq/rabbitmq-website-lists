<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mirror queues and poor write performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirror%20queues%20and%20poor%20write%20performance&In-Reply-To=%3C45cb8656-53c9-40e8-83ca-dfa4bd926d69%401g2000vbx.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015819.html">
   <LINK REL="Next"  HREF="015787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mirror queues and poor write performance</H1>
    <B>Anderew</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirror%20queues%20and%20poor%20write%20performance&In-Reply-To=%3C45cb8656-53c9-40e8-83ca-dfa4bd926d69%401g2000vbx.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Mirror queues and poor write performance">andrew.rendell at gmail.com
       </A><BR>
    <I>Thu Oct 27 23:18:14 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015819.html">[rabbitmq-discuss] Mirror queues and poor write performance
</A></li>
        <LI>Next message: <A HREF="015787.html">[rabbitmq-discuss]  &quot;sockets module&quot; for rabbitmq.js example
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15839">[ date ]</a>
              <a href="thread.html#15839">[ thread ]</a>
              <a href="subject.html#15839">[ subject ]</a>
              <a href="author.html#15839">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the information, that is very useful.

The problem was my test. I had a large pool of consumers but was
single threading the producer on the theory that whilst TPS is very
important for the application I work with, the latency if an
individual operation is also critical. With a small change to use a
pool of producers I can get a far more acceptable rate.

Using multiple producers and consumers, running on a single processor,
dual core i7 I was able to achieve close to 850 transactional messages
per second with the consumer emptying the queues quickly enough that
queues lengths as you describe were always very close to zero. For the
same setup with a non-mirrored queue I was able to get 1400 messages
per second. This is much closer to the kind of performance difference
I was expecting. Given the relatively low power of the test machine
this is very good.

(At the risk of exposing my stupidity) I still don't quite understand
why the single threaded test was so poor with the mirror queue
compared to the non mirrored queue. My timings indicated that a single
threaded producer, with no concurrent consumers, would publish one
(transacted) message every five milliseconds for non-mirrored and one
per forty milliseconds for mirrored.

Thanks again for your help and for an excellent product!

Regards, Andrew.

On Oct 27, 2:41&#160;pm, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matt... at rabbitmq.com</A>&gt; wrote:
&gt;<i> On Thu, Oct 27, 2011 at 02:37:47PM +0100, Matthew Sackman wrote:
</I>&gt;<i> &gt; At least in the first instance, HA has been designed to be write
</I>&gt;<i>
</I>&gt;<i> write =&gt; right.
</I>&gt;<i>
</I>&gt;<i> I shall have to have myself flogged for that one.
</I>&gt;<i>
</I>&gt;<i> Matthew.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015819.html">[rabbitmq-discuss] Mirror queues and poor write performance
</A></li>
	<LI>Next message: <A HREF="015787.html">[rabbitmq-discuss]  &quot;sockets module&quot; for rabbitmq.js example
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15839">[ date ]</a>
              <a href="thread.html#15839">[ thread ]</a>
              <a href="subject.html#15839">[ subject ]</a>
              <a href="author.html#15839">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
