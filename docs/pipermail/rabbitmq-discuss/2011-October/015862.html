<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue size of the mirrored queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20size%20of%20the%20mirrored%20queue&In-Reply-To=%3C20111028143812.GB30623%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015856.html">
   <LINK REL="Next"  HREF="015857.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue size of the mirrored queue</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20size%20of%20the%20mirrored%20queue&In-Reply-To=%3C20111028143812.GB30623%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Queue size of the mirrored queue">matthew at rabbitmq.com
       </A><BR>
    <I>Fri Oct 28 15:38:12 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015856.html">[rabbitmq-discuss] Queue size of the mirrored queue
</A></li>
        <LI>Next message: <A HREF="015857.html">[rabbitmq-discuss] Queue depth and no. of consumers.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15862">[ date ]</a>
              <a href="thread.html#15862">[ thread ]</a>
              <a href="subject.html#15862">[ subject ]</a>
              <a href="author.html#15862">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Melvin,

On Fri, Oct 28, 2011 at 04:53:09AM -0700, ||M|| wrote:
&gt;<i> At this moment I'm testing the HA active/active setup of rabbitMQ to
</I>&gt;<i> see if we can replace or current messagging solution with it. I
</I>&gt;<i> created the clustered on 2virutal machines and I must say I like what
</I>&gt;<i> I see so far.
</I>
That's great to hear!

&gt;<i> I just have 1 question. Is it correct that I can't see the number of
</I>&gt;<i> messages that are in my durable queue when is processing. When I sent
</I>&gt;<i> (for example) 1.000.000 messages to the queue (using the fanout
</I>&gt;<i> exchange with 1 queue bind) with my publisher it will take some time,
</I>&gt;<i> but when it's done the subscribers are still receiving, because this
</I>&gt;<i> is not so fast as the publishing it will take much more time. But the
</I>&gt;<i> queue size is 3 messages at most.
</I>
Ahh, what's going on is that the messages will be being buffered
internally before they get to the queue. Messages within Rabbit pass
between a number of different erlang processes. The process that spends
the most CPU per message will have the biggest backlog of these
messages. In the case of mirrored queues, it's definitely the queue
itself that'll be spending the most CPU per message.

Thus the queue will be receiving each message, processing it (including
all the HA gubbins), and then sending it out to the consumers as fast as
it can, but &quot;as fast as it can&quot; will still be slower than any other
process dealing with those messages within Rabbit. Thus there'll be a
backlog of messages building up immediately before the queue.

If you disable the consumers then you'll see the queue grow in length,
but again, your publisher may well report that it's published all 1e6
msgs before 1e6 msgs make it into the queue proper. This is the same
thing.

&gt;<i> It's not very imported because it just the interface, but I'm a little
</I>&gt;<i> bit concurred about where this message are if the management interface
</I>&gt;<i> (and the command line tool) can see them anywhere.
</I>
The numbers in the mgmt and command line are the numbers each actual
queue reports, thus precludes any internal backlog.

Hope that helps,

Matthew
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015856.html">[rabbitmq-discuss] Queue size of the mirrored queue
</A></li>
	<LI>Next message: <A HREF="015857.html">[rabbitmq-discuss] Queue depth and no. of consumers.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15862">[ date ]</a>
              <a href="thread.html#15862">[ thread ]</a>
              <a href="subject.html#15862">[ subject ]</a>
              <a href="author.html#15862">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
