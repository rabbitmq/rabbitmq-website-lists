<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mirror queues and poor write performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirror%20queues%20and%20poor%20write%20performance&In-Reply-To=%3C20111027133746.GA22379%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015805.html">
   <LINK REL="Next"  HREF="015819.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mirror queues and poor write performance</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirror%20queues%20and%20poor%20write%20performance&In-Reply-To=%3C20111027133746.GA22379%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Mirror queues and poor write performance">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Oct 27 14:37:47 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015805.html">[rabbitmq-discuss] Mirror queues and poor write performance
</A></li>
        <LI>Next message: <A HREF="015819.html">[rabbitmq-discuss] Mirror queues and poor write performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15818">[ date ]</a>
              <a href="thread.html#15818">[ thread ]</a>
              <a href="subject.html#15818">[ subject ]</a>
              <a href="author.html#15818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Andrew,

On Wed, Oct 26, 2011 at 11:02:13PM -0700, Anderew wrote:
&gt;<i> It sounds from your description that what I am seeing is unexpected
</I>&gt;<i> and therefore probably an error somewhere on my part. I will go back
</I>&gt;<i> to my test code and re-investigate. Thanks for the response!
</I>
Ok, I've been doing some testing.

Everything on one box (no VMs) which is a 4-core (8 thread) CPU.

With a cluster of 2 nodes, simultaneously publishing and consuming,
0-length transient msgs to non-durable queues. I can do a sustained rate
(i.e. the queue pretty much stays empty) of 2500 msgs/second. It's a
little slower if the master is not on the node to which I connect
(around 2300Hz). I'm not using publisher confirms in those tests, but
some quick testing with confirms on (and a fairly large window of 1000)
shows that there's apparently no impact by using confirms.

Yes, this is around an order of magnitude (base 10) slower than without
HA for the same scenario.

It does absorb spikes fairly well though - throwing various spikes of
publishes at it do get absorbed - the consumer just sees slightly more
messages for a while and then the queue again returns to being empty.

At least in the first instance, HA has been designed to be write
rather than fast. There may well be a number of opportunities for
optimisations further down the line.

Matthew
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015805.html">[rabbitmq-discuss] Mirror queues and poor write performance
</A></li>
	<LI>Next message: <A HREF="015819.html">[rabbitmq-discuss] Mirror queues and poor write performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15818">[ date ]</a>
              <a href="thread.html#15818">[ thread ]</a>
              <a href="subject.html#15818">[ subject ]</a>
              <a href="author.html#15818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
