<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq%202.6.1%20cluster%20failure%20recovery&In-Reply-To=%3C4E899BFF.6060303%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015345.html">
   <LINK REL="Next"  HREF="015354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq%202.6.1%20cluster%20failure%20recovery&In-Reply-To=%3C4E899BFF.6060303%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery">simon at rabbitmq.com
       </A><BR>
    <I>Mon Oct  3 12:26:55 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015345.html">[rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery
</A></li>
        <LI>Next message: <A HREF="015354.html">[rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15352">[ date ]</a>
              <a href="thread.html#15352">[ thread ]</a>
              <a href="subject.html#15352">[ subject ]</a>
              <a href="author.html#15352">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alain.

When you see timeout_waiting_for_tables, that should mean that the node 
you're trying to start:

* Could not find any other cluster nodes running

* Was not the last node to shut down

 From your explanation it sounds like node-1 *is* running while you 
restart node-2 - is that correct? In that case, can node-2 definitely 
see node-1? (i.e. it can ping cumulonimbus)

Cheers, Simon

On 01/10/11 01:25, Alain Dazzi wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I can't get my rabbitmq cluster to recover from a dead node. So
</I>&gt;<i> perhaps someone can help ...
</I>&gt;<i>
</I>&gt;<i> node-1 (cumulonimbus)
</I>&gt;<i> Linux cumulonimbus 2.6.38-11-server #50-Ubuntu SMP Mon Sep 12 21:34:27
</I>&gt;<i> UTC 2011 x86_64 x86_64 x86_64 GNU/Linux
</I>&gt;<i> ii  rabbitmq-server                       2.6.1-1
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at cumulonimbus</A>:~# ls -1 /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/plugins/
</I>&gt;<i> amqp_client-2.6.1.ez
</I>&gt;<i> mochiweb-1.3-rmq2.6.1-git9a53dbd.ez
</I>&gt;<i> rabbitmq_management-2.6.1.ez
</I>&gt;<i> rabbitmq_management_agent-2.6.1.ez
</I>&gt;<i> rabbitmq_management_visualiser-2.6.1.ez
</I>&gt;<i> rabbitmq_mochiweb-2.6.1.ez
</I>&gt;<i> README
</I>&gt;<i> webmachine-1.7.0-rmq2.6.1-hg0c4b60a.ez
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> node-2 (nuage-informatique)
</I>&gt;<i> Linux nuage-informatique 2.6.38-11-generic #50-Ubuntu SMP Mon Sep 12
</I>&gt;<i> 21:17:25 UTC 2011 x86_64 x86_64 x86_64 GNU/Linux
</I>&gt;<i> ii  rabbitmq-server                       2.6.1-1
</I>&gt;<i>
</I>&gt;<i> 1/ stop both servers and set-up same .erlang_cookie value; restart nodes
</I>&gt;<i>
</I>&gt;<i> 2/ on node1 I create a cluster
</I>&gt;<i>      rabbitmqctl stop_app
</I>&gt;<i>      rabbitmqctl reset
</I>&gt;<i>      rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at nuage-informatique</A> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at cumulonimbus</A>
</I>&gt;<i> Clustering node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at cumulonimbus</A> with ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at nuage-informatique</A>',
</I>&gt;<i>                                            <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at cumulonimbus</A>] ...
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i> 3/ This creates 2 disc nodes !!!
</I>&gt;<i>
</I>&gt;<i> 4/ run a test and pass data successfully
</I>&gt;<i>
</I>&gt;<i> 5/ restart node-2 (service rabbitmq-server stop)
</I>&gt;<i> service rabbitmq-server start ... fails with ...
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at nuage-informatique</A>:~/Desktop# service rabbitmq-server start
</I>&gt;<i> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
</I>&gt;<i> rabbitmq-server.
</I>&gt;<i> Erlang has closed
</I>&gt;<i> ^M
</I>&gt;<i> Crash dump was written to: erl_crash.dump^M
</I>&gt;<i> Kernel pid terminated (application_controller)
</I>&gt;<i> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})^M
</I>&gt;<i>
</I>&gt;<i> Activating RabbitMQ plugins ...
</I>&gt;<i> 1 plugins activated:
</I>&gt;<i> * rabbitmq_management_agent-2.6.1
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> +---+   +---+
</I>&gt;<i> |   |   |   |
</I>&gt;<i> |   |   |   |
</I>&gt;<i> |   |   |   |
</I>&gt;<i> |   +---+   +-------+
</I>&gt;<i> |                   |
</I>&gt;<i> | RabbitMQ  +---+   |
</I>&gt;<i> |           |   |   |
</I>&gt;<i> |   v2.6.1  +---+   |
</I>&gt;<i> |                   |
</I>&gt;<i> +-------------------+
</I>&gt;<i> AMQP 0-9-1 / 0-9 / 0-8
</I>&gt;<i> Copyright (C) 2007-2011 VMware, Inc.
</I>&gt;<i> Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
</I>&gt;<i>
</I>&gt;<i> node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at nuage-informatique</A>
</I>&gt;<i> app descriptor :
</I>&gt;<i> /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
</I>&gt;<i> home dir       : /var/lib/rabbitmq
</I>&gt;<i> config file(s) : (none)
</I>&gt;<i> cookie hash    : qHpvLciGsi5o4f8ScVzyWg==
</I>&gt;<i> log            : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at nuage-informatique.log</A>
</I>&gt;<i> sasl log       : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at nuage-informatique-sasl.log</A>
</I>&gt;<i> database dir   : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at nuage-informatique</A>
</I>&gt;<i> erlang version : 5.7.4
</I>&gt;<i>
</I>&gt;<i> -- rabbit boot start
</I>&gt;<i> starting file handle cache server                                     ...done
</I>&gt;<i> starting worker pool                                                  ...done
</I>&gt;<i> starting database
</I>&gt;<i> ...BOOT ERROR: FAILED
</I>&gt;<i> Reason: {error,
</I>&gt;<i>              {timeout_waiting_for_tables,
</I>&gt;<i>                  [rabbit_user,rabbit_user_permission,rabbit_vhost,
</I>&gt;<i>                   rabbit_durable_route,rabbit_durable_exchange,
</I>&gt;<i>                   rabbit_durable_queue]}}
</I>&gt;<i> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
</I>&gt;<i>               {rabbit_mnesia,check_schema_integrity,0},
</I>&gt;<i>               {rabbit_mnesia,ensure_schema_integrity,0},
</I>&gt;<i>               {rabbit_mnesia,init,0},
</I>&gt;<i>               {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
</I>&gt;<i>               {rabbit,run_boot_step,1},
</I>&gt;<i>               {rabbit,'-start/2-lc$^0/1-0-',1},
</I>&gt;<i>               {rabbit,start,2}]
</I>&gt;<i> {&quot;Kernel pid terminated&quot;,application_controller,&quot;{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}&quot;}^M
</I>&gt;<i>
</I>&gt;<i> At this point I have to re-install node-2 to recover.
</I>&gt;<i>
</I>&gt;<i> Any idea why?
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> next I would like to test mirrored q but obviously this has to work first...
</I>&gt;<i>
</I>&gt;<i> -Alain
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015345.html">[rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery
</A></li>
	<LI>Next message: <A HREF="015354.html">[rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15352">[ date ]</a>
              <a href="thread.html#15352">[ thread ]</a>
              <a href="subject.html#15352">[ subject ]</a>
              <a href="author.html#15352">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
