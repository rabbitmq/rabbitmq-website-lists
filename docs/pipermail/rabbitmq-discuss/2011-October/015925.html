<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%20Consumer%0A%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3CCAGWz9vUwmOdg9TibndZ%2BUE4Vz1Btyz95CmTf1Xu%3Dm0H4ONe6qw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015926.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large</H1>
    <B>Cameron Davison</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%20Consumer%0A%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3CCAGWz9vUwmOdg9TibndZ%2BUE4Vz1Btyz95CmTf1Xu%3Dm0H4ONe6qw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large">cameron.davison at gmail.com
       </A><BR>
    <I>Mon Oct 31 23:24:02 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015926.html">[rabbitmq-discuss] PossibleAuthenticationFailureError
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15925">[ date ]</a>
              <a href="thread.html#15925">[ thread ]</a>
              <a href="subject.html#15925">[ subject ]</a>
              <a href="author.html#15925">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am using RabbitMQ version 2.6.1 of the server.

I created a durable direct exchange with the java client and then
declared a durable, not exclusive, not autoDelete queue and then bound
the exchange and the queue together. Then I set confirm select to true
to start writing messages to the queue. I am publishing messages to
the broker in batches of 2000 as MINIMAL_PERSISTENT_BASIC and the
calling channel.waitForConfirms() to block until all the messages have
been confirmed. This works rather well with an empty queue with a
consumer, and when there is no consumer present. I then setup a
basicConsumer as a QueueingConsumer with ack=true. I am acking every
1k messages I receive with multiple set to true. I am reading and
writing basically as fast as possible, not much code in the critical
path, just to test that RabbitMQ works as I would expect.

I start the writer process to start writing and waiting for confirms
from rabbit and it starts fine. After about 30 seconds, so at this
point many messages have been queued up in the queue, I start the
reader. As soon as I start the reader the writer process stops
receiving confirms. I can even see in the management console that it
shows the 2000 confirms that the writer channel is waiting on. I tried
restarting the writer but it still does not get any confirms while the
reader process is reading from rabbitmq. It will stay like this until
the reader empties the queue and I assume starts acking things that
were written so the confirms are coming from the consumer ack rather
than the writes to disk. Is this expected behavior? Do I have it
configured to not fsync to disk while there is a consumer reading the
messages, would that even possible?

Thanks,
Cameron
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015926.html">[rabbitmq-discuss] PossibleAuthenticationFailureError
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15925">[ date ]</a>
              <a href="thread.html#15925">[ thread ]</a>
              <a href="subject.html#15925">[ subject ]</a>
              <a href="author.html#15925">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
