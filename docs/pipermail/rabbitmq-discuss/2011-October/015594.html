<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Highest Reliability simple publish to a queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Highest%20Reliability%20simple%20publish%20to%20a%20queue&In-Reply-To=%3C4E9EA9C6.10809%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015595.html">
   <LINK REL="Next"  HREF="015600.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Highest Reliability simple publish to a queue</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Highest%20Reliability%20simple%20publish%20to%20a%20queue&In-Reply-To=%3C4E9EA9C6.10809%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Highest Reliability simple publish to a queue">simon at rabbitmq.com
       </A><BR>
    <I>Wed Oct 19 11:43:18 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015595.html">[rabbitmq-discuss] Highest Reliability simple publish to a queue
</A></li>
        <LI>Next message: <A HREF="015600.html">[rabbitmq-discuss] Highest Reliability simple publish to a queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15594">[ date ]</a>
              <a href="thread.html#15594">[ thread ]</a>
              <a href="subject.html#15594">[ subject ]</a>
              <a href="author.html#15594">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/10/11 15:16, Matt G wrote:
&gt;<i> So far it appears to me that I should use the following, can you
</I>&gt;<i> review my list and edit as necessary:
</I>&gt;<i> Durable exchange
</I>&gt;<i> ExchangeType.Direct
</I>&gt;<i> Durable queue
</I>&gt;<i> Persistent message (Delivery Mode = 2)
</I>&gt;<i> Mandatory message
</I>&gt;<i> Model/Channel.ConfirmSelect&amp;   Model.WaitForConfirmsOrDie();
</I>
Sure, makes sense. The only thing that's unusual in your case is the use 
of mandatory in order to test if the queue has been unbound. Normally I 
would say &quot;well, don't unbind it then&quot;, this is not the sort of thing 
that will happen spontaneously :)

If you know the name of the queue you want to publish to then an 
alternative would be to publish via the default exchange. Since queues 
are always implicitly bound to the default exchange you could lose the 
use of &quot;mandatory&quot; there. Assuming you are not going to delete the queue 
in question...

&gt;<i> I also setup event handlers BasicAcks, BasicNacks&amp;  BasicReturn.
</I>&gt;<i> If for testing purposes I unbind the queue from the exchange, and send
</I>&gt;<i> a single message,  I get a BasicAck and a BasicReturn(NO_ROUTE) back,
</I>&gt;<i> however the Model.WaitForConfirmsOrDie() returns without error.
</I>
Yes, WaitForConfirmsOrDie() is just counting acks aka confirms. 
Basic.return is a different thing. RabbitMQ will ensure that by the time 
you get an ack back, you will have received a basic.return if one was 
going to be sent.

&gt;<i> This
</I>&gt;<i> seems inconsistent in that my message has been lost as there is no
</I>&gt;<i> queue bound to the exchange and I have specified mandatory and every
</I>&gt;<i> persistent option I can find. Is this correct, or am I doing something
</I>&gt;<i> wrong? Do I need to do/check both (WaitForConfirms&amp;  BasicReturn event
</I>&gt;<i> msg) to be sure the message was successfully delivered to the queue?
</I>
Yes.

The meaning of a confirm is &quot;RabbitMQ has taken responsibility for the 
message, and handled it in whatever way it was meant to be handled&quot;. If 
that means dropping it on the floor as unrouted then so be it - the 
assumption is that the routing is set up how you wanted it. manadtory / 
basic.return then adds on top of that the ability to check that a 
message got routed somewhere.

&gt;<i> Where is the documentation for API calls which are not documented in
</I>&gt;<i> the API doc, an example is WaitForConfirmsOrDie, but there are many
</I>&gt;<i> others?
</I>
Hmm. The HTMLdoc for those is not coming through. Looks like invalid 
XML. Will file a bug.

It's in the source:
<A HREF="http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/rabbitmq_v2_6_1/projects/client/RabbitMQ.Client/src/client/api/IModel.cs#l320">http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/rabbitmq_v2_6_1/projects/client/RabbitMQ.Client/src/client/api/IModel.cs#l320</A>

&gt;<i> I read one of the other posts directing people away from transactions
</I>&gt;<i> and towards the Model/Channel.ConfirmSelect&amp;
</I>&gt;<i> Model.WaitForConfirmsOrDie() model, so I have not investigated
</I>&gt;<i> transactions.
</I>
That's reasonable.

&gt;<i> What about connection heart beating? I know from my experience with
</I>&gt;<i> other products HB's are good way to keep the client and server in-sync
</I>&gt;<i> and aware if the other party has gone off line. Should I overwrite the
</I>&gt;<i> default which appears to be no heartbeats?
</I>
Yes, that would be reasonable. Depends on whether you're more concerned 
about a short connectivity loss killing your connections or a long one 
going undetected...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015595.html">[rabbitmq-discuss] Highest Reliability simple publish to a queue
</A></li>
	<LI>Next message: <A HREF="015600.html">[rabbitmq-discuss] Highest Reliability simple publish to a queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15594">[ date ]</a>
              <a href="thread.html#15594">[ thread ]</a>
              <a href="subject.html#15594">[ subject ]</a>
              <a href="author.html#15594">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
