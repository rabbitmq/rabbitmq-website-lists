<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Creating mirrored queues via STOMP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Creating%20mirrored%20queues%20via%20STOMP&In-Reply-To=%3CFE11CEF9-AEE7-4D43-983C-C5E99CA29346%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015650.html">
   <LINK REL="Next"  HREF="015623.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Creating mirrored queues via STOMP</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Creating%20mirrored%20queues%20via%20STOMP&In-Reply-To=%3CFE11CEF9-AEE7-4D43-983C-C5E99CA29346%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Creating mirrored queues via STOMP">steve at rabbitmq.com
       </A><BR>
    <I>Fri Oct 21 15:28:26 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015650.html">[rabbitmq-discuss] Creating mirrored queues via STOMP
</A></li>
        <LI>Next message: <A HREF="015623.html">[rabbitmq-discuss] retry count and retry delay?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15667">[ date ]</a>
              <a href="thread.html#15667">[ thread ]</a>
              <a href="subject.html#15667">[ subject ]</a>
              <a href="author.html#15667">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Toby,

If the queue structure is fixed then the STOMP adapter 
need not create them, and so it might be sensible to 
create them beforehand, and use STOMP destinations of 
/amq/queue/&lt;name&gt; as I suggested.  

Instead of using STOMP to create them, create some 
shared queues using a richer protocol, say with the 
Java Client, or the Erlang Client, or even Python 
(gasp). The queue headers are then arbitrary and the 
STOMP applications will only have to SEND and 
SUBSCRIBE to the /amq/destinations and not be 
concerned with any operational characteristics of the 
queues.

The (slight) downside is that the queues are managed
separately from the main apps, and you might have some
more operational steps at restart/backup/upgrade
events to consider. I'm morally certain you already 
have a place to put those extra steps.
 
Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 21 Oct 2011, at 08:24, Toby Corkindale wrote:

&gt;<i> On 21/10/11 01:53, Steve Powell wrote:
</I>&gt;&gt;<i> Hi Toby,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Unfortunately it is not possible to set ha policy or ttl
</I>&gt;&gt;<i> settings on a rabbit STOMP-created queue. [1] [2]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> However, it is possible to send to and subscribe from
</I>&gt;&gt;<i> a queue created in AMQP using /amq/queue/&lt;name&gt;
</I>&gt;&gt;<i> destinations inSTOMP. These queues can have any of the
</I>&gt;&gt;<i> rabbit-supported properties.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> We currently have an enhancement under discussion that
</I>&gt;&gt;<i> puts these headers on SUBSCRIBE or SEND, so that the
</I>&gt;&gt;<i> STOMP adapter can create the right sort of queue; but
</I>&gt;&gt;<i> we are not sure what to do if the header values disagree
</I>&gt;&gt;<i> on two commands referring to the &quot;same&quot; queue.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The STOMP protocol design makes it hard to define queue
</I>&gt;&gt;<i> properties, as opposed to message properties, since
</I>&gt;&gt;<i> queue-creation is implicit and conditional. It would be
</I>&gt;&gt;<i> a surprise if one application sets a queue property and
</I>&gt;&gt;<i> another removes it or resets it (or fails if the property
</I>&gt;&gt;<i> is different).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> A description of your application which requires this
</I>&gt;&gt;<i> would help us with future design.
</I>&gt;<i> 
</I>&gt;<i> Hi Steve,
</I>&gt;<i> It's nothing terribly complex.
</I>&gt;<i> 
</I>&gt;<i> There are several applications which generate task requests; they generate hundreds of these very rapidly, but only from time to time.
</I>&gt;<i> 
</I>&gt;<i> The tasks go through several stages. Each stage has some application servers that are subscribed to a queue to process precisely one request, then enqueue a new message for the next stage.
</I>&gt;<i> 
</I>&gt;<i> RabbitMQ works to hold the queue of pending tasks at each stage. Each stage has a separate queue. The backlog of messages surges up to a few hundred, then back down to zero as they get processed.
</I>&gt;<i> 
</I>&gt;<i> It all works quite nicely, but if I power off one of the two nodes in our rabbitmq cluster, then there's a 50% chance we have just lost all the messages in some queues. The messages are all marked as persistent, so as long as the machine recovers, they'll be safe.. but there's still a pause until you fix the machine.
</I>&gt;<i> 
</I>&gt;<i> So I was thinking the mirrored queues would work well for us - if a machine dies, then it's OK, messages will still carry on being processed out of the backlog.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Toby
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111021/4b5ea5f5/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111021/4b5ea5f5/attachment.htm</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015650.html">[rabbitmq-discuss] Creating mirrored queues via STOMP
</A></li>
	<LI>Next message: <A HREF="015623.html">[rabbitmq-discuss] retry count and retry delay?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15667">[ date ]</a>
              <a href="thread.html#15667">[ thread ]</a>
              <a href="subject.html#15667">[ subject ]</a>
              <a href="author.html#15667">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
