<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Java RabbitMQ API bug in	response.getHeaders()?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Java%20RabbitMQ%20API%20bug%20in%0A%09response.getHeaders%28%29%3F&In-Reply-To=%3C4EA98593.8030207%40niclabs.cl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015825.html">
   <LINK REL="Next"  HREF="015828.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Java RabbitMQ API bug in	response.getHeaders()?</H1>
    <B>Mario Leyton</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Java%20RabbitMQ%20API%20bug%20in%0A%09response.getHeaders%28%29%3F&In-Reply-To=%3C4EA98593.8030207%40niclabs.cl%3E"
       TITLE="[rabbitmq-discuss] Java RabbitMQ API bug in	response.getHeaders()?">mleyton at niclabs.cl
       </A><BR>
    <I>Thu Oct 27 17:23:47 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015825.html">[rabbitmq-discuss] Java RabbitMQ API bug in	response.getHeaders()?
</A></li>
        <LI>Next message: <A HREF="015828.html">[rabbitmq-discuss] Java RabbitMQ API bug in	response.getHeaders()?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15827">[ date ]</a>
              <a href="thread.html#15827">[ thread ]</a>
              <a href="subject.html#15827">[ subject ]</a>
              <a href="author.html#15827">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your quick reply Tony but I completely disagree with your
implementation choice ;-)

If there are no headers, it doesn't matter why, a good API should always
return an empty Map o List and not null because it contaminates the API
user's code.  Instead of simply doing:

Map headers = response.getHeaders();
for(String k: headers.getKeys(){ ... }

The API user has to add the code:

if(headers != null){
   for(String k: headers.getKeys(){ ... }
}

This if(headers != null) has to be added by all API users, even if they
don't care to distinguish between the empty header or unsent header. If
an API user doesn't  add the if, the code actually breaks with a null
pointer exception depending on the message!

If the API user is actually concerned on why the set is empty you can
provide additional info like headerWasSent() to distinguish the
difference. This is actually a lot clearer for maintaining the API
user's code because it is evident that he is testing if the header was
sent or not instead of simply checking as not to through the
nullpointer  exception.

If you are still not convinced, I was convinced myself after reading
Joshua Bloch's Effective Java Programming:

<A HREF="http://java.sun.com/docs/books/effective/toc.html">http://java.sun.com/docs/books/effective/toc.html</A>

Item 43: Return empty arrays or collections, not nulls

Mario Leyton
--
NIC Chile Research Labs


On 10/27/11 1:06 PM, Tony Garnock-Jones wrote:
&gt;<i> On 27 October 2011 10:41, Mario Leyton &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mleyton at niclabs.cl</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>  We are using rabbitmq java client and I believe the following is a bug:
</I>&gt;&gt;<i>
</I>&gt;<i> Nope, it's deliberate. null, here, represents that no headers were sent.
</I>&gt;<i> This is distinct from an empty map being sent. AMQP's basic properties
</I>&gt;<i> structure includes &quot;absent/present&quot; bits for all of the fields; we chose to
</I>&gt;<i> use &quot;null&quot; to represent &quot;missing&quot;, as in this instance it is unambiguous.
</I>&gt;<i> In languages like ML and Haskell we'd use 'whatever option and Maybe
</I>&gt;<i> whatever, respectively. In C, we use a bitmap stored separately from the
</I>&gt;<i> struct members concerned.
</I>&gt;<i>
</I>&gt;<i> So when reading (or writing!) basic properties in Java,
</I>&gt;<i>
</I>&gt;<i>    - null means &quot;missing value&quot; or &quot;no value&quot;
</I>&gt;<i>    - empty map, empty string etc. is a *present* value but is otherwise
</I>&gt;<i>    just itself
</I>&gt;<i>    - non-empty maps, strings, etc are present values
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>   Tony
</I>&gt;<i>
</I>
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015825.html">[rabbitmq-discuss] Java RabbitMQ API bug in	response.getHeaders()?
</A></li>
	<LI>Next message: <A HREF="015828.html">[rabbitmq-discuss] Java RabbitMQ API bug in	response.getHeaders()?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15827">[ date ]</a>
              <a href="thread.html#15827">[ thread ]</a>
              <a href="subject.html#15827">[ subject ]</a>
              <a href="author.html#15827">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
