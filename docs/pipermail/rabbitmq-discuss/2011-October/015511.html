<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] problems updating to new client library
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20problems%20updating%20to%20new%20client%20library&In-Reply-To=%3CCAApCF478UBc1T-Z-vhov3S23qG9sOwLU%2B%3DwPraA4T702vdkD6g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015496.html">
   <LINK REL="Next"  HREF="015525.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] problems updating to new client library</H1>
    <B>Max Warnock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20problems%20updating%20to%20new%20client%20library&In-Reply-To=%3CCAApCF478UBc1T-Z-vhov3S23qG9sOwLU%2B%3DwPraA4T702vdkD6g%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] problems updating to new client library">maxjwarnock at gmail.com
       </A><BR>
    <I>Thu Oct 13 18:17:40 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015496.html">[rabbitmq-discuss]  Frustrated
</A></li>
        <LI>Next message: <A HREF="015525.html">[rabbitmq-discuss] problems updating to new client library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15511">[ date ]</a>
              <a href="thread.html#15511">[ thread ]</a>
              <a href="subject.html#15511">[ subject ]</a>
              <a href="author.html#15511">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've just swapped out the whole amqp_client infrastructure in my erlang
application to the latest release. It looks like there were significant
changes to the infrastructure but the api remains almost identical (the
network vs direct connection being the only exception I've found).  But now
I'm getting an error in code that used to work about my subscription.  My
code looks like this:


%% Queue is a binary name, Listener is a PID and State is a dictionary
containing various things including the channel PID
subscribe(Queue,Listener,State) -&gt;
    Sub = #'basic.consume'{queue = Queue},
    #'basic.consume_ok'{consumer_tag = Tag} =
amqp_channel:subscribe(State:fetch(amqp_channel_pid), Sub, Listener),
    {ok, Tag}.


This worked with the previous version of the library and I don't see any
difference in the docs (
<A HREF="http://www.rabbitmq.com/erlang-client-user-guide.html">http://www.rabbitmq.com/erlang-client-user-guide.html</A>) now it produces the
following error:

 {{function_clause,
                      [{amqp_selective_consumer,handle_consume_ok,
                           [{'basic.consume_ok',
                                &lt;&lt;&quot;amq.ctag-yC9CxaknYwPrAYj5hCChPQ==&quot;&gt;&gt;},

 {'basic.consume',0,&lt;&lt;&quot;harbinger-dm-hipaa&quot;&gt;&gt;,&lt;&lt;&gt;&gt;,
                                false,false,false,false,[]},
                            {state,
                                {dict,0,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]}}},
                                hipaa,
                                {dict,0,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]}}},
                                none}]},
                       {amqp_gen_consumer,handle_call,3},
                       {gen_server2,handle_msg,2},
                       {proc_lib,init_p_do_apply,3}]},
                  {gen_server2,call,
                      [&lt;0.181.0&gt;,
                       {consumer_call,
                           {'basic.consume_ok',
                               &lt;&lt;&quot;amq.ctag-yC9CxaknYwPrAYj5hCChPQ==&quot;&gt;&gt;},
                           {'basic.consume',0,&lt;&lt;&quot;harbinger-dm-hipaa&quot;&gt;&gt;,&lt;&lt;&gt;&gt;,
                               false,false,false,false,[]}},
                       infinity]}}

There is a clause in the new docs that explains the difference between the
selective consumer and the direct consumer. Based on that description it
seems like everything used to be a direct consumer and that's what I should
be using, but I don't see any docs on how to use it. I explored the rabbit
headers and couldn't find anything that would let me select it. The only
mention of it I found was when selective consumer is set as the default.

Thanks,
-Max
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/f2ec2be1/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/f2ec2be1/attachment.htm</A>&gt;
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015496.html">[rabbitmq-discuss]  Frustrated
</A></li>
	<LI>Next message: <A HREF="015525.html">[rabbitmq-discuss] problems updating to new client library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15511">[ date ]</a>
              <a href="thread.html#15511">[ thread ]</a>
              <a href="subject.html#15511">[ subject ]</a>
              <a href="author.html#15511">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
