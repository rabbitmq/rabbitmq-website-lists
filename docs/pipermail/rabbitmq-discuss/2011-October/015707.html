<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] DTrace and Erlang: an update
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20DTrace%20and%20Erlang%3A%20an%20update&In-Reply-To=%3C32803.1319480445%40snookles.snookles.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015706.html">
   <LINK REL="Next"  HREF="015708.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] DTrace and Erlang: an update</H1>
    <B>Scott Lystig Fritchie</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20DTrace%20and%20Erlang%3A%20an%20update&In-Reply-To=%3C32803.1319480445%40snookles.snookles.com%3E"
       TITLE="[rabbitmq-discuss] DTrace and Erlang: an update">slfritchie at snookles.com
       </A><BR>
    <I>Mon Oct 24 19:20:45 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015706.html">[rabbitmq-discuss] asynchronous fetching messages from rabbitMQ queues
</A></li>
        <LI>Next message: <A HREF="015708.html">[rabbitmq-discuss] DTrace and Erlang: an update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15707">[ date ]</a>
              <a href="thread.html#15707">[ thread ]</a>
              <a href="subject.html#15707">[ subject ]</a>
              <a href="author.html#15707">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, all.  I've been a lurker on this list since January 2009.  I thought
it might be time to post something.

I've been working with Dustin Sallings and Michal Ptaszek to expand the
work that they've done on adding DTrace probes to the Erlang virtual
machine.  We have started preliminary, *informal*, **no-promises-yet**
talks with Ericsson's OTP team.  Our goal (and not yet the OTP team's, I
*cannot* speak for them) is to get these probes &amp; NIF code into the R15
release cycle.

I'll be speaking about this DTrace work at the Erlang User Conference in
Stockholm, Sweden on Thursday, November 4th.  If you're going to be at
the EUC and you're interested in DTrace, I'd love to talk to you.  If
you have a war story about RabbitMQ that you'd like me to share at the
EUC (perhaps as part of my presentation), please contact me directly.
FWIW, I'll also be attending the tutorial &amp; hack-a-thon day on Friday
05 November.

If you like DTrace but you're not going to be at EUC, then ... I'd like
to start some email correspondence.  Specifically, what do you need to
make RabbitMQ's workings visible to the outside world via DTrace?

If we actually meet our goal of getting the probes + NIF into the
official R15 source distribution ... then the evolution of the probes
will probably be slow.  Why?  Because it'll be tied to Ericsson's
release schedule.  The more input we get from users of *real* apps
(RabbitMQ, Riak, Ejabberd, et al.) now, the better the initial probes
will be, and the fewer iterations it will take to make them &quot;perfect&quot;.

-Scott

P.S.  Sorry like sounding like a telethon fundraiser.  (&quot;We need your
pledge of support *now*.&quot;)  But the Erlang/OTP R15 release schedule is
Ericsson's, not mine.  If we want full support for this DTrace work, we
need to play by Ericsson's rules and schedules.

P.P.S. Here's a summary of recent coding developments:

A list of the probes now available is at:

    <A HREF="https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/erts/emulator/beam/erlang_dtrace.d">https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/erts/emulator/beam/erlang_dtrace.d</A>

... and a set of small example D scripts:

    <A HREF="https://github.com/slfritchie/otp/tree/dtrace-experiment+michal2/lib/dtrace/examples">https://github.com/slfritchie/otp/tree/dtrace-experiment+michal2/lib/dtrace/examples</A>

In addition, I've added a NIF that allows Erlang code to trigger a
probe.  See the EDoc comments at the top of this source file for some
background:

    <A HREF="https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/lib/dtrace/src/dtrace.erl">https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/lib/dtrace/src/dtrace.erl</A>

I've created a &quot;shar&quot;-like shell script that will automagically patch
your otp_src_R14B04.tar.gz source tarball with all this DTrace stuff.
See here for details:

    <A HREF="http://erlang.org/pipermail/erlang-questions/2011-October/061933.html">http://erlang.org/pipermail/erlang-questions/2011-October/061933.html</A>

Over the weekend, I added the ability to trace the &quot;sequential trace
token&quot; via DTrace.  That work isn't available in the patch above, but it
is available if you wish by checking out the underlying repo from
GitHub, <A HREF="git://github.com/slfritchie/otp.git,">git://github.com/slfritchie/otp.git,</A> and using the
&quot;dtrace-experiment+michal2&quot; branch.

</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015706.html">[rabbitmq-discuss] asynchronous fetching messages from rabbitMQ queues
</A></li>
	<LI>Next message: <A HREF="015708.html">[rabbitmq-discuss] DTrace and Erlang: an update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15707">[ date ]</a>
              <a href="thread.html#15707">[ thread ]</a>
              <a href="subject.html#15707">[ subject ]</a>
              <a href="author.html#15707">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
