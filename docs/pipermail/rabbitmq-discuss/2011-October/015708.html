<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] DTrace and Erlang: an update
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20DTrace%20and%20Erlang%3A%20an%20update&In-Reply-To=%3CCAHZAEpeVJv_RBCB-mwx%2BoKA%3DwxGG5J4YRGZ02mQYth8DEevKXA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015707.html">
   <LINK REL="Next"  HREF="015709.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] DTrace and Erlang: an update</H1>
    <B>Jason J. W. Williams</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20DTrace%20and%20Erlang%3A%20an%20update&In-Reply-To=%3CCAHZAEpeVJv_RBCB-mwx%2BoKA%3DwxGG5J4YRGZ02mQYth8DEevKXA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] DTrace and Erlang: an update">jasonjwwilliams at gmail.com
       </A><BR>
    <I>Mon Oct 24 19:30:27 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015707.html">[rabbitmq-discuss] DTrace and Erlang: an update
</A></li>
        <LI>Next message: <A HREF="015709.html">[rabbitmq-discuss] DTrace and Erlang: an update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15708">[ date ]</a>
              <a href="thread.html#15708">[ thread ]</a>
              <a href="subject.html#15708">[ subject ]</a>
              <a href="author.html#15708">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Scott,

This would be awesome. It would be great to be able to get better
visibility into Rabbit via DTrace. We'd be using the probes on
OpenIndiana.

-J

On Mon, Oct 24, 2011 at 12:20 PM, Scott Lystig Fritchie
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">slfritchie at snookles.com</A>&gt; wrote:
&gt;<i> Hi, all. &#160;I've been a lurker on this list since January 2009. &#160;I thought
</I>&gt;<i> it might be time to post something.
</I>&gt;<i>
</I>&gt;<i> I've been working with Dustin Sallings and Michal Ptaszek to expand the
</I>&gt;<i> work that they've done on adding DTrace probes to the Erlang virtual
</I>&gt;<i> machine. &#160;We have started preliminary, *informal*, **no-promises-yet**
</I>&gt;<i> talks with Ericsson's OTP team. &#160;Our goal (and not yet the OTP team's, I
</I>&gt;<i> *cannot* speak for them) is to get these probes &amp; NIF code into the R15
</I>&gt;<i> release cycle.
</I>&gt;<i>
</I>&gt;<i> I'll be speaking about this DTrace work at the Erlang User Conference in
</I>&gt;<i> Stockholm, Sweden on Thursday, November 4th. &#160;If you're going to be at
</I>&gt;<i> the EUC and you're interested in DTrace, I'd love to talk to you. &#160;If
</I>&gt;<i> you have a war story about RabbitMQ that you'd like me to share at the
</I>&gt;<i> EUC (perhaps as part of my presentation), please contact me directly.
</I>&gt;<i> FWIW, I'll also be attending the tutorial &amp; hack-a-thon day on Friday
</I>&gt;<i> 05 November.
</I>&gt;<i>
</I>&gt;<i> If you like DTrace but you're not going to be at EUC, then ... I'd like
</I>&gt;<i> to start some email correspondence. &#160;Specifically, what do you need to
</I>&gt;<i> make RabbitMQ's workings visible to the outside world via DTrace?
</I>&gt;<i>
</I>&gt;<i> If we actually meet our goal of getting the probes + NIF into the
</I>&gt;<i> official R15 source distribution ... then the evolution of the probes
</I>&gt;<i> will probably be slow. &#160;Why? &#160;Because it'll be tied to Ericsson's
</I>&gt;<i> release schedule. &#160;The more input we get from users of *real* apps
</I>&gt;<i> (RabbitMQ, Riak, Ejabberd, et al.) now, the better the initial probes
</I>&gt;<i> will be, and the fewer iterations it will take to make them &quot;perfect&quot;.
</I>&gt;<i>
</I>&gt;<i> -Scott
</I>&gt;<i>
</I>&gt;<i> P.S. &#160;Sorry like sounding like a telethon fundraiser. &#160;(&quot;We need your
</I>&gt;<i> pledge of support *now*.&quot;) &#160;But the Erlang/OTP R15 release schedule is
</I>&gt;<i> Ericsson's, not mine. &#160;If we want full support for this DTrace work, we
</I>&gt;<i> need to play by Ericsson's rules and schedules.
</I>&gt;<i>
</I>&gt;<i> P.P.S. Here's a summary of recent coding developments:
</I>&gt;<i>
</I>&gt;<i> A list of the probes now available is at:
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;<A HREF="https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/erts/emulator/beam/erlang_dtrace.d">https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/erts/emulator/beam/erlang_dtrace.d</A>
</I>&gt;<i>
</I>&gt;<i> ... and a set of small example D scripts:
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;<A HREF="https://github.com/slfritchie/otp/tree/dtrace-experiment+michal2/lib/dtrace/examples">https://github.com/slfritchie/otp/tree/dtrace-experiment+michal2/lib/dtrace/examples</A>
</I>&gt;<i>
</I>&gt;<i> In addition, I've added a NIF that allows Erlang code to trigger a
</I>&gt;<i> probe. &#160;See the EDoc comments at the top of this source file for some
</I>&gt;<i> background:
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;<A HREF="https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/lib/dtrace/src/dtrace.erl">https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/lib/dtrace/src/dtrace.erl</A>
</I>&gt;<i>
</I>&gt;<i> I've created a &quot;shar&quot;-like shell script that will automagically patch
</I>&gt;<i> your otp_src_R14B04.tar.gz source tarball with all this DTrace stuff.
</I>&gt;<i> See here for details:
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;<A HREF="http://erlang.org/pipermail/erlang-questions/2011-October/061933.html">http://erlang.org/pipermail/erlang-questions/2011-October/061933.html</A>
</I>&gt;<i>
</I>&gt;<i> Over the weekend, I added the ability to trace the &quot;sequential trace
</I>&gt;<i> token&quot; via DTrace. &#160;That work isn't available in the patch above, but it
</I>&gt;<i> is available if you wish by checking out the underlying repo from
</I>&gt;<i> GitHub, <A HREF="git://github.com/slfritchie/otp.git,">git://github.com/slfritchie/otp.git,</A> and using the
</I>&gt;<i> &quot;dtrace-experiment+michal2&quot; branch.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015707.html">[rabbitmq-discuss] DTrace and Erlang: an update
</A></li>
	<LI>Next message: <A HREF="015709.html">[rabbitmq-discuss] DTrace and Erlang: an update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15708">[ date ]</a>
              <a href="thread.html#15708">[ thread ]</a>
              <a href="subject.html#15708">[ subject ]</a>
              <a href="author.html#15708">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
