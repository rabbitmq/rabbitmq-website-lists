<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] clustering behind a firewall
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20clustering%20behind%20a%20firewall&In-Reply-To=%3Cfeeb0490-455f-4d3a-8c23-504aace07fce%40mx1.0b10.mx%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015535.html">
   <LINK REL="Next"  HREF="015553.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] clustering behind a firewall</H1>
    <B>Kyle O'Donnell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20clustering%20behind%20a%20firewall&In-Reply-To=%3Cfeeb0490-455f-4d3a-8c23-504aace07fce%40mx1.0b10.mx%3E"
       TITLE="[rabbitmq-discuss] clustering behind a firewall">kyleo at 0b10.mx
       </A><BR>
    <I>Sat Oct 15 17:07:53 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015535.html">[rabbitmq-discuss] RabbitMQ HA queue declaration fail
</A></li>
        <LI>Next message: <A HREF="015553.html">[rabbitmq-discuss] clustering behind a firewall
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15540">[ date ]</a>
              <a href="thread.html#15540">[ thread ]</a>
              <a href="subject.html#15540">[ subject ]</a>
              <a href="author.html#15540">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I just moved one of my rabbit nodes into a firewalled network and am trying to figure out why the communication between the nodes is happening on ports that I haven't configured.  The cluster appears to be functioning normally now that I've opened all the appropriate ports, but still seeing ports used that I haven't defined. 

(ports 5672,4369 and range 58000-62000 are opened in both directions between all nodes)

Here is my config file:
[
  {kernel,
        [{inet_dist_listen_min, 58000},
        {inet_dist_listen_max, 62000}
        ]
  },
  {rabbit,
        [{cluster_nodes,                ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node1</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node3</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node4</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node5</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node6</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node7</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node8</A>']}
        ]
  }
].


Here is the traffic I am seeing on node2, watching for traffic from node1:

10:34:38.024623 IP node2.33420 &gt; node1.4369: Flags [S], seq 1878005646, win 5840, options [mss 1460,nop,nop,sackOK,nop,wscale 10], length 0
10:34:38.025325 IP node1.4369 &gt; node2.33420: Flags [S.], seq 2356457984, ack 1878005647, win 5840, options [mss 1380,nop,nop,sackOK,nop,wscale 10], length 0
10:34:38.025347 IP node2.33420 &gt; node1.4369: Flags [.], ack 1, win 6, length 0
10:34:38.025414 IP node2.33420 &gt; node1.4369: Flags [P.], seq 1:10, ack 1, win 6, length 9
10:34:38.026103 IP node1.4369 &gt; node2.33420: Flags [.], ack 10, win 6, length 0
10:34:38.026254 IP node1.4369 &gt; node2.33420: Flags [P.], seq 1:21, ack 10, win 6, length 20
10:34:38.026261 IP node2.33420 &gt; node1.4369: Flags [.], ack 21, win 6, length 0
10:34:38.026279 IP node1.4369 &gt; node2.33420: Flags [F.], seq 21, ack 10, win 6, length 010:34:38.026528 IP node2.33420 &gt; node1.4369: Flags [F.], seq 10, ack 22, win 6, length 0
10:34:38.026622 IP node2.45073 &gt; node1.58000: Flags [S], seq 1877745630, win 5840, options [mss 1460,nop,nop,sackOK,nop,wscale 10], length 0
10:34:38.026855 IP node1.4369 &gt; node2.33420: Flags [.], ack 11, win 6, length 010:34:41.026136 IP node2.45073 &gt; node1.58000: Flags [S], seq 1877745630, win 5840, options [mss 1460,nop,nop,sackOK,nop,wscale 10], length 0


I see the attempt on port 58000 (as specified), but I also see ports in the 30000 range.  I've restarted rabbit on both nodes and find that that the 30000 is a randomized port (I've seen it in the 30000,40000,50000, and 60000 range).

Is that normal?

Thanks,
Kyle
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015535.html">[rabbitmq-discuss] RabbitMQ HA queue declaration fail
</A></li>
	<LI>Next message: <A HREF="015553.html">[rabbitmq-discuss] clustering behind a firewall
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15540">[ date ]</a>
              <a href="thread.html#15540">[ thread ]</a>
              <a href="subject.html#15540">[ subject ]</a>
              <a href="author.html#15540">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
