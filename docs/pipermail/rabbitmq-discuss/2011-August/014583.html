<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue: internal	crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.2.0%20message%20delivery%20issue%3A%20internal%0A%09crash&In-Reply-To=%3C5e41b730-540e-4b16-ae83-aa5dec8758ff%40t29g2000vby.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014598.html">
   <LINK REL="Next"  HREF="014585.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue: internal	crash</H1>
    <B>Alfonso Pantoja</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.2.0%20message%20delivery%20issue%3A%20internal%0A%09crash&In-Reply-To=%3C5e41b730-540e-4b16-ae83-aa5dec8758ff%40t29g2000vby.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue: internal	crash">alfonso.pantoja at gmail.com
       </A><BR>
    <I>Wed Aug 17 11:57:30 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014598.html">[rabbitmq-discuss] RabbitMQ-c @ ARM Targets
</A></li>
        <LI>Next message: <A HREF="014585.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue: internal crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14583">[ date ]</a>
              <a href="thread.html#14583">[ thread ]</a>
              <a href="subject.html#14583">[ subject ]</a>
              <a href="author.html#14583">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We are experiencing an issue with version 2.2.0 which causes to
RabbitMQ to not deliver messages to a consumer.
The consumer is connected to RabbitMQ and performs a create queue/
exchange/binding when it is started but sometimes when there are
messages in the queue they are not being delivered by Rabbit.
Restarting the consumer (it is a windows service) does not solve the
problem and the consumer remains connected but without any message
although the queue contains 3000 messages.

I've found this in rabbitmq sals log file every time I restart the
service:


=CRASH REPORT==== 17-Aug-2011::11:19:04 ===
  crasher:
    initial call: rabbit_writer:mainloop/2
    pid: &lt;0.5938.552&gt;
    registered_name: []
    exception error: bad argument
      in function  rabbit_binary_generator:encode_property/2
      in call from rabbit_binary_generator:encode_properties/6
      in call from rabbit_binary_generator:ensure_content_encoded/2
      in call from rabbit_binary_generator:build_simple_content_frames/
4
      in call from rabbit_writer:assemble_frames/5
      in call from rabbit_writer:internal_send_command_async/3
      in call from rabbit_writer:handle_message/2
      in call from rabbit_writer:mainloop1/2
    ancestors: [&lt;0.5937.552&gt;,&lt;0.5912.552&gt;,&lt;0.5910.552&gt;,
                  rabbit_tcp_client_sup,rabbit_sup,&lt;0.165.0&gt;]
    messages: [{send_command_and_notify,&lt;0.463.0&gt;,&lt;0.5939.552&gt;,
                      {'basic.deliver',
                          &lt;&lt;&quot;amq.ctag-Ci6dSa3Tdm2obfV5CXFVxg==&quot;&gt;&gt;,
2,false,
                          &lt;&lt;&quot;users&quot;&gt;&gt;,&lt;&lt;&quot;domain.com.machinename.
0.status&quot;&gt;&gt;},
                      {content,60,
                          {'P_basic',&lt;&lt;&quot;text/
plain&quot;&gt;&gt;,undefined,undefined,2,
                              undefined,undefined,undefined,undefined,
                              undefined,
1920007482.523,undefined,undefined,
                              undefined,undefined},
                          none,none,
                          [&lt;&lt;&quot;&lt;presence&gt;&lt;jid&gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">username1 at domain.com</A>&lt;/
jid&gt;&lt;status&gt;offline&lt;/status&gt;&lt;/presence&gt;&quot;&gt;&gt;]}},
                  {send_command_and_notify,&lt;0.463.0&gt;,&lt;0.5939.552&gt;,
                      {'basic.deliver',
                          &lt;&lt;&quot;amq.ctag-Ci6dSa3Tdm2obfV5CXFVxg==&quot;&gt;&gt;,
3,false,
                          &lt;&lt;&quot;users&quot;&gt;&gt;,&lt;&lt;&quot;domain.com.machinename.
0.status&quot;&gt;&gt;},
                      {content,60,
                          {'P_basic',&lt;&lt;&quot;text/
plain&quot;&gt;&gt;,undefined,undefined,2,
                              undefined,undefined,undefined,undefined,
                              undefined,
1920009454.965,undefined,undefined,
                              undefined,undefined},
                          none,none,
                          [&lt;&lt;&quot;&lt;presence&gt;&lt;jid&gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">username2 at domain.com</A>&lt;/
jid&gt;&lt;status&gt;online&lt;/status&gt;&lt;/presence&gt;&quot;&gt;&gt;]}},
                  {send_command_and_notify,&lt;0.463.0&gt;,&lt;0.5939.552&gt;,
                      {'basic.deliver',
                          &lt;&lt;&quot;amq.ctag-Ci6dSa3Tdm2obfV5CXFVxg==&quot;&gt;&gt;,
4,false,
                          &lt;&lt;&quot;users&quot;&gt;&gt;,&lt;&lt;&quot;domain.com.machinename.
0.status&quot;&gt;&gt;},


.
.
.


[log reduced for clarity]

.
.
.


    links: [&lt;0.5937.552&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 194
  neighbours:

=SUPERVISOR REPORT==== 17-Aug-2011::11:19:04 ===
     Supervisor: {&lt;0.5937.552&gt;,rabbit_channel_sup}
     Context:    child_terminated
     Reason:     badarg
     Offender:   [{pid,&lt;0.5938.552&gt;},
                  {name,writer},
                  {mfa,{rabbit_writer,start_link,
                                      [#Port&lt;0.8712&gt;,1,131072,
                                       rabbit_framing_amqp_0_9_1,
                                       &lt;0.5913.552&gt;]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 17-Aug-2011::11:19:04 ===
     Supervisor: {&lt;0.5937.552&gt;,rabbit_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,&lt;0.5938.552&gt;},
                  {name,writer},
                  {mfa,{rabbit_writer,start_link,
                                      [#Port&lt;0.8712&gt;,1,131072,
                                       rabbit_framing_amqp_0_9_1,
                                       &lt;0.5913.552&gt;]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]



Note: &quot;&lt;presence&gt;&lt;jid&gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">username1 at domain.com</A>&lt;/jid&gt;&lt;status&gt;offline&lt;/
status&gt;&lt;/presence&gt;&quot; is a message on the queue and
&quot;domain.com.machinename.0.status&quot; is the routing key.




</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014598.html">[rabbitmq-discuss] RabbitMQ-c @ ARM Targets
</A></li>
	<LI>Next message: <A HREF="014585.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue: internal crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14583">[ date ]</a>
              <a href="thread.html#14583">[ thread ]</a>
              <a href="subject.html#14583">[ subject ]</a>
              <a href="author.html#14583">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
