<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks like	a genuine bug...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20crashed%20in%20ets%3Ainsert_new%20-%20looks%20like%0A%09a%20genuine%20bug...&In-Reply-To=%3CCANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014518.html">
   <LINK REL="Next"  HREF="014508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks like	a genuine bug...</H1>
    <B>Eugene Kirpichov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20crashed%20in%20ets%3Ainsert_new%20-%20looks%20like%0A%09a%20genuine%20bug...&In-Reply-To=%3CCANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks like	a genuine bug...">ekirpichov at gmail.com
       </A><BR>
    <I>Fri Aug 12 02:23:36 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014518.html">[rabbitmq-discuss] rabbit-mq management plugin in windows
</A></li>
        <LI>Next message: <A HREF="014508.html">[rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks	like a genuine bug...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14506">[ date ]</a>
              <a href="thread.html#14506">[ thread ]</a>
              <a href="subject.html#14506">[ subject ]</a>
              <a href="author.html#14506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A lot of clients (a thousand or more) were rapidly publishing 1kb
messages to a queue, and then rabbitmq crashed.

In fact I had a cluster of 4 rabbits, and 2 of them crashed as a
result. The remaining 2 continued working ok.

Here's a crash report from rabbit-sasl.log. I do not give the full log
because it's large, contains message data (which my employer might not
like) and I'm too lazy to automatically snip it.
But the log is really full of things exactly like what I show. This
exact message gets repeated many times in the same second, and then it
finally crashed.

What other information can I provide to resolve this? Could this be an
error on my, not rabbit's, part? Having a sudden rabbitmq crash is not
really what I'd like to have in production :-|

=CRASH REPORT==== 11-Aug-2011::17:56:19 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.16624.0&gt;
    registered_name: []
    exception exit: {badarg,
                        [{ets,insert_new,
                             [303172,
                              {&lt;&lt;223,221,16,201,23,190,196,251,169,11,157,145,
                                 94,36,1,105&gt;&gt;,
                               {basic_message,
                                   {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&gt;&gt;},

[&lt;&lt;&quot;results-8808E5FBBC714C9E880F9FD30F443151.TestApp.rmq002&quot;&gt;&gt;],
                                   {content,60,none,
                                       &lt;&lt;....&gt;&gt;, % (snipped)
                                       rabbit_framing_amqp_0_9_1,
                                       [&lt;&lt;....&gt;&gt;]}, % (snipped too)
                                   &lt;&lt;223,221,16,201,23,190,196,251,169,11,157,
                                     145,94,36,1,105&gt;&gt;,
                                   true},
                               1}]},
                         {rabbit_msg_store,update_msg_cache,3},
                         {rabbit_msg_store,write,3},
                         {rabbit_variable_queue,
                             '-with_immutable_msg_store_state/3-fun-0-',2},
                         {rabbit_variable_queue,with_msg_store_state,3},
                         {rabbit_variable_queue,
                             with_immutable_msg_store_state,3},
                         {rabbit_variable_queue,maybe_write_msg_to_disk,3},
                         {rabbit_variable_queue,maybe_write_to_disk,4}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.137.0&gt;]
    messages: [{'$gen_cast',{ack,none,[46689],&lt;0.16623.0&gt;}},
                  {'$gen_cast',{ack,none,[46690],&lt;0.16623.0&gt;}}]
    links: [&lt;0.263.0&gt;]
    dictionary: [{fhc_age_tree,{0,nil}},
                  {{ch,&lt;0.16623.0&gt;},
                   {cr,1,&lt;0.16623.0&gt;,&lt;0.16628.0&gt;,#Ref&lt;0.0.0.16807&gt;,
                       {set,2,16,16,8,80,48,
                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                            {{[],[],[],[],[],[],[],[],
                              [46690],
                              [],[],[],[],
                              [46689],
                              [],[]}}},
                       false,none,0}},
                  {guid,{{7,&lt;0.16624.0&gt;},1}}]
    trap_exit: true
    status: running
    heap_size: 1682835
    stack_size: 24
    reductions: 1260360700
  neighbours:


-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. <A HREF="http://www.mirantis.com/">http://www.mirantis.com/</A>
Editor, <A HREF="http://fprog.ru/">http://fprog.ru/</A>
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014518.html">[rabbitmq-discuss] rabbit-mq management plugin in windows
</A></li>
	<LI>Next message: <A HREF="014508.html">[rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks	like a genuine bug...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14506">[ date ]</a>
              <a href="thread.html#14506">[ thread ]</a>
              <a href="subject.html#14506">[ subject ]</a>
              <a href="author.html#14506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
