<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Inconsistent log rotation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Inconsistent%20log%20rotation&In-Reply-To=%3C20034.7703.256826.616563%40mail.cern.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014436.html">
   <LINK REL="Next"  HREF="014450.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Inconsistent log rotation</H1>
    <B>Lionel Cons</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Inconsistent%20log%20rotation&In-Reply-To=%3C20034.7703.256826.616563%40mail.cern.ch%3E"
       TITLE="[rabbitmq-discuss] Inconsistent log rotation">lionel.cons at cern.ch
       </A><BR>
    <I>Wed Aug 10 06:58:47 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014436.html">[rabbitmq-discuss] Inconsistent log rotation
</A></li>
        <LI>Next message: <A HREF="014450.html">[rabbitmq-discuss] Inconsistent log rotation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14449">[ date ]</a>
              <a href="thread.html#14449">[ thread ]</a>
              <a href="subject.html#14449">[ subject ]</a>
              <a href="author.html#14449">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alexandru Scvorcov writes:
 &gt;   1. When RabbitMQ is started up, it will always start on a new file.
 &gt;   To prevent loss of information, we always append the current log file
 &gt;   to the end of a backup file (whose filename is constructed by
 &gt;   appending RABBITMQ_BACKUP_EXTENSION).

RABBITMQ_BACKUP_EXTENSION defaults to &quot;.1&quot; so log information will be
lost anyway after a subsequent restart.

 &gt;   2. When a user manually rotates logs, that is, when a user manually
 &gt;   executes rabbitmqctl rotate_logs or via the init script, the server
 &gt;   appends it's current log to the backup log file (whose name is
 &gt;   constructed by appending ROTATE_SUFFIX) and starts using a
 &gt;   fresh log.
 
AFAIK, ROTATE_SUFFIX defaults to &quot;&quot; so previous log information is
lost (unless copied outside of the init script).

 &gt; Has this behaviour caused any problems for you?

Yes: multiple restarts wiped log information.

IMHO, rabbitmq should not rotate logs on startup but rather, like most
daemons, simply append. The log rotation policy should be external to
rabbitmq (logrotate is fine for this) and rabbitmq should cooperate by
providing an easy to re-open the logs. This is in line with
<A HREF="http://hg.rabbitmq.com/rabbitmq-server/annotate/e4bf0f9afb46/packaging/debs/Debian/debian/rabbitmq-server.logrotate">http://hg.rabbitmq.com/rabbitmq-server/annotate/e4bf0f9afb46/packaging/debs/Debian/debian/rabbitmq-server.logrotate</A>

Cheers,

Lionel
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014436.html">[rabbitmq-discuss] Inconsistent log rotation
</A></li>
	<LI>Next message: <A HREF="014450.html">[rabbitmq-discuss] Inconsistent log rotation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14449">[ date ]</a>
              <a href="thread.html#14449">[ thread ]</a>
              <a href="subject.html#14449">[ subject ]</a>
              <a href="author.html#14449">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
