<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] queue gets removed from a node
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20queue%20gets%20removed%20from%20a%20node&In-Reply-To=%3C20110830115031.GB14864%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014726.html">
   <LINK REL="Next"  HREF="014761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] queue gets removed from a node</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20queue%20gets%20removed%20from%20a%20node&In-Reply-To=%3C20110830115031.GB14864%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] queue gets removed from a node">matthew at rabbitmq.com
       </A><BR>
    <I>Tue Aug 30 12:50:32 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014726.html">[rabbitmq-discuss] queue gets removed from a node
</A></li>
        <LI>Next message: <A HREF="014761.html">[rabbitmq-discuss] queue gets removed from a node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14760">[ date ]</a>
              <a href="thread.html#14760">[ thread ]</a>
              <a href="subject.html#14760">[ subject ]</a>
              <a href="author.html#14760">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Cezary,

On Thu, Aug 25, 2011 at 01:09:47PM +0100, Cezary Siwek wrote:
&gt;<i> I'm facing an issue with my rabittmq cluster where a queue
</I>&gt;<i> disappears from a node.
</I>&gt;<i> I have 2 nodes in a cluster working in &quot;disk mode&quot;.
</I>&gt;<i> Node1 - only consumes messages from the queue.
</I>&gt;<i> Node2 - only publishes messages to the queue.
</I>&gt;<i> 
</I>&gt;<i> The consumer script on Node1 creates a durable queue and waits for
</I>&gt;<i> messages.
</I>&gt;<i> Everything works fine until some no-activity time. I can't say how
</I>&gt;<i> long it needs to be but usually after more than 24h the queue
</I>&gt;<i> disappears from Node2 and the consumer stops receiving messages. The
</I>&gt;<i> list_queues command shows the queue exists on Node1 but not on
</I>&gt;<i> Node2.
</I>&gt;<i> I've done a packet trace when it happened and I can see some packets
</I>&gt;<i> are being exchanged between nodes. Also cluster_status commands
</I>&gt;<i> shows that both nodes are up and running in the cluster.
</I>&gt;<i> When I try to declare_queue on the Node2 i get 'NOT_FOUND - no queue
</I>&gt;<i> 'msgs' in vhost '/vhost1'.
</I>&gt;<i> All I need to do to have the Node2 running is to run stop_app and start_app.
</I>&gt;<i> 
</I>&gt;<i> Both nodes are sitting behind firewalls (in separate networks) but
</I>&gt;<i> both firewalls have been granted to pass all the traffic between
</I>&gt;<i> these two boxes.
</I>&gt;<i> It happens on my dev platfrom. On production I don't think I will
</I>&gt;<i> ever have such long quiet periods but I need to find out what is
</I>&gt;<i> causing this.
</I>
Hmm, this is odd. It suggests that the two nodes have lost contact with
each other which is why Node2 is responding with the NOT_FOUND when you
try to redeclare the queue. However, if at this point the cluster_status
on both nodes is suggesting everything is clustered and happy, then this
is very odd indeed. Could you check that you can achieve these sets of
circumstances?

Also, do you have the logs for both nodes during the no-activity time?
I'm curious whether there are entries in there that suggest the cluster
has split apart. If they're large, then maybe send them to us off-list.

Matthew
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014726.html">[rabbitmq-discuss] queue gets removed from a node
</A></li>
	<LI>Next message: <A HREF="014761.html">[rabbitmq-discuss] queue gets removed from a node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14760">[ date ]</a>
              <a href="thread.html#14760">[ thread ]</a>
              <a href="subject.html#14760">[ subject ]</a>
              <a href="author.html#14760">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
