<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] WCF and queue creation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20WCF%20and%20queue%20creation&In-Reply-To=%3C32281523.post%40talk.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014590.html">
   <LINK REL="Next"  HREF="014613.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] WCF and queue creation</H1>
    <B>rjrizzuto</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20WCF%20and%20queue%20creation&In-Reply-To=%3C32281523.post%40talk.nabble.com%3E"
       TITLE="[rabbitmq-discuss] WCF and queue creation">Raymond.Rizzuto at sig.com
       </A><BR>
    <I>Wed Aug 17 18:15:36 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014590.html">[rabbitmq-discuss] Auto-disconnecting a deleted user
</A></li>
        <LI>Next message: <A HREF="014613.html">[rabbitmq-discuss] WCF and queue creation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14604">[ date ]</a>
              <a href="thread.html#14604">[ thread ]</a>
              <a href="subject.html#14604">[ subject ]</a>
              <a href="author.html#14604">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
We're also considering moving from MSMQ via WCF to RabbitMQ via WCF.  If I
follow this discussion correctly, we also need durable queues.  I.e. we want
to be able to stop and restart either the producer or consumer without
losing data or the queue going away.  Would we need to apply the same patch
to line 171 in RabbitMQInputChannel, or is that now included in the current
version?


Emile Joubert-2 wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi Jonathan,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 11/06/10 16:18, Jonathan Graham wrote:
</I>&gt;&gt;<i> Hi Emile,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> I have two WCF services (let's call them A and B) in an existing
</I>&gt;&gt;<i> application.  I want to send asynchronous, one-way messages from service
</I>&gt;&gt;<i> A to service B.  The operation being invoked on service B can take some
</I>&gt;&gt;<i> time to complete, and service A's call to B is due to an end user
</I>&gt;&gt;<i> initiated operation on A. I don't want to make end users wait for B to
</I>&gt;&gt;<i> complete, hence the asynchronous requirement.  Service B is also a
</I>&gt;&gt;<i> little fragile and is not always available, so I want any messages sent
</I>&gt;&gt;<i> to it to be stored in a durable queue until B is able to process the
</I>&gt;&gt;<i> messages.
</I>&gt;<i> 
</I>&gt;<i> I agree that a one-way (fire &amp; forget) channel is appropriate for your 
</I>&gt;<i> use case. Queue durability alone will not be sufficient to accomplish 
</I>&gt;<i> your goal though, because the service host will need to reconnect to the 
</I>&gt;<i> same queue. If you are comfortable with recompiling the ServiceModel 
</I>&gt;<i> project in order to experiment with a possible approach, try replacing 
</I>&gt;<i> line 171 in RabbitMQInputChannel with:
</I>&gt;<i> 
</I>&gt;<i> string queue = m_model.QueueDeclare(LocalAddress.Uri.AbsolutePath, true);
</I>&gt;<i> 
</I>&gt;<i> This will cause the service queue to have a fixed name and be durable. 
</I>&gt;<i> The queue will then accumulate requests in the event of service B 
</I>&gt;<i> temporarily disconnecting.
</I>&gt;<i> 
</I>&gt;<i> Caveats apply: This code has not been through our formal QA process. It 
</I>&gt;<i> is meant for experimentation only and may break other things.
</I>&gt;<i> 
</I>&gt;&gt;<i> [...] Unfortunately because Rabbit's WCF
</I>&gt;&gt;<i> binding doesn't let us use durable queues, we haven't yet been able to
</I>&gt;&gt;<i> make use of it.
</I>&gt;<i> 
</I>&gt;<i> This is a feature that could be added if there was sufficient demand, 
</I>&gt;<i> but you are the first to suggest it.
</I>&gt;<i> 
</I>&gt;&gt;<i> It looks like the following options are available:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. Change the way the WCF binding works so that existing queues can be
</I>&gt;&gt;<i> used and/or that queues declared by the binding can be made durable. (As
</I>&gt;&gt;<i> an aside, if I can find the time, I wouldn't mind contributing this
</I>&gt;&gt;<i> change, but I don't have a whole lot of free time at present.)
</I>&gt;<i> 
</I>&gt;<i> I'm hoping that the line of code above gives you a useful place to 
</I>&gt;<i> start. I'd be interested to know if it works for you.
</I>&gt;<i> 
</I>&gt;&gt;<i> 2. No longer implement service B as a WCF service and instead use the
</I>&gt;&gt;<i> RabbitMQ .NET client API to consume messages from RabbitMQ.
</I>&gt;<i> 
</I>&gt;<i> If you are not bound to the strictures of WCF then this can work very 
</I>&gt;<i> simply. There are many examples in the RabbitMQ.Client.Examples that 
</I>&gt;<i> illustrate how to send messages from a message producer to a consumer. 
</I>&gt;<i> You will need to do some of the work that RabbitMQ ServiceModel does for 
</I>&gt;<i> you, such as declaring and binding a queue and structuring the message 
</I>&gt;<i> in the way that the consumer can understand it.
</I>&gt;<i> 
</I>&gt;<i> Regards
</I>&gt;<i> 
</I>&gt;<i> Emile
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://old.nabble.com/WCF-and-queue-creation-tp28842204p32281523.html">http://old.nabble.com/WCF-and-queue-creation-tp28842204p32281523.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.

</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014590.html">[rabbitmq-discuss] Auto-disconnecting a deleted user
</A></li>
	<LI>Next message: <A HREF="014613.html">[rabbitmq-discuss] WCF and queue creation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14604">[ date ]</a>
              <a href="thread.html#14604">[ thread ]</a>
              <a href="subject.html#14604">[ subject ]</a>
              <a href="author.html#14604">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
