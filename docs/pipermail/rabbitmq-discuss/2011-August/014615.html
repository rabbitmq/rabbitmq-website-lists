<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.2.0%20message%20delivery%0A%20issue%3A%09internal%20crash&In-Reply-To=%3C4E4D40D0.7080401%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014614.html">
   <LINK REL="Next"  HREF="014616.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.2.0%20message%20delivery%0A%20issue%3A%09internal%20crash&In-Reply-To=%3C4E4D40D0.7080401%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash">matthias at rabbitmq.com
       </A><BR>
    <I>Thu Aug 18 17:41:52 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014614.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash
</A></li>
        <LI>Next message: <A HREF="014616.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue: internal crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14615">[ date ]</a>
              <a href="thread.html#14615">[ thread ]</a>
              <a href="subject.html#14615">[ subject ]</a>
              <a href="author.html#14615">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alfonso,

On 18/08/11 14:50, Alfonso Pantoja wrote:
&gt;<i> Because this issue does not happen very ofter I'm wondering if you
</I>&gt;<i> could suggest what to the check (messages properties use, etc.) or the
</I>&gt;<i> possible causes that lead to message corruption (after reading your
</I>&gt;<i> responses I  understand that we should review our modifications in
</I>&gt;<i> mod_rabbitmq but it would be nice to have a tip to track down that
</I>&gt;<i> bug)
</I>
In the original rabbitmq-xmpp code base, the only place for things to go 
wrong is at 
<A HREF="https://github.com/rabbitmq/rabbitmq-xmpp/blob/master/src/mod_rabbitmq.erl#L250.">https://github.com/rabbitmq/rabbitmq-xmpp/blob/master/src/mod_rabbitmq.erl#L250.</A> 
That code is bullet proof (famous last words), but I suspect you have 
either modified it or have similar code elsewhere.

The thing to watch out for in particular is what values you place in the 
properties. Their type must correspond to what is expected for the given 
key in the Basic content properties (see 
<A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.basic">http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.basic</A>). shortstr 
and longstr must be Erlang binaries. octet, shortint, longint, 
longlongint and timestamp must be Erlang integers. And 'table' must be a 
list of {KeyBinary, TypeAtom, Value}.

&gt;<i> Regarding the broker upgrade I would like to know what is the
</I>&gt;<i> procedure for upgrading it without losing the messages (all our
</I>&gt;<i> messages are persistent).
</I>
Simply install the new broker. Persistent messages in durable queues 
will be retained.


Matthias.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014614.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash
</A></li>
	<LI>Next message: <A HREF="014616.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue: internal crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14615">[ date ]</a>
              <a href="thread.html#14615">[ thread ]</a>
              <a href="subject.html#14615">[ subject ]</a>
              <a href="author.html#14615">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
