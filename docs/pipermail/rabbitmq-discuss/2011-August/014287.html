<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20actively%20refuses%20connections%20after%0A%09connectity%20issues&In-Reply-To=%3Cda4c18d6-20a4-49cd-88c9-0690cce14701%40t5g2000yqj.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014286.html">
   <LINK REL="Next"  HREF="014299.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues</H1>
    <B>Alfonso Pantoja</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20actively%20refuses%20connections%20after%0A%09connectity%20issues&In-Reply-To=%3Cda4c18d6-20a4-49cd-88c9-0690cce14701%40t5g2000yqj.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues">alfonso.pantoja at gmail.com
       </A><BR>
    <I>Tue Aug  2 11:17:17 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014286.html">[rabbitmq-discuss] RabbitMQ actively refuses connections after connectity issues
</A></li>
        <LI>Next message: <A HREF="014299.html">[rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14287">[ date ]</a>
              <a href="thread.html#14287">[ thread ]</a>
              <a href="subject.html#14287">[ subject ]</a>
              <a href="author.html#14287">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Simon,

Thanks for your response.
We have about 8 windows services and all use the heartbeat feature. 6
of them use the basicGet approach (this should be changed)
I think default Ubuntu's configuration has not been modified so I
think it is strange that those few consumers/publishers could run out
the file descriptors.

Windows services try to connect to RabbitMQ continously so when the
connection is lost there are trying to connect permanently. Can these
behavior lead to a  file descriptor lack while Rabbit is restarting
and about to be operative?

After reading some posts in this group I'm wondering if a large amount
of queues could be a problem. We have more 1000 durable queues. The
most of them are created due to the use of a custom mod_rabbitmq in
Ejabberd where all users have their message queue.


Thank you in advance

Regards,

Alfonso



On 2 ago, 11:53, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">si... at rabbitmq.com</A>&gt; wrote:
&gt;<i> On 02/08/11 10:44, Alfonso Pantoja wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; More info:
</I>&gt;<i> &gt; when we had the problem, in RabbitMQ web admin we could see that file
</I>&gt;<i> &gt; descriptors monitor were in red (file descriptors were near the
</I>&gt;<i> &gt; maximum)
</I>&gt;<i>
</I>&gt;<i> Well that's basically your problem - when RabbitMQ runs out of file
</I>&gt;<i> descriptors it simply can't accept any more TCP connections. In practice
</I>&gt;<i> it will stop accepting connections slightly before it runs out
</I>&gt;<i> completely, to give itself some wriggle room when writing new files.
</I>&gt;<i>
</I>&gt;<i> This is a pure OS-level limitation, Rabbit gives you some monitoring of
</I>&gt;<i> the situation but that's it.
</I>&gt;<i>
</I>&gt;<i> The most likely problem was that something was holding connections open
</I>&gt;<i> - check the connections page in mgmt to see what that was.
</I>&gt;<i>
</I>&gt;<i> Ubuntu has a fairly low limit on file descriptors by default (1000) - if
</I>&gt;<i> you think you could legitimately want to accept more than ~800
</I>&gt;<i> connections at once you might want to add something like:
</I>&gt;<i>
</I>&gt;<i> rabbitmq &#160; &#160; &#160; &#160;soft &#160; &#160;nofile &#160; &#160; &#160; &#160; &#160;100000
</I>&gt;<i> rabbitmq &#160; &#160; &#160; &#160;hard &#160; &#160;nofile &#160; &#160; &#160; &#160; &#160;100000
</I>&gt;<i>
</I>&gt;<i> to /etc/security/limits.conf and restart Rabbit.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014286.html">[rabbitmq-discuss] RabbitMQ actively refuses connections after connectity issues
</A></li>
	<LI>Next message: <A HREF="014299.html">[rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14287">[ date ]</a>
              <a href="thread.html#14287">[ thread ]</a>
              <a href="subject.html#14287">[ subject ]</a>
              <a href="author.html#14287">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
