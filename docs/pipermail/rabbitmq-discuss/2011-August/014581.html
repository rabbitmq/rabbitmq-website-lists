<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Scenario ideas
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Scenario%20ideas&In-Reply-To=%3C4E4B8C58.9050401%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014579.html">
   <LINK REL="Next"  HREF="014582.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Scenario ideas</H1>
    <B>Michael Bridgen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Scenario%20ideas&In-Reply-To=%3C4E4B8C58.9050401%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Scenario ideas">mikeb at rabbitmq.com
       </A><BR>
    <I>Wed Aug 17 10:39:36 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014579.html">[rabbitmq-discuss] Scenario ideas
</A></li>
        <LI>Next message: <A HREF="014582.html">[rabbitmq-discuss] Scenario ideas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14581">[ date ]</a>
              <a href="thread.html#14581">[ thread ]</a>
              <a href="subject.html#14581">[ subject ]</a>
              <a href="author.html#14581">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Pete,

&gt;<i> I have been playing with rabbitmq and am thinking through some common
</I>&gt;<i> scenarios I think I will need to deal with, I was wondering if anyone
</I>&gt;<i> would be able to take the time to read my thoughts and validate them or
</I>&gt;<i> throw a few more options in/give me some article links?
</I>&gt;<i>
</I>&gt;<i> I have a topic exchange and need to attach some consumers to process
</I>&gt;<i> messages.
</I>&gt;<i>
</I>&gt;<i> If I attach a consumer with no queue name, a unique one time queue will
</I>&gt;<i> be created and I can bind the exchange to this queue using a routing key
</I>&gt;<i> like 'animal.mammals.#'.
</I>
Not quite; you have to create the queue with an empty name, then consume 
from it using the name you get back in queue.declare_ok (and then bind 
it to the exchange).

&gt;<i> This is great until
</I>&gt;<i>
</I>&gt;<i> - the consumer crashes, meaning the exchange will drop all messages (or
</I>&gt;<i> they get rejected depending on the publish settings I use)
</I>&gt;<i> or
</I>
Yes, that can happen. Though if the queue isn't exclusive or auto_delete 
(and thereby destroyed when the connection drops or consumer goes away), 
it will happily collect messages until the consumer returns. Of course, 
you'd have to have recorded its name somewhere, or generated the name 
yourself in a way you can repeat.

&gt;<i> - I need another consumer to process animals.mammals.#, which I can't do
</I>&gt;<i> as I am using a one time queue and adding another will mean each message
</I>&gt;<i> is delivered to 2 queues.
</I>
What is the problem with delivering to two queues? If you are using a 
topic exchange, creating an anonymous, exclusive queue for each consumer 
is usually appropriate.

&gt;<i> Are the above assumptions correct?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So my second option is to use a named queue. I attach a consumer with a
</I>&gt;<i> queue name and bind the exchange to this queue using a routing key like
</I>&gt;<i> 'animal.mammals.#'.
</I>&gt;<i>
</I>&gt;<i> Now if I need another consumer I simply bring another one up and attach
</I>&gt;<i> it to the same queue name, and they get the messages in round robin
</I>&gt;<i> which is great.
</I>
It is certainly an established pattern to use a durable, named queue for 
sharing out messages.  Queues do double duty in AMQP -- firstly as &quot;work 
queues&quot; of this kind, secondly as buffers for transmission.

Take care with the order in which you do things, or at least be aware 
that unless you set a prefetch value, the first consumer will get all 
the messages in the queue at that time.

&gt;<i> What's not so great is if I then decide to attach a consumer to this
</I>&gt;<i> queue name (maybe by accident) and bind the exchange to a routing key
</I>&gt;<i> 'animal.mammals.rabbit'
</I>&gt;<i>
</I>&gt;<i> Then the queue gets 2 copies of each message. Is there any way to avoid
</I>&gt;<i> this other than careful management of bindings? Maybe a way of telling
</I>&gt;<i> the exchange to only deliver the message once to a given queue?
</I>
No, it won't get two copies.  The routing will only ever deliver any 
given message once to a queue.

The combination of wildcard routing and round-robin is unusual. Would 
you go into more detail about what you are trying to achieve?


--Michael
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014579.html">[rabbitmq-discuss] Scenario ideas
</A></li>
	<LI>Next message: <A HREF="014582.html">[rabbitmq-discuss] Scenario ideas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14581">[ date ]</a>
              <a href="thread.html#14581">[ thread ]</a>
              <a href="subject.html#14581">[ subject ]</a>
              <a href="author.html#14581">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
