<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Nodes loosing contact with the cluster, using 2.5.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Nodes%20loosing%20contact%20with%20the%20cluster%2C%0A%20using%202.5.1&In-Reply-To=%3C20110831095001.GA8687%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014767.html">
   <LINK REL="Next"  HREF="014750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Nodes loosing contact with the cluster, using 2.5.1</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Nodes%20loosing%20contact%20with%20the%20cluster%2C%0A%20using%202.5.1&In-Reply-To=%3C20110831095001.GA8687%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Nodes loosing contact with the cluster, using 2.5.1">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Aug 31 10:50:02 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014767.html">[rabbitmq-discuss] Nodes loosing contact with the cluster,	using 2.5.1
</A></li>
        <LI>Next message: <A HREF="014750.html">[rabbitmq-discuss] [announcement] amqp gem 0.8.0.rc15 is released, very likely to be the last RC before 0.8.0 final
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14769">[ date ]</a>
              <a href="thread.html#14769">[ thread ]</a>
              <a href="subject.html#14769">[ subject ]</a>
              <a href="author.html#14769">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Otto,

On Wed, Aug 31, 2011 at 01:20:14AM -0700, Otto Bergstr&#246;m wrote:
&gt;<i> richmqcoll01:
</I>&gt;<i> 
</I>&gt;<i> richmqcoll02:
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 28-Aug-2011::15:22:48 ===
</I>&gt;<i> ** Node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at richmqcoll01</A> not responding **
</I>&gt;<i> ** Removing (timedout) connection **
</I>&gt;<i> 
</I>&gt;<i> =INFO REPORT==== 28-Aug-2011::15:22:48 ===
</I>&gt;<i> node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at richmqcoll01</A> lost 'rabbit'
</I>&gt;<i> 
</I>&gt;<i> =INFO REPORT==== 28-Aug-2011::15:22:56 ===
</I>&gt;<i> node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at richmqcoll01</A> down
</I>&gt;<i> 
</I>&gt;<i> richmqcoll04:
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 28-Aug-2011::15:22:53 ===
</I>&gt;<i> ** Node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at richmqcoll01</A> not responding **
</I>&gt;<i> ** Removing (timedout) connection **
</I>&gt;<i> 
</I>&gt;<i> =INFO REPORT==== 28-Aug-2011::15:22:53 ===
</I>&gt;<i> node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at richmqcoll01</A> lost 'rabbit'
</I>&gt;<i> 
</I>&gt;<i> =INFO REPORT==== 28-Aug-2011::15:23:00 ===
</I>&gt;<i> node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at richmqcoll01</A> down
</I>

Wow, that's very very interesting - that 02 and 04 thought they lost 01
but 01 didn't think it had lost 02 or 04. What's even more odd is your
report that this happens with 2.5.1 and not 2.4.X.

Having had a dig around, I've come across this -
<A HREF="http://erlang.org/pipermail/erlang-questions/2010-September/053336.html">http://erlang.org/pipermail/erlang-questions/2010-September/053336.html</A>
- which I certainly wasn't aware of, and might potentially be causing
this. It's quite alarming, that one.

One thing you might wish to experiment with is increasing the
net_ticktime - this is the amount of time each node will wait since
hearing from another node before declaring that node dead. By default
for me it seems to be at 60 seconds, which I would have thought should
be more than sufficient, but I'm curious as to whether increasing it
would solve the problem for you.

If you find your rabbitmq-server shell script which should be in
/usr/sbin/rabbitmq-server, and make the following change *on all your
nodes*, before restarting them:

The first non-comment line should look like:

SERVER_ERL_ARGS=&quot;+K true +A30 +P 1048576 \
-kernel inet_default_connect_options [{nodelay,true}]&quot;

Change that to:

SERVER_ERL_ARGS=&quot;+K true +A30 +P 1048576 \
-kernel inet_default_connect_options [{nodelay,true}] \
-kernel net_ticktime 120&quot;

(Quotes and trailing \ are important).

Let me know how you get on - this isn't something we've seen and I'm
very curious as to what could be causing it.

Best wishes,

Matthew
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014767.html">[rabbitmq-discuss] Nodes loosing contact with the cluster,	using 2.5.1
</A></li>
	<LI>Next message: <A HREF="014750.html">[rabbitmq-discuss] [announcement] amqp gem 0.8.0.rc15 is released, very likely to be the last RC before 0.8.0 final
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14769">[ date ]</a>
              <a href="thread.html#14769">[ thread ]</a>
              <a href="subject.html#14769">[ subject ]</a>
              <a href="author.html#14769">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
