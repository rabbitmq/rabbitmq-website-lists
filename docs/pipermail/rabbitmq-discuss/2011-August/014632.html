<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Configure VM memory high watermark
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Configure%20VM%20memory%20high%20watermark&In-Reply-To=%3C20110819140857.GB5436%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014560.html">
   <LINK REL="Next"  HREF="014503.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Configure VM memory high watermark</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Configure%20VM%20memory%20high%20watermark&In-Reply-To=%3C20110819140857.GB5436%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] Configure VM memory high watermark">matthew at rabbitmq.com
       </A><BR>
    <I>Fri Aug 19 15:08:57 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014560.html">[rabbitmq-discuss] Configure VM memory high watermark
</A></li>
        <LI>Next message: <A HREF="014503.html">[rabbitmq-discuss] Extremely unfair consumption under high publish	load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14632">[ date ]</a>
              <a href="thread.html#14632">[ thread ]</a>
              <a href="subject.html#14632">[ subject ]</a>
              <a href="author.html#14632">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sylvain,

On Tue, Aug 16, 2011 at 10:27:20AM +0200, CORDIER-AKKA Sylvain (MORPHO) wrote:
&gt;<i> Our RabbitMQ host has got 64GB installed RAM and RabbitMQ server
</I>&gt;<i> process uses in normal use about 5GB of RAM.  The normal use point is
</I>&gt;<i> just above the 8% of installed RAM (8% of 64GB is 5.12GB) and a small
</I>&gt;<i> variation of the use point makes the RabbitMQ starts paging messages
</I>&gt;<i> and causes a final system slowdown.
</I>&gt;<i> 
</I>&gt;<i> If the vm_memory_high_watermark is not the good solution, what are the
</I>&gt;<i> available solutions?
</I>&gt;<i> Increase the amount of installed RAM to 96GB for the system starts
</I>&gt;<i> paging at 7.68GB?
</I>&gt;<i> Isn't there another way to delay RabbitMQ to start swapping?
</I>
Well. The thing that Rabbit is trying to ensure is that should RAM
continue to be eaten up, by the time it gets to around 26GB used,
everything should be safely on disk and that the transition to putting
things onto disk is a smooth one. Obviously, unless you have insanely
fast disks, writing out 26GB of messages to disk takes some time, which
is why Rabbit starts writing out quite early on.

The use of 0.4 as the default highwater mark is based on the fear that
GC by the Erlang VM could cause a tempory spike of near double the
amount of RAM in the machine. As the amount of RAM you have installed
gets greater and greater, I'd have thought the odds of there being such
a spike reduces. Thus maybe in such machines, a much higher highwater
mark would be reasonable.

If you have the time, what I'd suggest is that you try with the
watermark much higher (say, 0.8) and then stress test it and see if you
can get Rabbit/Erlang to fail (most likely it'll be a a &quot;cannot allocate
X bytes&quot; malloc-style failure). Reduce the watermark and repeat until
you have confidence that for your use case, there will be no fatal
spikes and you still have utilisation of RAM that you're happy with.

Matthew
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014560.html">[rabbitmq-discuss] Configure VM memory high watermark
</A></li>
	<LI>Next message: <A HREF="014503.html">[rabbitmq-discuss] Extremely unfair consumption under high publish	load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14632">[ date ]</a>
              <a href="thread.html#14632">[ thread ]</a>
              <a href="subject.html#14632">[ subject ]</a>
              <a href="author.html#14632">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
