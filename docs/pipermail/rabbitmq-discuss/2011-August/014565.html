<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] major failure when clearing large queue	backlog
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20major%20failure%20when%20clearing%20large%20queue%0A%09backlog&In-Reply-To=%3CCAHiEoM7uazjw%3DLT_cRU6s62-cdAeRyVO7Rajqy81t8LSYWoa8A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014562.html">
   <LINK REL="Next"  HREF="014566.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] major failure when clearing large queue	backlog</H1>
    <B>Aaron Westendorf</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20major%20failure%20when%20clearing%20large%20queue%0A%09backlog&In-Reply-To=%3CCAHiEoM7uazjw%3DLT_cRU6s62-cdAeRyVO7Rajqy81t8LSYWoa8A%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] major failure when clearing large queue	backlog">aaron at agoragames.com
       </A><BR>
    <I>Tue Aug 16 13:45:27 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014562.html">[rabbitmq-discuss] major failure when clearing large queue backlog
</A></li>
        <LI>Next message: <A HREF="014566.html">[rabbitmq-discuss] major failure when clearing large queue backlog
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14565">[ date ]</a>
              <a href="thread.html#14565">[ thread ]</a>
              <a href="subject.html#14565">[ subject ]</a>
              <a href="author.html#14565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Since restarting rabbit is a major disruption to service, changing
that value will probably wait until next week at the earliest. Seeing
as I have some time, I'd like to make sure we set it to a value that
we're happy with.

The documentation says only that disabling memsup will prevent
throttling of producers. There's also discussion about the Erlang
garbage collector, which I can see being responsible for the situation
I originally described.

<A HREF="http://www.rabbitmq.com/extensions.html#memsup">http://www.rabbitmq.com/extensions.html#memsup</A>

We've been running this configuration for a long time now, and I
vaguely recall that when the spool-to-disk feature was added, it was
dependent on this setting. However, I've seen it write to disk even
with this setting off so I may be mistaken. Regardless, we don't have
support in our applications for flow control (yet?) so I've been wary
to enable vm_memory_high_watermark. I plan to add a concept of flow
control strategies to haigha so that common use cases can be
abstracted without per-app implementations.

I've seen rabbit use much more than 1GB so I don't think it's defaulted to that.


-Aaron



On Tue, Aug 16, 2011 at 6:35 AM, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt; wrote:
&gt;<i> On Mon, Aug 15, 2011 at 01:29:23PM -0400, Aaron Westendorf wrote:
</I>&gt;&gt;<i> I can email you logs, but they're really not exciting. It's all just noise
</I>&gt;&gt;<i> as messages were published and consumers had yet to initialize and declare
</I>&gt;&gt;<i> exchanges, queues and bindings.
</I>&gt;<i>
</I>&gt;<i> Hmm, that's a pity.
</I>&gt;<i>
</I>&gt;&gt;<i> I assume you have tests for spooling to disk when rabbit is low on memory.
</I>&gt;&gt;<i> Has this been tested in a cluster situation such as I described?
</I>&gt;<i>
</I>&gt;<i> Part of our test suite certainly does simulate low memory conditions.
</I>&gt;<i>
</I>&gt;&gt;<i> I checked our configurations, and I wonder if this is what caused the
</I>&gt;&gt;<i> problem:
</I>&gt;&gt;<i> [{rabbit, [{vm_memory_high_watermark, 0}, {cluster_nodes,
</I>&gt;&gt;<i> ['artemis','hermes']}]}].
</I>&gt;<i>
</I>&gt;<i> Erm, setting that to 0 disables the memory monitor, which then forces
</I>&gt;<i> Rabbit to default to thinking that there's probably about 1GB RAM
</I>&gt;<i> installed. This is very certainly not what you want. I'd set that back
</I>&gt;<i> to the default of 0.4 and see how you get on with that.
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aaron at agoragames.com</A>
www.agoragames.com
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014562.html">[rabbitmq-discuss] major failure when clearing large queue backlog
</A></li>
	<LI>Next message: <A HREF="014566.html">[rabbitmq-discuss] major failure when clearing large queue backlog
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14565">[ date ]</a>
              <a href="thread.html#14565">[ thread ]</a>
              <a href="subject.html#14565">[ subject ]</a>
              <a href="author.html#14565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
