<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumer Callback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumer%20Callback&In-Reply-To=%3C4E4DD6F9.3040306%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014623.html">
   <LINK REL="Next"  HREF="014487.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumer Callback</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumer%20Callback&In-Reply-To=%3C4E4DD6F9.3040306%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Consumer Callback">matthias at rabbitmq.com
       </A><BR>
    <I>Fri Aug 19 04:22:33 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014623.html">[rabbitmq-discuss] Consumer Callback
</A></li>
        <LI>Next message: <A HREF="014487.html">[rabbitmq-discuss] What is rabbitmq heartbeat?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14624">[ date ]</a>
              <a href="thread.html#14624">[ thread ]</a>
              <a href="subject.html#14624">[ subject ]</a>
              <a href="author.html#14624">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/08/11 00:51, fangbot wrote:
&gt;<i> This makes sense. My goal now is to be able to send both persistent AND
</I>&gt;<i> non-persistent messages to a single consumer. In this case, I want to turn
</I>&gt;<i> auto-acknowledge off so I can acknowledge the messages after I process them,
</I>&gt;<i> in my code. However, I do not wish to send those acknowledgements if the
</I>&gt;<i> message I receive is a non-persistent message.
</I>
It's fine to send a mixture of persistent and non-persistent messages to 
a queue, and subsequently consume them. What you cannot do though is 
choose which messages need acknowledgement - that's solely determined by 
the consumer, i.e. whether it is consuming in ack or no-ack mode.

&gt;<i> 1. what if I just acknowledged ALL messages, including non-persistent
</I>&gt;<i> messages? Will acknowledging non-persistent messages have a
</I>&gt;<i> noticeable performance impact on the throughput speeds?
</I>
There is certainly a performance penalty for using acks. It's not 
massive though.

&gt;<i> 2. With auto-ack turned on, will a persistent message get ack'ed upon
</I>&gt;<i> arrival to a queue, or when a QueueingConsumer calls nextDelivery()? In
</I>&gt;<i> other words, if I have a consumer binded to a queue, and a persistent
</I>&gt;<i> message gets sent to that queue but the QueueingConsumer does not call
</I>&gt;<i> nextDelivery(), and I shut down the server, will the message get persisted
</I>&gt;<i> to mnesia?
</I>
The auto-ack'ing happens when the message is sent to the consumer, since 
only at that point the queue knows what kind of consumer - ack'ing or 
not - the message is being sent to.

Note though that QueuingConsumer is a client-side construct. It queues 
the messages in the client that it was sent from the server. 
nextDelivery() does not interact with the server; it simply dequeues the 
next message from the client-side queue, or waits for more messages to 
arrive. If consuming in auto-ack mode, all such locally queued messages, 
and all messages &quot;in flight&quot; will be lost when the 
client/connection/server dies or is restarted since, as far as the 
server is concerned, they were auto-ack'ed when they were sent to the 
client and hence are no longer held in the (server) queue.

A clean shutdown of the broker will ensure all persistent messages held 
in queues are stored on disk, including those that have been sent to 
clients and are awaiting acknowledgement (i.e. were sent to consumers in 
'ack' mode).

[minor point of correctness: messages are not stored in mnesia but a 
custom high-performance message store (which does keep its data in files 
in the mnesia directory hierarchy, even though it has nothing to do with 
mnesia)]

Regards,

Matthias.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014623.html">[rabbitmq-discuss] Consumer Callback
</A></li>
	<LI>Next message: <A HREF="014487.html">[rabbitmq-discuss] What is rabbitmq heartbeat?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14624">[ date ]</a>
              <a href="thread.html#14624">[ thread ]</a>
              <a href="subject.html#14624">[ subject ]</a>
              <a href="author.html#14624">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
