<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Slow startup/recovery time
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Slow%20startup/recovery%20time&In-Reply-To=%3CCAHfDCQJwhJzLE_uVQqs59pXiGbpqXZEfesY7f6m3N90BudTr%3DA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014372.html">
   <LINK REL="Next"  HREF="014294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Slow startup/recovery time</H1>
    <B>Pablo Ruiz</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Slow%20startup/recovery%20time&In-Reply-To=%3CCAHfDCQJwhJzLE_uVQqs59pXiGbpqXZEfesY7f6m3N90BudTr%3DA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Slow startup/recovery time">pablo.ruiz at gmail.com
       </A><BR>
    <I>Tue Aug  2 12:37:10 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014372.html">[rabbitmq-discuss] CRL support
</A></li>
        <LI>Next message: <A HREF="014294.html">[rabbitmq-discuss] Slow startup/recovery time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14291">[ date ]</a>
              <a href="thread.html#14291">[ thread ]</a>
              <a href="subject.html#14291">[ subject ]</a>
              <a href="author.html#14291">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Since upgraded to 2.5.1 from 2.1.1, one of our rabbit servers refuses to
finish startup procedures.. starup_log shows:

AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at qa</A>
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.5.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : kiHDz4b553meuCVcbBEI4w==
log            : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at qa.log</A>
sasl log       : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at qa-sasl.log</A>
database dir   : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at qa</A>
erlang version : 5.8

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
 ...done
starting database
...done
starting codec correctness check
 ...done
-- external infrastructure ready
starting plugin registry
 ...done
starting auth mechanism cr-demo
...done
starting auth mechanism amqplain
 ...done
starting auth mechanism plain
...done
starting statistics event manager
...done
starting logging server
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
 ...done
starting exchange type topic
 ...done
-- kernel ready
starting alarm handler
 ...done
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange, queue and binding recovery                         ...

At this point it keeps 'doing nothing' forever.. which makes me think it's
just re-indexing/recovering queues and messajes, however, the mail log files
show the following error:

=ERROR REPORT==== 2-Aug-2011::13:27:55 ===
** Generic server &lt;0.127.0&gt; terminating
** Last message in was {'$gen_cast',
                           {submit_async,
                               #Fun&lt;rabbit_queue_index.24.55115249&gt;}}
** When Server state == 2
** Reason for termination ==
** {function_clause,
       [{rabbit_queue_index,journal_minus_segment1,
            [{no_pub,no_del,ack},
             {{&lt;&lt;144,186,140,223,68,195,225,104,84,142,97,239,10,35,24,96&gt;&gt;,
               {message_properties,undefined,false},
               true},
              no_del,no_ack}]},
        {rabbit_queue_index,'-journal_minus_segment/2-fun-0-',4},
        {array,sparse_foldl_3,7},
        {array,sparse_foldl_2,9},
        {rabbit_queue_index,'-recover_journal/1-fun-0-',1},
        {dict,map_bucket,2},
        {dict,map_bkt_list,2},
        {dict,map_bkt_list,2}]}

Should I ignore such error??

Greets
Pablo

PD: I can zip &amp; send our mnesia files just in case they are needed to debug
the issue.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/4b57756e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/4b57756e/attachment.htm</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014372.html">[rabbitmq-discuss] CRL support
</A></li>
	<LI>Next message: <A HREF="014294.html">[rabbitmq-discuss] Slow startup/recovery time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14291">[ date ]</a>
              <a href="thread.html#14291">[ thread ]</a>
              <a href="subject.html#14291">[ subject ]</a>
              <a href="author.html#14291">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
