<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ on EC2 performance challenge
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20on%20EC2%20performance%20challenge&In-Reply-To=%3CCABzX%2Bqyqnn3mjH11nvsEP2qcNrkaam18sZJkZnkDC3VHaemAFA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014333.html">
   <LINK REL="Next"  HREF="014330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ on EC2 performance challenge</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20on%20EC2%20performance%20challenge&In-Reply-To=%3CCABzX%2Bqyqnn3mjH11nvsEP2qcNrkaam18sZJkZnkDC3VHaemAFA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ on EC2 performance challenge">majek04 at gmail.com
       </A><BR>
    <I>Mon Aug  8 16:16:54 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014333.html">[rabbitmq-discuss] RabbitMQ on EC2 performance challenge
</A></li>
        <LI>Next message: <A HREF="014330.html">[rabbitmq-discuss] RabbitMQ on EC2 performance challenge
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14391">[ date ]</a>
              <a href="thread.html#14391">[ thread ]</a>
              <a href="subject.html#14391">[ subject ]</a>
              <a href="author.html#14391">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Aug 4, 2011 at 10:40, Jaymin Shah &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sjaymin at gmail.com</A>&gt; wrote:
&gt;<i> What could be performance expectations of RabbitMQ on EC2? Would appreciate
</I>&gt;<i> sharing experience here.
</I>&gt;<i>
</I>&gt;<i> I am trying to do some performance test of RabbitMQ on aws EC2. I have 3
</I>&gt;<i> separate EC2 instance running for RabbitMQ, Publisher and consumer/worker.
</I>&gt;<i>
</I>&gt;<i> The scenario I have is that Publisher pushes JSON string (approx 165-200
</I>&gt;<i> bytes) to exchange type direct with durable set to true and bind queue with
</I>&gt;<i> durable set to true (i.e. both in persistent mode). Consumer/worker is
</I>&gt;<i> running on separate box - keeps pulling messages. (Moving forward these
</I>&gt;<i> messages at worker are expected to be persisted in MongoDB and Publisher
</I>&gt;<i> would be replaced with Restful &#160;service using REST easy)
</I>&gt;<i>
</I>&gt;<i> To keep things simple I have simulated this scenario by using Multicast
</I>&gt;<i> sample code. I had split multicast code in to two separate java file namely
</I>&gt;<i> &#8220;Producer&#8221; and &#8220;Worker&#8221; to run each on separate box. I have used &#8220;c1.mediam&#8221;
</I>&gt;<i> EC2 with Ubuntu server v11.4 32 bit for running producer and consumer and
</I>&gt;<i> &#8220;m1.large&#8221; with Ubuntu server v11.4 64 bit for RabbitMQ.
</I>
Sounds sensible.

&gt;<i> I am able to achieve a throughput of 3-5k messages per second i.e. keeping
</I>&gt;<i> study message push rate to 5K. (This concur with
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/faq.html#performance-latency">http://www.rabbitmq.com/faq.html#performance-latency</A>)
</I>&gt;<i>
</I>&gt;<i> Further, when I increase the push rate to 10-12k messages per second.
</I>&gt;<i> Consumer&#8217;s ability to consume messages drops to 1-2k messages per second and
</I>&gt;<i> it generates backlog (Many time it goes below 800 messages per second too).
</I>&gt;<i>
</I>&gt;<i> With above scenario, I have following questions and would appreciate
</I>&gt;<i> thoughts/suggestion to improve throughput of consumer as well. &#160;(NOTE: all
</I>&gt;<i> the messages in my scenario are expected to similar type giving no
</I>&gt;<i> opportunity to group them for setting routing therefore may need some kind
</I>&gt;<i> of load-balancer approach)
</I>&gt;<i>
</I>&gt;<i> 1)&#160;This performance is observed with one rabbitMQ server, one exchange and
</I>&gt;<i> one queue. Is anything further can be configured, fine-tuned to improvise
</I>&gt;<i> throughput to more than 5k with persistent mode.
</I>
Oh, you're sending persistent messages. Can you repeat the test for the
transient messages?

Why are you using persistence? I'm not sure what's the point,
as you're running on ec2, you have no guarantees whatsoever,
ebs may die, your local storage may die.

BTW, are you using ebs or just local ec2 disk?

&gt;<i> 2)&#160;I do understand, clustering could be another option. However, I need to
</I>&gt;<i> set cluster based on incoming load and I may not get message grouping /
</I>&gt;<i> identity to define routing (since messages are expected to be just log
</I>&gt;<i> description). Can I have clustering following load balancing option for
</I>&gt;<i> worker/consumer?
</I>
Clustering can increase performance only in a very few cases.
You must use multiple queues, configure clients to connect
to different nodes and have a good connectivity between nodes.
Clustering is a bit like setting few separate rabbitmq servers
that are able to exchange messages between them
(and obviously they share a namespace).

&gt;<i> 3)&#160;I am expected to process several hundred thousand requests per second. I
</I>&gt;<i> would appreciate sharing some experience and approach to achieve this.
</I>
You should think about setting few rabbitmq instances (using clustering or
as completely separate instances) and using at least one queue
on every rabbit.

Cheers,
   Marek
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014333.html">[rabbitmq-discuss] RabbitMQ on EC2 performance challenge
</A></li>
	<LI>Next message: <A HREF="014330.html">[rabbitmq-discuss] RabbitMQ on EC2 performance challenge
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14391">[ date ]</a>
              <a href="thread.html#14391">[ thread ]</a>
              <a href="subject.html#14391">[ subject ]</a>
              <a href="author.html#14391">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
