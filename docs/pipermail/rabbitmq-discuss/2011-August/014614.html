<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.2.0%20message%20delivery%20issue%3A%0A%09internal%20crash&In-Reply-To=%3C0122a43f-548d-4ae1-a0de-72a449e71cce%40b8g2000vbg.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014608.html">
   <LINK REL="Next"  HREF="014615.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash</H1>
    <B>Alfonso Pantoja</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.2.0%20message%20delivery%20issue%3A%0A%09internal%20crash&In-Reply-To=%3C0122a43f-548d-4ae1-a0de-72a449e71cce%40b8g2000vbg.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash">alfonso.pantoja at gmail.com
       </A><BR>
    <I>Thu Aug 18 14:50:52 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014608.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash
</A></li>
        <LI>Next message: <A HREF="014615.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14614">[ date ]</a>
              <a href="thread.html#14614">[ thread ]</a>
              <a href="subject.html#14614">[ subject ]</a>
              <a href="author.html#14614">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias &amp; Matthew thank for your responses.

We are not using any plugin and send  the messages inside mod_rabbitmq
(we customized it a bit)
catching presence and chat messages in order to forward them to a
RabbitMQ queue.
The protocol we use for consume messages is AMQP (v.0_9).

Since the problem was not solved by restarting the broker I thought it
could exist a message corruption (we are using persistent messages)
as you suggested because the problem disappeared when we purged the
queue.
Because this issue does not happen very ofter I'm wondering if you
could suggest what to the check (messages properties use, etc.) or the
possible causes that lead to message corruption (after reading your
responses I  understand that we should review our modifications in
mod_rabbitmq but it would be nice to have a tip to track down that
bug)

Regarding the broker upgrade I would like to know what is the
procedure for upgrading it without losing the messages (all our
messages are persistent).


Thank you in advance.


Regards,

Alfonso

On 18 ago, 10:00, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matth... at rabbitmq.com</A>&gt; wrote:
&gt;<i> Alfonso,
</I>&gt;<i>
</I>&gt;<i> On 18/08/11 08:37, Alfonso Pantoja wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; More info: the issue was &quot;solved&quot; by purging the messages in the
</I>&gt;<i> &gt; queue.
</I>&gt;<i> &gt; So I think there is something in them that Rabbit does not like.
</I>&gt;<i>
</I>&gt;<i> Yes, that's what Matthew said in his reply.
</I>&gt;<i>
</I>&gt;<i> &gt; It is strange because the messages are sent always the same way so
</I>&gt;<i> &gt; the issue happens randomly.
</I>&gt;<i>
</I>&gt;<i> Assuming all messages are sent from mod_ejabberd, I suspect there is
</I>&gt;<i> some variation in the code path there that leads to different data
</I>&gt;<i> ending up in the messages.
</I>&gt;<i>
</I>&gt;<i> &gt; The messages are sent using the timestamp (in milliseconds) and
</I>&gt;<i> &gt; content-type AMQP fields.
</I>&gt;<i>
</I>&gt;<i> The source of the problem is almost certainly in mod_rabbitmq or your
</I>&gt;<i> modifications to it.
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014608.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash
</A></li>
	<LI>Next message: <A HREF="014615.html">[rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:	internal crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14614">[ date ]</a>
              <a href="thread.html#14614">[ thread ]</a>
              <a href="subject.html#14614">[ subject ]</a>
              <a href="author.html#14614">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
