<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster Disk Node vs Ram Node explanation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Disk%20Node%20vs%20Ram%20Node%20explanation&In-Reply-To=%3CCA8274F8.EBE9%25rparra%40homeaway.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014764.html">
   <LINK REL="Next"  HREF="014766.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster Disk Node vs Ram Node explanation</H1>
    <B>Rene Parra</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Disk%20Node%20vs%20Ram%20Node%20explanation&In-Reply-To=%3CCA8274F8.EBE9%25rparra%40homeaway.com%3E"
       TITLE="[rabbitmq-discuss] Cluster Disk Node vs Ram Node explanation">rparra at homeaway.com
       </A><BR>
    <I>Tue Aug 30 17:07:36 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014764.html">[rabbitmq-discuss] Troubleshooting Shovel 2.5.1 on Windows
</A></li>
        <LI>Next message: <A HREF="014766.html">[rabbitmq-discuss] Troubleshooting Shovel 2.5.1 on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14765">[ date ]</a>
              <a href="thread.html#14765">[ thread ]</a>
              <a href="subject.html#14765">[ subject ]</a>
              <a href="author.html#14765">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I know this has probably been discussed at length in this list and
elsewhere.

Reference:
<A HREF="http://groups.google.com/group/rabbitmq-discuss/msg/baa8f8b30ba423e0">http://groups.google.com/group/rabbitmq-discuss/msg/baa8f8b30ba423e0</A>

I just want to clarify:

GIVEN:
* A load balanced cluster consisting of disk node A, ram node B, and ram
node C

WHEN:
* A client is routed to ram node B via the load balancer,
* AND the client declares a durable queue on its connection to ram node B,
* AND the client declares bindings to a topic exchange being serviced by a
producer connected on ram node C;

WHERE are the messages stored?
WHAT happens to the producer on ram node C when ram node B fails? (Does it
block? Do messages continue to be delivered? Are messages to the client
lost?)

POSSIBLE ANSWERS:

A) Messages are stored on disk node A but served up through ram node B.
If ram node B goes down, messages are preserved and when the client
reconnects on any node, the messages can be retrieved.  Since the messages
are stored on disk node A, the producer connected on ram node C continues to
publish messages to its topic exchange without blocking.

B) They are stored on disk for ram node B. If ram node B goes down, the
queue is unavailable for delivery, the producer on ram node C blocks on
publishing of messages until ram node B comes back up again. (I&#185;m assuming
metadata of the network is shared by the cluster therefore ram node C,
&#179;knows&#178; it has bindings to a durable queue on node B, which is unresponsive,
so it blocks).

C) They are not stored on disk for ram node B (unless under memory
pressure).  Any messages in memory are lost. C does not block on publishing
of messages, but continues to publish messages to topic exchange. Bindings
are non-existent until ram node B comes back up again, or the client
reconnects/redeclares durable queue on another node for servicing.

D) Something else?

My inclination is to say A) is the right answer above.

However, I just finished a soak test where my durable queue on ram node B
lost messages over the weekend due to a network hiccup that crashed ram node
B. When it came back up again messages were lost.  As such, we are
recommending our production configuration to be unclustered, disk node only
until we better understand the benefits and use cases associated with
clustering with RabbitMQ 2.5.1

A simple tutorial or explanation of &#179;To Disk Node or To Ram Node... that is
the question&#178; would be great and useful for those of us implementing,
learning and teaching rabbit to our organizations.

Regards,
--rparra


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110830/44f59213/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110830/44f59213/attachment.htm</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014764.html">[rabbitmq-discuss] Troubleshooting Shovel 2.5.1 on Windows
</A></li>
	<LI>Next message: <A HREF="014766.html">[rabbitmq-discuss] Troubleshooting Shovel 2.5.1 on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14765">[ date ]</a>
              <a href="thread.html#14765">[ thread ]</a>
              <a href="subject.html#14765">[ subject ]</a>
              <a href="author.html#14765">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
