<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20actively%20refuses%20connections%20after%0A%09connectity%20issues&In-Reply-To=%3C968a1a05-b848-4794-b8ad-9a865489ce51%40p20g2000yqp.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014324.html">
   <LINK REL="Next"  HREF="014285.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues</H1>
    <B>Alfonso Pantoja</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20actively%20refuses%20connections%20after%0A%09connectity%20issues&In-Reply-To=%3C968a1a05-b848-4794-b8ad-9a865489ce51%40p20g2000yqp.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues">alfonso.pantoja at gmail.com
       </A><BR>
    <I>Tue Aug  2 10:06:23 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014324.html">[rabbitmq-discuss] Queuing fundamentals.
</A></li>
        <LI>Next message: <A HREF="014285.html">[rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14279">[ date ]</a>
              <a href="thread.html#14279">[ thread ]</a>
              <a href="subject.html#14279">[ subject ]</a>
              <a href="author.html#14279">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

we are running RabbitMQ v. 2.2.0 on Ubuntu and yesterday we
experienced a problem in our production server after a connectivity
issue that caused the consumers couldn't access to Rabbit.
After the connectivity issue was solved the consumers couldn't connect
to Rabbit anymore (they are windows services).
Our RabbitMQ works with Ejabberd using a custom mod_rabbitmq.

In some consumers we saw the error
System.Net.Sockets.SocketException: An operation on a socket could not
be performed because the system lacked sufficient buffer space or
because a queue was full&quot;
And after some time this error turned into

System.Net.Sockets.TcpClient.Connect(String hostname, Int32 port)
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(AmqpTcpEndpoint
endpoint)
  at
RabbitMQ.Client.Framing.Impl.v0_9.ProtocolBase.CreateFrameHandler(AmqpTcpEndpoint
endpoint)
  at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
maxRedirects, IDictionary connectionAttempts, IDictionary
connectionErrors, AmqpTcpEndpoint[]&amp; mostRecentKnownHosts,
AmqpTcpEndpoint endpoint)amqp-0-<A HREF="9://xx.xx.xxx.xxx:5672">9://xx.xx.xxx.xxx:5672</A> -
System.Net.Sockets.SocketException: No connection could be made
because the target machine actively refused it

I've been doing a research about this problem and found that some
services are using BasicGet for getting the messages continously. In
this group I've found a reference to a issue with BasicGet which
caused the consumer to hang after a certain number of messages.
Maybe BasicGet is using too connections (and also those services are
using Qos=1) but the most strange thing is the error where Rabbit
refuses the connections.
Is there any limitation on RabbitMQ or a security system for avoiding
continous short living connections (as far as

I know BasicGet opens and closes channel connections)?
By the way the rabbit connections is constructed with a heartbeat=3.

Moreover when the problem arised we tried to connect other consumers
using another Windows machine and Rabbit still refused the
connections. The problem couldn't be solved immediatly
and a couple of Rabbit restarts were needed. They also tried to
replace the rabbit with another rabbit server (they use pacemaker).

Finally the problem gone (magically?) and the consumers worked again.

Any ideas?





</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014324.html">[rabbitmq-discuss] Queuing fundamentals.
</A></li>
	<LI>Next message: <A HREF="014285.html">[rabbitmq-discuss] RabbitMQ actively refuses connections after	connectity issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14279">[ date ]</a>
              <a href="thread.html#14279">[ thread ]</a>
              <a href="subject.html#14279">[ subject ]</a>
              <a href="author.html#14279">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
