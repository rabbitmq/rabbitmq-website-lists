<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ performance tips,	collected with sweat and blood
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20performance%20tips%2C%0A%09collected%20with%20sweat%20and%20blood&In-Reply-To=%3CCANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014527.html">
   <LINK REL="Next"  HREF="014513.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ performance tips,	collected with sweat and blood</H1>
    <B>Eugene Kirpichov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20performance%20tips%2C%0A%09collected%20with%20sweat%20and%20blood&In-Reply-To=%3CCANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ performance tips,	collected with sweat and blood">ekirpichov at gmail.com
       </A><BR>
    <I>Fri Aug 12 05:47:40 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014527.html">[rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks like a genuine bug...
</A></li>
        <LI>Next message: <A HREF="014513.html">[rabbitmq-discuss] RabbitMQ performance tips, collected with sweat and blood
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14511">[ date ]</a>
              <a href="thread.html#14511">[ thread ]</a>
              <a href="subject.html#14511">[ subject ]</a>
              <a href="author.html#14511">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I decided that I've asked too many hard or confusing questions lately,
and decided to contribute instead :)

So here's what I learnt about making rabbitmq fast, or at least
avoiding making it slow:
* Turn on prefetch. Large is good, small is better than nothing. You
can try a trick &quot;reject a prefetched message if we didn't actually
need it for a few seconds/minutes&quot;. Consider prefetch individually for
each queue; e.g. it may be that you cannot turn it on for tasks, but
can for results.
* Turn on autoAck
* Do not use transactions
* In a cluster, always communicate with a queue only through the
broker that first declared it
* Avoid frequently doing these things, esp. on a cluster: establishing
a connection, BasicConsume, QueueDeclare etc. If you do them often
(dozens/hundreds of times per second), you're completely screwed. And
conversely, if you're completely screwed, the first place to look is
whether you're doing these things too frequently, and if you're not,
look again.
* Avoid overloading rabbitmq with published messages in a queue and
making it swap like crazy. For that, use ConfirmSelect (publisher
confirmations), track (in your app) the number of unconfirmed messages
and block further submission if there are too many (more than a few
dozen megabytes). The effect is really dramatic.
* Use a 64-bit machine and raise the vm high watermark
* Increase erlang process limit
* Increase file descriptor limit
* Split one queue into many, as a queue can only utilize 1 core -
across a cluster or not (either will give some benefit); publish in
roundrobin (between those sub-queues that aren't overloaded acc. to
publisher confirmations); consume all simultaneously.

More tips welcome.

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. <A HREF="http://www.mirantis.com/">http://www.mirantis.com/</A>
Editor, <A HREF="http://fprog.ru/">http://fprog.ru/</A>
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014527.html">[rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks like a genuine bug...
</A></li>
	<LI>Next message: <A HREF="014513.html">[rabbitmq-discuss] RabbitMQ performance tips, collected with sweat and blood
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14511">[ date ]</a>
              <a href="thread.html#14511">[ thread ]</a>
              <a href="subject.html#14511">[ subject ]</a>
              <a href="author.html#14511">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
