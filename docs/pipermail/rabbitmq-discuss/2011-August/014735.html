<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Management Plugin stops gathering stats ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Management%20Plugin%20stops%20gathering%20stats%20%3F&In-Reply-To=%3CCA7BEC9B.EAA7%25rparra%40homeaway.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014715.html">
   <LINK REL="Next"  HREF="014736.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Management Plugin stops gathering stats ?</H1>
    <B>Rene Parra</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Management%20Plugin%20stops%20gathering%20stats%20%3F&In-Reply-To=%3CCA7BEC9B.EAA7%25rparra%40homeaway.com%3E"
       TITLE="[rabbitmq-discuss] Management Plugin stops gathering stats ?">rparra at homeaway.com
       </A><BR>
    <I>Thu Aug 25 18:12:11 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014715.html">[rabbitmq-discuss] Management Plugin stops gathering stats ?
</A></li>
        <LI>Next message: <A HREF="014736.html">[rabbitmq-discuss] Management Plugin stops gathering stats ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14735">[ date ]</a>
              <a href="thread.html#14735">[ thread ]</a>
              <a href="subject.html#14735">[ subject ]</a>
              <a href="author.html#14735">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias, et.al, 

It took me a while to answer this, sorry for the delay.

We have since upgraded to 2.5.1 and erlang R14B03.

The publish rates seem to only work if I use the CachingConnectionFactory in
Spring vs the SingleConnectionFactory. Makes sense, because when I use
SingleConnectionFactory, my publisher is creating and closing a connection
on every single publish.... therefore rabbit only can create statistics for
a connection that no longer exists (wouldn't make sense unless you are doing
historic stats, which I'd be surprised if you do).

FWIW,

The stats bug, and the memory bug seem to be better in 2.5.1/R14B03. We are
progressing with our soak / load tests at a very light load (100 TPS).

I was able to exhibit the stats bug, and hence memory bug however in
2.5.1/R14B03 under high load.

The video is here:

TimePoints:
* @ 0m00s:  - Memory Pressure WORKING, Throttling ACTIVE
* @ 0m37s:  - BANG! Statistics stop collecting
* @ 0m56s:  - Showing how Memory Level now exceeded.

Good news is all the messages were indeed delivered.
Bad news even after the test completed, I had to restart RabbitMQ to recover
the memory back down to a normal state and get the stats/memory
level/publish throttling working again.

We are going to continue with our tests @ 100TPS (since that is all we need
for our initial application) but would appreciate any other insight that we
can provide for you on this issue.

Thank you for your help!
--rparra

Note: The above screencast was done after we upgraded to 2.5.1 but BEFORE we
upgraded to erlang R14B03.  We have not run the heavy load against R14B03
yet.

On 8/23/11 3:35 PM, &quot;Matthias Radestock&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:

&gt;<i> Rene,
</I>&gt;<i> 
</I>&gt;<i> On 23/08/11 20:59, Rene Parra wrote:
</I>&gt;&gt;&gt;&gt;<i> Here&#185;s a ScreenCast of the management UI working and then &#179;FAILS&#178;:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://goo.gl/jrvAP">http://goo.gl/jrvAP</A>
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> (please fast forward to these time points in the screencast)
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> @2m 16s:  The system runs normally and then I demo the queues stats
</I>&gt;&gt;&gt;&gt;<i> collection working perfectly.
</I>&gt;<i> 
</I>&gt;<i> Er, no, something is wrong here. We see Delivers and Acks, but no queued
</I>&gt;<i> messages and no publishes. So where are the delivered messages coming
</I>&gt;<i> from? ...
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> @2m 56s:  Connection View shows normal operating behavior.
</I>&gt;<i> 
</I>&gt;<i> This shows a 25kb/s inbound rate on one of the connections. Presumably
</I>&gt;<i> these are the publishes, but for some reason they don't show up in the
</I>&gt;<i> stats.
</I>&gt;<i> 
</I>&gt;<i> I definitely recommend upgrading to 2.5.1. If the problem still occurs
</I>&gt;<i> there it will be easier for us to track down.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Matthias.
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014715.html">[rabbitmq-discuss] Management Plugin stops gathering stats ?
</A></li>
	<LI>Next message: <A HREF="014736.html">[rabbitmq-discuss] Management Plugin stops gathering stats ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14735">[ date ]</a>
              <a href="thread.html#14735">[ thread ]</a>
              <a href="subject.html#14735">[ subject ]</a>
              <a href="author.html#14735">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
