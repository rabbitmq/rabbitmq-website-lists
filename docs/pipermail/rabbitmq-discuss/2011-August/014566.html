<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] major failure when clearing large queue backlog
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20major%20failure%20when%20clearing%20large%20queue%0A%20backlog&In-Reply-To=%3C20110816125616.GC5810%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014565.html">
   <LINK REL="Next"  HREF="014567.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] major failure when clearing large queue backlog</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20major%20failure%20when%20clearing%20large%20queue%0A%20backlog&In-Reply-To=%3C20110816125616.GC5810%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] major failure when clearing large queue backlog">matthew at rabbitmq.com
       </A><BR>
    <I>Tue Aug 16 13:56:16 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014565.html">[rabbitmq-discuss] major failure when clearing large queue	backlog
</A></li>
        <LI>Next message: <A HREF="014567.html">[rabbitmq-discuss] major failure when clearing large queue	backlog
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14566">[ date ]</a>
              <a href="thread.html#14566">[ thread ]</a>
              <a href="subject.html#14566">[ subject ]</a>
              <a href="author.html#14566">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Aug 16, 2011 at 08:45:27AM -0400, Aaron Westendorf wrote:
&gt;<i> We've been running this configuration for a long time now, and I
</I>&gt;<i> vaguely recall that when the spool-to-disk feature was added, it was
</I>&gt;<i> dependent on this setting. However, I've seen it write to disk even
</I>&gt;<i> with this setting off so I may be mistaken.
</I>
Yes, because whilst setting it to 0 stops the broker from throttling
producers when memory gets tight, the queues are forced to assume that
there is 1GB of memory available and they do continue to watch memory
use and write to disk as they see fit. Thus if you have more than 1GB
RAM in your machines, Rabbit will be writing to disk earlier that it
should.

&gt;<i> Regardless, we don't have
</I>&gt;<i> support in our applications for flow control (yet?) so I've been wary
</I>&gt;<i> to enable vm_memory_high_watermark. I plan to add a concept of flow
</I>&gt;<i> control strategies to haigha so that common use cases can be
</I>&gt;<i> abstracted without per-app implementations.
</I>
Ok understood. The way Rabbit does it these days is that it just stops
reading from the sockets of publishers. Thus the TCP buffers will fill
up, and the publishers will just find that writing to their socket
blocks. We don't use channel.flow any more. Thus you may find that you
need do nothing, or, you may have a situation where you really don't
want to have publishers blocked.

&gt;<i> I've seen rabbit use much more than 1GB so I don't think it's defaulted to that.
</I>
Well we can't control fully how much RAM gets used. That's why we hedge
our bets and have the default at 0.4 of the installed RAM. This allows
space for transient spikes such as GC and so forth. The point of the 1GB
default is that this controls when Rabbit starts to send msgs to disk to
try and free up RAM. But ultimately, it won't stop Rabbit/Erlang from
using more than 1GB RAM if that's necessary.

Matthew
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014565.html">[rabbitmq-discuss] major failure when clearing large queue	backlog
</A></li>
	<LI>Next message: <A HREF="014567.html">[rabbitmq-discuss] major failure when clearing large queue	backlog
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14566">[ date ]</a>
              <a href="thread.html#14566">[ thread ]</a>
              <a href="subject.html#14566">[ subject ]</a>
              <a href="author.html#14566">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
