From alexis.richardson at gmail.com  Thu Apr  1 00:44:08 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 31 Mar 2010 16:44:08 -0700
Subject: [rabbitmq-discuss] clustering question
In-Reply-To: <BF8565BD-A0EC-4E6D-81C5-FDB4D2BEB944@gmail.com>
References: <BF8565BD-A0EC-4E6D-81C5-FDB4D2BEB944@gmail.com>
Message-ID: <g2y167204d21003311644h6c9c446fz3c801cb457fa6e9a@mail.gmail.com>

Ian

Some background on this is here: http://www.rabbitmq.com/faq.html#performance

The unavailability of a node prevents any queues on that node from
receiving messages - instead they must find another path through the
broker.  By the same token, client cannot consume from a queue whose
node is down.  Queues cannot yet have an existence 'across' nodes.  It
is however possible to set up 'back up' queues using normal AMQP.  I
recommend @ezmobius presentation on Redis, found on slideshare, as
well as some of our video presentations on high availability - which
you can find via this link repo:
http://delicious.com/alexisrichardson/rabbitmq+video+presentation

Does this help?  Let us know.

Cheers

alexis


On Wed, Mar 31, 2010 at 2:29 PM, Ian Ragsdale <ian.ragsdale at gmail.com> wrote:
> Hello all. ?I just set up a rabbitmq cluster using the clustering setup guide on the website, and I can report that the guide was easy to follow and worked well. ?However, I did have a question about a couple of statements made in the guide that I would like to clarify.
>
> The guide says:
>
> "RabbitMQ brokers tolerate the failure of individual nodes. Nodes can be started and stopped at will."
>
> As well as:
>
> "All data/state required for the operation of a RabbitMQ broker is replicated across all nodes, for reliability and scaling, with full ACID properties. An exception to this are message queues, which currently only reside on the node that created them, though they are visible and reachable from all nodes."
>
> So, from this I can assume that if one of my nodes go down the cluster will continue to operate, but how will that affect any queues that resided on the inoperative node? ?If I publish a message that was meant for one of those queues will it fail? ?Will clients that are subscribed to those queues continue to receive new messages? ?I'd just like to understand what the behavior will be so that I can plan accordingly.
>
> Thanks,
> Ian
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From ian.ragsdale at gmail.com  Thu Apr  1 01:00:08 2010
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Wed, 31 Mar 2010 19:00:08 -0500
Subject: [rabbitmq-discuss] clustering question
In-Reply-To: <g2y167204d21003311644h6c9c446fz3c801cb457fa6e9a@mail.gmail.com>
References: <BF8565BD-A0EC-4E6D-81C5-FDB4D2BEB944@gmail.com>
	<g2y167204d21003311644h6c9c446fz3c801cb457fa6e9a@mail.gmail.com>
Message-ID: <DF96C3E8-273F-4EB2-97F8-F5E026864482@gmail.com>

Hi Alexis, that's very useful information - using redis to dedupe messages between redundant servers is interesting.  

Regarding queues being unavailable when their nodes are down, what kind of behavior should I expect at the producer?  If I publish a message to an exchange that is bound to a queue that is unavailable, should I receive an error, would the message be in limbo until the node came back up, or would it just not get pushed into the queue?

Thanks,
Ian

On Mar 31, 2010, at 6:44 PM, Alexis Richardson wrote:

> Ian
> 
> Some background on this is here: http://www.rabbitmq.com/faq.html#performance
> 
> The unavailability of a node prevents any queues on that node from
> receiving messages - instead they must find another path through the
> broker.  By the same token, client cannot consume from a queue whose
> node is down.  Queues cannot yet have an existence 'across' nodes.  It
> is however possible to set up 'back up' queues using normal AMQP.  I
> recommend @ezmobius presentation on Redis, found on slideshare, as
> well as some of our video presentations on high availability - which
> you can find via this link repo:
> http://delicious.com/alexisrichardson/rabbitmq+video+presentation
> 
> Does this help?  Let us know.
> 
> Cheers
> 
> alexis
> 
> 
> On Wed, Mar 31, 2010 at 2:29 PM, Ian Ragsdale <ian.ragsdale at gmail.com> wrote:
>> Hello all.  I just set up a rabbitmq cluster using the clustering setup guide on the website, and I can report that the guide was easy to follow and worked well.  However, I did have a question about a couple of statements made in the guide that I would like to clarify.
>> 
>> The guide says:
>> 
>> "RabbitMQ brokers tolerate the failure of individual nodes. Nodes can be started and stopped at will."
>> 
>> As well as:
>> 
>> "All data/state required for the operation of a RabbitMQ broker is replicated across all nodes, for reliability and scaling, with full ACID properties. An exception to this are message queues, which currently only reside on the node that created them, though they are visible and reachable from all nodes."
>> 
>> So, from this I can assume that if one of my nodes go down the cluster will continue to operate, but how will that affect any queues that resided on the inoperative node?  If I publish a message that was meant for one of those queues will it fail?  Will clients that are subscribed to those queues continue to receive new messages?  I'd just like to understand what the behavior will be so that I can plan accordingly.
>> 
>> Thanks,
>> Ian
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 





From alexis.richardson at gmail.com  Thu Apr  1 01:02:42 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 31 Mar 2010 17:02:42 -0700
Subject: [rabbitmq-discuss] clustering question
In-Reply-To: <DF96C3E8-273F-4EB2-97F8-F5E026864482@gmail.com>
References: <BF8565BD-A0EC-4E6D-81C5-FDB4D2BEB944@gmail.com>
	<g2y167204d21003311644h6c9c446fz3c801cb457fa6e9a@mail.gmail.com>
	<DF96C3E8-273F-4EB2-97F8-F5E026864482@gmail.com>
Message-ID: <s2u167204d21003311702r49784589od9fd304b3a31b169@mail.gmail.com>

Ian

On Wed, Mar 31, 2010 at 5:00 PM, Ian Ragsdale <ian.ragsdale at gmail.com> wrote:
> Hi Alexis, that's very useful information - using redis to dedupe messages between redundant servers is interesting.

Thanks - I agree.

> Regarding queues being unavailable when their nodes are down, what kind of behavior should I expect at the producer? ?If I publish a message to an exchange that is bound to a queue that is unavailable, should I receive an error, would the message be in limbo until the node came back up, or would it just not get pushed into the queue?

Not necessarily, since your message may reach another queue on another
node.  If you publish with (say) key "bob" and two queues on two nodes
are bound with that key, then they both get a copy. That's pubsub in
the multicast style for you.  For precise error reporting, I shall
defer to someone with more knowledge than I ...

alexis


>
> Thanks,
> Ian
>
> On Mar 31, 2010, at 6:44 PM, Alexis Richardson wrote:
>
>> Ian
>>
>> Some background on this is here: http://www.rabbitmq.com/faq.html#performance
>>
>> The unavailability of a node prevents any queues on that node from
>> receiving messages - instead they must find another path through the
>> broker. ?By the same token, client cannot consume from a queue whose
>> node is down. ?Queues cannot yet have an existence 'across' nodes. ?It
>> is however possible to set up 'back up' queues using normal AMQP. ?I
>> recommend @ezmobius presentation on Redis, found on slideshare, as
>> well as some of our video presentations on high availability - which
>> you can find via this link repo:
>> http://delicious.com/alexisrichardson/rabbitmq+video+presentation
>>
>> Does this help? ?Let us know.
>>
>> Cheers
>>
>> alexis
>>
>>
>> On Wed, Mar 31, 2010 at 2:29 PM, Ian Ragsdale <ian.ragsdale at gmail.com> wrote:
>>> Hello all. ?I just set up a rabbitmq cluster using the clustering setup guide on the website, and I can report that the guide was easy to follow and worked well. ?However, I did have a question about a couple of statements made in the guide that I would like to clarify.
>>>
>>> The guide says:
>>>
>>> "RabbitMQ brokers tolerate the failure of individual nodes. Nodes can be started and stopped at will."
>>>
>>> As well as:
>>>
>>> "All data/state required for the operation of a RabbitMQ broker is replicated across all nodes, for reliability and scaling, with full ACID properties. An exception to this are message queues, which currently only reside on the node that created them, though they are visible and reachable from all nodes."
>>>
>>> So, from this I can assume that if one of my nodes go down the cluster will continue to operate, but how will that affect any queues that resided on the inoperative node? ?If I publish a message that was meant for one of those queues will it fail? ?Will clients that are subscribed to those queues continue to receive new messages? ?I'd just like to understand what the behavior will be so that I can plan accordingly.
>>>
>>> Thanks,
>>> Ian
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>
>



From jon.brisbin at npcinternational.com  Thu Apr  1 15:24:57 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 1 Apr 2010 09:24:57 -0500
Subject: [rabbitmq-discuss] New RabbitMQ Groovy DSL
In-Reply-To: <q2sf977c6861003311658hcd722d84kef587fa8ea2aa188@mail.gmail.com>
References: <FE120BF9-E002-49BB-A7D7-1A6E5774395E@npcinternational.com>
	<q2sf977c6861003311658hcd722d84kef587fa8ea2aa188@mail.gmail.com>
Message-ID: <6DA68E12-AE52-4C64-A659-F409FB1B3EF6@npcinternational.com>

I've put the RabbitMQ Groovy DSL code up on Github:

http://github.com/jbrisbin/rabbitmq-dsl

I've tried to include enough documentation to get people going with a command-line DSL runner. I'm always interested in feedback, so please don't be shy. :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Mar 31, 2010, at 6:58 PM, Rob Elsner wrote:

> Jon,
> 
> I've used Rabbit in some applications, so when you get that up I'd
> like to help contribute.  I'm working on my Groovy, so it's a good
> project.
> 
> Thanks,
> Rob
> 
> On Wed, Mar 31, 2010 at 2:49 PM, Jon Brisbin
> <jon.brisbin at npcinternational.com> wrote:
>> Folks,
>> 
>> "I'm fixin' to" (as we say here in the Midwest) upload some recent work I've done on a Groovy-language DSL for RabbitMQ that lets me integrate with our existing Groovy REST/MVC framework. A simple example looks like:
>> 
>> mq.on error: {err ->
>>  log.error(err.message)
>> }, myevent: {msg ->
>>  log.info(msg.bodyAsString)
>> }
>> 
>> // Initialization
>> mq {channel ->
>>  //channel.queueDelete("test")
>>  //channel.exchangeDelete("test")
>> }
>> 
>> mq.exchange(name: "test") {
>>  // Named, non-durable queue
>>  queue name: "test", routingKey: "test.key", {
>>    consume tag: "test", onmessage: "myevent"
>>  }
>>  // Anonymous (server-generated) non-durable queue
>>  queue name: null, routingKey: "test2.key", {
>>    consume tag: "test2", onmessage: {msg ->
>>      log.info(msg.bodyAsString)
>>      log.info("myHeaderValue=" + msg.properties.headers["myHeaderValue"])
>>    }
>>  }
>>  // Poke some messages
>>  queue routingKey: "test.key", {
>>    publish body: "this is a test"
>>  }
>>  queue routingKey: "test2.key", {
>>    publish myHeaderValue: "customHeader", body: {msg, out ->
>>      msg.properties.contentType = "text/plain"
>>      out.write("test are test bytes".bytes)
>>    }
>>  }
>> }
>> 
>> 
>> To test it, I've got a command-line utility that takes RabbitMQ connection parameters and a Groovy DSL file to operate on (it also handles stdin/stdout for piping).
>> 
>> Basics of the system include:
>> 
>> * Direct access to the channel when you need custom stuff.
>> * A very basic event system for dispatch error and custom application events.
>> * Using Groovy, I can get a lot of stuff done quickly (works great for utilities, etc...).
>> * On a "consume" closure, if you return a non-null/true result, it will keep listening for more messages (uses a QueuingConsumer).
>> * On a "publish" node, if you specify a closure for the body, it will call() that closure, passing an output stream for you to do custom byte processing, otherwise it'll try and fit whatever you tell it into the message body (strings automagically converted, etc...).
>> 
>> There's more to this. This is just a simplistic example. I'll try and document some of that on my github account.
>> 
>> I'd be interested in some feedback. I'm wondering what might make this useful to more people than just me. I do make some assumptions about how I'm interacting with RabbitMQ because that's just how we're doing it. I'd be interested in hearing if that doesn't hold for others.
>> 
>> I'll post the link when I've got everything put into Git.
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 




From johndapps at gmail.com  Thu Apr  1 15:58:57 2010
From: johndapps at gmail.com (John Apps)
Date: Thu, 1 Apr 2010 16:58:57 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after
	several hours running MulticastMain from 1.7.2
Message-ID: <z2x173a1edc1004010758m31b83ca5r56e0ee56e90ef338@mail.gmail.com>

Wondering why this crashes when vm_memory_high_watermark is set?

This message "vm_memory_high_watermark set. Memory used:935,079,976
allowed:858,993,459" is rather intriguing, or am I missing something? (The
commas were inserted by me in order to make the number more legible.)

Environment:

   - Windows 7 X64 (4GB memory)
   - RabbitMQ 1.7.2
   - Erlang R13B04

rabbitmq.config

[
  {rabbit, [{vm_memory_high_watermark, 0.4}]},
  {rabbit, [{memory_alarms, true}]},
  {mnesia, [{dump_log_write_threshold, 1000}]},
  {rabbit, []}
].


Running these two clients:

   - MulticastMain -y 0 -s 128 -e e -t fanout -r 1100 -f persistent
   - MulticastMain -x 0 -e e -t fanout -y 10 -n 500 -q 1000

The broker crashed with:

Thu Apr 01 15:22:19 2010
Slogan: eheap_alloc: Cannot allocate 153052320 bytes of memory (of type
"heap").
System version: Erlang R13B04 (erts-5.7.5) [smp:2:2] [rq:2]
[async-threads:30]
Compiled: Mon Feb 22 20:02:36 2010


--- this is the log file ---
=INFO REPORT==== 1-Apr-2010::15:15:04 ===
Memory limit set to 819MB.

=INFO REPORT==== 1-Apr-2010::15:15:04 ===
disk_log: repairing
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnesia/ra
bbit_persister.LOG" ...
=INFO REPORT==== 1-Apr-2010::15:15:08 ===
Repaired persister log - 501 recovered, 0 bad
=INFO REPORT==== 1-Apr-2010::15:15:21 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous"
=INFO REPORT==== 1-Apr-2010::15:15:22 ===
started TCP Listener on 0.0.0.0:5672
=INFO REPORT==== 1-Apr-2010::15:17:50 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37477
=INFO REPORT==== 1-Apr-2010::15:17:50 ===
starting TCP connection <0.315.0> from 127.0.0.1:37477
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37484
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
starting TCP connection <0.339.0> from 127.0.0.1:37484
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37485
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
starting TCP connection <0.345.0> from 127.0.0.1:37485
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37488
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
starting TCP connection <0.352.0> from 127.0.0.1:37488
=INFO REPORT==== 1-Apr-2010::15:18:09 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37489
=INFO REPORT==== 1-Apr-2010::15:18:09 ===
starting TCP connection <0.362.0> from 127.0.0.1:37489
=INFO REPORT==== 1-Apr-2010::15:18:10 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37490
=INFO REPORT==== 1-Apr-2010::15:18:10 ===
starting TCP connection <0.371.0> from 127.0.0.1:37490
=INFO REPORT==== 1-Apr-2010::15:18:11 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37491
=INFO REPORT==== 1-Apr-2010::15:18:11 ===
starting TCP connection <0.383.0> from 127.0.0.1:37491
=INFO REPORT==== 1-Apr-2010::15:18:12 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37492
=INFO REPORT==== 1-Apr-2010::15:18:12 ===
starting TCP connection <0.393.0> from 127.0.0.1:37492
=INFO REPORT==== 1-Apr-2010::15:18:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37493
=INFO REPORT==== 1-Apr-2010::15:18:13 ===
starting TCP connection <0.404.0> from 127.0.0.1:37493
=INFO REPORT==== 1-Apr-2010::15:18:16 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37494
=INFO REPORT==== 1-Apr-2010::15:18:16 ===
starting TCP connection <0.419.0> from 127.0.0.1:37494
=INFO REPORT==== 1-Apr-2010::15:18:20 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37496
=INFO REPORT==== 1-Apr-2010::15:18:20 ===
starting TCP connection <0.440.0> from 127.0.0.1:37496
=INFO REPORT==== 1-Apr-2010::15:18:37 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous"
=INFO REPORT==== 1-Apr-2010::15:20:25 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous"
=INFO REPORT==== 1-Apr-2010::15:21:38 ===
vm_memory_high_watermark set. Memory used:935079976 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:21:39 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 1-Apr-2010::15:21:41 ===
vm_memory_high_watermark clear. Memory used:857734144 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:21:41 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 1-Apr-2010::15:21:54 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous"
=INFO REPORT==== 1-Apr-2010::15:22:12 ===
vm_memory_high_watermark set. Memory used:874137976 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:22:12 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 1-Apr-2010::15:22:15 ===
vm_memory_high_watermark clear. Memory used:829796064 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:22:15 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 1-Apr-2010::15:22:17 ===
vm_memory_high_watermark set. Memory used:861047168 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:22:17 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}

--- end of log file ---
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100401/0e615e26/attachment.htm 

From juan.wajnerman at gmail.com  Thu Apr  1 16:05:25 2010
From: juan.wajnerman at gmail.com (Juan Wajnerman)
Date: Thu, 1 Apr 2010 12:05:25 -0300
Subject: [rabbitmq-discuss] Old consumer tags delivered after re-subscribing
	to a queue
Message-ID: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>

I'm facing the following issue with RabbitMQ. 
After unsubscribing from a queue, following "recover" calls will still redeliver unack'd messages through the channel. Even worse, after resubscribing to the queue, the recovered messages are still sent with the old consumer tag.

I'm using the amqp ruby library to consume the queues. Here's a small snippet that reproduces the issue. When I execute this, I always get an error similar to: Basic.Deliver for invalid consumer tag: myqueue-396735623077.

==========

require 'rubygems'
require 'amqp'
require 'mq'

Thread.new { EM.run}

AMQP.start(:host => 'localhost', :logging => false)

MQ.error do |msg|
  puts "ERROR: #{msg}"
end

@exchange = MQ.direct("myexchange")  
@queue = MQ.queue("myqueue").bind(@exchange)

def subscribe
  @queue.subscribe(:ack => true) do |msg|
    puts "Message received: #{msg}"
  end
end

subscribe ; sleep 0.2
@exchange.publish Kernel.rand(1E10).to_s ; sleep 0.2
@queue.unsubscribe ; sleep 0.2
subscribe ; sleep 0.2
MQ.recover ; sleep 0.2

==========

The reason I'm doing this is because I want to accommodate to availability of the target services. So, whenever any component is temporarily down or full, I want to stop receiving messages from the queue. Maybe is there any other way to achieve this?

I'm using RabbitMQ 1.7.2 and the ruby library is amqp 0.6.6.

Thanks,
- Juan


From johndapps at gmail.com  Thu Apr  1 17:53:57 2010
From: johndapps at gmail.com (John Apps)
Date: Thu, 1 Apr 2010 18:53:57 +0200
Subject: [rabbitmq-discuss] Persister log size calculation and rolling
	persister log frequency?
Message-ID: <q2n173a1edc1004010953t66f0d7ebjb6d022d7b37bc5d4@mail.gmail.com>

What follows is probably answered somewhere, so forgive me for asking if it
is...

RabbitMQ 1.7.2
Windows 7 X64

Observing a test using the MulticastMain client, one producer and one
receiver, with the following parameters:

   - MulticastMain -y 0 -s 128 -e e -t fanout -r 1100 -f persistent
   - MulticastMain -x 0 -e e -t fanout -y 1 -n 500 -q 1000

I see that the size of the log varies tremendously, as does the frequency
with which it is 'rolled'.
The size is presumably determined by the number of messages pending, i.e.,
not yet acknowledged?

QueuesOverviewMessagesTransactionsParametersVhostNameConsumersMemoryCountMsg
readyMsg unackCountAcks uncommitedDurableAuto deleteArguments/
amq.gen-EIK8rQQfEX9IBiqLwF6h7Q==10MB22702271227falsetrue[]The log file at
the above moment in time is 128KB. (I paused the producer long enough for
the receiver to catch up.)

QueuesOverviewMessagesTransactionsParametersVhostNameConsumersMemoryCountMsg
readyMsg unackCountAcks uncommitedDurableAuto deleteArguments/
amq.gen-EIK8rQQfEX9IBiqLwF6h7Q==1105MB2493432483431000158falsetrue[]

The log file at the above moment is some 111,529KB, the rolled over log file
about the same size.

What I am wondering about is

   1. when does the roll-over take place?
   2. what role does the dump_log_write_threshold parameter play here? (It
   is set to 1,000 in these tests)
   3. why is the previous version deleted before the current one is rolled
   over? (GFS would appear to be the algorithm which should be used in order
   not to lose anything)
   4. the new version of the log file is created with a very small initial
   allocation? Is there a way to influence this size?  (yes, I know, modern
   file systems should be able to happily expand very fast, and I have asked
   this question before. However, the time taken to 'rename' the current to
   previous and create a new log causes quite significant waves on the client
   side. These are noticeable even to the human eye.)
   5. The severe delay is only experienced by the receiver. Here are a few
   samples:




   - recving rate: 507 msg/s
      - recving rate: 506 msg/s
      - recving rate: 475 msg/s
      - recving rate: 377 msg/s
      - *recving rate: 5 msg/s*
      - recving rate: 591 msg/s
      - recving rate: 490 msg/s













---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100401/46de1efc/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr  1 21:12:00 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 1 Apr 2010 13:12:00 -0700
Subject: [rabbitmq-discuss] rabbits rabbits
Message-ID: <l2y167204d21004011312v929c0310r409fb54b89e197df@mail.gmail.com>

Happy April 1st everyone - and it's been quite the week for seasonal jinks.

I just wanted to let folks know that Friday and Monday are Bank
Holidays in the UK where many of the RabbitMQ engineers live.  It is
thus a 'long weekend'.  If you have sent an email in the last couple
of days, it may well get answered by the community, but it may not get
proper attention until after the weekend.

Cheers

alexis



From matthew at lshift.net  Fri Apr  2 16:11:39 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 16:11:39 +0100
Subject: [rabbitmq-discuss] java client swallows interrupts
In-Reply-To: <c26271fb1003180358j67f500b1yd3ffff9ba934535c@mail.gmail.com>
References: <c26271fb1003180358j67f500b1yd3ffff9ba934535c@mail.gmail.com>
Message-ID: <20100402151138.GA11613@wellquite.org>

Hi Anton,

Sorry for the slow reply.

On Thu, Mar 18, 2010 at 01:58:13PM +0300, mabrek wrote:
> I came across java client issue: it clears thread interrupted status
> and/or swallows InterruptedException in Channel operations (close,
> basicPublish) and Connection.close, maybe in others.
> It creates a problem when I need to stop consumer thread pool by
> issuing ExecutorService.shutdownNow, they won't stop.

Yup, I think this is the catch in the quiescingTransmit method in
com/rabbitmq/client/impl/AMQChannel.java

Of course, I'd actually recommend that you shutdown by closing the
consumers, channels and connections down explicitly rather than just
trying to kill off the threads. The Javadoc for shutdownNow does say:
"There are no guarantees beyond best-effort attempts to stop processing
actively executing tasks"

Is there a reason why you can't more gracefully shutdown the threads?

Matthew



From matthew at lshift.net  Fri Apr  2 16:14:45 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 16:14:45 +0100
Subject: [rabbitmq-discuss] sub-request a message using a message batch
In-Reply-To: <518E64F6-D42B-4033-B0DC-6799A350C441@npcinternational.com>
References: <518E64F6-D42B-4033-B0DC-6799A350C441@npcinternational.com>
Message-ID: <20100402151445.GB11613@wellquite.org>

Hi Jon,

Sorry for the slow reply.

On Tue, Mar 23, 2010 at 08:19:28AM -0500, Jon Brisbin wrote:
> When I'm in my handleDelivery() method of my batch message listener, it seems I can't create a new, anonymous queue which I can listen to for the results of this "sub-request", which I will grab, put into a new zip file, and send back to the requestor, along with the results from all their other requests.

You're deadlocking here because you're in the main loop thread already.
You need to get out of that thread - if you use our QueueingConsumer class
rather than DefaultConsumer and then call nextDelivery() from your own
thread you will pick up the next message in your own thread and then find
that you can make subsequent calls back to Rabbit.

I hope that makes some sense.

Matthew



From matthew at lshift.net  Fri Apr  2 16:16:57 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 16:16:57 +0100
Subject: [rabbitmq-discuss] rabbitmq-public-umbrella make error on debian
In-Reply-To: <4BA9EDAD.2030708@lshift.net>
References: <421152D4-7CCF-44EB-B950-DB458A1F442B@plyce.com>
	<4BA9B1E5.3030006@lshift.net>
	<5342322E-8082-4B66-AACC-FFD5001E6002@plyce.com>
	<4BA9D035.8040206@lshift.net> <4BA9EDAD.2030708@lshift.net>
Message-ID: <20100402151656.GC11613@wellquite.org>

On Wed, Mar 24, 2010 at 10:47:09AM +0000, Simon MacMullen wrote:
> It was me that introduced that step, so I guess I need to apologise. 
> I'll try to get this fixed today, but in the mean time, you'll need to 
> run "make clean" after installing xsltproc.

Just to update you on this, xsltproc is needed for building Rabbit now,
as some documentation now has a single source which is used to generate
man pages, website documentation and usage messages for various of the
utility programs. The makefile has been improved substantially to
ensure that the correct error message now pops out.

Matthew



From matthew at lshift.net  Fri Apr  2 16:19:17 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 16:19:17 +0100
Subject: [rabbitmq-discuss] queues scheme at startup time
In-Reply-To: <4BAA855E.30008@lshift.net>
References: <1269462150.9878.47.camel@juno>
 <4BAA855E.30008@lshift.net>
Message-ID: <20100402151916.GD11613@wellquite.org>

Hi Henry,

On Wed, Mar 24, 2010 at 02:34:22PM -0700, Tony Garnock-Jones wrote:
> Not yet, there isn't. Your best bet for now is to either write and run a
> small app that sets things up right, with durable exchanges and queues
> which will survive restarts, or to use BQL
> (http://www.rabbitmq.com/rabbitmq-bql.html) to do much the same thing.

Actually, just thinking out loud, the shovel has the ability to perform
arbitrary AMQP actions whenever it connects. This includes creating queues
etc. http://hg.rabbitmq.com/rabbitmq-shovel/ and
http://hg.rabbitmq.com/rabbitmq-shovel/file/default/README in particular.

Matthew



From matthew at lshift.net  Fri Apr  2 16:24:11 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 16:24:11 +0100
Subject: [rabbitmq-discuss] rabbit cluster keeps crashing
In-Reply-To: <28023134.post@talk.nabble.com>
References: <28023134.post@talk.nabble.com>
Message-ID: <20100402152411.GE11613@wellquite.org>

Hi,

On Wed, Mar 24, 2010 at 06:07:09PM -0700, LoOoD wrote:
> We've been having a problem with our rabbit servers. We have a cluster setup,
> one disk node and two ram nodes. All clients only connect to
> the ram nodes. The ram nodes eventually stop accepting new connections.
> 
> The only way to fix so far is to restart the affected ram node. 
> 
> We're running 1.7.2-1 (installed via the deb repo) on ubuntu 8.10 64bit.
> 
> Here is are some crash reports from rabbit-sasl.log:

Hmm. The nodedown simply suggests that Erlang has lost touch with the other
nodes. What kind of a network are you suing - is this a LAN or WAN or...
and do you see any sort of packet loss with other applications?

You may want to experiment with lower values of net_ticktime in your
rabbitmq.config file:

[{kernel, [{net_ticktime, 5}]}].

See http://ftp.sunet.se/pub/lang/erlang/doc/man/net_kernel.html#set_net_ticktime-1
for documentation. It could just be that getting the nodes to talk to each
other more frequently will solve this. On the other hand, that's likely to
only be a problem if there are large periods of inactivity in the cluster -
is this the case?

Matthew



From matthew at lshift.net  Fri Apr  2 16:38:54 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 16:38:54 +0100
Subject: [rabbitmq-discuss] basic_qos(prefetch_count=1) NOT_IMPLEMENTED
In-Reply-To: <7C243F1A-0610-439A-BB4D-18137440E073@gmail.com>
References: <7C243F1A-0610-439A-BB4D-18137440E073@gmail.com>
Message-ID: <20100402153854.GG11613@wellquite.org>

Hi Ray,

On Wed, Mar 31, 2010 at 04:26:00PM -0400, Ray Slakinski wrote:
> When I set basic_qos to 1 I get an NOT IMPLEMENTED error coming back from RabbitMQ, we are using 1.7.2 and txamqp, I was looking at an example of someone using this setting on 1.6 and working ok, so I wanted to know if its just broke in 1.7.2 and if so is there a patch forthcoming or do I need to compile things differently?
> 
> >>> yield channel.basic_qos(prefetch_count=1)
> txamqp.client.Closed: Method(name=close, id=60) (540, 'NOT_IMPLEMENTED - prefetch_size!=0 (1)', 60, 10) content = None

Looks like a bug in the client to me - you're setting prefetch_count,
which we do implement, but the server's receiving a non-zero value for
prefetch_size (which we don't implement).

You could try explicitly setting prefetch_size to 0 as well, and see if
that helps, but unless there's something funny going on elsewhere, it
smells like a bug in txamqp to me (though I've not checked the code).

Matthew



From matthew at lshift.net  Fri Apr  2 16:45:09 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 16:45:09 +0100
Subject: [rabbitmq-discuss] sub-request a message using a message batch
In-Reply-To: <51527265-20AB-4393-9963-1F00EE10ECE0@npcinternational.com>
References: <518E64F6-D42B-4033-B0DC-6799A350C441@npcinternational.com>
	<20100402151445.GB11613@wellquite.org>
	<51527265-20AB-4393-9963-1F00EE10ECE0@npcinternational.com>
Message-ID: <20100402154509.GA18728@wellquite.org>

On Fri, Apr 02, 2010 at 10:27:31AM -0500, Jon Brisbin wrote:
> I figured that something like this was going on, but at the time, I didn't know about the QueueingConsumer class. I stumbled across it, though, and now I'm letting the consumer load up a BlockingQueue with responses and my Callable/Runnable waits for incoming messages directly from the queue.

Yes, needless to say, in the 300 or so open items in our issue tracker,
one is to have some documentation which actually recommends using the
QueueingConsumer.

> I suppose the same thing happens if I use nextDelivery(), but without having to declare a separate Queue?

Yes it sounds very much like you've implemented yourself exactly what
QueueingConsumer does.

> I'm still not clear on the relationship between Channels and Threads. Right now, I have a separate Channel for each thread (multiple workers load-balanced by listening to the same queue) and one to receive the messages on (it dispatches to the other workers in the other threads). I don't know if this is "proper", though.

The API guide does talk about this, and yes, you should not share Channels
between multiple threads. http://www.rabbitmq.com/api-guide.html#channel-threads

Matthew



From matthew at lshift.net  Fri Apr  2 16:50:49 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 16:50:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashed again
In-Reply-To: <F32DA9B1-5E9B-413D-B536-0B5961DB658E@gmail.com>
References: <46C25109-EDD6-4721-9B08-79ADEFE6BC6A@gmail.com>
	<4BB3C888.3010406@lshift.net>
	<F32DA9B1-5E9B-413D-B536-0B5961DB658E@gmail.com>
Message-ID: <20100402155049.GH11613@wellquite.org>

On Wed, Mar 31, 2010 at 05:37:40PM -0500, Ian Ragsdale wrote:
> Thanks for confirming, Michael.  Is it safe to assume that closing a connection will deallocate any associated resources?  I have the example for how to increase the number of processes, so I can increase that and make sure that the connections get reopened on a regular basis, which should hopefully keep whatever is causing this slow resource from crashing the server.

Your reference to system_limits makes me wonder if you've run out of
ets tables. Do you have a large number of queues or bindings which churn
at a high rate? You could try setting the ERL_MAX_ETS_TABLES env var -
adding the following to your rabbitmq.conf file should pimp it out for
reasonably extreme running:

SERVER_ERL_ARGS="-env ERL_MAX_ETS_TABLES 90240 -env ERL_MAX_PORTS 40240 +K true +A300 +P512000"

(all one line).

Closing a connection should certainly free up all the resources associated
with it (exclusive queues etc etc), but if you've actually hit some
system limit then it's likely the ErlangVM is in a bad way at that point
and recovery from there is going to be tricky.

We've recently fixed a bug which could cause the ets table exhaustion:
http://www.lshift.net/blog/2010/03/29/on-the-limits-of-concurrency-worker-pools-in-erlang

And the new persister is (needless to say!) even better at resource
management! Depends how bleeding edge you like it really.

> Any thoughts on the behavior I mentioned where the server seemed to continue to accept messages?  I don't see that behavior if I manually stop the server, just in the case of this crash - does that seem at all possible?  I could try to reproduce it locally if that would help.

Yeah, it's possible the queue has died, but that doesn't mean you can't
publish to the exchange - if the queue has died, the exchange won't care
and if the messages are then destined to go to no queues then the exchange
will throw the message away. Setting the mandatory bit on publish will
help here, though maybe at some performance cost.

Matthew



From matthew at lshift.net  Fri Apr  2 17:01:14 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 17:01:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes
 after several hours running MulticastMain from 1.7.2
In-Reply-To: <z2x173a1edc1004010758m31b83ca5r56e0ee56e90ef338@mail.gmail.com>
References: <z2x173a1edc1004010758m31b83ca5r56e0ee56e90ef338@mail.gmail.com>
Message-ID: <20100402160114.GI11613@wellquite.org>

Hi John,

On Thu, Apr 01, 2010 at 04:58:57PM +0200, John Apps wrote:
> Wondering why this crashes when vm_memory_high_watermark is set?
> 
> This message "vm_memory_high_watermark set. Memory used:935,079,976
> allowed:858,993,459" is rather intriguing, or am I missing something? (The
> commas were inserted by me in order to make the number more legible.)

When Rabbit raises its alarms, it does not mean that it'll stop using
more memory. It will raise channel.flow to the client, but it can take
some time for the client to respond to that, and in the meantime, the
client can continue to send more messages in. At the moment we do not
drop such messages on the floor, but it's something that we have been
looking at.

Furthermore, Erlang's GC can mean that substantially more memory can be
used by the Erlang process than the (artificial) threshold at which we
raise channel.flow.

> Thu Apr 01 15:22:19 2010
> Slogan: eheap_alloc: Cannot allocate 153052320 bytes of memory (of type
> "heap").
> System version: Erlang R13B04 (erts-5.7.5) [smp:2:2] [rq:2]
> [async-threads:30]
> Compiled: Mon Feb 22 20:02:36 2010

Interesting. It's asking for 153MB and apparently Windows said "no" to
it. Was there really no free memory available for Windows? Have you
disabled the page file? 

The "Memory limit set to 819MB." shows that rabbit really did detect
4GB of Ram in there, which is interesting for a Windows system - it
suggests you're running a 64-bit Erlang. If you just start up erl, and
type in:

os:type().
erlang:system_info(wordsize).

Also, if you start up rabbit, and in the rabbit shell, type:

vm_memory_monitor:get_total_memory().

what results do you get?

Matthew



From matthew at lshift.net  Fri Apr  2 17:15:12 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 17:15:12 +0100
Subject: [rabbitmq-discuss] Old consumer tags delivered after
 re-subscribing to a queue
In-Reply-To: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>
References: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>
Message-ID: <20100402161512.GJ11613@wellquite.org>

On Thu, Apr 01, 2010 at 12:05:25PM -0300, Juan Wajnerman wrote:
> After unsubscribing from a queue, following "recover" calls will still redeliver unack'd messages through the channel. Even worse, after resubscribing to the queue, the recovered messages are still sent with the old consumer tag.

The documentation of basic.recover is clear:
"This method asks the server to redeliver all unacknowledged messages
on a specified channel."

I don't know the ruby library at all, but I assume from your code below
they inverted the noAck flag to ack, hence your :ack => true indicates
you are commiting to acking messages manually. Your code does not do that
hence every message you receive as part of the subscription is unack'd,
hence will be redelivered when you issue the recover.

Similarly, the documention for basic.cancel (unsubscribe):
"This method cancels a consumer. This does not affect already delivered
messages, but it does mean the server will not send any more messages for
that consumer."

Thus it is clear that cancelling your subscription does not void your
commitment to acknowledge the messages you've already been sent.

> I'm using the amqp ruby library to consume the queues. Here's a small snippet that reproduces the issue. When I execute this, I always get an error similar to: Basic.Deliver for invalid consumer tag: myqueue-396735623077.

That really shouldn't be happening - and I suspect it's a client bug.
I've just checked our code - the queue is told to forget about the
consumer tag on the basic.cancel, and is told about the new consumer
tag on basic.consume. Your ctag of myqueue-396735623077 is clearly one
that you, or the library, is specifying - all the server generated
ctags start "amq.ctag-". I have no idea what the ruby amqp library is
doing under the bonnet - given that you're not supplying a ctag
yourself, nor should the library.

Matthew



From matthew at lshift.net  Fri Apr  2 17:30:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 17:30:15 +0100
Subject: [rabbitmq-discuss] Persister log size calculation and rolling
 persister log frequency?
In-Reply-To: <q2n173a1edc1004010953t66f0d7ebjb6d022d7b37bc5d4@mail.gmail.com>
References: <q2n173a1edc1004010953t66f0d7ebjb6d022d7b37bc5d4@mail.gmail.com>
Message-ID: <20100402163014.GK11613@wellquite.org>

Hi John,

On Thu, Apr 01, 2010 at 06:53:57PM +0200, John Apps wrote:
> I see that the size of the log varies tremendously, as does the frequency
> with which it is 'rolled'.
> The size is presumably determined by the number of messages pending, i.e.,
> not yet acknowledged?

Oh the logic there is quite complex. It's something like "it shouldn't be
rolled too often, and we also have a minimum number of operations that
should have to go into it before we roll, and probably we should not roll
whilst we're really busy". The last time Matthias and I looked at that code,
it took the two of us some hours to figure out what was going on. The new
persister is a fair bit more predictable in this regard.

> QueuesOverviewMessagesTransactionsParametersVhostNameConsumersMemoryCountMsg
> readyMsg unackCountAcks uncommitedDurableAuto deleteArguments/
> amq.gen-EIK8rQQfEX9IBiqLwF6h7Q==10MB22702271227falsetrue[]

I know some people aren't a fan of semantically significant spaces in
programming languages, but they're generally favoured in English...

> The log file at
> the above moment in time is 128KB. (I paused the producer long enough for
> the receiver to catch up.)
> 
> QueuesOverviewMessagesTransactionsParametersVhostNameConsumersMemoryCountMsg
> readyMsg unackCountAcks uncommitedDurableAuto deleteArguments/
> amq.gen-EIK8rQQfEX9IBiqLwF6h7Q==1105MB2493432483431000158falsetrue[]
> 
> The log file at the above moment is some 111,529KB, the rolled over log file
> about the same size.
> 
> What I am wondering about is
> 
>    1. when does the roll-over take place?

Not totally sure - it's not completely clear from the code what the goals
were. Tony G is probably the only person who can answer this sufficiently.

>    2. what role does the dump_log_write_threshold parameter play here? (It
>    is set to 1,000 in these tests)

That's an mnesia parameter and has nothing to do with the persister log
that Rabbit uses.

>    3. why is the previous version deleted before the current one is rolled
>    over? (GFS would appear to be the algorithm which should be used in order
>    not to lose anything)

It's not. On taking a snapshot, the data in the current file is correct.
There may be a .previous file, which is removed if it exists. Then
disk_log:reopen/3 is called.
http://www.erlang.org/doc/man/disk_log.html#reopen-3
"The reopen functions first rename the log file to File and then re-create a
new log file."

There should be no possibility of data loss during this process.

>    4. the new version of the log file is created with a very small initial
>    allocation? Is there a way to influence this size?  (yes, I know, modern
>    file systems should be able to happily expand very fast, and I have asked
>    this question before. However, the time taken to 'rename' the current to
>    previous and create a new log causes quite significant waves on the client
>    side. These are noticeable even to the human eye.)

Renaming a file should be an instantaneous operation. Nothing other than
meta data needs writing to do this, and depending on your filesystem, that
may not even hit disk. We do not do any preallocation - for file systems
that support holes, it gains nothing, and for those that don't, it's very
expensive (HFS is a good example here). The persister files are only ever
appended to - there is no rewriting in place. Preallocation won't help
here.

>    5. The severe delay is only experienced by the receiver. Here are a few
>    samples:
>    - recving rate: 507 msg/s
>       - recving rate: 506 msg/s
>       - recving rate: 475 msg/s
>       - recving rate: 377 msg/s
>       - *recving rate: 5 msg/s*

Yup, that's the cost of writing out the snapshot again. What you're seeing
here is a bug that is one of the main reasons for the existance of the new
persister, which is that with the current persister, the same data gets
written out over and over again - If you have one long queue which is doing
no work, and one short and fast queue, then whenever the persister decides
to take a new snapshot, it writes out the entire contents of the long queue
as well.

The new persister is much much better in this regard (and several others
too). In particular, messages are only rewritten on disk for GC reasons,
and there is a finite bound on the number of times a message will be
rewritten. In short, I'd recommend you compile, test and compare with the
new persister branch (bug21673).

Matthew



From juan.wajnerman at gmail.com  Fri Apr  2 17:37:11 2010
From: juan.wajnerman at gmail.com (Juan Wajnerman)
Date: Fri, 2 Apr 2010 13:37:11 -0300
Subject: [rabbitmq-discuss] Old consumer tags delivered after
	re-subscribing to a queue
In-Reply-To: <20100402161512.GJ11613@wellquite.org>
References: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>
	<20100402161512.GJ11613@wellquite.org>
Message-ID: <5469CC33-06C4-4941-A325-A9F3E411B32D@gmail.com>

Matthew, thanks for your reply! Some comments inline:

On Apr 2, 2010, at 1:15 PM, Matthew Sackman wrote:

> On Thu, Apr 01, 2010 at 12:05:25PM -0300, Juan Wajnerman wrote:
>> After unsubscribing from a queue, following "recover" calls will still redeliver unack'd messages through the channel. Even worse, after resubscribing to the queue, the recovered messages are still sent with the old consumer tag.
> 
> The documentation of basic.recover is clear:
> "This method asks the server to redeliver all unacknowledged messages
> on a specified channel."

But what should happen if the subscription was canceled before the messages
were ack'd? The current implementation is still sending the messages with the same consumer tag.

> 
> I don't know the ruby library at all, but I assume from your code below
> they inverted the noAck flag to ack, hence your :ack => true indicates
> you are commiting to acking messages manually. Your code does not do that
> hence every message you receive as part of the subscription is unack'd,
> hence will be redelivered when you issue the recover.

That's right. The omission was completely intentional to reproduce the issue.
I'm sorry, maybe I wasn't clear enough about this. The idea is to cancel the
subscription before the message was ack'd and then resubscribe and perform a recover. 

> 
> Similarly, the documention for basic.cancel (unsubscribe):
> "This method cancels a consumer. This does not affect already delivered
> messages, but it does mean the server will not send any more messages for
> that consumer."

I understand this, but I'm looking at the bits on the wire, and after sending a cancel, the
following recover will send the unack'd messages using the same old consumer tag.

> 
> Thus it is clear that cancelling your subscription does not void your
> commitment to acknowledge the messages you've already been sent.
> 
>> I'm using the amqp ruby library to consume the queues. Here's a small snippet that reproduces the issue. When I execute this, I always get an error similar to: Basic.Deliver for invalid consumer tag: myqueue-396735623077.
> 
> That really shouldn't be happening - and I suspect it's a client bug.
> I've just checked our code - the queue is told to forget about the
> consumer tag on the basic.cancel, and is told about the new consumer
> tag on basic.consume. Your ctag of myqueue-396735623077 is clearly one
> that you, or the library, is specifying - all the server generated
> ctags start "amq.ctag-". I have no idea what the ruby amqp library is
> doing under the bonnet - given that you're not supplying a ctag
> yourself, nor should the library.

I was digging into the source code after sending my email and I found that (correct me if I'm wrong, it's my first time
I look into this code) in rabbit_channel.erl:578 the recover is taking the unack'd messages
and redelivering these using the same ConsumerTag as it was sent before. I think this is
indeed what the FIXME warns: "What should happen if the consumer's been cancelled since?".

> 
> Matthew

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100402/0b5650a1/attachment.htm 

From matthew at lshift.net  Fri Apr  2 17:54:32 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 17:54:32 +0100
Subject: [rabbitmq-discuss] Old consumer tags delivered after
 re-subscribing to a queue
In-Reply-To: <5469CC33-06C4-4941-A325-A9F3E411B32D@gmail.com>
References: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>
	<20100402161512.GJ11613@wellquite.org>
	<5469CC33-06C4-4941-A325-A9F3E411B32D@gmail.com>
Message-ID: <20100402165432.GL11613@wellquite.org>

Hi Juan,

On Fri, Apr 02, 2010 at 01:37:11PM -0300, Juan Wajnerman wrote:
> On Apr 2, 2010, at 1:15 PM, Matthew Sackman wrote:
> 
> > On Thu, Apr 01, 2010 at 12:05:25PM -0300, Juan Wajnerman wrote:
> >> After unsubscribing from a queue, following "recover" calls will still redeliver unack'd messages through the channel. Even worse, after resubscribing to the queue, the recovered messages are still sent with the old consumer tag.
> > 
> > The documentation of basic.recover is clear:
> > "This method asks the server to redeliver all unacknowledged messages
> > on a specified channel."
> 
> But what should happen if the subscription was canceled before the messages
> were ack'd? The current implementation is still sending the messages with the same consumer tag.

Ahh! Right, now I understand the problem - sorry, I thought you were
saying that with your second subscription, you were getting the same
ctag, but you're actually saying that the ctag used during the recovery
is the same as the (now cancelled) subscription.

Yes, that indeed is a bug - the comment in the code is rather revealing!

handle_method(#'basic.recover'{requeue = false},
              _, State = #ch{ transaction_id = none,
                              writer_pid = WriterPid,
                              unacked_message_q = UAMQ }) ->
    ok = rabbit_misc:queue_fold(
           fun ({_DeliveryTag, none, _Msg}, ok) ->
                   %% Was sent as a basic.get_ok. Don't redeliver
                   %% it. FIXME: appropriate?
                   ok;
               ({DeliveryTag, ConsumerTag,
                 {QName, QPid, MsgId, _Redelivered, Message}}, ok) ->
                   %% Was sent as a proper consumer delivery.  Resend
                   %% it as before.
                   %%
                   %% FIXME: What should happen if the consumer's been
                   %% cancelled since?
                   %%
                   %% FIXME: should we allocate a fresh DeliveryTag?
                   internal_deliver(
                     WriterPid, false, ConsumerTag, DeliveryTag,
                     {QName, QPid, MsgId, true, Message})
           end, ok, UAMQ),

> That's right. The omission was completely intentional to reproduce the issue.
> I'm sorry, maybe I wasn't clear enough about this. The idea is to cancel the
> subscription before the message was ack'd and then resubscribe and perform a recover. 

Actually, I think you'll see this bug if you just do: subscribe,
unsubscribe, recover. The second subscription should be unnecessary.

The problem is that the result of recover is a number of deliveries.
They must have a ctag of some sort, and all the clients will rely on
that. (This is clearly not a ruby client bug - apologies for suggesting
it was.) If the subscription has been cancelled, it's very likely all
clients will get upset not matter what you do - both a new and an
existing ctag will be unrecognised by clients as they will have
forgotten about the ctag on the unsubscribe.

Which suggests that the possible outcomes are:
a) Don't permit a basic.recover if the subscription has been cancelled.
   This gets very tricky - if you have multiple subscriptions on the
   same channel, cancel some of them, and then hit recover, what on
   earth do you do then?
b) On cancel, forget about unacked messages from the subscription being
   cancelled - treat it the same as a channel closure and requeue the
   messages.

The problem with both of these is that they're explicitly against the
wording of the spec.

> > Similarly, the documention for basic.cancel (unsubscribe):
> > "This method cancels a consumer. This does not affect already delivered
> > messages, but it does mean the server will not send any more messages for
> > that consumer."
> 
> I understand this, but I'm looking at the bits on the wire, and after sending a cancel, the
> following recover will send the unack'd messages using the same old consumer tag.

Yes. There's probably an argument for saying that in the absence of a
valid consumer tag, the messages should be sent to the client as a
sequence of basic.get-oks, or at least a basic.deliver with a very
special ctag to indicate to the clients that they shouldn't be suprised
by these deliveries which are apparently appearing outside of the scope
of any subscription it knows about. This really seems to be a bug in the
spec rather than our implementation or the client.

At the very least, the basic.recover_ok should contain a new ctag (which
for symmetry suggests the client should be able to specify one in
basic.recover to mirror basic.consume and basic.consume_ok) which the
client can then use to identify these deliveries and route them
accordingly.

> I was digging into the source code after sending my email and I found that (correct me if I'm wrong, it's my first time
> I look into this code) in rabbit_channel.erl:578 the recover is taking the unack'd messages
> and redelivering these using the same ConsumerTag as it was sent before. I think this is
> indeed what the FIXME warns: "What should happen if the consumer's been cancelled since?".

Absolutely, and well found, you are exactly right.

I would recommend that you don't use recover without also setting
requeue=true, thus ensuring the messages are inserted back into the
queue and can hence be redelivered to any valid consumer again (at
which point the ctag will be set correctly). Hopefully you'll at
least get unsurprising behaviour! I will raise some bugs to cover the
issues uncovered - many thanks for the report.

Matthew




From matthew at lshift.net  Fri Apr  2 18:12:27 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 18:12:27 +0100
Subject: [rabbitmq-discuss] Old consumer tags delivered after
 re-subscribing to a queue
In-Reply-To: <20100402165432.GL11613@wellquite.org>
References: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>
	<20100402161512.GJ11613@wellquite.org>
	<5469CC33-06C4-4941-A325-A9F3E411B32D@gmail.com>
	<20100402165432.GL11613@wellquite.org>
Message-ID: <20100402171227.GM11613@wellquite.org>

On Fri, Apr 02, 2010 at 05:54:32PM +0100, Matthew Sackman wrote:
> At the very least, the basic.recover_ok should contain a new ctag (which
> for symmetry suggests the client should be able to specify one in
> basic.recover to mirror basic.consume and basic.consume_ok) which the
> client can then use to identify these deliveries and route them
> accordingly.

Oh and of course, there's no basic.recover_ok until you get to AMQP
0-9-1. And even if you could specify a ctag, you'd need to know when
the stream ends too. It should probably be something like:

C=>S: basic.recover [optional ctag; requeue=false]
S=>C: basic.recover_start [ctag either server generated or as specified]
S=>C: basic.delivery [ctag set as in recover_start]
...
S=>C: basic.recover_end [ctag set as in recover_start]

That way clients would have some idea of knowing what to do with the
recovered messages, and when to stop. Another idea would be to have
the _ok variant as in 0-9-1 but to put a count in it so that the
clients know how many messages to expect:

C=>S: basic.recover [optional ctag; requeue=false]
S=>C: basic.recover_ok [ctag either server generated or as specified; count=N]
S=>C: basic.delivery [ctag set as in recover_start]
...

Matthew



From juan.wajnerman at gmail.com  Fri Apr  2 19:01:37 2010
From: juan.wajnerman at gmail.com (Juan Wajnerman)
Date: Fri, 2 Apr 2010 15:01:37 -0300
Subject: [rabbitmq-discuss] Old consumer tags delivered after
	re-subscribing to a queue
In-Reply-To: <20100402165432.GL11613@wellquite.org>
References: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>
	<20100402161512.GJ11613@wellquite.org>
	<5469CC33-06C4-4941-A325-A9F3E411B32D@gmail.com>
	<20100402165432.GL11613@wellquite.org>
Message-ID: <D5D26DD6-522A-4719-9A13-77FBFBF4297F@gmail.com>


On Apr 2, 2010, at 1:54 PM, Matthew Sackman wrote:

> Actually, I think you'll see this bug if you just do: subscribe,
> unsubscribe, recover. The second subscription should be unnecessary.

Yes, you're right. 



> 
> Yes. There's probably an argument for saying that in the absence of a
> valid consumer tag, the messages should be sent to the client as a
> sequence of basic.get-oks, or at least a basic.deliver with a very
> special ctag to indicate to the clients that they shouldn't be suprised
> by these deliveries which are apparently appearing outside of the scope
> of any subscription it knows about. This really seems to be a bug in the
> spec rather than our implementation or the client.
> 
> At the very least, the basic.recover_ok should contain a new ctag (which
> for symmetry suggests the client should be able to specify one in
> basic.recover to mirror basic.consume and basic.consume_ok) which the
> client can then use to identify these deliveries and route them
> accordingly.

At this point I should go and read the full specs to try to understand the reasons for this
design. However, I don't see the reason for redelivering messages to a consumer that
already said explicitly that it doesn't want to receive messages from that queue anymore.
Why don't just redeliver the messages to other possible subscribers after the subscription
cancel was received? Ok, maybe the consumer can subscribe again using the same ctag (the library
should allow to do so) or the server should understand the change of ctag, given that there
cannot be two consumers for the same queue on the same channel, right?

I just have a couple of weeks of experience with AMQP and RabbitMQ and I'm still
trying to figure out the architecture patters that I should follow for our design. One thing
that still results strange to me is that the recover operates only at a channel level and there
is no way to recover messages just for one queue.

> I would recommend that you don't use recover without also setting
> requeue=true, thus ensuring the messages are inserted back into the
> queue and can hence be redelivered to any valid consumer again (at
> which point the ctag will be set correctly). Hopefully you'll at
> least get unsurprising behaviour! I will raise some bugs to cover the
> issues uncovered - many thanks for the report.

Yes! this solved my issue.

- Juan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100402/afe1c7a5/attachment.htm 

From matthew at lshift.net  Fri Apr  2 20:46:59 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 2 Apr 2010 20:46:59 +0100
Subject: [rabbitmq-discuss] Old consumer tags delivered after
 re-subscribing to a queue
In-Reply-To: <D5D26DD6-522A-4719-9A13-77FBFBF4297F@gmail.com>
References: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>
	<20100402161512.GJ11613@wellquite.org>
	<5469CC33-06C4-4941-A325-A9F3E411B32D@gmail.com>
	<20100402165432.GL11613@wellquite.org>
	<D5D26DD6-522A-4719-9A13-77FBFBF4297F@gmail.com>
Message-ID: <20100402194659.GO11613@wellquite.org>

On Fri, Apr 02, 2010 at 03:01:37PM -0300, Juan Wajnerman wrote:
> At this point I should go and read the full specs to try to understand the reasons for this
> design. However, I don't see the reason for redelivering messages to a consumer that
> already said explicitly that it doesn't want to receive messages from that queue anymore.

Well, the consumer also said "send me messages, and I'll ack them when
I'm done with them". If you don't want them any more, use recover with
requeue=true (which you now have done). It's also possible that you
should be setting qos to some lowish value - between 1 and 10 which will
limit the number of messages that get buffered in the client - i.e. it
should result in fewer messages arriving at the client between you sending
off the cancel and getting the cancel_ok back (in fact, if you're acking
explicitly then it would mean you can't ever receive more messages per
consumer than you have qos set to).

> Why don't just redeliver the messages to other possible subscribers after the subscription
> cancel was received?

Because you might want to say "consume, then I'm going to take the next
N messages, stop consuming, but I'm still going to process those N
messages in my leisure and I'll ack them in due course - but whilst I'm
processing those, I don't want to be receiving any further messages".

> Ok, maybe the consumer can subscribe again using the same ctag (the library
> should allow to do so) or the server should understand the change of ctag, given that there
> cannot be two consumers for the same queue on the same channel, right?

Not with the same ctag. There are all sorts of complications due to the
provision for user-supplied ctags. I wish all ctags were only supplied
by the server, but that's another issue really.

> I just have a couple of weeks of experience with AMQP and RabbitMQ and I'm still
> trying to figure out the architecture patters that I should follow for our design. One thing
> that still results strange to me is that the recover operates only at a channel level and there
> is no way to recover messages just for one queue.

Well that's because recover operates at the channel level, not the queue
level, and that's a design. Really, not many people use recover and not
just because of the reasons you've come across. Also, I would generally
advise that you create new channels for each subscription to a queue you
make - it's not necessary, by any means, but it does keep things like
this a little simpler.

I'm glad the recover with requeue=true worked for you.

Matthew



From pdezwart at rubiconproject.com  Fri Apr  2 21:36:10 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 02 Apr 2010 13:36:10 -0700
Subject: [rabbitmq-discuss] Rabbitmq-c compatibility
Message-ID: <C7DBA34A.800C%pdezwart@rubiconproject.com>

This is a RabbitMQ-c question, but I figure I would send it to the entire
list as well.

Is rabbitmq-c compatible with other brokers implementing the AMQP spec? The
reason I ask is that I submitting our php extension to the PECL directory,
which is where official PHP extensions are listed/maintained, and I want to
name this project appropriately. Therefore, if the rabbitmq-c client
implements the AMQP client standards (if any,) the PHP extension should be
called ?amqp? and not ?rabbbitmq?, and we should name our
classes/variables/etc appropriately.

Thanks,
Pieter
-- 
the rubicon project

PIETER DE ZWART | INTERFACES ENGINEER

??? P 310 207 0272 | x224
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100402/5c583417/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100402/5c583417/attachment.png 

From tonyg at lshift.net  Sat Apr  3 19:08:39 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 04 Apr 2010 06:08:39 +1200
Subject: [rabbitmq-discuss] Rabbitmq-c compatibility
In-Reply-To: <C7DBA34A.800C%pdezwart@rubiconproject.com>
References: <C7DBA34A.800C%pdezwart@rubiconproject.com>
Message-ID: <4BB78427.3010300@lshift.net>

Hi Pieter,

It is intended to be, yes. At the 0-9-1 protocol version it definitely
works with Qpid and OpenAMQ (I've tried it), though the 0-8 version
doesn't interoperate so smoothly because of differing interpretations of
the spec. I'd therefore recommend calling the extension "AMQP" instead
of "rabbitmq".

Regards,
  Tony


Pieter de Zwart wrote:
> This is a RabbitMQ-c question, but I figure I would send it to the
> entire list as well.
> 
> Is rabbitmq-c compatible with other brokers implementing the AMQP spec?
> The reason I ask is that I submitting our php extension to the PECL
> directory, which is where official PHP extensions are listed/maintained,
> and I want to name this project appropriately. Therefore, if the
> rabbitmq-c client implements the AMQP client standards (if any,) the PHP
> extension should be called ?amqp? and not ?rabbbitmq?, and we should
> name our classes/variables/etc appropriately.
> 
> Thanks,
> Pieter
> -- 
> the rubicon project
> 
> PIETER DE ZWART | INTERFACES ENGINEER
> 
> ??? P 310 207 0272 | x224
> ??? F 323 466 7119
> 
> 
> 1925 S. BUNDY  DRIVE
> LOS ANGELES, CALIFORNIA 90025
> 
> WWW.RUBICONPROJECT.COM <_http://www.rubiconproject.com/_>
> 
> 
> ?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
> #24 ON FAST COMPANY FAST 50 READER FAVORITES
> 2008  ALWAYSON 250 GLOBAL WINNER
> 2008 ALWAYSON ONMEDIA 100 WINNER
> TWIISTUP3  BEST IN SHOW
> PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
> AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
> AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
> AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE
> -  SERVICES
> 
> P          Please consider the environment before printing this e-mail



From pdezwart at rubiconproject.com  Sat Apr  3 19:19:29 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Sat, 3 Apr 2010 14:19:29 -0400
Subject: [rabbitmq-discuss] Rabbitmq-c compatibility
Message-ID: <7C1046148D91C244A98F4C146735886701BA2E04@BE43.exg3.exghost.com>

That is awesome, thank you very much Tony!
Pieter


----- Original Message -----
From: Tony Garnock-Jones <tonyg at lshift.net>
To: Pieter de Zwart
Cc: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Sat Apr 03 14:08:39 2010
Subject: Re: Rabbitmq-c compatibility

Hi Pieter,

It is intended to be, yes. At the 0-9-1 protocol version it definitely
works with Qpid and OpenAMQ (I've tried it), though the 0-8 version
doesn't interoperate so smoothly because of differing interpretations of
the spec. I'd therefore recommend calling the extension "AMQP" instead
of "rabbitmq".

Regards,
  Tony


Pieter de Zwart wrote:
> This is a RabbitMQ-c question, but I figure I would send it to the
> entire list as well.
> 
> Is rabbitmq-c compatible with other brokers implementing the AMQP spec?
> The reason I ask is that I submitting our php extension to the PECL
> directory, which is where official PHP extensions are listed/maintained,
> and I want to name this project appropriately. Therefore, if the
> rabbitmq-c client implements the AMQP client standards (if any,) the PHP
> extension should be called ?amqp? and not ?rabbbitmq?, and we should
> name our classes/variables/etc appropriately.
> 
> Thanks,
> Pieter
> -- 
> the rubicon project
> 
> PIETER DE ZWART | INTERFACES ENGINEER
> 
> ??? P 310 207 0272 | x224
> ??? F 323 466 7119
> 
> 
> 1925 S. BUNDY  DRIVE
> LOS ANGELES, CALIFORNIA 90025
> 
> WWW.RUBICONPROJECT.COM <_http://www.rubiconproject.com/_>
> 
> 
> ?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
> #24 ON FAST COMPANY FAST 50 READER FAVORITES
> 2008  ALWAYSON 250 GLOBAL WINNER
> 2008 ALWAYSON ONMEDIA 100 WINNER
> TWIISTUP3  BEST IN SHOW
> PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
> AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
> AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
> AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE
> -  SERVICES
> 
> P          Please consider the environment before printing this e-mail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100403/81cb141b/attachment.htm 

From tonyg at lshift.net  Sat Apr  3 19:22:39 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 04 Apr 2010 06:22:39 +1200
Subject: [rabbitmq-discuss] Old consumer tags delivered after
 re-subscribing to a queue
In-Reply-To: <20100402165432.GL11613@wellquite.org>
References: <0F7F2E94-69CB-41EA-84FF-B0975CC0F633@gmail.com>	<20100402161512.GJ11613@wellquite.org>	<5469CC33-06C4-4941-A325-A9F3E411B32D@gmail.com>
	<20100402165432.GL11613@wellquite.org>
Message-ID: <4BB7876F.6020601@lshift.net>

Matthew Sackman wrote:
> Yes, that indeed is a bug - the comment in the code is rather revealing!

Just to be clear, it's a bug in the *spec*. The comment in the code is
indicating a problem with the spec that I couldn't resolve at the time.
The code I wrote implemented the least awful interpretation I could come
up with.

Regards,
  Tony



From johndapps at gmail.com  Mon Apr  5 14:20:26 2010
From: johndapps at gmail.com (John Apps)
Date: Mon, 5 Apr 2010 15:20:26 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes
	after several hours running MulticastMain from 1.7.2
In-Reply-To: <z2x173a1edc1004010758m31b83ca5r56e0ee56e90ef338@mail.gmail.com>
References: <z2x173a1edc1004010758m31b83ca5r56e0ee56e90ef338@mail.gmail.com>
Message-ID: <h2h173a1edc1004050620n4c538968yd9d904783ef9e606@mail.gmail.com>

Hello Matthew,


Here you go:

>>>os:type().

{win32,nt}

>>>erlang:system_info(wordsize).

4

>>>Also, if you start up rabbit, and in the rabbit shell, type:
>>>vm_memory_monitor:get_total_memory().

4284735488


This is a Windows 7 X64 installation on a dual-core Intel machine with 4GB
physical memory.

OS Version:                6.1.7600 N/A Build 7600
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                                  [01]: Intel64 Family 6 Model 23 Stepping
10 GenuineIntel ~2800 Mhz
*
*
Total Physical Memory:     4,086 MB
Available Physical Memory: 2,189 MB
Virtual Memory: Max Size:  12,276 MB
Virtual Memory: Available: 7,390 MB
Virtual Memory: In Use:    4,886 MB


---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/94642686/attachment.htm 

From johndapps at gmail.com  Mon Apr  5 14:38:19 2010
From: johndapps at gmail.com (John Apps)
Date: Mon, 5 Apr 2010 15:38:19 +0200
Subject: [rabbitmq-discuss] Are Windows 7 X64 and X86 supported by RabbitMQ?
Message-ID: <j2i173a1edc1004050638n3ce199e8jab719292272e0ee3@mail.gmail.com>

Before I continue spending time on this and reporting things I either do not
understand or consider wrong,
it would be worth knowing if Windows in general and 7 (X64 and X86) are
supported by RabbitMQ.
I would hate to waste your time, and mine, with this!

I was told in a previous reply a few weeks ago that anyone considering a
'serious' production deployment of
a RabbitMQ application would use Linux rather than Windows. It was this
suggestion and the number of
things not quite working to plan that led me to ask the question.

Thank you, John
PS: I would like to thank the RabbitMQ people and also those in the
community for all the help and understanding
I have received to date!
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/004bd368/attachment.htm 

From matthew at lshift.net  Mon Apr  5 14:41:52 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 5 Apr 2010 14:41:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes
 after several hours running MulticastMain from 1.7.2
In-Reply-To: <h2h173a1edc1004050620n4c538968yd9d904783ef9e606@mail.gmail.com>
References: <z2x173a1edc1004010758m31b83ca5r56e0ee56e90ef338@mail.gmail.com>
	<h2h173a1edc1004050620n4c538968yd9d904783ef9e606@mail.gmail.com>
Message-ID: <20100405134152.GA12495@wellquite.org>

Hi John,

On Fri, Apr 02, 2010 at 05:01:14PM +0100, Matthew Sackman wrote:
> The "Memory limit set to 819MB." shows that rabbit really did detect
> 4GB of Ram in there, which is interesting for a Windows system - it
> suggests you're running a 64-bit Erlang.

No, no it doesn't. I can't do maths...

819/0.4 = 2048.

On Mon, Apr 05, 2010 at 03:20:26PM +0200, John Apps wrote:
> Here you go:
> >>>os:type().
> {win32,nt}
> >>>erlang:system_info(wordsize).
> 4
> 
> >>>Also, if you start up rabbit, and in the rabbit shell, type:
> >>>vm_memory_monitor:get_total_memory().
> 4284735488

Right, this all makes sense. You're running a 32-bit Erlang, which
depending on all sorts of fairly ridiculous issues with Windows, means
that the biggest amount of memory that Windows will allocate to Erlang
(or any 32 bit process) is sometimes 2GB and sometimes 3GB. Under 32-bit
windows, we take the minimum of the detected RAM (4GB in your case), and
2GB (32bit on Windows). The 0.4 scaling is done after that, which is why
we end up with 819MB.

It would then seem that the malloc failed because it would have taken
the erlang process above the 2GB or 3GB limit (whichever your version of
Windows applies to 32-bit programs). The correct thing to do in this
case is to lower the 0.4 and try again, I'm afraid. Slightly more
documentation is available at
http://www.rabbitmq.com/extensions.html#memsup

I am surprised that even inspite of the 0.4 scaling, you still managed
to get Rabbit to go above the address space limit. Flow control should
have kicked in, stopping the producer. The consumer could still continue
but clearly something happened which caused Erlang to require more
memory than Windows could supply it with.

Does it still happen if you lower the -n parameter in your tests?

Matthew



From msteele at beringmedia.com  Mon Apr  5 14:46:59 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Mon, 5 Apr 2010 09:46:59 -0400
Subject: [rabbitmq-discuss] Rabbitmq-c compatibility
In-Reply-To: <7C1046148D91C244A98F4C146735886701BA2E04@BE43.exg3.exghost.com>
References: <AcrTWLcz3yACNCO3TdCLgA3FQMeyOwAAXxGE>
	<7C1046148D91C244A98F4C146735886701BA2E04@BE43.exg3.exghost.com>
Message-ID: <n2saa3794b1004050646pc2000199j4da69b0864b1009b@mail.gmail.com>

Quick question sort of related to both the C client and the php client...

How hard would it be to get SSL support (including client
certificates)? We're currently using a pure PHP implementation which we use
with SSL support and would love to switch to a librabbit based solution,
however we need the SSL support. Thoughts?

Creating the SSL socket stream context in PHP is trivial, might it be
possible to pass the stream file descriptor to librabbit in some fashion?
(or any plans on supporting SSL by linking in openssl to librabbit?)

Cheers,


Mark Steele
Director of development
Bering Media Inc.



On Sat, Apr 3, 2010 at 2:19 PM, Pieter de Zwart <pdezwart at rubiconproject.com
> wrote:

>  That is awesome, thank you very much Tony!
> Pieter
>
>
>
> ----- Original Message -----
> From: Tony Garnock-Jones <tonyg at lshift.net>
> To: Pieter de Zwart
> Cc: rabbitmq-discuss at lists.rabbitmq.com <
> rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Sat Apr 03 14:08:39 2010
> Subject: Re: Rabbitmq-c compatibility
>
> Hi Pieter,
>
> It is intended to be, yes. At the 0-9-1 protocol version it definitely
> works with Qpid and OpenAMQ (I've tried it), though the 0-8 version
> doesn't interoperate so smoothly because of differing interpretations of
> the spec. I'd therefore recommend calling the extension "AMQP" instead
> of "rabbitmq".
>
> Regards,
>   Tony
>
>
> Pieter de Zwart wrote:
> > This is a RabbitMQ-c question, but I figure I would send it to the
> > entire list as well.
> >
> > Is rabbitmq-c compatible with other brokers implementing the AMQP spec?
> > The reason I ask is that I submitting our php extension to the PECL
> > directory, which is where official PHP extensions are listed/maintained,
> > and I want to name this project appropriately. Therefore, if the
> > rabbitmq-c client implements the AMQP client standards (if any,) the PHP
> > extension should be called ?amqp? and not ?rabbbitmq?, and we should
> > name our classes/variables/etc appropriately.
> >
> > Thanks,
> > Pieter
> > --
> > the rubicon project
> >
> > PIETER DE ZWART | INTERFACES ENGINEER
> >
> > ??? P 310 207 0272 | x224
> > ??? F 323 466 7119
> >
> >
> > 1925 S. BUNDY  DRIVE
> > LOS ANGELES, CALIFORNIA 90025
> >
> > WWW.RUBICONPROJECT.COM <_http://www.rubiconproject.com/_>
> >
> >
> > ?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
> > #24 ON FAST COMPANY FAST 50 READER FAVORITES
> > 2008  ALWAYSON 250 GLOBAL WINNER
> > 2008 ALWAYSON ONMEDIA 100 WINNER
> > TWIISTUP3  BEST IN SHOW
> > PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
> > AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
> > AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
> > AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE
> > -  SERVICES
> >
> > P          Please consider the environment before printing this e-mail
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/746becf4/attachment.htm 

From matthew at lshift.net  Mon Apr  5 14:47:19 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 5 Apr 2010 14:47:19 +0100
Subject: [rabbitmq-discuss] Are Windows 7 X64 and X86 supported by
 RabbitMQ?
In-Reply-To: <j2i173a1edc1004050638n3ce199e8jab719292272e0ee3@mail.gmail.com>
References: <j2i173a1edc1004050638n3ce199e8jab719292272e0ee3@mail.gmail.com>
Message-ID: <20100405134719.GB12495@wellquite.org>

John,

On Mon, Apr 05, 2010 at 03:38:19PM +0200, John Apps wrote:
> Before I continue spending time on this and reporting things I either do not
> understand or consider wrong,
> it would be worth knowing if Windows in general and 7 (X64 and X86) are
> supported by RabbitMQ.
> I would hate to waste your time, and mine, with this!

Sure, that makes sense. The answer is yes, we do support Windows.
However, the unavailability of a 64-bit Erlang for Windows, and Windows'
unhelpful and inconsistent limits on address space for 32-bit programs
means that we do not recommend Windows. That said, pretty much every
bug that was fixed between 1.7.1 and 1.7.2 was in order to make RabbitMQ
work better on Windows - hence we are committed to supporting it, despite
its warts.

> I was told in a previous reply a few weeks ago that anyone considering a
> 'serious' production deployment of
> a RabbitMQ application would use Linux rather than Windows. It was this
> suggestion and the number of
> things not quite working to plan that led me to ask the question.

Yup, that is pretty much our position. At the end of the day, the
inability to reliably get > 2GB memory assigned to Rabbit under Windows
is a pretty crippling issue. This should ease, once a 64-bit Erlang
appears for Windows, though I've no idea of any ETA for that.

Matthew



From johndapps at gmail.com  Mon Apr  5 14:50:37 2010
From: johndapps at gmail.com (John Apps)
Date: Mon, 5 Apr 2010 15:50:37 +0200
Subject: [rabbitmq-discuss] Persister log size calculation and rolling
	persister log frequency?
In-Reply-To: <q2n173a1edc1004010953t66f0d7ebjb6d022d7b37bc5d4@mail.gmail.com>
References: <q2n173a1edc1004010953t66f0d7ebjb6d022d7b37bc5d4@mail.gmail.com>
Message-ID: <q2k173a1edc1004050650w974bdcbcg78ad2696019037ec@mail.gmail.com>

>
QueuesOverviewMessagesTransactionsParametersVhostNameConsumersMemoryCountMsg
> readyMsg unackCountAcks uncommitedDurableAuto deleteArguments/
> amq.gen-EIK8rQQfEX9IBiqLwF6h7Q==10MB22702271227falsetrue[]

>>>I know some people aren't a fan of semantically significant spaces in
>>>programming languages, but they're generally favoured in English...

Oh well, it would appear that the program you are using to process entries
in the discussion group is
converting everything to plain text prior to processing. The original note
had some statistics taken from
the RabbitMQ Statistics Report Web application. I screen shots are
preferred, such as the one attached,
I shall send those along instead in the future.
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/ee496020/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitUntitled.png
Type: image/png
Size: 37826 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/ee496020/attachment.png 

From scott at beamdog.com  Mon Apr  5 16:38:12 2010
From: scott at beamdog.com (Scott Brooks)
Date: Mon, 5 Apr 2010 09:38:12 -0600
Subject: [rabbitmq-discuss] Rabbitmq-c compatibility
In-Reply-To: <n2saa3794b1004050646pc2000199j4da69b0864b1009b@mail.gmail.com>
References: <7C1046148D91C244A98F4C146735886701BA2E04@BE43.exg3.exghost.com>
	<n2saa3794b1004050646pc2000199j4da69b0864b1009b@mail.gmail.com>
Message-ID: <r2qad81937d1004050838ife980024y75466db9e67f2c77@mail.gmail.com>

I'm not sure if the PHP client exposes it, but
http://hg.rabbitmq.com/rabbitmq-c/file/17b9fb0d63d3/librabbitmq/amqp_connection.c#l126

<http://hg.rabbitmq.com/rabbitmq-c/file/17b9fb0d63d3/librabbitmq/amqp_connection.c#l126>amqp_set_sockfd
will let you set the socket fd that librabbit uses.

Scott

On Mon, Apr 5, 2010 at 7:46 AM, Mark Steele <msteele at beringmedia.com> wrote:

> Quick question sort of related to both the C client and the php client...
>
> How hard would it be to get SSL support (including client
> certificates)? We're currently using a pure PHP implementation which we use
> with SSL support and would love to switch to a librabbit based solution,
> however we need the SSL support. Thoughts?
>
> Creating the SSL socket stream context in PHP is trivial, might it be
> possible to pass the stream file descriptor to librabbit in some fashion?
> (or any plans on supporting SSL by linking in openssl to librabbit?)
>
> Cheers,
>
>
> Mark Steele
> Director of development
> Bering Media Inc.
>
>
>
> On Sat, Apr 3, 2010 at 2:19 PM, Pieter de Zwart <
> pdezwart at rubiconproject.com> wrote:
>
>>  That is awesome, thank you very much Tony!
>> Pieter
>>
>>
>>
>> ----- Original Message -----
>> From: Tony Garnock-Jones <tonyg at lshift.net>
>> To: Pieter de Zwart
>> Cc: rabbitmq-discuss at lists.rabbitmq.com <
>> rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Sat Apr 03 14:08:39 2010
>> Subject: Re: Rabbitmq-c compatibility
>>
>> Hi Pieter,
>>
>> It is intended to be, yes. At the 0-9-1 protocol version it definitely
>> works with Qpid and OpenAMQ (I've tried it), though the 0-8 version
>> doesn't interoperate so smoothly because of differing interpretations of
>> the spec. I'd therefore recommend calling the extension "AMQP" instead
>> of "rabbitmq".
>>
>> Regards,
>>   Tony
>>
>>
>> Pieter de Zwart wrote:
>> > This is a RabbitMQ-c question, but I figure I would send it to the
>> > entire list as well.
>> >
>> > Is rabbitmq-c compatible with other brokers implementing the AMQP spec?
>> > The reason I ask is that I submitting our php extension to the PECL
>> > directory, which is where official PHP extensions are listed/maintained,
>> > and I want to name this project appropriately. Therefore, if the
>> > rabbitmq-c client implements the AMQP client standards (if any,) the PHP
>> > extension should be called ?amqp? and not ?rabbbitmq?, and we should
>> > name our classes/variables/etc appropriately.
>> >
>> > Thanks,
>> > Pieter
>> > --
>> > the rubicon project
>> >
>> > PIETER DE ZWART | INTERFACES ENGINEER
>> >
>> > ??? P 310 207 0272 | x224
>> > ??? F 323 466 7119
>> >
>> >
>> > 1925 S. BUNDY  DRIVE
>> > LOS ANGELES, CALIFORNIA 90025
>> >
>> > WWW.RUBICONPROJECT.COM <_http://www.rubiconproject.com/_>
>> >
>> >
>> > ?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
>> > #24 ON FAST COMPANY FAST 50 READER FAVORITES
>> > 2008  ALWAYSON 250 GLOBAL WINNER
>> > 2008 ALWAYSON ONMEDIA 100 WINNER
>> > TWIISTUP3  BEST IN SHOW
>> > PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
>> > AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
>> > AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
>> > AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE
>> > -  SERVICES
>> >
>> > P          Please consider the environment before printing this e-mail
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>>
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/fe1811c9/attachment.htm 

From pdezwart at rubiconproject.com  Mon Apr  5 17:31:01 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 5 Apr 2010 12:31:01 -0400
Subject: [rabbitmq-discuss] Rabbitmq-c compatibility
Message-ID: <7C1046148D91C244A98F4C146735886701BA2E0E@BE43.exg3.exghost.com>

Well, until about 5 minutes ago there were no plans, but I am always up for a challenge =)
Before I go through all the work though, I need to finish all the clean up required to make it an official PHP extension, so the potential start date is about 1 to 2 weeks out.
Ill start asking around in the meantime, but can you also validate that the current php-rabbit project on Google Code has all of the necessary functionality you are looking for?

Thanks,
Pieter


________________________________

From: Mark Steele <msteele at beringmedia.com> 
To: Pieter de Zwart 
Cc: tonyg at lshift.net <tonyg at lshift.net>; rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Mon Apr 05 09:46:59 2010
Subject: Re: [rabbitmq-discuss] Rabbitmq-c compatibility 


Quick question sort of related to both the C client and the php client...

How hard would it be to get SSL support (including client certificates)? We're currently using a pure PHP implementation which we use with SSL support and would love to switch to a librabbit based solution, however we need the SSL support. Thoughts?

Creating the SSL socket stream context in PHP is trivial, might it be possible to pass the stream file descriptor to librabbit in some fashion? (or any plans on supporting SSL by linking in openssl to librabbit?)

Cheers,


Mark Steele
Director of development
Bering Media Inc.




On Sat, Apr 3, 2010 at 2:19 PM, Pieter de Zwart <pdezwart at rubiconproject.com> wrote:


	That is awesome, thank you very much Tony!
	Pieter

	



	----- Original Message -----
	From: Tony Garnock-Jones <tonyg at lshift.net>
	To: Pieter de Zwart
	Cc: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com>
	Sent: Sat Apr 03 14:08:39 2010
	Subject: Re: Rabbitmq-c compatibility
	
	Hi Pieter,
	
	It is intended to be, yes. At the 0-9-1 protocol version it definitely
	works with Qpid and OpenAMQ (I've tried it), though the 0-8 version
	doesn't interoperate so smoothly because of differing interpretations of
	the spec. I'd therefore recommend calling the extension "AMQP" instead
	of "rabbitmq".
	
	Regards,
	  Tony
	
	
	Pieter de Zwart wrote:
	> This is a RabbitMQ-c question, but I figure I would send it to the
	> entire list as well.
	>
	> Is rabbitmq-c compatible with other brokers implementing the AMQP spec?
	> The reason I ask is that I submitting our php extension to the PECL
	> directory, which is where official PHP extensions are listed/maintained,
	> and I want to name this project appropriately. Therefore, if the
	> rabbitmq-c client implements the AMQP client standards (if any,) the PHP
	> extension should be called ?amqp? and not ?rabbbitmq?, and we should
	> name our classes/variables/etc appropriately.
	>
	> Thanks,
	> Pieter
	> --
	> the rubicon project
	>
	> PIETER DE ZWART | INTERFACES ENGINEER
	>
	> ??? P 310 207 0272 | x224
	> ??? F 323 466 7119
	>
	>
	> 1925 S. BUNDY  DRIVE
	> LOS ANGELES, CALIFORNIA 90025
	>
	> WWW.RUBICONPROJECT.COM <_http://www.rubiconproject.com/_>
	>
	>
	> ?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
	> #24 ON FAST COMPANY FAST 50 READER FAVORITES
	> 2008  ALWAYSON 250 GLOBAL WINNER
	> 2008 ALWAYSON ONMEDIA 100 WINNER
	> TWIISTUP3  BEST IN SHOW
	> PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
	> AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
	> AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
	> AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE
	> -  SERVICES
	>
	> P          Please consider the environment before printing this e-mail
	

	


	_______________________________________________
	rabbitmq-discuss mailing list
	rabbitmq-discuss at lists.rabbitmq.com
	http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
	
	


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/347f1820/attachment.htm 

From pdezwart at rubiconproject.com  Mon Apr  5 17:33:25 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 5 Apr 2010 12:33:25 -0400
Subject: [rabbitmq-discuss] Rabbitmq-c compatibility
Message-ID: <7C1046148D91C244A98F4C146735886701BA2E0F@BE43.exg3.exghost.com>

D'oh. Should read all my emails before responding. If this is the case, then exposing the functionality should be relatively easy. Still at least 1 to 2 weeks out though.
Pieter

________________________________

From: rabbitmq-discuss-bounces at lists.rabbitmq.com <rabbitmq-discuss-bounces at lists.rabbitmq.com> 
To: Mark Steele <msteele at beringmedia.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Mon Apr 05 11:38:12 2010
Subject: Re: [rabbitmq-discuss] Rabbitmq-c compatibility 


I'm not sure if the PHP client exposes it, but 
http://hg.rabbitmq.com/rabbitmq-c/file/17b9fb0d63d3/librabbitmq/amqp_connection.c#l126

<http://hg.rabbitmq.com/rabbitmq-c/file/17b9fb0d63d3/librabbitmq/amqp_connection.c#l126> amqp_set_sockfd will let you set the socket fd that librabbit uses.

Scott


On Mon, Apr 5, 2010 at 7:46 AM, Mark Steele <msteele at beringmedia.com> wrote:


	Quick question sort of related to both the C client and the php client...

	How hard would it be to get SSL support (including client certificates)? We're currently using a pure PHP implementation which we use with SSL support and would love to switch to a librabbit based solution, however we need the SSL support. Thoughts?

	Creating the SSL socket stream context in PHP is trivial, might it be possible to pass the stream file descriptor to librabbit in some fashion? (or any plans on supporting SSL by linking in openssl to librabbit?)

	Cheers,


	Mark Steele
	Director of development
	Bering Media Inc.
	
	
	
	
	On Sat, Apr 3, 2010 at 2:19 PM, Pieter de Zwart <pdezwart at rubiconproject.com> wrote:
	

		That is awesome, thank you very much Tony!
		Pieter

		



		----- Original Message -----
		From: Tony Garnock-Jones <tonyg at lshift.net>
		To: Pieter de Zwart
		Cc: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com>
		Sent: Sat Apr 03 14:08:39 2010
		Subject: Re: Rabbitmq-c compatibility
		
		Hi Pieter,
		
		It is intended to be, yes. At the 0-9-1 protocol version it definitely
		works with Qpid and OpenAMQ (I've tried it), though the 0-8 version
		doesn't interoperate so smoothly because of differing interpretations of
		the spec. I'd therefore recommend calling the extension "AMQP" instead
		of "rabbitmq".
		
		Regards,
		  Tony
		
		
		Pieter de Zwart wrote:
		> This is a RabbitMQ-c question, but I figure I would send it to the
		> entire list as well.
		>
		> Is rabbitmq-c compatible with other brokers implementing the AMQP spec?
		> The reason I ask is that I submitting our php extension to the PECL
		> directory, which is where official PHP extensions are listed/maintained,
		> and I want to name this project appropriately. Therefore, if the
		> rabbitmq-c client implements the AMQP client standards (if any,) the PHP
		> extension should be called ?amqp? and not ?rabbbitmq?, and we should
		> name our classes/variables/etc appropriately.
		>
		> Thanks,
		> Pieter
		> --
		> the rubicon project
		>
		> PIETER DE ZWART | INTERFACES ENGINEER
		>
		> ??? P 310 207 0272 | x224
		> ??? F 323 466 7119
		>
		>
		> 1925 S. BUNDY  DRIVE
		> LOS ANGELES, CALIFORNIA 90025
		>
		> WWW.RUBICONPROJECT.COM <_http://www.rubiconproject.com/_>
		>
		>
		> ?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
		> #24 ON FAST COMPANY FAST 50 READER FAVORITES
		> 2008  ALWAYSON 250 GLOBAL WINNER
		> 2008 ALWAYSON ONMEDIA 100 WINNER
		> TWIISTUP3  BEST IN SHOW
		> PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
		> AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
		> AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
		> AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE
		> -  SERVICES
		>
		> P          Please consider the environment before printing this e-mail
		

		


		_______________________________________________
		rabbitmq-discuss mailing list

		rabbitmq-discuss at lists.rabbitmq.com
		
		http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
		
		



	_______________________________________________
	rabbitmq-discuss mailing list
	rabbitmq-discuss at lists.rabbitmq.com
	http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
	
	


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/85590a54/attachment.htm 

From tonyg at lshift.net  Mon Apr  5 18:34:15 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 06 Apr 2010 05:34:15 +1200
Subject: [rabbitmq-discuss] Rabbitmq-c compatibility
In-Reply-To: <n2saa3794b1004050646pc2000199j4da69b0864b1009b@mail.gmail.com>
References: <AcrTWLcz3yACNCO3TdCLgA3FQMeyOwAAXxGE>
	<7C1046148D91C244A98F4C146735886701BA2E04@BE43.exg3.exghost.com>
	<n2saa3794b1004050646pc2000199j4da69b0864b1009b@mail.gmail.com>
Message-ID: <4BBA1F17.1040200@lshift.net>

Mark Steele wrote:
> How hard would it be to get SSL support (including client
> certificates)?

As Scott pointed out, at the C level it ought to be doable now, but
isn't exactly easy. I've never written an SSL client or server
application in C before so I've no idea how cleanly SSL integrates with
ordinary select()ish programs.

Another option you could consider is to look for something like stunnel4
but which runs in reverse, and run it on your PHP machines. The PHP
programs would connect to localhost without SSL, and the stunnel-like
program would connect out to the Rabbit server with SSL on their behalf.
I'm not sure if anything like this exists.

Tony




From mmistroni at gmail.com  Mon Apr  5 18:51:54 2010
From: mmistroni at gmail.com (Marco Mistroni)
Date: Mon, 5 Apr 2010 18:51:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ Admin API
Message-ID: <h2m7e346e131004051051rde095e18led5bd83323f40322@mail.gmail.com>

Hello all,
 is there  a rabbitmq admin API, so that i can for example view all channels
per host?

I know rabbitMQ has a different approach to JMS , and you can create and
destroy channels on the fly..
is ther an API that allows me to view all queues / topic  for a predefined
exchange>?

w/kindest regards
  marco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/503e0a20/attachment.htm 

From tonyg at lshift.net  Mon Apr  5 18:53:47 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 06 Apr 2010 05:53:47 +1200
Subject: [rabbitmq-discuss] Persister log size calculation and rolling
 persister log frequency?
In-Reply-To: <20100402163014.GK11613@wellquite.org>
References: <q2n173a1edc1004010953t66f0d7ebjb6d022d7b37bc5d4@mail.gmail.com>
	<20100402163014.GK11613@wellquite.org>
Message-ID: <4BBA23AB.8020705@lshift.net>

Hi John, Matthew,

Matthew Sackman wrote:
> On Thu, Apr 01, 2010 at 06:53:57PM +0200, John Apps wrote:
>> The size is presumably determined by the number of messages pending, i.e.,
>> not yet acknowledged?

Roughly, yes. The size of each log file is proportional to

 - the number of undelivered messages at previous rollover,
 - the total size of undelivered messages at previous rollover,
 - the number of deliveries since rollover,
 - the total size of deliveries since rollover, and
 - the number of acknowledgements since rollover.

Rollover happens at the moment whenever more than MAX_WRAP_ENTRIES
(currently set to only 500!) "entries" are written to the log, or after
HIBERNATE_AFTER (currently 10,000) milliseconds of persister inactivity.

An "entry" for the purposes of MAX_WRAP_ENTRIES is the amount of work
the persister collects in either 5ms or 2ms, depending on context.

At its most frequent, log rolling should happen about once a second.
This is way, way too often. I'll write a separate message now asking
people to experiment with different settings for MAX_WRAP_ENTRIES.

> "[...] probably we should not roll whilst we're really busy".

Hmm. Was this a change to callers of the persister? I can't see any
logic in the persister that takes system load into account at the moment.

> I know some people aren't a fan of semantically significant spaces in
> programming languages, but they're generally favoured in English...

Presumably mutt mangled the HTML somehow :-)

Regards,
  Tony




From tonyg at lshift.net  Mon Apr  5 19:39:48 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 06 Apr 2010 06:39:48 +1200
Subject: [rabbitmq-discuss] The *old* persister: call for help in
	experimenting
Message-ID: <4BBA2E74.1080700@lshift.net>

Hi all,

The current persister (*not* Matthew's new persister) is very much
TSTTCPW, and uses a few overly-simple heuristics to decide when to start
a GC run. Some of them are arbitrarily chosen, and I suspect that many
readers of this list *might* see a not inconsiderable improvement in
persistent-message performance by tweaking them. The tradeoff seems to
be in RAM usage.

If you can help by reporting experiences with tweaked persister-control
variables, please do try out the suggestions in the rest of this message
and let us know what happens!


The main control variables, all of which are compiled in (!) to the
code, are

 -define(LOG_BUNDLE_DELAY, 5).
 -define(COMPLETE_BUNDLE_DELAY, 2).
 -define(HIBERNATE_AFTER, 10000).
 -define(MAX_WRAP_ENTRIES, 500).

The *_BUNDLE_DELAY variables are milliseconds to wait for additional
work to arrive at the persister before performing some I/O to the
journal, in differing calling contexts.

The HIBERNATE_AFTER variable is the number of milliseconds of persister
idling after which we choose to GC the journal.

The MAX_WRAP_ENTRIES variable is a completely arbitrary count of I/O
operations after which we choose to GC the journal.

So here's the issue: MAX_WRAP_ENTRIES really is pretty arbitrary, and I
think the value 500 is probably one or maybe even two orders of
magnitude too low.

To see why, imagine that we're submitting a constant stream of work to
the persister in a situation that results in it waiting for
COMPLETE_BUNDLE_DELAY (i.e. 2) milliseconds for more work before
performing (and counting!) a bundled I/O to the journal. Since we will
GC after MAX_WRAP_ENTRIES I/Os, we will GC every MAX_WRAP_ENTRIES *
COMPLETE_BUNDLE_DELAY = 1000 milliseconds.

A garbage collection of the whole message store once a second, at worst!
Ouch.

If people are in a position such that

 - they use the persister heavily (durable queues, persistent messages)
 - they are submitting moderate load to Rabbit (> 100 messages/sec)
 - they are experiencing excessive persister log rollover
 - they run RabbitMQ built from source code

then I'd *love* to hear if changing MAX_WRAP_ENTRIES for your local
rabbit to something like 5000 makes a difference in terms of rollover
frequency and general rabbit performance for you.

Note that RAM requirements will rise a bit if you increase
MAX_WRAP_ENTRIES. I've just run some experiments on my Macbook. Using
ProducerMain/ConsumerMain to provider a 300 message-per-second
persistent load through a single durable queue, I notice:

|------------------+----------+--------------+----------+----------|
| MAX_WRAP_ENTRIES | rollover | max log size | real mem | virt mem |
|------------------+----------+--------------+----------+----------|
|              500 | 3.5 s    | 700 kB       | 13 MB    | 609 MB   |
|             5000 | 34 s     | 7.3 MB       | 19 MB    | 615 MB   |
|            50000 | ~5 min   | 72 MB        | ~60 MB   | ~660 MB  |
|------------------+----------+--------------+----------+----------|

(I'm not sure why Rabbit seems to use RAM in proportion to the size of
the journal.)

Changing MAX_WRAP_ENTRIES from 500 to 5000 gave a tenfold reduction in
the number of rollovers, at a cost of about 6 MB RAM, which seems pretty
reasonable to me.

Tony




From matthew at lshift.net  Mon Apr  5 20:12:58 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 5 Apr 2010 20:12:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ Admin API
In-Reply-To: <h2m7e346e131004051051rde095e18led5bd83323f40322@mail.gmail.com>
References: <h2m7e346e131004051051rde095e18led5bd83323f40322@mail.gmail.com>
Message-ID: <20100405191258.GA29580@wellquite.org>

Hi Marco,

On Mon, Apr 05, 2010 at 06:51:54PM +0100, Marco Mistroni wrote:
>  is there  a rabbitmq admin API, so that i can for example view all channels
> per host?

http://www.rabbitmq.com/admin-guide.html#list_channels

> I know rabbitMQ has a different approach to JMS , and you can create and
> destroy channels on the fly..
> is ther an API that allows me to view all queues / topic  for a predefined
> exchange>?

http://www.rabbitmq.com/admin-guide.html#list_bindings though you'll
have to do some filtering of the output.

In general, monitoring is something we're currently spending a lot of
time thinking about, so you could expect this area to improve in the
future. If you have any thoughts on this front, we'd be interested to
hear them.


Matthew



From jon.brisbin at npcinternational.com  Mon Apr  5 22:53:29 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 5 Apr 2010 16:53:29 -0500
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
Message-ID: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>

Not sure there's anyone besides me on both these lists, but I'm x-posting just to save time.

I'm currently working on setting up a RabbitMQ-based session cluster using my own session manager and store. I had to write my own because I couldn't find anything out there that uses JMS or RabbitMQ to do session clustering (which actually surprised me a little) that had the virtual cloud awareness I need. Everything I've read about Tomcat clustering uses the Apache Tribes replication, which doesn't work for me under even moderate load testing (maybe I'm just not doing right...I don't know) or the centralized JDBCStore, which introduces a single point of failure. 

The basic idea here is to use RabbitMQ as the session clustering back-end and have a user's session available to any server currently subscribed to the clustering queue with no sticky sessions at all. This (cross your fingers) gives me a very, very scalable clustering architecture (my RabbitMQ servers are load-balanced and clustered using VMware vms so I can add capacity at will) that doesn't suffer from the single point of failure of a JDBCStore or the multicast limitations of Apache Tribes. Sessions are also shared across points of responsibility, too, as a single session object can be passed around from code running inside a webapp to code in a command-line client. I wanted my session handling to be a first-class virtual cloud citizen, rather than feel like I'm shoe-horning existing code into what I want to do.

I'm almost finished with the heavy lifting. I should have a functioning drop-in manager and store this week, which I'll put on my github account. What I'd like to know is if there's any interest in the community for something like this? If there's no interest, I won't bother writing documentation and what-not.

Does this sound like it would interest any other Tomcat/RabbitMQ users?

Jon Brisbin
Portal Webmaster
NPC International, Inc.






From alexis at rabbitmq.com  Mon Apr  5 23:22:12 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 5 Apr 2010 15:22:12 -0700
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
Message-ID: <q2g167204d21004051522tad24826aua6e82eb4fe065cf0@mail.gmail.com>

Jon

thank-you

yes there is definitely interest in this and in your work with groovy

sorry if we have been slow to respond over Easter

alexis

On Apr 5, 2010 2:53 PM, "Jon Brisbin" <jon.brisbin at npcinternational.com>
wrote:

Not sure there's anyone besides me on both these lists, but I'm x-posting
just to save time.

I'm currently working on setting up a RabbitMQ-based session cluster using
my own session manager and store. I had to write my own because I couldn't
find anything out there that uses JMS or RabbitMQ to do session clustering
(which actually surprised me a little) that had the virtual cloud awareness
I need. Everything I've read about Tomcat clustering uses the Apache Tribes
replication, which doesn't work for me under even moderate load testing
(maybe I'm just not doing right...I don't know) or the centralized
JDBCStore, which introduces a single point of failure.

The basic idea here is to use RabbitMQ as the session clustering back-end
and have a user's session available to any server currently subscribed to
the clustering queue with no sticky sessions at all. This (cross your
fingers) gives me a very, very scalable clustering architecture (my RabbitMQ
servers are load-balanced and clustered using VMware vms so I can add
capacity at will) that doesn't suffer from the single point of failure of a
JDBCStore or the multicast limitations of Apache Tribes. Sessions are also
shared across points of responsibility, too, as a single session object can
be passed around from code running inside a webapp to code in a command-line
client. I wanted my session handling to be a first-class virtual cloud
citizen, rather than feel like I'm shoe-horning existing code into what I
want to do.

I'm almost finished with the heavy lifting. I should have a functioning
drop-in manager and store this week, which I'll put on my github account.
What I'd like to know is if there's any interest in the community for
something like this? If there's no interest, I won't bother writing
documentation and what-not.

Does this sound like it would interest any other Tomcat/RabbitMQ users?

Jon Brisbin
Portal Webmaster
NPC International, Inc.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100405/b70fdedb/attachment.htm 

From johndapps at gmail.com  Tue Apr  6 09:48:07 2010
From: johndapps at gmail.com (John Apps)
Date: Tue, 6 Apr 2010 10:48:07 +0200
Subject: [rabbitmq-discuss] The New Persister --- I would like to compare it
	with the old (using Tony's recommendations) --- but where is it?
Message-ID: <v2n173a1edc1004060148wdd595516r597c559d87458046@mail.gmail.com>

Sorry to ask a silly question again, but where do I find and how do I
install the New Persister (on Windows 7)?

Just bear with someone that has worked on mainframes and other strange
machines for years, please! [?]

---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100406/1a8e1d47/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 100 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100406/1a8e1d47/attachment.gif 

From matthew at lshift.net  Tue Apr  6 11:27:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 6 Apr 2010 11:27:15 +0100
Subject: [rabbitmq-discuss] The New Persister --- I would like to
 compare it with the old (using Tony's recommendations) --- but where is it?
In-Reply-To: <v2n173a1edc1004060148wdd595516r597c559d87458046@mail.gmail.com>
References: <v2n173a1edc1004060148wdd595516r597c559d87458046@mail.gmail.com>
Message-ID: <20100406102715.GA7830@mrnibble.lshift.net>

On Tue, Apr 06, 2010 at 10:48:07AM +0200, John Apps wrote:
> Sorry to ask a silly question again, but where do I find and how do I
> install the New Persister (on Windows 7)?

You need to build from source. It's on branch bug21673.
http://www.rabbitmq.com/build-server.html

After the cd rabbitmq-server step, do an hg up -C bug21673

Note you'll need at least cygwin in order to build under Windows (and
obviously Erlang installed too, and no doubt all manner of fun and games
to get erl and erlc on your %PATH% and $PATH.

Note even under the new persister there is still a small per-message RAM
cost, *unless* you also use the rabbitmq-toke plugin
http://hg.rabbitmq.com/rabbitmq-toke/ which will require you to have
Tokyo Cabinet installed. I have absolutely no experience of attempting
that under Windows.

Matthew



From matthew at lshift.net  Tue Apr  6 11:57:57 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 6 Apr 2010 11:57:57 +0100
Subject: [rabbitmq-discuss] New Plugin: External Exchange
Message-ID: <20100406105757.GB7830@mrnibble.lshift.net>

RabbitMQ External Exchange Plugin
=================================

http://hg.rabbitmq.com/rabbitmq-external-exchange
http://hg.rabbitmq.com/rabbitmq-external-exchange/file/default/README


Overview
--------

This plugin allows you to write implementations of exchange types as
normal AMQP clients of RabbitMQ using any of the multitude of AMQP
clients available.

Example frameworks for both Java (using the RabbitMQ Java client) and
Erlang (using the RabbitMQ Erlang client) are provided to demonstrate
the cleanliness of API that can be achieved.


Introduction
------------

AMQP provides 4 basic exchange types: "fanout", "direct", "topic" and
"headers". It also provides a means to allow custom exchange types to
be used, requiring that any such custom exchange types start with a
"x-" prefix.

RabbitMQ provides pluggable exchange types, which permit new exchange
types to be provided by filling in a thin API. This API allows the
custom exchange type to be notified of exchange creation, deletion,
the addition and removal of bindings, and the publishing messages to
an exchange. The custom exchange may, upon being told of a publish,
modify the message or any of its meta-data, and route it to any queue.

However, the custom exchange is called directly by each channel, and
so does not serialise events, making it a little challenging (though
by no means overly tricky) to maintain state. It also requires the
exchange to be written in Erlang and to run directly in the same
Erlang VM as RabbitMQ (though note that plugins such as the
script-exchange allow for functions written in scripting languages
such as Javascript to be run on every publish).

This plugin takes the events relating to exchanges, encapsulates them
in AMQP and performs RPC to an external client. This allows further
choice of language, flexibility of implementation, and permits all
events to be processed by a single thread, thus making it easier for
the exchange type implementation to be stateful (though it's by no
means impossible to achieve a stateful exchange without this plugin).

See the README linked above for the rest of the details including the
APIs of the example frameworks.

Matthew



From matthew at lshift.net  Tue Apr  6 12:05:48 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 6 Apr 2010 12:05:48 +0100
Subject: [rabbitmq-discuss] New persister developments
Message-ID: <20100406110548.GC7830@mrnibble.lshift.net>

...and whilst I'm on the subject of annoucements...

The new persister (bug21673) received an awful lot af attention day and
night over the long weekend, gaining the ability to start up almost
instantly given a clean shutdown (i.e. rabbitmqctl stop, not kill!),
regardless of the volume of persistent messages stored in Rabbit. Even
with tens of millions of messages in there, start up is now on the order
of 10 seconds - likely 2 orders of magnitude faster than before.

If it isn't shutdown clean, fscking is still necessary, though even that
has been dramatically improved, now being able to do this work in
parallel (in some cases in parallel even if only restoring a single
queue).

You'll want at least revision e21206f4da2b, or any child of that
(currently none).

As ever, bug reports are most welcome!

Matthew



From matthew at lshift.net  Tue Apr  6 14:49:49 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 6 Apr 2010 14:49:49 +0100
Subject: [rabbitmq-discuss] Persister log size calculation and rolling
 persister log frequency?
In-Reply-To: <4BBA23AB.8020705@lshift.net>
References: <q2n173a1edc1004010953t66f0d7ebjb6d022d7b37bc5d4@mail.gmail.com>
	<20100402163014.GK11613@wellquite.org>
	<4BBA23AB.8020705@lshift.net>
Message-ID: <20100406134949.GB8518@mrnibble.lshift.net>

On Tue, Apr 06, 2010 at 05:53:47AM +1200, Tony Garnock-Jones wrote:
> > "[...] probably we should not roll whilst we're really busy".
> 
> Hmm. Was this a change to callers of the persister? I can't see any
> logic in the persister that takes system load into account at the moment.

Oh, I was meaning the hibernate delay.

Matthew



From matthias at lshift.net  Tue Apr  6 15:17:13 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 06 Apr 2010 15:17:13 +0100
Subject: [rabbitmq-discuss] clustering question
In-Reply-To: <s2u167204d21003311702r49784589od9fd304b3a31b169@mail.gmail.com>
References: <BF8565BD-A0EC-4E6D-81C5-FDB4D2BEB944@gmail.com>	<g2y167204d21003311644h6c9c446fz3c801cb457fa6e9a@mail.gmail.com>	<DF96C3E8-273F-4EB2-97F8-F5E026864482@gmail.com>
	<s2u167204d21003311702r49784589od9fd304b3a31b169@mail.gmail.com>
Message-ID: <4BBB4269.8070105@lshift.net>

Ian,

Alexis Richardson wrote:
> If you publish with (say) key "bob" and two queues on two nodes
> are bound with that key, then they both get a copy. That's pubsub in
> the multicast style for you.  For precise error reporting, I shall
> defer to someone with more knowledge than I ...

In AMQP it is perfectly ok to publish a message that does not get routed 
anywhere; the message will simply be dropped. But if you set the 
'mandatory' flag in basic.publish then in these situations the server 
will asynchronously return the message to the sender in a basic.return 
command.


Regards,

Matthias.



From pkirsanov at 38studios.com  Tue Apr  6 17:15:47 2010
From: pkirsanov at 38studios.com (Philippe Kirsanov)
Date: Tue, 6 Apr 2010 12:15:47 -0400
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
Message-ID: <D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>

Just curious, how do you do load balancing with VMware?

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jon
Brisbin
Sent: Monday, April 05, 2010 17:53
To: RabbitMQ
Cc: Tomcat Users List
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering

Not sure there's anyone besides me on both these lists, but I'm
x-posting just to save time.

I'm currently working on setting up a RabbitMQ-based session cluster
using my own session manager and store. I had to write my own because I
couldn't find anything out there that uses JMS or RabbitMQ to do session
clustering (which actually surprised me a little) that had the virtual
cloud awareness I need. Everything I've read about Tomcat clustering
uses the Apache Tribes replication, which doesn't work for me under even
moderate load testing (maybe I'm just not doing right...I don't know) or
the centralized JDBCStore, which introduces a single point of failure. 

The basic idea here is to use RabbitMQ as the session clustering
back-end and have a user's session available to any server currently
subscribed to the clustering queue with no sticky sessions at all. This
(cross your fingers) gives me a very, very scalable clustering
architecture (my RabbitMQ servers are load-balanced and clustered using
VMware vms so I can add capacity at will) that doesn't suffer from the
single point of failure of a JDBCStore or the multicast limitations of
Apache Tribes. Sessions are also shared across points of responsibility,
too, as a single session object can be passed around from code running
inside a webapp to code in a command-line client. I wanted my session
handling to be a first-class virtual cloud citizen, rather than feel
like I'm shoe-horning existing code into what I want to do.

I'm almost finished with the heavy lifting. I should have a functioning
drop-in manager and store this week, which I'll put on my github
account. What I'd like to know is if there's any interest in the
community for something like this? If there's no interest, I won't
bother writing documentation and what-not.

Does this sound like it would interest any other Tomcat/RabbitMQ users?

Jon Brisbin
Portal Webmaster
NPC International, Inc.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From majek04 at gmail.com  Tue Apr  6 17:20:04 2010
From: majek04 at gmail.com (majek04)
Date: Tue, 6 Apr 2010 17:20:04 +0100
Subject: [rabbitmq-discuss] rabbitmq_status_web crashed on daylight
	savings time switchover, took down RabbitMQ
In-Reply-To: <c26271fb1003290621k11605be5m2f755d67fcfce145@mail.gmail.com>
References: <ac6faba21003141945p1cd5effdu1755db8f10f9a827@mail.gmail.com>
	<c26271fb1003290621k11605be5m2f755d67fcfce145@mail.gmail.com>
Message-ID: <n2m3bb0d9711004060920hd23919c0g52cd91d37f089cf8@mail.gmail.com>

On Mon, Mar 29, 2010 at 14:21, mabrek <mabrek at gmail.com> wrote:
> It hasn't fixed, I've got this error with erlang R13B04.

You're right, it looks like the patch mentioned by Matthew [1] didn't
go through into R13B04.

I'm not sure what we should do about it. Changing supervisor relationship won't
fix the problem. Changing rabbit behaiviour when plugin crashes seem to be
no-option.

We could eventually try to catch this particular error in the status plugin
code, but the question is what time we should return to the rendered page.
Maybe a http/500 error page.

Marek Majkowski


[1] http://www.erlang.org/cgi-bin/ezmlm-cgi?2:mss:1681:201001:jffdfifdokimdicjnpcp.



From gman at colo247.com  Tue Apr  6 22:29:48 2010
From: gman at colo247.com (LoOoD)
Date: Tue, 6 Apr 2010 14:29:48 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbit cluster keeps crashing
In-Reply-To: <20100402152411.GE11613@wellquite.org>
References: <28023134.post@talk.nabble.com>
	<20100402152411.GE11613@wellquite.org>
Message-ID: <28157770.post@talk.nabble.com>


Hi, 

Matthew Sackman wrote:
> 
> Hmm. The nodedown simply suggests that Erlang has lost touch with the
> other
> nodes. What kind of a network are you suing - is this a LAN or WAN or...
> and do you see any sort of packet loss with other applications?
> 
> You may want to experiment with lower values of net_ticktime in your
> rabbitmq.config file:
> 
> [{kernel, [{net_ticktime, 5}]}].
> 
> See
> http://ftp.sunet.se/pub/lang/erlang/doc/man/net_kernel.html#set_net_ticktime-1
> for documentation. It could just be that getting the nodes to talk to each
> other more frequently will solve this. On the other hand, that's likely to
> only be a problem if there are large periods of inactivity in the cluster
> -
> is this the case?
> 

Our servers are connected to gige switches and different subnets. The
switches and routers that the servers are connected to are using less then
10% of their capacity. We don't see any other apps having any sort of
network issues.  We send the rabbit cluster about 70 msgs/sec.

Another symptom we've noticed is the beam.smp process using 100% cpu. Is
there any thing we can do, to help track down the exact cause? Some sort of
increase debugging level? We're willing to do anything to figure out what
going on and stabilize it.


-- 
View this message in context: http://old.nabble.com/rabbit-cluster-keeps-crashing-tp28023134p28157770.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From tonyg at lshift.net  Tue Apr  6 23:43:58 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 07 Apr 2010 10:43:58 +1200
Subject: [rabbitmq-discuss] The New Persister --- I would like to
 compare it with the old (using Tony's recommendations) --- but where is it?
In-Reply-To: <20100406102715.GA7830@mrnibble.lshift.net>
References: <v2n173a1edc1004060148wdd595516r597c559d87458046@mail.gmail.com>
	<20100406102715.GA7830@mrnibble.lshift.net>
Message-ID: <4BBBB92E.9030206@lshift.net>

Matthew Sackman wrote:
> Note even under the new persister there is still a small per-message RAM
> cost, *unless* you also use the rabbitmq-toke plugin
> http://hg.rabbitmq.com/rabbitmq-toke/ which will require you to have
> Tokyo Cabinet installed. I have absolutely no experience of attempting
> that under Windows.

Yikes :-) Sends shivers down the spine. In my opinion, for these
preliminary tests, using the toke plugin isn't necessary. It could be
necessary for certain kinds of production installation though, so maybe
as a later step we should look at getting it built for windows somehow.

Tony




From tonyg at lshift.net  Tue Apr  6 23:46:20 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 07 Apr 2010 10:46:20 +1200
Subject: [rabbitmq-discuss] supervisor2 (was Re: rabbitmq_status_web crashed
 on daylight	savings time switchover, took down RabbitMQ)
In-Reply-To: <n2m3bb0d9711004060920hd23919c0g52cd91d37f089cf8@mail.gmail.com>
References: <ac6faba21003141945p1cd5effdu1755db8f10f9a827@mail.gmail.com>	<c26271fb1003290621k11605be5m2f755d67fcfce145@mail.gmail.com>
	<n2m3bb0d9711004060920hd23919c0g52cd91d37f089cf8@mail.gmail.com>
Message-ID: <4BBBB9BC.4050908@lshift.net>

majek04 wrote:
> I'm not sure what we should do about it.

supervisor2.erl? We could add some kind of exponential-backoff retry
thing, along the lines of init and/or daemontools.

Tony




From matthias at lshift.net  Wed Apr  7 06:41:47 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 07 Apr 2010 06:41:47 +0100
Subject: [rabbitmq-discuss] supervisor2 (was Re: rabbitmq_status_web
 crashed on daylight	savings time switchover, took down RabbitMQ)
In-Reply-To: <4BBBB9BC.4050908@lshift.net>
References: <ac6faba21003141945p1cd5effdu1755db8f10f9a827@mail.gmail.com>	<c26271fb1003290621k11605be5m2f755d67fcfce145@mail.gmail.com>	<n2m3bb0d9711004060920hd23919c0g52cd91d37f089cf8@mail.gmail.com>
	<4BBBB9BC.4050908@lshift.net>
Message-ID: <4BBC1B1B.5020205@lshift.net>

Tony Garnock-Jones wrote:
> majek04 wrote:
>> I'm not sure what we should do about it.
> 
> supervisor2.erl? We could add some kind of exponential-backoff retry
> thing, along the lines of init and/or daemontools.

Like 
http://hg.rabbitmq.com/rabbitmq-shovel/annotate/default/src/supervisor3.erl 
?

It only introduces a fixed delay rather than exponential backoff, but 
that should be good enough and, if not, would be easy to add.

Anyway, the bug should get fixed in the next OTP release, which ought to 
happen way before the next DST change cycle.


Matthias.



From g at rre.tt  Wed Apr  7 16:04:36 2010
From: g at rre.tt (Garrett Smith)
Date: Wed, 7 Apr 2010 10:04:36 -0500
Subject: [rabbitmq-discuss] RabbitMQ Admin API
In-Reply-To: <20100405191258.GA29580@wellquite.org>
References: <h2m7e346e131004051051rde095e18led5bd83323f40322@mail.gmail.com>
	<20100405191258.GA29580@wellquite.org>
Message-ID: <s2rce2570e21004070804g78a8ffa8ofd99d3fa06975d2b@mail.gmail.com>

On Mon, Apr 5, 2010 at 2:12 PM, Matthew Sackman <matthew at lshift.net> wrote:
> Hi Marco,
>
> On Mon, Apr 05, 2010 at 06:51:54PM +0100, Marco Mistroni wrote:
>> ?is there ?a rabbitmq admin API, so that i can for example view all channels
>> per host?
>
> http://www.rabbitmq.com/admin-guide.html#list_channels
>
>> I know rabbitMQ has a different approach to JMS , and you can create and
>> destroy channels on the fly..
>> is ther an API that allows me to view all queues / topic ?for a predefined
>> exchange>?
>
> http://www.rabbitmq.com/admin-guide.html#list_bindings though you'll
> have to do some filtering of the output.
>
> In general, monitoring is something we're currently spending a lot of
> time thinking about, so you could expect this area to improve in the
> future. If you have any thoughts on this front, we'd be interested to
> hear them.

This is a random and slightly disjointed thought, but I recall a
discussion about using counters to track various metrics in rabbitmq.
Have you looked at gproc?

Perhaps you already have something similar -- I've been meaning to
look to see how rabbitmq tracks processes and state for external
consumption (something I'm discovering is an important design
consideration in Erlang for very high process counts).

Garrett



From matthew at lshift.net  Wed Apr  7 17:39:49 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 7 Apr 2010 17:39:49 +0100
Subject: [rabbitmq-discuss] The New Persister --- I would like to
 compare it with the old (using Tony's recommendations) --- but where is it?
In-Reply-To: <4BBBB92E.9030206@lshift.net>
References: <v2n173a1edc1004060148wdd595516r597c559d87458046@mail.gmail.com>
	<20100406102715.GA7830@mrnibble.lshift.net>
	<4BBBB92E.9030206@lshift.net>
Message-ID: <20100407163949.GD29149@mrnibble.lshift.net>

On Wed, Apr 07, 2010 at 10:43:58AM +1200, Tony Garnock-Jones wrote:
> Yikes :-) Sends shivers down the spine. In my opinion, for these
> preliminary tests, using the toke plugin isn't necessary.

I absolutely agree. I'm just saying that esp under Windows, with the 2GB
limit, don't be suprised if even with the new persister, if you can't send
millions and millions of messages in, without the toke plugin.

> It could be
> necessary for certain kinds of production installation though, so maybe
> as a later step we should look at getting it built for windows somehow.

Indeed.

Matthew



From alexis.richardson at gmail.com  Wed Apr  7 19:21:40 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 7 Apr 2010 19:21:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
	<D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>
Message-ID: <o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>

Philippe

In what sense?  I imagine most folks would treat VMs as machines.  But
perhaps the VMware product suite could be helpful too....

alexis



On Tue, Apr 6, 2010 at 5:15 PM, Philippe Kirsanov
<pkirsanov at 38studios.com> wrote:
> Just curious, how do you do load balancing with VMware?
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jon
> Brisbin
> Sent: Monday, April 05, 2010 17:53
> To: RabbitMQ
> Cc: Tomcat Users List
> Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
>
> Not sure there's anyone besides me on both these lists, but I'm
> x-posting just to save time.
>
> I'm currently working on setting up a RabbitMQ-based session cluster
> using my own session manager and store. I had to write my own because I
> couldn't find anything out there that uses JMS or RabbitMQ to do session
> clustering (which actually surprised me a little) that had the virtual
> cloud awareness I need. Everything I've read about Tomcat clustering
> uses the Apache Tribes replication, which doesn't work for me under even
> moderate load testing (maybe I'm just not doing right...I don't know) or
> the centralized JDBCStore, which introduces a single point of failure.
>
> The basic idea here is to use RabbitMQ as the session clustering
> back-end and have a user's session available to any server currently
> subscribed to the clustering queue with no sticky sessions at all. This
> (cross your fingers) gives me a very, very scalable clustering
> architecture (my RabbitMQ servers are load-balanced and clustered using
> VMware vms so I can add capacity at will) that doesn't suffer from the
> single point of failure of a JDBCStore or the multicast limitations of
> Apache Tribes. Sessions are also shared across points of responsibility,
> too, as a single session object can be passed around from code running
> inside a webapp to code in a command-line client. I wanted my session
> handling to be a first-class virtual cloud citizen, rather than feel
> like I'm shoe-horning existing code into what I want to do.
>
> I'm almost finished with the heavy lifting. I should have a functioning
> drop-in manager and store this week, which I'll put on my github
> account. What I'd like to know is if there's any interest in the
> community for something like this? If there's no interest, I won't
> bother writing documentation and what-not.
>
> Does this sound like it would interest any other Tomcat/RabbitMQ users?
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From colin at cloudeventprocessing.com  Wed Apr  7 19:27:01 2010
From: colin at cloudeventprocessing.com (Colin Clark)
Date: Wed, 07 Apr 2010 13:27:01 -0500
Subject: [rabbitmq-discuss] Erlang Client
Message-ID: <4BBCCE75.3000601@cloudeventprocessing.com>

Hello,

I'm having difficulty getting the Erlang client to connect to a rabbitmq 
server - I'm using the stocks_example and the latest erlang client code 
and attempting to run within erlide.  The error message I'm getting is:

10> stocks_example:start().
** exception error: no match of right hand side value
                     {error,
                         {undef,
                             [{rabbit_net,send,
                                  [#Port<0.527>,<<65,77,81,80,1,1,8,0>>]},
                              {amqp_network_connection,do_handshake,1},
                              {amqp_network_connection,init,1},
                              {gen_server,init_it,6},
                              {proc_lib,init_p_do_apply,3}]}}
      in function  amqp_connection:start_network_internal/2
      in call from stocks_example:amqp_lifecycle/0

If anyone could point me in the right direction, I'd appreciate it.

Thank you.

-- 
Colin
+1 701 659 0115 cell
+1 701 212 4314 office
http://blog.cloudeventprocessing.com
http://twitter.com/EventCloudPro

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100407/35147a99/attachment.htm 

From matthew at lshift.net  Wed Apr  7 19:35:58 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 7 Apr 2010 19:35:58 +0100
Subject: [rabbitmq-discuss] Erlang Client
In-Reply-To: <4BBCCE75.3000601@cloudeventprocessing.com>
References: <4BBCCE75.3000601@cloudeventprocessing.com>
Message-ID: <20100407183558.GA9634@wellquite.org>

Hi Colin,

On Wed, Apr 07, 2010 at 01:27:01PM -0500, Colin Clark wrote:
> I'm having difficulty getting the Erlang client to connect to a
> rabbitmq server - I'm using the stocks_example and the latest erlang
> client code and attempting to run within erlide.  The error message
> I'm getting is:
> 
> 10> stocks_example:start().
> ** exception error: no match of right hand side value
>                     {error,
>                         {undef,
>                             [{rabbit_net,send,
>                                  [#Port<0.527>,<<65,77,81,80,1,1,8,0>>]},
>                              {amqp_network_connection,do_handshake,1},
>                              {amqp_network_connection,init,1},
>                              {gen_server,init_it,6},
>                              {proc_lib,init_p_do_apply,3}]}}
>      in function  amqp_connection:start_network_internal/2
>      in call from stocks_example:amqp_lifecycle/0
> 
> If anyone could point me in the right direction, I'd appreciate it.

I suspect you're missing the rabbit_common package on your path. If you
build the erlang client then you should find in the dist directory the
rabbit_common directory and .ez. Then:

ERL_LIBS=deps:dist erl -pa ebin

should work:

> ERL_LIBS=deps:dist erl -pa ebin
Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.7.5  (abort with ^G)
1> rr("include/amqp_client.hrl").
['P_access','P_basic','P_channel','P_connection','P_dtx',
 'P_exchange','P_file','P_queue','P_stream','P_test',
 'P_tunnel','P_tx','access.request','access.request_ok',
 amqp_error,amqp_msg,amqp_params,amqqueue,'basic.ack',
 'basic.cancel','basic.cancel_ok','basic.consume',
 'basic.consume_ok','basic.deliver','basic.get',
 'basic.get_empty','basic.get_ok','basic.publish',
 'basic.qos'|...]
2> Conn = amqp_connection:start_network_link(#amqp_params{}).
<0.44.0>

=INFO REPORT==== 7-Apr-2010::19:35:05 ===
Negotiated maximums: (Channel = 0, Frame= 131072, Heartbeat=0)
3> 

It's likely just the ERL_LIBS=deps:dist bit your missing, would be my
guess.

Matthew



From pkirsanov at 38studios.com  Wed Apr  7 19:47:14 2010
From: pkirsanov at 38studios.com (Philippe Kirsanov)
Date: Wed, 7 Apr 2010 14:47:14 -0400
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
	<D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>
	<o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>
Message-ID: <D1AC29FC5C9E644C91BE7C9294BF701B035763F4@gmg-maynard-mai.greenmonstergames.net>

That just a general question of server topology.
For running on cloud we should be able to throw in more machines (e.g.
using RightScale) and server farm should recognize that and use
additional resources to host more queues, maybe even exactly same queues
as exist on other brokers for the sake of scalability; end then
publishers and consumers should load balance those queues on different
brokers.

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: Wednesday, April 07, 2010 14:22
To: Philippe Kirsanov
Cc: Jon Brisbin; RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering

Philippe

In what sense?  I imagine most folks would treat VMs as machines.  But
perhaps the VMware product suite could be helpful too....

alexis



On Tue, Apr 6, 2010 at 5:15 PM, Philippe Kirsanov
<pkirsanov at 38studios.com> wrote:
> Just curious, how do you do load balancing with VMware?
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jon
> Brisbin
> Sent: Monday, April 05, 2010 17:53
> To: RabbitMQ
> Cc: Tomcat Users List
> Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
>
> Not sure there's anyone besides me on both these lists, but I'm
> x-posting just to save time.
>
> I'm currently working on setting up a RabbitMQ-based session cluster
> using my own session manager and store. I had to write my own because
I
> couldn't find anything out there that uses JMS or RabbitMQ to do
session
> clustering (which actually surprised me a little) that had the virtual
> cloud awareness I need. Everything I've read about Tomcat clustering
> uses the Apache Tribes replication, which doesn't work for me under
even
> moderate load testing (maybe I'm just not doing right...I don't know)
or
> the centralized JDBCStore, which introduces a single point of failure.
>
> The basic idea here is to use RabbitMQ as the session clustering
> back-end and have a user's session available to any server currently
> subscribed to the clustering queue with no sticky sessions at all.
This
> (cross your fingers) gives me a very, very scalable clustering
> architecture (my RabbitMQ servers are load-balanced and clustered
using
> VMware vms so I can add capacity at will) that doesn't suffer from the
> single point of failure of a JDBCStore or the multicast limitations of
> Apache Tribes. Sessions are also shared across points of
responsibility,
> too, as a single session object can be passed around from code running
> inside a webapp to code in a command-line client. I wanted my session
> handling to be a first-class virtual cloud citizen, rather than feel
> like I'm shoe-horning existing code into what I want to do.
>
> I'm almost finished with the heavy lifting. I should have a
functioning
> drop-in manager and store this week, which I'll put on my github
> account. What I'd like to know is if there's any interest in the
> community for something like this? If there's no interest, I won't
> bother writing documentation and what-not.
>
> Does this sound like it would interest any other Tomcat/RabbitMQ
users?
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From jon.brisbin at npcinternational.com  Wed Apr  7 20:07:09 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 7 Apr 2010 14:07:09 -0500
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
	<D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>
	<o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>
Message-ID: <A40A05F1-BDE2-478C-A025-5A509AF5020E@npcinternational.com>


On Apr 7, 2010, at 1:21 PM, Alexis Richardson wrote:

> I imagine most folks would treat VMs as machines.  

I used to call my servers "boxes" or "machines". Now I refer to my VMs as "nodes", which I feel more accurately describes them. They are task-oriented instances of Ubuntu Linux (technically-speaking) but functionally, they are of a particular type (e.g. "tcServer instance", "RabbitMQ broker", etc...).

> But perhaps the VMware product suite could be helpful too....

We're using the free stuff, so we don't get much help there. :) My original Nirvana was to have an environment that shrunk and grew based on user demand. When more resources were needed, the system could start additional VMs. That's still sort of my goal, but I've softened on the dynamism, which is still not well-supported in most third-party applications we use. Apache, for instance, is a beast that is anything but cloud-friendly. When my application servers start and stop, I have to update a central "master" node and a cron job keeps the ProxyMember directives up-to-date and restarts Apache if it sees membership change. RabbitMQ needs similar hand-holding because it doesn't seem well-equipped to exist within a dynamic and complex environment where it is only a citizen. I'm tackling this in my vcloud tomcat session manager by having each node keep a list of all active sessions and the node they were on last. 

As more developers adopt cloud topologies, these issues will become more and more critical. I still want to be able to reclaim CPU resources that are being locked up by running more VMs than I really need at any given moment simply because other services can't handle dynamic membership well. I just don't know when I'll be able to achieve that. I just got off a conference call with some industry analysts and we were talking about this very topic.


Jon Brisbin
Portal Webmaster
NPC International, Inc.






From alexis.richardson at gmail.com  Wed Apr  7 22:55:21 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 7 Apr 2010 22:55:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <A40A05F1-BDE2-478C-A025-5A509AF5020E@npcinternational.com>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
	<D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>
	<o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>
	<A40A05F1-BDE2-478C-A025-5A509AF5020E@npcinternational.com>
Message-ID: <h2t167204d21004071455rc9b0b93cifb0e139684a97f46@mail.gmail.com>

Jon

Very interesting.  More below.

On Wed, Apr 7, 2010 at 8:07 PM, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
>
> On Apr 7, 2010, at 1:21 PM, Alexis Richardson wrote:
>
>> I imagine most folks would treat VMs as machines.
>
> I used to call my servers "boxes" or "machines". Now I refer to my VMs as "nodes", which I feel more accurately describes them. They are task-oriented instances of Ubuntu Linux (technically-speaking) but functionally, they are of a particular type (e.g. "tcServer instance", "RabbitMQ broker", etc...).

Understood.


>> But perhaps the VMware product suite could be helpful too....
>
> We're using the free stuff, so we don't get much help there. :) My original Nirvana was to have an environment that shrunk and grew based on user demand. When more resources were needed, the system could start additional VMs. That's still sort of my goal, but I've softened on the dynamism, which is still not well-supported in most third-party applications we use. Apache, for instance, is a beast that is anything but cloud-friendly. When my application servers start and stop, I have to update a central "master" node and a cron job keeps the ProxyMember directives up-to-date and restarts Apache if it sees membership change. RabbitMQ needs similar hand-holding because it doesn't seem well-equipped to exist within a dynamic and complex environment where it is only a citizen. I'm tackling this in my vcloud tomcat session manager by having each node keep a list of all active sessions and the node they were on last.

This is fascinating.  Are you saying, for example, that you would like
RabbitMQ to deal with group membership and discovery in a more
'elastic' way?  What about things like this:
http://cacm.acm.org/blogs/blog-cacm/83396-errors-in-database-systems-eventual-consistency-and-the-cap-theorem/fulltext


> As more developers adopt cloud topologies, these issues will become more and more critical. I still want to be able to reclaim CPU resources that are being locked up by running more VMs than I really need at any given moment simply because other services can't handle dynamic membership well. I just don't know when I'll be able to achieve that. I just got off a conference call with some industry analysts and we were talking about this very topic.

It's hot, see for example:

http://gigaom.com/2009/10/25/the-future-is-big-data-in-the-cloud/
http://kirkwylie.blogspot.com/2010/03/qcon-london-2010.html

alexis


>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>



From colin at cloudeventprocessing.com  Thu Apr  8 03:08:59 2010
From: colin at cloudeventprocessing.com (Colin Clark)
Date: Wed, 07 Apr 2010 21:08:59 -0500
Subject: [rabbitmq-discuss] Erlang Client
In-Reply-To: <20100407183558.GA9634@wellquite.org>
References: <4BBCCE75.3000601@cloudeventprocessing.com>
	<20100407183558.GA9634@wellquite.org>
Message-ID: <4BBD3ABB.6000303@cloudeventprocessing.com>

Thank you everyone for your help - I started from scratch and all is 
fine now.

On 4/7/2010 1:35 PM, Matthew Sackman wrote:
> Hi Colin,
>
> On Wed, Apr 07, 2010 at 01:27:01PM -0500, Colin Clark wrote:
>    
>> I'm having difficulty getting the Erlang client to connect to a
>> rabbitmq server - I'm using the stocks_example and the latest erlang
>> client code and attempting to run within erlide.  The error message
>> I'm getting is:
>>
>> 10>  stocks_example:start().
>> ** exception error: no match of right hand side value
>>                      {error,
>>                          {undef,
>>                              [{rabbit_net,send,
>>                                   [#Port<0.527>,<<65,77,81,80,1,1,8,0>>]},
>>                               {amqp_network_connection,do_handshake,1},
>>                               {amqp_network_connection,init,1},
>>                               {gen_server,init_it,6},
>>                               {proc_lib,init_p_do_apply,3}]}}
>>       in function  amqp_connection:start_network_internal/2
>>       in call from stocks_example:amqp_lifecycle/0
>>
>> If anyone could point me in the right direction, I'd appreciate it.
>>      
> I suspect you're missing the rabbit_common package on your path. If you
> build the erlang client then you should find in the dist directory the
> rabbit_common directory and .ez. Then:
>
> ERL_LIBS=deps:dist erl -pa ebin
>
> should work:
>
>    
>> ERL_LIBS=deps:dist erl -pa ebin
>>      
> Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:0] [hipe] [kernel-poll:false]
>
> Eshell V5.7.5  (abort with ^G)
> 1>  rr("include/amqp_client.hrl").
> ['P_access','P_basic','P_channel','P_connection','P_dtx',
>   'P_exchange','P_file','P_queue','P_stream','P_test',
>   'P_tunnel','P_tx','access.request','access.request_ok',
>   amqp_error,amqp_msg,amqp_params,amqqueue,'basic.ack',
>   'basic.cancel','basic.cancel_ok','basic.consume',
>   'basic.consume_ok','basic.deliver','basic.get',
>   'basic.get_empty','basic.get_ok','basic.publish',
>   'basic.qos'|...]
> 2>  Conn = amqp_connection:start_network_link(#amqp_params{}).
> <0.44.0>
>
> =INFO REPORT==== 7-Apr-2010::19:35:05 ===
> Negotiated maximums: (Channel = 0, Frame= 131072, Heartbeat=0)
> 3>
>
> It's likely just the ERL_LIBS=deps:dist bit your missing, would be my
> guess.
>
> Matthew
>    

-- 
Colin
+1 701 659 0115 cell
+1 701 212 4314 office
http://blog.cloudeventprocessing.com
http://twitter.com/EventCloudPro

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100407/ea19925f/attachment.htm 

From matthew at lshift.net  Thu Apr  8 12:07:17 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 8 Apr 2010 12:07:17 +0100
Subject: [rabbitmq-discuss] rabbit cluster keeps crashing
In-Reply-To: <28157770.post@talk.nabble.com>
References: <28023134.post@talk.nabble.com>
	<20100402152411.GE11613@wellquite.org>
	<28157770.post@talk.nabble.com>
Message-ID: <20100408110717.GF29149@mrnibble.lshift.net>

Hi,

On Tue, Apr 06, 2010 at 02:29:48PM -0700, LoOoD wrote:
> Our servers are connected to gige switches and different subnets. The
> switches and routers that the servers are connected to are using less then
> 10% of their capacity. We don't see any other apps having any sort of
> network issues.  We send the rabbit cluster about 70 msgs/sec.

Ok, it's definitely not the network then ;)

> Another symptom we've noticed is the beam.smp process using 100% cpu. Is
> there any thing we can do, to help track down the exact cause? Some sort of
> increase debugging level? We're willing to do anything to figure out what
> going on and stabilize it.

Hmm, that's interesting. It suggests rabbit is very busy. Does this
happen before the nodedown messages start happening - if Rabbit is
sufficiently busy then it could be failing to schedule the net ticktimes
frequently enough.

70 msgs/sec is very low - Rabbit running on a decades-old PC will be
able to manage that. Thus what led you to setting up the cluster in the
first place and what topology / use cases do you have?

Matthew



From mikeb at lshift.net  Thu Apr  8 13:16:27 2010
From: mikeb at lshift.net (Michael Bridgen)
Date: Thu, 08 Apr 2010 13:16:27 +0100
Subject: [rabbitmq-discuss] New User: Questions and Comments
In-Reply-To: <6cf1763a1003110607p13c03fct5ec0fe7a69118f72@mail.gmail.com>
References: <6cf1763a1003110607p13c03fct5ec0fe7a69118f72@mail.gmail.com>
Message-ID: <4BBDC91B.5000608@lshift.net>

> Hello All!  I'm a potential new user of RabbitMQ and am also new to
> AMQP and messaging in general.

Hi Cory, and welcome to the warren!

To the comments and questions:

> RabbitMQ is easy to set up, requires less configuration and works well
> right out of the box.  It's also available in our distribution of
> choice (Debian) which makes things easier.  Thanks!

Painless set-up-and-get-going is a major driver for us, so it's good to 
hear it was easy for you.

> * Cluster Setup *
> 
> Setting up a cluster works great but the status of a node as a disk
> node is confusing.  This was exacerbated by problems I was having with
> my client library not setting the delivery mode.  Regardless, I don't
> see a way to determine (from rabbitmqctl) if a node is a disk node or
> memory node.  It's therefore difficult to tell if I've set things up
> correctly.

Just to be clear, the flavour of a node in a cluster has no bearing on 
delivery mode -- persistent messages are always persisted.  What's being 
saved to disk in a disk node is durable exchange, queue and binding 
configuration and cluster configuration.

Yes, it would be better if "rabbitmqctl status" listed whether the 
running nodes were disk or RAM nodes, at least for verifying 
configuration, as you say.  I've logged a bug here for it.

> Also, the method for specifying that the node should be a disk node is
> confusing.  And I quote:
> 
> "we list rabbit at rabbit3 as a node in the cluster command in order to
> turn it into a disk rather than ram node"

Yes it is, and it doesn't help that both "rabbitmqctl" and "man 
rabbitmqctl" give slightly the wrong syntax (we fixed that just now).

> I still don't grok that.  It sounds like when specifying the other
> nodes this node should talk to, if we specify ourselves then it
> becomes a disk node?

Yes that's exactly it.  "man rabbitmqctl" does give a better account 
than the web site guide, but it's still rather obscure.

> I'm not sure if there's some cultural/technical
> reason for this type of configuration but it is completely lost on me.
>  I'd be much more likely understand something like
> 
> rabbitmqctl cluster rabbit at rabbit1 rabbit at rabbit3[type="disk"]
> 
> or whatever is easiest to parse.

Well, the idea is that at the point you are issuing the command you can 
specify only the diskiness of the local node.  So perhaps better would 
be a switch:

rabbitmqctl cluster [--disk | -D] <clusternode> ...

(bug logged for this too)

> * Cluster Capabilities *
> [...]
> When I originally read this I said "great!" and moved right down the
> page to setup my cluster.  I was not really aware that this would
> happen:
>  * Create queue A on node 1
>  * Send messages that are routed to queue A
>  * Pull the plug on node A
>  * Node 2 (if asked) says queue A doesn't exist
> 
> I realized afterward that this was what the earlier quote was trying
> to tell me.  I'm not sure how to solve it in language.  There's a thin
> line between warning users of shortcoming and being an alarmist.

Indeed.  The single most common misunderstanding about clustering that 
comes up is that it gives full redundancy, whereas it's for scalability 
(basically, being able to have more processors accepting, routing, and 
delivering messages).  So the guide should at least say that up-front.

There is an HA guide on its way -- consider your voice added to those 
willing it onward.

> I imagine that one could watch for the error saying that the queue
> doesn't exist and retry later.  But how does one disambiguate this
> from the unlikely occurrence that the queue has somehow disappeared?
> Perhaps if I had asked node 2 about queue A it could've told me that
> is was unavailable rather than non-existant?

Yes, there's no difference, observable by a client, between the queue 
being deleted by another client and it disappearing because it's located 
at a downed node.  There's not really a mechanism in AMQP to describe 
unavailability as such; and anyway, in an ideal world downing a node 
wouldn't have that effect.

> * Patterns *
> 
> I've watched the RabbitMQ Google tech talk opened by Alexis and would
> love to see some recipes for setting up RabbitMQ to satisfy the
> various patterns outlined.  Things like Service Bus, Client Server,
> etc.  Having that as a guide would be great!

http://www.rabbitmq.com/how.html links to blog posts and so on with 
plenty of examples; in particular, 
http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/ seems to be 
popular as a primer.

I don't there's a single place with common recipes (e.g., on the 
RabbitMQ site) -- that's a great suggestion.

> * Configuration *
> 
> Is it possible to specify exchange/queue/binding creation in
> configuration?  If not, I'm going to need to write a client
> application that connects and establishes them for me.  That seems
> clunky.

There's no AMQP-specified way of doing this, but you could look at BQL 
as a way of maintaining a repeatable configuration:
http://www.rabbitmq.com/rabbitmq-bql.html

> I hope that me pointing out a mole or two on your baby doesn't sound
> like I'm implying that the whole thing is ugly!  Users rarely realize
> that the BEST time to make comments about a complex system such as
> this is when they are most confused.

For sure, and thank you for yours, they have indeed been a help.

Regards,
Michael




From magnus at alum.mit.edu  Thu Apr  8 13:53:26 2010
From: magnus at alum.mit.edu (Daniel Risacher)
Date: Thu, 8 Apr 2010 08:53:26 -0400
Subject: [rabbitmq-discuss] convention for "more/last message" pattern
Message-ID: <s2la3ff00ac1004080553gbbbd1d3crb6be7e9bb7162441@mail.gmail.com>

It seems like a not-uncommon design pattern to send a data set (of
some kind) as a series of sequential messages, where each item in the
set is a separate message, and with a flag to indicate that there are
more messages coming, or that the message represents the last entry.
Is there a recommended way of implementing this pattern in AMQP?  i.e.
is there a flag to set on the message, or is it expected that such
information should be in the payload?

I thought about kludging it into the reply-to field, but that seems too ugly.



From aleksey at yeschenko.com  Thu Apr  8 14:52:55 2010
From: aleksey at yeschenko.com (Aleksey Yeschenko)
Date: Thu, 8 Apr 2010 16:52:55 +0300
Subject: [rabbitmq-discuss] convention for "more/last message" pattern
In-Reply-To: <s2la3ff00ac1004080553gbbbd1d3crb6be7e9bb7162441@mail.gmail.com>
References: <s2la3ff00ac1004080553gbbbd1d3crb6be7e9bb7162441@mail.gmail.com>
Message-ID: <i2h5c6f8a091004080652x9a8f1162qfa544958b276e57f@mail.gmail.com>

You can use basic.headers field to store any attributes you need.

2010/4/8 Daniel Risacher <magnus at alum.mit.edu>:
> It seems like a not-uncommon design pattern to send a data set (of
> some kind) as a series of sequential messages, where each item in the
> set is a separate message, and with a flag to indicate that there are
> more messages coming, or that the message represents the last entry.
> Is there a recommended way of implementing this pattern in AMQP? ?i.e.
> is there a flag to set on the message, or is it expected that such
> information should be in the payload?
>
> I thought about kludging it into the reply-to field, but that seems too ugly.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From jon.brisbin at npcinternational.com  Thu Apr  8 15:30:41 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 8 Apr 2010 09:30:41 -0500
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <h2t167204d21004071455rc9b0b93cifb0e139684a97f46@mail.gmail.com>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
	<D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>
	<o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>
	<A40A05F1-BDE2-478C-A025-5A509AF5020E@npcinternational.com>
	<h2t167204d21004071455rc9b0b93cifb0e139684a97f46@mail.gmail.com>
Message-ID: <76C49D19-36F3-4A55-AA66-C41E744AE5E7@npcinternational.com>


On Apr 7, 2010, at 4:55 PM, Alexis Richardson wrote:

>>> But perhaps the VMware product suite could be helpful too....
>> 
>> We're using the free stuff, so we don't get much help there. :) My original Nirvana was to have an environment that shrunk and grew based on user demand. When more resources were needed, the system could start additional VMs. That's still sort of my goal, but I've softened on the dynamism, which is still not well-supported in most third-party applications we use. Apache, for instance, is a beast that is anything but cloud-friendly. When my application servers start and stop, I have to update a central "master" node and a cron job keeps the ProxyMember directives up-to-date and restarts Apache if it sees membership change. RabbitMQ needs similar hand-holding because it doesn't seem well-equipped to exist within a dynamic and complex environment where it is only a citizen. I'm tackling this in my vcloud tomcat session manager by having each node keep a list of all active sessions and the node they were on last.
> 
> This is fascinating.  Are you saying, for example, that you would like
> RabbitMQ to deal with group membership and discovery in a more
> 'elastic' way?  What about things like this:
> http://cacm.acm.org/blogs/blog-cacm/83396-errors-in-database-systems-eventual-consistency-and-the-cap-theorem/fulltext

I think elasticity is absolutely essential to new software that has any desire to operate inside a "cloud" (however loosely-defined) environment. 

There's no easy answer, as that blog post pointed out. I'm trying to address issues like that myself by keeping an internal membership list that are pointers to the real data. If one were to apply this to RabbitMQ, it would look something like:

1. Broker starts and registers itself with central service registry (I'm using dynamic DNS, so as soon as RabbitMQ starts, it's accessible via internal hostname mq.cloud.npci.com).
2. Broker attaches to another random broker and issues an "add me and give me the current state" message to a fanout queue (which one depends on what "group" its in).
3. Broker receives list of currently active brokers/consumers, which now includes itself.
4. Client connects to random broker and publishes a message.
5. Broker delivers message to local consumers, if any exist, and checks the membership list to see if any other brokers list consumers for that queue; if so, it forwards the message to that broker (maybe dropping it from the list if its inaccessible), who maybe repeats the process (if membership has changed).

This is basically what I'm doing with sessions. Each node knows all the available sessions throughout the cloud and where the actual object resides. If it doesn't see a session locally, but it shows up in the list of cloud sessions, it tries to load the session from the node listed in the membership map. My idea is to have one of the replicators (who are eavesdropping) always respond, in addition to the node, so that a response is always received by the requestor, even if the node has gone down before every other node realizes it and has had a chance to update membership.

Jon Brisbin
Portal Webmaster
NPC International, Inc.



From videlalvaro at gmail.com  Fri Apr  9 04:29:32 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 9 Apr 2010 11:29:32 +0800
Subject: [rabbitmq-discuss] Question about Queue Bind/Unbind
Message-ID: <4401D3E0-24A2-4436-A185-BEE3BEBECDD4@gmail.com>

Hi,

I'm writing some application using a topic exchange. 

Every time I start a consumer, it performs the following steps:

- access_request
- queue_declare
- exchange_declare
- queue_bind
- basic_consume

Lets say the topics are:

usa.news
usa.weather

So I launch the app and I specify that the queue "usa" will use this routing key: "usa.news"

So far so good, but when I stop the app and then I say that the queue "usa" must be bound by the "usa.weather" routing key, nothing happens. the binding is not changed.

Then I read the code of rabbit_exchange:add_binding/4 and it seems that it doesn't support overwriting the binding. 

Is it OK what I'm trying to do or should I always unbind the queue and then bind it again with the new routing key?

Thanks,

Alvaro


From tonyg at lshift.net  Fri Apr  9 05:56:00 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 09 Apr 2010 16:56:00 +1200
Subject: [rabbitmq-discuss] Question about Queue Bind/Unbind
In-Reply-To: <4401D3E0-24A2-4436-A185-BEE3BEBECDD4@gmail.com>
References: <4401D3E0-24A2-4436-A185-BEE3BEBECDD4@gmail.com>
Message-ID: <4BBEB360.4040900@lshift.net>

Hi Alvaro,

Alvaro Videla wrote:
> So far so good, but when I stop the app and then I say that the queue
> "usa" must be bound by the "usa.weather" routing key, nothing
> happens. the binding is not changed.
> 
> Then I read the code of rabbit_exchange:add_binding/4 and it seems
> that it doesn't support overwriting the binding.

Queue.bind won't alter a binding, but it will add a new binding. It's
also idempotent, so two or more queue.binds with identical arguments
will act the same as just one.

So the following:

 - queue.declare('usa')
 - queue.bind(binding_key = 'usa.news', queue = 'usa')
 - queue.bind(binding_key = 'usa.weather', queue = 'usa')

will (should!) result in *two* bindings. The queue should then receive
messages published to the exchange with either usa.news or usa.weather.

You could also use 'usa.*', if you like, to pick up all USAish messages
with a single binding.

Tony



From videlalvaro at gmail.com  Fri Apr  9 05:59:23 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 9 Apr 2010 12:59:23 +0800
Subject: [rabbitmq-discuss] Question about Queue Bind/Unbind
In-Reply-To: <4BBEB360.4040900@lshift.net>
References: <4401D3E0-24A2-4436-A185-BEE3BEBECDD4@gmail.com>
	<4BBEB360.4040900@lshift.net>
Message-ID: <7B483FF6-D47E-4C30-8B27-8388154C46B7@gmail.com>

Hi Tony,

Oh, OK.

So basically to stop receiving the other notifications I will have to unbind the queue from the unwanted binding and then just keep one binding, right?

Thanks for clarifying this.

Alvaro


On Apr 9, 2010, at 12:56 PM, Tony Garnock-Jones wrote:

> Hi Alvaro,
> 
> Alvaro Videla wrote:
>> So far so good, but when I stop the app and then I say that the queue
>> "usa" must be bound by the "usa.weather" routing key, nothing
>> happens. the binding is not changed.
>> 
>> Then I read the code of rabbit_exchange:add_binding/4 and it seems
>> that it doesn't support overwriting the binding.
> 
> Queue.bind won't alter a binding, but it will add a new binding. It's
> also idempotent, so two or more queue.binds with identical arguments
> will act the same as just one.
> 
> So the following:
> 
> - queue.declare('usa')
> - queue.bind(binding_key = 'usa.news', queue = 'usa')
> - queue.bind(binding_key = 'usa.weather', queue = 'usa')
> 
> will (should!) result in *two* bindings. The queue should then receive
> messages published to the exchange with either usa.news or usa.weather.
> 
> You could also use 'usa.*', if you like, to pick up all USAish messages
> with a single binding.
> 
> Tony




From alexis.richardson at gmail.com  Fri Apr  9 12:21:56 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 9 Apr 2010 12:21:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <76C49D19-36F3-4A55-AA66-C41E744AE5E7@npcinternational.com>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
	<D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>
	<o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>
	<A40A05F1-BDE2-478C-A025-5A509AF5020E@npcinternational.com>
	<h2t167204d21004071455rc9b0b93cifb0e139684a97f46@mail.gmail.com>
	<76C49D19-36F3-4A55-AA66-C41E744AE5E7@npcinternational.com>
Message-ID: <t2h167204d21004090421s4e986d24g524cf8e8c626a021@mail.gmail.com>

Jon

Sorry to topline you, but I want to show you something similar to what
you describe.  Let's compare notes.

http://www.oceanobservatories.org/spaces/download/attachments/7045394/AMQP-ScalableFederation_OOI-PrototypeReport-20100105.pdf

This describes work by the RabbitMQ team to enable something a bit
like your (1-5) below.  What do you think?

alexis


On Thu, Apr 8, 2010 at 3:30 PM, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
>
> On Apr 7, 2010, at 4:55 PM, Alexis Richardson wrote:
>
>>>> But perhaps the VMware product suite could be helpful too....
>>>
>>> We're using the free stuff, so we don't get much help there. :) My original Nirvana was to have an environment that shrunk and grew based on user demand. When more resources were needed, the system could start additional VMs. That's still sort of my goal, but I've softened on the dynamism, which is still not well-supported in most third-party applications we use. Apache, for instance, is a beast that is anything but cloud-friendly. When my application servers start and stop, I have to update a central "master" node and a cron job keeps the ProxyMember directives up-to-date and restarts Apache if it sees membership change. RabbitMQ needs similar hand-holding because it doesn't seem well-equipped to exist within a dynamic and complex environment where it is only a citizen. I'm tackling this in my vcloud tomcat session manager by having each node keep a list of all active sessions and the node they were on last.
>>
>> This is fascinating. ?Are you saying, for example, that you would like
>> RabbitMQ to deal with group membership and discovery in a more
>> 'elastic' way? ?What about things like this:
>> http://cacm.acm.org/blogs/blog-cacm/83396-errors-in-database-systems-eventual-consistency-and-the-cap-theorem/fulltext
>
> I think elasticity is absolutely essential to new software that has any desire to operate inside a "cloud" (however loosely-defined) environment.
>
> There's no easy answer, as that blog post pointed out. I'm trying to address issues like that myself by keeping an internal membership list that are pointers to the real data. If one were to apply this to RabbitMQ, it would look something like:
>
> 1. Broker starts and registers itself with central service registry (I'm using dynamic DNS, so as soon as RabbitMQ starts, it's accessible via internal hostname mq.cloud.npci.com).
> 2. Broker attaches to another random broker and issues an "add me and give me the current state" message to a fanout queue (which one depends on what "group" its in).
> 3. Broker receives list of currently active brokers/consumers, which now includes itself.
> 4. Client connects to random broker and publishes a message.
> 5. Broker delivers message to local consumers, if any exist, and checks the membership list to see if any other brokers list consumers for that queue; if so, it forwards the message to that broker (maybe dropping it from the list if its inaccessible), who maybe repeats the process (if membership has changed).
>
> This is basically what I'm doing with sessions. Each node knows all the available sessions throughout the cloud and where the actual object resides. If it doesn't see a session locally, but it shows up in the list of cloud sessions, it tries to load the session from the node listed in the membership map. My idea is to have one of the replicators (who are eavesdropping) always respond, in addition to the node, so that a response is always received by the requestor, even if the node has gone down before every other node realizes it and has had a chance to update membership.
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>



From jon.brisbin at npcinternational.com  Fri Apr  9 15:45:39 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 9 Apr 2010 09:45:39 -0500
Subject: [rabbitmq-discuss] RabbitMQ-based vcloud session clustering
In-Reply-To: <t2h167204d21004090421s4e986d24g524cf8e8c626a021@mail.gmail.com>
References: <F654D607-285F-4923-9629-E1A23C9E818F@npcinternational.com>
	<D1AC29FC5C9E644C91BE7C9294BF701B03575DDE@gmg-maynard-mai.greenmonstergames.net>
	<o2y167204d21004071121q37589693w7adf60154e27326b@mail.gmail.com>
	<A40A05F1-BDE2-478C-A025-5A509AF5020E@npcinternational.com>
	<h2t167204d21004071455rc9b0b93cifb0e139684a97f46@mail.gmail.com>
	<76C49D19-36F3-4A55-AA66-C41E744AE5E7@npcinternational.com>
	<t2h167204d21004090421s4e986d24g524cf8e8c626a021@mail.gmail.com>
Message-ID: <1DC32F5A-B65E-470C-9277-BE1F3CC13483@npcinternational.com>


On Apr 9, 2010, at 6:21 AM, Alexis Richardson wrote:

> Jon
> 
> Sorry to topline you, but I want to show you something similar to what
> you describe.  Let's compare notes.
> 
> http://www.oceanobservatories.org/spaces/download/attachments/7045394/AMQP-ScalableFederation_OOI-PrototypeReport-20100105.pdf
> 
> This describes work by the RabbitMQ team to enable something a bit
> like your (1-5) below.  What do you think?
> 

I'm glad to hear about 0-9-1 compatibility, for sure! We've been fighting this 0-8/0-9 thing with our C++ developers for a little bit now, trying to get something that will work for them (they're still using VS 2003). I'm going to try downloading the source and setting up an 0-9-1 server for them to play around with.

As for the cloud stuff...it sounds like you're farther down the road than I am. :) Since I'm approaching this operationally instead of academically (or even strategically ;), I don't know that I could help much with the theory. I was thinking out load and basically transliterating what I'm doing in other areas to RabbitMQ (minus the store-and-forward stuff...that was improv ;). This definitely puts some meat on the bones of the problems I'm facing in implementing applications that use these federated services.

But in the end, I'm going to have to write my own software to approximate these more long-term solutions because of the demands of an operational, production environment. I'm working on a blog post to try and lay out my thinking on this. I think I need a couple more cups of coffee to properly digest this... :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.



> alexis
> 
> 
> On Thu, Apr 8, 2010 at 3:30 PM, Jon Brisbin
> <jon.brisbin at npcinternational.com> wrote:
>> 
>> On Apr 7, 2010, at 4:55 PM, Alexis Richardson wrote:
>> 
>>>>> But perhaps the VMware product suite could be helpful too....
>>>> 
>>>> We're using the free stuff, so we don't get much help there. :) My original Nirvana was to have an environment that shrunk and grew based on user demand. When more resources were needed, the system could start additional VMs. That's still sort of my goal, but I've softened on the dynamism, which is still not well-supported in most third-party applications we use. Apache, for instance, is a beast that is anything but cloud-friendly. When my application servers start and stop, I have to update a central "master" node and a cron job keeps the ProxyMember directives up-to-date and restarts Apache if it sees membership change. RabbitMQ needs similar hand-holding because it doesn't seem well-equipped to exist within a dynamic and complex environment where it is only a citizen. I'm tackling this in my vcloud tomcat session manager by having each node keep a list of all active sessions and the node they were on last.
>>> 
>>> This is fascinating.  Are you saying, for example, that you would like
>>> RabbitMQ to deal with group membership and discovery in a more
>>> 'elastic' way?  What about things like this:
>>> http://cacm.acm.org/blogs/blog-cacm/83396-errors-in-database-systems-eventual-consistency-and-the-cap-theorem/fulltext
>> 
>> I think elasticity is absolutely essential to new software that has any desire to operate inside a "cloud" (however loosely-defined) environment.
>> 
>> There's no easy answer, as that blog post pointed out. I'm trying to address issues like that myself by keeping an internal membership list that are pointers to the real data. If one were to apply this to RabbitMQ, it would look something like:
>> 
>> 1. Broker starts and registers itself with central service registry (I'm using dynamic DNS, so as soon as RabbitMQ starts, it's accessible via internal hostname mq.cloud.npci.com).
>> 2. Broker attaches to another random broker and issues an "add me and give me the current state" message to a fanout queue (which one depends on what "group" its in).
>> 3. Broker receives list of currently active brokers/consumers, which now includes itself.
>> 4. Client connects to random broker and publishes a message.
>> 5. Broker delivers message to local consumers, if any exist, and checks the membership list to see if any other brokers list consumers for that queue; if so, it forwards the message to that broker (maybe dropping it from the list if its inaccessible), who maybe repeats the process (if membership has changed).
>> 
>> This is basically what I'm doing with sessions. Each node knows all the available sessions throughout the cloud and where the actual object resides. If it doesn't see a session locally, but it shows up in the list of cloud sessions, it tries to load the session from the node listed in the membership map. My idea is to have one of the replicators (who are eavesdropping) always respond, in addition to the node, so that a response is always received by the requestor, even if the node has gone down before every other node realizes it and has had a chance to update membership.
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 




From jon.brisbin at npcinternational.com  Fri Apr  9 18:32:23 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 9 Apr 2010 12:32:23 -0500
Subject: [rabbitmq-discuss] RabbitMQ-backed tomcat cloud session manager
Message-ID: <94D6559A-FC76-4AD7-BE6B-5C4E29112268@npcinternational.com>

I updated a new virtual cloud-related blog I started this week with a post describing how I approach the problem of maintaining active tomcat sessions within a "cloud" architecture of tcServer (tomcat 6.0) instances.

I tried to lay out, in excruciating detail, my thoughts on distributed membership and how I approached that particular sticky wicket. 

I personally think this has some potential to get traction in the community. I hope so. I'd like to get some help on some of this stuff since I'm basically a one-man-band here as far as cloud computing goes.

Non-multicast Tomcat Session Clustering with RabbitMQ:
http://jbrisbin.wordpress.com/

Jon Brisbin
Portal Webmaster
NPC International, Inc.






From tonyg at lshift.net  Fri Apr  9 20:29:17 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 10 Apr 2010 07:29:17 +1200
Subject: [rabbitmq-discuss] Question about Queue Bind/Unbind
In-Reply-To: <7B483FF6-D47E-4C30-8B27-8388154C46B7@gmail.com>
References: <4401D3E0-24A2-4436-A185-BEE3BEBECDD4@gmail.com>
	<4BBEB360.4040900@lshift.net>
	<7B483FF6-D47E-4C30-8B27-8388154C46B7@gmail.com>
Message-ID: <4BBF800D.7050506@lshift.net>

Alvaro Videla wrote:
> So basically to stop receiving the other notifications I will have to
> unbind the queue from the unwanted binding and then just keep one
> binding, right?

That's right.

Tony




From pdezwart at rubiconproject.com  Sun Apr 11 18:47:42 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Sun, 11 Apr 2010 10:47:42 -0700
Subject: [rabbitmq-discuss] User/Password maximum lengths
Message-ID: <C7E7594E.8B24%pdezwart@rubiconproject.com>

Can someone let me know what the maximum allowed length of the username,
password, queue name and exchange name can be? A cursory search of the AMQP
spec yielded nothing.

Thanks,
Pieter

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100411/c12cb211/attachment.htm 

From mjs at fix.net  Sun Apr 11 19:17:03 2010
From: mjs at fix.net (Mark Steckel)
Date: Sun, 11 Apr 2010 11:17:03 -0700 (PDT)
Subject: [rabbitmq-discuss] New User: Questions and Comments
In-Reply-To: <4BBDC91B.5000608@lshift.net>
References: <6cf1763a1003110607p13c03fct5ec0fe7a69118f72@mail.gmail.com> 
	<4BBDC91B.5000608@lshift.net>
Message-ID: <2aa20a0a-cad0-4033-b5a0-0c672610cce4@j21g2000yqh.googlegroups.com>

Hi,

I am new to RabbitMQ as well. I've been reading about it for a while
but started my first RabbitMQ server just yesterday. So far I'm very
impressed.

On Apr 8, 8:16 am, Michael Bridgen <mi... at lshift.net> wrote:
> > * Cluster Capabilities *
> > [...]
> > When I originally read this I said "great!" and moved right down the
> > page to setup my cluster.  I was not really aware that this would
> > happen:
> >  * Create queue A on node 1
> >  * Send messages that are routed to queue A
> >  * Pull the plug on node A
> >  * Node 2 (if asked) says queue A doesn't exist
>
> > I realized afterward that this was what the earlier quote was trying
> > to tell me.  I'm not sure how to solve it in language.  There's a thin
> > line between warning users of shortcoming and being an alarmist.
>
> Indeed.  The single most common misunderstanding about clustering that
> comes up is that it gives full redundancy, whereas it's for scalability
> (basically, being able to have more processors accepting, routing, and
> delivering messages).  So the guide should at least say that up-front.

Ahh, this is something I've been trying to understand as well...

Is it the case that a RabbitMQ cluster a) allows a queue to be
accessed from every node in the cluster, but b) the queue and the
messages it contains only reside in/on a single node?

> There is an HA guide on its way

I'm definitely interested in reading this.

Best
Mark



From jstabile1 at vmware.com  Sun Apr 11 19:52:47 2010
From: jstabile1 at vmware.com (Jim Stabile)
Date: Sun, 11 Apr 2010 11:52:47 -0700 (PDT)
Subject: [rabbitmq-discuss] conceptual question
In-Reply-To: <4A607B6F.1090700@lshift.net>
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>
	<167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>
	<897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>
	<167204d20907031147m6ea1d8f8ke2248f3bf084e238@mail.gmail.com>
	<4A607B6F.1090700@lshift.net>
Message-ID: <28210868.post@talk.nabble.com>


Hi,

What is the current status of this?  I want to use RabbitMQ across a WAN. 
One publisher connected to a RabbitMQ server and a set of subscribers
connected to another RabbitMQ server (both servers in a cluster) over a WAN. 
When a publish occurs, I want only 1 message to be sent from the publisher's
server to the subscriber's server (over the WAN) and then the fan-out
happens to all subscribers (last-mile fan-out).  I'm looking at RabbitMQ
1.7.2.  Has this been addressed?  If not, is there a timeframe?  

Jim 



Matthias Radestock-2 wrote:
> 
> Alexis Richardson wrote:
>> I am fairly sure that....
>> 
>> On Fri, Jul 3, 2009 at 7:38 PM, <Ken.Anderson at sungard.com> wrote:
>>> Sorry to interject here, but I'm curious as to the answer as well.
>>> I'm assuming the question is related to performance - does the
>>> message make on hop between nodes, and then get distributed,
>> 
>> Yes.
> 
> Actually, the answer, at present, is 'no', though it used to be 'yes'.
> We disabled the optimisation which sends just one copy of the message to
> a node on which multiple destination queues reside, since it broke some
> of AMQP's ordering guarantees. A fix for that, allowing us to re-enable
> the optimisation, is on our todo list.
> 
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/conceptual-question-tp24291315p28210868.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at gmail.com  Sun Apr 11 20:23:08 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 11 Apr 2010 20:23:08 +0100
Subject: [rabbitmq-discuss] conceptual question
In-Reply-To: <28210868.post@talk.nabble.com>
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>
	<167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>
	<897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>
	<167204d20907031147m6ea1d8f8ke2248f3bf084e238@mail.gmail.com>
	<4A607B6F.1090700@lshift.net> <28210868.post@talk.nabble.com>
Message-ID: <t2m167204d21004111223g133fffa1w1ecbfa3aa0d4d7c1@mail.gmail.com>

Jim

Have you looked at the Shovel plugin?  That may be a better fit for
your needs in this case.

alexis


On Sun, Apr 11, 2010 at 7:52 PM, Jim Stabile <jstabile1 at vmware.com> wrote:
>
> Hi,
>
> What is the current status of this? ?I want to use RabbitMQ across a WAN.
> One publisher connected to a RabbitMQ server and a set of subscribers
> connected to another RabbitMQ server (both servers in a cluster) over a WAN.
> When a publish occurs, I want only 1 message to be sent from the publisher's
> server to the subscriber's server (over the WAN) and then the fan-out
> happens to all subscribers (last-mile fan-out). ?I'm looking at RabbitMQ
> 1.7.2. ?Has this been addressed? ?If not, is there a timeframe?
>
> Jim
>
>
>
> Matthias Radestock-2 wrote:
>>
>> Alexis Richardson wrote:
>>> I am fairly sure that....
>>>
>>> On Fri, Jul 3, 2009 at 7:38 PM, <Ken.Anderson at sungard.com> wrote:
>>>> Sorry to interject here, but I'm curious as to the answer as well.
>>>> I'm assuming the question is related to performance - does the
>>>> message make on hop between nodes, and then get distributed,
>>>
>>> Yes.
>>
>> Actually, the answer, at present, is 'no', though it used to be 'yes'.
>> We disabled the optimisation which sends just one copy of the message to
>> a node on which multiple destination queues reside, since it broke some
>> of AMQP's ordering guarantees. A fix for that, allowing us to re-enable
>> the optimisation, is on our todo list.
>>
>>
>> Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://old.nabble.com/conceptual-question-tp24291315p28210868.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthew at lshift.net  Sun Apr 11 20:49:56 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 11 Apr 2010 20:49:56 +0100
Subject: [rabbitmq-discuss] conceptual question
In-Reply-To: <28210868.post@talk.nabble.com>
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>
	<167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>
	<897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>
	<167204d20907031147m6ea1d8f8ke2248f3bf084e238@mail.gmail.com>
	<4A607B6F.1090700@lshift.net> <28210868.post@talk.nabble.com>
Message-ID: <20100411194955.GA19736@wellquite.org>

Hi Jim,

On Sun, Apr 11, 2010 at 11:52:47AM -0700, Jim Stabile wrote:
> What is the current status of this?  I want to use RabbitMQ across a WAN. 
> One publisher connected to a RabbitMQ server and a set of subscribers
> connected to another RabbitMQ server (both servers in a cluster) over a WAN. 
> When a publish occurs, I want only 1 message to be sent from the publisher's
> server to the subscriber's server (over the WAN) and then the fan-out
> happens to all subscribers (last-mile fan-out).  I'm looking at RabbitMQ
> 1.7.2.  Has this been addressed?  If not, is there a timeframe?  

In 1.7.2, no this is not addressed.

The fanout will always happen locally, because it pretty much has to be
atomic, and there will be many potential "gotchas" if it happens once
local to the publisher, and then once again on destination nodes -
changes to queues and exchanges in between those events would be
problematic.

However, we have code in development that after doing the fanout local
to the publisher then groups together publishes to multiple queues on
remote nodes, then forwarding the message once, with annotation to say
which queues it should go to on the remote node. This code is nearly
finished and will very likely appear in the next release of Rabbit.

Simon is developing this code and hopefully will be able to say more as
it gets finished.

Matthew



From tonyg at lshift.net  Sun Apr 11 22:18:57 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 12 Apr 2010 09:18:57 +1200
Subject: [rabbitmq-discuss] User/Password maximum lengths
In-Reply-To: <C7E7594E.8B24%pdezwart@rubiconproject.com>
References: <C7E7594E.8B24%pdezwart@rubiconproject.com>
Message-ID: <4BC23CC1.1010209@lshift.net>

Hi Pieter,

Pieter de Zwart wrote:
> Can someone let me know what the maximum allowed length of the username,
> password, queue name and exchange name can be? A cursory search of the
> AMQP spec yielded nothing.

Queue names and exchange names have easy answers: they're limited to 255
*bytes* long, each. (Not characters, encoded bytes.) This stuff is given in the
XML part of the specification rather than in the main PDF, and it can be a
little difficult to piece together the relevant fragments to discover facts
like these.

Usernames and passwords will take a little more text to explain.

All authentication data is sent on the wire as a longstring, which has a
maximum length limit of 2^32-1. However, the longstring has to travel in
an AMQP method frame *before* a maximum frame size has been negotiated,
meaning that while servers *may* accept authenticating frames longer than 4096
bytes, they are not required to do so. RabbitMQ doesn't limit frames to 4096
bytes here, so the full 2^32-1 bytes are in theory available to you.

So if you're thinking about AMQP generally, rather than RabbitMQ in particular,
the "response" longstring in the connection.start_ok method that carries
username and password information should be thought of as limited to roughly
3800 bytes, given a guess at the number of bytes used for other information in
the start_ok method (see below for details).

AMQP delegates to SASL for its authentication. Both the ad-hoc AMQPLAIN
method and the more standard PLAIN authentication methods put both the
username and password (with small constant padding) into that single
longstring, so your constraint is:

   len(username) + len(password) + k < 3800

where k is either 2 or 23 depending on whether your client library uses
PLAIN or AMQPLAIN, respectively.

Here's the connection.start-ok frame as sent by our Java client library. We see
that the frame is 0x122 bytes long after the 7-byte frame header, not including
the 1-byte frame footer, and that username and password information take up 11
bytes of that, meaning that the rest of the frame takes up 279 bytes (this will
vary slightly depending on library version and so forth), which leaves us with
3817, or about 3800, bytes for the authentication information.

Mon Apr 12 08:42:36 2010 (4bc2343c): TCP: fd 5 (I; localhost) sent 298 bytes:
00000000: 01 00 00 00 00 01 22 00 : 0A 00 0B 00 00 00 FE 07  ......".........
00000010: 70 72 6F 64 75 63 74 53 : 00 00 00 08 52 61 62 62  productS....Rabb
00000020: 69 74 4D 51 08 70 6C 61 : 74 66 6F 72 6D 53 00 00  itMQ.platformS..
00000030: 00 04 4A 61 76 61 0B 69 : 6E 66 6F 72 6D 61 74 69  ..Java.informati
00000040: 6F 6E 53 00 00 00 34 4C : 69 63 65 6E 73 65 64 20  onS...4Licensed
00000050: 75 6E 64 65 72 20 74 68 : 65 20 4D 50 4C 2E 20 53  under the MPL. S
00000060: 65 65 20 68 74 74 70 3A : 2F 2F 77 77 77 2E 72 61  ee http://www.ra
00000070: 62 62 69 74 6D 71 2E 63 : 6F 6D 2F 07 76 65 72 73  bbitmq.com/.vers
00000080: 69 6F 6E 53 00 00 00 0F : 24 7B 69 6D 70 6C 2E 76  ionS....${impl.v
00000090: 65 72 73 69 6F 6E 7D 09 : 63 6F 70 79 72 69 67 68  ersion}.copyrigh
000000A0: 74 53 00 00 00 67 43 6F : 70 79 72 69 67 68 74 20  tS...gCopyright
000000B0: 28 43 29 20 32 30 30 37 : 2D 32 30 30 38 20 4C 53  (C) 2007-2008 LS
000000C0: 68 69 66 74 20 4C 74 64 : 2E 2C 20 43 6F 68 65 73  hift Ltd., Cohes
000000D0: 69 76 65 20 46 69 6E 61 : 6E 63 69 61 6C 20 54 65  ive Financial Te
000000E0: 63 68 6E 6F 6C 6F 67 69 : 65 73 20 4C 4C 43 2E 2C  chnologies LLC.,
000000F0: 20 61 6E 64 20 52 61 62 : 62 69 74 20 54 65 63 68   and Rabbit Tech
00000100: 6E 6F 6C 6F 67 69 65 73 : 20 4C 74 64 2E 05 50 4C  nologies Ltd..PL
00000110: 41 49 4E 00 00 00 0C 00 : 67 75 65 73 74 00 67 75  AIN.....guest.gu
00000120: 65 73 74 05 65 6E 5F 55 : 53 CE                    est.en_US.
0000012A:

Regards,
  Tony




From johndapps at gmail.com  Mon Apr 12 09:24:35 2010
From: johndapps at gmail.com (John Apps)
Date: Mon, 12 Apr 2010 10:24:35 +0200
Subject: [rabbitmq-discuss]
	<rabbitmq-java-client-vxx>\test\src\com\rabbitmq\examples ---
	are these supposed to work out of the box on all platforms,
	i.e., if they do not, is it considered a bug?
Message-ID: <h2j173a1edc1004120124web0049b5oa124cd64d81e6104@mail.gmail.com>

The subject line says it all. Having spent some time, and also that of the
folks on this list, running the above examples and finding several that do
not work, i.e., crash, I am now wondering if I am spending time on something
which is shipped as an example, i.e., there is no guarantee that it will
work on all supported platforms, e.g., Windows.

This is a general question for now; specifics can be provided if there is
interest in learning which of the examples do not work. MulticastMain comes
to mind, StressPersister is another.

However, I did not want to waste everyone's time if the examples are, well,
examples!

I have found the examples more than useful as a learning and testing tool,
so am grateful that they are there.

Cheers, John
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100412/0fb923b4/attachment.htm 

From rljones at lastminute.com  Mon Apr 12 12:03:42 2010
From: rljones at lastminute.com (Jones, Richard)
Date: Mon, 12 Apr 2010 12:03:42 +0100
Subject: [rabbitmq-discuss] RPC with Erlang client
Message-ID: <3630CFD1D8AD3C478A155AA75AC5A98C2E08A4@sglonms02.Global.ad.sabre.com>

Greetings Rabbiteers,

I've noticed that the RPC server that comes with the Erlang client doesn't acknowledge messages. This has the effect of replaying all previous RPC requests whenever the system is restarted. I've looked at the equivalent code in the Java client, and it does a 'basic.ack' after the result of the call has been sent to the reply queue.

So, with this in mind I humbly submit a patch (attached).

I'm a newbie in all three of: AMQP, RabbitMQ and Erlang, so apologies if I've missed something obvious or I'm barking up the wrong tree.

cheers,
Richard Lewis Jones
-- 
lastminute.com labs

-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp_rpc_server.erl.patch
Type: text/x-patch
Size: 835 bytes
Desc: amqp_rpc_server.erl.patch
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100412/73e0729c/attachment.bin 

From jon.brisbin at npcinternational.com  Mon Apr 12 22:50:39 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 12 Apr 2010 16:50:39 -0500
Subject: [rabbitmq-discuss] Rapid Application Prototyping in Groovy/RabbitMQ
Message-ID: <2D04B5AA-51DA-4D51-8269-B233B413F5D4@npcinternational.com>

I don't know if there's an official methodology for this or not, but I've started doing some rapid application prototyping using the Groovy DSL. I blogged about it today:

http://jbrisbin.wordpress.com/2010/04/12/rapid-application-prototyping-with-groovy-and-rabbitmq/

Basically, I've found I was having a hard time visualizing how my messages were being routed and how queues were interconnected, and why my message wasn't ending up where I thought it was. I felt like I was flying blind.

Now I can rapidly prototype an application by wiring it together using the Groovy DSL, which gives me either an application outline, which I can fill out in Groovy, or a complex prototype against which I can write the application in another language.

I'd be interested to hear if this works for anyone else.

Jon Brisbin
Portal Webmaster
NPC International, Inc.






From dan.dispaltro at gmail.com  Tue Apr 13 01:28:56 2010
From: dan.dispaltro at gmail.com (Dan Di Spaltro)
Date: Mon, 12 Apr 2010 17:28:56 -0700
Subject: [rabbitmq-discuss] Bound Queues
Message-ID: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>

Is there anyway you can specify a memory/disk/length limit to a queue
size with the action being a similar to a fixed window?

If not, is there any chance it is on the roadmap?  I know its not in
the amqp spec, but it could be treated like a header.

-- 
Dan Di Spaltro



From tonyg at lshift.net  Tue Apr 13 03:41:40 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 13 Apr 2010 14:41:40 +1200
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
Message-ID: <4BC3D9E4.8030804@lshift.net>

Dan Di Spaltro wrote:
> Is there anyway you can specify a memory/disk/length limit to a queue
> size with the action being a similar to a fixed window?

Not at the moment, no.

> If not, is there any chance it is on the roadmap?  I know its not in
> the amqp spec, but it could be treated like a header.

It's not exactly on the roadmap, but it's something we've considered before.
There are some questions that need careful thought though, some of which have
more than one valid answer, mostly around the issue of what should happen once
a configured limit is reached. Would you expect newly-arriving messages to be
dropped? Would you expect the oldest enqueued messages to be dropped? Would you
expect to be warned about the dropped messages? Would you expect dropped
messages to be re-published somewhere, through some kind of dead-letter
exchange? How would queue limits interact with
delivered-but-not-yet-acknowledged messages? How would queue limits interact
with transactionally-published messages? How would queue limits interact with
the "mandatory" and "immediate" flags?

Regards,
  Tony



From matthias at lshift.net  Tue Apr 13 06:25:14 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 13 Apr 2010 06:25:14 +0100
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <4BC3D9E4.8030804@lshift.net>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net>
Message-ID: <4BC4003A.4060406@lshift.net>

Dan,

Tony Garnock-Jones wrote:
> Dan Di Spaltro wrote:
>> Is there anyway you can specify a memory/disk/length limit to a queue
>> size with the action being a similar to a fixed window? [...]
>
> It's not exactly on the roadmap, but it's something we've considered before.
> There are some questions that need careful thought though [...]

One particular tricky issue is sharing. AMQP message may get delivered 
to 0, 1 or *several* queues. RabbitMQ generally only keeps *one* copy of 
a message, regardless of how many queues it ends up in. So queues end up 
sharing messages. And some data can even be shared *between* messages.

Hence there really is no such thing as a per-queue memory/disk footprint.

Furthermore, there is no way to determine the memory footprint of a 
message precisely due to memory fragmentation, gc, etc.


Regards,

Matthias.



From matthias at rabbitmq.com  Tue Apr 13 13:33:37 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 13 Apr 2010 13:33:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ acquired by SpringSource
Message-ID: <4BC464A1.9060302@rabbitmq.com>

Rabbit Technologies Ltd. (RTL), the company behind RabbitMQ, has been 
acquired by SpringSource, a division of VMware, Inc.

RTL was founded in February 2007 and is a spin out from LShift Ltd., the 
UK software consultancy, and Cohesive FT, the US virtualization and 
cloud computing company.

The Rabbit Team are very excited about the deal. ?RabbitMQ is an 
extremely successful technology and forms the backbone for many varied 
cloud messaging systems,? said Alexis Richardson, chief executive 
officer and co-founder, Rabbit Technologies, Ltd. ?By providing a 
multi-protocol, completely open, portable messaging system, our 
technology can be a key enabler of tomorrow?s applications. By joining 
with enterprise leaders, SpringSource and VMware, RabbitMQ expects to 
continue to be at the forefront of the movement toward cloud computing. 
Users and customers will benefit from an organization offering deep and 
immediate experience with the challenges of managing highly available 
and stable operations.?

RabbitMQ will continue to be open source and distributed in the same way 
as before. The RabbitMQ community can expect to see increased investment 
in this outstanding technology which should result in significant 
improvements to the open source release.

RabbitMQ customers will see an increase in availability of training, 
professional services and support offerings as the RabbitMQ business is 
integrated with SpringSource.

For more details see 
http://www.springsource.com/springsource-acquires-rabbit-technologies



From aquino.gustavo at gmail.com  Tue Apr 13 13:41:00 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 13 Apr 2010 09:41:00 -0300
Subject: [rabbitmq-discuss] RabbitMQ acquired by SpringSource
In-Reply-To: <4BC464A1.9060302@rabbitmq.com>
References: <4BC464A1.9060302@rabbitmq.com>
Message-ID: <g2z5ef296b31004130541ve109780av63ae8cafb8c0ee7b@mail.gmail.com>

Congratulations It's sounds a good deal.I wish that this very good mail list
and community support continue.

Do you have any news about rabbit payed support ? SpringSource and RabbitMQ
have a plan about how it will work from now ?

Best Wishes for all Rabitters. :D

On Tue, Apr 13, 2010 at 9:33 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Rabbit Technologies Ltd. (RTL), the company behind RabbitMQ, has been
> acquired by SpringSource, a division of VMware, Inc.
>
> RTL was founded in February 2007 and is a spin out from LShift Ltd., the
> UK software consultancy, and Cohesive FT, the US virtualization and
> cloud computing company.
>
> The Rabbit Team are very excited about the deal. ?RabbitMQ is an
> extremely successful technology and forms the backbone for many varied
> cloud messaging systems,? said Alexis Richardson, chief executive
> officer and co-founder, Rabbit Technologies, Ltd. ?By providing a
> multi-protocol, completely open, portable messaging system, our
> technology can be a key enabler of tomorrow?s applications. By joining
> with enterprise leaders, SpringSource and VMware, RabbitMQ expects to
> continue to be at the forefront of the movement toward cloud computing.
> Users and customers will benefit from an organization offering deep and
> immediate experience with the challenges of managing highly available
> and stable operations.?
>
> RabbitMQ will continue to be open source and distributed in the same way
> as before. The RabbitMQ community can expect to see increased investment
> in this outstanding technology which should result in significant
> improvements to the open source release.
>
> RabbitMQ customers will see an increase in availability of training,
> professional services and support offerings as the RabbitMQ business is
> integrated with SpringSource.
>
> For more details see
> http://www.springsource.com/springsource-acquires-rabbit-technologies
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100413/84a9295b/attachment.htm 

From alexis.richardson at gmail.com  Tue Apr 13 14:40:01 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 13 Apr 2010 14:40:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ acquired by SpringSource
In-Reply-To: <g2z5ef296b31004130541ve109780av63ae8cafb8c0ee7b@mail.gmail.com>
References: <4BC464A1.9060302@rabbitmq.com>
	<g2z5ef296b31004130541ve109780av63ae8cafb8c0ee7b@mail.gmail.com>
Message-ID: <r2t167204d21004130640j504bb43eybeaf36486496b898@mail.gmail.com>

Gustavo

On Tue, Apr 13, 2010 at 1:41 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Congratulations It's sounds a good deal.

Thank-you - I think it's a great development.


> I wish that this very good mail list
> and?community?support continue.

That is one of our top priorities.  This list is a foundation stone
for the success of RabbitMQ and is critical to its future.  We love
the RabbitMQ community and the discussions that happen here.



> Do you have any news about rabbit payed support ? SpringSource and RabbitMQ
> have a plan about how it will work from now ?

We shall continue to provide RabbitMQ commercial support per our
existing offerings.  Look out for more as we work with the
SpringSource teams!


> Best Wishes for all Rabitters. :D

Thank-you.  And don't forget Rabbiters includes everyone here on this
list: thank-you all very much and we are excited about working with
you all more.

Best wishes

alexis




> On Tue, Apr 13, 2010 at 9:33 AM, Matthias Radestock <matthias at rabbitmq.com>
> wrote:
>>
>> Rabbit Technologies Ltd. (RTL), the company behind RabbitMQ, has been
>> acquired by SpringSource, a division of VMware, Inc.
>>
>> RTL was founded in February 2007 and is a spin out from LShift Ltd., the
>> UK software consultancy, and Cohesive FT, the US virtualization and
>> cloud computing company.
>>
>> The Rabbit Team are very excited about the deal. ?RabbitMQ is an
>> extremely successful technology and forms the backbone for many varied
>> cloud messaging systems,? said Alexis Richardson, chief executive
>> officer and co-founder, Rabbit Technologies, Ltd. ?By providing a
>> multi-protocol, completely open, portable messaging system, our
>> technology can be a key enabler of tomorrow?s applications. By joining
>> with enterprise leaders, SpringSource and VMware, RabbitMQ expects to
>> continue to be at the forefront of the movement toward cloud computing.
>> Users and customers will benefit from an organization offering deep and
>> immediate experience with the challenges of managing highly available
>> and stable operations.?
>>
>> RabbitMQ will continue to be open source and distributed in the same way
>> as before. The RabbitMQ community can expect to see increased investment
>> in this outstanding technology which should result in significant
>> improvements to the open source release.
>>
>> RabbitMQ customers will see an increase in availability of training,
>> professional services and support offerings as the RabbitMQ business is
>> integrated with SpringSource.
>>
>> For more details see
>> http://www.springsource.com/springsource-acquires-rabbit-technologies
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From videlalvaro at gmail.com  Tue Apr 13 14:45:23 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 13 Apr 2010 21:45:23 +0800
Subject: [rabbitmq-discuss] RabbitMQ acquired by SpringSource
In-Reply-To: <r2t167204d21004130640j504bb43eybeaf36486496b898@mail.gmail.com>
References: <4BC464A1.9060302@rabbitmq.com>
	<g2z5ef296b31004130541ve109780av63ae8cafb8c0ee7b@mail.gmail.com>
	<r2t167204d21004130640j504bb43eybeaf36486496b898@mail.gmail.com>
Message-ID: <E1D690DD-BF32-4287-8286-638C94A9AD36@gmail.com>

My Congratulations too to the RabbitMQ team.

This list has been supportive at all times and the quality delivered by the software is great.

Thanks and congratulations!

Alvaro



On Apr 13, 2010, at 9:40 PM, Alexis Richardson wrote:

> Gustavo
> 
> On Tue, Apr 13, 2010 at 1:41 PM, Gustavo Aquino
> <aquino.gustavo at gmail.com> wrote:
>> Congratulations It's sounds a good deal.
> 
> Thank-you - I think it's a great development.
> 
> 
>> I wish that this very good mail list
>> and community support continue.
> 
> That is one of our top priorities.  This list is a foundation stone
> for the success of RabbitMQ and is critical to its future.  We love
> the RabbitMQ community and the discussions that happen here.
> 
> 
> 
>> Do you have any news about rabbit payed support ? SpringSource and RabbitMQ
>> have a plan about how it will work from now ?
> 
> We shall continue to provide RabbitMQ commercial support per our
> existing offerings.  Look out for more as we work with the
> SpringSource teams!
> 
> 
>> Best Wishes for all Rabitters. :D
> 
> Thank-you.  And don't forget Rabbiters includes everyone here on this
> list: thank-you all very much and we are excited about working with
> you all more.
> 
> Best wishes
> 
> alexis
> 
> 
> 
> 
>> On Tue, Apr 13, 2010 at 9:33 AM, Matthias Radestock <matthias at rabbitmq.com>
>> wrote:
>>> 
>>> Rabbit Technologies Ltd. (RTL), the company behind RabbitMQ, has been
>>> acquired by SpringSource, a division of VMware, Inc.
>>> 
>>> RTL was founded in February 2007 and is a spin out from LShift Ltd., the
>>> UK software consultancy, and Cohesive FT, the US virtualization and
>>> cloud computing company.
>>> 
>>> The Rabbit Team are very excited about the deal. ?RabbitMQ is an
>>> extremely successful technology and forms the backbone for many varied
>>> cloud messaging systems,? said Alexis Richardson, chief executive
>>> officer and co-founder, Rabbit Technologies, Ltd. ?By providing a
>>> multi-protocol, completely open, portable messaging system, our
>>> technology can be a key enabler of tomorrow?s applications. By joining
>>> with enterprise leaders, SpringSource and VMware, RabbitMQ expects to
>>> continue to be at the forefront of the movement toward cloud computing.
>>> Users and customers will benefit from an organization offering deep and
>>> immediate experience with the challenges of managing highly available
>>> and stable operations.?
>>> 
>>> RabbitMQ will continue to be open source and distributed in the same way
>>> as before. The RabbitMQ community can expect to see increased investment
>>> in this outstanding technology which should result in significant
>>> improvements to the open source release.
>>> 
>>> RabbitMQ customers will see an increase in availability of training,
>>> professional services and support offerings as the RabbitMQ business is
>>> integrated with SpringSource.
>>> 
>>> For more details see
>>> http://www.springsource.com/springsource-acquires-rabbit-technologies
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From matthew at lshift.net  Tue Apr 13 14:53:54 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 13 Apr 2010 14:53:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ acquired by SpringSource
In-Reply-To: <4BC464A1.9060302@rabbitmq.com>
References: <4BC464A1.9060302@rabbitmq.com>
Message-ID: <20100413135354.GB1515@mrnibble.lshift.net>

On Tue, Apr 13, 2010 at 01:33:37PM +0100, Matthias Radestock wrote:
> Rabbit Technologies Ltd. (RTL), the company behind RabbitMQ, has been 
> acquired by SpringSource, a division of VMware, Inc.

              .
                        +---+   +---+                                
              |         |   |   |   |                                
     .               /  |   |   |   |                                
      \       I         |   |   |   |                                
                  /     |   +---+   +-------+
        \  ,g88R_       |                   |
          d888(`  ).    | RabbitMQ  +---+   |       _
 -  --==  888(     ).=--|           |   |   |   .+(`  )`.
)         Y8P(       '`.| In your   +---+   |  :(   .    )
        .+(`(      .   )|    clouds...      |  `.  (    ) )
 +-+ +-+((    (..__.:'-'+-------------------+    ` _`  ) )
`| | | |(       ) )       (   .  )                  (   )  ._
 | +-+ +---+_.:'   )     (   (   ))       .--        `-'.:(`  )
)|     +-+ |    --'       `- __.'      .=(   )         :(      ))
.|     +-+ |       .')                 (   .  )        `(    )  ))
 +---------+      (_  )               (   (   ))         ` __.:'
                                       `- __.'            
--..,___.--,--'`,---..-.--+--.,,-,,..._.--..-._.-a:f--m:s---._..-


Matthew



From jon.brisbin at npcinternational.com  Tue Apr 13 16:22:58 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 13 Apr 2010 10:22:58 -0500
Subject: [rabbitmq-discuss] Calling AS/400 service programs via RabbitMQ
Message-ID: <D69B6E19-2C5B-460C-A4B8-5B7F43912EB5@npcinternational.com>

I'm trying to document as much of what we're doing here at NPC as possible. If I can't release source code, I'm trying to do the next best thing and explain what we're doing.

In trying to make the AS/400 a first-class member of our cloud architecture, we need to open up the RPG-language service programs to other callers via RabbitMQ, so any language that has a client binding can call RPG programs. I wrote a generic MessageRouter (that isn't OpenSource, unfortunately) that handles incoming messages and dispatches them to RPG service programs.

I've tried to lay out the process in a new blog post:
http://jbrisbin.wordpress.com/2010/04/13/exposing-as400-service-programs-via-rabbitmq-and-java/

I don't know how many people are actually using RabbitMQ in conjunction with the AS/400, but I hope this is helpful, nonetheless...

Jon Brisbin
Portal Webmaster
NPC International, Inc.






From pdezwart at rubiconproject.com  Tue Apr 13 17:14:32 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 13 Apr 2010 12:14:32 -0400
Subject: [rabbitmq-discuss] RabbitMQ acquired by SpringSource
Message-ID: <7C1046148D91C244A98F4C146735886701BA2E61@BE43.exg3.exghost.com>

Congratulations guys, this is awesome. I wish you all the best of luck and I look forward to being part of this awesome community as it picks up even more steam.

Pieter

----- Original Message -----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com <rabbitmq-discuss-bounces at lists.rabbitmq.com>
To: rabbitmq-announce <rabbitmq-announce at lists.rabbitmq.com>; rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Tue Apr 13 08:33:37 2010
Subject: [rabbitmq-discuss] RabbitMQ acquired by SpringSource

Rabbit Technologies Ltd. (RTL), the company behind RabbitMQ, has been 
acquired by SpringSource, a division of VMware, Inc.

RTL was founded in February 2007 and is a spin out from LShift Ltd., the 
UK software consultancy, and Cohesive FT, the US virtualization and 
cloud computing company.

The Rabbit Team are very excited about the deal. ?RabbitMQ is an 
extremely successful technology and forms the backbone for many varied 
cloud messaging systems,? said Alexis Richardson, chief executive 
officer and co-founder, Rabbit Technologies, Ltd. ?By providing a 
multi-protocol, completely open, portable messaging system, our 
technology can be a key enabler of tomorrow?s applications. By joining 
with enterprise leaders, SpringSource and VMware, RabbitMQ expects to 
continue to be at the forefront of the movement toward cloud computing. 
Users and customers will benefit from an organization offering deep and 
immediate experience with the challenges of managing highly available 
and stable operations.?

RabbitMQ will continue to be open source and distributed in the same way 
as before. The RabbitMQ community can expect to see increased investment 
in this outstanding technology which should result in significant 
improvements to the open source release.

RabbitMQ customers will see an increase in availability of training, 
professional services and support offerings as the RabbitMQ business is 
integrated with SpringSource.

For more details see 
http://www.springsource.com/springsource-acquires-rabbit-technologies

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100413/dfa37820/attachment.htm 

From sigurd.hogsbro at museeka.com  Tue Apr 13 17:36:22 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Tue, 13 Apr 2010 09:36:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ acquired by SpringSource
In-Reply-To: <4BC464A1.9060302@rabbitmq.com>
References: <4BC464A1.9060302@rabbitmq.com>
Message-ID: <47f590c3-e1b9-440b-8dc3-c0e16f46a2e6@b33g2000yqc.googlegroups.com>

Well deserved recognition for a great product and team that engages
the community.

Congratulations!

Sigurd

On Apr 13, 1:33?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> Rabbit Technologies Ltd. (RTL), the company behind RabbitMQ, has been
> acquired by SpringSource, a division of VMware, Inc.
>
> RTL was founded in February 2007 and is a spin out from LShift Ltd., the
> UK software consultancy, and Cohesive FT, the US virtualization and
> cloud computing company.
>
> The Rabbit Team are very excited about the deal. ?RabbitMQ is an
> extremely successful technology and forms the backbone for many varied
> cloud messaging systems,? said Alexis Richardson, chief executive
> officer and co-founder, Rabbit Technologies, Ltd. ?By providing a
> multi-protocol, completely open, portable messaging system, our
> technology can be a key enabler of tomorrow?s applications. By joining
> with enterprise leaders, SpringSource and VMware, RabbitMQ expects to
> continue to be at the forefront of the movement toward cloud computing.
> Users and customers will benefit from an organization offering deep and
> immediate experience with the challenges of managing highly available
> and stable operations.?
>
> RabbitMQ will continue to be open source and distributed in the same way
> as before. The RabbitMQ community can expect to see increased investment
> in this outstanding technology which should result in significant
> improvements to the open source release.
>
> RabbitMQ customers will see an increase in availability of training,
> professional services and support offerings as the RabbitMQ business is
> integrated with SpringSource.
>
> For more details seehttp://www.springsource.com/springsource-acquires-rabbit-technologies
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From progrium at twilio.com  Tue Apr 13 19:42:57 2010
From: progrium at twilio.com (Jeff Lindsay)
Date: Tue, 13 Apr 2010 11:42:57 -0700
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <4BC4003A.4060406@lshift.net>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
Message-ID: <m2gab2aca561004131142h6cc049cfz1ea4ae6169ab09a8@mail.gmail.com>

I didn't realize this about queues. I thought that's where the state was in
Rabbit. For example, I thought when a node goes down, the messages in the
queues in that node are lost.

On Mon, Apr 12, 2010 at 10:25 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Dan,
>
> Tony Garnock-Jones wrote:
> > Dan Di Spaltro wrote:
> >> Is there anyway you can specify a memory/disk/length limit to a queue
> >> size with the action being a similar to a fixed window? [...]
> >
> > It's not exactly on the roadmap, but it's something we've considered
> before.
> > There are some questions that need careful thought though [...]
>
> One particular tricky issue is sharing. AMQP message may get delivered
> to 0, 1 or *several* queues. RabbitMQ generally only keeps *one* copy of
> a message, regardless of how many queues it ends up in. So queues end up
> sharing messages. And some data can even be shared *between* messages.
>
> Hence there really is no such thing as a per-queue memory/disk footprint.
>
> Furthermore, there is no way to determine the memory footprint of a
> message precisely due to memory fragmentation, gc, etc.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100413/8a0ffe0b/attachment.htm 

From aquino.gustavo at gmail.com  Tue Apr 13 19:57:20 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 13 Apr 2010 15:57:20 -0300
Subject: [rabbitmq-discuss] Calling AS/400 service programs via RabbitMQ
In-Reply-To: <D69B6E19-2C5B-460C-A4B8-5B7F43912EB5@npcinternational.com>
References: <D69B6E19-2C5B-460C-A4B8-5B7F43912EB5@npcinternational.com>
Message-ID: <q2q5ef296b31004131157wb02991b2o6d3f5f2f2cdc33a@mail.gmail.com>

Hi Jon,

Very good to know about your job, on past I did something like you but for
MainFrame VM ESA, exposing Cobol programs as Services replacing the Terminal
3270. Unfortunately we don't use Rabbit but other MQ and when I leave the
project I started the studding to replace this MQ using Rabbit.

One problem that I had was , connect in RabbitMQ using Cobol, so How do you
connect in Rabbit from AS/400 ? Do you write a RPG program or using Java for
AS/400 ?

Regards.


On Tue, Apr 13, 2010 at 12:22 PM, Jon Brisbin <
jon.brisbin at npcinternational.com> wrote:

> I'm trying to document as much of what we're doing here at NPC as possible.
> If I can't release source code, I'm trying to do the next best thing and
> explain what we're doing.
>
> In trying to make the AS/400 a first-class member of our cloud
> architecture, we need to open up the RPG-language service programs to other
> callers via RabbitMQ, so any language that has a client binding can call RPG
> programs. I wrote a generic MessageRouter (that isn't OpenSource,
> unfortunately) that handles incoming messages and dispatches them to RPG
> service programs.
>
> I've tried to lay out the process in a new blog post:
>
> http://jbrisbin.wordpress.com/2010/04/13/exposing-as400-service-programs-via-rabbitmq-and-java/
>
> I don't know how many people are actually using RabbitMQ in conjunction
> with the AS/400, but I hope this is helpful, nonetheless...
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100413/10d8cf3c/attachment.htm 

From jon.brisbin at npcinternational.com  Tue Apr 13 20:37:51 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 13 Apr 2010 14:37:51 -0500
Subject: [rabbitmq-discuss] Calling AS/400 service programs via RabbitMQ
In-Reply-To: <20589ED9-CCEE-4C78-81C1-DF6F1145B033@jbrisbin.com>
References: <D69B6E19-2C5B-460C-A4B8-5B7F43912EB5@npcinternational.com>
	<20589ED9-CCEE-4C78-81C1-DF6F1145B033@jbrisbin.com>
Message-ID: <673D0607-2B7A-4739-86CD-E001BC4D24B6@npcinternational.com>

Another thing I forgot to mention in the blog post is that this same principle works for any native language calls. For instance, we're also creating listeners that run functions inside C++ DLLs on win32 boxes. 

The obvious: why not just use the native clients? Our C++ developers use VisualStudio 2003 on old XP boxes, for one... No C# or .NET anywhere. Just plain C++ and some boost library usage.

We bought a copy of VS2008 the other day and I think they're trying to get something hacked up using that.


Jon Brisbin
Portal Webmaster
NPC International, Inc.



> On Apr 13, 2010, at 10:22 AM, Jon Brisbin wrote:
> 
>> I'm trying to document as much of what we're doing here at NPC as possible. If I can't release source code, I'm trying to do the next best thing and explain what we're doing.
>> 
>> In trying to make the AS/400 a first-class member of our cloud architecture, we need to open up the RPG-language service programs to other callers via RabbitMQ, so any language that has a client binding can call RPG programs. I wrote a generic MessageRouter (that isn't OpenSource, unfortunately) that handles incoming messages and dispatches them to RPG service programs.
>> 
>> I've tried to lay out the process in a new blog post:
>> http://jbrisbin.wordpress.com/2010/04/13/exposing-as400-service-programs-via-rabbitmq-and-java/
>> 
>> I don't know how many people are actually using RabbitMQ in conjunction with the AS/400, but I hope this is helpful, nonetheless...
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100413/e312da2f/attachment.htm 

From g at rre.tt  Tue Apr 13 21:34:57 2010
From: g at rre.tt (Garrett Smith)
Date: Tue, 13 Apr 2010 15:34:57 -0500
Subject: [rabbitmq-discuss] VMWare and Rabbit
Message-ID: <y2rce2570e21004131334gbc120956tdb4a669f1f819b90@mail.gmail.com>

I completely missed this news! Congratulations to the LShift team!

Garrett



From alexis.richardson at gmail.com  Tue Apr 13 21:43:53 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 13 Apr 2010 21:43:53 +0100
Subject: [rabbitmq-discuss] VMWare and Rabbit
In-Reply-To: <y2rce2570e21004131334gbc120956tdb4a669f1f819b90@mail.gmail.com>
References: <y2rce2570e21004131334gbc120956tdb4a669f1f819b90@mail.gmail.com>
Message-ID: <p2k167204d21004131343j51f6e67cp7525097d3b481a75@mail.gmail.com>

Thanks!

On Tue, Apr 13, 2010 at 9:34 PM, Garrett Smith <g at rre.tt> wrote:
> I completely missed this news! Congratulations to the LShift team!
>
> Garrett
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tonyg at lshift.net  Wed Apr 14 03:07:01 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 14 Apr 2010 14:07:01 +1200
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <m2gab2aca561004131142h6cc049cfz1ea4ae6169ab09a8@mail.gmail.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>	<4BC3D9E4.8030804@lshift.net>
	<4BC4003A.4060406@lshift.net>
	<m2gab2aca561004131142h6cc049cfz1ea4ae6169ab09a8@mail.gmail.com>
Message-ID: <4BC52345.3040906@lshift.net>

Jeff Lindsay wrote:
> I didn't realize this about queues. I thought that's where the state was
> in Rabbit. For example, I thought when a node goes down, the messages in
> the queues in that node are lost. 

Ah, I think Matthias is glossing over issues of clustering here and talking
just about a single node's behaviour. So where he says RabbitMQ keeps one copy
regardless of how many queues, he means each node that holds queues that a
message is destined for keeps one copy. Generally. There are lots of caveats.
The point, though, is that one message may end up on 100 queues, but be shared
between them, leading to nontrivial memory accounting.

In this case I'd be inclined to do the simplest thing: count each message on a
queue toward its budget, no matter if the system has cleverly managed to avoid
copying that same message out to a million other queues. But it really does
suggest that we're not really measuring the right thing here somehow; I'm
looking forward to discovering a better way of accounting for messages!

Tony




From matthias at rabbitmq.com  Wed Apr 14 07:42:31 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Apr 2010 07:42:31 +0100
Subject: [rabbitmq-discuss] New User: Questions and Comments
In-Reply-To: <2aa20a0a-cad0-4033-b5a0-0c672610cce4@j21g2000yqh.googlegroups.com>
References: <6cf1763a1003110607p13c03fct5ec0fe7a69118f72@mail.gmail.com>
	<4BBDC91B.5000608@lshift.net>
	<2aa20a0a-cad0-4033-b5a0-0c672610cce4@j21g2000yqh.googlegroups.com>
Message-ID: <4BC563D7.9050303@rabbitmq.com>

Mark,

Mark Steckel wrote:
> Is it the case that a RabbitMQ cluster a) allows a queue to be
> accessed from every node in the cluster, but b) the queue and the
> messages it contains only reside in/on a single node?

Correct.

>> There is an HA guide on its way
> 
> I'm definitely interested in reading this.

It's still going through QA. Should be ready soon.


Regards,

Matthias.



From matthias at rabbitmq.com  Wed Apr 14 08:26:32 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Apr 2010 08:26:32 +0100
Subject: [rabbitmq-discuss] RPC with Erlang client
In-Reply-To: <3630CFD1D8AD3C478A155AA75AC5A98C2E08A4@sglonms02.Global.ad.sabre.com>
References: <3630CFD1D8AD3C478A155AA75AC5A98C2E08A4@sglonms02.Global.ad.sabre.com>
Message-ID: <4BC56E28.6010501@rabbitmq.com>

Richard,

Jones, Richard wrote:
> I've noticed that the RPC server that comes with the Erlang client
> doesn't acknowledge messages. This has the effect of replaying all
> previous RPC requests whenever the system is restarted.

Congratulations, looks like you have found a bug.

> So, with this in mind I humbly submit a patch (attached).

Thanks. We will get this fixed shortly.

> I'm a newbie in all three of: AMQP, RabbitMQ and Erlang

Identifying and fixing that bug required knowledge of all three. So you 
are doing pretty well :)

Let us know if you spot anything else. What are your plans for rabbit?


Regards,

Matthias.



From g at rre.tt  Wed Apr 14 11:27:47 2010
From: g at rre.tt (Garrett Smith)
Date: Wed, 14 Apr 2010 05:27:47 -0500
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <4BC4003A.4060406@lshift.net>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
Message-ID: <i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>

On Tue, Apr 13, 2010 at 12:25 AM, Matthias Radestock
<matthias at lshift.net> wrote:
> Dan,
>
> Tony Garnock-Jones wrote:
>> Dan Di Spaltro wrote:
>>> Is there anyway you can specify a memory/disk/length limit to a queue
>>> size with the action being a similar to a fixed window? [...]
>>
>> It's not exactly on the roadmap, but it's something we've considered before.
>> There are some questions that need careful thought though [...]
>
> One particular tricky issue is sharing. AMQP message may get delivered
> to 0, 1 or *several* queues. RabbitMQ generally only keeps *one* copy of
> a message, regardless of how many queues it ends up in. So queues end up
> sharing messages. And some data can even be shared *between* messages.
>
> Hence there really is no such thing as a per-queue memory/disk footprint.
>
> Furthermore, there is no way to determine the memory footprint of a
> message precisely due to memory fragmentation, gc, etc.

At the end of the day though, when messages pile up in a queue (just
takes one), you'll run out of memory at some point.

Without support for ttl/expires, Rabbit is particularly susceptible to
this "problem". I realize this it's by design and there are cases
where you *want* this, but there are absolutely cases when you
*don't*. It just takes one flaky consumer to put your entire system in
jeopardy.

For this reason, I've moved all of our queues to exclusive + auto
delete. I'd prefer to maintain queue state as producers and consumers
drop off, but the benefit of this is not enough to justify the
risk/cost.

I also have an external monitor on queue size (I believe measured in
memory as per rabbitmqctl output) in the event a rogue consumer
declares a queue with the wrong settings.

FWIW, the qpid server does respect the ttl message property and this
condition is easier to manage as a result. I'm a fan of ttl as it's
application specific (producers get to chose how long their messages
should live) and provides a reasonable heuristic for deleting messages
that aren't consumed in a timely manner.

This has been brought up a few times and I understand that there is a
similar set of questions that need to be addressed. Nonetheless, from
my point of view, this is a topic (general problem) that should get a
bump in road map priority.

Garrett



From matthias at rabbitmq.com  Wed Apr 14 12:00:37 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Apr 2010 12:00:37 +0100
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>	
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
Message-ID: <4BC5A055.1000501@rabbitmq.com>

Garrett,

Garrett Smith wrote:
> At the end of the day though, when messages pile up in a queue (just
> takes one), you'll run out of memory at some point.

You won't run out of memory with the new persister, which has been a top 
development priority for some time. Sorry it's taking so long to get 
that into an official release.

But even with memory consumption no longer being an issue it may still 
be desirable to drop messages at some point. Hence ...

> Without support for ttl/expires, Rabbit is particularly susceptible to
> this "problem". I realize this it's by design

ttl/expires are on the todo list. They are not missing "by design".

> from my point of view, this is a topic (general problem) that should
> get a bump in road map priority.

Ack. FWIW, you could implement a crude ttl/expires logic purely as an 
AMQP client that periodically fetches all messages from a queue and acks 
all those that have expired. Obviously that is far less efficient than 
what could be done inside the broker. Plus it affects message order. But 
it's probably good enough for a whole bunch of use cases.


Regards,

Matthias.



From tonyg at lshift.net  Wed Apr 14 12:13:19 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 14 Apr 2010 23:13:19 +1200
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>	<4BC3D9E4.8030804@lshift.net>
	<4BC4003A.4060406@lshift.net>
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
Message-ID: <4BC5A34F.9000504@lshift.net>

Garrett Smith wrote:
> FWIW, the qpid server does respect the ttl message property and this
> condition is easier to manage as a result. I'm a fan of ttl as it's
> application specific (producers get to chose how long their messages
> should live) and provides a reasonable heuristic for deleting messages
> that aren't consumed in a timely manner.

And as it happens, ttl is one of the key controls of reliable delivery: in
order to achieve reliable delivery, you need to be able to bound the lifetime
of a packet in the network, so that duplicates don't outlive their
deduplication buffer entries.

I think implementing ttl is important. We could build a dumb form of it quickly
enough, where as a message is considered for delivery its ttl is checked, but
the real challenge lies in collecting expired messages while they're idle.
Per-message ttls aggravate the problem: if only it were a per *queue* ttl, it'd
be so much easier!

Tony




From g at rre.tt  Wed Apr 14 12:22:32 2010
From: g at rre.tt (Garrett Smith)
Date: Wed, 14 Apr 2010 06:22:32 -0500
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <4BC5A055.1000501@rabbitmq.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
	<4BC5A055.1000501@rabbitmq.com>
Message-ID: <z2ice2570e21004140422v7feecc6ex7b783ec8f515deaf@mail.gmail.com>

On Wed, Apr 14, 2010 at 6:00 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Garrett,
>
> Garrett Smith wrote:
>>
>> At the end of the day though, when messages pile up in a queue (just
>> takes one), you'll run out of memory at some point.
>
> You won't run out of memory with the new persister, which has been a top
> development priority for some time. Sorry it's taking so long to get that
> into an official release.
>
> But even with memory consumption no longer being an issue it may still be
> desirable to drop messages at some point. Hence ...
>
>> Without support for ttl/expires, Rabbit is particularly susceptible to
>> this "problem". I realize this it's by design
>
> ttl/expires are on the todo list. They are not missing "by design".

Awesome!

>> from my point of view, this is a topic (general problem) that should
>> get a bump in road map priority.
>
> Ack. FWIW, you could implement a crude ttl/expires logic purely as an AMQP
> client that periodically fetches all messages from a queue and acks all
> those that have expired. Obviously that is far less efficient than what
> could be done inside the broker. Plus it affects message order. But it's
> probably good enough for a whole bunch of use cases.

And another moving part for the app, but still... good idea.

Garrett



From mwilhelm at vz.net  Wed Apr 14 12:41:00 2010
From: mwilhelm at vz.net (Martin Wilhelm)
Date: Wed, 14 Apr 2010 13:41:00 +0200
Subject: [rabbitmq-discuss] Turning off rabbit logging
In-Reply-To: <20100107223155.GK15498@wellquite.org>
References: <aa3794b1001071335x637251aas7ebff32ca56c0d81@mail.gmail.com>	<20100107221526.GI15498@wellquite.org>
	<20100107223155.GK15498@wellquite.org>
Message-ID: <4BC5A9CC.9070402@vz.net>

On 07.01.2010 23:31, Matthew Sackman wrote:
> On Thu, Jan 07, 2010 at 10:15:26PM +0000, Matthew Sackman wrote:
>> On Thu, Jan 07, 2010 at 04:35:29PM -0500, Mark Steele wrote:
>>> Is there a method to turn off rabbit's logging? I've poked around the
>>> documentation (administration guide), and have come up empty handed.
>>
>> Nope. You could always just redirect the logs to /dev/null.
>
> Actually, I've just done some more digging into this. If you put in your
> /etc/rabbitmq/rabbitmq.conf
> SERVER_START_ARGS="-kernel error_logger silent"
>
> then you'll not get the main log. However, it's debatable whether that
> should really work. You also can't turn of the sasl log from there (for
> some reason). Much better is to edit your rabbitmq-server script and
> change the two lines at the bottom which look like:
>
>      -kernel error_logger '{file,"'${RABBITMQ_LOGS}'"}' \
>      -sasl sasl_error_logger '{file,"'${RABBITMQ_SASL_LOGS}'"}' \
>
> to
>
>      -kernel error_logger silent \
>      -sasl sasl_error_logger false \
>
> Then you'll get rid of both of them.

A late question:

Are there plans to use log4erl with rabbitmq? So - one
can adjust the loglevel instead of enable/disable the
whole logging. In our case 'error' and 'fatal' should be
logged, 'info' not.


Greetings,
Martin


-- 
Martin Wilhelm

System Operations


VZnet Netzwerke Ltd. || Saarbruecker Str. 38 || D - 10405 Berlin

Tel:    +49 (30) 4050427 575
Fax:    +49 (30) 405042727 575
Mobil: 	+49 (176) 14050444

MWilhelm at vz.net

www.studivz.net, www.meinvz.net, www.schuelervz.net

VZnet Netzwerke Limited, Registered Office Berlin, Registration Court Charlottenburg, HRB 101454
Executive Directors: Clemens Riedl, Thomas Baum, Jodok Batlogg
Non-Executive Directors: Dr. Jochen Gutbrod, Martin Weber, Claas van Delden
Headquarters: VZnet Netzwerke Limited, 5 New Street Square, London EC4A 3TW, United Kingdom
Companies House Cardiff No. 5607971, Place of Registration: England and Wales




From matthias at rabbitmq.com  Wed Apr 14 13:20:49 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Apr 2010 13:20:49 +0100
Subject: [rabbitmq-discuss] Turning off rabbit logging
In-Reply-To: <4BC5A9CC.9070402@vz.net>
References: <aa3794b1001071335x637251aas7ebff32ca56c0d81@mail.gmail.com>	<20100107221526.GI15498@wellquite.org>	<20100107223155.GK15498@wellquite.org>
	<4BC5A9CC.9070402@vz.net>
Message-ID: <4BC5B321.7030608@rabbitmq.com>

Martin,

Martin Wilhelm wrote:
> Are there plans to use log4erl with rabbitmq? So - one can adjust the
> loglevel instead of enable/disable the whole logging. In our case
> 'error' and 'fatal' should be logged, 'info' not.

There are no plans at present, but I've just filed a bug to look into 
this. Switching to a different logging system is quite a substantial 
piece of work though, so I doubt we'll get to that soon.


Regards,

Matthias.
PS: It would be handy if something like log4erl was in Erlang/OTP.



From dan.dispaltro at gmail.com  Wed Apr 14 16:56:25 2010
From: dan.dispaltro at gmail.com (Dan Di Spaltro)
Date: Wed, 14 Apr 2010 08:56:25 -0700
Subject: [rabbitmq-discuss] Bound Queues
In-Reply-To: <4BC5A34F.9000504@lshift.net>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com> 
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net> 
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com> 
	<4BC5A34F.9000504@lshift.net>
Message-ID: <u2ofdec68581004140856y4db59037le20decf32be2dad7@mail.gmail.com>

ttl's on a queue level would be very useful to us

On Wed, Apr 14, 2010 at 4:13 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Garrett Smith wrote:
>> FWIW, the qpid server does respect the ttl message property and this
>> condition is easier to manage as a result. I'm a fan of ttl as it's
>> application specific (producers get to chose how long their messages
>> should live) and provides a reasonable heuristic for deleting messages
>> that aren't consumed in a timely manner.
>
> And as it happens, ttl is one of the key controls of reliable delivery: in
> order to achieve reliable delivery, you need to be able to bound the lifetime
> of a packet in the network, so that duplicates don't outlive their
> deduplication buffer entries.
>
> I think implementing ttl is important. We could build a dumb form of it quickly
> enough, where as a message is considered for delivery its ttl is checked, but
> the real challenge lies in collecting expired messages while they're idle.
> Per-message ttls aggravate the problem: if only it were a per *queue* ttl, it'd
> be so much easier!
>
> Tony
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Dan Di Spaltro



From alexis.richardson at gmail.com  Wed Apr 14 18:02:17 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 14 Apr 2010 18:02:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
Message-ID: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>

Hi everyone,

It looks like Xing's Beetle project is up on Github:
http://github.com/xing/beetle

There is a project page here: http://xing.github.com/beetle/

Please take a look and share any comments you may have here :-)

alexis



From jasonjwwilliams at gmail.com  Wed Apr 14 18:09:12 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 14 Apr 2010 11:09:12 -0600
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
Message-ID: <y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>

Been reading the page since y'all started tweeting about it. :) It's
hard to tell how it works.

-J

On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Hi everyone,
>
> It looks like Xing's Beetle project is up on Github:
> http://github.com/xing/beetle
>
> There is a project page here: http://xing.github.com/beetle/
>
> Please take a look and share any comments you may have here :-)
>
> alexis
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthias at rabbitmq.com  Wed Apr 14 19:13:21 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Apr 2010 19:13:21 +0100
Subject: [rabbitmq-discuss] per-queue message TTLs [was Re: Bound Queues]
In-Reply-To: <u2ofdec68581004140856y4db59037le20decf32be2dad7@mail.gmail.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
	<4BC5A34F.9000504@lshift.net>
	<u2ofdec68581004140856y4db59037le20decf32be2dad7@mail.gmail.com>
Message-ID: <4BC605C1.9010305@rabbitmq.com>

Dan Di Spaltro wrote:
> On Wed, Apr 14, 2010 at 4:13 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
>> if only it were a per *queue* ttl, it'd be so much easier!
> ttl's on a queue level would be very useful to us

That's a really interesting idea, and it is a lot easier to implement 
than per-message TTLs.

So here is a question to all RabbitMQ users who have been asking / 
secretly wishing for TTLs: Would per-queue TTLs, i.e. all messages 
getting the same TTL when they are enqueued, be good enough (or even 
preferable) for you? Or do you definitely need to be able to specify 
TTLs on per-message basis (and if so, what is the use case)?


Regards,

Matthias.



From bmurphy1976 at gmail.com  Wed Apr 14 19:24:59 2010
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 14 Apr 2010 13:24:59 -0500
Subject: [rabbitmq-discuss] per-queue message TTLs [was Re: Bound Queues]
In-Reply-To: <4BC605C1.9010305@rabbitmq.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
	<4BC5A34F.9000504@lshift.net>
	<u2ofdec68581004140856y4db59037le20decf32be2dad7@mail.gmail.com>
	<4BC605C1.9010305@rabbitmq.com>
Message-ID: <v2t7fd310d11004141124zcbfc1eh153681617fb5b9e3@mail.gmail.com>

On Wed, Apr 14, 2010 at 1:13 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Dan Di Spaltro wrote:
> > On Wed, Apr 14, 2010 at 4:13 AM, Tony Garnock-Jones <tonyg at lshift.net>
> wrote:
> >> if only it were a per *queue* ttl, it'd be so much easier!
> > ttl's on a queue level would be very useful to us
>
> That's a really interesting idea, and it is a lot easier to implement
> than per-message TTLs.
>
> So here is a question to all RabbitMQ users who have been asking /
> secretly wishing for TTLs: Would per-queue TTLs, i.e. all messages
> getting the same TTL when they are enqueued, be good enough (or even
> preferable) for you? Or do you definitely need to be able to specify
> TTLs on per-message basis (and if so, what is the use case)?
>
>
We'd find per-queue TTLs very useful.

Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100414/54c7f281/attachment.htm 

From aquino.gustavo at gmail.com  Wed Apr 14 19:34:51 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Wed, 14 Apr 2010 15:34:51 -0300
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
	<y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
Message-ID: <v2s5ef296b31004141134i6b4e693cr4e70f31f7725042b@mail.gmail.com>

Good news... I'm trying to do something like it but using memcached, it's
very good to know and I will put it to run now , let me see.

Thanks Alexis.


So if RabbitMQ is a VMWare product and Redis it too, so do Rabbit support
this HA approach ? :-)

Regars.


On Wed, Apr 14, 2010 at 2:09 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> Been reading the page since y'all started tweeting about it. :) It's
> hard to tell how it works.
>
> -J
>
> On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
> > Hi everyone,
> >
> > It looks like Xing's Beetle project is up on Github:
> > http://github.com/xing/beetle
> >
> > There is a project page here: http://xing.github.com/beetle/
> >
> > Please take a look and share any comments you may have here :-)
> >
> > alexis
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100414/3fd256d6/attachment.htm 

From g at rre.tt  Wed Apr 14 19:36:07 2010
From: g at rre.tt (Garrett Smith)
Date: Wed, 14 Apr 2010 13:36:07 -0500
Subject: [rabbitmq-discuss] per-queue message TTLs [was Re: Bound Queues]
In-Reply-To: <4BC605C1.9010305@rabbitmq.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
	<4BC5A34F.9000504@lshift.net>
	<u2ofdec68581004140856y4db59037le20decf32be2dad7@mail.gmail.com>
	<4BC605C1.9010305@rabbitmq.com>
Message-ID: <u2vce2570e21004141136w7c0a7858q9cb4ab95b84cbcaa@mail.gmail.com>

On Wed, Apr 14, 2010 at 1:13 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Dan Di Spaltro wrote:
>> On Wed, Apr 14, 2010 at 4:13 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
>>> if only it were a per *queue* ttl, it'd be so much easier!
>> ttl's on a queue level would be very useful to us
>
> That's a really interesting idea, and it is a lot easier to implement
> than per-message TTLs.
>
> So here is a question to all RabbitMQ users who have been asking /
> secretly wishing for TTLs: Would per-queue TTLs, i.e. all messages
> getting the same TTL when they are enqueued, be good enough (or even
> preferable) for you? Or do you definitely need to be able to specify
> TTLs on per-message basis (and if so, what is the use case)?

Per message ttl and per queue ttl strike me as being very different
and both having valid use cases.

Per message ttl is specified based on the producer's requirement or
vantage point. E.g. a caller might designate a request as being valid
only for a certain amount of time (e.g. request price quote) -- or the
message content is no longer valid after the expiration (e.g. send
price quote). In such cases queues have nothing to say about ttl.

A per queue ttl would apply to consumers. E.g. a consumer might not
fulfill a request because it's become "stale".

For my part, per queue ttls would be preferable. I want my consumers
to be able to drop off, come back and handle requests that aren't
"stale" (basically to handle restarts, though there are other
scenarios). In my case, the consumers know what stale means better
than the producers, though that's obviously application specific.

I see both being reasonable features that are independent of one another.

Garrett



From chen650 at yahoo.com  Wed Apr 14 19:46:43 2010
From: chen650 at yahoo.com (alex chen)
Date: Wed, 14 Apr 2010 11:46:43 -0700 (PDT)
Subject: [rabbitmq-discuss] per-queue message TTLs [was Re: Bound Queues]
In-Reply-To: <4BC605C1.9010305@rabbitmq.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
	<4BC5A34F.9000504@lshift.net>
	<u2ofdec68581004140856y4db59037le20decf32be2dad7@mail.gmail.com>
	<4BC605C1.9010305@rabbitmq.com>
Message-ID: <378713.87784.qm@web31801.mail.mud.yahoo.com>

> TTLs: Would per-queue TTLs, i.e. all messages 
> getting the same TTL when they 
> are enqueued, be good enough (or even 
> preferable) for you? 

We prefer to have per queue TTL.  It would also be very useful if rabbit can support limiting max number of messages per queue, and/or max num of bytes per queue.  When the queue length reached the limit, drop old messages.

-alex


      



From tobert at gmail.com  Wed Apr 14 19:48:24 2010
From: tobert at gmail.com (Al Tobey)
Date: Wed, 14 Apr 2010 11:48:24 -0700
Subject: [rabbitmq-discuss] per-queue message TTLs [was Re: Bound Queues]
In-Reply-To: <4BC605C1.9010305@rabbitmq.com>
References: <n2xfdec68581004121728m6226f6ccs32b84c35a765a241@mail.gmail.com>
	<4BC3D9E4.8030804@lshift.net> <4BC4003A.4060406@lshift.net>
	<i2kce2570e21004140327s20e81703xd115e59e98ed0940@mail.gmail.com>
	<4BC5A34F.9000504@lshift.net>
	<u2ofdec68581004140856y4db59037le20decf32be2dad7@mail.gmail.com>
	<4BC605C1.9010305@rabbitmq.com>
Message-ID: <q2v5ac7acb11004141148lf3222ee8r1cc669a2052bb31c@mail.gmail.com>

On Wed, Apr 14, 2010 at 11:13 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Dan Di Spaltro wrote:
> > On Wed, Apr 14, 2010 at 4:13 AM, Tony Garnock-Jones <tonyg at lshift.net>
> wrote:
> >> if only it were a per *queue* ttl, it'd be so much easier!
> > ttl's on a queue level would be very useful to us
>
> That's a really interesting idea, and it is a lot easier to implement
> than per-message TTLs.
>
> So here is a question to all RabbitMQ users who have been asking /
> secretly wishing for TTLs: Would per-queue TTLs, i.e. all messages
> getting the same TTL when they are enqueued, be good enough (or even
> preferable) for you? Or do you definitely need to be able to specify
> TTLs on per-message basis (and if so, what is the use case)?
>

Per-queue would be far more useful IMO.   Display the TTL's in rabbitmqctl
list_queues and in the rabbitmq-status plugin and it'll be really easy to
allow users to figure out why their messages are disappearing after $TTL
seconds.   It also makes the life of the administrator easier, since it
would be visible without peeking at messages.

-Al

Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100414/887b5a3d/attachment.htm 

From alexis.richardson at gmail.com  Wed Apr 14 20:08:12 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 14 Apr 2010 20:08:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <o2jc6114db61004141137q7ff6fbf5m818970fcfe61ac25@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
	<y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
	<v2s5ef296b31004141134i6b4e693cr4e70f31f7725042b@mail.gmail.com>
	<o2jc6114db61004141137q7ff6fbf5m818970fcfe61ac25@mail.gmail.com>
Message-ID: <x2r167204d21004141208j1c03d41dycfebcd816d453509@mail.gmail.com>

Thanks Salvatore.

Gustavo,

We and the community will support good solutions and 'things that
work'.  I like the approach, but as Salvatore suggested - it is not
unique.

alexis



On Wed, Apr 14, 2010 at 7:37 PM, Salvatore Sanfilippo <antirez at gmail.com> wrote:
> On Wed, Apr 14, 2010 at 8:34 PM, Gustavo Aquino
> <aquino.gustavo at gmail.com> wrote:
>
>> So if RabbitMQ is a VMWare product and Redis it too, so do Rabbit support
>> this HA?approach?? :-)
>
> I think that surely it helps that this feature depends from another
> VMWare product ;)
> But my guess is that the way to go is to have such a support built-in
> for RabbitMQ.
>
> Ciao,
> Salvatore
>
>> Regars.
>>
>> On Wed, Apr 14, 2010 at 2:09 PM, Jason J. W. Williams
>> <jasonjwwilliams at gmail.com> wrote:
>>>
>>> Been reading the page since y'all started tweeting about it. :) It's
>>> hard to tell how it works.
>>>
>>> -J
>>>
>>> On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
>>> <alexis.richardson at gmail.com> wrote:
>>> > Hi everyone,
>>> >
>>> > It looks like Xing's Beetle project is up on Github:
>>> > http://github.com/xing/beetle
>>> >
>>> > There is a project page here: http://xing.github.com/beetle/
>>> >
>>> > Please take a look and share any comments you may have here :-)
>>> >
>>> > alexis
>>> >
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
> --
> Salvatore 'antirez' Sanfilippo
> http://invece.org
>
> "Once you have something that grows faster than education grows,
> you?re always going to get a pop culture.", Alan Kay
>



From aquino.gustavo at gmail.com  Wed Apr 14 20:43:24 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Wed, 14 Apr 2010 16:43:24 -0300
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <x2r167204d21004141208j1c03d41dycfebcd816d453509@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
	<y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
	<v2s5ef296b31004141134i6b4e693cr4e70f31f7725042b@mail.gmail.com>
	<o2jc6114db61004141137q7ff6fbf5m818970fcfe61ac25@mail.gmail.com>
	<x2r167204d21004141208j1c03d41dycfebcd816d453509@mail.gmail.com>
Message-ID: <z2o5ef296b31004141243lc0caf3amd83296bf9cfe0c39@mail.gmail.com>

Alexis,

I know that it's not the unique, you know how much I'm looking for a good HA
solutions using RabbitMQ. The problem is RabbitMQ doesn't have a default
solution out of the box for HA, and do you know companies need it, need a
commitment from product owner about HA. Do my own solution means,
the responsible of maintenance and evolution of this solutions is my, and it
is not my business it will be yours. Understand why I do this question about
support ?

I'm a community enthusiast, and work hard of lot of open projects and is a
pleasure if I can help to Rabbit HA, the point is today all products
inclusive cloud products need to have one HA solutions OTB, It's is the best
? may be not but need to have it, and today we have a problem of using
RabbitMQ because it don't have it. So how can I put Rabbit on my core if
cannot guarantee a single SLA, or without putting responsible in side like
O.S cluster solution, OpenaIS, LVS shared storage or whatever.

Do you know any about the overhead in throughput using this Xing's Solution
?


Best Regards.


On Wed, Apr 14, 2010 at 4:08 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Thanks Salvatore.
>
> Gustavo,
>
> We and the community will support good solutions and 'things that
> work'.  I like the approach, but as Salvatore suggested - it is not
> unique.
>
> alexis
>
>
>
> On Wed, Apr 14, 2010 at 7:37 PM, Salvatore Sanfilippo <antirez at gmail.com>
> wrote:
> > On Wed, Apr 14, 2010 at 8:34 PM, Gustavo Aquino
> > <aquino.gustavo at gmail.com> wrote:
> >
> >> So if RabbitMQ is a VMWare product and Redis it too, so do Rabbit
> support
> >> this HA approach ? :-)
> >
> > I think that surely it helps that this feature depends from another
> > VMWare product ;)
> > But my guess is that the way to go is to have such a support built-in
> > for RabbitMQ.
> >
> > Ciao,
> > Salvatore
> >
> >> Regars.
> >>
> >> On Wed, Apr 14, 2010 at 2:09 PM, Jason J. W. Williams
> >> <jasonjwwilliams at gmail.com> wrote:
> >>>
> >>> Been reading the page since y'all started tweeting about it. :) It's
> >>> hard to tell how it works.
> >>>
> >>> -J
> >>>
> >>> On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
> >>> <alexis.richardson at gmail.com> wrote:
> >>> > Hi everyone,
> >>> >
> >>> > It looks like Xing's Beetle project is up on Github:
> >>> > http://github.com/xing/beetle
> >>> >
> >>> > There is a project page here: http://xing.github.com/beetle/
> >>> >
> >>> > Please take a look and share any comments you may have here :-)
> >>> >
> >>> > alexis
> >>> >
> >>> > _______________________________________________
> >>> > rabbitmq-discuss mailing list
> >>> > rabbitmq-discuss at lists.rabbitmq.com
> >>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>> >
> >>>
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-discuss at lists.rabbitmq.com
> >>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >>
> >
> >
> >
> > --
> > Salvatore 'antirez' Sanfilippo
> > http://invece.org
> >
> > "Once you have something that grows faster than education grows,
> > you?re always going to get a pop culture.", Alan Kay
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100414/a8e2821b/attachment.htm 

From alexis.richardson at gmail.com  Wed Apr 14 20:56:38 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 14 Apr 2010 20:56:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <z2o5ef296b31004141243lc0caf3amd83296bf9cfe0c39@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
	<y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
	<v2s5ef296b31004141134i6b4e693cr4e70f31f7725042b@mail.gmail.com>
	<o2jc6114db61004141137q7ff6fbf5m818970fcfe61ac25@mail.gmail.com>
	<x2r167204d21004141208j1c03d41dycfebcd816d453509@mail.gmail.com>
	<z2o5ef296b31004141243lc0caf3amd83296bf9cfe0c39@mail.gmail.com>
Message-ID: <h2j167204d21004141256jb5b40fdbscd275874f3141d60@mail.gmail.com>

Gustavo

We are about to release an HA Guide including recommendations.  It's
just being reviewed.

It is not possible to provide "HA OOTB" because each system is
slightly different.  If someone tells you that they can support HA
OOTB, they are misleading you.  What is possible, and desirable, is a
much simpler and more "OOTB like" experience for the main four or five
HA cases.  For example, the Beetle project aims to solve for cases
where idempotency is desired.  Your case might require a different
optimisation.  E.g. sometimes latency needs to be below X
microseconds, and sometimes it does not.

We are in the business of providing long term commercial support for
RabbitMQ based solutions, including where an SLA is in use.  Just let
us know what solution or solutions you need.

alexis



On Wed, Apr 14, 2010 at 8:43 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Alexis,
> I know that it's not the unique, you know how much I'm looking for a good HA
> solutions using RabbitMQ. The problem is RabbitMQ?doesn't?have a default
> solution out of the box for HA, and do you know companies need it, need a
> commitment from product owner about HA. Do my own solution means,
> the?responsible?of?maintenance?and evolution of this solutions is my, and it
> is not my business it will be yours. Understand why I do this question about
> support ?
> I'm a community?enthusiast, and work hard of lot of open projects and is a
> pleasure if I can help to Rabbit HA, the point is today all products
> inclusive cloud products need to have one HA solutions OTB, It's is the best
> ? may be not but need to have it, and today we have a problem of using
> RabbitMQ because it don't have it. So how can I put Rabbit on my core if
> cannot?guarantee a single SLA, or without putting?responsible?in side like
> O.S cluster solution, OpenaIS, LVS shared storage or whatever.
> Do you know any about the overhead in throughput using this Xing's Solution
> ?
>
> Best Regards.
>
> On Wed, Apr 14, 2010 at 4:08 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Thanks Salvatore.
>>
>> Gustavo,
>>
>> We and the community will support good solutions and 'things that
>> work'. ?I like the approach, but as Salvatore suggested - it is not
>> unique.
>>
>> alexis
>>
>>
>>
>> On Wed, Apr 14, 2010 at 7:37 PM, Salvatore Sanfilippo <antirez at gmail.com>
>> wrote:
>> > On Wed, Apr 14, 2010 at 8:34 PM, Gustavo Aquino
>> > <aquino.gustavo at gmail.com> wrote:
>> >
>> >> So if RabbitMQ is a VMWare product and Redis it too, so do Rabbit
>> >> support
>> >> this HA?approach?? :-)
>> >
>> > I think that surely it helps that this feature depends from another
>> > VMWare product ;)
>> > But my guess is that the way to go is to have such a support built-in
>> > for RabbitMQ.
>> >
>> > Ciao,
>> > Salvatore
>> >
>> >> Regars.
>> >>
>> >> On Wed, Apr 14, 2010 at 2:09 PM, Jason J. W. Williams
>> >> <jasonjwwilliams at gmail.com> wrote:
>> >>>
>> >>> Been reading the page since y'all started tweeting about it. :) It's
>> >>> hard to tell how it works.
>> >>>
>> >>> -J
>> >>>
>> >>> On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
>> >>> <alexis.richardson at gmail.com> wrote:
>> >>> > Hi everyone,
>> >>> >
>> >>> > It looks like Xing's Beetle project is up on Github:
>> >>> > http://github.com/xing/beetle
>> >>> >
>> >>> > There is a project page here: http://xing.github.com/beetle/
>> >>> >
>> >>> > Please take a look and share any comments you may have here :-)
>> >>> >
>> >>> > alexis
>> >>> >
>> >>> > _______________________________________________
>> >>> > rabbitmq-discuss mailing list
>> >>> > rabbitmq-discuss at lists.rabbitmq.com
>> >>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>> >
>> >>>
>> >>> _______________________________________________
>> >>> rabbitmq-discuss mailing list
>> >>> rabbitmq-discuss at lists.rabbitmq.com
>> >>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>
>> >>
>> >
>> >
>> >
>> > --
>> > Salvatore 'antirez' Sanfilippo
>> > http://invece.org
>> >
>> > "Once you have something that grows faster than education grows,
>> > you?re always going to get a pop culture.", Alan Kay
>> >
>
>



From jdunck at gmail.com  Wed Apr 14 21:09:53 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 14 Apr 2010 15:09:53 -0500
Subject: [rabbitmq-discuss] Rabbit crash (1.7.0)
Message-ID: <v2z2545a92c1004141309zfadf11a7w4dc3bf372b5e1fbe@mail.gmail.com>

Hey all,
  We've had a Rabbit 1.7.0 daemon running since January, pretty much
the same app load, no changes in client code which uses Rabbit.

  Today it crashed, complaining about too many open processes.  I've
zipped up the rabbit.log and the erlang crash log.

  Can anyone see an issue?  How can I help troubleshoot the cause?

  Log files here:
  http://radiotime-logs.s3.amazonaws.com/rabbit-crash-2010-04-14.zip



From aquino.gustavo at gmail.com  Wed Apr 14 21:35:50 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Wed, 14 Apr 2010 17:35:50 -0300
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <h2j167204d21004141256jb5b40fdbscd275874f3141d60@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
	<y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
	<v2s5ef296b31004141134i6b4e693cr4e70f31f7725042b@mail.gmail.com>
	<o2jc6114db61004141137q7ff6fbf5m818970fcfe61ac25@mail.gmail.com>
	<x2r167204d21004141208j1c03d41dycfebcd816d453509@mail.gmail.com>
	<z2o5ef296b31004141243lc0caf3amd83296bf9cfe0c39@mail.gmail.com>
	<h2j167204d21004141256jb5b40fdbscd275874f3141d60@mail.gmail.com>
Message-ID: <k2r5ef296b31004141335xed6262fakc61b0d2037852bf@mail.gmail.com>

Alexis,

Why not one HA OOTB can be provided ? do you have one HP OOTB solution why
not HA ? May be one HA OOTB is not the best solution, and may be not attend
100% of users but may be 70% and it's sounds good for me not for you ?.

We know about one AMQP product that have a HA OOTB solution, and we are
trying this "HA OOTB" and this product will be used in CME. But can't do the
same with RabbitMQ.

I understand you, and you know my case, we are working in
microseconds/nanoseconds, may be this HA don't attend our requirements, but
it is one solutions and until now we don't have a good solution for HA using
Rabbit, about HP we don't need nothing to talk about RabbitMQ is very good
Broker routing 2.000.000 messages per second just inboud. But one good HA
solution is getting my sleep.

Do you know what we need,we talked about that is just one HA solution from
RabbitMQ with a very low latency, SLA and guarantee that no messages will be
loosed. O.S cluster or putting HA logic in our application is not a good
solution in our case.

Regards.




On Wed, Apr 14, 2010 at 4:56 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gustavo
>
> We are about to release an HA Guide including recommendations.  It's
> just being reviewed.
>
> It is not possible to provide "HA OOTB" because each system is
> slightly different.  If someone tells you that they can support HA
> OOTB, they are misleading you.  What is possible, and desirable, is a
> much simpler and more "OOTB like" experience for the main four or five
> HA cases.  For example, the Beetle project aims to solve for cases
> where idempotency is desired.  Your case might require a different
> optimisation.  E.g. sometimes latency needs to be below X
> microseconds, and sometimes it does not.
>
> We are in the business of providing long term commercial support for
> RabbitMQ based solutions, including where an SLA is in use.  Just let
> us know what solution or solutions you need.
>
> alexis
>
>
>
> On Wed, Apr 14, 2010 at 8:43 PM, Gustavo Aquino
> <aquino.gustavo at gmail.com> wrote:
> > Alexis,
> > I know that it's not the unique, you know how much I'm looking for a good
> HA
> > solutions using RabbitMQ. The problem is RabbitMQ doesn't have a default
> > solution out of the box for HA, and do you know companies need it, need a
> > commitment from product owner about HA. Do my own solution means,
> > the responsible of maintenance and evolution of this solutions is my, and
> it
> > is not my business it will be yours. Understand why I do this question
> about
> > support ?
> > I'm a community enthusiast, and work hard of lot of open projects and is
> a
> > pleasure if I can help to Rabbit HA, the point is today all products
> > inclusive cloud products need to have one HA solutions OTB, It's is the
> best
> > ? may be not but need to have it, and today we have a problem of using
> > RabbitMQ because it don't have it. So how can I put Rabbit on my core if
> > cannot guarantee a single SLA, or without putting responsible in side
> like
> > O.S cluster solution, OpenaIS, LVS shared storage or whatever.
> > Do you know any about the overhead in throughput using this Xing's
> Solution
> > ?
> >
> > Best Regards.
> >
> > On Wed, Apr 14, 2010 at 4:08 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Thanks Salvatore.
> >>
> >> Gustavo,
> >>
> >> We and the community will support good solutions and 'things that
> >> work'.  I like the approach, but as Salvatore suggested - it is not
> >> unique.
> >>
> >> alexis
> >>
> >>
> >>
> >> On Wed, Apr 14, 2010 at 7:37 PM, Salvatore Sanfilippo <
> antirez at gmail.com>
> >> wrote:
> >> > On Wed, Apr 14, 2010 at 8:34 PM, Gustavo Aquino
> >> > <aquino.gustavo at gmail.com> wrote:
> >> >
> >> >> So if RabbitMQ is a VMWare product and Redis it too, so do Rabbit
> >> >> support
> >> >> this HA approach ? :-)
> >> >
> >> > I think that surely it helps that this feature depends from another
> >> > VMWare product ;)
> >> > But my guess is that the way to go is to have such a support built-in
> >> > for RabbitMQ.
> >> >
> >> > Ciao,
> >> > Salvatore
> >> >
> >> >> Regars.
> >> >>
> >> >> On Wed, Apr 14, 2010 at 2:09 PM, Jason J. W. Williams
> >> >> <jasonjwwilliams at gmail.com> wrote:
> >> >>>
> >> >>> Been reading the page since y'all started tweeting about it. :) It's
> >> >>> hard to tell how it works.
> >> >>>
> >> >>> -J
> >> >>>
> >> >>> On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
> >> >>> <alexis.richardson at gmail.com> wrote:
> >> >>> > Hi everyone,
> >> >>> >
> >> >>> > It looks like Xing's Beetle project is up on Github:
> >> >>> > http://github.com/xing/beetle
> >> >>> >
> >> >>> > There is a project page here: http://xing.github.com/beetle/
> >> >>> >
> >> >>> > Please take a look and share any comments you may have here :-)
> >> >>> >
> >> >>> > alexis
> >> >>> >
> >> >>> > _______________________________________________
> >> >>> > rabbitmq-discuss mailing list
> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
> >> >>> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >>> >
> >> >>>
> >> >>> _______________________________________________
> >> >>> rabbitmq-discuss mailing list
> >> >>> rabbitmq-discuss at lists.rabbitmq.com
> >> >>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >>
> >> >>
> >> >
> >> >
> >> >
> >> > --
> >> > Salvatore 'antirez' Sanfilippo
> >> > http://invece.org
> >> >
> >> > "Once you have something that grows faster than education grows,
> >> > you?re always going to get a pop culture.", Alan Kay
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100414/01f9c148/attachment.htm 

From matthias at rabbitmq.com  Wed Apr 14 23:07:05 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Apr 2010 23:07:05 +0100
Subject: [rabbitmq-discuss] Rabbit crash (1.7.0)
In-Reply-To: <v2z2545a92c1004141309zfadf11a7w4dc3bf372b5e1fbe@mail.gmail.com>
References: <v2z2545a92c1004141309zfadf11a7w4dc3bf372b5e1fbe@mail.gmail.com>
Message-ID: <4BC63C89.4070004@rabbitmq.com>

Jeremy,

Jeremy Dunck wrote:
>   We've had a Rabbit 1.7.0 daemon running since January, pretty much
> the same app load, no changes in client code which uses Rabbit.
> 
>   Today it crashed, complaining about too many open processes.  I've
> zipped up the rabbit.log and the erlang crash log.

Please accept the rabbit team's condolences on the death of your bunny. 
According to the logs it seemed to be in good health and spirit and then 
it suddenly collapsed.

There is nothing in the logs that points at the cause for reaching the 
process limit. It's possible that there is a very slow leak somewhere, 
but I cannot think of any place where that would be, unless your clients 
sometimes do something strange like create a queue that gets left 
behind. Hence it's probably worth keeping an eye in the number of queues 
with
   rabbitmqctl list_queues

To check whether there is a slow leak of processes, periodically run
   erl_call -sname rabbit at localhost -a 'erlang system_info [process_count]'
which returns the current process count. Depending on how you installed 
rabbit you may need the -c option to set the Erlang cookie, e.g.
   erl_call -c `cat /var/lib/rabbitmq/.erlang.cookie` -sname ...

The count will fluctuate as rabbit does its work, but if you see a 
general upward trend then please let us know.

Also, please upgrade to the latest version of RabbitMQ if it's not too 
much hassle. I don't think that will solve the problem, but it will make 
investigation easier if the problem reoccurs.

Here's hoping that the next incarnation of your bunny lives longer.


Regards,

Matthias.



From videlalvaro at gmail.com  Thu Apr 15 06:36:57 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 15 Apr 2010 13:36:57 +0800
Subject: [rabbitmq-discuss] Rabbit crash (1.7.0)
In-Reply-To: <4BC63C89.4070004@rabbitmq.com>
References: <v2z2545a92c1004141309zfadf11a7w4dc3bf372b5e1fbe@mail.gmail.com>
	<4BC63C89.4070004@rabbitmq.com>
Message-ID: <19D7A872-8A9C-4AFF-88EE-9C2514C83066@gmail.com>

Our RabbitMQ server just died in the same way.

We will add a script to get the number of processes and add that to Graphite, maybe in a week we can have a nice graph with those numbers and see what's the behavior is.

Regards,

Alvaro

On Apr 15, 2010, at 6:07 AM, Matthias Radestock wrote:

> Jeremy,
> 
> Jeremy Dunck wrote:
>>  We've had a Rabbit 1.7.0 daemon running since January, pretty much
>> the same app load, no changes in client code which uses Rabbit.
>> 
>>  Today it crashed, complaining about too many open processes.  I've
>> zipped up the rabbit.log and the erlang crash log.
> 
> Please accept the rabbit team's condolences on the death of your bunny. 
> According to the logs it seemed to be in good health and spirit and then 
> it suddenly collapsed.
> 
> There is nothing in the logs that points at the cause for reaching the 
> process limit. It's possible that there is a very slow leak somewhere, 
> but I cannot think of any place where that would be, unless your clients 
> sometimes do something strange like create a queue that gets left 
> behind. Hence it's probably worth keeping an eye in the number of queues 
> with
>   rabbitmqctl list_queues
> 
> To check whether there is a slow leak of processes, periodically run
>   erl_call -sname rabbit at localhost -a 'erlang system_info [process_count]'
> which returns the current process count. Depending on how you installed 
> rabbit you may need the -c option to set the Erlang cookie, e.g.
>   erl_call -c `cat /var/lib/rabbitmq/.erlang.cookie` -sname ...
> 
> The count will fluctuate as rabbit does its work, but if you see a 
> general upward trend then please let us know.
> 
> Also, please upgrade to the latest version of RabbitMQ if it's not too 
> much hassle. I don't think that will solve the problem, but it will make 
> investigation easier if the problem reoccurs.
> 
> Here's hoping that the next incarnation of your bunny lives longer.
> 
> 
> Regards,
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From videlalvaro at gmail.com  Thu Apr 15 08:12:38 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 15 Apr 2010 15:12:38 +0800
Subject: [rabbitmq-discuss] Rabbit crash (1.7.0)
In-Reply-To: <4BC63C89.4070004@rabbitmq.com>
References: <v2z2545a92c1004141309zfadf11a7w4dc3bf372b5e1fbe@mail.gmail.com>
	<4BC63C89.4070004@rabbitmq.com>
Message-ID: <CD01BACC-7C3E-4652-A264-4C6EDE0CD0C6@gmail.com>

Well, I found the problem in our situation,

One of our publishers was opening too many channels. 

For the library that we are using, if you don't specify the channel_id, then it will open a new one. Our library is a PHP one, I don't know in Jeremy's case.

Regards,

Alvaro

On Apr 15, 2010, at 6:07 AM, Matthias Radestock wrote:

> Jeremy,
> 
> Jeremy Dunck wrote:
>>  We've had a Rabbit 1.7.0 daemon running since January, pretty much
>> the same app load, no changes in client code which uses Rabbit.
>> 
>>  Today it crashed, complaining about too many open processes.  I've
>> zipped up the rabbit.log and the erlang crash log.
> 
> Please accept the rabbit team's condolences on the death of your bunny. 
> According to the logs it seemed to be in good health and spirit and then 
> it suddenly collapsed.
> 
> There is nothing in the logs that points at the cause for reaching the 
> process limit. It's possible that there is a very slow leak somewhere, 
> but I cannot think of any place where that would be, unless your clients 
> sometimes do something strange like create a queue that gets left 
> behind. Hence it's probably worth keeping an eye in the number of queues 
> with
>   rabbitmqctl list_queues
> 
> To check whether there is a slow leak of processes, periodically run
>   erl_call -sname rabbit at localhost -a 'erlang system_info [process_count]'
> which returns the current process count. Depending on how you installed 
> rabbit you may need the -c option to set the Erlang cookie, e.g.
>   erl_call -c `cat /var/lib/rabbitmq/.erlang.cookie` -sname ...
> 
> The count will fluctuate as rabbit does its work, but if you see a 
> general upward trend then please let us know.
> 
> Also, please upgrade to the latest version of RabbitMQ if it's not too 
> much hassle. I don't think that will solve the problem, but it will make 
> investigation easier if the problem reoccurs.
> 
> Here's hoping that the next incarnation of your bunny lives longer.
> 
> 
> Regards,
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From matthew at lshift.net  Thu Apr 15 11:03:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 15 Apr 2010 11:03:15 +0100
Subject: [rabbitmq-discuss] Rabbit crash (1.7.0)
In-Reply-To: <CD01BACC-7C3E-4652-A264-4C6EDE0CD0C6@gmail.com>
References: <v2z2545a92c1004141309zfadf11a7w4dc3bf372b5e1fbe@mail.gmail.com>
	<4BC63C89.4070004@rabbitmq.com>
	<CD01BACC-7C3E-4652-A264-4C6EDE0CD0C6@gmail.com>
Message-ID: <20100415100315.GD1515@mrnibble.lshift.net>

On Thu, Apr 15, 2010 at 03:12:38PM +0800, Alvaro Videla wrote:
> Well, I found the problem in our situation,
> 
> One of our publishers was opening too many channels. 
> 
> For the library that we are using, if you don't specify the channel_id, then it will open a new one. Our library is a PHP one, I don't know in Jeremy's case.

Yes, you only have 65536 channels max per connection and the client
should reuse them for you automatically if it does assignment of
channels automatically. Both our .Net and Java clients have channel
allocators which cope nicely with holes in the range of assigned
channels and so forth.

Matthew



From alexis.richardson at gmail.com  Thu Apr 15 11:51:41 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 15 Apr 2010 11:51:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <k2r5ef296b31004141335xed6262fakc61b0d2037852bf@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
	<y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
	<v2s5ef296b31004141134i6b4e693cr4e70f31f7725042b@mail.gmail.com>
	<o2jc6114db61004141137q7ff6fbf5m818970fcfe61ac25@mail.gmail.com>
	<x2r167204d21004141208j1c03d41dycfebcd816d453509@mail.gmail.com>
	<z2o5ef296b31004141243lc0caf3amd83296bf9cfe0c39@mail.gmail.com>
	<h2j167204d21004141256jb5b40fdbscd275874f3141d60@mail.gmail.com>
	<k2r5ef296b31004141335xed6262fakc61b0d2037852bf@mail.gmail.com>
Message-ID: <i2i167204d21004150351j4d8037c6q7c5698afafe11351@mail.gmail.com>

Gustavo,

On Wed, Apr 14, 2010 at 9:35 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Alexis,
> Why not one HA OOTB can be provided ?

As I mentioned, we are about to release an HA Guide which provides our
recommendation for HA today, that we can stand behind.  In other words
- you can trust us to commercially support that solution and provide
SLAs.

You are correct that we *could* provide a single configuration OOTB
for HA.  The question is: which one.

Bear in mind that HA behaviour combines:

* Immediate acceptance
* Immediate delivery
* Eventual acceptance
* Eventual delivery

Note that:

(a) these requirements are in tension with one another; so it is
expensive to provide a system that is able to provide all of them at
once so that, somehow, the system works out what each message needs
and reacts accordingly based on need.

(b) more importantly, the requirements are based on a notion of TIME.
This is problematic because time based guarantees are
non-deterministic.  For some systems an unavailability window of 1ms
is fine because the client can wait.  For others it is too big.  Many
things can affect this.  For example you could be running a messaging
system on a real time Linux kernel, but still have variance in your
failover window due to how your network and disk hardware is behaving
based on (eg) load and contention.

This is all ok, but we need to make our assumptions *explicit* for any
one HA OOTB solution.



> do you have one HP OOTB solution why
> not HA ? May be one HA OOTB is not the best solution, and may be not attend
> 100% of users but may be 70% and it's sounds good for me not for you ?.

Yes that's fine Gustavo, but as soon as you make a promise about one
configuration being "HA" then people immediately expect that you can
do things that break the laws of physics.




> We know about one AMQP product that have a HA OOTB solution, and we are
> trying this "HA OOTB" and this product will be used in CME. But can't do the
> same with RabbitMQ.

Why don't you describe the main HA parameters that you need, on this
list, and we can talk about them.

Also: Do you want to see a copy of the HA Guide?




> I understand you, and you know my case, we are working in
> microseconds/nanoseconds, may be this HA don't attend our requirements, but
> it is one solutions and until now we don't have a good solution for HA using
> Rabbit, about HP we don't need nothing to talk about RabbitMQ is very good
> Broker routing 2.000.000 messages per second just inboud. But one good HA
> solution is getting my sleep.

I'm sorry to hear that we are keeping you awake at night.



> Do you know what we need,we talked about that is just one HA solution from
> RabbitMQ with a very low?latency, SLA and guarantee that no messages will be
> loosed.?O.S cluster or putting HA logic in our application is not a good
> solution in our case.

Actually, doing dedup on the consumer could be a very good solution
based on what you have told me in the past.  But, let's keep
discussing it.

alexis



> Regards.
>
>
>
> On Wed, Apr 14, 2010 at 4:56 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gustavo
>>
>> We are about to release an HA Guide including recommendations. ?It's
>> just being reviewed.
>>
>> It is not possible to provide "HA OOTB" because each system is
>> slightly different. ?If someone tells you that they can support HA
>> OOTB, they are misleading you. ?What is possible, and desirable, is a
>> much simpler and more "OOTB like" experience for the main four or five
>> HA cases. ?For example, the Beetle project aims to solve for cases
>> where idempotency is desired. ?Your case might require a different
>> optimisation. ?E.g. sometimes latency needs to be below X
>> microseconds, and sometimes it does not.
>>
>> We are in the business of providing long term commercial support for
>> RabbitMQ based solutions, including where an SLA is in use. ?Just let
>> us know what solution or solutions you need.
>>
>> alexis
>>
>>
>>
>> On Wed, Apr 14, 2010 at 8:43 PM, Gustavo Aquino
>> <aquino.gustavo at gmail.com> wrote:
>> > Alexis,
>> > I know that it's not the unique, you know how much I'm looking for a
>> > good HA
>> > solutions using RabbitMQ. The problem is RabbitMQ?doesn't?have a default
>> > solution out of the box for HA, and do you know companies need it, need
>> > a
>> > commitment from product owner about HA. Do my own solution means,
>> > the?responsible?of?maintenance?and evolution of this solutions is my,
>> > and it
>> > is not my business it will be yours. Understand why I do this question
>> > about
>> > support ?
>> > I'm a community?enthusiast, and work hard of lot of open projects and is
>> > a
>> > pleasure if I can help to Rabbit HA, the point is today all products
>> > inclusive cloud products need to have one HA solutions OTB, It's is the
>> > best
>> > ? may be not but need to have it, and today we have a problem of using
>> > RabbitMQ because it don't have it. So how can I put Rabbit on my core if
>> > cannot?guarantee a single SLA, or without putting?responsible?in side
>> > like
>> > O.S cluster solution, OpenaIS, LVS shared storage or whatever.
>> > Do you know any about the overhead in throughput using this Xing's
>> > Solution
>> > ?
>> >
>> > Best Regards.
>> >
>> > On Wed, Apr 14, 2010 at 4:08 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Thanks Salvatore.
>> >>
>> >> Gustavo,
>> >>
>> >> We and the community will support good solutions and 'things that
>> >> work'. ?I like the approach, but as Salvatore suggested - it is not
>> >> unique.
>> >>
>> >> alexis
>> >>
>> >>
>> >>
>> >> On Wed, Apr 14, 2010 at 7:37 PM, Salvatore Sanfilippo
>> >> <antirez at gmail.com>
>> >> wrote:
>> >> > On Wed, Apr 14, 2010 at 8:34 PM, Gustavo Aquino
>> >> > <aquino.gustavo at gmail.com> wrote:
>> >> >
>> >> >> So if RabbitMQ is a VMWare product and Redis it too, so do Rabbit
>> >> >> support
>> >> >> this HA?approach?? :-)
>> >> >
>> >> > I think that surely it helps that this feature depends from another
>> >> > VMWare product ;)
>> >> > But my guess is that the way to go is to have such a support built-in
>> >> > for RabbitMQ.
>> >> >
>> >> > Ciao,
>> >> > Salvatore
>> >> >
>> >> >> Regars.
>> >> >>
>> >> >> On Wed, Apr 14, 2010 at 2:09 PM, Jason J. W. Williams
>> >> >> <jasonjwwilliams at gmail.com> wrote:
>> >> >>>
>> >> >>> Been reading the page since y'all started tweeting about it. :)
>> >> >>> It's
>> >> >>> hard to tell how it works.
>> >> >>>
>> >> >>> -J
>> >> >>>
>> >> >>> On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
>> >> >>> <alexis.richardson at gmail.com> wrote:
>> >> >>> > Hi everyone,
>> >> >>> >
>> >> >>> > It looks like Xing's Beetle project is up on Github:
>> >> >>> > http://github.com/xing/beetle
>> >> >>> >
>> >> >>> > There is a project page here: http://xing.github.com/beetle/
>> >> >>> >
>> >> >>> > Please take a look and share any comments you may have here :-)
>> >> >>> >
>> >> >>> > alexis
>> >> >>> >
>> >> >>> > _______________________________________________
>> >> >>> > rabbitmq-discuss mailing list
>> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >>> >
>> >> >>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >>> >
>> >> >>>
>> >> >>> _______________________________________________
>> >> >>> rabbitmq-discuss mailing list
>> >> >>> rabbitmq-discuss at lists.rabbitmq.com
>> >> >>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >>
>> >> >>
>> >> >
>> >> >
>> >> >
>> >> > --
>> >> > Salvatore 'antirez' Sanfilippo
>> >> > http://invece.org
>> >> >
>> >> > "Once you have something that grows faster than education grows,
>> >> > you?re always going to get a pop culture.", Alan Kay
>> >> >
>> >
>> >
>
>



From lists at zopyx.com  Thu Apr 15 14:30:10 2010
From: lists at zopyx.com (Andreas Jung)
Date: Thu, 15 Apr 2010 15:30:10 +0200
Subject: [rabbitmq-discuss] Typical throughput of RabbitMQ
Message-ID: <h2i42d8a3d11004150630x8a990f2i7d8b1f132c5b9614@mail.gmail.com>

Hi,

I made some benchmark with RabbitMQ (and MongoDB) and got a throughput of
10k/second inserts into a queue with an average document size of 10 KB.
This makes a throughput of roughly 10 MB/second. Is this fast or slow for an
out-of-the-box installation of RabbitMQ 1.7.2 on a dual-core Intel Duo2,
2.66 GHz  box?

The more complete blog entry can be found here:

http://www.zopyx.de/blog/looking-beyond-ones-own-nose-looking-at-rabbitmq-and-mongodb

Andreas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100415/8b819d67/attachment.htm 

From matthew at lshift.net  Thu Apr 15 14:35:07 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 15 Apr 2010 14:35:07 +0100
Subject: [rabbitmq-discuss] Typical throughput of RabbitMQ
In-Reply-To: <h2i42d8a3d11004150630x8a990f2i7d8b1f132c5b9614@mail.gmail.com>
References: <h2i42d8a3d11004150630x8a990f2i7d8b1f132c5b9614@mail.gmail.com>
Message-ID: <20100415133506.GG1515@mrnibble.lshift.net>

Hi Andreas,

On Thu, Apr 15, 2010 at 03:30:10PM +0200, Andreas Jung wrote:
> I made some benchmark with RabbitMQ (and MongoDB) and got a throughput of
> 10k/second inserts into a queue with an average document size of 10 KB.
> This makes a throughput of roughly 10 MB/second. Is this fast or slow for an
> out-of-the-box installation of RabbitMQ 1.7.2 on a dual-core Intel Duo2,
> 2.66 GHz  box?

For that sort of machine with those message sizes, that sounds about
right. Is that with manual acking of messages or with noack set true?

Matthew



From lists at zopyx.com  Thu Apr 15 14:48:11 2010
From: lists at zopyx.com (Andreas Jung)
Date: Thu, 15 Apr 2010 15:48:11 +0200
Subject: [rabbitmq-discuss] Typical throughput of RabbitMQ
In-Reply-To: <20100415133506.GG1515@mrnibble.lshift.net>
References: <h2i42d8a3d11004150630x8a990f2i7d8b1f132c5b9614@mail.gmail.com>
	<20100415133506.GG1515@mrnibble.lshift.net>
Message-ID: <4BC7191B.80004@zopyx.com>

Matthew Sackman wrote:
> Hi Andreas,
>
> On Thu, Apr 15, 2010 at 03:30:10PM +0200, Andreas Jung wrote:
>> I made some benchmark with RabbitMQ (and MongoDB) and got a throughput of
>> 10k/second inserts into a queue with an average document size of 10 KB.
>> This makes a throughput of roughly 10 MB/second. Is this fast or slow for an
>> out-of-the-box installation of RabbitMQ 1.7.2 on a dual-core Intel Duo2,
>> 2.66 GHz  box?
>
> For that sort of machine with those message sizes, that sounds about
> right. Is that with manual acking of messages or with noack set true?

I can't tell about ack or noack. The Python script uses the carrot 
bindings for Python and I could get an answer by studying the carrot code.

Tnx,
Andreas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100415/78400b7f/attachment.vcf 

From aquino.gustavo at gmail.com  Thu Apr 15 15:38:11 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Thu, 15 Apr 2010 11:38:11 -0300
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <i2i167204d21004150351j4d8037c6q7c5698afafe11351@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
	<y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
	<v2s5ef296b31004141134i6b4e693cr4e70f31f7725042b@mail.gmail.com>
	<o2jc6114db61004141137q7ff6fbf5m818970fcfe61ac25@mail.gmail.com>
	<x2r167204d21004141208j1c03d41dycfebcd816d453509@mail.gmail.com>
	<z2o5ef296b31004141243lc0caf3amd83296bf9cfe0c39@mail.gmail.com>
	<h2j167204d21004141256jb5b40fdbscd275874f3141d60@mail.gmail.com>
	<k2r5ef296b31004141335xed6262fakc61b0d2037852bf@mail.gmail.com>
	<i2i167204d21004150351j4d8037c6q7c5698afafe11351@mail.gmail.com>
Message-ID: <s2l5ef296b31004150738r56589118u1f7a6c49c93e5b7b@mail.gmail.com>

Alexis,

On Thu, Apr 15, 2010 at 7:51 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gustavo,
>
> On Wed, Apr 14, 2010 at 9:35 PM, Gustavo Aquino
> <aquino.gustavo at gmail.com> wrote:
> > Alexis,
> > Why not one HA OOTB can be provided ?
>
> As I mentioned, we are about to release an HA Guide which provides our
> recommendation for HA today, that we can stand behind.  In other words
> - you can trust us to commercially support that solution and provide
> SLAs.
>
>
I trust you, you know, but we need to know what will be the road map for it.


> You are correct that we *could* provide a single configuration OOTB
> for HA.  The question is: which one.
>
> Bear in mind that HA behaviour combines:
>
> * Immediate acceptance
> * Immediate delivery
> * Eventual acceptance
> * Eventual delivery
>
> Note that:
>
> (a) these requirements are in tension with one another; so it is
> expensive to provide a system that is able to provide all of them at
> once so that, somehow, the system works out what each message needs
> and reacts accordingly based on need.
>
> (b) more importantly, the requirements are based on a notion of TIME.
> This is problematic because time based guarantees are
> non-deterministic.  For some systems an unavailability window of 1ms
> is fine because the client can wait.  For others it is too big.  Many
> things can affect this.  For example you could be running a messaging
> system on a real time Linux kernel, but still have variance in your
> failover window due to how your network and disk hardware is behaving
> based on (eg) load and contention.
>
> This is all ok, but we need to make our assumptions *explicit* for any
> one HA OOTB solution.
>
>
>
You are right. But some situations are the same of ppl, I think that a good
solution is We have this ways to do HA OOTB it's part of product, but if you
not attend you we can optimize it soing something like X,Y or
Z approaches... (your commercial support).


>
> > do you have one HP OOTB solution why
> > not HA ? May be one HA OOTB is not the best solution, and may be not
> attend
> > 100% of users but may be 70% and it's sounds good for me not for you ?.
>
> Yes that's fine Gustavo, but as soon as you make a promise about one
> configuration being "HA" then people immediately expect that you can
> do things that break the laws of physics.


> > We know about one AMQP product that have a HA OOTB solution, and we are
> > trying this "HA OOTB" and this product will be used in CME. But can't do
> the
> > same with RabbitMQ.
>
> Why don't you describe the main HA parameters that you need, on this
> list, and we can talk about them.
>
>
Sure, here is.

We have two scenarios for HA:
-  Cluster
- "Federation"

Cluster:

A* Cluster* will be a group of brokers that act as a single broker. Changes
on any broker are replicated to all other brokers in the same Messaging
Cluster, so if one broker fails, its clients can fail-over to another broker
without loss of state. The brokers in a Messaging Cluster may run on the
same host or on different hosts.
Clusters need to provide a reliable multicast protocol, tools, and
infrastructure for implementing replicated services.
Clusters need to uses an Active/Active model. In this model, all possible
brokers are active at all times. Producers and consumers can be connected to
any broker in the cluster. Additionally, any broker can be killed and
restarted, and the cluster will retain its operational state to provide
scalability and enhanced load-balancing.


"Federation":

Federation will be used to provide geographical distribution of brokers. A
number of individual brokers, or clusters of brokers, can be federated
together. This will allows client machines to see and interact with the
federation as though it were a single broker. Federation will be used where
client machines remain on a local network, even though their messages have
to be routed out.

Federation will be used for connecting disparate locations across a wide
area network. Full connectivity across an enterprise can be achieved while
keeping local message traffic isolated to a single location. Departmental
brokers can be specified with individual policies that control
inter-departmental message traffic flow.
Client produces data that must be delivered reliably but connectivity can
not be guaranteed. In this case, a co-resident broker provides queueing and
durability that is not available in the client on its own.

RabbitMQ provide a part of "Federation" but the problem is node dow all
others don't see more the queue and it broke all the process, and RabbitMQ
"route" don't guarantee delivery if one node is down out of local network,
today if one node is down all process fail.


> Also: Do you want to see a copy of the HA Guide?
>

I would like so much to get a copy of this guide.



> > I understand you, and you know my case, we are working in
> > microseconds/nanoseconds, may be this HA don't attend our requirements,
> but
> > it is one solutions and until now we don't have a good solution for HA
> using
> > Rabbit, about HP we don't need nothing to talk about RabbitMQ is very
> good
> > Broker routing 2.000.000 messages per second just inboud. But one good HA
> > solution is getting my sleep.
>
> I'm sorry to hear that we are keeping you awake at night.
>

No worry it's not your fault, it's part of IT skill :)


>
>
> > Do you know what we need,we talked about that is just one HA solution
> from
> > RabbitMQ with a very low latency, SLA and guarantee that no messages will
> be
> > loosed. O.S cluster or putting HA logic in our application is not a good
> > solution in our case.
>
> Actually, doing dedup on the consumer could be a very good solution
> based on what you have told me in the past.  But, let's keep
> discussing it.
>
> alexis
>

Great. let's discussing about.

Regards.

Gustavo



>
>
>
> > Regards.
> >
> >
> >
> > On Wed, Apr 14, 2010 at 4:56 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Gustavo
> >>
> >> We are about to release an HA Guide including recommendations.  It's
> >> just being reviewed.
> >>
> >> It is not possible to provide "HA OOTB" because each system is
> >> slightly different.  If someone tells you that they can support HA
> >> OOTB, they are misleading you.  What is possible, and desirable, is a
> >> much simpler and more "OOTB like" experience for the main four or five
> >> HA cases.  For example, the Beetle project aims to solve for cases
> >> where idempotency is desired.  Your case might require a different
> >> optimisation.  E.g. sometimes latency needs to be below X
> >> microseconds, and sometimes it does not.
> >>
> >> We are in the business of providing long term commercial support for
> >> RabbitMQ based solutions, including where an SLA is in use.  Just let
> >> us know what solution or solutions you need.
> >>
> >> alexis
> >>
> >>
> >>
> >> On Wed, Apr 14, 2010 at 8:43 PM, Gustavo Aquino
> >> <aquino.gustavo at gmail.com> wrote:
> >> > Alexis,
> >> > I know that it's not the unique, you know how much I'm looking for a
> >> > good HA
> >> > solutions using RabbitMQ. The problem is RabbitMQ doesn't have a
> default
> >> > solution out of the box for HA, and do you know companies need it,
> need
> >> > a
> >> > commitment from product owner about HA. Do my own solution means,
> >> > the responsible of maintenance and evolution of this solutions is my,
> >> > and it
> >> > is not my business it will be yours. Understand why I do this question
> >> > about
> >> > support ?
> >> > I'm a community enthusiast, and work hard of lot of open projects and
> is
> >> > a
> >> > pleasure if I can help to Rabbit HA, the point is today all products
> >> > inclusive cloud products need to have one HA solutions OTB, It's is
> the
> >> > best
> >> > ? may be not but need to have it, and today we have a problem of using
> >> > RabbitMQ because it don't have it. So how can I put Rabbit on my core
> if
> >> > cannot guarantee a single SLA, or without putting responsible in side
> >> > like
> >> > O.S cluster solution, OpenaIS, LVS shared storage or whatever.
> >> > Do you know any about the overhead in throughput using this Xing's
> >> > Solution
> >> > ?
> >> >
> >> > Best Regards.
> >> >
> >> > On Wed, Apr 14, 2010 at 4:08 PM, Alexis Richardson
> >> > <alexis.richardson at gmail.com> wrote:
> >> >>
> >> >> Thanks Salvatore.
> >> >>
> >> >> Gustavo,
> >> >>
> >> >> We and the community will support good solutions and 'things that
> >> >> work'.  I like the approach, but as Salvatore suggested - it is not
> >> >> unique.
> >> >>
> >> >> alexis
> >> >>
> >> >>
> >> >>
> >> >> On Wed, Apr 14, 2010 at 7:37 PM, Salvatore Sanfilippo
> >> >> <antirez at gmail.com>
> >> >> wrote:
> >> >> > On Wed, Apr 14, 2010 at 8:34 PM, Gustavo Aquino
> >> >> > <aquino.gustavo at gmail.com> wrote:
> >> >> >
> >> >> >> So if RabbitMQ is a VMWare product and Redis it too, so do Rabbit
> >> >> >> support
> >> >> >> this HA approach ? :-)
> >> >> >
> >> >> > I think that surely it helps that this feature depends from another
> >> >> > VMWare product ;)
> >> >> > But my guess is that the way to go is to have such a support
> built-in
> >> >> > for RabbitMQ.
> >> >> >
> >> >> > Ciao,
> >> >> > Salvatore
> >> >> >
> >> >> >> Regars.
> >> >> >>
> >> >> >> On Wed, Apr 14, 2010 at 2:09 PM, Jason J. W. Williams
> >> >> >> <jasonjwwilliams at gmail.com> wrote:
> >> >> >>>
> >> >> >>> Been reading the page since y'all started tweeting about it. :)
> >> >> >>> It's
> >> >> >>> hard to tell how it works.
> >> >> >>>
> >> >> >>> -J
> >> >> >>>
> >> >> >>> On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
> >> >> >>> <alexis.richardson at gmail.com> wrote:
> >> >> >>> > Hi everyone,
> >> >> >>> >
> >> >> >>> > It looks like Xing's Beetle project is up on Github:
> >> >> >>> > http://github.com/xing/beetle
> >> >> >>> >
> >> >> >>> > There is a project page here: http://xing.github.com/beetle/
> >> >> >>> >
> >> >> >>> > Please take a look and share any comments you may have here :-)
> >> >> >>> >
> >> >> >>> > alexis
> >> >> >>> >
> >> >> >>> > _______________________________________________
> >> >> >>> > rabbitmq-discuss mailing list
> >> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >>> >
> >> >> >>> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >>> >
> >> >> >>>
> >> >> >>> _______________________________________________
> >> >> >>> rabbitmq-discuss mailing list
> >> >> >>> rabbitmq-discuss at lists.rabbitmq.com
> >> >> >>>
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >>
> >> >> >>
> >> >> >
> >> >> >
> >> >> >
> >> >> > --
> >> >> > Salvatore 'antirez' Sanfilippo
> >> >> > http://invece.org
> >> >> >
> >> >> > "Once you have something that grows faster than education grows,
> >> >> > you?re always going to get a pop culture.", Alan Kay
> >> >> >
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100415/606ec09a/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 15 17:33:41 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 15 Apr 2010 17:33:41 +0100
Subject: [rabbitmq-discuss] Cool NoSQL conf next week in London
Message-ID: <t2j167204d21004150933k3cd44b8cpbdffc2ea47ac2ce1@mail.gmail.com>

Hi

It seems there is an affinity between messaging use cases and some of
those addressed by "NoSQL" data stores.  I feel our communities
overlap, so I am comfortable promoting this event on the list.  Below
is an email from James Governor, one of the organisers.  I understand
this is a pay-for event.

alexis






----

One of the hottest topics in software development right now is what is
being called NoSQL. What is that? Here is a definition from
no-sqldatabase.org

? ?NoSQL databases mostly address some of the points: being
non-relational, distributed, open-source and horizontal scalable. The
original intention has been modern web-scale databases. The movement began
early 2009 and is growing rapidly. Often more characteristics apply as:
schema-free, replication support, easy API, eventually consistency / BASE
(not ACID), and more. So the misleading term "nosql" (the community now
translates it mostly with "not only sql") should be seen as an alias to
something like the definition above.

There's just under a week to go until NoSQL Europe, our conference about
NoSQL technologies, and how you use them. We've got a fantastic line up,
including keynotes from Amazon's Werner Vogels, The Guardian's Matt Wall;
speakers from Twitter, The BBC, Rackspace, Basho, 10gen, Neo Technology
and many others over 2 days. We have some fantastic workshops lined up on
Riak, MongoDB, Redis, and Neo4J, from members of their development teams
or core contributors.

Are you a European web or enterprise developer interested in using
different approaches to scale data-driven apps, who wants to know Where
have All The Good Databases Gone? ?Then this is the show for you. Tickets
are available from

http://nosqleu.com/



From brian at fluggo.com  Thu Apr 15 17:33:52 2010
From: brian at fluggo.com (Brian Crowell)
Date: Thu, 15 Apr 2010 11:33:52 -0500
Subject: [rabbitmq-discuss] "Protocol wrong type for socket"
Message-ID: <w2t434e2bcd1004150933mf6af85e7r38d9f246a0b0366c@mail.gmail.com>

I downloaded and built rabbitmq-c on Debian, and right away I ran into
this trouble:

  $ ./examples/amqp_listen localhost 5672 amq.direct test
  Logging in: Protocol wrong type for socket

Now, this is my first time using RabbitMQ. I know the server is
listening to that port, but is there some other configuration I got
wrong?

--Brian



From david.wragg at lshift.net  Thu Apr 15 18:27:33 2010
From: david.wragg at lshift.net (David Wragg)
Date: Thu, 15 Apr 2010 18:27:33 +0100
Subject: [rabbitmq-discuss] "Protocol wrong type for socket"
In-Reply-To: <w2t434e2bcd1004150933mf6af85e7r38d9f246a0b0366c@mail.gmail.com>
	(Brian Crowell's message of "Thu\, 15 Apr 2010 11\:33\:52 -0500")
References: <w2t434e2bcd1004150933mf6af85e7r38d9f246a0b0366c@mail.gmail.com>
Message-ID: <k54ojchbi2.fsf@mrbraver.lshift.net>

Hi Brian,

Brian Crowell <brian at fluggo.com> writes:
> I downloaded and built rabbitmq-c on Debian, and right away I ran into
> this trouble:
>
>   $ ./examples/amqp_listen localhost 5672 amq.direct test
>   Logging in: Protocol wrong type for socket
>
> Now, this is my first time using RabbitMQ. I know the server is
> listening to that port, but is there some other configuration I got
> wrong?

It sounds like you might be running the AMQP 0.9.1 rabbitmq-c against
a AMQP 0.8 rabbitmq-server, or vice versa (e.g. one of them built from
the default branch, one from the amqp_0_9_1 branch).  Does that sound
likely?  You currently need to use a client and server for the same
AMQP version.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From jon.brisbin at npcinternational.com  Thu Apr 15 19:00:49 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 15 Apr 2010 13:00:49 -0500
Subject: [rabbitmq-discuss] Using ReplyTo
Message-ID: <5993E744-D209-4266-844B-923FC78CDBAE@npcinternational.com>

Maybe I'm not approaching this correctly. I was wondering how the ReplyTo property is meant to be used by the consumer that is supposed to reply to requests. I'd prefer not to have to assume an exchange, so I've been trying to figure out the best way to send responses back to clients.

I pushed some code to GitHub for a JMX MBean invoker that uses RabbitMQ and in the consumer that does the invoking, I take the ReplyTo property and split it on a comma (I've also experimented with a colon and other characters).

I just don't like the feel of this, though. Maybe it's okay, but I worry that having to rely on splitting the replyTo to get my exchange and routingKey values might break something. Maybe I should use a header value or even code the response exchange and queue into the body of the request?

I'd like to hear how others are using the replyTo in responding to requests...

Jon Brisbin
Portal Webmaster
NPC International, Inc.






From matthias at rabbitmq.com  Thu Apr 15 19:13:20 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Apr 2010 19:13:20 +0100
Subject: [rabbitmq-discuss] Using ReplyTo
In-Reply-To: <5993E744-D209-4266-844B-923FC78CDBAE@npcinternational.com>
References: <5993E744-D209-4266-844B-923FC78CDBAE@npcinternational.com>
Message-ID: <4BC75740.1090407@rabbitmq.com>

Jon,

Jon Brisbin wrote:
> Maybe I'm not approaching this correctly. I was wondering how the
> ReplyTo property is meant to be used by the consumer that is supposed
> to reply to requests. I'd prefer not to have to assume an exchange,
> so I've been trying to figure out the best way to send responses back
> to clients.

Typically the replyTo field contains the name of the reply queue. And 
you use that as the routing key of the reply message and send that 
message to the default exchange.

The default exchange mainly exists for this and similar use cases. You 
can think of it as providing a convenient mechanism for addressing 
queues directly, i.e. any message sent to the default exchange is routed 
to the queue named in the routing key.

Regards,

Matthias.



From jon.brisbin at npcinternational.com  Thu Apr 15 21:07:01 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 15 Apr 2010 15:07:01 -0500
Subject: [rabbitmq-discuss] to ack or not to ack? that is the question...
Message-ID: <B4B5D733-D737-4FC9-A440-9ED18F747194@npcinternational.com>

:)

I've noticed I'm a little schizophrenic when it comes to ACKing messages. I'm wondering how others handle whether or not (and at what point) I should acknowledge receipt of my messages.

In some cases, I apparently thought it was better to delay ACKing the message until the process has completely processed the message and either generated a result or produced an error. In other cases, I ACK the message as soon as I get it, which means I could lose it if there was a failure between the acknowledgement and the actual processing of the message. If I don't ACK it and hit an error, the message might be redelivered later. I'm not sure that's always desirable, given I often don't know what's in my messages (they're generic, but of specific "types").

Ugh. Any helpful hints on when it's appropriate to ACK an incoming message?

Thanks for the great help! (and all that for free ;)

Jon Brisbin
Portal Webmaster
NPC International, Inc.






From tonyg at lshift.net  Thu Apr 15 21:12:01 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 16 Apr 2010 08:12:01 +1200
Subject: [rabbitmq-discuss] "Protocol wrong type for socket"
In-Reply-To: <w2t434e2bcd1004150933mf6af85e7r38d9f246a0b0366c@mail.gmail.com>
References: <w2t434e2bcd1004150933mf6af85e7r38d9f246a0b0366c@mail.gmail.com>
Message-ID: <4BC77311.8090407@lshift.net>

Hi Brian,

Brian Crowell wrote:
> I downloaded and built rabbitmq-c on Debian

As David suggests, it's likely that you have the wrong branch of rabbitmq-c.
This is often caused by an obsolete behaviour of the web interface to the hg
repo, which offers a link to the most recent version on any branch rather than
the most recent version on the default branch. Try either of these approaches
to getting the code:

hg clone http://hg.rabbitmq.com/rabbitmq-c

or

wget http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz (not tip.tar.gz)

Regards,
  Tony



From tonyg at lshift.net  Thu Apr 15 21:15:20 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 16 Apr 2010 08:15:20 +1200
Subject: [rabbitmq-discuss] Using ReplyTo
In-Reply-To: <4BC75740.1090407@rabbitmq.com>
References: <5993E744-D209-4266-844B-923FC78CDBAE@npcinternational.com>
	<4BC75740.1090407@rabbitmq.com>
Message-ID: <4BC773D8.7030804@lshift.net>

Matthias Radestock wrote:
> Typically the replyTo field contains the name of the reply queue. And 
> you use that as the routing key of the reply message and send that 
> message to the default exchange.

To clarify, "default exchange" is AMQP jargon for the exchange with the
empty-string as its name.

  channel.basic_publish(exchange = "", routing_key = queue_name, ...)

The spec mandates that this exchange route directly to queues named the same as
the routing keys used. Whenever a queue is created, a binding for the queue is
automatically created on the default exchange.

Regards,
  Tony



From akalend at mail.ru  Thu Apr 15 21:33:11 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Fri, 16 Apr 2010 00:33:11 +0400
Subject: [rabbitmq-discuss] the draft code of the rabbitmq++ lib C++
In-Reply-To: <t2j167204d21004150933k3cd44b8cpbdffc2ea47ac2ce1@mail.gmail.com>
References: <t2j167204d21004150933k3cd44b8cpbdffc2ea47ac2ce1@mail.gmail.com>
Message-ID: <E1O2VkN-0001S9-00.akalend-mail-ru@f5.mail.ru>

Hi all,

I develope the draft code of the librabbitmq++, the C++ wrapper on the librabbitmq.
the code is http://code.google.com/p/rabbitcpp/

The code is draft.

TODO:
Makefile for library
more examples
API docs
multithreading for Consume (?)
more events


I wait  any ideas and critics form community.



Alexandre.




From brian at fluggo.com  Thu Apr 15 22:19:41 2010
From: brian at fluggo.com (Brian Crowell)
Date: Thu, 15 Apr 2010 16:19:41 -0500
Subject: [rabbitmq-discuss] "Protocol wrong type for socket"
In-Reply-To: <4BC77311.8090407@lshift.net>
References: <w2t434e2bcd1004150933mf6af85e7r38d9f246a0b0366c@mail.gmail.com>
	<4BC77311.8090407@lshift.net>
Message-ID: <k2x434e2bcd1004151419r852dbd7ctc4313a7e0a6c2465@mail.gmail.com>

On Thu, Apr 15, 2010 at 3:12 PM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> As David suggests, it's likely that you have the wrong branch of rabbitmq-c.

Yes, that sounds likely, but in this case I was following the
directions in the README. I'll go back to the 0-8 branch and try
again.

--Brian



From tonyg at lshift.net  Thu Apr 15 22:29:09 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 16 Apr 2010 09:29:09 +1200
Subject: [rabbitmq-discuss] to ack or not to ack? that is the question...
In-Reply-To: <B4B5D733-D737-4FC9-A440-9ED18F747194@npcinternational.com>
References: <B4B5D733-D737-4FC9-A440-9ED18F747194@npcinternational.com>
Message-ID: <4BC78525.4080200@lshift.net>

Hi Jon,

Whether 'tis nobler in the client to suffer the tedium of constant redeliveries
or to take arms against the tide of poisoned messages and by acknowledging, end
them?

You've hit on the two major approaches to responsibility-transfer that AMQP
supports:

 - At most once, where acking is immediate, before processing, or where
   no-ack mode is used

 - At least once, where acking is delayed until after processing.

(You get exactly-once by setting expiry timers appropriately and using a
deduplication filter in conjunction with at-least-once.)

There's no point in acking immediately you receive a message: you may as well
use no-ack mode, which lets the server be more efficient internally besides
automatically "acknowledging" the outbound message as it hits the wire toward
the client. If you have acknowledgements enabled, it makes more sense to
acknowledge after processing the message. (If you're doing exactly-once, then
"processing" could simply entail making a note of the message in the
deduplication filter.)

With regard to not knowing the content/types of a message, we often find that
segregating message types onto separate queues makes good sense. It permits the
use of different acking policies, which are configured on a per-consumer basis.

Regards,
  Tony




From hmolina at lapolar.cl  Thu Apr 15 22:32:58 2010
From: hmolina at lapolar.cl (Henry Molina)
Date: Thu, 15 Apr 2010 17:32:58 -0400
Subject: [rabbitmq-discuss] RabbitMQ running over XEN
Message-ID: <1271367178.4504.377.camel@juno>

Hi All,

I have RabbitMQ instaled over a VM with Xen as hypervisor from EPEL and
RabbitMQ does not start.

It shows at log:
"starting database   ...BOOT ERROR: FAILED"

# cat /var/log/rabbitmq/startup_err 
Erlang has closed
Error: {node_start_failed,normal}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()


# cat /var/log/rabbitmq/startup_log
Starting all nodes...
Starting node rabbit_at_dhc0 at dhac...

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.2  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit_at_dhc0 at dhac
app
descriptor: /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : 1X4mB+UG7ewYwedvaiHBlw==
log           : /var/log/rabbitmq/rabbit_at_dhc0.log
sasl log      : /var/log/rabbitmq/rabbit_at_dhc0-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit_at_dhc0

starting internal event notification
system                           ...done
starting logging
server                                               ...done
starting
database                                                     ...BOOT
ERROR: FAILED
Reason: {{case_clause,{ok,[]}},
         [{rabbit_mnesia,read_cluster_nodes_config,0},
          {rabbit_mnesia,init,0},
          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
          {rabbit,run_boot_step,1},
          {rabbit,'-start/2-lc$^0/1-0-',1},
          {rabbit,'-start/2-lc$^0/1-0-',1},
          {rabbit,start,2},
          {application_master,start_it_old,4}]}
{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}}},[{init,start_it,1},{init,start_em,1}]}}

Any Idea to solve this?

Regards,

Henry Molina

____________________________________________________________________________
La informacion  contenida en  este mensaje  y en sus documentos adjuntos, es
estrictamente  confidencial y privado para sus destinatarios. Cualquier uso,
reproduccion, divulgacion o distribucion no autorizada  de su contenido esta
estrictamente prohibida y puede ser sancionado criminalmente.
Si ha  recibido este  correo por  error,  solicitamos avisar  al remitente y
eliminarlo de su sistema. EMPRESAS LA POLAR S.A., y  sociedades relacionadas
directa o indirectamente con esta, no seran responsables del uso indebido de
este contenido o de los adjuntos al mismo.
____________________________________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100415/fa563ac3/attachment.htm 

From matthias at rabbitmq.com  Thu Apr 15 23:19:39 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Apr 2010 23:19:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ running over XEN
In-Reply-To: <1271367178.4504.377.camel@juno>
References: <1271367178.4504.377.camel@juno>
Message-ID: <4BC790FB.6070104@rabbitmq.com>

Henry,

Henry Molina wrote:
> I have RabbitMQ instaled over a VM with Xen as hypervisor from EPEL and 
> RabbitMQ does not start.

Xen? Never heard of it ;)

> Reason: {{case_clause,{ok,[]}},
>          [{rabbit_mnesia,read_cluster_nodes_config,0},
>           {rabbit_mnesia,init,0},

The most likely cause is that you have an invalid cluster config file 
(which usually lives in /etc/rabbitmq/rabbitmq_cluster.config). What's 
in that file?


Regards,

Matthias.



From aquino.gustavo at gmail.com  Fri Apr 16 13:05:21 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Fri, 16 Apr 2010 09:05:21 -0300
Subject: [rabbitmq-discuss] RabbitMQ HA with Redis
In-Reply-To: <s2l5ef296b31004150738r56589118u1f7a6c49c93e5b7b@mail.gmail.com>
References: <k2y167204d21004141002j937d346dp8d1f29f8b08570d5@mail.gmail.com>
	<y2l3b949f091004141009ze9262385j74634e152b540a81@mail.gmail.com>
	<v2s5ef296b31004141134i6b4e693cr4e70f31f7725042b@mail.gmail.com>
	<o2jc6114db61004141137q7ff6fbf5m818970fcfe61ac25@mail.gmail.com>
	<x2r167204d21004141208j1c03d41dycfebcd816d453509@mail.gmail.com>
	<z2o5ef296b31004141243lc0caf3amd83296bf9cfe0c39@mail.gmail.com>
	<h2j167204d21004141256jb5b40fdbscd275874f3141d60@mail.gmail.com>
	<k2r5ef296b31004141335xed6262fakc61b0d2037852bf@mail.gmail.com>
	<i2i167204d21004150351j4d8037c6q7c5698afafe11351@mail.gmail.com>
	<s2l5ef296b31004150738r56589118u1f7a6c49c93e5b7b@mail.gmail.com>
Message-ID: <q2z5ef296b31004160505gb642ee59saf7cd5a457b58b56@mail.gmail.com>

Anyone ?

On Thu, Apr 15, 2010 at 11:38 AM, Gustavo Aquino
<aquino.gustavo at gmail.com>wrote:

> Alexis,
>
> On Thu, Apr 15, 2010 at 7:51 AM, Alexis Richardson <
> alexis.richardson at gmail.com> wrote:
>
>> Gustavo,
>>
>> On Wed, Apr 14, 2010 at 9:35 PM, Gustavo Aquino
>> <aquino.gustavo at gmail.com> wrote:
>> > Alexis,
>> > Why not one HA OOTB can be provided ?
>>
>> As I mentioned, we are about to release an HA Guide which provides our
>> recommendation for HA today, that we can stand behind.  In other words
>> - you can trust us to commercially support that solution and provide
>> SLAs.
>>
>>
> I trust you, you know, but we need to know what will be the road map for
> it.
>
>
>> You are correct that we *could* provide a single configuration OOTB
>> for HA.  The question is: which one.
>>
>> Bear in mind that HA behaviour combines:
>>
>> * Immediate acceptance
>> * Immediate delivery
>> * Eventual acceptance
>> * Eventual delivery
>>
>> Note that:
>>
>> (a) these requirements are in tension with one another; so it is
>> expensive to provide a system that is able to provide all of them at
>> once so that, somehow, the system works out what each message needs
>> and reacts accordingly based on need.
>>
>> (b) more importantly, the requirements are based on a notion of TIME.
>> This is problematic because time based guarantees are
>> non-deterministic.  For some systems an unavailability window of 1ms
>> is fine because the client can wait.  For others it is too big.  Many
>> things can affect this.  For example you could be running a messaging
>> system on a real time Linux kernel, but still have variance in your
>> failover window due to how your network and disk hardware is behaving
>> based on (eg) load and contention.
>>
>> This is all ok, but we need to make our assumptions *explicit* for any
>> one HA OOTB solution.
>>
>>
>>
> You are right. But some situations are the same of ppl, I think that a good
> solution is We have this ways to do HA OOTB it's part of product, but if you
> not attend you we can optimize it soing something like X,Y or
> Z approaches... (your commercial support).
>
>
>>
>> > do you have one HP OOTB solution why
>> > not HA ? May be one HA OOTB is not the best solution, and may be not
>> attend
>> > 100% of users but may be 70% and it's sounds good for me not for you ?.
>>
>> Yes that's fine Gustavo, but as soon as you make a promise about one
>> configuration being "HA" then people immediately expect that you can
>> do things that break the laws of physics.
>
>
>> > We know about one AMQP product that have a HA OOTB solution, and we are
>> > trying this "HA OOTB" and this product will be used in CME. But can't do
>> the
>> > same with RabbitMQ.
>>
>> Why don't you describe the main HA parameters that you need, on this
>> list, and we can talk about them.
>>
>>
> Sure, here is.
>
> We have two scenarios for HA:
> -  Cluster
> - "Federation"
>
> Cluster:
>
> A* Cluster* will be a group of brokers that act as a single broker.
> Changes on any broker are replicated to all other brokers in the same
> Messaging Cluster, so if one broker fails, its clients can fail-over to
> another broker without loss of state. The brokers in a Messaging Cluster may
> run on the same host or on different hosts.
>  Clusters need to provide a reliable multicast protocol, tools, and
> infrastructure for implementing replicated services.
> Clusters need to uses an Active/Active model. In this model, all possible
> brokers are active at all times. Producers and consumers can be connected to
> any broker in the cluster. Additionally, any broker can be killed and
> restarted, and the cluster will retain its operational state to provide
> scalability and enhanced load-balancing.
>
>
> "Federation":
>
> Federation will be used to provide geographical distribution of brokers. A
> number of individual brokers, or clusters of brokers, can be federated
> together. This will allows client machines to see and interact with the
> federation as though it were a single broker. Federation will be used where
> client machines remain on a local network, even though their messages have
> to be routed out.
>
>  Federation will be used for connecting disparate locations across a wide
> area network. Full connectivity across an enterprise can be achieved while
> keeping local message traffic isolated to a single location. Departmental
> brokers can be specified with individual policies that control
> inter-departmental message traffic flow.
> Client produces data that must be delivered reliably but connectivity can
> not be guaranteed. In this case, a co-resident broker provides queueing and
> durability that is not available in the client on its own.
>
> RabbitMQ provide a part of "Federation" but the problem is node dow all
> others don't see more the queue and it broke all the process, and RabbitMQ
> "route" don't guarantee delivery if one node is down out of local network,
> today if one node is down all process fail.
>
>
>> Also: Do you want to see a copy of the HA Guide?
>>
>
> I would like so much to get a copy of this guide.
>
>
>
>> > I understand you, and you know my case, we are working in
>> > microseconds/nanoseconds, may be this HA don't attend our requirements,
>> but
>> > it is one solutions and until now we don't have a good solution for HA
>> using
>> > Rabbit, about HP we don't need nothing to talk about RabbitMQ is very
>> good
>> > Broker routing 2.000.000 messages per second just inboud. But one good
>> HA
>> > solution is getting my sleep.
>>
>> I'm sorry to hear that we are keeping you awake at night.
>>
>
> No worry it's not your fault, it's part of IT skill :)
>
>
>>
>>
>> > Do you know what we need,we talked about that is just one HA solution
>> from
>> > RabbitMQ with a very low latency, SLA and guarantee that no messages
>> will be
>> > loosed. O.S cluster or putting HA logic in our application is not a good
>> > solution in our case.
>>
>> Actually, doing dedup on the consumer could be a very good solution
>> based on what you have told me in the past.  But, let's keep
>> discussing it.
>>
>> alexis
>>
>
> Great. let's discussing about.
>
> Regards.
>
> Gustavo
>
>
>
>>
>>
>>
>> > Regards.
>> >
>> >
>> >
>> > On Wed, Apr 14, 2010 at 4:56 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Gustavo
>> >>
>> >> We are about to release an HA Guide including recommendations.  It's
>> >> just being reviewed.
>> >>
>> >> It is not possible to provide "HA OOTB" because each system is
>> >> slightly different.  If someone tells you that they can support HA
>> >> OOTB, they are misleading you.  What is possible, and desirable, is a
>> >> much simpler and more "OOTB like" experience for the main four or five
>> >> HA cases.  For example, the Beetle project aims to solve for cases
>> >> where idempotency is desired.  Your case might require a different
>> >> optimisation.  E.g. sometimes latency needs to be below X
>> >> microseconds, and sometimes it does not.
>> >>
>> >> We are in the business of providing long term commercial support for
>> >> RabbitMQ based solutions, including where an SLA is in use.  Just let
>> >> us know what solution or solutions you need.
>> >>
>> >> alexis
>> >>
>> >>
>> >>
>> >> On Wed, Apr 14, 2010 at 8:43 PM, Gustavo Aquino
>> >> <aquino.gustavo at gmail.com> wrote:
>> >> > Alexis,
>> >> > I know that it's not the unique, you know how much I'm looking for a
>> >> > good HA
>> >> > solutions using RabbitMQ. The problem is RabbitMQ doesn't have a
>> default
>> >> > solution out of the box for HA, and do you know companies need it,
>> need
>> >> > a
>> >> > commitment from product owner about HA. Do my own solution means,
>> >> > the responsible of maintenance and evolution of this solutions is my,
>> >> > and it
>> >> > is not my business it will be yours. Understand why I do this
>> question
>> >> > about
>> >> > support ?
>> >> > I'm a community enthusiast, and work hard of lot of open projects and
>> is
>> >> > a
>> >> > pleasure if I can help to Rabbit HA, the point is today all products
>> >> > inclusive cloud products need to have one HA solutions OTB, It's is
>> the
>> >> > best
>> >> > ? may be not but need to have it, and today we have a problem of
>> using
>> >> > RabbitMQ because it don't have it. So how can I put Rabbit on my core
>> if
>> >> > cannot guarantee a single SLA, or without putting responsible in side
>> >> > like
>> >> > O.S cluster solution, OpenaIS, LVS shared storage or whatever.
>> >> > Do you know any about the overhead in throughput using this Xing's
>> >> > Solution
>> >> > ?
>> >> >
>> >> > Best Regards.
>> >> >
>> >> > On Wed, Apr 14, 2010 at 4:08 PM, Alexis Richardson
>> >> > <alexis.richardson at gmail.com> wrote:
>> >> >>
>> >> >> Thanks Salvatore.
>> >> >>
>> >> >> Gustavo,
>> >> >>
>> >> >> We and the community will support good solutions and 'things that
>> >> >> work'.  I like the approach, but as Salvatore suggested - it is not
>> >> >> unique.
>> >> >>
>> >> >> alexis
>> >> >>
>> >> >>
>> >> >>
>> >> >> On Wed, Apr 14, 2010 at 7:37 PM, Salvatore Sanfilippo
>> >> >> <antirez at gmail.com>
>> >> >> wrote:
>> >> >> > On Wed, Apr 14, 2010 at 8:34 PM, Gustavo Aquino
>> >> >> > <aquino.gustavo at gmail.com> wrote:
>> >> >> >
>> >> >> >> So if RabbitMQ is a VMWare product and Redis it too, so do Rabbit
>> >> >> >> support
>> >> >> >> this HA approach ? :-)
>> >> >> >
>> >> >> > I think that surely it helps that this feature depends from
>> another
>> >> >> > VMWare product ;)
>> >> >> > But my guess is that the way to go is to have such a support
>> built-in
>> >> >> > for RabbitMQ.
>> >> >> >
>> >> >> > Ciao,
>> >> >> > Salvatore
>> >> >> >
>> >> >> >> Regars.
>> >> >> >>
>> >> >> >> On Wed, Apr 14, 2010 at 2:09 PM, Jason J. W. Williams
>> >> >> >> <jasonjwwilliams at gmail.com> wrote:
>> >> >> >>>
>> >> >> >>> Been reading the page since y'all started tweeting about it. :)
>> >> >> >>> It's
>> >> >> >>> hard to tell how it works.
>> >> >> >>>
>> >> >> >>> -J
>> >> >> >>>
>> >> >> >>> On Wed, Apr 14, 2010 at 11:02 AM, Alexis Richardson
>> >> >> >>> <alexis.richardson at gmail.com> wrote:
>> >> >> >>> > Hi everyone,
>> >> >> >>> >
>> >> >> >>> > It looks like Xing's Beetle project is up on Github:
>> >> >> >>> > http://github.com/xing/beetle
>> >> >> >>> >
>> >> >> >>> > There is a project page here: http://xing.github.com/beetle/
>> >> >> >>> >
>> >> >> >>> > Please take a look and share any comments you may have here
>> :-)
>> >> >> >>> >
>> >> >> >>> > alexis
>> >> >> >>> >
>> >> >> >>> > _______________________________________________
>> >> >> >>> > rabbitmq-discuss mailing list
>> >> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >>> >
>> >> >> >>> >
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >>> >
>> >> >> >>>
>> >> >> >>> _______________________________________________
>> >> >> >>> rabbitmq-discuss mailing list
>> >> >> >>> rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >>>
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >>
>> >> >> >>
>> >> >> >
>> >> >> >
>> >> >> >
>> >> >> > --
>> >> >> > Salvatore 'antirez' Sanfilippo
>> >> >> > http://invece.org
>> >> >> >
>> >> >> > "Once you have something that grows faster than education grows,
>> >> >> > you?re always going to get a pop culture.", Alan Kay
>> >> >> >
>> >> >
>> >> >
>> >
>> >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100416/5cbb6255/attachment.htm 

From rajesh.reddy at baml.com  Fri Apr 16 13:08:55 2010
From: rajesh.reddy at baml.com (Reddy, Rajesh (GPT EMEA))
Date: Fri, 16 Apr 2010 13:08:55 +0100
Subject: [rabbitmq-discuss] java client library rpc client
In-Reply-To: <269388e30909062259t381dfbc5of8b606738c6e38a1@mail.gmail.com>
Message-ID: <03FC0D29D4E88943AB7420C524BE848905AD6363@mllnc20mb056.emea.win.ml.com>

Hi

Iam having trouble using the java rpcclient for multiple replies.
Basically my process makes an rpccall and gets reply from one or more
other process. This works if the rpcclient receives one reply for its
request, but as soon as it gets multiple replies it fails. I get the
following exception which doesn't say much about the root cause.

The case here is the process should check for dependent process, so it
sends a rpc call to all existing process and then decide if the required
service is up and running.
This is possible in .NET library of rabbitmq and working fine.

Any help is appreciated.

Error:
Consumer com.rabbitmq.client.RpcClient$1 at b27c38 method handleDelivery
for channel
AMQChannel(amqp://guest at GBWMAPPROPC02.emea.win.ml.com:5672/,1) threw an
exception:
java.lang.NullPointerException
	at
com.rabbitmq.client.RpcClient$1.handleDelivery(RpcClient.java:153)
	at
com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:223)
	at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChan
nel.java:159)
	at
com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
	at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:4
24)

Thanks
Rajesh



--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. The information contained in this e-mail was obtained from sources believed to be reliable; however, the accuracy or completeness of this information is not guaranteed. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Past performance is no guarantee of future results. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 



From hmolina at lapolar.cl  Fri Apr 16 14:29:29 2010
From: hmolina at lapolar.cl (Henry Molina)
Date: Fri, 16 Apr 2010 09:29:29 -0400
Subject: [rabbitmq-discuss] RabbitMQ running over XEN
In-Reply-To: <4BC790FB.6070104@rabbitmq.com>
References: <1271367178.4504.377.camel@juno> <4BC790FB.6070104@rabbitmq.com>
Message-ID: <1271424569.4504.411.camel@juno>

Hi Matthias,

You are right, /etc/rabbitmq/rabbitmq_cluster.config was empty.

Regards,

Henry


El jue, 15-04-2010 a las 23:19 +0100, Matthias Radestock escribi?:
> Henry,
> 
> Henry Molina wrote:
> > I have RabbitMQ instaled over a VM with Xen as hypervisor from EPEL and 
> > RabbitMQ does not start.
> 
> Xen? Never heard of it ;)
> 
> > Reason: {{case_clause,{ok,[]}},
> >          [{rabbit_mnesia,read_cluster_nodes_config,0},
> >           {rabbit_mnesia,init,0},
> 
> The most likely cause is that you have an invalid cluster config file 
> (which usually lives in /etc/rabbitmq/rabbitmq_cluster.config). What's 
> in that file?
> 
> 
> Regards,
> 
> Matthias.


____________________________________________________________________________
La informacion  contenida en  este mensaje  y en sus documentos adjuntos, es
estrictamente  confidencial y privado para sus destinatarios. Cualquier uso,
reproduccion, divulgacion o distribucion no autorizada  de su contenido esta
estrictamente prohibida y puede ser sancionado criminalmente.
Si ha  recibido este  correo por  error,  solicitamos avisar  al remitente y
eliminarlo de su sistema. EMPRESAS LA POLAR S.A., y  sociedades relacionadas
directa o indirectamente con esta, no seran responsables del uso indebido de
este contenido o de los adjuntos al mismo.
____________________________________________________________________________



From simon at lshift.net  Fri Apr 16 18:07:01 2010
From: simon at lshift.net (Simon MacMullen)
Date: Fri, 16 Apr 2010 18:07:01 +0100
Subject: [rabbitmq-discuss] conceptual question
In-Reply-To: <20100411194955.GA19736@wellquite.org>
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>	<167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>	<897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>	<167204d20907031147m6ea1d8f8ke2248f3bf084e238@mail.gmail.com>	<4A607B6F.1090700@lshift.net>
	<28210868.post@talk.nabble.com>
	<20100411194955.GA19736@wellquite.org>
Message-ID: <4BC89935.9040803@lshift.net>

On 11/04/10 20:49, Matthew Sackman <matthew at lshift.net> said:
> On Sun, Apr 11, 2010 at 11:52:47AM -0700, Jim Stabile wrote:
>> What is the current status of this?  I want to use RabbitMQ across a WAN.
>> One publisher connected to a RabbitMQ server and a set of subscribers
>> connected to another RabbitMQ server (both servers in a cluster) over a WAN.
>> When a publish occurs, I want only 1 message to be sent from the publisher's
>> server to the subscriber's server (over the WAN) and then the fan-out
>> happens to all subscribers (last-mile fan-out).  I'm looking at RabbitMQ
>> 1.7.2.  Has this been addressed?  If not, is there a timeframe?
<snip re 1.7.2>
> However, we have code in development that after doing the fanout local
> to the publisher then groups together publishes to multiple queues on
> remote nodes, then forwarding the message once, with annotation to say
> which queues it should go to on the remote node. This code is nearly
> finished and will very likely appear in the next release of Rabbit.
>
> Simon is developing this code and hopefully will be able to say more as
> it gets finished.

This code is now ready to be looked at - it's in branch bug19844 of the 
broker. Currently it's passing all our automated tests and some 
preliminary performance testing shows no obvious regressions, and fairly 
obvious improvements fanning out across a cluster. It hasn't seen any 
more testing than that though. If you do try it, please let me know how 
you get on.

Cheers, Simon



From tonyg at lshift.net  Sat Apr 17 02:11:08 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 17 Apr 2010 13:11:08 +1200
Subject: [rabbitmq-discuss] conceptual question
In-Reply-To: <4BC89935.9040803@lshift.net>
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>	<167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>	<897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>	<167204d20907031147m6ea1d8f8ke2248f3bf084e238@mail.gmail.com>	<4A607B6F.1090700@lshift.net>	<28210868.post@talk.nabble.com>	<20100411194955.GA19736@wellquite.org>
	<4BC89935.9040803@lshift.net>
Message-ID: <4BC90AAC.4090301@lshift.net>

Simon, that's fantastic!

Tony


Simon MacMullen wrote:
> This code is now ready to be looked at - it's in branch bug19844 of the 
> broker. Currently it's passing all our automated tests and some 
> preliminary performance testing shows no obvious regressions, and fairly 
> obvious improvements fanning out across a cluster. It hasn't seen any 
> more testing than that though. If you do try it, please let me know how 
> you get on.
> 
> Cheers, Simon
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From akalend at mail.ru  Sat Apr 17 12:43:11 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Sat, 17 Apr 2010 15:43:11 +0400
Subject: [rabbitmq-discuss]
	=?windows-1251?q?the_draft_code_of_the_rabbitm?=
	=?windows-1251?q?q++_lib_C++?=
In-Reply-To: <E58E869F-3EA7-4618-8973-FFBA836E301D@there4i.am>
References: <E58E869F-3EA7-4618-8973-FFBA836E301D@there4i.am>
Message-ID: <E1O36QZ-0001zR-00.akalend-mail-ru@f242.mail.ru>

Hi S?bastien,

Thanks for attention. After develope the Makefile I make the svn repository.
The current version is static library from XCode project (XOs). 

You can download source  from download page http://code.google.com/p/rabbitcpp/downloads/list.

I have three example:
- Publish message (Declare exchange and bind),
- using GET (Declare queue and using GET)
-using Consume. The using Consume is not stable. I don't realise the Cancel an signal events.
I think to use the libevent.

Please join,
I include You in project as commiter or contributor.

Any ideas is big plus for project.


Alexandre.

Fri, 16 Apr 2010 20:51:22 -0500 ?????? ?? S?bastien <sebastien at there4i.am>:

> Hi Alexandre,
> 
> I am interested into diving the lib however, I don't see anything uploaded to the default subversion repository on Google Code. It would help if a repo was avail in order to provide proper potential patches ;)
> 
> Thank you already for getting this done, I was starting to feel the need to do that ;)
> 
> Cheers!
> 
> S?bastien Arnaud
> arnaudsj at gmail.com
> 
> On Apr 15, 2010, at 3:33 PM, Alexandre Kalendarev wrote:
> 
> > Hi all,
> > 
> > I develope the draft code of the librabbitmq++, the C++ wrapper on the librabbitmq.
> > the code is http://code.google.com/p/rabbitcpp/
> > 
> > The code is draft.
> > 
> > TODO:
> > Makefile for library
> > more examples
> > API docs
> > multithreading for Consume (?)
> > more events
> > 
> > 
> > I wait  any ideas and critics form community.
> > 
> > 
> > 
> > Alexandre.
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 



From polidore at gmail.com  Sat Apr 17 20:28:21 2010
From: polidore at gmail.com (Benjamin Polidore)
Date: Sat, 17 Apr 2010 15:28:21 -0400
Subject: [rabbitmq-discuss] rabbitmq-mochiweb
Message-ID: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>

hi, i'm trying to use the json-channel plugin, and it runs ok when i do make
test, but it doesn't seem to work when i try to start up my broker.  the
port is open, but everything returns 404.  what is mochiweb using as a
docroot when I run it outside make test?  sorry if this is obvious, but i've
been struggling with it for a couple hours.

thanks,
bp
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100417/4319baf6/attachment.htm 

From pauljones23 at gmail.com  Sat Apr 17 21:11:30 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Sat, 17 Apr 2010 21:11:30 +0100
Subject: [rabbitmq-discuss] rabbitmq-mochiweb
In-Reply-To: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>
References: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>
Message-ID: <v2x29598b611004171311h40594413pe1913f53ac5ec30@mail.gmail.com>

Hi Benjamin,

Which plugins have you installed into RabbitMQ? The mochiweb plugin alone
simply embeds a webserver - you'll need to install rabbitmq-jsonrpc and
rabbitmq-jsonrpc-channel to get the JSON services.

If you have done this, then you might be hitting the fact that when running
under test, an additional context is installed under the root that provides
all the various test examples. We don't activate this in the "production"
mode, since we don't expect you'll want them in a real deployment. The
scripts for doing JSON-RPC are still there though - under /rabbitmq_lib (the
scripts that are made available via this can be found on the filesystem in
priv/www).

I hope this answers your question.

Cheers,
Paul

On Sat, Apr 17, 2010 at 8:28 PM, Benjamin Polidore <polidore at gmail.com>wrote:

> hi, i'm trying to use the json-channel plugin, and it runs ok when i do
> make test, but it doesn't seem to work when i try to start up my broker.  the
> port is open, but everything returns 404.  what is mochiweb using as a
> docroot when I run it outside make test?  sorry if this is obvious, but i've
> been struggling with it for a couple hours.
>
> thanks,
> bp
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100417/afad673f/attachment.htm 

From tonyg at lshift.net  Sat Apr 17 23:25:38 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 18 Apr 2010 10:25:38 +1200
Subject: [rabbitmq-discuss]
 <rabbitmq-java-client-vxx>\test\src\com\rabbitmq\examples ---	are these
 supposed to work out of the box on all platforms, i.e., if they do not,
 is it considered a bug?
In-Reply-To: <h2j173a1edc1004120124web0049b5oa124cd64d81e6104@mail.gmail.com>
References: <h2j173a1edc1004120124web0049b5oa124cd64d81e6104@mail.gmail.com>
Message-ID: <4BCA3562.6000000@lshift.net>

Hi John,

John Apps wrote:
> The subject line says it all. Having spent some time, and also that of
> the folks on this list, running the above examples and finding several
> that do not work, i.e., crash

What circumstances do they crash under?

> I am now wondering if I am spending time on something which is shipped as an
> example, i.e., there is no guarantee that it will work on all supported
> platforms, e.g., Windows.

They should work on all supported platforms. Of course, machines and operating
systems differ, so the "examples" intended for finding the limits of stability
of RabbitMQ will need different parameters in each new context.

> This is a general question for now; specifics can be provided if there
> is interest in learning which of the examples do not work. MulticastMain
> comes to mind, StressPersister is another.

These are both for finding the limits of the system. They should run
identically on all platforms, but some platforms will perform worse than others
and so will require more conservative parameter settings.

Tony



From polidore at gmail.com  Sat Apr 17 23:29:30 2010
From: polidore at gmail.com (Benjamin Polidore)
Date: Sat, 17 Apr 2010 18:29:30 -0400
Subject: [rabbitmq-discuss] rabbitmq-mochiweb
In-Reply-To: <v2x29598b611004171311h40594413pe1913f53ac5ec30@mail.gmail.com>
References: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>
	<v2x29598b611004171311h40594413pe1913f53ac5ec30@mail.gmail.com>
Message-ID: <y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883@mail.gmail.com>

Hey, paul, I installed all the dependencies to rabbitmq-jsonrpc-channel (see
below).

I see that you add a little context in test mode.  Basically, I was hoping
to use the plugin to host my HTML and javascript in dev mode so I don't have
to run another webserver on my laptop.  I prefer to run rabbitmq in
"production" mode on my laptop, and I was curious what mochiweb thinks the
docroot is in this mode.

[{running_applications,
     [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
      {rabbit,"RabbitMQ","1.7.2"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9"},
      {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
      {mochiweb,"MochiMedia Web Server","0.01"},
      {mnesia,"MNESIA  CXC 138 12","4.4.13"},
      {stdlib,"ERTS  CXC 138 10","1.16.5"},
      {kernel,"ERTS  CXC 138 10","2.13.5"}]},
 {nodes,[rabbit at H5Pro]},
 {running_nodes,[rabbit at H5Pro]}]
...done.


On Sat, Apr 17, 2010 at 4:11 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Benjamin,
>
> Which plugins have you installed into RabbitMQ? The mochiweb plugin alone
> simply embeds a webserver - you'll need to install rabbitmq-jsonrpc and
> rabbitmq-jsonrpc-channel to get the JSON services.
>
> If you have done this, then you might be hitting the fact that when running
> under test, an additional context is installed under the root that provides
> all the various test examples. We don't activate this in the "production"
> mode, since we don't expect you'll want them in a real deployment. The
> scripts for doing JSON-RPC are still there though - under /rabbitmq_lib (the
> scripts that are made available via this can be found on the filesystem in
> priv/www).
>
> I hope this answers your question.
>
> Cheers,
> Paul
>
> On Sat, Apr 17, 2010 at 8:28 PM, Benjamin Polidore <polidore at gmail.com>wrote:
>
>> hi, i'm trying to use the json-channel plugin, and it runs ok when i do
>> make test, but it doesn't seem to work when i try to start up my broker.
>>   the port is open, but everything returns 404.  what is mochiweb using
>> as a docroot when I run it outside make test?  sorry if this is obvious, but
>> i've been struggling with it for a couple hours.
>>
>> thanks,
>> bp
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100417/03902481/attachment.htm 

From pauljones23 at gmail.com  Sat Apr 17 23:46:21 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Sat, 17 Apr 2010 23:46:21 +0100
Subject: [rabbitmq-discuss] rabbitmq-mochiweb
In-Reply-To: <y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883@mail.gmail.com>
References: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>
	<v2x29598b611004171311h40594413pe1913f53ac5ec30@mail.gmail.com>
	<y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883@mail.gmail.com>
Message-ID: <t2g29598b611004171546uc81a556axeac726f6b19527b4@mail.gmail.com>

Hi Benjamin,

In the production mode, mochiweb doesn't really have a docroot setup.
/rabbitmq_lib will serve the files in priv/www, but that is as far as it
goes.

However... if you want to serve some other files then you could always use
code similar to what the test mode does to make it happen. For example, if
you were to add:

Handler = rabbit_mochiweb:static_context_handler("", ?MODULE,
"priv/mydocroot"),
ok = rabbit_mochiweb:register_global_handler(Handler),

after the line:
rabbit_mochiweb:register_static_context(ContextRoot, ?MODULE, "priv/www")

in src/rabbit_jsonrpc_channel_app.erl, then once you've installed the plugin
into Rabbit, any file put into
priv/plugins/rabbitmq-jsonrpc-channel/priv/mydocroot should be served from
the root context of mochiweb.

BTW, I've just noticed a bug in the packaging of the jsonrpc-channel plugin
such that if you do run that plugin by installing it via a .ez, you'll need
to copy the priv/www directory into
priv/plugins/rabbitmq-jsonrpc-channel/priv/www (otherwise libraries such as
rabbitmq.js won't be available).

Thanks,
Paul.

On Sat, Apr 17, 2010 at 11:29 PM, Benjamin Polidore <polidore at gmail.com>wrote:

> Hey, paul, I installed all the dependencies to rabbitmq-jsonrpc-channel
> (see below).
>
> I see that you add a little context in test mode.  Basically, I was hoping
> to use the plugin to host my HTML and javascript in dev mode so I don't have
> to run another webserver on my laptop.  I prefer to run rabbitmq in
> "production" mode on my laptop, and I was curious what mochiweb thinks the
> docroot is in this mode.
>
> [{running_applications,
>      [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
>       {rabbit,"RabbitMQ","1.7.2"},
>       {os_mon,"CPO  CXC 138 46","2.2.5"},
>       {sasl,"SASL  CXC 138 11","2.1.9"},
>       {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
>       {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>       {mochiweb,"MochiMedia Web Server","0.01"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.13"},
>       {stdlib,"ERTS  CXC 138 10","1.16.5"},
>       {kernel,"ERTS  CXC 138 10","2.13.5"}]},
>  {nodes,[rabbit at H5Pro]},
>  {running_nodes,[rabbit at H5Pro]}]
> ...done.
>
>
> On Sat, Apr 17, 2010 at 4:11 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>
>> Hi Benjamin,
>>
>> Which plugins have you installed into RabbitMQ? The mochiweb plugin alone
>> simply embeds a webserver - you'll need to install rabbitmq-jsonrpc and
>> rabbitmq-jsonrpc-channel to get the JSON services.
>>
>> If you have done this, then you might be hitting the fact that when
>> running under test, an additional context is installed under the root that
>> provides all the various test examples. We don't activate this in the
>> "production" mode, since we don't expect you'll want them in a real
>> deployment. The scripts for doing JSON-RPC are still there though - under
>> /rabbitmq_lib (the scripts that are made available via this can be found on
>> the filesystem in priv/www).
>>
>> I hope this answers your question.
>>
>> Cheers,
>> Paul
>>
>> On Sat, Apr 17, 2010 at 8:28 PM, Benjamin Polidore <polidore at gmail.com>wrote:
>>
>>> hi, i'm trying to use the json-channel plugin, and it runs ok when i do
>>> make test, but it doesn't seem to work when i try to start up my broker.
>>>   the port is open, but everything returns 404.  what is mochiweb using
>>> as a docroot when I run it outside make test?  sorry if this is obvious, but
>>> i've been struggling with it for a couple hours.
>>>
>>> thanks,
>>> bp
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100417/d0f3a2ab/attachment.htm 

From scottblanc at gmail.com  Sun Apr 18 16:50:14 2010
From: scottblanc at gmail.com (Scott White)
Date: Sun, 18 Apr 2010 08:50:14 -0700
Subject: [rabbitmq-discuss] New persister (bug21673) crashed
Message-ID: <g2s401b577e1004180850s9c441d1dx60a5ac1971c35879@mail.gmail.com>

I am running the new persister and after running fine for several weeks, it
crashed last night. Please see crash low below. I'm not sure how to
interpret this, any ideas what the problem might be?

As far as the exact version of bug21673 I am using, here is what 'hg
summary' says: parent: 2886:cb9508e8ba5c tip.

thanks,
Scott

=CRASH REPORT==== 17-Apr-2010::06:22:21 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.8460.0>
    registered_name: []
    exception exit: {{case_clause,-1},
                     [{rabbit_variable_queue,maybe_deltas_to_betas,1},
                      {rabbit_variable_queue,purge1,2},
                      {rabbit_variable_queue,purge,1},
                      {rabbit_variable_queue,delete_and_terminate,1},
                      {rabbit_amqqueue_process,terminate,2},
                      {gen_server2,terminate,6},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/6
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.76.0>]
    messages: []
    links: [#Port<0.69768181>,#Port<0.69808272>,#Port<0.69829358>,
                  #Port<0.69840316>,#Port<0.69848264>,<0.203.0>,
                  #Port<0.69850558>,#Port<0.69843986>,#Port<0.69845960>,
                  #Port<0.69842083>,#Port<0.69835426>,#Port<0.69838384>,
                  #Port<0.69831846>,#Port<0.69820934>,#Port<0.69825572>,
                  #Port<0.69827261>,#Port<0.69828292>,#Port<0.69826371>,
                  #Port<0.69823799>,#Port<0.69824686>,#Port<0.69822313>,
                  #Port<0.69812856>,#Port<0.69815663>,#Port<0.69819626>,
                  #Port<0.69814184>,#Port<0.69810653>,#Port<0.69811678>,
                  #Port<0.69809311>,#Port<0.69787190>,#Port<0.69801954>,
                  #Port<0.69805475>,#Port<0.69806388>,#Port<0.69804319>,
                  #Port<0.69791263>,#Port<0.69797657>,#Port<0.69789361>,
                  #Port<0.69776999>,#Port<0.69782871>,#Port<0.69784792>,
                  #Port<0.69779328>,#Port<0.69773648>,#Port<0.69775618>,
                  #Port<0.69770946>,#Port<0.69743003>,#Port<0.69753805>,
                  #Port<0.69759344>,#Port<0.69764139>,#Port<0.69765926>,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100418/9f15de05/attachment.htm 

From matthew at lshift.net  Sun Apr 18 17:28:51 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 18 Apr 2010 17:28:51 +0100
Subject: [rabbitmq-discuss] New persister (bug21673) crashed
In-Reply-To: <g2s401b577e1004180850s9c441d1dx60a5ac1971c35879@mail.gmail.com>
References: <g2s401b577e1004180850s9c441d1dx60a5ac1971c35879@mail.gmail.com>
Message-ID: <20100418162850.GA23773@wellquite.org>

Hi Scott,

On Sun, Apr 18, 2010 at 08:50:14AM -0700, Scott White wrote:
> I am running the new persister and after running fine for several
> weeks, it
> crashed last night. Please see crash low below. I'm not sure how to
> interpret this, any ideas what the problem might be?

Yes, it recovered more off disk than it was expecting to. I have no idea
how that could happen, but quite a lot of code around there has changed
around the easter weekend, which is after the revision you're running.

I'm afraid there's nothing more I can suggest other than pulling,
updating to the latest and working from there.

Such a shame that it crashes as it's tidying up given that the queue is
being deleted!

Please let us know if you can repeat the crash either on the old
revision (in which case I'll be able to figure out if it's fixed on the
current head of bug21673), or on the current head.

Matthew



From matthew at lshift.net  Sun Apr 18 19:13:56 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 18 Apr 2010 19:13:56 +0100
Subject: [rabbitmq-discuss] New persister (bug21673) crashed
In-Reply-To: <20100418162850.GA23773@wellquite.org>
References: <g2s401b577e1004180850s9c441d1dx60a5ac1971c35879@mail.gmail.com>
	<20100418162850.GA23773@wellquite.org>
Message-ID: <20100418181356.GB23773@wellquite.org>

On Sun, Apr 18, 2010 at 05:28:51PM +0100, Matthew Sackman wrote:
> Yes, it recovered more off disk than it was expecting to. I have no idea
> how that could happen, but quite a lot of code around there has changed
> around the easter weekend, which is after the revision you're running.

Just some other questions: were you doing anything in particular with
the queue at the time? - had you just started up Rabbit or was it a long
running queue, what kind of actions were going on in the queue at the
time?

Matthew



From polidore at gmail.com  Sun Apr 18 19:31:12 2010
From: polidore at gmail.com (Benjamin Polidore)
Date: Sun, 18 Apr 2010 14:31:12 -0400
Subject: [rabbitmq-discuss] rabbitmq-mochiweb
In-Reply-To: <t2g29598b611004171546uc81a556axeac726f6b19527b4@mail.gmail.com>
References: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>
	<v2x29598b611004171311h40594413pe1913f53ac5ec30@mail.gmail.com>
	<y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883@mail.gmail.com>
	<t2g29598b611004171546uc81a556axeac726f6b19527b4@mail.gmail.com>
Message-ID: <g2n8801cb2b1004181131ieaa3f75fv1bf3dc0f5f99deb3@mail.gmail.com>

Thanks, Paul.  I decided not to mess with the source code, and I'm just
using OS X's built in apache for my static files.

Now I'm getting a different problem. I modified the test program to work in
this new context by changing the paths for loading the javascripts and
changing the urls in rabbitmq.js:

    factoryServiceUrl: *"http://h5pro.local:55672/rpc/rabbitmq",*
  rpcServiceUrlBase*: "http://h5pro.local:55672/rpc/",*

and in test.js:

    var channelFactory = new JsonRpc.Service("*
http://h5pro.local:55672/rpc/rabbitmq", *

But it doesn't work.  When I do an ngrep on the traffic going between my js
and mochiweb, I get:

T 10.0.1.3:60988 -> 10.0.1.3:55672 [AP]
  OPTIONS /rpc/rabbitmq HTTP/1.1..Host: h5pro.local:55672..Connection:
keep-alive..User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; e
  n-US) AppleWebKit/533.4 (KHTML, like Gecko) Chrome/5.0.375.9
Safari/533.4..Referer:
http://h5pro.local/~bp/rabbitTest/www-examples/test/..Access
  -Control-Request-Method: POST..Origin:
http://h5pro.local..Access-Control-Request-Headers:
X-Requested-With, Content-Type, Accept..Accept: */*..
  Accept-Encoding: gzip,deflate,sdch..Accept-Language:
en-US,en;q=0.8..Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3....

##
T 10.0.1.3:55672 -> 10.0.1.3:60988 [AP]
  HTTP/1.1 200 OK..Server: MochiWeb/1.0 (Any of you quaids got a
smint?)..Date: Sun, 18 Apr 2010 18:27:48 GMT..Content-type:
text/plain..Content-L
  ength: 155....

##
T 10.0.1.3:55672 -> 10.0.1.3:60988 [AP]
  {*
"version":"1.1","id":null,"error":{"name":"JSONRPCError","code":404,"message":"Procedure
not found","error":["http://h5pro.local:55672/rpc/rabb  itmq",""]}}    *
*
*
*Thoughts?       *
*
Thanks,
bp        *

On Sat, Apr 17, 2010 at 6:46 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Benjamin,
>
> In the production mode, mochiweb doesn't really have a docroot setup.
> /rabbitmq_lib will serve the files in priv/www, but that is as far as it
> goes.
>
> However... if you want to serve some other files then you could always use
> code similar to what the test mode does to make it happen. For example, if
> you were to add:
>
> Handler = rabbit_mochiweb:static_context_handler("", ?MODULE,
> "priv/mydocroot"),
> ok = rabbit_mochiweb:register_global_handler(Handler),
>
> after the line:
> rabbit_mochiweb:register_static_context(ContextRoot, ?MODULE, "priv/www")
>
> in src/rabbit_jsonrpc_channel_app.erl, then once you've installed the
> plugin into Rabbit, any file put into
> priv/plugins/rabbitmq-jsonrpc-channel/priv/mydocroot should be served from
> the root context of mochiweb.
>
> BTW, I've just noticed a bug in the packaging of the jsonrpc-channel plugin
> such that if you do run that plugin by installing it via a .ez, you'll need
> to copy the priv/www directory into
> priv/plugins/rabbitmq-jsonrpc-channel/priv/www (otherwise libraries such as
> rabbitmq.js won't be available).
>
> Thanks,
> Paul.
>
>
> On Sat, Apr 17, 2010 at 11:29 PM, Benjamin Polidore <polidore at gmail.com>wrote:
>
>> Hey, paul, I installed all the dependencies to rabbitmq-jsonrpc-channel
>> (see below).
>>
>> I see that you add a little context in test mode.  Basically, I was hoping
>> to use the plugin to host my HTML and javascript in dev mode so I don't have
>> to run another webserver on my laptop.  I prefer to run rabbitmq in
>> "production" mode on my laptop, and I was curious what mochiweb thinks the
>> docroot is in this mode.
>>
>> [{running_applications,
>>      [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
>>       {rabbit,"RabbitMQ","1.7.2"},
>>       {os_mon,"CPO  CXC 138 46","2.2.5"},
>>       {sasl,"SASL  CXC 138 11","2.1.9"},
>>       {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
>>       {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>>       {mochiweb,"MochiMedia Web Server","0.01"},
>>       {mnesia,"MNESIA  CXC 138 12","4.4.13"},
>>       {stdlib,"ERTS  CXC 138 10","1.16.5"},
>>       {kernel,"ERTS  CXC 138 10","2.13.5"}]},
>>  {nodes,[rabbit at H5Pro]},
>>  {running_nodes,[rabbit at H5Pro]}]
>> ...done.
>>
>>
>> On Sat, Apr 17, 2010 at 4:11 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>
>>> Hi Benjamin,
>>>
>>> Which plugins have you installed into RabbitMQ? The mochiweb plugin alone
>>> simply embeds a webserver - you'll need to install rabbitmq-jsonrpc and
>>> rabbitmq-jsonrpc-channel to get the JSON services.
>>>
>>> If you have done this, then you might be hitting the fact that when
>>> running under test, an additional context is installed under the root that
>>> provides all the various test examples. We don't activate this in the
>>> "production" mode, since we don't expect you'll want them in a real
>>> deployment. The scripts for doing JSON-RPC are still there though - under
>>> /rabbitmq_lib (the scripts that are made available via this can be found on
>>> the filesystem in priv/www).
>>>
>>> I hope this answers your question.
>>>
>>> Cheers,
>>> Paul
>>>
>>> On Sat, Apr 17, 2010 at 8:28 PM, Benjamin Polidore <polidore at gmail.com>wrote:
>>>
>>>> hi, i'm trying to use the json-channel plugin, and it runs ok when i do
>>>> make test, but it doesn't seem to work when i try to start up my broker.
>>>>   the port is open, but everything returns 404.  what is mochiweb using
>>>> as a docroot when I run it outside make test?  sorry if this is obvious, but
>>>> i've been struggling with it for a couple hours.
>>>>
>>>> thanks,
>>>> bp
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100418/acc783e0/attachment.htm 

From polidore at gmail.com  Sun Apr 18 22:10:46 2010
From: polidore at gmail.com (Benjamin Polidore)
Date: Sun, 18 Apr 2010 17:10:46 -0400
Subject: [rabbitmq-discuss] BQL crashes broker
Message-ID: <w2m8801cb2b1004181410m566fd5d6t542ba926b15e3db4@mail.gmail.com>

I'm having a similar issue to what I'm reading here:

lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-February/006192.html

When I install BQL and its dependencies, my broker crashes on startup:

broker running
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})

Here is my plugins dir:

/opt/local/lib/rabbitmq/lib/rabbitmq_server-1.7.2/plugins > ls -l
total 56
lrwxr-xr-x  1 root  admin  45 Apr 17 16:49 erlang-rfc4627 ->
../../rabbitmq-public-umbrella/erlang-rfc4627
lrwxr-xr-x  1 root  admin  62 Apr 17 16:48 mochiweb ->
../../rabbitmq-public-umbrella/rabbitmq-mochiweb/deps/mochiweb
lrwxr-xr-x  1 root  admin  43 Apr 18 17:03 rabbitmq-bql ->
../../rabbitmq-public-umbrella/rabbitmq-bql
lrwxr-xr-x  1 root  admin  53 Apr 18 17:02 rabbitmq-erlang-client ->
../../rabbitmq-public-umbrella/rabbitmq-erlang-client
lrwxr-xr-x  1 root  admin  47 Apr 17 16:48 rabbitmq-jsonrpc ->
../../rabbitmq-public-umbrella/rabbitmq-jsonrpc
lrwxr-xr-x  1 root  admin  55 Apr 17 16:48 rabbitmq-jsonrpc-channel ->
../../rabbitmq-public-umbrella/rabbitmq-jsonrpc-channel
lrwxr-xr-x  1 root  admin  48 Apr 17 16:47 rabbitmq-mochiweb ->
../../rabbitmq-public-umbrella/rabbitmq-mochiweb

When I read the guide:

www.rabbitmq.com/rabbitmq-bql.html

It says to install plugins that I already have like rfc4627 from the bql
folder.  I didn't do this to avoid duplication.  I also installed the amqp
client through its own dir rather than from inside the bql folder.

Thoughts?

Thanks,
bp
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100418/f2e774e8/attachment.htm 

From akalend at mail.ru  Sun Apr 18 22:59:55 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Mon, 19 Apr 2010 01:59:55 +0400
Subject: [rabbitmq-discuss] Draft of C++ rabbitMq API
Message-ID: <E1O3cWx-0005Wh-00.akalend-mail-ru@f174.mail.ru>

Hi All,

the source code of the lib http://code.google.com/p/rabbitcpp/source/checkout
add the Makefile


Alexandre



From fletchgqc at gmail.com  Mon Apr 19 12:30:43 2010
From: fletchgqc at gmail.com (John Fletcher)
Date: Mon, 19 Apr 2010 13:30:43 +0200
Subject: [rabbitmq-discuss] LIFO queue
Message-ID: <t2v1448e2901004190430q48d7c002sf4dbd6e886f93d3a@mail.gmail.com>

Hi, I'm just learning about messaging and I need to create a LIFO message
queue. I looked into it with ApacheMQ and it is apparently not easily
possible.

Does AMQP/RabbitMQ support LIFO / FILO?

Thanks,
John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100419/15a849eb/attachment.htm 

From sustrik at 250bpm.com  Mon Apr 19 12:59:24 2010
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Mon, 19 Apr 2010 13:59:24 +0200
Subject: [rabbitmq-discuss] LIFO queue
In-Reply-To: <t2v1448e2901004190430q48d7c002sf4dbd6e886f93d3a@mail.gmail.com>
References: <t2v1448e2901004190430q48d7c002sf4dbd6e886f93d3a@mail.gmail.com>
Message-ID: <4BCC459C.50303@250bpm.com>

John,

> Hi, I'm just learning about messaging and I need to create a LIFO 
> message queue. I looked into it with ApacheMQ and it is apparently not 
> easily possible.
> 
> Does AMQP/RabbitMQ support LIFO / FILO?

No. There's no such thing in AMQP. You won't find it even in non-AMQP 
solutions.

It would be extremely interesting to know a bit more about your use case 
though.

Martin



From videlalvaro at gmail.com  Mon Apr 19 14:41:00 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 19 Apr 2010 21:41:00 +0800
Subject: [rabbitmq-discuss] RabbitMQ seems to crash Snow Leopard
Message-ID: <F0C477BE-85CB-4ED3-9106-571D489BC914@gmail.com>

Hi,

I want to report a problem that I was able to reproduce twice and then I stopped before breaking my Mac :)

I want to state that I don't know if this is actually a bug or a problem related to RabbitMQ but it will be nice to know if it happens to other people.

How to reproduce it:

Open the default Mac Terminal.app

Get rabbitmq from the hg repo, ?if someone could tell me how to check in which branch I am, then I could provide that information?.

After building, do make run.

Then press command+q to quit the Terminal.app, and close it without stopping RabbitMQ, that should crash your mac, badly.

After I restarted the computer I repeated the steps and this happened again, while no other application was running.

Then I restarted and just opened Erlang typing erl at the Terminal and close it in the same way, no problems, so it seems to be happen when RabbitMQ is running.

As I said, this is not urgent or something to panic about, but it would be nice to know what's going on.

Regards,

Alvaro


From majek04 at gmail.com  Mon Apr 19 15:18:13 2010
From: majek04 at gmail.com (majek04)
Date: Mon, 19 Apr 2010 15:18:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ seems to crash Snow Leopard
In-Reply-To: <F0C477BE-85CB-4ED3-9106-571D489BC914@gmail.com>
References: <F0C477BE-85CB-4ED3-9106-571D489BC914@gmail.com>
Message-ID: <w2l3bb0d9711004190718k7c47bbb5p6741e3b82c549f8e@mail.gmail.com>

Confirmed. Any security researchers at the audience?

(Snow Leopard + full updates)

On Mon, Apr 19, 2010 at 14:41, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> I want to report a problem that I was able to reproduce twice and then I stopped before breaking my Mac :)
>
> I want to state that I don't know if this is actually a bug or a problem related to RabbitMQ but it will be nice to know if it happens to other people.
>
> How to reproduce it:
>
> Open the default Mac Terminal.app
>
> Get rabbitmq from the hg repo, ?if someone could tell me how to check in which branch I am, then I could provide that information?.
>
> After building, do make run.
>
> Then press command+q to quit the Terminal.app, and close it without stopping RabbitMQ, that should crash your mac, badly.
>
> After I restarted the computer I repeated the steps and this happened again, while no other application was running.
>
> Then I restarted and just opened Erlang typing erl at the Terminal and close it in the same way, no problems, so it seems to be happen when RabbitMQ is running.
>
> As I said, this is not urgent or something to panic about, but it would be nice to know what's going on.
>
> Regards,
>
> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From marc at worrell.nl  Mon Apr 19 15:32:15 2010
From: marc at worrell.nl (Marc Worrell)
Date: Mon, 19 Apr 2010 16:32:15 +0200
Subject: [rabbitmq-discuss] RabbitMQ seems to crash Snow Leopard
In-Reply-To: <w2l3bb0d9711004190718k7c47bbb5p6741e3b82c549f8e@mail.gmail.com>
References: <F0C477BE-85CB-4ED3-9106-571D489BC914@gmail.com>
	<w2l3bb0d9711004190718k7c47bbb5p6741e3b82c549f8e@mail.gmail.com>
Message-ID: <A1FC9B23-AC44-40F2-8697-F950F5E67302@worrell.nl>

This is a known problem for Erlang on Mac OS X.

http://groups.google.com/group/erlang-programming/browse_thread/thread/e94213f0ec897129

I see the same thing happening with our Zotonic CMS/framework.
Seems to be related with kernel polling and the crypto app.

I am using Erlang 13B03 and Mac OS X 10.6.3

- Marc


On 19 apr 2010, at 16:18, majek04 wrote:

> Confirmed. Any security researchers at the audience?
> 
> (Snow Leopard + full updates)
> 
> On Mon, Apr 19, 2010 at 14:41, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Hi,
>> 
>> I want to report a problem that I was able to reproduce twice and then I stopped before breaking my Mac :)
>> 
>> I want to state that I don't know if this is actually a bug or a problem related to RabbitMQ but it will be nice to know if it happens to other people.
>> 
>> How to reproduce it:
>> 
>> Open the default Mac Terminal.app
>> 
>> Get rabbitmq from the hg repo, ?if someone could tell me how to check in which branch I am, then I could provide that information?.
>> 
>> After building, do make run.
>> 
>> Then press command+q to quit the Terminal.app, and close it without stopping RabbitMQ, that should crash your mac, badly.
>> 
>> After I restarted the computer I repeated the steps and this happened again, while no other application was running.
>> 
>> Then I restarted and just opened Erlang typing erl at the Terminal and close it in the same way, no problems, so it seems to be happen when RabbitMQ is running.
>> 
>> As I said, this is not urgent or something to panic about, but it would be nice to know what's going on.
>> 
>> Regards,
>> 
>> Alvaro
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From videlalvaro at gmail.com  Mon Apr 19 17:44:08 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 20 Apr 2010 00:44:08 +0800
Subject: [rabbitmq-discuss] RabbitMQ seems to crash Snow Leopard
In-Reply-To: <A1FC9B23-AC44-40F2-8697-F950F5E67302@worrell.nl>
References: <F0C477BE-85CB-4ED3-9106-571D489BC914@gmail.com>
	<w2l3bb0d9711004190718k7c47bbb5p6741e3b82c549f8e@mail.gmail.com>
	<A1FC9B23-AC44-40F2-8697-F950F5E67302@worrell.nl>
Message-ID: <141BDB09-45BD-4EA8-A160-D1916F56753E@gmail.com>

Thanks for confirming guys.

- Alvaro

On Apr 19, 2010, at 10:32 PM, Marc Worrell wrote:

> This is a known problem for Erlang on Mac OS X.
> 
> http://groups.google.com/group/erlang-programming/browse_thread/thread/e94213f0ec897129
> 
> I see the same thing happening with our Zotonic CMS/framework.
> Seems to be related with kernel polling and the crypto app.
> 
> I am using Erlang 13B03 and Mac OS X 10.6.3
> 
> - Marc
> 
> 
> On 19 apr 2010, at 16:18, majek04 wrote:
> 
>> Confirmed. Any security researchers at the audience?
>> 
>> (Snow Leopard + full updates)
>> 
>> On Mon, Apr 19, 2010 at 14:41, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>> Hi,
>>> 
>>> I want to report a problem that I was able to reproduce twice and then I stopped before breaking my Mac :)
>>> 
>>> I want to state that I don't know if this is actually a bug or a problem related to RabbitMQ but it will be nice to know if it happens to other people.
>>> 
>>> How to reproduce it:
>>> 
>>> Open the default Mac Terminal.app
>>> 
>>> Get rabbitmq from the hg repo, ?if someone could tell me how to check in which branch I am, then I could provide that information?.
>>> 
>>> After building, do make run.
>>> 
>>> Then press command+q to quit the Terminal.app, and close it without stopping RabbitMQ, that should crash your mac, badly.
>>> 
>>> After I restarted the computer I repeated the steps and this happened again, while no other application was running.
>>> 
>>> Then I restarted and just opened Erlang typing erl at the Terminal and close it in the same way, no problems, so it seems to be happen when RabbitMQ is running.
>>> 
>>> As I said, this is not urgent or something to panic about, but it would be nice to know what's going on.
>>> 
>>> Regards,
>>> 
>>> Alvaro
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From tsuraan at gmail.com  Mon Apr 19 19:54:57 2010
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 19 Apr 2010 13:54:57 -0500
Subject: [rabbitmq-discuss] Non-crashing error
Message-ID: <i2r84fb38e31004191154wd489bba8ub3408da4ec729aeb@mail.gmail.com>

I'm getting this error in my rabbit.log, and nothing at all in my -sasl.log:

Error in process <0.3222.770> on node 'mqueue at master' with exit value:
{undef,[{rabbit_msg_store,sync,[]}]}

I can't find any place where :sync() is being called with no
arguments, and I don't have any sort of traceback.  the sasl.log is
empty, so there's no help there.  I'm not sure if this bug report is
of any value at all without that info, but I'm trying :)  The problem
that I've seen is that I very rarely get a failure to connect to
rabbit, but then it is working fine immediately afterwards.  There are
no printouts on the console where the rabbit server is running.

hg summary gives me "parent: 2964:dcf75e1958f6 tip".

If I can provide anything more useful, I'll be happy to.



From matthias at rabbitmq.com  Mon Apr 19 20:12:30 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Apr 2010 20:12:30 +0100
Subject: [rabbitmq-discuss] Non-crashing error
In-Reply-To: <i2r84fb38e31004191154wd489bba8ub3408da4ec729aeb@mail.gmail.com>
References: <i2r84fb38e31004191154wd489bba8ub3408da4ec729aeb@mail.gmail.com>
Message-ID: <4BCCAB1E.9000307@rabbitmq.com>

Tsuraan,

tsuraan wrote:
> I'm getting this error in my rabbit.log, and nothing at all in my -sasl.log:
> 
> Error in process <0.3222.770> on node 'mqueue at master' with exit value:
> {undef,[{rabbit_msg_store,sync,[]}]}

This got fixed in 
http://hg.rabbitmq.com/rabbitmq-server/rev/5ded8d0fb268 on 6th April.


Regards,

Matthias.



From tsuraan at gmail.com  Mon Apr 19 20:15:42 2010
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 19 Apr 2010 14:15:42 -0500
Subject: [rabbitmq-discuss] Non-crashing error
In-Reply-To: <4BCCAB1E.9000307@rabbitmq.com>
References: <i2r84fb38e31004191154wd489bba8ub3408da4ec729aeb@mail.gmail.com>
	<4BCCAB1E.9000307@rabbitmq.com>
Message-ID: <n2g84fb38e31004191215v6d590e2aoea394b5fa6cc2b9e@mail.gmail.com>

> This got fixed in http://hg.rabbitmq.com/rabbitmq-server/rev/5ded8d0fb268 on
> 6th April.

Aha, really out of date code again.  Sorry for the noise.



From tonyg at lshift.net  Tue Apr 20 02:53:16 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 20 Apr 2010 13:53:16 +1200
Subject: [rabbitmq-discuss] BQL crashes broker
In-Reply-To: <w2m8801cb2b1004181410m566fd5d6t542ba926b15e3db4@mail.gmail.com>
References: <w2m8801cb2b1004181410m566fd5d6t542ba926b15e3db4@mail.gmail.com>
Message-ID: <4BCD090C.3070800@lshift.net>

Anything in the log files?

Tony


Benjamin Polidore wrote:
> I'm having a similar issue to what I'm reading here:
> 
> lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-February/006192.html
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-February/006192.html>
> 
> When I install BQL and its dependencies, my broker crashes on startup:
> 
> broker running
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}}"}
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbitmq_bql,{shutdown,{rabbitmq_bql,start,[normal,[]]}}})
> 
> Here is my plugins dir:
> 
> /opt/local/lib/rabbitmq/lib/rabbitmq_server-1.7.2/plugins > ls -l
> total 56
> lrwxr-xr-x  1 root  admin  45 Apr 17 16:49 erlang-rfc4627 ->
> ../../rabbitmq-public-umbrella/erlang-rfc4627
> lrwxr-xr-x  1 root  admin  62 Apr 17 16:48 mochiweb ->
> ../../rabbitmq-public-umbrella/rabbitmq-mochiweb/deps/mochiweb
> lrwxr-xr-x  1 root  admin  43 Apr 18 17:03 rabbitmq-bql ->
> ../../rabbitmq-public-umbrella/rabbitmq-bql
> lrwxr-xr-x  1 root  admin  53 Apr 18 17:02 rabbitmq-erlang-client ->
> ../../rabbitmq-public-umbrella/rabbitmq-erlang-client
> lrwxr-xr-x  1 root  admin  47 Apr 17 16:48 rabbitmq-jsonrpc ->
> ../../rabbitmq-public-umbrella/rabbitmq-jsonrpc
> lrwxr-xr-x  1 root  admin  55 Apr 17 16:48 rabbitmq-jsonrpc-channel ->
> ../../rabbitmq-public-umbrella/rabbitmq-jsonrpc-channel
> lrwxr-xr-x  1 root  admin  48 Apr 17 16:47 rabbitmq-mochiweb ->
> ../../rabbitmq-public-umbrella/rabbitmq-mochiweb
> 
> When I read the guide:
> 
> www.rabbitmq.com/rabbitmq-bql.html
> <http://www.rabbitmq.com/rabbitmq-bql.html>
> 
> It says to install plugins that I already have like rfc4627 from the bql
> folder.  I didn't do this to avoid duplication.  I also installed the
> amqp client through its own dir rather than from inside the bql folder.  
> 
> Thoughts? 
> 
> Thanks,
> bp
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From akalend at mail.ru  Tue Apr 20 14:24:03 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Tue, 20 Apr 2010 17:24:03 +0400
Subject: [rabbitmq-discuss] =?windows-1251?q?php=5Frabbitmq_=26_Windows?=
Message-ID: <E1O4DQp-0003I3-00.akalend-mail-ru@f273.mail.ru>

Hi Collegues,

I was asked to compile php-RabbitMQ for Win (php_rabbit.dll)
If You can, please compilling for windows the last version php_rabbit and send me, I upload it to project.

Thanks


Alexandre



From majek04 at gmail.com  Tue Apr 20 14:32:53 2010
From: majek04 at gmail.com (majek04)
Date: Tue, 20 Apr 2010 14:32:53 +0100
Subject: [rabbitmq-discuss] php_rabbitmq & Windows
In-Reply-To: <E1O4DQp-0003I3-00.akalend-mail-ru@f273.mail.ru>
References: <E1O4DQp-0003I3-00.akalend-mail-ru@f273.mail.ru>
Message-ID: <o2m3bb0d9711004200632jcbc9e007y97adfb53751da416@mail.gmail.com>

We don't officially support neither C library nor PHP one.

On the other hand maybe some one from the list can help you.

Marek

On Tue, Apr 20, 2010 at 14:24, Alexandre Kalendarev <akalend at mail.ru> wrote:
> Hi Collegues,
>
> I was asked to compile php-RabbitMQ for Win (php_rabbit.dll)
> If You can, please compilling for windows the last version php_rabbit and send me, I upload it to project.
>
> Thanks
>
>
> Alexandre
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From david.wragg at lshift.net  Tue Apr 20 15:54:45 2010
From: david.wragg at lshift.net (David Wragg)
Date: Tue, 20 Apr 2010 15:54:45 +0100
Subject: [rabbitmq-discuss] php_rabbitmq & Windows
In-Reply-To: <o2m3bb0d9711004200632jcbc9e007y97adfb53751da416@mail.gmail.com>
	(majek's message of "Tue\, 20 Apr 2010 14\:32\:53 +0100")
References: <E1O4DQp-0003I3-00.akalend-mail-ru@f273.mail.ru>
	<o2m3bb0d9711004200632jcbc9e007y97adfb53751da416@mail.gmail.com>
Message-ID: <k5pr1ucgy2.fsf@mrbraver.lshift.net>

majek04 <majek04 at gmail.com> writes:
> We don't officially support neither C library nor PHP one.

Correct, though I would say there is a significant distinction between
the two:

We did write the rabbitmq-c client, and it is possible it will
graduate from being an experimental client to something we officially
support at some point.

On the other hand, the PHP library is not something we have any
first-hand experience with.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From john.harrison at hiveonline.co.uk  Tue Apr 20 16:47:43 2010
From: john.harrison at hiveonline.co.uk (John Harrison)
Date: Tue, 20 Apr 2010 10:47:43 -0500
Subject: [rabbitmq-discuss] help to get RabbitMQ working
Message-ID: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A0566F@34093-MBX-C10.mex07a.mlsrvr.com>



Hi,



I am trying to get rabbit working on a redhat server. I had no issues installing an running under mint. But am having real issues with this under redhat



The startup_log looks like this:



AMQP 8-0

Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.

Licensed under the MPL.  See http://www.rabbitmq.com/



node          : rabbit at 209011-file2

app descriptor: /usr/lib64/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app

home dir      : /var/lib/rabbitmq

cookie hash   : wiXVZraf3+Ou0MSKGQeJOg==

log           : /var/log/rabbitmq/rabbit.log

sasl log      : /var/log/rabbitmq/rabbit-sasl.log

database dir  : /var/lib/rabbitmq/mnesia/rabbit



starting internal event notification system                           ...done

starting logging server                                               ...done

starting database                                                     ...done

-- kernel ready

starting queue supervisor                                             ...done

starting node monitor                                                 ...done

starting cluster router                                               ...done

starting alarm handler                                                ...done

-- core initialized

starting empty DB check                                               ...done

starting exchange recovery                                            ...done

starting queue recovery                                               ...done

starting persister                                                    ...done

starting guid generator                                               ...done

-- message delivery logic ready

starting error log relay                                              ...done

starting networking                                                   ...BOOT ERROR: FAILED

Reason: {{badmatch,

             {error,

                 {shutdown,

                     {child,undefined,

                         'rabbit_tcp_listener_sup_127.0.0.1:5672',

                         {tcp_listener_sup,start_link,

                             [{127,0,0,1},

                              5672,

                              [binary,

                               {packet,raw},

                               {reuseaddr,true},

                               {exit_on_close,false}],

                              {rabbit_networking,tcp_listener_started,[]},

                              {rabbit_networking,tcp_listener_stopped,[]},

                              {rabbit_networking,start_client,[]},

                              "TCP Listener"]},

                         transient,infinity,supervisor,

                         [tcp_listener_sup]}}}},

         [{rabbit_networking,start_listener,4},

          {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},

          {rabbit_networking,boot_tcp,0},

          {rabbit_networking,boot,0},

          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},

          {rabbit,run_boot_step,1},

          {rabbit,'-start/2-lc$^0/1-0-',1},

          {rabbit,start,2}]}

Erlang has closed

{"init terminating in do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}}},[{init,start_it,1},{init,start_em,1}]}}



Crash dump was written to: erl_crash.dump

init terminating in do_boot ()







startup_err looks like



/etc/rabbitmq/rabbitmq.conf: line 1: NODENAME: command not found

/etc/rabbitmq/rabbitmq.conf: line 1: NODENAME: command not found

Erlang has closed



Crash dump was written to: erl_crash.dump

init terminating in do_boot ()

Error: {node_start_failed,normal}



Any suggestions please would be a great help







Regards



John Harrison

Developer

Hive

DD Telephone: +44(0) 1509 788944

Reception: +44 (0) 1509 882910

Fax: +44 (0) 1509 882911

Mobile: +44 (0) 7525 251520

E-mail: john.harrison at hiveonline.co.uk<mailto:*********@hiveonline.co.uk>

Address: Woodland Granaries, Narrow Lane, Wymeswold, Leicestershire LE12 6SD

www.hiveonline.co.uk<http://www.hiveonline.co.uk/>



Hive is a trading name of Hive Online Limited. Company registration number 500 7193. Registered address Woodland Granaries, Narrow Lane, Wymeswold, Leicestershire LE12 6SD.

This message is intended only for the use of the person(s) to whom it is addressed. It may contain information which is privileged and confidential. Accordingly any unauthorised use is strictly prohibited. If you are not the intended recipient, please contact the sender as soon as possible. Email transmission cannot be guaranteed to be secure or error free. Therefore, we do not represent that this information is complete or accurate and it should not be relied upon as such.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100420/f88ceb16/attachment.htm 

From aquino.gustavo at gmail.com  Tue Apr 20 17:59:02 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 20 Apr 2010 13:59:02 -0300
Subject: [rabbitmq-discuss] help to get RabbitMQ working
In-Reply-To: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A0566F@34093-MBX-C10.mex07a.mlsrvr.com>
References: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A0566F@34093-MBX-C10.mex07a.mlsrvr.com>
Message-ID: <z2j5ef296b31004200959r8e143e6ft1ccf53aabaa5e17e@mail.gmail.com>

What's the content of your */etc/rabbitmq/rabbitmq.conf ?*
*
*
***Regards.*

On Tue, Apr 20, 2010 at 12:47 PM, John Harrison <
john.harrison at hiveonline.co.uk> wrote:

>
>
> Hi,
>
>
>
> I am trying to get rabbit working on a redhat server. I had no issues
> installing an running under mint. But am having real issues with this under
> redhat
>
>
>
> The startup_log looks like this:
>
>
>
> *AMQP 8-0*
>
> *Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
> LLC., and Rabbit Technologies Ltd.*
>
> *Licensed under the MPL.  See http://www.rabbitmq.com/*
>
> * *
>
> *node          : rabbit at 209011-file2*
>
> *app descriptor:
> /usr/lib64/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app*
>
> *home dir      : /var/lib/rabbitmq*
>
> *cookie hash   : wiXVZraf3+Ou0MSKGQeJOg==*
>
> *log           : /var/log/rabbitmq/rabbit.log*
>
> *sasl log      : /var/log/rabbitmq/rabbit-sasl.log*
>
> *database dir  : /var/lib/rabbitmq/mnesia/rabbit*
>
> * *
>
> *starting internal event notification system
> ...done*
>
> *starting logging server
> ...done*
>
> *starting database
> ...done*
>
> *-- kernel ready*
>
> *starting queue supervisor
>                       ...done*
>
> *starting node monitor
> ...done*
>
> *starting cluster router
> ...done*
>
> *starting alarm handler
> ...done*
>
> *-- core initialized*
>
> *starting empty DB check
> ...done*
>
> *starting exchange recovery
> ...done*
>
> *starting queue recovery
> ...done*
>
> *starting persister
> ...done*
>
> *starting guid generator
> ...done*
>
> *-- message delivery logic ready*
>
> *starting error log relay
> ...done*
>
> *starting networking
> ...BOOT ERROR: FAILED*
>
> *Reason: {{badmatch,*
>
> *             {error,*
>
> *                 {shutdown,*
>
> *                     {child,undefined,*
>
> *                         'rabbit_tcp_listener_sup_127.0.0.1:5672',*
>
> *                         {tcp_listener_sup,start_link,*
>
> *                             [{127,0,0,1},*
>
> *                              5672,*
>
> *                              [binary,*
>
> *                               {packet,raw},*
>
> *                               {reuseaddr,true},*
>
> *                               {exit_on_close,false}],*
>
> *
> {rabbit_networking,tcp_listener_started,[]},*
>
> *
>               {rabbit_networking,tcp_listener_stopped,[]},*
>
> *                              {rabbit_networking,start_client,[]},*
>
> *                              "TCP Listener"]},*
>
> *                         transient,infinity,supervisor,*
>
> *                         [tcp_listener_sup]}}}},*
>
> *         [{rabbit_networking,start_listener,4},*
>
> *          {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},*
>
> *          {rabbit_networking,boot_tcp,0},*
>
> *          {rabbit_networking,boot,0},*
>
> *          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},*
>
> *          {rabbit,run_boot_step,1},*
>
> *          {rabbit,'-start/2-lc$^0/1-0-',1},*
>
> *          {rabbit,start,2}]}*
>
> *Erlang has closed*
>
> *{"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
> *
>
> * *
>
> *Crash dump was written to: erl_crash.dump*
>
> *init terminating in do_boot ()*
>
>
>
>
>
>
>
> startup_err looks like
>
>
>
> */etc/rabbitmq/rabbitmq.conf: line 1: NODENAME: command not found*
>
> */etc/rabbitmq/rabbitmq.conf: line 1: NODENAME: command not found*
>
> *Erlang has closed*
>
> * *
>
> *Crash dump was written to: erl_crash.dump*
>
> *init terminating in do_boot ()*
>
> *Error: {node_start_failed,normal}*
>
>
>
> Any suggestions please would be a great help
>
>
>
>
>
>
>
> Regards
>
>
>
> John Harrison
>
> Developer
>
> Hive
>
> DD Telephone: +44(0) 1509 788944
>
> Reception: +44 (0) 1509 882910
>
> Fax: +44 (0) 1509 882911
>
> Mobile: +44 (0) 7525 251520
>
> E-mail: john.harrison at hiveonline.co.uk <*********@hiveonline.co.uk>
>
> Address: Woodland Granaries, Narrow Lane, Wymeswold, Leicestershire LE12
> 6SD
>
> www.hiveonline.co.uk
>
>
>
> Hive is a trading name of Hive Online Limited. Company registration number
> 500 7193. Registered address Woodland Granaries, Narrow Lane, Wymeswold,
> Leicestershire LE12 6SD.
>
> This message is intended only for the use of the person(s) to whom it is
> addressed. It may contain information which is privileged and confidential.
> Accordingly any unauthorised use is strictly prohibited. If you are not the
> intended recipient, please contact the sender as soon as possible. Email
> transmission cannot be guaranteed to be secure or error free. Therefore, we
> do not represent that this information is complete or accurate and it should
> not be relied upon as such.
>
>
>
>
>
>
> __________ Information from ESET Smart Security, version of virus signature
> database 5044 (20100420) __________
>
> The message was checked by ESET Smart Security.
>
> http://www.eset.com
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100420/27309cff/attachment.htm 

From matthew at lshift.net  Tue Apr 20 18:35:38 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 20 Apr 2010 18:35:38 +0100
Subject: [rabbitmq-discuss] help to get RabbitMQ working
In-Reply-To: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A0566F@34093-MBX-C10.mex07a.mlsrvr.com>
References: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A0566F@34093-MBX-C10.mex07a.mlsrvr.com>
Message-ID: <20100420173537.GL1515@mrnibble.lshift.net>

Hi John,

What are the contents of your /etc/rabbitmq/rabbitmq.conf file ? I think
there's a bug in there.

Matthew



From john.harrison at hiveonline.co.uk  Tue Apr 20 20:47:03 2010
From: john.harrison at hiveonline.co.uk (John Harrison)
Date: Tue, 20 Apr 2010 14:47:03 -0500
Subject: [rabbitmq-discuss] help to get RabbitMQ working
In-Reply-To: <20100420173537.GL1515@mrnibble.lshift.net>
References: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A0566F@34093-MBX-C10.mex07a.mlsrvr.com>
	<20100420173537.GL1515@mrnibble.lshift.net>
Message-ID: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A057B3@34093-MBX-C10.mex07a.mlsrvr.com>

Thanks for the response.


I had put spaces in the .conf file which it did not like then I needed to kill all process for the rabbitmq user.


-----Original Message-----
From: Matthew Sackman [mailto:matthew at lshift.net]
Sent: 20 April 2010 18:36
To: John Harrison
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] help to get RabbitMQ working

Hi John,

What are the contents of your /etc/rabbitmq/rabbitmq.conf file ? I think
there's a bug in there.

Matthew


__________ Information from ESET Smart Security, version of virus signature database 5044 (20100420) __________

The message was checked by ESET Smart Security.

http://www.eset.com



__________ Information from ESET Smart Security, version of virus signature database 5044 (20100420) __________

The message was checked by ESET Smart Security.

http://www.eset.com




From pdezwart at rubiconproject.com  Tue Apr 20 22:34:21 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 20 Apr 2010 14:34:21 -0700
Subject: [rabbitmq-discuss] php_rabbitmq & Windows
In-Reply-To: <k5pr1ucgy2.fsf@mrbraver.lshift.net>
Message-ID: <C7F36BED.90DA%pdezwart@rubiconproject.com>

I want to clarify that no one is asking RabbitMQ or Lshift to officially
support anything. This is just one guy who is working very hard to help
RabbitMQ be accessible to more people by writing a PHP extension and C++
library, and who was hoping someone in the community might be able to
compile the PHP extension on a windows box for another RabbitMQ user who
doesn?t have the chops to do so.

I was disappointed to see these two responses from a community that so often
lends a helping hand. Furthermore, I would like to point out that the only
way for the C library to make it out of the experimental status is for the
community to test it in a billion different scenarios, and hopefully find a
maintainer to support Tony in its continued development. This is an
opportunity for the former, and, you never know, maybe for the latter.

So, again, to the community, Alex is looking for help from someone who can
compile the PHP extension on a windows box and run a sanity test against a
broker. The source for the library is here:
http://code.google.com/p/php-rabbit/

Thanks,
Pieter


On 4/20/10 7:54 AM, "David Wragg" <david.wragg at lshift.net> wrote:

> majek04 <majek04 at gmail.com> writes:
>> > We don't officially support neither C library nor PHP one.
> 
> Correct, though I would say there is a significant distinction between
> the two:
> 
> We did write the rabbitmq-c client, and it is possible it will
> graduate from being an experimental client to something we officially
> support at some point.
> 
> On the other hand, the PHP library is not something we have any
> first-hand experience with.
> 
> David
> 
> --
>  [][][] David Wragg       | mail: david.wragg at lshift.net
>    [][] Senior Developer  | tel: +44 (0)20 7729 7060
>  []  [] LShift Ltd        | web: www.lshift.net
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-- 
the rubicon project

PIETER DE ZWART | INTERFACES ENGINEER

??? P 310 207 0272 | x224
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100420/846f70c4/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100420/846f70c4/attachment.png 

From slfritchie at snookles.com  Tue Apr 20 23:16:34 2010
From: slfritchie at snookles.com (Scott Lystig Fritchie)
Date: Tue, 20 Apr 2010 17:16:34 -0500
Subject: [rabbitmq-discuss] Call for papers: ACM Erlang Workshop 2010
Message-ID: <75001.1271801794@snookles.snookles.com>

Hi, all.  It's been very exciting to see the work done on RabbitMQ by
Rabbit Technologies, LShift, and individual contributors on things like
message persistence, plugins, and control and monitoring.  I catch up
reading the mailing list archives about once per month, alas, so it's
difficult to keep up with all the innovation.

With all the good work happening ... there's got to be a paper or three
lurking, waiting to escape from your neurons and fingers, right?  :-)

Please consider a paper for the ACM Erlang Workshop this fall in
Baltimore, Maryland, USA.  This year, we have two tracks for authors to
write for; the call for papers is included below.  If you have any
questions about the workshop, suitable topics, or the submission &
review process, please contact me directly.

-Scott Lystig Fritchie
Workshop Chair, ACM Erlang Workshop 2010
 
--- snip --- snip --- snip --- snip --- snip --- snip --- snip ---

                      CALL FOR PAPERS
                Ninth ACM SIGPLAN Erlang Workshop
      Baltimore, Maryland, USA, Thursday, September 30, 2010

http://www.erlang.org/workshop/2010/

A satellite event of the 15th ACM SIGPLAN International
Conference on Functional Programming (ICFP)

Erlang is a concurrent, distributed functional programming language
aimed at systems with requirements on massive concurrency, soft real
time response, fault tolerance, and high availability. It has been
available as open source for over 10 years, creating a community that
actively contributes to its already existing rich set of libraries and
applications. Originally created for telecom applications, its usage
has spread to other domains including e-commerce, banking, databases,
and computer telephony and messaging.

Erlang programs are today among the largest applications written
in any functional programming language. These applications offer
new opportunities to evaluate functional programming and functional
programming methods on a very large scale and suggest new problems for
the research community to solve.

This workshop will bring together the open source, academic, and
industrial programming communities of Erlang. It will enable participants
to familiarize themselves with recent developments on new techniques and
tools tailored to Erlang, novel applications, draw lessons from users'
experiences and identify research problems and common areas relevant to
the practice of Erlang and functional programming.

We invite two sorts of submissions:

   1) technical papers describing language extensions, critical
   discussions of the status quo, formal semantics of language constructs,
   program analysis and transformation, virtual machine extensions and
   compilation techniques, implementations and interfaces of Erlang
   in/with other languages, and new tools (profilers, tracers, debuggers,
   testing frameworks, etc.)

   2) practice and application papers describing uses of Erlang in the
   "real-world", Erlang libraries for specific tasks, experiences from
   using Erlang in specific application domains, reusable programming
   idioms and elegant new ways of using Erlang to approach or solve a
   particular problem.

Workshop Chair

* Scott Lystig Fritchie, Gemini Mobile Technologies, Inc.

Program Chair

* Konstantinos Sagonas, National Technical University of Athens, Greece

Program Committee (the Workshop and Program Chairs are also committee members)

* Danny Dube               Universite Laval, Canada
* Garry Hodgson            AT&T Chief Security Office, U.S.A.
* Zoltan Horvath           Eotvos Lorand University, Hungary
* Mickael Remond           Process One, France
* Erik Stenman             Klarna AB
* Hans Svensson            Chalmers University of Technology, Sweden
* Simon Thompson           University of Kent, U.K.
* Ulf Wiger                Erlang Solutions Ltd, U.K.

Important Dates

* Submission deadline: Friday, June 11, 2010
* Author notification: Monday, June 28, 2010
* Final submission:    Monday, August 2, 2010
* Workshop date:       Thursday, September 30, 2010

Instructions to authors

Papers must be submitted online via EasyChair (via the "Erlang2010" event).

Submitted papers should be in portable document format (PDF), formatted
using the ACM SIGPLAN style guidelines. The length for technical papers
is restricted to 12 pages. For "Practice and Application" papers,
the length is restricted to 6 pages; papers in this cateogory may be
allocated less time for their talk and instead be given the opportunity
for a demo and/or poster session during the workshop. Each submission
must adhere to SIGPLAN's republication policy. Violation risks summary
rejection of the offending submission. Accepted papers will be published
by the ACM and will appear in the ACM Digital Library.

Venue & Registration Details

* For registration, please see the ICFP web site.

Related Links

* ICFP 2010 web site: http://www.icfpconference.org/icfp2010/
* Past ACM SIGPLAN Erlang workshops: http://www.erlang.se/workshop
* Open Source Erlang: http://www.erlang.org/
* EasyChair submission site: 
      https://www.easychair.org/account/signin.cgi?conf=erlang2010
* Author Information for SIGPLAN Conferences:
      http://www.sigplan.org/authorInformation.htm



From david.wragg at lshift.net  Tue Apr 20 23:55:52 2010
From: david.wragg at lshift.net (David Wragg)
Date: Tue, 20 Apr 2010 23:55:52 +0100
Subject: [rabbitmq-discuss] php_rabbitmq & Windows
In-Reply-To: <C7F36BED.90DA%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Tue\, 20 Apr 2010 14\:34\:21 -0700")
References: <C7F36BED.90DA%pdezwart@rubiconproject.com>
Message-ID: <k5633l3f9j.fsf@mrbraver.lshift.net>

Hi Pieter,

Like you, both myself and Marek would be delighted if someone in the
RabbitMQ community is able to help Alexandre.

I'm sorry if our responses came across as unhelpful.  I don't think it
was clear whether Alexandre's request was directed at the RabbitMQ
team, or the community.  In that context, we were just trying to
clarify the status of the C library and the PHP library.

While many peoeple have found rabbitmq-c to be useful, we know it has
some deficiencies, such as the difficulties of compiling it under
Windows.  We may get around to addressing this ourselves at some
point, but we'd be very happy to see someone from the community tackle
it if they are interested.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From johndapps at gmail.com  Wed Apr 21 08:55:47 2010
From: johndapps at gmail.com (John Apps)
Date: Wed, 21 Apr 2010 09:55:47 +0200
Subject: [rabbitmq-discuss] php_rabbitmq & Windows
In-Reply-To: <k5633l3f9j.fsf@mrbraver.lshift.net>
References: <C7F36BED.90DA%pdezwart@rubiconproject.com>
	<k5633l3f9j.fsf@mrbraver.lshift.net>
Message-ID: <r2x173a1edc1004210055t30edd924y559fc6897a7c5228@mail.gmail.com>

Time permitting along with sufficient expertise, I shall be more than happy
to help out with this. I have a Windows 7 X64 machine along with VS2010.

Brett Cameron has the libRabbitMQ library working just fine on OpenVMS; we
are in the process of developing a high-level language interface for it and
hope to have something in the near future, probably COBOL for starters
followed by FORTRAN and perhaps even PL/I (for those old and grey mainframe
developers like me).

You can follow our progress at http://www.johndapps.com/.

John
On Wed, Apr 21, 2010 at 00:55, David Wragg <david.wragg at lshift.net> wrote:

> Hi Pieter,
>
> Like you, both myself and Marek would be delighted if someone in the
> RabbitMQ community is able to help Alexandre.
>
> I'm sorry if our responses came across as unhelpful.  I don't think it
> was clear whether Alexandre's request was directed at the RabbitMQ
> team, or the community.  In that context, we were just trying to
> clarify the status of the C library and the PHP library.
>
> While many peoeple have found rabbitmq-c to be useful, we know it has
> some deficiencies, such as the difficulties of compiling it under
> Windows.  We may get around to addressing this ourselves at some
> point, but we'd be very happy to see someone from the community tackle
> it if they are interested.
>
> David
>
> --
>  [][][] David Wragg       | mail: david.wragg at lshift.net
>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
>  []  [] LShift Ltd        | web: www.lshift.net
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100421/fbaceac6/attachment.htm 

From Alister.Morton at tradition.com  Wed Apr 21 09:06:53 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Wed, 21 Apr 2010 09:06:53 +0100
Subject: [rabbitmq-discuss] php_rabbitmq & Windows
In-Reply-To: <k5633l3f9j.fsf@mrbraver.lshift.net>
References: <C7F36BED.90DA%pdezwart@rubiconproject.com>
	<k5633l3f9j.fsf@mrbraver.lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066F2B3B9B39@SVR-2K3-BH-EMC.tradition.int>

> While many peoeple have found rabbitmq-c to be useful, we know it has some deficiencies,
> such as the difficulties of compiling it under Windows.

That's been the biggest obstacle to me getting involved. I've ported stuff *from* MS environments to others before (PC->Vax for a real time bond evaluation system, for example) but I have so little familiarity with the specifics of the gcc compilers and the various switches, pragmas and other compiler specific constructs, and the whole linux/unix tool set that I don't know where to start - I've been working on PCs with C and its derivatives for so long now that there's a real element of tunnel vision.


The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From mlin at admob.com  Thu Apr 22 01:46:01 2010
From: mlin at admob.com (Mark Lin)
Date: Wed, 21 Apr 2010 17:46:01 -0700
Subject: [rabbitmq-discuss] rabbitmq-shovel
Message-ID: <D35D6AD7-E952-44C8-9277-BCFF5AF7FFE4@admob.com>

Wanted to get shovel to work, but am getting 

{amqp_error,access_refused,
                            "access to vhost 'vtest' refused for user 'shovel'",
                            'connection.open'}}

from the rabbit server.  

I am sure the username and password are correct.  From the bql security document, http://www.rabbitmq.com/rabbitmq-bql.html#bql-security-rules, showing the exact same error, it seems that I HAVE to use bql to grant permission to amq.default(which doesn't actually exist on the OSX 1.7.0 build of rabbitmq).  Instead of trying to get bql to work, I want to make sure I am heading toward the right direction.  Would appreciate any pointer from folks who have it working.


By the way, the version of rabbitmq-shovel I downloaded via hg has a few parameter modifications differ from given example in the blog:

>From rabbitmq-shovel/src/rabbit_shovel_sup.erl
reconnect becomes reconnect_delay
qos becomes prefetch_count

And this is not a valid parameter:
{delivery_mode, keep},


Thanks,
Mark


From scott at beamdog.com  Thu Apr 22 02:12:21 2010
From: scott at beamdog.com (Scott Brooks)
Date: Wed, 21 Apr 2010 19:12:21 -0600
Subject: [rabbitmq-discuss] rabbitmq-shovel
In-Reply-To: <D35D6AD7-E952-44C8-9277-BCFF5AF7FFE4@admob.com>
References: <D35D6AD7-E952-44C8-9277-BCFF5AF7FFE4@admob.com>
Message-ID: <v2yad81937d1004211812q3ba16d49q37e2e741aadaf3b0@mail.gmail.com>

I haven't used that shovel yet, but do you need to set the vhost to /vtest
rather then vtest?

I'm not sure if it's stripping the / or not.

Scott Brooks

On Wed, Apr 21, 2010 at 6:46 PM, Mark Lin <mlin at admob.com> wrote:

> Wanted to get shovel to work, but am getting
>
> {amqp_error,access_refused,
>                            "access to vhost 'vtest' refused for user
> 'shovel'",
>                            'connection.open'}}
>
> from the rabbit server.
>
> I am sure the username and password are correct.  From the bql security
> document, http://www.rabbitmq.com/rabbitmq-bql.html#bql-security-rules,
> showing the exact same error, it seems that I HAVE to use bql to grant
> permission to amq.default(which doesn't actually exist on the OSX 1.7.0
> build of rabbitmq).  Instead of trying to get bql to work, I want to make
> sure I am heading toward the right direction.  Would appreciate any pointer
> from folks who have it working.
>
>
> By the way, the version of rabbitmq-shovel I downloaded via hg has a few
> parameter modifications differ from given example in the blog:
>
> From rabbitmq-shovel/src/rabbit_shovel_sup.erl
> reconnect becomes reconnect_delay
> qos becomes prefetch_count
>
> And this is not a valid parameter:
> {delivery_mode, keep},
>
>
> Thanks,
> Mark
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100421/afc5201f/attachment.htm 

From matthias at rabbitmq.com  Thu Apr 22 07:40:37 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Apr 2010 07:40:37 +0100
Subject: [rabbitmq-discuss] rabbitmq-shovel
In-Reply-To: <D35D6AD7-E952-44C8-9277-BCFF5AF7FFE4@admob.com>
References: <D35D6AD7-E952-44C8-9277-BCFF5AF7FFE4@admob.com>
Message-ID: <4BCFEF65.7000902@rabbitmq.com>

Mark,

Mark Lin wrote:
> Wanted to get shovel to work, but am getting
> 
> {amqp_error,access_refused, "access to vhost 'vtest' refused for user
> 'shovel'", 'connection.open'}}
> 
> from the rabbit server.
> 
> I am sure the username and password are correct.

Have you granted the 'shovel' user access to the vhost 'vtest'? See 
http://www.rabbitmq.com/admin-guide.html#set_permissions - so something like
   rabbitmqctl set_permissions -p vtest shovel ".*" ".*" ".*"
should do the trick.

> From the bql security document,
> http://www.rabbitmq.com/rabbitmq-bql.html#bql-security-rules, showing
> the exact same error, it seems that I HAVE to use bql ...

No, you don't have to use bql; rabbitmqctl (which ships with the broker) 
is all you need.

> to grant permission to amq.default(which doesn't actually exist on
> the OSX 1.7.0 build of rabbitmq).

'amq.default' is a pseudonym for the otherwise nameless default 
exchange. From http://www.rabbitmq.com/admin-guide.html#access-control ...

"For convenience RabbitMQ maps AMQP's default exchange's blank name to 
'amq.default' when performing permission checks."

Whether or not the shovel user needs access to the default exchange 
depends on the rest of your shovel configuration. But in any case the 
".*" regexps in the above set_permissions call will cover that.

> By the way, the version of rabbitmq-shovel I downloaded via hg has a
> few parameter modifications differ from given example in the blog.

The shovel, like the rest of the code base, is evolving, so for the most 
up to date documentation always refer to the docs shipped with the code, 
i.e. http://hg.rabbitmq.com/rabbitmq-shovel/file/default/README in this 
case.


Regards,

Matthias.



From mark.geib at echostar.com  Thu Apr 22 17:36:07 2010
From: mark.geib at echostar.com (Mark Geib)
Date: Thu, 22 Apr 2010 10:36:07 -0600
Subject: [rabbitmq-discuss] erlang 1.6.0 client possible problem
Message-ID: <4BD07AF7.40801@echostar.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

We are using rabbitmq 1.6.x and the erlang client tagged for 1.6.0. We
have a system in production for many months now with no problems until
yesterday. The system in question receives data messages from many
sources, translates those messages into a binary encoded format and
publishes to the broker. Yesterday one of the sources started sending
larger messages that result in the encoded form exceeding 2k bytes.
Now when the erlang consumers get the messages from the broker they
appear to be corrupt, that is, they will not properly decoded from the
binary form. This only happens with the larger messages.

I get the message like this...

case lib_amqp:get(Channel, Queue, false) of
  basic.get_emtpy ->
     ...

  {DeliveryTag, Content} ->
     #content{payload_fragments_rev = Payload, class_id = ClassId,
properties_bin = Props} = Content,
     Message = list_to_binary(Payload),
     ...

Is there a limit to the payload size, at least in this version of the
erlang client.??

- -- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkvQeu0ACgkQNMVrR9CRdv1EjQCdGRN0pf1vuHqyuPPScGLeYk2H
ztIAn2Ws5BXfUV3E5G+5FU6rNGvdThsa
=WWHE
-----END PGP SIGNATURE-----




From matthew at lshift.net  Thu Apr 22 17:58:50 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 22 Apr 2010 17:58:50 +0100
Subject: [rabbitmq-discuss] erlang 1.6.0 client possible problem
In-Reply-To: <4BD07AF7.40801@echostar.com>
References: <4BD07AF7.40801@echostar.com>
Message-ID: <20100422165849.GB5655@mrnibble.lshift.net>

Hi Mark,

Needless to say, 1.6.0 is pretty ancient and we'd recommend that you
upgrade to the latest 1.7.2, where lib_amqp has vanished, and the
problem you're reporting has been abstracted away by the library.

On Thu, Apr 22, 2010 at 10:36:07AM -0600, Mark Geib wrote:
> case lib_amqp:get(Channel, Queue, false) of
>   basic.get_emtpy ->
>      ...
> 
>   {DeliveryTag, Content} ->
>      #content{payload_fragments_rev = Payload, class_id = ClassId,
> properties_bin = Props} = Content,
>      Message = list_to_binary(Payload),

The clue is in the name ;) payload_fragments_rev is a *reversed* list of
fragments. Thus you'll need to reverse it first. The reason this only
affects you with large messages is that smaller messages will be under
the max frame size, and thus will only be a single fragment.

Just ftr, if you do upgrade to 1.7.2, the API is now:

    {#'basic.get_ok'{}, #amqp_msg{payload = Payload}}
        = amqp_channel:call(Channel, #'basic.get'{queue = Q, no_ack = false}),

There, Payload is a single binary, not reversed, and not a list, thus
all the work has been done for you.

Best wishes,

Matthew



From mark.geib at echostar.com  Thu Apr 22 19:20:33 2010
From: mark.geib at echostar.com (Mark Geib)
Date: Thu, 22 Apr 2010 12:20:33 -0600
Subject: [rabbitmq-discuss] erlang 1.6.0 client possible problem
In-Reply-To: <20100422165849.GB5655@mrnibble.lshift.net>
References: <4BD07AF7.40801@echostar.com>
	<20100422165849.GB5655@mrnibble.lshift.net>
Message-ID: <4BD09371.4080400@echostar.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Matthew,

Thanks for the quick and helpful reply. That fixes my issue. We will
upgrade to the current release as soon as we can, but time is a little
short now.

Congratulations again on the Spring acquisition. Rabbitmq is by far
the highest quality product and support of all the OSS projects we
employ, and we use a fare number.

Thanks again,
Mark.

On 04/22/2010 10:58 AM, Matthew Sackman wrote:
> Hi Mark,
>
> Needless to say, 1.6.0 is pretty ancient and we'd recommend that
> you upgrade to the latest 1.7.2, where lib_amqp has vanished, and
> the problem you're reporting has been abstracted away by the
> library.
>
> On Thu, Apr 22, 2010 at 10:36:07AM -0600, Mark Geib wrote:
>> case lib_amqp:get(Channel, Queue, false) of basic.get_emtpy ->
>> ...
>>
>> {DeliveryTag, Content} -> #content{payload_fragments_rev =
>> Payload, class_id = ClassId, properties_bin = Props} = Content,
>> Message = list_to_binary(Payload),
>
> The clue is in the name ;) payload_fragments_rev is a *reversed*
> list of fragments. Thus you'll need to reverse it first. The reason
> this only affects you with large messages is that smaller messages
> will be under the max frame size, and thus will only be a single
> fragment.
>
> Just ftr, if you do upgrade to 1.7.2, the API is now:
>
> {#'basic.get_ok'{}, #amqp_msg{payload = Payload}} =
> amqp_channel:call(Channel, #'basic.get'{queue = Q, no_ack =
> false}),
>
> There, Payload is a single binary, not reversed, and not a list,
> thus all the work has been done for you.
>
> Best wishes,
>
> Matthew

- -- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkvQk3EACgkQNMVrR9CRdv0qIwCfdMNFQvJnoJIAiKdxz3rroIJI
fcoAn3/V2xMpGokNUGnS79hkWZ0XXg0F
=tcrn
-----END PGP SIGNATURE-----




From mark.geib at echostar.com  Thu Apr 22 19:43:14 2010
From: mark.geib at echostar.com (Mark Geib)
Date: Thu, 22 Apr 2010 12:43:14 -0600
Subject: [rabbitmq-discuss] erlang 1.6.0 client possible problem
In-Reply-To: <20100422165849.GB5655@mrnibble.lshift.net>
References: <4BD07AF7.40801@echostar.com>
	<20100422165849.GB5655@mrnibble.lshift.net>
Message-ID: <4BD098C2.8010606@echostar.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Matthew,

Followup question. Will the 1.7.x erlang client work with 1.6.0 brokers.?

I have also tried to use the erlang client tagged with the broker
version number.

Mark.

On 04/22/2010 10:58 AM, Matthew Sackman wrote:
> Hi Mark,
>
> Needless to say, 1.6.0 is pretty ancient and we'd recommend that
> you upgrade to the latest 1.7.2, where lib_amqp has vanished, and
> the problem you're reporting has been abstracted away by the
> library.
>
> On Thu, Apr 22, 2010 at 10:36:07AM -0600, Mark Geib wrote:
>> case lib_amqp:get(Channel, Queue, false) of basic.get_emtpy ->
>> ...
>>
>> {DeliveryTag, Content} -> #content{payload_fragments_rev =
>> Payload, class_id = ClassId, properties_bin = Props} = Content,
>> Message = list_to_binary(Payload),
>
> The clue is in the name ;) payload_fragments_rev is a *reversed*
> list of fragments. Thus you'll need to reverse it first. The reason
> this only affects you with large messages is that smaller messages
> will be under the max frame size, and thus will only be a single
> fragment.
>
> Just ftr, if you do upgrade to 1.7.2, the API is now:
>
> {#'basic.get_ok'{}, #amqp_msg{payload = Payload}} =
> amqp_channel:call(Channel, #'basic.get'{queue = Q, no_ack =
> false}),
>
> There, Payload is a single binary, not reversed, and not a list,
> thus all the work has been done for you.
>
> Best wishes,
>
> Matthew

- -- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkvQmMIACgkQNMVrR9CRdv2jWQCfYxKz6uns4tXcojEXFoeovgxb
uNIAnRhFVhazu02sOqR22dfyxTsq8E+s
=4ncH
-----END PGP SIGNATURE-----




From mlin at admob.com  Thu Apr 22 19:40:18 2010
From: mlin at admob.com (Mark Lin)
Date: Thu, 22 Apr 2010 11:40:18 -0700
Subject: [rabbitmq-discuss] rabbitmq-shovel
In-Reply-To: <4BCFEF65.7000902@rabbitmq.com>
References: <D35D6AD7-E952-44C8-9277-BCFF5AF7FFE4@admob.com>
	<4BCFEF65.7000902@rabbitmq.com>
Message-ID: <BBE17E07-1AE5-4F68-A76A-F79E41FAF677@admob.com>

Thank you!  It turns out my vhost name actually has "/" in the name. So I was specifying the wrong vhost name all along.  I guess since the default  vhost is "/", I was looking at it like uri, so I had to create vhost preceded by "/".

Always helpful to have another pair of eyes looking at the problem.


Two quick questions, is it possible to define multiple queue.bind in the same declaration?  This is to shovel traffic from multiple exchanges.    And can we use the Most-Recently-Declared-Queue in the resource definition and NOT have it persistent so if shovel dies, the queue dies with it instead of accumulate messages?


Thanks again,
Mark, happy shoveling.


On Apr 21, 2010, at 11:40 PM, Matthias Radestock wrote:

Mark,

Mark Lin wrote:
Wanted to get shovel to work, but am getting

{amqp_error,access_refused, "access to vhost 'vtest' refused for user
'shovel'", 'connection.open'}}

from the rabbit server.

I am sure the username and password are correct.

Have you granted the 'shovel' user access to the vhost 'vtest'? See
http://www.rabbitmq.com/admin-guide.html#set_permissions - so something like
  rabbitmqctl set_permissions -p vtest shovel ".*" ".*" ".*"
should do the trick.

>From the bql security document,
http://www.rabbitmq.com/rabbitmq-bql.html#bql-security-rules, showing
the exact same error, it seems that I HAVE to use bql ...

No, you don't have to use bql; rabbitmqctl (which ships with the broker)
is all you need.

to grant permission to amq.default(which doesn't actually exist on
the OSX 1.7.0 build of rabbitmq).

'amq.default' is a pseudonym for the otherwise nameless default
exchange. From http://www.rabbitmq.com/admin-guide.html#access-control ...

"For convenience RabbitMQ maps AMQP's default exchange's blank name to
'amq.default' when performing permission checks."

Whether or not the shovel user needs access to the default exchange
depends on the rest of your shovel configuration. But in any case the
".*" regexps in the above set_permissions call will cover that.

By the way, the version of rabbitmq-shovel I downloaded via hg has a
few parameter modifications differ from given example in the blog.

The shovel, like the rest of the code base, is evolving, so for the most
up to date documentation always refer to the docs shipped with the code,
i.e. http://hg.rabbitmq.com/rabbitmq-shovel/file/default/README in this
case.


Regards,

Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100422/77068848/attachment.htm 

From matthew at lshift.net  Thu Apr 22 19:56:03 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 22 Apr 2010 19:56:03 +0100
Subject: [rabbitmq-discuss] erlang 1.6.0 client possible problem
In-Reply-To: <4BD098C2.8010606@echostar.com>
References: <4BD07AF7.40801@echostar.com>
	<20100422165849.GB5655@mrnibble.lshift.net>
	<4BD098C2.8010606@echostar.com>
Message-ID: <20100422185603.GA27576@wellquite.org>

On Thu, Apr 22, 2010 at 12:43:14PM -0600, Mark Geib wrote:
> Followup question. Will the 1.7.x erlang client work with 1.6.0 brokers.?

The problem you will have is compiling the 1.7.x erlang client - it
needs to be compiled against the 1.7.x broker, because they share code.

However, *once* you have it compiled, you should find that the 1.7.x
erlang client works just fine with the 1.6.0 broker, though depending on
how you've got things installed, you may have issues with code paths and
the client finding code belonging to the 1.6.0 broker etc etc - if the
broker and client are on different machines then you'll be fine!

Also, because of the code sharing, using the direct connection will
almost certainly not work - you'll need to use the network connection.

Matthew



From matthew at lshift.net  Thu Apr 22 19:58:11 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 22 Apr 2010 19:58:11 +0100
Subject: [rabbitmq-discuss] rabbitmq-shovel
In-Reply-To: <BBE17E07-1AE5-4F68-A76A-F79E41FAF677@admob.com>
References: <D35D6AD7-E952-44C8-9277-BCFF5AF7FFE4@admob.com>
	<4BCFEF65.7000902@rabbitmq.com>
	<BBE17E07-1AE5-4F68-A76A-F79E41FAF677@admob.com>
Message-ID: <20100422185811.GB27576@wellquite.org>

On Thu, Apr 22, 2010 at 11:40:18AM -0700, Mark Lin wrote:
> Two quick questions, is it possible to define multiple queue.bind in
> the same declaration?.

Yes. There are no restrictions on the declarations at all.

>  And can we use the Most-Recently-Declared-Queue in the resource definition and NOT have it persistent so if shovel dies, the queue dies with it instead of accumulate messages?

Yes. When you declare the queue, make sure you set the auto-delete flag.

Matthew



From jcodev at gmail.com  Thu Apr 22 22:21:20 2010
From: jcodev at gmail.com (john odendahl)
Date: Thu, 22 Apr 2010 17:21:20 -0400
Subject: [rabbitmq-discuss] Broker stops accepting messages after 887
	messages sent
Message-ID: <g2ma4503d301004221421m2c2d8590u4e9750a032ad163f@mail.gmail.com>

Hello,
I'm running RabbitMQ on Suse linux, basically using a fresh out of box
installation running single node rabbitmq-server.
I have a java client doing a basicaPublish.

I start sending messages and on roughly the 887th message the broker stops
accepting messages.
I kill the broker (even try deleting /var/lib/rabbitmq), restart him. Same
thing, the 887th causes the broker to stop receiving messages.

I get the following stack trace on my client:

 java.io.IOException
 at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
 at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:254)
 at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:178)
 at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:227)
 at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:241)
 at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:252)
 at
com.ericsson.monaco.servers.MonacoServer.postMessage(MonacoServer.java:309)
 at com.ericsson.monaco.util.SessionLoadTest.main(SessionLoadTest.java:33)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
reason: java.net.SocketException: Software caused connection abort: recv
failed
 at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:588)
 at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:454)
Caused by: java.net.SocketException: Software caused connection abort: recv
failed
 at java.net.SocketInputStream.socketRead0(Native Method)
 at java.net.SocketInputStream.read(SocketInputStream.java:129)
 at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
 at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
 at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
 at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:117)
 at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:151)
 at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:379)
 at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:420)

Here is the code that sends a basic json string as the message:

channel.basicPublish(
  amqpExchange,
  routingKey,
  MessageProperties.PERSISTENT_TEXT_PLAIN,
  jsonString.getBytes());


Any ideas why this might be occurring?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100422/8ad265e8/attachment.htm 

From matthew at lshift.net  Thu Apr 22 22:29:24 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 22 Apr 2010 22:29:24 +0100
Subject: [rabbitmq-discuss] Broker stops accepting messages after 887
 messages sent
In-Reply-To: <g2ma4503d301004221421m2c2d8590u4e9750a032ad163f@mail.gmail.com>
References: <g2ma4503d301004221421m2c2d8590u4e9750a032ad163f@mail.gmail.com>
Message-ID: <20100422212923.GD27576@wellquite.org>

Hi John,

On Thu, Apr 22, 2010 at 05:21:20PM -0400, john odendahl wrote:
> I start sending messages and on roughly the 887th message the broker stops
> accepting messages.
> I kill the broker (even try deleting /var/lib/rabbitmq), restart him. Same
> thing, the 887th causes the broker to stop receiving messages.

I have a suspicion that the broker has raised channel.flow because it's
run out of memory and is thus preventing you from sending any further
messages. But 887 messages is very low, unless your messages are pretty
big. Also, the stack trace you sent doesn't really indicate this is the
problem. What does rabbit's logs have to say?

Matthew



From hmolina at lapolar.cl  Thu Apr 22 23:06:40 2010
From: hmolina at lapolar.cl (Henry Molina)
Date: Thu, 22 Apr 2010 18:06:40 -0400
Subject: [rabbitmq-discuss] Broker stops accepting messages after 887
 messages sent
In-Reply-To: <g2ma4503d301004221421m2c2d8590u4e9750a032ad163f@mail.gmail.com>
References: <g2ma4503d301004221421m2c2d8590u4e9750a032ad163f@mail.gmail.com>
Message-ID: <1271974000.3404.204.camel@juno>

Hi John,

How many channels are you using?

# rabbitmqctl list_channels

El jue, 22-04-2010 a las 17:21 -0400, john odendahl escribi?:
> Hello,
> I'm running RabbitMQ on Suse linux, basically using a fresh out of box
> installation running single node rabbitmq-server.
> I have a java client doing a basicaPublish. 
> 
> I start sending messages and on roughly the 887th message the broker
> stops accepting messages.
> I kill the broker (even try deleting /var/lib/rabbitmq), restart him.
> Same thing, the 887th causes the broker to stop receiving messages.
> 
> I get the following stack trace on my client:
>  
>  java.io.IOException
>  at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
>  at
> com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:254)
>  at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:178)
>  at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:227)
>  at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:241)
>  at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:252)
>  at
> com.ericsson.monaco.servers.MonacoServer.postMessage(MonacoServer.java:309)
>  at
> com.ericsson.monaco.util.SessionLoadTest.main(SessionLoadTest.java:33)
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection
> error; reason: java.net.SocketException: Software caused connection
> abort: recv failed
>  at
> com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:588)
>  at com.rabbitmq.client.impl.AMQConnection
> $MainLoop.run(AMQConnection.java:454)
> Caused by: java.net.SocketException: Software caused connection abort:
> recv failed
>  at java.net.SocketInputStream.socketRead0(Native Method)
>  at java.net.SocketInputStream.read(SocketInputStream.java:129)
>  at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
>  at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
>  at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
>  at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:117)
>  at
> com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:151)
>  at
> com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:379)
>  at com.rabbitmq.client.impl.AMQConnection
> $MainLoop.run(AMQConnection.java:420)
> 
> Here is the code that sends a basic json string as the message:
> 
> channel.basicPublish(
>   amqpExchange, 
>   routingKey, 
>   MessageProperties.PERSISTENT_TEXT_PLAIN, 
>   jsonString.getBytes());
> 
> 
> Any ideas why this might be occurring?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
Henry Molina
Jefe de Proyectos de Plataforma
Empresas La Polar S.A.
Avda. Eduardo Frei Montalva No 520, Renca
Santiago - Chile
Tel?fono: 383 3425
Direcci?n Internet: http://www.lapolar.cl

____________________________________________________________________________
La informacion  contenida en  este mensaje  y en sus documentos adjuntos, es
estrictamente  confidencial y privado para sus destinatarios. Cualquier uso,
reproduccion, divulgacion o distribucion no autorizada  de su contenido esta
estrictamente prohibida y puede ser sancionado criminalmente.
Si ha  recibido este  correo por  error,  solicitamos avisar  al remitente y
eliminarlo de su sistema. EMPRESAS LA POLAR S.A., y  sociedades relacionadas
directa o indirectamente con esta, no seran responsables del uso indebido de
este contenido o de los adjuntos al mismo.
____________________________________________________________________________


From polidore at gmail.com  Fri Apr 23 01:31:04 2010
From: polidore at gmail.com (Benjamin Polidore)
Date: Thu, 22 Apr 2010 20:31:04 -0400
Subject: [rabbitmq-discuss] rabbitmq-mochiweb
In-Reply-To: <g2n8801cb2b1004181131ieaa3f75fv1bf3dc0f5f99deb3@mail.gmail.com>
References: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>
	<v2x29598b611004171311h40594413pe1913f53ac5ec30@mail.gmail.com>
	<y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883@mail.gmail.com>
	<t2g29598b611004171546uc81a556axeac726f6b19527b4@mail.gmail.com>
	<g2n8801cb2b1004181131ieaa3f75fv1bf3dc0f5f99deb3@mail.gmail.com>
Message-ID: <v2i8801cb2b1004221731r26c8e94djeae51da8e8e799d@mail.gmail.com>

hey, i can't seem to get past this. i'm probably doing something silly, but
i keep getting:

{"version":"1.1","id":null,"error":{"name":"JSONRPCError","code":404,"message":"Procedure
not found","error":["http://h5pro.local:55672/rpc/rabbitmq",""]}}

when i run the test.js from my mac's apache server.  is there a dead
simple way to test that jsonrpc-channel is working when it's running
as a plugin?


On Sun, Apr 18, 2010 at 2:31 PM, Benjamin Polidore <polidore at gmail.com>wrote:

> Thanks, Paul.  I decided not to mess with the source code, and I'm just
> using OS X's built in apache for my static files.
>
> Now I'm getting a different problem. I modified the test program to work in
> this new context by changing the paths for loading the javascripts and
> changing the urls in rabbitmq.js:
>
>     factoryServiceUrl: *"http://h5pro.local:55672/rpc/rabbitmq",*
>   rpcServiceUrlBase*: "http://h5pro.local:55672/rpc/",*
>
> and in test.js:
>
>     var channelFactory = new JsonRpc.Service("*
> http://h5pro.local:55672/rpc/rabbitmq", *
>
> But it doesn't work.  When I do an ngrep on the traffic going between my js
> and mochiweb, I get:
>
> T 10.0.1.3:60988 -> 10.0.1.3:55672 [AP]
>   OPTIONS /rpc/rabbitmq HTTP/1.1..Host: h5pro.local:55672..Connection:
> keep-alive..User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; e
>   n-US) AppleWebKit/533.4 (KHTML, like Gecko) Chrome/5.0.375.9
> Safari/533.4..Referer:
> http://h5pro.local/~bp/rabbitTest/www-examples/test/..Access
>   -Control-Request-Method: POST..Origin: http://h5pro.local..Access-Control-Request-Headers:
> X-Requested-With, Content-Type, Accept..Accept: */*..
>   Accept-Encoding: gzip,deflate,sdch..Accept-Language:
> en-US,en;q=0.8..Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3....
>
> ##
> T 10.0.1.3:55672 -> 10.0.1.3:60988 [AP]
>   HTTP/1.1 200 OK..Server: MochiWeb/1.0 (Any of you quaids got a
> smint?)..Date: Sun, 18 Apr 2010 18:27:48 GMT..Content-type:
> text/plain..Content-L
>   ength: 155....
>
> ##
> T 10.0.1.3:55672 -> 10.0.1.3:60988 [AP]
>   {*
> "version":"1.1","id":null,"error":{"name":"JSONRPCError","code":404,"message":"Procedure
> not found","error":["http://h5pro.local:55672/rpc/rabb  itmq",""]}}    *
> *
> *
> *Thoughts?       *
> *
> Thanks,
> bp        *
>
> On Sat, Apr 17, 2010 at 6:46 PM, Paul Jones <pauljones23 at gmail.com> wrote:
>
>> Hi Benjamin,
>>
>> In the production mode, mochiweb doesn't really have a docroot setup.
>> /rabbitmq_lib will serve the files in priv/www, but that is as far as it
>> goes.
>>
>> However... if you want to serve some other files then you could always use
>> code similar to what the test mode does to make it happen. For example, if
>> you were to add:
>>
>> Handler = rabbit_mochiweb:static_context_handler("", ?MODULE,
>> "priv/mydocroot"),
>> ok = rabbit_mochiweb:register_global_handler(Handler),
>>
>> after the line:
>> rabbit_mochiweb:register_static_context(ContextRoot, ?MODULE, "priv/www")
>>
>> in src/rabbit_jsonrpc_channel_app.erl, then once you've installed the
>> plugin into Rabbit, any file put into
>> priv/plugins/rabbitmq-jsonrpc-channel/priv/mydocroot should be served from
>> the root context of mochiweb.
>>
>> BTW, I've just noticed a bug in the packaging of the jsonrpc-channel
>> plugin such that if you do run that plugin by installing it via a .ez,
>> you'll need to copy the priv/www directory into
>> priv/plugins/rabbitmq-jsonrpc-channel/priv/www (otherwise libraries such as
>> rabbitmq.js won't be available).
>>
>> Thanks,
>> Paul.
>>
>>
>> On Sat, Apr 17, 2010 at 11:29 PM, Benjamin Polidore <polidore at gmail.com>wrote:
>>
>>> Hey, paul, I installed all the dependencies to rabbitmq-jsonrpc-channel
>>> (see below).
>>>
>>> I see that you add a little context in test mode.  Basically, I was
>>> hoping to use the plugin to host my HTML and javascript in dev mode so I
>>> don't have to run another webserver on my laptop.  I prefer to run rabbitmq
>>> in "production" mode on my laptop, and I was curious what mochiweb thinks
>>> the docroot is in this mode.
>>>
>>> [{running_applications,
>>>      [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
>>>       {rabbit,"RabbitMQ","1.7.2"},
>>>       {os_mon,"CPO  CXC 138 46","2.2.5"},
>>>       {sasl,"SASL  CXC 138 11","2.1.9"},
>>>       {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
>>>       {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>>>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>>>       {mochiweb,"MochiMedia Web Server","0.01"},
>>>       {mnesia,"MNESIA  CXC 138 12","4.4.13"},
>>>       {stdlib,"ERTS  CXC 138 10","1.16.5"},
>>>       {kernel,"ERTS  CXC 138 10","2.13.5"}]},
>>>  {nodes,[rabbit at H5Pro]},
>>>  {running_nodes,[rabbit at H5Pro]}]
>>> ...done.
>>>
>>>
>>> On Sat, Apr 17, 2010 at 4:11 PM, Paul Jones <pauljones23 at gmail.com>wrote:
>>>
>>>> Hi Benjamin,
>>>>
>>>> Which plugins have you installed into RabbitMQ? The mochiweb plugin
>>>> alone simply embeds a webserver - you'll need to install rabbitmq-jsonrpc
>>>> and rabbitmq-jsonrpc-channel to get the JSON services.
>>>>
>>>> If you have done this, then you might be hitting the fact that when
>>>> running under test, an additional context is installed under the root that
>>>> provides all the various test examples. We don't activate this in the
>>>> "production" mode, since we don't expect you'll want them in a real
>>>> deployment. The scripts for doing JSON-RPC are still there though - under
>>>> /rabbitmq_lib (the scripts that are made available via this can be found on
>>>> the filesystem in priv/www).
>>>>
>>>> I hope this answers your question.
>>>>
>>>> Cheers,
>>>> Paul
>>>>
>>>> On Sat, Apr 17, 2010 at 8:28 PM, Benjamin Polidore <polidore at gmail.com>wrote:
>>>>
>>>>> hi, i'm trying to use the json-channel plugin, and it runs ok when i do
>>>>> make test, but it doesn't seem to work when i try to start up my broker.
>>>>>   the port is open, but everything returns 404.  what is mochiweb
>>>>> using as a docroot when I run it outside make test?  sorry if this is
>>>>> obvious, but i've been struggling with it for a couple hours.
>>>>>
>>>>> thanks,
>>>>> bp
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100422/6a8daa2f/attachment.html 

From mlin at admob.com  Fri Apr 23 03:23:29 2010
From: mlin at admob.com (Mark Lin)
Date: Thu, 22 Apr 2010 19:23:29 -0700
Subject: [rabbitmq-discuss] init terminating in do_boot at starting time
Message-ID: <4FDB5633-D663-4629-B2CF-004211404E63@admob.com>


Running debian version(lenny) of rabbitmq.  After upgrading erlang with backported version of erlang-* packages, I start to see this error message.

sudo -u rabbitmq rabbitmq-server
{"init terminating in do_boot",{'cannot load',error_handler,get_files}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

It looks like I am doing something really fundamentally wrong.  I needed the new version of erlang packages because rabbitmq-shovel plugin needs rabbitmq-inets package which only exists in squeeze and above branch.  Appreciate any suggestion and help.


Thanks,
Mark

From tonyg at lshift.net  Fri Apr 23 04:55:45 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 23 Apr 2010 15:55:45 +1200
Subject: [rabbitmq-discuss] rabbitmq-mochiweb
In-Reply-To: <v2i8801cb2b1004221731r26c8e94djeae51da8e8e799d@mail.gmail.com>
References: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>	<v2x29598b611004171311h40594413pe1913f53ac5ec30@mail.gmail.com>	<y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883@mail.gmail.com>	<t2g29598b611004171546uc81a556axeac726f6b19527b4@mail.gmail.com>	<g2n8801cb2b1004181131ieaa3f75fv1bf3dc0f5f99deb3@mail.gmail.com>
	<v2i8801cb2b1004221731r26c8e94djeae51da8e8e799d@mail.gmail.com>
Message-ID: <4BD11A41.8010601@lshift.net>

Not *quite* what is required, but a good start, is to run "rabbitmqctl status".
For instance, on my dev instance of RabbitMQ, I get:

~/dev/rabbitmq-umbrella/rabbitmq-server$ ./scripts/rabbitmqctl status
Status of node rabbit at walk ...
[{running_applications,
     [{rabbit_lvc_plugin,"RabbitMQ last-value cache exchange plugin","0.01"},
      {rabbit_script_exchange,"RabbitMQ Script Exchange Plugin","0.01"},
      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
      {rabbitmq_smtp_server,"RabbitMQ SMTP Server","0.0"},
      {rabbithub,"rabbithub","0.0.1"},
      {crypto,"CRYPTO version 1","1.6.4"},
      {mochiweb,"MochiMedia Web Server","0.01"},
      {rabbit_stomp,"Embedded Rabbit Stomp Adapter","0.01"},
      {rabbit,"RabbitMQ","%%VSN%%"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
      {mnesia,"MNESIA  CXC 138 12","4.4.13"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9"},
      {erlang_smtp,"Erlang POP3 and SMTP server library code","0.0"},
      {stdlib,"ERTS  CXC 138 10","1.16.5"},
      {kernel,"ERTS  CXC 138 10","2.13.5"}]},
 {nodes,[rabbit at walk]},
 {running_nodes,[rabbit at walk]}]
...done.


You'll see the jsonrpc-channel app in the list, if it's installed and
initialised correctly.

Cheers,
  Tony


Benjamin Polidore wrote:
> hey, i can't seem to get past this. i'm probably doing something silly,
> but i keep getting:
> 
> {"version":"1.1","id":null,"error":{"name":"JSONRPCError","code":404,"message":"Procedure not found","error":["http://h5pro.local:55672/rpc/rabbitmq",""]}}
> 
> when i run the test.js from my mac's apache server.  is there a dead simple way to test that jsonrpc-channel is working when it's running as a plugin?
> 
> 
> On Sun, Apr 18, 2010 at 2:31 PM, Benjamin Polidore <polidore at gmail.com
> <mailto:polidore at gmail.com>> wrote:
> 
>     Thanks, Paul.  I decided not to mess with the source code, and I'm
>     just using OS X's built in apache for my static files. 
> 
>     Now I'm getting a different problem. I modified the test program to
>     work in this new context by changing the paths for loading the
>     javascripts and changing the urls in rabbitmq.js:
> 
>        factoryServiceUrl: *"http://h5pro.local:55672/rpc/rabbitmq",*
>       rpcServiceUrlBase*: "http://h5pro.local:55672/rpc/",*
>         
>     and in test.js:
> 
>         var channelFactory = new
>     JsonRpc.Service("*http://h5pro.local:55672/rpc/rabbitmq", *
> 
>     But it doesn't work.  When I do an ngrep on the traffic going
>     between my js and mochiweb, I get:
> 
>     T 10.0.1.3:60988 <http://10.0.1.3:60988> -> 10.0.1.3:55672
>     <http://10.0.1.3:55672> [AP]
>       OPTIONS /rpc/rabbitmq HTTP/1.1..Host:
>     h5pro.local:55672..Connection: keep-alive..User-Agent: Mozilla/5.0
>     (Macintosh; U; Intel Mac OS X 10_6_3; e
>       n-US) AppleWebKit/533.4 (KHTML, like Gecko) Chrome/5.0.375.9
>     Safari/533.4..Referer:
>     http://h5pro.local/~bp/rabbitTest/www-examples/test/..Access
>       -Control-Request-Method: POST..Origin:
>     http://h5pro.local..Access-Control-Request-Headers:
>     X-Requested-With, Content-Type, Accept..Accept: */*..
>       Accept-Encoding: gzip,deflate,sdch..Accept-Language:
>     en-US,en;q=0.8..Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3....  
>                           
>     ##
>     T 10.0.1.3:55672 <http://10.0.1.3:55672> -> 10.0.1.3:60988
>     <http://10.0.1.3:60988> [AP]
>       HTTP/1.1 200 OK..Server: MochiWeb/1.0 (Any of you quaids got a
>     smint?)..Date: Sun, 18 Apr 2010 18:27:48 GMT..Content-type:
>     text/plain..Content-L
>       ength: 155....                                                    
>                                                                        
>              
>     ##
>     T 10.0.1.3:55672 <http://10.0.1.3:55672> -> 10.0.1.3:60988
>     <http://10.0.1.3:60988> [AP]
>       {*"version":"1.1","id":null,"error":{"name":"JSONRPCError","code":404,"message":"Procedure
>     not found","error":["http://h5pro.local:55672/rpc/rabb  itmq",""]}}    *
>     *
>     *
>     *Thoughts?       *
>     *
>     Thanks,
>     bp        *        
> 
>     On Sat, Apr 17, 2010 at 6:46 PM, Paul Jones <pauljones23 at gmail.com
>     <mailto:pauljones23 at gmail.com>> wrote:
> 
>         Hi Benjamin,
> 
>         In the production mode, mochiweb doesn't really have a docroot
>         setup. /rabbitmq_lib will serve the files in priv/www, but that
>         is as far as it goes.
> 
>         However... if you want to serve some other files then you could
>         always use code similar to what the test mode does to make it
>         happen. For example, if you were to add:
> 
>         Handler = rabbit_mochiweb:static_context_handler("", ?MODULE,
>         "priv/mydocroot"),
>         ok = rabbit_mochiweb:register_global_handler(Handler),
> 
>         after the line:
>         rabbit_mochiweb:register_static_context(ContextRoot, ?MODULE,
>         "priv/www")
> 
>         in src/rabbit_jsonrpc_channel_app.erl, then once you've
>         installed the plugin into Rabbit, any file put into
>         priv/plugins/rabbitmq-jsonrpc-channel/priv/mydocroot should be
>         served from the root context of mochiweb.
> 
>         BTW, I've just noticed a bug in the packaging of the
>         jsonrpc-channel plugin such that if you do run that plugin by
>         installing it via a .ez, you'll need to copy the priv/www
>         directory into priv/plugins/rabbitmq-jsonrpc-channel/priv/www
>         (otherwise libraries such as rabbitmq.js won't be available).
> 
>         Thanks,
>         Paul.
> 
> 
>         On Sat, Apr 17, 2010 at 11:29 PM, Benjamin Polidore
>         <polidore at gmail.com <mailto:polidore at gmail.com>> wrote:
> 
>             Hey, paul, I installed all the dependencies to
>             rabbitmq-jsonrpc-channel (see below).
> 
>             I see that you add a little context in test mode.
>              Basically, I was hoping to use the plugin to host my HTML
>             and javascript in dev mode so I don't have to run another
>             webserver on my laptop.  I prefer to run rabbitmq in
>             "production" mode on my laptop, and I was curious what
>             mochiweb thinks the docroot is in this mode.
> 
>             [{running_applications,
>                  [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC
>             Channels","0.01"},
>                   {rabbit,"RabbitMQ","1.7.2"},
>                   {os_mon,"CPO  CXC 138 46","2.2.5"},
>                   {sasl,"SASL  CXC 138 11","2.1.9"},
>                   {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
>                   {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>                   {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>                   {mochiweb,"MochiMedia Web Server","0.01"},
>                   {mnesia,"MNESIA  CXC 138 12","4.4.13"},
>                   {stdlib,"ERTS  CXC 138 10","1.16.5"},
>                   {kernel,"ERTS  CXC 138 10","2.13.5"}]},
>              {nodes,[rabbit at H5Pro]},
>              {running_nodes,[rabbit at H5Pro]}]
>             ...done.
> 
> 
>             On Sat, Apr 17, 2010 at 4:11 PM, Paul Jones
>             <pauljones23 at gmail.com <mailto:pauljones23 at gmail.com>> wrote:
> 
>                 Hi Benjamin,
> 
>                 Which plugins have you installed into RabbitMQ? The
>                 mochiweb plugin alone simply embeds a webserver - you'll
>                 need to install rabbitmq-jsonrpc and
>                 rabbitmq-jsonrpc-channel to get the JSON services.
> 
>                 If you have done this, then you might be hitting the
>                 fact that when running under test, an additional context
>                 is installed under the root that provides all the
>                 various test examples. We don't activate this in the
>                 "production" mode, since we don't expect you'll want
>                 them in a real deployment. The scripts for doing
>                 JSON-RPC are still there though - under /rabbitmq_lib
>                 (the scripts that are made available via this can be
>                 found on the filesystem in priv/www).
> 
>                 I hope this answers your question.
> 
>                 Cheers,
>                 Paul
> 
>                 On Sat, Apr 17, 2010 at 8:28 PM, Benjamin Polidore
>                 <polidore at gmail.com <mailto:polidore at gmail.com>> wrote:
> 
>                     hi, i'm trying to use the json-channel plugin, and
>                     it runs ok when i do make test, but it doesn't seem
>                     to work when i try to start up my broker.  the port
>                     is open, but everything returns 404.  what is
>                     mochiweb using as a docroot when I run it outside
>                     make test?  sorry if this is obvious, but i've been
>                     struggling with it for a couple hours. 
> 
>                     thanks,
>                     bp
> 
>                     _______________________________________________
>                     rabbitmq-discuss mailing list
>                     rabbitmq-discuss at lists.rabbitmq.com
>                     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>                     http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From polidore at gmail.com  Fri Apr 23 05:17:48 2010
From: polidore at gmail.com (Benjamin Polidore)
Date: Fri, 23 Apr 2010 00:17:48 -0400
Subject: [rabbitmq-discuss] rabbitmq-mochiweb
In-Reply-To: <4BD11A41.8010601@lshift.net>
References: <p2p8801cb2b1004171228t3bb1a5cfjf56925136b34d09c@mail.gmail.com>
	<v2x29598b611004171311h40594413pe1913f53ac5ec30@mail.gmail.com>
	<y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883@mail.gmail.com>
	<t2g29598b611004171546uc81a556axeac726f6b19527b4@mail.gmail.com>
	<g2n8801cb2b1004181131ieaa3f75fv1bf3dc0f5f99deb3@mail.gmail.com>
	<v2i8801cb2b1004221731r26c8e94djeae51da8e8e799d@mail.gmail.com>
	<4BD11A41.8010601@lshift.net>
Message-ID: <s2z8801cb2b1004222117m62c9d1acia6d2a4ea69b92aaf@mail.gmail.com>

Here's what I've got.  I think it is configured properly from a rabbitmq
point of view.  The difference between this and make test (which works) is
that i'm hosting the html and js on apache, and i'm using an absolute URL
for the rabbitmq json-rpc service.  I may have entered the wrong values in
the various URI variables in the javascript-- not really sure.

~ > /usr/local/sbin/rabbitmqctl status
Status of node rabbit at H5Pro ...
[{running_applications,
     [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
      {rabbit,"RabbitMQ","1.7.2"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9"},
      {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
      {mochiweb,"MochiMedia Web Server","0.01"},
      {mnesia,"MNESIA  CXC 138 12","4.4.13"},
      {stdlib,"ERTS  CXC 138 10","1.16.5"},
      {kernel,"ERTS  CXC 138 10","2.13.5"}]},
 {nodes,[rabbit at H5Pro]},
 {running_nodes,[rabbit at H5Pro]}]
...done.

thanks again,
bp

On Thu, Apr 22, 2010 at 11:55 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Not *quite* what is required, but a good start, is to run "rabbitmqctl
> status".
> For instance, on my dev instance of RabbitMQ, I get:
>
> ~/dev/rabbitmq-umbrella/rabbitmq-server$ ./scripts/rabbitmqctl status
> Status of node rabbit at walk ...
> [{running_applications,
>     [{rabbit_lvc_plugin,"RabbitMQ last-value cache exchange
> plugin","0.01"},
>      {rabbit_script_exchange,"RabbitMQ Script Exchange Plugin","0.01"},
>       {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>       {rabbitmq_smtp_server,"RabbitMQ SMTP Server","0.0"},
>      {rabbithub,"rabbithub","0.0.1"},
>      {crypto,"CRYPTO version 1","1.6.4"},
>       {mochiweb,"MochiMedia Web Server","0.01"},
>       {rabbit_stomp,"Embedded Rabbit Stomp Adapter","0.01"},
>      {rabbit,"RabbitMQ","%%VSN%%"},
>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.13"},
>       {os_mon,"CPO  CXC 138 46","2.2.5"},
>      {sasl,"SASL  CXC 138 11","2.1.9"},
>       {erlang_smtp,"Erlang POP3 and SMTP server library code","0.0"},
>       {stdlib,"ERTS  CXC 138 10","1.16.5"},
>      {kernel,"ERTS  CXC 138 10","2.13.5"}]},
>  {nodes,[rabbit at walk]},
>  {running_nodes,[rabbit at walk]}]
> ...done.
>
>
> You'll see the jsonrpc-channel app in the list, if it's installed and
> initialised correctly.
>
> Cheers,
>  Tony
>
>
> Benjamin Polidore wrote:
> > hey, i can't seem to get past this. i'm probably doing something silly,
> > but i keep getting:
> >
> >
> {"version":"1.1","id":null,"error":{"name":"JSONRPCError","code":404,"message":"Procedure
> not found","error":["http://h5pro.local:55672/rpc/rabbitmq",""]}}
> >
> > when i run the test.js from my mac's apache server.  is there a dead
> simple way to test that jsonrpc-channel is working when it's running as a
> plugin?
> >
> >
> > On Sun, Apr 18, 2010 at 2:31 PM, Benjamin Polidore <polidore at gmail.com
> > <mailto:polidore at gmail.com>> wrote:
> >
> >     Thanks, Paul.  I decided not to mess with the source code, and I'm
> >     just using OS X's built in apache for my static files.
> >
> >     Now I'm getting a different problem. I modified the test program to
> >     work in this new context by changing the paths for loading the
> >     javascripts and changing the urls in rabbitmq.js:
> >
> >        factoryServiceUrl: *"http://h5pro.local:55672/rpc/rabbitmq",*
> >       rpcServiceUrlBase*: "http://h5pro.local:55672/rpc/",*
> >
> >     and in test.js:
> >
> >         var channelFactory = new
> >     JsonRpc.Service("*http://h5pro.local:55672/rpc/rabbitmq", *
> >
> >     But it doesn't work.  When I do an ngrep on the traffic going
> >     between my js and mochiweb, I get:
> >
> >     T 10.0.1.3:60988 <http://10.0.1.3:60988> -> 10.0.1.3:55672
> >     <http://10.0.1.3:55672> [AP]
> >       OPTIONS /rpc/rabbitmq HTTP/1.1..Host:
> >     h5pro.local:55672..Connection: keep-alive..User-Agent: Mozilla/5.0
> >     (Macintosh; U; Intel Mac OS X 10_6_3; e
> >       n-US) AppleWebKit/533.4 (KHTML, like Gecko) Chrome/5.0.375.9
> >     Safari/533.4..Referer:
> >     http://h5pro.local/~bp/rabbitTest/www-examples/test/..Access
> >       -Control-Request-Method: POST..Origin:
> >     http://h5pro.local..Access-Control-Request-Headers:
> >     X-Requested-With, Content-Type, Accept..Accept: */*..
> >       Accept-Encoding: gzip,deflate,sdch..Accept-Language:
> >     en-US,en;q=0.8..Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3....
> >
> >     ##
> >     T 10.0.1.3:55672 <http://10.0.1.3:55672> -> 10.0.1.3:60988
> >     <http://10.0.1.3:60988> [AP]
> >       HTTP/1.1 200 OK..Server: MochiWeb/1.0 (Any of you quaids got a
> >     smint?)..Date: Sun, 18 Apr 2010 18:27:48 GMT..Content-type:
> >     text/plain..Content-L
> >       ength: 155....
> >
> >
> >     ##
> >     T 10.0.1.3:55672 <http://10.0.1.3:55672> -> 10.0.1.3:60988
> >     <http://10.0.1.3:60988> [AP]
> >
> {*"version":"1.1","id":null,"error":{"name":"JSONRPCError","code":404,"message":"Procedure
> >     not found","error":["http://h5pro.local:55672/rpc/rabb  itmq",""]}}
>    *
> >     *
> >     *
> >     *Thoughts?       *
> >     *
> >     Thanks,
> >     bp        *
> >
> >     On Sat, Apr 17, 2010 at 6:46 PM, Paul Jones <pauljones23 at gmail.com
> >     <mailto:pauljones23 at gmail.com>> wrote:
> >
> >         Hi Benjamin,
> >
> >         In the production mode, mochiweb doesn't really have a docroot
> >         setup. /rabbitmq_lib will serve the files in priv/www, but that
> >         is as far as it goes.
> >
> >         However... if you want to serve some other files then you could
> >         always use code similar to what the test mode does to make it
> >         happen. For example, if you were to add:
> >
> >         Handler = rabbit_mochiweb:static_context_handler("", ?MODULE,
> >         "priv/mydocroot"),
> >         ok = rabbit_mochiweb:register_global_handler(Handler),
> >
> >         after the line:
> >         rabbit_mochiweb:register_static_context(ContextRoot, ?MODULE,
> >         "priv/www")
> >
> >         in src/rabbit_jsonrpc_channel_app.erl, then once you've
> >         installed the plugin into Rabbit, any file put into
> >         priv/plugins/rabbitmq-jsonrpc-channel/priv/mydocroot should be
> >         served from the root context of mochiweb.
> >
> >         BTW, I've just noticed a bug in the packaging of the
> >         jsonrpc-channel plugin such that if you do run that plugin by
> >         installing it via a .ez, you'll need to copy the priv/www
> >         directory into priv/plugins/rabbitmq-jsonrpc-channel/priv/www
> >         (otherwise libraries such as rabbitmq.js won't be available).
> >
> >         Thanks,
> >         Paul.
> >
> >
> >         On Sat, Apr 17, 2010 at 11:29 PM, Benjamin Polidore
> >         <polidore at gmail.com <mailto:polidore at gmail.com>> wrote:
> >
> >             Hey, paul, I installed all the dependencies to
> >             rabbitmq-jsonrpc-channel (see below).
> >
> >             I see that you add a little context in test mode.
> >              Basically, I was hoping to use the plugin to host my HTML
> >             and javascript in dev mode so I don't have to run another
> >             webserver on my laptop.  I prefer to run rabbitmq in
> >             "production" mode on my laptop, and I was curious what
> >             mochiweb thinks the docroot is in this mode.
> >
> >             [{running_applications,
> >                  [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC
> >             Channels","0.01"},
> >                   {rabbit,"RabbitMQ","1.7.2"},
> >                   {os_mon,"CPO  CXC 138 46","2.2.5"},
> >                   {sasl,"SASL  CXC 138 11","2.1.9"},
> >                   {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
> >                   {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
> >                   {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
> >                   {mochiweb,"MochiMedia Web Server","0.01"},
> >                   {mnesia,"MNESIA  CXC 138 12","4.4.13"},
> >                   {stdlib,"ERTS  CXC 138 10","1.16.5"},
> >                   {kernel,"ERTS  CXC 138 10","2.13.5"}]},
> >              {nodes,[rabbit at H5Pro]},
> >              {running_nodes,[rabbit at H5Pro]}]
> >             ...done.
> >
> >
> >             On Sat, Apr 17, 2010 at 4:11 PM, Paul Jones
> >             <pauljones23 at gmail.com <mailto:pauljones23 at gmail.com>>
> wrote:
> >
> >                 Hi Benjamin,
> >
> >                 Which plugins have you installed into RabbitMQ? The
> >                 mochiweb plugin alone simply embeds a webserver - you'll
> >                 need to install rabbitmq-jsonrpc and
> >                 rabbitmq-jsonrpc-channel to get the JSON services.
> >
> >                 If you have done this, then you might be hitting the
> >                 fact that when running under test, an additional context
> >                 is installed under the root that provides all the
> >                 various test examples. We don't activate this in the
> >                 "production" mode, since we don't expect you'll want
> >                 them in a real deployment. The scripts for doing
> >                 JSON-RPC are still there though - under /rabbitmq_lib
> >                 (the scripts that are made available via this can be
> >                 found on the filesystem in priv/www).
> >
> >                 I hope this answers your question.
> >
> >                 Cheers,
> >                 Paul
> >
> >                 On Sat, Apr 17, 2010 at 8:28 PM, Benjamin Polidore
> >                 <polidore at gmail.com <mailto:polidore at gmail.com>> wrote:
> >
> >                     hi, i'm trying to use the json-channel plugin, and
> >                     it runs ok when i do make test, but it doesn't seem
> >                     to work when i try to start up my broker.  the port
> >                     is open, but everything returns 404.  what is
> >                     mochiweb using as a docroot when I run it outside
> >                     make test?  sorry if this is obvious, but i've been
> >                     struggling with it for a couple hours.
> >
> >                     thanks,
> >                     bp
> >
> >                     _______________________________________________
> >                     rabbitmq-discuss mailing list
> >                     rabbitmq-discuss at lists.rabbitmq.com
> >                     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> >
> >
> >
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100423/a4d5cacc/attachment-0001.htm 

From videlalvaro at gmail.com  Fri Apr 23 05:52:18 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 23 Apr 2010 12:52:18 +0800
Subject: [rabbitmq-discuss] Question About Bindings
Message-ID: <B239FA5E-3260-4821-8102-A49CB8921B71@gmail.com>

Hi,

I have a question regarding how bindings work. 

I have a brand new build of RabbitMQ, started with make run

I noticed that after I do the usual calls (pseudocode):

access_request("/")
queue_declare("queue_name")
exchange_declare("exchange_name")
queue_bind("queue_name", "exchange_name")
basic_consume("consumer_tag")

and then in Erlang I do the following:

> Bindings = rpc:call('rabbit at localhost', rabbit_exchange, list_bindings, [<<"/">>]).

I get this list:

[{{resource,<<"/">>,exchange,<<>>}, {resource,<<"/">>,queue,<<"bounce_mail">>}, <<"bounce_mail">>,[]},
 {{resource,<<"/">>,exchange,<<"bounce_mail_router">>},  {resource,<<"/">>,queue,<<"bounce_mail">>},  <<>>,[]}]

What are those anonymous exchanges?, like the one from the list head?

Regards,

Alvaro




From tonyg at lshift.net  Fri Apr 23 07:21:08 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 23 Apr 2010 18:21:08 +1200
Subject: [rabbitmq-discuss] Question About Bindings
In-Reply-To: <B239FA5E-3260-4821-8102-A49CB8921B71@gmail.com>
References: <B239FA5E-3260-4821-8102-A49CB8921B71@gmail.com>
Message-ID: <4BD13C54.9060106@lshift.net>

Alvaro Videla wrote:
> What are those anonymous exchanges?, like the one from the list head?

It's the binding to the AMQP "default exchange". Every queue is automatically
given a binding to a direct exchange named "" in AMQP 0-8 and 0-9-1. It sorta
kinda permits delivering messages directly to queues, but I'd still recommend
explicitly managing your own bindings rather than relying on this default
binding behaviour.

Regards,
  Tony



From matthias at rabbitmq.com  Fri Apr 23 07:44:17 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 23 Apr 2010 07:44:17 +0100
Subject: [rabbitmq-discuss] Question About Bindings
In-Reply-To: <4BD13C54.9060106@lshift.net>
References: <B239FA5E-3260-4821-8102-A49CB8921B71@gmail.com>
	<4BD13C54.9060106@lshift.net>
Message-ID: <4BD141C1.8080803@rabbitmq.com>

Alvaro,

Tony Garnock-Jones wrote:
> Alvaro Videla wrote:
>> What are those anonymous exchanges?, like the one from the list head?
> 
> It's the binding to the AMQP "default exchange". Every queue is
> automatically given a binding to a direct exchange named "" in AMQP
> 0-8 and 0-9-1. It sorta kinda permits delivering messages directly to
> queues, but I'd still recommend explicitly managing your own bindings
> rather than relying on this default binding behaviour.

I disagree with Tony here. But he knows that ;)

Relying on the default exchange bindings is perfectly fine. They are in 
every 0-* AMQP spec and are widely supported by brokers. By contrast, 
attempting to manage these bindings (i.e. bindings to the default 
exchange) explicitly is prohibited by some versions of the spec and thus 
not guaranteed to work.

Regards,

Matthias.


From videlalvaro at gmail.com  Fri Apr 23 07:43:49 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 23 Apr 2010 14:43:49 +0800
Subject: [rabbitmq-discuss] Question About Bindings
In-Reply-To: <4BD141C1.8080803@rabbitmq.com>
References: <B239FA5E-3260-4821-8102-A49CB8921B71@gmail.com>
	<4BD13C54.9060106@lshift.net> <4BD141C1.8080803@rabbitmq.com>
Message-ID: <F0C1D1BD-EFB1-4021-BCB9-838AF17B4B11@gmail.com>

Thanks to both you. 

I needed to have that clear, since I'm writing an admin tool for RabbitMQ and I was seeing those blank exchanges popping up. 

Alvaro

On Apr 23, 2010, at 2:44 PM, Matthias Radestock wrote:

> Alvaro,
> 
> Tony Garnock-Jones wrote:
>> Alvaro Videla wrote:
>>> What are those anonymous exchanges?, like the one from the list head?
>> It's the binding to the AMQP "default exchange". Every queue is
>> automatically given a binding to a direct exchange named "" in AMQP
>> 0-8 and 0-9-1. It sorta kinda permits delivering messages directly to
>> queues, but I'd still recommend explicitly managing your own bindings
>> rather than relying on this default binding behaviour.
> 
> I disagree with Tony here. But he knows that ;)
> 
> Relying on the default exchange bindings is perfectly fine. They are in every 0-* AMQP spec and are widely supported by brokers. By contrast, attempting to manage these bindings (i.e. bindings to the default exchange) explicitly is prohibited by some versions of the spec and thus not guaranteed to work.
> 
> Regards,
> 
> Matthias.



From tonyg at lshift.net  Fri Apr 23 07:57:29 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 23 Apr 2010 18:57:29 +1200
Subject: [rabbitmq-discuss] Question About Bindings
In-Reply-To: <4BD141C1.8080803@rabbitmq.com>
References: <B239FA5E-3260-4821-8102-A49CB8921B71@gmail.com>
	<4BD13C54.9060106@lshift.net> <4BD141C1.8080803@rabbitmq.com>
Message-ID: <4BD144D9.7020506@lshift.net>

Matthias Radestock wrote:
> I disagree with Tony here. But he knows that ;)

Well, to clarify, I meant more something along the lines of "avoid using the
default exchange, use your own exchanges instead". But yes, with current
releases, if you limit yourself to only ever mentioning the default exchange in
basic.publish operations, and otherwise relying on the standardised behaviour
for the default exchange, you're definitely safe.

Tony



From matthias at rabbitmq.com  Fri Apr 23 09:08:44 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 23 Apr 2010 09:08:44 +0100
Subject: [rabbitmq-discuss] java client library rpc client
In-Reply-To: <03FC0D29D4E88943AB7420C524BE848905AD6363@mllnc20mb056.emea.win.ml.com>
References: <03FC0D29D4E88943AB7420C524BE848905AD6363@mllnc20mb056.emea.win.ml.com>
Message-ID: <4BD1558C.2060103@rabbitmq.com>

Rajesh,

Reddy, Rajesh (GPT EMEA) wrote:
> Basically my process makes an rpccall and gets reply from one or more
> other process. This works if the rpcclient receives one reply for its
> request, but as soon as it gets multiple replies it fails. I get the
> following exception which doesn't say much about the root cause.

The rpc abstractions that ship with the RabbitMQ clients are not 
designed to handle multiple replies.

> This is possible in .NET library of rabbitmq and working fine.

The difference between the Java and .net version is that the former 
processes replies eagerly, i.e. any message received from the rpc 
client's reply queue is processed immediately, whereas the .net version 
processes replies lazily, i.e. only when an rpc caller is waiting for a 
result. If you tried re-using the same .net SimpleRpcClient instance for 
another call things would break in much the same way as for the Java 
client since the code would find a reply that is not correlated to the 
current request.

To implement the "wait for first reply and discard all others" pattern 
properly I suggest you amend the rpc client code with an "unexpected 
reply" handler/callback that by default throws an exception (thus 
mimicking the current behaviour). In your application code you could 
then set that handler to ignore unexpected replies instead.

Patches are welcome.


Regards,

Matthias.


From rajesh.reddy at baml.com  Fri Apr 23 09:21:01 2010
From: rajesh.reddy at baml.com (Reddy, Rajesh (GPT EMEA))
Date: Fri, 23 Apr 2010 09:21:01 +0100
Subject: [rabbitmq-discuss] java client library rpc client
In-Reply-To: <4BD1558C.2060103@rabbitmq.com>
Message-ID: <03FC0D29D4E88943AB7420C524BE848905AD6390@mllnc20mb056.emea.win.ml.com>

Hi Matthias,

The .net client has a overload call() defined which invokes cast()(Sends
an asynchronous/one-way message) and then Retrieves the reply from the
Subscription object which is consuming from the reply queue of the
consumer.
So in this way you get the first reply back immediately and then you can
poll the subscription for any more replies.

I have extended the java rpcclient to work in a similar way by using
QueingConsumer instead of Default consumer.

Thanks
Rajesh

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: 23 April 2010 09:09
To: Reddy, Rajesh (GPT EMEA)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] java client library rpc client


Rajesh,

Reddy, Rajesh (GPT EMEA) wrote:
> Basically my process makes an rpccall and gets reply from one or more
> other process. This works if the rpcclient receives one reply for its
> request, but as soon as it gets multiple replies it fails. I get the
> following exception which doesn't say much about the root cause.

The rpc abstractions that ship with the RabbitMQ clients are not 
designed to handle multiple replies.

> This is possible in .NET library of rabbitmq and working fine.

The difference between the Java and .net version is that the former 
processes replies eagerly, i.e. any message received from the rpc 
client's reply queue is processed immediately, whereas the .net version 
processes replies lazily, i.e. only when an rpc caller is waiting for a 
result. If you tried re-using the same .net SimpleRpcClient instance for

another call things would break in much the same way as for the Java 
client since the code would find a reply that is not correlated to the 
current request.

To implement the "wait for first reply and discard all others" pattern 
properly I suggest you amend the rpc client code with an "unexpected 
reply" handler/callback that by default throws an exception (thus 
mimicking the current behaviour). In your application code you could 
then set that handler to ignore unexpected replies instead.

Patches are welcome.


Regards,

Matthias.

--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. The information contained in this e-mail was obtained from sources believed to be reliable; however, the accuracy or completeness of this information is not guaranteed. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Past performance is no guarantee of future results. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 


From pcoquentin at sierrawireless.com  Sat Apr 24 09:56:21 2010
From: pcoquentin at sierrawireless.com (Pierre Coquentin)
Date: Sat, 24 Apr 2010 01:56:21 -0700
Subject: [rabbitmq-discuss] Behavior of consumers listening to the same queue
Message-ID: <9287D1909D3EEA4E92505D48604887E9056CAA17D3@carmd-exchmb01.sierrawireless.local>

Hello
I am working on an integration of AMQP and I have one question.
I noticed a behavior that surprised me a little. For example, if I register two consumers on two different channels on a shared connection, listening to the same queue, I realized that the messages were processed one by one using round robin strategy, ie the second consumer will not process a message until the first consumer has finished processing the previous message and so on. I thought the messages would be treated as independent if I used different channels.
Is there no way to ensure that messages are processed in parallel by both consumers except by registering them on two different connections ? Or am I just missing something ?

Best regards,

Pierre


From matthew at lshift.net  Sat Apr 24 13:19:25 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sat, 24 Apr 2010 13:19:25 +0100
Subject: [rabbitmq-discuss] Behavior of consumers listening to the same
 queue
In-Reply-To: <9287D1909D3EEA4E92505D48604887E9056CAA17D3@carmd-exchmb01.sierrawireless.local>
References: <9287D1909D3EEA4E92505D48604887E9056CAA17D3@carmd-exchmb01.sierrawireless.local>
Message-ID: <20100424121924.GA3128@wellquite.org>

On Sat, Apr 24, 2010 at 01:56:21AM -0700, Pierre Coquentin wrote:
> Is there no way to ensure that messages are processed in parallel by both consumers except by registering them on two different connections ? Or am I just missing something ?

You should be using 2 different *queues*. Then one consumer per *queue*.
Provided the queues are bound to the same exchanges with the same
binding keys, they will both get the same messages.

Matthew


From matthew at lshift.net  Sat Apr 24 13:53:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sat, 24 Apr 2010 13:53:15 +0100
Subject: [rabbitmq-discuss] Behavior of consumers listening to the same
 queue
In-Reply-To: <20100424121924.GA3128@wellquite.org>
References: <9287D1909D3EEA4E92505D48604887E9056CAA17D3@carmd-exchmb01.sierrawireless.local>
	<20100424121924.GA3128@wellquite.org>
Message-ID: <20100424125315.GB3128@wellquite.org>

Hi Pierre,

I've just realised I answered totally the wrong question, so I'll have
another go!

On Sat, Apr 24, 2010 at 01:56:21AM -0700, Pierre Coquentin wrote:
> I noticed a behavior that surprised me a little. For example, if I
> register two consumers on two different channels on a shared
> connection, listening to the same queue, I realized that the messages
> were processed one by one using round robin strategy, ie the second
> consumer will not process a message until the first consumer has
> finished processing the previous message and so on. I thought the
> messages would be treated as independent if I used different channels.
> Is there no way to ensure that messages are processed in parallel by
> both consumers except by registering them on two different connections
> ? Or am I just missing something ?

Yes, the messages should be treated independently, and should be able to
be processed in parallel (ignore everything I said in my last email
about multiple queues!).

However, most clients are implemented with one "main" thread which pulls
the messages off the socket. If you are getting that thread to do the
processing, then yes, it'll block, and you'll achieve no parallelism.
You really need for that thread to hand off the message to some other
thread so that the main thread can go back and grab the next message off
the socket.

If you're using our Java client then you need to be using the
QueueingConsumer which exists for exactly this purpose, rather than just
filling in the handleDelivery callback yourself. You didn't mention
which client you're using though.

I hope that helps,

Matthew


From pcoquentin at sierrawireless.com  Sat Apr 24 14:34:25 2010
From: pcoquentin at sierrawireless.com (Pierre Coquentin)
Date: Sat, 24 Apr 2010 06:34:25 -0700
Subject: [rabbitmq-discuss] RE : Behavior of consumers listening to the same
 queue
In-Reply-To: <20100424125315.GB3128@wellquite.org>
References: <9287D1909D3EEA4E92505D48604887E9056CAA17D3@carmd-exchmb01.sierrawireless.local>
	<20100424121924.GA3128@wellquite.org>,
	<20100424125315.GB3128@wellquite.org>
Message-ID: <9287D1909D3EEA4E92505D48604887E9056CAA17D4@carmd-exchmb01.sierrawireless.local>

Hi
Thanks for your second answer :)
I ve tried RabbitMQ and Qpid client but it's planned to use rabbitMQ client.

Pierre

________________________________________
De : Matthew Sackman [matthew at lshift.net]
Date d'envoi : samedi 24 avril 2010 14:53
? : rabbitmq-discuss at lists.rabbitmq.com
Cc : Pierre Coquentin
Objet : Re: [rabbitmq-discuss] Behavior of consumers listening to the same queue

Hi Pierre,

I've just realised I answered totally the wrong question, so I'll have
another go!

On Sat, Apr 24, 2010 at 01:56:21AM -0700, Pierre Coquentin wrote:
> I noticed a behavior that surprised me a little. For example, if I
> register two consumers on two different channels on a shared
> connection, listening to the same queue, I realized that the messages
> were processed one by one using round robin strategy, ie the second
> consumer will not process a message until the first consumer has
> finished processing the previous message and so on. I thought the
> messages would be treated as independent if I used different channels.
> Is there no way to ensure that messages are processed in parallel by
> both consumers except by registering them on two different connections
> ? Or am I just missing something ?

Yes, the messages should be treated independently, and should be able to
be processed in parallel (ignore everything I said in my last email
about multiple queues!).

However, most clients are implemented with one "main" thread which pulls
the messages off the socket. If you are getting that thread to do the
processing, then yes, it'll block, and you'll achieve no parallelism.
You really need for that thread to hand off the message to some other
thread so that the main thread can go back and grab the next message off
the socket.

If you're using our Java client then you need to be using the
QueueingConsumer which exists for exactly this purpose, rather than just
filling in the handleDelivery callback yourself. You didn't mention
which client you're using though.

I hope that helps,

Matthew



From radisb at gmail.com  Sat Apr 24 17:47:45 2010
From: radisb at gmail.com (radisb)
Date: Sat, 24 Apr 2010 09:47:45 -0700 (PDT)
Subject: [rabbitmq-discuss]  Problem with BasicProperties (bug?)
Message-ID: <28351417.post@talk.nabble.com>


he code below does the following: Sends 1000 messages (each tagged with a key
by BasicProperties.getHeaders.put("MESSAGE_KEY", value) and stored in a map)
directly to queueA and then waits in a loop for incoming replies on the
queue Replies.
It then fires 2 Threads (SimpleForwarder class). The first thread waits for
messages on QueueA and upon receipt it sends them to QueueB. The second
Thread waits on QueueB and sends to Replies.

When a message is received on Replies , its key (taken from the header in
the delivery properties) is removed from a map. The test finishes
succesfully if all keys sent where received and removed from the map.

The problem is in the forwarding threads code. If before forwarding the
message, the thread recreates the BasicProperties and sends a fresh
BasicProperties , this causes the consumer on Replies to lose messages and
get duplicates in their place. Sometimes the forwarder throws null pointer
exception because it cant find the header that has the key(This cant happen
because all messages are assigned one before sending). What is strange is
that if the 2 forwarders are started in separate JVMs the problem
disappears. I have marked the problematic area with /* -- PROBLEM -- */

Note that the lost messages are random and the problem might not manifest if
run for a few messages. Above 400-500 it always happens for me. 

I use server 1.7.2 and javaclient 1.7.2.
Any suggestions?

Here is the code: 
http://old.nabble.com/file/p28351417/Tester.java Tester.java 

package test;


import com.rabbitmq.client.AMQP.BasicProperties;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.ConnectionParameters;
import com.rabbitmq.client.MessageProperties;
import com.rabbitmq.client.QueueingConsumer;
import com.rabbitmq.client.QueueingConsumer.Delivery;
import com.rabbitmq.client.ShutdownSignalException;
import com.rabbitmq.client.impl.LongString;
import java.io.IOException;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Set;


public class Tester
{
	ConnectionParameters parameters;
	Channel senderChannel;
	Channel receiverChannel;
	QueueingConsumer consumer;
	String sourceQueue;
	String targetRoutingKey;
	
	public Tester(ConnectionParameters parameters, String sourceQueue, String
targetRoutingKey)
	{
		this.parameters = parameters;
		this.sourceQueue = sourceQueue;
		this.targetRoutingKey = targetRoutingKey;
	}

	public void test(int messageCount) throws IOException
	{
		senderChannel = new
ConnectionFactory(parameters).newConnection("localhost").createChannel();
		receiverChannel = new
ConnectionFactory(parameters).newConnection("localhost").createChannel();
		receiverChannel.queueDeclare(sourceQueue, false);
		receiverChannel.queueBind(sourceQueue, "amq.direct", sourceQueue);
		consumer = new QueueingConsumer(receiverChannel);
		String dummyData = "dummyData";
		Set<String>sentKeys = new HashSet<String>();
		int c = 0;
		while(c < messageCount)
		{
			c++;
			String key =  String.valueOf(c);
			BasicProperties props = MessageProperties.PERSISTENT_TEXT_PLAIN;
			props.setHeaders(new HashMap<String, Object>());
			props.getHeaders().put("MESSAGE_KEY", key);
			senderChannel.basicPublish("amq.direct", targetRoutingKey, props,
dummyData.getBytes());
			sentKeys.add(key);
		}
		System.out.println("Sent " + c + " messages. Firing up consumer to wait
for replies:\n");
		
		receiverChannel.basicConsume(sourceQueue, false, consumer);

		while(true)
		{
			try
			{
				Delivery delivery = consumer.nextDelivery(1000);
				if(delivery != null)
				{
					receiverChannel.basicAck(delivery.getEnvelope().getDeliveryTag(),
false);
					String receivedKey = new
String(((LongString)delivery.getProperties().getHeaders().get("MESSAGE_KEY")).getBytes());
					System.out.print("Key: " + receivedKey);
					if(!sentKeys.remove(receivedKey))
						System.out.println(" ...Already received");
					else
					{
						System.out.println(" ...OK");
						if(sentKeys.isEmpty())
						{
							System.out.println("All keys removed");
							close();
							return;
						}
					}
				}
				else
				{
					System.out.println("Timed out.");
				}
			}
			catch(InterruptedException ex){System.err.println("Interrupted while
waiting for message. Exiting");return;}
			catch(ShutdownSignalException sse){ System.err.println("Caught shutdown
signal. Exiting");return;}
			catch(IOException ex){System.err.println("Unexpected IO error.
Exiting");}
		}
	}

	private void close() throws IOException
	{
		senderChannel.getConnection().close();
		receiverChannel.getConnection().close();
	}

	public static class SimpleForwarder extends Thread
	{
		ConnectionParameters parameters;
		Channel senderChannel;
		Channel receiverChannel;
		QueueingConsumer consumer;
		String sourceQueue;
		String targetRoutingKey;

		public SimpleForwarder(ConnectionParameters parameters, String
sourceQueue, String targetRoutingKey)
		{
			this.parameters = parameters;
			this.sourceQueue = sourceQueue;
			this.targetRoutingKey = targetRoutingKey;
			this.setName(sourceQueue);
		}

		private void init() throws IOException
		{
			senderChannel = new
ConnectionFactory(parameters).newConnection("localhost").createChannel();
			receiverChannel = new
ConnectionFactory(parameters).newConnection("localhost").createChannel();
			receiverChannel.basicQos(1);
			receiverChannel.queueDeclare(sourceQueue, false);
			receiverChannel.queueBind(sourceQueue, "amq.direct", sourceQueue);
			consumer = new QueueingConsumer(receiverChannel);
			receiverChannel.basicConsume(sourceQueue, false, consumer);
		}
		@Override
		public void run()
		{
			try{init();}catch(IOException ex){System.err.println("Error initializing.
Exiting.");close();return;}
			while(!Thread.currentThread().isInterrupted())
			{
				try
				{
					Delivery delivery = consumer.nextDelivery(5000);

					if(delivery != null)
					{
						String key = new
String(((LongString)delivery.getProperties().getHeaders().get("MESSAGE_KEY")).getBytes());
						String data = new String(delivery.getBody());

	/* -- PROBLEM -- */
	//---------  	THIS CAUSES the problem. (BUT ONLY WHEN SimpleForwarders are
running IN THE SAME JVM).
						BasicProperties props = MessageProperties.PERSISTENT_TEXT_PLAIN;

	//---------		THIS NEVER CAUSES PROBLEM EVEN when SimpleForwarders IN THE
SAME JVM
	//					BasicProperties props = delivery.getProperties();
	/* -- END OF PROBLEM -- */
						
						props.setHeaders(new HashMap<String, Object>());
						props.getHeaders().put("MESSAGE_KEY", key);
						senderChannel.basicPublish("amq.direct", targetRoutingKey, props ,
data.getBytes());
						receiverChannel.basicAck(delivery.getEnvelope().getDeliveryTag(),
false);
					}
				}
				catch(InterruptedException ex){System.err.println("[" +
Thread.currentThread().getName() + "] Interrupted while waiting for message.
Exiting");close();return;}
				catch(ShutdownSignalException sse){ System.err.println("[" +
Thread.currentThread().getName() + "] Caught shutdown signal.
Exiting");close();return;}
				catch(IOException ex){System.err.println("[" +
Thread.currentThread().getName() + "] Unexpected IO error.
Exiting");return;}
			}
		}
		public void close()
		{
			try
			{
				senderChannel.getConnection().close();
				receiverChannel.getConnection().close();
			}
			catch(IOException ex)
			{
				System.err.println("Close failed");
			}
		}
	}

	public static void main(String[] args) throws IOException
	{
		ConnectionParameters params = new ConnectionParameters();
		params.setPassword("guest");
		params.setUsername("guest");
		params.setVirtualHost("/");

		SimpleForwarder f1 = new SimpleForwarder(params, "QueueA", "QueueB");
		SimpleForwarder f2 = new SimpleForwarder(params, "QueueB", "Replies");
		f1.start();
		f2.start();

		Tester tester = new Tester(params, "Replies", "QueueA");
		tester.test(1000);
	}
}


-- 
View this message in context: http://old.nabble.com/Problem-with-BasicProperties-%28bug-%29-tp28351417p28351417.html
Sent from the RabbitMQ mailing list archive at Nabble.com.



From matthias at rabbitmq.com  Sun Apr 25 12:24:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 25 Apr 2010 12:24:07 +0100
Subject: [rabbitmq-discuss] Problem with BasicProperties (bug?)
In-Reply-To: <28351417.post@talk.nabble.com>
References: <28351417.post@talk.nabble.com>
Message-ID: <4BD42657.1070907@rabbitmq.com>

Hi,

radisb wrote:
> The problem is in the forwarding threads code. If before forwarding the
> message, the thread recreates the BasicProperties and sends a fresh
> BasicProperties , this causes the consumer on Replies to lose messages and
> get duplicates in their place. Sometimes the forwarder throws null pointer
> exception because it cant find the header that has the key(This cant happen
> because all messages are assigned one before sending). What is strange is
> that if the 2 forwarders are started in separate JVMs the problem
> disappears.
 > [...]
> 	BasicProperties props = MessageProperties.PERSISTENT_TEXT_PLAIN;
>       [...]
> 	props.setHeaders(new HashMap<String, Object>());

That last line ends up modifying the 
MessageProperties.PERSISTENT_TEXT_PLAIN object. That's bad in itself, 
but made worse by the fact that you have multiple threads doing this 
concurrently.

To avoid this, you should clone() the object first and then use/modify 
the clone instead.

Regards,

Matthias.


From radisb at gmail.com  Sun Apr 25 18:10:44 2010
From: radisb at gmail.com (radisb)
Date: Sun, 25 Apr 2010 10:10:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem with BasicProperties (bug?)
In-Reply-To: <4BD42657.1070907@rabbitmq.com>
References: <28351417.post@talk.nabble.com> <4BD42657.1070907@rabbitmq.com>
Message-ID: <28357380.post@talk.nabble.com>


Hi matthias, 
 I looked into the source code of MessageProperties.XXXXX and the reason for
the problem is that   MessageProperties.XXXXX are static final. This means
that either I am mistaken in thinking that their use were as a shortcut for
construction of BasicProperties, or they shouldnt be static. 
But I then read in the javadoc that they are "Constant holder class with
useful static instances of AMQContentHeader. These are intended for use with
Channel.basicPublish". This makes sense but the problem is that the
BasicProperty class holds user data (the headers) that is to be set and get
by the user. So the kind of use  MessageProperties.XXXXX the javadoc
suggests, is useless for me because this way how am I going to set my
headers before calling basicPublish? I have to create a fresh
BasicProperties instance to set the headers and then pass them to
basicPublish. And since MessageProperties.XXXX is static , the only way to
do that is create BasicProperties by constructor. The constructor has many
boilerplate arguments, thats why I though the MessageProperties where a
convinience for construction. It seems the current design of
MessageProperties assumes the user is only making use of the body and not
the headers. For those users that they need access to headers (and I think
they are a lot) shouldn't we provide the same convinience? :wistle::-D


Thanks a lot,

Bill Radis.


Matthias Radestock-3 wrote:
> 
> Hi,
> 
> radisb wrote:
>> The problem is in the forwarding threads code. If before forwarding the
>> message, the thread recreates the BasicProperties and sends a fresh
>> BasicProperties , this causes the consumer on Replies to lose messages
>> and
>> get duplicates in their place. Sometimes the forwarder throws null
>> pointer
>> exception because it cant find the header that has the key(This cant
>> happen
>> because all messages are assigned one before sending). What is strange is
>> that if the 2 forwarders are started in separate JVMs the problem
>> disappears.
>  > [...]
>> 	BasicProperties props = MessageProperties.PERSISTENT_TEXT_PLAIN;
>>       [...]
>> 	props.setHeaders(new HashMap<String, Object>());
> 
> That last line ends up modifying the 
> MessageProperties.PERSISTENT_TEXT_PLAIN object. That's bad in itself, 
> but made worse by the fact that you have multiple threads doing this 
> concurrently.
> 
> To avoid this, you should clone() the object first and then use/modify 
> the clone instead.
> 
> Regards,
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Problem-with-BasicProperties-%28bug-%29-tp28351417p28357380.html
Sent from the RabbitMQ mailing list archive at Nabble.com.



From matthias at rabbitmq.com  Sun Apr 25 19:51:37 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 25 Apr 2010 19:51:37 +0100
Subject: [rabbitmq-discuss] Problem with BasicProperties (bug?)
In-Reply-To: <28357380.post@talk.nabble.com>
References: <28351417.post@talk.nabble.com> <4BD42657.1070907@rabbitmq.com>
	<28357380.post@talk.nabble.com>
Message-ID: <4BD48F39.8040904@rabbitmq.com>

Bill,

radisb wrote:
> So the kind of use  MessageProperties.XXXXX the javadoc
> suggests, is useless for me because this way how am I going to set my
> headers before calling basicPublish?

You can call clone() on the MessageProperties.XXXXX and then set the 
headers on the result, as I suggested in my first reply.


Matthias.


From seemasbiradar at gmail.com  Mon Apr 26 10:28:09 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Mon, 26 Apr 2010 14:58:09 +0530
Subject: [rabbitmq-discuss] Producers send messages ! Consumer is Slow
Message-ID: <l2n558967a41004260228w5d637586ke534a238b36236da@mail.gmail.com>

Hi ,

I have a Producer and consumer programs written in java.
Producer sends 2 Lakhs message, each message of 820 Byte. consumer is
offline.

when Consumer come live , the rate of consuming message is very low.
Can you please suggest me how can I increase the rate of Consuming the
message.
and also please let me know is there any reason why the rate is less?

Thanks,
Seema
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100426/e0557b2b/attachment.htm 

From matthew at lshift.net  Mon Apr 26 13:10:25 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 26 Apr 2010 13:10:25 +0100
Subject: [rabbitmq-discuss] Release of HA + Pacemaker guide
Message-ID: <20100426121025.GC20993@mrnibble.lshift.net>

The RabbitMQ HA + Pacemaker guide has made its way onto the live website
and can be accessed at http://www.rabbitmq.com/pacemaker.html

Note that this is really only the start of the story for HA and RabbitMQ
- we hope that this will be of use to people, but we are aware that
dozens of things fall under the heading of HA and we currently cover
very few of them.

Feedback is very welcome and please let us know if there are specific
needs that you have for HA which are not yet covered (there will be
many!).

Matthew


From joehealy at gmail.com  Mon Apr 26 14:48:12 2010
From: joehealy at gmail.com (Joe Healy)
Date: Mon, 26 Apr 2010 23:48:12 +1000
Subject: [rabbitmq-discuss] Release of HA + Pacemaker guide
In-Reply-To: <20100426121025.GC20993@mrnibble.lshift.net>
References: <20100426121025.GC20993@mrnibble.lshift.net>
Message-ID: <k2ib22588821004260648p1a0bbdbbx7835be1614149d5f@mail.gmail.com>

Thanks - this is a great guide for ha rabbit.

We've been using a similar set up for a couple of months with iscsi instead
of drdb.

Do you need to add resource grouping or colocation to the bunny and ip
resources to make sure that they move together? Is it important that the ip
migrates before the bunny starts so that it will listen on the right
address?

Cheers,

Joe


On Mon, Apr 26, 2010 at 10:10 PM, Matthew Sackman <matthew at lshift.net>wrote:

> The RabbitMQ HA + Pacemaker guide has made its way onto the live website
> and can be accessed at http://www.rabbitmq.com/pacemaker.html
>
> Note that this is really only the start of the story for HA and RabbitMQ
> - we hope that this will be of use to people, but we are aware that
> dozens of things fall under the heading of HA and we currently cover
> very few of them.
>
> Feedback is very welcome and please let us know if there are specific
> needs that you have for HA which are not yet covered (there will be
> many!).
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100426/f8bd59a2/attachment.htm 

From matthew at lshift.net  Mon Apr 26 14:59:38 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 26 Apr 2010 14:59:38 +0100
Subject: [rabbitmq-discuss] Release of HA + Pacemaker guide
In-Reply-To: <k2ib22588821004260648p1a0bbdbbx7835be1614149d5f@mail.gmail.com>
References: <20100426121025.GC20993@mrnibble.lshift.net>
	<k2ib22588821004260648p1a0bbdbbx7835be1614149d5f@mail.gmail.com>
Message-ID: <20100426135938.GD20993@mrnibble.lshift.net>

Hi Joe,

On Mon, Apr 26, 2010 at 11:48:12PM +1000, Joe Healy wrote:
> Thanks - this is a great guide for ha rabbit.

Good to hear!

> We've been using a similar set up for a couple of months with iscsi instead
> of drdb.

Yup. I was simply using drbd because it's pretty much the lowest common
denominator - (e)nbd would also be possible (over RAID 1), but that's
more fiddly. iscsi / NAS / SAN and such ilk would, I'd expect, give
better results.

> Do you need to add resource grouping or colocation to the bunny and ip
> resources to make sure that they move together? Is it important that the ip
> migrates before the bunny starts so that it will listen on the right
> address?

Yes and yes:

"crm(ip)# configure primitive ip ocf:heartbeat:IPaddr2 params ip="192.168.50.1" cidr_netmask="24"
crm(ip)# configure colocation bunny_on_ip inf: bunny ip
crm(ip)# configure order bunny_after_ip inf: ip bunny

This should all be looking rather familiar by now. We create the ip
resource, we say that the bunny resource must run on the same node as
the ip resource, and we make sure that the bunny resource is started
after, and stopped before, the ip resource."

These are necessary steps - sure, you could have bunny just listen on
0.0.0.0 which is the default, but if the network i/f isn't there when it
starts then there may be problems. I'm not quite sure what the IPaddr2
script is doing, but it's clearly at least slightly magic - the
interface doesn't show up in the output of ifconfig. In general, I found
things more reliable if the IP address is already there before bunny
starts up.

Matthew


From joehealy at gmail.com  Mon Apr 26 15:02:40 2010
From: joehealy at gmail.com (Joe Healy)
Date: Tue, 27 Apr 2010 00:02:40 +1000
Subject: [rabbitmq-discuss] Release of HA + Pacemaker guide
In-Reply-To: <20100426135938.GD20993@mrnibble.lshift.net>
References: <20100426121025.GC20993@mrnibble.lshift.net>
	<k2ib22588821004260648p1a0bbdbbx7835be1614149d5f@mail.gmail.com>
	<20100426135938.GD20993@mrnibble.lshift.net>
Message-ID: <p2vb22588821004260702o546fa733ncb0dcb6985c45f25@mail.gmail.com>

Apologies there - a quick read and I missed the colocation part.

Thanks,

Joe


On Mon, Apr 26, 2010 at 11:59 PM, Matthew Sackman <matthew at lshift.net>wrote:

> Hi Joe,
>
> On Mon, Apr 26, 2010 at 11:48:12PM +1000, Joe Healy wrote:
> > Thanks - this is a great guide for ha rabbit.
>
> Good to hear!
>
> > We've been using a similar set up for a couple of months with iscsi
> instead
> > of drdb.
>
> Yup. I was simply using drbd because it's pretty much the lowest common
> denominator - (e)nbd would also be possible (over RAID 1), but that's
> more fiddly. iscsi / NAS / SAN and such ilk would, I'd expect, give
> better results.
>
> > Do you need to add resource grouping or colocation to the bunny and ip
> > resources to make sure that they move together? Is it important that the
> ip
> > migrates before the bunny starts so that it will listen on the right
> > address?
>
> Yes and yes:
>
> "crm(ip)# configure primitive ip ocf:heartbeat:IPaddr2 params
> ip="192.168.50.1" cidr_netmask="24"
> crm(ip)# configure colocation bunny_on_ip inf: bunny ip
> crm(ip)# configure order bunny_after_ip inf: ip bunny
>
> This should all be looking rather familiar by now. We create the ip
> resource, we say that the bunny resource must run on the same node as
> the ip resource, and we make sure that the bunny resource is started
> after, and stopped before, the ip resource."
>
> These are necessary steps - sure, you could have bunny just listen on
> 0.0.0.0 which is the default, but if the network i/f isn't there when it
> starts then there may be problems. I'm not quite sure what the IPaddr2
> script is doing, but it's clearly at least slightly magic - the
> interface doesn't show up in the output of ifconfig. In general, I found
> things more reliable if the IP address is already there before bunny
> starts up.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100427/4cb49c01/attachment.htm 

From matthew at lshift.net  Mon Apr 26 15:27:43 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 26 Apr 2010 15:27:43 +0100
Subject: [rabbitmq-discuss] help to get RabbitMQ working
In-Reply-To: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A057B3@34093-MBX-C10.mex07a.mlsrvr.com>
References: <CEC76B79C85FAB45848BFBF2B1AE23ED2374A0566F@34093-MBX-C10.mex07a.mlsrvr.com>
	<20100420173537.GL1515@mrnibble.lshift.net>
	<CEC76B79C85FAB45848BFBF2B1AE23ED2374A057B3@34093-MBX-C10.mex07a.mlsrvr.com>
Message-ID: <20100426142743.GF20993@mrnibble.lshift.net>

On Tue, Apr 20, 2010 at 02:47:03PM -0500, John Harrison wrote:
> I had put spaces in the .conf file which it did not like then I needed to kill all process for the rabbitmq user.

Ahh yes. Spaces in variables which are interpreted and requoted multiple
times by shell scripts are painful to say the least. Though it's even
worse under Windows with BAT files.

Needless to say, the consolidation of the mess of our configuration
mechanisms is on our todo list.

Matthew


From matthew at lshift.net  Mon Apr 26 15:32:08 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 26 Apr 2010 15:32:08 +0100
Subject: [rabbitmq-discuss] rabbitmq-shovel
In-Reply-To: <v2yad81937d1004211812q3ba16d49q37e2e741aadaf3b0@mail.gmail.com>
References: <D35D6AD7-E952-44C8-9277-BCFF5AF7FFE4@admob.com>
	<v2yad81937d1004211812q3ba16d49q37e2e741aadaf3b0@mail.gmail.com>
Message-ID: <20100426143208.GG20993@mrnibble.lshift.net>

On Wed, Apr 21, 2010 at 07:12:21PM -0600, Scott Brooks wrote:
> I'm not sure if it's stripping the / or not.

Yes. This is probably the most unsavoury part of the schema. The problem
is that a) we need to support vhosts that start with / and that don't
start with /; b) the default vhost is /

Thus:

amqp://user:pass at host/   => vhost = /
amqp://user:pass at host//  => vhost = /
amqp://user:pass at host/a  => vhost = a
amqp://user:pass at host//a => vhost = /a

So basically, the first / is definitely just a separator, so if your
vhost is not / but does start with a /, then you need to add another /.
The confusion arises because the separator is / and the default vhost is
also /

Matthew


From matthew at lshift.net  Mon Apr 26 15:40:05 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 26 Apr 2010 15:40:05 +0100
Subject: [rabbitmq-discuss] init terminating in do_boot at starting time
In-Reply-To: <4FDB5633-D663-4629-B2CF-004211404E63@admob.com>
References: <4FDB5633-D663-4629-B2CF-004211404E63@admob.com>
Message-ID: <20100426144005.GH20993@mrnibble.lshift.net>

Hi Mark,

On Thu, Apr 22, 2010 at 07:23:29PM -0700, Mark Lin wrote:
> Running debian version(lenny) of rabbitmq.  After upgrading erlang with backported version of erlang-* packages, I start to see this error message.
> 
> sudo -u rabbitmq rabbitmq-server
> {"init terminating in do_boot",{'cannot load',error_handler,get_files}}
> 
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()

Hmm. That's interesting. What happens if you just run "erl", or maybe
just run "erl" as the rabbitmq user (sudo -u rabbitmq erl) ?

> It looks like I am doing something really fundamentally wrong.  I needed the new version of erlang packages because rabbitmq-shovel plugin needs rabbitmq-inets package which only exists in squeeze and above branch.  Appreciate any suggestion and help.

Not sure what you mean by rabbitmq-inets. There is currently a bug in
Rabbit which means that the current default head can't work on 12b3, but
it really should, and I think 12b3 is the version in lenny ...

What's the version of erlang in the backports?

Presumeably you're building from source? In which case "make cleandb
run" in the rabbitmq-server dir should start up rabbit as the current
user: if you're wishing to use the shovel you may find it doesn't work
with the 1.7.2 release, so it might actually just be a permissions issue
with the rabbitmq user trying and failing to read the beam files that
you've compiled yourself, or it might be trying to write log files and
getting permission errors - hence if you just try "make run" from the
rabbitmq-server, it sets up everything to write under /tmp.

Matthew


From matthew at lshift.net  Mon Apr 26 15:45:30 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 26 Apr 2010 15:45:30 +0100
Subject: [rabbitmq-discuss] Producers send messages ! Consumer is Slow
In-Reply-To: <l2n558967a41004260228w5d637586ke534a238b36236da@mail.gmail.com>
References: <l2n558967a41004260228w5d637586ke534a238b36236da@mail.gmail.com>
Message-ID: <20100426144530.GI20993@mrnibble.lshift.net>

Hi Seema,

On Mon, Apr 26, 2010 at 02:58:09PM +0530, Seema Biradar wrote:
> I have a Producer and consumer programs written in java.

Using the RabbitMQ Java client?

> Producer sends 2 Lakhs message, each message of 820 Byte. consumer is
> offline.
> 
> when Consumer come live , the rate of consuming message is very low.

Are you actually trying to measure the rate of messages from 2 messages
alone? That's a somewhat small sample set - what happens if the producer
sends 2000 * 820B messages in and then you start up the consumer?

> Can you please suggest me how can I increase the rate of Consuming the
> message.

Well, you haven't actually told us what the rates are you're seeing. We
really need rather more information from you before we can start making
any suggestions.

Matthew


From nfontes at cynigram.com  Mon Apr 26 19:58:24 2010
From: nfontes at cynigram.com (Noah Fontes)
Date: Mon, 26 Apr 2010 13:58:24 -0500
Subject: [rabbitmq-discuss] Erlang client RPC and dropped messages
Message-ID: <4BD5E250.9070606@cynigram.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi all,

I'm encountering an issue with publishing messages that are
mandatory/persisted (i.e., we can't risk dropping the messages). I have
a tool similar to rabbitmq-shovel (developed slightly before it). It
works like this:

1. A message is read from a queue on a local RabbitMQ instance.
2. The message is then published to a remote exchange, and if no errors
occur, acked. I attempt re-publish the message if I get a rejected call
from the remote RabbitMQ instance. This works almost all the time,
however...

I'm also listening for connection drops on the local and remote
connections, and re-establishing them if they go down. So something like
this occurs:

1. The connection to the remote RabbitMQ exchange is dropped (often this
is because I accidentally let way too many messages build up and the
node crashes, but that's a topic for another day and I'm guessing the
new persister is going to fix this issue quite nicely); however, no-one
is notified of the dropped connection because as far as I can tell the
checks for this are only run when data actually goes across the connection.

2. A message is read from the local queue and published to the remote
exchange (via amqp_channel:cast/3), which appears to be successful.
Relevant comments from rabbit_writer.erl are included here:
%% So instead we lift the code from prim_inet:send/2, which is what
%% gen_tcp:send/2 calls, do the first half here and then just process
%% the result code in handle_message/2 as and when it arrives.
%%
%% This means we may end up happily sending data down a closed/broken
%% socket, but that's ok since a) data in the buffers will be lost in
%% any case (so qualitatively we are no worse off than if we used
%% gen_tcp:send/2), and b) we do detect the changed socket status
%% eventually, i.e. when we get round to handling the result code.

3. After the message is "written" to the exchange, the connection is
seen as closed, messages are sent out to listening Erlang processes, and
a new connection is subsequently re-established by my code.

However, at this point the message that caused the connection drop to be
noticed is permanently lost; since the connection wasn't actually active
when it was published it can't possibly be rejected, and since no errors
were thrown at publish-time, it appears as if the message was sent
successfully. In our code, this results in ~50% data loss when a node
unexpectedly goes down.

I'm open to suggestions on a better way to architect my code to get
around this issue, but it seems (to me, and I must confess my general
ignorance to the implementation) like a bug or at least something that
should be addressed/cautioned about.

Regards and thanks in advance for any advice!

Noah
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEARECAAYFAkvV4lAACgkQhitK+HuUQJTdbwCffk73y5iuzUOuBNoqi+bZpa3X
NtcAoKZKOd2G8TDeelp6uKfEV9I7QcGQ
=FvNz
-----END PGP SIGNATURE-----


From matthew at lshift.net  Mon Apr 26 20:37:55 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 26 Apr 2010 20:37:55 +0100
Subject: [rabbitmq-discuss] Erlang client RPC and dropped messages
In-Reply-To: <4BD5E250.9070606@cynigram.com>
References: <4BD5E250.9070606@cynigram.com>
Message-ID: <20100426193755.GA5451@wellquite.org>

Hi Noah,

On Mon, Apr 26, 2010 at 01:58:24PM -0500, Noah Fontes wrote:
> 1. The connection to the remote RabbitMQ exchange is dropped (often this
> is because I accidentally let way too many messages build up and the
> node crashes, but that's a topic for another day and I'm guessing the
> new persister is going to fix this issue quite nicely); however, no-one
> is notified of the dropped connection because as far as I can tell the
> checks for this are only run when data actually goes across the connection.

Correct, though you could set heartbeat to non-zero. That should get you
more prompt notification.

> 2. A message is read from the local queue and published to the remote
> exchange (via amqp_channel:cast/3), which appears to be successful.

Be aware of cast. Cast returns as soon as the message has been added to
the writer's mailbox (and actually can be sooner...). Needless to say,
this does not suggest the message has made it out of the socket, or even
been looked at by the socket writer. In general, I tend to use
amqp_channel:call, not cast, for almost everything as it avoids millions
of messages backing up in the mailbox of the writer process.

> Relevant comments from rabbit_writer.erl are included here:
> %% So instead we lift the code from prim_inet:send/2, which is what
> %% gen_tcp:send/2 calls, do the first half here and then just process
> %% the result code in handle_message/2 as and when it arrives.
> %%
> %% This means we may end up happily sending data down a closed/broken
> %% socket, but that's ok since a) data in the buffers will be lost in
> %% any case (so qualitatively we are no worse off than if we used
> %% gen_tcp:send/2), and b) we do detect the changed socket status
> %% eventually, i.e. when we get round to handling the result code.

Indeed, so using call, not cast, pretty much gets you to this point, but
obviously no further.

> 3. After the message is "written" to the exchange, the connection is
> seen as closed, messages are sent out to listening Erlang processes, and
> a new connection is subsequently re-established by my code.
> 
> However, at this point the message that caused the connection drop to be
> noticed is permanently lost; since the connection wasn't actually active
> when it was published it can't possibly be rejected, and since no errors
> were thrown at publish-time, it appears as if the message was sent
> successfully. In our code, this results in ~50% data loss when a node
> unexpectedly goes down.

Right. What you're doing is fine, but with your approach you clearly
need to hold on to the most recent message you received in case the
connection drops and you then need to resend it. Furthermore, as you're
using cast, you could have millions of messages queued up with the
writer process mailbox which all would be lost.

However, you're not acking. So, on connection drop to the remote, you
could also connection drop to the local. Then, the local broker will
requeue everything that's not been acked, and when you reconnect, you'll
find it all there. Now at that point, any ordering guarantees you had go
out the window, but that may not be a concern. Assuming you're using
basic.consume, you could set qos to prefetch of 1, which would then mean
that at most one message is buffered in the client without it being
acked, significantly limiting your exposure.

Finally, if you want to be really sure, use transactions to the
destination - that way you know you have to hang on to everything you've
published up until you get the commit_ok back, and then you are
guaranteed that it's been received.

And in an obvious plug, our shovel is capable of dealing with these
issues. ;)

Matthew


From nfontes at cynigram.com  Mon Apr 26 21:20:55 2010
From: nfontes at cynigram.com (Noah Fontes)
Date: Mon, 26 Apr 2010 15:20:55 -0500
Subject: [rabbitmq-discuss] Erlang client RPC and dropped messages
In-Reply-To: <20100426193755.GA5451@wellquite.org>
References: <4BD5E250.9070606@cynigram.com>
	<20100426193755.GA5451@wellquite.org>
Message-ID: <4BD5F5A7.9040808@cynigram.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Matthew,

Thanks a lot for the clarification! I was thoroughly confused and this
all makes a lot more sense now. I think I'll try the transactional
method (or perhaps even work on replacing our current system with
rabbitmq-shovel).

Much appreciated,

Noah

Matthew Sackman wrote:
> Hi Noah,
> 
> On Mon, Apr 26, 2010 at 01:58:24PM -0500, Noah Fontes wrote:
>> 1. The connection to the remote RabbitMQ exchange is dropped (often this
>> is because I accidentally let way too many messages build up and the
>> node crashes, but that's a topic for another day and I'm guessing the
>> new persister is going to fix this issue quite nicely); however, no-one
>> is notified of the dropped connection because as far as I can tell the
>> checks for this are only run when data actually goes across the connection.
> 
> Correct, though you could set heartbeat to non-zero. That should get you
> more prompt notification.
> 
>> 2. A message is read from the local queue and published to the remote
>> exchange (via amqp_channel:cast/3), which appears to be successful.
> 
> Be aware of cast. Cast returns as soon as the message has been added to
> the writer's mailbox (and actually can be sooner...). Needless to say,
> this does not suggest the message has made it out of the socket, or even
> been looked at by the socket writer. In general, I tend to use
> amqp_channel:call, not cast, for almost everything as it avoids millions
> of messages backing up in the mailbox of the writer process.
> 
>> Relevant comments from rabbit_writer.erl are included here:
>> %% So instead we lift the code from prim_inet:send/2, which is what
>> %% gen_tcp:send/2 calls, do the first half here and then just process
>> %% the result code in handle_message/2 as and when it arrives.
>> %%
>> %% This means we may end up happily sending data down a closed/broken
>> %% socket, but that's ok since a) data in the buffers will be lost in
>> %% any case (so qualitatively we are no worse off than if we used
>> %% gen_tcp:send/2), and b) we do detect the changed socket status
>> %% eventually, i.e. when we get round to handling the result code.
> 
> Indeed, so using call, not cast, pretty much gets you to this point, but
> obviously no further.
> 
>> 3. After the message is "written" to the exchange, the connection is
>> seen as closed, messages are sent out to listening Erlang processes, and
>> a new connection is subsequently re-established by my code.
>>
>> However, at this point the message that caused the connection drop to be
>> noticed is permanently lost; since the connection wasn't actually active
>> when it was published it can't possibly be rejected, and since no errors
>> were thrown at publish-time, it appears as if the message was sent
>> successfully. In our code, this results in ~50% data loss when a node
>> unexpectedly goes down.
> 
> Right. What you're doing is fine, but with your approach you clearly
> need to hold on to the most recent message you received in case the
> connection drops and you then need to resend it. Furthermore, as you're
> using cast, you could have millions of messages queued up with the
> writer process mailbox which all would be lost.
> 
> However, you're not acking. So, on connection drop to the remote, you
> could also connection drop to the local. Then, the local broker will
> requeue everything that's not been acked, and when you reconnect, you'll
> find it all there. Now at that point, any ordering guarantees you had go
> out the window, but that may not be a concern. Assuming you're using
> basic.consume, you could set qos to prefetch of 1, which would then mean
> that at most one message is buffered in the client without it being
> acked, significantly limiting your exposure.
> 
> Finally, if you want to be really sure, use transactions to the
> destination - that way you know you have to hang on to everything you've
> published up until you get the commit_ok back, and then you are
> guaranteed that it's been received.
> 
> And in an obvious plug, our shovel is capable of dealing with these
> issues. ;)
> 
> Matthew

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEARECAAYFAkvV9acACgkQhitK+HuUQJSKwgCgn881Wc100Ck+h+1DknhhwEsl
rgQAnjUyC68Ehg1SRqFWeMUCEapmmaQc
=JuyV
-----END PGP SIGNATURE-----


From mlin at admob.com  Mon Apr 26 22:06:36 2010
From: mlin at admob.com (Mark Lin)
Date: Mon, 26 Apr 2010 14:06:36 -0700
Subject: [rabbitmq-discuss] compiled plugin for debian packaged
	rabbitmq-server
Message-ID: <B809D4C8-5EEE-472F-9892-4219F3B4F772@admob.com>

Rabbitmq-shovel plugin works  compiling from source and following README instructions.  When I copy the compiled .ez files 

amqp_client.ez  rabbit_common.ez  rabbitmq-shovel.ez

from rabbitmq-shovel/dist  to rabbitmq plugin directory that I specified in /etc/rabbitmq/rabbitmq.conf

RABBITMQ_PLUGINS_DIR=/usr/lib/rabbitmq/plugins

and issued rabbitmq-activate-plugins, I got this error:

ERROR: generation of boot script file /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.script failed:
Duplicated modules: 
        rabbit_writer specified in rabbit and rabbit_common
        rabbit_reader specified in rabbit and rabbit_common
        rabbit_net specified in rabbit and rabbit_common
        rabbit_misc specified in rabbit and rabbit_common
        rabbit_heartbeat specified in rabbit and rabbit_common
        rabbit_framing_channel specified in rabbit and rabbit_common
        rabbit_framing specified in rabbit and rabbit_common
        rabbit_channel specified in rabbit and rabbit_common
        rabbit_binary_parser specified in rabbit and rabbit_common
        rabbit_binary_generator specified in rabbit and rabbit_common
        rabbit_basic specified in rabbit and rabbit_common
        priority_queue specified in rabbit and rabbit_common
        gen_server2 specified in rabbit and rabbit_common

If I remove rabbit_common.ez or use "ln -s" to create a soft link of rabbitmq-shovel in plugin directory, then activate works.  But when I kick off server, I got this error:

{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_shovel,{bad_return,{{rabbit_shovel,start,[normal,[]]},{'EXIT',{undef,[{rabbit_framing,method_record,['queue.declare']},{rabbit_shovel_sup,parse_declaration,1},{lists,foldl,3},{rabbit_shovel_sup,parse_endpoint,1},{rabbit_shovel_sup,'-parse_shovel_config_dict/1-fun-7-',4},{lists,foldl,3},{rabbit_shovel_sup,parse_shovel_config,3},{rabbit_shovel_sup,parse_configuration,3}]}}}}}"}


Erlang system version:
System version: Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]

Any idea? 


Thanks,
Mark

From mlin at admob.com  Mon Apr 26 22:08:17 2010
From: mlin at admob.com (Mark Lin)
Date: Mon, 26 Apr 2010 14:08:17 -0700
Subject: [rabbitmq-discuss] compiled plugin for debian packaged
	rabbitmq-server
Message-ID: <DF772B9F-8D92-4242-95FE-15E0CE6238F7@admob.com>

Rabbitmq-shovel plugin works  compiling from source and following README instructions.  When I copy the compiled .ez files 

amqp_client.ez  rabbit_common.ez  rabbitmq-shovel.ez

from rabbitmq-shovel/dist  to rabbitmq plugin directory that I specified in /etc/rabbitmq/rabbitmq.conf

RABBITMQ_PLUGINS_DIR=/usr/lib/rabbitmq/plugins

and issued rabbitmq-activate-plugins, I got this error:

ERROR: generation of boot script file /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.script failed:
Duplicated modules: 
       rabbit_writer specified in rabbit and rabbit_common
       rabbit_reader specified in rabbit and rabbit_common
       rabbit_net specified in rabbit and rabbit_common
       rabbit_misc specified in rabbit and rabbit_common
       rabbit_heartbeat specified in rabbit and rabbit_common
       rabbit_framing_channel specified in rabbit and rabbit_common
       rabbit_framing specified in rabbit and rabbit_common
       rabbit_channel specified in rabbit and rabbit_common
       rabbit_binary_parser specified in rabbit and rabbit_common
       rabbit_binary_generator specified in rabbit and rabbit_common
       rabbit_basic specified in rabbit and rabbit_common
       priority_queue specified in rabbit and rabbit_common
       gen_server2 specified in rabbit and rabbit_common

If I remove rabbit_common.ez or use "ln -s" to create a soft link of rabbitmq-shovel in plugin directory, then activate works.  But when I kick off server, I got this error:

{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_shovel,{bad_return,{{rabbit_shovel,start,[normal,[]]},{'EXIT',{undef,[{rabbit_framing,method_record,['queue.declare']},{rabbit_shovel_sup,parse_declaration,1},{lists,foldl,3},{rabbit_shovel_sup,parse_endpoint,1},{rabbit_shovel_sup,'-parse_shovel_config_dict/1-fun-7-',4},{lists,foldl,3},{rabbit_shovel_sup,parse_shovel_config,3},{rabbit_shovel_sup,parse_configuration,3}]}}}}}"}


Erlang system version:
System version: Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]

Any idea? 


Thanks,
Mark

From mlin at admob.com  Mon Apr 26 22:09:49 2010
From: mlin at admob.com (Mark Lin)
Date: Mon, 26 Apr 2010 14:09:49 -0700
Subject: [rabbitmq-discuss] compiled plugin for debian packaged
	rabbitmq-server
Message-ID: <5E4E1304-4897-4AA1-AB01-C0DCA751FF3F@admob.com>

Rabbitmq-shovel plugin works  compiling from source and following README instructions.  When I copy the compiled .ez files 

amqp_client.ez  rabbit_common.ez  rabbitmq-shovel.ez

from rabbitmq-shovel/dist  to rabbitmq plugin directory that I specified in /etc/rabbitmq/rabbitmq.conf

RABBITMQ_PLUGINS_DIR=/usr/lib/rabbitmq/plugins

and issued rabbitmq-activate-plugins, I got this error:

ERROR: generation of boot script file /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.script failed:
Duplicated modules: 
      rabbit_writer specified in rabbit and rabbit_common
      rabbit_reader specified in rabbit and rabbit_common
      rabbit_net specified in rabbit and rabbit_common
      rabbit_misc specified in rabbit and rabbit_common
      rabbit_heartbeat specified in rabbit and rabbit_common
      rabbit_framing_channel specified in rabbit and rabbit_common
      rabbit_framing specified in rabbit and rabbit_common
      rabbit_channel specified in rabbit and rabbit_common
      rabbit_binary_parser specified in rabbit and rabbit_common
      rabbit_binary_generator specified in rabbit and rabbit_common
      rabbit_basic specified in rabbit and rabbit_common
      priority_queue specified in rabbit and rabbit_common
      gen_server2 specified in rabbit and rabbit_common

If I remove rabbit_common.ez or use "ln -s" to create a soft link of rabbitmq-shovel in plugin directory, then activate works.  But when I kick off server, I got this error:

{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_shovel,{bad_return,{{rabbit_shovel,start,[normal,[]]},{'EXIT',{undef,[{rabbit_framing,method_record,['queue.declare']},{rabbit_shovel_sup,parse_declaration,1},{lists,foldl,3},{rabbit_shovel_sup,parse_endpoint,1},{rabbit_shovel_sup,'-parse_shovel_config_dict/1-fun-7-',4},{lists,foldl,3},{rabbit_shovel_sup,parse_shovel_config,3},{rabbit_shovel_sup,parse_configuration,3}]}}}}}"}


Erlang system version:
System version: Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]

Any idea? 


Thanks,
Mark

From matthew at lshift.net  Mon Apr 26 22:14:38 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 26 Apr 2010 22:14:38 +0100
Subject: [rabbitmq-discuss] compiled plugin for debian packaged
 rabbitmq-server
In-Reply-To: <B809D4C8-5EEE-472F-9892-4219F3B4F772@admob.com>
References: <B809D4C8-5EEE-472F-9892-4219F3B4F772@admob.com>
Message-ID: <20100426211438.GB5451@wellquite.org>

Hi Mark,

On Mon, Apr 26, 2010 at 02:06:36PM -0700, Mark Lin wrote:
> Rabbitmq-shovel plugin works  compiling from source and following README instructions.  When I copy the compiled .ez files 
> 
> amqp_client.ez  rabbit_common.ez  rabbitmq-shovel.ez
> 
> from rabbitmq-shovel/dist  to rabbitmq plugin directory that I specified in /etc/rabbitmq/rabbitmq.conf
> 
> RABBITMQ_PLUGINS_DIR=/usr/lib/rabbitmq/plugins
> 
> and issued rabbitmq-activate-plugins, I got this error:
> 
> ERROR: generation of boot script file /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.script failed:
> Duplicated modules: 
>         rabbit_writer specified in rabbit and rabbit_common
>         rabbit_reader specified in rabbit and rabbit_common
>         rabbit_net specified in rabbit and rabbit_common
>         rabbit_misc specified in rabbit and rabbit_common
>         rabbit_heartbeat specified in rabbit and rabbit_common
>         rabbit_framing_channel specified in rabbit and rabbit_common
>         rabbit_framing specified in rabbit and rabbit_common
>         rabbit_channel specified in rabbit and rabbit_common
>         rabbit_binary_parser specified in rabbit and rabbit_common
>         rabbit_binary_generator specified in rabbit and rabbit_common
>         rabbit_basic specified in rabbit and rabbit_common
>         priority_queue specified in rabbit and rabbit_common
>         gen_server2 specified in rabbit and rabbit_common
> 
> If I remove rabbit_common.ez or use "ln -s" to create a soft link of rabbitmq-shovel in plugin directory, then activate works.  But when I kick off server, I got this error:

Yes. This is exactly what's meant to happen - though I do admit it's not
entirely explicitly explained by the instructions. Basically, copying
the .ez is fine, provided you don't copy in the rabbit_common.ez; or
linking is also fine, but you'll need to link to the shovel and
erlang-client.

We do have a bug open for everything we want to change about the plugin
mechanism. It's quite long.

> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_shovel,{bad_return,{{rabbit_shovel,start,[normal,[]]},{'EXIT',{undef,[{rabbit_framing,method_record,['queue.declare']},{rabbit_shovel_sup,parse_declaration,1},{lists,foldl,3},{rabbit_shovel_sup,parse_endpoint,1},{rabbit_shovel_sup,'-parse_shovel_config_dict/1-fun-7-',4},{lists,foldl,3},{rabbit_shovel_sup,parse_shovel_config,3},{rabbit_shovel_sup,parse_configuration,3}]}}}}}"}

Yes. You need something more up to date than Rabbit 1.7.2. You really
need to be compiling from the head of the default branch of
rabbitmq-server. In general, the only thing we try to ensure is that the
latest default revision on the plugin works with the latest default
revision on the server. Until we (finally) get around to packaging up
and releasing plugins, this is unlikely to change I'm afraid.

Matthew


From mlin at admob.com  Mon Apr 26 22:27:02 2010
From: mlin at admob.com (Mark Lin)
Date: Mon, 26 Apr 2010 14:27:02 -0700
Subject: [rabbitmq-discuss] compiled plugin for debian packaged
	rabbitmq-server
Message-ID: <4214D574-E1A4-42C2-AB80-C38F12009D0D@admob.com>

Rabbitmq-shovel plugin works  compiling from source and following README instructions.  When I copy the compiled .ez files 

amqp_client.ez  rabbit_common.ez  rabbitmq-shovel.ez

from rabbitmq-shovel/dist  to rabbitmq plugin directory that I specified in /etc/rabbitmq/rabbitmq.conf

RABBITMQ_PLUGINS_DIR=/usr/lib/rabbitmq/plugins

and issued rabbitmq-activate-plugins, I got this error:

ERROR: generation of boot script file /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.script failed:
Duplicated modules: 
     rabbit_writer specified in rabbit and rabbit_common
     rabbit_reader specified in rabbit and rabbit_common
     rabbit_net specified in rabbit and rabbit_common
     rabbit_misc specified in rabbit and rabbit_common
     rabbit_heartbeat specified in rabbit and rabbit_common
     rabbit_framing_channel specified in rabbit and rabbit_common
     rabbit_framing specified in rabbit and rabbit_common
     rabbit_channel specified in rabbit and rabbit_common
     rabbit_binary_parser specified in rabbit and rabbit_common
     rabbit_binary_generator specified in rabbit and rabbit_common
     rabbit_basic specified in rabbit and rabbit_common
     priority_queue specified in rabbit and rabbit_common
     gen_server2 specified in rabbit and rabbit_common

If I remove rabbit_common.ez or use "ln -s" to create a soft link of rabbitmq-shovel in plugin directory, then activate works.  But when I kick off server, I got this error:

{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_shovel,{bad_return,{{rabbit_shovel,start,[normal,[]]},{'EXIT',{undef,[{rabbit_framing,method_record,['queue.declare']},{rabbit_shovel_sup,parse_declaration,1},{lists,foldl,3},{rabbit_shovel_sup,parse_endpoint,1},{rabbit_shovel_sup,'-parse_shovel_config_dict/1-fun-7-',4},{lists,foldl,3},{rabbit_shovel_sup,parse_shovel_config,3},{rabbit_shovel_sup,parse_configuration,3}]}}}}}"}


Erlang system version:
System version: Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]

Any idea? 


Thanks,
Mark

From matthew at lshift.net  Tue Apr 27 00:12:44 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 27 Apr 2010 00:12:44 +0100
Subject: [rabbitmq-discuss] compiled plugin for debian packaged
 rabbitmq-server
In-Reply-To: <351D02CA91945E46A84F24EF5CE4AC120E7100FCB0@mercury>
References: <B809D4C8-5EEE-472F-9892-4219F3B4F772@admob.com>
	<20100426211438.GB5451@wellquite.org>
	<351D02CA91945E46A84F24EF5CE4AC120E7100FCB0@mercury>
Message-ID: <20100426231244.GA26224@wellquite.org>

Hi Mark,

On Mon, Apr 26, 2010 at 03:56:03PM -0700, Mark Lin wrote:
> Thanks for the explanation.  I just build the debian package off the checked out code, installed that version and everything works.  
> 
> I didn't find the package build doc, here what I did, plz let me know if you see anything unfit.
> 
> check out source codes with hg.
> 
> cd rabbitmq-server, modify VERSION in Makefile, this is gonna be used in source tar/zip file name.
> 
> run 'make srcdist' to make the tar ball.
> 
> cd package/debs/Debian
> 
> modified debian/changelog with my own update, ie: latest build off trunk
> 
> make pacakge.  Install any missing dependencies if command returned with error.
> 
> Install the package and happy shoveling.  

Err well that's not quite how we'd do it - the scripts we use for full
packaging aren't actually released, but certainly if it works for you
then that's absolutely fine!

Matthew


From scottblanc at gmail.com  Tue Apr 27 02:15:32 2010
From: scottblanc at gmail.com (Scott White)
Date: Mon, 26 Apr 2010 18:15:32 -0700
Subject: [rabbitmq-discuss] New persister (bug21673) crashed
In-Reply-To: <20100418181356.GB23773@wellquite.org>
References: <g2s401b577e1004180850s9c441d1dx60a5ac1971c35879@mail.gmail.com>
	<20100418162850.GA23773@wellquite.org>
	<20100418181356.GB23773@wellquite.org>
Message-ID: <t2k401b577e1004261815r54731935gcd4b7f13cacc431d@mail.gmail.com>

Hi Matthew --

Sorry for the delay in responding. I believe it was a long running queue and
I don't recall anyone doing anything special with that queue at that time.
Bizarrely, the queue did recover itself eventually although another
developer told me about it and I was not there when it happened. Sorry to be
short on details. If it happens again and I have more information, I will
share it with you.

cheers,
SCott

On Sun, Apr 18, 2010 at 11:13 AM, Matthew Sackman <matthew at lshift.net>wrote:

> On Sun, Apr 18, 2010 at 05:28:51PM +0100, Matthew Sackman wrote:
> > Yes, it recovered more off disk than it was expecting to. I have no idea
> > how that could happen, but quite a lot of code around there has changed
> > around the easter weekend, which is after the revision you're running.
>
> Just some other questions: were you doing anything in particular with
> the queue at the time? - had you just started up Rabbit or was it a long
> running queue, what kind of actions were going on in the queue at the
> time?
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100426/54e4a76c/attachment.htm 

From daniel at rimspace.net  Tue Apr 27 06:14:44 2010
From: daniel at rimspace.net (Daniel Pittman)
Date: Tue, 27 Apr 2010 15:14:44 +1000
Subject: [rabbitmq-discuss] STOMP support - production ready?
Message-ID: <877hnta33v.fsf@rimspace.net>

G'day.

We have a need for messaging infrastructure in a few places at work, and a
couple of those are integrating with the third party tools that have selected
the STOMP protocol for messaging.

I know RabbitMQ offers a STOMP plugin, and back in '08 y'all considered it
experimental, but I can't find any more recent evidence of status.

So, is the STOMP support reasonably production ready?

More specifically, is it going to be stable enough that we can use it for
non-core activities, without risking problems for real AMQP clients doing more
serious work?

        Daniel
-- 
? Daniel Pittman            ? daniel at rimspace.net            ? +61 401 155 707
               ? made with 100 percent post-consumer electrons



From aernouts_jens at hotmail.com  Tue Apr 27 08:55:19 2010
From: aernouts_jens at hotmail.com (Aernouts Jens)
Date: Tue, 27 Apr 2010 09:55:19 +0200
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
Message-ID: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>

Hi,



We want to write a Silverlight client that can communicate with RabbitMQ. The problem is that the RabbitMQ .NET client assembly doesn't work in a Silverlight environment. Silverlight is a another runtime, which is mostly compatible with .NET, but is just a subset.

We tried different approaches to find a good solution, but none of them works:

- Tried to compile the .NET client code against the Silverlight runtime. When we try that, we get some errors because there are some missing classes in Silverlight like TcpClient, XmlDocument, ArrayList, .

- Used Kaazing (http://www.kaazing.com/), a gateway to use Sockets with different languages (Silverlight, JavaScript, .). The problem here is that Kaazing only works with version 0.9.0 or 0.9.1 of the AMQP protocol, but RabbitMQ is only available with version 0.8.0.

- Tried the STOMP plug-in, because there is a (working) Silverlight client for STOMP. Sending of text works, but we have to send binary data (Protobuf serialized). This does not work, the received data is wrong (both the content as the length). We're not sure if it's the RabbitMQ STOMP plugin or the STOMP client that's doing something wrong with binary data. Is there someone who already managed to send binary data over STOMP?

We also have in mind two other possible approaches:

- Build a web service between the Silverlight client and RabbitMQ. But we want to avoid polling as this would decrease the responsiveness. This is why we want to connect straight to RabbitMQ from the Silverlight client.

- Get the RabbitMQ client Project to compile against the Silverlight runtime. This is not undoable, but requires some work. Would someone be interested in a Silverlight version of the RabbitMQ client?

Now we have some questions:

- Is there any other possible way to get a good communication between a Silverlight application and RabbitMQ?

- Is there a way to resolve the problems mentioned above?

Kind Regards

Jens Aernouts - Student Bachelor of Applied Engineering @ Artesis University College of Antwerp 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100427/0773a6f4/attachment.htm 

From mikeb at lshift.net  Tue Apr 27 09:54:35 2010
From: mikeb at lshift.net (Michael Bridgen)
Date: Tue, 27 Apr 2010 09:54:35 +0100
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
In-Reply-To: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
References: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
Message-ID: <4BD6A64B.2090806@lshift.net>

> - Used Kaazing (http://www.kaazing.com/), a gateway to use Sockets with 
> different languages (Silverlight, JavaScript, ?). The problem here is 
> that Kaazing only works with version 0.9.0 or 0.9.1 of the AMQP 
> protocol, but RabbitMQ is only available with version 0.8.0.

There is a fairly stable, just not-yet-official branch of RabbitMQ that 
supports AMQP 0-9-1.  See https://dev.rabbitmq.com/wiki/Amqp091

> We also have in mind two other possible approaches:
> 
> - Build a web service between the Silverlight client and RabbitMQ. But 
> we want to avoid polling as this would decrease the responsiveness. This 
> is why we want to connect straight to RabbitMQ from the Silverlight client.

You might also look at the Rabbit JSON RPC adapter, though this may 
suffer from the same "textiness" that the STOMP adapter does.

> - Get the RabbitMQ client Project to compile against the Silverlight 
> runtime. This is not undoable, but requires some work. Would someone be 
> interested in a Silverlight version of the RabbitMQ client?

A Silverlight client would be great to see!  How much work do you think 
this involves, and what are the main obstacles -- are there classes that 
substitute for those that are missing?


Michael


From Owain.Perry at thetrainline.com  Tue Apr 27 10:34:42 2010
From: Owain.Perry at thetrainline.com (Owain Perry)
Date: Tue, 27 Apr 2010 10:34:42 +0100
Subject: [rabbitmq-discuss] Similar behaviour to MSMQ internal outgoing
	queues?
Message-ID: <B636D27EC8708044BACDF68D95DD416803C164A5@exc4.thetrainline.com>

Newbie question:

I was trying to workout if rabbit can have similar behaviour to MSMQ
internal outgoing queues, where a client can fire and forget as MSMQ
stores the message locally. 

If I have a Rabbit Client who needs sends a message to the broker,
however the network is down between the client and the broker, Can
rabbit be configured in such away that it can accept the message locally
and deal with resubmission when the network returns?


O.





From aernouts_jens at hotmail.com  Tue Apr 27 10:56:28 2010
From: aernouts_jens at hotmail.com (Aernouts Jens)
Date: Tue, 27 Apr 2010 11:56:28 +0200
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
In-Reply-To: <4BD6A64B.2090806@lshift.net>
References: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
	<4BD6A64B.2090806@lshift.net>
Message-ID: <SNT144-ds17EF6795C3232772F3A03887030@phx.gbl>

>> - Used Kaazing (http://www.kaazing.com/), a gateway to use Sockets with 
>> different languages (Silverlight, JavaScript, ?). The problem here is 
>> that Kaazing only works with version 0.9.0 or 0.9.1 of the AMQP protocol, 
>> but RabbitMQ is only available with version 0.8.0.
>
> There is a fairly stable, just not-yet-official branch of RabbitMQ that 
> supports AMQP 0-9-1.  See https://dev.rabbitmq.com/wiki/Amqp091
>
I downloaded this version but I can't get it to work on my PC. When I run 
"rabbitmq-server.bat" I get the following:

*********************
Service control usage
*********************

rabbitmq-service help    - Display this help
rabbitmq-service install - Install the RabbitMQ service
rabbitmq-service remove  - Remove the RabbitMQ service

The following actions can also be accomplished by using
Windows Services Management Console (services.msc):

rabbitmq-service start   - Start the RabbitMQ service
rabbitmq-service stop    - Stop the RabbitMQ service
rabbitmq-service disable - Disable the RabbitMQ service
rabbitmq-service enable  - Enable the RabbitMQ service


c:\Temp\rabbitmq_server-0.0.0\sbin>rabbitmq-service.bat remove
C:\Program Files (x86)\erl5.7.5\erts-5.7.5\bin\erlsrv: Service RabbitMQ 
removed
from system.

c:\Temp\rabbitmq_server-0.0.0\sbin>rabbitmq-server

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v0.0.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., 
and R
abbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at Laptop_2_64Bit
app descriptor: c:/Temp/rabbitmq_server-0.0.0/sbin/../ebin/rabbit.app
home dir      : C:\Users\Compufreak
cookie hash   : +H0L6sW4I41zYcsFymNsfg==
log           : C:/Users/Compufreak/AppData/Roaming/RabbitMQ/log/rabbit.log
sasl log      : 
C:/Users/Compufreak/AppData/Roaming/RabbitMQ/log/rabbit-sasl.log

database dir  : 
c:/Users/Compufreak/AppData/Roaming/RabbitMQ/db/rabbit-mnesia

starting worker pool 
...done
starting database 
...done
-- external infrastructure ready
starting exchange type registry 
...done
starting exchange type topic 
...done
starting exchange type headers 
...done
starting exchange type fanout 
...done
starting exchange type direct 
...done
starting internal event notification system 
...done
starting logging server 
...done
-- kernel ready
starting alarm handler 
...done
starting queue supervisor 
...done
starting node monitor 
...done
starting cluster router 
...done
-- core initialized
starting empty DB check 
...done
starting codec correctness check 
...done
starting exchange recovery 
...BOOT ER
ROR: FAILED
Reason: {function_clause,
            [{rabbit_exchange,recover_with_bindings,
                 [[],
                  [{exchange,
                       {resource,<<"/">>,exchange,<<>>},
                       direct,true,false,[]},
                   {exchange,
                       {resource,<<"/">>,exchange,<<"amq.direct">>},
                       direct,true,false,[]},
                   {exchange,
                       {resource,<<"/">>,exchange,<<"amq.fanout">>},
                       fanout,true,false,[]},
                   {exchange,
                       {resource,<<"/">>,exchange,<<"amq.headers">>},
                       headers,true,false,[]},
                   {exchange,
                       {resource,<<"/">>,exchange,<<"amq.match">>},
                       headers,true,false,[]},
                   {exchange,
                       {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>},
                       topic,true,false,[]},
                   {exchange,
                       {resource,<<"/">>,exchange,<<"amq.topic">>},
                       topic,true,false,[]}],
                  []]},
             {rabbit_exchange,recover,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]}
{"init terminating in 
do_boot",{{nocatch,{error,{cannot_start_application,rabbit
,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}
}}},[{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

c:\Temp\rabbitmq_server-0.0.0\sbin>

So there is an error when starting the exchange recovery module. Maybe a 
little bug?


>> We also have in mind two other possible approaches:
>>
>> - Build a web service between the Silverlight client and RabbitMQ. But we 
>> want to avoid polling as this would decrease the responsiveness. This is 
>> why we want to connect straight to RabbitMQ from the Silverlight client.
>
> You might also look at the Rabbit JSON RPC adapter, though this may suffer 
> from the same "textiness" that the STOMP adapter does.
>
Will JSON work well with binary data? The STOMP connection works well, so 
that's not the problem. It's just the use of binary data where it fails...


>> - Get the RabbitMQ client Project to compile against the Silverlight 
>> runtime. This is not undoable, but requires some work. Would someone be 
>> interested in a Silverlight version of the RabbitMQ client?
>
> A Silverlight client would be great to see!  How much work do you think 
> this involves, and what are the main obstacles -- are there classes that 
> substitute for those that are missing?
>
The only thing I did right now, was opening the .NET solution, update it 
(Visual Studio 2010) and add a Silverlight application. Then I edited the 
Silverlight .cproj file that was generated, to insert all the .cs files of 
the .NET client. When I try to compile the whole thing, I get about 40 
errors. I don't know yet how much work it's going to take, I'm analyzing the 
errors right now. The main obstacles are:
- Use of SLL in Silverlight (in our application we don't need this, but 
maybe it's possible to change some things?)
- Use of framing (needs to be resolved, but don't know how yet)
- Use of XmlDocument (may can changed by the use of XmlReader etc.)
- ArrayList's (can be changed in generic lists)

There are some classes that substitute for the classes that are missing, but 
I'm not sure in wich degree.

Jens Aernouts - Student Bachelor of Applied Engineering @ Artesis University 
College of Antwerp 



From simon at rabbitmq.com  Tue Apr 27 11:06:37 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 Apr 2010 11:06:37 +0100
Subject: [rabbitmq-discuss] Similar behaviour to MSMQ internal outgoing
 queues?
In-Reply-To: <B636D27EC8708044BACDF68D95DD416803C164A5@exc4.thetrainline.com>
References: <B636D27EC8708044BACDF68D95DD416803C164A5@exc4.thetrainline.com>
Message-ID: <4BD6B72D.9000604@rabbitmq.com>

Owain Perry wrote:
> If I have a Rabbit Client who needs sends a message to the broker,
> however the network is down between the client and the broker, Can
> rabbit be configured in such away that it can accept the message locally
> and deal with resubmission when the network returns?

Sort of.

This feature is not supported by the .NET client itself; however we do 
have a higher level library which sits on top of the .NET client and 
adds a couple of features including automatic resubmission in the event 
of network failure. I think it's only available from Mercurial though; 
you can clone it from:

http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/

Cheers, Simon


From aquino.gustavo at gmail.com  Tue Apr 27 14:34:15 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 27 Apr 2010 10:34:15 -0300
Subject: [rabbitmq-discuss] Client failover
Message-ID: <m2s5ef296b31004270634j8462e705k5f4edfc9939e7437@mail.gmail.com>

Hi Guys,

First good work in HA doc. Other AMQP solutions use solutions based on
OpenAis and in my thoughts it's a good way.

Now I have one doubt have a way in RabbitMQ java or .net client to
restablish one connection when it's down or redirect connection to passive
server ? in other words can I configure my client with my active and passive
server and this guy have the knowledge to use master or slave ?

Best Regards.

Gustavo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100427/cab7cf83/attachment.htm 

From jason.dusek at gmail.com  Tue Apr 27 18:42:42 2010
From: jason.dusek at gmail.com (Jason Dusek)
Date: Tue, 27 Apr 2010 10:42:42 -0700
Subject: [rabbitmq-discuss] Interesting error in RabbitMQ logs -- path issue?
Message-ID: <v2l42784f261004271042w114b6c79keb4345445e564b87@mail.gmail.com>

  I am having some trouble with RabbitMQ -- the message in the
  logs is:

    =ERROR REPORT==== 27-Apr-2010::10:37:23 ===
    ** Generic server <0.205.0> terminating
    ** Last message in was {'$gen_cast',init}
    ** When Server state == {...
                             ...many lines...
                             ...}

    ** Reason for termination ==
    ** {'function not exported',[{random,seed,[{1272,389638,154772}]},
                                 {rabbit_shovel_worker,handle_cast,2},
                                 {gen_server2,handle_msg,7},
                                 {proc_lib,init_p_do_apply,3}]}

  I'm using Shovel with SSL. This looks like a path or library
  issue; but I am not as familiar with Erlang as I would like
  and it's hard to say. I have several machines on which
  RabbitMQ is working, using the same configuration and build
  process. However, this is one of those environments where each
  machine is a subtly different snowflake; any help in tracking
  this down would be appreciated.

--
Jason Dusek


From matthias at rabbitmq.com  Tue Apr 27 19:04:29 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 27 Apr 2010 19:04:29 +0100
Subject: [rabbitmq-discuss] Interesting error in RabbitMQ logs -- path
 issue?
In-Reply-To: <v2l42784f261004271042w114b6c79keb4345445e564b87@mail.gmail.com>
References: <v2l42784f261004271042w114b6c79keb4345445e564b87@mail.gmail.com>
Message-ID: <4BD7272D.3020907@rabbitmq.com>

Jason,

Jason Dusek wrote:
>   I am having some trouble with RabbitMQ -- the message in the
>   logs is:
> 
>     =ERROR REPORT==== 27-Apr-2010::10:37:23 ===
>     ** Generic server <0.205.0> terminating
>     ** Last message in was {'$gen_cast',init}
>     ** When Server state == {...
>                              ...many lines...
>                              ...}
> 
>     ** Reason for termination ==
>     ** {'function not exported',[{random,seed,[{1272,389638,154772}]},
>                                  {rabbit_shovel_worker,handle_cast,2},
>                                  {gen_server2,handle_msg,7},
>                                  {proc_lib,init_p_do_apply,3}]}

The above complains about an unexported function random:seed/1, used by 
the shovel plug-in. That function only became part of the public API in 
Erlang/OTP R13B01. I suspect you are running an older version.

I have filed a bug to get the shovel code changed so it works with older 
versions of Erlang too. Meanwhile, perhaps you could upgrade to R13B01 
or higher on that machine? Certainly if, as you say, you are planning to 
use SSL we'd recommend running R13B02 or R13B03.


Regards,

Matthias.


From irrer at umich.edu  Tue Apr 27 21:24:58 2010
From: irrer at umich.edu (Jim Irrer)
Date: Tue, 27 Apr 2010 16:24:58 -0400
Subject: [rabbitmq-discuss] ./configure can not find
	/codegen/amqp-0.9.1.json file
Message-ID: <z2k3b6ef0791004271324wb70e651dkf0dbfe231c7b01d1@mail.gmail.com>

Tony -

I'm trying to build rabbitmq-c on a RedHat Linux system, and
the ./configure script errors out with the following statements:

checking if g77 supports -c -o file.o... yes
checking whether the g77 linker (/usr/bin/ld -m elf_x86_64) supports shared
libraries... yes
checking dynamic linker characteristics... GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking for ANSI C header files... (cached) yes
checking location of AMQP codegen directory... configure: error: could not
find AMQP spec file at "'/codegen/amqp-0.9.1.json'"

Is the the missing file supposed to be generated?

Also, it looks like it is supposed to be just off the root directory, which
seems wrong to me.

Is there a way to get this file?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100427/b5249c17/attachment.htm 

From tonyg at lshift.net  Tue Apr 27 23:49:28 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 28 Apr 2010 10:49:28 +1200
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
In-Reply-To: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
References: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
Message-ID: <4BD769F8.30607@lshift.net>

Hi Jens,

Aernouts Jens wrote:
> missing classes in Silverlight like TcpClient, XmlDocument, ArrayList, ?

Wow, what a crippled environment. (Although actually I wonder why we depend on
XmlDocument. Hmm. The other dependencies seem reasonable though!)

> - Tried the STOMP plug-in, because there is a (working) Silverlight
> client for STOMP. Sending of text works, but we have to send binary data
> (Protobuf serialized). This does not work, the received data is wrong
> (both the content as the length). We?re not sure if it?s the RabbitMQ
> STOMP plugin or the STOMP client that?s doing something wrong with
> binary data. Is there someone who already managed to send binary data
> over STOMP?

Yep. STOMP is capable of carrying binary data without encoding. The client
simply needs to use a content-length header to let the server know reliably
when the message body ends. The RabbitMQ STOMP adapter processes these
according to the spec, and I've personally seen binary data carried across the
wire OK.

> - Get the RabbitMQ client Project to compile against the Silverlight
> runtime. This is not undoable, but requires some work. Would someone be
> interested in a Silverlight version of the RabbitMQ client?

I think this sounds very interesting! If we could split the .NET client into a
core that could compile against Silverlight and other reduced runtimes, and an
outer layer that includes some of the convenience code that only runs on a full
.NET environment, then that would be very cool.

Regards,
  Tony



From jason.dusek at gmail.com  Tue Apr 27 23:55:26 2010
From: jason.dusek at gmail.com (Jason Dusek)
Date: Tue, 27 Apr 2010 15:55:26 -0700
Subject: [rabbitmq-discuss] Interesting error in RabbitMQ logs -- path
	issue?
In-Reply-To: <4BD7272D.3020907@rabbitmq.com>
References: <v2l42784f261004271042w114b6c79keb4345445e564b87@mail.gmail.com>
	<4BD7272D.3020907@rabbitmq.com>
Message-ID: <n2m42784f261004271555o400ffb09nda27a21a96ef3857@mail.gmail.com>

  I did install R13B04; but in to `/usr/local/'. The pre-existing
  Erlang, R12-x in `/usr', is what ended up build RabbitMQ; this
  led to a weird hybrid code path, with `kernel' and some other
  modules come `/usr/lib64' and the rest coming from the
  installation in `/usr/local'.

  Thanks for your help; it allowed me to see this was a library
  look up issue and that was enough to get me going in the right
  direction.

--
Jason Dusek


From tonyg at lshift.net  Tue Apr 27 23:59:48 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 28 Apr 2010 10:59:48 +1200
Subject: [rabbitmq-discuss] ./configure can not find
	/codegen/amqp-0.9.1.json file
In-Reply-To: <z2k3b6ef0791004271324wb70e651dkf0dbfe231c7b01d1@mail.gmail.com>
References: <z2k3b6ef0791004271324wb70e651dkf0dbfe231c7b01d1@mail.gmail.com>
Message-ID: <4BD76C64.7020800@lshift.net>

Hi Jim,

Jim Irrer wrote:
> checking location of AMQP codegen directory... configure: error: could
> not find AMQP spec file at "'/codegen/amqp-0.9.1.json'"
> 
> Is the the missing file supposed to be generated?

It's supposed to come from the rabbitmq-codegen project, which the code is
expecting in a directory next to the rabbitmq-c directory. A while ago I
updated the instructions in the README,
http://hg.rabbitmq.com/rabbitmq-c/file/aafba2c665b5/README#l23, to include all
the checkout and build steps. To summarise, for the AMQP 0-8 branch, the steps are:

    hg clone http://hg.rabbitmq.com/rabbitmq-codegen/
    hg clone http://hg.rabbitmq.com/rabbitmq-c/
    cd rabbitmq-c
    autoreconf -i
    ./configure
    make

For the AMQP 0-9-1 branch, it's exactly the same, but with these two commands
after the second hg clone:

    (cd rabbitmq-codegen; hg up amqp_0_9_1)
    (cd rabbitmq-c; hg up amqp_0_9_1)

You can also replace the hg clone/hg up statements with retrieval of
appropriate tarballs. For 0-8:

    http://hg.rabbitmq.com/rabbitmq-codegen/archive/default.tar.bz2
    http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.bz2

or for 0-9-1:

    http://hg.rabbitmq.com/rabbitmq-codegen/archive/amqp_0_9_1.tar.bz2
    http://hg.rabbitmq.com/rabbitmq-c/archive/amqp_0_9_1.tar.bz2

Regards,
  Tony


From jason.dusek at gmail.com  Wed Apr 28 00:28:05 2010
From: jason.dusek at gmail.com (Jason Dusek)
Date: Tue, 27 Apr 2010 16:28:05 -0700
Subject: [rabbitmq-discuss] BQL failing to start -- a code path issue?
Message-ID: <n2j42784f261004271628rbd3091e1m470da9471b1376e3@mail.gmail.com>

  I'm sure if I understand the Erlang environment better, I
  could sort this out myself; it appears to be a code path
  issue. When I try to run BQL, I get:

    :;  ./scripts/bql -host 127.0.0.1 -port 5572
    {"init terminating in
do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}

    Crash dump was written to: erl_crash.dump
    init terminating in do_boot ()

  What this seems to say is that it can not find the definition
  of `bql_shell:start/1'; but the module would seem to be loaded
  by the `-pa' directive in the script.

--
Jason Dusek


From aquino.gustavo at gmail.com  Wed Apr 28 07:01:59 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Wed, 28 Apr 2010 03:01:59 -0300
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
In-Reply-To: <4BD769F8.30607@lshift.net>
References: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
	<4BD769F8.30607@lshift.net>
Message-ID: <x2l5ef296b31004272301lfcaa8d07k29a5501cdf263381@mail.gmail.com>

Hi guys,

Do you have some ideia about when RabbitMQ 0.9.1 will be official released ?

Regards.

On Tue, Apr 27, 2010 at 7:49 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Jens,
>
> Aernouts Jens wrote:
> > missing classes in Silverlight like TcpClient, XmlDocument, ArrayList, ?
>
> Wow, what a crippled environment. (Although actually I wonder why we depend
> on
> XmlDocument. Hmm. The other dependencies seem reasonable though!)
>
> > - Tried the STOMP plug-in, because there is a (working) Silverlight
> > client for STOMP. Sending of text works, but we have to send binary data
> > (Protobuf serialized). This does not work, the received data is wrong
> > (both the content as the length). We?re not sure if it?s the RabbitMQ
> > STOMP plugin or the STOMP client that?s doing something wrong with
> > binary data. Is there someone who already managed to send binary data
> > over STOMP?
>
> Yep. STOMP is capable of carrying binary data without encoding. The client
> simply needs to use a content-length header to let the server know reliably
> when the message body ends. The RabbitMQ STOMP adapter processes these
> according to the spec, and I've personally seen binary data carried across
> the
> wire OK.
>
> > - Get the RabbitMQ client Project to compile against the Silverlight
> > runtime. This is not undoable, but requires some work. Would someone be
> > interested in a Silverlight version of the RabbitMQ client?
>
> I think this sounds very interesting! If we could split the .NET client
> into a
> core that could compile against Silverlight and other reduced runtimes, and
> an
> outer layer that includes some of the convenience code that only runs on a
> full
> .NET environment, then that would be very cool.
>
> Regards,
>   Tony
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100428/aac655a3/attachment-0001.htm 

From pauljones23 at gmail.com  Wed Apr 28 08:07:05 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 28 Apr 2010 08:07:05 +0100
Subject: [rabbitmq-discuss] BQL failing to start -- a code path issue?
In-Reply-To: <n2j42784f261004271628rbd3091e1m470da9471b1376e3@mail.gmail.com>
References: <n2j42784f261004271628rbd3091e1m470da9471b1376e3@mail.gmail.com>
Message-ID: <t2m29598b611004280007wa9bd7836uacb9cecb609d099a@mail.gmail.com>

Hi Jason,

How are you trying to run the client? Are you using the version built as the
zip as per the documentation at http://www.rabbitmq.com/rabbitmq-bql.html?

Paul.

On Wed, Apr 28, 2010 at 12:28 AM, Jason Dusek <jason.dusek at gmail.com> wrote:

>  I'm sure if I understand the Erlang environment better, I
>  could sort this out myself; it appears to be a code path
>  issue. When I try to run BQL, I get:
>
>    :;  ./scripts/bql -host 127.0.0.1 -port 5572
>    {"init terminating in
>
> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>
>    Crash dump was written to: erl_crash.dump
>    init terminating in do_boot ()
>
>  What this seems to say is that it can not find the definition
>  of `bql_shell:start/1'; but the module would seem to be loaded
>  by the `-pa' directive in the script.
>
> --
> Jason Dusek
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100428/1a1fefb9/attachment.htm 

From joehealy at gmail.com  Wed Apr 28 08:19:48 2010
From: joehealy at gmail.com (Joe Healy)
Date: Wed, 28 Apr 2010 17:19:48 +1000
Subject: [rabbitmq-discuss] Client failover
In-Reply-To: <m2s5ef296b31004270634j8462e705k5f4edfc9939e7437@mail.gmail.com>
References: <m2s5ef296b31004270634j8462e705k5f4edfc9939e7437@mail.gmail.com>
Message-ID: <y2jb22588821004280019l2b64075yad75115a3f567b80@mail.gmail.com>

On Tue, Apr 27, 2010 at 11:34 PM, Gustavo Aquino
<aquino.gustavo at gmail.com>wrote:

> Hi Guys,
>
> First good work in HA doc. Other AMQP solutions use solutions based on
> OpenAis and in my thoughts it's a good way.
>
> Now I have one doubt have a way in RabbitMQ java or .net client to
> restablish one connection when it's down or redirect connection to passive
> server ? in other words can I configure my client with my active and passive
> server and this guy have the knowledge to use master or slave ?
>

We've configured it so that the passive server takes over the IP address
that rabbitmq is listening to so whether it is running using the active or
passive server clients still use the same IP address.

The document also suggests this.

I'm not sure on the behaviour of the .net or java client regarding
automatically reconnecting. I think this is something you will need to
manage in your application - I could be wrong though.

Hope that helps,

Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100428/3f88a1a4/attachment.htm 

From mikeb at lshift.net  Wed Apr 28 13:37:09 2010
From: mikeb at lshift.net (Michael Bridgen)
Date: Wed, 28 Apr 2010 13:37:09 +0100
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
In-Reply-To: <SNT144-ds17EF6795C3232772F3A03887030@phx.gbl>
References: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
	<4BD6A64B.2090806@lshift.net>
	<SNT144-ds17EF6795C3232772F3A03887030@phx.gbl>
Message-ID: <4BD82BF5.5040209@lshift.net>

Jens,

I have to admit at this point that I'm not an expert -- or even a gifted 
amateur -- at running RabbitMQ on Windows.  I'll try to help out.

>> There is a fairly stable, just not-yet-official branch of RabbitMQ 
>> that supports AMQP 0-9-1.  See https://dev.rabbitmq.com/wiki/Amqp091
>>
> I downloaded this version but I can't get it to work on my PC. When I 
> run "rabbitmq-server.bat" I get the following:
> c:\Temp\rabbitmq_server-0.0.0\sbin>rabbitmq-server
> 
> starting exchange recovery ...BOOT ER
> ROR: FAILED
> Reason: {function_clause,
>            [{rabbit_exchange,recover_with_bindings,
>                 [[],
>                  [{exchange,
>                       {resource,<<"/">>,exchange,<<>>},
>                       direct,true,false,[]},
>                   {exchange,
>                       {resource,<<"/">>,exchange,<<"amq.direct">>},
>                       direct,true,false,[]},
>                   {exchange,
>                       {resource,<<"/">>,exchange,<<"amq.fanout">>},
>                       fanout,true,false,[]},
>                   {exchange,
>                       {resource,<<"/">>,exchange,<<"amq.headers">>},
>                       headers,true,false,[]},
>                   {exchange,
>                       {resource,<<"/">>,exchange,<<"amq.match">>},
>                       headers,true,false,[]},
>                   {exchange,
>                       {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>},
>                       topic,true,false,[]},
>                   {exchange,
>                       {resource,<<"/">>,exchange,<<"amq.topic">>},
>                       topic,true,false,[]}],
>                  []]},
>             {rabbit_exchange,recover,0},
>             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>             {rabbit,run_boot_step,1},
>             {rabbit,'-start/2-lc$^0/1-0-',1},
>             {rabbit,start,2},
>             {application_master,start_it_old,4}]}
> {"init terminating in 
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit
> ,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}} 
> 
> }}},[{init,start_it,1},{init,start_em,1}]}}
> 
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> 
> c:\Temp\rabbitmq_server-0.0.0\sbin>
> 
> So there is an error when starting the exchange recovery module. Maybe a 
> little bug?

Yes, but likely my packaging or some other circumstance rather than 
RabbitMQ.  Exchange recovery really ought not to be a problem.

Did you start from a fresh database?  i.e., was 
c:/Users/Compufreak/AppData/Roaming/RabbitMQ/db/rabbit-mnesia missing or 
empty before you started RabbitMQ?



From irrer at umich.edu  Wed Apr 28 17:00:04 2010
From: irrer at umich.edu (Jim Irrer)
Date: Wed, 28 Apr 2010 12:00:04 -0400
Subject: [rabbitmq-discuss] special values for timeouts
Message-ID: <v2h3b6ef0791004280900lc3a90c33o4389f016e004171a@mail.gmail.com>

Hi -

I am using

http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.7.2/rabbitmq-java-client-javadoc-1.7.2/com/rabbitmq/client/QueueingConsumer.html#nextDelivery(long)

And was wondering, if the timeout value is zero or negative, will the the
method wait forever?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100428/30571e2b/attachment.htm 

From mark.geib at echostar.com  Wed Apr 28 17:28:22 2010
From: mark.geib at echostar.com (Mark Geib)
Date: Wed, 28 Apr 2010 10:28:22 -0600
Subject: [rabbitmq-discuss] type field use
Message-ID: <4BD86226.1010008@echostar.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Is the "type" field available for use by rabbitmq clients. I would
like to use the field to help identify the type of the message payload.

Thanks,
Mark.

- -- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkvYYiYACgkQNMVrR9CRdv01aQCfaU00uv5liw81cLMAtbBqFwC6
PAoAnjVFRGMnY++qDuL8Js1jqvsn0sw9
=C/7U
-----END PGP SIGNATURE-----



From jasonjwwilliams at gmail.com  Wed Apr 28 18:28:47 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 28 Apr 2010 11:28:47 -0600
Subject: [rabbitmq-discuss] Client failover
In-Reply-To: <m2s5ef296b31004270634j8462e705k5f4edfc9939e7437@mail.gmail.com>
References: <m2s5ef296b31004270634j8462e705k5f4edfc9939e7437@mail.gmail.com>
Message-ID: <t2z3b949f091004281028p46aa996t7738446961398e3a@mail.gmail.com>

Hi Gustavo,

You could do something like we did here for py-amqp:
http://github.com/williamsjj/py-resilient_mq

-J

On Tue, Apr 27, 2010 at 7:34 AM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Hi Guys,
> First good work in HA doc. Other AMQP solutions use solutions based on
> OpenAis and in my thoughts it's a good way.
> Now I have one doubt have a way in RabbitMQ java or .net client to
> restablish one connection when it's down or redirect connection to passive
> server ? in other words can I configure my client with my active and passive
> server and this guy have the?knowledge?to use master or slave ?
> Best Regards.
> Gustavo
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From jason.dusek at gmail.com  Wed Apr 28 18:50:49 2010
From: jason.dusek at gmail.com (Jason Dusek)
Date: Wed, 28 Apr 2010 10:50:49 -0700
Subject: [rabbitmq-discuss] BQL failing to start -- a code path issue?
In-Reply-To: <t2m29598b611004280007wa9bd7836uacb9cecb609d099a@mail.gmail.com>
References: <n2j42784f261004271628rbd3091e1m470da9471b1376e3@mail.gmail.com>
	<t2m29598b611004280007wa9bd7836uacb9cecb609d099a@mail.gmail.com>
Message-ID: <t2o42784f261004281050q708d2799mc7bccd4b6294dd66@mail.gmail.com>

2010/04/28 Paul Jones <pauljones23 at gmail.com>:
> How are you trying to run the client? Are you using the
> version built as the zip as per the documentation at
> http://www.rabbitmq.com/rabbitmq-bql.html?

  Thank you for calling attention to that -- I was just running
  `./scripts/bql' in the `rabbitmq-bql' build directory. Now
  that I'm using the one from the `.ez', I get a more
  interesting error message:

     :; ./bql -host 127.0.0.1 -port 5572
    {"init terminating in
do_boot",{{badmatch,{error,{function_clause,[{inet_tcp,getserv,["5572"]},{gen_tcp,connect1,4},{gen_tcp,connect,4},{amqp_network_connection,handshake,1},{amqp_network_connection,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}}},[{amqp_connection,start_network_internal,2},{bql_client,connect,5},{bql_shell,start,0},{init,start_it,1},{init,start_em,1}]}}

    Crash dump was written to: erl_crash.dump
    init terminating in do_boot ()

  The port in question is the unencrypted local port; we appear
  to have a connection failure but I have no idea as to the
  cause. Or is this actually a bad pattern match -- like maybe
  an old or nonexistent function is being called? I have two
  versions of Erlang on this system and have had some trouble
  sandboxing one from the other.

--
Jason Dusek


From pauljones23 at gmail.com  Wed Apr 28 19:42:13 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 28 Apr 2010 19:42:13 +0100
Subject: [rabbitmq-discuss] BQL failing to start -- a code path issue?
In-Reply-To: <t2o42784f261004281050q708d2799mc7bccd4b6294dd66@mail.gmail.com>
References: <n2j42784f261004271628rbd3091e1m470da9471b1376e3@mail.gmail.com>
	<t2m29598b611004280007wa9bd7836uacb9cecb609d099a@mail.gmail.com>
	<t2o42784f261004281050q708d2799mc7bccd4b6294dd66@mail.gmail.com>
Message-ID: <q2j29598b611004281142zb818b2c4waac99b2d5ce5a8e9@mail.gmail.com>

Hi Jason,

This was actually a bug in BQL - it wasn't parsing the port parameter
properly. The fix for this has been sitting in a branch for a while. I've
just QA'd it and merged it into default, so if you update and rebuild
rabbitmq-bql, then it should work properly. My apologies for the troubles.

Thanks,
Paul.

On Wed, Apr 28, 2010 at 6:50 PM, Jason Dusek <jason.dusek at gmail.com> wrote:

> 2010/04/28 Paul Jones <pauljones23 at gmail.com>:
> > How are you trying to run the client? Are you using the
> > version built as the zip as per the documentation at
> > http://www.rabbitmq.com/rabbitmq-bql.html?
>
>   Thank you for calling attention to that -- I was just running
>  `./scripts/bql' in the `rabbitmq-bql' build directory. Now
>  that I'm using the one from the `.ez', I get a more
>  interesting error message:
>
>     :; ./bql -host 127.0.0.1 -port 5572
>    {"init terminating in
>
> do_boot",{{badmatch,{error,{function_clause,[{inet_tcp,getserv,["5572"]},{gen_tcp,connect1,4},{gen_tcp,connect,4},{amqp_network_connection,handshake,1},{amqp_network_connection,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}}},[{amqp_connection,start_network_internal,2},{bql_client,connect,5},{bql_shell,start,0},{init,start_it,1},{init,start_em,1}]}}
>
>    Crash dump was written to: erl_crash.dump
>    init terminating in do_boot ()
>
>   The port in question is the unencrypted local port; we appear
>  to have a connection failure but I have no idea as to the
>  cause. Or is this actually a bad pattern match -- like maybe
>  an old or nonexistent function is being called? I have two
>  versions of Erlang on this system and have had some trouble
>  sandboxing one from the other.
>
> --
> Jason Dusek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100428/ca41354c/attachment.htm 

From aernouts_jens at hotmail.com  Thu Apr 29 12:54:55 2010
From: aernouts_jens at hotmail.com (Aernouts Jens)
Date: Thu, 29 Apr 2010 13:54:55 +0200
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
In-Reply-To: <4BD82BF5.5040209@lshift.net>
References: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
	<4BD6A64B.2090806@lshift.net>
	<SNT144-ds17EF6795C3232772F3A03887030@phx.gbl>
	<4BD82BF5.5040209@lshift.net>
Message-ID: <SNT144-ds18EA434BC49079D3BF522887010@phx.gbl>

> Jens,
>
> I have to admit at this point that I'm not an expert -- or even a gifted 
> amateur -- at running RabbitMQ on Windows.  I'll try to help out.
>
>> So there is an error when starting the exchange recovery module. Maybe a 
>> little bug?
>
> Yes, but likely my packaging or some other circumstance rather than 
> RabbitMQ.  Exchange recovery really ought not to be a problem.
>
> Did you start from a fresh database?  i.e., was 
> c:/Users/Compufreak/AppData/Roaming/RabbitMQ/db/rabbit-mnesia missing or 
> empty before you started RabbitMQ?
>

@ Michael: No, I didn't delete that map (Didn't know I had to!). I just 
retried it and after deleting that map it works! Thank you for that..
@ Gustavo: I'm just someone who uses RabbitMQ, I don't know when the new 
version will be released.
@ Tony: About STOMP: how can our client send a content-length header to the 
server? We can use the content-length header at our client, but not at the 
server I think... Can you give some more info about this please?

I'm currently compiling the client project against the Silverlight runtime, 
and it seems to work. At this moment, I just rewrote the things we really 
need (this needs to be fixed as fast as possible), but I'm going to fix the 
other problems too.
I just managed to compile the whole project and I'm testing the dll right 
now, but there's another problem. Some of the projects I use are precompiled 
(I use DLL files for them), and they use a RabbitMQ.client DLL with these 
specifications:

// Assembly RabbitMQ.Client, Version 1.7.2.0
Location: 
E:\Jens\School\BAP\Tracker\LocONCommunication\LocONCommunication.Web\App_Data\DLL\RabbitMQ.Client.dll
Name: RabbitMQ.Client, Version=1.7.2.0, Culture=neutral, 
PublicKeyToken=89e7d7c5feba84ce
Type: Library

When I compiled my version of that client, I find these specifications:

// Assembly RabbitMQ.Client, Version 0.0.0.0
Location: E:\Jens\School\BAP\Tracker\Silverlight dlls\Not 
Silverlight\RabbitMQ.Client.dll
Name: RabbitMQ.Client, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
Type: Library

So when my program links to the RabbitMQ.Client.dll file, I get an error 
that it can't find the right one...
What should I do to compile it with the right PublicKeyToken and the right 
version Number?

Kind Regards

Jens Aernouts ? Student Bachelor of Applied Engineering @ Artesis University 
College of Antwerp 



From lists at zopyx.com  Thu Apr 29 13:57:34 2010
From: lists at zopyx.com (Andreas Jung)
Date: Thu, 29 Apr 2010 14:57:34 +0200
Subject: [rabbitmq-discuss] init terminating in do_boot
Message-ID: <4BD9823E.9040903@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

What does the following error during the startup mean?

RabbitMQ 1.7.2 on Snow Leopard, 64 bit

Andreas
- ----------

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.2  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at suxmac2.fritz.box
app descriptor: /Users/ajung/sandboxes/occ/parts/rabbitmq/ebin/rabbit.app
home dir      : /Users/ajung
cookie hash   : YdPtx/uDiT0CjSe1lC1Gig==
log           : /Users/ajung/sandboxes/occ/var/log/rabbitmq/rabbit.log
sasl log      : /Users/ajung/sandboxes/occ/var/log/rabbitmq/rabbit-sasl.log
database dir  : /Users/ajung/sandboxes/occ/var/rabbit

starting internal event notification system
...done
starting logging server
...done
starting database
...{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{case_clause,{error,{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]}}},[{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},{rabbit,run_boot_step,1},{rabbit,'-start/2-lc$^0/1-0-',1},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkvZgj4ACgkQCJIWIbr9KYx3rACfVKVFzb07eGYF3QWkh3wzXYDM
RgUAoJ9Jd/HuRVnst7siCwMFxqG1FkcF
=zN2l
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100429/879ec3a4/attachment.vcf 

From rtrlists at googlemail.com  Thu Apr 29 14:18:28 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 29 Apr 2010 14:18:28 +0100
Subject: [rabbitmq-discuss] init terminating in do_boot
In-Reply-To: <4BD9823E.9040903@zopyx.com>
References: <4BD9823E.9040903@zopyx.com>
Message-ID: <i2i6a3ae47e1004290618q33e9263fz3451ab516de86d9a@mail.gmail.com>

On Thu, Apr 29, 2010 at 1:57 PM, Andreas Jung <lists at zopyx.com> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> What does the following error during the startup mean?
>
> RabbitMQ 1.7.2 on Snow Leopard, 64 bit
>
> Andreas
> - ----------
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.2  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
> LLC., and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node          : rabbit at suxmac2.fritz.box
> app descriptor: /Users/ajung/sandboxes/occ/parts/rabbitmq/ebin/rabbit.app
> home dir      : /Users/ajung
> cookie hash   : YdPtx/uDiT0CjSe1lC1Gig==
> log           : /Users/ajung/sandboxes/occ/var/log/rabbitmq/rabbit.log
> sasl log      : /Users/ajung/sandboxes/occ/var/log/rabbitmq/rabbit-sasl.log
> database dir  : /Users/ajung/sandboxes/occ/var/rabbit
>
> starting internal event notification system
> ...done
> starting logging server
> ...done
> starting database
> ...{"init terminating in
>
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{case_clause,{error,{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]}}},[{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},{rabbit,run_boot_step,1},{rabbit,'-start/2-lc$^0/1-0-',1},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
>
>
The 'timeout_waiting_for_tables' error usually means that you previously had
an mnesia DB set up under a particular named node and hostname, but now the
system is starting up with a different nodename or hostname and cannot
attach itself to your old DB.

If you're wanting to start from scratch, then just nuke the database files
and the next start will rebuild the schema.

If you need to retain the DB, then either try and re-establish your previous
name, or with more work using Erlang, rename your schema (see
http://www.erlang.org/doc/apps/mnesia/Mnesia_chap7.html#id2277864 for an
example of code to rename the node in the schema).

Hope this helps,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100429/9e90e3c0/attachment.htm 

From lists at zopyx.com  Thu Apr 29 14:21:21 2010
From: lists at zopyx.com (Andreas Jung)
Date: Thu, 29 Apr 2010 15:21:21 +0200
Subject: [rabbitmq-discuss] init terminating in do_boot
In-Reply-To: <i2i6a3ae47e1004290618q33e9263fz3451ab516de86d9a@mail.gmail.com>
References: <4BD9823E.9040903@zopyx.com>
	<i2i6a3ae47e1004290618q33e9263fz3451ab516de86d9a@mail.gmail.com>
Message-ID: <4BD987D1.8040000@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Robert Raschke wrote:
> 
> On Thu, Apr 29, 2010 at 1:57 PM, Andreas Jung <lists at zopyx.com
> <mailto:lists at zopyx.com>> wrote:
> 
>     -----BEGIN PGP SIGNED MESSAGE-----
>     Hash: SHA1
> 
>     What does the following error during the startup mean?
> 
>     RabbitMQ 1.7.2 on Snow Leopard, 64 bit
> 
>     Andreas
>     - ----------
> 
>     +---+   +---+
>     |   |   |   |
>     |   |   |   |
>     |   |   |   |
>     |   +---+   +-------+
>     |                   |
>     | RabbitMQ  +---+   |
>     |           |   |   |
>     |   v1.7.2  +---+   |
>     |                   |
>     +-------------------+
>     AMQP 8-0
>     Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
>     LLC., and Rabbit Technologies Ltd.
>     Licensed under the MPL.  See http://www.rabbitmq.com/
> 
>     node          : rabbit at suxmac2.fritz.box
>     app descriptor:
>     /Users/ajung/sandboxes/occ/parts/rabbitmq/ebin/rabbit.app
>     home dir      : /Users/ajung
>     cookie hash   : YdPtx/uDiT0CjSe1lC1Gig==
>     log           : /Users/ajung/sandboxes/occ/var/log/rabbitmq/rabbit.log
>     sasl log      :
>     /Users/ajung/sandboxes/occ/var/log/rabbitmq/rabbit-sasl.log
>     database dir  : /Users/ajung/sandboxes/occ/var/rabbit
> 
>     starting internal event notification system
>     ...done
>     starting logging server
>     ...done
>     starting database
>     ...{"init terminating in
>     do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{case_clause,{error,{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]}}},[{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},{rabbit,run_boot_step,1},{rabbit,'-start/2-lc$^0/1-0-',1},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
> 
> 
> The 'timeout_waiting_for_tables' error usually means that you previously
> had an mnesia DB set up under a particular named node and hostname, but
> now the system is starting up with a different nodename or hostname and
> cannot attach itself to your old DB.
> 
This is really not the case...this is issue is likely related to some
unclean shutdown while testing rabbitmq on the same machine inside the
same network.

Andreas
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkvZh9EACgkQCJIWIbr9KYxixACglOK0xwQrqHYPK9yv7h057Oxv
z1cAoIXgWIE459wGgPsd6gSB2K55T7HA
=V6Dz
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 330 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100429/2f124dd1/attachment.vcf 

From rtrlists at googlemail.com  Thu Apr 29 14:27:46 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 29 Apr 2010 14:27:46 +0100
Subject: [rabbitmq-discuss] init terminating in do_boot
In-Reply-To: <4BD987D1.8040000@zopyx.com>
References: <4BD9823E.9040903@zopyx.com>
	<i2i6a3ae47e1004290618q33e9263fz3451ab516de86d9a@mail.gmail.com>
	<4BD987D1.8040000@zopyx.com>
Message-ID: <k2w6a3ae47e1004290627k395a6e83ieddbb572eaf79dfc@mail.gmail.com>

On Thu, Apr 29, 2010 at 2:21 PM, Andreas Jung <lists at zopyx.com> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Robert Raschke wrote:
> >
> > On Thu, Apr 29, 2010 at 1:57 PM, Andreas Jung <lists at zopyx.com
> > <mailto:lists at zopyx.com>> wrote:
> >
> >     -----BEGIN PGP SIGNED MESSAGE-----
> >     Hash: SHA1
> >
> >     What does the following error during the startup mean?
> >
> >     RabbitMQ 1.7.2 on Snow Leopard, 64 bit
> >
> >     Andreas
>

I note that you are running on a Mac. Have a look at the mail archives. I
think this particular error has come up a few times in the past and has to
do with OSX sometimes giving inconsistent hostnames back to RabbitMQ.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100429/757bf6bc/attachment.htm 

From dawalama at gmail.com  Thu Apr 29 19:21:42 2010
From: dawalama at gmail.com (Dawa Lama)
Date: Thu, 29 Apr 2010 14:21:42 -0400
Subject: [rabbitmq-discuss] Failing to start rabbitmq with shovel
Message-ID: <m2p540330411004291121rb4bad599ib92450f4058c0e01@mail.gmail.com>

snippet of log
.......
AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : Rabbitat33servdls at 33servdls
app descriptor: /usr/lib/rabbitmq/lib/rabbitmq_server-9.0.0/sbin/../
ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : fO6bIZ0qpeYPIThXQTqV+Q==
log           : /var/log/rabbitmq/Rabbitat33servdls.log
sasl log      : /var/log/rabbitmq/Rabbitat33servdls-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/Rabbitat33servdls

starting worker
pool                                                  ...done
starting
database                                                     ...done
starting codec correctness
check                                      ...done
.......................
-- network listeners available

broker running
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit_shovel,
{bad_return,{{rabbit_shovel,start,[normal,[]]},{'EXIT',{undef,
[{inets_regexp,first_match,
[[97,109,113,112,58,47,47,103,117,101,115,116,58,103,117,101,115,116,64,101,99,50,45,49,55,52,45,49,50,57,45,55,54,45,50,50,55,46,99,111,109,112,117,116,101,45,49,46,97,109,97,122,111,110,97,119,115,46,99,111,109,47],
[58]]},{uri_parser,split_uri,5},{uri_parser,parse,2},
{rabbit_shovel_sup,parse_uri,1},{lists,foldl,3},
{rabbit_shovel_sup,parse_endpoint,1},{rabbit_shovel_sup,'-
parse_shovel_config_dict/1-fun-7-',4},{lists,foldl,3}]}}}}}"}



My config is :  http://pastebin.org/192512

Any help would be appreciated.


-- 
Dawa L. Sherpa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100429/3c1e1de8/attachment-0001.htm 

From matthias at rabbitmq.com  Thu Apr 29 19:33:15 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 29 Apr 2010 19:33:15 +0100
Subject: [rabbitmq-discuss] Failing to start rabbitmq with shovel
In-Reply-To: <m2p540330411004291121rb4bad599ib92450f4058c0e01@mail.gmail.com>
References: <m2p540330411004291121rb4bad599ib92450f4058c0e01@mail.gmail.com>
Message-ID: <4BD9D0EB.2000007@rabbitmq.com>

Dawa,

Dawa Lama wrote:
> snippet of log [...]
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit_shovel,
> {bad_return,{{rabbit_shovel,start,[normal,[]]},{'EXIT',{undef,
> [{inets_regexp,first_match,

That is due to the shovel code relying on Erlang/OTP R13B features, and 
I suspect you are running an earlier version. A similar problem was 
reported earlier this week.

We fixed this a few hours ago. So please try the latest version.


Regards,

Matthias.


From tonyg at lshift.net  Fri Apr 30 01:25:37 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 30 Apr 2010 12:25:37 +1200
Subject: [rabbitmq-discuss] type field use
In-Reply-To: <4BD86226.1010008@echostar.com>
References: <4BD86226.1010008@echostar.com>
Message-ID: <4BDA2381.6060801@lshift.net>

Hi Mark,

Mark Geib wrote:
> Is the "type" field available for use by rabbitmq clients. I would
> like to use the field to help identify the type of the message payload.

Yes, the "type" field in a Basic content-properties structure is available for
arbitrary application use. The specification places no constraints on its use,
saying "For application use, no formal behaviour".

There's also "content-type", which is supposed to be a MIME-type for the
content body.

Regards,
  Tony


From tonyg at lshift.net  Fri Apr 30 01:26:31 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 30 Apr 2010 12:26:31 +1200
Subject: [rabbitmq-discuss] special values for timeouts
In-Reply-To: <v2h3b6ef0791004280900lc3a90c33o4389f016e004171a@mail.gmail.com>
References: <v2h3b6ef0791004280900lc3a90c33o4389f016e004171a@mail.gmail.com>
Message-ID: <4BDA23B7.4060204@lshift.net>

Jim Irrer wrote:
> And was wondering, if the timeout value is zero or negative, will the
> the method wait forever?

Um. Good question! The timeout is passed on to BlockQueue's poll() method, and
the Javadocs for that are unclear. Experimentation will be required to find the
answer, I'm afraid.

Regards,
  Tony



From tonyg at lshift.net  Fri Apr 30 01:33:08 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 30 Apr 2010 12:33:08 +1200
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
In-Reply-To: <SNT144-ds18EA434BC49079D3BF522887010@phx.gbl>
References: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
	<4BD6A64B.2090806@lshift.net>
	<SNT144-ds17EF6795C3232772F3A03887030@phx.gbl>
	<4BD82BF5.5040209@lshift.net>
	<SNT144-ds18EA434BC49079D3BF522887010@phx.gbl>
Message-ID: <4BDA2544.9060107@lshift.net>

Hi Jens,

Aernouts Jens wrote:
> @ Tony: About STOMP: how can our client send a content-length header to
> the server? We can use the content-length header at our client, but not
> at the server I think... Can you give some more info about this please?

So the STOMP protocol, http://stomp.codehaus.org/Protocol, says this on the
subject:

  "It is recommended that SEND frames include a content-length header which
   is a byte count for the length of the message body. If a content-length
   header is included, this number of bytes should be read, regardless of
   whether or not there are null characters in the body. The frame still needs
   to be terminated with a null byte and if a content-length is not specified,
   the first null byte encountered signals the end of the frame."

(MESSAGE frames have a very similar paragraph in their description.)

The RabbitMQ STOMP server plugin pays attention to this content-length header.
It also *always* supplies a content-length header on MESSAGE whenever the
message body is non-empty.

> I'm currently compiling the client project against the Silverlight
> runtime, and it seems to work. At this moment, I just rewrote the things
> we really need (this needs to be fixed as fast as possible), but I'm
> going to fix the other problems too.

Hey this is excellent news! Will you be able to send us a patch?

> What should I do to compile it with the right PublicKeyToken and the
> right version Number?

I think you might need our key for that. (Which clearly isn't an option :-) ) I
suspect you will have to recompile the DLLs you have that depend on the
RabbitMQ client to have less strict dependencies. I'm afraid I'm not an expert
on the vagaries of .NET linking, though :-/

Regards,
  Tony


From tonyg at lshift.net  Fri Apr 30 01:38:27 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 30 Apr 2010 12:38:27 +1200
Subject: [rabbitmq-discuss] STOMP support - production ready?
In-Reply-To: <877hnta33v.fsf@rimspace.net>
References: <877hnta33v.fsf@rimspace.net>
Message-ID: <4BDA2683.9060509@lshift.net>

Hi Daniel,

Daniel Pittman wrote:
> I know RabbitMQ offers a STOMP plugin, and back in '08 y'all considered it
> experimental, but I can't find any more recent evidence of status.
> 
> So, is the STOMP support reasonably production ready?
> 
> More specifically, is it going to be stable enough that we can use it for
> non-core activities, without risking problems for real AMQP clients doing more
> serious work?

The plugin hasn't changed much in recent months, people have been using it in
production for a long time now, and I don't personally plan on making any large
changes to it, so it feels relatively stable to me -- but please don't take
that as an official announcement, it's just my own feelings on the matter!

With regard to risk for AMQP clients connected to the same broker: Erlang
enforces reasonable levels of isolation between clients. If an individual STOMP
connection, or even the whole STOMP plugin, crashes, the rest of the broker
will in most situations continue to run unaffected.

Regards,
  Tony



From daniel at rimspace.net  Fri Apr 30 05:11:53 2010
From: daniel at rimspace.net (Daniel Pittman)
Date: Fri, 30 Apr 2010 14:11:53 +1000
Subject: [rabbitmq-discuss] STOMP support - production ready?
References: <877hnta33v.fsf@rimspace.net> <4BDA2683.9060509@lshift.net>
Message-ID: <87zl0lmvee.fsf@rimspace.net>

Tony Garnock-Jones <tonyg at lshift.net> writes:
> Daniel Pittman wrote:
>
>> I know RabbitMQ offers a STOMP plugin, and back in '08 y'all considered it
>> experimental, but I can't find any more recent evidence of status.
>>
>> So, is the STOMP support reasonably production ready?
>>
>> More specifically, is it going to be stable enough that we can use it for
>> non-core activities, without risking problems for real AMQP clients doing more
>> serious work?
>
> The plugin hasn't changed much in recent months, people have been using it in
> production for a long time now, and I don't personally plan on making any large
> changes to it, so it feels relatively stable to me -- but please don't take
> that as an official announcement, it's just my own feelings on the matter!

*nod*  Between that, and a couple of private replies indicating that it is
reliable enough for people to deploy, I am pretty comfortable.  Especially
because the architecture of RabbitMQ means that, as you say, a failure doesn't
hurt anything but the STOMP support.


I see that there is a bit of Debian packaging ephemera in the stomp Mercurial
repository, and that the rabbitmq-public-umbrella module also includes some
support for it.

I couldn't see, though, any advice on the site or the list archives about how
best to go ahead and build a Debian package for the extension.

Is that documented somewhere, or am I going to have to troll through the build
system and work that out myself?


All I really care about is building the STOMP adapter against release 1.7.2,
and perhaps about trialing the JSON-RPC module at some point in the future.

        Daniel

-- 
? Daniel Pittman            ? daniel at rimspace.net            ? +61 401 155 707
               ? made with 100 percent post-consumer electrons



From jstabile at vmware.com  Fri Apr 30 20:54:36 2010
From: jstabile at vmware.com (Jim Stabile)
Date: Fri, 30 Apr 2010 12:54:36 -0700
Subject: [rabbitmq-discuss] ordering semantics
Message-ID: <392922E81643B245A905B42E3E34C2401496EE3025@EXCH-MBX-1.vmware.com>

Hi,



I'm trying to get a handle on ordering semantics on the topic exchange.



Assume there are two publishers, each on their own channel.  Publishers produce a stream of messages.  So:

Publisher A produces A1, A2, A3 (in that order) Publisher B produces B1, B2, B3 (in that order)



There is a single subscriber on a queue that all the messages produced by both publishers are targeted to.



Questions:

1. Messages A1, A2, A3 are received in that order.  Messages B1, B2, B3 are received in that order.  Correct?



2. Messages from A can be interleaved from B as in: A1, A2, B1, B2, B3, A3.  (Still subject to the constraint from question 1 above) Correct?



3. In the event of a failure of a node in a cluster, messages may be lost, but do they still obey the strict ordering, even though messages may travel a different route in the cluster?



4. I'm assuming that the ordering semantics guaranteed per-channel, correct?



5.Can a subscriber determine a unique ID of the actual sender (i.e., can a subscriber know if a message was sent by A or B)?



Thanks,

Jim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100430/7c56e327/attachment.htm 

From aernouts_jens at hotmail.com  Fri Apr 30 21:05:06 2010
From: aernouts_jens at hotmail.com (Aernouts Jens)
Date: Fri, 30 Apr 2010 22:05:06 +0200
Subject: [rabbitmq-discuss] Silverlight application with RabbitMQ
In-Reply-To: <4BDA2544.9060107@lshift.net>
References: <SNT144-ds1941EBD6FC45422A6567BA87030@phx.gbl>
	<4BD6A64B.2090806@lshift.net>
	<SNT144-ds17EF6795C3232772F3A03887030@phx.gbl>
	<4BD82BF5.5040209@lshift.net>
	<SNT144-ds18EA434BC49079D3BF522887010@phx.gbl>
	<4BDA2544.9060107@lshift.net>
Message-ID: <SNT144-ds22B94EDCC9D913846165487000@phx.gbl>

Hi everyone,

I didn't test the STOMP plugin or the new AMQP version yet, so I can't give 
new information about it. However, thank you guys for all the feedback. I'm 
going to test it after finishing the Silverlight client.
I used all my time working on that and it finally seems to work. I ran the 
tests that where delivered with the client and they're all working (except 
the tests that didn't even work in the original project). After that, I ran 
some example projects, and they're also working. Like I said before, I 
commented out the things we don't need (XML things, SSL, ...), so they 
aren't working yet. These functions will be fixed afterwards.
About the version: It was simple to change the version by adding the version 
number in the AssemblyInfo.cs file.
About the PublicKeyToken: Well, that's what I thought before... However, 
thanks for that.
When I finish the project, I'll send it to you and in the meantime, I'll 
keep you posted.
Next week I'm on collegetrip, so there won't be any updates...

Kind Regards

Jens Aernouts - Student Bachelor of Applied Engineering @ Artesis University 
College of Antwerp

> Hi Jens,
>
> Aernouts Jens wrote:
>> @ Tony: About STOMP: how can our client send a content-length header to
>> the server? We can use the content-length header at our client, but not
>> at the server I think... Can you give some more info about this please?
>
> So the STOMP protocol, http://stomp.codehaus.org/Protocol, says this on 
> the
> subject:
>
>  "It is recommended that SEND frames include a content-length header which
>   is a byte count for the length of the message body. If a content-length
>   header is included, this number of bytes should be read, regardless of
>   whether or not there are null characters in the body. The frame still 
> needs
>   to be terminated with a null byte and if a content-length is not 
> specified,
>   the first null byte encountered signals the end of the frame."
>
> (MESSAGE frames have a very similar paragraph in their description.)
>
> The RabbitMQ STOMP server plugin pays attention to this content-length 
> header.
> It also *always* supplies a content-length header on MESSAGE whenever the
> message body is non-empty.
>
>> I'm currently compiling the client project against the Silverlight
>> runtime, and it seems to work. At this moment, I just rewrote the things
>> we really need (this needs to be fixed as fast as possible), but I'm
>> going to fix the other problems too.
>
> Hey this is excellent news! Will you be able to send us a patch?
>
>> What should I do to compile it with the right PublicKeyToken and the
>> right version Number?
>
> I think you might need our key for that. (Which clearly isn't an option 
> :-) ) I
> suspect you will have to recompile the DLLs you have that depend on the
> RabbitMQ client to have less strict dependencies. I'm afraid I'm not an 
> expert
> on the vagaries of .NET linking, though :-/
>
> Regards,
>  Tony
> 


