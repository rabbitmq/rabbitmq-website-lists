<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ as communication server for mobile	devices
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20as%20communication%20server%20for%20mobile%0A%09devices&In-Reply-To=%3CCAGTWDE26nSxekvRqp971zUcQSQ4QVhWbyiqbkdfW-NtJF0yPgQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023874.html">
   <LINK REL="Next"  HREF="023851.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ as communication server for mobile	devices</H1>
    <B>Michal Levy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20as%20communication%20server%20for%20mobile%0A%09devices&In-Reply-To=%3CCAGTWDE26nSxekvRqp971zUcQSQ4QVhWbyiqbkdfW-NtJF0yPgQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ as communication server for mobile	devices">michal.liwoj at gmail.com
       </A><BR>
    <I>Thu Nov 15 17:20:37 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023874.html">[rabbitmq-discuss] RabbitMQ as communication server for mobile	devices
</A></li>
        <LI>Next message: <A HREF="023851.html">[rabbitmq-discuss] Unable to get Federation connection established
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23907">[ date ]</a>
              <a href="thread.html#23907">[ thread ]</a>
              <a href="subject.html#23907">[ subject ]</a>
              <a href="author.html#23907">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tim

On Thu, Nov 15, 2012 at 9:58 AM, Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hi Michal,
</I>&gt;<i>
</I>&gt;<i> On 11/14/2012 04:49 PM, Michal Lev&#305; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi everyone
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have following scenario:
</I>&gt;&gt;<i> 1) Many Android clients (from 1000 to 10 000 clients) - not connected all
</I>&gt;&gt;<i> the time (messaging seems like good fit for this)
</I>&gt;&gt;<i> 2) Each sending max 100 messages\day
</I>&gt;&gt;<i> 3) Also needs to send some messages back from server but not very
</I>&gt;&gt;<i> frequently (10\day)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I was looking on rabbit tutorials, AMQP spec etc.
</I>&gt;&gt;<i> It looks like collecting data from androids is easy task. All will send
</I>&gt;&gt;<i> data into single exchange\queue.
</I>&gt;&gt;<i> But what about sending messages to Androids from server?
</I>&gt;&gt;<i> 1st i was thinking about having single queue and to subcribe from each
</I>&gt;&gt;<i> device with some kind of &quot;filter&quot; (based on some header field). I know
</I>&gt;&gt;<i> there are message brokers which support this scenario.
</I>&gt;&gt;<i> But it seems Rabbit doesn't support this.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It isn't hard to set this up in Rabbit! You will need to think about
</I>&gt;<i> solving the problem in AMQP terms though, which is admittedly a bit
</I>&gt;<i> different from what you'd do with say JMS or whatever.
</I>

Im trying ;) ...but its still new concept for me...


&gt;<i>
</I>
 Do i really have to create one &quot;sending&quot; queue for each client (using
&gt;&gt;<i> direct exchange with proper &quot;per device&quot; routing key) ?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> As a matter of fact, clients never send messages directly to queues, but
</I>&gt;<i> rather send them to exchanges (as you've already noted), after which
</I>&gt;<i> they're routed to zero or more queues based on the bindings you've set up
</I>&gt;<i> (between the exchanges and queues). So for example, you can send a message
</I>&gt;<i> to an exchange from one client and receive it on another a la pub/sub by
</I>&gt;<i> using a topic exchange. You can apply content based routing using the
</I>&gt;<i> headers exchange. If you've got data that needs to go out to the devices
</I>&gt;<i> then you first need to figure out what your filters look like. Once these
</I>&gt;<i> are in place, you can use one of the built in exchange types to place the
</I>&gt;<i> messages into the broker's care. Each device that wishes to consume data
</I>&gt;<i> can either create a temporary queue and bind it to the exchange(s) in the
</I>&gt;<i> right way, or connect to an existing queue which is bound to a topic
</I>&gt;<i> exchange for some set of keys that interest you.
</I>&gt;<i>
</I>
Yep, i know you always send message to exchange and not to queue directly
(and i think its very nice concept).
My question was more about &quot;consuming part&quot; - when i have messages for one
and only one device\client, only way to get this message into device is to
create queue for each of them (and using proper exchange types\binding) -
because there is not something like &quot;subscribe to messages from queue xxxx
with header property DeviceId = 564165434&quot; in Rabbit...

And you answered my question ;) ...i have to have one &quot;incoming&quot; queue for
each device.

Temporal queues created by devices are not option for us. We work with same
device for a long time (say few months) and we need to send messages to
devices even when they are not connected atm..
As i understand how exchanges works, if there is no queue bound to exchange
with correct routing key, messages are just dropped (or can be returned
back to publisher)...



&gt;<i>  How much overhead queues in rabbit have ?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You can have lots (i.e., thousands) of queues without suffering too much,
</I>&gt;<i> though there is obviously *some* overhead (memory, etc) and its worth
</I>&gt;<i> planning your topology carefully so as to get the best out of Rabbit. We
</I>&gt;<i> can help with that (here) by pointing you to the right resources and
</I>&gt;<i> documentation, or if you want elaborate on some of the finer details of the
</I>&gt;<i> design we often have lively and interesting discussions about how to solve
</I>&gt;<i> various problems on this mailing list!
</I>&gt;<i>
</I>
I have made some tests and 1 durable queue created on rabbit running on
64bit Debian takes cca 10kb of memory. Thats pretty acceptable imho

&quot;Design&quot; is probably too strong word for what i have now :) ....just
thinking...



&gt;<i> Going back to something you mentioned at the beginning of your post:
</I>&gt;<i>
</I>&gt;<i>  It looks like collecting data from androids is easy task. All will send
</I>&gt;&gt;<i> data into single exchange\queue.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This really depends on what the whole messaging topology needs to look
</I>&gt;<i> like. Sometimes you need to propagate messages into various places, and
</I>&gt;<i> building blocks like fan-out and exchange-2-exchange bindings can help with
</I>&gt;<i> this. Other times, it actually makes more sense to send some messages to a
</I>&gt;<i> specific exchange and others to, well, another. As you're making design
</I>&gt;<i> decisions such as these, you'll want to consider various factors which
</I>&gt;<i> include performance and resource consumption on the broker, scaling up/out
</I>&gt;<i> (as you add more clients, potentially cluster the broker and so on) and of
</I>&gt;<i> course the management of all this infrastructure, from the perspective of
</I>&gt;<i> both the client application(s) and the administration of the broker itself.
</I>&gt;<i>
</I>&gt;<i>
</I>Yep, i'v oversiplified here.
Im planning to have different exchanges\queues for data messages send from
devices independently, separate for responses for server requests and
different for logging etc...
Not set in stone yet but im starting to see the light ;)


&gt;<i>  It can be also management issue and really feels like overkill when
</I>&gt;&gt;<i> number of messages send from server to device is really low....
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It's actually quite easy to set up a temporary, auto-delete (once the
</I>&gt;<i> client disconnects) queue that is used simply to bind to an exchange that
</I>&gt;<i> you're interested in. The semantics probably need some thought however: how
</I>&gt;<i> are you going to consume messages (e.g., round robin, fan-out, etc), how
</I>&gt;<i> will you know to delete them from the broker (using acks, etc) and so on.
</I>&gt;<i> This is where you need to think carefully about your design. Either way,
</I>&gt;<i> there shouldn't be much management to do if you're using temporary queues
</I>&gt;<i> to make consumption and guarantee that the queues are deleted once you're
</I>&gt;<i> finished with them (i.e., the client goes away). If you're using long lived
</I>&gt;<i> (shared) queues then the design complexity pushes back into the exchanges
</I>&gt;<i> and bindings you configure, but that's done just once and then clients need
</I>&gt;<i> to know where/how to connect.
</I>&gt;<i>
</I>&gt;<i>  Any advice will be appriciated.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If you've been through the tutorials, then hopefully it's clear that
</I>&gt;<i> consuming from a queue is relatively simple and that you have a number of
</I>&gt;<i> choices when it comes to 'filtering' what you receive. If you want to go
</I>&gt;<i> into a bit more detail about these 'filters' then we can look at which
</I>&gt;<i> topologies might best support your use cases.
</I>&gt;<i>
</I>
When i was talking about 'filters' it was really meant as &quot;how to subscribe
to *sigle* *queue *and receive only some messages based on some condition&quot;,
not how to distribute messages into different queues based on exchange
type\routing key really :)

Thanks very much for your time Tim!

Cheers

Michal


&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Tim
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121115/bbafdd3f/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121115/bbafdd3f/attachment.htm</A>&gt;
</PRE>






































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023874.html">[rabbitmq-discuss] RabbitMQ as communication server for mobile	devices
</A></li>
	<LI>Next message: <A HREF="023851.html">[rabbitmq-discuss] Unable to get Federation connection established
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23907">[ date ]</a>
              <a href="thread.html#23907">[ thread ]</a>
              <a href="subject.html#23907">[ subject ]</a>
              <a href="author.html#23907">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
