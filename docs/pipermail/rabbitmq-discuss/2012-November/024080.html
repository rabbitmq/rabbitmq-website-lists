<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Message unacked, Queue not responding...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Message%20unacked%2C%20Queue%20not%20responding...&In-Reply-To=%3CDBC6D4F4-8568-4C88-80F6-B754FC34C704%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024034.html">
   <LINK REL="Next"  HREF="024081.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Message unacked, Queue not responding...</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Message%20unacked%2C%20Queue%20not%20responding...&In-Reply-To=%3CDBC6D4F4-8568-4C88-80F6-B754FC34C704%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Message unacked, Queue not responding...">tim at rabbitmq.com
       </A><BR>
    <I>Thu Nov 22 09:46:18 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024034.html">[rabbitmq-discuss] Message unacked, Queue not responding...
</A></li>
        <LI>Next message: <A HREF="024081.html">[rabbitmq-discuss] Message unacked, Queue not responding...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24080">[ date ]</a>
              <a href="thread.html#24080">[ thread ]</a>
              <a href="subject.html#24080">[ subject ]</a>
              <a href="author.html#24080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi 

On 21 Nov 2012, at 08:36, jhiemer wrote:

&gt;<i> Good Morning guys, 
</I>&gt;<i> I have a question regarding queues with Rounting Key. It set the queues up, and the first two hours it runs very well. After a few hours of runtime the messages get into the queue, get the Unacked tag, but nothing happens. Even if I remove the consumer the messages are still in the Unacked state. First when I restart both, RabbitMQ Server as well as the consumer, or close the consumer and wait for 15 (?) minute, it works again. It seems that this is an issue with the timeout period or something?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I would be very glad if someone could help me out.
</I>
I'd be happy to try and help, but I must admit that I'm very confused about what you're saying. From what I can gather, you've got some queues and some exchanges bound to them and you're sending messages with routing keys and everything is good. Some time later, you're finding that messages have arrived in the queue and are in an unacked state - presumably you've seen this by running `rabbitmqctl messages_unacknowledged` or used the management plugin. 

&gt;<i> Even if I remove the consumer the messages are still in the Unacked state.
</I>
Removing a consumer is not going to help - you need to consume and then ACK the messages, otherwise they'll remain un-acked forever. From <A HREF="http://www.rabbitmq.com/tutorials/tutorial-two-python.html">http://www.rabbitmq.com/tutorials/tutorial-two-python.html</A> we can read:

&lt;quote&gt;
It's a common mistake to miss the basic_ack. It's an easy error, but the consequences are serious. Messages will be redelivered when your client quits (which may look like random redelivery), but RabbitMQ will eat more and more memory as it won't be able to release any unacked messages. 
&lt;/quote&gt;

&gt;<i> First when I restart both, RabbitMQ Server as well as the consumer, or close the consumer and wait for 15 (?) minute, it works 
</I>&gt;<i> again. It seems that this is an issue with the timeout period or something?
</I>

It really is totally unclear what you're doing here. The responsibility for acknowledgements lies with the consumer, so it seems likely to me that your consumer code is forgetting to ACK for some reason or another. If this is not the case, and you are seeing that the consumer sends a basic.ack but the messages are not being removed from the queue, then please send a minimal test case demonstrating this. I very much doubt that is what's happening.

If you've set up per-queue or per-message (in 3.0) TTL and you've got DLX configurations then it's possible that the configuration is wrong somehow but again I'm finding it hard to visualise how this scenario would crop up even then. What kind of queue are we talking about; Is this a durable queue? Have you enabled per-queue-ttl for this queue? Is there a deal letter exchange set up for it? 

If you can provide a bit more information about what your setup looks like and what exactly your clients are doing (i.e., basic.consume and basic.ack for each message, etc) then we should be able to get this sorted out for you!

Tim
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024034.html">[rabbitmq-discuss] Message unacked, Queue not responding...
</A></li>
	<LI>Next message: <A HREF="024081.html">[rabbitmq-discuss] Message unacked, Queue not responding...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24080">[ date ]</a>
              <a href="thread.html#24080">[ thread ]</a>
              <a href="subject.html#24080">[ subject ]</a>
              <a href="author.html#24080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
