<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] best practice for &quot;work queue&quot; type	application
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20best%20practice%20for%20%22work%20queue%22%20type%0A%09application&In-Reply-To=%3CCAE0Sz%3DyjFn8UAELb3XnnWrY_qnCD74%3D-H-S7jL87WtK7aNJk7Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023563.html">
   <LINK REL="Next"  HREF="023567.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] best practice for &quot;work queue&quot; type	application</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20best%20practice%20for%20%22work%20queue%22%20type%0A%09application&In-Reply-To=%3CCAE0Sz%3DyjFn8UAELb3XnnWrY_qnCD74%3D-H-S7jL87WtK7aNJk7Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] best practice for &quot;work queue&quot; type	application">jerryk at rbcon.com
       </A><BR>
    <I>Sun Nov  4 16:30:58 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023563.html">[rabbitmq-discuss] best practice for &quot;work queue&quot; type application
</A></li>
        <LI>Next message: <A HREF="023567.html">[rabbitmq-discuss] best practice for &quot;work queue&quot; type	application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23564">[ date ]</a>
              <a href="thread.html#23564">[ thread ]</a>
              <a href="subject.html#23564">[ subject ]</a>
              <a href="author.html#23564">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, John:

On Fri, Nov 2, 2012 at 7:19 PM, John Cartwright
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">john.c.cartwright at noaa.gov</A>&gt;wrote:

&gt;<i>
</I>&gt;<i> The example suggests that the worker wait until the processing is
</I>&gt;<i> complete to send the ACK for a given message.  So if my processing
</I>&gt;<i> takes many hours, is this a problem for RabbitMQ to have the worker
</I>&gt;<i> process consume a message but wait for a very long time to acknowledge
</I>&gt;<i> it?
</I>&gt;<i>
</I>
The answer is that it depends.  :-)

While your message is in the &quot;consumed but unACKed by the consumer&quot; state,
the broker is holding on to a copy of the message to guard against the
possible failure of your consumer (which will be detected by seeing the
connection close unexpectedly) by redelivering in the future if necessary.

If the message was published with persistence requested it may be sitting
on disk during this period.  Even if it wasn't published persistently, but
the broker came under memory pressure, the message may still have been
swapped out to disk.  In both cases, keeping that message alive will eat
some disk space.  It will also eat some memory, both for the message
itself, assuming it hasn't been swapped out due to memory pressure, and a
tiny bit of bookkeeping overhead.

Whether that becomes a problem or not while your long running consumer is
chewing on the message depends on just what sort of resources are available
in your broker (RAM and disk particularly) couner-balanced against just how
many other messages are passing through the broker, and potentially also
languishing in this state for a long time.

Rabbit can queue and persist messages pending their delivery and
acknowledgment, but it's best not used deliberately as a long term store of
data.  A handy mantra is that &quot;A happy Rabbit is an empty Rabbit.&quot;  In
other words, Rabbit (and other messaging systems) runs best when it's able
to deliver messages in a reasonably timely way, although if things block up
due to crashed or slow consumers or the like, mechanisms exist to keep
things going, as long as you don't resource exhaust the universe.


&gt;<i> Is there a better way to handle this scenario?
</I>&gt;<i>
</I>
Again, it depends.  If you have a good sense for how much of your traffic
is going to result in these long-working consumers, and you can bound that
to some reasonable extent to avoid having vast piles of messages in the
broker, delivered but waiting to be ACKed, then you might be just fine
doing things the way you describe.

If you expect that you'll have a ton of these slow-to-ACK messages, you may
want to consider a slightly more elaborate messaging structure, say where
the consumers ACK the message as soon as they've persisted a local copy to
work on, and use another queue to notify any upstream services or
publishers who care that the work in question has been finished.

Then again, perhaps the publisher side doesn't need to be directly informed
that consumer work is done, in which case your workflow on the consumer
side would be to consume the message, persist it to local storage so that
you have a safe copy of it you can resume work upon if your consumer dies,
and then ACK it, thereby accepting responsibility for the message's
contents from the broker and allowing the broker to forget about the
message and stop worrying about having to redeliver it.

Make sense?

Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121104/b86d2e91/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121104/b86d2e91/attachment.htm</A>&gt;
</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023563.html">[rabbitmq-discuss] best practice for &quot;work queue&quot; type application
</A></li>
	<LI>Next message: <A HREF="023567.html">[rabbitmq-discuss] best practice for &quot;work queue&quot; type	application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23564">[ date ]</a>
              <a href="thread.html#23564">[ thread ]</a>
              <a href="subject.html#23564">[ subject ]</a>
              <a href="author.html#23564">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
