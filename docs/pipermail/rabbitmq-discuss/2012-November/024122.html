<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publishing: Connection timeout issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publishing%3A%20Connection%20timeout%20issue&In-Reply-To=%3CCAAt2poKDVXZq7vGoCAEBpiMDscPAjzuqYS%2BAp2JRpcggFoKhCg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024121.html">
   <LINK REL="Next"  HREF="024243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publishing: Connection timeout issue</H1>
    <B>Alan Antonuk</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publishing%3A%20Connection%20timeout%20issue&In-Reply-To=%3CCAAt2poKDVXZq7vGoCAEBpiMDscPAjzuqYS%2BAp2JRpcggFoKhCg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Publishing: Connection timeout issue">alan.antonuk at gmail.com
       </A><BR>
    <I>Sat Nov 24 22:23:49 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024121.html">[rabbitmq-discuss] Publishing: Connection timeout issue
</A></li>
        <LI>Next message: <A HREF="024243.html">[rabbitmq-discuss] Publishing: Connection timeout issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24122">[ date ]</a>
              <a href="thread.html#24122">[ thread ]</a>
              <a href="subject.html#24122">[ subject ]</a>
              <a href="author.html#24122">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Couple notes:

- Doing a connection_close() implicitly closes all channels. You don't need
to explicitly close channels.
- If you get a connection timeout error while using the connection object,
the whole connection is dead. You won't be able to do a channel_close or
connection_close. The only thing you can do is destroy the connection
object (which should clean up any memory and close any partially open
sockets).

I'm not sure how you set up your exchanges/queues on the broker, but I
don't think it should matter what connection you publish your message over.

-Alan

On Sat, Nov 24, 2012 at 4:35 PM, Borman Squirrel
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">triton.genocide at gmail.com</A>&gt;wrote:

&gt;<i> Hi everybody, carrot eaters! :)
</I>&gt;<i>
</I>&gt;<i> I am using rabbitmq-c driver.
</I>&gt;<i>
</I>&gt;<i> Sometimes when I try to publish a message (using basic publish method)
</I>&gt;<i> from a thread that is acting like worker for sending messages, I am geting
</I>&gt;<i> an error due to connection time out.
</I>&gt;<i>
</I>&gt;<i> When I try to close channel and connection to restablishing connection, I
</I>&gt;<i> get broken pipe exception and consecuently I can not close the connection.
</I>&gt;<i> After that, the worker enters in a new loop iteration and create a new
</I>&gt;<i> socket, a new channel, a new connection ... It seems that the server, due
</I>&gt;<i> to exists two connections, does not send the messages to clients through
</I>&gt;<i> the right connection and the messages never reaches the clients.
</I>&gt;<i>
</I>&gt;<i> This is the pseudocode :
</I>&gt;<i>
</I>&gt;<i> worker_sender()
</I>&gt;<i> {
</I>&gt;<i>     while(1)
</I>&gt;<i>     {
</I>&gt;<i>          opening_socket
</I>&gt;<i>          logging_in
</I>&gt;<i>          opening_channel
</I>&gt;<i>
</I>&gt;<i>          while(1)
</I>&gt;<i>          {
</I>&gt;<i>               if(error(basic_publish()) //here connection timeout error
</I>&gt;<i>                   break;
</I>&gt;<i>          }
</I>&gt;<i>
</I>&gt;<i>          closing_channel //here broken pipe exception
</I>&gt;<i>          closing_connection //here broken pipe exception
</I>&gt;<i>          destroy_connection
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>     return
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> It would be possible to solve this issue with other approach or some
</I>&gt;<i> adjustment to the showed solution?
</I>&gt;<i>
</I>&gt;<i> Thanks in advance!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121124/10ca5175/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121124/10ca5175/attachment.htm</A>&gt;
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024121.html">[rabbitmq-discuss] Publishing: Connection timeout issue
</A></li>
	<LI>Next message: <A HREF="024243.html">[rabbitmq-discuss] Publishing: Connection timeout issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24122">[ date ]</a>
              <a href="thread.html#24122">[ thread ]</a>
              <a href="subject.html#24122">[ subject ]</a>
              <a href="author.html#24122">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
