<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Recommended haproxy config
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recommended%20haproxy%20config&In-Reply-To=%3C1515DE74-8FD0-48B7-BB2C-8903E993072C%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023549.html">
   <LINK REL="Next"  HREF="023558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Recommended haproxy config</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recommended%20haproxy%20config&In-Reply-To=%3C1515DE74-8FD0-48B7-BB2C-8903E993072C%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Recommended haproxy config">tim at rabbitmq.com
       </A><BR>
    <I>Mon Nov  5 14:36:44 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023549.html">[rabbitmq-discuss] Recommended haproxy config
</A></li>
        <LI>Next message: <A HREF="023558.html">[rabbitmq-discuss] Erlang version issue when Upgrading to	2.8.7-1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23585">[ date ]</a>
              <a href="thread.html#23585">[ thread ]</a>
              <a href="subject.html#23585">[ subject ]</a>
              <a href="author.html#23585">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

On 1 Nov 2012, at 19:48, Dave Curylo wrote:

&gt;<i> I am running an active-active RabbitMQ cluster, and as recommended by &quot;High Availability in RabbitMQ: solving part of the puzzle&quot; (<A HREF="http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/">http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/</A>), I'm connecting to the cluster of message brokers via an haproxy load balancer.  Everything was working fine until one of the nodes failed, after which it seemed that the haproxy load balancer did not appear to detect the failed node.  Clients would initiate connections and often just hang, I assume because the load balancer is forwarding them on to the failed node.
</I>
Well, you've got tcp keep-alives enabled at the TCP/IP stack level, so one would expect broken connections to be detected by ha-proxy in this case. The exact behaviour of tcp keep-alive is determined by the underlying OS/Kernel configuration - see `man tcp` on linux for more details. I notice that you've set `timeout server` to 50 seconds - could the interplay between this setting and tcpka be causing the delay here? How long are clients seeming to 'hang' once a node has failed?
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023549.html">[rabbitmq-discuss] Recommended haproxy config
</A></li>
	<LI>Next message: <A HREF="023558.html">[rabbitmq-discuss] Erlang version issue when Upgrading to	2.8.7-1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23585">[ date ]</a>
              <a href="thread.html#23585">[ thread ]</a>
              <a href="subject.html#23585">[ subject ]</a>
              <a href="author.html#23585">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
