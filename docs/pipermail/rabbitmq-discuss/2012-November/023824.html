<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 100% CPU usage with 2.8.4 when out file	descriptors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20100%25%20CPU%20usage%20with%202.8.4%20when%20out%20file%0A%09descriptors&In-Reply-To=%3CCAO0Hhb3AQ4iMSeiiCRYmiGicPSaG0GryU8_y%3DcwfJZnFwvbbhA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023830.html">
   <LINK REL="Next"  HREF="023825.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 100% CPU usage with 2.8.4 when out file	descriptors</H1>
    <B>Lars Windolf</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20100%25%20CPU%20usage%20with%202.8.4%20when%20out%20file%0A%09descriptors&In-Reply-To=%3CCAO0Hhb3AQ4iMSeiiCRYmiGicPSaG0GryU8_y%3DcwfJZnFwvbbhA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] 100% CPU usage with 2.8.4 when out file	descriptors">lars.lindner at gmail.com
       </A><BR>
    <I>Tue Nov 13 18:31:51 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023830.html">[rabbitmq-discuss] AnyEvent perl dependency
</A></li>
        <LI>Next message: <A HREF="023825.html">[rabbitmq-discuss] 100% CPU usage with 2.8.4 when out file	descriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23824">[ date ]</a>
              <a href="thread.html#23824">[ thread ]</a>
              <a href="subject.html#23824">[ subject ]</a>
              <a href="author.html#23824">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I was asked by Matthias Rodestock to submit my experience [1] with
100% CPU usage when file descriptors are used up.

My setup:
- Recent Chef with Ubuntu rabbitmq-server package 2.8.4-1

Steps to reproduce:
1.) Set ulimit -n to low value (e.g. default of 1024)
2.) Connect a lot of chef nodes, do a lot of stuff
3.) Wait 2 or 3 days

After this memory usage goes up and at some time it starts eating CPU.
It does stop working then. Listing the queues doesn't work anymore.
Restarting the service doesn't help. &quot;rabbitmqctl report&quot; shows ~100%
used file descriptors.

Increasing the ulimit and restarting RabbitMQ immediately helps.

Best Regards,
Lars

[1] <A HREF="http://lzone.de/Solving+100%25+CPU+usage+of+Chef">http://lzone.de/Solving+100%25+CPU+usage+of+Chef</A>

PS: Please CC in case of questions as I have not subscribed to the list
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121113/39ad760b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121113/39ad760b/attachment.htm</A>&gt;
</PRE>














































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023830.html">[rabbitmq-discuss] AnyEvent perl dependency
</A></li>
	<LI>Next message: <A HREF="023825.html">[rabbitmq-discuss] 100% CPU usage with 2.8.4 when out file	descriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23824">[ date ]</a>
              <a href="thread.html#23824">[ thread ]</a>
              <a href="subject.html#23824">[ subject ]</a>
              <a href="author.html#23824">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
