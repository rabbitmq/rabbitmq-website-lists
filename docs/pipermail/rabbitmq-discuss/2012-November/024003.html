<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%203.0%20Policy%20ha-all%20delete%20issue&In-Reply-To=%3C1353430965372-23530.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024000.html">
   <LINK REL="Next"  HREF="024005.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue</H1>
    <B>Mark Ward</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%203.0%20Policy%20ha-all%20delete%20issue&In-Reply-To=%3C1353430965372-23530.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue">ward.mark at gmail.com
       </A><BR>
    <I>Tue Nov 20 17:02:45 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024000.html">[rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
</A></li>
        <LI>Next message: <A HREF="024005.html">[rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24003">[ date ]</a>
              <a href="thread.html#24003">[ thread ]</a>
              <a href="subject.html#24003">[ subject ]</a>
              <a href="author.html#24003">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I should note that my testing clients are actively sending messages in 4
static queues.  but for each message sent they are creating a dynamic queue
and then later deleting the queue.  I think the issue could be happening
wile the cluster is handling some of the more volatile queues that are
created/deleted by the clients.

What else I noticed.  I deleted the previous queue that was still tied to a
policy that didn't exist.  Began running my test again with no policies. 
During the testing I created the policy to mirror the queues and received
another error.  then after a few moments of I deleted the policy.  An error
again.

Now one of my more static queues was lost. It does not show up in the
management anymore.   I think the queue &quot;crashed&quot;

Some of my errors from the logs

=INFO REPORT==== 20-Nov-2012::10:33:30 ===
Adding mirror of queue 'dcf.action.status' in vhost 'MoBunnyMoProblems.DCF'
on node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at CUST1-MASTER</A>': &lt;2756.5031.0&gt;

=INFO REPORT==== 20-Nov-2012::10:33:30 ===
Adding mirror of queue 'dcf.action.status' in vhost 'MoBunnyMoProblems.DCF'
on node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RIOBARON-1</A>': &lt;2754.13177.4&gt;

=WARNING REPORT==== 20-Nov-2012::10:46:47 ===
closing AMQP connection &lt;0.32767.3&gt; (192.168.10.104:37880 -&gt;
192.168.10.57:5672):
connection_closed_abruptly

=ERROR REPORT==== 20-Nov-2012::10:49:28 ===
** Generic server &lt;0.6.4&gt; terminating
** Last message in was stop_mirroring
** When Server state == {q,
                         {amqqueue,
                          {resource,&lt;&lt;&quot;MoBunnyMoProblems.DCF&quot;&gt;&gt;,queue,
                           &lt;&lt;&quot;dcf.action.status&quot;&gt;&gt;},
                          true,false,none,
                          [{&lt;&lt;&quot;x-expires&quot;&gt;&gt;,signedint,100800000}],
                          &lt;0.6.4&gt;,[],[],
                          [{vhost,&lt;&lt;&quot;MoBunnyMoProblems.DCF&quot;&gt;&gt;},
                           {name,&lt;&lt;&quot;ha-all&quot;&gt;&gt;},
                           {pattern,&lt;&lt;&quot;^dcf&quot;&gt;&gt;},
                           {definition,[{&lt;&lt;&quot;ha-mode&quot;&gt;&gt;,&lt;&lt;&quot;all&quot;&gt;&gt;}]},
                           {priority,0}],
                          []},
                         none,true,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          10885,
                          {0,nil},
                          undefined,
                          {0,nil},
                          {qistate,
                          
&quot;c:/rabbitmq.hold/db/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RIOOVERLORD-1-mnesia</A>/queues/CTMLPLO20JY4AIHN3GGESPI7D&quot;,
                           {{dict,0,16,16,8,80,48,
                            
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            [{segment,0,
                             
&quot;c:/rabbitmq.hold/db/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RIOOVERLORD-1-mnesia</A>/queues/CTMLPLO20JY4AIHN3GGESPI7D/0.idx&quot;,
                              {array,16384,0,undefined,
                               {{1000,1000,1000,1000,1000,1000,
                                 {100,100,100,100,100,100,100,100,
                                  {10,10,10,10,10,10,
                                   {undefined,undefined,undefined,
                                   
{{&lt;&lt;240,91,13,230,237,230,42,174,76,54,117,
                                        111,236,199,4,71&gt;&gt;,
                                      {message_properties,undefined,true,
                                       false},
                                      true},
                                     del,ack},
                                    
..................... deleted bunch of stuff ......................

                                   10,10},
                                  100,100},
                                
1000,1000,1000,1000,1000,1000,1000,1000,1000,
                                 1000},
                                10000,10000,10000,10000,10000,10000,10000,
                                10000,10000}},
                              0}]},
                           #Ref&lt;0.0.7.158837&gt;,12066,262144,
                           #Fun&lt;rabbit_variable_queue.2.41635915&gt;,
                           {0,nil}},
                          {{client_msstate,msg_store_persistent,
                           
&lt;&lt;158,88,38,57,48,220,55,115,72,72,33,241,89,104,
                              106,124&gt;&gt;,
                            {dict,0,16,16,8,80,48,
                            
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,344140,
                            
&quot;c:/rabbitmq.hold/db/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RIOOVERLORD-1-mnesia</A>/msg_store_persistent&quot;},
                            rabbit_msg_store_ets_index,
                           
&quot;c:/rabbitmq.hold/db/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RIOOVERLORD-1-mnesia</A>/msg_store_persistent&quot;,
                            &lt;0.267.0&gt;,348237,340043,352334,356431},
                           {client_msstate,msg_store_transient,
                           
&lt;&lt;83,30,50,235,43,138,36,105,58,170,111,228,99,194,
                              5,152&gt;&gt;,
                            {dict,0,16,16,8,80,48,
                            
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,323655,
                            
&quot;c:/rabbitmq.hold/db/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RIOOVERLORD-1-mnesia</A>/msg_store_transient&quot;},
                            rabbit_msg_store_ets_index,
                           
&quot;c:/rabbitmq.hold/db/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RIOOVERLORD-1-mnesia</A>/msg_store_transient&quot;,
                            &lt;0.262.0&gt;,327752,319551,331849,335946}},
                         
true,0,#Fun&lt;rabbit_amqqueue_process.5.77104289&gt;,0,0,
                          infinity,0,0,0,95,95,
                          {rates,
                           {{1353,430160,19630},155},
                           {{1353,430160,19630},155},
                           32.34796456653727,32.34796456653727,
                           {1353,430165,27630}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          95,95,
                          {rates,
                           {{1353,430160,19630},155},
                           {{1353,430160,19630},155},
                           32.34796456653727,32.34796456653727,
                           {1353,430165,27630}}},
                         {[{&lt;2756.5629.0&gt;,
                            {consumer,&lt;&lt;&quot;amq.ctag-ZHZP5Ybp_xZxsi5kvmuVfw&quot;&gt;&gt;,
                             true}}],
                          []},
                         100800000,undefined,#Ref&lt;0.0.8.36505&gt;,
                         #Ref&lt;0.0.8.1338&gt;,
                         {state,fine,5000,#Ref&lt;0.0.8.36524&gt;},
                         {0,nil},
                         undefined,undefined,undefined,
                         {dict,3,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[[&lt;2756.5690.0&gt;|#Ref&lt;0.0.8.1812&gt;],
                             [&lt;2754.15277.4&gt;|#Ref&lt;0.0.8.1819&gt;]],
                            [],[],[],[],[],[],[],
                            [[&lt;2754.15269.4&gt;|#Ref&lt;0.0.8.1825&gt;]],
                            [],[],[],[],[],[],[]}}},
                         1,
                         {{0,nil},{0,nil}},
                         undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined}


** Reason for termination == 
** {{badmatch,rabbit_mirror_queue_master},
    [{rabbit_amqqueue_process,handle_call,3,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,wake_up,3,[{file,&quot;proc_lib.erl&quot;},{line,237}]}]}





--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-Policy-ha-all-delete-issue-tp23527p23530.html">http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-Policy-ha-all-delete-issue-tp23527p23530.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024000.html">[rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
</A></li>
	<LI>Next message: <A HREF="024005.html">[rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24003">[ date ]</a>
              <a href="thread.html#24003">[ thread ]</a>
              <a href="subject.html#24003">[ subject ]</a>
              <a href="author.html#24003">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
