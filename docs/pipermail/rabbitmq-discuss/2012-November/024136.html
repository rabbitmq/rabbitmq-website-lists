<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Issue with delayed restart of children in	supervisor2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Issue%20with%20delayed%20restart%20of%20children%20in%0A%09supervisor2&In-Reply-To=%3Cc626ebb1-1e71-474d-9b63-7d1e6ee2d4b7%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024132.html">
   <LINK REL="Next"  HREF="024137.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Issue with delayed restart of children in	supervisor2</H1>
    <B>Ilya Staheev</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Issue%20with%20delayed%20restart%20of%20children%20in%0A%09supervisor2&In-Reply-To=%3Cc626ebb1-1e71-474d-9b63-7d1e6ee2d4b7%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Issue with delayed restart of children in	supervisor2">istaheev at gmail.com
       </A><BR>
    <I>Mon Nov 26 12:03:57 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024132.html">[rabbitmq-discuss] Permissions for aliveness-test user
</A></li>
        <LI>Next message: <A HREF="024137.html">[rabbitmq-discuss] Issue with delayed restart of children in	supervisor2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24136">[ date ]</a>
              <a href="thread.html#24136">[ thread ]</a>
              <a href="subject.html#24136">[ subject ]</a>
              <a href="author.html#24136">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

supervisor2 treats start of a child after the delay as a restart of the 
child which might lead to weird behavior in some cases. Imagine the 
situation when a bunch of children are restarted simultaneously for some 
reason so that maximum restart frequency has been reached. If all children 
have {permanent | transient | intrinsic, Delay} in their child 
specifications then supervisor2 delays restart of them for Delay seconds. 
After the delay all the children are restarted simultaneously and 
supervisor2 applies same rules for checking maximal restart frequency 
again. If amount of children is greater than MaxR then first MaxR children 
are started normally, without any delays between each other, but then 
supervisor2 begins to think that maximum restart frequency is reached again 
and introduce a delay before it begins to start the rest of the children. 

1. N children fail simultaneously (N &gt; MaxR).
2. supervisor2 waits for Delay second.
3. supervisor2 begins to restart failed children.
4. First MaxR children have been restarted.
5. supervisor2 reaches maximum restart frequency.
6. supervisor2 waits for Delay seconds.   &lt;-- bad
7. The (MaxR+1)'th child is started.
8. After the next MaxR children the same effect with delay appears.
...

It is not good behaviour from my point of view, start of a child after the 
delay should not be treated as restart with restarts counting and I would 
like to fix it. Patch is attached. Thank you in advance.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121126/27026892/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121126/27026892/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: supervisor2.diff
Type: text/x-diff
Size: 2638 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121126/27026892/attachment.diff">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121126/27026892/attachment.diff</A>&gt;
</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024132.html">[rabbitmq-discuss] Permissions for aliveness-test user
</A></li>
	<LI>Next message: <A HREF="024137.html">[rabbitmq-discuss] Issue with delayed restart of children in	supervisor2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24136">[ date ]</a>
              <a href="thread.html#24136">[ thread ]</a>
              <a href="subject.html#24136">[ subject ]</a>
              <a href="author.html#24136">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
