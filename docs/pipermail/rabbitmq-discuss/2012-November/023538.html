<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbit_mgmt_db crashed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbit_mgmt_db%20crashed&In-Reply-To=%3C5092B14F.4030006%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023543.html">
   <LINK REL="Next"  HREF="023552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbit_mgmt_db crashed</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbit_mgmt_db%20crashed&In-Reply-To=%3C5092B14F.4030006%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] rabbit_mgmt_db crashed">simon at rabbitmq.com
       </A><BR>
    <I>Thu Nov  1 17:28:47 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023543.html">[rabbitmq-discuss] can't start rabbitmq-server
</A></li>
        <LI>Next message: <A HREF="023552.html">[rabbitmq-discuss] rabbit_mgmt_db crashed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23538">[ date ]</a>
              <a href="thread.html#23538">[ thread ]</a>
              <a href="subject.html#23538">[ subject ]</a>
              <a href="author.html#23538">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/10/12 18:48, Chen, Bin wrote:
&gt;<i> Hi Simon,
</I>&gt;<i>
</I>&gt;<i> I found the similar crash reports on another RMQ server.
</I>&gt;<i> It had happened a few times.
</I>&gt;<i> However, the memory utilization didn't went up greatly as another
</I>&gt;<i> server.
</I>&gt;<i>
</I>&gt;<i> Two of the attached zip files are the eval output and report output.
</I>&gt;<i> The other one is the sasl log file containing the crash reports.
</I>
Ah, OK. I asked for the eval output to try to understand why that server 
was using so much memory - so if it's from a different server using less 
memory it doesn't tell me anything.

I'm afraid looking at this I still don't understand any better why the 
rabbit_mgmt_db is crashing. But I notice it crashed twice in one day on 
that machine - does this happen often for you?

If so, would you be prepared to run a patched management plugin that 
could gather some more data when it crashes, so we can investigate further?

Cheers, Simon

&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> --Bin Chen
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Simon MacMullen [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>]
</I>&gt;<i> Sent: Wednesday, October 31, 2012 4:07 AM
</I>&gt;<i> To: Discussions about RabbitMQ
</I>&gt;<i> Cc: Chen, Bin
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] rabbit_mgmt_db crashed
</I>&gt;<i>
</I>&gt;<i> Hi. I remember you posted a similar stack trace six months ago:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019990.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019990.htm</A>
</I>&gt;<i> l
</I>&gt;<i>
</I>&gt;<i> I stared at the code involved for some time but was completely unable to
</I>&gt;<i> see how that could occur. I don't suppose you have any way to replicate
</I>&gt;<i> this?
</I>&gt;<i>
</I>&gt;<i> Apart from that, could you post the output of:
</I>&gt;<i>
</I>&gt;<i> rabbitmqctl.bat eval
</I>&gt;<i> &quot;lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
</I>&gt;<i> Pid, process_info(Pid)} || Pid &lt;- processes()])), 30).&quot;
</I>&gt;<i>
</I>&gt;<i> (all on one line)
</I>&gt;<i>
</I>&gt;<i> and
</I>&gt;<i>
</I>&gt;<i> rabbitmqctl.bat report
</I>&gt;<i>
</I>&gt;<i> somewhere please?
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> On 31/10/12 00:09, Chen, Bin wrote:
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I just noticed a crash report in sasl log of one of our RMQ server.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It seems the management plug-in crashed. The management web page
</I>&gt;&gt;<i> cannot be opened any more.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I had this problem before with an old version. Now I am using 2.8.6
</I>&gt;&gt;<i> 64-bit version on Windows 2008 Server.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The RMQ server is still running fine, but the memory utilization is
</I>&gt;&gt;<i> much higher than other similar servers without such crash.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This &quot;bad&quot; server uses about 8 GB memory now, while other normal
</I>&gt;&gt;<i> servers use only about 500 MB memory.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It may eventually hit the high memory water mark soon at 9.6 GB.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the complete crash report.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =CRASH REPORT==== 29-Oct-2012::23:01:08 ===
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     crasher:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       initial call: rabbit_mgmt_db:init/1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       pid: &lt;0.284.0&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       registered_name: []
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       exception exit: {badarith,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                           [{rabbit_mgmt_db,rate,5,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                            {rabbit_mgmt_db,'-rates/5-lc$^0/1-0-',5,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                            {rabbit_mgmt_db,'-rates/5-lc$^1/1-1-',6,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                            {rabbit_mgmt_db,rates,5,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                            {rabbit_mgmt_db,handle_fine_stat,7,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {rabbit_mgmt_db,'-handle_fine_stats/4-lc$^1/1-1-',4,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                []},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>          {rabbit_mgmt_db,'-handle_event/2-lc$^1/1-0-',4,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                            {rabbit_mgmt_db,handle_event,2,[]}]}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         in function  gen_server:terminate/6 (gen_server.erl, line 747)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       ancestors: [&lt;0.281.0&gt;,rabbit_mgmt_sup,&lt;0.262.0&gt;]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       messages: [{'$gen_cast',
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                         {event,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                             {event,channel_stats,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                 [{pid,&lt;0.12756.396&gt;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {transactional,false},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {confirm,false},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {consumer_count,0},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {messages_unacknowledged,0},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {messages_unconfirmed,0},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {messages_uncommitted,0},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {acks_uncommitted,0},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {prefetch_count,1},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {client_flow_blocked,false},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {channel_queue_stats,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {channel_exchange_stats,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                  {channel_queue_exchange_stats,[]}],
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                 {1351,576868,812003}}}}]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       links: [&lt;0.281.0&gt;]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       dictionary: []
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       trap_exit: false
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       status: running
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       heap_size: 6765
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       stack_size: 24
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       reductions: 3730467164
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     neighbours:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the output of &quot;rabbitmqctl.bat status&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RACK4UNIT001</A> ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [{pid,4708},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {running_applications,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        [{rabbitmq_management,&quot;RabbitMQ Management Console&quot;,&quot;2.8.6&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {rabbitmq_management_agent,&quot;RabbitMQ Management
</I>&gt;&gt;<i> Agent&quot;,&quot;2.8.6&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;2.8.6&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {rabbit,&quot;RabbitMQ&quot;,&quot;2.8.6&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.10&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.2.1&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {rabbitmq_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.8.6&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {webmachine,&quot;webmachine&quot;,&quot;1.9.1-rmq2.8.6-git52e62bc&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;2.3.1-rmq2.8.6-gitd541e9a&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {xmerl,&quot;XML parser&quot;,&quot;1.3.2&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.9.1&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.7.1&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.18.2&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.15.2&quot;}]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {os,{win32,nt}},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {erlang_version,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        &quot;Erlang R15B02 (erts-5.9.2) [64-bit] [smp:12:12]
</I>&gt;&gt;<i> [async-threads:30]\n&quot;},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {memory,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        [{total,8512001360},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {processes,7401925315},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {processes_used,7401754972},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {system,1110076045},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {atom,662409},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {atom_used,652416},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {binary,857726336},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {code,17969722},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {ets,4550280}]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {vm_memory_high_watermark,0.4},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {vm_memory_limit,10304190873},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {disk_free_limit,1000000000},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {disk_free,39365828608},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {file_descriptors,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        [{total_limit,16284},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {total_used,142},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {sockets_limit,14653},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         {sockets_used,113}]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {processes,[{limit,1048576},{used,5986}]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {run_queue,0},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {uptime,104350}]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ...done.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Best regards,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --Bin Chen
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023543.html">[rabbitmq-discuss] can't start rabbitmq-server
</A></li>
	<LI>Next message: <A HREF="023552.html">[rabbitmq-discuss] rabbit_mgmt_db crashed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23538">[ date ]</a>
              <a href="thread.html#23538">[ thread ]</a>
              <a href="subject.html#23538">[ subject ]</a>
              <a href="author.html#23538">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
