<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] redelivery after ACK
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20redelivery%20after%20ACK&In-Reply-To=%3C1352260127.60148864%40apps.rackspace.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023657.html">
   <LINK REL="Next"  HREF="023658.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] redelivery after ACK</H1>
    <B>larry.edelstein at therealreal.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20redelivery%20after%20ACK&In-Reply-To=%3C1352260127.60148864%40apps.rackspace.com%3E"
       TITLE="[rabbitmq-discuss] redelivery after ACK">larry.edelstein at therealreal.com
       </A><BR>
    <I>Wed Nov  7 03:48:47 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023657.html">[rabbitmq-discuss] publish msg in immediate mode and rabbitmq server's memory is pilling up
</A></li>
        <LI>Next message: <A HREF="023658.html">[rabbitmq-discuss] redelivery after ACK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23641">[ date ]</a>
              <a href="thread.html#23641">[ thread ]</a>
              <a href="subject.html#23641">[ subject ]</a>
              <a href="author.html#23641">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
 
Hi folks - I'm new to RabbitMQ. I've got a problem and need some help.
 
I've posted the question on Stack Overflow at <A HREF="http://stackoverflow.com/questions/13262738/redelivery-after-ack,">http://stackoverflow.com/questions/13262738/redelivery-after-ack,</A> so if you want to answer it there, please do! I'll do my best to repost, here, any answers I get there, so that rabbitmq-discuss list denizens can also see and discuss.
 
So feel free to go to Stack Overflow, or read it here.

Larry Edelstein
Now Answers, Inc.
m (415) 713-9148
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ribs at acm.org</A>

+++
 

Why are my RabbitMQ messages being redelivered to my consumer after they have been ACKd? I'm new to RabbitMQ; I must be misusing it, or there's something wrong perhaps with the Ruby amqp gem.


I have a ruby script that subscribes to a queue and acks each message. If I let it make it all the way through the messages, the messages really do disappear from the queue; they're not redelivered. But if I interrupt my script before they're all ACKd, and then start the script again, delivery starts anew from the first message. 


The behavior I'm seeing in code is reflected accurately by the RabbitMQ web management interface; the queue has messages, and despite the ACKs, they don't disappear.


Clue: I put about 5000 messages in the queue. If I let the consumer ACK a significant amount, a few messages do actually appear to be removed from the queue (contrary to what I said above). I haven't been able to nail this phenomenon down.


I'm using ruby 1.9.3, RabbitMQ 2.8.7, and the amqp ruby gem 0.9.8. It happens with producer and consumer on Ubuntu 12.0.4, or on Mac OS 10.7.4.


What the heck??


Here's the code for the consumer:


 # encoding: utf-8
 require &quot;rubygems&quot;
 require 'amqp'
 require 'aws-sdk'
 
 queue_name = &quot;some.queue&quot;
 begin
 AMQP.start(&quot;<A HREF="amqp://localhost:5672&quot;">amqp://localhost:5672&quot;</A>) do | connection |
 channel  = AMQP::Channel.new(connection)
 queue = channel.queue(queue_name, :durable =&gt; true)
 queue.subscribe(:ack =&gt; true) do | metadata, payload |
 metadata.ack
 end
 end
 end


and here's the producer:


 # encoding: utf-8
 require &quot;rubygems&quot;
 require 'amqp'
 require 'aws-sdk'
 
 msg = ARGV[0]
 queue_name = &quot;some.queue&quot;
 begin
 AMQP.start(&quot;<A HREF="amqp://localhost:5672&quot;">amqp://localhost:5672&quot;</A>) do | connection |
 channel  = AMQP::Channel.new(connection)
 queue    = channel.queue(queue_name, :durable =&gt; true)
 (1..5000).each do | x |
 channel.default_exchange.publish x, :routing_key =&gt; queue_name, :persistent =&gt; true
 end
 end
 end


 
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121106/dae75c3c/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121106/dae75c3c/attachment.htm</A>&gt;
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023657.html">[rabbitmq-discuss] publish msg in immediate mode and rabbitmq server's memory is pilling up
</A></li>
	<LI>Next message: <A HREF="023658.html">[rabbitmq-discuss] redelivery after ACK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23641">[ date ]</a>
              <a href="thread.html#23641">[ thread ]</a>
              <a href="subject.html#23641">[ subject ]</a>
              <a href="author.html#23641">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
