<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] newbie rabbitMQ clustering question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20newbie%20rabbitMQ%20clustering%20question&In-Reply-To=%3C0DA71B7504503342B547250DC47209D578E2A5%40SJC4EXDAG01-01.corp.service-now.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023509.html">
   <LINK REL="Next"  HREF="023519.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] newbie rabbitMQ clustering question</H1>
    <B>Scott Stone</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20newbie%20rabbitMQ%20clustering%20question&In-Reply-To=%3C0DA71B7504503342B547250DC47209D578E2A5%40SJC4EXDAG01-01.corp.service-now.com%3E"
       TITLE="[rabbitmq-discuss] newbie rabbitMQ clustering question">Scott.Stone at servicenow.com
       </A><BR>
    <I>Thu Nov  1 01:57:59 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023509.html">[rabbitmq-discuss] Will the rabbitmq-web-stomp work with 2.8.7?
</A></li>
        <LI>Next message: <A HREF="023519.html">[rabbitmq-discuss] newbie rabbitMQ clustering question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23510">[ date ]</a>
              <a href="thread.html#23510">[ thread ]</a>
              <a href="subject.html#23510">[ subject ]</a>
              <a href="author.html#23510">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>sorry for the doublepost here - not sure if my other one even got through, since my original subscribed address doesn't match what my sender address goes OUT as.. anyway, that's fixed, so here's my original question:

So, I'm trying to get mcollective to work with a highly-available rabbitMQ cluster.  Using SSL (that is actually working), and an F5 bigIP.

So, as long as both of my rabbitmq nodes are up, everything works great.  Loadbalancer works, even with SSL turned on, all my mcollective stuff works, everything is happy and good.

I have both of my rabbitmq nodes configured as disc nodes, and they share a common config as such:

(partial config):

[
  {rabbit, [
     {cluster_nodes, ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit01</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit03</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit04</A>']},
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,&quot;/etc/rabbitmq/ca/cacert.pem&quot;},
                    {certfile,&quot;/etc/rabbitmq/servercert/cert.pem&quot;},
                    {keyfile,&quot;/etc/rabbitmq/servercert/key.pem&quot;},
                    {verify,verify_none},
                    {fail_if_no_peer_cert,false}]},
     {auth_backends, [rabbit_auth_backend_internal,rabbit_auth_backend_ldap]}
   ]},
  {rabbitmq_stomp, [{ssl_listeners, [6163]}]},

(at the moment, only rabbit01 and rabbit02 are online).  So if I list the queues under the /mcollective vhost, everything looks normal (on both nodes).

If I stop rabbit02, no problem, everything still works.

If I stop rabbit01, everything breaks.  rabbitmqctl list_queues -p /mcollective shows almost nothing - the main mcollective queue and almost every child just magically disappears.

As I said, I'm kind of new to this; what is going on here?  Is it because mcollective isn't creating the queues as 'mirrored' and rabbit01 is elected as the master?  or is something else going on?  If my assumption is correct, is there anything I can do about this?

Scott M. Stone, Sr. Systems Engineer | ServiceNow | Office 425-629-2803 | Mobile 408-857-2973 | www.service-now.com
Transform IT
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121101/fba5542c/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121101/fba5542c/attachment.htm</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023509.html">[rabbitmq-discuss] Will the rabbitmq-web-stomp work with 2.8.7?
</A></li>
	<LI>Next message: <A HREF="023519.html">[rabbitmq-discuss] newbie rabbitMQ clustering question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23510">[ date ]</a>
              <a href="thread.html#23510">[ thread ]</a>
              <a href="subject.html#23510">[ subject ]</a>
              <a href="author.html#23510">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
