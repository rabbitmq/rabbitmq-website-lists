<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] An issue in Pika 0.9.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20An%20issue%20in%20Pika%200.9.6&In-Reply-To=%3CCCBC3AA3.5BA9%25Michael.Laing%40nytimes.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023571.html">
   <LINK REL="Next"  HREF="023583.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] An issue in Pika 0.9.6</H1>
    <B>Laing, Michael P.</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20An%20issue%20in%20Pika%200.9.6&In-Reply-To=%3CCCBC3AA3.5BA9%25Michael.Laing%40nytimes.com%3E"
       TITLE="[rabbitmq-discuss] An issue in Pika 0.9.6">Michael.Laing at nytimes.com
       </A><BR>
    <I>Sun Nov  4 20:42:10 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023571.html">[rabbitmq-discuss] An issue in Pika 0.9.6
</A></li>
        <LI>Next message: <A HREF="023583.html">[rabbitmq-discuss] rabbitmqadmin and default node behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23573">[ date ]</a>
              <a href="thread.html#23573">[ thread ]</a>
              <a href="subject.html#23573">[ subject ]</a>
              <a href="author.html#23573">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This occurs when a synchronous command is made to a channel &#8211;  without specifying nowait=True &#8211; and the same command is subsequently submitted prior to the acknowledgment of the first by the server.

You can also specify the callback to wait for the processing of Exchange.DeclareOk as a way of handling this issue.

See <A HREF="https://github.com/pika/pika/issues/211">https://github.com/pika/pika/issues/211</A>

Michael

From: Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.s.klishin at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.s.klishin at gmail.com</A>&gt;&gt;
Reply-To: rabbitmq &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Date: Sun, 4 Nov 2012 14:03:48 -0500
To: rabbitmq &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Subject: [rabbitmq-discuss] An issue in Pika 0.9.6

I am working on an AMQP 0.9.1 client interoperability test suite and
have found what looks like an issue in Pika 0.9.6.

The issue is the following: when consuming messages and doing something else
on the same channel (e.g. declaring an exchange), as soon as exchange.declare_ok
or similar response method arrives, Pika raises an UnexpectedMethod exception.

A piece of code I have:
<A HREF="https://gist.github.com/2daa009ef55aac87e1ff">https://gist.github.com/2daa009ef55aac87e1ff</A>

Stack trace:
<A HREF="https://gist.github.com/93ad2a59b5345d0b1b7d">https://gist.github.com/93ad2a59b5345d0b1b7d</A>

I understand that it makes little sense without the publisher code, which I will put on GitHub
some time next week, but still demonstrates the problem. Adding nowait = True makes
the exception go away because RabbitMQ will not send exchange.declare_ok back.

Modifying the source to use a separate channel to perform exchange declaration in the
consumer like so:

<A HREF="https://gist.github.com/5175c24a4ee74465faff">https://gist.github.com/5175c24a4ee74465faff</A>

also makes the exception go away.
--
MK

<A HREF="http://github.com/michaelklishin">http://github.com/michaelklishin</A>
<A HREF="http://twitter.com/michaelklishin">http://twitter.com/michaelklishin</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121104/af79eea3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121104/af79eea3/attachment.htm</A>&gt;
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023571.html">[rabbitmq-discuss] An issue in Pika 0.9.6
</A></li>
	<LI>Next message: <A HREF="023583.html">[rabbitmq-discuss] rabbitmqadmin and default node behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23573">[ date ]</a>
              <a href="thread.html#23573">[ thread ]</a>
              <a href="subject.html#23573">[ subject ]</a>
              <a href="author.html#23573">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
