<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Recommended haproxy config
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recommended%20haproxy%20config&In-Reply-To=%3CCAAqmy6Myd5%2ByMVJ%3DBER9%2B-6BeW8Lyp%2BKb4PK6PQYqd183%2B1Sow%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023548.html">
   <LINK REL="Next"  HREF="023585.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Recommended haproxy config</H1>
    <B>Dave Curylo</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recommended%20haproxy%20config&In-Reply-To=%3CCAAqmy6Myd5%2ByMVJ%3DBER9%2B-6BeW8Lyp%2BKb4PK6PQYqd183%2B1Sow%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Recommended haproxy config">curylod at asme.org
       </A><BR>
    <I>Thu Nov  1 19:48:32 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023548.html">[rabbitmq-discuss] RabbitMQ .NET Client Bug - ModelBase.BasicCancel Always Throws An Exception
</A></li>
        <LI>Next message: <A HREF="023585.html">[rabbitmq-discuss] Recommended haproxy config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23549">[ date ]</a>
              <a href="thread.html#23549">[ thread ]</a>
              <a href="subject.html#23549">[ subject ]</a>
              <a href="author.html#23549">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am running an active-active RabbitMQ cluster, and as recommended by &quot;High
Availability in RabbitMQ: solving part of the puzzle&quot; (
<A HREF="http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/">http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/</A>),
I'm connecting to the cluster of message brokers via an haproxy load
balancer.  Everything was working fine until one of the nodes failed, after
which it seemed that the haproxy load balancer did not appear to detect the
failed node.  Clients would initiate connections and often just hang, I
assume because the load balancer is forwarding them on to the failed node.
 As a workaround, I've reconfigured clients to connect directly to a
working node, and everything returned to normal, so I am suspecting my
haproxy configuration is not correct.

Does anyone have experience using haproxy as a load balancer for RabbitMQ,
and if so, can you share your config or take a look at my configuration and
let me know if you have any recommendations?

haproxy.cfg:
global
        log 127.0.0.1   local0
        log 127.0.0.1   local1 notice
        maxconn 4096
        user haproxy
        group haproxy
        daemon

defaults
        log     global
        mode    http
        option  dontlognull
        retries 3
        option redispatch
        maxconn 2000
        contimeout      5000
        clitimeout      50000
        srvtimeout      50000

listen rabbitmq 0.0.0.0:5672
        mode tcp
        stats enable
        balance roundrobin
        option forwardfor
        option tcpka
        server rabbit01 1.2.3.4:5672 check inter 5000
        server rabbit02 1.2.3.5:5672 check inter 5000
        server rabbit03 1.2.3.6:5672 check inter 5000
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121101/407ada55/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121101/407ada55/attachment.htm</A>&gt;
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023548.html">[rabbitmq-discuss] RabbitMQ .NET Client Bug - ModelBase.BasicCancel Always Throws An Exception
</A></li>
	<LI>Next message: <A HREF="023585.html">[rabbitmq-discuss] Recommended haproxy config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23549">[ date ]</a>
              <a href="thread.html#23549">[ thread ]</a>
              <a href="subject.html#23549">[ subject ]</a>
              <a href="author.html#23549">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
