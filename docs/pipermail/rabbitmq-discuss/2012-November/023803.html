<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Almost all statistics drop to 0 every hour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Almost%20all%20statistics%20drop%20to%200%20every%20hour&In-Reply-To=%3CCAAcXTOaJgODih6MczES%2BguRr5HTr5yz6q6FzLXcLWXbY1L%3Dw0A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023619.html">
   <LINK REL="Next"  HREF="023805.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Almost all statistics drop to 0 every hour</H1>
    <B>Irmo Manie</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Almost%20all%20statistics%20drop%20to%200%20every%20hour&In-Reply-To=%3CCAAcXTOaJgODih6MczES%2BguRr5HTr5yz6q6FzLXcLWXbY1L%3Dw0A%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Almost all statistics drop to 0 every hour">irmo.manie at gmail.com
       </A><BR>
    <I>Tue Nov 13 10:35:15 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023619.html">[rabbitmq-discuss] Almost all statistics drop to 0 every hour
</A></li>
        <LI>Next message: <A HREF="023805.html">[rabbitmq-discuss] Almost all statistics drop to 0 every hour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23803">[ date ]</a>
              <a href="thread.html#23803">[ thread ]</a>
              <a href="subject.html#23803">[ subject ]</a>
              <a href="author.html#23803">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm still seeing this behavior and it seems to get worse.
Every hour there is a drop in delivery rate to 0 and now also the publish
rate drops to 0.
Sometimes even for a period of 5 minutes

I'm really sure that messaging continues and the statistics are a lie.
We use rabbitmq as our main communication hub and certainly a drop in
real-time market data going from ~500 msg/s to 0 for about 5 minutes must
be noticed somewhere if this is true.

I'm wondering if it might be the writing part of the statistics to the
database. Could that timeout?

I don't really want to restart to see if that fixes the problem.
It's been running for 177 days now and apart from the weird statistics we
don't have any problems.

Is there anything I could do as additional checks to figure out where the
problem might be?

- Irmo


On Tue, Nov 6, 2012 at 12:24 PM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 06/11/12 08:48, Irmo Manie wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> As you can see, the delivery (no-ack) rate drops to 0 every hour for a
</I>&gt;&gt;<i> couple of minutes. Other statistics on message processing indicate that
</I>&gt;&gt;<i> actual delivery/consuming is continuing, so it looks like it's really
</I>&gt;&gt;<i> only the statistics that are wrong.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If I look at the json output during such a 'downtime' I can see that the
</I>&gt;&gt;<i> publish rate is always available, but the rest of the rates
</I>&gt;&gt;<i> (acknowledge, delivery, etc) are mostly 0.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Just the rates in /api/overview or the ones in /api/queues as well?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  I understand a bit from the sources that in this /api/overview call from
</I>&gt;&gt;<i> the management api, these statistics are gathered from different places,
</I>&gt;&gt;<i> both memory and database (with additional calculations executed on them
</I>&gt;&gt;<i> while fetching), correct?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes. We get basic queue information from the Mnesia database, and then
</I>&gt;<i> augment it with statistics information (including rates) from the
</I>&gt;<i> (in-memory) management database.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Could it be that some of these values are 0 because of certain time-outs
</I>&gt;&gt;<i> while getting the data?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> No, the requests for stats don't time out.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  In other words: do I have to start searching for
</I>&gt;&gt;<i> the problem at the database disk/IO level?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> No.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  I couldn't see any IO waits on the machine indicating something else is
</I>&gt;&gt;<i> happening at the time. Also CPU load is normal.
</I>&gt;&gt;<i> Still the weird thing is that this also happens on a test machine at
</I>&gt;&gt;<i> roughly the same times.
</I>&gt;&gt;<i> Since both machines are VM's, this might indicate that it could be an
</I>&gt;&gt;<i> infrastructural problem, but I'd like to be sure before accusing 'others'.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If /api/overview and /api/queues contradict each other I'd like to know
</I>&gt;<i> about it.
</I>&gt;<i>
</I>&gt;<i> But if the rates drop to 0 in /api/queues as well, Occam's Razor suggests
</I>&gt;<i> that maybe your consumers are pausing for some reason :)
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121113/651b0953/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121113/651b0953/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023619.html">[rabbitmq-discuss] Almost all statistics drop to 0 every hour
</A></li>
	<LI>Next message: <A HREF="023805.html">[rabbitmq-discuss] Almost all statistics drop to 0 every hour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23803">[ date ]</a>
              <a href="thread.html#23803">[ thread ]</a>
              <a href="subject.html#23803">[ subject ]</a>
              <a href="author.html#23803">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
