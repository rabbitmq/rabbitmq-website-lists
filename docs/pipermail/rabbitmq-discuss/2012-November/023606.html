<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] newbie rabbitMQ clustering question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20newbie%20rabbitMQ%20clustering%20question&In-Reply-To=%3C0DA71B7504503342B547250DC47209D579A5E1%40SJC4EXDAG01-01.corp.service-now.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023554.html">
   <LINK REL="Next"  HREF="023616.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] newbie rabbitMQ clustering question</H1>
    <B>Scott Stone</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20newbie%20rabbitMQ%20clustering%20question&In-Reply-To=%3C0DA71B7504503342B547250DC47209D579A5E1%40SJC4EXDAG01-01.corp.service-now.com%3E"
       TITLE="[rabbitmq-discuss] newbie rabbitMQ clustering question">Scott.Stone at servicenow.com
       </A><BR>
    <I>Mon Nov  5 21:29:09 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023554.html">[rabbitmq-discuss] newbie rabbitMQ clustering question
</A></li>
        <LI>Next message: <A HREF="023616.html">[rabbitmq-discuss] newbie rabbitMQ clustering question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23606">[ date ]</a>
              <a href="thread.html#23606">[ thread ]</a>
              <a href="subject.html#23606">[ subject ]</a>
              <a href="author.html#23606">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>well fortunately none of this is in production use yet, so I can just blow away everything and start it over from scorched-earth.  After I modify the mcollective code.  Any ideas what parameters I would need to change in the connector to turn on the HA flags?  or is there an &quot;FM&quot; that I can go &quot;RT&quot; ? :)

Scott M. Stone, Sr. Systems Engineer | ServiceNow | Office 425-629-2803 | Mobile 408-857-2973 | www.service-now.com
Transform IT

From: Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">watson.timothy at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">watson.timothy at gmail.com</A>&gt;&gt;
Reply-To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Date: Fri, 2 Nov 2012 01:44:34 +0000
To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Cc: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] newbie rabbitMQ clustering question
Resent-From: &quot;scott.stone&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.stone at servicenow.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.stone at servicenow.com</A>&gt;&gt;

Hi

Sent from my iPhone.

On 1 Nov 2012, at 18:39, Scott Stone &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Scott.Stone at servicenow.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Scott.Stone at servicenow.com</A>&gt;&gt; wrote:

yes, sorry, clustered, with both nodes as disc nodes:

[rabbit01.sea1:/root]# rabbitmqctl cluster_status
Cluster status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit01</A> ...
[{nodes,[{disc,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A><A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">,rabbit at rabbit01</A>]}]},
 {running_nodes,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A><A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">,rabbit at rabbit01</A>]}]
...done.

[rabbit02.sea1:/root]# rabbitmqctl cluster_status
Cluster status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A> ...
[{nodes,[{disc,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A><A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">,rabbit at rabbit01</A>]}]},
 {running_nodes,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit01</A><A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">,rabbit at rabbit02</A>]}]
...done.

I think your question of &quot;are the queues declared as HA&quot; might be the key to this, though - from what I understand, the application itself (in this case, mcollective) would have to declare that at the time the queue is created, yes?

In the current version of rabbit, yes that's true. And if you declare an existing queue with different parameters, you'll get an error. For production, you'll needed to set up another queue to drain all the messages into, then delete the old queue and redeclare it is ha, then push the messages back in.

The forthcoming 3.0 release will fix this foible as you'll be able to change queues to ha via policy controls at runtime.

 I suppose I *can* modify mcollective to do this, but I was hoping I didn't have to.  Any pointers on how you would do that from, say, a ruby application? :)


Like I said above, make a temporary durable queue and drain all the 'to be ha' queue's messages into it (marking them as persistent and using publisher confirms to ensure they're written to disk) then delete and redeclare the other queue as ha before republishing the messages. Not sure hat impact this will have on your application/system logic though.

I appreciate everyone's help with this.  This same question has been asked a couple of times on the mcollective forums, to which  R.I.Pienaar replies simply, &quot;Use ActiveMQ,&quot; and that's not an option for me&#8230; so I thought I'd have more success asking the question here.

Scott M. Stone, Sr. Systems Engineer | ServiceNow | Office 425-629-2803 | Mobile 408-857-2973 | www.service-now.com&lt;<A HREF="http://www.service-now.com">http://www.service-now.com</A>&gt;
Transform IT

From: Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">watson.timothy at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">watson.timothy at gmail.com</A>&gt;&gt;
Reply-To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Date: Thu, 1 Nov 2012 10:00:25 +0000
To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Cc: &quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] newbie rabbitMQ clustering question
Resent-From: &quot;scott.stone&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.stone at servicenow.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.stone at servicenow.com</A>&gt;&gt;

Hi Scott,

Sent from my iPhone.

On 1 Nov 2012, at 01:57, Scott Stone &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Scott.Stone at servicenow.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Scott.Stone at servicenow.com</A>&gt;&gt; wrote:


If I stop rabbit02, no problem, everything still works.

If I stop rabbit01, everything breaks.  rabbitmqctl list_queues -p /mcollective shows almost nothing - the main mcollective queue and almost every child just magically disappears.

As I said, I'm kind of new to this; what is going on here?  Is it because mcollective isn't creating the queues as 'mirrored' and rabbit01 is elected as the master?  or is something else going on?  If my assumption is correct, is there anything I can do about this?

You haven't said what your setup is. Are the nodes clustered? Are the queues declared as HA?


Scott M. Stone, Sr. Systems Engineer | ServiceNow | Office 425-629-2803 | Mobile 408-857-2973 | www.service-now.com&lt;<A HREF="http://www.service-now.com">http://www.service-now.com</A>&gt;
Transform IT
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
_______________________________________________ rabbitmq-discuss mailing list <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
_______________________________________________ rabbitmq-discuss mailing list <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121105/5acc3e57/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121105/5acc3e57/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023554.html">[rabbitmq-discuss] newbie rabbitMQ clustering question
</A></li>
	<LI>Next message: <A HREF="023616.html">[rabbitmq-discuss] newbie rabbitMQ clustering question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23606">[ date ]</a>
              <a href="thread.html#23606">[ thread ]</a>
              <a href="subject.html#23606">[ subject ]</a>
              <a href="author.html#23606">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
