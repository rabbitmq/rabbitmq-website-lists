From michael.laing at nytimes.com  Thu Aug  1 01:59:25 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Wed, 31 Jul 2013 20:59:25 -0400
Subject: [rabbitmq-discuss] Message sending/receiving overhead.
In-Reply-To: <CAABB5w_ceCmrDyG+O6a0APebCN+TEumUqicjLonB410apWkEqQ@mail.gmail.com>
References: <CAABB5w_ceCmrDyG+O6a0APebCN+TEumUqicjLonB410apWkEqQ@mail.gmail.com>
Message-ID: <CAKgmDnF6cVFDYFK9Sf4T9q7V5voM_BwpV2GcMY6mnHvawJOxag@mail.gmail.com>

Hi Pavel,

Have you experimented with prefetch?

Which client are you using and which versions of rabbitmq and erlang.
Message size is important too, of course.

We use the python pika client in asynch mode and have consistent processing
times (fetch/process/publish) under 5ms.

In general, we have found event loop based approaches faster than threads,
esp. on the small (cheap) machines we use in the cloud.

Best regards,

Michael


On Wed, Jul 31, 2013 at 6:16 PM, Pavel Kogan <pavel.kogan at cortica.com>wrote:

> Hi all,
>
> I have simple subscriber that receives message, process it in single
> thread and publish response.
> Processing must be done in single thread (logic limitations) but is very
> fast (~5ms) so I expect to be able to process 200 requests per second.
> However publishing response in line with processing slows the things as
> network latency is considerable (even though it is internal 1Gbit network).
> To resolve it I moved responses publishing to separate threads (via
> internal concurrent queue) and it helped.
> The question is about receiving overhead. Is there any pre-caching of
> messages or I should also integrate internal concurrent queue for requests
> too?
>
> Many Thanks,
>    Pavel
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130731/c65d3068/attachment.htm>

From matthias at rabbitmq.com  Thu Aug  1 03:21:25 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 01 Aug 2013 03:21:25 +0100
Subject: [rabbitmq-discuss] Message sending/receiving overhead.
In-Reply-To: <CAABB5w_ceCmrDyG+O6a0APebCN+TEumUqicjLonB410apWkEqQ@mail.gmail.com>
References: <CAABB5w_ceCmrDyG+O6a0APebCN+TEumUqicjLonB410apWkEqQ@mail.gmail.com>
Message-ID: <51F9C625.8080303@rabbitmq.com>

Pavel,

On 31/07/13 23:16, Pavel Kogan wrote:
> However publishing response in line with processing slows the things as
> network latency is considerable (even though it is internal 1Gbit
> network).

Publishing is an asynchronous operation and therefore should not be 
affected by latency.

> The question is about receiving overhead. Is there any pre-caching of
> messages [...]?

By default there is an infinite prefetch, i.e. the broker will send 
messages to the client as fast as network speed & server processing 
permits. The number of messages "in flight" that way, more precisely, 
the number of messages that have been sent to the client but not yet 
acknowledged, can be bounded with the basic.qos prefetch setting. See 
the section of "Fair dispatch" in Tutorial #2 
(http://www.rabbitmq.com/tutorials/tutorial-two-python.html).

Matthias.

From joshua__lim at hotmail.com  Thu Aug  1 05:17:12 2013
From: joshua__lim at hotmail.com (joshua__lim)
Date: Wed, 31 Jul 2013 21:17:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Authenticated push message service using
	RabbitMQ Web STOMP plugin?
Message-ID: <1375330632068-28530.post@n5.nabble.com>

I'm trying to study the feasibility of using RabbitMQ + Web STOMP plugin to
create a peer to peer push message service for up to 10,000 connected
JavaScript clients with the following features:

- Authenticated Peer to peer
- Delivery/Read Confirmation
- Persistent

XMPP has features that can meet my requirement, so I tested BOSH (XMPP) +
Strophe JS client using Prosody and Openfire, but encountered a limitation
on the number of connected clients.  The Erlang based Ejabberd is suppose to
scale better but I'm a novice when it comes to Linux.

If I were to use RabbitMQ, I'll need to figure out:

1. Whether the Web STOMP plugin can handle 10,000 concurrent connections.

2. Whether it is feasible to create 20,000 queues (2 queues for each
client).  I've tried Exchanges but they are not persistent from my tests.

3. How to authenticate each JavaScript client and to ensure message
confidentiality so that clients can only bind to queues that they have the
rights.

I've seen several others discussion in this issue and it appears that this
might be a bit tricky since queues are not password protected.  Is it
possible to make a queue exclusive to a user? I read somewhere that there is
some differences between queues and exchanges with respect to user right.

If there are no other methods, I thought I could create a randomly generated
queue id that is unique to that client and a lookup table on the server end
to match queueid with username.  But one problem with this method that I can
think of is a rogue client can generate tens of thousands of queues and
cause the server to crash.

4. Detect online presence for clients - similar to XMPP.

5. Whether it is possible to capture ack confirmations sent by the receiving
client.  Or do I need to create and send a delivery receipt confirmation
message back to the sender client?

I would greatly appreciate any thoughts and references that is related to
what I'm trying to do.  Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Authenticated-push-message-service-using-RabbitMQ-Web-STOMP-plugin-tp28530.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From whitefes at gmail.com  Thu Aug  1 10:26:30 2013
From: whitefes at gmail.com (Cheolseung Baek)
Date: Thu, 1 Aug 2013 02:26:30 -0700 (PDT)
Subject: [rabbitmq-discuss] connection timeout error in
 ConnectionFactory.newConnection (java)
In-Reply-To: <82b9ea44-52e2-4fc9-9907-55023f576c77@googlegroups.com>
References: <82b9ea44-52e2-4fc9-9907-55023f576c77@googlegroups.com>
Message-ID: <050b6bdf-d766-4855-8923-649768d6d2b9@googlegroups.com>

attach the .sasl full log

thanx

=SUPERVISOR REPORT==== 8-Jul-2013::23:36:06 ===

     Supervisor: {<0.11607.30>,

                                           rabbit_channel_sup_sup}

     Context:    shutdown_error

     Reason:     noproc

     Offender:   [{pid,<0.11608.30>},

                  {name,channel_sup},

                  {mfa,{rabbit_channel_sup,start_link,[]}},

                  {restart_type,temporary},

                  {shutdown,infinity},

                  {child_type,supervisor}]

2013? 7? 31? ??? ?? 11? 22? 0? UTC+9, Cheolseung Baek ?? ?:
>
> ConnectionFactory.newConnection return connection timeout exception
>
> The following shall be attached to the exception message.
>
> java.io.IOException
>
>            at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
>
>            at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
>
>            at 
> com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
>
>            at 
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
>
>            at 
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:488)
>
>            ,,,,,,,,,,,,,,
>
>            at java.lang.Thread.run(Thread.java:679)
>
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; 
> reason: java.net.SocketTimeoutException: Timeout during Connection 
> negotiation
>
>            at 
> com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
>
>            at 
> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
>
>            at 
> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
>
>            at 
> com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
>
>            ... 7 more
>
> Caused by: java.net.SocketTimeoutException: Timeout during Connection 
> negotiation
>
>            at 
> com.rabbitmq.client.impl.AMQConnection.handleSocketTimeout(AMQConnection.java:566)
>
>            at 
> com.rabbitmq.client.impl.AMQConnection.access$500(AMQConnection.java:59)
>
>            at 
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:541)
>
> java.lang.NullPointerException
>
>            ..........................
>
>            at java.lang.Thread.run(Thread.java:679)
>
>
> also attach sasl log 
>
> =SUPERVISOR REPORT==== Reason: noproc
>
> What is the reason of the problem
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/345912c8/attachment.htm>

From emile at rabbitmq.com  Thu Aug  1 10:46:37 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 01 Aug 2013 10:46:37 +0100
Subject: [rabbitmq-discuss] Duplicated message and unknown delivery tag
 after ack
In-Reply-To: <ae768eb4-3b32-4e9e-b6b2-37c6a723ef23@googlegroups.com>
References: <ae768eb4-3b32-4e9e-b6b2-37c6a723ef23@googlegroups.com>
Message-ID: <51FA2E7D.4090209@rabbitmq.com>


Hi Lukasz,

On 31/07/13 17:30, Lukasz Olczak wrote:
> com.rabbitmq.client.ShutdownSignalException: channel error; reason:
> {#method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED -
> unknown delivery tag 1, class-id=60, method-id=80), null, ""}


There are legitimate ways in which multiple consumers could get hold of
the same message, in the same second. If any consumer rejects a message
or reconnects then unacknowledged messages will be returned to the
broker and may be delivered to other consumers. Such messages will have
the redelivered flag set.

The error you quote could also arise if an application acknowledges
messages incorrectly. Make sure that messages are only acknowledged once.


> Anybody knows why RabbitMQ duplicates messages on a single broker with a
> publisher and consumers connected through loopback interface?



This is unlikely to have anything to do with the loopback interface
directly. Though loopback offers greater speed which may expose race
conditions.

If you believe there is a broker error then please run your test via the
Tracer protocol analyser and send us the generated trace file:
http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html





-Emile

From david.tinker at gmail.com  Thu Aug  1 11:44:45 2013
From: david.tinker at gmail.com (David Tinker)
Date: Thu, 1 Aug 2013 12:44:45 +0200
Subject: [rabbitmq-discuss] ANN New project QDB: Persistent Message Queues
	With Replay
Message-ID: <CA+O6_FcN1ne8LY1BZLi==n6ueNbJ4B7oG7D3c07EN3m8KHVdTA@mail.gmail.com>

QDB provides persistent message queues with the ability to efficiently
replay old messages by timestamp or id. It can push messages from its
queues directly to RabbitMQ and has simple REST interface.

http://qdb.io/

QDB is much more efficient than stuffing messages into a database
(MongoDB, MySQL etc.) before sending them to RabbitMQ for processing.

Cheers
David

From tom.anderson at timgroup.com  Thu Aug  1 13:00:37 2013
From: tom.anderson at timgroup.com (Tom Anderson)
Date: Thu, 1 Aug 2013 13:00:37 +0100
Subject: [rabbitmq-discuss] ANN New project QDB: Persistent Message
 Queues With Replay
In-Reply-To: <CA+O6_FcN1ne8LY1BZLi==n6ueNbJ4B7oG7D3c07EN3m8KHVdTA@mail.gmail.com>
References: <CA+O6_FcN1ne8LY1BZLi==n6ueNbJ4B7oG7D3c07EN3m8KHVdTA@mail.gmail.com>
Message-ID: <51FA4DE5.1090501@timgroup.com>

On 01/08/13 11:44, David Tinker wrote:
> QDB provides persistent message queues with the ability to efficiently
> replay old messages by timestamp or id. It can push messages from its
> queues directly to RabbitMQ and has simple REST interface.
>
> http://qdb.io/

Interesting. Thanks!

Can you feed it from RabbitMQ too? If not, any plans to make that 
possible? A replayable recent history of certain queues could be 
insanely useful for us. If not, it looks like it wouldn't be that hard 
for us to add if we wanted it.

A few minor remarks:

- "QDB depends on two libraries that are not yet on Maven central ... 
These need to be built and installed in your local Maven repository 
before building QDB." - have you considered putting artifacts for these 
up in a non-Central repository? I do that via a repo hosted on my 
Bitbucket site - see https://bitbucket.org/twic/twic.bitbucket.org/src 
and https://bitbucket.org/twic/twic.bitbucket.org/src/default/release.sh 
for the script that updates it - and find it fairly easy. I think this 
is even easier on GitHub.

- Building and installing locally is rendered less than entirely smooth 
by (a) the fact that both projects use the signing plugin, which means i 
would have to set up GPG etc just to install locally (i commented out 
the signing declarations instead), (b) qdb-kvstore refers to a repo with 
url "/Users/david/.m2/repository", (c) qdb-kvstore depends on version 
0.4.0-SNAPSHOT of qdb-buffer, but if you check out and build qdb-buffer, 
you make version 0.4.1-SNAPSHOT.

- The qdb-server build at revision c5c7ac3b7a11 has one failing test, 
because this:

     def "Format timestamp works"() {
         Date d = new 
SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ").parse("2013-06-16T21:04:32.123+0200")
         String s = DateTimeParser.INSTANCE.formatTimestamp(d)

         expect:
         s == "2013-06-16T21:04:32.123+0200"
     }

Won't pass if you don't live in South Africa, or somewhere else with a 
+0200 timezone.

And some handwaving:

- If you ever fancy using a different storage engine, you might be 
interested in http://www.mapdb.org/ . Not sure if it has the event 
notification, though, nor if its performance characteristics are really 
what you need.

- For qdb-buffer, it might be helpful to write a comparison between what 
seems like your main use case (buffering messages heading towards 
RabbitMQ to protect against RabbitMQ doing down) and running a local 
RabbitMQ on every box as a first hop.

tom

-- 

Tom Anderson | Developer | +44 20 7826 4312 | timgroup.com 
<http://timgroup.com/>

STATEMENT OF CONFIDENTIALITY: The information contained in this 
electronic message and any attachments to this message are intended for 
the exclusive use of the addressee(s) and may contain confidential or 
privileged information. If you are not the intended recipient, please 
notify Tom Anderson at TIM Group at tom.anderson at timgroup.com and 
destroy all copies of this message and any attachments.

TIM Group is the trading name for YouDevise Limited. YouDevise Limited 
is registered in England, No. 3331176. Registered office: 3 Copthall 
Avenue, London, EC2R 7BH.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/0d40e7f7/attachment.htm>

From gsim at redhat.com  Thu Aug  1 13:24:47 2013
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 01 Aug 2013 13:24:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ and AMQP 0-10?
In-Reply-To: <51F92DE8.30908@rabbitmq.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D36B737@FR44EX3005.global.ds.honeywell.com>
	<51F92DE8.30908@rabbitmq.com>
Message-ID: <51FA538F.8000306@redhat.com>

On 07/31/2013 04:31 PM, Simon MacMullen wrote:
> On 31/07/13 16:06, Gotthard, Petr wrote:
>> Could you please clarify a bit what is so different in AMQP 0-10 so that
>> ?RabbitMQ is unlikely ever to support AMQP 0-10? as said  here:
>> https://www.rabbitmq.com/specification.html?
>
> Pretty much everything is different.
>
> You should probably download and read the AMQP 0-10 spec from
> http://www.amqp.org/specification/0-10/amqp-org-download to get a good
> handle on that question.
>
> But AMQP 0-9-1, 0-10 and 1.0 really are all quite different from each
> other. They all have different codecs, different commands sets, and
> different semantics.
>
> The AMQP 1.0 implementation in RabbitMQ shares essentially no code in
> common with the 0-9-1 implementation. Any putative support for 0-10
> would be another from-scratch implementation - and we don't really see
> there being enough demand for it.

I agree. With increasing support for 1.0, going back to add 0-10 support 
doesn't make much sense. For interoperability with AMQP, 1.0 is where it 
will happen.

Most clients that support 0-10 now also support 1.0 through the same 
API, so switching may be possible. You can also do bridging between 0-10 
and 1.0 using e.g. qpidd. I have had success with (admittedly quite 
simple) tests between qpid::messaging, qpidd and RabbitMQ over 1.0.

From david.tinker at gmail.com  Thu Aug  1 13:32:42 2013
From: david.tinker at gmail.com (David Tinker)
Date: Thu, 1 Aug 2013 14:32:42 +0200
Subject: [rabbitmq-discuss] ANN New project QDB: Persistent Message
 Queues With Replay
In-Reply-To: <51FA4DE5.1090501@timgroup.com>
References: <CA+O6_FcN1ne8LY1BZLi==n6ueNbJ4B7oG7D3c07EN3m8KHVdTA@mail.gmail.com>
	<51FA4DE5.1090501@timgroup.com>
Message-ID: <CA+O6_FfRk3A3oahB_+uq2ohsaR_AkVQWQSjDdVrZLz9usueyTQ@mail.gmail.com>

Thanks for all the comments and testing. I will fix the build scripts
for qdb-buffer and qdb-kvstore and sort out the Maven stuff and the
failing test.

Yes I definitely do plan to add support for pulling messages from
RabbitMQ queues as well. We need that here at work.

As for the QDB vs local RabbitMQ use-case thats a good idea.



On Thu, Aug 1, 2013 at 2:00 PM, Tom Anderson <tom.anderson at timgroup.com> wrote:
> On 01/08/13 11:44, David Tinker wrote:
>
> QDB provides persistent message queues with the ability to efficiently
> replay old messages by timestamp or id. It can push messages from its
> queues directly to RabbitMQ and has simple REST interface.
>
> http://qdb.io/
>
>
> Interesting. Thanks!
>
> Can you feed it from RabbitMQ too? If not, any plans to make that possible?
> A replayable recent history of certain queues could be insanely useful for
> us. If not, it looks like it wouldn't be that hard for us to add if we
> wanted it.
>
> A few minor remarks:
>
> - "QDB depends on two libraries that are not yet on Maven central ... These
> need to be built and installed in your local Maven repository before
> building QDB." - have you considered putting artifacts for these up in a
> non-Central repository? I do that via a repo hosted on my Bitbucket site -
> see https://bitbucket.org/twic/twic.bitbucket.org/src and
> https://bitbucket.org/twic/twic.bitbucket.org/src/default/release.sh for the
> script that updates it - and find it fairly easy. I think this is even
> easier on GitHub.
>
> - Building and installing locally is rendered less than entirely smooth by
> (a) the fact that both projects use the signing plugin, which means i would
> have to set up GPG etc just to install locally (i commented out the signing
> declarations instead), (b) qdb-kvstore refers to a repo with url
> "/Users/david/.m2/repository", (c) qdb-kvstore depends on version
> 0.4.0-SNAPSHOT of qdb-buffer, but if you check out and build qdb-buffer, you
> make version 0.4.1-SNAPSHOT.
>
> - The qdb-server build at revision c5c7ac3b7a11 has one failing test,
> because this:
>
>     def "Format timestamp works"() {
>         Date d = new
> SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ").parse("2013-06-16T21:04:32.123+0200")
>         String s = DateTimeParser.INSTANCE.formatTimestamp(d)
>
>         expect:
>         s == "2013-06-16T21:04:32.123+0200"
>     }
>
> Won't pass if you don't live in South Africa, or somewhere else with a +0200
> timezone.
>
> And some handwaving:
>
> - If you ever fancy using a different storage engine, you might be
> interested in http://www.mapdb.org/ . Not sure if it has the event
> notification, though, nor if its performance characteristics are really what
> you need.
>
> - For qdb-buffer, it might be helpful to write a comparison between what
> seems like your main use case (buffering messages heading towards RabbitMQ
> to protect against RabbitMQ doing down) and running a local RabbitMQ on
> every box as a first hop.
>
> tom
>
> --
>
> Tom Anderson | Developer | +44 20 7826 4312 | timgroup.com
>
> STATEMENT OF CONFIDENTIALITY: The information contained in this electronic
> message and any attachments to this message are intended for the exclusive
> use of the addressee(s) and may contain confidential or privileged
> information. If you are not the intended recipient, please notify Tom
> Anderson at TIM Group at tom.anderson at timgroup.com and destroy all copies of
> this message and any attachments.
>
> TIM Group is the trading name for YouDevise Limited. YouDevise Limited is
> registered in England, No. 3331176. Registered office: 3 Copthall Avenue,
> London, EC2R 7BH.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
http://twoogleplus.com/ Online service to cross-post tweets to Google+
http://engage.calibreapps.com/ Engage - Web based goal setting and
performance management

From lrodriguez1995 at yahoo.com  Thu Aug  1 14:59:47 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Thu, 1 Aug 2013 06:59:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Ubuntu 12.04 Rabbitmq-server hangs after being
	stopped or restarted
Message-ID: <1375365587.74921.YahooMailNeo@web141104.mail.bf1.yahoo.com>

Hi all,

running Ubuntu 12.04 on 3 clustered VM's (Erlang R16B01)
I can't seem to know why rabbitmq-server hangs after either stopping the server or restarting it..
./rabbitmq-server start ----- Rabbitmq-server is currently running
./rabbitmq-server stop ------ hangs
./rabbitmq-server restart ---- hangs

the management console shows the cluster with all the nodes up and there is nothing on the server log or the broker about why it hangs
any ideas on what to do?

thanks


Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/5d2f1892/attachment.htm>

From timrobertson100 at gmail.com  Thu Aug  1 15:54:44 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Thu, 1 Aug 2013 16:54:44 +0200
Subject: [rabbitmq-discuss] Java client - 91% time spent in reading the
	socket?
Message-ID: <CAMsy_NipEYnhhEG2DmamrDd+xxfnB+YdyjvYH+4a_pvf1afECw@mail.gmail.com>

Hi all,

I am trying to optimize our processes, and I attached a profiler to the
Java client reading from Rabbit.
I am seeing the profiler report 91% of the time spent reading the socket,
which I find somewhat surprising (the consumer is doing quite some
computation and then writing to HBase so I was expecting my own part to be
the slowest).

Our messages are JSON encoded and I have a sample message [1] which is
about 3kb when saved as a text file.

The profile thread timing is showing the following:
com.rabbitmq.client.impl.AMQConnection$MainLoop.run()
 - com.rabbitmq.client.impl.SocketFrameHandler.readFrame()
  - com.rabbitmq.client.impl.Frame.readFrom(DataInputStream) 167394
   -  java.io.DataInputStream.readUnsignedByte() 166968
    -   java.io.BufferedInputStream.read() 166968
     -    java.io.BufferedInputStream.fill() 166968
      -     java.net.SocketInputStream.read(byte[], int, int) 166968
       -      [Wall Time]
 java.net.SocketInputStream.socketRead0(FileDescriptor, byte[], int, int,
int)         91%

I'm seeing only around 400 messages per second (lots of resources - 24
cores, 40GB memory, fast network) and using v3.0.4.  We're using easyrabbit
libraries, but basically it boils down to a channel.basicConsume(...) with
explicit acking.

Does this look suspicious to anyone?  Can anyone shed any light on how one
might improve this?

Thanks for any insights,
Tim
- a rabbit newbie


[1]
https://dl.dropboxusercontent.com/u/608155/transient/sampleRabbitMessage.json
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/bb088cb4/attachment.htm>

From mklishin at gopivotal.com  Thu Aug  1 16:02:14 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 19:02:14 +0400
Subject: [rabbitmq-discuss] Java client - 91% time spent in reading the
	socket?
In-Reply-To: <CAMsy_NipEYnhhEG2DmamrDd+xxfnB+YdyjvYH+4a_pvf1afECw@mail.gmail.com>
References: <CAMsy_NipEYnhhEG2DmamrDd+xxfnB+YdyjvYH+4a_pvf1afECw@mail.gmail.com>
Message-ID: <4A63C288-065B-4610-AF24-A897690C39D9@gopivotal.com>

Tim Robertson:

> Does this look suspicious to anyone?  Can anyone shed any light on how one might improve this?

Java client uses a separate thread for network activity (called "main loop"), one per connection.

So in that thread, 100% of time is spent reading from the socket. When a delivery arrives,
it is dispatched to a work pool (every channel has its own, AFAIR).

If you profile all methods, it's certainly very likely that com.rabbitmq.client.impl.AMQConnection$MainLoop.run will be at the top of
the overall table.

You can try excluding certain classes/methods/threads from the profiler. That will
give you a more informative insight.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/e131ca4d/attachment.pgp>

From emile at rabbitmq.com  Thu Aug  1 16:18:09 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 01 Aug 2013 16:18:09 +0100
Subject: [rabbitmq-discuss] Ubuntu 12.04 Rabbitmq-server hangs after
 being stopped or restarted
In-Reply-To: <1375365587.74921.YahooMailNeo@web141104.mail.bf1.yahoo.com>
References: <1375365587.74921.YahooMailNeo@web141104.mail.bf1.yahoo.com>
Message-ID: <51FA7C31.2020106@rabbitmq.com>


Hi,


On 01/08/13 14:59, Luis Rodriguez wrote:
> running Ubuntu 12.04 on 3 clustered VM's (Erlang R16B01)
> I can't seem to know why rabbitmq-server hangs after either stopping the
> server or restarting it..
> ./rabbitmq-server start ----- Rabbitmq-server is currently running
> ./rabbitmq-server stop ------ hangs
> ./rabbitmq-server restart ---- hangs
> 
> the management console shows the cluster with all the nodes up and there
> is nothing on the server log or the broker



Depending on which version you are running the root cause may be masked
by this bug:
https://bugs.launchpad.net/ubuntu/+source/rabbitmq-server/+bug/1053424/
Don't use rabbitmq-server-2.7.1-0ubuntu4, if indeed that is the case.

If you are not using that version then can you please describe in more
detail what you mean by "hang". How long have you waited? What is the
CPU usage like? Does the same happen on an unclustered node?



-Emile







From simon at rabbitmq.com  Thu Aug  1 16:34:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Aug 2013 16:34:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ Clustering with Federation
In-Reply-To: <7db0a8da-c006-49c1-82ff-143c595395bf@googlegroups.com>
References: <7db0a8da-c006-49c1-82ff-143c595395bf@googlegroups.com>
Message-ID: <51FA7FEC.3040100@rabbitmq.com>

On 31/07/2013 5:35PM, Robert Parker wrote:
> I'm having some trouble getting the right architecture configured to
> support rabbitmq federation in a clustered high availability
> environment.  Our basic setup is four clusters of two nodes each which
> are separated by a WAN.
>
> "home" is the "home" cluster and "remote1", "remote2" and "remote3" are
> remote clusters.  There are a lot of queues being created and published
> to via the API identically on all clusters but I only want to federate
> ONE of the queues, which is called "EventListener" back to the "home"
> cluster from all the "remote" clusters.  I want messages published to
> this queue on each remote cluster to be federated to the home cluster to
> be consumed by a separate event listener service that only lives at the
> "home" site.

Just to be clear: you are aware that (currently) it's only *exchanges* 
which can be federated, not queues?

> Each cluster is configured with:

<snip>

> We have configured three hardware load balancer VIPs that load balance
> connections on port 5672 between both nodes in each cluster, and have
> configured federation upstreams to use these and also configured our
> application to use these VIPs for queue/exchange creation and for
> publishing messages.  Here's our federation config script thats run on
> node1 of the home cluster only:

<snip>

> However I am noticing that the "rabbitmqctl eval
> 'rabbit_federation_status:status()." command only shows federation
> config on node2 of the home cluster despite having been configured on node1:

Federation works by establishing link(s) from the downstream to the 
upstream(s). You can define the upstreams on any node in the downstream 
cluster (the configuration is cluster-wide) and the cluster will 
arbitrarily start the link processes on any node (and will migrate them 
around the cluster if nodes go down).

*However*, rabbit_federation_status:status() will only report links that 
are running on the local node. This is probably not well documented. 
Hmm. Let's fix that.

(The HTTP API exported by rabbitmq_federation_management will report 
links on all nodes.)

<snip>

> And I'm noticing that messages published to the queues via the load
> balancer VIPs to the remote clusters are not showing up in the
> "EventListener" queue of the home cluster.

Note that you have federated an exchange called "EventListener", not a 
queue. So if you bind a queue to the exchange "EventListener" on home, 
and publish to the exchange "EventListener" on remote1/2/3 then you 
should see messages turning up in the queue on home. Is that what you're 
doing?

> Is this not the right way to set this up?

It sounds like you're basically right, apart from the exchange vs queue 
thing.

> Is it possible to configure
> this without using an external load balancer and still achieve high
> availability?

Since 3.1.0, yes. You can specify multiple URIs in a single upstream, 
and federation will connect to a randomly chosen one (and keep retrying 
different ones if that one goes down). Use something like:

rabbitmqctl set_parameter federation-upstream remote1-upstream 
'{"uri":["amqp://remote1-node1","amqp://remote1-node2"],"expires":3600000}'

> If I federate to a single node of a cluster directly,
> what happens if that node goes down?

If you only specify one URI, it will keep retrying until that node comes 
back up.

> Do I have to configure redundant
> federation between every node of home cluster to every node of each
> remote cluster?

No - since the config is shared across the cluster. So you can set up 
the upstreams on one node of the home cluster, pointing to all nodes of 
the remote clusters.

> If I don't use a load balancer VIP to publish to from my
> application, if the single node of the cluster I've configured goes
> down, it wont help me that the other node is still available.

Not sure what you mean here. Hopefully I've explained enough now.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Aug  1 16:55:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Aug 2013 16:55:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ Clustering with Federation
In-Reply-To: <CAA5SsRHHSj2uQS+LXbmFyHwivJHmuN_1adyjakn9DVNoFZ8VMw@mail.gmail.com>
References: <7db0a8da-c006-49c1-82ff-143c595395bf@googlegroups.com>
	<51FA7FEC.3040100@rabbitmq.com>
	<CAA5SsRHHSj2uQS+LXbmFyHwivJHmuN_1adyjakn9DVNoFZ8VMw@mail.gmail.com>
Message-ID: <51FA84E1.4000408@rabbitmq.com>

No, at the moment that's only for federation. This may change in future.

Cheers, Simon

On 01/08/2013 4:53PM, Robert Parker wrote:
> Ah, so is there a way to alleviate the need for both the publisher (in
> our case, mass transit) or the consumer (a .net reporting app) to use
> load balancer VIP for client connections to any cluster using a compound
> connection string via the .NET API?  That is, is it possible to use
> something similar to
>   '{"uri":["amqp://remote1-__node1","amqp://remote1-node2"]}' on the
> client side for either publishing or consuming such that we don't need
> an external load balancer at all to achieve high availability for BOTH
> client connections and federation connections?
>
>
> Thanks,
> Robert
>
>
> On Thu, Aug 1, 2013 at 10:34 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 31/07/2013 5:35PM, Robert Parker wrote:
>
>         I'm having some trouble getting the right architecture configured to
>         support rabbitmq federation in a clustered high availability
>         environment.  Our basic setup is four clusters of two nodes each
>         which
>         are separated by a WAN.
>
>         "home" is the "home" cluster and "remote1", "remote2" and
>         "remote3" are
>         remote clusters.  There are a lot of queues being created and
>         published
>         to via the API identically on all clusters but I only want to
>         federate
>         ONE of the queues, which is called "EventListener" back to the
>         "home"
>         cluster from all the "remote" clusters.  I want messages
>         published to
>         this queue on each remote cluster to be federated to the home
>         cluster to
>         be consumed by a separate event listener service that only lives
>         at the
>         "home" site.
>
>
>     Just to be clear: you are aware that (currently) it's only
>     *exchanges* which can be federated, not queues?
>
>         Each cluster is configured with:
>
>
>     <snip>
>
>         We have configured three hardware load balancer VIPs that load
>         balance
>         connections on port 5672 between both nodes in each cluster, and
>         have
>         configured federation upstreams to use these and also configured our
>         application to use these VIPs for queue/exchange creation and for
>         publishing messages.  Here's our federation config script thats
>         run on
>         node1 of the home cluster only:
>
>
>     <snip>
>
>         However I am noticing that the "rabbitmqctl eval
>         'rabbit_federation_status:__status()." command only shows federation
>         config on node2 of the home cluster despite having been
>         configured on node1:
>
>
>     Federation works by establishing link(s) from the downstream to the
>     upstream(s). You can define the upstreams on any node in the
>     downstream cluster (the configuration is cluster-wide) and the
>     cluster will arbitrarily start the link processes on any node (and
>     will migrate them around the cluster if nodes go down).
>
>     *However*, rabbit_federation_status:__status() will only report
>     links that are running on the local node. This is probably not well
>     documented. Hmm. Let's fix that.
>
>     (The HTTP API exported by rabbitmq_federation_management will report
>     links on all nodes.)
>
>     <snip>
>
>         And I'm noticing that messages published to the queues via the load
>         balancer VIPs to the remote clusters are not showing up in the
>         "EventListener" queue of the home cluster.
>
>
>     Note that you have federated an exchange called "EventListener", not
>     a queue. So if you bind a queue to the exchange "EventListener" on
>     home, and publish to the exchange "EventListener" on remote1/2/3
>     then you should see messages turning up in the queue on home. Is
>     that what you're doing?
>
>         Is this not the right way to set this up?
>
>
>     It sounds like you're basically right, apart from the exchange vs
>     queue thing.
>
>         Is it possible to configure
>         this without using an external load balancer and still achieve high
>         availability?
>
>
>     Since 3.1.0, yes. You can specify multiple URIs in a single
>     upstream, and federation will connect to a randomly chosen one (and
>     keep retrying different ones if that one goes down). Use something like:
>
>     rabbitmqctl set_parameter federation-upstream remote1-upstream
>     '{"uri":["amqp://remote1-__node1","amqp://remote1-node2"]__,"expires":3600000}'
>
>         If I federate to a single node of a cluster directly,
>         what happens if that node goes down?
>
>
>     If you only specify one URI, it will keep retrying until that node
>     comes back up.
>
>         Do I have to configure redundant
>         federation between every node of home cluster to every node of each
>         remote cluster?
>
>
>     No - since the config is shared across the cluster. So you can set
>     up the upstreams on one node of the home cluster, pointing to all
>     nodes of the remote clusters.
>
>         If I don't use a load balancer VIP to publish to from my
>         application, if the single node of the cluster I've configured goes
>         down, it wont help me that the other node is still available.
>
>
>     Not sure what you mean here. Hopefully I've explained enough now.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Aug  1 17:23:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Aug 2013 17:23:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ Clustering with Federation
In-Reply-To: <CAA5SsRG83vrfCN5t-43TYABp+JzmSOgkCxV8NHOpUfL4dw4fGg@mail.gmail.com>
References: <7db0a8da-c006-49c1-82ff-143c595395bf@googlegroups.com>
	<51FA7FEC.3040100@rabbitmq.com>
	<CAA5SsRHHSj2uQS+LXbmFyHwivJHmuN_1adyjakn9DVNoFZ8VMw@mail.gmail.com>
	<51FA84E1.4000408@rabbitmq.com>
	<CAA5SsRG83vrfCN5t-43TYABp+JzmSOgkCxV8NHOpUfL4dw4fGg@mail.gmail.com>
Message-ID: <51FA8B8F.4090201@rabbitmq.com>

That looks correct to me. But note that support for multiple URIs was 
only added in 3.1.0 - which version are you running?

Cheers, Simon

On 01/08/2013 5:15PM, Robert Parker wrote:
> Thanks.
>
> Can you confirm the exact syntax of that compound federation upstream
> config?  I'm getting:
>
> rabbitmqctl set_parameter federation-upstream remote1-upstream
> '{"uri":["amqp://remote1-node1","amqp://remote1-node2"],"expires":3600000}'
>
> Setting runtime parameter "remote1-upstream" for component
> "federation-upstream" to
> "{\"uri\":[\"amqp://remote1-node1\",\"amqp://remote1-node2\"],\"expires\":3600000}"
> ...
> Error: Validation failed
>
> uri should be binary, actually was [<<"amqp://remote1-node1">>,
>                                      <<"amqp://remote1-node2">>]
>
>
>
> On Thu, Aug 1, 2013 at 10:55 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     No, at the moment that's only for federation. This may change in future.
>
>     Cheers, Simon
>
>
>     On 01/08/2013 4:53PM, Robert Parker wrote:
>
>         Ah, so is there a way to alleviate the need for both the
>         publisher (in
>         our case, mass transit) or the consumer (a .net reporting app)
>         to use
>         load balancer VIP for client connections to any cluster using a
>         compound
>         connection string via the .NET API?  That is, is it possible to use
>         something similar to
>
>         '{"uri":["amqp://remote1-____node1","amqp://remote1-node2"]__}'
>         on the
>
>         client side for either publishing or consuming such that we
>         don't need
>         an external load balancer at all to achieve high availability
>         for BOTH
>         client connections and federation connections?
>
>
>         Thanks,
>         Robert
>
>
>         On Thu, Aug 1, 2013 at 10:34 AM, Simon MacMullen
>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>              On 31/07/2013 5:35PM, Robert Parker wrote:
>
>                  I'm having some trouble getting the right architecture
>         configured to
>                  support rabbitmq federation in a clustered high
>         availability
>                  environment.  Our basic setup is four clusters of two
>         nodes each
>                  which
>                  are separated by a WAN.
>
>                  "home" is the "home" cluster and "remote1", "remote2" and
>                  "remote3" are
>                  remote clusters.  There are a lot of queues being
>         created and
>                  published
>                  to via the API identically on all clusters but I only
>         want to
>                  federate
>                  ONE of the queues, which is called "EventListener" back
>         to the
>                  "home"
>                  cluster from all the "remote" clusters.  I want messages
>                  published to
>                  this queue on each remote cluster to be federated to
>         the home
>                  cluster to
>                  be consumed by a separate event listener service that
>         only lives
>                  at the
>                  "home" site.
>
>
>              Just to be clear: you are aware that (currently) it's only
>              *exchanges* which can be federated, not queues?
>
>                  Each cluster is configured with:
>
>
>              <snip>
>
>                  We have configured three hardware load balancer VIPs
>         that load
>                  balance
>                  connections on port 5672 between both nodes in each
>         cluster, and
>                  have
>                  configured federation upstreams to use these and also
>         configured our
>                  application to use these VIPs for queue/exchange
>         creation and for
>                  publishing messages.  Here's our federation config
>         script thats
>                  run on
>                  node1 of the home cluster only:
>
>
>              <snip>
>
>                  However I am noticing that the "rabbitmqctl eval
>                  'rabbit_federation_status:____status()." command only
>         shows federation
>
>                  config on node2 of the home cluster despite having been
>                  configured on node1:
>
>
>              Federation works by establishing link(s) from the
>         downstream to the
>              upstream(s). You can define the upstreams on any node in the
>              downstream cluster (the configuration is cluster-wide) and the
>              cluster will arbitrarily start the link processes on any
>         node (and
>              will migrate them around the cluster if nodes go down).
>
>              *However*, rabbit_federation_status:____status() will only
>         report
>
>              links that are running on the local node. This is probably
>         not well
>              documented. Hmm. Let's fix that.
>
>              (The HTTP API exported by rabbitmq_federation_management
>         will report
>              links on all nodes.)
>
>              <snip>
>
>                  And I'm noticing that messages published to the queues
>         via the load
>                  balancer VIPs to the remote clusters are not showing up
>         in the
>                  "EventListener" queue of the home cluster.
>
>
>              Note that you have federated an exchange called
>         "EventListener", not
>              a queue. So if you bind a queue to the exchange
>         "EventListener" on
>              home, and publish to the exchange "EventListener" on
>         remote1/2/3
>              then you should see messages turning up in the queue on
>         home. Is
>              that what you're doing?
>
>                  Is this not the right way to set this up?
>
>
>              It sounds like you're basically right, apart from the
>         exchange vs
>              queue thing.
>
>                  Is it possible to configure
>                  this without using an external load balancer and still
>         achieve high
>                  availability?
>
>
>              Since 3.1.0, yes. You can specify multiple URIs in a single
>              upstream, and federation will connect to a randomly chosen
>         one (and
>              keep retrying different ones if that one goes down). Use
>         something like:
>
>              rabbitmqctl set_parameter federation-upstream remote1-upstream
>
>         '{"uri":["amqp://remote1-____node1","amqp://remote1-node2"]____,"expires":3600000}'
>
>
>                  If I federate to a single node of a cluster directly,
>                  what happens if that node goes down?
>
>
>              If you only specify one URI, it will keep retrying until
>         that node
>              comes back up.
>
>                  Do I have to configure redundant
>                  federation between every node of home cluster to every
>         node of each
>                  remote cluster?
>
>
>              No - since the config is shared across the cluster. So you
>         can set
>              up the upstreams on one node of the home cluster, pointing
>         to all
>              nodes of the remote clusters.
>
>                  If I don't use a load balancer VIP to publish to from my
>                  application, if the single node of the cluster I've
>         configured goes
>                  down, it wont help me that the other node is still
>         available.
>
>
>              Not sure what you mean here. Hopefully I've explained
>         enough now.
>
>              Cheers, Simon
>
>              --
>              Simon MacMullen
>              RabbitMQ, Pivotal
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jlkrenzelok at riversidemachine.com  Thu Aug  1 17:13:23 2013
From: jlkrenzelok at riversidemachine.com (jlkrenzelok)
Date: Thu, 01 Aug 2013 11:13:23 -0500
Subject: [rabbitmq-discuss] New install problem
Message-ID: <1375373603.5206.15.camel@openPLM.metalcraft.com>

Hello,

I'm working on setting up a server for openPLM 1.2 on a machine running
openSUSE 12.3.

Thought I was almost done, but I had been accidentally working off
installation instructions for the previous version, so I had to back up
a few steps and redo some portions of the installation.  This included
removing the django folder, grabbing a new clean copy of openPLM with
subversion, making a new database, and resyncing and migrating the
files.

The next step was to configure celery, but when I tried to start
rabbitmq with the command 'service rabbitmq-server start', it failed.  I
uninstalled the package, and reinstalled erlang-rabbitmq-client,
rabbitmq-server and rabbitmq-server-plugins, all version 2.8.7-2.4.1

This is the result of running the command again, and the error log:

openPLM:/home/jlkrenzelok # service rabbitmq-server start
Job for rabbitmq-server.service failed. See 'systemctl status
rabbitmq-server.service' and 'journalctl -n' for details.
openPLM:/home/jlkrenzelok # systemctl status rabbitmq-server.service
rabbitmq-server.service - LSB: Enable AMQP service provided by RabbitMQ
broker
	  Loaded: loaded (/etc/init.d/rabbitmq-server)
	  Active: failed (Result: exit-code) since Thu, 2013-08-01 10:30:46
CDT; 1min 8s ago
	 Process: 9001 ExecStart=/etc/init.d/rabbitmq-server start
(code=exited, status=1/FAILURE)
	  CGroup: name=systemd:/system/rabbitmq-server.service

Aug 01 10:29:34 openPLM.metalcraft.com su[9018]: (to rabbitmq) root on
none
Aug 01 10:29:34 openPLM.metalcraft.com su[9018]: pam_unix(su:session):
session opened for user rabbitmq by (uid=0)
Aug 01 10:30:12 openPLM.metalcraft.com su[9064]: (to rabbitmq) root on
none
Aug 01 10:30:12 openPLM.metalcraft.com su[9064]: pam_unix(su:session):
session opened for user rabbitmq by (uid=0)
Aug 01 10:30:13 openPLM.metalcraft.com su[9092]: (to rabbitmq) root on
none
Aug 01 10:30:13 openPLM.metalcraft.com su[9092]: pam_unix(su:session):
session opened for user rabbitmq by (uid=0)
Aug 01 10:30:46 openPLM.metalcraft.com rabbitmq-server[9001]: Starting
rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
Aug 01 10:30:46 openPLM.metalcraft.com rabbitmq-server[9001]: ..failed
Aug 01 10:30:46 openPLM.metalcraft.com systemd[1]: Failed to start LSB:
Enable AMQP service provided by RabbitMQ broker.
Aug 01 10:30:46 openPLM.metalcraft.com systemd[1]: Unit
rabbitmq-server.service entered failed state

Any ideas on what I do here?  It worked fine the first time around.

Thanks,

Jesse


From mklishin at gopivotal.com  Thu Aug  1 18:15:00 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 21:15:00 +0400
Subject: [rabbitmq-discuss] New install problem
In-Reply-To: <1375373603.5206.15.camel@openPLM.metalcraft.com>
References: <1375373603.5206.15.camel@openPLM.metalcraft.com>
Message-ID: <2E5E7814-3066-471F-A400-903FDDEE874C@gopivotal.com>

jlkrenzelok:

> Any ideas on what I do here?

What's in the rabbitmq log?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/5b6cc32f/attachment.pgp>

From jlkrenzelok at riversidemachine.com  Thu Aug  1 18:38:13 2013
From: jlkrenzelok at riversidemachine.com (jlkrenzelok)
Date: Thu, 01 Aug 2013 12:38:13 -0500
Subject: [rabbitmq-discuss] New install problem
In-Reply-To: <2E5E7814-3066-471F-A400-903FDDEE874C@gopivotal.com>
References: <1375373603.5206.15.camel@openPLM.metalcraft.com>
	<2E5E7814-3066-471F-A400-903FDDEE874C@gopivotal.com>
Message-ID: <1375378693.5206.17.camel@openPLM.metalcraft.com>

=INFO REPORT==== 31-Jul-2013::10:23:53 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 31-Jul-2013::10:23:53 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
Memory limit set to 388MB of 971MB total.

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
Disk free limit set to 1000MB

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
Adding vhost '/'

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
Creating user 'guest'

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
Setting user tags for user 'guest' to [administrator]

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
Setting permissions for 'guest' in '/' to '.*', '.*', '.*'

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 31-Jul-2013::10:23:54 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 31-Jul-2013::10:23:54 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 31-Jul-2013::10:24:47 ===
Creating user 'openplm'

=INFO REPORT==== 31-Jul-2013::10:25:04 ===
Adding vhost 'openplm'

=INFO REPORT==== 31-Jul-2013::10:25:51 ===
Setting permissions for 'openplm' in 'openplm' to '.*', '.*', '.*'


On Thu, 2013-08-01 at 21:15 +0400, Michael Klishin wrote:
> jlkrenzelok:
> 
> > Any ideas on what I do here?
> 
> What's in the rabbitmq log?
> --
> MK
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From jlkrenzelok at riversidemachine.com  Thu Aug  1 18:43:32 2013
From: jlkrenzelok at riversidemachine.com (jlkrenzelok)
Date: Thu, 01 Aug 2013 12:43:32 -0500
Subject: [rabbitmq-discuss] New install problem
In-Reply-To: <1375378693.5206.17.camel@openPLM.metalcraft.com>
References: <1375373603.5206.15.camel@openPLM.metalcraft.com>
	<2E5E7814-3066-471F-A400-903FDDEE874C@gopivotal.com>
	<1375378693.5206.17.camel@openPLM.metalcraft.com>
Message-ID: <1375379012.5206.21.camel@openPLM.metalcraft.com>

I saw that the log previously posted had not been updated today- here's
the startup log.

The last two boxed error messages are repeated quite a few times, so I
cropped it.


From timrobertson100 at gmail.com  Thu Aug  1 18:51:29 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Thu, 1 Aug 2013 19:51:29 +0200
Subject: [rabbitmq-discuss] Java client - 91% time spent in reading the
	socket?
In-Reply-To: <4A63C288-065B-4610-AF24-A897690C39D9@gopivotal.com>
References: <CAMsy_NipEYnhhEG2DmamrDd+xxfnB+YdyjvYH+4a_pvf1afECw@mail.gmail.com>
	<4A63C288-065B-4610-AF24-A897690C39D9@gopivotal.com>
Message-ID: <CAMsy_NjRwfxkbpwL-GX7HghrYwgvMr8RNx50Lh4KYuoLjPqacw@mail.gmail.com>

Thanks Michael for that super fast reply,

That was what I was actually questioning... across all threads, 91% of the
time is spent in the connection thread and all of it is in reading the
socket which I found somewhat suspicious, knowing how much processing needs
to happen per message.  The other 9% is spent in "my code".  Is it really
true that it is so time consuming for the connection thread to need 9/10ths
of the time?  Also - I'm only seeing 400msg/s (even when I comment out all
my code) from a durable persistent queue with ACK, lending more weight to
my suspicions that something is not quite right here (I have basic QoS at
100msg and a single thread+channel here).

You still think this is correct behavior?

Cheers,
Tim














On Thu, Aug 1, 2013 at 5:02 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Tim Robertson:
>
> > Does this look suspicious to anyone?  Can anyone shed any light on how
> one might improve this?
>
> Java client uses a separate thread for network activity (called "main
> loop"), one per connection.
>
> So in that thread, 100% of time is spent reading from the socket. When a
> delivery arrives,
> it is dispatched to a work pool (every channel has its own, AFAIR).
>
> If you profile all methods, it's certainly very likely that
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run will be at the top of
> the overall table.
>
> You can try excluding certain classes/methods/threads from the profiler.
> That will
> give you a more informative insight.
> --
> MK
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/56ab38d7/attachment.htm>

From mklishin at gopivotal.com  Thu Aug  1 19:03:16 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 22:03:16 +0400
Subject: [rabbitmq-discuss] Java client - 91% time spent in reading the
	socket?
In-Reply-To: <CAMsy_NjRwfxkbpwL-GX7HghrYwgvMr8RNx50Lh4KYuoLjPqacw@mail.gmail.com>
References: <CAMsy_NipEYnhhEG2DmamrDd+xxfnB+YdyjvYH+4a_pvf1afECw@mail.gmail.com>
	<4A63C288-065B-4610-AF24-A897690C39D9@gopivotal.com>
	<CAMsy_NjRwfxkbpwL-GX7HghrYwgvMr8RNx50Lh4KYuoLjPqacw@mail.gmail.com>
Message-ID: <B115566B-0CCC-4B82-BD00-465B23A519C1@gopivotal.com>

Tim Robertson:

> The other 9% is spent in "my code".  Is it really true that it is so time consuming for the connection thread to need 9/10ths of the time?

What profiler do you use? Sampling profilers don't measure for how long every method is executed,
just at what points in time a particular method was running. For the main loop I can imagine it greatly
skews the results

>  Also - I'm only seeing 400msg/s (even when I comment out all my code) from a durable persistent queue with ACK, lending more weight to my suspicions that something is not quite right here (I have basic QoS at 100msg and a single thread+channel here).

It's a low rate. You can try automatic acknowledgements just to compare. Throughput in both directions
also depends on message payload size and TCP stack settings. RabbitMQ Java client by default
disables Nagle's algorithm.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/cb673537/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug  1 19:05:17 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 22:05:17 +0400
Subject: [rabbitmq-discuss] New install problem
In-Reply-To: <1375379012.5206.21.camel@openPLM.metalcraft.com>
References: <1375373603.5206.15.camel@openPLM.metalcraft.com>
	<2E5E7814-3066-471F-A400-903FDDEE874C@gopivotal.com>
	<1375378693.5206.17.camel@openPLM.metalcraft.com>
	<1375379012.5206.21.camel@openPLM.metalcraft.com>
Message-ID: <8FF21126-A7EC-4AEF-9BA6-1E0B6BF095D8@gopivotal.com>

jlkrenzelok:

> ERROR: epmd error for host "openPLM": timeout (timed out establishing
> tcp connection)

host openPLM probably has firewall configured to block incoming traffic on the port epmd uses (4369 by default).
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/c98d4885/attachment.pgp>

From lrodriguez1995 at yahoo.com  Thu Aug  1 19:40:47 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Thu, 1 Aug 2013 11:40:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Ubuntu 12.04 Rabbitmq-server hangs after
	being stopped or restarted
In-Reply-To: <51FA7C31.2020106@rabbitmq.com>
References: <1375365587.74921.YahooMailNeo@web141104.mail.bf1.yahoo.com>
	<51FA7C31.2020106@rabbitmq.com>
Message-ID: <1375382447.69439.YahooMailNeo@web141101.mail.bf1.yahoo.com>

thanks for your reply...
I was able to figure out the issue thankfully...

rabbitmq was timming out because was unable to connect to epmd ":address (cannot connect to host)"
in addition, several instances were still running, so I had to kill them and reboot,,
after that everything worked fine...



Luis




________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Luis Rodriguez <lrodriguez1995 at yahoo.com>; Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Thursday, August 1, 2013 11:18 AM
Subject: Re: [rabbitmq-discuss] Ubuntu 12.04 Rabbitmq-server hangs after being stopped or restarted
 


Hi,


On 01/08/13 14:59, Luis Rodriguez wrote:
> running Ubuntu 12.04 on 3 clustered VM's (Erlang R16B01)
> I can't seem to know why rabbitmq-server hangs after either stopping the
> server or restarting it..
> ./rabbitmq-server start ----- Rabbitmq-server is currently running
> ./rabbitmq-server stop ------ hangs
> ./rabbitmq-server restart ---- hangs
> 
> the management console shows the cluster with all the nodes up and there
> is nothing on the server log or the broker



Depending on which version you are running the root cause may be masked
by this bug:
https://bugs.launchpad.net/ubuntu/+source/rabbitmq-server/+bug/1053424/
Don't use rabbitmq-server-2.7.1-0ubuntu4, if indeed that is the case.

If you are not using that version then can you please describe in more
detail what you mean by "hang". How long have you waited? What is the
CPU usage like? Does the same happen on an unclustered node?



-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/b4d88b58/attachment.htm>

From vashi.priyanki at gmail.com  Thu Aug  1 20:06:03 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Thu, 1 Aug 2013 12:06:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
Message-ID: <7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>

Hi There ,

I have done many small small tests to understand how the throughput of 
rabbitMQ node scales with respect to cores as well as number of producers 
and consumers. Here are my observations. Tests are for both single node as 
well as Cluster configuration. 

Based on this observations, first thing I would like to confirm if these 
are expected behaviour/results or I can do something more to improve 
throughput. Secondly there are some specific questions with respect to them 
so would help me to have clarification on them to continue further. 

Just so you know, I have also checked the performance statistics, which 
were published on rabbitMQ site for 2.8.1 version, and based on the points 
there I tried different things. Like changing prefetch_count values, 
non-persistent type of messages as well as persistent type of messages, 
DISK node and RAM node etc. etc.



My test configuration are as follows.

RabbitMQ version . 3.1.3 with Erlang version - R16B01

I have one virtual machine with 8 GB of RAM and 20 cores - This is 
dedicated for mainly rabbit nodes. 
I have another virtual machine with 8 GB of RAM and 20 cores - This is 
dedicated mainly my producer and consumers. Also my producer and consumer 
are single threaded type (using python pika library) so I have try to go 10 
producer and 10 consumer by giving each of them 1 dedicated core to find 
out system limit of RabbitMQ. I start linearly. first with 1P and 1C and so 
on.....

Since my interest is to benchmark performance and find system limits on 
RabbitMQ, I have simulated producer and consumer and basically there is no 
processing with messages after consumer receives the messages. This means, 
I believe that I am producing as fast as above configuration of VM supports 
as well as I am consuming as fast as I can.

I am using non-blocking method of connection (using select.connection) 
method of pika.
Message size is 100 bytes. I have configured 'direct' type of exchange
I also have enabled publisher confirm as well as consumer ack since I am 
interested in reliable delivery and confirmation of messages till 
application layer. Hence I explicitly use publisher confirm and consumer 
ack. 


Here comes my statistics

Test-1) With Single Node configuration:
    The maximum throughout I can get is around 5000 msg/sec - with 1 
publisher and 1 consumer, with prefetch_count = 0 
    Node type = Disk
    Both producer and consumer are given dedicated cores using linux 
taskset command. (if I leave core assignment on linux then throughput is 
only around 3500 msg/sec) Core assignment for Rabbit Nodes are left to the 
linux and not touched.

    Here the limiting factor is publisher since it loads it's assigned core 
to almost 100%. So to have better throughput , I started another producer 
assigning another core     and also started corresponding consumer with 
it's own dedicated core. Try to publish to same queue as well as different 
queue.
    But still I see the overall throughout  remains around the same value 
and increases little bit and its division is roughly as follows for each of 
the producer and receiver. 

    P1 and P2- publish rate - roughly 2500-2700 msg/sec. Same for 
consumption, which adds to the total of around 5000-5500 msg/sec.
   
    Even if I introduce prefetch_count value it hardly changes the 
throughput.
    Also, I tried with both persistent and non-persistent messages, 
throughput does not change much. It's almost the same as listed above with 
node of type DISK.

    
So from this it feels that maximum capacity of a single node of type DISK 
is limited to 5000 msg/sec when publisher confirm and consumer ack is 
enabled in this version. I thought main reason for this could be server 
latency. Is it correct understanding or I am missing something here to 
consider ? 

And my specific questions on this particular observations are as follows.
1) Is this expected behaviour on throughput scaling when number of producer 
and consumer increases linearly ? 
2) Can something be done to improve throughout with single node 
configuration without changing publisher confirm and comsumer ack 
configuration ( means keeping them enabled) ? 
3) How to calculate server latency in approximate way ? here I thought by 
adding round trip time (RTT) for both publisher confirm and consumer ack, 
one can get latency. Is this correct understanding ? What is the effective 
method to calculate RTT ? 


Test-2) With Cluster configuration: 
First I tried, Cluster with 1 DISK node and 1 RAM node

Here when my producer and receiver try to connect to DISK node, statistics 
are almost similar to Test-1. 
I tried with single producer-single consumer, 2 publisher and 2consumer and 
so on. Not any observable diff in throughput 

Now when my producer and consumer connect to RAM node, I see following.
1 P and 1 C - throughout is around 4500-5000 msg/sec
2P and 2C - throughout is around 9000-10000 msg/sec
beyond this if I increase producer and consumer throughput starts to drop 
little bit with overall throughput to 12000 msg/sec with each 
producer/consumer having 4000 msg/sec.
So again I feel, after certain number of producer and consumer, server 
latency do come into picture even for RAM type of node and slowly drops the 
throughout. 
Instead of having multiple of 5000 msg/sec for every increase in producer 
and consumer it becomes roughly 4000 , 3500 , 3000 msg/sec per 
producer-consumer pair.

After this I added third node, fourth node and so on in the cluster, All 
are of also of type RAM. And maximum throughout I can get is around 
22000-24500 msg/sec. 
Changing prefetch_count or delivery_mode ( from persistent to 
non-persistent and vice versa) do not really makes any big difference.


So then my specific questions on Test-2) observation are as follows.
1) Why there is no linear increase in throughput with DISK type of node as 
it's seen with RAM type of node ?
2)  At least for messages of type non-persistent I believe DISK type and 
RAM type should behave similar but they are not so what are the main 
difference in the way         DISK type and RAM type of node handles 
non-persistent messages ?
3) What can be done to improve throughput in both the Tests ?
4) Since I have VM with 20 cores dedicated for rabbitMQ execution, how can 
I load the CPU to it's limit ? with the current tests I can load CPU 
maximum to 800% with    above mentioned throughput. currently the limiting 
factor seems to be server latency so how to overcome that ? 


Best Regards,
Priyanki.   
   

    





On Tuesday, June 25, 2013 1:09:28 PM UTC+2, hyperthunk wrote:
>
> Reposting
>
> On 25 Jun 2013, at 09:38, Tim Watson <t... at rabbitmq.com <javascript:>> 
> wrote:
>
> What does your publishing code look like? The figures below are expected 
> in that the consumer can keep pace with the producer - it could hardly be 
> expected to consume faster than messages are arriving in the queue(s). So 
> the slowness is very likely on the producing side.
>
> Are you using persistent messages and either publisher confirms or 
> transactions? If so, how often are you waiting on confirms/commits?
>
> With the official clients we typically see avg rates of 50 - 60Khz with 
> non-persistent messages. Persistence slows things down a tad, as do 
> confirms (and more so transactions) but even with persistent messages and 
> confirms, rates >= 5Khz are expected. It /sounds/ like you might be 
> publishing persistent messages with confirms enabled and waiting for a 
> confirm (ack) from the broker for each message. That  involves disk I/O on 
> the server for each message plus network latency, effectively making 
> publishing synchronous (and very slow by comparison).
>
> Cheers,
> Tim
>
> On 25 Jun 2013, at 08:44, Priyanki Vashi <vashi.p... at gmail.com<javascript:>> 
> wrote:
>
> Hi there,
>
> I am doing a performance study of RabbitMQ-3.1.1 and this is my first time 
> to do such a performance study with any messaging broker :))-
>
> 1) I have thoroughly gone through rabbitMQ in action' and learnt important 
> concepts. 
>
> 2) Tried single node broker to get a feel of how it is working and then 
> set up a four node cluster (with two disk and two RAM type of node). Also 
> configured HAproxy TCP Load balancer so that I can just provide single port 
> to connect to the Cluster.
>
> 3) I am simulating producer and consumers through Python scripts ( using 
> Python-pika library methods to connect to server , publish subscribe etc.)
>
> 4) My scripts are working fine but where I am stuck is no matter what I do 
> my throughout is always 300 msg/sec. 
>
> 5) I have defines durable exchanges and queues
>
> My final requirement is to run atleast 10 to 15 producer and 60 to 70 
> consumer simultaneously and I want to start with linear increase in number 
> of producer and consumer so that I can make conclusions about  throughout, 
> fault handling, processor utilization etc. etc but I am seriously stuck now 
> after trying to start in initial steps only. This group's help would be 
> really appreciated. 
>
> I have started with following different scenarios but no matter what I do 
> my throughput is more or less remaining same (300 msg/sec) except for 
> Scenario-1
>
> Scenario-1
> -1 producer and No consumer and no queue binded to exchange
> -Producer is running in infinite loop and publishing to one fanout exchange
> - publisher/confirm disabled
> -Publisher rate - 6200 msg/sec ( checked through web management plugin)
>
> Tried scenario-1 with also fanout type of exchange and it's the same 
> publish rate
> I know that Scenario-1 is not really useful, since there are no queues and 
> ultimately messages will be dropped but as a part of debugging process I 
> tried this and I see above mentioned results.
>
> Scenario-2
> -1 producer and 1 consumer 
> -Producer is running in infinite loop and publishing to one direct exchange
> -A consumer has it's own dedicated queue and listening to above exchange 
> - publisher/confirm and consumer ack are disabled
> Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec 
> and deliver rate - 300 msg/sec)
>
> Tried Scenario-2 also with fanout type of exchange and enabling publisher 
> confirm and consumer ack
> Still the same throughput as 300 msg/sec
>
> Scenario-3
> -1 producer and 4 consumer 
> -Producer is running in infinite loop and publishing to four direct 
> exchange
> -A consumer has it's own dedicated queue and listening to respective 
> exchange 
> - publisher/confirm and consumer ack are disabled
> Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec 
> and deliver rate - 300 msg/sec)
>
> Tried Scenario-3 also with fanout type of exchange and enabling publisher 
> confirm and consumer ack
> Still the same throughput as 300 msg/sec
>
> Tried configuring prefetch_count parameters also to 100 but it still gives 
> me same throughput of 300 msg/sec.
> I am honestly going crazy with this.
>
> After seeing this behavior, I am seriously suspecting that there is some 
> serious limitation with my simulated producers and consumers.
> Has anyone else has tried Python-pika client and any idea on throughput 
> with this version of rabbit ? 
> Did anyone have rough idea about throughout with rabbitMQ-3.1.1 ?
>
> I can also share my python scripts if required but I would really 
> appreciate some light on this situation
> Also what points to take care, in order to improve throughput ?
>
> Best Regards,
> Priyanki
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/5874b5ed/attachment.htm>

From mklishin at gopivotal.com  Thu Aug  1 20:14:51 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 23:14:51 +0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
	and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
Message-ID: <095EF0F0-4273-44E1-9D5E-E899B89DA6AD@gopivotal.com>

Priyanki Vashi:

> So from this it feels that maximum capacity of a single node of type DISK is limited to 5000 msg/sec when publisher confirm and consumer ack is enabled in this version. I thought main reason for this could be server latency. Is it correct understanding or I am missing something here to consider ? 

If you say your producer maxes out one core, you are limited by Pika's throughput (for which 5K/s
from a single process sounds about right).

Try with a multi-threaded Java producer (allowing the JVM use as many
cores as you have publishing threads is a good idea) or multiple Pika producer processes.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/a79b734f/attachment.pgp>

From david.tinker at gmail.com  Thu Aug  1 20:17:59 2013
From: david.tinker at gmail.com (David Tinker)
Date: Thu, 1 Aug 2013 21:17:59 +0200
Subject: [rabbitmq-discuss] ANN New project QDB: Persistent Message
 Queues With Replay
In-Reply-To: <CA+O6_FfRk3A3oahB_+uq2ohsaR_AkVQWQSjDdVrZLz9usueyTQ@mail.gmail.com>
References: <CA+O6_FcN1ne8LY1BZLi==n6ueNbJ4B7oG7D3c07EN3m8KHVdTA@mail.gmail.com>
	<51FA4DE5.1090501@timgroup.com>
	<CA+O6_FfRk3A3oahB_+uq2ohsaR_AkVQWQSjDdVrZLz9usueyTQ@mail.gmail.com>
Message-ID: <CA+O6_FcUtt+PeW8UjEE=0dqhkd6hbLVBrS+D+Z=b1ZUu5h9XmA@mail.gmail.com>

I have fixed all of the assorted build problems (version issue,
signing required etc.) and the "failing outside of GMT+2" test.

With any luck the qdb-buffer and qdb-kvstore dependencies will also be
on Maven Central in a couple of hours.

I should have time to implement queue "inputs" this weekend. The first
of which will have type=rabbitmq and will pull messages from a
RabbitMQ queue.

On Thu, Aug 1, 2013 at 2:32 PM, David Tinker <david.tinker at gmail.com> wrote:
> Thanks for all the comments and testing. I will fix the build scripts
> for qdb-buffer and qdb-kvstore and sort out the Maven stuff and the
> failing test.
>
> Yes I definitely do plan to add support for pulling messages from
> RabbitMQ queues as well. We need that here at work.
>
> As for the QDB vs local RabbitMQ use-case thats a good idea.
>
>
>
> On Thu, Aug 1, 2013 at 2:00 PM, Tom Anderson <tom.anderson at timgroup.com> wrote:
>> On 01/08/13 11:44, David Tinker wrote:
>>
>> QDB provides persistent message queues with the ability to efficiently
>> replay old messages by timestamp or id. It can push messages from its
>> queues directly to RabbitMQ and has simple REST interface.
>>
>> http://qdb.io/
>>
>>
>> Interesting. Thanks!
>>
>> Can you feed it from RabbitMQ too? If not, any plans to make that possible?
>> A replayable recent history of certain queues could be insanely useful for
>> us. If not, it looks like it wouldn't be that hard for us to add if we
>> wanted it.
>>
>> A few minor remarks:
>>
>> - "QDB depends on two libraries that are not yet on Maven central ... These
>> need to be built and installed in your local Maven repository before
>> building QDB." - have you considered putting artifacts for these up in a
>> non-Central repository? I do that via a repo hosted on my Bitbucket site -
>> see https://bitbucket.org/twic/twic.bitbucket.org/src and
>> https://bitbucket.org/twic/twic.bitbucket.org/src/default/release.sh for the
>> script that updates it - and find it fairly easy. I think this is even
>> easier on GitHub.
>>
>> - Building and installing locally is rendered less than entirely smooth by
>> (a) the fact that both projects use the signing plugin, which means i would
>> have to set up GPG etc just to install locally (i commented out the signing
>> declarations instead), (b) qdb-kvstore refers to a repo with url
>> "/Users/david/.m2/repository", (c) qdb-kvstore depends on version
>> 0.4.0-SNAPSHOT of qdb-buffer, but if you check out and build qdb-buffer, you
>> make version 0.4.1-SNAPSHOT.
>>
>> - The qdb-server build at revision c5c7ac3b7a11 has one failing test,
>> because this:
>>
>>     def "Format timestamp works"() {
>>         Date d = new
>> SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ").parse("2013-06-16T21:04:32.123+0200")
>>         String s = DateTimeParser.INSTANCE.formatTimestamp(d)
>>
>>         expect:
>>         s == "2013-06-16T21:04:32.123+0200"
>>     }
>>
>> Won't pass if you don't live in South Africa, or somewhere else with a +0200
>> timezone.
>>
>> And some handwaving:
>>
>> - If you ever fancy using a different storage engine, you might be
>> interested in http://www.mapdb.org/ . Not sure if it has the event
>> notification, though, nor if its performance characteristics are really what
>> you need.
>>
>> - For qdb-buffer, it might be helpful to write a comparison between what
>> seems like your main use case (buffering messages heading towards RabbitMQ
>> to protect against RabbitMQ doing down) and running a local RabbitMQ on
>> every box as a first hop.
>>
>> tom
>>
>> --
>>
>> Tom Anderson | Developer | +44 20 7826 4312 | timgroup.com
>>
>> STATEMENT OF CONFIDENTIALITY: The information contained in this electronic
>> message and any attachments to this message are intended for the exclusive
>> use of the addressee(s) and may contain confidential or privileged
>> information. If you are not the intended recipient, please notify Tom
>> Anderson at TIM Group at tom.anderson at timgroup.com and destroy all copies of
>> this message and any attachments.
>>
>> TIM Group is the trading name for YouDevise Limited. YouDevise Limited is
>> registered in England, No. 3331176. Registered office: 3 Copthall Avenue,
>> London, EC2R 7BH.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> http://twoogleplus.com/ Online service to cross-post tweets to Google+
> http://engage.calibreapps.com/ Engage - Web based goal setting and
> performance management



-- 
http://twoogleplus.com/ Online service to cross-post tweets to Google+
http://engage.calibreapps.com/ Engage - Web based goal setting and
performance management

From mklishin at gopivotal.com  Thu Aug  1 20:19:35 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 23:19:35 +0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
	and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
Message-ID: <003F5F6C-DBF3-4BA8-A745-851456B1208C@gopivotal.com>

Priyanki Vashi:

> 1) Is this expected behaviour on throughput scaling when number of producer and consumer increases linearly ? 

Given that there are hardware resources available, yes, but up to a certain point.

> 2) Can something be done to improve throughout with single node configuration without changing publisher confirm and comsumer ack configuration ( means keeping them enabled) ?

For publishers, no (besides reducing message payload). For consumers, increase prefetch count
x2-8 and add more consumer threads (probably not going to have any effect on Pika and CPython).

>  
> 3) How to calculate server latency in approximate way ? here I thought by adding round trip time (RTT) for both publisher confirm and consumer ack, one can get latency. Is this correct understanding ? What is the effective method to calculate RTT ? 

Calculating RTT for a single message correctly is quite tricky. I suggest that you calculate avg latency
for the entire run and take a mean of, say, 10 runs (or 100, if it can be automated).
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/d3a45eae/attachment.pgp>

From vashi.priyanki at gmail.com  Thu Aug  1 20:22:39 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Thu, 1 Aug 2013 21:22:39 +0200
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <095EF0F0-4273-44E1-9D5E-E899B89DA6AD@gopivotal.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<095EF0F0-4273-44E1-9D5E-E899B89DA6AD@gopivotal.com>
Message-ID: <CA+0nT8A=x_HZkBsnBZGcB7d3djnznY7cm64A_kYJj_Te1r7MQQ@mail.gmail.com>

Hi there ,

I have tried to with multiple producer and multiple consumer since my
producer and consumer are single threaded (around 10 each) but it's the
same statistics in test-1, which is around 5000 msg/sec. And since
eventually we will use python clients in real application of rabbitmq, I
think it would be good to know how it behaves with python clients ( in this
case I chose python-pika).

//P


On Thu, Aug 1, 2013 at 9:14 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Priyanki Vashi:
>
> > So from this it feels that maximum capacity of a single node of type
> DISK is limited to 5000 msg/sec when publisher confirm and consumer ack is
> enabled in this version. I thought main reason for this could be server
> latency. Is it correct understanding or I am missing something here to
> consider ?
>
> If you say your producer maxes out one core, you are limited by Pika's
> throughput (for which 5K/s
> from a single process sounds about right).
>
> Try with a multi-threaded Java producer (allowing the JVM use as many
> cores as you have publishing threads is a good idea) or multiple Pika
> producer processes.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/ef8d74f7/attachment.htm>

From mklishin at gopivotal.com  Thu Aug  1 20:27:34 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 23:27:34 +0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
	and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
Message-ID: <DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>

Priyanki Vashi:

> 1) Why there is no linear increase in throughput with DISK type of node as it's seen with RAM type of node ?

Because disks are much slower than RAM and performing multiple I/O operations in parallel often won't yield
linear increase in I/O throughput (depends on your disks and how they are set up; try with a striping array of SSDs ;))

With RAM access, it is more likely that you will see nearly linear increase.

> 3) What can be done to improve throughput in both the Tests ?

It's hard to give you good advice without seeing the code.

> 4) Since I have VM with 20 cores dedicated for rabbitMQ execution, how can I load the CPU to it's limit ? with the current tests I can load CPU maximum to 800% with    above mentioned throughput. currently the limiting factor seems to be server latency so how to overcome that ?

I suspect that the limiting factor is disk and network I/O and not CPU.
If Erlang runtime does not need more cores, it will not use more cores.

Try running iostat or vmstat alongside your benchmarks to see what % of load your disk has.
Monitoring network throughput is another thing to do. Finally, TCP stack configuration matters.
For example, does Pika disable Nagle's algorithm [1] on the sockets it uses? I'm not sure.

1. http://boundary.com/blog/2012/05/02/know-a-delay-nagles-algorithm-and-you
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/82bab552/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug  1 20:32:29 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 23:32:29 +0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
	and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <CA+0nT8A=x_HZkBsnBZGcB7d3djnznY7cm64A_kYJj_Te1r7MQQ@mail.gmail.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<095EF0F0-4273-44E1-9D5E-E899B89DA6AD@gopivotal.com>
	<CA+0nT8A=x_HZkBsnBZGcB7d3djnznY7cm64A_kYJj_Te1r7MQQ@mail.gmail.com>
Message-ID: <B0671577-7F69-4C1C-A053-520DF9963FB5@gopivotal.com>

Priyanki Vashi:

> I have tried to with multiple producer and multiple consumer since my producer and consumer are single threaded (around 10 each) but it's the same statistics in test-1, which is around 5000 msg/sec. And since eventually we will use python clients in real application of rabbitmq, I think it would be good to know how it behaves with python clients ( in this case I chose python-pika).

As your other tests demonstrate, a single RabbitMQ node can go to 25K with your setup.

If a Python producer (or multiple instances of thee) demonstrate lower throughput, it's logical
to suspect that publishing is the bottleneck.

I haven't done client benchmarks in a while but 5-6 KGhz is about right for Pika on CPython
and also Bunny 0.9+ on CRuby. Java client and clients based on it easily go into the 20-25K
range.

I can't offer any advice about possible throughput improvements with Pika but
it's a good idea to profile your producer to see what actually takes time.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/5cc09188/attachment.pgp>

From asternb at gmail.com  Thu Aug  1 18:36:53 2013
From: asternb at gmail.com (asternb at gmail.com)
Date: Thu, 1 Aug 2013 10:36:53 -0700 (PDT)
Subject: [rabbitmq-discuss] More detail on bug refusing publishes fixed in
	2.8.3
Message-ID: <241e13b1-955e-456d-b861-83d346cda61b@googlegroups.com>

I'm looking for more detail on a bug fixed in 2.8.3. The only description 
in the release notes is "queues with many busy consumers could refuse to 
accept publishes until empty" (http://www.rabbitmq.com/release-notes/README-2.8.3.txt). 
Could someone link me to the bug with detail in a tracker or copy that info 
here? With that bug, does the broker block connections similar to flow 
control?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/ebe4598f/attachment.htm>

From asternb at gmail.com  Thu Aug  1 18:42:36 2013
From: asternb at gmail.com (asternb at gmail.com)
Date: Thu, 1 Aug 2013 10:42:36 -0700 (PDT)
Subject: [rabbitmq-discuss] flow control blocked producers vs consumers
In-Reply-To: <d1a6f0e0-78af-4540-8ded-0b66c6ddee56@googlegroups.com>
References: <d1a6f0e0-78af-4540-8ded-0b66c6ddee56@googlegroups.com>
Message-ID: <b2cbe0eb-b0ef-4dda-9a3b-fb4a428e702a@googlegroups.com>

Are you sharing one connection between producers and consumers? You would 
need a separate connection (not just a different channel) for consumers in 
order for them to continue working when flow control blocks the producer's 
connection. Because if you are sharing one connection, blocking the 
producer's connection would also block consumers using that connection, I 
believe.

On Friday, July 26, 2013 3:33:09 AM UTC-7, Kobi Biton wrote:
>
> our rabbitmq (3.0.1) servers blocks producers (logstash) due to flow 
> control triggering (reason is flow on rabbitctl) this however also blocked 
> our consumers , to mitigate it we are restarting the blocked producers and 
> consumers then the queue start to get balanced.
>
> Reading the flow control docs , how can we avoid from blocking the 
> consumers connections ? can they operate on a different channel ? we also 
> lowered the message TTL and that seemed to slow down the waiting messages, 
> we do understand that we have a bottleneck somewhere along the pipe that 
> said could we configure out consumers to avoid flow control blocking ?
>
> Kobi  
>
> The above terms reflect a potential business arrangement, are provided solely 
> as a basis for further discussion, and are not intended to be and do not 
> constitute a legally binding obligation. No legally binding obligations will 
> be created, implied, or inferred until an agreement in final form is executed 
> in writing by all parties involved.
>
> This email and any attachments hereto may be confidential or privileged. 
>  If you received this communication by mistake, please don't forward it 
> to anyone else, please erase all copies and attachments, and please let 
> me know that it has gone to the wrong person. Thanks.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/b4344a66/attachment.htm>

From mklishin at gopivotal.com  Thu Aug  1 20:37:08 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 Aug 2013 23:37:08 +0400
Subject: [rabbitmq-discuss] flow control blocked producers vs consumers
In-Reply-To: <b2cbe0eb-b0ef-4dda-9a3b-fb4a428e702a@googlegroups.com>
References: <d1a6f0e0-78af-4540-8ded-0b66c6ddee56@googlegroups.com>
	<b2cbe0eb-b0ef-4dda-9a3b-fb4a428e702a@googlegroups.com>
Message-ID: <5883F34B-7E74-4EC3-B3FF-751822253062@gopivotal.com>

asternb at gmail.com:

> Because if you are sharing one connection, blocking the producer's connection would also block consumers using that connection, I believe.

This is correct.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/4a1a47c3/attachment.pgp>

From gmr at meetme.com  Thu Aug  1 21:39:48 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 1 Aug 2013 16:39:48 -0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <B0671577-7F69-4C1C-A053-520DF9963FB5@gopivotal.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<095EF0F0-4273-44E1-9D5E-E899B89DA6AD@gopivotal.com>
	<CA+0nT8A=x_HZkBsnBZGcB7d3djnznY7cm64A_kYJj_Te1r7MQQ@mail.gmail.com>
	<B0671577-7F69-4C1C-A053-520DF9963FB5@gopivotal.com>
Message-ID: <A4EFBA46FE504F518151F235060E526F@meetme.com>

I'll add that using pypy instead of python shows dramatic throughput increases with pika. Also note that as of my tests, the Tornado connection adapter is the fastest and as of right now, the Blocking adapter is pretty slow due to the logic required to make it answer RabbitMQ RPC requests while being single threaded.

I've been experimenting with using librabbitmq if it's available for the low level codec to see if there are performance improvements, but that's a ways off.

Regards,

Gavin 


On Thursday, August 1, 2013 at 3:32 PM, Michael Klishin wrote:

> Priyanki Vashi:
> 
> > I have tried to with multiple producer and multiple consumer since my producer and consumer are single threaded (around 10 each) but it's the same statistics in test-1, which is around 5000 msg/sec. And since eventually we will use python clients in real application of rabbitmq, I think it would be good to know how it behaves with python clients ( in this case I chose python-pika).
> 
> As your other tests demonstrate, a single RabbitMQ node can go to 25K with your setup.
> 
> If a Python producer (or multiple instances of thee) demonstrate lower throughput, it's logical
> to suspect that publishing is the bottleneck.
> 
> I haven't done client benchmarks in a while but 5-6 KGhz is about right for Pika on CPython
> and also Bunny 0.9+ on CRuby. Java client and clients based on it easily go into the 20-25K
> range.
> 
> I can't offer any advice about possible throughput improvements with Pika but
> it's a good idea to profile your producer to see what actually takes time.
> --
> MK
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130801/db36c208/attachment.htm>

From mklishin at gopivotal.com  Fri Aug  2 09:52:52 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 2 Aug 2013 12:52:52 +0400
Subject: [rabbitmq-discuss] Fwd:  Possible bug in .NET library,
	with IConnection
References: <CANzpDC7U8G6e-qp6cRwCaDOekfB7yHPeRCpNuy_MahdiZna5FA@mail.gmail.com>
Message-ID: <693ECBAB-71BF-46C9-86C7-A8013354B72A@gopivotal.com>

Adding rabbitmq-discuss back.

> From: Burtsev Aleksey <brokenpipe.coder at gmail.com>
> To: Michael Klishin <mklishin at gopivotal.com>
> 
> Yes. It's not exactly a bug in your .NET client, but it's very weak spot in you code. It is very easy to stumble on this problem. I had to wrap all calls to IModel in if blocks checking CloseReason.

It sounds like a bug to me ;)

> At least you should set closeReason for IModel and inner ISession when IModel.Close() is called. Even better would be to add IsClosing prop to Imodel and check it before sending commands to ISession, this will not break you existing session shutdown command sequence.
> 
> On Wed, Jul 31, 2013 at 9:58 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
>  Burtsev Aleksey:
> 
> > The code inside ModelBase.BasicGet doesn't Enqueue BasicGetRpcContinuation because m_closeReason  is not null
> > but send this command to server using _Private_BasicGet(), this method checks ModelBase.m_sessions.m_closeReason which is not null, and then when server reply is received command handler for BasicGetEmpty tries to dequeue (calls Next()) item from m_continuationQueue in which BasicGetRpcContinuation  wasn't put.
> 
> So in order to reproduce the problem one has to use basic.get on a closed channel?
> --
> MK

--
MK

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130802/a8796c6b/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130802/a8796c6b/attachment.pgp>

From simon at rabbitmq.com  Fri Aug  2 10:36:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Aug 2013 10:36:31 +0100
Subject: [rabbitmq-discuss] More detail on bug refusing publishes fixed
 in 2.8.3
In-Reply-To: <241e13b1-955e-456d-b861-83d346cda61b@googlegroups.com>
References: <241e13b1-955e-456d-b861-83d346cda61b@googlegroups.com>
Message-ID: <51FB7D9F.2070902@rabbitmq.com>

On 01/08/2013 6:36PM, asternb at gmail.com wrote:
> I'm looking for more detail on a bug fixed in 2.8.3. The only
> description in the release notes is "queues with many busy consumers
> could refuse to accept publishes until empty"
> (http://www.rabbitmq.com/release-notes/README-2.8.3.txt). Could someone
> link me to the bug with detail in a tracker or copy that info here?

We don't have a public bug tracker I'm afraid.

The bug was that queues always prioritised sending messages to consumers 
over accepting messages from publishers. Normally this was OK, since the 
limiting factor in sending messages to consumers was either how fast 
they could be streamed off disc, how fast they were coming in, or how 
fast they could be pushed onto the network, thus giving the queue CPU 
time to do other things.

However, if the queue had a lot of consumers (typically at least 
hundreds), and all those consumers were active, then the queue could get 
into a state where it was CPU-bound - at which point it would then fail 
to accept publishes at all until empty.

> With
> that bug, does the broker block connections similar to flow control?

Before RabbitMQ 2.8.0 messages would back up indefinitely in the broker 
before getting to the queue - so the symptom of this bug would be a 
sudden spike in memory use (possibly leading to the memory alarm going 
off). In 2.8.0 to 2.8.2 the broker would put the publishers into flow 
control - normally flow control should flick on and off rapidly to 
restrict the publishing rate, but in this case flow control would stay 
on and the publishing rate would drop to 0.

The bug was fixed in 2.8.3; now queues give equal priority to accepting 
and delivering messages.

Of course, many other bugs have also been fixed since then so as ever 
you are advised to upgrade :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Fri Aug  2 15:12:36 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 02 Aug 2013 15:12:36 +0100
Subject: [rabbitmq-discuss] Maximum achievable concurrent Web STOMP
 plugin on Windows
In-Reply-To: <1375112853685-28458.post@n5.nabble.com>
References: <1374878860315-28434.post@n5.nabble.com>
	<51F66B68.5050807@rabbitmq.com>
	<1375112853685-28458.post@n5.nabble.com>
Message-ID: <51FBBE54.6000005@rabbitmq.com>

On 29/07/13 16:47, joshua__lim wrote:
> Hi Emile, thank you for replying.  Do you know if there's a script or project
> that I can use to test client concurrency for the Web STOMP plugin?

I don't know of any.

> After that, I did more Googling, found SOCKET.IO, followed by SOCKJS and
> arrived at RabbitMQ.

The concurrency limit is not being imposed by the broker.




-Emile




From emile at rabbitmq.com  Fri Aug  2 15:24:41 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 02 Aug 2013 15:24:41 +0100
Subject: [rabbitmq-discuss] flow control blocked producers vs consumers
In-Reply-To: <CAKCS0Ay5ng+rjXnWGPkY+AhMeh_mxEFXoo5Fr7oy0frrYJb5xg@mail.gmail.com>
References: <d1a6f0e0-78af-4540-8ded-0b66c6ddee56@googlegroups.com>
	<207BC147-BFF1-40AE-BAC6-44C23C06E2DE@gopivotal.com>
	<CAKCS0Ay5ng+rjXnWGPkY+AhMeh_mxEFXoo5Fr7oy0frrYJb5xg@mail.gmail.com>
Message-ID: <51FBC129.2080604@rabbitmq.com>

On 26/07/13 12:39, Kobi Biton wrote:
> Our logstash consumers do use their own connection , we do not use the
> same connection for publishing (logstash rabbitmq output) and for
> consuming (logstash rabbitmq input) , I was under the impression that
> the consumers are blocked due to the fact that when rabbitmq starts to
> block producers due to flow rates looking at the logstash consumers
> logs I see errors connecting to the broker (connection reset by host)
> which implies that the broker rejects the consumers connection this of
> course leads us to shaky state where messages are no delivered and the
> only workaround we found is capturing the blocked producers list from
> rabbitmq_ctl and restarting the logstash agents by looping on all the
> blocked producers.


If publishers and consumers use separate connections then blocking of
publishers due to flow control won't affect consumers directly. Though
if publishers slow down that will eventually slow down consumers too
when queues are empty.

Can you explain what you mean when you say consumers are blocked? Are
there messages available in queues that are not being delivered? It
should be possible to determine the reason for messages not being
delivered if you provide the output of "rabbitmqctl report".





-Emile







From grussell at gopivotal.com  Fri Aug  2 17:20:36 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 2 Aug 2013 12:20:36 -0400
Subject: [rabbitmq-discuss] Duplicated message and unknown delivery tag
 after ack
In-Reply-To: <51FA2E7D.4090209@rabbitmq.com>
References: <ae768eb4-3b32-4e9e-b6b2-37c6a723ef23@googlegroups.com>
	<51FA2E7D.4090209@rabbitmq.com>
Message-ID: <CADtU9_udtSvbY4duxRHPHrAn7uR5KOa0tZGYvdFJTK+nO8kLeA@mail.gmail.com>

Also, while I don't believe there have been any changes to Spring AMQP in
this area, I would recommend using the latest version - 1.2.0 (or, at least
1.1.4).


On Thu, Aug 1, 2013 at 5:46 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Lukasz,
>
> On 31/07/13 17:30, Lukasz Olczak wrote:
> > com.rabbitmq.client.ShutdownSignalException: channel error; reason:
> > {#method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED -
> > unknown delivery tag 1, class-id=60, method-id=80), null, ""}
>
>
> There are legitimate ways in which multiple consumers could get hold of
> the same message, in the same second. If any consumer rejects a message
> or reconnects then unacknowledged messages will be returned to the
> broker and may be delivered to other consumers. Such messages will have
> the redelivered flag set.
>
> The error you quote could also arise if an application acknowledges
> messages incorrectly. Make sure that messages are only acknowledged once.
>
>
> > Anybody knows why RabbitMQ duplicates messages on a single broker with a
> > publisher and consumers connected through loopback interface?
>
>
>
> This is unlikely to have anything to do with the loopback interface
> directly. Though loopback offers greater speed which may expose race
> conditions.
>
> If you believe there is a broker error then please run your test via the
> Tracer protocol analyser and send us the generated trace file:
> http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html
>
>
>
>
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130802/136a55dd/attachment.htm>

From mklishin at gopivotal.com  Fri Aug  2 17:25:39 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 2 Aug 2013 20:25:39 +0400
Subject: [rabbitmq-discuss] Possible bug in .NET library,
	with IConnection
In-Reply-To: <b9d00605-68ee-421c-a150-fdf08c17ff77@googlegroups.com>
References: <b9d00605-68ee-421c-a150-fdf08c17ff77@googlegroups.com>
Message-ID: <F257DEC4-8225-4BB8-BE2C-E216F856FB70@gopivotal.com>

inforser.analytics at gmail.com:

> {AMQP close-reason, initiated by Library, code=541, text="Unexpected Exception", classId=0, methodId=0, cause=System.NullReferenceException: Object reference not set to an instance of an object.

I looked into this issue and cannot reproduce this particular exception.

Simply using BasicGet on a closed channel triggers an exception which is not entirely obvious
(OperationInterruptedException, vs. AlreadyClosedException in the Java client) but not
the exception you see.

Can you post a test case that reproduces the problem? Are you sharing IModel between threads?
(I'm not sure how else can basic.get-empty arrive to a closed channel)
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130802/2c83c7c5/attachment.pgp>

From mpietrek at skytap.com  Sat Aug  3 01:08:27 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 2 Aug 2013 17:08:27 -0700
Subject: [rabbitmq-discuss] Question on RabbitMQ and file I/O characteristics
Message-ID: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>

Just want to run this past the RabbitMQ devs and see if this jibes with
their expectations.

Our typical cluster runs RabbitMQ 3.02 on Ubuntu 10.04 on two nodes.  All
queues are mirrored. All our channels are opened in transactional mode. (We
know, this causes things to go slower - That's OK with us, we really want
to avoid message loss.)

What I'm seeing is that for each message written to the broker, we see
approximately four disk writes. That is, if the broker is doing 40
messages/sec, we see ~160 disk writes. We're getting these number from

Is this about what should be expected when running this way?

If it helps, I dug in a bit more to see what the files were. The vast
majority of the activity seems to be to files like this:

msg_store_persistent/743.rdq
queues/E10F54B1OGM7M4LTRX5Z3L4K0/journal.jif

Any insight would be very valuable for our planning processes.

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130802/8f05b64a/attachment.htm>

From matthias at rabbitmq.com  Sat Aug  3 03:42:52 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 Aug 2013 03:42:52 +0100
Subject: [rabbitmq-discuss] connection timeout error in
 ConnectionFactory.newConnection (java)
In-Reply-To: <050b6bdf-d766-4855-8923-649768d6d2b9@googlegroups.com>
References: <82b9ea44-52e2-4fc9-9907-55023f576c77@googlegroups.com>
	<050b6bdf-d766-4855-8923-649768d6d2b9@googlegroups.com>
Message-ID: <51FC6E2C.5030403@rabbitmq.com>

On 01/08/13 10:26, Cheolseung Baek wrote:
> attach the .sasl full log

As my colleague Michael said, please also post the contents of the 
normal (non-sasl) log.

Also, what version of RabbitMQ are you running?

Matthias.

From mathias at globalinn.com  Sat Aug  3 11:20:47 2013
From: mathias at globalinn.com (=?UTF-8?Q?Mathias_Stjernstr=C3=B6m?=)
Date: Sat, 3 Aug 2013 03:20:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Chat backend with chatrooms,
	design/performance question
Message-ID: <54363703-b1ee-4ea8-bc7e-aae73976ebce@googlegroups.com>

Hi.

We are currently implementing/rewriting our backend chat engine. Lets say 
we have 100 rooms with 500-1000 consumers in each room. To each room there 
is one publisher.

We have tried two different implementations (but without real data). 

1. We use a single Topic Exchange where messages are distrubuted to each 
room based on routing keys

2. We use one Fanout Exchange per room

Anyone have ideas/thoughts of which would be better in a 
performance/scalabillity point of view? 

Best regards

Mathias


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130803/bfb8fe23/attachment.htm>

From mklishin at gopivotal.com  Sat Aug  3 14:22:20 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 03 Aug 2013 17:22:20 +0400
Subject: [rabbitmq-discuss] Chat backend with chatrooms,
 design/performance question
In-Reply-To: <54363703-b1ee-4ea8-bc7e-aae73976ebce@googlegroups.com>
References: <54363703-b1ee-4ea8-bc7e-aae73976ebce@googlegroups.com>
Message-ID: <51FD040C.2030001@gopivotal.com>

Mathias Stjernstr?m escribi?:
> 2. We use one Fanout Exchange per room
> 
> Anyone have ideas/thoughts of which would be better in a
> performance/scalabillity point of view? 

1 fanout exchange per room, and one server-named queue per chat
participant. Then extremely busy rooms will have less effect on other rooms.

Exchange-to-Exchange bindings offer another alternative but it's hard to
predict how it's going to perform and it's more complicated conceptually.

And, like with any performance considerations, I highly recommend
you to benchmark both approaches and see what the data says.
-- 
MK

From matwey.kornilov at gmail.com  Sun Aug  4 09:46:55 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Sun, 04 Aug 2013 12:46:55 +0400
Subject: [rabbitmq-discuss] x-lvc exchange
Message-ID: <ktl4do$71e$1@ger.gmane.org>

Hi,

Are there any plans to include 
https://github.com/simonmacmullen/rabbitmq-lvc-plugin to official release?


From david.tinker at gmail.com  Mon Aug  5 07:12:27 2013
From: david.tinker at gmail.com (David Tinker)
Date: Mon, 5 Aug 2013 08:12:27 +0200
Subject: [rabbitmq-discuss] ANN QDB 0.4.4 Released with backup for RabbitMQ
	queues
Message-ID: <CA+O6_FdwbcERifF7TED0hRkMAKkbcB_FyGbvZWrVwt3iDD_96A@mail.gmail.com>

QDB can now backup RabbitMQ queues and replay messages by timestamp.

http://qdb.io/

Backup/Replay RabbitMQ Queue
- Backup messages from a queue
- Replay by timestamp as needed
- Watch incoming messages with curl
- Alerts and monitoring

Push To Remote RabbitMQ Server
- Simple HTTP POST to send messages to RabbitMQ
- Your app is protected from network partitions or RabbitMQ downtime
- Replay by timestamp if downstream processing fails
- Easier than running RabbitMQ on both servers with a shovel
- Low memory footprint (run on an EC2 micro instance)

From kbiton at outbrain.com  Mon Aug  5 07:58:07 2013
From: kbiton at outbrain.com (Kobi Biton)
Date: Mon, 5 Aug 2013 09:58:07 +0300
Subject: [rabbitmq-discuss] flow control blocked producers vs consumers
In-Reply-To: <51FBC129.2080604@rabbitmq.com>
References: <d1a6f0e0-78af-4540-8ded-0b66c6ddee56@googlegroups.com>
	<207BC147-BFF1-40AE-BAC6-44C23C06E2DE@gopivotal.com>
	<CAKCS0Ay5ng+rjXnWGPkY+AhMeh_mxEFXoo5Fr7oy0frrYJb5xg@mail.gmail.com>
	<51FBC129.2080604@rabbitmq.com>
Message-ID: <CAKCS0AzmSOX6+RipVtApRDGHZdq7rZmid9DT3AvOoJFVmUkhnQ@mail.gmail.com>

you are 100% right after a cerfull look consumers (which are on a
separated channels) were not blocked , the problem was the producers
which flow control blocks.
That said the results of blocked producers , I will execute the
rabbitmqctl report when the problem reproduces and share this.

Our current suspicion is that the consumers cannot write fast enough
to the graphite thus slowing down the producers until they get
blocked.

Thanks!
Kobi

On Fri, Aug 2, 2013 at 5:24 PM, Emile Joubert <emile at rabbitmq.com> wrote:
> On 26/07/13 12:39, Kobi Biton wrote:
>> Our logstash consumers do use their own connection , we do not use the
>> same connection for publishing (logstash rabbitmq output) and for
>> consuming (logstash rabbitmq input) , I was under the impression that
>> the consumers are blocked due to the fact that when rabbitmq starts to
>> block producers due to flow rates looking at the logstash consumers
>> logs I see errors connecting to the broker (connection reset by host)
>> which implies that the broker rejects the consumers connection this of
>> course leads us to shaky state where messages are no delivered and the
>> only workaround we found is capturing the blocked producers list from
>> rabbitmq_ctl and restarting the logstash agents by looping on all the
>> blocked producers.
>
>
> If publishers and consumers use separate connections then blocking of
> publishers due to flow control won't affect consumers directly. Though
> if publishers slow down that will eventually slow down consumers too
> when queues are empty.
>
> Can you explain what you mean when you say consumers are blocked? Are
> there messages available in queues that are not being delivered? It
> should be possible to determine the reason for messages not being
> delivered if you provide the output of "rabbitmqctl report".
>
>
>
>
>
> -Emile
>
>
>
>
>
>

-- 
The above terms reflect a potential business arrangement, are provided solely 
as a basis for further discussion, and are not intended to be and do not 
constitute a legally binding obligation. No legally binding obligations will 
be created, implied, or inferred until an agreement in final form is executed 
in writing by all parties involved.

This email and any attachments hereto may be confidential or privileged. 
 If you received this communication by mistake, please don't forward it to 
anyone else, please erase all copies and attachments, and please let me 
know that it has gone to the wrong person. Thanks.

From yby538 at 163.com  Sat Aug  3 14:17:28 2013
From: yby538 at 163.com (yby538)
Date: Sat, 3 Aug 2013 21:17:28 +0800
Subject: [rabbitmq-discuss] A question when using rabbitmq   Thanks
Message-ID: <5ba3c874.208c.1404453395b.Coremail.yby538@163.com>

Hi,All,

I am a Rabbitmq user in China.We are in trouble with a question when we are using rabbitmq,and i am sorry to not get useful information in Rabbitmq documents and using google.So I have to send you an e-mail.My question is:

I have declared a queuqe in memory,so how can i get the size of the queue anytime?Is there some APIs we can use?(We have to use this method in my project if it is possible)how can i check whether the queue is empty or not?

Thanks very much.

Regards,

Bangyu Ye


2013-08-03



????????????

???????????????
Bangyu,Ye
Institute of Information Engineering,
Chinese Academy of Sciences
Beijing,P.R.China
Zip code: 100093
Email:  yebangyu at iie.ac.cn   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130803/5f2d1581/attachment.htm>

From mklishin at gopivotal.com  Mon Aug  5 09:15:32 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 05 Aug 2013 12:15:32 +0400
Subject: [rabbitmq-discuss] A question when using rabbitmq   Thanks
In-Reply-To: <5ba3c874.208c.1404453395b.Coremail.yby538@163.com>
References: <5ba3c874.208c.1404453395b.Coremail.yby538@163.com>
Message-ID: <51FF5F24.2030000@gopivotal.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

yby538 escribi?:
> I have declared a queuqe in memory,so how can i get the size of the 
> queue anytime?Is there some APIs we can use?(We have to use this
> method in my project if it is possible)how can i check whether the
> queue is empty or not?

There are two ways: use basic.declare with passive = true and see
message count on the response (basic.queue-ok), or use HTTP API [1].

1.
http://hg.rabbitmq.com/rabbitmq-management/raw-file/fbdc912fa1e5/priv/www/api/index.html
- -- 
MK
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (Darwin)
Comment: GPGTools - http://gpgtools.org
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJR/18kAAoJEFAGXKZn4yVAQLMH+gJdYx64PfGC4Hn8JTa5fH5g
wpF5jTQGZAQKm3HQpR2qavefbUqe2SPzZ/VNxf7aY0cbhHbAlPWnUp71xZvHX2IJ
MlaY0RGCl1dr71ZeXago7AVequILFI2J+tdO6sR2rEC2vKhV5jLmt3bj/8gDnBuq
McAyeEdGYZgrbFO/vwJZEJFREmmDTpinMa5axktiEY17dILwgGNw3cZl8T5KrP+z
3Yqd/gHjYNSU+elorJ5nLkmGevZR4TFH0SD9zwrn7LBTLaRtEe8T0++ALm+Y2eD9
rlxLwM81v6gsizlfcfbd0Bci3uGKl5XatxjVHR96o/ti2aWJhL2H9dFBgwInurg=
=EOMG
-----END PGP SIGNATURE-----

From simon at rabbitmq.com  Mon Aug  5 09:51:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Aug 2013 09:51:00 +0100
Subject: [rabbitmq-discuss] x-lvc exchange
In-Reply-To: <ktl4do$71e$1@ger.gmane.org>
References: <ktl4do$71e$1@ger.gmane.org>
Message-ID: <51FF6774.9010801@rabbitmq.com>

On 04/08/2013 09:46, Matwey V. Kornilov wrote:
> Are there any plans to include
> https://github.com/simonmacmullen/rabbitmq-lvc-plugin to official release?

Probably not, at the moment it has quite a few limitations. We are 
exploring different options for LVC though, there might be a rewritten 
LVC plugin in the future.

Cheers, Simon


From simon at rabbitmq.com  Mon Aug  5 09:53:57 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Aug 2013 09:53:57 +0100
Subject: [rabbitmq-discuss] A question when using rabbitmq   Thanks
In-Reply-To: <51FF5F24.2030000@gopivotal.com>
References: <5ba3c874.208c.1404453395b.Coremail.yby538@163.com>
	<51FF5F24.2030000@gopivotal.com>
Message-ID: <51FF6825.3090405@rabbitmq.com>

On 05/08/2013 09:15, Michael Klishin wrote:
> yby538 escribi?:
>> I have declared a queuqe in memory,so how can i get the size of the
>> queue anytime?Is there some APIs we can use?(We have to use this
>> method in my project if it is possible)how can i check whether the
>> queue is empty or not?
>
> There are two ways: use basic.declare with passive = true and see
> message count on the response (basic.queue-ok), or use HTTP API [1].

You don't *have* to declare with passive = true, you get the same 
queue.declare-ok information back with passive = false.

Also there's a third way: "rabbitmqctl list_queues name messages" or 
similar.

Cheers, Simon


From matwey.kornilov at gmail.com  Mon Aug  5 10:01:30 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Mon, 5 Aug 2013 13:01:30 +0400
Subject: [rabbitmq-discuss] x-lvc exchange
In-Reply-To: <51FF6774.9010801@rabbitmq.com>
References: <ktl4do$71e$1@ger.gmane.org> <51FF6774.9010801@rabbitmq.com>
Message-ID: <CAJs94EbMBUf98sv=3SJOnd_M6qtekGWWKH91TVFzt22QuQA8YQ@mail.gmail.com>

Ok, thank you. I think there is a lack of such functionality. Maybe
not necessary dedicated exchange type, but some parameter to direct
exchange would be nice. As far as I understand you put bindings inside
mnesia in any case, so there should be no big difference to put
something else with routing_key.


2013/8/5 Simon MacMullen <simon at rabbitmq.com>:
> On 04/08/2013 09:46, Matwey V. Kornilov wrote:
>>
>> Are there any plans to include
>> https://github.com/simonmacmullen/rabbitmq-lvc-plugin to official release?
>
>
> Probably not, at the moment it has quite a few limitations. We are exploring
> different options for LVC though, there might be a rewritten LVC plugin in
> the future.
>
> Cheers, Simon
>



-- 
With best regards,
Matwey V. Kornilov
http://0x2207.blogspot.com
xmpp:0x2207 at jabber.ru

From simon at rabbitmq.com  Mon Aug  5 10:04:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Aug 2013 10:04:42 +0100
Subject: [rabbitmq-discuss] x-lvc exchange
In-Reply-To: <CAJs94EbMBUf98sv=3SJOnd_M6qtekGWWKH91TVFzt22QuQA8YQ@mail.gmail.com>
References: <ktl4do$71e$1@ger.gmane.org> <51FF6774.9010801@rabbitmq.com>
	<CAJs94EbMBUf98sv=3SJOnd_M6qtekGWWKH91TVFzt22QuQA8YQ@mail.gmail.com>
Message-ID: <51FF6AAA.4010208@rabbitmq.com>

On 05/08/2013 10:01, Matwey V. Kornilov wrote:
> Ok, thank you. I think there is a lack of such functionality. Maybe
> not necessary dedicated exchange type, but some parameter to direct
> exchange would be nice. As far as I understand you put bindings inside
> mnesia in any case, so there should be no big difference to put
> something else with routing_key.

The trouble with putting things in Mnesia is it's not all that fast. The 
current LVC exchange uses Mnesia in this way and thus is quite slow 
(especially in a cluster) - that's a prime thing we'd want to change.

Cheers, Simon

From mklishin at gopivotal.com  Mon Aug  5 10:28:13 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 05 Aug 2013 13:28:13 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.10.0
Message-ID: <51FF702D.2020306@gopivotal.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Bunny 0.10.0 is released [1].

This is a minor feature release that has one *breaking API change*.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/08/05/bunny-0-dot-10-dot-0-is-released/

1. http://rubygems.org/gems/bunny/versions/0.10.0
- -- 
MK
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (Darwin)
Comment: GPGTools - http://gpgtools.org
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJR/3AsAAoJEFAGXKZn4yVAWDIH/Akr9aWe1A41yMsQIrvi1JC8
x8RutfPfzB5XLW0svrGtJrZ2nIRWlaDLyLJJ5fwZXMMAsXF/Dau6z/rK/Os/ITbS
cVvc+8mUktcJEimWXWNHCwett4Dcyv4n1+6cjjG+Ddy/bljTauDorI1dsqRVbr8q
J7/H4YbOfXKP66PY37uvEdNFD5C5RGWlwKlnNwwM5hzmB7USxIn4l6/gzLywLmIj
ZDkV0ATGVDz7RaXhMBZxGb8t46U2HcgYghdWYKFKbgjXJR0qgB6+sXae3cJd4peY
NwuJZj/LyCSCv6HCaCel1WEq5+umUNqMNxwrH41IfgdUhOlojU+JhFQrALwK5/E=
=ETtk
-----END PGP SIGNATURE-----

From simon at rabbitmq.com  Mon Aug  5 10:59:57 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Aug 2013 10:59:57 +0100
Subject: [rabbitmq-discuss] Question on RabbitMQ and file I/O
	characteristics
In-Reply-To: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>
References: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>
Message-ID: <51FF779D.6040302@rabbitmq.com>

That filename is typical of those of a queue index journal. That's the 
file that records the state of messages in the queue - when a message 
has been published, when it's been confirmed (transactional publish is 
internally implemented in terms of confirms), when it's been delivered, 
and when it's been acknowledged (I assume you are using acks).

So it is very possible to get four disk writes to the journal per 
message for publish / confirm / deliver / ack.

At 40 msg/s you are publishing slowly enough that RabbitMQ probably 
won't start to coalesce these events together. So as you start to 
publish faster you should start to see fewer writes per message - 
eventually you should see many messages per write.

Therefore I wouldn't try to scale the numbers you're seeing up to 
predict anything - you're likely to be much better off running some 
benchmark with MulticastMain or similar.

Cheers, Simon

On 03/08/2013 01:08, Matt Pietrek wrote:
> Just want to run this past the RabbitMQ devs and see if this jibes with
> their expectations.
>
> Our typical cluster runs RabbitMQ 3.02 on Ubuntu 10.04 on two nodes.
> All queues are mirrored. All our channels are opened in transactional
> mode. (We know, this causes things to go slower - That's OK with us, we
> really want to avoid message loss.)
>
> What I'm seeing is that for each message written to the broker, we see
> approximately four disk writes. That is, if the broker is doing 40
> messages/sec, we see ~160 disk writes. We're getting these number from
>
> Is this about what should be expected when running this way?
>
> If it helps, I dug in a bit more to see what the files were. The vast
> majority of the activity seems to be to files like this:
>
> msg_store_persistent/743.rdq
> queues/E10F54B1OGM7M4LTRX5Z3L4K0/journal.jif
>
> Any insight would be very valuable for our planning processes.
>
> Thanks,
>
> Matt
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From matwey.kornilov at gmail.com  Mon Aug  5 14:14:11 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Mon, 05 Aug 2013 17:14:11 +0400
Subject: [rabbitmq-discuss] web-stomp reply-to
Message-ID: <kto8es$roo$1@ger.gmane.org>

Hi,

I am doing RPC-pattern as following:

client.send('/exchange/name/key', {"reply-to":"/temp-queue/reply"}, 'msg');

What I can not understand is where should I wait an reply :) It seems 
that web-stomp don't support /temp-queue/... Is it?


From Punit.Jain at emc.com  Mon Aug  5 15:24:53 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Mon, 5 Aug 2013 10:24:53 -0400
Subject: [rabbitmq-discuss] Federation setup query
Message-ID: <DB14E94115BBC84E8960C12C176D067639FB7E0D@MX25A.corp.emc.com>

Hi,
I want to setup federation b/w two brokers called A (Downstream) and B (Upstream). We have redundant network link between these two brokers. B has two IPs, named IP1 and IP2. I have setup federation in following way

I created two upstreams:

rabbitmqctl set_parameter federation-upstream site-b-1 '{"uri":"amqp://IP1","max-hops":1}'

rabbitmqctl set_parameter federation-upstream site-b-2 '{"uri":"amqp://IP2","max-hops":1}'

Then I created one policy:

rabbitmqctl set_policy federate-test "ExchangeName" '{"federation-upstream-set":"MyUpstreamSet"}'



Then I put the both upstreams in the upstream set:

rabbitmqctl set_parameter federation-upstream-set MyUpstreamSet '[{"upstream":"site-b-1","exchange":" ExchangeName"}, {"upstream":"site-b-2","exchange":" ExchangeName"}]'


I have tested this setup and it is working fine. I have few questions regarding this setup:

*         Is it wise to create a single upstream with two uris? Or the above setup is good and will provide network high availability incase if a network link goes down?

*         Though we have specified two upstream, but when we list exchanges and queues on broker B it shows only one x-federation-upstream and a single upstream queue, and there is no duplication of messages. This is the exact behavior we expect, but I want to understand that how does RabbitMQ achieve this behavior and avoid duplication. It would be a great help if you can point me to some documentation or a link.

*         Any suggestion or advice to improve this configuration.


Thanks,
Punit


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130805/0835a401/attachment.htm>

From simon at rabbitmq.com  Mon Aug  5 17:52:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Aug 2013 17:52:12 +0100
Subject: [rabbitmq-discuss] Federation setup query
In-Reply-To: <DB14E94115BBC84E8960C12C176D067639FB7E0D@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D067639FB7E0D@MX25A.corp.emc.com>
Message-ID: <51FFD83C.1050401@rabbitmq.com>

On 05/08/13 15:24, Jain, Punit wrote:
> I want to setup federation b/w two brokers called A (Downstream) and B
> (Upstream). We have redundant network link between these two brokers. B
> has two IPs, named IP1 and IP2. I have setup federation in following way

<snip>

> I have tested this setup and it is working fine. I have few questions
> regarding this setup:
>
> ?Is it wise to create a single upstream with two uris? Or the above
> setup is good and will provide network high availability incase if a
> network link goes down?

I would create a single upstream with two URIs. Both configurations will 
provide network high availability, but if you have two upstreams you can 
see messages being reordered.

> ?Though we have specified two upstream, but when we list exchanges and
> queues on broker B it shows only one x-federation-upstream and a single
> upstream queue

These objects are identified in the upstream broker by the name of the 
downstream broker - therefore if you have a single downstream connecting 
more than once you will have multiple federation links sharing the same 
queue / exchange. This is not how it's designed to work.

> and there is no duplication of messages. This is the
> exact behavior we expect, but I want to understand that how does
> RabbitMQ achieve this behavior and avoid duplication. It would be a
> great help if you can point me to some documentation or a link.

There won't be duplication since there's only one upstream queue. 
However since you have two links consuming from it and publishing to the 
same exchange, messages can overtake each other and become reordered. 
Also the links will consider themselves to each own the 
x-federation-upstream exchange and the upstream queue; they may tread on 
each others toes here. So...

> Any suggestion or advice to improve this configuration.

...you shouldn't point two upstreams to the same cluster.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mpietrek at skytap.com  Mon Aug  5 18:11:37 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 5 Aug 2013 10:11:37 -0700
Subject: [rabbitmq-discuss] Question on RabbitMQ and file I/O
	characteristics
In-Reply-To: <51FF779D.6040302@rabbitmq.com>
References: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>
	<51FF779D.6040302@rabbitmq.com>
Message-ID: <CACLE7iyDFtqS7ZWUr5TNmU-Ou-fE7CUBru3owpekRtLYWk0U=A@mail.gmail.com>

Thanks for the background Simon.

One statement caught my attention though:

> At 40 msg/s you are publishing slowly enough that RabbitMQ probably won't
start to coalesce these events together.

In my original message I didn't lay out all my results - I was trying to
keep the question simple. That said, the 4 write/sec pattern held up at
higher rates. For instance, on a machine with a faster disk, the same test
could do 400 messages/sec, and per tools like sar, were seeing 1600 disk
writes/sec.

As you can imagine, at those I/O rater we're rapidly coming close to the
disk's ability to keep up, thus the question about the writes/message rates.

So with this additional context, any additional insight?

Thanks,

Matt


On Mon, Aug 5, 2013 at 2:59 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> That filename is typical of those of a queue index journal. That's the
> file that records the state of messages in the queue - when a message has
> been published, when it's been confirmed (transactional publish is
> internally implemented in terms of confirms), when it's been delivered, and
> when it's been acknowledged (I assume you are using acks).
>
> So it is very possible to get four disk writes to the journal per message
> for publish / confirm / deliver / ack.
>
> At 40 msg/s you are publishing slowly enough that RabbitMQ probably won't
> start to coalesce these events together. So as you start to publish faster
> you should start to see fewer writes per message - eventually you should
> see many messages per write.
>
> Therefore I wouldn't try to scale the numbers you're seeing up to predict
> anything - you're likely to be much better off running some benchmark with
> MulticastMain or similar.
>
> Cheers, Simon
>
>
> On 03/08/2013 01:08, Matt Pietrek wrote:
>
>> Just want to run this past the RabbitMQ devs and see if this jibes with
>> their expectations.
>>
>> Our typical cluster runs RabbitMQ 3.02 on Ubuntu 10.04 on two nodes.
>> All queues are mirrored. All our channels are opened in transactional
>> mode. (We know, this causes things to go slower - That's OK with us, we
>> really want to avoid message loss.)
>>
>> What I'm seeing is that for each message written to the broker, we see
>> approximately four disk writes. That is, if the broker is doing 40
>> messages/sec, we see ~160 disk writes. We're getting these number from
>>
>> Is this about what should be expected when running this way?
>>
>> If it helps, I dug in a bit more to see what the files were. The vast
>> majority of the activity seems to be to files like this:
>>
>> msg_store_persistent/743.rdq
>> queues/**E10F54B1OGM7M4LTRX5Z3L4K0/**journal.jif
>>
>> Any insight would be very valuable for our planning processes.
>>
>> Thanks,
>>
>> Matt
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130805/a359d1b1/attachment.htm>

From Punit.Jain at emc.com  Mon Aug  5 18:14:37 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Mon, 5 Aug 2013 13:14:37 -0400
Subject: [rabbitmq-discuss] Federation setup query
In-Reply-To: <51FFD83C.1050401@rabbitmq.com>
References: <DB14E94115BBC84E8960C12C176D067639FB7E0D@MX25A.corp.emc.com>
	<51FFD83C.1050401@rabbitmq.com>
Message-ID: <DB14E94115BBC84E8960C12C176D067639FB7E10@MX25A.corp.emc.com>

Thanks a lot Simon for detailed explanation, this answers my questions precisely.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, August 05, 2013 10:22 PM
To: Discussions about RabbitMQ
Cc: Jain, Punit
Subject: Re: [rabbitmq-discuss] Federation setup query

On 05/08/13 15:24, Jain, Punit wrote:
> I want to setup federation b/w two brokers called A (Downstream) and B 
> (Upstream). We have redundant network link between these two brokers. 
> B has two IPs, named IP1 and IP2. I have setup federation in following 
> way

<snip>

> I have tested this setup and it is working fine. I have few questions 
> regarding this setup:
>
> *Is it wise to create a single upstream with two uris? Or the above 
> setup is good and will provide network high availability incase if a 
> network link goes down?

I would create a single upstream with two URIs. Both configurations will provide network high availability, but if you have two upstreams you can see messages being reordered.

> *Though we have specified two upstream, but when we list exchanges and 
> queues on broker B it shows only one x-federation-upstream and a 
> single upstream queue

These objects are identified in the upstream broker by the name of the downstream broker - therefore if you have a single downstream connecting more than once you will have multiple federation links sharing the same queue / exchange. This is not how it's designed to work.

> and there is no duplication of messages. This is the exact behavior we 
> expect, but I want to understand that how does RabbitMQ achieve this 
> behavior and avoid duplication. It would be a great help if you can 
> point me to some documentation or a link.

There won't be duplication since there's only one upstream queue. 
However since you have two links consuming from it and publishing to the same exchange, messages can overtake each other and become reordered. 
Also the links will consider themselves to each own the x-federation-upstream exchange and the upstream queue; they may tread on each others toes here. So...

> Any suggestion or advice to improve this configuration.

...you shouldn't point two upstreams to the same cluster.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal


From goyalk at vmware.com  Mon Aug  5 19:15:27 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Mon, 5 Aug 2013 11:15:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Where can I see current list of bugs filed on
	RabbitMQ?
Message-ID: <0c82e6f7.00000de8.00000003@KAPILPC.vmware.com>

Hi,

 

The way we are deploying RabbitMQ in customer environment will make it
hard for us to upgrade. So, we need to decide on a stable build. We are
currently on 3.0.2 and have been advised on this forum to upgrade to
3.1.3. I'd like to look at the bug-list for 3.1.3 before deciding to
upgrade. I'd also welcome any suggestions on choosing a stable build. I am
not currently utilizing clustering/federation, just the basic single node
messaging.

 

Thanks

Kapil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130805/ceaba36f/attachment.htm>

From matthias at rabbitmq.com  Mon Aug  5 19:30:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 05 Aug 2013 19:30:44 +0100
Subject: [rabbitmq-discuss] Where can I see current list of bugs filed
 on RabbitMQ?
In-Reply-To: <0c82e6f7.00000de8.00000003@KAPILPC.vmware.com>
References: <0c82e6f7.00000de8.00000003@KAPILPC.vmware.com>
Message-ID: <51FFEF54.9060800@rabbitmq.com>

Kapil,

On 05/08/13 19:15, Kapil Goyal wrote:
> I?d like to look at the bug-list for 3.1.3 before deciding to
> upgrade.

http://www.rabbitmq.com/changelog.html (click on the 'changes' links for
the detailed info).

> I?d also welcome any suggestions on choosing a stable build.

3.1.3.

Matthias.

From goyalk at vmware.com  Mon Aug  5 22:24:47 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Mon, 5 Aug 2013 14:24:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Where can I see current list of bugs filed
	on RabbitMQ?
In-Reply-To: <51FFEF54.9060800@rabbitmq.com>
References: <0c82e6f7.00000de8.00000003@KAPILPC.vmware.com>
	<51FFEF54.9060800@rabbitmq.com>
Message-ID: <06714905.00000de8.0000000c@KAPILPC.vmware.com>

Thanks Matthias. But you have directed me to the list of bugs that were
fixed in 3.1.3 (and older). I am interested in bugs that are currently
filed against 3.1.3.

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Monday, August 05, 2013 11:31 AM
To: Discussions about RabbitMQ
Cc: Kapil Goyal
Subject: Re: [rabbitmq-discuss] Where can I see current list of bugs filed
on RabbitMQ?

Kapil,

On 05/08/13 19:15, Kapil Goyal wrote:
> I'd like to look at the bug-list for 3.1.3 before deciding to upgrade.

http://www.rabbitmq.com/changelog.html (click on the 'changes' links for
the detailed info).

> I'd also welcome any suggestions on choosing a stable build.

3.1.3.

Matthias

From matthias at rabbitmq.com  Mon Aug  5 22:28:01 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 05 Aug 2013 22:28:01 +0100
Subject: [rabbitmq-discuss] Where can I see current list of bugs filed
 on RabbitMQ?
In-Reply-To: <06714905.00000de8.0000000c@KAPILPC.vmware.com>
References: <0c82e6f7.00000de8.00000003@KAPILPC.vmware.com>
	<51FFEF54.9060800@rabbitmq.com>
	<06714905.00000de8.0000000c@KAPILPC.vmware.com>
Message-ID: <520018E1.2090506@rabbitmq.com>

Kapil,

On 05/08/13 22:24, Kapil Goyal wrote:
> Thanks Matthias. But you have directed me to the list of bugs that were
> fixed in 3.1.3 (and older). I am interested in bugs that are currently
> filed against 3.1.3.

Oh I see. There isn't a (public) list like that.

We generally have few regressions, so the latest release is nearly 
always the most stable.

Matthias.

From jchappelle at 4redi.com  Tue Aug  6 06:54:14 2013
From: jchappelle at 4redi.com (jchappelle)
Date: Mon, 5 Aug 2013 22:54:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Reason not to use QueueingConsumer?
Message-ID: <1375768454923-28593.post@n5.nabble.com>

I'm just starting to use RabbitMQ and I was wondering if there is a
compelling reason not to use QueueingConsumer. It seems to serve my purpose
well but I'm still in the testing phase. I just want to make sure I'm not
missing something because the javadoc says it is deprecated, although it
doesn't have the standard deprecated annotation. 

The only problem I can see is that memory could fill up if my consumer is
not keeping up with the producer.

Thanks for any help you can give me!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Reason-not-to-use-QueueingConsumer-tp28593.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Tue Aug  6 08:08:39 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 6 Aug 2013 00:08:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection count on node crash
Message-ID: <1375772919286-28594.post@n5.nabble.com>

Had a node crashed in a cluster. All clients then reconnected, but the old
connections to the crashed node was still reported by the mgmt api.
Shouldn't connection stats for connections to a node which is down be
automatically cleared? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-count-on-node-crash-tp28594.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Tue Aug  6 08:15:51 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 6 Aug 2013 00:15:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Node crash
Message-ID: <1375773351869-28595.post@n5.nabble.com>

Had a node crash in a cluster (due to memory exhaustion). When clients then
reconnected to a healthy node, bind commands failed to return. And when the
crashed node was restarted the logs was flooded with: 

=ERROR REPORT==== 5-Aug-2013::23:45:50 ===
Discarding message
{'$gen_call',{<0.7975.0>,#Ref<0.0.0.244595>},{deliver,{delivery,true,<5068.31152.5031>,{basic_message,{resource,<<8
bytes>>,exchange,<<16 bytes>>},[<<7 bytes>>],{content,60,{'P_basic',<<24
bytes>>,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined},<<27
bytes>>,rabbit_framing_amqp_0_9_1,[<<299 bytes>>]},<<16
bytes>>,false},396},true}} from <0.7975.0> to <0.26389.5794> in an old
incarnation (3) of this node (1)

The only solution was to restart all nodes in the cluster. 




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Node-crash-tp28595.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.justin at gmx.net  Tue Aug  6 08:24:04 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 06 Aug 2013 09:24:04 +0200
Subject: [rabbitmq-discuss] ANN: Habari Client for RabbitMQ - Delphi and
	Free Pascal client
Message-ID: <ktq8ak$3vj$1@ger.gmane.org>

August 6, 2013 - Habarisoft released version 1.7 of Habari Client for 
RabbitMQ, a Delphi and Free Pascal client library for the RabbitMQ 
message broker.

New features in this release
* Remote Procedure Call (RPC) demo program
* Heart-beating tests use a mock STOMP server
* Connection parameter "subscribe.receipt" to request and verify broker 
confirmations for subscriptions
* Connection pool example implementation

Tested with RabbitMQ 3.1.3, Free Pascal 2.6.2, Internet Direct (Indy) 10.6

Home page and demo download:

http://www.habarisoft.com/habari_rabbitmq.html

-- 
Michael Justin


From mklishin at gopivotal.com  Tue Aug  6 09:27:23 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 6 Aug 2013 12:27:23 +0400
Subject: [rabbitmq-discuss] Reason not to use QueueingConsumer?
In-Reply-To: <1375768454923-28593.post@n5.nabble.com>
References: <1375768454923-28593.post@n5.nabble.com>
Message-ID: <F57D4AD8-28AE-4538-A6D4-9278D070EDE9@gopivotal.com>

jchappelle:

> The only problem I can see is that memory could fill up if my consumer is
> not keeping up with the producer.

That's the primary downside, it uses an unbounded queue to collect deliveries,
which may cause an OOM exception.

By the way, could you point me to the page that says it's deprecated?
We should either add a proper annotation or revisit this decision because QueueingConsumer
is still used in one of the tutorials.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/6e44886a/attachment.pgp>

From 314992959 at qq.com  Tue Aug  6 09:46:20 2013
From: 314992959 at qq.com (3k4b251)
Date: Tue, 6 Aug 2013 01:46:20 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq server Mnesia   backup and restore
Message-ID: <1375778780916-28598.post@n5.nabble.com>

how to  backup and  restore   messages  queues  exchanges  on  node?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-server-Mnesia-backup-and-restore-tp28598.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue Aug  6 10:15:27 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 06 Aug 2013 10:15:27 +0100
Subject: [rabbitmq-discuss] rabbitmq server Mnesia   backup and restore
In-Reply-To: <1375778780916-28598.post@n5.nabble.com>
References: <1375778780916-28598.post@n5.nabble.com>
Message-ID: <5200BEAF.6060507@rabbitmq.com>


Hi,


On 06/08/13 09:46, 3k4b251 wrote:
> how to  backup and  restore   messages  queues  exchanges  on  node?


If you  just want to  backup the  broker config  then  do that by
saving  and loading  the definitions  using the  management plugin:
http://www.rabbitmq.com/management.html#load-definitions



If you  want to backup the messages as  well  then you should  stop  the
broker and  save the Mnesia  database directory.  Only durable
resources can  be backed up this way,  and only  persistent messages
will survive  when you restore.  Bear in mind  the  impact  on message
TTL  when  messages spend  time  backed up.





-Emile





From simon at rabbitmq.com  Tue Aug  6 10:32:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Aug 2013 10:32:52 +0100
Subject: [rabbitmq-discuss] Connection count on node crash
In-Reply-To: <1375772919286-28594.post@n5.nabble.com>
References: <1375772919286-28594.post@n5.nabble.com>
Message-ID: <5200C2C4.2020703@rabbitmq.com>

On 06/08/13 08:08, carlhoerberg wrote:
> Had a node crashed in a cluster. All clients then reconnected, but the old
> connections to the crashed node was still reported by the mgmt api.
> Shouldn't connection stats for connections to a node which is down be
> automatically cleared?

There was a bug to that effect fixed in 3.0.3. Are you running an older 
version?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From carl.hoerberg at gmail.com  Tue Aug  6 10:37:58 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 6 Aug 2013 02:37:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection count on node crash
In-Reply-To: <5200C2C4.2020703@rabbitmq.com>
References: <1375772919286-28594.post@n5.nabble.com>
	<5200C2C4.2020703@rabbitmq.com>
Message-ID: <987DBEB51A5247D0B11E622C4FE26F14@gmail.com>

This was a 3.0.3 and 3.0.4 server running in a cluster, it was the 3.0.4 node that crashed. 



On Tuesday 6 August 2013 at 11:34, Simon MacMullen-2 [via RabbitMQ] wrote:

> On 06/08/13 08:08, carlhoerberg wrote: 
> > Had a node crashed in a cluster. All clients then reconnected, but the old 
> > connections to the crashed node was still reported by the mgmt api. 
> > Shouldn't connection stats for connections to a node which is down be 
> > automatically cleared? 
> 
> 
> There was a bug to that effect fixed in 3.0.3. Are you running an older 
> version? 
> 
> Cheers, Simon 
> 
> -- 
> Simon MacMullen 
> RabbitMQ, Pivotal 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=28600&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Connection-count-on-node-crash-tp28594p28600.html 
> To unsubscribe from Connection count on node crash, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=28594&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218Mjg1OTR8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-count-on-node-crash-tp28594p28601.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/e7cf8938/attachment.htm>

From vashi.priyanki at gmail.com  Tue Aug  6 11:01:52 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Tue, 6 Aug 2013 03:01:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Not able to enable rabbitmq_tracing plugin in
 3.1.3 with Erlang-R16B01
Message-ID: <97d2ec88-2338-4701-b449-d770614207d3@googlegroups.com>

Hi There ,

I am facing problems with enabling rabbitmq_tracing plugin with 3.1.3 
version. There is .ez file also in proper location for this plugin and I 
can see tracing plugin in the list of plugin. I have followed the steps as 
per guidelines on rabbitmq web page.

1) Enabled the plugin using command 'sudo rabbitmq_plugins enable 
rabbitmq_tracing' - When I run this command, it says plugin enabled 
successfully and suggest to restart rabbitmq server to get it active in web 
interface. 

2) Restarted the rabbitmq server. - After restarting everything is fine and 
no error but plugin is still not enabled. 

I have tried both on mac and linux but it's the same result. 

Any idea ? 

Is there a real problem with this plugin or I am doing something wrong ?

Please advise.

Thanks // P
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/81284603/attachment.htm>

From simon at rabbitmq.com  Tue Aug  6 11:08:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Aug 2013 11:08:36 +0100
Subject: [rabbitmq-discuss] Not able to enable rabbitmq_tracing plugin
 in 3.1.3 with Erlang-R16B01
In-Reply-To: <97d2ec88-2338-4701-b449-d770614207d3@googlegroups.com>
References: <97d2ec88-2338-4701-b449-d770614207d3@googlegroups.com>
Message-ID: <5200CB24.5020800@rabbitmq.com>

There should be a message in the log like:

     =INFO REPORT==== 6-Aug-2013::10:45:46 ===
     Server startup complete; 7 plugins started.

followed by a list of the plugins that were activated. Does it show up 
there?

How are you determining that the plugin is not enabled? What do you 
expect to see?

Cheers, Simon

On 06/08/13 11:01, Priyanki Vashi wrote:
> Hi There ,
>
> I am facing problems with enabling rabbitmq_tracing plugin with 3.1.3
> version. There is .ez file also in proper location for this plugin and I
> can see tracing plugin in the list of plugin. I have followed the steps
> as per guidelines on rabbitmq web page.
>
> 1) Enabled the plugin using command 'sudo rabbitmq_plugins enable
> rabbitmq_tracing' - When I run this command, it says plugin enabled
> successfully and suggest to restart rabbitmq server to get it active in
> web interface.
>
> 2) Restarted the rabbitmq server. - After restarting everything is fine
> and no error but plugin is still not enabled.
>
> I have tried both on mac and linux but it's the same result.
>
> Any idea ?
>
> Is there a real problem with this plugin or I am doing something wrong ?
>
> Please advise.
>
> Thanks // P
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotals

From michael.laing at nytimes.com  Tue Aug  6 11:36:11 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 6 Aug 2013 06:36:11 -0400
Subject: [rabbitmq-discuss] breadth vs depth for topic routing keys
Message-ID: <CAKgmDnHxeRcTy-J6QuE_JTUHye4_M7FdR8t2WVqzuSrM=JfcUg@mail.gmail.com>

We have a routing scheme in which (initially) messages will route to 1 of
10,000 bindings in a set. There are many such sets.

The key is a pseudo-random whole number in the decimal range up to
10,000,000.

The plan is to represent the bindings and routing keys in a way that
results in a compact and fast trie structure within rabbitmq by separating
each digit with a '.', e.g. for a typical key like '1234567' the routing
key would be '1.2.3.4.5.6.7' if expressed in decimal.

But of course the key could be expressed in another base, affecting the
breadth and depth of the trie, e.g. '5.B.A.N' in base 62. A base in the
range of 10 to 62 is probably reasonable.

So for my range, base 10 has a span of 10 and a depth of 9 while base 62
has a span of 62 and a depth of 4. Any thoughts about where the optimum
lies?

Actually, after writing this I realize that I have answered my own
question: since in my case each set of bindings is a random, sparse
representation of the domain, minimizing depth will tend to form a better
trie for any one set - use base 62.

But perhaps the list will find this interesting anyway.

ml
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/88132f8e/attachment.htm>

From emile at rabbitmq.com  Tue Aug  6 11:37:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 06 Aug 2013 11:37:57 +0100
Subject: [rabbitmq-discuss] Node crash
In-Reply-To: <1375773351869-28595.post@n5.nabble.com>
References: <1375773351869-28595.post@n5.nabble.com>
Message-ID: <5200D205.6020004@rabbitmq.com>


Hi Carl,

On 06/08/13 08:15, carlhoerberg wrote:
> Had a node crash in a cluster (due to memory exhaustion). When clients then
> reconnected to a healthy node, bind commands failed to return. And when the
> crashed node was restarted the logs was flooded with: 
> 
> =ERROR REPORT==== 5-Aug-2013::23:45:50 ===
> Discarding message
> {'$gen_call',{<0.7975.0>,#Ref<0.0.0.244595>},{deliver,{delivery,true,<5068.31152.5031>,{basic_message,{resource,<<8
> bytes>>,exchange,<<16 bytes>>},[<<7 bytes>>],{content,60,{'P_basic',<<24
> bytes>>,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined},<<27
> bytes>>,rabbit_framing_amqp_0_9_1,[<<299 bytes>>]},<<16
> bytes>>,false},396},true}} from <0.7975.0> to <0.26389.5794> in an old
> incarnation (3) of this node (1)
> 
> The only solution was to restart all nodes in the cluster. 

One or two of these messages (Discarding message ... in an old
incarnation) does not indicate an error condition, and can safely be
ignored.

If you see large numbers of these messages then that does indicate a
problem. A cause has been identified and fixed since 3.1.3. The release
notes containing the fix will contain the tag "25670". You should
upgrade when this release becomes available.

(You can obtain the fix sooner by building from source, making sure to
use the "stable" branch: http://www.rabbitmq.com/build-server.html)





-Emile






From carl.hoerberg at gmail.com  Tue Aug  6 11:44:26 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 6 Aug 2013 03:44:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Node crash
In-Reply-To: <5200D205.6020004@rabbitmq.com>
References: <1375773351869-28595.post@n5.nabble.com>
	<5200D205.6020004@rabbitmq.com>
Message-ID: <F027924642BB4CFF975CF3804D8657F6@gmail.com>

Excellent! Thanks! 



On Tuesday 6 August 2013 at 12:39, Emile Joubert [via RabbitMQ] wrote:

> 
> Hi Carl, 
> 
> On 06/08/13 08:15, carlhoerberg wrote: 
> 
> > Had a node crash in a cluster (due to memory exhaustion). When clients then 
> > reconnected to a healthy node, bind commands failed to return. And when the 
> > crashed node was restarted the logs was flooded with: 
> > 
> > =ERROR REPORT==== 5-Aug-2013::23:45:50 === 
> > Discarding message 
> > {'$gen_call',{<0.7975.0>,#Ref<0.0.0.244595>},{deliver,{delivery,true,<5068.31152.5031>,{basic_message,{resource,<<8 
> > bytes>>,exchange,<<16 bytes>>},[<<7 bytes>>],{content,60,{'P_basic',<<24 
> > bytes>>,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined},<<27 
> > bytes>>,rabbit_framing_amqp_0_9_1,[<<299 bytes>>]},<<16 
> > bytes>>,false},396},true}} from <0.7975.0> to <0.26389.5794> in an old 
> > incarnation (3) of this node (1) 
> > 
> > The only solution was to restart all nodes in the cluster. 
> One or two of these messages (Discarding message ... in an old 
> incarnation) does not indicate an error condition, and can safely be 
> ignored. 
> 
> If you see large numbers of these messages then that does indicate a 
> problem. A cause has been identified and fixed since 3.1.3. The release 
> notes containing the fix will contain the tag "25670". You should 
> upgrade when this release becomes available. 
> 
> (You can obtain the fix sooner by building from source, making sure to 
> use the "stable" branch: http://www.rabbitmq.com/build-server.html) 
> 
> 
> 
> 
> 
> -Emile 
> 
> 
> 
> 
> 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=28605&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Node-crash-tp28595p28605.html 
> To unsubscribe from Node crash, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=28595&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218Mjg1OTV8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Node-crash-tp28595p28606.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/fcf83796/attachment.htm>

From simon at rabbitmq.com  Tue Aug  6 12:00:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Aug 2013 12:00:00 +0100
Subject: [rabbitmq-discuss] Node crash
In-Reply-To: <5200D205.6020004@rabbitmq.com>
References: <1375773351869-28595.post@n5.nabble.com>
	<5200D205.6020004@rabbitmq.com>
Message-ID: <5200D730.9080606@rabbitmq.com>

On 06/08/13 11:37, Emile Joubert wrote:
> If you see large numbers of these messages then that does indicate a
> problem. A cause has been identified and fixed since 3.1.3. The release
> notes containing the fix will contain the tag "25670". You should
> upgrade when this release becomes available.

Just for clarification, this will be in 3.1.4.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matwey.kornilov at gmail.com  Tue Aug  6 12:21:58 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Tue, 06 Aug 2013 15:21:58 +0400
Subject: [rabbitmq-discuss] stomp and message headers
Message-ID: <ktqm8f$t71$1@ger.gmane.org>

Hi,

I am trying to send out a message with non-empty headers table. As far 
as I understand I am free to select any header name and any value type.

When I receive the message by means of webstomp (stomp.js), there is JS 
object with three fields: command, headers and body, headers carries 
both custom user headers and headers like 'content-length', 'message-id' 
and so on. I even can send message with headers 'content-length', 
'message-id' and so on. In this case, my value overwrites initial one. 
This causes issues.

I think the issue lies in rabbitmq-stomp plugin where both amqp-headers 
and amqp-props are converted to stomp headers. It is not so easy, 
because we are allowed to have header name same as property name.


From emile at rabbitmq.com  Tue Aug  6 12:25:23 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 06 Aug 2013 12:25:23 +0100
Subject: [rabbitmq-discuss] web-stomp reply-to
In-Reply-To: <kto8es$roo$1@ger.gmane.org>
References: <kto8es$roo$1@ger.gmane.org>
Message-ID: <5200DD23.1020009@rabbitmq.com>

On 05/08/13 14:14, Matwey V. Kornilov wrote:
> client.send('/exchange/name/key', {"reply-to":"/temp-queue/reply"}, 'msg');
> 
> What I can not understand is where should I wait an reply :) It seems 
> that web-stomp don't support /temp-queue/... Is it?

Hmm, I see no support for implicit subscriptions created by temporary
queues either. The workaround would be to set up subscriptions
explicitly until that is improved.



-Emile





From brokenpipe.coder at gmail.com  Tue Aug  6 13:15:08 2013
From: brokenpipe.coder at gmail.com (Burtsev Aleksey)
Date: Tue, 6 Aug 2013 05:15:08 -0700 (PDT)
Subject: [rabbitmq-discuss] BasicReject(deliveryTag,
	false) message stays in queue..
Message-ID: <1b537c35-faaf-45b0-a2f5-ff21e6d728aa@googlegroups.com>

I'm using RabbitMQ  3.1.3 with .NET client library.

I'm receiving messages using BasicConsume which puts them in List, then I 
take them from a List in other thread, and do:
channel.TxStart()
try
{
HandleMessage(qMessage);
channel.BasicAck(qMessage.DeliveryTag)
}
catch
{
 channel.BasicReject(qMessage,DeliveryTag, false); //I want to delete 
messages I can't process
}
finally
{
channel.TxCommit();
}

Message is marked as Nack, but it remains in queue, and when channel is 
closed message returns to Ready state.

I'm pulling hairs out of my head how such simple 3 lines of code couldn't 
work.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/1485429c/attachment.htm>

From emile at rabbitmq.com  Tue Aug  6 13:37:55 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 06 Aug 2013 13:37:55 +0100
Subject: [rabbitmq-discuss] BasicReject(deliveryTag,
 false) message stays in queue..
In-Reply-To: <1b537c35-faaf-45b0-a2f5-ff21e6d728aa@googlegroups.com>
References: <1b537c35-faaf-45b0-a2f5-ff21e6d728aa@googlegroups.com>
Message-ID: <5200EE23.6060600@rabbitmq.com>

On 06/08/13 13:15, Burtsev Aleksey wrote:

> try
> {
> HandleMessage(qMessage);
> channel.BasicAck(qMessage.DeliveryTag)


You have to acknowledge the message on the same channel that it was
received on. It is not clear from your description whether you are doing
this correctly. Check the broker logfile after an error.

You are assuming that the channel is still open after an exception, but
it might not be. You might consider registering for connection and
channel shutdown events. See RabbitMQ.Client.Examples.ExceptionTest for
an example.


-Emile





From bison_art at o2.pl  Tue Aug  6 14:32:14 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 6 Aug 2013 06:32:14 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ QUEUE MESSAGES
In-Reply-To: <51F24C7B.7010403@rabbitmq.com>
References: <1374651001375-28315.post@n5.nabble.com>
	<51EF8407.4060806@rabbitmq.com>
	<1374652023304-28317.post@n5.nabble.com>
	<51EF86E7.8030105@rabbitmq.com>
	<1374652266203-28319.post@n5.nabble.com>
	<51EF8F98.5070601@rabbitmq.com>
	<1374660089485-28335.post@n5.nabble.com>
	<51EFAE12.7010208@rabbitmq.com>
	<1374756757556-28391.post@n5.nabble.com>
	<51F24C7B.7010403@rabbitmq.com>
Message-ID: <1375795934034-28612.post@n5.nabble.com>

Hi, I saw that there is still not the same like with my buffer. When I used
my buffer than it was on the same speed all the time. If I run with
qos.basic(1), but without my buffer than the speed was better than without
qos, but still there are different values even 0. It is better than without
qos, but not like with my buffer. What should I sent to you ?

Cheers,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-QUEUE-MESSAGES-tp27737p28612.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jchappelle at 4redi.com  Tue Aug  6 15:31:03 2013
From: jchappelle at 4redi.com (jchappelle)
Date: Tue, 6 Aug 2013 07:31:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Reason not to use QueueingConsumer?
In-Reply-To: <F57D4AD8-28AE-4538-A6D4-9278D070EDE9@gopivotal.com>
References: <1375768454923-28593.post@n5.nabble.com>
	<F57D4AD8-28AE-4538-A6D4-9278D070EDE9@gopivotal.com>
Message-ID: <1375799463502-28613.post@n5.nabble.com>

Thanks for the quick answer. If that's the only issue then I think it will
work fine for my use case.

It is marked deprecated in the javadoc of the QueueingConsumer in version
3.1.3. 

http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.3/rabbitmq-java-client-javadoc-3.1.3/com/rabbitmq/client/QueueingConsumer.html
<http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.3/rabbitmq-java-client-javadoc-3.1.3/com/rabbitmq/client/QueueingConsumer.html>  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Reason-not-to-use-QueueingConsumer-tp28593p28613.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From demesg at gmail.com  Tue Aug  6 16:43:50 2013
From: demesg at gmail.com (ku3ia)
Date: Tue, 6 Aug 2013 08:43:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchanges: Publish In/Out difference?
Message-ID: <1375803830036-28614.post@n5.nabble.com>

Hi all! I'm newbie at rabbitmq, please advice.
I'm using direct exchange (amq.direct). I'd bind a queue to it through
management plugin with specific route key. So my route is:
producer -> direct exchange -> queue via route key -> consumer

I'm using .net client to publish messages. my code is simple, something like
this: 

// main program... 
      var factory = new ConnectionFactory { HostName = "localhost" }; 
      IConnection _connection = factory.CreateConnection(); 
      IModel _model = _connection.CreateModel(); 
      IBasicProperties _basicProperties = _model.CreateBasicProperties(); 
      _basicProperties.DeliveryMode = 2; 
      _basicProperties.SetPersistent(true); 
      _model.ConfirmSelect(); 
      _model.BasicAcks += BasicAcks; 
      _model.BasicNacks += BasicNacks; 
      
      _model.BasicPublish("amq.direct", _routingKey, _basicProperties,
message); 
      
      if(_connection != null) 
        _connection.Close(); 
      if(_model != null) 
        _model.Close(); 

... 

    public void BasicAcks(IModel sender, BasicAckEventArgs args) 
    { 
      MessageBox.Show("Acks"); 
    } 

    public void BasicNacks(IModel sender, BasicNackEventArgs args) 
    { 
      MessageBox.Show("Nacks"); 
    } 

When I publish message I see at management GUI that message already
published. It is OK. Also I have a message box with "Acks" message. It is OK
too. After that I'm removing my queue which has binded to exchange and run
program again. I haven't any error and "acks" message appeared again.

As I understand producer knows that message has been published ("acks"
message) but seems it is no correct, because it is not routed to destination
queue.

Can I catch this in .net client? Thanks




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Exchanges-Publish-In-Out-difference-tp28614.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Aug  6 16:47:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Aug 2013 16:47:11 +0100
Subject: [rabbitmq-discuss] Question on RabbitMQ and file I/O
	characteristics
In-Reply-To: <CACLE7iyDFtqS7ZWUr5TNmU-Ou-fE7CUBru3owpekRtLYWk0U=A@mail.gmail.com>
References: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>
	<51FF779D.6040302@rabbitmq.com>
	<CACLE7iyDFtqS7ZWUr5TNmU-Ou-fE7CUBru3owpekRtLYWk0U=A@mail.gmail.com>
Message-ID: <52011A7F.9010403@rabbitmq.com>

At this point we probably need to look at what exactly your tests are doing.

You mention that you are publishing in transactions. Does that mean you 
publish each message in a separate transaction? If so then the publishes 
from each channel can't be coalesced together for obvious reasons.

If you are then publishing in multiple channels simultaneously then 
maybe those can coalesce together - although each queue has its own 
journal so if you are publishing to a lot of queues this might not be 
the case. Message contents get written to the (global) message store and 
thus obviously can be coalesced, but the queue index journals are separate.

So:

1) Does that make sense?
2) What does your publishing really look like? And consuming come to that.

Cheers, Simon

PS: for reference, I can publish nearly 4000 persistent confirmed 
messages per second into a single queue at once, with about 90 
writes/sec. So coalescing does happen...

On 05/08/13 18:11, Matt Pietrek wrote:
> Thanks for the background Simon.
>
> One statement caught my attention though:
>
>  > At 40 msg/s you are publishing slowly enough that RabbitMQ probably
> won't start to coalesce these events together.
>
> In my original message I didn't lay out all my results - I was trying to
> keep the question simple. That said, the 4 write/sec pattern held up at
> higher rates. For instance, on a machine with a faster disk, the same
> test could do 400 messages/sec, and per tools like sar, were seeing 1600
> disk writes/sec.
>
> As you can imagine, at those I/O rater we're rapidly coming close to the
> disk's ability to keep up, thus the question about the writes/message rates.
>
> So with this additional context, any additional insight?
>
> Thanks,
>
> Matt
>
>
> On Mon, Aug 5, 2013 at 2:59 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     That filename is typical of those of a queue index journal. That's
>     the file that records the state of messages in the queue - when a
>     message has been published, when it's been confirmed (transactional
>     publish is internally implemented in terms of confirms), when it's
>     been delivered, and when it's been acknowledged (I assume you are
>     using acks).
>
>     So it is very possible to get four disk writes to the journal per
>     message for publish / confirm / deliver / ack.
>
>     At 40 msg/s you are publishing slowly enough that RabbitMQ probably
>     won't start to coalesce these events together. So as you start to
>     publish faster you should start to see fewer writes per message -
>     eventually you should see many messages per write.
>
>     Therefore I wouldn't try to scale the numbers you're seeing up to
>     predict anything - you're likely to be much better off running some
>     benchmark with MulticastMain or similar.
>
>     Cheers, Simon
>
>
>     On 03/08/2013 01:08, Matt Pietrek wrote:
>
>         Just want to run this past the RabbitMQ devs and see if this
>         jibes with
>         their expectations.
>
>         Our typical cluster runs RabbitMQ 3.02 on Ubuntu 10.04 on two nodes.
>         All queues are mirrored. All our channels are opened in
>         transactional
>         mode. (We know, this causes things to go slower - That's OK with
>         us, we
>         really want to avoid message loss.)
>
>         What I'm seeing is that for each message written to the broker,
>         we see
>         approximately four disk writes. That is, if the broker is doing 40
>         messages/sec, we see ~160 disk writes. We're getting these
>         number from
>
>         Is this about what should be expected when running this way?
>
>         If it helps, I dug in a bit more to see what the files were. The
>         vast
>         majority of the activity seems to be to files like this:
>
>         msg_store_persistent/743.rdq
>         queues/__E10F54B1OGM7M4LTRX5Z3L4K0/__journal.jif
>
>         Any insight would be very valuable for our planning processes.
>
>         Thanks,
>
>         Matt
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Aug  6 16:51:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Aug 2013 16:51:13 +0100
Subject: [rabbitmq-discuss] Exchanges: Publish In/Out difference?
In-Reply-To: <1375803830036-28614.post@n5.nabble.com>
References: <1375803830036-28614.post@n5.nabble.com>
Message-ID: <52011B71.6080809@rabbitmq.com>

On 06/08/13 16:43, ku3ia wrote:
> When I publish message I see at management GUI that message already
> published. It is OK. Also I have a message box with "Acks" message. It is OK
> too. After that I'm removing my queue which has binded to exchange and run
> program again. I haven't any error and "acks" message appeared again.
>
> As I understand producer knows that message has been published ("acks"
> message) but seems it is no correct, because it is not routed to destination
> queue.

The ack you get back from the broker in this situation just means that 
the broker has received the message and done whatever it's contractually 
required to do - if there is no queue then the defined behaviour is to 
drop the message, and the ack just tells you this has happened.

You might want to set the mandatory flag on publish. This will ensure 
that you get a basic.return back if the message is *not* routed to at 
least one queue.

See http://www.rabbitmq.com/confirms.html and 
http://www.rabbitmq.com/reliability.html for more info.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From yamil.asusta at upr.edu  Tue Aug  6 16:47:31 2013
From: yamil.asusta at upr.edu (Yamil Einar Asusta Santos)
Date: Tue, 6 Aug 2013 08:47:31 -0700 (PDT)
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
Message-ID: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>

I have been testing my cluster and I have come across an unexpected 
behavior. As explained in the subject, the cluster runs well on 3 nodes. If 
I bring 1 node down, it still runs smoothly. But if I bring a second node 
down, the third one becomes unresponsive.
This is what the third node provides after running "rabbitmqctl report":

Reporting server status on {{2013,8,6},{15,19,8}}
 ...
Error: {aborted,{no_exists,rabbit_vhost}}


Then if I bring 1 or 2 of my nodes back up, the third one becomes 
responsive and everything is back to normal. 

Here is the report after bringing the nodes up again:

Reporting server status on {{2013,8,6},{15,26,31}}
 ...
Status of node rabbit at qcluster1 ...
[{pid,901},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.1.3"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.3"},
      {rabbit,"RabbitMQ","3.1.3"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.3"},
      {webmachine,"webmachine","1.9.1-rmq3.1.3-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.3-gitd541e9a"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.3"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,31689208},
      {connection_procs,5408},
      {queue_procs,5408},
      {plugins,340592},
      {other_proc,9166952},
      {mnesia,61984},
      {mgmt_db,10248},
      {msg_index,34160},
      {other_ets,1080168},
      {binary,6480},
      {code,17557932},
      {atom,1565809},
      {other_system,1854067}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,153295257},
 {disk_free_limit,1000000000},
 {disk_free,77554466816},
 {file_descriptors,
    
 [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,187}]},
 {run_queue,0},
 {uptime,210}]
Cluster status of node rabbit at qcluster1 ...
[{nodes,[{disc,[rabbit at qcluster2,rabbit at qcluster0]},{ram,[rabbit at qcluster1]}]},
 {running_nodes,[rabbit at qcluster0,rabbit at qcluster2,rabbit at qcluster1]},
 {partitions,[]}]
Application environment of node rabbit at qcluster1 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[rabbit at qcluster0,rabbit at qcluster1],ram}},
 {cluster_partition_handling,pause_minority},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster1.log"}},
 {frame_max,131072},
 {heartbeat,600},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.3/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at qcluster1-plugins-expand"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster1-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[{"auto",5672}]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]
Status of node rabbit at qcluster2 ...
[{pid,1940},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.1.3"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.3"},
      {rabbit,"RabbitMQ","3.1.3"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.3"},
      {webmachine,"webmachine","1.9.1-rmq3.1.3-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.3-gitd541e9a"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.3"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,32032800},
      {connection_procs,5408},
      {queue_procs,5408},
      {plugins,315040},
      {other_proc,9172832},
      {mnesia,61952},
      {mgmt_db,89704},
      {msg_index,34160},
      {other_ets,1111736},
      {binary,33384},
      {code,17743902},
      {atom,1603433},
      {other_system,1855841}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,153295257},
 {disk_free_limit,1000000000},
 {disk_free,77553033216},
 {file_descriptors,
    
 [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,191}]},
 {run_queue,0},
 {uptime,617}]
Cluster status of node rabbit at qcluster2 ...
[{nodes,[{disc,[rabbit at qcluster0,rabbit at qcluster2]},{ram,[rabbit at qcluster1]}]},
 {running_nodes,[rabbit at qcluster1,rabbit at qcluster0,rabbit at qcluster2]},
 {partitions,[]}]
Application environment of node rabbit at qcluster2 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[rabbit at qcluster0,rabbit at qcluster1,rabbit at qcluster2],ram}},
 {cluster_partition_handling,pause_minority},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster2.log"}},
 {frame_max,131072},
 {heartbeat,600},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.3/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at qcluster2-plugins-expand"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster2-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[{"auto",5672}]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]
Status of node rabbit at qcluster0 ...
[{pid,873},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.1.3"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.3"},
      {rabbit,"RabbitMQ","3.1.3"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.3"},
      {webmachine,"webmachine","1.9.1-rmq3.1.3-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.3-gitd541e9a"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.3"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,33671216},
      {connection_procs,5408},
      {queue_procs,5408},
      {plugins,452592},
      {other_proc,10742928},
      {mnesia,61984},
      {mgmt_db,10248},
      {msg_index,34160},
      {other_ets,1117456},
      {binary,35464},
      {code,17740702},
      {atom,1602625},
      {other_system,1862241}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,153295257},
 {disk_free_limit,1000000000},
 {disk_free,77554319360},
 {file_descriptors,
    
 [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,196}]},
 {run_queue,0},
 {uptime,335}]
Cluster status of node rabbit at qcluster0 ...
[{nodes,[{disc,[rabbit at qcluster0,rabbit at qcluster2]},{ram,[rabbit at qcluster1]}]},
 {running_nodes,[rabbit at qcluster1,rabbit at qcluster2,rabbit at qcluster0]},
 {partitions,[]}]
Application environment of node rabbit at qcluster0 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[rabbit at qcluster0,rabbit at qcluster1],disc}},
 {cluster_partition_handling,pause_minority},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster0.log"}},
 {frame_max,131072},
 {heartbeat,600},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.3/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at qcluster0-plugins-expand"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster0-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[{"auto",5672}]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]
Connections:
Channels:
Queues on /:
Exchanges on /:
name type durable auto_delete internal arguments policy
direct true false false []
amq.direct direct true false false []
amq.fanout fanout true false false []
amq.headers headers true false false []
amq.match headers true false false []
amq.rabbitmq.log topic true false false []
amq.rabbitmq.trace topic true false false []
amq.topic topic true false false []
Bindings on /:
Consumers on /:
Permissions on /:
user configure write read
guest .* .* .*
Policies on /:
Parameters on /:
...done. 

Any help would be appreciated. 
Thanks 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/4961e5c9/attachment.htm>

From demesg at gmail.com  Tue Aug  6 17:05:42 2013
From: demesg at gmail.com (ku3ia)
Date: Tue, 6 Aug 2013 09:05:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchanges: Publish In/Out difference?
In-Reply-To: <52011B71.6080809@rabbitmq.com>
References: <1375803830036-28614.post@n5.nabble.com>
	<52011B71.6080809@rabbitmq.com>
Message-ID: <1375805142608-28618.post@n5.nabble.com>

Hi, Simon! Thanks for quick reply. I just tried your advice and this is
really what I need. Great. Many thanks!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Exchanges-Publish-In-Out-difference-tp28614p28618.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From yamil.asusta at upr.edu  Tue Aug  6 17:53:29 2013
From: yamil.asusta at upr.edu (Yamil Einar Asusta Santos)
Date: Tue, 6 Aug 2013 09:53:29 -0700 (PDT)
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
Message-ID: <e303f971-58bc-4a91-8839-51b1f86d7a7f@googlegroups.com>

I ran this with 4 nodes in the cluster and after just 2 nodes down, the 
whole system became unresponsive.
I have put the log in 
here: https://gist.github.com/elbuo8/e5171ec85608b7bd7842

Also, I noticed that when I bring the nodes back up, they become Disc nodes 
even when they have been configured specifically as RAM nodes.


On Tuesday, August 6, 2013 11:47:31 AM UTC-4, Yamil Einar Asusta Santos 
wrote:
>
> I have been testing my cluster and I have come across an unexpected 
> behavior. As explained in the subject, the cluster runs well on 3 nodes. If 
> I bring 1 node down, it still runs smoothly. But if I bring a second node 
> down, the third one becomes unresponsive.
> This is what the third node provides after running "rabbitmqctl report":
>
> Reporting server status on {{2013,8,6},{15,19,8}}
>  ...
> Error: {aborted,{no_exists,rabbit_vhost}}
>
>
> Then if I bring 1 or 2 of my nodes back up, the third one becomes 
> responsive and everything is back to normal. 
>
> Here is the report after bringing the nodes up again:
>
> Reporting server status on {{2013,8,6},{15,26,31}}
>  ...
> Status of node rabbit at qcluster1 ...
> [{pid,901},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","3.1.3"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.3"},
>       {rabbit,"RabbitMQ","3.1.3"},
>       {os_mon,"CPO  CXC 138 46","2.2.7"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.3"},
>       {webmachine,"webmachine","1.9.1-rmq3.1.3-git52e62bc"},
>       {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.3-gitd541e9a"},
>       {xmerl,"XML parser","1.2.10"},
>       {inets,"INETS  CXC 138 49","5.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.5"},
>       {amqp_client,"RabbitMQ AMQP Client","3.1.3"},
>       {sasl,"SASL  CXC 138 11","2.1.10"},
>       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,31689208},
>       {connection_procs,5408},
>       {queue_procs,5408},
>       {plugins,340592},
>       {other_proc,9166952},
>       {mnesia,61984},
>       {mgmt_db,10248},
>       {msg_index,34160},
>       {other_ets,1080168},
>       {binary,6480},
>       {code,17557932},
>       {atom,1565809},
>       {other_system,1854067}]},
>  {vm_memory_high_watermark,0.4},
>  {vm_memory_limit,153295257},
>  {disk_free_limit,1000000000},
>  {disk_free,77554466816},
>  {file_descriptors,
>     
>  [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
>  {processes,[{limit,1048576},{used,187}]},
>  {run_queue,0},
>  {uptime,210}]
> Cluster status of node rabbit at qcluster1 ...
>
> [{nodes,[{disc,[rabbit at qcluster2,rabbit at qcluster0]},{ram,[rabbit at qcluster1]}]},
>  {running_nodes,[rabbit at qcluster0,rabbit at qcluster2,rabbit at qcluster1]},
>  {partitions,[]}]
> Application environment of node rabbit at qcluster1 ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,{[rabbit at qcluster0,rabbit at qcluster1],ram}},
>  {cluster_partition_handling,pause_minority},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {disk_free_limit,1000000000},
>  {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster1.log"}},
>  {frame_max,131072},
>  {heartbeat,600},
>  {hipe_compile,false},
>  {included_applications,[]},
>  {log_levels,[{connection,info}]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>
>  {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.3/sbin/../plugins"},
>
>  {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at qcluster1-plugins-expand"},
>  {queue_index_max_journal_entries,65536},
>  {reverse_dns_lookups,false},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster1-sasl.log"}},
>  {server_properties,[]},
>  {ssl_cert_login_from,distinguished_name},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[{"auto",5672}]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.4}]
> Status of node rabbit at qcluster2 ...
> [{pid,1940},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","3.1.3"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.3"},
>       {rabbit,"RabbitMQ","3.1.3"},
>       {os_mon,"CPO  CXC 138 46","2.2.7"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.3"},
>       {webmachine,"webmachine","1.9.1-rmq3.1.3-git52e62bc"},
>       {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.3-gitd541e9a"},
>       {mnesia,"MNESIA  CXC 138 12","4.5"},
>       {amqp_client,"RabbitMQ AMQP Client","3.1.3"},
>       {xmerl,"XML parser","1.2.10"},
>       {inets,"INETS  CXC 138 49","5.7.1"},
>       {sasl,"SASL  CXC 138 11","2.1.10"},
>       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,32032800},
>       {connection_procs,5408},
>       {queue_procs,5408},
>       {plugins,315040},
>       {other_proc,9172832},
>       {mnesia,61952},
>       {mgmt_db,89704},
>       {msg_index,34160},
>       {other_ets,1111736},
>       {binary,33384},
>       {code,17743902},
>       {atom,1603433},
>       {other_system,1855841}]},
>  {vm_memory_high_watermark,0.4},
>  {vm_memory_limit,153295257},
>  {disk_free_limit,1000000000},
>  {disk_free,77553033216},
>  {file_descriptors,
>     
>  [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
>  {processes,[{limit,1048576},{used,191}]},
>  {run_queue,0},
>  {uptime,617}]
> Cluster status of node rabbit at qcluster2 ...
>
> [{nodes,[{disc,[rabbit at qcluster0,rabbit at qcluster2]},{ram,[rabbit at qcluster1]}]},
>  {running_nodes,[rabbit at qcluster1,rabbit at qcluster0,rabbit at qcluster2]},
>  {partitions,[]}]
> Application environment of node rabbit at qcluster2 ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>
>  {cluster_nodes,{[rabbit at qcluster0,rabbit at qcluster1,rabbit at qcluster2],ram}},
>  {cluster_partition_handling,pause_minority},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {disk_free_limit,1000000000},
>  {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster2.log"}},
>  {frame_max,131072},
>  {heartbeat,600},
>  {hipe_compile,false},
>  {included_applications,[]},
>  {log_levels,[{connection,info}]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>
>  {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.3/sbin/../plugins"},
>
>  {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at qcluster2-plugins-expand"},
>  {queue_index_max_journal_entries,65536},
>  {reverse_dns_lookups,false},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster2-sasl.log"}},
>  {server_properties,[]},
>  {ssl_cert_login_from,distinguished_name},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[{"auto",5672}]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.4}]
> Status of node rabbit at qcluster0 ...
> [{pid,873},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","3.1.3"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.3"},
>       {rabbit,"RabbitMQ","3.1.3"},
>       {os_mon,"CPO  CXC 138 46","2.2.7"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.3"},
>       {webmachine,"webmachine","1.9.1-rmq3.1.3-git52e62bc"},
>       {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.3-gitd541e9a"},
>       {xmerl,"XML parser","1.2.10"},
>       {inets,"INETS  CXC 138 49","5.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.5"},
>       {amqp_client,"RabbitMQ AMQP Client","3.1.3"},
>       {sasl,"SASL  CXC 138 11","2.1.10"},
>       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,33671216},
>       {connection_procs,5408},
>       {queue_procs,5408},
>       {plugins,452592},
>       {other_proc,10742928},
>       {mnesia,61984},
>       {mgmt_db,10248},
>       {msg_index,34160},
>       {other_ets,1117456},
>       {binary,35464},
>       {code,17740702},
>       {atom,1602625},
>       {other_system,1862241}]},
>  {vm_memory_high_watermark,0.4},
>  {vm_memory_limit,153295257},
>  {disk_free_limit,1000000000},
>  {disk_free,77554319360},
>  {file_descriptors,
>     
>  [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
>  {processes,[{limit,1048576},{used,196}]},
>  {run_queue,0},
>  {uptime,335}]
> Cluster status of node rabbit at qcluster0 ...
>
> [{nodes,[{disc,[rabbit at qcluster0,rabbit at qcluster2]},{ram,[rabbit at qcluster1]}]},
>  {running_nodes,[rabbit at qcluster1,rabbit at qcluster2,rabbit at qcluster0]},
>  {partitions,[]}]
> Application environment of node rabbit at qcluster0 ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,{[rabbit at qcluster0,rabbit at qcluster1],disc}},
>  {cluster_partition_handling,pause_minority},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {disk_free_limit,1000000000},
>  {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster0.log"}},
>  {frame_max,131072},
>  {heartbeat,600},
>  {hipe_compile,false},
>  {included_applications,[]},
>  {log_levels,[{connection,info}]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>
>  {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.3/sbin/../plugins"},
>
>  {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at qcluster0-plugins-expand"},
>  {queue_index_max_journal_entries,65536},
>  {reverse_dns_lookups,false},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at qcluster0-sasl.log"}},
>  {server_properties,[]},
>  {ssl_cert_login_from,distinguished_name},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[{"auto",5672}]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.4}]
> Connections:
> Channels:
> Queues on /:
> Exchanges on /:
> name type durable auto_delete internal arguments policy
> direct true false false []
> amq.direct direct true false false []
> amq.fanout fanout true false false []
> amq.headers headers true false false []
> amq.match headers true false false []
> amq.rabbitmq.log topic true false false []
> amq.rabbitmq.trace topic true false false []
> amq.topic topic true false false []
> Bindings on /:
> Consumers on /:
> Permissions on /:
> user configure write read
> guest .* .* .*
> Policies on /:
> Parameters on /:
> ...done. 
>
> Any help would be appreciated. 
> Thanks 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/cbd2fbf3/attachment.htm>

From mpietrek at skytap.com  Tue Aug  6 18:42:54 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 6 Aug 2013 10:42:54 -0700
Subject: [rabbitmq-discuss] Question on RabbitMQ and file I/O
	characteristics
In-Reply-To: <52011A7F.9010403@rabbitmq.com>
References: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>
	<51FF779D.6040302@rabbitmq.com>
	<CACLE7iyDFtqS7ZWUr5TNmU-Ou-fE7CUBru3owpekRtLYWk0U=A@mail.gmail.com>
	<52011A7F.9010403@rabbitmq.com>
Message-ID: <CACLE7izYTbUj9LguaP=hZ2x04+86jd2U9caAa7E6Y5KQEhfhWg@mail.gmail.com>

1) Does that make sense?

For the most part, yes. Thank you.

2) What does your publishing really look like? And consuming come to that.

So the app is something I call "echotest". It spins up two ioloops in
separate threads ('main', 'echo'). Each ioloop thread listens on its own
queue.

The "on_message" methods in both 'main' and 'echo' do effectively the
following:

- Write a new message to the other queue
- Acknowledge the incoming message

The net effect is that messages 'ping-pong' between the two ioloop threads
as fast as possible. In the 'main' ioloop init, it sends an initial message
to kick things off.

I've added counters and timing logic to calculate the current message rate.

In terms of the queue config, the queues are declared like this:

    channel.queue_declare(queue=echo_queue_name, durable=True,
arguments={"x-ha-policy": "all"})

Broker config is two clustered 3.0.2 nodes.

For writing messages, it looks like this:

    channel.basic_publish(exchange='',
        routing_key=echo_queue_name,
        body=json.dumps(payload_dict),
        mandatory=True,
        properties=BasicProperties(delivery_mode=2))

I also have a global switch (USE_TRANSACTIONS) that lets me switch between
using transactions and not. When set, it adds tx_select() when opening the
channels and tx_commit after publishing messages. For the tests I was
running, I wasn't using transactions. If I do run with transactions the
numbers are very similar (surprising I know, but I stepped through the code
to verify that the tx_xxx calls are only made when I intend them to be.)

I absolutely realize this particular setup isn't optimal for driving high
broker load. For the moment, I'm more interested in how many "RPC"-style
calls/second we could expect between two given endpoints.

Thanks for your help in digging into this!

Matt


On Tue, Aug 6, 2013 at 8:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> At this point we probably need to look at what exactly your tests are
> doing.
>
> You mention that you are publishing in transactions. Does that mean you
> publish each message in a separate transaction? If so then the publishes
> from each channel can't be coalesced together for obvious reasons.
>
> If you are then publishing in multiple channels simultaneously then maybe
> those can coalesce together - although each queue has its own journal so if
> you are publishing to a lot of queues this might not be the case. Message
> contents get written to the (global) message store and thus obviously can
> be coalesced, but the queue index journals are separate.
>
> So:
>
> 1) Does that make sense?
> 2) What does your publishing really look like? And consuming come to that.
>
> Cheers, Simon
>
> PS: for reference, I can publish nearly 4000 persistent confirmed messages
> per second into a single queue at once, with about 90 writes/sec. So
> coalescing does happen...
>
>
> On 05/08/13 18:11, Matt Pietrek wrote:
>
>> Thanks for the background Simon.
>>
>> One statement caught my attention though:
>>
>>  > At 40 msg/s you are publishing slowly enough that RabbitMQ probably
>> won't start to coalesce these events together.
>>
>> In my original message I didn't lay out all my results - I was trying to
>> keep the question simple. That said, the 4 write/sec pattern held up at
>> higher rates. For instance, on a machine with a faster disk, the same
>> test could do 400 messages/sec, and per tools like sar, were seeing 1600
>> disk writes/sec.
>>
>> As you can imagine, at those I/O rater we're rapidly coming close to the
>> disk's ability to keep up, thus the question about the writes/message
>> rates.
>>
>> So with this additional context, any additional insight?
>>
>> Thanks,
>>
>> Matt
>>
>>
>> On Mon, Aug 5, 2013 at 2:59 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     That filename is typical of those of a queue index journal. That's
>>     the file that records the state of messages in the queue - when a
>>     message has been published, when it's been confirmed (transactional
>>     publish is internally implemented in terms of confirms), when it's
>>     been delivered, and when it's been acknowledged (I assume you are
>>     using acks).
>>
>>     So it is very possible to get four disk writes to the journal per
>>     message for publish / confirm / deliver / ack.
>>
>>     At 40 msg/s you are publishing slowly enough that RabbitMQ probably
>>     won't start to coalesce these events together. So as you start to
>>     publish faster you should start to see fewer writes per message -
>>     eventually you should see many messages per write.
>>
>>     Therefore I wouldn't try to scale the numbers you're seeing up to
>>     predict anything - you're likely to be much better off running some
>>     benchmark with MulticastMain or similar.
>>
>>     Cheers, Simon
>>
>>
>>     On 03/08/2013 01:08, Matt Pietrek wrote:
>>
>>         Just want to run this past the RabbitMQ devs and see if this
>>         jibes with
>>         their expectations.
>>
>>         Our typical cluster runs RabbitMQ 3.02 on Ubuntu 10.04 on two
>> nodes.
>>         All queues are mirrored. All our channels are opened in
>>         transactional
>>         mode. (We know, this causes things to go slower - That's OK with
>>         us, we
>>         really want to avoid message loss.)
>>
>>         What I'm seeing is that for each message written to the broker,
>>         we see
>>         approximately four disk writes. That is, if the broker is doing 40
>>         messages/sec, we see ~160 disk writes. We're getting these
>>         number from
>>
>>         Is this about what should be expected when running this way?
>>
>>         If it helps, I dug in a bit more to see what the files were. The
>>         vast
>>         majority of the activity seems to be to files like this:
>>
>>         msg_store_persistent/743.rdq
>>         queues/__**E10F54B1OGM7M4LTRX5Z3L4K0/__**journal.jif
>>
>>
>>         Any insight would be very valuable for our planning processes.
>>
>>         Thanks,
>>
>>         Matt
>>
>>
>>         ______________________________**___________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/f69f68f1/attachment.htm>

From jchappelle at 4redi.com  Tue Aug  6 20:48:16 2013
From: jchappelle at 4redi.com (jchappelle)
Date: Tue, 6 Aug 2013 12:48:16 -0700 (PDT)
Subject: [rabbitmq-discuss] shutdownCompleted is not called when queue is
	deleted
Message-ID: <1375818496145-28621.post@n5.nabble.com>

I have implemented a Consumer that extends DefaultConsumer. When I delete my
queue using the web interface it fires the handleCancel event in my consumer
but it does not call shutdownCompleted in the class that is managing my
connections. I'm trying to make my application fault tolerant so that it
will re-connect in this case. I throw a ConsumerCancelledException in my
handleCancel method thinking that the DefaultExceptionHandler will close the
channel and ultimately fire the event that calls the shutdownCompleted
method but this does not happen. My code works fine in the event that the
server goes down, because shutdownCompleted is called and I'm able to
re-establish the connection. 

Is there some other way that I should be handling this? I have listed my
code below:


package com.redi.email.service;

import java.io.IOException;

import org.apache.log4j.Logger;

import com.google.gson.Gson;
import com.google.gson.JsonSyntaxException;
import com.rabbitmq.client.AMQP.BasicProperties;
import com.rabbitmq.client.*;
import com.redi.email.*;
import com.redi.email.rabbitmq.QueuedEmail;

public class EmailConsumerApplication implements Application,
ShutdownListener
{
	private static final Logger logger =
Logger.getLogger(EmailConsumerApplication.class);
	
	private final EmailConfig defaultEmailConfig;
 
	private boolean stopped;
	private final ConnectionFactory factory;
	private Connection connection = null;
	private Channel channel = null;

	private EmailConsumer consumer;
	private final String queue;
	private static final String EXCHANGE = "email";
	
	public EmailConsumerApplication(MqConfig mqConfig, EmailConfig
defaultEmailConfig)
	{
		factory = new ConnectionFactory();
	    factory.setHost(mqConfig.getHost());
	    factory.setUsername(mqConfig.getUsername());
	    factory.setPassword(mqConfig.getPassword());
	    factory.setVirtualHost(mqConfig.getVhost());
	    
	    this.queue = mqConfig.getQueue();
	    this.defaultEmailConfig = defaultEmailConfig;
	}

	public void run()
	{
		connectAndConsume();
	}

	private void connectAndConsume()
	{
		int connectionRetries = 0;
		int retrySeconds = 30;
		boolean connected = false;
		while(!stopped && !connected)
		{
			try
			{
				boolean autoAck = false;
				boolean durable = true;
				
				logger.debug("Establishing a connection");
				connection = factory.newConnection();
				connection.addShutdownListener(this);
				channel = connection.createChannel();
				channel.addShutdownListener(this);
				
				logger.debug("Setting up channel");
				channel.exchangeDeclare(EXCHANGE, "direct", true);
				channel.queueDeclare(queue, durable, false, false, null);
				channel.queueBind(queue, EXCHANGE, queue);
				channel.basicQos(1);
				
				logger.info("Waiting for messages.");
				consumer = new EmailConsumer(channel, defaultEmailConfig);
				channel.basicConsume(queue, autoAck, consumer);
				connected = true;
			}
			catch(Exception e)
			{
				close();
				logger.error("Unable to establish a connection to the RabbitMQ server.
Retry #" + connectionRetries++ + " in " + retrySeconds + " seconds...", e);
				Utils.sleep(retrySeconds);
			}
		}
	}

	private void close()
	{
		logger.debug("Closing channel and connection");
		try
		{
			Utils.close(channel);
			Utils.close(connection);
		}
		catch(Exception e)
		{
			logger.debug("Unable to abort consumer", e);
		}
	}

	public void stop()
	{
		logger.debug("Stopping Consumer");
		stopped = true;
		close();
	}

	public boolean isStopped()
	{
		return stopped;
	}

	@Override
	public void shutdownCompleted(ShutdownSignalException cause)
	{
		logger.debug("handleShutdownOrCancel");
		if(stopped)
		{
			logger.info("Consumer shutdown completed.");
		}
		else
		{
			logger.info("Connection has been shutdown.", cause);
			logger.info("Re-establishing connection");
			connectAndConsume();
		}
	}
	
	private class EmailConsumer extends DefaultConsumer
	{
		private EmailService emailService = new DefaultEmailService();
		private DeduplicateService deduplicateService = new
DefaultDeduplicateService();

		private final EmailConfig defaultEmailConfig;
	 
		public EmailConsumer(Channel channel, EmailConfig defaultEmailConfig)
		{
			super(channel);
			
			this.defaultEmailConfig = defaultEmailConfig;
		}

		@Override
		public void handleDelivery(String consumerTag, Envelope envelope,
BasicProperties properties, byte[] body) throws IOException
		{
			if(body == null)
			{
				logger.warn("Ignoring null message!");
			}
			else
			{
				String rawMessage = new String(body, "UTF-8");
				logger.debug("Received '" + rawMessage + "'");     
				sendEmail(rawMessage);
				logger.debug("Done");
				getChannel().basicAck(envelope.getDeliveryTag(), false);
			}
		}

		private void sendEmail(String rawMessage)
		{
			try
			{
				QueuedEmail queuedEmail = makeQueuedEmail(rawMessage);
				if(deduplicateService.isDuplicate(queuedEmail))
				{
					logger.warn("Ignoring duplicate message id=" + queuedEmail.getMsgId());
				}
				else
				{
					Email email = queuedEmail.getEmail();
					if(email.getEmailConfig() == null)
					{
						email.setEmailConfig(defaultEmailConfig);
					}
					emailService.sendEmail(email);
				}
			}
			catch(EmailException e)
			{
				logger.error("Unable to send email", e);
			}
		}
		
		private QueuedEmail makeQueuedEmail(String rawMessage)
		{
			try
			{
				Gson gson = new Gson();
				return gson.fromJson(rawMessage, QueuedEmail.class);
			}
			catch(JsonSyntaxException e)
			{
				logger.error("Could not create QueuedEmail from json string " +
rawMessage, e);
				throw e;
			}
		}
		
		@Override
		public void handleShutdownSignal(String consumerTag,
ShutdownSignalException sig)
		{
			logger.debug("handleShutdownSignal");
		}
		
		@Override
		public void handleCancelOk(String consumerTag)
		{
			logger.debug("handleCancelOk");
		}

		@Override
		public void handleCancel(String consumerTag) throws IOException
		{
			logger.debug("handleCancel");
			throw new ConsumerCancelledException();
		}
	}
}




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/shutdownCompleted-is-not-called-when-queue-is-deleted-tp28621.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From 314992959 at qq.com  Wed Aug  7 03:47:46 2013
From: 314992959 at qq.com (3k4b251)
Date: Tue, 6 Aug 2013 19:47:46 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq server Mnesia   backup and restore
In-Reply-To: <5200BEAF.6060507@rabbitmq.com>
References: <1375778780916-28598.post@n5.nabble.com>
	<5200BEAF.6060507@rabbitmq.com>
Message-ID: <1375843666659-28622.post@n5.nabble.com>

thanks.   but  how  to restore ?  just copy back?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-server-Mnesia-backup-and-restore-tp28598p28622.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jared at kauppi.la  Wed Aug  7 04:05:11 2013
From: jared at kauppi.la (Jared Kauppila)
Date: Tue, 6 Aug 2013 22:05:11 -0500
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap granular permissions?
Message-ID: <CAJnBO6YtLak-LK8sdvysQbRGpL_9rs8kjrjSdQvauH4yp5yhFQ@mail.gmail.com>

Greetings,

I was curious how granular you get set permissions using the
rabbit_auth_backend_ldap plugin? Is it possible to define permissions to a
particular vhost/exchange/queue explicitly defining these resources and the
AD groups that have access to them in the config? Our current use case is
defining static exchanges and queues and restricting access to those
resources via AD groups that would grant developers and service accounts
access per development group. We will have a number of applications that
will push messages to the exchanges, with another set of applications
consuming these messages via their own queue. We would ideally restrict
access to each queue per it's defined app, likewise for the exchanges.

It looks like this achievable fairly easily using the baked in user
accounts, can this be defined for LDAP groups/users and resources?

It was discussed some here,
http://rabbitmq.1065348.n5.nabble.com/Per-queue-exchange-ACL-via-LDAP-plugin-td25331.html,
which shows how to match queue to a username. Is it not possible for group
membership or explicitly defining the resource and group?

Thanks,

Jared
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130806/e06991c0/attachment.htm>

From brett.r.cameron at gmail.com  Wed Aug  7 04:52:20 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 7 Aug 2013 15:52:20 +1200
Subject: [rabbitmq-discuss] rabbitmq server Mnesia backup and restore
In-Reply-To: <1375843666659-28622.post@n5.nabble.com>
References: <1375778780916-28598.post@n5.nabble.com>
	<5200BEAF.6060507@rabbitmq.com>
	<1375843666659-28622.post@n5.nabble.com>
Message-ID: <CALPqkirRLVu2F4XcHrOhMSFsJxw9=N5ANdQ-UAYEYKXJ3j6okQ@mail.gmail.com>

You would need to backup everything under $RABBITMQ_MNESIA_DIR. This
includes both the Mnesia database (which as Emile says holds durable
configuration data) and the files used to store messages (and their
associated index files). At a quiet point (or preferably with the broker
shut down) you could hypothetically tar up the whole lot and then
subsequently restore if necessary; however it is important to note that the
Mnesia database is associated with a particular Erlang node (say
rabbit at mynode, where mynode is the name of the server on which the broker
is running), so you cannot simply copy your backup to another node, restore
it and expect things to work. There are ways to change the node name
associated with the database, but even then you may not be totally
successful. If you want to get a bit fancy you can also backup and restore
the Mnesia database using Erlang Mnesia functions like backup/1 and
restore/1. However, the simplest way to save your configuration is to use
the rabbitmqadmin tool, assuming you have the management API installed. For
example the command "rabbitmqadmin export broker.conf" will save your
configuration as a JSON document to the file broker.conf, and you could
subsequently restore it using the corresponding rabbitmqadmin import
command (you can also do these operations via the management web UI).
Instead of backing up the files used to store messages you might be better
off replicating the queues across to one or more cluster nodes.


On Wed, Aug 7, 2013 at 2:47 PM, 3k4b251 <314992959 at qq.com> wrote:

> thanks.   but  how  to restore ?  just copy back?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-server-Mnesia-backup-and-restore-tp28598p28622.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/fd0403c9/attachment.htm>

From mklishin at gopivotal.com  Wed Aug  7 05:59:37 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 7 Aug 2013 08:59:37 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.10.1 is released
Message-ID: <B2111F09-3D93-44F9-882D-A3E7B2A44206@gopivotal.com>

Bunny 0.10.1 [1] is released.

This is a bug fix release. All users are encouraged to upgrade.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/08/07/bunny-0-dot-10-dot-1-is-released/

1. http://rubygems.org/gems/bunny/versions/0.10.1
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/d0e204de/attachment.pgp>

From david.tinker at gmail.com  Wed Aug  7 07:29:24 2013
From: david.tinker at gmail.com (David Tinker)
Date: Wed, 7 Aug 2013 08:29:24 +0200
Subject: [rabbitmq-discuss] rabbitmq server Mnesia backup and restore
In-Reply-To: <1375843666659-28622.post@n5.nabble.com>
References: <1375778780916-28598.post@n5.nabble.com>
	<5200BEAF.6060507@rabbitmq.com>
	<1375843666659-28622.post@n5.nabble.com>
Message-ID: <CA+O6_FeTrZijNn0+_EgOQB3abdT=EW30ruFM9ptcTmomndXhhA@mail.gmail.com>

QDB can backup/restore your queues in realtime to a remote server:

http://qdb.io/

QDB provides disk based messages queues and integrates with RabbitMQ.


On Wed, Aug 7, 2013 at 4:47 AM, 3k4b251 <314992959 at qq.com> wrote:
> thanks.   but  how  to restore ?  just copy back?
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-server-Mnesia-backup-and-restore-tp28598p28622.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
http://qdb.io/ Persistent Message Queues With Replay and #RabbitMQ Integration

From alexandru.topliceanu at gmail.com  Wed Aug  7 09:20:50 2013
From: alexandru.topliceanu at gmail.com (Alexandru Topliceanu)
Date: Wed, 7 Aug 2013 01:20:50 -0700 (PDT)
Subject: [rabbitmq-discuss] 2 Node Cluster Configuration becomes unresponsive
Message-ID: <2941f537-800b-4d17-8807-f69ac77b71ee@googlegroups.com>

Hi, 

I have the following setup:
- 2 ubuntu 12.04 machines with rabbitmq v3.1.1 linked in a cluster
- one durable queue, policy HA, default exchange binding
- 2 producers
- 3 consumers
- both workers and consumers are implemented in node.js using node-amqp

The problem is that it sometimes happens that messages are pilled up in the 
queue but no longer forwarded to consumers.
I don't know what is causing the jam!
Restarting the consumers doesn't fix the problem.
All I could do so far is to restart the cluster. This causes all the 
messages to be lost (why? they should be durable) 
Luckily I'm able to lose messages for now, but there must be better 
configuration for persistence and availability.

Please let me know if you need more information.
Thanks very much for your help,
Alex 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/0dd96d4b/attachment.htm>

From emile at rabbitmq.com  Wed Aug  7 10:32:55 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 07 Aug 2013 10:32:55 +0100
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <e303f971-58bc-4a91-8839-51b1f86d7a7f@googlegroups.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
	<e303f971-58bc-4a91-8839-51b1f86d7a7f@googlegroups.com>
Message-ID: <52021447.6040200@rabbitmq.com>

On 06/08/13 17:53, Yamil Einar Asusta Santos wrote:

> I have put the log in
> here: https://gist.github.com/elbuo8/e5171ec85608b7bd7842

The error recorded on 6-Aug-2013::16:29:44 looks like it might be part
of the problem. Can you tell by looking at the other logfiles whether
anything noteworthy happened at that time? Is anything recorded in the
sasl log?

Are you able to reproduce this issue reliably? And does the last
remaining node always have an log entry containing
"{rabbit_node_monitor,handle_info,2}" ?

Would it be possible for you to run an instrumented version of the
broker to help discover the cause of the problem? It will help alot if
you can reproduce the problem with instrumented code in a test environment.

You may wish to configure "cluster_partition_handling" to "ignore" as a
temporary workaround. This should allow the last node to keep running
while the others are off-line.




-Emile





From joshua__lim at hotmail.com  Wed Aug  7 10:41:54 2013
From: joshua__lim at hotmail.com (joshua__lim)
Date: Wed, 7 Aug 2013 02:41:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Maximum achievable concurrent Web STOMP
	plugin on Windows
In-Reply-To: <51FBBE54.6000005@rabbitmq.com>
References: <1374878860315-28434.post@n5.nabble.com>
	<51F66B68.5050807@rabbitmq.com>
	<1375112853685-28458.post@n5.nabble.com>
	<51FBBE54.6000005@rabbitmq.com>
Message-ID: <1375868514826-28629.post@n5.nabble.com>

Hi Emile, thank you.  I managed to create a concurrency test by modifying the
webworker example for the STOMP Over WebSocket example by Jeff Mesnil.  I'll
post it up later.

https://github.com/jmesnil/stomp-websocket/tree/master/example/webworker



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Maximum-achievable-concurrent-Web-STOMP-plugin-on-Windows-tp28434p28629.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From joshua__lim at hotmail.com  Wed Aug  7 10:44:40 2013
From: joshua__lim at hotmail.com (joshua__lim)
Date: Wed, 7 Aug 2013 02:44:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Authenticated push message service using
 RabbitMQ Web STOMP plugin?
In-Reply-To: <1375330632068-28530.post@n5.nabble.com>
References: <1375330632068-28530.post@n5.nabble.com>
Message-ID: <1375868680764-28630.post@n5.nabble.com>


From simon at rabbitmq.com  Wed Aug  7 10:53:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Aug 2013 10:53:28 +0100
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
Message-ID: <52021918.3010804@rabbitmq.com>

On 06/08/13 16:47, Yamil Einar Asusta Santos wrote:
> I have been testing my cluster and I have come across an unexpected
> behavior. As explained in the subject, the cluster runs well on 3
> nodes. If I bring 1 node down, it still runs smoothly. But if I bring
> a second node down, the third one becomes unresponsive. This is what
> the third node provides after running "rabbitmqctl report":

You have pause_minority mode enabled. From
http://www.rabbitmq.com/partitions.html#automatic-handling:

> In pause-minority mode RabbitMQ will automatically pause cluster
> nodes which determine themselves to be in a minority after seeing
> other nodes go down.

So when you stop two nodes, the third determines itself to be in a 
minority, and pauses, becoming unresponsive.

If this behaviour is not what you want, then you don't want 
pause_minority mode.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Wed Aug  7 10:54:18 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 Aug 2013 10:54:18 +0100
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
Message-ID: <5202194A.7020701@rabbitmq.com>

On 06/08/13 16:47, Yamil Einar Asusta Santos wrote:
> I have been testing my cluster and I have come across an unexpected
> behavior. As explained in the subject, the cluster runs well on 3 nodes.
> If I bring 1 node down, it still runs smoothly. But if I bring a second
> node down, the third one becomes unresponsive.
> This is what the third node provides after running "rabbitmqctl report":
>
>     Reporting server status on {{2013,8,6},{15,19,8}}
>       ...
>     Error: {aborted,{no_exists,rabbit_vhost}}
>
>
> Then if I bring 1 or 2 of my nodes back up, the third one becomes
> responsive and everything is back to normal.
>
> Here is the report after bringing the nodes up again:
> [...]
>     Cluster status of node rabbit at qcluster1 ...
>     [{nodes,[{disc,[rabbit at qcluster2,rabbit at qcluster0]},{ram,[rabbit at qcluster1]}]},

You have two disk and one ram node. If you stop both disk nodes, the 
remaining ram node will not be happy.

Matthias.

From simon at rabbitmq.com  Wed Aug  7 10:56:50 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Aug 2013 10:56:50 +0100
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <52021447.6040200@rabbitmq.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
	<e303f971-58bc-4a91-8839-51b1f86d7a7f@googlegroups.com>
	<52021447.6040200@rabbitmq.com>
Message-ID: <520219E2.4070300@rabbitmq.com>

On 07/08/13 10:32, Emile Joubert wrote:
> On 06/08/13 17:53, Yamil Einar Asusta Santos wrote:
>> >I have put the log in
>> >here:https://gist.github.com/elbuo8/e5171ec85608b7bd7842

> The error recorded on 6-Aug-2013::16:29:44 looks like it might be part
> of the problem.

After poking at this a bit, it looks like a cosmetic problem (the 
rabbit_node_monitor process crashes while the application is in the 
middle of stopping anyway). We'll fix this of course, but it's not 
particularly relevant to the OP's situation.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Wed Aug  7 11:04:04 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 07 Aug 2013 11:04:04 +0100
Subject: [rabbitmq-discuss] stomp and message headers
In-Reply-To: <ktqm8f$t71$1@ger.gmane.org>
References: <ktqm8f$t71$1@ger.gmane.org>
Message-ID: <52021B94.1080903@rabbitmq.com>

On 06/08/13 12:21, Matwey V. Kornilov wrote:

> I am trying to send out a message with non-empty headers table. As far 
> as I understand I am free to select any header name and any value type.
> 
> When I receive the message by means of webstomp (stomp.js), there is JS 
> object with three fields: command, headers and body, headers carries 
> both custom user headers and headers like 'content-length', 'message-id' 
> and so on. I even can send message with headers 'content-length', 
> 'message-id' and so on. In this case, my value overwrites initial one. 
> This causes issues.

The 'message-id' header should cause an error in the broker STOMP
adapter when it appears with a SEND frame. (relevant test:
http://hg.rabbitmq.com/rabbitmq-stomp/file/a0cfcfd9c7f2/test/src/lifecycle.py#l111)

So it should not be possible to send messages with a 'message-id'
header. Can you confirm that you see no evidence of an error?

The 'message-id' header is the only one explicitly disallowed by the
broker on SEND.



-Emile









From simon at rabbitmq.com  Wed Aug  7 11:22:09 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Aug 2013 11:22:09 +0100
Subject: [rabbitmq-discuss] Question on RabbitMQ and file I/O
	characteristics
In-Reply-To: <CACLE7izYTbUj9LguaP=hZ2x04+86jd2U9caAa7E6Y5KQEhfhWg@mail.gmail.com>
References: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>
	<51FF779D.6040302@rabbitmq.com>
	<CACLE7iyDFtqS7ZWUr5TNmU-Ou-fE7CUBru3owpekRtLYWk0U=A@mail.gmail.com>
	<52011A7F.9010403@rabbitmq.com>
	<CACLE7izYTbUj9LguaP=hZ2x04+86jd2U9caAa7E6Y5KQEhfhWg@mail.gmail.com>
Message-ID: <52021FD1.50906@rabbitmq.com>

On 06/08/13 18:42, Matt Pietrek wrote:
> The net effect is that messages 'ping-pong' between the two ioloop
> threads as fast as possible. In the 'main' ioloop init, it sends an
> initial message to kick things off.

<snip>

> I also have a global switch (USE_TRANSACTIONS) that lets me switch
> between using transactions and not. When set, it adds tx_select() when
> opening the channels and tx_commit after publishing messages. For the
> tests I was running, I wasn't using transactions. If I do run with
> transactions the numbers are very similar (surprising I know, but I
> stepped through the code to verify that the tx_xxx calls are only made
> when I intend them to be.)

Ah, I see. The thing is that transactions are quite lightweight in and 
of themselves, the reason they tend to slow things down is they form a 
barrier across which we can't coalesce writes / have to wait for a 
synchronous network round trip.

But your ping-pong test is doing the same thing! If it can't send 
another message until the previous one has been received, we can't 
coalesce together two writes. And it also ensures there's only one 
message on the wire at once.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Aug  7 11:28:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Aug 2013 11:28:18 +0100
Subject: [rabbitmq-discuss] 2 Node Cluster Configuration becomes
	unresponsive
In-Reply-To: <2941f537-800b-4d17-8807-f69ac77b71ee@googlegroups.com>
References: <2941f537-800b-4d17-8807-f69ac77b71ee@googlegroups.com>
Message-ID: <52022142.102@rabbitmq.com>

On 07/08/13 09:20, Alexandru Topliceanu wrote:
> The problem is that it sometimes happens that messages are pilled up in
> the queue but no longer forwarded to consumers.
> I don't know what is causing the jam!

I'm not sure either, but this is such basic stuff that I doubt it's the 
broker. Do the messages show up in messages_ready or 
messages_unacknowledged?

> Restarting the consumers doesn't fix the problem.
> All I could do so far is to restart the cluster. This causes all the
> messages to be lost (why? they should be durable)

Are you publishing with delivery mode 2? The messages need to be marked 
as persistent, as well as the queues being durable.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Wed Aug  7 11:38:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 Aug 2013 11:38:44 +0100
Subject: [rabbitmq-discuss] 2 Node Cluster Configuration becomes
	unresponsive
In-Reply-To: <52022142.102@rabbitmq.com>
References: <2941f537-800b-4d17-8807-f69ac77b71ee@googlegroups.com>
	<52022142.102@rabbitmq.com>
Message-ID: <520223B4.7080406@rabbitmq.com>

On 07/08/13 11:28, Simon MacMullen wrote:
> On 07/08/13 09:20, Alexandru Topliceanu wrote:
>> The problem is that it sometimes happens that messages are pilled up in
>> the queue but no longer forwarded to consumers.
>> I don't know what is causing the jam!
>
> I'm not sure either, but this is such basic stuff that I doubt it's the
> broker.

Quite. One issue might be that the connection has died without the 
client noticing. Try enabling amqp heartbeats. I don't know whether 
node.amqp fully supports these; you may want to give amqplib (aka 
amqp.node - https://github.com/squaremo/amqp.node) a try instead.

Matthias.

From matwey.kornilov at gmail.com  Wed Aug  7 11:58:42 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Wed, 7 Aug 2013 14:58:42 +0400
Subject: [rabbitmq-discuss] stomp and message headers
In-Reply-To: <52021B94.1080903@rabbitmq.com>
References: <ktqm8f$t71$1@ger.gmane.org> <52021B94.1080903@rabbitmq.com>
Message-ID: <CAJs94EZGMkv0t494MzjV-6JWQXuz6OYRX9hmVEO7=buyoxn2YA@mail.gmail.com>

2013/8/7 Emile Joubert <emile at rabbitmq.com>:
> The 'message-id' header should cause an error in the broker STOMP
> adapter when it appears with a SEND frame. (relevant test:
> http://hg.rabbitmq.com/rabbitmq-stomp/file/a0cfcfd9c7f2/test/src/lifecycle.py#l111)
>
> So it should not be possible to send messages with a 'message-id'
> header. Can you confirm that you see no evidence of an error?

I do can send message with header 'message-id', and see it on web-page
by means of stomp.js. My rabbitmq is 3.1.3.


The one more question, Why does stomp plugin (adhoc_convert_headers)
filter out all headers with type not in longstr and signednum? It is
not so obviously how to send array in STOMP, but float should be
straightforward.

-- 
With best regards,
Matwey V. Kornilov
http://0x2207.blogspot.com
xmpp:0x2207 at jabber.ru

From simon at rabbitmq.com  Wed Aug  7 12:35:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Aug 2013 12:35:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.4 released
Message-ID: <52023114.9040500@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.1.4.

This release fixes two security bugs: a directory traversal bug for the 
management plugin (and other HTTP applications) on Windows, and a means 
to subvert publish access control using dead-lettering.

This release also fixes a number of bugs in 3.1.0 and earlier versions. 
See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.1.4.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)
_______________________________________________
rabbitmq-announce mailing list
rabbitmq-announce at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-announce

From mklishin at gopivotal.com  Wed Aug  7 12:47:36 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 7 Aug 2013 15:47:36 +0400
Subject: [rabbitmq-discuss] New AMQP 0-9-1 extension added in default/master
Message-ID: <6E055535-AC6E-4D59-AC39-D0CDBC40DA13@gopivotal.com>

I'm happy to report that RabbitMQ 3.2 will support a new AMQP 0-9-1
extension that makes it possible for clients to be notified about
blocked connections [1].

Documentation for the extension is available on next.rabbitmq.com [2].
It is currently supported by 4 clients (in their development branches):

 * Java client
 * .NET client
 * Erlang client
 * Bunny (http://rubybunny.info)

with a couple more clients working on supporting it in the near future.

If you maintain a RabbitMQ client, below are some notes about how
you can add support for this extension.

We've introduced two new AMQP 0-9-1 methods: connection.blocked
and connection.unblocked. This codegen commit demonstrates what
properties of what types they have:
http://hg.rabbitmq.com/rabbitmq-codegen/rev/1748e6cf399a

Next, you need to add connection.blocked to the list of supported extensions
in client capabilities.

How these methods are exposed in the API is client-specific. 
3 clients (Java, .NET, Bunny) let users register event handlers (callbacks)
on connection instances.

Below are two diffs that may help you add support for connection.blocked
to your client:

http://hg.rabbitmq.com/rabbitmq-java-client/rev/fc3a59ca0aab
https://github.com/ruby-amqp/bunny/commit/334d0ceb3f84c03be342ad06dd244f0aa25fb7bc

To test this functionality you can either build RabbitMQ from source (on the default branch)
or use nightly builds available from https://www.rabbitmq.com/nightly-builds.html

If you have any questions about this extension, simply reply to this thread.

1. http://www.rabbitmq.com/memory.html
2. http://next.rabbitmq.com/connection-blocked.html
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/c8ed3a1c/attachment.pgp>

From daniel at pocock.com.au  Wed Aug  7 14:46:05 2013
From: daniel at pocock.com.au (Daniel Pocock)
Date: Wed, 07 Aug 2013 15:46:05 +0200
Subject: [rabbitmq-discuss] C++ client options
Message-ID: <52024F9D.4000501@pocock.com.au>


Hi,

There are various C++ clients listed on the RabbitMQ web site:

https://github.com/alanxz/SimpleAmqpClient
- depends on boost
- MIT license

https://github.com/akalend/amqpcpp
http://code.google.com/p/rabbitcpp/
- no boost dependency
- MIT license (no license info in the github site though, it only
mentions the license on Google Code)

Can anybody comment on which of these projects (or others) to go with?

If we select one of these, I will probably make an official package for
it in Debian+Ubuntu

Regards,

Daniel



From yamil.asusta at upr.edu  Wed Aug  7 15:21:33 2013
From: yamil.asusta at upr.edu (Yamil Einar Asusta Santos)
Date: Wed, 7 Aug 2013 10:21:33 -0400
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <52021447.6040200@rabbitmq.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
	<e303f971-58bc-4a91-8839-51b1f86d7a7f@googlegroups.com>
	<52021447.6040200@rabbitmq.com>
Message-ID: <CA+k2F_CxkY1t21YRRnNdmFBMA6PVqaXU+2Zpq1u7n+kpobQOrQ@mail.gmail.com>

I can reproduce this very reliably.

How can I run an instrumented version?


On Wed, Aug 7, 2013 at 5:32 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 06/08/13 17:53, Yamil Einar Asusta Santos wrote:
>
> > I have put the log in
> > here: https://gist.github.com/elbuo8/e5171ec85608b7bd7842
>
> The error recorded on 6-Aug-2013::16:29:44 looks like it might be part
> of the problem. Can you tell by looking at the other logfiles whether
> anything noteworthy happened at that time? Is anything recorded in the
> sasl log?
>
> Are you able to reproduce this issue reliably? And does the last
> remaining node always have an log entry containing
> "{rabbit_node_monitor,handle_info,2}" ?
>
> Would it be possible for you to run an instrumented version of the
> broker to help discover the cause of the problem? It will help alot if
> you can reproduce the problem with instrumented code in a test environment.
>
> You may wish to configure "cluster_partition_handling" to "ignore" as a
> temporary workaround. This should allow the last node to keep running
> while the others are off-line.
>
>
>
>
> -Emile
>
>
>
>
>


-- 
Yamil Asusta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/42a18c08/attachment.htm>

From yamil.asusta at upr.edu  Wed Aug  7 15:35:35 2013
From: yamil.asusta at upr.edu (Yamil Einar Asusta Santos)
Date: Wed, 7 Aug 2013 10:35:35 -0400
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <52021918.3010804@rabbitmq.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
	<52021918.3010804@rabbitmq.com>
Message-ID: <CA+k2F_BB+wPLg+zf85OKdddLJ4CM6iqoapwgds2mnhOJD5Pg1g@mail.gmail.com>

I understand that. But I have been testing this in two different env. In my
personal env, they remaining node crashes. Versus in the other environment,
the cluster runs on 1 node. Same configurations, both paused_minority.


From matthias at rabbitmq.com  Wed Aug  7 15:38:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 Aug 2013 15:38:23 +0100
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <CA+k2F_CxkY1t21YRRnNdmFBMA6PVqaXU+2Zpq1u7n+kpobQOrQ@mail.gmail.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
	<e303f971-58bc-4a91-8839-51b1f86d7a7f@googlegroups.com>
	<52021447.6040200@rabbitmq.com>
	<CA+k2F_CxkY1t21YRRnNdmFBMA6PVqaXU+2Zpq1u7n+kpobQOrQ@mail.gmail.com>
Message-ID: <52025BDF.5070907@rabbitmq.com>

Yamil,

On 07/08/13 15:21, Yamil Einar Asusta Santos wrote:
> I can reproduce this very reliably.
>
> How can I run an instrumented version?

Please see the other replies in this thread for further analysis of the 
problem you encountered.

Matthias.

From Petr.Gotthard at Honeywell.com  Wed Aug  7 17:16:35 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Wed, 7 Aug 2013 16:16:35 +0000
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <52024F9D.4000501@pocock.com.au>
References: <52024F9D.4000501@pocock.com.au>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>

All the C++ clients listed are wrappers around https://github.com/alanxz/rabbitmq-c.

I may be too old fashioned, but-- did you consider using the C client without any wrappers?


Petr

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Daniel Pocock
Sent: 7. srpna 2013 15:46
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] C++ client options


Hi,

There are various C++ clients listed on the RabbitMQ web site:

https://github.com/alanxz/SimpleAmqpClient
- depends on boost
- MIT license

https://github.com/akalend/amqpcpp
http://code.google.com/p/rabbitcpp/
- no boost dependency
- MIT license (no license info in the github site though, it only mentions the license on Google Code)

Can anybody comment on which of these projects (or others) to go with?

If we select one of these, I will probably make an official package for it in Debian+Ubuntu

Regards,

Daniel


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alan.antonuk at gmail.com  Wed Aug  7 19:10:07 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 7 Aug 2013 11:10:07 -0700
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
References: <52024F9D.4000501@pocock.com.au>
	<F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
Message-ID: <CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>

As Petr mentioned: all of the C++ libraries listed wrap rabbitmq-c.  The
major difference I see between the the different libraries mentioned is how
well they handle asynchronous events. rabbitmq-c doesn't provide a lot of
support API wise for dealing with async events like basic.deliver, or a
channel.close as a result of a basic.publish failure.

SimpleAmqpClient tries to make some of the async bits more synchronous at
the expense of performance. As far as I can tell the others listed don't do
much in the way of error handling at a protocol level.

My (biased) opinion is to use SimpleAmqpClient.  That said, you should
evaluate the API and the performance of the library and see if it fits your
needs.

Full disclosure: I'm the maintainer behind both SimpleAmqpClient and
rabbitmq-c

-Alan


On Wed, Aug 7, 2013 at 9:16 AM, Gotthard, Petr
<Petr.Gotthard at honeywell.com>wrote:

> All the C++ clients listed are wrappers around
> https://github.com/alanxz/rabbitmq-c.
>
> I may be too old fashioned, but-- did you consider using the C client
> without any wrappers?
>
>
> Petr
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Daniel Pocock
> Sent: 7. srpna 2013 15:46
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] C++ client options
>
>
> Hi,
>
> There are various C++ clients listed on the RabbitMQ web site:
>
> https://github.com/alanxz/SimpleAmqpClient
> - depends on boost
> - MIT license
>
> https://github.com/akalend/amqpcpp
> http://code.google.com/p/rabbitcpp/
> - no boost dependency
> - MIT license (no license info in the github site though, it only mentions
> the license on Google Code)
>
> Can anybody comment on which of these projects (or others) to go with?
>
> If we select one of these, I will probably make an official package for it
> in Debian+Ubuntu
>
> Regards,
>
> Daniel
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/07b2dc2e/attachment.htm>

From Petr.Gotthard at Honeywell.com  Wed Aug  7 19:11:20 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Wed, 7 Aug 2013 18:11:20 +0000
Subject: [rabbitmq-discuss] Firehose behaviour for acks
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D36DC5F@FR44EX3005.global.ds.honeywell.com>

Hello,

I'd need to know when messages get delivered to consumers, but the Firehose Tracer publishes the "deliver.queuename" message only when the message leaves the broker. Unfortunately, it's not enough for us to know that the message left the broker, we really need to know it has been delivered.

Did you ever come across this problem?
One solution could be to modify the Firehose to send some tracing message after ack has been received. If we propose such extension, is there a chance to get it accepted into the mainstream? Or you have some other solution in mind?


Thanks,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/ef2b5eda/attachment.htm>

From Petr.Gotthard at Honeywell.com  Wed Aug  7 19:14:41 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Wed, 7 Aug 2013 18:14:41 +0000
Subject: [rabbitmq-discuss] Firehose's "redelivered" header not documented
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D36DC84@FR44EX3005.global.ds.honeywell.com>

Side note:
in the "deliver.queuename" messages, Firehose Tracer sends a "redelivered" header. This is not documented.

Is it a legal feature? ;-)


Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/2f048490/attachment.htm>

From alan.antonuk at gmail.com  Wed Aug  7 19:32:51 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 7 Aug 2013 11:32:51 -0700
Subject: [rabbitmq-discuss] New AMQP 0-9-1 extension added in
	default/master
In-Reply-To: <6E055535-AC6E-4D59-AC39-D0CDBC40DA13@gopivotal.com>
References: <6E055535-AC6E-4D59-AC39-D0CDBC40DA13@gopivotal.com>
Message-ID: <CAAt2poJvHepB-GTuJjEr1-HkUKuHTUu9xuXecp2MzBL6yEv6uw@mail.gmail.com>

Initial support has been added in rabbitmq-c here:
https://github.com/alanxz/rabbitmq-c/pull/133


On Wed, Aug 7, 2013 at 4:47 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> I'm happy to report that RabbitMQ 3.2 will support a new AMQP 0-9-1
> extension that makes it possible for clients to be notified about
> blocked connections [1].
>
> Documentation for the extension is available on next.rabbitmq.com [2].
> It is currently supported by 4 clients (in their development branches):
>
>  * Java client
>  * .NET client
>  * Erlang client
>  * Bunny (http://rubybunny.info)
>
> with a couple more clients working on supporting it in the near future.
>
> If you maintain a RabbitMQ client, below are some notes about how
> you can add support for this extension.
>
> We've introduced two new AMQP 0-9-1 methods: connection.blocked
> and connection.unblocked. This codegen commit demonstrates what
> properties of what types they have:
> http://hg.rabbitmq.com/rabbitmq-codegen/rev/1748e6cf399a
>
> Next, you need to add connection.blocked to the list of supported
> extensions
> in client capabilities.
>
> How these methods are exposed in the API is client-specific.
> 3 clients (Java, .NET, Bunny) let users register event handlers (callbacks)
> on connection instances.
>
> Below are two diffs that may help you add support for connection.blocked
> to your client:
>
> http://hg.rabbitmq.com/rabbitmq-java-client/rev/fc3a59ca0aab
>
> https://github.com/ruby-amqp/bunny/commit/334d0ceb3f84c03be342ad06dd244f0aa25fb7bc
>
> To test this functionality you can either build RabbitMQ from source (on
> the default branch)
> or use nightly builds available from
> https://www.rabbitmq.com/nightly-builds.html
>
> If you have any questions about this extension, simply reply to this
> thread.
>
> 1. http://www.rabbitmq.com/memory.html
> 2. http://next.rabbitmq.com/connection-blocked.html
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/8bdfe6ae/attachment.htm>

From stuff at moesel.net  Wed Aug  7 19:42:33 2013
From: stuff at moesel.net (Chris)
Date: Wed, 7 Aug 2013 14:42:33 -0400
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
References: <52024F9D.4000501@pocock.com.au>
	<F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
	<CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
Message-ID: <CAHEpgBDoeEL_a8W5jBJ-0ud8RV3udcTjaDapVmb4ET3TYXKHQQ@mail.gmail.com>

My team went through this decision a few months ago.  We decided to go with
SimpleAmqpClient for a few reasons:

   - Its author (Alan) is very involved in the community and very
   responsive to questions.
   - Its author is intimately familiar w/ rabbitmq-c, so likely knows best
   how to leverage its capabilities
   - It seems to be better documented and more frequently maintained than
   the alternatives

Several months in, we're still happy with the choice we have made.  Of
course we have our list of features we'd love to see implemented, but
everything it does so far, it does well!  (Thanks, Alan!)

-Chris



On Wed, Aug 7, 2013 at 2:10 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:

> As Petr mentioned: all of the C++ libraries listed wrap rabbitmq-c.  The
> major difference I see between the the different libraries mentioned is how
> well they handle asynchronous events. rabbitmq-c doesn't provide a lot of
> support API wise for dealing with async events like basic.deliver, or a
> channel.close as a result of a basic.publish failure.
>
> SimpleAmqpClient tries to make some of the async bits more synchronous at
> the expense of performance. As far as I can tell the others listed don't do
> much in the way of error handling at a protocol level.
>
> My (biased) opinion is to use SimpleAmqpClient.  That said, you should
> evaluate the API and the performance of the library and see if it fits your
> needs.
>
> Full disclosure: I'm the maintainer behind both SimpleAmqpClient and
> rabbitmq-c
>
> -Alan
>
>
> On Wed, Aug 7, 2013 at 9:16 AM, Gotthard, Petr <
> Petr.Gotthard at honeywell.com> wrote:
>
>> All the C++ clients listed are wrappers around
>> https://github.com/alanxz/rabbitmq-c.
>>
>> I may be too old fashioned, but-- did you consider using the C client
>> without any wrappers?
>>
>>
>> Petr
>>
>> -----Original Message-----
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
>> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Daniel Pocock
>> Sent: 7. srpna 2013 15:46
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: [rabbitmq-discuss] C++ client options
>>
>>
>> Hi,
>>
>> There are various C++ clients listed on the RabbitMQ web site:
>>
>> https://github.com/alanxz/SimpleAmqpClient
>> - depends on boost
>> - MIT license
>>
>> https://github.com/akalend/amqpcpp
>> http://code.google.com/p/rabbitcpp/
>> - no boost dependency
>> - MIT license (no license info in the github site though, it only
>> mentions the license on Google Code)
>>
>> Can anybody comment on which of these projects (or others) to go with?
>>
>> If we select one of these, I will probably make an official package for
>> it in Debian+Ubuntu
>>
>> Regards,
>>
>> Daniel
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/4a3dabaa/attachment.htm>

From gmr at meetme.com  Wed Aug  7 19:44:38 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 7 Aug 2013 14:44:38 -0400
Subject: [rabbitmq-discuss] New AMQP 0-9-1 extension added in
 default/master
In-Reply-To: <CAAt2poJvHepB-GTuJjEr1-HkUKuHTUu9xuXecp2MzBL6yEv6uw@mail.gmail.com>
References: <6E055535-AC6E-4D59-AC39-D0CDBC40DA13@gopivotal.com>
	<CAAt2poJvHepB-GTuJjEr1-HkUKuHTUu9xuXecp2MzBL6yEv6uw@mail.gmail.com>
Message-ID: <B9297E70A7ED4F96B8FBC88C8068FA50@meetme.com>

Likewise the pamqp low level Python codec has it: 

https://github.com/pika/pamqp/commit/b4fb658b84004116d73ec6741c47dbd8d73cb880

It will be making its way into pika and rmqid soon. 


On Wednesday, August 7, 2013 at 2:32 PM, Alan Antonuk wrote:

> Initial support has been added in rabbitmq-c here:
> https://github.com/alanxz/rabbitmq-c/pull/133
> 
> 
> On Wed, Aug 7, 2013 at 4:47 AM, Michael Klishin <mklishin at gopivotal.com (mailto:mklishin at gopivotal.com)> wrote:
> > I'm happy to report that RabbitMQ 3.2 will support a new AMQP 0-9-1
> > extension that makes it possible for clients to be notified about
> > blocked connections [1].
> > 
> > Documentation for the extension is available on next.rabbitmq.com (http://next.rabbitmq.com) [2].
> > It is currently supported by 4 clients (in their development branches):
> > 
> >  * Java client
> >  * .NET client
> >  * Erlang client
> >  * Bunny (http://rubybunny.info)
> > 
> > with a couple more clients working on supporting it in the near future.
> > 
> > If you maintain a RabbitMQ client, below are some notes about how
> > you can add support for this extension.
> > 
> > We've introduced two new AMQP 0-9-1 methods: connection.blocked
> > and connection.unblocked. This codegen commit demonstrates what
> > properties of what types they have:
> > http://hg.rabbitmq.com/rabbitmq-codegen/rev/1748e6cf399a
> > 
> > Next, you need to add connection.blocked to the list of supported extensions
> > in client capabilities.
> > 
> > How these methods are exposed in the API is client-specific.
> > 3 clients (Java, .NET, Bunny) let users register event handlers (callbacks)
> > on connection instances.
> > 
> > Below are two diffs that may help you add support for connection.blocked
> > to your client:
> > 
> > http://hg.rabbitmq.com/rabbitmq-java-client/rev/fc3a59ca0aab
> > https://github.com/ruby-amqp/bunny/commit/334d0ceb3f84c03be342ad06dd244f0aa25fb7bc
> > 
> > To test this functionality you can either build RabbitMQ from source (on the default branch)
> > or use nightly builds available from https://www.rabbitmq.com/nightly-builds.html
> > 
> > If you have any questions about this extension, simply reply to this thread.
> > 
> > 1. http://www.rabbitmq.com/memory.html
> > 2. http://next.rabbitmq.com/connection-blocked.html
> > --
> > MK
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/a2020ada/attachment.htm>

From alan.antonuk at gmail.com  Wed Aug  7 20:16:02 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 7 Aug 2013 12:16:02 -0700
Subject: [rabbitmq-discuss] AMQP library APIs
Message-ID: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>

I've been doing a bit of thinking about building a more fully-featured
native AMQP client library in C/C++, and have been pondering where to go
with designing the public API for the library.

A question for the authors of AMQP client libraries: if you could change
the the public API to your library, what would you change? (and why?).

Thanks
-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/656e3764/attachment.htm>

From mklishin at gopivotal.com  Wed Aug  7 21:11:09 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 8 Aug 2013 00:11:09 +0400
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
Message-ID: <856C10B1-6180-4246-9EA6-5C30DC566907@gopivotal.com>

Alan Antonuk:

> A question for the authors of AMQP client libraries: if you could change the the public API to your library, what would you change? (and why?).

I wouldn't change much of the public API but have some recommendations about what clients
should focus on (according to me).

In most AMQP 0-9-1 clients at the moment, the single most painful thing is
network failure recovery. I believe this is not a trivial matter (protocol state does isn't helping, too), and will be harder to get right in
C and C++, but at the moment, most clients in garbage collected languages
don't even try.

amqp gem, Bunny serve as good examples of how it can be made much easier
for common cases. I hope to make HotBunnies and Langohr support the same
automatic recovery process fairly soon.

Hopefully some time after that there will be enough evidence to consider
adding the same set of features to Java and .NET clients, as well as Pika and amqp.node.

Some clients try to introduce their own abstractions to be more convenient. It's OK as long
as they are clearly documented and you still know how to access every protocol feature
there is.

So, expose the protocol as it is and make it as easy as possible to recover from network
failures. Then document it well.

HTH.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/93f6508f/attachment.pgp>

From david.tinker at gmail.com  Wed Aug  7 21:34:11 2013
From: david.tinker at gmail.com (David Tinker)
Date: Wed, 7 Aug 2013 22:34:11 +0200
Subject: [rabbitmq-discuss] ANN QDB 0.4.5 released
Message-ID: <CA+O6_Fe8yaFHkJCc=2ptP-7Thk1EdPVmKs2uUgRb9pHoivGZ+A@mail.gmail.com>

Release Notes:
- Added 'to' and 'toId' to the retrieve messages endpoint to stream
messages until a timestamp or id is reached
- Added 'noPayload=true' option to the retrieve messages endpoint
- Added 'to' and 'toId' to outputs to output messages until a
timestamp or id is reached

http://qdb.io/ Persistent Message Queues With Replay and #RabbitMQ Integration

From daniel at pocock.com.au  Wed Aug  7 21:49:47 2013
From: daniel at pocock.com.au (Daniel Pocock)
Date: Wed, 07 Aug 2013 22:49:47 +0200
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
References: <52024F9D.4000501@pocock.com.au>
	<F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
	<CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
Message-ID: <5202B2EB.2000203@pocock.com.au>



On 07/08/13 20:10, Alan Antonuk wrote:
> As Petr mentioned: all of the C++ libraries listed wrap rabbitmq-c.  The
> major difference I see between the the different libraries mentioned is how
> well they handle asynchronous events. rabbitmq-c doesn't provide a lot of
> support API wise for dealing with async events like basic.deliver, or a
> channel.close as a result of a basic.publish failure.

Does this mean we need to block and/or use threads to receive messages?

Do you envisage making it work like boost::asio or have you seen
anything like that for AMQP?

> SimpleAmqpClient tries to make some of the async bits more synchronous at
> the expense of performance. As far as I can tell the others listed don't do
> much in the way of error handling at a protocol level.
> 
> My (biased) opinion is to use SimpleAmqpClient.  That said, you should
> evaluate the API and the performance of the library and see if it fits your
> needs.
> 
> Full disclosure: I'm the maintainer behind both SimpleAmqpClient and
> rabbitmq-c

Did you collaborate with anybody for the Debian package of the C client?
http://packages.debian.org/jessie/librabbitmq-dev

Has anybody discussed a package of the C++ client?


Just some background: I'm mentoring a student with Google Summer of
Code, he is making some changes to the reSIProcate project

reSIProcate is a strongly object-oriented C++ project, so to remain
consistent with the code style, using C++ would be nice.  Regular C
could be used too.  Some parts of the stack use asio, other parts use a
similar, single threaded async model.

What we have here is a SIP voice conferencing application:

  https://github.com/resiprocate/reConServer

The original version of the code just takes commands and prints
responses through stdin/stdout.  We would like to replace that with JSON
over RabbitMQ / AMQP

E.g.

- when a new caller dials in, a JSON message goes out on a topic

- the admin can send an instruction over a queue (e.g. move caller A
from room 1 to room 2)


From alan.antonuk at gmail.com  Wed Aug  7 22:27:30 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 7 Aug 2013 14:27:30 -0700
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <856C10B1-6180-4246-9EA6-5C30DC566907@gopivotal.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
	<856C10B1-6180-4246-9EA6-5C30DC566907@gopivotal.com>
Message-ID: <CAAt2poKTP9Etx78KyeMbZL6g1+XEDGyH235_4gGkY7ppn=ugpg@mail.gmail.com>

On Wed, Aug 7, 2013 at 1:11 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> amqp gem, Bunny serve as good examples of how it can be made much easier
> for common cases. I hope to make HotBunnies and Langohr support the same
> automatic recovery process fairly soon.
>

Interesting, whole connection recovery is something I haven't really
considered.  Any reason why individual channel recovery on error isn't
implemented?

I guess one thought I have had is to abstract away AMQP channels from the
public API.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/eb182c8b/attachment.htm>

From mklishin at gopivotal.com  Wed Aug  7 22:43:57 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 8 Aug 2013 01:43:57 +0400
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <CAAt2poKTP9Etx78KyeMbZL6g1+XEDGyH235_4gGkY7ppn=ugpg@mail.gmail.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
	<856C10B1-6180-4246-9EA6-5C30DC566907@gopivotal.com>
	<CAAt2poKTP9Etx78KyeMbZL6g1+XEDGyH235_4gGkY7ppn=ugpg@mail.gmail.com>
Message-ID: <1A49B5EB-CA5C-41C7-8BAC-2FB97A2B7396@gopivotal.com>

Alan Antonuk:

> Interesting, whole connection recovery is something I haven't really considered.  Any reason why individual channel recovery on error isn't implemented?

Bunny's automatic recovery is for network failures, not connection exceptions (which are rare
and severe, and should be as visible as possible).

> I guess one thought I have had is to abstract away AMQP channels from the public API.

I don't think this is a good idea. First, it is part of the protocol
and developers may want to use that. Second, error handling for operations such as queue.declare
or basic.publish, is per-channel. Finally, basic.qos setting, delivery tags and publisher confirms
are all per-channel.

Bunny before 0.9 tried to completely hide channels in the API. I don't think it's gained it any
new users but it surely annoyed those who needed to use more than one channel. Shaving off one
line from "Hello, world" is as much as it did.

Bunny 0.9 requires opening channels explicitly and I haven't heard a single complaint about that.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/483b1781/attachment.pgp>

From stuff at moesel.net  Wed Aug  7 22:50:04 2013
From: stuff at moesel.net (Chris)
Date: Wed, 7 Aug 2013 17:50:04 -0400
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <CAAt2poKTP9Etx78KyeMbZL6g1+XEDGyH235_4gGkY7ppn=ugpg@mail.gmail.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
	<856C10B1-6180-4246-9EA6-5C30DC566907@gopivotal.com>
	<CAAt2poKTP9Etx78KyeMbZL6g1+XEDGyH235_4gGkY7ppn=ugpg@mail.gmail.com>
Message-ID: <CAHEpgBD-6dG6xEcktBYabxAJVa5a+kh_yYXnexrSD1e_aGYjRw@mail.gmail.com>

+1 for connection recovery and automatic fail-over in a cluster.  In my
opinion, this should automagically connect/reconnect to the server,
redeclare and/or rebind any non-durable objects, and reconsume from the
queues.  It should also reconsume if a master queue dies and a slave queue
is promoted.

I'm working on a project that uses amqp libraries in Java, C#, C++, and
node.js, and it's a pain to have to handle this ourselves in each (except
node-amqp, which mostly works for this).  On the other hand, it's free, so
I try not to complain too much. ;-)

-Chris



On Wed, Aug 7, 2013 at 5:27 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:

>
> On Wed, Aug 7, 2013 at 1:11 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>
>>
>> amqp gem, Bunny serve as good examples of how it can be made much easier
>> for common cases. I hope to make HotBunnies and Langohr support the same
>> automatic recovery process fairly soon.
>>
>
> Interesting, whole connection recovery is something I haven't really
> considered.  Any reason why individual channel recovery on error isn't
> implemented?
>
> I guess one thought I have had is to abstract away AMQP channels from the
> public API.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/fe93234c/attachment.htm>

From daniel at pocock.com.au  Wed Aug  7 22:58:20 2013
From: daniel at pocock.com.au (Daniel Pocock)
Date: Wed, 07 Aug 2013 23:58:20 +0200
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
Message-ID: <5202C2FC.8080303@pocock.com.au>



On 07/08/13 21:16, Alan Antonuk wrote:
> I've been doing a bit of thinking about building a more fully-featured
> native AMQP client library in C/C++, and have been pondering where to go
> with designing the public API for the library.
> 
> A question for the authors of AMQP client libraries: if you could change
> the the public API to your library, what would you change? (and why?).
> 

Here is some feedback from the non-AMQP world

As mentioned in the other thread, I'm working with things like SIP and
boost::asio (sometimes together)

asio and boost::asio are very compelling for asynchronous programming
and distributed systems.

Not so long ago I was looking for a WebSocket client library and I came
across websocketpp: it basically builds on asio to provide an async
WebSockets API.  It was really trivial for me to take that and then add
in SIP over WebSocket, you can see how it works in this example:

https://github.com/zaphoyd/websocketpp/tree/master/examples/sip_client

It would be really nice to have a similar paradigm for AMQP programming,
e.g. receiving callbacks for different types of events (message
receiving, failures, etc)


From alan.antonuk at gmail.com  Wed Aug  7 23:32:20 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 7 Aug 2013 15:32:20 -0700
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <1A49B5EB-CA5C-41C7-8BAC-2FB97A2B7396@gopivotal.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
	<856C10B1-6180-4246-9EA6-5C30DC566907@gopivotal.com>
	<CAAt2poKTP9Etx78KyeMbZL6g1+XEDGyH235_4gGkY7ppn=ugpg@mail.gmail.com>
	<1A49B5EB-CA5C-41C7-8BAC-2FB97A2B7396@gopivotal.com>
Message-ID: <CAAt2poJyY80tuBCgi1JyDXBThm1VY511RoBQNgtET1Vg9Yx60g@mail.gmail.com>

On Wed, Aug 7, 2013 at 2:43 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> Bunny's automatic recovery is for network failures, not connection
> exceptions (which are rare
> and severe, and should be as visible as possible).
>

I agree with you on the connection exceptions, in that case it makes a lot
of sense to be loud.  However I was thinking in the case of a channel
exception being thrown.  E.g., you have a consumer associated with a
channel, and you happen to publish to a non-existent exchange, whoops that
consumer goes away. Obviously the client code should be notified of the
failure, but from an API perspective its annoying to have something that is
potentially unrelated be affected and have to be recreated.


> I don't think this is a good idea. First, it is part of the protocol
> and developers may want to use that. Second, error handling for operations
> such as queue.declare
> or basic.publish, is per-channel. Finally, basic.qos setting, delivery
> tags and publisher confirms
> are all per-channel.
>

That makes me wonder what is it that developers use channels for?  My
understanding is they're were designed to be an 'error scope' at a protocol
level. I don't see a lot of developers using them that way, and sometimes
its the source of a bit of pain (having to recreate any resources that get
destroyed as a result of a channel exception, or in bad cases, their whole
app aborts because the channel dies).

My thinking is that an API could be created that internally uses channels
intelligently to give more native feel to error handling. One example of
changing the API might be: instead of apply basic.qos to a channel, you
apply it to a consumer, and internally the library maps a consumer to a
channel, so a BasicQos on a consumer.  The same can be done for other
aspects of the protocol (this is what I ended up doing with
SimpleAmqpClient).  A downside being the API may not map 1:1  to a lot of
the documentation that is out there.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/ff72d3b0/attachment.htm>

From alan.antonuk at gmail.com  Wed Aug  7 23:57:27 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 7 Aug 2013 15:57:27 -0700
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <5202B2EB.2000203@pocock.com.au>
References: <52024F9D.4000501@pocock.com.au>
	<F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
	<CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
	<5202B2EB.2000203@pocock.com.au>
Message-ID: <CAAt2poJ7VRb1dq1ZsEA_Y4jRSqdDRKaKvpnRxMq4dAafVmp-Fw@mail.gmail.com>

On Wed, Aug 7, 2013 at 1:49 PM, Daniel Pocock <daniel at pocock.com.au> wrote:

> Does this mean we need to block and/or use threads to receive messages?
>

Yes, the state of rabbitmq-c and SimpleAmqpClient when waiting for a
delivery from a consumer is you need to block, optionally with a timeout.

The problem I'm stating is that AMQP has some async parts to the protocol,
and rabbitmq-c doesn't do anything to handle these events as they're fired
from the broker.  They're only 'seen' by rabbitmq-c when synchronous calls
are made.


> Do you envisage making it work like boost::asio or have you seen
> anything like that for AMQP?
>

A few years back I started to implement a pure C++ AMQP client library
leveraging boost::asio.  You can find it here:
https://github.com/alanxz/libamqp-cpp
The project was not completed. I don't have plans to resume work it.

Recently I have been doing a bit of design work to see what would be
necessary to create an library that leverages libuv to make a
fully-functional native AMQP client.


> Did you collaborate with anybody for the Debian package of the C client?
> http://packages.debian.org/jessie/librabbitmq-dev
>
> That package is very old.  People have come to me time-to-time for
assistance in creating a Ubuntu and/or Debian package, and not having a lot
of knowledge in the process I do what I can to help out.  Currently there
is some packaging material in the debian directory of the rabbitmq-c repo.
 It is somewhat out of date, though not as old as what you've linked.

I personally would like to move the packaging details out of the repository
to allow for different distributions to come up with their own independent
packaging, as each distribution seems to do things in a slightly different
and incompatible way. If you or someone you know is willing to step up and
help maintain said package, I will do what I can to help out.


Has anybody discussed a package of the C++ client?
>

I haven't heard of anyone doing so.  One roadblock is that when
SimpleAmqpClient was created it used a newer version of boost than came
packaged with the LTS version of Ubuntu because it needed the boost.chrono
library which was fairly new at the time.  I'm not sure if the situation
has changed since then.

Again if you or someone you know is willing to step up and help maintain an
SimpleAmqpClient package, I will do what I can to help out.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/7c36357d/attachment.htm>

From nellaivijay at gmail.com  Wed Aug  7 21:55:37 2013
From: nellaivijay at gmail.com (Vijayakumar Ramdoss)
Date: Wed, 7 Aug 2013 13:55:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Install error erlang not found but is installed
	in Redhat
Message-ID: <7e1188a5-2164-4ab9-bd66-d1c46cd51335@googlegroups.com>

Hi Gurus,
I have a similar issue 
https://groups.google.com/forum/#!topic/rabbitmq-discuss/ozPHDL5XW30 which 
was described by John Beaulaurier
Any workaround for this issue if we installed the ErLang from the Source. 

Thanks
Vijay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130807/0f16f8d7/attachment.htm>

From verenate at verenate.com  Thu Aug  8 09:25:58 2013
From: verenate at verenate.com (Guillaume Vernat)
Date: Thu, 8 Aug 2013 10:25:58 +0200
Subject: [rabbitmq-discuss] fail upgrade from 3.1.3 to 3.1.4
Message-ID: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>

Hy,

I try to up upgrade a cluster from 3.1.3 to 3.1.4 on debian wheezy.
apt-get update
apt-get dist-upgrade

but upgrade fail because I did not stop the cluster nodes :(
I finally stop the other cluster nodes but it was too late for the first
one.

How can I start back the first node ?
I already touch /var/lib/rabbitmq/mnesia/<node>/nodes_running_at_shutdown,
rabbit_serial, cluster_nodes.config but it fail again.

Guillaume
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/f023c7b1/attachment.htm>

From emile at rabbitmq.com  Thu Aug  8 09:29:22 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 08 Aug 2013 09:29:22 +0100
Subject: [rabbitmq-discuss] Install error erlang not found but is
 installed in Redhat
In-Reply-To: <7e1188a5-2164-4ab9-bd66-d1c46cd51335@googlegroups.com>
References: <7e1188a5-2164-4ab9-bd66-d1c46cd51335@googlegroups.com>
Message-ID: <520356E2.6010402@rabbitmq.com>

On 07/08/13 21:55, Vijayakumar Ramdoss wrote:
> I have a similar
> issue https://groups.google.com/forum/#!topic/rabbitmq-discuss/ozPHDL5XW30 which
> was described by John Beaulaurier
> Any workaround for this issue if we installed the ErLang from the Source. 

Have you tried any of the suggestions in that thread? What is the error?





-Emile





From daniel at pocock.com.au  Thu Aug  8 09:46:26 2013
From: daniel at pocock.com.au (Daniel Pocock)
Date: Thu, 08 Aug 2013 10:46:26 +0200
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <CAAt2poJ7VRb1dq1ZsEA_Y4jRSqdDRKaKvpnRxMq4dAafVmp-Fw@mail.gmail.com>
References: <52024F9D.4000501@pocock.com.au>
	<F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
	<CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
	<5202B2EB.2000203@pocock.com.au>
	<CAAt2poJ7VRb1dq1ZsEA_Y4jRSqdDRKaKvpnRxMq4dAafVmp-Fw@mail.gmail.com>
Message-ID: <52035AE2.9030809@pocock.com.au>

On 08/08/13 00:57, Alan Antonuk wrote:
>
> On Wed, Aug 7, 2013 at 1:49 PM, Daniel Pocock <daniel at pocock.com.au
> <mailto:daniel at pocock.com.au>> wrote:
>
>     Does this mean we need to block and/or use threads to receive
>     messages?
>
>
> Yes, the state of rabbitmq-c and SimpleAmqpClient when waiting for a
> delivery from a consumer is you need to block, optionally with a timeout.
>  
> The problem I'm stating is that AMQP has some async parts to the
> protocol, and rabbitmq-c doesn't do anything to handle these events as
> they're fired from the broker.  They're only 'seen' by rabbitmq-c when
> synchronous calls are made.
>
>
>     Do you envisage making it work like boost::asio or have you seen
>     anything like that for AMQP?
>
>
> A few years back I started to implement a pure C++ AMQP client library
> leveraging boost::asio.  You can find it here:
> https://github.com/alanxz/libamqp-cpp
> The project was not completed. I don't have plans to resume work it.
>
> Recently I have been doing a bit of design work to see what would be
> necessary to create an library that leverages libuv to make a
> fully-functional native AMQP client.

Personally, I wouldn't want to favour any of these solutions over any
other, they are all good.

The most important thing will be demonstrating how it integrates with
higher level code, particularly if the high level code is using an event
loop other than the one you choose yourself.  E.g. will the end user
have to run your event loop in a thread and when they get callbacks from
your code, they will have to pass data to their own event loop thread in
a thread-safe manner?

Another thing that comes to mind is the question of adding an
abstraction layer, just like JMS in the Java world.  The only one I've
come across so far is OpenMAMA:
http://www.openmama.org - do you believe RabbitMQ users could benefit
from coding to the OpenMAMA API and using some low-level driver for AMQP
or RabbitMQ specifically?  This would be more like the JMS programming
paradigm.


>  
>
>     Did you collaborate with anybody for the Debian package of the C
>     client?
>     http://packages.debian.org/jessie/librabbitmq-dev
>
> That package is very old.  People have come to me time-to-time for
> assistance in creating a Ubuntu and/or Debian package, and not having
> a lot of knowledge in the process I do what I can to help out.
>  Currently there is some packaging material in the debian directory of
> the rabbitmq-c repo.  It is somewhat out of date, though not as old as
> what you've linked.
>

I'll contact the maintainers and if they are not actively updating it, I
might volunteer to refresh it


> I personally would like to move the packaging details out of the
> repository to allow for different distributions to come up with their
> own independent packaging, as each distribution seems to do things in
> a slightly different and incompatible way. If you or someone you know
> is willing to step up and help maintain said package, I will do what I
> can to help out.
>

Debian often maintains packaging artifacts in git repositories in alioth
these days.  When we import your release tarball into our git
repository, we can easily tell it to ignore any debian/ directory you
have.  For older versions of Debian this was problematic though.  My own
suggestion is that you can include your own debian/ artifacts in your
repository if you wish to maintain them, but when you prepare a release
tarball, exclude that subtree.

>
>     Has anybody discussed a package of the C++ client?
>
>
> I haven't heard of anyone doing so.  One roadblock is that when
> SimpleAmqpClient was created it used a newer version of boost than
> came packaged with the LTS version of Ubuntu because it needed the
> boost.chrono library which was fairly new at the time.  I'm not sure
> if the situation has changed since then.
>

I would be aiming to introduce something in Debian unstable to begin
with.  From there, it will propagate to other distributions over time
and if those distributions operate commercially (like Ubuntu) and their
clients really want it, they will hopefully collaborate with you to
resolve the problem and contribute fixes for you.

> Again if you or someone you know is willing to step up and help
> maintain an SimpleAmqpClient package, I will do what I can to help out.
>

I'd like to understand your feelings about the future of the API before
committing to that - do you see something based on libuv happening in
the near future, e.g. within 6 months?



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/d04996c6/attachment.htm>

From simon at rabbitmq.com  Thu Aug  8 10:08:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Aug 2013 10:08:08 +0100
Subject: [rabbitmq-discuss] Firehose's "redelivered" header not
	documented
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D36DC84@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D36DC84@FR44EX3005.global.ds.honeywell.com>
Message-ID: <52035FF8.2080408@rabbitmq.com>

On 07/08/2013 7:14PM, Gotthard, Petr wrote:
> Side note:
>
> in the "deliver./queuename/" messages, Firehose Tracer sends a
> "redelivered" header. This is not documented.
>
> Is it a legal feature? ;-)

Oh yes. We'll add that to the documentation...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Aug  8 10:09:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Aug 2013 10:09:45 +0100
Subject: [rabbitmq-discuss] Firehose behaviour for acks
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D36DC5F@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D36DC5F@FR44EX3005.global.ds.honeywell.com>
Message-ID: <52036059.3040703@rabbitmq.com>

Yes, that's a limitation.

There's a half worked on patch somewhere to get the firehose to 
(optionally) report on all AMQP methods. I abandoned it because it was 
quite involved and it wasn't obvious anyone would care.

In the absence of that, the only real option is to use the Java client's 
AMQP tracer proxy instead: http://www.rabbitmq.com/api-guide.html#tracer 
- or something like Wireshark.

Cheers, Simon

On 07/08/2013 7:11PM, Gotthard, Petr wrote:
> Hello,
>
> I?d need to know when messages get delivered to consumers, but the
> Firehose Tracer publishes the "deliver.queuename" message only when the
> message leaves the broker. Unfortunately, it?s not enough for us to know
> that the message left the broker, we really need to know it has been
> delivered.
>
> Did you ever come across this problem?
>
> One solution could be to modify the Firehose to send some tracing
> message after ack has been received. If we propose such extension, is
> there a chance to get it accepted into the mainstream? Or you have some
> other solution in mind?
>
> Thanks,
>
> Petr
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Aug  8 10:55:55 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Aug 2013 10:55:55 +0100
Subject: [rabbitmq-discuss] fail upgrade from 3.1.3 to 3.1.4
In-Reply-To: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>
References: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>
Message-ID: <52036B2B.3060902@rabbitmq.com>

Huh. You should not need to stop the cluster to do a minor version 
upgrade like that. What error are you seeing?

Cheers, Simon

On 08/08/2013 9:25AM, Guillaume Vernat wrote:
> Hy,
>
> I try to up upgrade a cluster from 3.1.3 to 3.1.4 on debian wheezy.
> apt-get update
> apt-get dist-upgrade
>
> but upgrade fail because I did not stop the cluster nodes :(
> I finally stop the other cluster nodes but it was too late for the first
> one.
>
> How can I start back the first node ?
> I already touch
> /var/lib/rabbitmq/mnesia/<node>/nodes_running_at_shutdown,
> rabbit_serial, cluster_nodes.config but it fail again.
>
> Guillaume
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sekhar434145 at gmail.com  Thu Aug  8 11:38:58 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Thu, 8 Aug 2013 16:08:58 +0530
Subject: [rabbitmq-discuss] RabbitMQ + JBoss AS7 clustered Integration
Message-ID: <CAH75Yb5x5hprhKvgA-D2EU3eZ5GXWAXDZYVardWTDwLVDP9rUg@mail.gmail.com>

Hi,

Am new to RabbitMQ, I want to implement a RabbitMQ as messaging Queue. My
application is running on JBoss AS7 clustered environment. So, could any
one please share how to integrtae RabbitMQ in JBoss AS7 cluster. Appreciate
the  response.


Thanks,
Pand005
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/1d8844f0/attachment.htm>

From timrobertson100 at gmail.com  Thu Aug  8 11:39:46 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Thu, 8 Aug 2013 12:39:46 +0200
Subject: [rabbitmq-discuss] Duplicated message and unknown delivery tag
 after ack
In-Reply-To: <CADtU9_udtSvbY4duxRHPHrAn7uR5KOa0tZGYvdFJTK+nO8kLeA@mail.gmail.com>
References: <ae768eb4-3b32-4e9e-b6b2-37c6a723ef23@googlegroups.com>
	<51FA2E7D.4090209@rabbitmq.com>
	<CADtU9_udtSvbY4duxRHPHrAn7uR5KOa0tZGYvdFJTK+nO8kLeA@mail.gmail.com>
Message-ID: <CAMsy_NhhZJK9EKzd7=twDraMhHgiopR10haxHGO5MUErh8FXjQ@mail.gmail.com>

Hi all,

Were there any further insights into this?
I am seeing the same behavior on 3.1.3 on my mac (homebrew install) and
using rabbiteasy (1.2.0) and amqp java libraries 3.1.3.

I'm digging into it, but though I'd ask.

Cheers,
Tim



On Fri, Aug 2, 2013 at 6:20 PM, Gary Russell <grussell at gopivotal.com> wrote:

> Also, while I don't believe there have been any changes to Spring AMQP in
> this area, I would recommend using the latest version - 1.2.0 (or, at least
> 1.1.4).
>
>
> On Thu, Aug 1, 2013 at 5:46 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>>
>> Hi Lukasz,
>>
>> On 31/07/13 17:30, Lukasz Olczak wrote:
>> > com.rabbitmq.client.ShutdownSignalException: channel error; reason:
>> > {#method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED -
>> > unknown delivery tag 1, class-id=60, method-id=80), null, ""}
>>
>>
>> There are legitimate ways in which multiple consumers could get hold of
>> the same message, in the same second. If any consumer rejects a message
>> or reconnects then unacknowledged messages will be returned to the
>> broker and may be delivered to other consumers. Such messages will have
>> the redelivered flag set.
>>
>> The error you quote could also arise if an application acknowledges
>> messages incorrectly. Make sure that messages are only acknowledged once.
>>
>>
>> > Anybody knows why RabbitMQ duplicates messages on a single broker with a
>> > publisher and consumers connected through loopback interface?
>>
>>
>>
>> This is unlikely to have anything to do with the loopback interface
>> directly. Though loopback offers greater speed which may expose race
>> conditions.
>>
>> If you believe there is a broker error then please run your test via the
>> Tracer protocol analyser and send us the generated trace file:
>> http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html
>>
>>
>>
>>
>>
>> -Emile
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/0f3b3165/attachment.htm>

From simon at rabbitmq.com  Thu Aug  8 11:41:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Aug 2013 11:41:53 +0100
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap granular
	permissions?
In-Reply-To: <CAJnBO6YtLak-LK8sdvysQbRGpL_9rs8kjrjSdQvauH4yp5yhFQ@mail.gmail.com>
References: <CAJnBO6YtLak-LK8sdvysQbRGpL_9rs8kjrjSdQvauH4yp5yhFQ@mail.gmail.com>
Message-ID: <520375F1.8080709@rabbitmq.com>

I'm not quite sure what you're asking, but if you want to create a group 
for each queue you could do something like:

{resource_access_query,
  {for,
   [{resource, queue,
     {for,
      [{permission, configure, {constant, false}},
       {permission, write,
        {in_group, "cn=access-${name},ou=groups,dc=example,dc=com"}},
         <etc>

- then to write to "myqueue" the user would need to be in the group 
"cn=access-myqueue,ou=groups,dc=example,dc=com".

Alternatively, if you want to statically list the queue -> group 
mapping, you could do something like:

{resource_access_query,
  {for,
   [{resource, queue,
     {for,
      [{permission, configure, {constant, false}},
       {permission, write,
        {for,
         [{name, <<"queue1">>,
           {in_group, "cn=simonsqueue,ou=groups,dc=example,dc=com"}},
          {name, <<"queue2">>,
           {in_group, "cn=anotherqueue,ou=groups,dc=example,dc=com"}},

Cheers, Simon


On 07/08/2013 4:05AM, Jared Kauppila wrote:
> Greetings,
>
> I was curious how granular you get set permissions using the
> rabbit_auth_backend_ldap plugin? Is it possible to define permissions to
> a particular vhost/exchange/queue explicitly defining these resources
> and the AD groups that have access to them in the config? Our current
> use case is defining static exchanges and queues and restricting access
> to those resources via AD groups that would grant developers and service
> accounts access per development group. We will have a number of
> applications that will push messages to the exchanges, with another set
> of applications consuming these messages via their own queue. We would
> ideally restrict access to each queue per it's defined app, likewise for
> the exchanges.
>
> It looks like this achievable fairly easily using the baked in user
> accounts, can this be defined for LDAP groups/users and resources?
>
> It was discussed some here,
> http://rabbitmq.1065348.n5.nabble.com/Per-queue-exchange-ACL-via-LDAP-plugin-td25331.html,
> which shows how to match queue to a username. Is it not possible for
> group membership or explicitly defining the resource and group?
>
> Thanks,
>
> Jared
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Thu Aug  8 11:47:17 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 08 Aug 2013 11:47:17 +0100
Subject: [rabbitmq-discuss] Duplicated message and unknown delivery tag
 after ack
In-Reply-To: <CAMsy_NhhZJK9EKzd7=twDraMhHgiopR10haxHGO5MUErh8FXjQ@mail.gmail.com>
References: <ae768eb4-3b32-4e9e-b6b2-37c6a723ef23@googlegroups.com>
	<51FA2E7D.4090209@rabbitmq.com>
	<CADtU9_udtSvbY4duxRHPHrAn7uR5KOa0tZGYvdFJTK+nO8kLeA@mail.gmail.com>
	<CAMsy_NhhZJK9EKzd7=twDraMhHgiopR10haxHGO5MUErh8FXjQ@mail.gmail.com>
Message-ID: <52037735.2020108@rabbitmq.com>

Tim,

On 08/08/13 11:39, Tim Robertson wrote:
> Were there any further insights into this?
> I am seeing the same behavior on 3.1.3 on my mac (homebrew install) and
> using rabbiteasy (1.2.0) and amqp java libraries 3.1.3.

rabbiteasy claims to provide "managed consumers that recover from 
connection loss and re-attach to the broker". I strongly suspect that 
recovery logic is too naive, allowing acks for messages to be span 
channel recreation, which would result exactly in the error you are seeing.

Regards,

Matthias.

From wangjunbo924 at gmail.com  Thu Aug  8 11:49:45 2013
From: wangjunbo924 at gmail.com (Junius Wang)
Date: Thu, 8 Aug 2013 18:49:45 +0800
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
Message-ID: <1216301ce9425$01092380$031b6a80$@gmail.com>

Hi guys,

Our team are performing some performance tests and we try to prove that we
can get linear scalability of our services, it means when we add more
RabbitMQ nodes, the throughputs should increase as well.  We use RabbitMQ as
our backend message system. However, when we add more RabbitMQ servers to
cluster, the throughput decreases which is not expected and I would like to
ask for your help. Following are the details, any comments are appreciated.

 

We setup the our testing environment on AWS. All instances, including app
servers, RabbitMQ servers and Jmeter servers(host test tool Jmeter 2.7), are
of  type m1.xlarge(8ECUs, 4 Cores and 15Gib memory). For RabbitMQ servers,
"EBS optimized" are enabled, and the PIOPs are set to 2000 to improve the
disc read/write speed. There are two ELBs. One for App servers and the
another for RabbitMQ servers.  Here are some more environment
configurations:


Instances Type

m1.xlarge


connect pool size for App servers

40000


JVM args for App servers

-Xmx12G -Xms6G -XX:MaxPermSize=2G


App servers count

2


Jmeter servers

10


total concurrent users

4000


PIOPs for RabbitMQ Servers

2000


Consumer Prefetch Count

1000


message size

1KB


hipe_compile

FALSE

 

The designed topologic of broker:



1)      We create only one global topic exchange "events" to route all
incoming messages. It's durable.

2)      There will be an event log queue which receive all messages with
binding key "#". It's durable as well.

3)      There will be several queues for our external services and each
service queue may have several bindings to the global exchange which we
called eventypes.

Actually In our test scenarios,  we create only one service queue and only
one binding on this queue. Message publishers publish messages using the
only binding routing key.  So in fact, every message resides on two queues:
the event log queue and a test service queue. And all messages are
persistent.

 

We start with 1 single RabbitMQ node. And then run different configurations
with 2-RabbitMQ node cluster. For example ,1) change the node type 2)
enable/disable mirrored queues(also called high available queue, showed as
"ha" in the following tables). The test results shown as following:


configurations

Avg response time(ms)

throughput


1 rabbitmq node

1125

2702.904


2disc,ha

2957

1192.645


1disc+1ram,ha

3654

998.126


1disc+1ram,non-ha

1110

2799.826


 

1015

2720.422


2disc,non-ha

1289

2570.826


 

1080

2845.821


 

1118

2802.278

We can see that, while two rabbitmq servers are used, we see no throughput
improvement. This doesn't make sense to me. To my understanding,  Here comes
my questions:

1.       What does RabbitMQ cluster scalability means exactly? Does it refer
to the capacity of handing messages? The queue capacity? Or the message
number?

2.       The  mirrored queues seems to affect performance in a large scale.
What's the possible cause of this? 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/054538b9/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 14245 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/054538b9/attachment.jpeg>

From simon at rabbitmq.com  Thu Aug  8 12:33:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Aug 2013 12:33:30 +0100
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
In-Reply-To: <1216301ce9425$01092380$031b6a80$@gmail.com>
References: <1216301ce9425$01092380$031b6a80$@gmail.com>
Message-ID: <5203820A.70105@rabbitmq.com>

On 08/08/2013 11:49AM, Junius Wang wrote:
> Our team are performing some performance tests and we try to prove that
> we can get linear scalability of our services, it means when we add more
> RabbitMQ nodes, the throughputs should increase as well.  We use
> RabbitMQ as our backend message system. However, when we add more
> RabbitMQ servers to cluster, the throughput decreases which is not
> expected and I would like to ask for your help. Following are the
> details, any comments are appreciated.

<snip>

> We can see that, while two rabbitmq servers are used, we see no
> throughput improvement. This doesn?t make sense to me. To my
> understanding,  Here comes my questions:

The issue is that an individual unmirrored queue cannot scale out across 
more than one node in a cluster (and it's hard to see how it could do 
while maintaining ordering guarantees etc).

> 1.What does RabbitMQ cluster scalability means exactly? Does it refer to
> the capacity of handing messages? The queue capacity? Or the message number?

Primarily more cluster nodes can either give more redundancy, or 
capacity for more queues. They cannot make individual queues have more 
capacity.

> 2.The  mirrored queues seems to affect performance in a large scale.
> What?s the possible cause of this?

When you have an unmirrored queue it needs to do a certain amount of 
work on a certain node.

When you make that queue mirrored, it needs to do the same amount of 
work on that node, and also the same amount of work on the other nodes. 
But in addition to that it also needs to do more work on each node, to 
keep the mirrors informed of what each other are doing. This is not a 
trivial amount of work!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Aug  8 12:53:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Aug 2013 12:53:52 +0100
Subject: [rabbitmq-discuss] fail upgrade from 3.1.3 to 3.1.4
In-Reply-To: <CAJaPRW6cv_8OiShMrqLYHo2B6nMAL4k3=gE6sFShLyaBgV6ypg@mail.gmail.com>
References: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>
	<52036B2B.3060902@rabbitmq.com>
	<CAJaPRW6quOB=BH9bUN=u56fcvT7jU0H34xQNbT4RruxVSUtSHw@mail.gmail.com>
	<CAJaPRW6cv_8OiShMrqLYHo2B6nMAL4k3=gE6sFShLyaBgV6ypg@mail.gmail.com>
Message-ID: <520386D0.5020705@rabbitmq.com>

Hi.

It looks like we managed to release a version 3.1.4 which is not 
compatible with other 3.1.x versions in the same cluster. Damn.

So if you upgrade *all* the nodes in the cluster to 3.1.4, and restore 
the /var/lib/rabbitmq/mnesia on all the nodes, then things should work.

Cheers, Simon

On 08/08/2013 11:54AM, Guillaume Vernat wrote:
> Hy Simon,
>
> I really needed this cluster up. So, after making a copy of
> /var/lib/rabbitmq/mnesia I rebuild cluster.
> Now it's ok going on 3.1.4
>
> How can I export messages from the copy in order to have them back in
> the cluster ?
>
> Guillaume VERNAT
>
>
> 2013/8/8 Guillaume Vernat <verenate at verenate.com
> <mailto:verenate at verenate.com>>
>
>     Hy Simmons, thank you for your answer.
>
>     The cluster was : amqp105/amqp107 and amqp108 (ram). Main node is
>     105 and I stated update with it.
>     107 and 108 were runnning during update. I join the log file
>     starting errors where :
>
>     Error description:
>         {error,{incompatible_bytecode,"Incompatible Erlang bytecode
>     found on nodes"}}
>
>
>
>
>     2013/8/8 Simon MacMullen <simon at rabbitmq.com
>     <mailto:simon at rabbitmq.com>>
>
>         Huh. You should not need to stop the cluster to do a minor
>         version upgrade like that. What error are you seeing?
>
>         Cheers, Simon
>
>
>         On 08/08/2013 9:25AM, Guillaume Vernat wrote:
>
>             Hy,
>
>             I try to up upgrade a cluster from 3.1.3 to 3.1.4 on debian
>             wheezy.
>             apt-get update
>             apt-get dist-upgrade
>
>             but upgrade fail because I did not stop the cluster nodes :(
>             I finally stop the other cluster nodes but it was too late
>             for the first
>             one.
>
>             How can I start back the first node ?
>             I already touch
>             /var/lib/rabbitmq/mnesia/<__node>/nodes_running_at___shutdown,
>             rabbit_serial, cluster_nodes.config but it fail again.
>
>             Guillaume
>
>
>             _________________________________________________
>             rabbitmq-discuss mailing list
>             rabbitmq-discuss at lists.__rabbitmq.com
>             <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>             https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>             <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>         --
>         Simon MacMullen
>         RabbitMQ, Pivotal
>
>
>
>
>     --
>     Cordialement,
>
>     Guillaume VERNAT
>     ---
>     VereNate Sarl - http://www.verenate.com/ tel: +33 607114196
>     <tel:%2B33%20607114196> verenate at verenate.com
>     <mailto:verenate at verenate.com> Twitter : http://twitter.com/verenate
>     Blog : http://verenate.tumblr.com/ *"Agence en Communication des
>     savoir-faire - internet et multimedia" * /Ce message et les pi?ces
>     jointes sont confidentiels et ?tablis ? l'attention exclusive de
>     leurs destinataires. Si vous n'?tes pas le destinataire de ce
>     message, merci de le d?truire et d'en avertir l'exp?diteur. This
>     message and any attachments are confidential and intented solely for
>     the addressees. If you are not the intended recipient of this
>     message, please erase it and notify the sender thereof. /
>
>
>
>
> --
> Cordialement,
>
> Guillaume VERNAT
> ---
> VereNate Sarl - http://www.verenate.com/ tel: +33 607114196
> verenate at verenate.com <mailto:verenate at verenate.com> Twitter :
> http://twitter.com/verenate Blog : http://verenate.tumblr.com/ *"Agence
> en Communication des savoir-faire - internet et multimedia" * /Ce
> message et les pi?ces jointes sont confidentiels et ?tablis ?
> l'attention exclusive de leurs destinataires. Si vous n'?tes pas le
> destinataire de ce message, merci de le d?truire et d'en avertir
> l'exp?diteur. This message and any attachments are confidential and
> intented solely for the addressees. If you are not the intended
> recipient of this message, please erase it and notify the sender thereof. /
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From verenate at verenate.com  Thu Aug  8 13:08:17 2013
From: verenate at verenate.com (Guillaume Vernat)
Date: Thu, 8 Aug 2013 14:08:17 +0200
Subject: [rabbitmq-discuss] fail upgrade from 3.1.3 to 3.1.4
In-Reply-To: <520386D0.5020705@rabbitmq.com>
References: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>
	<52036B2B.3060902@rabbitmq.com>
	<CAJaPRW6quOB=BH9bUN=u56fcvT7jU0H34xQNbT4RruxVSUtSHw@mail.gmail.com>
	<CAJaPRW6cv_8OiShMrqLYHo2B6nMAL4k3=gE6sFShLyaBgV6ypg@mail.gmail.com>
	<520386D0.5020705@rabbitmq.com>
Message-ID: <CAJaPRW5Svf8xgxN=gFy9JpkqEGOErQv1f1fWRnG4qevT+i=wNQ@mail.gmail.com>

Ok. I will try and let you know...

And my other question is there a way to export datas from mnesia db ?


2013/8/8 Simon MacMullen <simon at rabbitmq.com>

> Hi.
>
> It looks like we managed to release a version 3.1.4 which is not
> compatible with other 3.1.x versions in the same cluster. Damn.
>
> So if you upgrade *all* the nodes in the cluster to 3.1.4, and restore the
> /var/lib/rabbitmq/mnesia on all the nodes, then things should work.
>
> Cheers, Simon
>
>
> On 08/08/2013 11:54AM, Guillaume Vernat wrote:
>
>> Hy Simon,
>>
>> I really needed this cluster up. So, after making a copy of
>> /var/lib/rabbitmq/mnesia I rebuild cluster.
>> Now it's ok going on 3.1.4
>>
>> How can I export messages from the copy in order to have them back in
>> the cluster ?
>>
>> Guillaume VERNAT
>>
>>
>> 2013/8/8 Guillaume Vernat <verenate at verenate.com
>> <mailto:verenate at verenate.com>**>
>>
>>
>>     Hy Simmons, thank you for your answer.
>>
>>     The cluster was : amqp105/amqp107 and amqp108 (ram). Main node is
>>     105 and I stated update with it.
>>     107 and 108 were runnning during update. I join the log file
>>     starting errors where :
>>
>>     Error description:
>>         {error,{incompatible_bytecode,**"Incompatible Erlang bytecode
>>     found on nodes"}}
>>
>>
>>
>>
>>     2013/8/8 Simon MacMullen <simon at rabbitmq.com
>>     <mailto:simon at rabbitmq.com>>
>>
>>
>>         Huh. You should not need to stop the cluster to do a minor
>>         version upgrade like that. What error are you seeing?
>>
>>         Cheers, Simon
>>
>>
>>         On 08/08/2013 9:25AM, Guillaume Vernat wrote:
>>
>>             Hy,
>>
>>             I try to up upgrade a cluster from 3.1.3 to 3.1.4 on debian
>>             wheezy.
>>             apt-get update
>>             apt-get dist-upgrade
>>
>>             but upgrade fail because I did not stop the cluster nodes :(
>>             I finally stop the other cluster nodes but it was too late
>>             for the first
>>             one.
>>
>>             How can I start back the first node ?
>>             I already touch
>>             /var/lib/rabbitmq/mnesia/<__**node>/nodes_running_at___**
>> shutdown,
>>
>>             rabbit_serial, cluster_nodes.config but it fail again.
>>
>>             Guillaume
>>
>>
>>             ______________________________**___________________
>>             rabbitmq-discuss mailing list
>>             rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>             <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>             https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>
>>             <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>         --
>>         Simon MacMullen
>>         RabbitMQ, Pivotal
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/fe20587e/attachment.htm>

From timrobertson100 at gmail.com  Thu Aug  8 14:21:58 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Thu, 8 Aug 2013 15:21:58 +0200
Subject: [rabbitmq-discuss] Fwd: Duplicated message and unknown delivery tag
 after ack
In-Reply-To: <CAMsy_NgwjUFxRqsa5tJArAK3mmSAJMRfpu3Mfxwb2jAVAodY8A@mail.gmail.com>
References: <ae768eb4-3b32-4e9e-b6b2-37c6a723ef23@googlegroups.com>
	<51FA2E7D.4090209@rabbitmq.com>
	<CADtU9_udtSvbY4duxRHPHrAn7uR5KOa0tZGYvdFJTK+nO8kLeA@mail.gmail.com>
	<CAMsy_NhhZJK9EKzd7=twDraMhHgiopR10haxHGO5MUErh8FXjQ@mail.gmail.com>
	<52037735.2020108@rabbitmq.com>
	<CAMsy_Ngks_gPaoP0nvXQ=z9JALp8MdDkN3gtcBTGH5V1OtL1iQ@mail.gmail.com>
	<5203999B.3020402@rabbitmq.com>
	<CAMsy_NgwjUFxRqsa5tJArAK3mmSAJMRfpu3Mfxwb2jAVAodY8A@mail.gmail.com>
Message-ID: <CAMsy_NiY4DqtpqcZ0GciDvL-yua=jdurJTeoBp6Do6M3qimVtw@mail.gmail.com>

[stupidly I replied only to Matthias without noticing]

Ok - attached a really quick hack which I believe shows 3.1.3 to behave as
expected with 1 production thread, and 10 consuming threads.  This is a
durable exchange and queue, and it is using explicit ack'ing.  It uses 1
connection for publishing, and 1 connection for all the consuming threads.
 Each consuming thread gets a channel.

If someone familiar with the Java API could cast an eye over that and
confirm that it is give or take the expected usage (I'm not closing
resources properly here), I'll then try and work out why I see rabbiteasy
does not operate the same.

Curiously, when I ran the rabbiteasy version through Tracer I got the
following:
http://pastebin.aquilenet.fr/?a91d27418ddaade5#8e6MBLhOR+ISSPEtg2QoR0iqURsGgBjBfCbH2dTaj9o=
I figured I was using Tracer wrongly, but perhaps that is correct and
rabbiteasy does indeed do a reconnect and then does not recover connections
properly.  Still more to follow.


On Thu, Aug 8, 2013 at 3:14 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Tim, please keep the list in the loop on your investigation.
>
>
> On 08/08/13 13:44, Tim Robertson wrote:
>
>> Thanks Matthias,
>>
>> I'm going to craft a vanilla consumer and try it.  I *don't think* this
>> is related to the connection retrying, as this happens consistently and
>> immediately when there is more than 1 thread registered with a channel.
>>   The first consumer ACKs, but I *think* rabbit redelivers it anyway -
>> more to follow on that.
>>
>> I only just started investigations, and came across this thread
>> immediately.  It is curious we're both using totally different libraries
>> (spring, rabbiteasy) and seeing the same behavior though.
>>
>>
>>
>>
>>
>>
>> On Thu, Aug 8, 2013 at 12:47 PM, Matthias Radestock
>> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>**> wrote:
>>
>>     Tim,
>>
>>
>>     On 08/08/13 11:39, Tim Robertson wrote:
>>
>>         Were there any further insights into this?
>>         I am seeing the same behavior on 3.1.3 on my mac (homebrew
>>         install) and
>>         using rabbiteasy (1.2.0) and amqp java libraries 3.1.3.
>>
>>
>>     rabbiteasy claims to provide "managed consumers that recover from
>>     connection loss and re-attach to the broker". I strongly suspect
>>     that recovery logic is too naive, allowing acks for messages to be
>>     span channel recreation, which would result exactly in the error you
>>     are seeing.
>>
>>     Regards,
>>
>>     Matthias.
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/df4108fb/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitTest.java
Type: application/octet-stream
Size: 3575 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/df4108fb/attachment.obj>

From mklishin at gopivotal.com  Thu Aug  8 14:58:18 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 8 Aug 2013 17:58:18 +0400
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <CAAt2poJyY80tuBCgi1JyDXBThm1VY511RoBQNgtET1Vg9Yx60g@mail.gmail.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
	<856C10B1-6180-4246-9EA6-5C30DC566907@gopivotal.com>
	<CAAt2poKTP9Etx78KyeMbZL6g1+XEDGyH235_4gGkY7ppn=ugpg@mail.gmail.com>
	<1A49B5EB-CA5C-41C7-8BAC-2FB97A2B7396@gopivotal.com>
	<CAAt2poJyY80tuBCgi1JyDXBThm1VY511RoBQNgtET1Vg9Yx60g@mail.gmail.com>
Message-ID: <A56C135E-E904-488D-8B18-14C1A83C60C6@gopivotal.com>

Alan Antonuk:

> That makes me wonder what is it that developers use channels for?  My understanding is they're were designed to be an 'error scope' at a protocol level. I don't see a lot of developers using them that way, and sometimes its the source of a bit of pain (having to recreate any resources that get destroyed as a result of a channel exception, or in bad cases, their whole app aborts because the channel dies).

For separating things that may require different error handling.

> My thinking is that an API could be created that internally uses channels intelligently to give more native feel to error handling. One example of changing the API might be: instead of apply basic.qos to a channel, you apply it to a consumer, and internally the library maps a consumer to a channel, so a BasicQos on a consumer.  The same can be done for other aspects of the protocol (this is what I ended up doing with SimpleAmqpClient).  A downside being the API may not map 1:1  to a lot of the documentation that is out there.

Nearly every other client exposes basic.qos on a channel, not a consumer. Not doing the same
will likely only cause more confusion at this point, not less.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/df24f887/attachment.pgp>

From timrobertson100 at gmail.com  Thu Aug  8 15:27:26 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Thu, 8 Aug 2013 16:27:26 +0200
Subject: [rabbitmq-discuss] Duplicated message and unknown delivery tag
 after ack
In-Reply-To: <CAMsy_NiY4DqtpqcZ0GciDvL-yua=jdurJTeoBp6Do6M3qimVtw@mail.gmail.com>
References: <ae768eb4-3b32-4e9e-b6b2-37c6a723ef23@googlegroups.com>
	<51FA2E7D.4090209@rabbitmq.com>
	<CADtU9_udtSvbY4duxRHPHrAn7uR5KOa0tZGYvdFJTK+nO8kLeA@mail.gmail.com>
	<CAMsy_NhhZJK9EKzd7=twDraMhHgiopR10haxHGO5MUErh8FXjQ@mail.gmail.com>
	<52037735.2020108@rabbitmq.com>
	<CAMsy_Ngks_gPaoP0nvXQ=z9JALp8MdDkN3gtcBTGH5V1OtL1iQ@mail.gmail.com>
	<5203999B.3020402@rabbitmq.com>
	<CAMsy_NgwjUFxRqsa5tJArAK3mmSAJMRfpu3Mfxwb2jAVAodY8A@mail.gmail.com>
	<CAMsy_NiY4DqtpqcZ0GciDvL-yua=jdurJTeoBp6Do6M3qimVtw@mail.gmail.com>
Message-ID: <CAMsy_NipHR+CtoxDag2_H7b8q6P1dZSXN4yE5vZ0UXcChEoytg@mail.gmail.com>

Ok, to update this list on my findings.  The issue is indeed isolated in
rabbiteasy, and how it incorrectly manages channels with multiple consuming
instances.  I'm going to log an issue there, and provide a small sample
showing the problem - it only happens when you register multiple listeners.
 The vanilla version attached early demonstrates that rabbitmq 3.1.3 server
and client libraries work as expected.  We're ripping out our rabbiteasy
dependency and reverting to vanilla API, which is actually easier to
understand in our system.

Sorry for the noise, and thanks Matthias for the quick answers



On Thu, Aug 8, 2013 at 3:21 PM, Tim Robertson <timrobertson100 at gmail.com>wrote:

> [stupidly I replied only to Matthias without noticing]
>
> Ok - attached a really quick hack which I believe shows 3.1.3 to behave as
> expected with 1 production thread, and 10 consuming threads.  This is a
> durable exchange and queue, and it is using explicit ack'ing.  It uses 1
> connection for publishing, and 1 connection for all the consuming threads.
>  Each consuming thread gets a channel.
>
> If someone familiar with the Java API could cast an eye over that and
> confirm that it is give or take the expected usage (I'm not closing
> resources properly here), I'll then try and work out why I see rabbiteasy
> does not operate the same.
>
> Curiously, when I ran the rabbiteasy version through Tracer I got the
> following:
> http://pastebin.aquilenet.fr/?a91d27418ddaade5#8e6MBLhOR+ISSPEtg2QoR0iqURsGgBjBfCbH2dTaj9o=
> I figured I was using Tracer wrongly, but perhaps that is correct and
> rabbiteasy does indeed do a reconnect and then does not recover connections
> properly.  Still more to follow.
>
>
> On Thu, Aug 8, 2013 at 3:14 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:
>
>> Tim, please keep the list in the loop on your investigation.
>>
>>
>> On 08/08/13 13:44, Tim Robertson wrote:
>>
>>> Thanks Matthias,
>>>
>>> I'm going to craft a vanilla consumer and try it.  I *don't think* this
>>> is related to the connection retrying, as this happens consistently and
>>> immediately when there is more than 1 thread registered with a channel.
>>>   The first consumer ACKs, but I *think* rabbit redelivers it anyway -
>>> more to follow on that.
>>>
>>> I only just started investigations, and came across this thread
>>> immediately.  It is curious we're both using totally different libraries
>>> (spring, rabbiteasy) and seeing the same behavior though.
>>>
>>>
>>>
>>>
>>>
>>>
>>> On Thu, Aug 8, 2013 at 12:47 PM, Matthias Radestock
>>> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>**> wrote:
>>>
>>>     Tim,
>>>
>>>
>>>     On 08/08/13 11:39, Tim Robertson wrote:
>>>
>>>         Were there any further insights into this?
>>>         I am seeing the same behavior on 3.1.3 on my mac (homebrew
>>>         install) and
>>>         using rabbiteasy (1.2.0) and amqp java libraries 3.1.3.
>>>
>>>
>>>     rabbiteasy claims to provide "managed consumers that recover from
>>>     connection loss and re-attach to the broker". I strongly suspect
>>>     that recovery logic is too naive, allowing acks for messages to be
>>>     span channel recreation, which would result exactly in the error you
>>>     are seeing.
>>>
>>>     Regards,
>>>
>>>     Matthias.
>>>
>>>
>>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/7c96194d/attachment.htm>

From timrobertson100 at gmail.com  Thu Aug  8 15:45:10 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Thu, 8 Aug 2013 16:45:10 +0200
Subject: [rabbitmq-discuss] Duplicated message and unknown delivery tag
 after ack
In-Reply-To: <CAMsy_NipHR+CtoxDag2_H7b8q6P1dZSXN4yE5vZ0UXcChEoytg@mail.gmail.com>
References: <ae768eb4-3b32-4e9e-b6b2-37c6a723ef23@googlegroups.com>
	<51FA2E7D.4090209@rabbitmq.com>
	<CADtU9_udtSvbY4duxRHPHrAn7uR5KOa0tZGYvdFJTK+nO8kLeA@mail.gmail.com>
	<CAMsy_NhhZJK9EKzd7=twDraMhHgiopR10haxHGO5MUErh8FXjQ@mail.gmail.com>
	<52037735.2020108@rabbitmq.com>
	<CAMsy_Ngks_gPaoP0nvXQ=z9JALp8MdDkN3gtcBTGH5V1OtL1iQ@mail.gmail.com>
	<5203999B.3020402@rabbitmq.com>
	<CAMsy_NgwjUFxRqsa5tJArAK3mmSAJMRfpu3Mfxwb2jAVAodY8A@mail.gmail.com>
	<CAMsy_NiY4DqtpqcZ0GciDvL-yua=jdurJTeoBp6Do6M3qimVtw@mail.gmail.com>
	<CAMsy_NipHR+CtoxDag2_H7b8q6P1dZSXN4yE5vZ0UXcChEoytg@mail.gmail.com>
Message-ID: <CAMsy_Nja-yzfbsRQ5t2tCV5XJ6nUFzLQcvVQD01Un9GCGXR4iQ@mail.gmail.com>

This is the rabbiteasy issue, should anyone stumble upon this thread.
https://github.com/zanox/rabbiteasy/issues/4
Disclaimer: I could be using rabbiteasy wrong of course, but I _don't
think_ I am.


On Thu, Aug 8, 2013 at 4:27 PM, Tim Robertson <timrobertson100 at gmail.com>wrote:

> Ok, to update this list on my findings.  The issue is indeed isolated in
> rabbiteasy, and how it incorrectly manages channels with multiple consuming
> instances.  I'm going to log an issue there, and provide a small sample
> showing the problem - it only happens when you register multiple listeners.
>  The vanilla version attached early demonstrates that rabbitmq 3.1.3 server
> and client libraries work as expected.  We're ripping out our rabbiteasy
> dependency and reverting to vanilla API, which is actually easier to
> understand in our system.
>
> Sorry for the noise, and thanks Matthias for the quick answers
>
>
>
> On Thu, Aug 8, 2013 at 3:21 PM, Tim Robertson <timrobertson100 at gmail.com>wrote:
>
>> [stupidly I replied only to Matthias without noticing]
>>
>> Ok - attached a really quick hack which I believe shows 3.1.3 to behave
>> as expected with 1 production thread, and 10 consuming threads.  This is a
>> durable exchange and queue, and it is using explicit ack'ing.  It uses 1
>> connection for publishing, and 1 connection for all the consuming threads.
>>  Each consuming thread gets a channel.
>>
>> If someone familiar with the Java API could cast an eye over that and
>> confirm that it is give or take the expected usage (I'm not closing
>> resources properly here), I'll then try and work out why I see rabbiteasy
>> does not operate the same.
>>
>> Curiously, when I ran the rabbiteasy version through Tracer I got the
>> following:
>> http://pastebin.aquilenet.fr/?a91d27418ddaade5#8e6MBLhOR+ISSPEtg2QoR0iqURsGgBjBfCbH2dTaj9o=
>> I figured I was using Tracer wrongly, but perhaps that is correct and
>> rabbiteasy does indeed do a reconnect and then does not recover connections
>> properly.  Still more to follow.
>>
>>
>> On Thu, Aug 8, 2013 at 3:14 PM, Matthias Radestock <matthias at rabbitmq.com
>> > wrote:
>>
>>> Tim, please keep the list in the loop on your investigation.
>>>
>>>
>>> On 08/08/13 13:44, Tim Robertson wrote:
>>>
>>>> Thanks Matthias,
>>>>
>>>> I'm going to craft a vanilla consumer and try it.  I *don't think* this
>>>> is related to the connection retrying, as this happens consistently and
>>>> immediately when there is more than 1 thread registered with a channel.
>>>>   The first consumer ACKs, but I *think* rabbit redelivers it anyway -
>>>> more to follow on that.
>>>>
>>>> I only just started investigations, and came across this thread
>>>> immediately.  It is curious we're both using totally different libraries
>>>> (spring, rabbiteasy) and seeing the same behavior though.
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> On Thu, Aug 8, 2013 at 12:47 PM, Matthias Radestock
>>>> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>**> wrote:
>>>>
>>>>     Tim,
>>>>
>>>>
>>>>     On 08/08/13 11:39, Tim Robertson wrote:
>>>>
>>>>         Were there any further insights into this?
>>>>         I am seeing the same behavior on 3.1.3 on my mac (homebrew
>>>>         install) and
>>>>         using rabbiteasy (1.2.0) and amqp java libraries 3.1.3.
>>>>
>>>>
>>>>     rabbiteasy claims to provide "managed consumers that recover from
>>>>     connection loss and re-attach to the broker". I strongly suspect
>>>>     that recovery logic is too naive, allowing acks for messages to be
>>>>     span channel recreation, which would result exactly in the error you
>>>>     are seeing.
>>>>
>>>>     Regards,
>>>>
>>>>     Matthias.
>>>>
>>>>
>>>>
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/3a11272d/attachment.htm>

From simon at rabbitmq.com  Thu Aug  8 16:02:19 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Aug 2013 16:02:19 +0100
Subject: [rabbitmq-discuss] fail upgrade from 3.1.3 to 3.1.4
In-Reply-To: <CAJaPRW5Svf8xgxN=gFy9JpkqEGOErQv1f1fWRnG4qevT+i=wNQ@mail.gmail.com>
References: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>
	<52036B2B.3060902@rabbitmq.com>
	<CAJaPRW6quOB=BH9bUN=u56fcvT7jU0H34xQNbT4RruxVSUtSHw@mail.gmail.com>
	<CAJaPRW6cv_8OiShMrqLYHo2B6nMAL4k3=gE6sFShLyaBgV6ypg@mail.gmail.com>
	<520386D0.5020705@rabbitmq.com>
	<CAJaPRW5Svf8xgxN=gFy9JpkqEGOErQv1f1fWRnG4qevT+i=wNQ@mail.gmail.com>
Message-ID: <5203B2FB.2010707@rabbitmq.com>

You can pull records out of Mnesia, but bear in mind that messages are 
stored in RabbitMQ's message store, not Mnesia. And really RabbitMQ is 
the only thing that can read that in a practical sense.

Cheers, Simon

On 08/08/2013 1:08PM, Guillaume Vernat wrote:
> Ok. I will try and let you know...
>
> And my other question is there a way to export datas from mnesia db ?
>
>
> 2013/8/8 Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>
>     Hi.
>
>     It looks like we managed to release a version 3.1.4 which is not
>     compatible with other 3.1.x versions in the same cluster. Damn.
>
>     So if you upgrade *all* the nodes in the cluster to 3.1.4, and
>     restore the /var/lib/rabbitmq/mnesia on all the nodes, then things
>     should work.
>
>     Cheers, Simon
>
>
>     On 08/08/2013 11:54AM, Guillaume Vernat wrote:
>
>         Hy Simon,
>
>         I really needed this cluster up. So, after making a copy of
>         /var/lib/rabbitmq/mnesia I rebuild cluster.
>         Now it's ok going on 3.1.4
>
>         How can I export messages from the copy in order to have them
>         back in
>         the cluster ?
>
>         Guillaume VERNAT
>
>
>         2013/8/8 Guillaume Vernat <verenate at verenate.com
>         <mailto:verenate at verenate.com>
>         <mailto:verenate at verenate.com <mailto:verenate at verenate.com>>__>
>
>
>              Hy Simmons, thank you for your answer.
>
>              The cluster was : amqp105/amqp107 and amqp108 (ram). Main
>         node is
>              105 and I stated update with it.
>              107 and 108 were runnning during update. I join the log file
>              starting errors where :
>
>              Error description:
>                  {error,{incompatible_bytecode,__"Incompatible Erlang
>         bytecode
>              found on nodes"}}
>
>
>
>
>              2013/8/8 Simon MacMullen <simon at rabbitmq.com
>         <mailto:simon at rabbitmq.com>
>              <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>>
>
>
>                  Huh. You should not need to stop the cluster to do a minor
>                  version upgrade like that. What error are you seeing?
>
>                  Cheers, Simon
>
>
>                  On 08/08/2013 9:25AM, Guillaume Vernat wrote:
>
>                      Hy,
>
>                      I try to up upgrade a cluster from 3.1.3 to 3.1.4
>         on debian
>                      wheezy.
>                      apt-get update
>                      apt-get dist-upgrade
>
>                      but upgrade fail because I did not stop the cluster
>         nodes :(
>                      I finally stop the other cluster nodes but it was
>         too late
>                      for the first
>                      one.
>
>                      How can I start back the first node ?
>                      I already touch
>
>         /var/lib/rabbitmq/mnesia/<____node>/nodes_running_at_____shutdown,
>
>                      rabbit_serial, cluster_nodes.config but it fail again.
>
>                      Guillaume
>
>
>                      ___________________________________________________
>                      rabbitmq-discuss mailing list
>                      rabbitmq-discuss at lists.__rabbi__tmq.com
>         <http://rabbitmq.com>
>                      <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>
>
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>
>
>
>                  --
>                  Simon MacMullen
>                  RabbitMQ, Pivotal
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From verenate at verenate.com  Thu Aug  8 16:49:21 2013
From: verenate at verenate.com (Guillaume Vernat)
Date: Thu, 8 Aug 2013 17:49:21 +0200
Subject: [rabbitmq-discuss] fail upgrade from 3.1.3 to 3.1.4
In-Reply-To: <5203B2FB.2010707@rabbitmq.com>
References: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>
	<52036B2B.3060902@rabbitmq.com>
	<CAJaPRW6quOB=BH9bUN=u56fcvT7jU0H34xQNbT4RruxVSUtSHw@mail.gmail.com>
	<CAJaPRW6cv_8OiShMrqLYHo2B6nMAL4k3=gE6sFShLyaBgV6ypg@mail.gmail.com>
	<520386D0.5020705@rabbitmq.com>
	<CAJaPRW5Svf8xgxN=gFy9JpkqEGOErQv1f1fWRnG4qevT+i=wNQ@mail.gmail.com>
	<5203B2FB.2010707@rabbitmq.com>
Message-ID: <CAJaPRW5EUFN6_MYUJsKOA2GUr2o2CgAap+_h14ZXUpfaT9Mq5A@mail.gmail.com>

Hy Simon,

Sorry but my knowledge of mnesia, erlang is close to nothing so I dont
understand your answer. My goal is to extract message and put them back un
RabbitMQ.
I know nothing about erlang, do you please tell my how to extract message.
If I have datas I can arrange them in json to use RabbitMQ submit api.

Thank you for your help.


2013/8/8 Simon MacMullen <simon at rabbitmq.com>

> You can pull records out of Mnesia, but bear in mind that messages are
> stored in RabbitMQ's message store, not Mnesia. And really RabbitMQ is the
> only thing that can read that in a practical sense.
>
> Cheers, Simon
>
>
> On 08/08/2013 1:08PM, Guillaume Vernat wrote:
>
>> Ok. I will try and let you know...
>>
>> And my other question is there a way to export datas from mnesia db ?
>>
>>
>> 2013/8/8 Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>>
>>
>>     Hi.
>>
>>     It looks like we managed to release a version 3.1.4 which is not
>>     compatible with other 3.1.x versions in the same cluster. Damn.
>>
>>     So if you upgrade *all* the nodes in the cluster to 3.1.4, and
>>     restore the /var/lib/rabbitmq/mnesia on all the nodes, then things
>>     should work.
>>
>>     Cheers, Simon
>>
>>
>>     On 08/08/2013 11:54AM, Guillaume Vernat wrote:
>>
>>         Hy Simon,
>>
>>         I really needed this cluster up. So, after making a copy of
>>         /var/lib/rabbitmq/mnesia I rebuild cluster.
>>         Now it's ok going on 3.1.4
>>
>>         How can I export messages from the copy in order to have them
>>         back in
>>         the cluster ?
>>
>>         Guillaume VERNAT
>>
>>
>>         2013/8/8 Guillaume Vernat <verenate at verenate.com
>>         <mailto:verenate at verenate.com>
>>         <mailto:verenate at verenate.com <mailto:verenate at verenate.com>**
>> >__>
>>
>>
>>
>>              Hy Simmons, thank you for your answer.
>>
>>              The cluster was : amqp105/amqp107 and amqp108 (ram). Main
>>         node is
>>              105 and I stated update with it.
>>              107 and 108 were runnning during update. I join the log file
>>              starting errors where :
>>
>>              Error description:
>>                  {error,{incompatible_bytecode,**__"Incompatible Erlang
>>
>>         bytecode
>>              found on nodes"}}
>>
>>
>>
>>
>>              2013/8/8 Simon MacMullen <simon at rabbitmq.com
>>         <mailto:simon at rabbitmq.com>
>>              <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>>
>>
>>
>>
>>                  Huh. You should not need to stop the cluster to do a
>> minor
>>                  version upgrade like that. What error are you seeing?
>>
>>                  Cheers, Simon
>>
>>
>>                  On 08/08/2013 9:25AM, Guillaume Vernat wrote:
>>
>>                      Hy,
>>
>>                      I try to up upgrade a cluster from 3.1.3 to 3.1.4
>>         on debian
>>                      wheezy.
>>                      apt-get update
>>                      apt-get dist-upgrade
>>
>>                      but upgrade fail because I did not stop the cluster
>>         nodes :(
>>                      I finally stop the other cluster nodes but it was
>>         too late
>>                      for the first
>>                      one.
>>
>>                      How can I start back the first node ?
>>                      I already touch
>>
>>         /var/lib/rabbitmq/mnesia/<____**node>/nodes_running_at_____**
>> shutdown,
>>
>>
>>                      rabbit_serial, cluster_nodes.config but it fail
>> again.
>>
>>                      Guillaume
>>
>>
>>                      ______________________________**
>> _____________________
>>                      rabbitmq-discuss mailing list
>>                      rabbitmq-discuss at lists.__rabbi**__tmq.com<http://rabbi__tmq.com>
>>         <http://rabbitmq.com>
>>                      <mailto:rabbitmq-discuss at __lis**ts.rabbitmq.com<http://lists.rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >>
>>         https://lists.rabbitmq.com/___**_cgi-bin/mailman/listinfo/____**
>> rabbitmq-discuss<https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>> >
>>
>>
>>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >>
>>
>>
>>                  --
>>                  Simon MacMullen
>>                  RabbitMQ, Pivotal
>>
>>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/565dc9f8/attachment.htm>

From alan.antonuk at gmail.com  Thu Aug  8 19:05:26 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 8 Aug 2013 11:05:26 -0700
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <52035AE2.9030809@pocock.com.au>
References: <52024F9D.4000501@pocock.com.au>
	<F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
	<CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
	<5202B2EB.2000203@pocock.com.au>
	<CAAt2poJ7VRb1dq1ZsEA_Y4jRSqdDRKaKvpnRxMq4dAafVmp-Fw@mail.gmail.com>
	<52035AE2.9030809@pocock.com.au>
Message-ID: <CAAt2po+TfNTq1B=pLPu-o9Y9yOEKhVh2qyQWyrnZhNoFKsv1OQ@mail.gmail.com>

On Thu, Aug 8, 2013 at 1:46 AM, Daniel Pocock <daniel at pocock.com.au> wrote:

> The most important thing will be demonstrating how it integrates with
> higher level code, particularly if the high level code is using an event
> loop other than the one you choose yourself.  E.g. will the end user have
> to run your event loop in a thread and when they get callbacks from your
> code, they will have to pass data to their own event loop thread in a
> thread-safe manner?
>

Noted.

>
> Another thing that comes to mind is the question of adding an abstraction
> layer, just like JMS in the Java world.  The only one I've come across so
> far is OpenMAMA:
> http://www.openmama.org - do you believe RabbitMQ users could benefit
> from coding to the OpenMAMA API and using some low-level driver for AMQP or
> RabbitMQ specifically?  This would be more like the JMS programming
> paradigm.
>

I believe something like this would be something layered on top of the
protocol library, and not necessarily baked into the library itself. As to
whether you should go this direction, I would imagine it depends on the
requirements for whatever you're doing.

>
>
> I'd like to understand your feelings about the future of the API before
> committing to that - do you see something based on libuv happening in the
> near future, e.g. within 6 months?
>
>
> I don't plan on making any drastic API changes to SimpleAmqpClient, its
purpose in my eyes is to give an easy interface to using rabbitmq-c from
C++, so it will continue to develop SimpleAmqpClient to support the various
bits of functionality that rabbitmq-c supports.  A libuv-based library will
likely be developed under a different library name, whether or not the
functionality gets rolled back into an existing library is TBD.  Will this
happen in 6 months? I have no idea - it depends on how much free time I
have to work on these kinds of projects.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/9133eb6e/attachment.htm>

From alan.antonuk at gmail.com  Thu Aug  8 19:09:11 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 8 Aug 2013 11:09:11 -0700
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <A56C135E-E904-488D-8B18-14C1A83C60C6@gopivotal.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
	<856C10B1-6180-4246-9EA6-5C30DC566907@gopivotal.com>
	<CAAt2poKTP9Etx78KyeMbZL6g1+XEDGyH235_4gGkY7ppn=ugpg@mail.gmail.com>
	<1A49B5EB-CA5C-41C7-8BAC-2FB97A2B7396@gopivotal.com>
	<CAAt2poJyY80tuBCgi1JyDXBThm1VY511RoBQNgtET1Vg9Yx60g@mail.gmail.com>
	<A56C135E-E904-488D-8B18-14C1A83C60C6@gopivotal.com>
Message-ID: <CAAt2poKFfD6kuknkL=mn0hqR9C-7aK+PZPUx3ViJ44YCWw6RNw@mail.gmail.com>

Excellent points.

Having had a chance to sleep on it - its seems to me you need to have an
API that exposes the protocol at some level. A layer that abstracts away
the concept of channels can always be layered over the top of that.


On Thu, Aug 8, 2013 at 6:58 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Alan Antonuk:
>
> > That makes me wonder what is it that developers use channels for?  My
> understanding is they're were designed to be an 'error scope' at a protocol
> level. I don't see a lot of developers using them that way, and sometimes
> its the source of a bit of pain (having to recreate any resources that get
> destroyed as a result of a channel exception, or in bad cases, their whole
> app aborts because the channel dies).
>
> For separating things that may require different error handling.
>
> > My thinking is that an API could be created that internally uses
> channels intelligently to give more native feel to error handling. One
> example of changing the API might be: instead of apply basic.qos to a
> channel, you apply it to a consumer, and internally the library maps a
> consumer to a channel, so a BasicQos on a consumer.  The same can be done
> for other aspects of the protocol (this is what I ended up doing with
> SimpleAmqpClient).  A downside being the API may not map 1:1  to a lot of
> the documentation that is out there.
>
> Nearly every other client exposes basic.qos on a channel, not a consumer.
> Not doing the same
> will likely only cause more confusion at this point, not less.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/66addd7c/attachment.htm>

From matt at soupmatt.com  Thu Aug  8 19:57:40 2013
From: matt at soupmatt.com (Matt Campbell)
Date: Thu, 8 Aug 2013 11:57:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Bug/Behavior Change in binds to header
 exchanges in rabbitmq 3.1.0
In-Reply-To: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>
References: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>
Message-ID: <47e035bc-f794-4869-aa4f-83b281326a93@googlegroups.com>

I received the following reply from one of the rabbit guys. I'm not sure 
why he didn't reply to the group. I am including it here so that i might 
help others.


On Mon, May 6, 2013 at 12:20 PM, Matthias Radestock <email removed> wrote:

We introduced validation of the x-match header in 3.1 - a change that 
unfortunately didn't get mentioned in the release notes.

As part of that, bindings with no x-match header are now rejected whereas 
previously they would be treated as 'all' matches.

The spec is vague in this regard; it neither says that x-match must be 
present nor what should happen when it isn't.

I have filed a bug to explore whether we should revert to the original 
behaviour, though given the spec vagueness it is probably best not to 
depend on that in applications.

As an alternative to changing the bindings in your code, you could 
introduce an intermediate fanout exchange, either

a) in front of the headers exchange, with publishers publishing to that 
instead of the headers exchange, or

b) behind the headers exchange, bound to it with x-match=all, so that 
selected queues can bind to that w/o having to set a header

Regards,

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/fad3ea86/attachment.htm>

From daniel at pocock.com.au  Thu Aug  8 20:14:47 2013
From: daniel at pocock.com.au (Daniel Pocock)
Date: Thu, 08 Aug 2013 21:14:47 +0200
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <CAAt2po+TfNTq1B=pLPu-o9Y9yOEKhVh2qyQWyrnZhNoFKsv1OQ@mail.gmail.com>
References: <52024F9D.4000501@pocock.com.au>
	<F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
	<CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
	<5202B2EB.2000203@pocock.com.au>
	<CAAt2poJ7VRb1dq1ZsEA_Y4jRSqdDRKaKvpnRxMq4dAafVmp-Fw@mail.gmail.com>
	<52035AE2.9030809@pocock.com.au>
	<CAAt2po+TfNTq1B=pLPu-o9Y9yOEKhVh2qyQWyrnZhNoFKsv1OQ@mail.gmail.com>
Message-ID: <5203EE27.6060303@pocock.com.au>



On 08/08/13 20:05, Alan Antonuk wrote:

> 
>>
>> Another thing that comes to mind is the question of adding an abstraction
>> layer, just like JMS in the Java world.  The only one I've come across so
>> far is OpenMAMA:
>> http://www.openmama.org - do you believe RabbitMQ users could benefit
>> from coding to the OpenMAMA API and using some low-level driver for AMQP or
>> RabbitMQ specifically?  This would be more like the JMS programming
>> paradigm.
>>
> 
> I believe something like this would be something layered on top of the
> protocol library, and not necessarily baked into the library itself. As to
> whether you should go this direction, I would imagine it depends on the
> requirements for whatever you're doing.

I agree - the Avis MQ solution appears to work like that:

- C++ Application code
- OpenMAMA C++ API
- OpenMAMA itself
- Avis "bridge" code (part of OpenMAMA repository)
- Avis C client layer

So to phrase my comments another way: instead of re-inventing or
extending the C++ API that exists now, maybe the work involved in making
such a bridge module delivers more benefit for the C++ user and/or is
easier to achieve

Here are some demos that show how a C++ user codes to the OpenMAMA API:

http://git.openmama.org/?p=OpenMAMA.git;a=blob;f=mama/c_cpp/src/examples/cpp/mamapublishercpp.cpp;hb=HEAD

http://git.openmama.org/?p=OpenMAMA.git;a=blob;f=mama/c_cpp/src/examples/cpp/mamasubscribercpp.cpp;hb=HEAD


and here are the bridges for Qpid and Avis:

http://git.openmama.org/?p=openmama-qpid.git;a=tree;f=mama/c_cpp/src/c/bridge;h=f4747d48a008bae21891b78d5cfeb5fd8f47713c;hb=HEAD


>>
>>
>> I'd like to understand your feelings about the future of the API before
>> committing to that - do you see something based on libuv happening in the
>> near future, e.g. within 6 months?
>>
>>
>> I don't plan on making any drastic API changes to SimpleAmqpClient, its
> purpose in my eyes is to give an easy interface to using rabbitmq-c from
> C++, so it will continue to develop SimpleAmqpClient to support the various
> bits of functionality that rabbitmq-c supports.  A libuv-based library will
> likely be developed under a different library name, whether or not the
> functionality gets rolled back into an existing library is TBD.  Will this
> happen in 6 months? I have no idea - it depends on how much free time I
> have to work on these kinds of projects.
> 

Ok, that's fine - I didn't want to put any urgency on it, just to get a
feeling for the future direction of each component



From matthias at rabbitmq.com  Thu Aug  8 22:08:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 08 Aug 2013 22:08:44 +0100
Subject: [rabbitmq-discuss] Bug/Behavior Change in binds to header
 exchanges in rabbitmq 3.1.0
In-Reply-To: <47e035bc-f794-4869-aa4f-83b281326a93@googlegroups.com>
References: <0363bdf2-1f39-443e-b2b6-7573fc56a5b2@googlegroups.com>
	<47e035bc-f794-4869-aa4f-83b281326a93@googlegroups.com>
Message-ID: <520408DC.8000206@rabbitmq.com>

Matt,

On 08/08/13 19:57, Matt Campbell wrote:
> I received the following reply from one of the rabbit guys. I'm not sure
> why he didn't reply to the group.

My reply was posted to the mailing list. As you can see here: 
http://rabbitmq.1065348.n5.nabble.com/Bug-Behavior-Change-in-binds-to-header-exchanges-in-rabbitmq-3-1-0-tp26426p26458.html

The google group is a mirror of the mailing list. The mirroring 
sometimes breaks (thanks, google), and, furthermore, we do not have 
control over the group (thanks again, google).

Matthias.

From stuff at moesel.net  Fri Aug  9 03:51:55 2013
From: stuff at moesel.net (Chris)
Date: Thu, 8 Aug 2013 22:51:55 -0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in Java
	Client
Message-ID: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>

Hello,

I understand that in the event of a master queue going down, a consumer
cancel notification will be sent to all consumers.  Upon receiving the
notification, the consumer can re-consume from the queue (the newly
promoted master queue of course).

I have a consumer that is a subclass of the Java DefaultConsumer.  I'm
having trouble figuring out exactly how to reconsume from the queue.
 Whenever I try to do anything with the channel in my "handleCancel" method
implementation, it blocks forever.  I'm guessing there is a lock on the
channel while I'm in that method, and that lock that prevents me from
redeclaring queues or consuming from them?  It seems, however, I can't even
create a new channel when I'm in that "handleCancel" method.

What is the recommended way for reconsuming?  Do I need to spawn another
thread to do it asynchronously?  That doesn't seem right, but I'm out of
ideas... Or am I missing something really obvious?  I feel like that is
probably more likely. ;-)

Thanks for any pointers!
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130808/bc9a65bd/attachment.htm>

From mklishin at gopivotal.com  Fri Aug  9 08:19:03 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 9 Aug 2013 11:19:03 +0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
Message-ID: <FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>

Chris:

> Whenever I try to do anything with the channel in my "handleCancel" method implementation, it blocks forever.  I'm guessing there is a lock on the channel while I'm in that method, and that lock that prevents me from redeclaring queues or consuming from them?

Chris,

There should be no lock that prevents operations from handleCancel.

Can you use VisualVM or jstack to take a thread dump and see what method hangs?
Do you see any alarms mentioned in RabbitMQ log?

Is there a way you can reproduce this issue with a code sample you can post?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/6b8c809a/attachment.pgp>

From JSwainston at sportingsolutions.com  Fri Aug  9 11:22:12 2013
From: JSwainston at sportingsolutions.com (Jim Swainston)
Date: Fri, 9 Aug 2013 11:22:12 +0100
Subject: [rabbitmq-discuss] Queue Creation Rate and response times
Message-ID: <556325346CA26341B6F0530E07F90D960170843548AE@GBGH-EXCH-CMS.sig.ads>

Hi,

Would anyone be able to give me some guidance on what I can expect from Rabbit regarding the rate of queue creation, and what I can do to increase it.

I have one Rabbit box with many virtual hosts, each host has a durable topic exchange.
The large majority of the time our system is creating approximately 5 queues per second with two bindings each across the whole rabbit box (I don't currently have figures for queue deletion) and each queue creation request averages about 350ms.
The queues are non-durable and make use of x-expires, x-message-ttl and auto-delete.

Recently I have started to get short lived spikes in queue creation up to approximately 20 queues per second across the whole rabbit box.
When this happens the queue creation request time can jump up to anywhere between 10000ms and 20000ms.
At the same time as this it appears as if the publishing request  to these exchanges also increases from about 40ms to about 5000ms.

I am currently using RabbitMQ 2.8.6 on Erlang R13B03 running on an Ubuntu server with 2Gb RAM

Thanks

Jim

**********************************************************************
Please consider the environment before printing this email or attachments

This email and any attachments are confidential, protected by copyright and may be legally privileged.  If you are not the intended recipient, then the dissemination or copying of this email is prohibited. If you have received this in error, please notify the sender by replying by email and then delete the email completely from your system.  Neither Sporting Index nor the sender accepts responsibility for any virus, or any other defect which might affect any computer or IT system into which the email is received and/or opened.  It is the responsibility of the recipient to scan the email and no responsibility is accepted for any loss or damage arising in any way from receipt or use of this email.  Sporting Index Ltd is a company registered in England and Wales with company number 2636842, whose registered office is at Gateway House, Milverton Street, London, SE11 4AP.  Sporting Index Ltd is authorised and regulated by the UK Financial Services Authority (reg. no. 150404) and Gambling Commission (reg. no. 000-027343-R-308898-001).  Any financial promotion contained herein has been issued
and approved by Sporting Index Ltd.

Outbound email has been scanned for viruses and SPAM


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/b7e042cd/attachment.htm>

From houxuehua49 at gmail.com  Fri Aug  9 11:53:44 2013
From: houxuehua49 at gmail.com (richmonkey)
Date: Fri, 9 Aug 2013 03:53:44 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster memory alarm blocks producer too long
In-Reply-To: <51DA6A45.4020504@rabbitmq.com>
References: <6585d4ed-400d-451f-8dc4-511900bf4e45@googlegroups.com>
	<51C18169.7080108@rabbitmq.com>
	<1371700372306-27507.post@n5.nabble.com>
	<51CBE111.5060905@rabbitmq.com>
	<1373260079251-27877.post@n5.nabble.com>
	<51DA6A45.4020504@rabbitmq.com>
Message-ID: <1376045624250-28691.post@n5.nabble.com>

Thanks for your reply.

I  writed  a small python program to reproduce the issue.
You can download the code from https://gist.github.com/richmonkey/6192737.
Python2.7 with amqp extension is needed,
also you need change the mq_host config in the source.

Run:
python2.7 benchmark.py



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/cluster-memory-alarm-blocks-producer-too-long-tp27473p28691.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gsim at redhat.com  Fri Aug  9 12:25:52 2013
From: gsim at redhat.com (Gordon Sim)
Date: Fri, 09 Aug 2013 12:25:52 +0100
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
Message-ID: <5204D1C0.1090702@redhat.com>

On 08/07/2013 08:16 PM, Alan Antonuk wrote:
> I've been doing a bit of thinking about building a more fully-featured
> native AMQP client library in C/C++, and have been pondering where to go
> with designing the public API for the library.
>
> A question for the authors of AMQP client libraries: if you could change
> the the public API to your library, what would you change? (and why?).

I've been involved in the c++ AMQP client (qpid::messaging) at Apache 
Qpid. The ability to integrate with external event loops and a more 
complete model for asynchronous control flow would be the key things I 
would change. Also providing more detailed information about the status 
of outgoing messages.


From gsim at redhat.com  Fri Aug  9 12:26:11 2013
From: gsim at redhat.com (Gordon Sim)
Date: Fri, 09 Aug 2013 12:26:11 +0100
Subject: [rabbitmq-discuss] C++ client options
In-Reply-To: <5202B2EB.2000203@pocock.com.au>
References: <52024F9D.4000501@pocock.com.au>
	<F9E85480F62349458DF67CE8BA000D8D2D36DB5F@FR44EX3005.global.ds.honeywell.com>
	<CAAt2poJdj4gpf4DiUat+gi8JsjXbqDi0YMa8B=2gxgmZy8L3vA@mail.gmail.com>
	<5202B2EB.2000203@pocock.com.au>
Message-ID: <5204D1D3.7070603@redhat.com>

On 08/07/2013 09:49 PM, Daniel Pocock wrote:
> Just some background: I'm mentoring a student with Google Summer of
> Code, he is making some changes to the reSIProcate project
>
> reSIProcate is a strongly object-oriented C++ project, so to remain
> consistent with the code style, using C++ would be nice.  Regular C
> could be used too.  Some parts of the stack use asio, other parts use a
> similar, single threaded async model.
>
> What we have here is a SIP voice conferencing application:
>
>    https://github.com/resiprocate/reConServer
>
> The original version of the code just takes commands and prints
> responses through stdin/stdout.  We would like to replace that with JSON
> over RabbitMQ / AMQP

Would publishing over MQTT be an option? That might give further choices 
in client library.

From matthias at rabbitmq.com  Fri Aug  9 13:07:15 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 09 Aug 2013 13:07:15 +0100
Subject: [rabbitmq-discuss] cluster memory alarm blocks producer too long
In-Reply-To: <1376045624250-28691.post@n5.nabble.com>
References: <6585d4ed-400d-451f-8dc4-511900bf4e45@googlegroups.com>
	<51C18169.7080108@rabbitmq.com>
	<1371700372306-27507.post@n5.nabble.com>
	<51CBE111.5060905@rabbitmq.com>
	<1373260079251-27877.post@n5.nabble.com>
	<51DA6A45.4020504@rabbitmq.com>
	<1376045624250-28691.post@n5.nabble.com>
Message-ID: <5204DB73.5060300@rabbitmq.com>

On 09/08/13 11:53, richmonkey wrote:
> I  writed  a small python program to reproduce the issue.
> You can download the code from https://gist.github.com/richmonkey/6192737.
> Python2.7 with amqp extension is needed,
> also you need change the mq_host config in the source.
>
> Run:
> python2.7 benchmark.py

Thanks. A few questions...

1) What version of RabbitMQ did you run this against? If you haven't 
tried the latest 3.1.4 then please do.

2) When I run the program, what am I meant to watching out for? i.e. how 
can I tell when I've reproduced the problem?

3) Are you running this against an unclustered rabbit broker, or are you 
using clustering & mirroring?


Regards,

Matthias.

From mklishin at gopivotal.com  Fri Aug  9 14:10:14 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 9 Aug 2013 17:10:14 +0400
Subject: [rabbitmq-discuss] Queue Creation Rate and response times
In-Reply-To: <556325346CA26341B6F0530E07F90D960170843548AE@GBGH-EXCH-CMS.sig.ads>
References: <556325346CA26341B6F0530E07F90D960170843548AE@GBGH-EXCH-CMS.sig.ads>
Message-ID: <AA5C16AC-DCAC-4DF3-AFB5-C645F66C0651@gopivotal.com>

Jim Swainston:

> Recently I have started to get short lived spikes in queue creation up to approximately 20 queues per second across the whole rabbit box.
> When this happens the queue creation request time can jump up to anywhere between 10000ms and 20000ms.
> At the same time as this it appears as if the publishing request  to these exchanges also increases from about 40ms to about 5000ms.

Have you tried running vmstat or iostat to see if can be a limited I/O issue? Do you create exchanges
as durable? Is RabbitMQ running on localhost, accessed over LAN or WAN?

I have a benchmark in one of the clients (Bunny) that demonstrates about 0.77 KGhz for queue.declare
with server-named, non-durable, exclusive queues:

https://github.com/ruby-amqp/bunny/blob/master/benchmarks/queue_declare.rb

To run it, do bundle install and then bundle exec ruby benchmarks/queue_declare.rb
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/99f2268b/attachment.pgp>

From stuff at moesel.net  Fri Aug  9 14:19:04 2013
From: stuff at moesel.net (Chris)
Date: Fri, 9 Aug 2013 09:19:04 -0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
Message-ID: <CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>

I'm not sure if I can send attachments in this mailing list, so I'll inline
the data in the message.  Please let me know if there are any issues or
questions.  I am using RabbitMQ Java client 3.0.1 w/ RabbitMQ server 3.1.1.

*Thread Dump*

I did a thread dump on a simple app and here is what seems to be the
relevant portion when I try to reconsume (full thread dump at end of
message):

"AMQP Connection 10.106.76.31:5672" prio=5 tid=0x00007fde3383e000
nid=0x6203 in Object.wait() [0x00000001104bc000]
   java.lang.Thread.State: WAITING (on object monitor)
at java.lang.Object.wait(Native Method)
- waiting on <0x00000007d5bfb028> (a
com.rabbitmq.utility.BlockingValueOrException)
at java.lang.Object.wait(Object.java:503)
at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
- locked <0x00000007d5bfb028> (a
com.rabbitmq.utility.BlockingValueOrException)
at
com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:89)
- locked <0x00000007d5bfb028> (a
com.rabbitmq.utility.BlockingValueOrException)
at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:972)
at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:941)
at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:933)
at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:926)
at
com.avid.acs.example.rabbitmq.SimpleConsumerExample$SimpleConsumer.handleCancel(SimpleConsumerExample.java:50)
at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:395)
at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144)
at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:91)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:533)


*Simple App to Reproduce*

I *can* reproduce this in a simple Java app, which I will copy below.  Here
is how I reproduce it:

   - You need a running active/active cluster with a policy to mirror the
   queue you will test with
   - Create the queue on node1 so that is where its master resides (with
   slave on node2)
   - Run the SimpleConsumerExample so it connects to node2
   - Restart RabbitMQ on node1 so that the master dies and the slave on
   node2 is promoted.

At this point, we should see handleCancel invoked (it is) and then
reconsume from the channel (this is where it hangs).

*The Java Example Code*
*
*

package example.rabbitmq;

import com.rabbitmq.client.AMQP;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DefaultConsumer;
import com.rabbitmq.client.Envelope;

import java.io.IOException;

public class SimpleConsumerExample {
    private static final String DEFAULT_URI = "amqp://localhost";
    private static final String DEFAULT_QUEUE = "test_queue";

    public static void main(String[] args) throws Exception {
        String uri = args.length > 0 ? args[0] : DEFAULT_URI;
        String queueName = args.length > 1 ? args[1] : DEFAULT_QUEUE;
        ConnectionFactory factory = new ConnectionFactory();
        factory.setUri(uri);

        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();
        String queue = channel.queueDeclare(queueName, true, false, false,
null).getQueue();
        String cTag = channel.basicConsume(queue, true, new
SimpleConsumer(channel, queue));
        System.out.println("basicConsume: " + cTag);
    }

    public static class SimpleConsumer extends DefaultConsumer {
        private String queue;

        public SimpleConsumer(Channel channel, String queue) {
            super(channel);
            this.queue = queue;
        }

        @Override
        public void handleDelivery(String consumerTag, Envelope envelope,
AMQP.BasicProperties properties, byte[] body) throws IOException {
            System.out.println("handleDelivery: " + consumerTag);
        }

        @Override
        public void handleCancel(String consumerTag) throws IOException {
            System.out.println("handleCancel: " + consumerTag);
            super.handleCancel(consumerTag);

            String cTag = getChannel().basicConsume(queue, this);
            System.out.println("basic(Re)Consume: " + cTag); // <-- Never
gets here
        }
    }
}


*The Thread Dump*
*
*

Full thread dump OpenJDK 64-Bit Server VM (24.0-b49 mixed mode):

"DestroyJavaVM" prio=5 tid=0x00007fde35802000 nid=0x1d03 waiting on
condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"pool-1-thread-1" prio=5 tid=0x00007fde338a7800 nid=0x6603 waiting on
condition [0x000000011072d000]
   java.lang.Thread.State: WAITING (parking)
at sun.misc.Unsafe.park(Native Method)
- parking to wait for  <0x00000007d57e8fe8> (a
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
at
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
at
java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
at
java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1068)
at
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
at java.lang.Thread.run(Thread.java:724)

"pool-2-thread-1" prio=5 tid=0x00007fde3504d800 nid=0x6403 waiting on
condition [0x000000011062a000]
   java.lang.Thread.State: TIMED_WAITING (parking)
at sun.misc.Unsafe.park(Native Method)
- parking to wait for  <0x00000007d5c4f300> (a
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)
at
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2082)
at
java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1090)
at
java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:807)
at
java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1068)
at
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
at java.lang.Thread.run(Thread.java:724)

"AMQP Connection 10.106.76.31:5672" prio=5 tid=0x00007fde3383e000
nid=0x6203 in Object.wait() [0x00000001104bc000]
   java.lang.Thread.State: WAITING (on object monitor)
at java.lang.Object.wait(Native Method)
- waiting on <0x00000007d5bfb028> (a
com.rabbitmq.utility.BlockingValueOrException)
at java.lang.Object.wait(Object.java:503)
at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
- locked <0x00000007d5bfb028> (a
com.rabbitmq.utility.BlockingValueOrException)
at
com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:89)
- locked <0x00000007d5bfb028> (a
com.rabbitmq.utility.BlockingValueOrException)
at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:972)
at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:941)
at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:933)
at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:926)
at
com.avid.acs.example.rabbitmq.SimpleConsumerExample$SimpleConsumer.handleCancel(SimpleConsumerExample.java:50)
at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:395)
at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144)
at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:91)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:533)

"Monitor Ctrl-Break" daemon prio=5 tid=0x00007fde34009000 nid=0x6003
runnable [0x000000011035c000]
   java.lang.Thread.State: RUNNABLE
at java.net.SocketInputStream.socketRead0(Native Method)
at java.net.SocketInputStream.read(SocketInputStream.java:150)
at java.net.SocketInputStream.read(SocketInputStream.java:121)
at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:283)
at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:325)
at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:177)
- locked <0x00000007d5657698> (a java.io.InputStreamReader)
at java.io.InputStreamReader.read(InputStreamReader.java:184)
at java.io.BufferedReader.fill(BufferedReader.java:154)
at java.io.BufferedReader.readLine(BufferedReader.java:317)
- locked <0x00000007d5657698> (a java.io.InputStreamReader)
at java.io.BufferedReader.readLine(BufferedReader.java:382)
at com.intellij.rt.execution.application.AppMain$1.run(AppMain.java:85)
at java.lang.Thread.run(Thread.java:724)

"Service Thread" daemon prio=5 tid=0x00007fde3308f000 nid=0x5c03 runnable
[0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread1" daemon prio=5 tid=0x00007fde3308e800 nid=0x5a03
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread0" daemon prio=5 tid=0x00007fde3308d000 nid=0x5803
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Signal Dispatcher" daemon prio=5 tid=0x00007fde33035000 nid=0x5603 waiting
on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Finalizer" daemon prio=5 tid=0x00007fde33818800 nid=0x4603 in
Object.wait() [0x000000010f9f2000]
   java.lang.Thread.State: WAITING (on object monitor)
at java.lang.Object.wait(Native Method)
- waiting on <0x00000007d5505448> (a java.lang.ref.ReferenceQueue$Lock)
at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)
- locked <0x00000007d5505448> (a java.lang.ref.ReferenceQueue$Lock)
at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)
at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:189)

"Reference Handler" daemon prio=5 tid=0x00007fde33817800 nid=0x4403 in
Object.wait() [0x000000010f8ef000]
   java.lang.Thread.State: WAITING (on object monitor)
at java.lang.Object.wait(Native Method)
- waiting on <0x00000007d5504fd0> (a java.lang.ref.Reference$Lock)
at java.lang.Object.wait(Object.java:503)
at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)
- locked <0x00000007d5504fd0> (a java.lang.ref.Reference$Lock)

"VM Thread" prio=5 tid=0x00007fde33815000 nid=0x4203 runnable

"GC task thread#0 (ParallelGC)" prio=5 tid=0x00007fde3380e800 nid=0x3203
runnable

"GC task thread#1 (ParallelGC)" prio=5 tid=0x00007fde3303a800 nid=0x3403
runnable

"GC task thread#2 (ParallelGC)" prio=5 tid=0x00007fde3303b000 nid=0x3603
runnable

"GC task thread#3 (ParallelGC)" prio=5 tid=0x00007fde3303b800 nid=0x3803
runnable

"GC task thread#4 (ParallelGC)" prio=5 tid=0x00007fde3303c000 nid=0x3a03
runnable

"GC task thread#5 (ParallelGC)" prio=5 tid=0x00007fde3303d000 nid=0x3c03
runnable

"GC task thread#6 (ParallelGC)" prio=5 tid=0x00007fde3303d800 nid=0x3e03
runnable

"GC task thread#7 (ParallelGC)" prio=5 tid=0x00007fde3303e000 nid=0x4003
runnable

"VM Periodic Task Thread" prio=5 tid=0x00007fde33086000 nid=0x5e03 waiting
on condition

JNI global references: 161

Heap
 PSYoungGen      total 38912K, used 10145K [0x00000007d5500000,
0x00000007d8000000, 0x0000000800000000)
  eden space 33792K, 30% used
[0x00000007d5500000,0x00000007d5ee8558,0x00000007d7600000)
  from space 5120K, 0% used
[0x00000007d7b00000,0x00000007d7b00000,0x00000007d8000000)
  to   space 5120K, 0% used
[0x00000007d7600000,0x00000007d7600000,0x00000007d7b00000)
 ParOldGen       total 87040K, used 0K [0x0000000780000000,
0x0000000785500000, 0x00000007d5500000)
  object space 87040K, 0% used
[0x0000000780000000,0x0000000780000000,0x0000000785500000)
 PSPermGen       total 21504K, used 4385K [0x000000077ae00000,
0x000000077c300000, 0x0000000780000000)
  object space 21504K, 20% used
[0x000000077ae00000,0x000000077b248528,0x000000077c300000)


*Conclusion*
*
*
Thanks for any help you can give!

-Chris

*
*


On Fri, Aug 9, 2013 at 3:19 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Chris:
>
> > Whenever I try to do anything with the channel in my "handleCancel"
> method implementation, it blocks forever.  I'm guessing there is a lock on
> the channel while I'm in that method, and that lock that prevents me from
> redeclaring queues or consuming from them?
>
> Chris,
>
> There should be no lock that prevents operations from handleCancel.
>
> Can you use VisualVM or jstack to take a thread dump and see what method
> hangs?
> Do you see any alarms mentioned in RabbitMQ log?
>
> Is there a way you can reproduce this issue with a code sample you can
> post?
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/5b8f8e3a/attachment.htm>

From simon at rabbitmq.com  Fri Aug  9 14:29:33 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Aug 2013 14:29:33 +0100
Subject: [rabbitmq-discuss] Queue Creation Rate and response times
In-Reply-To: <556325346CA26341B6F0530E07F90D960170843548AE@GBGH-EXCH-CMS.sig.ads>
References: <556325346CA26341B6F0530E07F90D960170843548AE@GBGH-EXCH-CMS.sig.ads>
Message-ID: <5204EEBD.1010206@rabbitmq.com>

There was a bug (fixed in 2.8.7) where deleting non-durable things 
triggered an fsync. (Deleting durable things will cause an fsync anyway).

I assume if you're creating 20 queues/sec you're probably deleting at a 
similar rate? Depending on how fast your system can fsync that might be 
a problem.

Cheers, Simon

On 09/08/2013 11:22AM, Jim Swainston wrote:
> Hi,
>
> Would anyone be able to give me some guidance on what I can expect from
> Rabbit regarding the rate of queue creation, and what I can do to
> increase it.
>
> I have one Rabbit box with many virtual hosts, each host has a durable
> topic exchange.
>
> The large majority of the time our system is creating approximately 5
> queues per second with two bindings each across the whole rabbit box (I
> don?t currently have figures for queue deletion) and each queue creation
> request averages about 350ms.
>
> The queues are non-durable and make use of x-expires, x-message-ttl and
> auto-delete.
>
> Recently I have started to get short lived spikes in queue creation up
> to approximately 20 queues per second across the whole rabbit box.
>
> When this happens the queue creation request time can jump up to
> anywhere between 10000ms and 20000ms.
>
> At the same time as this it appears as if the publishing request  to
> these exchanges also increases from about 40ms to about 5000ms.
>
> I am currently using RabbitMQ 2.8.6 on Erlang R13B03 running on an
> Ubuntu server with 2Gb RAM
>
> Thanks
>
> Jim
>
>
>
>
> *****************************************************************************
> P*Please consider the environment before printing this email or
> attachments*
>
>
> This email and any attachments are confidential, protected by copyright
> and may be legally privileged. If you are not the intended recipient,
> then the dissemination or copying of this email is prohibited. If you
> have received this in error, please notify the sender by replying by
> email and then delete the email completely from your system. Neither
> Sporting Index nor the sender accepts responsibility for any virus, or
> any other defect which might affect any computer or IT system into which
> the email is received and/or opened. It is the responsibility of the
> recipient to scan the email and no responsibility is accepted for any
> loss or damage arising in any way from receipt or use of this email.
> Sporting Index Ltd is a company registered in England and Wales with
> company number 2636842, whose registered office is at Gateway House,
> Milverton Street, London, SE11 4AP. Sporting Index Ltd is authorised and
> regulated by the UK Financial Services Authority (reg. no. 150404) and
> Gambling Commission (reg. no. 000-027343-R-308898-001). Any financial
> promotion contained herein has been issued and approved by Sporting
> Index Ltd.
>
>
> Outbound email has been scanned for viruses and SPAM
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Fri Aug  9 14:30:44 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 9 Aug 2013 17:30:44 +0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
	<CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
Message-ID: <BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>

Chris:

> Thanks for any help you can give!

Chris,

This looks like a bug in the Java client.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/e11b38fc/attachment.pgp>

From emile at rabbitmq.com  Fri Aug  9 14:32:59 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 09 Aug 2013 14:32:59 +0100
Subject: [rabbitmq-discuss] stomp and message headers
In-Reply-To: <CAJs94EZGMkv0t494MzjV-6JWQXuz6OYRX9hmVEO7=buyoxn2YA@mail.gmail.com>
References: <ktqm8f$t71$1@ger.gmane.org> <52021B94.1080903@rabbitmq.com>
	<CAJs94EZGMkv0t494MzjV-6JWQXuz6OYRX9hmVEO7=buyoxn2YA@mail.gmail.com>
Message-ID: <5204EF8B.1000402@rabbitmq.com>

On 07/08/13 11:58, Matwey V. Kornilov wrote:
> I do can send message with header 'message-id', and see it on web-page
> by means of stomp.js. My rabbitmq is 3.1.3.

Adding a "message-id" header to a "SEND" frame cases an error frame to
be sent back to the web-stomp client. The error is also recorded in the
broker logfile.

> The one more question, Why does stomp plugin (adhoc_convert_headers)
> filter out all headers with type not in longstr and signednum? It is
> not so obviously how to send array in STOMP, but float should be
> straightforward.

It is not obvious what the string representation of a floating number
should be. E.g. both uuencoded and base64 encoded versions of the binary
representations will work also. The STOMP adapter cannot make this
choice. The only encoding allowed in STOMP headers is UTF8. Since STOMP
is a text-based protocol, you should use a string representation for
floating point numbers. If this represents an unacceptable overhead then
consider placing numbers in the body or using AMQP, which supports
IEEE-754 float and double numbers.






-Emile





From stuff at moesel.net  Fri Aug  9 14:40:04 2013
From: stuff at moesel.net (Chris)
Date: Fri, 9 Aug 2013 09:40:04 -0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
	<CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
	<BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
Message-ID: <CAHEpgBDgGHHxrASVNq7HRLoNQ71SZenwasLqx-V_KsED2yWPYQ@mail.gmail.com>

I'll try upgrading to the Java 3.1.4 client to see if the bug displays
there too.  I'll let you know.

-Chris


On Fri, Aug 9, 2013 at 9:30 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Chris:
>
> > Thanks for any help you can give!
>
> Chris,
>
> This looks like a bug in the Java client.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/54413fa2/attachment.htm>

From mklishin at gopivotal.com  Fri Aug  9 14:41:34 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 9 Aug 2013 17:41:34 +0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
	<CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
	<BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
Message-ID: <DAAB5710-B6E1-496A-B8E5-86695AF14853@gopivotal.com>

Michael Klishin:

> This looks like a bug in the Java client.

Using basicConsume from another (e.g. newly created) thread is how you can work
around this issue. Passing this for consumer reference instead of instantiating a new
consumer should work fine.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/405ce861/attachment.pgp>

From mklishin at gopivotal.com  Fri Aug  9 14:42:06 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 9 Aug 2013 17:42:06 +0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <CAHEpgBDgGHHxrASVNq7HRLoNQ71SZenwasLqx-V_KsED2yWPYQ@mail.gmail.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
	<CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
	<BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
	<CAHEpgBDgGHHxrASVNq7HRLoNQ71SZenwasLqx-V_KsED2yWPYQ@mail.gmail.com>
Message-ID: <5C799CFF-C476-47EF-9826-1F8DFD1E9431@gopivotal.com>

Chris:

> I'll try upgrading to the Java 3.1.4 client to see if the bug displays there too.  I'll let you know.

I'm pretty sure it will be present with 3.1.4, too.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/26424aa3/attachment.pgp>

From matthias at rabbitmq.com  Fri Aug  9 14:42:30 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 09 Aug 2013 14:42:30 +0100
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
 Java Client
In-Reply-To: <CAHEpgBDgGHHxrASVNq7HRLoNQ71SZenwasLqx-V_KsED2yWPYQ@mail.gmail.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
	<CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
	<BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
	<CAHEpgBDgGHHxrASVNq7HRLoNQ71SZenwasLqx-V_KsED2yWPYQ@mail.gmail.com>
Message-ID: <5204F1C6.1030706@rabbitmq.com>

On 09/08/13 14:40, Chris wrote:
> I'll try upgrading to the Java 3.1.4 client to see if the bug displays
> there too.  I'll let you know.

It will be in 3.1.4 too.

Matthias.


From simon at rabbitmq.com  Fri Aug  9 14:48:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Aug 2013 14:48:26 +0100
Subject: [rabbitmq-discuss] If 2 nodes out a 3 node cluster,
 the third one becomes unresponsive until one of the nodes is
 brought back.
In-Reply-To: <CA+k2F_BB+wPLg+zf85OKdddLJ4CM6iqoapwgds2mnhOJD5Pg1g@mail.gmail.com>
References: <4073d87e-c0e8-43b9-8e0a-98ca44827fcd@googlegroups.com>
	<52021918.3010804@rabbitmq.com>
	<CA+k2F_BB+wPLg+zf85OKdddLJ4CM6iqoapwgds2mnhOJD5Pg1g@mail.gmail.com>
Message-ID: <5204F32A.7090205@rabbitmq.com>

When you say the remaining node crashes, what do you mean? What error 
message do you see?

Cheers, Simon

On 07/08/2013 3:35PM, Yamil Einar Asusta Santos wrote:
> I understand that. But I have been testing this in two different env. In
> my personal env, they remaining node crashes. Versus in the other
> environment, the cluster runs on 1 node. Same configurations, both
> paused_minority.
>
>  From your explanation I won't be using pause_minority but I think you
> should know about the second case I have here.
>
>
> On Wed, Aug 7, 2013 at 5:53 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 06/08/13 16:47, Yamil Einar Asusta Santos wrote:
>
>         I have been testing my cluster and I have come across an unexpected
>         behavior. As explained in the subject, the cluster runs well on 3
>         nodes. If I bring 1 node down, it still runs smoothly. But if I
>         bring
>         a second node down, the third one becomes unresponsive. This is what
>         the third node provides after running "rabbitmqctl report":
>
>
>     You have pause_minority mode enabled. From
>     http://www.rabbitmq.com/__partitions.html#automatic-__handling
>     <http://www.rabbitmq.com/partitions.html#automatic-handling>:
>
>         In pause-minority mode RabbitMQ will automatically pause cluster
>         nodes which determine themselves to be in a minority after seeing
>         other nodes go down.
>
>
>     So when you stop two nodes, the third determines itself to be in a
>     minority, and pauses, becoming unresponsive.
>
>     If this behaviour is not what you want, then you don't want
>     pause_minority mode.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>
>
>
> --
> Yamil Asusta
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From JSwainston at sportingsolutions.com  Fri Aug  9 15:15:05 2013
From: JSwainston at sportingsolutions.com (Jim Swainston)
Date: Fri, 9 Aug 2013 15:15:05 +0100
Subject: [rabbitmq-discuss] Queue Creation Rate and response times
In-Reply-To: <AA5C16AC-DCAC-4DF3-AFB5-C645F66C0651@gopivotal.com>
References: <556325346CA26341B6F0530E07F90D960170843548AE@GBGH-EXCH-CMS.sig.ads>
	<AA5C16AC-DCAC-4DF3-AFB5-C645F66C0651@gopivotal.com>
Message-ID: <556325346CA26341B6F0530E07F90D960170843548B0@GBGH-EXCH-CMS.sig.ads>

Hi MK,

Thanks for the response. I will take a look at vmstat etc.
The exchanges are durable topic exchanges. The rabbit box is a dedicated server accessed over LAN.
Thanks for the script I will give it a go and see what happens.

Jim

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: 09 August 2013 14:10
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Queue Creation Rate and response times

Jim Swainston:

> Recently I have started to get short lived spikes in queue creation up to approximately 20 queues per second across the whole rabbit box.
> When this happens the queue creation request time can jump up to anywhere between 10000ms and 20000ms.
> At the same time as this it appears as if the publishing request  to these exchanges also increases from about 40ms to about 5000ms.

Have you tried running vmstat or iostat to see if can be a limited I/O issue? Do you create exchanges as durable? Is RabbitMQ running on localhost, accessed over LAN or WAN?

I have a benchmark in one of the clients (Bunny) that demonstrates about 0.77 KGhz for queue.declare with server-named, non-durable, exclusive queues:

https://github.com/ruby-amqp/bunny/blob/master/benchmarks/queue_declare.rb

To run it, do bundle install and then bundle exec ruby benchmarks/queue_declare.rb
--
MK

**********************************************************************
Please consider the environment before printing this email or attachments

This email and any attachments are confidential, protected by copyright and may be legally privileged.  If you are not the intended recipient, then the dissemination or copying of this email is prohibited. If you have received this in error, please notify the sender by replying by email and then delete the email completely from your system.  Neither Sporting Index nor the sender accepts responsibility for any virus, or any other defect which might affect any computer or IT system into which the email is received and/or opened.  It is the responsibility of the recipient to scan the email and no responsibility is accepted for any loss or damage arising in any way from receipt or use of this email.  Sporting Index Ltd is a company registered in England and Wales with company number 2636842, whose registered office is at Gateway House, Milverton Street, London, SE11 4AP.  Sporting Index Ltd is authorised and regulated by the UK Financial Services Authority (reg. no. 150404) and Gambling Commission (reg. no. 000-027343-R-308898-001).  Any financial promotion contained herein has been issued
and approved by Sporting Index Ltd.

Outbound email has been scanned for viruses and SPAM

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/09871cac/attachment.htm>

From stuff at moesel.net  Fri Aug  9 15:15:52 2013
From: stuff at moesel.net (Chris)
Date: Fri, 9 Aug 2013 10:15:52 -0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <DAAB5710-B6E1-496A-B8E5-86695AF14853@gopivotal.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
	<CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
	<BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
	<DAAB5710-B6E1-496A-B8E5-86695AF14853@gopivotal.com>
Message-ID: <CAHEpgBB7UD4ms6jU-v8jtP64U0yCau2xH+FPR0b+00yRyC8WQg@mail.gmail.com>

I'm an optimistic person, so I just had to try 3.1.4.  But... you are
right.  It does not work there either.

The good news is that I've updated the handleCancel method to consume from
a new thread (as you suggested) and that seems to work!  Is this
essentially what you had in mind?

        @Override
        public void handleCancel(String consumerTag) throws IOException {
            System.out.println("handleCancel: " + consumerTag);
            super.handleCancel(consumerTag);

            final SimpleConsumer self = this;
            Runnable reconsumeTask = new Runnable() {
                    @Override
                    public void run() {
                        try {
                            String cTag = getChannel().basicConsume(queue,
self);
                            System.out.println("basic(Re)Consume: " + cTag);
                        } catch (IOException e) {
                            System.err.println("basic(Re)Consume FAILED");
                            e.printStackTrace();
                        }
                    }
                };
            new Thread(reconsumeTask).start();
        }


If I recall, it's generally recommended that you not use the same channel
in multiple threads-- but I guess this is an exception to the rule?

Thanks again for the help!
Chris


On Fri, Aug 9, 2013 at 9:41 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Michael Klishin:
>
> > This looks like a bug in the Java client.
>
> Using basicConsume from another (e.g. newly created) thread is how you can
> work
> around this issue. Passing this for consumer reference instead of
> instantiating a new
> consumer should work fine.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/fcff2389/attachment.htm>

From JSwainston at sportingsolutions.com  Fri Aug  9 15:15:57 2013
From: JSwainston at sportingsolutions.com (Jim Swainston)
Date: Fri, 9 Aug 2013 15:15:57 +0100
Subject: [rabbitmq-discuss] Queue Creation Rate and response times
In-Reply-To: <5204EEBD.1010206@rabbitmq.com>
References: <556325346CA26341B6F0530E07F90D960170843548AE@GBGH-EXCH-CMS.sig.ads>
	<5204EEBD.1010206@rabbitmq.com>
Message-ID: <556325346CA26341B6F0530E07F90D960170843548B1@GBGH-EXCH-CMS.sig.ads>

Thanks Simon, I will try an upgrade and see if that helps

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: 09 August 2013 14:30
To: Discussions about RabbitMQ
Cc: Jim Swainston
Subject: Re: [rabbitmq-discuss] Queue Creation Rate and response times

There was a bug (fixed in 2.8.7) where deleting non-durable things triggered an fsync. (Deleting durable things will cause an fsync anyway).

I assume if you're creating 20 queues/sec you're probably deleting at a similar rate? Depending on how fast your system can fsync that might be a problem.

Cheers, Simon

On 09/08/2013 11:22AM, Jim Swainston wrote:
> Hi,
>
> Would anyone be able to give me some guidance on what I can expect 
> from Rabbit regarding the rate of queue creation, and what I can do to 
> increase it.
>
> I have one Rabbit box with many virtual hosts, each host has a durable 
> topic exchange.
>
> The large majority of the time our system is creating approximately 5 
> queues per second with two bindings each across the whole rabbit box 
> (I don't currently have figures for queue deletion) and each queue 
> creation request averages about 350ms.
>
> The queues are non-durable and make use of x-expires, x-message-ttl 
> and auto-delete.
>
> Recently I have started to get short lived spikes in queue creation up 
> to approximately 20 queues per second across the whole rabbit box.
>
> When this happens the queue creation request time can jump up to 
> anywhere between 10000ms and 20000ms.
>
> At the same time as this it appears as if the publishing request  to 
> these exchanges also increases from about 40ms to about 5000ms.
>
> I am currently using RabbitMQ 2.8.6 on Erlang R13B03 running on an 
> Ubuntu server with 2Gb RAM
>
> Thanks
>
> Jim
>
>
>
>
> **********************************************************************
> ******* P*Please consider the environment before printing this email 
> or
> attachments*
>
>
> This email and any attachments are confidential, protected by 
> copyright and may be legally privileged. If you are not the intended 
> recipient, then the dissemination or copying of this email is 
> prohibited. If you have received this in error, please notify the 
> sender by replying by email and then delete the email completely from 
> your system. Neither Sporting Index nor the sender accepts 
> responsibility for any virus, or any other defect which might affect 
> any computer or IT system into which the email is received and/or 
> opened. It is the responsibility of the recipient to scan the email 
> and no responsibility is accepted for any loss or damage arising in any way from receipt or use of this email.
> Sporting Index Ltd is a company registered in England and Wales with 
> company number 2636842, whose registered office is at Gateway House, 
> Milverton Street, London, SE11 4AP. Sporting Index Ltd is authorised 
> and regulated by the UK Financial Services Authority (reg. no. 150404) 
> and Gambling Commission (reg. no. 000-027343-R-308898-001). Any 
> financial promotion contained herein has been issued and approved by 
> Sporting Index Ltd.
>
>
> Outbound email has been scanned for viruses and SPAM
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--
Simon MacMullen
RabbitMQ, Pivotal
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

**********************************************************************
Please consider the environment before printing this email or attachments

This email and any attachments are confidential, protected by copyright and may be legally privileged.  If you are not the intended recipient, then the dissemination or copying of this email is prohibited. If you have received this in error, please notify the sender by replying by email and then delete the email completely from your system.  Neither Sporting Index nor the sender accepts responsibility for any virus, or any other defect which might affect any computer or IT system into which the email is received and/or opened.  It is the responsibility of the recipient to scan the email and no responsibility is accepted for any loss or damage arising in any way from receipt or use of this email.  Sporting Index Ltd is a company registered in England and Wales with company number 2636842, whose registered office is at Gateway House, Milverton Street, London, SE11 4AP.  Sporting Index Ltd is authorised and regulated by the UK Financial Services Authority (reg. no. 150404) and Gambling Commission (reg. no. 000-027343-R-308898-001).  Any financial promotion contained herein has been issued
and approved by Sporting Index Ltd.

Outbound email has been scanned for viruses and SPAM

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/05986e96/attachment.htm>

From mklishin at gopivotal.com  Fri Aug  9 15:34:36 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 9 Aug 2013 18:34:36 +0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <CAHEpgBB7UD4ms6jU-v8jtP64U0yCau2xH+FPR0b+00yRyC8WQg@mail.gmail.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
	<CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
	<BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
	<DAAB5710-B6E1-496A-B8E5-86695AF14853@gopivotal.com>
	<CAHEpgBB7UD4ms6jU-v8jtP64U0yCau2xH+FPR0b+00yRyC8WQg@mail.gmail.com>
Message-ID: <B6098237-7FF7-49F6-B86F-9C12899C0061@gopivotal.com>

Chris:

> If I recall, it's generally recommended that you not use the same channel in multiple threads-- but I guess this is an exception to the rule?

Yes, in this case it is safe.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/edef3dbd/attachment.pgp>

From matwey.kornilov at gmail.com  Fri Aug  9 15:40:48 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Fri, 9 Aug 2013 18:40:48 +0400
Subject: [rabbitmq-discuss] stomp and message headers
In-Reply-To: <5204EF8B.1000402@rabbitmq.com>
References: <ktqm8f$t71$1@ger.gmane.org> <52021B94.1080903@rabbitmq.com>
	<CAJs94EZGMkv0t494MzjV-6JWQXuz6OYRX9hmVEO7=buyoxn2YA@mail.gmail.com>
	<5204EF8B.1000402@rabbitmq.com>
Message-ID: <CAJs94EZdKbUJOqMwc09D_H7WepSbMG-U7j6HCgRwVGeZSHYJ3Q@mail.gmail.com>

2013/8/9 Emile Joubert <emile at rabbitmq.com>:
> On 07/08/13 11:58, Matwey V. Kornilov wrote:
>> I do can send message with header 'message-id', and see it on web-page
>> by means of stomp.js. My rabbitmq is 3.1.3.
>
> Adding a "message-id" header to a "SEND" frame cases an error frame to
> be sent back to the web-stomp client. The error is also recorded in the
> broker logfile.

I've sent message through AMQP, and received through STOMP. Apologize
my imprecision.

> It is not obvious what the string representation of a floating number
> should be. E.g. both uuencoded and base64 encoded versions of the binary
> representations will work also. The STOMP adapter cannot make this
> choice.

I understand that there is no bijective relation between AMQP types
and STOMP types (UTF8 string). The point is that when I have AMQP
ecosystem and then add STOMP client (for instance to deliver messages
to web-pages), it becomes second-class citizen. The headers are just
silently dropped, headers in messages coming from STOMP-plugin are
received in longstr representation, and there is no way to somehow
customize its behavior. Instead of that I have to modify whole
existing ecosystem. That is sad.



-- 
With best regards,
Matwey V. Kornilov
http://0x2207.blogspot.com
xmpp:0x2207 at jabber.ru

From alan.antonuk at gmail.com  Fri Aug  9 19:54:40 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 9 Aug 2013 11:54:40 -0700
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <5204D1C0.1090702@redhat.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
	<5204D1C0.1090702@redhat.com>
Message-ID: <CAAt2poJ8+hLjBATzv+Ume=1mduUg0A980BDZC7HeVRnJnRQqxA@mail.gmail.com>

On Fri, Aug 9, 2013 at 4:25 AM, Gordon Sim <gsim at redhat.com> wrote:

> I've been involved in the c++ AMQP client (qpid::messaging) at Apache
>> Qpid. The ability to integrate with external event loops and a more
>> complete model for asynchronous control flow would be the key things I
>> would change. Also providing more detailed information about the status of
>> outgoing messages.
>>
>
>
> Could you expand on what kind of information you would want about the
status of outgoing messages?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/c01631f0/attachment.htm>

From Michael.Sullivan at Ticketmaster.com  Fri Aug  9 22:12:16 2013
From: Michael.Sullivan at Ticketmaster.com (Michael Sullivan)
Date: Fri, 9 Aug 2013 21:12:16 +0000
Subject: [rabbitmq-discuss] Issue with Topic Exchanges and multiple binding
	keys
Message-ID: <6A9B9F3E4CD5C1429ACA1A004E5748323D66AE19@USASHEXMB06.LYV.LiveNation.com>

Hello.  I am having an issue using the "Topic" type Exchange.  Following is the scenario...


?         I have several different subscribers that are bound to the same Queue and Exchange, with different routing key wildcards..

o   For example:

?  Da.response.server1.#

?  Da.response.server2.#

?  Da.response.server3.#

?         The messages being published have a routing key of 'Da.response.server[n].blah.blah

?         The subscribers end up receiving All messages (round-robin), regardless of the routing key.

?         It's almost as though the routing key is ignored and if a message is published that matches any of the bindings, Rabbit will route the message to any of the three servers.

Perhaps I am not fully understanding how the Topic Exchange should work, but something doesn't seem right here, and with the way it's working it's basically defeating the purpose of a Topic Exchange.

Any help would be greatly appreciated.

Thanks,
Michael Sullivan



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130809/0a90d6ff/attachment.htm>

From mklishin at gopivotal.com  Sat Aug 10 12:06:16 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 10 Aug 2013 15:06:16 +0400
Subject: [rabbitmq-discuss] Issue with Topic Exchanges and multiple
	binding keys
In-Reply-To: <6A9B9F3E4CD5C1429ACA1A004E5748323D66AE19@USASHEXMB06.LYV.LiveNation.com>
References: <6A9B9F3E4CD5C1429ACA1A004E5748323D66AE19@USASHEXMB06.LYV.LiveNation.com>
Message-ID: <59184906-AE43-4981-ACF6-2D217C42C0F0@gopivotal.com>

Michael Sullivan:

> Hello.  I am having an issue using the ?Topic? type Exchange.  Following is the scenario?
>  
> ?         I have several different subscribers that are bound to the same Queue and Exchange, with different routing key wildcards..
> o   For example: 
> ?  Da.response.server1.#
> ?  Da.response.server2.#
> ?  Da.response.server3.#
> ?         The messages being published have a routing key of ?Da.response.server[n].blah.blah
> ?         The subscribers end up receiving All messages (round-robin), regardless of the routing key.
> ?         It?s almost as though the routing key is ignored and if a message is published that matches any of the bindings, Rabbit will route the message to any of the three servers.
>  
> Perhaps I am not fully understanding how the Topic Exchange should work, but something doesn?t seem right here, and with the way it?s working it?s basically defeating the purpose of a Topic Exchange.

Bindings control how messages are routed, not how they are distributed between consumers.

With a single queue, all consumers on it
will receive deliveries from it the around-robin basis. You likely want to use multiple queues,
with one (or more) consumers per each.

See tutorial 5 [1] or the 3rd tutorial in [2].

1. http://www.rabbitmq.com/getstarted.html
2. http://rubybunny.info/articles/getting_started.html#weathr_manytomany_topic_routing_example
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130810/6a67bcc7/attachment.pgp>

From matthias at rabbitmq.com  Sun Aug 11 19:32:18 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 11 Aug 2013 19:32:18 +0100
Subject: [rabbitmq-discuss] fail upgrade from 3.1.3 to 3.1.4
In-Reply-To: <CAJaPRW5EUFN6_MYUJsKOA2GUr2o2CgAap+_h14ZXUpfaT9Mq5A@mail.gmail.com>
References: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>
	<52036B2B.3060902@rabbitmq.com>
	<CAJaPRW6quOB=BH9bUN=u56fcvT7jU0H34xQNbT4RruxVSUtSHw@mail.gmail.com>
	<CAJaPRW6cv_8OiShMrqLYHo2B6nMAL4k3=gE6sFShLyaBgV6ypg@mail.gmail.com>
	<520386D0.5020705@rabbitmq.com>
	<CAJaPRW5Svf8xgxN=gFy9JpkqEGOErQv1f1fWRnG4qevT+i=wNQ@mail.gmail.com>
	<5203B2FB.2010707@rabbitmq.com>
	<CAJaPRW5EUFN6_MYUJsKOA2GUr2o2CgAap+_h14ZXUpfaT9Mq5A@mail.gmail.com>
Message-ID: <5207D8B2.9040308@rabbitmq.com>

On 08/08/13 16:49, Guillaume Vernat wrote:
> Sorry but my knowledge of mnesia, erlang is close to nothing so I dont
> understand your answer. My goal is to extract message and put them back
> un RabbitMQ.

For what purpose?

- Messages are retained during upgrades, so there is no need to extract 
and replay them.

- If you are worried about reliability, then use mirrored queues. Again, 
no need to extract and replay messages.

Matthias.


From matthias at rabbitmq.com  Sun Aug 11 19:37:03 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 11 Aug 2013 19:37:03 +0100
Subject: [rabbitmq-discuss] shutdownCompleted is not called when queue
 is deleted
In-Reply-To: <1375818496145-28621.post@n5.nabble.com>
References: <1375818496145-28621.post@n5.nabble.com>
Message-ID: <5207D9CF.3000900@rabbitmq.com>

On 06/08/13 20:48, jchappelle wrote:
> I have implemented a Consumer that extends DefaultConsumer. When I delete my
> queue using the web interface it fires the handleCancel event in my consumer
> but it does not call shutdownCompleted in the class that is managing my
> connections. I'm trying to make my application fault tolerant so that it
> will re-connect in this case. I throw a ConsumerCancelledException in my
> handleCancel method thinking that the DefaultExceptionHandler will close the
> channel and ultimately fire the event that calls the shutdownCompleted
> method but this does not happen.

You may want to try closing the connection with connection.close() (from 
a separate thread, due to 
http://rabbitmq.1065348.n5.nabble.com/Handling-Consumer-Cancel-Notifications-in-Java-Client-tc28688.html)

Btw, it is not clear to me why you want to close the connection. The 
connection and channel are still alive and healthy; if you want to, say, 
create another queue & consumer, that could be done on the existing 
connection/channel.

Matthias.


From matthias at rabbitmq.com  Sun Aug 11 19:43:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 11 Aug 2013 19:43:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ + JBoss AS7 clustered Integration
In-Reply-To: <CAH75Yb5x5hprhKvgA-D2EU3eZ5GXWAXDZYVardWTDwLVDP9rUg@mail.gmail.com>
References: <CAH75Yb5x5hprhKvgA-D2EU3eZ5GXWAXDZYVardWTDwLVDP9rUg@mail.gmail.com>
Message-ID: <5207DB4F.8020202@rabbitmq.com>

On 08/08/13 11:38, Rajasekhar P wrote:
> Am new to RabbitMQ, I want to implement a RabbitMQ as messaging Queue.
> My application is running on JBoss AS7 clustered environment. So, could
> any one please share how to integrtae RabbitMQ in JBoss AS7 cluster.
> Appreciate the  response.

You should be able to connect to RabbitMQ from JBoss AS7 using 
RabbitMQ's Java client.

Matthias.


From matthias at rabbitmq.com  Sun Aug 11 19:46:02 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 11 Aug 2013 19:46:02 +0100
Subject: [rabbitmq-discuss] Statistics gathering
In-Reply-To: <CAELUF_CjudXaEPsqne9MjJEqazs9Wt=AhSOLsNWbeYjsW62cXA@mail.gmail.com>
References: <645a477c-e6e0-4140-a642-e3e165f8c74b@googlegroups.com>
	<51F00A47.1050904@rabbitmq.com>
	<CAELUF_DbsGjiLzG10-6QJU+2AgORQbgQ80h_ge1mJihYQ2i+mw@mail.gmail.com>
	<51F0EFBD.7010701@rabbitmq.com>
	<CAELUF_BC6jmbVVaK-p-_YSf_7un0CJYawq_M-ff_Xdmw_4uQhA@mail.gmail.com>
	<51F10BCF.5060606@rabbitmq.com>
	<CAELUF_CjudXaEPsqne9MjJEqazs9Wt=AhSOLsNWbeYjsW62cXA@mail.gmail.com>
Message-ID: <5207DBEA.7090307@rabbitmq.com>

Flavio,

have you been able to answer the questions below yourself, after further 
investigation?

Regards,

Matthias

On 25/07/13 13:18, Flavio Pompermaier wrote:
> So, actually I have just to tune sample_retention_policies to keep and
> aggregate statistics as long as I need!
> Is there a way to reset those statistics (during development I think I
> will make several tests in a day, but I think I'll keep stats for a day
> so I need to reset those couters..)?
> Moreover, I saw that detailed stats are available only for 10
> seconds..do you think it could be feasible to keep detailed data for an
> entire day or does it occupy too much space on disk?
> For example, I'd like to do something like:
>
> {rabbitmq_management, [{sample_retention_policies,
>                            [{global,   [{60, 5}, {3600, 60}, {86400,
> 1200}]},
>                             {basic,    [{60, 5},{3600, 60}, {86400, 1200}]},
>                             {detailed, [{10, 5},{3600, 60}, {86400, 1200}]}
>                          ]},
>
> What is not clear to me is which statistics provides each category..for
> example, detailed what information does affects?
> If i ask for /api/queues, will I receive more or less data if I had also
> detailed infos?
> Resolution defined in sample_retention_policies have different
> granularities in order to perform cumulative stats faster and save disk,
> right?
> Because I could configure {basic, [{{86400, 5}]} but then I keep all
> 5-secs samples for all the day and also compute aggregate stats will
> require to pass all the samples..(correct me if I'm wrong).
> Will HTTP api returns cumulative stats only? sample_age and sample_incr
> parameters are useful only I want all samples, right?
>
> Thanks for the support,
> Flavio


From jchappelle at 4redi.com  Sun Aug 11 22:03:14 2013
From: jchappelle at 4redi.com (jchappelle)
Date: Sun, 11 Aug 2013 14:03:14 -0700 (PDT)
Subject: [rabbitmq-discuss] shutdownCompleted is not called when queue
	is deleted
In-Reply-To: <5207D9CF.3000900@rabbitmq.com>
References: <1375818496145-28621.post@n5.nabble.com>
	<5207D9CF.3000900@rabbitmq.com>
Message-ID: <1376254994931-28717.post@n5.nabble.com>

Thanks for your response. 

I was closing it because I wasn't sure if the channel and connection were
alive and healthy so it was just to be safe. 

Since posting this I have started using Spring AMQP which allows me to
configure retry behavior and focus on my business problem. If anyone in
future comes across this thread I highly recommend the Spring AMQP
framework. The RabbitMQ java client is already pretty good in that you don't
have to write much code, but Spring AMQP certainly adds a lot of power for
very little effort.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/shutdownCompleted-is-not-called-when-queue-is-deleted-tp28621p28717.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From k.madnani84 at gmail.com  Mon Aug 12 05:44:09 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Sun, 11 Aug 2013 21:44:09 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ New Queues are not getting binded to
 the newly created exchange.
Message-ID: <1376282649234-28718.post@n5.nabble.com>

Hi,

I am using a java client in order to create a new exchange and a new queue
and to bind them and publish message on the exchange.The Exchange is of type
fan out so that whatever messages i publish to it should go to all the
queues bound to it.The queues are automatically generated with the API
queueDeclare.After running the below program i could see the exchange
getting created but no queues are bound it.I couldnt see my newly created
queue in the queue list.
I ran "rabbitmqctl list_bindings" but couldnt find any entry for it.Could
anybody help on it?

Java Code:
private static final String EXCHANGE_NAME = "logs5";
ConnectionFactory factory = new ConnectionFactory();
		factory.setHost("localhost");
		factory.setPort(5691);
		factory.setUsername("rbtadmin");
		factory.setPassword("x5b:LszV");
		
		try {
			Connection connection = factory.newConnection();
			Channel channel = connection.createChannel();
			
			channel.exchangeDeclare(EXCHANGE_NAME, "fanout");
			
			String queueName=channel.queueDeclare().getQueue();
			System.out.println("Queue Generated " + queueName);
			BindOk isBindOk=channel.queueBind(queueName, "logs5", "");
			
			System.out.println(" Queue Bind'" + isBindOk.toString());
			
			String message = "Hello World !!!";
			
			channel.basicPublish(EXCHANGE_NAME, "", null, message.getBytes());
		    System.out.println(" [x] Sent '" + message + "'");

		    channel.close();
		    connection.close();
		} catch (IOException e) {
			
			e.printStackTrace();
		}
	    
Output:
Queue Generated amq.gen-E-JlumgQ_lbzAo7tlojrog
 Queue Bind'#method<queue.bind-ok>()
 [x] Sent 'Hello World !!!'
	      



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-New-Queues-are-not-getting-binded-to-the-newly-created-exchange-tp28718.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From brett.r.cameron at gmail.com  Mon Aug 12 05:58:16 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Mon, 12 Aug 2013 16:58:16 +1200
Subject: [rabbitmq-discuss] RabbitMQ New Queues are not getting binded
 to the newly created exchange.
In-Reply-To: <1376282649234-28718.post@n5.nabble.com>
References: <1376282649234-28718.post@n5.nabble.com>
Message-ID: <CALPqkipA5J2WgVeufQh-oyZtYzPfW8Qj7ijn0Nc8Y4iodu6w6Q@mail.gmail.com>

The queueDeclare() method (with no arguments) creates an exclusive
auto-delete queue, so as soon as you do the channel.close() the queue will
get deleted. You might want to look at using one of the other
queueDeclare() methods to create a non-auto-delete queue.

Brett



On Mon, Aug 12, 2013 at 4:44 PM, k.madnani84 <k.madnani84 at gmail.com> wrote:

> Hi,
>
> I am using a java client in order to create a new exchange and a new queue
> and to bind them and publish message on the exchange.The Exchange is of
> type
> fan out so that whatever messages i publish to it should go to all the
> queues bound to it.The queues are automatically generated with the API
> queueDeclare.After running the below program i could see the exchange
> getting created but no queues are bound it.I couldnt see my newly created
> queue in the queue list.
> I ran "rabbitmqctl list_bindings" but couldnt find any entry for it.Could
> anybody help on it?
>
> Java Code:
> private static final String EXCHANGE_NAME = "logs5";
> ConnectionFactory factory = new ConnectionFactory();
>                 factory.setHost("localhost");
>                 factory.setPort(5691);
>                 factory.setUsername("rbtadmin");
>                 factory.setPassword("x5b:LszV");
>
>                 try {
>                         Connection connection = factory.newConnection();
>                         Channel channel = connection.createChannel();
>
>                         channel.exchangeDeclare(EXCHANGE_NAME, "fanout");
>
>                         String queueName=channel.queueDeclare().getQueue();
>                         System.out.println("Queue Generated " + queueName);
>                         BindOk isBindOk=channel.queueBind(queueName,
> "logs5", "");
>
>                         System.out.println(" Queue Bind'" +
> isBindOk.toString());
>
>                         String message = "Hello World !!!";
>
>                         channel.basicPublish(EXCHANGE_NAME, "", null,
> message.getBytes());
>                     System.out.println(" [x] Sent '" + message + "'");
>
>                     channel.close();
>                     connection.close();
>                 } catch (IOException e) {
>
>                         e.printStackTrace();
>                 }
>
> Output:
> Queue Generated amq.gen-E-JlumgQ_lbzAo7tlojrog
>  Queue Bind'#method<queue.bind-ok>()
>  [x] Sent 'Hello World !!!'
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-New-Queues-are-not-getting-binded-to-the-newly-created-exchange-tp28718.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/dba16e73/attachment.htm>

From mklishin at gopivotal.com  Mon Aug 12 06:05:04 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 12 Aug 2013 09:05:04 +0400
Subject: [rabbitmq-discuss] RabbitMQ New Queues are not getting binded
	to the newly created exchange.
In-Reply-To: <CALPqkipA5J2WgVeufQh-oyZtYzPfW8Qj7ijn0Nc8Y4iodu6w6Q@mail.gmail.com>
References: <1376282649234-28718.post@n5.nabble.com>
	<CALPqkipA5J2WgVeufQh-oyZtYzPfW8Qj7ijn0Nc8Y4iodu6w6Q@mail.gmail.com>
Message-ID: <DAEA46F4-1B19-446D-BB5D-A32CDA4D4BB5@gopivotal.com>

Brett Cameron:

> The queueDeclare() method (with no arguments) creates an exclusive auto-delete queue, so as soon as you do the channel.close() the queue will get deleted.

connection.close(), to be precise.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/5794d6cf/attachment.pgp>

From mklishin at gopivotal.com  Mon Aug 12 07:01:57 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 12 Aug 2013 10:01:57 +0400
Subject: [rabbitmq-discuss] HotBunnies 2.0.0.pre10 is released
Message-ID: <D4CF663F-BC30-481B-8312-D801DD737FEE@gopivotal.com>

HotBunnies 2.0.0.pre10 is released.

This is the first version to introduce automatic connection recovery from
network failures, similar to Bunny [1]. It is not yet 100% finished but I'd love
to hear some feedback from HotBunnies users.

You can use [2] as a simple example to try it out (ported from Bunny).

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/08/12/hotbunnies-2-dot-0-0-dot-pre10-is-released/

1. http://rubybunny.info/articles/error_handling.html
2. https://github.com/ruby-amqp/hot_bunnies/blob/master/examples/connection/automatic_recovery_with_client_named_queues.rb
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/12dd2070/attachment.pgp>

From mklishin at gopivotal.com  Mon Aug 12 07:03:56 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 12 Aug 2013 10:03:56 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.10.2 is released
Message-ID: <DD7555DA-6902-4C62-A921-F0E37CDFC4AB@gopivotal.com>

Bunny 0.10.2 is released [1].

This is a bug fix release that is 100% backwards compatible.
All users are encouraged to upgrade.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/08/12/bunny-0-dot-10-dot-2-is-released/

1. https://rubygems.org/gems/bunny/versions/0.10.2
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/bd58b15b/attachment.pgp>

From michael.s.klishin at gmail.com  Mon Aug 12 07:08:47 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 12 Aug 2013 10:08:47 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.4.0 is released
Message-ID: <CAE3HoVTJCu7XqpMh6c-UpFdpjMm2OMBg_OeAkaK-xf+RKdbvwQ@mail.gmail.com>

Langohr [1] is a small, feature complete Clojure client for RabbitMQ.

1.4.0 is a minor feature release that introduces automatic connection
recovery
(from network failures), similar to some other clients.
Detailed documentation about the design of this feature and how it is
different
from some other clients will be posted soon.

This feature can be disabled by passing :automatically-recover false to
langohr.core/connect.

Release notes:
http://blog.clojurewerkz.org/blog/2013/08/11/langohr-1-dot-4-0-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/cdd82540/attachment.htm>

From michael.s.klishin at gmail.com  Mon Aug 12 07:15:20 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 12 Aug 2013 10:15:20 +0400
Subject: [rabbitmq-discuss] ANN RabbitMQ tutorials ported to Clojure
Message-ID: <CAE3HoVR8HFXkaY_jS=4OxJZPVN+O0nq_pzJkuUfesxV45hN3xQ@mail.gmail.com>

I'm happy to announce that 5 out of 6 RabbitMQ tutorials [1] are now
available
for Clojure:

https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/clojure

and are tested for interoperability with 9 other clients. The final
tutorial will be
ported at a later point.

1. http://www.rabbitmq.com/getstarted.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/055b3bd2/attachment.htm>

From mklishin at gopivotal.com  Mon Aug 12 07:28:53 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 12 Aug 2013 10:28:53 +0400
Subject: [rabbitmq-discuss] Handling Consumer Cancel Notifications in
	Java Client
In-Reply-To: <CAHEpgBB7UD4ms6jU-v8jtP64U0yCau2xH+FPR0b+00yRyC8WQg@mail.gmail.com>
References: <CAHEpgBAo8W2KXq6D=q3S1FAFh6TQXn0ybQv0mw49deDHNMEs8A@mail.gmail.com>
	<FB2707D3-EAA5-4F01-91DD-11D3B20A862D@gopivotal.com>
	<CAHEpgBCYZJZp=N5sa6Y6fCoEpNndMS2qJ0F6t6kT88vx4twLzg@mail.gmail.com>
	<BA90F908-4877-4ECC-957C-B7FB43167C6C@gopivotal.com>
	<DAAB5710-B6E1-496A-B8E5-86695AF14853@gopivotal.com>
	<CAHEpgBB7UD4ms6jU-v8jtP64U0yCau2xH+FPR0b+00yRyC8WQg@mail.gmail.com>
Message-ID: <6A1AB962-5927-4265-890D-66FB6B21A4CD@gopivotal.com>

Chris:

> I'm an optimistic person, so I just had to try 3.1.4.  But... you are right.  It does not work there either.

Chris,

I have an update on this issue: it is resolved in a branch, see
https://github.com/rabbitmq/rabbitmq-java-client/commit/1214f66ca880922612e18694507236dfa8e968ff

It is waiting on QA now.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/3a84f402/attachment.pgp>

From k.madnani84 at gmail.com  Mon Aug 12 07:45:48 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Sun, 11 Aug 2013 23:45:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages not getting moved to the Upstream
 Federation, only empty queue is getting created.
Message-ID: <1376289948933-28726.post@n5.nabble.com>

Hi,

I have two clusters Cluster1 & Cluster2.Cluster2 has a federation Upstream
to Cluster 1 and there is a HA-Federation-policy that whatever reources end
with pattern '.federate' will get this policy applied.
When i run my Java client and hit Cluster2, a Federation Exchange and a
Federation Queue bound it it gets created in Cluster1 but the queue is
empty.The newly created queue in Cluster2 does have message but the
fedration queue in Cluster1 doesnt have it.
Is my understanding of Federation is wrong?I believe thats how it should
happen that message should move from Cluster 2 to Cluster1 if i have a
upstream of Cluster 1 in cluster 2.

So the problem is the queue "queue.federate" in Cluster2 as shown below has
2 msgs but queue in Cluster1 "federation: exchange.federate ->
CLUSTER2 at zldv0435.vci.com" has 0 msgs. 

Here is the configuration of Cluster 2."exchange.federate" is the new
exchange created with queue "queue.federate":
 /opt/app/rabbitmq/sbin/rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-nodename  "CLUSTER2 at zldv0435.vci.com"
federation      local-username  "rbtadmin"
federation-upstream     HA-upstream-CLUSTER1-adminvhost
{"uri":"amqp://feduser:myFedPassword at zldv0433.vci.com:5691","max-hops":1}
...done.

 /opt/app/rabbitmq/sbin/rabbitmqctl list_policies
Listing policies ...
/       HA-Federation-adminvhost        \\.federate$   
{"federation-upstream-set":"all"}       0
/       HA-Mirror-Federate-adminvhost   \\.fedMirror$  
{"federation-upstream-set":"all","ha-mode":"all"}       2
/       HA-Mirror-adminvhost    \\.mirror$      {"ha-mode":"all"}       1
...done.


/opt/app/rabbitmq/sbin/rabbitmqctl list_exchanges
Listing exchanges ...
        direct
amq.direct      direct
amq.fanout      fanout
amq.headers     headers
amq.match       headers
amq.rabbitmq.log        topic
amq.rabbitmq.trace      topic
amq.topic       topic
exchange.federate       fanout
...done.

/opt/app/rabbitmq/sbin/rabbitmqctl list_queues
Listing queues ...
queue.federate  2
...done.


Here is the list of queues and exchanges in Cluster1:

/opt/app/rabbitmq/sbin/rabbitmqctl list_exchanges
Listing exchanges ...
        direct
amq.direct      direct
amq.fanout      fanout
amq.headers     headers
amq.match       headers
amq.rabbitmq.log        topic
amq.rabbitmq.trace      topic
amq.topic       topic
exchange.federate       fanout
federation: exchange.federate -> CLUSTER2 at zldv0435.vci.com A       
x-federation-upstream

 /opt/app/rabbitmq/sbin/rabbitmqctl list_queues
Listing queues ...
federation: exchange.federate -> CLUSTER2 at zldv0435.vci.com  0





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-not-getting-moved-to-the-Upstream-Federation-only-empty-queue-is-getting-created-tp28726.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Mon Aug 12 07:55:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 12 Aug 2013 07:55:58 +0100
Subject: [rabbitmq-discuss] Messages not getting moved to the Upstream
 Federation, only empty queue is getting created.
In-Reply-To: <1376289948933-28726.post@n5.nabble.com>
References: <1376289948933-28726.post@n5.nabble.com>
Message-ID: <520886FE.9070501@rabbitmq.com>

On 12/08/13 07:45, k.madnani84 wrote:
> Is my understanding of Federation is wrong?I believe thats how it should
> happen that message should move from Cluster 2 to Cluster1 if i have a
> upstream of Cluster 1 in cluster 2.

The clue is in the naming. Water flows from upstream to downstream. So 
do messages.

Matthias.

From k.madnani84 at gmail.com  Mon Aug 12 08:30:44 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Mon, 12 Aug 2013 00:30:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages not getting moved to the Upstream
 Federation, only empty queue is getting created.
In-Reply-To: <520886FE.9070501@rabbitmq.com>
References: <1376289948933-28726.post@n5.nabble.com>
	<520886FE.9070501@rabbitmq.com>
Message-ID: <1376292644427-28728.post@n5.nabble.com>

But the Upstream exchange gets created only when we send a message to some
downstream exchange which adheres to the policy.And when we try to access
any of the Upstream Exchanges it says ACCESS DENIED.....I am really
confused....Could you please elaborate a bit taking my above example into
consideration....



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-not-getting-moved-to-the-Upstream-Federation-only-empty-queue-is-getting-created-tp28726p28728.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Mon Aug 12 08:42:31 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 12 Aug 2013 08:42:31 +0100
Subject: [rabbitmq-discuss] Messages not getting moved to the Upstream
 Federation, only empty queue is getting created.
In-Reply-To: <1376292644427-28728.post@n5.nabble.com>
References: <1376289948933-28726.post@n5.nabble.com>
	<520886FE.9070501@rabbitmq.com>
	<1376292644427-28728.post@n5.nabble.com>
Message-ID: <520891E7.1030504@rabbitmq.com>

On 12/08/13 08:30, k.madnani84 wrote:
> But the Upstream exchange gets created only when we send a message to some
> downstream exchange which adheres to the policy.

No exchanges or queues get created when messages are sent.

Your exchange.federate exchange will get created on the upstream when 
the downstream exchange is created. That's just for convenience; there 
is nothing stopping you creating the upstream exchange explicitly before 
hand.

> Could you please elaborate a bit taking my above example into
> consideration....

With the setup as you have it, a message published to the 
exchange.federate upstream (i.e. on your Cluster1) will get routed to 
the downstream (your Cluster2) and end up in your queue.federate queue.


Matthias.

From nikita.trophimov at gmail.com  Mon Aug 12 09:22:37 2013
From: nikita.trophimov at gmail.com (Nikita Trophimov)
Date: Mon, 12 Aug 2013 12:22:37 +0400
Subject: [rabbitmq-discuss] RabbitMQ memory limit and shutting down
Message-ID: <kua605$vai$1@ger.gmane.org>

Hello everyone.
Recently, I tried to check RabbitMQ in some critical situations, and 
found that if it doesn't have enough memory it will be turned off 
without subsequent restart. We need to create a stable system, so I'm 
wondering if we can do anything in this kind of situation (maybe more 
frequent garbage collector calls, certain configuration, etc).

Here's what I found in the logs:

**********************************************************
*** Publishers will be blocked until this alarm clears ***
**********************************************************

=INFO REPORT==== 8-Aug-2013::15:16:29 ===
vm_memory_high_watermark clear. Memory used:683898120 allowed:855275929

=WARNING REPORT==== 8-Aug-2013::15:16:29 ===
memory resource limit alarm cleared on node rabbit at helper

=INFO REPORT==== 8-Aug-2013::15:16:33 ===
vm_memory_high_watermark set. Memory used:916898176 allowed:855275929

=WARNING REPORT==== 8-Aug-2013::15:16:33 ===
memory resource limit alarm set on node rabbit at helper.


From emile at rabbitmq.com  Mon Aug 12 09:52:44 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Aug 2013 09:52:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ memory limit and shutting down
In-Reply-To: <kua605$vai$1@ger.gmane.org>
References: <kua605$vai$1@ger.gmane.org>
Message-ID: <5208A25C.1050004@rabbitmq.com>


Hi,

On 12/08/13 09:22, Nikita Trophimov wrote:

> Recently, I tried to check RabbitMQ in some critical situations, and 
> found that if it doesn't have enough memory it will be turned off 
> without subsequent restart. 

You should see the broker blocking connections instead of a broker
shutdown. The broker is still running and further messages will be
accepted as soon as some memory has been cleared by flushing messages
from RAM to disk.

Also see http://www.rabbitmq.com/memory.html#memsup

> We need to create a stable system, so I'm wondering if we can do
> anything in this kind of situation (maybe more frequent garbage
> collector calls, certain configuration, etc).

There are a number of things you can do to reduce the likelihood of
memory-based flow control:

 Add more RAM
 Increase the flow control threshold
 Define queues on different nodes in a cluster to spread the load
 Use faster disks



-Emile




From emile at rabbitmq.com  Mon Aug 12 10:11:44 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Aug 2013 10:11:44 +0100
Subject: [rabbitmq-discuss] stomp and message headers
In-Reply-To: <CAJs94EZdKbUJOqMwc09D_H7WepSbMG-U7j6HCgRwVGeZSHYJ3Q@mail.gmail.com>
References: <ktqm8f$t71$1@ger.gmane.org> <52021B94.1080903@rabbitmq.com>
	<CAJs94EZGMkv0t494MzjV-6JWQXuz6OYRX9hmVEO7=buyoxn2YA@mail.gmail.com>
	<5204EF8B.1000402@rabbitmq.com>
	<CAJs94EZdKbUJOqMwc09D_H7WepSbMG-U7j6HCgRwVGeZSHYJ3Q@mail.gmail.com>
Message-ID: <5208A6D0.4000305@rabbitmq.com>

On 09/08/13 15:40, Matwey V. Kornilov wrote:

> The headers are just silently dropped, headers in messages coming
> from STOMP-plugin are received in longstr representation, and there
> is no way to somehow customize its behavior. Instead of that I have
> to modify whole existing ecosystem. That is sad.

Thanks for providing the background. Our goal is to bring the STOMP
adapter closer to feature parity with other AMQP clients. Your
suggestion will most likely be included when this is implemented.


-Emile





From gsim at redhat.com  Mon Aug 12 11:36:16 2013
From: gsim at redhat.com (Gordon Sim)
Date: Mon, 12 Aug 2013 11:36:16 +0100
Subject: [rabbitmq-discuss] AMQP library APIs
In-Reply-To: <CAAt2poJ8+hLjBATzv+Ume=1mduUg0A980BDZC7HeVRnJnRQqxA@mail.gmail.com>
References: <CAAt2poKD9J6zCpwcO1dHrS+LetoFJLDsmAEQ_ywZOn9AbCsekA@mail.gmail.com>
	<5204D1C0.1090702@redhat.com>
	<CAAt2poJ8+hLjBATzv+Ume=1mduUg0A980BDZC7HeVRnJnRQqxA@mail.gmail.com>
Message-ID: <5208BAA0.5060307@redhat.com>

On 08/09/2013 07:54 PM, Alan Antonuk wrote:
> On Fri, Aug 9, 2013 at 4:25 AM, Gordon Sim <gsim at redhat.com
> <mailto:gsim at redhat.com>> wrote:
>
>         I've been involved in the c++ AMQP client (qpid::messaging) at
>         Apache Qpid. The ability to integrate with external event loops
>         and a more complete model for asynchronous control flow would be
>         the key things I would change. Also providing more detailed
>         information about the status of outgoing messages.
>
>
>
> Could you expand on what kind of information you would want about the
> status of outgoing messages?

Basically the ability to determine which asynchronously sent messages 
are accepted or rejected (or indeed potentially have the ability to 
associate some other statuses with them). Right now qpid::messaging 
allows you to track the acceptance of messages, but rejecting messages 
can really only be handled be ending the session (whereas it would be 
nice to merely indicate those that weren't accepted but allow the sender 
to continue).


From nikita.trophimov at gmail.com  Mon Aug 12 10:06:57 2013
From: nikita.trophimov at gmail.com (Nikita Trophimov)
Date: Mon, 12 Aug 2013 13:06:57 +0400
Subject: [rabbitmq-discuss] RabbitMQ memory limit and shutting down
In-Reply-To: <5208A25C.1050004@rabbitmq.com>
References: <kua605$vai$1@ger.gmane.org> <5208A25C.1050004@rabbitmq.com>
Message-ID: <5208A5B1.1060600@gmail.com>




> You should see the broker blocking connections instead of a broker
> shutdown. The broker is still running and further messages will be
> accepted as soon as some memory has been cleared by flushing messages
> from RAM to disk.

No, I'm pretty sure it is turned off, because I waited almost a day. 
Moreover, rabbitmq process disappeared from task manager.

To be more precise, I tried to create a lot of exchanges.

Here is the code I used:

using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace RabbitMQ_helper
{
     class Program
     {
         static void Main(string[] args)
         {
             ConnectionFactory factory = new ConnectionFactory();
             factory.UserName = "admin";
             factory.Password = "password";
             factory.HostName = "127.0.0.1";

             IConnection conn = factory.CreateConnection();

             IModel channel = conn.CreateModel();
             for (int i = 0; i < 1000000; ++i)
             {
                 channel.ExchangeDeclare("C#_" + i, ExchangeType.Direct);
             }
         }
     }
}



From joes at mail.apex.com.tw  Mon Aug 12 11:08:39 2013
From: joes at mail.apex.com.tw (=?UTF-8?B?5pa95aSp5bmz?=)
Date: Mon, 12 Aug 2013 18:08:39 +0800 (CST)
Subject: [rabbitmq-discuss] A question about web management tool
Message-ID: <9b4647af-25c2-4413-beb9-c04686933ef6.joes@mail.apex.com.tw>

Your email client does not support HTML messages
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/a813675e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SchematicDiagram.jpg
Type: application/octet-stream
Size: 52539 bytes
Desc: SchematicDiagram.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/a813675e/attachment.obj>

From matthias at rabbitmq.com  Mon Aug 12 11:43:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 12 Aug 2013 11:43:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ memory limit and shutting down
In-Reply-To: <5208A5B1.1060600@gmail.com>
References: <kua605$vai$1@ger.gmane.org> <5208A25C.1050004@rabbitmq.com>
	<5208A5B1.1060600@gmail.com>
Message-ID: <5208BC5E.1000100@rabbitmq.com>

On 12/08/13 10:06, Nikita Trophimov wrote:
> No, I'm pretty sure it is turned off, because I waited almost a day.
> Moreover, rabbitmq process disappeared from task manager.
>
> To be more precise, I tried to create a lot of exchanges.

Ah ok. Don't do that. Creating lots of resources can exhaust memory and 
cause rabbit to crash.

Matthias.


From emile at rabbitmq.com  Mon Aug 12 11:45:37 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Aug 2013 11:45:37 +0100
Subject: [rabbitmq-discuss] A question about web management tool
In-Reply-To: <9b4647af-25c2-4413-beb9-c04686933ef6.joes@mail.apex.com.tw>
References: <9b4647af-25c2-4413-beb9-c04686933ef6.joes@mail.apex.com.tw>
Message-ID: <5208BCD1.5060701@rabbitmq.com>

On 12/08/13 11:08, ??? wrote:
> I installed rabbitmq-server & enabled the web management tool in my
> computer(OS:CentOS).Then I use chrome to enter web management
> interface.I see that the chart of queued messages' time format is not
> location time.It is Geling Wei cure time.Now I want to know how to set
> the time format of queued messages' chart.There is a picture about my
> question.

If Geling Wei cure time is the same as UTC then this bug has been fixed,
but not yet released. It will be released in 3.2.0. You can either wait
until then or use a recent nightly build.



-Emile







From bill.ross at xoom.com  Mon Aug 12 18:10:01 2013
From: bill.ross at xoom.com (Bill Ross)
Date: Mon, 12 Aug 2013 17:10:01 +0000
Subject: [rabbitmq-discuss] RabbitMQ server/broker Windows7 nodedown and
	running
Message-ID: <783FA4BF1E34684F92DB6194019A87630D3086@ORD2MBX03D.mex05.mlsrvr.com>

It looks like I might still have a server running from my Windows install of RabbitMQ, but I don't see it in the process monitor, and can't connect to it with rabbitmqctl or restart. The cookie hash in the server log differs vs. the command output. With nothing to kill and a busted stop cmd, not sure what to do. When I reboot, the logs show lots of crash activity, and the server/broker is restarted with the same hash:

$ grep cookie rabbit at FLEETWOODMAC.log
cookie hash    : DR2p6xlgYrHDplyPdeGbtQ==
cookie hash    : DR2p6xlgYrHDplyPdeGbtQ==

Advice is appreciated.

rabbitmq_server-3.1.3
Windows 7

Thanks,
Bill

************* SERVER STARTUP from install **********************

=INFO REPORT==== 15-Jul-2013::14:18:57 ===
Starting RabbitMQ 3.1.3 on Erlang R16B01
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 15-Jul-2013::14:18:57 ===
node           : rabbit at FLEETWOODMAC
home dir       : C:\Windows
config file(s) : (none)
cookie hash    : DR2p6xlgYrHDplyPdeGbtQ==
log            : C:/Users/Bill Ross/AppData/Roaming/RabbitMQ/log/rabbit at FLEETWOODMAC.log<mailto:Ross/AppData/Roaming/RabbitMQ/log/rabbit at FLEETWOODMAC.log>
sasl log       : C:/Users/Bill Ross/AppData/Roaming/RabbitMQ/log/rabbit at FLEETWOODMAC-sasl.log<mailto:Ross/AppData/Roaming/RabbitMQ/log/rabbit at FLEETWOODMAC-sasl.log>
database dir   : c:/Users/Bill Ross/AppData/Roaming/RabbitMQ/db/rabbit at FLEETWOODMAC-mnesia

=INFO REPORT==== 15-Jul-2013::14:18:57 ===
Limiting to approx 8092 file handles (7280 sockets)

=WARNING REPORT==== 15-Jul-2013::14:19:01 ===
Only 2048MB of 15357MB memory usable due to limited address space.

=INFO REPORT==== 15-Jul-2013::14:19:01 ===
Memory limit set to 819MB of 15357MB total.

=INFO REPORT==== 15-Jul-2013::14:19:01 ===
Disk free limit set to 1000MB

=INFO REPORT==== 15-Jul-2013::14:19:01 ===
Adding vhost '/'

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
Creating user 'guest'

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
Setting user tags for user 'guest' to [administrator]

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
Setting permissions for 'guest' in '/' to '.*', '.*', '.*'

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 15-Jul-2013::14:19:02 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
Server startup complete; 0 plugins started.

=ERROR REPORT==== 9-Aug-2013::16:43:05 ===
** Connection attempt from disallowed node rabbitmqctl461535 at FLEETWOODMAC **

=ERROR REPORT==== 9-Aug-2013::16:44:30 ===
** Connection attempt from disallowed node rabbitmqctl2842093 at FLEETWOODMAC **

=ERROR REPORT==== 9-Aug-2013::16:58:25 ===
** Connection attempt from disallowed node rabbitmqctl174332 at FLEETWOODMAC **
  ...
========================

**************************************
*************************** STOP SERVER

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.1.3\sbin>rabbitmqctl.bat stop
Stopping and halting node rabbit at FLEETWOODMAC ...
Error: unable to connect to node rabbit at FLEETWOODMAC: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at FLEETWOODMAC]

hosts, their running nodes and ports:
- FLEETWOODMAC: [{rabbit,55089},{rabbitmqctl115099,55987}]

current node details:
- node name: rabbitmqctl115099 at FLEETWOODMAC
- home dir: H:\
- cookie hash: VTS0FHv40cXw/uYu5x65Eg==

*************************************
************************   START SERVER

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.1.3\sbin>rabbitmq-server.bat
ERROR: node with name "rabbit" already running on "FLEETWOODMAC"

DIAGNOSTICS
===========

nodes in question: [rabbit at FLEETWOODMAC]

hosts, their running nodes and ports:
- FLEETWOODMAC: [{rabbit,55089},{rabbitmqprelaunch1890276,55882}]

current node details:
- node name: rabbitmqprelaunch1890276 at FLEETWOODMAC
- home dir: H:\
- cookie hash: VTS0FHv40cXw/uYu5x65Eg==



---------------------------------------------------------------------------------
The information transmitted in this email is intended only for the person or entity to which it is addressed, and may contain material confidential to Xoom Corporation, and/or its subsidiary, buyindiaonline.com Inc.  Any review, retransmission, dissemination or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient(s) is prohibited.   If you received this email in error, please contact the sender and delete the material from your files.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/d4714778/attachment.htm>

From pompermaier at okkam.it  Mon Aug 12 18:29:50 2013
From: pompermaier at okkam.it (Flavio Pompermaier)
Date: Mon, 12 Aug 2013 19:29:50 +0200
Subject: [rabbitmq-discuss] Statistics gathering
In-Reply-To: <5207DBEA.7090307@rabbitmq.com>
References: <645a477c-e6e0-4140-a642-e3e165f8c74b@googlegroups.com>
	<51F00A47.1050904@rabbitmq.com>
	<CAELUF_DbsGjiLzG10-6QJU+2AgORQbgQ80h_ge1mJihYQ2i+mw@mail.gmail.com>
	<51F0EFBD.7010701@rabbitmq.com>
	<CAELUF_BC6jmbVVaK-p-_YSf_7un0CJYawq_M-ff_Xdmw_4uQhA@mail.gmail.com>
	<51F10BCF.5060606@rabbitmq.com>
	<CAELUF_CjudXaEPsqne9MjJEqazs9Wt=AhSOLsNWbeYjsW62cXA@mail.gmail.com>
	<5207DBEA.7090307@rabbitmq.com>
Message-ID: <CAELUF_AQHjwna61=bRU4Ri3qR_=B8eEyRVW=gZ-uW_XYgbaFaw@mail.gmail.com>

Actually my evaluation has been postponed to the next month. I will keep
you up to date!

Best,
Flavio
On Aug 11, 2013 8:46 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:
>
> Flavio,
>
> have you been able to answer the questions below yourself, after further
investigation?
>
> Regards,
>
> Matthias
>
>
> On 25/07/13 13:18, Flavio Pompermaier wrote:
>>
>> So, actually I have just to tune sample_retention_policies to keep and
>> aggregate statistics as long as I need!
>> Is there a way to reset those statistics (during development I think I
>> will make several tests in a day, but I think I'll keep stats for a day
>> so I need to reset those couters..)?
>> Moreover, I saw that detailed stats are available only for 10
>> seconds..do you think it could be feasible to keep detailed data for an
>> entire day or does it occupy too much space on disk?
>> For example, I'd like to do something like:
>>
>> {rabbitmq_management, [{sample_retention_policies,
>>                            [{global,   [{60, 5}, {3600, 60}, {86400,
>> 1200}]},
>>                             {basic,    [{60, 5},{3600, 60}, {86400,
1200}]},
>>                             {detailed, [{10, 5},{3600, 60}, {86400,
1200}]}
>>                          ]},
>>
>> What is not clear to me is which statistics provides each category..for
>> example, detailed what information does affects?
>> If i ask for /api/queues, will I receive more or less data if I had also
>> detailed infos?
>> Resolution defined in sample_retention_policies have different
>> granularities in order to perform cumulative stats faster and save disk,
>> right?
>> Because I could configure {basic, [{{86400, 5}]} but then I keep all
>> 5-secs samples for all the day and also compute aggregate stats will
>> require to pass all the samples..(correct me if I'm wrong).
>> Will HTTP api returns cumulative stats only? sample_age and sample_incr
>> parameters are useful only I want all samples, right?
>>
>> Thanks for the support,
>> Flavio
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/2523015e/attachment.htm>

From nikita.trophimov at gmail.com  Mon Aug 12 12:54:45 2013
From: nikita.trophimov at gmail.com (Nikita Trophimov)
Date: Mon, 12 Aug 2013 15:54:45 +0400
Subject: [rabbitmq-discuss] RabbitMQ memory limit and shutting down
In-Reply-To: <5208BC5E.1000100@rabbitmq.com>
References: <kua605$vai$1@ger.gmane.org> <5208A25C.1050004@rabbitmq.com>
	<5208A5B1.1060600@gmail.com> <5208BC5E.1000100@rabbitmq.com>
Message-ID: <5208CD05.3000901@gmail.com>



> Ah ok. Don't do that. Creating lots of resources can exhaust memory and
> cause rabbit to crash.

Ok.

Our situation looks like this:
- We have a server with X GB RAM on it. There is RabbitMQ running
- RabbitMQ for the correct work requires Y GB memory (Y < X)
- Over time, Y increases (there are new users, messages, etc)
- When Y will be greater than X, RabbitMQ crashes

The specifics of our task - we need a lot of accounts in RabbitMQ, each 
account has its own exchange.

Questions:

How can we avoid a situation when Y > X?

How can we evaluate the requirements of RabbitMQ in case of resources?
The fact that we have two cases that require resources:
- Creating new users with exchanges
- Messages between users
First case we can control by ourselves (for example, via external 
utility that monitors free resources on the server and stops creating 
new users).
But what we can do with the second case (resources for messages 
initially was enough, but number of messages has increased)?

Or is the only way to avoid the situation with Y > X is conducting 
stress testing to understand the hardware requirements?


From dan.arnould at gmail.com  Mon Aug 12 14:49:13 2013
From: dan.arnould at gmail.com (Dan A)
Date: Mon, 12 Aug 2013 06:49:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Net::RabbitFoot - Perl interface described on
 website failing to build
Message-ID: <17283a5d-5f5b-42ec-8716-a1452898543b@googlegroups.com>



Hello all,

The Perl module advocated on the website for use with RabbitMQ, in the website's tutorials, Net::RabbitFoot, fails to build on my system.

I suspect this is actually due to a particular bug in one if its dependencies, MooseX::AttributeHelpers, which fails tests in recent Perl versions (and is actually deprecated) - as described here: https://rt.cpan.org/Public/Bug/Display.html?id=81564  

I am running Perl v5.18.0, which is recent enough to be afflicted by this bug.  Below is an output dump from the CPAN shell, for further information.

Does anybody have any further information / insight on this, at all?

Thanks,

Dan


cpan[1]>install Net::RabbitFoot
Reading '/root/.cpan/Metadata'
  Database was generated on Sun, 11 Aug 2013 17:08:03 GMT
Running install for module 'Net::RabbitFoot'
Running make for I/IK/IKUTA/Net-RabbitFoot-1.03.tar.gz
Checksum for /root/.cpan/sources/authors/id/I/IK/IKUTA/Net-RabbitFoot-1.03.tar.gz ok
Scanning cache /root/.cpan/build for sizes
............................................................................DONE

  CPAN.pm: Building I/IK/IKUTA/Net-RabbitFoot-1.03.tar.gz

Cannot determine perl version info from lib/Net/RabbitFoot.pm
*** Module::AutoInstall version 1.03
*** Checking for Perl dependencies...
*** Since we're running under CPAN, I'll just let it take care
    of the dependency's installation later.
[Core Features]
- ExtUtils::MakeMaker      ...loaded. (6.66 >= 6.11)
- Test::More               ...loaded. (0.98)
- Test::Exception          ...loaded. (0.32)
- version                  ...loaded. (0.9902)
- Moose                    ...loaded. (2.1005)
- MooseX::AttributeHelpers ...missing.
- MooseX::App::Cmd         ...loaded. (0.10)
- MooseX::ConfigFromFile   ...loaded. (0.11)
- Config::Any              ...loaded. (0.23)
- JSON::XS                 ...loaded. (2.34)
- List::MoreUtils          ...loaded. (0.33)
- AnyEvent::RabbitMQ       ...loaded. (1.15)
- Coro                     ...loaded. (6.31)
- Coro::AnyEvent           ...loaded. (6.31)
*** Module::AutoInstall configuration finished.
Checking if your kit is complete...
Looks good
Warning: prerequisite MooseX::AttributeHelpers 0 not found.
Writing Makefile for Net::RabbitFoot
Writing MYMETA.yml and MYMETA.json
---- Unsatisfied dependencies detected during ----
----     IKUTA/Net-RabbitFoot-1.03.tar.gz     ----
    MooseX::AttributeHelpers [requires]
Running make test
  Delayed until after prerequisites
Running make install
  Delayed until after prerequisites
Running install for module 'MooseX::AttributeHelpers'
Running make for D/DR/DROLSKY/MooseX-AttributeHelpers-0.23.tar.gz
Checksum for /root/.cpan/sources/authors/id/D/DR/DROLSKY/MooseX-AttributeHelpers-0.23.tar.gz ok

  CPAN.pm: Building D/DR/DROLSKY/MooseX-AttributeHelpers-0.23.tar.gz

Cannot determine perl version info from lib/MooseX/AttributeHelpers.pm
Checking if your kit is complete...
Looks good
Writing Makefile for MooseX::AttributeHelpers
Writing MYMETA.yml and MYMETA.json
cp lib/MooseX/AttributeHelpers/MethodProvider/Bag.pm blib/lib/MooseX/AttributeHelpers/MethodProvider/Bag.pm
cp lib/MooseX/AttributeHelpers/Trait/Collection/Bag.pm blib/lib/MooseX/AttributeHelpers/Trait/Collection/Bag.pm
cp lib/MooseX/AttributeHelpers/Trait/Collection.pm blib/lib/MooseX/AttributeHelpers/Trait/Collection.pm
cp lib/MooseX/AttributeHelpers.pm blib/lib/MooseX/AttributeHelpers.pm
cp lib/MooseX/AttributeHelpers/Number.pm blib/lib/MooseX/AttributeHelpers/Number.pm
cp lib/MooseX/AttributeHelpers/Meta/Method/Curried.pm blib/lib/MooseX/AttributeHelpers/Meta/Method/Curried.pm
cp lib/MooseX/AttributeHelpers/Trait/String.pm blib/lib/MooseX/AttributeHelpers/Trait/String.pm
cp lib/MooseX/AttributeHelpers/MethodProvider/Hash.pm blib/lib/MooseX/AttributeHelpers/MethodProvider/Hash.pm
cp lib/MooseX/AttributeHelpers/Trait/Collection/Array.pm blib/lib/MooseX/AttributeHelpers/Trait/Collection/Array.pm
cp lib/MooseX/AttributeHelpers/Trait/Number.pm blib/lib/MooseX/AttributeHelpers/Trait/Number.pm
cp lib/MooseX/AttributeHelpers/Trait/Bool.pm blib/lib/MooseX/AttributeHelpers/Trait/Bool.pm
cp lib/MooseX/AttributeHelpers/Trait/Collection/List.pm blib/lib/MooseX/AttributeHelpers/Trait/Collection/List.pm
cp lib/MooseX/AttributeHelpers/MethodProvider/String.pm blib/lib/MooseX/AttributeHelpers/MethodProvider/String.pm
cp lib/MooseX/AttributeHelpers/Meta/Method/Provided.pm blib/lib/MooseX/AttributeHelpers/Meta/Method/Provided.pm
cp lib/MooseX/AttributeHelpers/Trait/Collection/Hash.pm blib/lib/MooseX/AttributeHelpers/Trait/Collection/Hash.pm
cp lib/MooseX/AttributeHelpers/MethodProvider/List.pm blib/lib/MooseX/AttributeHelpers/MethodProvider/List.pm
cp lib/MooseX/AttributeHelpers/Collection/Bag.pm blib/lib/MooseX/AttributeHelpers/Collection/Bag.pm
cp lib/MooseX/AttributeHelpers/Bool.pm blib/lib/MooseX/AttributeHelpers/Bool.pm
cp lib/MooseX/AttributeHelpers/Trait/Counter.pm blib/lib/MooseX/AttributeHelpers/Trait/Counter.pm
cp lib/MooseX/AttributeHelpers/Collection/List.pm blib/lib/MooseX/AttributeHelpers/Collection/List.pm
cp lib/MooseX/AttributeHelpers/Collection/Hash.pm blib/lib/MooseX/AttributeHelpers/Collection/Hash.pm
cp lib/MooseX/AttributeHelpers/MethodProvider/Bool.pm blib/lib/MooseX/AttributeHelpers/MethodProvider/Bool.pm
cp lib/MooseX/AttributeHelpers/Trait/Collection/ImmutableHash.pm blib/lib/MooseX/AttributeHelpers/Trait/Collection/ImmutableHash.pm
cp lib/MooseX/AttributeHelpers/Trait/Base.pm blib/lib/MooseX/AttributeHelpers/Trait/Base.pm
cp lib/MooseX/AttributeHelpers/Counter.pm blib/lib/MooseX/AttributeHelpers/Counter.pm
cp lib/MooseX/AttributeHelpers/String.pm blib/lib/MooseX/AttributeHelpers/String.pm
cp lib/MooseX/AttributeHelpers/MethodProvider/Array.pm blib/lib/MooseX/AttributeHelpers/MethodProvider/Array.pm
cp lib/MooseX/AttributeHelpers/Collection/ImmutableHash.pm blib/lib/MooseX/AttributeHelpers/Collection/ImmutableHash.pm
cp lib/MooseX/AttributeHelpers/MethodProvider/Counter.pm blib/lib/MooseX/AttributeHelpers/MethodProvider/Counter.pm
cp lib/MooseX/AttributeHelpers/Collection/Array.pm blib/lib/MooseX/AttributeHelpers/Collection/Array.pm
cp lib/MooseX/AttributeHelpers/MethodProvider/ImmutableHash.pm blib/lib/MooseX/AttributeHelpers/MethodProvider/ImmutableHash.pm
Manifying blib/man3/MooseX::AttributeHelpers::MethodProvider::Bool.3
Manifying blib/man3/MooseX::AttributeHelpers::Collection::Hash.3
Manifying blib/man3/MooseX::AttributeHelpers::MethodProvider::String.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Base.3
Manifying blib/man3/MooseX::AttributeHelpers::MethodProvider::Counter.3
Manifying blib/man3/MooseX::AttributeHelpers::MethodProvider::ImmutableHash.3
Manifying blib/man3/MooseX::AttributeHelpers::MethodProvider::Array.3
Manifying blib/man3/MooseX::AttributeHelpers::Collection::ImmutableHash.3
Manifying blib/man3/MooseX::AttributeHelpers::Collection::Array.3
Manifying blib/man3/MooseX::AttributeHelpers::Meta::Method::Curried.3
Manifying blib/man3/MooseX::AttributeHelpers::MethodProvider::List.3
Manifying blib/man3/MooseX::AttributeHelpers::Collection::List.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Collection::List.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Collection::ImmutableHash.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Counter.3
Manifying blib/man3/MooseX::AttributeHelpers::Collection::Bag.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Collection::Bag.3
Manifying blib/man3/MooseX::AttributeHelpers.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Collection::Hash.3
Manifying blib/man3/MooseX::AttributeHelpers::Meta::Method::Provided.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Collection::Array.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::String.3
Manifying blib/man3/MooseX::AttributeHelpers::Counter.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Bool.3
Manifying blib/man3/MooseX::AttributeHelpers::String.3
Manifying blib/man3/MooseX::AttributeHelpers::Number.3
Manifying blib/man3/MooseX::AttributeHelpers::Bool.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Number.3
Manifying blib/man3/MooseX::AttributeHelpers::MethodProvider::Bag.3
Manifying blib/man3/MooseX::AttributeHelpers::MethodProvider::Hash.3
Manifying blib/man3/MooseX::AttributeHelpers::Trait::Collection.3
  DROLSKY/MooseX-AttributeHelpers-0.23.tar.gz
  /usr/bin/make -- OK
Running make test
PERL_DL_NONLAZY=1 /usr/local/bin/perl "-MExtUtils::Command::MM" "-e" "test_harness(0, 'inc', 'blib/lib', 'blib/arch')" t/*.t
t/000_load.t ................... ok
t/001_basic_counter.t .......... ok
t/002_basic_array.t ............ ok
t/003_basic_hash.t ............. 1/50
#   Failed test '... got the right key value pairs'
#   at t/003_basic_hash.t line 174.
#     Structures begin differing at:
#          $got->[0][0] = 'quantity'
#     $expected->[0][0] = 'xxy'
# Looks like you failed 1 test of 50.
t/003_basic_hash.t ............. Dubious, test returned 1 (wstat 256, 0x100)
Failed 1/50 subtests
t/004_basic_number.t ........... ok
t/005_basic_list.t ............. ok
t/006_basic_bag.t .............. ok
t/007_basic_string.t ........... ok
t/010_array_from_role.t ........ ok
t/011_counter_with_defaults.t .. ok
t/012_basic_bool.t ............. ok
t/020_remove_attribute.t ....... ok
t/100_collection_with_roles.t .. ok
t/201_trait_counter.t .......... ok
t/202_trait_array.t ............ ok
t/203_trait_hash.t ............. ok
t/204_trait_number.t ........... ok
t/205_trait_list.t ............. ok
t/206_trait_bag.t .............. ok
t/207_trait_string.t ........... ok
t/208_trait_bool.t ............. ok
t/pod.t ........................ skipped: Pod tests run only authors
t/pod_coverage.t ............... skipped: Pod tests run only authors

Test Summary Report
-------------------
t/003_basic_hash.t           (Wstat: 256 Tests: 50 Failed: 1)
  Failed test:  49
  Non-zero exit status: 1
Files=23, Tests=568, 10 wallclock secs ( 0.05 usr  0.34 sys +  2.68 cusr  6.30 csys =  9.37 CPU)
Result: FAIL
Failed 1/23 test programs. 1/568 subtests failed.
make: *** [test_dynamic] Error 255
  DROLSKY/MooseX-AttributeHelpers-0.23.tar.gz
  /usr/bin/make test -- NOT OK
//hint// to see the cpan-testers results for installing this module, try:
  reports DROLSKY/MooseX-AttributeHelpers-0.23.tar.gz
Running make install
  make test had returned bad status, won't install without force
Running make for I/IK/IKUTA/Net-RabbitFoot-1.03.tar.gz
  Has already been unwrapped into directory /root/.cpan/build/Net-RabbitFoot-1.03-FdVhhF

  CPAN.pm: Building I/IK/IKUTA/Net-RabbitFoot-1.03.tar.gz

Warning: Prerequisite 'MooseX::AttributeHelpers => 0' for 'IKUTA/Net-RabbitFoot-1.03.tar.gz' failed when processing 'DROLSKY/MooseX-AttributeHelpers-0.23.tar.gz' with 'make_test => NO'. Continuing, but chances to succeed are limited.
cp lib/Net/RabbitFoot/Cmd/Command/declare_exchange.pm blib/lib/Net/RabbitFoot/Cmd/Command/declare_exchange.pm
cp lib/Net/RabbitFoot/Cmd/Command/purge_queue.pm blib/lib/Net/RabbitFoot/Cmd/Command/purge_queue.pm
cp lib/Net/RabbitFoot/Cmd/Role/Command.pm blib/lib/Net/RabbitFoot/Cmd/Role/Command.pm
cp lib/Net/RabbitFoot/Cmd/Role/Config.pm blib/lib/Net/RabbitFoot/Cmd/Role/Config.pm
cp lib/Net/RabbitFoot/Channel.pm blib/lib/Net/RabbitFoot/Channel.pm
cp lib/Net/RabbitFoot.pm blib/lib/Net/RabbitFoot.pm
cp lib/Net/RabbitFoot/Cmd/Command/unbind_queue.pm blib/lib/Net/RabbitFoot/Cmd/Command/unbind_queue.pm
cp lib/Net/RabbitFoot/Cmd/Command/delete_queue.pm blib/lib/Net/RabbitFoot/Cmd/Command/delete_queue.pm
cp lib/Net/RabbitFoot/Cmd/Command/declare_queue.pm blib/lib/Net/RabbitFoot/Cmd/Command/declare_queue.pm
cp lib/Net/RabbitFoot/Cmd/Command/delete_exchange.pm blib/lib/Net/RabbitFoot/Cmd/Command/delete_exchange.pm
cp lib/Net/RabbitFoot/Cmd/Command/bind_queue.pm blib/lib/Net/RabbitFoot/Cmd/Command/bind_queue.pm
cp lib/Net/RabbitFoot/Cmd.pm blib/lib/Net/RabbitFoot/Cmd.pm
cp rabbit_foot blib/script/rabbit_foot
/usr/local/bin/perl "-Iinc" -MExtUtils::MY -e 'MY->fixin(shift)' -- blib/script/rabbit_foot
Manifying blib/man3/Net::RabbitFoot.3
  IKUTA/Net-RabbitFoot-1.03.tar.gz
  /usr/bin/make -- OK
Running make test
PERL_DL_NONLAZY=1 /usr/local/bin/perl "-MExtUtils::Command::MM" "-e" "test_harness(0, 'inc', 'blib/lib', 'blib/arch')" t/*.t
t/00_compile.t ..... ok
t/01_localqueue.t .. ok
All tests successful.
Files=2, Tests=22,  1 wallclock secs ( 0.01 usr  0.05 sys +  0.27 cusr  0.62 csys =  0.95 CPU)
Result: PASS
  IKUTA/Net-RabbitFoot-1.03.tar.gz
Tests succeeded but one dependency not OK (MooseX::AttributeHelpers)
  IKUTA/Net-RabbitFoot-1.03.tar.gz
  [dependencies] -- NA
Running make install
  make test had returned bad status, won't install without force
Failed during this command:
 DROLSKY/MooseX-AttributeHelpers-0.23.tar.gz  : make_test NO
 IKUTA/Net-RabbitFoot-1.03.tar.gz             : make_test NO one dependency not OK (MooseX::AttributeHelpers)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/db3078b4/attachment.htm>

From rbxbxdev at gmail.com  Mon Aug 12 16:52:21 2013
From: rbxbxdev at gmail.com (Robert Pitts)
Date: Mon, 12 Aug 2013 08:52:21 -0700 (PDT)
Subject: [rabbitmq-discuss] ANN RabbitMQ tutorials ported to Clojure
In-Reply-To: <CAE3HoVR8HFXkaY_jS=4OxJZPVN+O0nq_pzJkuUfesxV45hN3xQ@mail.gmail.com>
References: <CAE3HoVR8HFXkaY_jS=4OxJZPVN+O0nq_pzJkuUfesxV45hN3xQ@mail.gmail.com>
Message-ID: <211f7620-092a-498d-9e7b-b367cffe0da0@googlegroups.com>

This is awesome, thanks for your efforts!

Wish this was around a few months ago, but I imagine people will be well 
served by it in the future :)

On Monday, August 12, 2013 2:15:20 AM UTC-4, Michael Klishin wrote:
>
> I'm happy to announce that 5 out of 6 RabbitMQ tutorials [1] are now 
> available
> for Clojure:
>
> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/clojure
>
> and are tested for interoperability with 9 other clients. The final 
> tutorial will be
> ported at a later point.
>
> 1. http://www.rabbitmq.com/getstarted.html
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/f0025106/attachment.htm>

From mklishin at gopivotal.com  Mon Aug 12 19:18:18 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 12 Aug 2013 22:18:18 +0400
Subject: [rabbitmq-discuss] ANN RabbitMQ tutorials ported to Clojure
In-Reply-To: <211f7620-092a-498d-9e7b-b367cffe0da0@googlegroups.com>
References: <CAE3HoVR8HFXkaY_jS=4OxJZPVN+O0nq_pzJkuUfesxV45hN3xQ@mail.gmail.com>
	<211f7620-092a-498d-9e7b-b367cffe0da0@googlegroups.com>
Message-ID: <2B6409B2-0904-4B58-B278-E3AA65A3B91B@gopivotal.com>

Robert Pitts:

> Wish this was around a few months ago, but I imagine people will be well served by it in the future :)

FWIW, Langohr itself has a pretty great Getting Started guide and mostly complete
documentation in general: http://clojurerabbitmq.info, so porting tutorials was a relatively
low priority issue.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/ae6d4573/attachment.pgp>

From bill.ross at xoom.com  Mon Aug 12 19:38:40 2013
From: bill.ross at xoom.com (Bill Ross)
Date: Mon, 12 Aug 2013 18:38:40 +0000
Subject: [rabbitmq-discuss] RabbitMQ server/broker Windows7 nodedown
	and	running
In-Reply-To: <783FA4BF1E34684F92DB6194019A87630D3086@ORD2MBX03D.mex05.mlsrvr.com>
References: <783FA4BF1E34684F92DB6194019A87630D3086@ORD2MBX03D.mex05.mlsrvr.com>
Message-ID: <783FA4BF1E34684F92DB6194019A87630D317F@ORD2MBX03D.mex05.mlsrvr.com>

A remove/reinstall fixed it.


From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Bill Ross
Sent: Monday, August 12, 2013 10:10 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] RabbitMQ server/broker Windows7 nodedown and running

It looks like I might still have a server running from my Windows install of RabbitMQ, but I don't see it in the process monitor, and can't connect to it with rabbitmqctl or restart. The cookie hash in the server log differs vs. the command output. With nothing to kill and a busted stop cmd, not sure what to do. When I reboot, the logs show lots of crash activity, and the server/broker is restarted with the same hash:

$ grep cookie rabbit at FLEETWOODMAC.log<mailto:rabbit at FLEETWOODMAC.log>
cookie hash    : DR2p6xlgYrHDplyPdeGbtQ==
cookie hash    : DR2p6xlgYrHDplyPdeGbtQ==

Advice is appreciated.

rabbitmq_server-3.1.3
Windows 7

Thanks,
Bill

************* SERVER STARTUP from install **********************

=INFO REPORT==== 15-Jul-2013::14:18:57 ===
Starting RabbitMQ 3.1.3 on Erlang R16B01
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 15-Jul-2013::14:18:57 ===
node           : rabbit at FLEETWOODMAC
home dir       : C:\Windows
config file(s) : (none)
cookie hash    : DR2p6xlgYrHDplyPdeGbtQ==
log            : C:/Users/Bill Ross/AppData/Roaming/RabbitMQ/log/rabbit at FLEETWOODMAC.log<mailto:Ross/AppData/Roaming/RabbitMQ/log/rabbit at FLEETWOODMAC.log>
sasl log       : C:/Users/Bill Ross/AppData/Roaming/RabbitMQ/log/rabbit at FLEETWOODMAC-sasl.log<mailto:Ross/AppData/Roaming/RabbitMQ/log/rabbit at FLEETWOODMAC-sasl.log>
database dir   : c:/Users/Bill Ross/AppData/Roaming/RabbitMQ/db/rabbit at FLEETWOODMAC-mnesia

=INFO REPORT==== 15-Jul-2013::14:18:57 ===
Limiting to approx 8092 file handles (7280 sockets)

=WARNING REPORT==== 15-Jul-2013::14:19:01 ===
Only 2048MB of 15357MB memory usable due to limited address space.

=INFO REPORT==== 15-Jul-2013::14:19:01 ===
Memory limit set to 819MB of 15357MB total.

=INFO REPORT==== 15-Jul-2013::14:19:01 ===
Disk free limit set to 1000MB

=INFO REPORT==== 15-Jul-2013::14:19:01 ===
Adding vhost '/'

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
Creating user 'guest'

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
Setting user tags for user 'guest' to [administrator]

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
Setting permissions for 'guest' in '/' to '.*', '.*', '.*'

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 15-Jul-2013::14:19:02 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 15-Jul-2013::14:19:02 ===
Server startup complete; 0 plugins started.

=ERROR REPORT==== 9-Aug-2013::16:43:05 ===
** Connection attempt from disallowed node rabbitmqctl461535 at FLEETWOODMAC **

=ERROR REPORT==== 9-Aug-2013::16:44:30 ===
** Connection attempt from disallowed node rabbitmqctl2842093 at FLEETWOODMAC **

=ERROR REPORT==== 9-Aug-2013::16:58:25 ===
** Connection attempt from disallowed node rabbitmqctl174332 at FLEETWOODMAC **
  ...
========================

**************************************
*************************** STOP SERVER

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.1.3\sbin>rabbitmqctl.bat stop
Stopping and halting node rabbit at FLEETWOODMAC ...
Error: unable to connect to node rabbit at FLEETWOODMAC: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at FLEETWOODMAC]

hosts, their running nodes and ports:
- FLEETWOODMAC: [{rabbit,55089},{rabbitmqctl115099,55987}]

current node details:
- node name: rabbitmqctl115099 at FLEETWOODMAC
- home dir: H:\
- cookie hash: VTS0FHv40cXw/uYu5x65Eg==

*************************************
************************   START SERVER

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.1.3\sbin>rabbitmq-server.bat
ERROR: node with name "rabbit" already running on "FLEETWOODMAC"

DIAGNOSTICS
===========

nodes in question: [rabbit at FLEETWOODMAC]

hosts, their running nodes and ports:
- FLEETWOODMAC: [{rabbit,55089},{rabbitmqprelaunch1890276,55882}]

current node details:
- node name: rabbitmqprelaunch1890276 at FLEETWOODMAC
- home dir: H:\
- cookie hash: VTS0FHv40cXw/uYu5x65Eg==


---------------------------------------------------------------------------------

The information transmitted in this email is intended only for the person or entity to which it is addressed, and may contain material confidential to Xoom Corporation, and/or its subsidiary, buyindiaonline.com Inc.  Any review, retransmission, dissemination or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient(s) is prohibited.   If you received this email in error, please contact the sender and delete the material from your files.


---------------------------------------------------------------------------------
The information transmitted in this email is intended only for the person or entity to which it is addressed, and may contain material confidential to Xoom Corporation, and/or its subsidiary, buyindiaonline.com Inc.  Any review, retransmission, dissemination or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient(s) is prohibited.   If you received this email in error, please contact the sender and delete the material from your files.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/028c96a0/attachment.htm>

From morty+rabbitmq at frakir.org  Mon Aug 12 20:25:06 2013
From: morty+rabbitmq at frakir.org (Morty)
Date: Mon, 12 Aug 2013 15:25:06 -0400
Subject: [rabbitmq-discuss] fail upgrade from 3.1.3 to 3.1.4
In-Reply-To: <520386D0.5020705@rabbitmq.com>
References: <CAJaPRW5TB1KHQ8NJWMAiCqmgocC0O8zfa=6kWm-=GaXX0JUA_w@mail.gmail.com>
	<52036B2B.3060902@rabbitmq.com>
	<CAJaPRW6quOB=BH9bUN=u56fcvT7jU0H34xQNbT4RruxVSUtSHw@mail.gmail.com>
	<CAJaPRW6cv_8OiShMrqLYHo2B6nMAL4k3=gE6sFShLyaBgV6ypg@mail.gmail.com>
	<520386D0.5020705@rabbitmq.com>
Message-ID: <20130812192506.GA31857@red-sonja>

On Thu, Aug 08, 2013 at 12:53:52PM +0100, Simon MacMullen wrote:

> It looks like we managed to release a version 3.1.4 which is not
> compatible with other 3.1.x versions in the same cluster. Damn.

You might want to update:

http://www.rabbitmq.com/clustering.html#upgrading

to say that 3.1.4 requires a full cluster restart.

- Morty

From scott_mackay at uhc.com  Mon Aug 12 20:59:33 2013
From: scott_mackay at uhc.com (Mackay, Scott)
Date: Mon, 12 Aug 2013 19:59:33 +0000
Subject: [rabbitmq-discuss] UNSUBSCRIBE
Message-ID: <757373EA1D697D40B7F5A6144AE1C15106BD62@APSWP0838.ms.ds.uhc.com>




Sincerely,


Scott Mackay<http://goto.uhc.com/scottmackay>
Application Frameworks and SDK Services
UHG IT - Software Engineering Services
Phone: (801) 982-3274

EAF.Net Framework Library<http://goto.uhc.com/dotnet/eaflib>
.Net Community of Practice<http://goto.uhc.com/dotnet/cop>


This e-mail, including attachments, may include confidential and/or
proprietary information, and may be used only by the person or entity
to which it is addressed. If the reader of this e-mail is not the intended
recipient or his or her authorized agent, the reader is hereby notified
that any dissemination, distribution or copying of this e-mail is
prohibited. If you have received this e-mail in error, please notify the
sender by replying to this message and delete this e-mail immediately.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/84c0b28b/attachment.htm>

From jeremy at fluxlabs.net  Mon Aug 12 21:08:07 2013
From: jeremy at fluxlabs.net (Jeremy McSpadden)
Date: Mon, 12 Aug 2013 20:08:07 +0000
Subject: [rabbitmq-discuss] UNSUBSCRIBE
In-Reply-To: <757373EA1D697D40B7F5A6144AE1C15106BD62@APSWP0838.ms.ds.uhc.com>
References: <757373EA1D697D40B7F5A6144AE1C15106BD62@APSWP0838.ms.ds.uhc.com>
Message-ID: <63EC8D45-D77E-4988-97C2-426DB04D27E7@fluxlabs.net>

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
Jeremy McSpadden
Flux Labs, Inc | http://www.fluxlabs.net<http://www.fluxlabs.net/> | Endless Solutions
Office : 850-250-5590x101<tel:850-250-5590;101> | Cell : 850-890-2543<tel:850-890-2543> | Fax : 850-254-2955<tel:850-254-2955>

On Aug 12, 2013, at 2:59 PM, "Mackay, Scott" <scott_mackay at uhc.com<mailto:scott_mackay at uhc.com>>
 wrote:




Sincerely,


Scott Mackay<http://goto.uhc.com/scottmackay>
Application Frameworks and SDK Services
UHG IT - Software Engineering Services
Phone: (801) 982-3274

EAF.Net Framework Library<http://goto.uhc.com/dotnet/eaflib>
.Net Community of Practice<http://goto.uhc.com/dotnet/cop>


This e-mail, including attachments, may include confidential and/or
proprietary information, and may be used only by the person or entity
to which it is addressed. If the reader of this e-mail is not the intended
recipient or his or her authorized agent, the reader is hereby notified
that any dissemination, distribution or copying of this e-mail is
prohibited. If you have received this e-mail in error, please notify the
sender by replying to this message and delete this e-mail immediately.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130812/09e89721/attachment.htm>

From sw at swhyte.net  Tue Aug 13 05:44:45 2013
From: sw at swhyte.net (Sean Whyte)
Date: Mon, 12 Aug 2013 22:44:45 -0600
Subject: [rabbitmq-discuss] Configuring SSL when connection is to a load
	balancer
Message-ID: <5209B9BD.1090406@swhyte.net>

I am new to RabbitMQ but have successfully configured a 2 node HA 
cluster and have that part working correctly.
There is a load balancer in front of the nodes that receives connections 
on port 80 and forwards them to the cluster on port 5672. That works.

Now I need to get it working through SSL. We have a company policy where 
all SSL certificates are installed on the load balancer and then the 
decrypted packets are forwarded wherever we want.

We have configured the load balancer to receive encrypted traffic on 
port 443 and forward the decrypted traffic to port 5672 on the rabbitmq 
cluster. Since the traffic will be unencrypted by the time rabbitmq 
receives it, I don't see any reason to configure SSL or use port 5671 on 
the mq server. I have validated this works by running a Tomcat instance 
in place of rabbitmq listening on port 5672, and I can view web pages.

Following the code samples for doing SSL 
(http://www.rabbitmq.com/ssl.html) , I have created test consumer:
         ConnectionFactory factory = new ConnectionFactory();
         factory.setHost(host);
         factory.setPort(443);
         try
         {
             factory.useSslProtocol();
         }
         catch(KeyManagementException | NoSuchAlgorithmException e)
         {
             log.error("Unable to use SSL");
         }

         Channel channel = null;
         Connection connection = null;
         try
         {
             connection = factory.newConnection();
             .
             .
             .
         catch( IOException e )
         {
             log.error( "Unable to establish MQ connection" );
         }
         finally
         {
             close Connection and Channel
         }


When the code gets to 'factory.newConnection()', it always times out. 
With the same code, if I change the port to 80 (and remove the SSL 
specific stuff), it works fine. I have tried all the various 
useSslProtocol methods with their different parameters, but always the 
same timeout result. Not sure what I'm missing.

From mklishin at gopivotal.com  Tue Aug 13 09:04:28 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 Aug 2013 12:04:28 +0400
Subject: [rabbitmq-discuss] Configuring SSL when connection is to a load
	balancer
In-Reply-To: <5209B9BD.1090406@swhyte.net>
References: <5209B9BD.1090406@swhyte.net>
Message-ID: <0B19D27C-F55C-47FC-87DC-49158AE4BCFB@gopivotal.com>

Sean Whyte:

> When the code gets to 'factory.newConnection()', it always times out. With the same code, if I change the port to 80 (and remove the SSL specific stuff), it works fine. I have tried all the various useSslProtocol methods with their different parameters, but always the same timeout result. Not sure what I'm missing.

It may time out because nothing gets forwarded, take a look at your load balancer logs. Inspecting RabbitMQ
logs should reveal if there are any AMQP 0-9-1 connection negotiation issues. Please post
them here if you see any.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/2ecdd9b3/attachment.pgp>

From jandres at omie.es  Tue Aug 13 10:19:37 2013
From: jandres at omie.es (jandres)
Date: Tue, 13 Aug 2013 02:19:37 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
Message-ID: <1376385577026-28750.post@n5.nabble.com>

Hi,

I?m trying to configure rabbit_auth_backend_ldap, but I get this error:

------------------
=INFO REPORT==== 13-Aug-2013::11:01:52 ===
accepting AMQP connection <0.336.0> (194.224.33.160:37051 ->
194.224.33.245:5671)

=ERROR REPORT==== 13-Aug-2013::11:01:57 ===
closing AMQP connection <0.336.0> (194.224.33.160:37051 ->
194.224.33.245:5671):
{handshake_error,starting,0,
                 {amqp_error,access_refused,
                             "PLAIN login refused: rabbit_auth_backend_ldap
failed authenticating XXXXX: \"*connect failed*\"\n",
                             *'connection.start_ok'*}}
------------------

This is my rabbitmq.config file:

------------------
[
  {rabbit, [	
				{ssl_listeners, [5671]},
				{ssl_options, [{cacertfile,"e:/RabbitMQ Server /ssl.ca/ca.cer"},
                    {certfile,"e:/RabbitMQ Server /ssl.crt/apache.pem"},
                    {keyfile,"e:/RabbitMQ Server /ssl.key/apache.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,true},
					{ssl_cert_login_from, common_name},
					{auth_mechanisms, ['EXTERNAL']}]
				},
				{auth_backends, [rabbit_auth_backend_ldap]}
			]},
  {rabbit_auth_backend_ldap,
   [ {servers,               ["ldap-server"]},
     {port,                  389},
	 {other_bind,			 {"userXX", "passwordXX"}},
	 {user_dn_pattern,       "uid=${username}"},
	 {use_ssl,               false},
     {log,                   network}
   ]
  }
].
---------

If this can help, I have an instance of Apache (Httpd) working with that
LDAP server, and I have this in my apache configuration:

              AuthLDAPBindDN  "userXX"
	AuthLDAPBindPassword "passwordXX"

I have tried a lot of things to stablish the connection, but i don't know
why i get the error. Can you help me?


Thank you very much!




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mas at crosscan.com  Tue Aug 13 10:29:35 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Tue, 13 Aug 2013 11:29:35 +0200
Subject: [rabbitmq-discuss] Delay between minority detected and stopped
	server
Message-ID: <5209FC7F.8040909@crosscan.com>

Hi,

we are using rabbitmq 3.1.4 with this bugfix [1] applied.

Playing around with the clustering features i came across the following 
situation.
I killed 2 out of 3 machines from the cluster. As expected the remaining 
machine detected its minority and due to the patch it stopped itself. 
But there was a delay between the minority detection and stopping the 
server as the following log entries show:

=WARNING REPORT==== 13-Aug-2013::11:02:31 ===
Cluster minority status detected - awaiting recovery

=ERROR REPORT==== 13-Aug-2013::11:02:31 ===
Error in process <0.2836.0> on node 'rabbit at rabbit-test-3' with exit 
value: 
{badarg,[{erlang,register,[rabbit_outside_app_process,<0.2836.0>],[]},{rabbit_node_monitor,'-run_outside_applications/1-fun-0-',1,[{fil
e,"src/rabbit_node_monitor.erl"},{line,391}]}]}


=INFO REPORT==== 13-Aug-2013::11:03:46 ===
stopped STOMP TCP Listener on [::]:61613

=INFO REPORT==== 13-Aug-2013::11:03:46 ===
stopped TCP Listener on [::]:5672


Yet i was unable to reproduce this situation again. But still i'm 
worried as i kind of lost confidence in the clustering abilities of 
rabbitmq due to the aforementioned bug (lost messages, lost queues, lost 
HA-policies, you name it)

Anyone able to tell me what went wrong here?

Thanks in advance
   malte


[1] http://hg.rabbitmq.com/rabbitmq-server/rev/be0b06386a8c
--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From simon at rabbitmq.com  Tue Aug 13 12:11:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Aug 2013 12:11:01 +0100
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <1376385577026-28750.post@n5.nabble.com>
References: <1376385577026-28750.post@n5.nabble.com>
Message-ID: <520A1445.4010400@rabbitmq.com>

So your LDAP server is called "ldap-server"? Can you telnet to port 389 
on that server?

Cheers, Simon

On 13/08/2013 10:19AM, jandres wrote:
> Hi,
>
> I?m trying to configure rabbit_auth_backend_ldap, but I get this error:
>
> ------------------
> =INFO REPORT==== 13-Aug-2013::11:01:52 ===
> accepting AMQP connection <0.336.0> (194.224.33.160:37051 ->
> 194.224.33.245:5671)
>
> =ERROR REPORT==== 13-Aug-2013::11:01:57 ===
> closing AMQP connection <0.336.0> (194.224.33.160:37051 ->
> 194.224.33.245:5671):
> {handshake_error,starting,0,
>                   {amqp_error,access_refused,
>                               "PLAIN login refused: rabbit_auth_backend_ldap
> failed authenticating XXXXX: \"*connect failed*\"\n",
>                               *'connection.start_ok'*}}
> ------------------
>
> This is my rabbitmq.config file:
>
> ------------------
> [
>    {rabbit, [	
> 				{ssl_listeners, [5671]},
> 				{ssl_options, [{cacertfile,"e:/RabbitMQ Server /ssl.ca/ca.cer"},
>                      {certfile,"e:/RabbitMQ Server /ssl.crt/apache.pem"},
>                      {keyfile,"e:/RabbitMQ Server /ssl.key/apache.pem"},
>                      {verify,verify_peer},
>                      {fail_if_no_peer_cert,true},
> 					{ssl_cert_login_from, common_name},
> 					{auth_mechanisms, ['EXTERNAL']}]
> 				},
> 				{auth_backends, [rabbit_auth_backend_ldap]}
> 			]},
>    {rabbit_auth_backend_ldap,
>     [ {servers,               ["ldap-server"]},
>       {port,                  389},
> 	 {other_bind,			 {"userXX", "passwordXX"}},
> 	 {user_dn_pattern,       "uid=${username}"},
> 	 {use_ssl,               false},
>       {log,                   network}
>     ]
>    }
> ].
> ---------
>
> If this can help, I have an instance of Apache (Httpd) working with that
> LDAP server, and I have this in my apache configuration:
>
>                AuthLDAPBindDN  "userXX"
> 	AuthLDAPBindPassword "passwordXX"
>
> I have tried a lot of things to stablish the connection, but i don't know
> why i get the error. Can you help me?
>
>
> Thank you very much!
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jandres at omie.es  Tue Aug 13 12:15:35 2013
From: jandres at omie.es (=?utf-8?B?U0FHIC0gSm9uYXRoYW4gQW5kcsOpcw==?=)
Date: Tue, 13 Aug 2013 11:15:35 +0000
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <520A1445.4010400@rabbitmq.com>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A294E@EXCHG01-OM.omel.es>

No,

I changed the server name. In real config file I use the IP of the server.


Thanks,

Jonathan


-----Mensaje original-----
De: Simon MacMullen [mailto:simon at rabbitmq.com] 
Enviado el: martes, 13 de agosto de 2013 13:11
Para: Discussions about RabbitMQ
CC: SAG - Jonathan Andr?s
Asunto: Re: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed

So your LDAP server is called "ldap-server"? Can you telnet to port 389 on that server?

Cheers, Simon

On 13/08/2013 10:19AM, jandres wrote:
> Hi,
>
> I?m trying to configure rabbit_auth_backend_ldap, but I get this error:
>
> ------------------
> =INFO REPORT==== 13-Aug-2013::11:01:52 === accepting AMQP connection 
> <0.336.0> (194.224.33.160:37051 ->
> 194.224.33.245:5671)
>
> =ERROR REPORT==== 13-Aug-2013::11:01:57 === closing AMQP connection 
> <0.336.0> (194.224.33.160:37051 ->
> 194.224.33.245:5671):
> {handshake_error,starting,0,
>                   {amqp_error,access_refused,
>                               "PLAIN login refused: 
> rabbit_auth_backend_ldap failed authenticating XXXXX: \"*connect failed*\"\n",
>                               *'connection.start_ok'*}}
> ------------------
>
> This is my rabbitmq.config file:
>
> ------------------
> [
>    {rabbit, [	
> 				{ssl_listeners, [5671]},
> 				{ssl_options, [{cacertfile,"e:/RabbitMQ Server /ssl.ca/ca.cer"},
>                      {certfile,"e:/RabbitMQ Server /ssl.crt/apache.pem"},
>                      {keyfile,"e:/RabbitMQ Server /ssl.key/apache.pem"},
>                      {verify,verify_peer},
>                      {fail_if_no_peer_cert,true},
> 					{ssl_cert_login_from, common_name},
> 					{auth_mechanisms, ['EXTERNAL']}]
> 				},
> 				{auth_backends, [rabbit_auth_backend_ldap]}
> 			]},
>    {rabbit_auth_backend_ldap,
>     [ {servers,               ["ldap-server"]},
>       {port,                  389},
> 	 {other_bind,			 {"userXX", "passwordXX"}},
> 	 {user_dn_pattern,       "uid=${username}"},
> 	 {use_ssl,               false},
>       {log,                   network}
>     ]
>    }
> ].
> ---------
>
> If this can help, I have an instance of Apache (Httpd) working with 
> that LDAP server, and I have this in my apache configuration:
>
>                AuthLDAPBindDN  "userXX"
> 	AuthLDAPBindPassword "passwordXX"
>
> I have tried a lot of things to stablish the connection, but i don't 
> know why i get the error. Can you help me?
>
>
> Thank you very much!
>
>
>
>
> --
> View this message in context: 
> http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect
> -failed-tp28750.html Sent from the RabbitMQ mailing list archive at 
> Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--
Simon MacMullen
RabbitMQ, Pivotal

From jandres at omie.es  Tue Aug 13 12:24:06 2013
From: jandres at omie.es (jandres)
Date: Tue, 13 Aug 2013 04:24:06 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <520A1445.4010400@rabbitmq.com>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>

In my real config file I use the IP of the server.

In the same server, I have an Apache instance that use the same LDAP server to validate the users, so I think the connection between the server and de LDAP is not the problem.

Thank you!


De: Simon MacMullen-2 [via RabbitMQ] [mailto:ml-node+s1065348n28752h74 at n5.nabble.com]
Enviado el: martes, 13 de agosto de 2013 13:13
Para: SAG - Jonathan Andr?s
Asunto: Re: rabbit_auth_backend_ldap connect failed

So your LDAP server is called "ldap-server"? Can you telnet to port 389
on that server?

Cheers, Simon

On 13/08/2013 10:19AM, jandres wrote:

> Hi,
>
> I?m trying to configure rabbit_auth_backend_ldap, but I get this error:
>
> ------------------
> =INFO REPORT==== 13-Aug-2013::11:01:52 ===
> accepting AMQP connection <0.336.0> (194.224.33.160:37051 ->
> 194.224.33.245:5671)
>
> =ERROR REPORT==== 13-Aug-2013::11:01:57 ===
> closing AMQP connection <0.336.0> (194.224.33.160:37051 ->
> 194.224.33.245:5671):
> {handshake_error,starting,0,
>                   {amqp_error,access_refused,
>                               "PLAIN login refused: rabbit_auth_backend_ldap
> failed authenticating XXXXX: \"*connect failed*\"\n",
>                               *'connection.start_ok'*}}
> ------------------
>
> This is my rabbitmq.config file:
>
> ------------------
> [
>    {rabbit, [
> {ssl_listeners, [5671]},
> {ssl_options, [{cacertfile,"e:/RabbitMQ Server /ssl.ca/ca.cer"},
>                      {certfile,"e:/RabbitMQ Server /ssl.crt/apache.pem"},
>                      {keyfile,"e:/RabbitMQ Server /ssl.key/apache.pem"},
>                      {verify,verify_peer},
>                      {fail_if_no_peer_cert,true},
> {ssl_cert_login_from, common_name},
> {auth_mechanisms, ['EXTERNAL']}]
> },
> {auth_backends, [rabbit_auth_backend_ldap]}
> ]},
>    {rabbit_auth_backend_ldap,
>     [ {servers,               ["ldap-server"]},
>       {port,                  389},
> {other_bind, {"userXX", "passwordXX"}},
> {user_dn_pattern,       "uid=${username}"},
> {use_ssl,               false},
>       {log,                   network}
>     ]
>    }
> ].
> ---------
>
> If this can help, I have an instance of Apache (Httpd) working with that
> LDAP server, and I have this in my apache configuration:
>
>                AuthLDAPBindDN  "userXX"
> AuthLDAPBindPassword "passwordXX"
>
> I have tried a lot of things to stablish the connection, but i don't know
> why i get the error. Can you help me?
>
>
> Thank you very much!
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email]</user/SendEmail.jtp?type=node&node=28752&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--
Simon MacMullen
RabbitMQ, Pivotal
_______________________________________________
rabbitmq-discuss mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=28752&i=1>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
If you reply to this email, your message will be added to the discussion below:
http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750p28752.html
To unsubscribe from rabbit_auth_backend_ldap connect failed, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=28750&code=amFuZHJlc0BvbWllLmVzfDI4NzUwfC0xOTA1NTkwNjE3>.
NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750p28754.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/2d107019/attachment.htm>

From emile at rabbitmq.com  Tue Aug 13 14:17:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 13 Aug 2013 14:17:40 +0100
Subject: [rabbitmq-discuss] Net::RabbitFoot - Perl interface described
 on website failing to build
In-Reply-To: <17283a5d-5f5b-42ec-8716-a1452898543b@googlegroups.com>
References: <17283a5d-5f5b-42ec-8716-a1452898543b@googlegroups.com>
Message-ID: <520A31F4.9090104@rabbitmq.com>


Hi Dan,

Thanks for pointing this out.

On 12/08/13 14:49, Dan A wrote:
> The Perl module advocated on the website for use with RabbitMQ, in
> the website's tutorials, Net::RabbitFoot, fails to build on my system.

I can confirm I get the same error on perl 5.18:

#   Failed test '... got the right key value pairs'
#   at t/003_basic_hash.t line 174.
#     Structures begin differing at:
#          $got->[0][0] = 'quantity'
#     $expected->[0][0] = 'xxy'
# Looks like you failed 1 test of 50.

I notice that there is a patch for this problem in the bugreport you
linked, but the better solution is to break dependency on this module.


In addition, Net::AMQP fails to compile on 32bit systems due to "Invalid
type 'Q' in pack" (Net/AMQP/Common.pm line 137). There are potential
workarounds for this using Math::Int64.


Unfortunately it seems that Net::RabbitFoot is unusable on the latest
version of Perl, and on 32bit systems. There are AMQP libraries that do
not depend on MooseX::AttributeHelpers, it may be worth trying those.
Another option is to use an older version of Perl, on a 64bit system.
Net::RabbitFoot is known to work on 5.14.


In the meantime we will update the documentation and attempt to make
contact with the maintainers of the relevant modules.



-Emile





From simon at rabbitmq.com  Tue Aug 13 14:23:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Aug 2013 14:23:22 +0100
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
Message-ID: <520A334A.9030005@rabbitmq.com>

Hmm. Nevertheless, eldap returns "connect failed" when a connection 
can't be established at the TCP / SSL level - before anything LDAPish 
happens. Unfortunately it swallows the real errors in this case, but it 
really does look like a connectivity problem.

Cheers, Simon

On 13/08/2013 12:24PM, jandres wrote:
> In my real config file I use the IP of the server.
>
> In the same server, I have an Apache instance that use the same LDAP
> server to validate the users, so I think the connection between the
> server and de LDAP is not the problem.
>
> Thank you!
>
> *De:*Simon MacMullen-2 [via RabbitMQ] [mailto:ml-node+[hidden email]
> </user/SendEmail.jtp?type=node&node=28754&i=0>]
> *Enviado el:* martes, 13 de agosto de 2013 13:13
> *Para:* SAG - Jonathan Andr?s
> *Asunto:* Re: rabbit_auth_backend_ldap connect failed
>
> So your LDAP server is called "ldap-server"? Can you telnet to port 389
> on that server?
>
> Cheers, Simon
>
> On 13/08/2013 10:19AM, jandres wrote:
>
>
>  > Hi,
>  >
>  > I?m trying to configure rabbit_auth_backend_ldap, but I get this error:
>  >
>  > ------------------
>  > =INFO REPORT==== 13-Aug-2013::11:01:52 ===
>  > accepting AMQP connection <0.336.0> (194.224.33.160:37051 ->
>  > 194.224.33.245:5671)
>  >
>  > =ERROR REPORT==== 13-Aug-2013::11:01:57 ===
>  > closing AMQP connection <0.336.0> (194.224.33.160:37051 ->
>  > 194.224.33.245:5671):
>  > {handshake_error,starting,0,
>  >                   {amqp_error,access_refused,
>  >                               "PLAIN login refused:
> rabbit_auth_backend_ldap
>  > failed authenticating XXXXX: \"*connect failed*\"\n",
>  >                               *'connection.start_ok'*}}
>  > ------------------
>  >
>  > This is my rabbitmq.config file:
>  >
>  > ------------------
>  > [
>  >    {rabbit, [
>  > {ssl_listeners, [5671]},
>  > {ssl_options, [{cacertfile,"e:/RabbitMQ Server /ssl.ca/ca.cer"},
>  >                      {certfile,"e:/RabbitMQ Server
> /ssl.crt/apache.pem"},
>  >                      {keyfile,"e:/RabbitMQ Server /ssl.key/apache.pem"},
>  >                      {verify,verify_peer},
>  >                      {fail_if_no_peer_cert,true},
>  > {ssl_cert_login_from, common_name},
>  > {auth_mechanisms, ['EXTERNAL']}]
>  > },
>  > {auth_backends, [rabbit_auth_backend_ldap]}
>  > ]},
>  >    {rabbit_auth_backend_ldap,
>  >     [ {servers,               ["ldap-server"]},
>  >       {port,                  389},
>  > {other_bind, {"userXX", "passwordXX"}},
>  > {user_dn_pattern,       "uid=${username}"},
>  > {use_ssl,               false},
>  >       {log,                   network}
>  >     ]
>  >    }
>  > ].
>  > ---------
>  >
>  > If this can help, I have an instance of Apache (Httpd) working with that
>  > LDAP server, and I have this in my apache configuration:
>  >
>  >                AuthLDAPBindDN  "userXX"
>  > AuthLDAPBindPassword "passwordXX"
>  >
>  > I have tried a lot of things to stablish the connection, but i don't
> know
>  > why i get the error. Can you help me?
>  >
>  >
>  > Thank you very much!
>  >
>  >
>  >
>  >
>  > --
>  > View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750.html
>  > Sent from the RabbitMQ mailing list archive at Nabble.com.
>  > _______________________________________________
>  > rabbitmq-discuss mailing list
>  > [hidden email] </user/SendEmail.jtp?type=node&node=28752&i=0>
>  > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] </user/SendEmail.jtp?type=node&node=28752&i=1>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> ------------------------------------------------------------------------
>
> *If you reply to this email, your message will be added to the
> discussion below:*
>
> http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750p28752.html
>
>
> To unsubscribe from rabbit_auth_backend_ldap connect failed, click here.
> NAML
> <http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>
>
>
> ------------------------------------------------------------------------
> View this message in context: RE: rabbit_auth_backend_ldap connect
> failed
> <http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750p28754.html>
> Sent from the RabbitMQ mailing list archive
> <http://rabbitmq.1065348.n5.nabble.com/> at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Aug 13 14:46:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Aug 2013 14:46:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ memory limit and shutting down
In-Reply-To: <5208CD05.3000901@gmail.com>
References: <kua605$vai$1@ger.gmane.org> <5208A25C.1050004@rabbitmq.com>
	<5208A5B1.1060600@gmail.com> <5208BC5E.1000100@rabbitmq.com>
	<5208CD05.3000901@gmail.com>
Message-ID: <520A38A6.8030005@rabbitmq.com>

On 12/08/2013 12:54PM, Nikita Trophimov wrote:
> First case we can control by ourselves (for example, via external
> utility that monitors free resources on the server and stops creating
> new users).
> But what we can do with the second case (resources for messages
> initially was enough, but number of messages has increased)?

The cost per message in the message store index is constant (I think 
about 160 bytes IIRC) so you can make a reasonable guess how much memory 
this will use ahead of time.

The memory details in "rabbitmqctl status" or the management plugin can 
tell you how much of your memory has gone on the message store index.

To keep a limit on the number of messages, you could use fixed length 
queues or TTLs.

http://www.rabbitmq.com/ttl.html
http://www.rabbitmq.com/maxlength.html

> Or is the only way to avoid the situation with Y > X is conducting
> stress testing to understand the hardware requirements?

Well stress testing is always nice. But you should be able to do some 
back of the envelope calculations here.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Aug 13 15:20:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Aug 2013 15:20:14 +0100
Subject: [rabbitmq-discuss] Delay between minority detected and stopped
 server
In-Reply-To: <5209FC7F.8040909@crosscan.com>
References: <5209FC7F.8040909@crosscan.com>
Message-ID: <520A409E.3000006@rabbitmq.com>

Hi.

The "badarg" error you posted is cosmetic, but should probably be fixed. 
It can happen when a node gets two nodedown notifications in rapid 
succession, both of which push it into a minority.

I'm not able to say what happened to make it take that long to pause, 
but be aware that the pause is (nearly) a complete shutdown so it's not 
inconceivable it could take some time. Was there anything in the logs 
between 13-Aug-2013::11:02:31 and 13-Aug-2013::11:03:46?

When you say "the aforementioned bug" which are you talking about?

Cheers, Simon

On 13/08/2013 10:29AM, Malte Schirmacher wrote:
> Hi,
>
> we are using rabbitmq 3.1.4 with this bugfix [1] applied.
>
> Playing around with the clustering features i came across the following
> situation.
> I killed 2 out of 3 machines from the cluster. As expected the remaining
> machine detected its minority and due to the patch it stopped itself.
> But there was a delay between the minority detection and stopping the
> server as the following log entries show:
>
> =WARNING REPORT==== 13-Aug-2013::11:02:31 ===
> Cluster minority status detected - awaiting recovery
>
> =ERROR REPORT==== 13-Aug-2013::11:02:31 ===
> Error in process <0.2836.0> on node 'rabbit at rabbit-test-3' with exit
> value:
> {badarg,[{erlang,register,[rabbit_outside_app_process,<0.2836.0>],[]},{rabbit_node_monitor,'-run_outside_applications/1-fun-0-',1,[{fil
>
> e,"src/rabbit_node_monitor.erl"},{line,391}]}]}
>
>
> =INFO REPORT==== 13-Aug-2013::11:03:46 ===
> stopped STOMP TCP Listener on [::]:61613
>
> =INFO REPORT==== 13-Aug-2013::11:03:46 ===
> stopped TCP Listener on [::]:5672
>
>
> Yet i was unable to reproduce this situation again. But still i'm
> worried as i kind of lost confidence in the clustering abilities of
> rabbitmq due to the aforementioned bug (lost messages, lost queues, lost
> HA-policies, you name it)
>
> Anyone able to tell me what went wrong here?
>
> Thanks in advance
>    malte
>
>
> [1] http://hg.rabbitmq.com/rabbitmq-server/rev/be0b06386a8c
> --
> Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 |
> 58452 Witten | Germany
> Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax:
> +49.2302.28232-09 Geschaeftsfuehrung/Management Board: Philip Lehmann,
> Erwin Berg, Ulrich Kellner
> Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten,
> Commercial Register of the Bochum County Court, HRB 8036
> UST-ID-Nr./VAT-IdNo.: DE234398770
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mas at crosscan.com  Tue Aug 13 16:45:24 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Tue, 13 Aug 2013 17:45:24 +0200
Subject: [rabbitmq-discuss] Delay between minority detected and stopped
 server
In-Reply-To: <520A409E.3000006@rabbitmq.com>
References: <5209FC7F.8040909@crosscan.com> <520A409E.3000006@rabbitmq.com>
Message-ID: <520A5494.7050409@crosscan.com>

On 13/08/13 16:20, Simon MacMullen wrote:
> Hi.

Hi Simon,

> It can happen when a node gets two nodedown notifications in rapid
> succession, both of which push it into a minority.

Shouldn't this behavior be fixed quickly?
Suppose the publisher is running on the same machine as the broker and 
someone pulls the network-cable out of this box.
Then it is pushed into minority instantaneously but would possibly still 
accept messages via 127.0.0.1 leading to inconsistency between the 
mirrored queues what we tried to prevent by using pause_minority...

> I'm not able to say what happened to make it take that long to pause,
> but be aware that the pause is (nearly) a complete shutdown so it's not
> inconceivable it could take some time. Was there anything in the logs
> between 13-Aug-2013::11:02:31 and 13-Aug-2013::11:03:46?

Nope, the log was complete.
While do not know a way ti reproduce this behavior it happend again this 
afternoon and i made sure i still could publish messages via 127.0.0.1 
as this log shows:

=WARNING REPORT==== 13-Aug-2013::13:37:20 ===
Cluster minority status detected - awaiting recovery

=ERROR REPORT==== 13-Aug-2013::13:37:20 ===
Error in process <0.872.0> on node 'rabbit at rabbit-test-1' with exit 
value: 
{badarg,[{erlang,register,[rabbit_outside_app_process,<0.872.0>],[]},{rabbit_node_monitor,'-run_outside_applications/1-fun-0-',1,[{file,"src/rabbit_node_monitor.erl"},{line,391}]}]}


=INFO REPORT==== 13-Aug-2013::13:37:53 ===
accepting AMQP connection <0.989.0> (127.0.0.1:45364 -> 127.0.0.1:5672)

=WARNING REPORT==== 13-Aug-2013::13:38:06 ===
closing AMQP connection <0.989.0> (127.0.0.1:45364 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 13-Aug-2013::13:38:38 ===
stopped STOMP TCP Listener on [::]:61613

=INFO REPORT==== 13-Aug-2013::13:38:38 ===
stopped TCP Listener on 127.0.0.1:5672

=INFO REPORT==== 13-Aug-2013::13:38:38 ===
stopped TCP Listener on 192.168.123.136:5672


Again this log is complete


> When you say "the aforementioned bug" which are you talking about?

I meant the bug fixed by the patch i linked:
http://hg.rabbitmq.com/rabbitmq-server/rev/be0b06386a8c
Its tag suggests it belongs to bug #25700


> Cheers, Simon

>
> On 13/08/2013 10:29AM, Malte Schirmacher wrote:
>> Hi,
>>
>> we are using rabbitmq 3.1.4 with this bugfix [1] applied.
>>
>> Playing around with the clustering features i came across the following
>> situation.
>> I killed 2 out of 3 machines from the cluster. As expected the remaining
>> machine detected its minority and due to the patch it stopped itself.
>> But there was a delay between the minority detection and stopping the
>> server as the following log entries show:
>>
>> =WARNING REPORT==== 13-Aug-2013::11:02:31 ===
>> Cluster minority status detected - awaiting recovery
>>
>> =ERROR REPORT==== 13-Aug-2013::11:02:31 ===
>> Error in process<0.2836.0>  on node 'rabbit at rabbit-test-3' with exit
>> value:
>> {badarg,[{erlang,register,[rabbit_outside_app_process,<0.2836.0>],[]},{rabbit_node_monitor,'-run_outside_applications/1-fun-0-',1,[{fil
>>
>> e,"src/rabbit_node_monitor.erl"},{line,391}]}]}
>>
>>
>> =INFO REPORT==== 13-Aug-2013::11:03:46 ===
>> stopped STOMP TCP Listener on [::]:61613
>>
>> =INFO REPORT==== 13-Aug-2013::11:03:46 ===
>> stopped TCP Listener on [::]:5672
>>
>>
>> Yet i was unable to reproduce this situation again. But still i'm
>> worried as i kind of lost confidence in the clustering abilities of
>> rabbitmq due to the aforementioned bug (lost messages, lost queues, lost
>> HA-policies, you name it)
>>
>> Anyone able to tell me what went wrong here?
>>
>> Thanks in advance
>>     malte
>>
>>
>> [1] http://hg.rabbitmq.com/rabbitmq-server/rev/be0b06386a8c
>> --
>> Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 |
>> 58452 Witten | Germany
>> Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax:
>> +49.2302.28232-09 Geschaeftsfuehrung/Management Board: Philip Lehmann,
>> Erwin Berg, Ulrich Kellner
>> Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten,
>> Commercial Register of the Bochum County Court, HRB 8036
>> UST-ID-Nr./VAT-IdNo.: DE234398770
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From ramviv.123 at gmail.com  Tue Aug 13 17:00:57 2013
From: ramviv.123 at gmail.com (ramviv.123 at gmail.com)
Date: Tue, 13 Aug 2013 09:00:57 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
Message-ID: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>

Hi,

    We are setting up a RabbitMQ env with clustering on the LAN and 
federated on the WAN.  We also intend to use consistent hash on the 
receiver side.  We were able to successfully setup a federated 
configuration with ssl enabled.  But we are having issues trying to setup 
ssl with clusters.  We are using RabbitMQ 3.1.3 with erlang 
version  5.9.3.1.  We have setup the erlang config based on 
http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.   I am able 
connect tru an erlang client server program to send data back and forth and 
so I know the ssl with erlang works.  But when I bring RabbitMQ with 
clusters and take a TCP dump of the packets, the data transfer seem to be 
clear text.  Is there a way to check if the clusters are configured for ssl 
by any other means.  Also, would appreciate if someone can point out what 
am I doing wrong here.  Here is the env file (rabbitmq-env.conf)

SERVER_START_ARGS="-boot /usr/lib64/erlang/releases/R15B03/start_ssl 
-proto_dist inet_tls"
#SERVER_START_ARGS="${SERVER_START_ARGS} -pa 
/usr/lib64/erlang/lib/ssl-5.1.2/ebin"
#SERVER_START_ARGS="${SERVER_START_ARGS} 
/usr/lib64/erlang/lib/asn1-1.8/ebin"
#SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_portprogram_dir 
/usr/lib64/erlang/lib/ssl-5.1.2/ebin"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_cacertfile 
/etc/openssl/all_cacerts.pem"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_certfile 
/etc/openssl/nn-vmrh5/cert.pem"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_keyfile 
/etc/openssl/nn-vmrh5/key.pem"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_verify 1"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
server_fail_if_no_peer_cert true"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
server_secure_renegotiate true"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_cacertfile 
/etc/openssl/all_cacerts.pem"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_certfile 
/etc/openssl/nn-vmrh5/cert.pem"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_keyfile 
/etc/openssl/nn-vmrh5/key.pem"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_verify 1"
SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
client_secure_renegotiate true"
#echo SERVER_START_ARGS: ${SERVER_START_ARGS}

Here is the rabbitmq.config for clustering and ssl option set for other 
modes.


[nn-vmrh5: /etc/rabbitmq]vi rabbitmq.config
[
    {rabbit, [
        {default_vhost, <<"alert">>},
        {tcp_listeners, [5672]},
        {ssl_listeners, [5671]},
        {rabbitmq_tracing, [{username, "guest"}]},
        {cluster_nodes, ['rabbit at nn-vmrh5','rabbit at nn-vmrh5g']},
        {ssl_options, [{cacertfile,"/etc/openssl/all_cacerts.pem"},
                       {certfile,"/etc/openssl/nn-vmrh5/cert.pem"},
                       {keyfile,"/etc/openssl/nn-vmrh5/key.pem"},
                       {verify,verify_peer},
                       {fail_if_no_peer_cert,true}] },
        {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
        {ssl_cert_login_from, common_name},
        {log_levels, [{connection, info}]}
    ] }
].

   Would really appreciate any help on this.

Thanks
Venkat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/18a98126/attachment.htm>

From emile at rabbitmq.com  Tue Aug 13 17:43:17 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 13 Aug 2013 17:43:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
Message-ID: <520A6225.8070009@rabbitmq.com>


Hi,

On 13/08/13 17:00, ramviv.123 at gmail.com wrote:
> We are setting up a RabbitMQ env with clustering on the LAN and 
> federated on the WAN.

> But when I bring RabbitMQ with clusters and take a TCP dump of the
> packets, the data transfer seem to be clear text.


Are you looking at the cluster traffic on an Erlang distribution port or
the federation traffic on port 5672/5671 ? I'm guessing you are seeing
cleartext federation traffic on port 5672. If you want that encrypted
also then set the federated links up to connect over AMQPS.




-Emile




From ramviv.123 at gmail.com  Tue Aug 13 21:45:13 2013
From: ramviv.123 at gmail.com (ramviv.123 at gmail.com)
Date: Tue, 13 Aug 2013 13:45:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Install error erlang not found but is
	installed in Redhat
In-Reply-To: <7e1188a5-2164-4ab9-bd66-d1c46cd51335@googlegroups.com>
References: <7e1188a5-2164-4ab9-bd66-d1c46cd51335@googlegroups.com>
Message-ID: <8836cb14-f16a-4c37-8acf-1e158feeb6fd@googlegroups.com>

Did you try turing off the dependcy check as mentioned in that post?  We 
did ignore that dependency warning and were able to bring up RabbitMQ 
server without any issues.

-Venkat

On Wednesday, August 7, 2013 4:55:37 PM UTC-4, Vijayakumar Ramdoss wrote:
>
> Hi Gurus,
> I have a similar issue 
> https://groups.google.com/forum/#!topic/rabbitmq-discuss/ozPHDL5XW30 which 
> was described by John Beaulaurier
> Any workaround for this issue if we installed the ErLang from the Source. 
>
> Thanks
> Vijay
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/4ff5bd71/attachment.htm>

From morty+rabbitmq at frakir.org  Tue Aug 13 22:20:25 2013
From: morty+rabbitmq at frakir.org (Morty)
Date: Tue, 13 Aug 2013 17:20:25 -0400
Subject: [rabbitmq-discuss] rabbitmq 3.1.4 upgrade lost cluster config
Message-ID: <20130813212025.GA15669@red-sonja>

I had three rabbitmq 3.1.3 two-node (both disc) clusters.  The cluster
config was configured using the configuration file.  They were working
fine.

Then I upgraded to 3.1.4.  I did it by following the "whole cluster"
rules from http://www.rabbitmq.com/clustering.html#upgrading -- took
down the cluster, upgraded the last node, started the upgrade node,
tested the upgrade node, and then upgraded + started the other node.

This worked just fine on the first cluster (development/test) I tried
it on.  On the second cluster, the other node is refusing to start.
Error message: "Node rabbit at rabbitmq91 thinks it's clustered with node
rabbit at rabbitmq92, but rabbit at rabbitmq92 disagrees".  Sure enough,
"rabbitmqctl cluster_status" on rabbitmq92 only lists itself.  This
was working fine before.  I tested by adding vhosts on each node and
verified that they showed up on the other node.

Any idea what's up?

I'm sure I could get this working by deleting the mnesia DB on the
second node, starting it as standalone, and manually joining it to the
cluster.  But that will lose any node-specific data.  So I'd rather
not do that.

- Morty

From ramviv.123 at gmail.com  Tue Aug 13 22:39:53 2013
From: ramviv.123 at gmail.com (ramviv.123 at gmail.com)
Date: Tue, 13 Aug 2013 14:39:53 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
Message-ID: <61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>

We also noticed two other failures.  When we kill the epmd process and 
restart rabbitMQ we see the following error.  

{error_logger,{{2013,8,13},{17,31,53}},"Protocol: ~p: not 
supported~n",["inet_tls"]}

   According to one other thread here, this should go away if we use the 
latest version of erlang, which we are using.  Rabbit MQ also seems to 
recognize the latest version of erlang, when we do rabbitmqctl status. We 
checked this  removing the SSL.configuration.  As mentioned in the ssl 
config guide for erlang, if we uncomment the commented out section of the 
config file below, the RRabbitMQ server would just hang.  I am able to 
connect the WebUI, but I never get the success message on the terminal I 
started the server.  Also, the other node when brought up, times out trying 
to connect to this node.

-Venkat

On Tuesday, August 13, 2013 12:00:57 PM UTC-4, ramvi... at gmail.com wrote:
>
> Hi,
>
>     We are setting up a RabbitMQ env with clustering on the LAN and 
> federated on the WAN.  We also intend to use consistent hash on the 
> receiver side.  We were able to successfully setup a federated 
> configuration with ssl enabled.  But we are having issues trying to setup 
> ssl with clusters.  We are using RabbitMQ 3.1.3 with erlang 
> version  5.9.3.1.  We have setup the erlang config based on 
> http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.   I am able 
> connect tru an erlang client server program to send data back and forth and 
> so I know the ssl with erlang works.  But when I bring RabbitMQ with 
> clusters and take a TCP dump of the packets, the data transfer seem to be 
> clear text.  Is there a way to check if the clusters are configured for ssl 
> by any other means.  Also, would appreciate if someone can point out what 
> am I doing wrong here.  Here is the env file (rabbitmq-env.conf)
>
> SERVER_START_ARGS="-boot /usr/lib64/erlang/releases/R15B03/start_ssl 
> -proto_dist inet_tls"
> #SERVER_START_ARGS="${SERVER_START_ARGS} -pa 
> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
> #SERVER_START_ARGS="${SERVER_START_ARGS} 
> /usr/lib64/erlang/lib/asn1-1.8/ebin"
> #SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_portprogram_dir 
> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_cacertfile 
> /etc/openssl/all_cacerts.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_certfile 
> /etc/openssl/nn-vmrh5/cert.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_keyfile 
> /etc/openssl/nn-vmrh5/key.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_verify 1"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> server_fail_if_no_peer_cert true"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> server_secure_renegotiate true"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_cacertfile 
> /etc/openssl/all_cacerts.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_certfile 
> /etc/openssl/nn-vmrh5/cert.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_keyfile 
> /etc/openssl/nn-vmrh5/key.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_verify 1"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> client_secure_renegotiate true"
> #echo SERVER_START_ARGS: ${SERVER_START_ARGS}
>
> Here is the rabbitmq.config for clustering and ssl option set for other 
> modes.
>
>
> [nn-vmrh5: /etc/rabbitmq]vi rabbitmq.config
> [
>     {rabbit, [
>         {default_vhost, <<"alert">>},
>         {tcp_listeners, [5672]},
>         {ssl_listeners, [5671]},
>         {rabbitmq_tracing, [{username, "guest"}]},
>         {cluster_nodes, ['rabbit at nn-vmrh5','rabbit at nn-vmrh5g']},
>         {ssl_options, [{cacertfile,"/etc/openssl/all_cacerts.pem"},
>                        {certfile,"/etc/openssl/nn-vmrh5/cert.pem"},
>                        {keyfile,"/etc/openssl/nn-vmrh5/key.pem"},
>                        {verify,verify_peer},
>                        {fail_if_no_peer_cert,true}] },
>         {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
>         {ssl_cert_login_from, common_name},
>         {log_levels, [{connection, info}]}
>     ] }
> ].
>
>    Would really appreciate any help on this.
>
> Thanks
> Venkat
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/6c939757/attachment.htm>

From ramviv.123 at gmail.com  Tue Aug 13 22:41:30 2013
From: ramviv.123 at gmail.com (ramviv.123 at gmail.com)
Date: Tue, 13 Aug 2013 14:41:30 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
Message-ID: <87c50ff8-0e6f-48eb-ba4f-afda3448bfa5@googlegroups.com>



On Tuesday, August 13, 2013 12:00:57 PM UTC-4, ramvi... at gmail.com wrote:
>
> Hi,
>
>     We are setting up a RabbitMQ env with clustering on the LAN and 
> federated on the WAN.  We also intend to use consistent hash on the 
> receiver side.  We were able to successfully setup a federated 
> configuration with ssl enabled.  But we are having issues trying to setup 
> ssl with clusters.  We are using RabbitMQ 3.1.3 with erlang 
> version  5.9.3.1.  We have setup the erlang config based on 
> http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.   I am able 
> connect tru an erlang client server program to send data back and forth and 
> so I know the ssl with erlang works.  But when I bring RabbitMQ with 
> clusters and take a TCP dump of the packets, the data transfer seem to be 
> clear text.  Is there a way to check if the clusters are configured for ssl 
> by any other means.  Also, would appreciate if someone can point out what 
> am I doing wrong here.  Here is the env file (rabbitmq-env.conf)
>
> SERVER_START_ARGS="-boot /usr/lib64/erlang/releases/R15B03/start_ssl 
> -proto_dist inet_tls"
> #SERVER_START_ARGS="${SERVER_START_ARGS} -pa 
> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
> #SERVER_START_ARGS="${SERVER_START_ARGS} 
> /usr/lib64/erlang/lib/asn1-1.8/ebin"
> #SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_portprogram_dir 
> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_cacertfile 
> /etc/openssl/all_cacerts.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_certfile 
> /etc/openssl/nn-vmrh5/cert.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_keyfile 
> /etc/openssl/nn-vmrh5/key.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_verify 1"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> server_fail_if_no_peer_cert true"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> server_secure_renegotiate true"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_cacertfile 
> /etc/openssl/all_cacerts.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_certfile 
> /etc/openssl/nn-vmrh5/cert.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_keyfile 
> /etc/openssl/nn-vmrh5/key.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_verify 1"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> client_secure_renegotiate true"
> #echo SERVER_START_ARGS: ${SERVER_START_ARGS}
>
> Here is the rabbitmq.config for clustering and ssl option set for other 
> modes.
>
>
> [nn-vmrh5: /etc/rabbitmq]vi rabbitmq.config
> [
>     {rabbit, [
>         {default_vhost, <<"alert">>},
>         {tcp_listeners, [5672]},
>         {ssl_listeners, [5671]},
>         {rabbitmq_tracing, [{username, "guest"}]},
>         {cluster_nodes, ['rabbit at nn-vmrh5','rabbit at nn-vmrh5g']},
>         {ssl_options, [{cacertfile,"/etc/openssl/all_cacerts.pem"},
>                        {certfile,"/etc/openssl/nn-vmrh5/cert.pem"},
>                        {keyfile,"/etc/openssl/nn-vmrh5/key.pem"},
>                        {verify,verify_peer},
>                        {fail_if_no_peer_cert,true}] },
>         {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
>         {ssl_cert_login_from, common_name},
>         {log_levels, [{connection, info}]}
>     ] }
> ].
>
>    Would really appreciate any help on this.
>
> Thanks
> Venkat
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/9c32f990/attachment.htm>

From alan.antonuk at gmail.com  Wed Aug 14 01:37:31 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 13 Aug 2013 17:37:31 -0700
Subject: [rabbitmq-discuss] ANN: rabbitmq-c v0.4.0 is released
Message-ID: <CAAt2po+qR-4E8x0ScoTABy86cnzbq8N98zQWjpztxQjABp9cPg@mail.gmail.com>

rabbitmq-c is the C-language AMQP client for RabbitMQ

Highlights of new features since v0.3.0

- SSL Support
- Non-blocking amqp_simple_wait_frame()
- Per-channel memory management
- High-level consumer API
- Partial heartbeat support
- many bug fixes
- and more....

The complete ChangeLog can be found:
https://github.com/alanxz/rabbitmq-c/blob/v0.4.0/ChangeLog.md

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/9ada3c92/attachment.htm>

From ramviv.123 at gmail.com  Wed Aug 14 04:01:02 2013
From: ramviv.123 at gmail.com (ramviv.123 at gmail.com)
Date: Tue, 13 Aug 2013 20:01:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
Message-ID: <4a4a16a5-88b6-4a5e-8fda-d9f84949d53d@googlegroups.com>

To clarify on the setup,  we removed federated setup to narrow down the 
cluster issue.  The federated setup is between two sets of clusters, each 
with two nodes on either side of the WAN.  So, when I took the tcp dump it 
was only with the cluster setup and no federatd setup.  I was filtering out 
packets based on the host name of the other cluster hosts, not just by the 
port and analyzing the packets.   We were able to successfully configure 
the federated using AMQPS so we removed the federation configuration. 
 Also, the federation would not be between the two hosts that I am 
analyzing.

-Venkat

On Tuesday, August 13, 2013 12:00:57 PM UTC-4, ramvi... at gmail.com wrote:
>
> Hi,
>
>     We are setting up a RabbitMQ env with clustering on the LAN and 
> federated on the WAN.  We also intend to use consistent hash on the 
> receiver side.  We were able to successfully setup a federated 
> configuration with ssl enabled.  But we are having issues trying to setup 
> ssl with clusters.  We are using RabbitMQ 3.1.3 with erlang 
> version  5.9.3.1.  We have setup the erlang config based on 
> http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.   I am able 
> connect tru an erlang client server program to send data back and forth and 
> so I know the ssl with erlang works.  But when I bring RabbitMQ with 
> clusters and take a TCP dump of the packets, the data transfer seem to be 
> clear text.  Is there a way to check if the clusters are configured for ssl 
> by any other means.  Also, would appreciate if someone can point out what 
> am I doing wrong here.  Here is the env file (rabbitmq-env.conf)
>
> SERVER_START_ARGS="-boot /usr/lib64/erlang/releases/R15B03/start_ssl 
> -proto_dist inet_tls"
> #SERVER_START_ARGS="${SERVER_START_ARGS} -pa 
> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
> #SERVER_START_ARGS="${SERVER_START_ARGS} 
> /usr/lib64/erlang/lib/asn1-1.8/ebin"
> #SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_portprogram_dir 
> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_cacertfile 
> /etc/openssl/all_cacerts.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_certfile 
> /etc/openssl/nn-vmrh5/cert.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_keyfile 
> /etc/openssl/nn-vmrh5/key.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_verify 1"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> server_fail_if_no_peer_cert true"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> server_secure_renegotiate true"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_cacertfile 
> /etc/openssl/all_cacerts.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_certfile 
> /etc/openssl/nn-vmrh5/cert.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_keyfile 
> /etc/openssl/nn-vmrh5/key.pem"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_verify 1"
> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
> client_secure_renegotiate true"
> #echo SERVER_START_ARGS: ${SERVER_START_ARGS}
>
> Here is the rabbitmq.config for clustering and ssl option set for other 
> modes.
>
>
> [nn-vmrh5: /etc/rabbitmq]vi rabbitmq.config
> [
>     {rabbit, [
>         {default_vhost, <<"alert">>},
>         {tcp_listeners, [5672]},
>         {ssl_listeners, [5671]},
>         {rabbitmq_tracing, [{username, "guest"}]},
>         {cluster_nodes, ['rabbit at nn-vmrh5','rabbit at nn-vmrh5g']},
>         {ssl_options, [{cacertfile,"/etc/openssl/all_cacerts.pem"},
>                        {certfile,"/etc/openssl/nn-vmrh5/cert.pem"},
>                        {keyfile,"/etc/openssl/nn-vmrh5/key.pem"},
>                        {verify,verify_peer},
>                        {fail_if_no_peer_cert,true}] },
>         {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
>         {ssl_cert_login_from, common_name},
>         {log_levels, [{connection, info}]}
>     ] }
> ].
>
>    Would really appreciate any help on this.
>
> Thanks
> Venkat
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/631dc640/attachment.htm>

From matthias at rabbitmq.com  Wed Aug 14 05:06:00 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Aug 2013 05:06:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
	<61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
Message-ID: <520B0228.6070203@rabbitmq.com>

On 13/08/13 22:39, ramviv.123 at gmail.com wrote:
> We also noticed two other failures.  When we kill the epmd process and
> restart rabbitMQ we see the following error.
>
> {error_logger,{{2013,8,13},{17,31,53}},"Protocol: ~p: not
> supported~n",["inet_tls"]}
>
>     According to one other thread here, this should go away if we use
> the latest version of erlang, which we are using.

You are *not* using the latest version of Erlang.

You said "We are using RabbitMQ 3.1.3 with erlang version 5.9.3.1.". 
That's R15B03, not R16B01 (the latest).

Matthias.

From utromvecherom at gmail.com  Tue Aug 13 22:58:51 2013
From: utromvecherom at gmail.com (Nicolai G.)
Date: Tue, 13 Aug 2013 14:58:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Content payload structure
Message-ID: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>

Hello!

I try to implement yet another amqp-client (on C++, heavily integrated with 
our base frameworks). And I've come to the point of interpreting the 
content header payload, and I cannot find clear description of the 
relationship between property-flags and property-list. If I got 
F1%b1,F2%b1, ... ,Fn%b0 in property-flags, what *amqp-field sequence I MUST 
expect in property-list?

Can anyone, please, point me on any doc where I can find this information?

Best regards,
Nicolai
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/7fe84cc1/attachment.htm>

From sr.aathithyan at outlook.com  Wed Aug 14 08:52:58 2013
From: sr.aathithyan at outlook.com (Aathithyan SR)
Date: Wed, 14 Aug 2013 07:52:58 +0000
Subject: [rabbitmq-discuss] Reg:Heartbeat Lost Error
Message-ID: <BAY176-W3C2DBC92D30C66A454847EC450@phx.gbl>

Hi,
I am using  perl Net::RabbitFoot  for worker,I am frequently  getting Heartbeat lost error can any one provide me the solution for avoiding Heartbeat lost error thanks in advance
Regards,Aathithyan 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/da783c2e/attachment.htm>

From emile at rabbitmq.com  Wed Aug 14 08:53:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Aug 2013 08:53:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
	<61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
Message-ID: <520B377A.2050000@rabbitmq.com>

On 13/08/13 22:39, ramviv.123 at gmail.com wrote:
> We also noticed two other failures.  When we kill the epmd process

The Erlang distribution infrastructure does not tolerate arbitrary epmd
failures. If the lifetime of the epmd process does not span the
lifetimes of all nodes co-located on the same OS then you will see errors.

Can you explain what kind of failure scenario you are trying to model?




-Emile




From emile at rabbitmq.com  Wed Aug 14 08:59:11 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Aug 2013 08:59:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <4a4a16a5-88b6-4a5e-8fda-d9f84949d53d@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
	<4a4a16a5-88b6-4a5e-8fda-d9f84949d53d@googlegroups.com>
Message-ID: <520B38CF.5000409@rabbitmq.com>

On 14/08/13 04:01, ramviv.123 at gmail.com wrote:
> I was filtering out packets based on the host name of the other
> cluster hosts, not just by the port and analyzing the packets.

You haven't stated which port the cleartext was seen on. Since the
broker is listening on AMQP/5672 you could be observing unencrypted
traffic between the broker and peers. Configure producers and consumers
to connect to the broker with AMQPS on port 5671.



-Emile





From jandres at omie.es  Wed Aug 14 10:09:30 2013
From: jandres at omie.es (jandres)
Date: Wed, 14 Aug 2013 02:09:30 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <520A334A.9030005@rabbitmq.com>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
	<520A334A.9030005@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A2B29@EXCHG01-OM.omel.es>

Thank you again.

I use Microsoft Network Monitor to get the traffic between the server and the LDAP, but I can?t see the traffic of the RabbitMQ LDAP Plugin. I can see the traffic between Apache and the LDAP, but not between RabbitMQ and LDAP.

So, I think I have something wrong in my config file, buy I don?t know what.

Any other ideas?

Thanks!




De: Simon MacMullen-2 [via RabbitMQ] [mailto:ml-node+s1065348n28756h98 at n5.nabble.com]
Enviado el: martes, 13 de agosto de 2013 15:25
Para: SAG - Jonathan Andr?s
Asunto: Re: rabbit_auth_backend_ldap connect failed

Hmm. Nevertheless, eldap returns "connect failed" when a connection
can't be established at the TCP / SSL level - before anything LDAPish
happens. Unfortunately it swallows the real errors in this case, but it
really does look like a connectivity problem.

Cheers, Simon

On 13/08/2013 12:24PM, jandres wrote:

> In my real config file I use the IP of the server.
>
> In the same server, I have an Apache instance that use the same LDAP
> server to validate the users, so I think the connection between the
> server and de LDAP is not the problem.
>
> Thank you!
>
> *De:*Simon MacMullen-2 [via RabbitMQ] [mailto:ml-node+[hidden email]
> </user/SendEmail.jtp?type=node&node=28754&i=0>]
> *Enviado el:* martes, 13 de agosto de 2013 13:13
> *Para:* SAG - Jonathan Andr?s
> *Asunto:* Re: rabbit_auth_backend_ldap connect failed
>
> So your LDAP server is called "ldap-server"? Can you telnet to port 389
> on that server?
>
> Cheers, Simon
>
> On 13/08/2013 10:19AM, jandres wrote:
>
>
>  > Hi,
>  >
>  > I?m trying to configure rabbit_auth_backend_ldap, but I get this error:
>  >
>  > ------------------
>  > =INFO REPORT==== 13-Aug-2013::11:01:52 ===
>  > accepting AMQP connection <0.336.0> (194.224.33.160:37051 ->
>  > 194.224.33.245:5671)
>  >
>  > =ERROR REPORT==== 13-Aug-2013::11:01:57 ===
>  > closing AMQP connection <0.336.0> (194.224.33.160:37051 ->
>  > 194.224.33.245:5671):
>  > {handshake_error,starting,0,
>  >                   {amqp_error,access_refused,
>  >                               "PLAIN login refused:
> rabbit_auth_backend_ldap
>  > failed authenticating XXXXX: \"*connect failed*\"\n",
>  >                               *'connection.start_ok'*}}
>  > ------------------
>  >
>  > This is my rabbitmq.config file:
>  >
>  > ------------------
>  > [
>  >    {rabbit, [
>  > {ssl_listeners, [5671]},
>  > {ssl_options, [{cacertfile,"e:/RabbitMQ Server /ssl.ca/ca.cer"},
>  >                      {certfile,"e:/RabbitMQ Server
> /ssl.crt/apache.pem"},
>  >                      {keyfile,"e:/RabbitMQ Server /ssl.key/apache.pem"},
>  >                      {verify,verify_peer},
>  >                      {fail_if_no_peer_cert,true},
>  > {ssl_cert_login_from, common_name},
>  > {auth_mechanisms, ['EXTERNAL']}]
>  > },
>  > {auth_backends, [rabbit_auth_backend_ldap]}
>  > ]},
>  >    {rabbit_auth_backend_ldap,
>  >     [ {servers,               ["ldap-server"]},
>  >       {port,                  389},
>  > {other_bind, {"userXX", "passwordXX"}},
>  > {user_dn_pattern,       "uid=${username}"},
>  > {use_ssl,               false},
>  >       {log,                   network}
>  >     ]
>  >    }
>  > ].
>  > ---------
>  >
>  > If this can help, I have an instance of Apache (Httpd) working with that
>  > LDAP server, and I have this in my apache configuration:
>  >
>  >                AuthLDAPBindDN  "userXX"
>  > AuthLDAPBindPassword "passwordXX"
>  >
>  > I have tried a lot of things to stablish the connection, but i don't
> know
>  > why i get the error. Can you help me?
>  >
>  >
>  > Thank you very much!
>  >
>  >
>  >
>  >
>  > --
>  > View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750.html
>  > Sent from the RabbitMQ mailing list archive at Nabble.com.
>  > _______________________________________________
>  > rabbitmq-discuss mailing list
>  > [hidden email] </user/SendEmail.jtp?type=node&node=28752&i=0>
>  > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] </user/SendEmail.jtp?type=node&node=28752&i=1>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> ------------------------------------------------------------------------
>
> *If you reply to this email, your message will be added to the
> discussion below:*
>
> http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750p28752.html
>
>
> To unsubscribe from rabbit_auth_backend_ldap connect failed, click here.
> NAML
> <http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>
>
>
> ------------------------------------------------------------------------
> View this message in context: RE: rabbit_auth_backend_ldap connect
> failed
> <http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750p28754.html>
> Sent from the RabbitMQ mailing list archive
> <http://rabbitmq.1065348.n5.nabble.com/> at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email]</user/SendEmail.jtp?type=node&node=28756&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--
Simon MacMullen
RabbitMQ, Pivotal
_______________________________________________
rabbitmq-discuss mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=28756&i=1>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
If you reply to this email, your message will be added to the discussion below:
http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750p28756.html
To unsubscribe from rabbit_auth_backend_ldap connect failed, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=28750&code=amFuZHJlc0BvbWllLmVzfDI4NzUwfC0xOTA1NTkwNjE3>.
NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbit-auth-backend-ldap-connect-failed-tp28750p28775.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/98b7c74b/attachment.htm>

From houxuehua49 at gmail.com  Wed Aug 14 10:13:54 2013
From: houxuehua49 at gmail.com (richmonkey)
Date: Wed, 14 Aug 2013 02:13:54 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster memory alarm blocks producer too long
In-Reply-To: <5204DB73.5060300@rabbitmq.com>
References: <6585d4ed-400d-451f-8dc4-511900bf4e45@googlegroups.com>
	<51C18169.7080108@rabbitmq.com>
	<1371700372306-27507.post@n5.nabble.com>
	<51CBE111.5060905@rabbitmq.com>
	<1373260079251-27877.post@n5.nabble.com>
	<51DA6A45.4020504@rabbitmq.com>
	<1376045624250-28691.post@n5.nabble.com>
	<5204DB73.5060300@rabbitmq.com>
Message-ID: <1376471634886-28776.post@n5.nabble.com>

answer:
1) I used rabbitmq 3.1.1. I will try 3.1.4.
2) I enabled rabbitmq_management plugin. The overview tab show the cluster
status.
3) I am using  cluster&mirror
rabbitmqctl cluster_status output:
Cluster status of node 'rabbit at IDC-019096' ...
[{nodes,[{disc,['rabbit at IDC-019096','rabbit at KVM-019047']}]},
 {running_nodes,['rabbit at KVM-019047','rabbit at IDC-019096']},
 {partitions,[]}]
...done.

rabbitmqctl list_policies output:
Listing policies ...
/	ha-all	.*	{"ha-mode":"all"}	    0
...done.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/cluster-memory-alarm-blocks-producer-too-long-tp27473p28776.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed Aug 14 10:10:20 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 14 Aug 2013 10:10:20 +0100
Subject: [rabbitmq-discuss] Reg:Heartbeat Lost Error
In-Reply-To: <BAY176-W3C2DBC92D30C66A454847EC450@phx.gbl>
References: <BAY176-W3C2DBC92D30C66A454847EC450@phx.gbl>
Message-ID: <520B497C.30109@rabbitmq.com>

On 08/14/2013 08:52 AM, Aathithyan SR wrote:
> Hi,
>
> I am using  perl Net::RabbitFoot  for worker,I am frequently  getting 
> Heartbeat lost error can any one provide me the solution for avoiding 
> Heartbeat lost error thanks in advance
>

I have no idea how Net::RabbitFoot handles AMQP heartbeats, but if 
heartbeats get "lost" then that is indicative of a network connectivity 
problem. You might consider (a) increasing the AMQP heartbeat timeout 
and/or (b) investigating why heartbeats sent over the network to/from 
the broker are getting dropped. Personally I'd start with (b).

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/b093934d/attachment.htm>

From paul.bowsher at gmail.com  Wed Aug 14 10:41:13 2013
From: paul.bowsher at gmail.com (Paul Bowsher)
Date: Wed, 14 Aug 2013 02:41:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
	Rabbit 3.1.4
Message-ID: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>

Hi,

After the upgrade to RabbitMQ 3.1.4 we're seeing a large number of 
linearly-increasing channels which seem to hang around after the connection 
is closed. This doesn't happen on every queue (even those processed by the 
same software), only on a particular queue. The orphaned channels leave 20 
messages (the prefetch count) unacked.

Symptoms:

- Initially, larger than expected consumer count on queue from our 
monitoring
- Stopping all expected consumers on that channel removes the expected 
number of consumers, leaving orphans (700+ at present)
- Each orphaned consumer's channel is reachable using Management tool
- Each connection for the channel is reachable, is in either a "flow" or 
"blocked" state with zero data flow. Timeout is set to 600s (count doesn't 
decrease after 10 minutes)
- Forcing a stuck connection closed through the management interface 
results in a 500:

> The server encountered an error while processing this request:
> {exit,{normal,{gen_server,call,
>                           [<0.16806.1347>,
>                            {shutdown,"Closed via management plugin"},
>                            infinity]}},
>       [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
>        {rabbit_mgmt_wm_connection,delete_resource,2,[]},
>        {webmachine_resource,resource_call,3,[]},
>        {webmachine_resource,do,3,[]},
>        {webmachine_decision_core,resource_call,1,[]},
>        {webmachine_decision_core,decision,1,[]},
>        {webmachine_decision_core,handle_request,2,[]},
>        {rabbit_webmachine,'-makeloop/1-fun-0-',2,[]}]}


- The connection closure does actually succeed, and the count drops. 
- Forcing a normal connection closed still works correctly.
- Doing a netstat on both the client and server shows that the port 
associated with the connection is indeed completely closed, and not in any 
sort of TIME_WAIT or FIN_WAIT state

This issue occurred over the weekend, but as it was unchecked it eventually 
exhausted the server of socket descriptors, and we had to restart RabbitMQ 
to recover. It's happened again over night. We can't see anything in our 
client or server logs that give any indication as to the cause of it. We 
upgraded from 3.1.0 so unfortunately are unable to determine which version 
is responsible for the bug, if indeed it is a bug.

If anyone has seen this behaviour or has any suggestions, please let us 
know. Also, if we can provide any debug data let us know.

Thanks,

Paul Bowsher
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/e9807b5e/attachment.htm>

From mklishin at gopivotal.com  Wed Aug 14 11:48:16 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 14 Aug 2013 14:48:16 +0400
Subject: [rabbitmq-discuss] Reg:Heartbeat Lost Error
In-Reply-To: <BAY176-W3C2DBC92D30C66A454847EC450@phx.gbl>
References: <BAY176-W3C2DBC92D30C66A454847EC450@phx.gbl>
Message-ID: <C8492BD1-E6FD-417B-BEEB-D5087544BB25@gopivotal.com>

Aathithyan SR:

> I am using  perl Net::RabbitFoot  for worker,I am frequently  getting Heartbeat lost error can any one provide me the solution for avoiding Heartbeat lost error thanks in advance

Is this an error from RabbitFoot? If it does not implement heartbeats, you can publish
a dummy message that gets routed nowhere every 20-30 seconds. Clients should reset
heartbeat timers when messages are published.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/fcf22aec/attachment.pgp>

From paul.bowsher at gmail.com  Wed Aug 14 12:09:23 2013
From: paul.bowsher at gmail.com (Paul Bowsher)
Date: Wed, 14 Aug 2013 04:09:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
	Rabbit 3.1.4
In-Reply-To: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
References: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
Message-ID: <dc33396f-988e-4808-8652-04fe37adb889@googlegroups.com>

As an additional piece of information, the cluster consists of two nodes, 
with the queue in question (and indeed all queues) mirrored, with their 
home on node A. All the stuck connections are homed on node A. Consumers 
and publishers connect to either node using a load balancer.

We've just forced our temporary queue (which also started exhibiting the 
same problem) to have node B as its home, and now any workers that attempt 
to consume from node A have an error:

Bunny::NotFound: NOT_FOUND - home node 'rabbit at nodeA' of durable queue 
> 'temp_queue' in vhost '/' is down or inaccessible


Cluster status seems to be ok. Now that we only have consumers on node B, 
we're going to leave it for a while and see if we have any stuck 
connections. We may attempt to split and rejoin node A from the cluster to 
see if it remedies things.


On Wednesday, 14 August 2013 10:41:13 UTC+1, Paul Bowsher wrote:
>
> Hi,
>
> After the upgrade to RabbitMQ 3.1.4 we're seeing a large number of 
> linearly-increasing channels which seem to hang around after the connection 
> is closed. This doesn't happen on every queue (even those processed by the 
> same software), only on a particular queue. The orphaned channels leave 20 
> messages (the prefetch count) unacked.
>
> Symptoms:
>
> - Initially, larger than expected consumer count on queue from our 
> monitoring
> - Stopping all expected consumers on that channel removes the expected 
> number of consumers, leaving orphans (700+ at present)
> - Each orphaned consumer's channel is reachable using Management tool
> - Each connection for the channel is reachable, is in either a "flow" or 
> "blocked" state with zero data flow. Timeout is set to 600s (count doesn't 
> decrease after 10 minutes)
> - Forcing a stuck connection closed through the management interface 
> results in a 500:
>
>> The server encountered an error while processing this request:
>> {exit,{normal,{gen_server,call,
>>                           [<0.16806.1347>,
>>                            {shutdown,"Closed via management plugin"},
>>                            infinity]}},
>>       [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
>>        {rabbit_mgmt_wm_connection,delete_resource,2,[]},
>>        {webmachine_resource,resource_call,3,[]},
>>        {webmachine_resource,do,3,[]},
>>        {webmachine_decision_core,resource_call,1,[]},
>>        {webmachine_decision_core,decision,1,[]},
>>        {webmachine_decision_core,handle_request,2,[]},
>>        {rabbit_webmachine,'-makeloop/1-fun-0-',2,[]}]}
>
>
> - The connection closure does actually succeed, and the count drops. 
> - Forcing a normal connection closed still works correctly.
> - Doing a netstat on both the client and server shows that the port 
> associated with the connection is indeed completely closed, and not in any 
> sort of TIME_WAIT or FIN_WAIT state
>
> This issue occurred over the weekend, but as it was unchecked it 
> eventually exhausted the server of socket descriptors, and we had to 
> restart RabbitMQ to recover. It's happened again over night. We can't see 
> anything in our client or server logs that give any indication as to the 
> cause of it. We upgraded from 3.1.0 so unfortunately are unable to 
> determine which version is responsible for the bug, if indeed it is a bug.
>
> If anyone has seen this behaviour or has any suggestions, please let us 
> know. Also, if we can provide any debug data let us know.
>
> Thanks,
>
> Paul Bowsher
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/638c6f83/attachment.htm>

From Bin.Chen at kla-tencor.com  Wed Aug 14 14:58:52 2013
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Wed, 14 Aug 2013 13:58:52 +0000
Subject: [rabbitmq-discuss] Frequent connection failure with RabbitMQ 3.1.3
Message-ID: <0A9BFCC08BB88444B487C782A14860AC04FAC73C@SN2PRD0310MB359.namprd03.prod.outlook.com>

Hello,

We are using RabbitMQ 3.1.3 with Erlang 16B01 on Windows 2008 Server 64-bit.
We have experienced frequent connection failure sometimes.


From emile at rabbitmq.com  Wed Aug 14 15:14:20 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Aug 2013 15:14:20 +0100
Subject: [rabbitmq-discuss] rabbitmq 3.1.4 upgrade lost cluster config
In-Reply-To: <20130813212025.GA15669@red-sonja>
References: <20130813212025.GA15669@red-sonja>
Message-ID: <520B90BC.1020700@rabbitmq.com>

On 13/08/13 22:20, Morty wrote:
> Any idea what's up?

If you ran the same sequence of steps on different clusters that had
identical configuration then you should get the same result. Either the
clusters did not have the same configuration or the sequence of steps
was different.

Compare the logfiles from the nodes in the first cluster with the
logfiles from the second cluster. The differences should indicate the
cause. Pay close attention to the order of messages of the form

  rabbit on node 'name at host' up/down

Also compare the configurations using "rabbitmqctl environment" on both
clusters and make sure they are the same.



-Emile




From emile at rabbitmq.com  Wed Aug 14 15:38:51 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Aug 2013 15:38:51 +0100
Subject: [rabbitmq-discuss] Frequent connection failure with RabbitMQ
 3.1.3
In-Reply-To: <0A9BFCC08BB88444B487C782A14860AC04FAC73C@SN2PRD0310MB359.namprd03.prod.outlook.com>
References: <0A9BFCC08BB88444B487C782A14860AC04FAC73C@SN2PRD0310MB359.namprd03.prod.outlook.com>
Message-ID: <520B967B.5050905@rabbitmq.com>


Hi,

On 14/08/13 14:58, Chen, Bin wrote:

> connection_closed_abruptly

The AMQP connections are probably not being closed by completing the
protocol shutdown sequence. Check that clients close connections
properly (e.g. using
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.1.3/rabbitmq-dotnet-client-3.1.3-client-htmldoc/html/type-RabbitMQ.Client.IConnection.html#method-M:RabbitMQ.Client.IConnection.Close)


> {inet_error,econnaborted}

There may be a network device sending RST packets.





-Emile





From mcintoshj at gmail.com  Wed Aug 14 16:06:58 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 14 Aug 2013 10:06:58 -0500
Subject: [rabbitmq-discuss] Sudden crash (3.0.2)
Message-ID: <CAD6m6fEyxFkWkZ_DpsRjq+dHhk9UyJoxaTU5p3ZKTC2rvsGdaA@mail.gmail.com>

Got some really funky errors and a sudden crash of my entire cluster.
 Off hand, I'm GUESSING it's a disk error, but I'm not totally sure -
thought I'd see if anyone had any ideas?
Thanks!
Jason


The web ui returns the following:

{error,{error,badarg,
              [{ets,match,[rabbit_registry,{{exchange,'$1'},'$2'}],[]},
               {rabbit_registry,lookup_all,1,[]},
               {rabbit_mgmt_external_stats,list_registry_plugins,2,[]},
               {rabbit_mgmt_wm_overview,to_json,2,[]},
               {webmachine_resource,resource_call,3,[]},
               {webmachine_resource,do,3,[]},
               {webmachine_decision_core,resource_call,1,[]},
               {webmachine_decision_core,decision,1,[]}]}}


In the cluster.log file I see a TON of data and some really odd things like:

  {msg_status,198128,
                               <<8,75,158,13,139,133,182,107,227,74,148,135,78,
                                 181,221,89>>,
                               undefined,true,false,true,true,
                               {message_properties,undefined,true,false}},
                              {msg_status,198127,<<"???V??F??CT?
0k2????I?">>,                  undefined,true,false,true,true,
                               {message_properties,undefined,true,false}},
                              {msg_status,198126,
                               <<207,120,238,6,2,192,31,43,235,1,10,138,104,
                                 207,34,236>>,


=ERROR REPORT==== 14-Aug-2013::09:53:50 ===
** Generic server rabbit_mgmt_external_stats terminating
** Last message in was emit_update
** When Server state == {state,1024}
** Reason for termination ==
** {noproc,{gen_server,call,[rabbit_node_monitor,partitions,infinity]}}

** Reason for termination ==
** {{badmatch,{error,eio}},
    [{file_handle_cache,soft_close,1,[]},
     {file_handle_cache,hard_close,1,[]},
     {file_handle_cache,close,1,[]},
     {rabbit_msg_store,terminate,2,[]},
     {gen_server2,terminate,3,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
** In 'terminate' callback with reason ==
** shutdown




=ERROR REPORT==== 14-Aug-2013::09:53:50 ===
** Generic server msg_store_transient terminating
** Last message in was {'EXIT',<0.238.0>,shutdown}
** When Server state == {msstate,

"/data/rabbitmq/rabbitmq/mnesia/cluster/msg_store_transient",
                            rabbit_msg_store_ets_index,
                            {state,397381,

"/data/rabbitmq/rabbitmq/mnesia/cluster/msg_store_transient"},
                            0,#Ref<0.0.0.1839>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            undefined,0,1271,[],<0.291.0>,401478,393277,
                            405575,409672,
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,48,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},




-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/2032e250/attachment.htm>

From mklishin at gopivotal.com  Wed Aug 14 16:14:27 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 14 Aug 2013 19:14:27 +0400
Subject: [rabbitmq-discuss] Sudden crash (3.0.2)
In-Reply-To: <CAD6m6fEyxFkWkZ_DpsRjq+dHhk9UyJoxaTU5p3ZKTC2rvsGdaA@mail.gmail.com>
References: <CAD6m6fEyxFkWkZ_DpsRjq+dHhk9UyJoxaTU5p3ZKTC2rvsGdaA@mail.gmail.com>
Message-ID: <A390D66B-4C6C-49A7-BAF4-B2047E7B9B79@gopivotal.com>

Jason McIntosh:

> {badmatch,{error,eio}}

I'm far from being an expert on the storage subsystem but this suggests
an EIO error happened when file handle cache tried to close a file.

EIO is ?a generic error code that commonly indicates I/O failure?? [1] on Linux.

1. https://www.usenix.org/legacy/event/fast08/tech/full_papers/gunawi/gunawi.pdf
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/fb3c659d/attachment.pgp>

From simon at rabbitmq.com  Wed Aug 14 16:17:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Aug 2013 16:17:05 +0100
Subject: [rabbitmq-discuss] Sudden crash (3.0.2)
In-Reply-To: <CAD6m6fEyxFkWkZ_DpsRjq+dHhk9UyJoxaTU5p3ZKTC2rvsGdaA@mail.gmail.com>
References: <CAD6m6fEyxFkWkZ_DpsRjq+dHhk9UyJoxaTU5p3ZKTC2rvsGdaA@mail.gmail.com>
Message-ID: <520B9F71.5020101@rabbitmq.com>

On 14/08/13 16:06, Jason McIntosh wrote:
> Got some really funky errors and a sudden crash of my entire cluster.
> Off hand, I'm GUESSING it's a disk error, but I'm not totally sure -
> thought I'd see if anyone had any ideas?

I think you're right.

> ** Reason for termination ==
> ** {{badmatch,{error,eio}},
>      [{file_handle_cache,soft_close,1,[]},
>       {file_handle_cache,hard_close,1,[]},
>       {file_handle_cache,close,1,[]},
>       {rabbit_msg_store,terminate,2,[]},
>       {gen_server2,terminate,3,[]},
>       {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}


eio is I/O error. Reported by the file handle cache that means you're 
seeing errors accessing the disk.

But when you say "sudden crash of my entire cluster" - do you mean a 
disk failure on one node caused failures on other nodes? That would be 
bad! Or were your nodes sharing a disk somehow?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From pavel.kogan at cortica.com  Wed Aug 14 16:40:44 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Wed, 14 Aug 2013 10:40:44 -0500
Subject: [rabbitmq-discuss] Message sending/receiving overhead.
In-Reply-To: <CAKgmDnF6cVFDYFK9Sf4T9q7V5voM_BwpV2GcMY6mnHvawJOxag@mail.gmail.com>
References: <CAABB5w_ceCmrDyG+O6a0APebCN+TEumUqicjLonB410apWkEqQ@mail.gmail.com>
	<CAKgmDnF6cVFDYFK9Sf4T9q7V5voM_BwpV2GcMY6mnHvawJOxag@mail.gmail.com>
Message-ID: <CAABB5w-dr8exCN+5XGvfztz9Zte=ncicuTH4nF9tpuq-6ay5GQ@mail.gmail.com>

Hi Michael,

Thanks for your reply. Sorry didn't answered before, I was on vacation.
Yes I am using prefetch = 100. I am using JAVA and .Net clients. I am not
sure about message size but it should not exceed 100kb.
What I saw in .Net client is that publishing message takes time - indeed
few milliseconds but my whole processing is also few milliseconds.
Moving publishing to separate thread with blocking collection interface
helped a lot. Now I am not sure about polling requests from queue ...

Regards,
   Pavel



On Wed, Jul 31, 2013 at 7:59 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> Hi Pavel,
>
> Have you experimented with prefetch?
>
> Which client are you using and which versions of rabbitmq and erlang.
> Message size is important too, of course.
>
> We use the python pika client in asynch mode and have consistent
> processing times (fetch/process/publish) under 5ms.
>
> In general, we have found event loop based approaches faster than threads,
> esp. on the small (cheap) machines we use in the cloud.
>
> Best regards,
>
> Michael
>
>
> On Wed, Jul 31, 2013 at 6:16 PM, Pavel Kogan <pavel.kogan at cortica.com>wrote:
>
>> Hi all,
>>
>> I have simple subscriber that receives message, process it in single
>> thread and publish response.
>> Processing must be done in single thread (logic limitations) but is very
>> fast (~5ms) so I expect to be able to process 200 requests per second.
>> However publishing response in line with processing slows the things as
>> network latency is considerable (even though it is internal 1Gbit network).
>> To resolve it I moved responses publishing to separate threads (via
>> internal concurrent queue) and it helped.
>> The question is about receiving overhead. Is there any pre-caching of
>> messages or I should also integrate internal concurrent queue for requests
>> too?
>>
>> Many Thanks,
>>    Pavel
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/d01b170e/attachment.htm>

From pavel.kogan at cortica.com  Wed Aug 14 16:42:41 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Wed, 14 Aug 2013 10:42:41 -0500
Subject: [rabbitmq-discuss] Message sending/receiving overhead.
In-Reply-To: <51F9C625.8080303@rabbitmq.com>
References: <CAABB5w_ceCmrDyG+O6a0APebCN+TEumUqicjLonB410apWkEqQ@mail.gmail.com>
	<51F9C625.8080303@rabbitmq.com>
Message-ID: <CAABB5w9vCGY4YX3H-YzMeyfJak31HKtKA3OzxByQE0ovopimAw@mail.gmail.com>

Hi Matthias,

Thanks for your reply. Sorry didn't answered before, I was on vacation.
Maybe it is client issue (.Net) but moving publishing to separate thread
with blocking queue interface helped a lot.

Regards,
   Pavel


On Wed, Jul 31, 2013 at 9:21 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Pavel,
>
>
> On 31/07/13 23:16, Pavel Kogan wrote:
>
>> However publishing response in line with processing slows the things as
>> network latency is considerable (even though it is internal 1Gbit
>> network).
>>
>
> Publishing is an asynchronous operation and therefore should not be
> affected by latency.
>
>  The question is about receiving overhead. Is there any pre-caching of
>> messages [...]?
>>
>
> By default there is an infinite prefetch, i.e. the broker will send
> messages to the client as fast as network speed & server processing
> permits. The number of messages "in flight" that way, more precisely, the
> number of messages that have been sent to the client but not yet
> acknowledged, can be bounded with the basic.qos prefetch setting. See the
> section of "Fair dispatch" in Tutorial #2 (http://www.rabbitmq.com/**
> tutorials/tutorial-two-python.**html<http://www.rabbitmq.com/tutorials/tutorial-two-python.html>
> ).
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/3e8cc2ee/attachment.htm>

From james.r.carr at gmail.com  Wed Aug 14 16:53:21 2013
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 14 Aug 2013 10:53:21 -0500
Subject: [rabbitmq-discuss] Docker Image
Message-ID: <CAJreXKAAmc+9vy7QLqe=TWR3akW-1F=cSQi6xt=gT0dKYp67TA@mail.gmail.com>

For those who are interested in such things, I've pushed out a working
rabbitmq 3.1.4 docker.io image at
https://index.docker.io/u/jamescarr/rabbitmq/.

Feel free to give it a try and let me know what you think!

Thanks,
James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/9208222c/attachment.htm>

From joao.pereira at mobbit.com  Wed Aug 14 17:52:07 2013
From: joao.pereira at mobbit.com (Joao Gomes Pereira)
Date: Wed, 14 Aug 2013 17:52:07 +0100
Subject: [rabbitmq-discuss] rabbit federation is failing
Message-ID: <520BB5B7.2050205@mobbit.com>

Hello
I implemented a rabbit federation to exchange SMS messages between 
diferent servers.
After working fine for some days, one of my nodes (192.168.1.200) just 
stopped working.

We can see some errors in the node log:


=INFO REPORT==== 13-Aug-2013::14:01:31 ===
Federation exchange 'LX' in vhost '/' connected to exchange 'LX' in 
vhost '/' on amqp://94.46.208.100

=ERROR REPORT==== 13-Aug-2013::14:03:46 ===
closing AMQP connection <0.5257.0> (94.46.208.98:45341 -> 
192.168.1.200:5672):
{heartbeat_timeout,running}

=INFO REPORT==== 13-Aug-2013::14:09:27 ===
accepting AMQP connection <0.5960.0> (94.46.208.98:60137 -> 
192.168.1.200:5672)

=ERROR REPORT==== 13-Aug-2013::14:09:27 ===
connection <0.5960.0>, channel 3 - soft error:
{amqp_error,not_found,
             "no exchange 'federation: SMS_System -> 
SMSDriver+Dispatcher-rabbit at insight-DISP-rabbit02 B' in vhost '/'",
             'exchange.delete'}

=INFO REPORT==== 13-Aug-2013::14:09:27 ===
accepting AMQP connection <0.5978.0> (94.46.208.98:20734 -> 
192.168.1.200:5672)

=INFO REPORT==== 13-Aug-2013::14:09:27 ===
closing AMQP connection <0.5978.0> (94.46.208.98:20734 -> 
192.168.1.200:5672)




How can I configure my node to be always federated?

Thanks
regards
Joao Pereira



-- 

From Petr.Gotthard at Honeywell.com  Wed Aug 14 18:55:13 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Wed, 14 Aug 2013 17:55:13 +0000
Subject: [rabbitmq-discuss] How to set trace_on durably?
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D37FF40@FR44EX3005.global.ds.honeywell.com>

Hello,

Is there be a way to durably enable tracing for a given virtual host? Instead calling rabbitmqctl each time the broker is started.

There is a 'trace_vhosts' configuration option, but it is marked as internal. Could I use it somehow?


Thanks,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/5e28017a/attachment.htm>

From morty+rabbitmq at frakir.org  Wed Aug 14 20:17:17 2013
From: morty+rabbitmq at frakir.org (Morty)
Date: Wed, 14 Aug 2013 15:17:17 -0400
Subject: [rabbitmq-discuss] rabbitmq 3.1.4 upgrade lost cluster config
In-Reply-To: <520B90BC.1020700@rabbitmq.com>
References: <20130813212025.GA15669@red-sonja> <520B90BC.1020700@rabbitmq.com>
Message-ID: <20130814191717.GA18453@red-sonja>

On Wed, Aug 14, 2013 at 03:14:20PM +0100, Emile Joubert wrote:

> If you ran the same sequence of steps on different clusters that had
> identical configuration then you should get the same result. Either
> the clusters did not have the same configuration or the sequence of
> steps was different.

We use puppet.  The configurations are templated and enforced to be
identical except for cluster node names, which are different between
clusters.  If a config changes that is only read at server start, such
as /etc/rabbitmq/rabbitmq.config, then rabbitmq is automatically
restarted by puppet.

> Compare the logfiles from the nodes in the first cluster with the
> logfiles from the second cluster. The differences should indicate the
> cause. Pay close attention to the order of messages of the form
> 
>   rabbit on node 'name at host' up/down

The logs aren't helping me.  In particular, the order of "up" and
"down" events is equivalent between the clusters up until the time of
the failure.

> Also compare the configurations using "rabbitmqctl environment" on both
> clusters and make sure they are the same.

They are indeed the same, except for file names (which incorporate the
nodenames) and cluster members (which again incorporate the
nodenames).  If I compensate for the above with suitable perl -pi -e
s/hostname91/hostname11/ stuff, the configs are identical.

This looks to me like a code bug.  A race condition or any number of
other classes of bug could explain why two identically-configured
clusters would exhibit different behavior when run through the same
sequence of operations.

- Morty

From morty+rabbitmq at frakir.org  Wed Aug 14 20:44:21 2013
From: morty+rabbitmq at frakir.org (Morty)
Date: Wed, 14 Aug 2013 15:44:21 -0400
Subject: [rabbitmq-discuss] rabbitmq 3.1.4 upgrade lost cluster config
In-Reply-To: <20130814191717.GA18453@red-sonja>
References: <20130813212025.GA15669@red-sonja> <520B90BC.1020700@rabbitmq.com>
	<20130814191717.GA18453@red-sonja>
Message-ID: <20130814194421.GC15669@red-sonja>

On Wed, Aug 14, 2013 at 03:17:17PM -0400, Morty wrote:

> We use puppet.  The configurations are templated and enforced to be
> identical except for cluster node names, which are different between
> clusters.  If a config changes that is only read at server start, such
> as /etc/rabbitmq/rabbitmq.config, then rabbitmq is automatically
> restarted by puppet.

BTW: the workaround I described earlier worked even better than
expected.  I just moved aside /var/lib/rabbitmq/mnesia and started
rabbitmq.  The node rejoined the cluster immediately and all was good.

I'd prefer to understand the cause of this, or a way to detect
possible impending problems.  In particular, I've got one more cluster
still to upgrade, and it's the most important (left for last, for good
reason!)  And it would be nice to understand this for future
reference.

NB: I've done 3.0.x and 3.1.x upgrades on these three clusters before
without seeing this type of issue.

- Morty

From matthias at rabbitmq.com  Wed Aug 14 21:50:24 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Aug 2013 21:50:24 +0100
Subject: [rabbitmq-discuss] Delay between minority detected and stopped
 server
In-Reply-To: <520A5494.7050409@crosscan.com>
References: <5209FC7F.8040909@crosscan.com> <520A409E.3000006@rabbitmq.com>
	<520A5494.7050409@crosscan.com>
Message-ID: <520BED90.7030403@rabbitmq.com>

Malte,

On 13/08/13 16:45, Malte Schirmacher wrote:
> On 13/08/13 16:20, Simon MacMullen wrote:
>> It can happen when a node gets two nodedown notifications in rapid
>> succession, both of which push it into a minority.
>
> Shouldn't this behavior be fixed quickly?

As Simon explained, the error in the logs is cosmetic, i.e. it doesn't 
affect functionality.

> Suppose the publisher is running on the same machine as the broker and
> someone pulls the network-cable out of this box.
> Then it is pushed into minority instantaneously but would possibly still
> accept messages via 127.0.0.1 leading to inconsistency between the
> mirrored queues what we tried to prevent by using pause_minority...

There is *always* scope for that, since publishing is inherently 
asynchronous, and so is detecting of cluster partitioning.


Regards,

Matthias.

From matthias at rabbitmq.com  Wed Aug 14 21:55:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Aug 2013 21:55:21 +0100
Subject: [rabbitmq-discuss] Content payload structure
In-Reply-To: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>
References: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>
Message-ID: <520BEEB9.1060906@rabbitmq.com>

On 13/08/13 22:58, Nicolai G. wrote:
> I try to implement yet another amqp-client (on C++, heavily integrated
> with our base frameworks). And I've come to the point of interpreting
> the content header payload, and I cannot find clear description of the
> relationship between property-flags and property-list. If I got
> F1%b1,F2%b1, ... ,Fn%b0 in property-flags, what *amqp-field sequence I
> MUST expect in property-list?
>
> Can anyone, please, point me on any doc where I can find this information?

 From AMQP 0-9-1, s 4.2.6.1 "The Content Header"

<quote>
- The property flags are an array of bits that indicate the presence or 
absence of each property value in sequence. The bits are ordered from 
most high to low - bit 15 indicates the first property.

- The property flags can specify more than 16 properties. If the last 
bit (0) is set, this indicates that a further property flags field 
follows. There are many property flags fields as needed.

- The property values are class-specific AMQP data fields.

- Bit properties are indicated ONLY by their respective property flag (1 
or 0) and are never present in the property list.
</quote>

Matthias.

From matthias at rabbitmq.com  Wed Aug 14 22:23:26 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Aug 2013 22:23:26 +0100
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
 Rabbit 3.1.4
In-Reply-To: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
References: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
Message-ID: <520BF54E.1080006@rabbitmq.com>

Paul,

On 14/08/13 10:41, Paul Bowsher wrote:
> After the upgrade to RabbitMQ 3.1.4 we're seeing a large number of
> linearly-increasing channels which seem to hang around after the
> connection is closed.

This is very unlikely to be related to the upgrade...

> - Initially, larger than expected consumer count on queue from our
> monitoring
> - Stopping all expected consumers on that channel removes the expected
> number of consumers, leaving orphans (700+ at present)
> - Each orphaned consumer's channel is reachable using Management tool
> - Each connection for the channel is reachable, is in either a "flow" or
> "blocked" state with zero data flow. Timeout is set to 600s (count
> doesn't decrease after 10 minutes)

The above is all consistent with connections being blocked due to 
resource alarms. Blocked connections do not get closed until they are 
unblocked. Check the server logs for alarm warnings.

> - Forcing a stuck connection closed through the management interface
> results in a 500:
>
>     The server encountered an error while processing this request:
>     {exit,{normal,{gen_server,call,
>                                [<0.16806.1347>,
>                                 {shutdown,"Closed via management plugin"},
>                                 infinity]}},
>            [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
>             {rabbit_mgmt_wm_connection,delete_resource,2,[]},
>             {webmachine_resource,resource_call,3,[]},
>             {webmachine_resource,do,3,[]},
>             {webmachine_decision_core,resource_call,1,[]},
>             {webmachine_decision_core,decision,1,[]},
>             {webmachine_decision_core,handle_request,2,[]},
>             {rabbit_webmachine,'-makeloop/1-fun-0-',2,[]}]}

That looks like a bug. Alas I cannot see anything obviously wrong in the 
code and I cannot reproduce it :( Is this easily reproducible for you?

Regards,

Matthias.

From Bin.Chen at kla-tencor.com  Thu Aug 15 00:26:34 2013
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Wed, 14 Aug 2013 23:26:34 +0000
Subject: [rabbitmq-discuss] Frequent connection failure with RabbitMQ
 3.1.3
In-Reply-To: <520B967B.5050905@rabbitmq.com>
References: <0A9BFCC08BB88444B487C782A14860AC04FAC73C@SN2PRD0310MB359.namprd03.prod.outlook.com>
	<520B967B.5050905@rabbitmq.com>
Message-ID: <0A9BFCC08BB88444B487C782A14860AC04FAE95D@SN2PRD0310MB359.namprd03.prod.outlook.com>

Hi Emile,



The problem happened when connecting to the server.

See the time stamp of the log entries.

The connection is closed abruptly as soon as the server accepted the connection request.

Is this a bug in server?



=INFO REPORT==== 14-Aug-2013::16:21:05 ===

accepting AMQP connection <0.23461.3294> (10.10.0.182:63312 -> 10.10.0.85:5672)



=WARNING REPORT==== 14-Aug-2013::16:21:05 ===

closing AMQP connection <0.23461.3294> (10.10.0.182:63312 -> 10.10.0.85:5672):

connection_closed_abruptly



=INFO REPORT==== 14-Aug-2013::16:21:05 ===

accepting AMQP connection <0.14548.3287> (10.10.0.214:61485 -> 10.10.0.85:5672)



=ERROR REPORT==== 14-Aug-2013::16:21:05 ===

closing AMQP connection <0.14548.3287> (10.10.0.214:61485 -> 10.10.0.85:5672):

{inet_error,econnaborted}







Thanks,

--Bin Chen





-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Wednesday, August 14, 2013 7:39 AM
To: Discussions about RabbitMQ
Cc: Chen, Bin
Subject: Re: [rabbitmq-discuss] Frequent connection failure with RabbitMQ 3.1.3





Hi,



On 14/08/13 14:58, Chen, Bin wrote:



> connection_closed_abruptly



The AMQP connections are probably not being closed by completing the protocol shutdown sequence. Check that clients close connections properly (e.g. using

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.1.3/rabbitmq-dotnet-client-3.1.3-client-htmldoc/html/type-RabbitMQ.Client.IConnection.html#method-M:RabbitMQ.Client.IConnection.Close)





> {inet_error,econnaborted}



There may be a network device sending RST packets.











-Emile










-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/5a8c06d4/attachment.htm>

From mklishin at gopivotal.com  Thu Aug 15 00:33:43 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 Aug 2013 03:33:43 +0400
Subject: [rabbitmq-discuss] Frequent connection failure with RabbitMQ
	3.1.3
In-Reply-To: <0A9BFCC08BB88444B487C782A14860AC04FAE95D@SN2PRD0310MB359.namprd03.prod.outlook.com>
References: <0A9BFCC08BB88444B487C782A14860AC04FAC73C@SN2PRD0310MB359.namprd03.prod.outlook.com>
	<520B967B.5050905@rabbitmq.com>
	<0A9BFCC08BB88444B487C782A14860AC04FAE95D@SN2PRD0310MB359.namprd03.prod.outlook.com>
Message-ID: <EA607E65-E72C-4B88-9800-A03AA4947AC0@gopivotal.com>

Chen, Bin:

> The connection is closed abruptly as soon as the server accepted the connection request.
> Is this a bug in server?

This means your client fails before connection negotiation
finishes due to uncaught exception or similar.

Use Wireshark or similar to see what's being transferred over the wire
between your client and RabbitMQ.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/2b448401/attachment.pgp>

From Bin.Chen at kla-tencor.com  Thu Aug 15 00:43:02 2013
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Wed, 14 Aug 2013 23:43:02 +0000
Subject: [rabbitmq-discuss] Frequent connection failure with
	RabbitMQ	3.1.3
In-Reply-To: <EA607E65-E72C-4B88-9800-A03AA4947AC0@gopivotal.com>
References: <0A9BFCC08BB88444B487C782A14860AC04FAC73C@SN2PRD0310MB359.namprd03.prod.outlook.com>
	<520B967B.5050905@rabbitmq.com>
	<0A9BFCC08BB88444B487C782A14860AC04FAE95D@SN2PRD0310MB359.namprd03.prod.outlook.com>
	<EA607E65-E72C-4B88-9800-A03AA4947AC0@gopivotal.com>
Message-ID: <0A9BFCC08BB88444B487C782A14860AC04FAE98F@SN2PRD0310MB359.namprd03.prod.outlook.com>

Thanks for the information.

More input here:
The problem happened for a period of time, from different clients.
Then the problem is gone by itself.

--Bin Chen

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Wednesday, August 14, 2013 4:34 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Frequent connection failure with RabbitMQ 3.1.3

Chen, Bin:

> The connection is closed abruptly as soon as the server accepted the connection request.
> Is this a bug in server?

This means your client fails before connection negotiation finishes due to uncaught exception or similar.

Use Wireshark or similar to see what's being transferred over the wire between your client and RabbitMQ.
--
MK



From sw at swhyte.net  Thu Aug 15 03:27:52 2013
From: sw at swhyte.net (Sean Whyte)
Date: Wed, 14 Aug 2013 20:27:52 -0600
Subject: [rabbitmq-discuss] Configuring SSL when connection is to a load
 balancer
In-Reply-To: <0B19D27C-F55C-47FC-87DC-49158AE4BCFB@gopivotal.com>
References: <5209B9BD.1090406@swhyte.net>
	<0B19D27C-F55C-47FC-87DC-49158AE4BCFB@gopivotal.com>
Message-ID: <520C3CA8.6070503@swhyte.net>

The RabbitMQ logs showed no information during SSL. Unfortunately, I 
don't control the load balancer and they were sure it was configured 
properly, so I had to eliminate every other possibility.

Long story short, it was the load balancer. Got somebody to reconfigure 
it and now it works.

On 8/13/2013 2:04 AM, Michael Klishin wrote:
> Sean Whyte:
>
>> When the code gets to 'factory.newConnection()', it always times out. With the same code, if I change the port to 80 (and remove the SSL specific stuff), it works fine. I have tried all the various useSslProtocol methods with their different parameters, but always the same timeout result. Not sure what I'm missing.
> It may time out because nothing gets forwarded, take a look at your load balancer logs. Inspecting RabbitMQ
> logs should reveal if there are any AMQP 0-9-1 connection negotiation issues. Please post
> them here if you see any.
> --
> MK
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/026a1948/attachment.htm>

From ramviv.123 at gmail.com  Wed Aug 14 20:33:20 2013
From: ramviv.123 at gmail.com (ramviv.123 at gmail.com)
Date: Wed, 14 Aug 2013 12:33:20 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
	<61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
Message-ID: <6ced32a8-9882-412f-8d1a-4287192549fa@googlegroups.com>

As suggested I tried upgrading the erlang to R16B01 and the rabbitmq server 
to 3.1.4.  Now I am not able to bring up the rabbitmq server.  I tried 
removing the erlang and rabbitmq installs multiple times and still I am 
unable to bring it up. I am not using any custom configuration or env files 
as well.  I tried removing the mnesia directory but did not help either.

# rpm -qa | grep -i esl | more
esl-erlang-R16B01-1.x86_64
]# rpm -qa | grep -i rabbit
rabbitmq-server-3.1.4-1.noarch.  

The startup log has the following error

              Starting broker...

BOOT FAILED
===========

Error description:
   {could_not_start,rabbit,undef}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at itops-dev-164.log
   /var/log/rabbitmq/rabbit at itops-dev-164-sasl.log

{"init terminating in 
do_boot",{rabbit,failure_during_boot,{could_not_start,rabbit,undef}}}^M
^[[60G[^[[0;31mFAILED^[[0;39m]^M

I am attaching rabbit at itops-dev-164-sasl.log file as well



On Tuesday, August 13, 2013 5:39:53 PM UTC-4, ramvi... at gmail.com wrote:
>
> We also noticed two other failures.  When we kill the epmd process and 
> restart rabbitMQ we see the following error.  
>
> {error_logger,{{2013,8,13},{17,31,53}},"Protocol: ~p: not 
> supported~n",["inet_tls"]}
>
>    According to one other thread here, this should go away if we use the 
> latest version of erlang, which we are using.  Rabbit MQ also seems to 
> recognize the latest version of erlang, when we do rabbitmqctl status. We 
> checked this  removing the SSL.configuration.  As mentioned in the ssl 
> config guide for erlang, if we uncomment the commented out section of the 
> config file below, the RRabbitMQ server would just hang.  I am able to 
> connect the WebUI, but I never get the success message on the terminal I 
> started the server.  Also, the other node when brought up, times out trying 
> to connect to this node.
>
> -Venkat
>
> On Tuesday, August 13, 2013 12:00:57 PM UTC-4, ramvi... at gmail.com wrote:
>>
>> Hi,
>>
>>     We are setting up a RabbitMQ env with clustering on the LAN and 
>> federated on the WAN.  We also intend to use consistent hash on the 
>> receiver side.  We were able to successfully setup a federated 
>> configuration with ssl enabled.  But we are having issues trying to setup 
>> ssl with clusters.  We are using RabbitMQ 3.1.3 with erlang 
>> version  5.9.3.1.  We have setup the erlang config based on 
>> http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.   I am able 
>> connect tru an erlang client server program to send data back and forth and 
>> so I know the ssl with erlang works.  But when I bring RabbitMQ with 
>> clusters and take a TCP dump of the packets, the data transfer seem to be 
>> clear text.  Is there a way to check if the clusters are configured for ssl 
>> by any other means.  Also, would appreciate if someone can point out what 
>> am I doing wrong here.  Here is the env file (rabbitmq-env.conf)
>>
>> SERVER_START_ARGS="-boot /usr/lib64/erlang/releases/R15B03/start_ssl 
>> -proto_dist inet_tls"
>> #SERVER_START_ARGS="${SERVER_START_ARGS} -pa 
>> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
>> #SERVER_START_ARGS="${SERVER_START_ARGS} 
>> /usr/lib64/erlang/lib/asn1-1.8/ebin"
>> #SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_portprogram_dir 
>> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_cacertfile 
>> /etc/openssl/all_cacerts.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_certfile 
>> /etc/openssl/nn-vmrh5/cert.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_keyfile 
>> /etc/openssl/nn-vmrh5/key.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_verify 1"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>> server_fail_if_no_peer_cert true"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>> server_secure_renegotiate true"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_cacertfile 
>> /etc/openssl/all_cacerts.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_certfile 
>> /etc/openssl/nn-vmrh5/cert.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_keyfile 
>> /etc/openssl/nn-vmrh5/key.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_verify 1"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>> client_secure_renegotiate true"
>> #echo SERVER_START_ARGS: ${SERVER_START_ARGS}
>>
>> Here is the rabbitmq.config for clustering and ssl option set for other 
>> modes.
>>
>>
>> [nn-vmrh5: /etc/rabbitmq]vi rabbitmq.config
>> [
>>     {rabbit, [
>>         {default_vhost, <<"alert">>},
>>         {tcp_listeners, [5672]},
>>         {ssl_listeners, [5671]},
>>         {rabbitmq_tracing, [{username, "guest"}]},
>>         {cluster_nodes, ['rabbit at nn-vmrh5','rabbit at nn-vmrh5g']},
>>         {ssl_options, [{cacertfile,"/etc/openssl/all_cacerts.pem"},
>>                        {certfile,"/etc/openssl/nn-vmrh5/cert.pem"},
>>                        {keyfile,"/etc/openssl/nn-vmrh5/key.pem"},
>>                        {verify,verify_peer},
>>                        {fail_if_no_peer_cert,true}] },
>>         {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
>>         {ssl_cert_login_from, common_name},
>>         {log_levels, [{connection, info}]}
>>     ] }
>> ].
>>
>>    Would really appreciate any help on this.
>>
>> Thanks
>> Venkat
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/0358a23d/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at itops-dev-164-sasl.log
Type: application/octet-stream
Size: 15552 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/0358a23d/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 1518670 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/0358a23d/attachment-0003.obj>

From ramviv.123 at gmail.com  Wed Aug 14 20:42:29 2013
From: ramviv.123 at gmail.com (ramviv.123 at gmail.com)
Date: Wed, 14 Aug 2013 12:42:29 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
	<61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
Message-ID: <81ea8a73-8747-4b49-9f08-7edec5e5f487@googlegroups.com>

As suggested, I upgraded erlang to R16B01 and RabbitMQ server to 3.1.4.1. 
 After the upgrade the RabbitMQ server does not come up.  I removed any 
custom env or config files as well as the mnesia tables. I also tried 
removing all of the rabbitmq and erlang installs and reinstalling them.  I 
have the following versions on the system

# rpm -qa | grep -i esl | more
esl-erlang-R16B01-1.x86_64
# rpm -qa | grep -i rabbit
rabbitmq-server-3.1.4-1.noarch

The startup_log has the following.

              Starting broker...

BOOT FAILED
===========

Error description:
   {could_not_start,rabbit,undef}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at itops-dev-164.log
   /var/log/rabbitmq/rabbit at itops-dev-164-sasl.log

{"init terminating in 
do_boot",{rabbit,failure_during_boot,{could_not_start,rabbit,undef}}}^M
^[[60G[^[[0;31mFAILED^[[0;39m]^M

   I am also attaching the sasl log and erl_crash.dump.  Would appreciate 
any help in solving this issue.


On Tuesday, August 13, 2013 5:39:53 PM UTC-4, ramvi... at gmail.com wrote:
>
> We also noticed two other failures.  When we kill the epmd process and 
> restart rabbitMQ we see the following error.  
>
> {error_logger,{{2013,8,13},{17,31,53}},"Protocol: ~p: not 
> supported~n",["inet_tls"]}
>
>    According to one other thread here, this should go away if we use the 
> latest version of erlang, which we are using.  Rabbit MQ also seems to 
> recognize the latest version of erlang, when we do rabbitmqctl status. We 
> checked this  removing the SSL.configuration.  As mentioned in the ssl 
> config guide for erlang, if we uncomment the commented out section of the 
> config file below, the RRabbitMQ server would just hang.  I am able to 
> connect the WebUI, but I never get the success message on the terminal I 
> started the server.  Also, the other node when brought up, times out trying 
> to connect to this node.
>
> -Venkat
>
> On Tuesday, August 13, 2013 12:00:57 PM UTC-4, ramvi... at gmail.com wrote:
>>
>> Hi,
>>
>>     We are setting up a RabbitMQ env with clustering on the LAN and 
>> federated on the WAN.  We also intend to use consistent hash on the 
>> receiver side.  We were able to successfully setup a federated 
>> configuration with ssl enabled.  But we are having issues trying to setup 
>> ssl with clusters.  We are using RabbitMQ 3.1.3 with erlang 
>> version  5.9.3.1.  We have setup the erlang config based on 
>> http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.   I am able 
>> connect tru an erlang client server program to send data back and forth and 
>> so I know the ssl with erlang works.  But when I bring RabbitMQ with 
>> clusters and take a TCP dump of the packets, the data transfer seem to be 
>> clear text.  Is there a way to check if the clusters are configured for ssl 
>> by any other means.  Also, would appreciate if someone can point out what 
>> am I doing wrong here.  Here is the env file (rabbitmq-env.conf)
>>
>> SERVER_START_ARGS="-boot /usr/lib64/erlang/releases/R15B03/start_ssl 
>> -proto_dist inet_tls"
>> #SERVER_START_ARGS="${SERVER_START_ARGS} -pa 
>> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
>> #SERVER_START_ARGS="${SERVER_START_ARGS} 
>> /usr/lib64/erlang/lib/asn1-1.8/ebin"
>> #SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_portprogram_dir 
>> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_cacertfile 
>> /etc/openssl/all_cacerts.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_certfile 
>> /etc/openssl/nn-vmrh5/cert.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_keyfile 
>> /etc/openssl/nn-vmrh5/key.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_verify 1"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>> server_fail_if_no_peer_cert true"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>> server_secure_renegotiate true"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_cacertfile 
>> /etc/openssl/all_cacerts.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_certfile 
>> /etc/openssl/nn-vmrh5/cert.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_keyfile 
>> /etc/openssl/nn-vmrh5/key.pem"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_verify 1"
>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>> client_secure_renegotiate true"
>> #echo SERVER_START_ARGS: ${SERVER_START_ARGS}
>>
>> Here is the rabbitmq.config for clustering and ssl option set for other 
>> modes.
>>
>>
>> [nn-vmrh5: /etc/rabbitmq]vi rabbitmq.config
>> [
>>     {rabbit, [
>>         {default_vhost, <<"alert">>},
>>         {tcp_listeners, [5672]},
>>         {ssl_listeners, [5671]},
>>         {rabbitmq_tracing, [{username, "guest"}]},
>>         {cluster_nodes, ['rabbit at nn-vmrh5','rabbit at nn-vmrh5g']},
>>         {ssl_options, [{cacertfile,"/etc/openssl/all_cacerts.pem"},
>>                        {certfile,"/etc/openssl/nn-vmrh5/cert.pem"},
>>                        {keyfile,"/etc/openssl/nn-vmrh5/key.pem"},
>>                        {verify,verify_peer},
>>                        {fail_if_no_peer_cert,true}] },
>>         {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
>>         {ssl_cert_login_from, common_name},
>>         {log_levels, [{connection, info}]}
>>     ] }
>> ].
>>
>>    Would really appreciate any help on this.
>>
>> Thanks
>> Venkat
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/6b15b560/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 1518670 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/6b15b560/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at itops-dev-164-sasl.log
Type: application/octet-stream
Size: 15552 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130814/6b15b560/attachment-0003.obj>

From daniel.bason at telogis.com  Thu Aug 15 04:06:54 2013
From: daniel.bason at telogis.com (Dan_b)
Date: Wed, 14 Aug 2013 20:06:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Many errors in mirrored queues with rabbitmq
	3.1.4
Message-ID: <1376536014078-28801.post@n5.nabble.com>

Hi

We have a Centos 5 server with rabbitmq 3.1.4 and all the queues are
mirrored to a Centos 6 server.  On the Centos6 server with the mirrored
queues we are seeing many errors:

=CRASH REPORT==== 15-Aug-2013::02:52:44 ===
  crasher:
    initial call: gen:init_it/7
    pid: <0.710.0>
    registered_name: delegate_4
    exception exit: {{case_clause,{ok,{<0.1303.0>,#Ref<0.0.0.33680>}}},
                     [{delegate,handle_info,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [delegate_sup,rabbit_sup,<0.604.0>]
    messages: []
    links: [<0.705.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 66062
  neighbours:

=SUPERVISOR REPORT==== 15-Aug-2013::02:52:44 ===
     Supervisor: {local,delegate_sup}
     Context:    child_terminated
     Reason:     {{case_clause,{ok,{<0.1303.0>,#Ref<0.0.0.33680>}}},
                  [{delegate,handle_info,2},
                   {gen_server2,handle_msg,2},
                   {proc_lib,wake_up,3}]}
     Offender:   [{pid,<0.710.0>},
                  {name,4},
                  {mfargs,{delegate,start_link,[4]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]

The erlang version on Centos 6 is R14B-04.2 and on the Centos 5 box it is
R14B-04.1.  We have an identical configuration in another data center but it
is running rabbitmq 3.1.3 and there are no issues so I think it is related
to the current version.  Any help would be greatly appreciated because as it
stands we can't use it (the crashes are causing memory and cpu usage to be
high when placed under load).

Regards
Dan



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Many-errors-in-mirrored-queues-with-rabbitmq-3-1-4-tp28801.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mas at crosscan.com  Thu Aug 15 08:00:50 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Thu, 15 Aug 2013 09:00:50 +0200
Subject: [rabbitmq-discuss] Delay between minority detected and stopped
 server
In-Reply-To: <520BED90.7030403@rabbitmq.com>
References: <5209FC7F.8040909@crosscan.com> <520A409E.3000006@rabbitmq.com>
	<520A5494.7050409@crosscan.com> <520BED90.7030403@rabbitmq.com>
Message-ID: <520C7CA2.4010601@crosscan.com>

On 14/08/13 22:50, Matthias Radestock wrote:
>> Suppose the publisher is running on the same machine as the broker and
>> someone pulls the network-cable out of this box.
>> Then it is pushed into minority instantaneously but would possibly still
>> accept messages via 127.0.0.1 leading to inconsistency between the
>> mirrored queues what we tried to prevent by using pause_minority...
>
> There is *always* scope for that, since publishing is inherently
> asynchronous, and so is detecting of cluster partitioning.

Yet there *must not* be scope for this. There is more then a minute 
delay between the node noticing it's in minority and actually shutting 
down the node. Furthermore there is nothing here to be explained simply 
by saying message delivery is asynchonous as delivering messages was 
startet AFTER the node logged that its in minority.
--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From matthias at rabbitmq.com  Thu Aug 15 08:24:32 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Aug 2013 08:24:32 +0100
Subject: [rabbitmq-discuss] Delay between minority detected and stopped
 server
In-Reply-To: <520C7CA2.4010601@crosscan.com>
References: <5209FC7F.8040909@crosscan.com> <520A409E.3000006@rabbitmq.com>
	<520A5494.7050409@crosscan.com> <520BED90.7030403@rabbitmq.com>
	<520C7CA2.4010601@crosscan.com>
Message-ID: <520C8230.6050403@rabbitmq.com>

Malte,
On 15/08/13 08:00, Malte Schirmacher wrote:
> On 14/08/13 22:50, Matthias Radestock wrote:
>> There is *always* scope for that, since publishing is inherently
>> asynchronous, and so is detecting of cluster partitioning.
>
> Yet there *must not* be scope for this.

It's unavoidable. See below.

> There is more then a minute delay between the node noticing it's in
> minority and actually shutting down the node. Furthermore there is
> nothing here to be explained simply by saying message delivery is
> asynchonous as delivering messages was startet AFTER the node logged
> that its in minority.

The node logs that it is in a minority. Then it shuts down rabbit. That
takes time. Now, we can quibble about *how much* time, but it will
always be a non-zero amount. And during that time the node will still 
happily accept connections and route messages. Plus of course minority 
detection isn't instantaneous either, i.e. there is a time window during 
which the node technically in a minority but hasn't detected that yet.

Matthias.

From utromvecherom at gmail.com  Thu Aug 15 08:24:42 2013
From: utromvecherom at gmail.com (Nicolai G.)
Date: Thu, 15 Aug 2013 00:24:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Content payload structure
In-Reply-To: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>
References: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>
Message-ID: <bc38e924-abb9-4c6d-a4be-744bb8dd196c@googlegroups.com>

I read the spec, and this particular segment I've read very attentively:

From utromvecherom at gmail.com  Thu Aug 15 08:34:16 2013
From: utromvecherom at gmail.com (Nicolai G.)
Date: Thu, 15 Aug 2013 00:34:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Content payload structure
In-Reply-To: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>
References: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>
Message-ID: <7ef0d061-13a0-42fe-a397-0dce4f75b42b@googlegroups.com>

I read the spec, and this particular segment I've read very attentively:

From joshua__lim at hotmail.com  Thu Aug 15 09:03:01 2013
From: joshua__lim at hotmail.com (joshua__lim)
Date: Thu, 15 Aug 2013 01:03:01 -0700 (PDT)
Subject: [rabbitmq-discuss] How to receive STOMP receipt only after the
 consumer has acknowledged the message?
Message-ID: <1376553781942-28808.post@n5.nabble.com>

The producer can request for a receipt when sending through the STOMP
interface (reference: https://www.rabbitmq.com/stomp.html):

SEND
destination:/queue/recipient
receipt:003              
persistent:true    
<empty line compulsory!>
online!
Ctrl-2

At the consumer end, I issue the following:

SUBSCRIBE
destination:/queue/recipient
ack:client-individual
persistent:true       
receipt:001   

What I've noticed from my tests is that the receipt sent is to the producer
right after the broker captures the message.  This receipt is not adequate
for reliable delivery since the message hasn't been sent to the consumer
yet.

I'm trying to figure out if it is possible for the receipt to be sent by the
broker only after the recipient has acknowledged the message?

Better still if it can send multiple receipts during each stage of the
delivery process.

If I've not misread, the documentation on this page shows that it is
possible - https://www.rabbitmq.com/confirms.html

"The broker will confirm messages once:....
... b) has been consumed and, if necessary, acknowledged."

I'll be grateful for any pointers, thank you.  :)



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-receive-STOMP-receipt-only-after-the-consumer-has-acknowledged-the-message-tp28808.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Chris.Nicel at 15below.com  Thu Aug 15 09:19:20 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Thu, 15 Aug 2013 03:19:20 -0500
Subject: [rabbitmq-discuss] Management API and Access control.
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A09@AUSP01VMBX29.collaborationhost.net>

Hi All,

I am looking for some clarification on the access control tags.

We are attempting to use a powershell script to add vhosts and users to our rabbitmq cluster. This is successful when the user is an administrator. As the password needs to be in many different configuration files for the automated deployment we would prefer not to use an administrator user. Is this possible? We have attempted with a user under the management tag to no avail.

Further detail:

We use vhosts to logically separate traffic which is for different customers. Each customers services are configured to use a different username which only has access to their vhost. The automated deployment of a new customer includes creation of the vhost and username. We are migrating customers to a newly created cluster of three nodes. Previous usage has been on a single windows rabbitmq box and vhosts created via the rabbitmqctl command line tool.

Cheers

Chris Nicel
Senior Systems Engineer
15below ltd : 15below Australia pty. ltd.

t:        +44 1273 764230
e:       chris.nicel at 15below.com<mailto:chris.nicel at 15below.com>
w:      15below.com<http://www.15below.com/>
[cid:image001.png at 01CE9998.86396470]       @15below_travel<https://twitter.com/#!/15below_travel>


15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/d0bcc3d0/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 808 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/d0bcc3d0/attachment.png>

From emile at rabbitmq.com  Thu Aug 15 10:07:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 15 Aug 2013 10:07:18 +0100
Subject: [rabbitmq-discuss] Management API and Access control.
In-Reply-To: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A09@AUSP01VMBX29.collaborationhost.net>
References: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A09@AUSP01VMBX29.collaborationhost.net>
Message-ID: <520C9A46.3050208@rabbitmq.com>

On 15/08/13 09:19, Chris Nicel wrote:

> We have attempted with a user under the management tag to no avail.

Only administrators can add vhosts. See
http://www.rabbitmq.com/management.html#permissions

It is also possible to add vhosts using the rabbitmqctl utility.



-Emile




From emile at rabbitmq.com  Thu Aug 15 10:18:52 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 15 Aug 2013 10:18:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <6ced32a8-9882-412f-8d1a-4287192549fa@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
	<61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
	<6ced32a8-9882-412f-8d1a-4287192549fa@googlegroups.com>
Message-ID: <520C9CFC.5080404@rabbitmq.com>

On 14/08/13 20:33, ramviv.123 at gmail.com wrote:
> As suggested I tried upgrading the erlang to R16B01 and the rabbitmq
> server to 3.1.4.  Now I am not able to bring up the rabbitmq server.  I
> tried removing the erlang and rabbitmq installs multiple times 


Make sure you remove the old installations completely before installing
the latest versions.


-Emile







From simon at rabbitmq.com  Thu Aug 15 10:20:47 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Aug 2013 10:20:47 +0100
Subject: [rabbitmq-discuss] Many errors in mirrored queues with rabbitmq
 3.1.4
In-Reply-To: <1376536014078-28801.post@n5.nabble.com>
References: <1376536014078-28801.post@n5.nabble.com>
Message-ID: <520C9D6F.9020408@rabbitmq.com>

Yes, this is a bug in 3.1.4 which we noticed yesterday. Very sorry about 
that. We will be pushing out a 3.1.5 ASAP to address this.

Cheers, Simon

On 15/08/13 04:06, Dan_b wrote:
> Hi
>
> We have a Centos 5 server with rabbitmq 3.1.4 and all the queues are
> mirrored to a Centos 6 server.  On the Centos6 server with the mirrored
> queues we are seeing many errors:
>
> =CRASH REPORT==== 15-Aug-2013::02:52:44 ===
>    crasher:
>      initial call: gen:init_it/7
>      pid: <0.710.0>
>      registered_name: delegate_4
>      exception exit: {{case_clause,{ok,{<0.1303.0>,#Ref<0.0.0.33680>}}},
>                       [{delegate,handle_info,2},
>                        {gen_server2,handle_msg,2},
>                        {proc_lib,wake_up,3}]}
>        in function  gen_server2:terminate/3
>      ancestors: [delegate_sup,rabbit_sup,<0.604.0>]
>      messages: []
>      links: [<0.705.0>]
>      dictionary: []
>      trap_exit: false
>      status: running
>      heap_size: 1597
>      stack_size: 24
>      reductions: 66062
>    neighbours:
>
> =SUPERVISOR REPORT==== 15-Aug-2013::02:52:44 ===
>       Supervisor: {local,delegate_sup}
>       Context:    child_terminated
>       Reason:     {{case_clause,{ok,{<0.1303.0>,#Ref<0.0.0.33680>}}},
>                    [{delegate,handle_info,2},
>                     {gen_server2,handle_msg,2},
>                     {proc_lib,wake_up,3}]}
>       Offender:   [{pid,<0.710.0>},
>                    {name,4},
>                    {mfargs,{delegate,start_link,[4]}},
>                    {restart_type,transient},
>                    {shutdown,4294967295},
>                    {child_type,worker}]
>
> The erlang version on Centos 6 is R14B-04.2 and on the Centos 5 box it is
> R14B-04.1.  We have an identical configuration in another data center but it
> is running rabbitmq 3.1.3 and there are no issues so I think it is related
> to the current version.  Any help would be greatly appreciated because as it
> stands we can't use it (the crashes are causing memory and cpu usage to be
> high when placed under load).
>
> Regards
> Dan
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Many-errors-in-mirrored-queues-with-rabbitmq-3-1-4-tp28801.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From Chris.Nicel at 15below.com  Thu Aug 15 10:29:40 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Thu, 15 Aug 2013 04:29:40 -0500
Subject: [rabbitmq-discuss] Management API and Access control.
In-Reply-To: <520C9A46.3050208@rabbitmq.com>
References: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A09@AUSP01VMBX29.collaborationhost.net>
	<520C9A46.3050208@rabbitmq.com>
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A1E@AUSP01VMBX29.collaborationhost.net>

Hi Emile,

Thanks for the response.

We are using Octopus for auto deployment. We are now running a rabbit cluster on Linux. Unfortunately there is no octopus client for Linux. Due to this we have written a powershell script to use the management http api to create the vhosts.

If this is only possible with an administrator account we will just have to be aware of it.

Cheers

Chris

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: 15 August 2013 10:07
To: Discussions about RabbitMQ
Cc: Chris Nicel
Subject: Re: [rabbitmq-discuss] Management API and Access control.

On 15/08/13 09:19, Chris Nicel wrote:

> We have attempted with a user under the management tag to no avail.

Only administrators can add vhosts. See
http://www.rabbitmq.com/management.html#permissions

It is also possible to add vhosts using the rabbitmqctl utility.



-Emile




 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From matthias at rabbitmq.com  Thu Aug 15 10:33:46 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Aug 2013 10:33:46 +0100
Subject: [rabbitmq-discuss] Content payload structure
In-Reply-To: <bc38e924-abb9-4c6d-a4be-744bb8dd196c@googlegroups.com>
References: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>
	<bc38e924-abb9-4c6d-a4be-744bb8dd196c@googlegroups.com>
Message-ID: <520CA07A.40906@rabbitmq.com>

Nicolai,

On 15/08/13 08:24, Nicolai G. wrote:
> I'm sorry for asking you silly questions. But how it influence on the
> interpretation of binary?

I believe the crucial bit of information you missed is that the fields 
are ordered. As the spec says: "The property flags are an array of bits 
that indicate the presence or absence of each property value *in sequence*."

So, e.g. for basic.publish, content-type is the first field, 
corresponding to bit position 1 in the flags, content-encoding is the 
second field, corresponding to position 2, etc.

> I've looked at other clients implementation. For Ruby I found some tips
> in
> http://rubydoc.info/github/ruby-amqp/amq-protocol/master/AMQ/Protocol/Basic
> <http://rubydoc.info/github/ruby-amqp/amq-protocol/master/AMQ/Protocol/Basic>
> But where these constants came from?
> Are they documented? or it's just peer2peer knowledge?

They are automatically generated from the specification based on the 
above rules.

Matthias.

From matthias at rabbitmq.com  Thu Aug 15 10:36:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Aug 2013 10:36:44 +0100
Subject: [rabbitmq-discuss] Management API and Access control.
In-Reply-To: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A1E@AUSP01VMBX29.collaborationhost.net>
References: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A09@AUSP01VMBX29.collaborationhost.net>
	<520C9A46.3050208@rabbitmq.com>
	<A57B6B00637AF741A9FA2D006B40C3C883C7CE4A1E@AUSP01VMBX29.collaborationhost.net>
Message-ID: <520CA12C.5090606@rabbitmq.com>

Chris,

On 15/08/13 10:29, Chris Nicel wrote:
> If this is only possible with an administrator account we will just
> have to be aware of it.

The administrator permissions Emile was referring to are the *RabbitMQ 
Management* administrator permissions, as per the documentation link he 
posted, i.e....

> Only administrators can add vhosts. See
> http://www.rabbitmq.com/management.html#permissions

That has nothing to do with *Windows* administrator permissions.

Matthias.

From vashi.priyanki at gmail.com  Thu Aug 15 10:44:53 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Thu, 15 Aug 2013 11:44:53 +0200
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
Message-ID: <CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>

Hi Again,

After all the above suggestions, I again try to do my tests with eye on
disk usage, RAM usage and network bandwidth utilization. This has now lead
to many more questions so could anyone please throw some light on them.

1) I have a quite high bandwidth between my client (producer & receiver)
and server. Its around 9.2 Gbps. I have confirmed this by running iperf
utility. But the maximum bandwidth I can reach is only 160 mbps. (I have
pika client and single rabbitmq DISK type)

2) I then also took network traces using wireshark, and what I observed
that the AMQP overhead was quite high then the actual payload. If I send
100 bytes of string then overhead is 300 bytes so for every message of 100
bytes I end up sending 400 bytes on wire.

Since I have publish confirm/ack enabled so I understand part of this but
there is also content header and some overhead in content body as well.
Is this standard for most of the clients or its specific for pika-clients
only ?

3) I then also try to observer how my system resources are used. I am new
to this but after some googling I learnt a linux command 'dstat -dmnsy'.
This provides me disk usage, RAM usage, interrupts and context switches,
network send/recev. What I observer that as I increase no of
producer/receiver, compare to DISK and RAM usage, its interrupts and
context switches, which increases rapidly.

what does this really mean ?

4) Also, after certain point the value under network send/receive field
remains constant. Not sure what does this mean also ?

I am pasting here one of the observed sample from dstat.

   mq10 at mqserver10:~$ sudo rabbitmqadmin list queues vhost name node
messages message_stats.publish_details.rate
+-------+------+-----------------+----------+------------------------------------+
| vhost | name |      node       | messages |
message_stats.publish_details.rate |
+-------+------+-----------------+----------+------------------------------------+
| /     | 1    | Moon at mqserver10 | 5        | 3380.4
      |
| /     | 2    | Moon at mqserver10 | 3        | 3649.0
      |
| /     | 3    | Moon at mqserver10 | 6        | 3402.4
      |
| /     | 4    | Moon at mqserver10 | 2        | 3450.8
      |
| /     | 5    | Moon at mqserver10 | 3        | 3444.8
      |
+-------+------+-----------------+----------+------------------------------------+
mq10 at mqserver10:~$ dstat -dmnsy
-dsk/total- ------memory-usage----- -net/total- ----swap--- ---system--
 read  writ| used  buff  cach  free| recv  send| used  free| int   csw
 100k 8974B| 188M 25.7M  115M 9674M|   0     0 |   0     0 |  15k 9759
   0    16k| 189M 25.7M  115M 9673M|6363k 4615k|   0     0 |  22k 6590
   0     0 | 189M 25.7M  115M 9673M|6666k 4847k|   0     0 |  22k 7846
   0     0 | 189M 25.7M  115M 9673M|6293k 4500k|   0     0 |  21k 7518
   0     0 | 189M 25.7M  115M 9674M|7049k 5121k|   0     0 |  22k 5936
   0     0 | 188M 25.7M  115M 9674M|6947k 5081k|   0     0 |  23k 6309
   0     0 | 188M 25.7M  115M 9674M|6387k 4741k|   0     0 |  22k 7020
   0     0 | 188M 25.7M  115M 9674M|6482k 4739k|   0     0 |  22k 7094
   0     0 | 189M 25.7M  115M 9673M|5642k 3976k|   0     0 |  18k 7586
   0     0 | 189M 25.7M  115M 9673M|6246k 4487k|   0     0 |  21k 7497
   0     0 | 189M 25.7M  115M 9673M|6631k 4827k|   0     0 |  21k 5924
   0     0 | 189M 25.7M  115M 9673M|6615k 4722k|   0     0 |  21k 5448
   0     0 | 190M 25.7M  115M 9672M|5677k 4051k|   0     0 |  20k 5757
   0     0 | 190M 25.7M  115M 9672M|6007k 4284k|   0     0 |  20k 6581
   0     0 | 190M 25.7M  115M 9672M|6983k 5052k|   0     0 |  23k 5704
   0     0 | 190M 25.7M  115M 9672M|6318k 4539k|   0     0 |  22k 6208
   0     0 | 190M 25.7M  115M 9672M|6769k 4862k|   0     0 |  23k 5952
   0     0 | 189M 25.7M  115M 9673M|6334k 4586k|   0     0 |  22k 6518
   0     0 | 191M 25.7M  115M 9671M|7019k 5089k|   0     0 |  23k 5937 ^C


   mq10 at mqserver10:~$ sudo rabbitmqadmin list queues vhost name node
messages message_stats.publish_details.rate
+-------+------+-----------------+----------+------------------------------------+
| vhost | name |      node       | messages |
message_stats.publish_details.rate |
+-------+------+-----------------+----------+------------------------------------+
| /     | 1    | Moon at mqserver10 | 3        | 2846.8
      |
| /     | 2    | Moon at mqserver10 | 6        | 2894.2
      |
| /     | 3    | Moon at mqserver10 | 5        | 2950.2
      |
| /     | 4    | Moon at mqserver10 | 3        | 2931.8
      |
| /     | 5    | Moon at mqserver10 | 6        | 2788.2
      |
| /     | 6    | Moon at mqserver10 | 7        | 3008.2
      |
+-------+------+-----------------+----------+------------------------------------+
mq10 at mqserver10:~$ dstat -dmnsy
-dsk/total- ------memory-usage----- -net/total- ----swap--- ---system--
 read  writ| used  buff  cach  free| recv  send| used  free| int   csw
  90k 8095B| 189M 25.7M  115M 9673M|   0     0 |   0     0 |  16k 9394
   0     0 | 190M 25.7M  115M 9672M|6893k 4967k|   0     0 |  24k 6852
   0     0 | 192M 25.7M  115M 9670M|5171k 3601k|   0     0 |  19k 4542
   0     0 | 191M 25.7M  115M 9671M|7007k 5107k|   0     0 |  24k 6125
   0     0 | 191M 25.7M  115M 9671M|6684k 4890k|   0     0 |  23k 6508
   0     0 | 191M 25.7M  115M 9671M|6453k 4643k|   0     0 |  23k 6159
   0     0 | 191M 25.7M  115M 9671M|6342k 4549k|   0     0 |  22k 5418
   0     0 | 191M 25.7M  115M 9671M|6284k 4475k|   0     0 |  22k 5698
   0     0 | 190M 25.7M  115M 9672M|6783k 4861k|   0     0 |  23k 5781
   0     0 | 190M 25.7M  115M 9672M|6636k 4707k|   0     0 |  23k 5779
   0     0 | 189M 25.7M  115M 9673M|6807k 4877k|   0     0 |  23k 5590
   0     0 | 189M 25.7M  115M 9673M|6904k 4949k|   0     0 |  24k 5668
   0     0 | 189M 25.7M  115M 9673M|7194k 5134k|   0     0 |  24k 5700
   0     0 | 189M 25.7M  115M 9673M|6727k 4779k|   0     0 |  23k 5259
   0     0 | 189M 25.7M  115M 9673M|7168k 5114k|   0     0 |  25k 5737
   0     0 | 189M 25.7M  115M 9673M|6943k 5046k|   0     0 |  23k 5646
   0     0 | 189M 25.7M  115M 9674M|6869k 4929k|   0     0 |  23k 5777
   0     0 | 188M 25.7M  115M 9674M|7037k 5044k|   0     0 |  23k 5586
   0     0 | 188M 25.7M  115M 9674M|6999k 5031k|   0     0 |  23k 5730
   0     0 | 189M 25.7M  115M 9673M|6599k 4742k|   0     0 |  22k 6504
   0     0 | 190M 25.7M  115M 9672M|6615k 4834k|   0     0 |  23k 6436
   0     0 | 190M 25.7M  115M 9672M|6595k 4742k|   0     0 |  23k 5795


Also, what is the good profiler to run for rabbitmq server ?

I really want to get hold of how the system resources are used and what is
the bottleneck so may be profiler is a good idea.

Please suggest.

Best Regards,
Priyanki.





On Thu, Aug 1, 2013 at 9:27 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Priyanki Vashi:
>
> > 1) Why there is no linear increase in throughput with DISK type of node
> as it's seen with RAM type of node ?
>
> Because disks are much slower than RAM and performing multiple I/O
> operations in parallel often won't yield
> linear increase in I/O throughput (depends on your disks and how they are
> set up; try with a striping array of SSDs ;))
>
> With RAM access, it is more likely that you will see nearly linear
> increase.
>
> > 3) What can be done to improve throughput in both the Tests ?
>
> It's hard to give you good advice without seeing the code.
>
> > 4) Since I have VM with 20 cores dedicated for rabbitMQ execution, how
> can I load the CPU to it's limit ? with the current tests I can load CPU
> maximum to 800% with    above mentioned throughput. currently the limiting
> factor seems to be server latency so how to overcome that ?
>
> I suspect that the limiting factor is disk and network I/O and not CPU.
> If Erlang runtime does not need more cores, it will not use more cores.
>
> Try running iostat or vmstat alongside your benchmarks to see what % of
> load your disk has.
> Monitoring network throughput is another thing to do. Finally, TCP stack
> configuration matters.
> For example, does Pika disable Nagle's algorithm [1] on the sockets it
> uses? I'm not sure.
>
> 1.
> http://boundary.com/blog/2012/05/02/know-a-delay-nagles-algorithm-and-you
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/d67e42c9/attachment.htm>

From paul.bowsher at gmail.com  Thu Aug 15 10:50:32 2013
From: paul.bowsher at gmail.com (Paul Bowsher)
Date: Thu, 15 Aug 2013 10:50:32 +0100
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
 Rabbit 3.1.4
In-Reply-To: <520BF54E.1080006@rabbitmq.com>
References: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
	<520BF54E.1080006@rabbitmq.com>
Message-ID: <CAFS6ge=Kjm_5h5TmCLVaYvUNM6LdvJbwujXHNT+XMFWWuQ0CJQ@mail.gmail.com>

Hi Matthias,

Thanks for the reply. When you say resource alarms, do you mean on the
server or from the clients? We don't have any issues whatsoever there.
We've been running the same workload, and this issue only occurs since the
upgrade to 3.1.4.

We've performed some further experimentation since - we've configured
clients to only connect to node B. This has resolved the problem entirely.
The queues are still mirrored but we have no "stuck" connections. It seems
that we have a sick rabbit on node A. How can we help diagnose this?

Thanks,

Paul

Paul Bowsher


On Wed, Aug 14, 2013 at 10:23 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Paul,
>
> On 14/08/13 10:41, Paul Bowsher wrote:
>
>> After the upgrade to RabbitMQ 3.1.4 we're seeing a large number of
>> linearly-increasing channels which seem to hang around after the
>> connection is closed.
>>
>
> This is very unlikely to be related to the upgrade...
>
>  - Initially, larger than expected consumer count on queue from our
>> monitoring
>> - Stopping all expected consumers on that channel removes the expected
>> number of consumers, leaving orphans (700+ at present)
>> - Each orphaned consumer's channel is reachable using Management tool
>> - Each connection for the channel is reachable, is in either a "flow" or
>> "blocked" state with zero data flow. Timeout is set to 600s (count
>> doesn't decrease after 10 minutes)
>>
>
> The above is all consistent with connections being blocked due to resource
> alarms. Blocked connections do not get closed until they are unblocked.
> Check the server logs for alarm warnings.
>
>  - Forcing a stuck connection closed through the management interface
>> results in a 500:
>>
>>     The server encountered an error while processing this request:
>>     {exit,{normal,{gen_server,**call,
>>                                [<0.16806.1347>,
>>                                 {shutdown,"Closed via management plugin"},
>>                                 infinity]}},
>>            [{gen_server,call,3,[{file,"**gen_server.erl"},{line,188}]},
>>             {rabbit_mgmt_wm_connection,**delete_resource,2,[]},
>>             {webmachine_resource,resource_**call,3,[]},
>>             {webmachine_resource,do,3,[]},
>>             {webmachine_decision_core,**resource_call,1,[]},
>>             {webmachine_decision_core,**decision,1,[]},
>>             {webmachine_decision_core,**handle_request,2,[]},
>>             {rabbit_webmachine,'-makeloop/**1-fun-0-',2,[]}]}
>>
>
> That looks like a bug. Alas I cannot see anything obviously wrong in the
> code and I cannot reproduce it :( Is this easily reproducible for you?
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/1cea71c0/attachment.htm>

From matthias at rabbitmq.com  Thu Aug 15 10:54:15 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Aug 2013 10:54:15 +0100
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
 Rabbit 3.1.4
In-Reply-To: <CAFS6ge=Kjm_5h5TmCLVaYvUNM6LdvJbwujXHNT+XMFWWuQ0CJQ@mail.gmail.com>
References: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
	<520BF54E.1080006@rabbitmq.com>
	<CAFS6ge=Kjm_5h5TmCLVaYvUNM6LdvJbwujXHNT+XMFWWuQ0CJQ@mail.gmail.com>
Message-ID: <520CA547.7000501@rabbitmq.com>

Paul,

On 15/08/13 10:50, Paul Bowsher wrote:
> Thanks for the reply. When you say resource alarms, do you mean on the
> server or from the clients?

Server.

> It seems that we have a sick rabbit on node A. How can we
> help diagnose this?

Check the logs and the management UI. For connections to be in the 
'blocked' state for any significant duration of time, there must be a 
triggering memory and/or disk alarm. Which should be very obvious in the 
logs and UI.

Matthias.

From utromvecherom at gmail.com  Thu Aug 15 10:56:15 2013
From: utromvecherom at gmail.com (Nicolai G.)
Date: Thu, 15 Aug 2013 02:56:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Content payload structure
In-Reply-To: <7ef0d061-13a0-42fe-a397-0dce4f75b42b@googlegroups.com>
References: <3b108e92-96a5-479a-8480-ddeb0e425dec@googlegroups.com>
	<7ef0d061-13a0-42fe-a397-0dce4f75b42b@googlegroups.com>
Message-ID: <939220d4-01b8-4527-a00a-33c1e12fa10f@googlegroups.com>

Ok, my bad. Looking at previous sections of spec 
(http://www.rabbitmq.com/resources/specs/amqp-xml-doc0-9-1.pdf) I get used 
that classes difine no properties, but the Basic class does (1.8.1.). 
Navigating through Table of Contents I didn't notice the table of 
properties defined by the Basic class :(

On Thursday, August 15, 2013 10:34:16 AM UTC+3, Nicolai G. wrote:
>
> I read the spec, and this particular segment I've read very attentively:
> From AMQP 0-9-1, s 4.2.6.1 "The Content Header"
>
> <quote>
> - The property flags are an array of bits that indicate the presence or 
> absence of each property value in sequence. The bits are ordered from most 
> high to low - bit 15 indicates the first property.
>
> - The property flags can specify more than 16 properties. If the last bit 
> (0) is set, this indicates that a further property flags field follows. 
> There are many property flags fields as needed.
>
> - The property values are class-specific AMQP data fields.
>
> - Bit properties are indicated ONLY by their respective property flag (1 
> or 0) and are never present in the property list.
> </quote>
>
> I'm sorry for asking you silly questions. But how it influence on the 
> interpretation of binary?
>
> For example.
> Client application receives 
> Basic.deliver
> | type (octet)| channel (short)| size (long)|  class-id(short) | method-id 
> (short) | payload | frame-end (octet) |
>
> Binary:
> | 0x01 | 0x0042 | 0x00000032 | 0x003C | 0x0028 |  Basic.deliver payload | 
> 0xCE |
>
> And the content comes:
>
> | type (octet)| channel (short)| size (long)|  class-id(short) | weight 
> (short) | body-size (long long) | property-flags (2 octets ) | property 
> list |
>
> Binary
> | 0x02 | 0x0042 | 0x0000000E + Z | 0x003C | 0x0000 |  body-size = 16 | 
> PROPERTY_FLAGS | Z octets | 0xCE |
>
> So if PROPERTY_FLAGS = 0x0000 what is in Z image, how to interpret it?
>
> if PROPERTY_FLAGS = 0x0080 or PROPERTY_FLAGS = whatever  (0x0 <= whatever 
> =< 0xFFFF)
>
> I've looked at other clients implementation. For Ruby I found some tips in 
> http://rubydoc.info/github/ruby-amqp/amq-protocol/master/AMQ/Protocol/Basic
> But where these constants came from? 
> Are they documented? or it's just peer2peer knowledge?
>
> Or are they client2client meaningful and it's up to them to make an 
> agreement on their meaning and way of interpretation?
>
> Thanx
>
> On Wednesday, August 14, 2013 12:58:51 AM UTC+3, Nicolai G. wrote:
>>
>> Hello!
>>
>> I try to implement yet another amqp-client (on C++, heavily integrated 
>> with our base frameworks). And I've come to the point of interpreting the 
>> content header payload, and I cannot find clear description of the 
>> relationship between property-flags and property-list. If I got 
>> F1%b1,F2%b1, ... ,Fn%b0 in property-flags, what *amqp-field sequence I MUST 
>> expect in property-list?
>>
>> Can anyone, please, point me on any doc where I can find this information?
>>
>> Best regards,
>> Nicolai
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/bc540a1b/attachment.htm>

From Chris.Nicel at 15below.com  Thu Aug 15 10:56:58 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Thu, 15 Aug 2013 04:56:58 -0500
Subject: [rabbitmq-discuss] Management API and Access control.
In-Reply-To: <520CA12C.5090606@rabbitmq.com>
References: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A09@AUSP01VMBX29.collaborationhost.net>
	<520C9A46.3050208@rabbitmq.com>
	<A57B6B00637AF741A9FA2D006B40C3C883C7CE4A1E@AUSP01VMBX29.collaborationhost.net>
	<520CA12C.5090606@rabbitmq.com>
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C883C7CE4A25@AUSP01VMBX29.collaborationhost.net>

Hi Matthias,

I was aware of this, but thanks for the additional clarification for those that may not have been.

Cheers

Chris

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: 15 August 2013 10:37
To: Discussions about RabbitMQ
Cc: Chris Nicel
Subject: Re: [rabbitmq-discuss] Management API and Access control.

Chris,

On 15/08/13 10:29, Chris Nicel wrote:
> If this is only possible with an administrator account we will just
> have to be aware of it.

The administrator permissions Emile was referring to are the *RabbitMQ
Management* administrator permissions, as per the documentation link he posted, i.e....

> Only administrators can add vhosts. See
> http://www.rabbitmq.com/management.html#permissions

That has nothing to do with *Windows* administrator permissions.

Matthias.

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From harel at thisisglow.com  Thu Aug 15 10:58:53 2013
From: harel at thisisglow.com (harel at thisisglow.com)
Date: Thu, 15 Aug 2013 02:58:53 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Crashes with Out Of Memory errors.
Message-ID: <11f752fb-bdef-47d8-b3bd-6c4160dd3791@googlegroups.com>

Hi, 

We've been using RabbitMQ Since early 1.x days and it has been a great and 
reliable queueing system. In the last few months we've started experiencing 
severe rabbit crashes, all due to 'out of memory' errors, where rabbit is 
killed by the kernel. We're using rabbit with celery in a python 
application.

We did go through some infrastructure changes when those crashes began - we 
moved to a different data centre and upgraded rabbit from 2.x to latest 3.x 
(as well as celery to the latest 3.x version). The spec of the machine 
running rabbit did not change though - the old and new servers had 16GB of 
ram and both had a few other things running on them - a few celery nodes 
and memcached (limited to 2GB). 
In our old setup, no matter how big the queues become rabbit stayed alive 
and well. In the new setup once memory usage spikes too high, rabbit dies. 

As an intermediate solution we've prepared a 32GB ram machine and will use 
the old 16GB one as a secondary (i.e., run rabbit in a cluster). However it 
is very important to us to understand why we are experiencing those crashes 
- adding hardware only solves the symptom but not the problem. 
Why does rabbit fail when memory is spiking? What causes the kernel to kill 
it? The error message is always a cryptic Out Of Memory and Killed by 
Kernel though I'm convinced there is something trivial we are missing in 
our new setup that causes the kernel to terminate rabbit in those cases. 

Any help is highly appreciated. 

Harel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/04db12d5/attachment.htm>

From mklishin at gopivotal.com  Thu Aug 15 11:06:11 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 Aug 2013 14:06:11 +0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
	and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
Message-ID: <08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>

Priyanki Vashi:

> 1) I have a quite high bandwidth between my client (producer & receiver) and server. Its around 9.2 Gbps. I have confirmed this by running iperf utility. But the maximum bandwidth I can reach is only 160 mbps. (I have pika client and single rabbitmq DISK type)

This means your client cannot publish faster.

> 2) I then also took network traces using wireshark, and what I observed that the AMQP overhead was quite high then the actual payload. If I send 100 bytes of string then overhead is 300 bytes so for every message of 100 bytes I end up sending 400 bytes on wire. 

That does not sound right. AMQP 0-9-1 is a binary protocol and for every published message
without custom headers, you should get a few dozens of bytes + message payload.

The rest is probably TCP and IP overhead. There is no way to use RabbitMQ over UDP.

> Since I have publish confirm/ack enabled so I understand part of this but there is also content header and some overhead in content body as well. 
> Is this standard for most of the clients or its specific for pika-clients only ? 

For a basic.publish with payload, you will get 3 frames:

[basic.publish method frame] [content headers] [content payload]

If the message has no content, it becomes

[basic.publish method frame] [content headers]

with every correct client.

> 3) I then also try to observer how my system resources are used. I am new to this but after some googling I learnt a linux command 'dstat -dmnsy'. This provides me disk usage, RAM usage, interrupts and context switches, network send/recev. What I observer that as I increase no of producer/receiver, compare to DISK and RAM usage, its interrupts and context switches, which increases rapidly. 
> 
> what does this really mean ?

When you publish rapidly, RabbitMQ stores messages (and some metadata about them) in RAM and on disk. Context switches means that OS gives various processes (your publisher, RabbitMQ, other processes running) time to execute. Flat network traffic rate suggests your publisher cannot
publish any faster.

> 4) Also, after certain point the value under network send/receive field remains constant. Not sure what does this mean also ?

See above.

> 
> I am pasting here one of the observed sample from dstat. 
> 
>    mq10 at mqserver10:~$ sudo rabbitmqadmin list queues vhost name node messages message_stats.publish_details.rate
> +-------+------+-----------------+----------+------------------------------------+
> | vhost | name |      node       | messages | message_stats.publish_details.rate |
> +-------+------+-----------------+----------+------------------------------------+
> | /     | 1    | Moon at mqserver10 | 5        | 3380.4                             |
> | /     | 2    | Moon at mqserver10 | 3        | 3649.0                             |
> | /     | 3    | Moon at mqserver10 | 6        | 3402.4                             |
> | /     | 4    | Moon at mqserver10 | 2        | 3450.8                             |
> | /     | 5    | Moon at mqserver10 | 3        | 3444.8                             |
> +-------+------+-----------------+----------+------------------------------------+
> mq10 at mqserver10:~$ dstat -dmnsy
> -dsk/total- ------memory-usage----- -net/total- ----swap--- ---system--
>  read  writ| used  buff  cach  free| recv  send| used  free| int   csw
>  100k 8974B| 188M 25.7M  115M 9674M|   0     0 |   0     0 |  15k 9759
>    0    16k| 189M 25.7M  115M 9673M|6363k 4615k|   0     0 |  22k 6590
>    0     0 | 189M 25.7M  115M 9673M|6666k 4847k|   0     0 |  22k 7846
>    0     0 | 189M 25.7M  115M 9673M|6293k 4500k|   0     0 |  21k 7518
>    0     0 | 189M 25.7M  115M 9674M|7049k 5121k|   0     0 |  22k 5936
>    0     0 | 188M 25.7M  115M 9674M|6947k 5081k|   0     0 |  23k 6309
>    0     0 | 188M 25.7M  115M 9674M|6387k 4741k|   0     0 |  22k 7020
>    0     0 | 188M 25.7M  115M 9674M|6482k 4739k|   0     0 |  22k 7094
>    0     0 | 189M 25.7M  115M 9673M|5642k 3976k|   0     0 |  18k 7586
>    0     0 | 189M 25.7M  115M 9673M|6246k 4487k|   0     0 |  21k 7497
>    0     0 | 189M 25.7M  115M 9673M|6631k 4827k|   0     0 |  21k 5924
>    0     0 | 189M 25.7M  115M 9673M|6615k 4722k|   0     0 |  21k 5448
>    0     0 | 190M 25.7M  115M 9672M|5677k 4051k|   0     0 |  20k 5757
>    0     0 | 190M 25.7M  115M 9672M|6007k 4284k|   0     0 |  20k 6581
>    0     0 | 190M 25.7M  115M 9672M|6983k 5052k|   0     0 |  23k 5704
>    0     0 | 190M 25.7M  115M 9672M|6318k 4539k|   0     0 |  22k 6208
>    0     0 | 190M 25.7M  115M 9672M|6769k 4862k|   0     0 |  23k 5952
>    0     0 | 189M 25.7M  115M 9673M|6334k 4586k|   0     0 |  22k 6518
>    0     0 | 191M 25.7M  115M 9671M|7019k 5089k|   0     0 |  23k 5937 ^C

This suggests your publisher publishes at a roughly constant rate.
Which, given spare network capacity (per your own words) suggests
that the publisher cannot go any faster. 

> Also, what is the good profiler to run for rabbitmq server ?

http://www.erlang.org/doc/efficiency_guide/profiling.html

I'd like to point you that it's not RabbitMQ that seem to need profiling but your
client.

Try MulticastMain that ships with the RabbitMQ Java client or amqpc [1]
to see what kind of thoughput your RabbitMQ node can offer with really fast
clients.

1. https://github.com/gocardless/amqpc
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/8705b8e2/attachment.pgp>

From paul.bowsher at gmail.com  Thu Aug 15 11:11:55 2013
From: paul.bowsher at gmail.com (Paul Bowsher)
Date: Thu, 15 Aug 2013 11:11:55 +0100
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
 Rabbit 3.1.4
In-Reply-To: <520CA547.7000501@rabbitmq.com>
References: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
	<520BF54E.1080006@rabbitmq.com>
	<CAFS6ge=Kjm_5h5TmCLVaYvUNM6LdvJbwujXHNT+XMFWWuQ0CJQ@mail.gmail.com>
	<520CA547.7000501@rabbitmq.com>
Message-ID: <CAFS6gekuvt=O6st6fWThd0YXzWAwtm44VSQvaj_pzOAAa+ACmA@mail.gmail.com>

Nope, nothing at all. When we have seen this issue "live" all the resource
indicators on the Overview page are green by a long way. The only error we
have in the logs is:

=ERROR REPORT==== 15-Aug-2013::11:02:42 ===
** Generic server delegate_0 terminating
** Last message in was
{'DOWN',#Ref<0.0.2498.72665>,process,<2986.16099.3104>,
                               normal}
** When Server state == {state,'rabbit at 428178-data15',
                               {dict,2,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]},
                                     {{[],
                                       [[<2986.16099.3104>|
                                         {<0.18153.2029>,
                                          #Ref<0.0.2498.72669>}]],
                                       [[<2986.15096.3096>|
                                         {<0.18155.2029>,
                                          #Ref<0.0.2497.259319>}]],
                                       [],[],[],[],[],[],[],[],[],[],[],[],
                                       []}}},
                               delegate_0}
** Reason for termination ==
** {{case_clause,{ok,{<0.18153.2029>,#Ref<0.0.2498.72669>}}},
    [{delegate,handle_info,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}

I've also just noticed now that we have publisher connections that are
stuck too. In the connections view

Paul Bowsher


On Thu, Aug 15, 2013 at 10:54 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Paul,
>
>
> On 15/08/13 10:50, Paul Bowsher wrote:
>
>> Thanks for the reply. When you say resource alarms, do you mean on the
>> server or from the clients?
>>
>
> Server.
>
>
>  It seems that we have a sick rabbit on node A. How can we
>> help diagnose this?
>>
>
> Check the logs and the management UI. For connections to be in the
> 'blocked' state for any significant duration of time, there must be a
> triggering memory and/or disk alarm. Which should be very obvious in the
> logs and UI.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/95f00429/attachment.htm>

From paul.bowsher at gmail.com  Thu Aug 15 11:14:11 2013
From: paul.bowsher at gmail.com (Paul Bowsher)
Date: Thu, 15 Aug 2013 11:14:11 +0100
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
 Rabbit 3.1.4
In-Reply-To: <CAFS6gekuvt=O6st6fWThd0YXzWAwtm44VSQvaj_pzOAAa+ACmA@mail.gmail.com>
References: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
	<520BF54E.1080006@rabbitmq.com>
	<CAFS6ge=Kjm_5h5TmCLVaYvUNM6LdvJbwujXHNT+XMFWWuQ0CJQ@mail.gmail.com>
	<520CA547.7000501@rabbitmq.com>
	<CAFS6gekuvt=O6st6fWThd0YXzWAwtm44VSQvaj_pzOAAa+ACmA@mail.gmail.com>
Message-ID: <CAFS6ge=PW-AFDc93cqaSsm1rdp3=5--1ir-Mi85wjvwz7EXkDQ@mail.gmail.com>

Oops sorry, premature send. In the connections view they don't say blocked,
flow or running. When you click the connection it doesn't have a "state" at
all. However rabbitmqctl list_connections lists them as blocked.

These publishers are still publishing to node A, and again there's no stuck
connections on node B. Both nodes are identical hardware (not VMs), and are
completely fine in terms of resource.

Paul Bowsher


On Thu, Aug 15, 2013 at 11:11 AM, Paul Bowsher <paul.bowsher at gmail.com>wrote:

> Nope, nothing at all. When we have seen this issue "live" all the resource
> indicators on the Overview page are green by a long way. The only error we
> have in the logs is:
>
> =ERROR REPORT==== 15-Aug-2013::11:02:42 ===
> ** Generic server delegate_0 terminating
> ** Last message in was
> {'DOWN',#Ref<0.0.2498.72665>,process,<2986.16099.3104>,
>                                normal}
> ** When Server state == {state,'rabbit at 428178-data15',
>                                {dict,2,16,16,8,80,48,
>
>  {[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]},
>                                      {{[],
>                                        [[<2986.16099.3104>|
>                                          {<0.18153.2029>,
>                                           #Ref<0.0.2498.72669>}]],
>                                        [[<2986.15096.3096>|
>                                          {<0.18155.2029>,
>                                           #Ref<0.0.2497.259319>}]],
>                                        [],[],[],[],[],[],[],[],[],[],[],[],
>                                        []}}},
>                                delegate_0}
> ** Reason for termination ==
> ** {{case_clause,{ok,{<0.18153.2029>,#Ref<0.0.2498.72669>}}},
>     [{delegate,handle_info,2,[]},
>      {gen_server2,handle_msg,2,[]},
>      {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}
>
> I've also just noticed now that we have publisher connections that are
> stuck too. In the connections view
>
> Paul Bowsher
>
>
> On Thu, Aug 15, 2013 at 10:54 AM, Matthias Radestock <
> matthias at rabbitmq.com> wrote:
>
>> Paul,
>>
>>
>> On 15/08/13 10:50, Paul Bowsher wrote:
>>
>>> Thanks for the reply. When you say resource alarms, do you mean on the
>>> server or from the clients?
>>>
>>
>> Server.
>>
>>
>>  It seems that we have a sick rabbit on node A. How can we
>>> help diagnose this?
>>>
>>
>> Check the logs and the management UI. For connections to be in the
>> 'blocked' state for any significant duration of time, there must be a
>> triggering memory and/or disk alarm. Which should be very obvious in the
>> logs and UI.
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/339dfbe9/attachment.htm>

From matthias at rabbitmq.com  Thu Aug 15 11:18:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Aug 2013 11:18:27 +0100
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
 Rabbit 3.1.4
In-Reply-To: <CAFS6ge=PW-AFDc93cqaSsm1rdp3=5--1ir-Mi85wjvwz7EXkDQ@mail.gmail.com>
References: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
	<520BF54E.1080006@rabbitmq.com>
	<CAFS6ge=Kjm_5h5TmCLVaYvUNM6LdvJbwujXHNT+XMFWWuQ0CJQ@mail.gmail.com>
	<520CA547.7000501@rabbitmq.com>
	<CAFS6gekuvt=O6st6fWThd0YXzWAwtm44VSQvaj_pzOAAa+ACmA@mail.gmail.com>
	<CAFS6ge=PW-AFDc93cqaSsm1rdp3=5--1ir-Mi85wjvwz7EXkDQ@mail.gmail.com>
Message-ID: <520CAAF3.40100@rabbitmq.com>

Paul,

On 15/08/13 11:14, Paul Bowsher wrote:
> Oops sorry, premature send. In the connections view they don't say
> blocked, flow or running. When you click the connection it doesn't have
> a "state" at all. However rabbitmqctl list_connections lists them as
> blocked.

I suspect you are seeing an effect of 
http://rabbitmq.1065348.n5.nabble.com/Many-errors-in-mirrored-queues-with-rabbitmq-3-1-4-tt28801.html. 
The error message in the logs is certainly due to that.

So either roll back to 3.1.3 or wait for 3.1.5.

Matthias.

From paul.bowsher at gmail.com  Thu Aug 15 11:26:22 2013
From: paul.bowsher at gmail.com (Paul Bowsher)
Date: Thu, 15 Aug 2013 11:26:22 +0100
Subject: [rabbitmq-discuss] Orphaned channels after connection close in
 Rabbit 3.1.4
In-Reply-To: <520CAAF3.40100@rabbitmq.com>
References: <f2d4d37c-efaa-4c5f-95c2-c8d893abaad6@googlegroups.com>
	<520BF54E.1080006@rabbitmq.com>
	<CAFS6ge=Kjm_5h5TmCLVaYvUNM6LdvJbwujXHNT+XMFWWuQ0CJQ@mail.gmail.com>
	<520CA547.7000501@rabbitmq.com>
	<CAFS6gekuvt=O6st6fWThd0YXzWAwtm44VSQvaj_pzOAAa+ACmA@mail.gmail.com>
	<CAFS6ge=PW-AFDc93cqaSsm1rdp3=5--1ir-Mi85wjvwz7EXkDQ@mail.gmail.com>
	<520CAAF3.40100@rabbitmq.com>
Message-ID: <CAFS6gen6S1qF6ddNaw-UGj7q5j+csKjZK4Q8hJQi+cUSJSaKDw@mail.gmail.com>

Thanks Matthias, that confirms our suspicions. We'll wait for 3.1.5 and
report back if there's still any issues.

Paul Bowsher


On Thu, Aug 15, 2013 at 11:18 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Paul,
>
>
> On 15/08/13 11:14, Paul Bowsher wrote:
>
>> Oops sorry, premature send. In the connections view they don't say
>> blocked, flow or running. When you click the connection it doesn't have
>> a "state" at all. However rabbitmqctl list_connections lists them as
>> blocked.
>>
>
> I suspect you are seeing an effect of http://rabbitmq.1065348.n5.**
> nabble.com/Many-errors-in-**mirrored-queues-with-rabbitmq-**
> 3-1-4-tt28801.html<http://rabbitmq.1065348.n5.nabble.com/Many-errors-in-mirrored-queues-with-rabbitmq-3-1-4-tt28801.html>.
> The error message in the logs is certainly due to that.
>
> So either roll back to 3.1.3 or wait for 3.1.5.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/6c59065d/attachment.htm>

From vashi.priyanki at gmail.com  Thu Aug 15 11:29:37 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Thu, 15 Aug 2013 12:29:37 +0200
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
Message-ID: <CA+0nT8BqWu-XXOEBvS-QypJoapsQuYtc1406N7bsyvOAOzQ2yg@mail.gmail.com>

Hi ,

I agree that my single producer is producing at constant rate but if I
increase number of producers, upt to say 10, then I should be able to see
proper usage of bandwidth right ?

Best Regards,
Priyanki.




On Thu, Aug 15, 2013 at 12:06 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Priyanki Vashi:
>
> > 1) I have a quite high bandwidth between my client (producer & receiver)
> and server. Its around 9.2 Gbps. I have confirmed this by running iperf
> utility. But the maximum bandwidth I can reach is only 160 mbps. (I have
> pika client and single rabbitmq DISK type)
>
> This means your client cannot publish faster.
>
> > 2) I then also took network traces using wireshark, and what I observed
> that the AMQP overhead was quite high then the actual payload. If I send
> 100 bytes of string then overhead is 300 bytes so for every message of 100
> bytes I end up sending 400 bytes on wire.
>
> That does not sound right. AMQP 0-9-1 is a binary protocol and for every
> published message
> without custom headers, you should get a few dozens of bytes + message
> payload.
>
> The rest is probably TCP and IP overhead. There is no way to use RabbitMQ
> over UDP.
>
> > Since I have publish confirm/ack enabled so I understand part of this
> but there is also content header and some overhead in content body as well.
> > Is this standard for most of the clients or its specific for
> pika-clients only ?
>
> For a basic.publish with payload, you will get 3 frames:
>
> [basic.publish method frame] [content headers] [content payload]
>
> If the message has no content, it becomes
>
> [basic.publish method frame] [content headers]
>
> with every correct client.
>
> > 3) I then also try to observer how my system resources are used. I am
> new to this but after some googling I learnt a linux command 'dstat
> -dmnsy'. This provides me disk usage, RAM usage, interrupts and context
> switches, network send/recev. What I observer that as I increase no of
> producer/receiver, compare to DISK and RAM usage, its interrupts and
> context switches, which increases rapidly.
> >
> > what does this really mean ?
>
> When you publish rapidly, RabbitMQ stores messages (and some metadata
> about them) in RAM and on disk. Context switches means that OS gives
> various processes (your publisher, RabbitMQ, other processes running) time
> to execute. Flat network traffic rate suggests your publisher cannot
> publish any faster.
>
> > 4) Also, after certain point the value under network send/receive field
> remains constant. Not sure what does this mean also ?
>
> See above.
>
> >
> > I am pasting here one of the observed sample from dstat.
> >
> >    mq10 at mqserver10:~$ sudo rabbitmqadmin list queues vhost name node
> messages message_stats.publish_details.rate
> >
> +-------+------+-----------------+----------+------------------------------------+
> > | vhost | name |      node       | messages |
> message_stats.publish_details.rate |
> >
> +-------+------+-----------------+----------+------------------------------------+
> > | /     | 1    | Moon at mqserver10 | 5        | 3380.4
>           |
> > | /     | 2    | Moon at mqserver10 | 3        | 3649.0
>           |
> > | /     | 3    | Moon at mqserver10 | 6        | 3402.4
>           |
> > | /     | 4    | Moon at mqserver10 | 2        | 3450.8
>           |
> > | /     | 5    | Moon at mqserver10 | 3        | 3444.8
>           |
> >
> +-------+------+-----------------+----------+------------------------------------+
> > mq10 at mqserver10:~$ dstat -dmnsy
> > -dsk/total- ------memory-usage----- -net/total- ----swap--- ---system--
> >  read  writ| used  buff  cach  free| recv  send| used  free| int   csw
> >  100k 8974B| 188M 25.7M  115M 9674M|   0     0 |   0     0 |  15k 9759
> >    0    16k| 189M 25.7M  115M 9673M|6363k 4615k|   0     0 |  22k 6590
> >    0     0 | 189M 25.7M  115M 9673M|6666k 4847k|   0     0 |  22k 7846
> >    0     0 | 189M 25.7M  115M 9673M|6293k 4500k|   0     0 |  21k 7518
> >    0     0 | 189M 25.7M  115M 9674M|7049k 5121k|   0     0 |  22k 5936
> >    0     0 | 188M 25.7M  115M 9674M|6947k 5081k|   0     0 |  23k 6309
> >    0     0 | 188M 25.7M  115M 9674M|6387k 4741k|   0     0 |  22k 7020
> >    0     0 | 188M 25.7M  115M 9674M|6482k 4739k|   0     0 |  22k 7094
> >    0     0 | 189M 25.7M  115M 9673M|5642k 3976k|   0     0 |  18k 7586
> >    0     0 | 189M 25.7M  115M 9673M|6246k 4487k|   0     0 |  21k 7497
> >    0     0 | 189M 25.7M  115M 9673M|6631k 4827k|   0     0 |  21k 5924
> >    0     0 | 189M 25.7M  115M 9673M|6615k 4722k|   0     0 |  21k 5448
> >    0     0 | 190M 25.7M  115M 9672M|5677k 4051k|   0     0 |  20k 5757
> >    0     0 | 190M 25.7M  115M 9672M|6007k 4284k|   0     0 |  20k 6581
> >    0     0 | 190M 25.7M  115M 9672M|6983k 5052k|   0     0 |  23k 5704
> >    0     0 | 190M 25.7M  115M 9672M|6318k 4539k|   0     0 |  22k 6208
> >    0     0 | 190M 25.7M  115M 9672M|6769k 4862k|   0     0 |  23k 5952
> >    0     0 | 189M 25.7M  115M 9673M|6334k 4586k|   0     0 |  22k 6518
> >    0     0 | 191M 25.7M  115M 9671M|7019k 5089k|   0     0 |  23k 5937 ^C
>
> This suggests your publisher publishes at a roughly constant rate.
> Which, given spare network capacity (per your own words) suggests
> that the publisher cannot go any faster.
>
> > Also, what is the good profiler to run for rabbitmq server ?
>
> http://www.erlang.org/doc/efficiency_guide/profiling.html
>
> I'd like to point you that it's not RabbitMQ that seem to need profiling
> but your
> client.
>
> Try MulticastMain that ships with the RabbitMQ Java client or amqpc [1]
> to see what kind of thoughput your RabbitMQ node can offer with really fast
> clients.
>
> 1. https://github.com/gocardless/amqpc
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/cd31e619/attachment.htm>

From harel at thisisglow.com  Thu Aug 15 11:30:31 2013
From: harel at thisisglow.com (harel at thisisglow.com)
Date: Thu, 15 Aug 2013 03:30:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Crash
In-Reply-To: <1b3ed206-6b44-40a7-89c0-a5ef789da21c@googlegroups.com>
References: <1b3ed206-6b44-40a7-89c0-a5ef789da21c@googlegroups.com>
Message-ID: <841bf084-9cc3-4897-b9ab-345e90a56aae@googlegroups.com>

Hi, I posted a RabbitMQ crash problem as well. 
Check dmesg to see if you have any Out Of Memory errors where the kernel 
kills the rabbit. That's what we are experiencing recently. 
Harel

On Wednesday, 3 July 2013 23:31:47 UTC+1, Jacob Straszynski wrote:
>
> These seem to happen intermittently. About to put a system into 
> productiion so it's somewhat scary.
>
> There is nothing in shutdown.err.
>
> Version info:
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v3.0.4  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2013 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at devbox
> app descriptor : 
> /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.4/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : /etc/rabbitmq/rabbitmq.config
> cookie hash    : fCNC8VwSUB7Sp3kOGod/FQ==
> log            : /var/log/rabbitmq/rabbit at devbox.log
> sasl log       : /var/log/rabbitmq/rabbit at devbox-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at devbox
> erlang version : 5.8.5
>
>
> This is the sasl log:
>
> =CRASH REPORT==== 3-Jul-2013::21:18:25 ===
>   crasher:
>     initial call: rabbit_disk_monitor:init/1
>     pid: <0.173.0>
>     registered_name: rabbit_disk_monitor
>     exception exit: {{badmatch,[]},
>                      [{rabbit_disk_monitor,parse_free_unix,1},
>                       {rabbit_disk_monitor,handle_call,3},
>                       {gen_server,handle_msg,5},
>                       {proc_lib,init_p_do_apply,3}]}
>       in function  gen_server:terminate/6
>     ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.150.0>]
>     messages: [update]
>     links: [<0.82.0>,<0.172.0>]
>     dictionary: []
>     trap_exit: false
>     status: running
>     heap_size: 2584
>     stack_size: 24
>     reductions: 2934764
>   neighbours:
>
> =SUPERVISOR REPORT==== 3-Jul-2013::21:18:25 ===
>      Supervisor: {local,rabbit_disk_monitor_sup}
>      Context:    child_terminated
>      Reason:     {{badmatch,[]},
>                   [{rabbit_disk_monitor,parse_free_unix,1},
>                    {rabbit_disk_monitor,handle_call,3},
>                    {gen_server,handle_msg,5},
>                    {proc_lib,init_p_do_apply,3}]}
>      Offender:   [{pid,<0.173.0>},
>                   {name,rabbit_disk_monitor},
>                   {mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},
>                   {restart_type,transient},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>
>
> =CRASH REPORT==== 3-Jul-2013::21:18:25 ===
>   crasher:
>     initial call: rabbit_mgmt_external_stats:init/1
>     pid: <0.228.0>
>     registered_name: rabbit_mgmt_external_stats
>     exception exit: {{{badmatch,[]},
>                       [{rabbit_disk_monitor,parse_free_unix,1},
>                        {rabbit_disk_monitor,handle_call,3},
>                        {gen_server,handle_msg,5},
>                        {proc_lib,init_p_do_apply,3}]},
>                      {gen_server,call,
>                                  [rabbit_disk_monitor,get_disk_free,
>                                   infinity]}}
>       in function  gen_server:terminate/6
>     ancestors: [rabbit_mgmt_agent_sup,<0.226.0>]
>     messages: []
>     links: [<0.227.0>]
>     dictionary: []
>     trap_exit: false
>     status: running
>     heap_size: 4181
>     stack_size: 24
>     reductions: 2306331
>   neighbours:
>
> =SUPERVISOR REPORT==== 3-Jul-2013::21:18:25 ===
>      Supervisor: {local,rabbit_mgmt_agent_sup}
>      Context:    child_terminated
>      Reason:     {{{badmatch,[]},
>                    [{rabbit_disk_monitor,parse_free_unix,1},
>                     {rabbit_disk_monitor,handle_call,3},
>                     {gen_server,handle_msg,5},
>                     {proc_lib,init_p_do_apply,3}]},
>                   {gen_server,call,
>                               
> [rabbit_disk_monitor,get_disk_free,infinity]}}
>      Offender:   [{pid,<0.228.0>},
>                   {name,rabbit_mgmt_external_stats},
>                   {mfargs,{rabbit_mgmt_external_stats,start_link,[]}},
>                   {restart_type,permanent},
>                   {shutdown,5000},
>                   {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 3-Jul-2013::21:27:38 ===
>      Supervisor: {<0.17763.0>,rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     noproc
>      Offender:   [{pid,<0.17765.0>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/5cf29d96/attachment.htm>

From harel at thisisglow.com  Thu Aug 15 11:30:31 2013
From: harel at thisisglow.com (harel at thisisglow.com)
Date: Thu, 15 Aug 2013 03:30:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Crash
In-Reply-To: <1b3ed206-6b44-40a7-89c0-a5ef789da21c@googlegroups.com>
References: <1b3ed206-6b44-40a7-89c0-a5ef789da21c@googlegroups.com>
Message-ID: <841bf084-9cc3-4897-b9ab-345e90a56aae@googlegroups.com>

Hi, I posted a RabbitMQ crash problem as well. 
Check dmesg to see if you have any Out Of Memory errors where the kernel 
kills the rabbit. That's what we are experiencing recently. 
Harel

On Wednesday, 3 July 2013 23:31:47 UTC+1, Jacob Straszynski wrote:
>
> These seem to happen intermittently. About to put a system into 
> productiion so it's somewhat scary.
>
> There is nothing in shutdown.err.
>
> Version info:
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v3.0.4  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2013 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at devbox
> app descriptor : 
> /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.4/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : /etc/rabbitmq/rabbitmq.config
> cookie hash    : fCNC8VwSUB7Sp3kOGod/FQ==
> log            : /var/log/rabbitmq/rabbit at devbox.log
> sasl log       : /var/log/rabbitmq/rabbit at devbox-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at devbox
> erlang version : 5.8.5
>
>
> This is the sasl log:
>
> =CRASH REPORT==== 3-Jul-2013::21:18:25 ===
>   crasher:
>     initial call: rabbit_disk_monitor:init/1
>     pid: <0.173.0>
>     registered_name: rabbit_disk_monitor
>     exception exit: {{badmatch,[]},
>                      [{rabbit_disk_monitor,parse_free_unix,1},
>                       {rabbit_disk_monitor,handle_call,3},
>                       {gen_server,handle_msg,5},
>                       {proc_lib,init_p_do_apply,3}]}
>       in function  gen_server:terminate/6
>     ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.150.0>]
>     messages: [update]
>     links: [<0.82.0>,<0.172.0>]
>     dictionary: []
>     trap_exit: false
>     status: running
>     heap_size: 2584
>     stack_size: 24
>     reductions: 2934764
>   neighbours:
>
> =SUPERVISOR REPORT==== 3-Jul-2013::21:18:25 ===
>      Supervisor: {local,rabbit_disk_monitor_sup}
>      Context:    child_terminated
>      Reason:     {{badmatch,[]},
>                   [{rabbit_disk_monitor,parse_free_unix,1},
>                    {rabbit_disk_monitor,handle_call,3},
>                    {gen_server,handle_msg,5},
>                    {proc_lib,init_p_do_apply,3}]}
>      Offender:   [{pid,<0.173.0>},
>                   {name,rabbit_disk_monitor},
>                   {mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},
>                   {restart_type,transient},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>
>
> =CRASH REPORT==== 3-Jul-2013::21:18:25 ===
>   crasher:
>     initial call: rabbit_mgmt_external_stats:init/1
>     pid: <0.228.0>
>     registered_name: rabbit_mgmt_external_stats
>     exception exit: {{{badmatch,[]},
>                       [{rabbit_disk_monitor,parse_free_unix,1},
>                        {rabbit_disk_monitor,handle_call,3},
>                        {gen_server,handle_msg,5},
>                        {proc_lib,init_p_do_apply,3}]},
>                      {gen_server,call,
>                                  [rabbit_disk_monitor,get_disk_free,
>                                   infinity]}}
>       in function  gen_server:terminate/6
>     ancestors: [rabbit_mgmt_agent_sup,<0.226.0>]
>     messages: []
>     links: [<0.227.0>]
>     dictionary: []
>     trap_exit: false
>     status: running
>     heap_size: 4181
>     stack_size: 24
>     reductions: 2306331
>   neighbours:
>
> =SUPERVISOR REPORT==== 3-Jul-2013::21:18:25 ===
>      Supervisor: {local,rabbit_mgmt_agent_sup}
>      Context:    child_terminated
>      Reason:     {{{badmatch,[]},
>                    [{rabbit_disk_monitor,parse_free_unix,1},
>                     {rabbit_disk_monitor,handle_call,3},
>                     {gen_server,handle_msg,5},
>                     {proc_lib,init_p_do_apply,3}]},
>                   {gen_server,call,
>                               
> [rabbit_disk_monitor,get_disk_free,infinity]}}
>      Offender:   [{pid,<0.228.0>},
>                   {name,rabbit_mgmt_external_stats},
>                   {mfargs,{rabbit_mgmt_external_stats,start_link,[]}},
>                   {restart_type,permanent},
>                   {shutdown,5000},
>                   {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 3-Jul-2013::21:27:38 ===
>      Supervisor: {<0.17763.0>,rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     noproc
>      Offender:   [{pid,<0.17765.0>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/5cf29d96/attachment-0001.htm>

From emile at rabbitmq.com  Thu Aug 15 11:31:53 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 15 Aug 2013 11:31:53 +0100
Subject: [rabbitmq-discuss] How to receive STOMP receipt only after the
 consumer has acknowledged the message?
In-Reply-To: <1376553781942-28808.post@n5.nabble.com>
References: <1376553781942-28808.post@n5.nabble.com>
Message-ID: <520CAE19.4030909@rabbitmq.com>


Hi,

On 15/08/13 09:03, joshua__lim wrote:

> What I've noticed from my tests is that the receipt sent is to the producer
> right after the broker captures the message.  This receipt is not adequate
> for reliable delivery since the message hasn't been sent to the consumer
> yet.

Messages can be transferred reliably from publishers to the broker.
(using transactions or confirms). Messages can also be transferred
reliably from the broker to consumers. (using acknowledgements)
Taken together this provides reliable transfer from publishers to consumers.

> I'm trying to figure out if it is possible for the receipt to be sent by the
> broker only after the recipient has acknowledged the message?

No. STOMP receipts are issued once the broker successfully takes
responsibility for a message. That does not translate to a guarantee
that it was acknowledged by the consumer.

If you want an end-to-end proof of delivery from the consumer then you
must set up an independent line of communication between the consumer
and the producer and send a proof-of-delivery token back along that route.

Depending on your needs you may wish to make consumer acknowledgements
synchronous by acknowledging in a transaction before sending the
proof-of-delivery.

> "The broker will confirm messages once:....
> ... b) has been consumed and, if necessary, acknowledged."

That is a semantically irrelevant optimisation which cannot be used to
obtain a guarantee that the message was acknowledged by a consumer.
(That statement has since been remove from the website. The optimisation
remains in place though.)



-Emile




From mklishin at gopivotal.com  Thu Aug 15 11:31:52 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 Aug 2013 14:31:52 +0400
Subject: [rabbitmq-discuss] RabbitMQ Crashes with Out Of Memory errors.
In-Reply-To: <11f752fb-bdef-47d8-b3bd-6c4160dd3791@googlegroups.com>
References: <11f752fb-bdef-47d8-b3bd-6c4160dd3791@googlegroups.com>
Message-ID: <1304FCDA-A0CC-44DC-A869-5012F40228FE@gopivotal.com>

harel at thisisglow.com:

> What causes the kernel to kill it?

OS finds itself running low on memory and tries to free some of it up by killing processes that
use a lot of RAM.

OOM killer can be configured and different kernels have different configuration. Possibly your
new machine has a newer kernel and/or different kernel configuration.

See 

http://serverfault.com/questions/101916/turn-off-the-linux-oom-killer-by-default
http://lwn.net/Articles/317814/
http://www.linuxdevcenter.com/pub/a/linux/2006/11/30/linux-out-of-memory.html?page=2

Other options would be moving any other processes that may use a substantial amount of RAM
to a different machine (if any), configuring RabbitMQ VM watermark to be lower [1] [2], provisioning more RAM or using more cluster nodes (I'm not qualified to answer if Celery will try to distribute
queues it uses between nodes).

1. http://www.rabbitmq.com/configure.html
2. http://www.rabbitmq.com/memory.html
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/c086d3a9/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug 15 11:34:04 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 Aug 2013 14:34:04 +0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
	and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <CA+0nT8BqWu-XXOEBvS-QypJoapsQuYtc1406N7bsyvOAOzQ2yg@mail.gmail.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
	<CA+0nT8BqWu-XXOEBvS-QypJoapsQuYtc1406N7bsyvOAOzQ2yg@mail.gmail.com>
Message-ID: <3F6AB00C-2B7E-4D00-B8C5-929ADCF75D0B@gopivotal.com>

Priyanki Vashi:

> I agree that my single producer is producing at constant rate but if I increase number of producers, upt to say 10, then I should be able to see proper usage of bandwidth right ?

With more producers on the same machine, you should see *higher* outgoing rate,
given that there are spare CPU resources.

Try MulticastMain and/or amqpc first.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/26708668/attachment.pgp>

From harel at thisisglow.com  Thu Aug 15 11:46:55 2013
From: harel at thisisglow.com (harel at thisisglow.com)
Date: Thu, 15 Aug 2013 03:46:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
Message-ID: <d87c3cff-1260-43d0-8b3a-b505f315ffb5@googlegroups.com>

We're seeing this happening too, though I did not think to check if the 
management plugin  was the culprit. We started using the plugin and its web 
interface around the time our rabbitmq crashes started happneing - all due 
to out of memory and being killed by the kernel.  We've disabled the 
management plugin and haven't seen the crashes yet though its too early to 
call. 


On Saturday, 15 June 2013 03:09:21 UTC+1, Travis Mehlinger wrote:
>
> We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two bug 
> fixes in 3.1.0 related to our RabbitMQ deployment:
>
>    - 25524 fix memory leak in mirror queue slave with many short-lived 
>    publishing channel
>    - 25290 fix per-queue memory leak recording stats for mirror queue 
>    slaves
>
> However, in our case, it seems that the management plugin may still have a 
> memory leak. We have a monitoring agent that hits the REST API to gather 
> information about the broker (number of queues, queue depth, etc.). With 
> the monitoring agent running and making requests against the API, memory 
> consumption steadily increased; when we stopped the agent, memory 
> consumption in the management plugin leveled off.
>
> Here a couple graphs detailing memory consumption in the broker (the 
> figures are parsed from rabbitmqctl report). The first graph shows the 
> ebb and flow of memory consumption in a number of components and the second 
> shows just consumption by the management plugin. You can see pretty clearly 
> where we stopped the monitoring agent at 1:20.
>
> https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png
> https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png
>
> We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang 
> R14B-04.1. There are typically around 200 queues, about 20 of which are 
> mirrored. There are generally about 200 consumers. Messages are rarely 
> queued and most queues typically sit idle.
>
> I'll be happy to provide any further diagnostic information.
>
> Thanks!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/d6ed7bac/attachment.htm>

From harel at thisisglow.com  Thu Aug 15 11:46:55 2013
From: harel at thisisglow.com (harel at thisisglow.com)
Date: Thu, 15 Aug 2013 03:46:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
Message-ID: <d87c3cff-1260-43d0-8b3a-b505f315ffb5@googlegroups.com>

We're seeing this happening too, though I did not think to check if the 
management plugin  was the culprit. We started using the plugin and its web 
interface around the time our rabbitmq crashes started happneing - all due 
to out of memory and being killed by the kernel.  We've disabled the 
management plugin and haven't seen the crashes yet though its too early to 
call. 


On Saturday, 15 June 2013 03:09:21 UTC+1, Travis Mehlinger wrote:
>
> We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two bug 
> fixes in 3.1.0 related to our RabbitMQ deployment:
>
>    - 25524 fix memory leak in mirror queue slave with many short-lived 
>    publishing channel
>    - 25290 fix per-queue memory leak recording stats for mirror queue 
>    slaves
>
> However, in our case, it seems that the management plugin may still have a 
> memory leak. We have a monitoring agent that hits the REST API to gather 
> information about the broker (number of queues, queue depth, etc.). With 
> the monitoring agent running and making requests against the API, memory 
> consumption steadily increased; when we stopped the agent, memory 
> consumption in the management plugin leveled off.
>
> Here a couple graphs detailing memory consumption in the broker (the 
> figures are parsed from rabbitmqctl report). The first graph shows the 
> ebb and flow of memory consumption in a number of components and the second 
> shows just consumption by the management plugin. You can see pretty clearly 
> where we stopped the monitoring agent at 1:20.
>
> https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png
> https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png
>
> We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang 
> R14B-04.1. There are typically around 200 queues, about 20 of which are 
> mirrored. There are generally about 200 consumers. Messages are rarely 
> queued and most queues typically sit idle.
>
> I'll be happy to provide any further diagnostic information.
>
> Thanks!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/d6ed7bac/attachment-0001.htm>

From simon at rabbitmq.com  Thu Aug 15 11:51:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Aug 2013 11:51:06 +0100
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <d87c3cff-1260-43d0-8b3a-b505f315ffb5@googlegroups.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<d87c3cff-1260-43d0-8b3a-b505f315ffb5@googlegroups.com>
Message-ID: <520CB29A.1060304@rabbitmq.com>

Note that the leak this thread was discussing was fixed in 3.1.2.

Cheers, Simon

On 15/08/13 11:46, harel at thisisglow.com wrote:
> We're seeing this happening too, though I did not think to check if the
> management plugin  was the culprit. We started using the plugin and its
> web interface around the time our rabbitmq crashes started happneing -
> all due to out of memory and being killed by the kernel.  We've disabled
> the management plugin and haven't seen the crashes yet though its too
> early to call.
>
>
> On Saturday, 15 June 2013 03:09:21 UTC+1, Travis Mehlinger wrote:
>
>     We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two
>     bug fixes in 3.1.0 related to our RabbitMQ deployment:
>
>       * 25524 fix memory leak in mirror queue slave with many
>         short-lived publishing channel
>       * 25290 fix per-queue memory leak recording stats for mirror queue
>         slaves
>
>     However, in our case, it seems that the management plugin may still
>     have a memory leak. We have a monitoring agent that hits the REST
>     API to gather information about the broker (number of queues, queue
>     depth, etc.). With the monitoring agent running and making requests
>     against the API, memory consumption steadily increased; when we
>     stopped the agent, memory consumption in the management plugin
>     leveled off.
>
>     Here a couple graphs detailing memory consumption in the broker (the
>     figures are parsed from rabbitmqctl report). The first graph shows
>     the ebb and flow of memory consumption in a number of components and
>     the second shows just consumption by the management plugin. You can
>     see pretty clearly where we stopped the monitoring agent at 1:20.
>
>     https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png
>     <https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>
>     https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png
>     <https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>
>
>     We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang
>     R14B-04.1. There are typically around 200 queues, about 20 of which
>     are mirrored. There are generally about 200 consumers. Messages are
>     rarely queued and most queues typically sit idle.
>
>     I'll be happy to provide any further diagnostic information.
>
>     Thanks!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Thu Aug 15 11:55:08 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 15 Aug 2013 06:55:08 -0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <3F6AB00C-2B7E-4D00-B8C5-929ADCF75D0B@gopivotal.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
	<CA+0nT8BqWu-XXOEBvS-QypJoapsQuYtc1406N7bsyvOAOzQ2yg@mail.gmail.com>
	<3F6AB00C-2B7E-4D00-B8C5-929ADCF75D0B@gopivotal.com>
Message-ID: <CAKgmDnHj4TdEv5-KfHrnRq8oWoBxE080kvOfWDiVAT925N5F0w@mail.gmail.com>

Be sure to use the async TornadoConnection or LibevConnection with pika
which can give an order of magnitude better performance for publish-heavy
workloads in my testing. Using pypy will provide a another boost.


On Thu, Aug 15, 2013 at 6:34 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Priyanki Vashi:
>
> > I agree that my single producer is producing at constant rate but if I
> increase number of producers, upt to say 10, then I should be able to see
> proper usage of bandwidth right ?
>
> With more producers on the same machine, you should see *higher* outgoing
> rate,
> given that there are spare CPU resources.
>
> Try MulticastMain and/or amqpc first.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/91d2e3a8/attachment.htm>

From simon at rabbitmq.com  Thu Aug 15 12:31:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Aug 2013 12:31:02 +0100
Subject: [rabbitmq-discuss] rabbit federation is failing
In-Reply-To: <520BB5B7.2050205@mobbit.com>
References: <520BB5B7.2050205@mobbit.com>
Message-ID: <520CBBF6.7000707@rabbitmq.com>

It's not obvious that those errors have anything to do with your problem.

The first one is an inbound connection being dropped due to its 
heartbeat being missed.

The second is an error which (unfortunately) happens whenever a 
federation link comes up; it needs to ensure that an exchange does not 
exist, so it tries to delete it - if it already did not exist we log an 
error.

Federation should always re-establish links that have failed.

So when you say it stopped working, what happened? Is 192.168.1.200 the 
upstream, downstream or both? What does the link status reporting say? 
(http://www.rabbitmq.com/federation.html#status)

Cheers, Simon

On 14/08/13 17:52, Joao Gomes Pereira wrote:
> Hello
> I implemented a rabbit federation to exchange SMS messages between
> diferent servers.
> After working fine for some days, one of my nodes (192.168.1.200) just
> stopped working.
>
> We can see some errors in the node log:
>
>
> =INFO REPORT==== 13-Aug-2013::14:01:31 ===
> Federation exchange 'LX' in vhost '/' connected to exchange 'LX' in
> vhost '/' on amqp://94.46.208.100
>
> =ERROR REPORT==== 13-Aug-2013::14:03:46 ===
> closing AMQP connection <0.5257.0> (94.46.208.98:45341 ->
> 192.168.1.200:5672):
> {heartbeat_timeout,running}
>
> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
> accepting AMQP connection <0.5960.0> (94.46.208.98:60137 ->
> 192.168.1.200:5672)
>
> =ERROR REPORT==== 13-Aug-2013::14:09:27 ===
> connection <0.5960.0>, channel 3 - soft error:
> {amqp_error,not_found,
>              "no exchange 'federation: SMS_System ->
> SMSDriver+Dispatcher-rabbit at insight-DISP-rabbit02 B' in vhost '/'",
>              'exchange.delete'}
>
> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
> accepting AMQP connection <0.5978.0> (94.46.208.98:20734 ->
> 192.168.1.200:5672)
>
> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
> closing AMQP connection <0.5978.0> (94.46.208.98:20734 ->
> 192.168.1.200:5672)
>
>
>
>
> How can I configure my node to be always federated?
>
> Thanks
> regards
> Joao Pereira
>
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Aug 15 12:33:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Aug 2013 12:33:39 +0100
Subject: [rabbitmq-discuss] How to set trace_on durably?
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D37FF40@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D37FF40@FR44EX3005.global.ds.honeywell.com>
Message-ID: <520CBC93.3020801@rabbitmq.com>

On 14/08/13 18:55, Gotthard, Petr wrote:
> Is there be a way to durably enable tracing for a given virtual host?
> Instead calling rabbitmqctl each time the broker is started.

There's no official way.

> There is a ?trace_vhosts? configuration option, but it is marked as
> internal. Could I use it somehow?

But you might get away with using that. Try something like:

[{rabbit, [{trace_vhosts, [<<"/">>, <<"my-vhost">>]}]}].

or whatever.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From vashi.priyanki at gmail.com  Thu Aug 15 13:20:49 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Thu, 15 Aug 2013 05:20:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Tornado Consumer example problem
Message-ID: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>

Hi There ,

This might be very basic error but since I am trying to use Tornado 
connection for the first time, help on this would be appreciated. 

I was trying to use Tornado consumer example given on following pika site.

https://pika.readthedocs.org/en/0.9.13/examples/tornado_consumer.html

I am running into following error. The example is with URL connection 
method. 
But I also tried to use hostname and port method as well as tried changing 
to IP address instead of hostname but still it's the same error. 

I have pika 0.9.13 library installed. My consumer & Producer works fine 
with select.connection method so I believe library is correctly installed.

Do I need to do something additional to get tornado connection working for 
both producer and consumer with pika?

Please suggest.

mq1 at mqserver1:~/Producer_Receiver/Latest$ python tornedo_c_1.py
Traceback (most recent call last):
  File "tornedo_c_1.py", line 357, in <module>
    main()
  File "tornedo_c_1.py", line 351, in main
    example.run()
  File "tornedo_c_1.py", line 326, in run
    self._connection = self.connect()
  File "tornedo_c_1.py", line 59, in connect
    adapters.TornadoConnection(self.parameters, self.on_connection_open, 
stop_ioloop_on_close=False)
TypeError: 'NoneType' object is not callable


Best Regards,
Priyanki.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/9bfb20df/attachment.htm>

From emile at rabbitmq.com  Thu Aug 15 14:15:49 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 15 Aug 2013 14:15:49 +0100
Subject: [rabbitmq-discuss] rabbitmq 3.1.4 upgrade lost cluster config
In-Reply-To: <20130814191717.GA18453@red-sonja>
References: <20130813212025.GA15669@red-sonja> <520B90BC.1020700@rabbitmq.com>
	<20130814191717.GA18453@red-sonja>
Message-ID: <520CD485.1010605@rabbitmq.com>

Hi,

On 14/08/13 20:17, Morty wrote:
> This looks to me like a code bug.

Would you be able to provide the sequence of commands to reproduce?
Can it be reproduced reliably? If you have backups of the pre-upgrade
database directories then it should be possible to re-run the upgrade.




-Emile




From ask at rabbitmq.com  Thu Aug 15 14:25:21 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 15 Aug 2013 14:25:21 +0100
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
Message-ID: <B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>


On Aug 15, 2013, at 1:20 PM, Priyanki Vashi <vashi.priyanki at gmail.com> wrote:

> Hi There ,
> 
> This might be very basic error but since I am trying to use Tornado connection for the first time, help on this would be appreciated. 
> 
> I was trying to use Tornado consumer example given on following pika site.
> 
> https://pika.readthedocs.org/en/0.9.13/examples/tornado_consumer.html
> 
> I am running into following error. The example is with URL connection method. 
> But I also tried to use hostname and port method as well as tried changing to IP address instead of hostname but still it's the same error. 
> 
> I have pika 0.9.13 library installed. My consumer & Producer works fine with select.connection method so I believe library is correctly installed.
> 
> Do I need to do something additional to get tornado connection working for both producer and consumer with pika?
> 
> Please suggest.
> 
> mq1 at mqserver1:~/Producer_Receiver/Latest$ python tornedo_c_1.py
> Traceback (most recent call last):
>   File "tornedo_c_1.py", line 357, in <module>
>     main()
>   File "tornedo_c_1.py", line 351, in main
>     example.run()
>   File "tornedo_c_1.py", line 326, in run
>     self._connection = self.connect()
>   File "tornedo_c_1.py", line 59, in connect
>     adapters.TornadoConnection(self.parameters, self.on_connection_open, stop_ioloop_on_close=False)
> TypeError: 'NoneType' object is not callable


Maybe you passed None as a callback somewhere?  What is the value of on_connection_open for example?


From vashi.priyanki at gmail.com  Thu Aug 15 14:51:50 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Thu, 15 Aug 2013 15:51:50 +0200
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
Message-ID: <CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>

Hi ,

on_connection_open, is a callback method, which will be called when
connection is opened with rabbitmq. It opens channel inturn. So it's little
unlikely that it has 'None' value but I am not 100% sure.

Here is my code. Could you quickly have a look.
It's the same example from pika site for tornado consumer except that I
have tried to use connection parameters instead of URL.


from pika import adapters
import pika
import logging

LOG_FORMAT = ('%(levelname) -10s %(asctime)s %(name) -30s %(funcName) '
              '-35s %(lineno) -5d: %(message)s')
LOGGER = logging.getLogger(__name__)


class ExampleConsumer(object):
    """This is an example consumer that will handle unexpected interactions
    with RabbitMQ such as channel and connection closures.

    If RabbitMQ closes the connection, it will reopen it. You should
    look at the output, as there are limited reasons why the connection may
    be closed, which usually are tied to permission related issues or
    socket timeouts.

    If the channel is closed, it will indicate a problem with one of the
    commands that were issued and that should surface in the output as well.

    """
    EXCHANGE = 'message'
    EXCHANGE_TYPE = 'topic'
    QUEUE = 'text'
    ROUTING_KEY = 'example.text'




    def __init__(self, host, port, username, password):
        """Setup the example publisher object, passing in the URL we will
use
        to connect to RabbitMQ.

        :param str amqp_url: The URL for connecting to RabbitMQ

        """

        self._connection = None
        self._channel = None
        self._closing = False
        self._consumer_tag = None
        #self._url = amqp_url

        self.credentials = pika.PlainCredentials(username=username,
password=password)
        self.parameters = pika.ConnectionParameters(host=host, port=port,
credentials=self.credentials)



    def connect(self):
        """This method connects to RabbitMQ, returning the connection
handle.
        When the connection is established, the on_connection_open method
        will be invoked by pika.

        :rtype: pika.SelectConnection

        """
        #LOGGER.info('Connecting to %s', self._url)
        adapters.TornadoConnection(self.parameters,
on_open_callback=self.on_connection_open, stop_ioloop_on_close=False)
        #return
adapters.TornadoConnection(pika.URLParameters(self._url),self.on_connection_open)

    def close_connection(self):
        """This method closes the connection to RabbitMQ."""
        LOGGER.info('Closing connection')
        self._connection.close()

    def add_on_connection_close_callback(self):
        """This method adds an on close callback that will be invoked by
pika
        when RabbitMQ closes the connection to the publisher unexpectedly.

        """
        LOGGER.info('Adding connection close callback')
        self._connection.add_on_close_callback(self.on_connection_closed)

    def on_connection_closed(self, connection, reply_code, reply_text):
        """This method is invoked by pika when the connection to RabbitMQ is
        closed unexpectedly. Since it is unexpected, we will reconnect to
        RabbitMQ if it disconnects.

        :param pika.connection.Connection connection: The closed connection
obj
        :param int reply_code: The server provided reply_code if given
        :param str reply_text: The server provided reply_text if given

        """
        self._channel = None
        if self._closing:
            self._connection.ioloop.stop()
        else:
            LOGGER.warning('Connection closed, reopening in 5 seconds: (%s)
%s',
                           reply_code, reply_text)
            self._connection.add_timeout(5, self.reconnect)

    def on_connection_open(self, unused_connection):
        """This method is called by pika once the connection to RabbitMQ has
        been established. It passes the handle to the connection object in
        case we need it, but in this case, we'll just mark it unused.

        :type unused_connection: pika.SelectConnection

        """
        LOGGER.info('Connection opened')
        self.add_on_connection_close_callback()
        self.open_channel()

    def reconnect(self):
        """Will be invoked by the IOLoop timer if the connection is
        closed. See the on_connection_closed method.

        """
        # This is the old connection IOLoop instance, stop its ioloop
        self._connection.ioloop.stop()

        if not self._closing:

            # Create a new connection
            self._connection = self.connect()

            # There is now a new connection, needs a new ioloop to run
            self._connection.ioloop.start()

    def add_on_channel_close_callback(self):
        """This method tells pika to call the on_channel_closed method if
        RabbitMQ unexpectedly closes the channel.

        """
        LOGGER.info('Adding channel close callback')
        self._channel.add_on_close_callback(self.on_channel_closed)

    def on_channel_closed(self, channel, reply_code, reply_text):
        """Invoked by pika when RabbitMQ unexpectedly closes the channel.
        Channels are usually closed if you attempt to do something that
        violates the protocol, such as re-declare an exchange or queue with
        different parameters. In this case, we'll close the connection
        to shutdown the object.

        :param pika.channel.Channel: The closed channel
        :param int reply_code: The numeric reason the channel was closed
        :param str reply_text: The text reason the channel was closed

        """
        LOGGER.warning('Channel %i was closed: (%s) %s',
                       channel, reply_code, reply_text)
        self._connection.close()

    def on_channel_open(self, channel):
        """This method is invoked by pika when the channel has been opened.
        The channel object is passed in so we can make use of it.

        Since the channel is now open, we'll declare the exchange to use.

        :param pika.channel.Channel channel: The channel object

        """
        LOGGER.info('Channel opened')
        self._channel = channel
        self.add_on_channel_close_callback()
        self.setup_exchange(self.EXCHANGE)

    def setup_exchange(self, exchange_name):
        """Setup the exchange on RabbitMQ by invoking the Exchange.Declare
RPC
        command. When it is complete, the on_exchange_declareok method will
        be invoked by pika.

        :param str|unicode exchange_name: The name of the exchange to
declare

        """
        LOGGER.info('Declaring exchange %s', exchange_name)
        self._channel.exchange_declare(self.on_exchange_declareok,
                                       exchange_name,
                                       self.EXCHANGE_TYPE)

    def on_exchange_declareok(self, unused_frame):
        """Invoked by pika when RabbitMQ has finished the Exchange.Declare
RPC
        command.

        :param pika.Frame.Method unused_frame: Exchange.DeclareOk response
frame

        """
        LOGGER.info('Exchange declared')
        self.setup_queue(self.QUEUE)

    def setup_queue(self, queue_name):
        """Setup the queue on RabbitMQ by invoking the Queue.Declare RPC
        command. When it is complete, the on_queue_declareok method will
        be invoked by pika.

        :param str|unicode queue_name: The name of the queue to declare.

        """
        LOGGER.info('Declaring queue %s', queue_name)
        self._channel.queue_declare(self.on_queue_declareok, queue_name)

    def on_queue_declareok(self, method_frame):
        """Method invoked by pika when the Queue.Declare RPC call made in
        setup_queue has completed. In this method we will bind the queue
        and exchange together with the routing key by issuing the Queue.Bind
        RPC command. When this command is complete, the on_bindok method
will
        be invoked by pika.

        :param pika.frame.Method method_frame: The Queue.DeclareOk frame

        """
        LOGGER.info('Binding %s to %s with %s',
                    self.EXCHANGE, self.QUEUE, self.ROUTING_KEY)
        self._channel.queue_bind(self.on_bindok, self.QUEUE,
                                 self.EXCHANGE, self.ROUTING_KEY)

    def add_on_cancel_callback(self):
        """Add a callback that will be invoked if RabbitMQ cancels the
consumer
        for some reason. If RabbitMQ does cancel the consumer,
        on_consumer_cancelled will be invoked by pika.

        """
        LOGGER.info('Adding consumer cancellation callback')
        self._channel.add_on_cancel_callback(self.on_consumer_cancelled)

    def on_consumer_cancelled(self, method_frame):
        """Invoked by pika when RabbitMQ sends a Basic.Cancel for a consumer
        receiving messages.

        :param pika.frame.Method method_frame: The Basic.Cancel frame

        """
        LOGGER.info('Consumer was cancelled remotely, shutting down: %r',
                    method_frame)
        if self._channel:
            self._channel.close()

    def acknowledge_message(self, delivery_tag):
        """Acknowledge the message delivery from RabbitMQ by sending a
        Basic.Ack RPC method for the delivery tag.

        :param int delivery_tag: The delivery tag from the Basic.Deliver
frame

        """
        LOGGER.info('Acknowledging message %s', delivery_tag)
        self._channel.basic_ack(delivery_tag)

    def on_message(self, unused_channel, basic_deliver, properties, body):
        """Invoked by pika when a message is delivered from RabbitMQ. The
        channel is passed for your convenience. The basic_deliver object
that
        is passed in carries the exchange, routing key, delivery tag and
        a redelivered flag for the message. The properties passed in is an
        instance of BasicProperties with the message properties and the body
        is the message that was sent.

        :param pika.channel.Channel unused_channel: The channel object
        :param pika.Spec.Basic.Deliver: basic_deliver method
        :param pika.Spec.BasicProperties: properties
        :param str|unicode body: The message body

        """
        LOGGER.info('Received message # %s from %s: %s',
                    basic_deliver.delivery_tag, properties.app_id, body)
        self.acknowledge_message(basic_deliver.delivery_tag)

    def on_cancelok(self, unused_frame):
        """This method is invoked by pika when RabbitMQ acknowledges the
        cancellation of a consumer. At this point we will close the channel.
        This will invoke the on_channel_closed method once the channel has
been
        closed, which will in-turn close the connection.

        :param pika.frame.Method unused_frame: The Basic.CancelOk frame

        """
        LOGGER.info('RabbitMQ acknowledged the cancellation of the
consumer')
        self.close_channel()

    def stop_consuming(self):
        """Tell RabbitMQ that you would like to stop consuming by sending
the
        Basic.Cancel RPC command.

        """
        if self._channel:
            LOGGER.info('Sending a Basic.Cancel RPC command to RabbitMQ')
            self._channel.basic_cancel(self.on_cancelok, self._consumer_tag)

    def start_consuming(self):
        """This method sets up the consumer by first calling
        add_on_cancel_callback so that the object is notified if RabbitMQ
        cancels the consumer. It then issues the Basic.Consume RPC command
        which returns the consumer tag that is used to uniquely identify the
        consumer with RabbitMQ. We keep the value to use it when we want to
        cancel consuming. The on_message method is passed in as a callback
pika
        will invoke when a message is fully received.

        """
        LOGGER.info('Issuing consumer related RPC commands')
        self.add_on_cancel_callback()
        self._consumer_tag = self._channel.basic_consume(self.on_message,
                                                         self.QUEUE)

    def on_bindok(self, unused_frame):
        """Invoked by pika when the Queue.Bind method has completed. At this
        point we will start consuming messages by calling start_consuming
        which will invoke the needed RPC commands to start the process.

        :param pika.frame.Method unused_frame: The Queue.BindOk response
frame

        """
        LOGGER.info('Queue bound')
        self.start_consuming()

    def close_channel(self):
        """Call to close the channel with RabbitMQ cleanly by issuing the
        Channel.Close RPC command.

        """
        LOGGER.info('Closing the channel')
        self._channel.close()

    def open_channel(self):
        """Open a new channel with RabbitMQ by issuing the Channel.Open RPC
        command. When RabbitMQ responds that the channel is open, the
        on_channel_open callback will be invoked by pika.

        """
        LOGGER.info('Creating a new channel')
        self._connection.channel(on_open_callback=self.on_channel_open)

    def run(self):
        """Run the example consumer by connecting to RabbitMQ and then
        starting the IOLoop to block and allow the SelectConnection to
operate.

        """
        self._connection = self.connect()
        self._connection.ioloop.start()

    def stop(self):
        """Cleanly shutdown the connection to RabbitMQ by stopping the
consumer
        with RabbitMQ. When RabbitMQ confirms the cancellation, on_cancelok
        will be invoked by pika, which will then closing the channel and
        connection. The IOLoop is started again because this method is
invoked
        when CTRL-C is pressed raising a KeyboardInterrupt exception. This
        exception stops the IOLoop which needs to be running for pika to
        communicate with RabbitMQ. All of the commands issued prior to
starting
        the IOLoop will be buffered but not processed.

        """
        LOGGER.info('Stopping')
        self._closing = True
        self.stop_consuming()
        self._connection.ioloop.start()
        LOGGER.info('Stopped')


def main():
    logging.basicConfig(level=logging.INFO, format=LOG_FORMAT)
    example = ExampleConsumer('mqserver10', 5672, 'guest', 'guest')
    try:
        example.run()
    except KeyboardInterrupt:
        example.stop()


if __name__ == '__main__':
    main()


On Thu, Aug 15, 2013 at 3:25 PM, Ask Solem <ask at rabbitmq.com> wrote:

>
> On Aug 15, 2013, at 1:20 PM, Priyanki Vashi <vashi.priyanki at gmail.com>
> wrote:
>
> > Hi There ,
> >
> > This might be very basic error but since I am trying to use Tornado
> connection for the first time, help on this would be appreciated.
> >
> > I was trying to use Tornado consumer example given on following pika
> site.
> >
> > https://pika.readthedocs.org/en/0.9.13/examples/tornado_consumer.html
> >
> > I am running into following error. The example is with URL connection
> method.
> > But I also tried to use hostname and port method as well as tried
> changing to IP address instead of hostname but still it's the same error.
> >
> > I have pika 0.9.13 library installed. My consumer & Producer works fine
> with select.connection method so I believe library is correctly installed.
> >
> > Do I need to do something additional to get tornado connection working
> for both producer and consumer with pika?
> >
> > Please suggest.
> >
> > mq1 at mqserver1:~/Producer_Receiver/Latest$ python tornedo_c_1.py
> > Traceback (most recent call last):
> >   File "tornedo_c_1.py", line 357, in <module>
> >     main()
> >   File "tornedo_c_1.py", line 351, in main
> >     example.run()
> >   File "tornedo_c_1.py", line 326, in run
> >     self._connection = self.connect()
> >   File "tornedo_c_1.py", line 59, in connect
> >     adapters.TornadoConnection(self.parameters, self.on_connection_open,
> stop_ioloop_on_close=False)
> > TypeError: 'NoneType' object is not callable
>
>
> Maybe you passed None as a callback somewhere?  What is the value of
> on_connection_open for example?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/86381480/attachment.htm>

From simon at rabbitmq.com  Thu Aug 15 15:14:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Aug 2013 15:14:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.5 released
Message-ID: <520CE24C.9000907@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.1.5.

This release fixes a bug in the delegate module leading to various 
crashes and cross-cluster minor version incompatibility, along with some 
other smaller bugs. See:

http://www.rabbitmq.com/release-notes/README-3.1.5.txt

for more information.

Note that due to the above mentioned bug, RabbitMQ 3.1.4 cannot be 
deployed in a cluster with other RabbitMQ 3.1.x versions. 3.1.5 can be 
deployed in a cluster with with 3.1.0 to 3.1.3.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)

From michael.laing at nytimes.com  Thu Aug 15 15:25:23 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 15 Aug 2013 10:25:23 -0400
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
	<CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
Message-ID: <CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>

The connect method doesn't apear to return a connection...


On Thu, Aug 15, 2013 at 9:51 AM, Priyanki Vashi <vashi.priyanki at gmail.com>wrote:

> Hi ,
>
> on_connection_open, is a callback method, which will be called when
> connection is opened with rabbitmq. It opens channel inturn. So it's little
> unlikely that it has 'None' value but I am not 100% sure.
>
> Here is my code. Could you quickly have a look.
> It's the same example from pika site for tornado consumer except that I
> have tried to use connection parameters instead of URL.
>
>
> from pika import adapters
> import pika
> import logging
>
> LOG_FORMAT = ('%(levelname) -10s %(asctime)s %(name) -30s %(funcName) '
>               '-35s %(lineno) -5d: %(message)s')
> LOGGER = logging.getLogger(__name__)
>
>
> class ExampleConsumer(object):
>     """This is an example consumer that will handle unexpected interactions
>     with RabbitMQ such as channel and connection closures.
>
>     If RabbitMQ closes the connection, it will reopen it. You should
>     look at the output, as there are limited reasons why the connection may
>     be closed, which usually are tied to permission related issues or
>     socket timeouts.
>
>     If the channel is closed, it will indicate a problem with one of the
>     commands that were issued and that should surface in the output as
> well.
>
>     """
>     EXCHANGE = 'message'
>     EXCHANGE_TYPE = 'topic'
>     QUEUE = 'text'
>     ROUTING_KEY = 'example.text'
>
>
>
>
>     def __init__(self, host, port, username, password):
>         """Setup the example publisher object, passing in the URL we will
> use
>         to connect to RabbitMQ.
>
>         :param str amqp_url: The URL for connecting to RabbitMQ
>
>         """
>
>         self._connection = None
>         self._channel = None
>         self._closing = False
>         self._consumer_tag = None
>         #self._url = amqp_url
>
>         self.credentials = pika.PlainCredentials(username=username,
> password=password)
>         self.parameters = pika.ConnectionParameters(host=host, port=port,
> credentials=self.credentials)
>
>
>
>     def connect(self):
>         """This method connects to RabbitMQ, returning the connection
> handle.
>         When the connection is established, the on_connection_open method
>         will be invoked by pika.
>
>         :rtype: pika.SelectConnection
>
>         """
>         #LOGGER.info('Connecting to %s', self._url)
>         adapters.TornadoConnection(self.parameters,
> on_open_callback=self.on_connection_open, stop_ioloop_on_close=False)
>         #return
> adapters.TornadoConnection(pika.URLParameters(self._url),self.on_connection_open)
>
>     def close_connection(self):
>         """This method closes the connection to RabbitMQ."""
>         LOGGER.info('Closing connection')
>         self._connection.close()
>
>     def add_on_connection_close_callback(self):
>         """This method adds an on close callback that will be invoked by
> pika
>         when RabbitMQ closes the connection to the publisher unexpectedly.
>
>         """
>         LOGGER.info('Adding connection close callback')
>         self._connection.add_on_close_callback(self.on_connection_closed)
>
>     def on_connection_closed(self, connection, reply_code, reply_text):
>         """This method is invoked by pika when the connection to RabbitMQ
> is
>         closed unexpectedly. Since it is unexpected, we will reconnect to
>         RabbitMQ if it disconnects.
>
>         :param pika.connection.Connection connection: The closed
> connection obj
>         :param int reply_code: The server provided reply_code if given
>         :param str reply_text: The server provided reply_text if given
>
>         """
>         self._channel = None
>         if self._closing:
>             self._connection.ioloop.stop()
>         else:
>             LOGGER.warning('Connection closed, reopening in 5 seconds:
> (%s) %s',
>                            reply_code, reply_text)
>             self._connection.add_timeout(5, self.reconnect)
>
>     def on_connection_open(self, unused_connection):
>         """This method is called by pika once the connection to RabbitMQ
> has
>         been established. It passes the handle to the connection object in
>         case we need it, but in this case, we'll just mark it unused.
>
>         :type unused_connection: pika.SelectConnection
>
>         """
>         LOGGER.info('Connection opened')
>         self.add_on_connection_close_callback()
>         self.open_channel()
>
>     def reconnect(self):
>         """Will be invoked by the IOLoop timer if the connection is
>         closed. See the on_connection_closed method.
>
>         """
>         # This is the old connection IOLoop instance, stop its ioloop
>         self._connection.ioloop.stop()
>
>         if not self._closing:
>
>             # Create a new connection
>             self._connection = self.connect()
>
>             # There is now a new connection, needs a new ioloop to run
>             self._connection.ioloop.start()
>
>     def add_on_channel_close_callback(self):
>         """This method tells pika to call the on_channel_closed method if
>         RabbitMQ unexpectedly closes the channel.
>
>         """
>         LOGGER.info('Adding channel close callback')
>         self._channel.add_on_close_callback(self.on_channel_closed)
>
>     def on_channel_closed(self, channel, reply_code, reply_text):
>         """Invoked by pika when RabbitMQ unexpectedly closes the channel.
>         Channels are usually closed if you attempt to do something that
>         violates the protocol, such as re-declare an exchange or queue with
>         different parameters. In this case, we'll close the connection
>         to shutdown the object.
>
>         :param pika.channel.Channel: The closed channel
>         :param int reply_code: The numeric reason the channel was closed
>         :param str reply_text: The text reason the channel was closed
>
>         """
>         LOGGER.warning('Channel %i was closed: (%s) %s',
>                        channel, reply_code, reply_text)
>         self._connection.close()
>
>     def on_channel_open(self, channel):
>         """This method is invoked by pika when the channel has been opened.
>         The channel object is passed in so we can make use of it.
>
>         Since the channel is now open, we'll declare the exchange to use.
>
>         :param pika.channel.Channel channel: The channel object
>
>         """
>         LOGGER.info('Channel opened')
>         self._channel = channel
>         self.add_on_channel_close_callback()
>         self.setup_exchange(self.EXCHANGE)
>
>     def setup_exchange(self, exchange_name):
>         """Setup the exchange on RabbitMQ by invoking the Exchange.Declare
> RPC
>         command. When it is complete, the on_exchange_declareok method will
>         be invoked by pika.
>
>         :param str|unicode exchange_name: The name of the exchange to
> declare
>
>         """
>         LOGGER.info('Declaring exchange %s', exchange_name)
>         self._channel.exchange_declare(self.on_exchange_declareok,
>                                        exchange_name,
>                                        self.EXCHANGE_TYPE)
>
>     def on_exchange_declareok(self, unused_frame):
>         """Invoked by pika when RabbitMQ has finished the Exchange.Declare
> RPC
>         command.
>
>         :param pika.Frame.Method unused_frame: Exchange.DeclareOk response
> frame
>
>         """
>         LOGGER.info('Exchange declared')
>         self.setup_queue(self.QUEUE)
>
>     def setup_queue(self, queue_name):
>         """Setup the queue on RabbitMQ by invoking the Queue.Declare RPC
>         command. When it is complete, the on_queue_declareok method will
>         be invoked by pika.
>
>         :param str|unicode queue_name: The name of the queue to declare.
>
>         """
>         LOGGER.info('Declaring queue %s', queue_name)
>         self._channel.queue_declare(self.on_queue_declareok, queue_name)
>
>     def on_queue_declareok(self, method_frame):
>         """Method invoked by pika when the Queue.Declare RPC call made in
>         setup_queue has completed. In this method we will bind the queue
>         and exchange together with the routing key by issuing the
> Queue.Bind
>         RPC command. When this command is complete, the on_bindok method
> will
>         be invoked by pika.
>
>         :param pika.frame.Method method_frame: The Queue.DeclareOk frame
>
>         """
>         LOGGER.info('Binding %s to %s with %s',
>                     self.EXCHANGE, self.QUEUE, self.ROUTING_KEY)
>         self._channel.queue_bind(self.on_bindok, self.QUEUE,
>                                  self.EXCHANGE, self.ROUTING_KEY)
>
>     def add_on_cancel_callback(self):
>         """Add a callback that will be invoked if RabbitMQ cancels the
> consumer
>         for some reason. If RabbitMQ does cancel the consumer,
>         on_consumer_cancelled will be invoked by pika.
>
>         """
>         LOGGER.info('Adding consumer cancellation callback')
>         self._channel.add_on_cancel_callback(self.on_consumer_cancelled)
>
>     def on_consumer_cancelled(self, method_frame):
>         """Invoked by pika when RabbitMQ sends a Basic.Cancel for a
> consumer
>         receiving messages.
>
>         :param pika.frame.Method method_frame: The Basic.Cancel frame
>
>         """
>         LOGGER.info('Consumer was cancelled remotely, shutting down: %r',
>                     method_frame)
>         if self._channel:
>             self._channel.close()
>
>     def acknowledge_message(self, delivery_tag):
>         """Acknowledge the message delivery from RabbitMQ by sending a
>         Basic.Ack RPC method for the delivery tag.
>
>         :param int delivery_tag: The delivery tag from the Basic.Deliver
> frame
>
>         """
>         LOGGER.info('Acknowledging message %s', delivery_tag)
>         self._channel.basic_ack(delivery_tag)
>
>     def on_message(self, unused_channel, basic_deliver, properties, body):
>         """Invoked by pika when a message is delivered from RabbitMQ. The
>         channel is passed for your convenience. The basic_deliver object
> that
>         is passed in carries the exchange, routing key, delivery tag and
>         a redelivered flag for the message. The properties passed in is an
>         instance of BasicProperties with the message properties and the
> body
>         is the message that was sent.
>
>         :param pika.channel.Channel unused_channel: The channel object
>         :param pika.Spec.Basic.Deliver: basic_deliver method
>         :param pika.Spec.BasicProperties: properties
>         :param str|unicode body: The message body
>
>         """
>         LOGGER.info('Received message # %s from %s: %s',
>                     basic_deliver.delivery_tag, properties.app_id, body)
>         self.acknowledge_message(basic_deliver.delivery_tag)
>
>     def on_cancelok(self, unused_frame):
>         """This method is invoked by pika when RabbitMQ acknowledges the
>         cancellation of a consumer. At this point we will close the
> channel.
>         This will invoke the on_channel_closed method once the channel has
> been
>         closed, which will in-turn close the connection.
>
>         :param pika.frame.Method unused_frame: The Basic.CancelOk frame
>
>         """
>         LOGGER.info('RabbitMQ acknowledged the cancellation of the
> consumer')
>         self.close_channel()
>
>     def stop_consuming(self):
>         """Tell RabbitMQ that you would like to stop consuming by sending
> the
>         Basic.Cancel RPC command.
>
>         """
>         if self._channel:
>             LOGGER.info('Sending a Basic.Cancel RPC command to RabbitMQ')
>             self._channel.basic_cancel(self.on_cancelok,
> self._consumer_tag)
>
>     def start_consuming(self):
>         """This method sets up the consumer by first calling
>         add_on_cancel_callback so that the object is notified if RabbitMQ
>         cancels the consumer. It then issues the Basic.Consume RPC command
>         which returns the consumer tag that is used to uniquely identify
> the
>         consumer with RabbitMQ. We keep the value to use it when we want to
>         cancel consuming. The on_message method is passed in as a callback
> pika
>         will invoke when a message is fully received.
>
>         """
>         LOGGER.info('Issuing consumer related RPC commands')
>         self.add_on_cancel_callback()
>         self._consumer_tag = self._channel.basic_consume(self.on_message,
>                                                          self.QUEUE)
>
>      def on_bindok(self, unused_frame):
>         """Invoked by pika when the Queue.Bind method has completed. At
> this
>         point we will start consuming messages by calling start_consuming
>         which will invoke the needed RPC commands to start the process.
>
>         :param pika.frame.Method unused_frame: The Queue.BindOk response
> frame
>
>         """
>         LOGGER.info('Queue bound')
>         self.start_consuming()
>
>     def close_channel(self):
>         """Call to close the channel with RabbitMQ cleanly by issuing the
>         Channel.Close RPC command.
>
>         """
>         LOGGER.info('Closing the channel')
>         self._channel.close()
>
>     def open_channel(self):
>         """Open a new channel with RabbitMQ by issuing the Channel.Open RPC
>         command. When RabbitMQ responds that the channel is open, the
>         on_channel_open callback will be invoked by pika.
>
>         """
>         LOGGER.info('Creating a new channel')
>         self._connection.channel(on_open_callback=self.on_channel_open)
>
>     def run(self):
>         """Run the example consumer by connecting to RabbitMQ and then
>         starting the IOLoop to block and allow the SelectConnection to
> operate.
>
>         """
>         self._connection = self.connect()
>         self._connection.ioloop.start()
>
>     def stop(self):
>         """Cleanly shutdown the connection to RabbitMQ by stopping the
> consumer
>         with RabbitMQ. When RabbitMQ confirms the cancellation, on_cancelok
>         will be invoked by pika, which will then closing the channel and
>         connection. The IOLoop is started again because this method is
> invoked
>         when CTRL-C is pressed raising a KeyboardInterrupt exception. This
>         exception stops the IOLoop which needs to be running for pika to
>         communicate with RabbitMQ. All of the commands issued prior to
> starting
>         the IOLoop will be buffered but not processed.
>
>         """
>         LOGGER.info('Stopping')
>         self._closing = True
>         self.stop_consuming()
>         self._connection.ioloop.start()
>         LOGGER.info('Stopped')
>
>
> def main():
>     logging.basicConfig(level=logging.INFO, format=LOG_FORMAT)
>     example = ExampleConsumer('mqserver10', 5672, 'guest', 'guest')
>     try:
>         example.run()
>     except KeyboardInterrupt:
>         example.stop()
>
>
> if __name__ == '__main__':
>     main()
>
>
> On Thu, Aug 15, 2013 at 3:25 PM, Ask Solem <ask at rabbitmq.com> wrote:
>
>>
>> On Aug 15, 2013, at 1:20 PM, Priyanki Vashi <vashi.priyanki at gmail.com>
>> wrote:
>>
>> > Hi There ,
>> >
>> > This might be very basic error but since I am trying to use Tornado
>> connection for the first time, help on this would be appreciated.
>> >
>> > I was trying to use Tornado consumer example given on following pika
>> site.
>> >
>> > https://pika.readthedocs.org/en/0.9.13/examples/tornado_consumer.html
>> >
>> > I am running into following error. The example is with URL connection
>> method.
>> > But I also tried to use hostname and port method as well as tried
>> changing to IP address instead of hostname but still it's the same error.
>> >
>> > I have pika 0.9.13 library installed. My consumer & Producer works fine
>> with select.connection method so I believe library is correctly installed.
>> >
>> > Do I need to do something additional to get tornado connection working
>> for both producer and consumer with pika?
>> >
>> > Please suggest.
>> >
>> > mq1 at mqserver1:~/Producer_Receiver/Latest$ python tornedo_c_1.py
>> > Traceback (most recent call last):
>> >   File "tornedo_c_1.py", line 357, in <module>
>> >     main()
>> >   File "tornedo_c_1.py", line 351, in main
>> >     example.run()
>> >   File "tornedo_c_1.py", line 326, in run
>> >     self._connection = self.connect()
>> >   File "tornedo_c_1.py", line 59, in connect
>> >     adapters.TornadoConnection(self.parameters,
>> self.on_connection_open, stop_ioloop_on_close=False)
>> > TypeError: 'NoneType' object is not callable
>>
>>
>> Maybe you passed None as a callback somewhere?  What is the value of
>> on_connection_open for example?
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/63ba333b/attachment.htm>

From vashi.priyanki at gmail.com  Thu Aug 15 16:00:44 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Thu, 15 Aug 2013 17:00:44 +0200
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
	<CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
	<CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>
Message-ID: <CA+0nT8Cyg0N8GpFKt4zXEcb3DfwAAGBLUkZMLBsMNQZ1mujHXw@mail.gmail.com>

Hi,

Sorry to say but I have now made connection to return the value but it
still say the same error.

Does anyone have working example of tornado connector (either consumer or
producer) with pika client and has possibility to sharing with me ?
Very basic example is also OK.

Thank you in advance !

Best Regards,
Priyanki.


On Thu, Aug 15, 2013 at 4:25 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> The connect method doesn't apear to return a connection...
>
>
> On Thu, Aug 15, 2013 at 9:51 AM, Priyanki Vashi <vashi.priyanki at gmail.com>wrote:
>
>> Hi ,
>>
>> on_connection_open, is a callback method, which will be called when
>> connection is opened with rabbitmq. It opens channel inturn. So it's little
>> unlikely that it has 'None' value but I am not 100% sure.
>>
>> Here is my code. Could you quickly have a look.
>> It's the same example from pika site for tornado consumer except that I
>> have tried to use connection parameters instead of URL.
>>
>>
>> from pika import adapters
>> import pika
>> import logging
>>
>> LOG_FORMAT = ('%(levelname) -10s %(asctime)s %(name) -30s %(funcName) '
>>               '-35s %(lineno) -5d: %(message)s')
>> LOGGER = logging.getLogger(__name__)
>>
>>
>> class ExampleConsumer(object):
>>     """This is an example consumer that will handle unexpected
>> interactions
>>     with RabbitMQ such as channel and connection closures.
>>
>>     If RabbitMQ closes the connection, it will reopen it. You should
>>     look at the output, as there are limited reasons why the connection
>> may
>>     be closed, which usually are tied to permission related issues or
>>     socket timeouts.
>>
>>     If the channel is closed, it will indicate a problem with one of the
>>     commands that were issued and that should surface in the output as
>> well.
>>
>>     """
>>     EXCHANGE = 'message'
>>     EXCHANGE_TYPE = 'topic'
>>     QUEUE = 'text'
>>     ROUTING_KEY = 'example.text'
>>
>>
>>
>>
>>     def __init__(self, host, port, username, password):
>>         """Setup the example publisher object, passing in the URL we will
>> use
>>         to connect to RabbitMQ.
>>
>>         :param str amqp_url: The URL for connecting to RabbitMQ
>>
>>         """
>>
>>         self._connection = None
>>         self._channel = None
>>         self._closing = False
>>         self._consumer_tag = None
>>         #self._url = amqp_url
>>
>>         self.credentials = pika.PlainCredentials(username=username,
>> password=password)
>>         self.parameters = pika.ConnectionParameters(host=host, port=port,
>> credentials=self.credentials)
>>
>>
>>
>>     def connect(self):
>>         """This method connects to RabbitMQ, returning the connection
>> handle.
>>         When the connection is established, the on_connection_open method
>>         will be invoked by pika.
>>
>>         :rtype: pika.SelectConnection
>>
>>         """
>>         #LOGGER.info('Connecting to %s', self._url)
>>         adapters.TornadoConnection(self.parameters,
>> on_open_callback=self.on_connection_open, stop_ioloop_on_close=False)
>>         #return
>> adapters.TornadoConnection(pika.URLParameters(self._url),self.on_connection_open)
>>
>>     def close_connection(self):
>>         """This method closes the connection to RabbitMQ."""
>>         LOGGER.info('Closing connection')
>>         self._connection.close()
>>
>>     def add_on_connection_close_callback(self):
>>         """This method adds an on close callback that will be invoked by
>> pika
>>         when RabbitMQ closes the connection to the publisher unexpectedly.
>>
>>         """
>>         LOGGER.info('Adding connection close callback')
>>         self._connection.add_on_close_callback(self.on_connection_closed)
>>
>>     def on_connection_closed(self, connection, reply_code, reply_text):
>>         """This method is invoked by pika when the connection to RabbitMQ
>> is
>>         closed unexpectedly. Since it is unexpected, we will reconnect to
>>         RabbitMQ if it disconnects.
>>
>>         :param pika.connection.Connection connection: The closed
>> connection obj
>>         :param int reply_code: The server provided reply_code if given
>>         :param str reply_text: The server provided reply_text if given
>>
>>         """
>>         self._channel = None
>>         if self._closing:
>>             self._connection.ioloop.stop()
>>         else:
>>             LOGGER.warning('Connection closed, reopening in 5 seconds:
>> (%s) %s',
>>                            reply_code, reply_text)
>>             self._connection.add_timeout(5, self.reconnect)
>>
>>     def on_connection_open(self, unused_connection):
>>         """This method is called by pika once the connection to RabbitMQ
>> has
>>         been established. It passes the handle to the connection object in
>>         case we need it, but in this case, we'll just mark it unused.
>>
>>         :type unused_connection: pika.SelectConnection
>>
>>         """
>>         LOGGER.info('Connection opened')
>>         self.add_on_connection_close_callback()
>>         self.open_channel()
>>
>>     def reconnect(self):
>>         """Will be invoked by the IOLoop timer if the connection is
>>         closed. See the on_connection_closed method.
>>
>>         """
>>         # This is the old connection IOLoop instance, stop its ioloop
>>         self._connection.ioloop.stop()
>>
>>         if not self._closing:
>>
>>             # Create a new connection
>>             self._connection = self.connect()
>>
>>             # There is now a new connection, needs a new ioloop to run
>>             self._connection.ioloop.start()
>>
>>     def add_on_channel_close_callback(self):
>>         """This method tells pika to call the on_channel_closed method if
>>         RabbitMQ unexpectedly closes the channel.
>>
>>         """
>>         LOGGER.info('Adding channel close callback')
>>         self._channel.add_on_close_callback(self.on_channel_closed)
>>
>>     def on_channel_closed(self, channel, reply_code, reply_text):
>>         """Invoked by pika when RabbitMQ unexpectedly closes the channel.
>>         Channels are usually closed if you attempt to do something that
>>         violates the protocol, such as re-declare an exchange or queue
>> with
>>         different parameters. In this case, we'll close the connection
>>         to shutdown the object.
>>
>>         :param pika.channel.Channel: The closed channel
>>         :param int reply_code: The numeric reason the channel was closed
>>         :param str reply_text: The text reason the channel was closed
>>
>>         """
>>         LOGGER.warning('Channel %i was closed: (%s) %s',
>>                        channel, reply_code, reply_text)
>>         self._connection.close()
>>
>>     def on_channel_open(self, channel):
>>         """This method is invoked by pika when the channel has been
>> opened.
>>         The channel object is passed in so we can make use of it.
>>
>>         Since the channel is now open, we'll declare the exchange to use.
>>
>>         :param pika.channel.Channel channel: The channel object
>>
>>         """
>>         LOGGER.info('Channel opened')
>>         self._channel = channel
>>         self.add_on_channel_close_callback()
>>         self.setup_exchange(self.EXCHANGE)
>>
>>     def setup_exchange(self, exchange_name):
>>         """Setup the exchange on RabbitMQ by invoking the
>> Exchange.Declare RPC
>>         command. When it is complete, the on_exchange_declareok method
>> will
>>         be invoked by pika.
>>
>>         :param str|unicode exchange_name: The name of the exchange to
>> declare
>>
>>         """
>>         LOGGER.info('Declaring exchange %s', exchange_name)
>>         self._channel.exchange_declare(self.on_exchange_declareok,
>>                                        exchange_name,
>>                                        self.EXCHANGE_TYPE)
>>
>>     def on_exchange_declareok(self, unused_frame):
>>         """Invoked by pika when RabbitMQ has finished the
>> Exchange.Declare RPC
>>         command.
>>
>>         :param pika.Frame.Method unused_frame: Exchange.DeclareOk
>> response frame
>>
>>         """
>>         LOGGER.info('Exchange declared')
>>         self.setup_queue(self.QUEUE)
>>
>>     def setup_queue(self, queue_name):
>>         """Setup the queue on RabbitMQ by invoking the Queue.Declare RPC
>>         command. When it is complete, the on_queue_declareok method will
>>         be invoked by pika.
>>
>>         :param str|unicode queue_name: The name of the queue to declare.
>>
>>         """
>>         LOGGER.info('Declaring queue %s', queue_name)
>>         self._channel.queue_declare(self.on_queue_declareok, queue_name)
>>
>>     def on_queue_declareok(self, method_frame):
>>         """Method invoked by pika when the Queue.Declare RPC call made in
>>         setup_queue has completed. In this method we will bind the queue
>>         and exchange together with the routing key by issuing the
>> Queue.Bind
>>         RPC command. When this command is complete, the on_bindok method
>> will
>>         be invoked by pika.
>>
>>         :param pika.frame.Method method_frame: The Queue.DeclareOk frame
>>
>>         """
>>         LOGGER.info('Binding %s to %s with %s',
>>                     self.EXCHANGE, self.QUEUE, self.ROUTING_KEY)
>>         self._channel.queue_bind(self.on_bindok, self.QUEUE,
>>                                  self.EXCHANGE, self.ROUTING_KEY)
>>
>>     def add_on_cancel_callback(self):
>>         """Add a callback that will be invoked if RabbitMQ cancels the
>> consumer
>>         for some reason. If RabbitMQ does cancel the consumer,
>>         on_consumer_cancelled will be invoked by pika.
>>
>>         """
>>         LOGGER.info('Adding consumer cancellation callback')
>>         self._channel.add_on_cancel_callback(self.on_consumer_cancelled)
>>
>>     def on_consumer_cancelled(self, method_frame):
>>         """Invoked by pika when RabbitMQ sends a Basic.Cancel for a
>> consumer
>>         receiving messages.
>>
>>         :param pika.frame.Method method_frame: The Basic.Cancel frame
>>
>>         """
>>         LOGGER.info('Consumer was cancelled remotely, shutting down: %r',
>>                     method_frame)
>>         if self._channel:
>>             self._channel.close()
>>
>>     def acknowledge_message(self, delivery_tag):
>>         """Acknowledge the message delivery from RabbitMQ by sending a
>>         Basic.Ack RPC method for the delivery tag.
>>
>>         :param int delivery_tag: The delivery tag from the Basic.Deliver
>> frame
>>
>>         """
>>         LOGGER.info('Acknowledging message %s', delivery_tag)
>>         self._channel.basic_ack(delivery_tag)
>>
>>     def on_message(self, unused_channel, basic_deliver, properties, body):
>>         """Invoked by pika when a message is delivered from RabbitMQ. The
>>         channel is passed for your convenience. The basic_deliver object
>> that
>>         is passed in carries the exchange, routing key, delivery tag and
>>         a redelivered flag for the message. The properties passed in is an
>>         instance of BasicProperties with the message properties and the
>> body
>>         is the message that was sent.
>>
>>         :param pika.channel.Channel unused_channel: The channel object
>>         :param pika.Spec.Basic.Deliver: basic_deliver method
>>         :param pika.Spec.BasicProperties: properties
>>         :param str|unicode body: The message body
>>
>>         """
>>         LOGGER.info('Received message # %s from %s: %s',
>>                     basic_deliver.delivery_tag, properties.app_id, body)
>>         self.acknowledge_message(basic_deliver.delivery_tag)
>>
>>     def on_cancelok(self, unused_frame):
>>         """This method is invoked by pika when RabbitMQ acknowledges the
>>         cancellation of a consumer. At this point we will close the
>> channel.
>>         This will invoke the on_channel_closed method once the channel
>> has been
>>         closed, which will in-turn close the connection.
>>
>>         :param pika.frame.Method unused_frame: The Basic.CancelOk frame
>>
>>         """
>>         LOGGER.info('RabbitMQ acknowledged the cancellation of the
>> consumer')
>>         self.close_channel()
>>
>>     def stop_consuming(self):
>>         """Tell RabbitMQ that you would like to stop consuming by sending
>> the
>>         Basic.Cancel RPC command.
>>
>>         """
>>         if self._channel:
>>             LOGGER.info('Sending a Basic.Cancel RPC command to RabbitMQ')
>>             self._channel.basic_cancel(self.on_cancelok,
>> self._consumer_tag)
>>
>>     def start_consuming(self):
>>         """This method sets up the consumer by first calling
>>         add_on_cancel_callback so that the object is notified if RabbitMQ
>>         cancels the consumer. It then issues the Basic.Consume RPC command
>>         which returns the consumer tag that is used to uniquely identify
>> the
>>         consumer with RabbitMQ. We keep the value to use it when we want
>> to
>>         cancel consuming. The on_message method is passed in as a
>> callback pika
>>         will invoke when a message is fully received.
>>
>>         """
>>         LOGGER.info('Issuing consumer related RPC commands')
>>         self.add_on_cancel_callback()
>>         self._consumer_tag = self._channel.basic_consume(self.on_message,
>>                                                          self.QUEUE)
>>
>>      def on_bindok(self, unused_frame):
>>         """Invoked by pika when the Queue.Bind method has completed. At
>> this
>>         point we will start consuming messages by calling start_consuming
>>         which will invoke the needed RPC commands to start the process.
>>
>>         :param pika.frame.Method unused_frame: The Queue.BindOk response
>> frame
>>
>>         """
>>         LOGGER.info('Queue bound')
>>         self.start_consuming()
>>
>>     def close_channel(self):
>>         """Call to close the channel with RabbitMQ cleanly by issuing the
>>         Channel.Close RPC command.
>>
>>         """
>>         LOGGER.info('Closing the channel')
>>         self._channel.close()
>>
>>     def open_channel(self):
>>         """Open a new channel with RabbitMQ by issuing the Channel.Open
>> RPC
>>         command. When RabbitMQ responds that the channel is open, the
>>         on_channel_open callback will be invoked by pika.
>>
>>         """
>>         LOGGER.info('Creating a new channel')
>>         self._connection.channel(on_open_callback=self.on_channel_open)
>>
>>     def run(self):
>>         """Run the example consumer by connecting to RabbitMQ and then
>>         starting the IOLoop to block and allow the SelectConnection to
>> operate.
>>
>>         """
>>         self._connection = self.connect()
>>         self._connection.ioloop.start()
>>
>>     def stop(self):
>>         """Cleanly shutdown the connection to RabbitMQ by stopping the
>> consumer
>>         with RabbitMQ. When RabbitMQ confirms the cancellation,
>> on_cancelok
>>         will be invoked by pika, which will then closing the channel and
>>         connection. The IOLoop is started again because this method is
>> invoked
>>         when CTRL-C is pressed raising a KeyboardInterrupt exception. This
>>         exception stops the IOLoop which needs to be running for pika to
>>         communicate with RabbitMQ. All of the commands issued prior to
>> starting
>>         the IOLoop will be buffered but not processed.
>>
>>         """
>>         LOGGER.info('Stopping')
>>         self._closing = True
>>         self.stop_consuming()
>>         self._connection.ioloop.start()
>>         LOGGER.info('Stopped')
>>
>>
>> def main():
>>     logging.basicConfig(level=logging.INFO, format=LOG_FORMAT)
>>     example = ExampleConsumer('mqserver10', 5672, 'guest', 'guest')
>>     try:
>>         example.run()
>>     except KeyboardInterrupt:
>>         example.stop()
>>
>>
>> if __name__ == '__main__':
>>     main()
>>
>>
>> On Thu, Aug 15, 2013 at 3:25 PM, Ask Solem <ask at rabbitmq.com> wrote:
>>
>>>
>>> On Aug 15, 2013, at 1:20 PM, Priyanki Vashi <vashi.priyanki at gmail.com>
>>> wrote:
>>>
>>> > Hi There ,
>>> >
>>> > This might be very basic error but since I am trying to use Tornado
>>> connection for the first time, help on this would be appreciated.
>>> >
>>> > I was trying to use Tornado consumer example given on following pika
>>> site.
>>> >
>>> > https://pika.readthedocs.org/en/0.9.13/examples/tornado_consumer.html
>>> >
>>> > I am running into following error. The example is with URL connection
>>> method.
>>> > But I also tried to use hostname and port method as well as tried
>>> changing to IP address instead of hostname but still it's the same error.
>>> >
>>> > I have pika 0.9.13 library installed. My consumer & Producer works
>>> fine with select.connection method so I believe library is correctly
>>> installed.
>>> >
>>> > Do I need to do something additional to get tornado connection working
>>> for both producer and consumer with pika?
>>> >
>>> > Please suggest.
>>> >
>>> > mq1 at mqserver1:~/Producer_Receiver/Latest$ python tornedo_c_1.py
>>> > Traceback (most recent call last):
>>> >   File "tornedo_c_1.py", line 357, in <module>
>>> >     main()
>>> >   File "tornedo_c_1.py", line 351, in main
>>> >     example.run()
>>> >   File "tornedo_c_1.py", line 326, in run
>>> >     self._connection = self.connect()
>>> >   File "tornedo_c_1.py", line 59, in connect
>>> >     adapters.TornadoConnection(self.parameters,
>>> self.on_connection_open, stop_ioloop_on_close=False)
>>> > TypeError: 'NoneType' object is not callable
>>>
>>>
>>> Maybe you passed None as a callback somewhere?  What is the value of
>>> on_connection_open for example?
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/747b5aab/attachment.htm>

From michael.laing at nytimes.com  Thu Aug 15 17:18:13 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 15 Aug 2013 12:18:13 -0400
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <CA+0nT8Cyg0N8GpFKt4zXEcb3DfwAAGBLUkZMLBsMNQZ1mujHXw@mail.gmail.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
	<CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
	<CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>
	<CA+0nT8Cyg0N8GpFKt4zXEcb3DfwAAGBLUkZMLBsMNQZ1mujHXw@mail.gmail.com>
Message-ID: <CAKgmDnEpUyU6YigxwudoU6TzA=--9r0wykmGU5xh4ZVwX7cSpA@mail.gmail.com>

Is tornado installed?

run this python fragment:

from pika import adapters
if adapters.TornadoConnection:
print 'y'



On Thu, Aug 15, 2013 at 11:00 AM, Priyanki Vashi
<vashi.priyanki at gmail.com>wrote:

> Hi,
>
> Sorry to say but I have now made connection to return the value but it
> still say the same error.
>
> Does anyone have working example of tornado connector (either consumer or
> producer) with pika client and has possibility to sharing with me ?
> Very basic example is also OK.
>
> Thank you in advance !
>
> Best Regards,
> Priyanki.
>
>
> On Thu, Aug 15, 2013 at 4:25 PM, Laing, Michael <michael.laing at nytimes.com
> > wrote:
>
>> The connect method doesn't apear to return a connection...
>>
>>
>> On Thu, Aug 15, 2013 at 9:51 AM, Priyanki Vashi <vashi.priyanki at gmail.com
>> > wrote:
>>
>>> Hi ,
>>>
>>> on_connection_open, is a callback method, which will be called when
>>> connection is opened with rabbitmq. It opens channel inturn. So it's little
>>> unlikely that it has 'None' value but I am not 100% sure.
>>>
>>> Here is my code. Could you quickly have a look.
>>> It's the same example from pika site for tornado consumer except that I
>>> have tried to use connection parameters instead of URL.
>>>
>>>
>>> from pika import adapters
>>> import pika
>>> import logging
>>>
>>> LOG_FORMAT = ('%(levelname) -10s %(asctime)s %(name) -30s %(funcName) '
>>>               '-35s %(lineno) -5d: %(message)s')
>>> LOGGER = logging.getLogger(__name__)
>>>
>>>
>>> class ExampleConsumer(object):
>>>     """This is an example consumer that will handle unexpected
>>> interactions
>>>     with RabbitMQ such as channel and connection closures.
>>>
>>>     If RabbitMQ closes the connection, it will reopen it. You should
>>>     look at the output, as there are limited reasons why the connection
>>> may
>>>     be closed, which usually are tied to permission related issues or
>>>     socket timeouts.
>>>
>>>     If the channel is closed, it will indicate a problem with one of the
>>>     commands that were issued and that should surface in the output as
>>> well.
>>>
>>>     """
>>>     EXCHANGE = 'message'
>>>     EXCHANGE_TYPE = 'topic'
>>>     QUEUE = 'text'
>>>     ROUTING_KEY = 'example.text'
>>>
>>>
>>>
>>>
>>>     def __init__(self, host, port, username, password):
>>>         """Setup the example publisher object, passing in the URL we
>>> will use
>>>         to connect to RabbitMQ.
>>>
>>>         :param str amqp_url: The URL for connecting to RabbitMQ
>>>
>>>         """
>>>
>>>         self._connection = None
>>>         self._channel = None
>>>         self._closing = False
>>>         self._consumer_tag = None
>>>         #self._url = amqp_url
>>>
>>>         self.credentials = pika.PlainCredentials(username=username,
>>> password=password)
>>>         self.parameters = pika.ConnectionParameters(host=host,
>>> port=port, credentials=self.credentials)
>>>
>>>
>>>
>>>     def connect(self):
>>>         """This method connects to RabbitMQ, returning the connection
>>> handle.
>>>         When the connection is established, the on_connection_open method
>>>         will be invoked by pika.
>>>
>>>         :rtype: pika.SelectConnection
>>>
>>>         """
>>>         #LOGGER.info('Connecting to %s', self._url)
>>>         adapters.TornadoConnection(self.parameters,
>>> on_open_callback=self.on_connection_open, stop_ioloop_on_close=False)
>>>         #return
>>> adapters.TornadoConnection(pika.URLParameters(self._url),self.on_connection_open)
>>>
>>>     def close_connection(self):
>>>         """This method closes the connection to RabbitMQ."""
>>>         LOGGER.info('Closing connection')
>>>         self._connection.close()
>>>
>>>     def add_on_connection_close_callback(self):
>>>         """This method adds an on close callback that will be invoked by
>>> pika
>>>         when RabbitMQ closes the connection to the publisher
>>> unexpectedly.
>>>
>>>         """
>>>         LOGGER.info('Adding connection close callback')
>>>         self._connection.add_on_close_callback(self.on_connection_closed)
>>>
>>>     def on_connection_closed(self, connection, reply_code, reply_text):
>>>         """This method is invoked by pika when the connection to
>>> RabbitMQ is
>>>         closed unexpectedly. Since it is unexpected, we will reconnect to
>>>         RabbitMQ if it disconnects.
>>>
>>>         :param pika.connection.Connection connection: The closed
>>> connection obj
>>>         :param int reply_code: The server provided reply_code if given
>>>         :param str reply_text: The server provided reply_text if given
>>>
>>>         """
>>>         self._channel = None
>>>         if self._closing:
>>>             self._connection.ioloop.stop()
>>>         else:
>>>             LOGGER.warning('Connection closed, reopening in 5 seconds:
>>> (%s) %s',
>>>                            reply_code, reply_text)
>>>             self._connection.add_timeout(5, self.reconnect)
>>>
>>>     def on_connection_open(self, unused_connection):
>>>         """This method is called by pika once the connection to RabbitMQ
>>> has
>>>         been established. It passes the handle to the connection object
>>> in
>>>         case we need it, but in this case, we'll just mark it unused.
>>>
>>>         :type unused_connection: pika.SelectConnection
>>>
>>>         """
>>>         LOGGER.info('Connection opened')
>>>         self.add_on_connection_close_callback()
>>>         self.open_channel()
>>>
>>>     def reconnect(self):
>>>         """Will be invoked by the IOLoop timer if the connection is
>>>         closed. See the on_connection_closed method.
>>>
>>>         """
>>>         # This is the old connection IOLoop instance, stop its ioloop
>>>         self._connection.ioloop.stop()
>>>
>>>         if not self._closing:
>>>
>>>             # Create a new connection
>>>             self._connection = self.connect()
>>>
>>>             # There is now a new connection, needs a new ioloop to run
>>>             self._connection.ioloop.start()
>>>
>>>     def add_on_channel_close_callback(self):
>>>         """This method tells pika to call the on_channel_closed method if
>>>         RabbitMQ unexpectedly closes the channel.
>>>
>>>         """
>>>         LOGGER.info('Adding channel close callback')
>>>         self._channel.add_on_close_callback(self.on_channel_closed)
>>>
>>>     def on_channel_closed(self, channel, reply_code, reply_text):
>>>         """Invoked by pika when RabbitMQ unexpectedly closes the channel.
>>>         Channels are usually closed if you attempt to do something that
>>>         violates the protocol, such as re-declare an exchange or queue
>>> with
>>>         different parameters. In this case, we'll close the connection
>>>         to shutdown the object.
>>>
>>>         :param pika.channel.Channel: The closed channel
>>>         :param int reply_code: The numeric reason the channel was closed
>>>         :param str reply_text: The text reason the channel was closed
>>>
>>>         """
>>>         LOGGER.warning('Channel %i was closed: (%s) %s',
>>>                        channel, reply_code, reply_text)
>>>         self._connection.close()
>>>
>>>     def on_channel_open(self, channel):
>>>         """This method is invoked by pika when the channel has been
>>> opened.
>>>         The channel object is passed in so we can make use of it.
>>>
>>>         Since the channel is now open, we'll declare the exchange to use.
>>>
>>>         :param pika.channel.Channel channel: The channel object
>>>
>>>         """
>>>         LOGGER.info('Channel opened')
>>>         self._channel = channel
>>>         self.add_on_channel_close_callback()
>>>         self.setup_exchange(self.EXCHANGE)
>>>
>>>     def setup_exchange(self, exchange_name):
>>>         """Setup the exchange on RabbitMQ by invoking the
>>> Exchange.Declare RPC
>>>         command. When it is complete, the on_exchange_declareok method
>>> will
>>>         be invoked by pika.
>>>
>>>         :param str|unicode exchange_name: The name of the exchange to
>>> declare
>>>
>>>         """
>>>         LOGGER.info('Declaring exchange %s', exchange_name)
>>>         self._channel.exchange_declare(self.on_exchange_declareok,
>>>                                        exchange_name,
>>>                                        self.EXCHANGE_TYPE)
>>>
>>>     def on_exchange_declareok(self, unused_frame):
>>>         """Invoked by pika when RabbitMQ has finished the
>>> Exchange.Declare RPC
>>>         command.
>>>
>>>         :param pika.Frame.Method unused_frame: Exchange.DeclareOk
>>> response frame
>>>
>>>         """
>>>         LOGGER.info('Exchange declared')
>>>         self.setup_queue(self.QUEUE)
>>>
>>>     def setup_queue(self, queue_name):
>>>         """Setup the queue on RabbitMQ by invoking the Queue.Declare RPC
>>>         command. When it is complete, the on_queue_declareok method will
>>>         be invoked by pika.
>>>
>>>         :param str|unicode queue_name: The name of the queue to declare.
>>>
>>>         """
>>>         LOGGER.info('Declaring queue %s', queue_name)
>>>         self._channel.queue_declare(self.on_queue_declareok, queue_name)
>>>
>>>     def on_queue_declareok(self, method_frame):
>>>         """Method invoked by pika when the Queue.Declare RPC call made in
>>>         setup_queue has completed. In this method we will bind the queue
>>>         and exchange together with the routing key by issuing the
>>> Queue.Bind
>>>         RPC command. When this command is complete, the on_bindok method
>>> will
>>>         be invoked by pika.
>>>
>>>         :param pika.frame.Method method_frame: The Queue.DeclareOk frame
>>>
>>>         """
>>>         LOGGER.info('Binding %s to %s with %s',
>>>                     self.EXCHANGE, self.QUEUE, self.ROUTING_KEY)
>>>         self._channel.queue_bind(self.on_bindok, self.QUEUE,
>>>                                  self.EXCHANGE, self.ROUTING_KEY)
>>>
>>>     def add_on_cancel_callback(self):
>>>         """Add a callback that will be invoked if RabbitMQ cancels the
>>> consumer
>>>         for some reason. If RabbitMQ does cancel the consumer,
>>>         on_consumer_cancelled will be invoked by pika.
>>>
>>>         """
>>>         LOGGER.info('Adding consumer cancellation callback')
>>>         self._channel.add_on_cancel_callback(self.on_consumer_cancelled)
>>>
>>>     def on_consumer_cancelled(self, method_frame):
>>>         """Invoked by pika when RabbitMQ sends a Basic.Cancel for a
>>> consumer
>>>         receiving messages.
>>>
>>>         :param pika.frame.Method method_frame: The Basic.Cancel frame
>>>
>>>         """
>>>         LOGGER.info('Consumer was cancelled remotely, shutting down: %r',
>>>                     method_frame)
>>>         if self._channel:
>>>             self._channel.close()
>>>
>>>     def acknowledge_message(self, delivery_tag):
>>>         """Acknowledge the message delivery from RabbitMQ by sending a
>>>         Basic.Ack RPC method for the delivery tag.
>>>
>>>         :param int delivery_tag: The delivery tag from the Basic.Deliver
>>> frame
>>>
>>>         """
>>>         LOGGER.info('Acknowledging message %s', delivery_tag)
>>>         self._channel.basic_ack(delivery_tag)
>>>
>>>     def on_message(self, unused_channel, basic_deliver, properties,
>>> body):
>>>         """Invoked by pika when a message is delivered from RabbitMQ. The
>>>         channel is passed for your convenience. The basic_deliver object
>>> that
>>>         is passed in carries the exchange, routing key, delivery tag and
>>>         a redelivered flag for the message. The properties passed in is
>>> an
>>>         instance of BasicProperties with the message properties and the
>>> body
>>>         is the message that was sent.
>>>
>>>         :param pika.channel.Channel unused_channel: The channel object
>>>         :param pika.Spec.Basic.Deliver: basic_deliver method
>>>         :param pika.Spec.BasicProperties: properties
>>>         :param str|unicode body: The message body
>>>
>>>         """
>>>         LOGGER.info('Received message # %s from %s: %s',
>>>                     basic_deliver.delivery_tag, properties.app_id, body)
>>>         self.acknowledge_message(basic_deliver.delivery_tag)
>>>
>>>     def on_cancelok(self, unused_frame):
>>>         """This method is invoked by pika when RabbitMQ acknowledges the
>>>         cancellation of a consumer. At this point we will close the
>>> channel.
>>>         This will invoke the on_channel_closed method once the channel
>>> has been
>>>         closed, which will in-turn close the connection.
>>>
>>>         :param pika.frame.Method unused_frame: The Basic.CancelOk frame
>>>
>>>         """
>>>         LOGGER.info('RabbitMQ acknowledged the cancellation of the
>>> consumer')
>>>         self.close_channel()
>>>
>>>     def stop_consuming(self):
>>>         """Tell RabbitMQ that you would like to stop consuming by
>>> sending the
>>>         Basic.Cancel RPC command.
>>>
>>>         """
>>>         if self._channel:
>>>             LOGGER.info('Sending a Basic.Cancel RPC command to RabbitMQ')
>>>             self._channel.basic_cancel(self.on_cancelok,
>>> self._consumer_tag)
>>>
>>>     def start_consuming(self):
>>>         """This method sets up the consumer by first calling
>>>         add_on_cancel_callback so that the object is notified if RabbitMQ
>>>         cancels the consumer. It then issues the Basic.Consume RPC
>>> command
>>>         which returns the consumer tag that is used to uniquely identify
>>> the
>>>         consumer with RabbitMQ. We keep the value to use it when we want
>>> to
>>>         cancel consuming. The on_message method is passed in as a
>>> callback pika
>>>         will invoke when a message is fully received.
>>>
>>>         """
>>>         LOGGER.info('Issuing consumer related RPC commands')
>>>         self.add_on_cancel_callback()
>>>         self._consumer_tag = self._channel.basic_consume(self.on_message,
>>>                                                          self.QUEUE)
>>>
>>>      def on_bindok(self, unused_frame):
>>>         """Invoked by pika when the Queue.Bind method has completed. At
>>> this
>>>         point we will start consuming messages by calling start_consuming
>>>         which will invoke the needed RPC commands to start the process.
>>>
>>>         :param pika.frame.Method unused_frame: The Queue.BindOk response
>>> frame
>>>
>>>         """
>>>         LOGGER.info('Queue bound')
>>>         self.start_consuming()
>>>
>>>     def close_channel(self):
>>>         """Call to close the channel with RabbitMQ cleanly by issuing the
>>>         Channel.Close RPC command.
>>>
>>>         """
>>>         LOGGER.info('Closing the channel')
>>>         self._channel.close()
>>>
>>>     def open_channel(self):
>>>         """Open a new channel with RabbitMQ by issuing the Channel.Open
>>> RPC
>>>         command. When RabbitMQ responds that the channel is open, the
>>>         on_channel_open callback will be invoked by pika.
>>>
>>>         """
>>>         LOGGER.info('Creating a new channel')
>>>         self._connection.channel(on_open_callback=self.on_channel_open)
>>>
>>>     def run(self):
>>>         """Run the example consumer by connecting to RabbitMQ and then
>>>         starting the IOLoop to block and allow the SelectConnection to
>>> operate.
>>>
>>>         """
>>>         self._connection = self.connect()
>>>         self._connection.ioloop.start()
>>>
>>>     def stop(self):
>>>         """Cleanly shutdown the connection to RabbitMQ by stopping the
>>> consumer
>>>         with RabbitMQ. When RabbitMQ confirms the cancellation,
>>> on_cancelok
>>>         will be invoked by pika, which will then closing the channel and
>>>         connection. The IOLoop is started again because this method is
>>> invoked
>>>         when CTRL-C is pressed raising a KeyboardInterrupt exception.
>>> This
>>>         exception stops the IOLoop which needs to be running for pika to
>>>         communicate with RabbitMQ. All of the commands issued prior to
>>> starting
>>>         the IOLoop will be buffered but not processed.
>>>
>>>         """
>>>         LOGGER.info('Stopping')
>>>         self._closing = True
>>>         self.stop_consuming()
>>>         self._connection.ioloop.start()
>>>         LOGGER.info('Stopped')
>>>
>>>
>>> def main():
>>>     logging.basicConfig(level=logging.INFO, format=LOG_FORMAT)
>>>     example = ExampleConsumer('mqserver10', 5672, 'guest', 'guest')
>>>     try:
>>>         example.run()
>>>     except KeyboardInterrupt:
>>>         example.stop()
>>>
>>>
>>> if __name__ == '__main__':
>>>     main()
>>>
>>>
>>> On Thu, Aug 15, 2013 at 3:25 PM, Ask Solem <ask at rabbitmq.com> wrote:
>>>
>>>>
>>>> On Aug 15, 2013, at 1:20 PM, Priyanki Vashi <vashi.priyanki at gmail.com>
>>>> wrote:
>>>>
>>>> > Hi There ,
>>>> >
>>>> > This might be very basic error but since I am trying to use Tornado
>>>> connection for the first time, help on this would be appreciated.
>>>> >
>>>> > I was trying to use Tornado consumer example given on following pika
>>>> site.
>>>> >
>>>> > https://pika.readthedocs.org/en/0.9.13/examples/tornado_consumer.html
>>>> >
>>>> > I am running into following error. The example is with URL connection
>>>> method.
>>>> > But I also tried to use hostname and port method as well as tried
>>>> changing to IP address instead of hostname but still it's the same error.
>>>> >
>>>> > I have pika 0.9.13 library installed. My consumer & Producer works
>>>> fine with select.connection method so I believe library is correctly
>>>> installed.
>>>> >
>>>> > Do I need to do something additional to get tornado connection
>>>> working for both producer and consumer with pika?
>>>> >
>>>> > Please suggest.
>>>> >
>>>> > mq1 at mqserver1:~/Producer_Receiver/Latest$ python tornedo_c_1.py
>>>> > Traceback (most recent call last):
>>>> >   File "tornedo_c_1.py", line 357, in <module>
>>>> >     main()
>>>> >   File "tornedo_c_1.py", line 351, in main
>>>> >     example.run()
>>>> >   File "tornedo_c_1.py", line 326, in run
>>>> >     self._connection = self.connect()
>>>> >   File "tornedo_c_1.py", line 59, in connect
>>>> >     adapters.TornadoConnection(self.parameters,
>>>> self.on_connection_open, stop_ioloop_on_close=False)
>>>> > TypeError: 'NoneType' object is not callable
>>>>
>>>>
>>>> Maybe you passed None as a callback somewhere?  What is the value of
>>>> on_connection_open for example?
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/491b1cc6/attachment.htm>

From michael.laing at nytimes.com  Thu Aug 15 17:19:49 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 15 Aug 2013 12:19:49 -0400
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <CAKgmDnEpUyU6YigxwudoU6TzA=--9r0wykmGU5xh4ZVwX7cSpA@mail.gmail.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
	<CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
	<CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>
	<CA+0nT8Cyg0N8GpFKt4zXEcb3DfwAAGBLUkZMLBsMNQZ1mujHXw@mail.gmail.com>
	<CAKgmDnEpUyU6YigxwudoU6TzA=--9r0wykmGU5xh4ZVwX7cSpA@mail.gmail.com>
Message-ID: <CAKgmDnGL1ajXviRjP5T4TvZurS3JM6xpXC26AuNmDhR=9ER0_A@mail.gmail.com>

sorry that got sent a little early...

run:

from pika import adapters
if adapters.TornadoConnection:
    print 'y'
else:
    print 'n'


On Thu, Aug 15, 2013 at 12:18 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> Is tornado installed?
>
> run this python fragment:
>
> from pika import adapters
> if adapters.TornadoConnection:
> print 'y'
>
>
>
> On Thu, Aug 15, 2013 at 11:00 AM, Priyanki Vashi <vashi.priyanki at gmail.com
> > wrote:
>
>> Hi,
>>
>> Sorry to say but I have now made connection to return the value but it
>> still say the same error.
>>
>> Does anyone have working example of tornado connector (either consumer or
>> producer) with pika client and has possibility to sharing with me ?
>> Very basic example is also OK.
>>
>> Thank you in advance !
>>
>> Best Regards,
>> Priyanki.
>>
>>
>> On Thu, Aug 15, 2013 at 4:25 PM, Laing, Michael <
>> michael.laing at nytimes.com> wrote:
>>
>>> The connect method doesn't apear to return a connection...
>>>
>>>
>>> On Thu, Aug 15, 2013 at 9:51 AM, Priyanki Vashi <
>>> vashi.priyanki at gmail.com> wrote:
>>>
>>>> Hi ,
>>>>
>>>> on_connection_open, is a callback method, which will be called when
>>>> connection is opened with rabbitmq. It opens channel inturn. So it's little
>>>> unlikely that it has 'None' value but I am not 100% sure.
>>>>
>>>> Here is my code. Could you quickly have a look.
>>>> It's the same example from pika site for tornado consumer except that I
>>>> have tried to use connection parameters instead of URL.
>>>>
>>>>
>>>> from pika import adapters
>>>> import pika
>>>> import logging
>>>>
>>>> LOG_FORMAT = ('%(levelname) -10s %(asctime)s %(name) -30s %(funcName) '
>>>>               '-35s %(lineno) -5d: %(message)s')
>>>> LOGGER = logging.getLogger(__name__)
>>>>
>>>>
>>>> class ExampleConsumer(object):
>>>>     """This is an example consumer that will handle unexpected
>>>> interactions
>>>>     with RabbitMQ such as channel and connection closures.
>>>>
>>>>     If RabbitMQ closes the connection, it will reopen it. You should
>>>>     look at the output, as there are limited reasons why the connection
>>>> may
>>>>     be closed, which usually are tied to permission related issues or
>>>>     socket timeouts.
>>>>
>>>>     If the channel is closed, it will indicate a problem with one of the
>>>>     commands that were issued and that should surface in the output as
>>>> well.
>>>>
>>>>     """
>>>>     EXCHANGE = 'message'
>>>>     EXCHANGE_TYPE = 'topic'
>>>>     QUEUE = 'text'
>>>>     ROUTING_KEY = 'example.text'
>>>>
>>>>
>>>>
>>>>
>>>>     def __init__(self, host, port, username, password):
>>>>         """Setup the example publisher object, passing in the URL we
>>>> will use
>>>>         to connect to RabbitMQ.
>>>>
>>>>         :param str amqp_url: The URL for connecting to RabbitMQ
>>>>
>>>>         """
>>>>
>>>>         self._connection = None
>>>>         self._channel = None
>>>>         self._closing = False
>>>>         self._consumer_tag = None
>>>>         #self._url = amqp_url
>>>>
>>>>         self.credentials = pika.PlainCredentials(username=username,
>>>> password=password)
>>>>         self.parameters = pika.ConnectionParameters(host=host,
>>>> port=port, credentials=self.credentials)
>>>>
>>>>
>>>>
>>>>     def connect(self):
>>>>         """This method connects to RabbitMQ, returning the connection
>>>> handle.
>>>>         When the connection is established, the on_connection_open
>>>> method
>>>>         will be invoked by pika.
>>>>
>>>>         :rtype: pika.SelectConnection
>>>>
>>>>         """
>>>>         #LOGGER.info('Connecting to %s', self._url)
>>>>         adapters.TornadoConnection(self.parameters,
>>>> on_open_callback=self.on_connection_open, stop_ioloop_on_close=False)
>>>>         #return
>>>> adapters.TornadoConnection(pika.URLParameters(self._url),self.on_connection_open)
>>>>
>>>>     def close_connection(self):
>>>>         """This method closes the connection to RabbitMQ."""
>>>>         LOGGER.info('Closing connection')
>>>>         self._connection.close()
>>>>
>>>>     def add_on_connection_close_callback(self):
>>>>         """This method adds an on close callback that will be invoked
>>>> by pika
>>>>         when RabbitMQ closes the connection to the publisher
>>>> unexpectedly.
>>>>
>>>>         """
>>>>         LOGGER.info('Adding connection close callback')
>>>>
>>>> self._connection.add_on_close_callback(self.on_connection_closed)
>>>>
>>>>     def on_connection_closed(self, connection, reply_code, reply_text):
>>>>         """This method is invoked by pika when the connection to
>>>> RabbitMQ is
>>>>         closed unexpectedly. Since it is unexpected, we will reconnect
>>>> to
>>>>         RabbitMQ if it disconnects.
>>>>
>>>>         :param pika.connection.Connection connection: The closed
>>>> connection obj
>>>>         :param int reply_code: The server provided reply_code if given
>>>>         :param str reply_text: The server provided reply_text if given
>>>>
>>>>         """
>>>>         self._channel = None
>>>>         if self._closing:
>>>>             self._connection.ioloop.stop()
>>>>         else:
>>>>             LOGGER.warning('Connection closed, reopening in 5 seconds:
>>>> (%s) %s',
>>>>                            reply_code, reply_text)
>>>>             self._connection.add_timeout(5, self.reconnect)
>>>>
>>>>     def on_connection_open(self, unused_connection):
>>>>         """This method is called by pika once the connection to
>>>> RabbitMQ has
>>>>         been established. It passes the handle to the connection object
>>>> in
>>>>         case we need it, but in this case, we'll just mark it unused.
>>>>
>>>>         :type unused_connection: pika.SelectConnection
>>>>
>>>>         """
>>>>         LOGGER.info('Connection opened')
>>>>         self.add_on_connection_close_callback()
>>>>         self.open_channel()
>>>>
>>>>     def reconnect(self):
>>>>         """Will be invoked by the IOLoop timer if the connection is
>>>>         closed. See the on_connection_closed method.
>>>>
>>>>         """
>>>>         # This is the old connection IOLoop instance, stop its ioloop
>>>>         self._connection.ioloop.stop()
>>>>
>>>>         if not self._closing:
>>>>
>>>>             # Create a new connection
>>>>             self._connection = self.connect()
>>>>
>>>>             # There is now a new connection, needs a new ioloop to run
>>>>             self._connection.ioloop.start()
>>>>
>>>>     def add_on_channel_close_callback(self):
>>>>         """This method tells pika to call the on_channel_closed method
>>>> if
>>>>         RabbitMQ unexpectedly closes the channel.
>>>>
>>>>         """
>>>>         LOGGER.info('Adding channel close callback')
>>>>         self._channel.add_on_close_callback(self.on_channel_closed)
>>>>
>>>>     def on_channel_closed(self, channel, reply_code, reply_text):
>>>>         """Invoked by pika when RabbitMQ unexpectedly closes the
>>>> channel.
>>>>         Channels are usually closed if you attempt to do something that
>>>>         violates the protocol, such as re-declare an exchange or queue
>>>> with
>>>>         different parameters. In this case, we'll close the connection
>>>>         to shutdown the object.
>>>>
>>>>         :param pika.channel.Channel: The closed channel
>>>>         :param int reply_code: The numeric reason the channel was closed
>>>>         :param str reply_text: The text reason the channel was closed
>>>>
>>>>         """
>>>>         LOGGER.warning('Channel %i was closed: (%s) %s',
>>>>                        channel, reply_code, reply_text)
>>>>         self._connection.close()
>>>>
>>>>     def on_channel_open(self, channel):
>>>>         """This method is invoked by pika when the channel has been
>>>> opened.
>>>>         The channel object is passed in so we can make use of it.
>>>>
>>>>         Since the channel is now open, we'll declare the exchange to
>>>> use.
>>>>
>>>>         :param pika.channel.Channel channel: The channel object
>>>>
>>>>         """
>>>>         LOGGER.info('Channel opened')
>>>>         self._channel = channel
>>>>         self.add_on_channel_close_callback()
>>>>         self.setup_exchange(self.EXCHANGE)
>>>>
>>>>     def setup_exchange(self, exchange_name):
>>>>         """Setup the exchange on RabbitMQ by invoking the
>>>> Exchange.Declare RPC
>>>>         command. When it is complete, the on_exchange_declareok method
>>>> will
>>>>         be invoked by pika.
>>>>
>>>>         :param str|unicode exchange_name: The name of the exchange to
>>>> declare
>>>>
>>>>         """
>>>>         LOGGER.info('Declaring exchange %s', exchange_name)
>>>>         self._channel.exchange_declare(self.on_exchange_declareok,
>>>>                                        exchange_name,
>>>>                                        self.EXCHANGE_TYPE)
>>>>
>>>>     def on_exchange_declareok(self, unused_frame):
>>>>         """Invoked by pika when RabbitMQ has finished the
>>>> Exchange.Declare RPC
>>>>         command.
>>>>
>>>>         :param pika.Frame.Method unused_frame: Exchange.DeclareOk
>>>> response frame
>>>>
>>>>         """
>>>>         LOGGER.info('Exchange declared')
>>>>         self.setup_queue(self.QUEUE)
>>>>
>>>>     def setup_queue(self, queue_name):
>>>>         """Setup the queue on RabbitMQ by invoking the Queue.Declare RPC
>>>>         command. When it is complete, the on_queue_declareok method will
>>>>         be invoked by pika.
>>>>
>>>>         :param str|unicode queue_name: The name of the queue to declare.
>>>>
>>>>         """
>>>>         LOGGER.info('Declaring queue %s', queue_name)
>>>>         self._channel.queue_declare(self.on_queue_declareok, queue_name)
>>>>
>>>>     def on_queue_declareok(self, method_frame):
>>>>         """Method invoked by pika when the Queue.Declare RPC call made
>>>> in
>>>>         setup_queue has completed. In this method we will bind the queue
>>>>         and exchange together with the routing key by issuing the
>>>> Queue.Bind
>>>>         RPC command. When this command is complete, the on_bindok
>>>> method will
>>>>         be invoked by pika.
>>>>
>>>>         :param pika.frame.Method method_frame: The Queue.DeclareOk frame
>>>>
>>>>         """
>>>>         LOGGER.info('Binding %s to %s with %s',
>>>>                     self.EXCHANGE, self.QUEUE, self.ROUTING_KEY)
>>>>         self._channel.queue_bind(self.on_bindok, self.QUEUE,
>>>>                                  self.EXCHANGE, self.ROUTING_KEY)
>>>>
>>>>     def add_on_cancel_callback(self):
>>>>         """Add a callback that will be invoked if RabbitMQ cancels the
>>>> consumer
>>>>         for some reason. If RabbitMQ does cancel the consumer,
>>>>         on_consumer_cancelled will be invoked by pika.
>>>>
>>>>         """
>>>>         LOGGER.info('Adding consumer cancellation callback')
>>>>         self._channel.add_on_cancel_callback(self.on_consumer_cancelled)
>>>>
>>>>     def on_consumer_cancelled(self, method_frame):
>>>>         """Invoked by pika when RabbitMQ sends a Basic.Cancel for a
>>>> consumer
>>>>         receiving messages.
>>>>
>>>>         :param pika.frame.Method method_frame: The Basic.Cancel frame
>>>>
>>>>         """
>>>>         LOGGER.info('Consumer was cancelled remotely, shutting down:
>>>> %r',
>>>>                     method_frame)
>>>>         if self._channel:
>>>>             self._channel.close()
>>>>
>>>>     def acknowledge_message(self, delivery_tag):
>>>>         """Acknowledge the message delivery from RabbitMQ by sending a
>>>>         Basic.Ack RPC method for the delivery tag.
>>>>
>>>>         :param int delivery_tag: The delivery tag from the
>>>> Basic.Deliver frame
>>>>
>>>>         """
>>>>         LOGGER.info('Acknowledging message %s', delivery_tag)
>>>>         self._channel.basic_ack(delivery_tag)
>>>>
>>>>     def on_message(self, unused_channel, basic_deliver, properties,
>>>> body):
>>>>         """Invoked by pika when a message is delivered from RabbitMQ.
>>>> The
>>>>         channel is passed for your convenience. The basic_deliver
>>>> object that
>>>>         is passed in carries the exchange, routing key, delivery tag and
>>>>         a redelivered flag for the message. The properties passed in is
>>>> an
>>>>         instance of BasicProperties with the message properties and the
>>>> body
>>>>         is the message that was sent.
>>>>
>>>>         :param pika.channel.Channel unused_channel: The channel object
>>>>         :param pika.Spec.Basic.Deliver: basic_deliver method
>>>>         :param pika.Spec.BasicProperties: properties
>>>>         :param str|unicode body: The message body
>>>>
>>>>         """
>>>>         LOGGER.info('Received message # %s from %s: %s',
>>>>                     basic_deliver.delivery_tag, properties.app_id, body)
>>>>         self.acknowledge_message(basic_deliver.delivery_tag)
>>>>
>>>>     def on_cancelok(self, unused_frame):
>>>>         """This method is invoked by pika when RabbitMQ acknowledges the
>>>>         cancellation of a consumer. At this point we will close the
>>>> channel.
>>>>         This will invoke the on_channel_closed method once the channel
>>>> has been
>>>>         closed, which will in-turn close the connection.
>>>>
>>>>         :param pika.frame.Method unused_frame: The Basic.CancelOk frame
>>>>
>>>>         """
>>>>         LOGGER.info('RabbitMQ acknowledged the cancellation of the
>>>> consumer')
>>>>         self.close_channel()
>>>>
>>>>     def stop_consuming(self):
>>>>         """Tell RabbitMQ that you would like to stop consuming by
>>>> sending the
>>>>         Basic.Cancel RPC command.
>>>>
>>>>         """
>>>>         if self._channel:
>>>>             LOGGER.info('Sending a Basic.Cancel RPC command to
>>>> RabbitMQ')
>>>>             self._channel.basic_cancel(self.on_cancelok,
>>>> self._consumer_tag)
>>>>
>>>>     def start_consuming(self):
>>>>         """This method sets up the consumer by first calling
>>>>         add_on_cancel_callback so that the object is notified if
>>>> RabbitMQ
>>>>         cancels the consumer. It then issues the Basic.Consume RPC
>>>> command
>>>>         which returns the consumer tag that is used to uniquely
>>>> identify the
>>>>         consumer with RabbitMQ. We keep the value to use it when we
>>>> want to
>>>>         cancel consuming. The on_message method is passed in as a
>>>> callback pika
>>>>         will invoke when a message is fully received.
>>>>
>>>>         """
>>>>         LOGGER.info('Issuing consumer related RPC commands')
>>>>         self.add_on_cancel_callback()
>>>>         self._consumer_tag =
>>>> self._channel.basic_consume(self.on_message,
>>>>                                                          self.QUEUE)
>>>>
>>>>      def on_bindok(self, unused_frame):
>>>>         """Invoked by pika when the Queue.Bind method has completed. At
>>>> this
>>>>         point we will start consuming messages by calling
>>>> start_consuming
>>>>         which will invoke the needed RPC commands to start the process.
>>>>
>>>>         :param pika.frame.Method unused_frame: The Queue.BindOk
>>>> response frame
>>>>
>>>>         """
>>>>         LOGGER.info('Queue bound')
>>>>         self.start_consuming()
>>>>
>>>>     def close_channel(self):
>>>>         """Call to close the channel with RabbitMQ cleanly by issuing
>>>> the
>>>>         Channel.Close RPC command.
>>>>
>>>>         """
>>>>         LOGGER.info('Closing the channel')
>>>>         self._channel.close()
>>>>
>>>>     def open_channel(self):
>>>>         """Open a new channel with RabbitMQ by issuing the Channel.Open
>>>> RPC
>>>>         command. When RabbitMQ responds that the channel is open, the
>>>>         on_channel_open callback will be invoked by pika.
>>>>
>>>>         """
>>>>         LOGGER.info('Creating a new channel')
>>>>         self._connection.channel(on_open_callback=self.on_channel_open)
>>>>
>>>>     def run(self):
>>>>         """Run the example consumer by connecting to RabbitMQ and then
>>>>         starting the IOLoop to block and allow the SelectConnection to
>>>> operate.
>>>>
>>>>         """
>>>>         self._connection = self.connect()
>>>>         self._connection.ioloop.start()
>>>>
>>>>     def stop(self):
>>>>         """Cleanly shutdown the connection to RabbitMQ by stopping the
>>>> consumer
>>>>         with RabbitMQ. When RabbitMQ confirms the cancellation,
>>>> on_cancelok
>>>>         will be invoked by pika, which will then closing the channel and
>>>>         connection. The IOLoop is started again because this method is
>>>> invoked
>>>>         when CTRL-C is pressed raising a KeyboardInterrupt exception.
>>>> This
>>>>         exception stops the IOLoop which needs to be running for pika to
>>>>         communicate with RabbitMQ. All of the commands issued prior to
>>>> starting
>>>>         the IOLoop will be buffered but not processed.
>>>>
>>>>         """
>>>>         LOGGER.info('Stopping')
>>>>         self._closing = True
>>>>         self.stop_consuming()
>>>>         self._connection.ioloop.start()
>>>>         LOGGER.info('Stopped')
>>>>
>>>>
>>>> def main():
>>>>     logging.basicConfig(level=logging.INFO, format=LOG_FORMAT)
>>>>     example = ExampleConsumer('mqserver10', 5672, 'guest', 'guest')
>>>>     try:
>>>>         example.run()
>>>>     except KeyboardInterrupt:
>>>>         example.stop()
>>>>
>>>>
>>>> if __name__ == '__main__':
>>>>     main()
>>>>
>>>>
>>>> On Thu, Aug 15, 2013 at 3:25 PM, Ask Solem <ask at rabbitmq.com> wrote:
>>>>
>>>>>
>>>>> On Aug 15, 2013, at 1:20 PM, Priyanki Vashi <vashi.priyanki at gmail.com>
>>>>> wrote:
>>>>>
>>>>> > Hi There ,
>>>>> >
>>>>> > This might be very basic error but since I am trying to use Tornado
>>>>> connection for the first time, help on this would be appreciated.
>>>>> >
>>>>> > I was trying to use Tornado consumer example given on following pika
>>>>> site.
>>>>> >
>>>>> >
>>>>> https://pika.readthedocs.org/en/0.9.13/examples/tornado_consumer.html
>>>>> >
>>>>> > I am running into following error. The example is with URL
>>>>> connection method.
>>>>> > But I also tried to use hostname and port method as well as tried
>>>>> changing to IP address instead of hostname but still it's the same error.
>>>>> >
>>>>> > I have pika 0.9.13 library installed. My consumer & Producer works
>>>>> fine with select.connection method so I believe library is correctly
>>>>> installed.
>>>>> >
>>>>> > Do I need to do something additional to get tornado connection
>>>>> working for both producer and consumer with pika?
>>>>> >
>>>>> > Please suggest.
>>>>> >
>>>>> > mq1 at mqserver1:~/Producer_Receiver/Latest$ python tornedo_c_1.py
>>>>> > Traceback (most recent call last):
>>>>> >   File "tornedo_c_1.py", line 357, in <module>
>>>>> >     main()
>>>>> >   File "tornedo_c_1.py", line 351, in main
>>>>> >     example.run()
>>>>> >   File "tornedo_c_1.py", line 326, in run
>>>>> >     self._connection = self.connect()
>>>>> >   File "tornedo_c_1.py", line 59, in connect
>>>>> >     adapters.TornadoConnection(self.parameters,
>>>>> self.on_connection_open, stop_ioloop_on_close=False)
>>>>> > TypeError: 'NoneType' object is not callable
>>>>>
>>>>>
>>>>> Maybe you passed None as a callback somewhere?  What is the value of
>>>>> on_connection_open for example?
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/d9535d2c/attachment.htm>

From vashi.priyanki at gmail.com  Thu Aug 15 17:28:21 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Thu, 15 Aug 2013 18:28:21 +0200
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <CAKgmDnEpUyU6YigxwudoU6TzA=--9r0wykmGU5xh4ZVwX7cSpA@mail.gmail.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
	<CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
	<CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>
	<CA+0nT8Cyg0N8GpFKt4zXEcb3DfwAAGBLUkZMLBsMNQZ1mujHXw@mail.gmail.com>
	<CAKgmDnEpUyU6YigxwudoU6TzA=--9r0wykmGU5xh4ZVwX7cSpA@mail.gmail.com>
Message-ID: <CA+0nT8DScs+T05WmyxKXbjXW3qm5ykQxBLtAF0eVgVim11=nfg@mail.gmail.com>

Hi ,

I don't print 'y'. Which means I don't have tornado installed.

Could you please guide me on how to install this tornado connector ?

I thought pika by default would include tornado so did not realized that
this could be the case.

Best Regards,
Priyanki.


On Thu, Aug 15, 2013 at 6:18 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> Is tornado installed?
>
> run this python fragment:
>
> from pika import adapters
> if adapters.TornadoConnection:
> print 'y'
>
>
>
> On Thu, Aug 15, 2013 at 11:00 AM, Priyanki Vashi <vashi.priyanki at gmail.com
> > wrote:
>
>> Hi,
>>
>> Sorry to say but I have now made connection to return the value but it
>> still say the same error.
>>
>> Does anyone have working example of tornado connector (either consumer or
>> producer) with pika client and has possibility to sharing with me ?
>> Very basic example is also OK.
>>
>> Thank you in advance !
>>
>> Best Regards,
>> Priyanki.
>>
>>
>> On Thu, Aug 15, 2013 at 4:25 PM, Laing, Michael <
>> michael.laing at nytimes.com> wrote:
>>
>>> The connect method doesn't apear to return a connection...
>>>
>>>
>>> On Thu, Aug 15, 2013 at 9:51 AM, Priyanki Vashi <
>>> vashi.priyanki at gmail.com> wrote:
>>>
>>>> Hi ,
>>>>
>>>> on_connection_open, is a callback method, which will be called when
>>>> connection is opened with rabbitmq. It opens channel inturn. So it's little
>>>> unlikely that it has 'None' value but I am not 100% sure.
>>>>
>>>> Here is my code. Could you quickly have a look.
>>>> It's the same example from pika site for tornado consumer except that I
>>>> have tried to use connection parameters instead of URL.
>>>>
>>>>
>>>> from pika import adapters
>>>> import pika
>>>> import logging
>>>>
>>>> LOG_FORMAT = ('%(levelname) -10s %(asctime)s %(name) -30s %(funcName) '
>>>>               '-35s %(lineno) -5d: %(message)s')
>>>> LOGGER = logging.getLogger(__name__)
>>>>
>>>>
>>>> class ExampleConsumer(object):
>>>>     """This is an example consumer that will handle unexpected
>>>> interactions
>>>>     with RabbitMQ such as channel and connection closures.
>>>>
>>>>     If RabbitMQ closes the connection, it will reopen it. You should
>>>>     look at the output, as there are limited reasons why the connection
>>>> may
>>>>     be closed, which usually are tied to permission related issues or
>>>>     socket timeouts.
>>>>
>>>>     If the channel is closed, it will indicate a problem with one of the
>>>>     commands that were issued and that should surface in the output as
>>>> well.
>>>>
>>>>     """
>>>>     EXCHANGE = 'message'
>>>>     EXCHANGE_TYPE = 'topic'
>>>>     QUEUE = 'text'
>>>>     ROUTING_KEY = 'example.text'
>>>>
>>>>
>>>>
>>>>
>>>>     def __init__(self, host, port, username, password):
>>>>         """Setup the example publisher object, passing in the URL we
>>>> will use
>>>>         to connect to RabbitMQ.
>>>>
>>>>         :param str amqp_url: The URL for connecting to RabbitMQ
>>>>
>>>>         """
>>>>
>>>>         self._connection = None
>>>>         self._channel = None
>>>>         self._closing = False
>>>>         self._consumer_tag = None
>>>>         #self._url = amqp_url
>>>>
>>>>         self.credentials = pika.PlainCredentials(username=username,
>>>> password=password)
>>>>         self.parameters = pika.ConnectionParameters(host=host,
>>>> port=port, credentials=self.credentials)
>>>>
>>>>
>>>>
>>>>     def connect(self):
>>>>         """This method connects to RabbitMQ, returning the connection
>>>> handle.
>>>>         When the connection is established, the on_connection_open
>>>> method
>>>>         will be invoked by pika.
>>>>
>>>>         :rtype: pika.SelectConnection
>>>>
>>>>         """
>>>>         #LOGGER.info('Connecting to %s', self._url)
>>>>         adapters.TornadoConnection(self.parameters,
>>>> on_open_callback=self.on_connection_open, stop_ioloop_on_close=False)
>>>>         #return
>>>> adapters.TornadoConnection(pika.URLParameters(self._url),self.on_connection_open)
>>>>
>>>>     def close_connection(self):
>>>>         """This method closes the connection to RabbitMQ."""
>>>>         LOGGER.info('Closing connection')
>>>>         self._connection.close()
>>>>
>>>>     def add_on_connection_close_callback(self):
>>>>         """This method adds an on close callback that will be invoked
>>>> by pika
>>>>         when RabbitMQ closes the connection to the publisher
>>>> unexpectedly.
>>>>
>>>>         """
>>>>         LOGGER.info('Adding connection close callback')
>>>>
>>>> self._connection.add_on_close_callback(self.on_connection_closed)
>>>>
>>>>     def on_connection_closed(self, connection, reply_code, reply_text):
>>>>         """This method is invoked by pika when the connection to
>>>> RabbitMQ is
>>>>         closed unexpectedly. Since it is unexpected, we will reconnect
>>>> to
>>>>         RabbitMQ if it disconnects.
>>>>
>>>>         :param pika.connection.Connection connection: The closed
>>>> connection obj
>>>>         :param int reply_code: The server provided reply_code if given
>>>>         :param str reply_text: The server provided reply_text if given
>>>>
>>>>         """
>>>>         self._channel = None
>>>>         if self._closing:
>>>>             self._connection.ioloop.stop()
>>>>         else:
>>>>             LOGGER.warning('Connection closed, reopening in 5 seconds:
>>>> (%s) %s',
>>>>                            reply_code, reply_text)
>>>>             self._connection.add_timeout(5, self.reconnect)
>>>>
>>>>     def on_connection_open(self, unused_connection):
>>>>         """This method is called by pika once the connection to
>>>> RabbitMQ has
>>>>         been established. It passes the handle to the connection object
>>>> in
>>>>         case we need it, but in this case, we'll just mark it unused.
>>>>
>>>>         :type unused_connection: pika.SelectConnection
>>>>
>>>>         """
>>>>         LOGGER.info('Connection opened')
>>>>         self.add_on_connection_close_callback()
>>>>         self.open_channel()
>>>>
>>>>     def reconnect(self):
>>>>         """Will be invoked by the IOLoop timer if the connection is
>>>>         closed. See the on_connection_closed method.
>>>>
>>>>         """
>>>>         # This is the old connection IOLoop instance, stop its ioloop
>>>>         self._connection.ioloop.stop()
>>>>
>>>>         if not self._closing:
>>>>
>>>>             # Create a new connection
>>>>             self._connection = self.connect()
>>>>
>>>>             # There is now a new connection, needs a new ioloop to run
>>>>             self._connection.ioloop.start()
>>>>
>>>>     def add_on_channel_close_callback(self):
>>>>         """This method tells pika to call the on_channel_closed method
>>>> if
>>>>         RabbitMQ unexpectedly closes the channel.
>>>>
>>>>         """
>>>>         LOGGER.info('Adding channel close callback')
>>>>         self._channel.add_on_close_callback(self.on_channel_closed)
>>>>
>>>>     def on_channel_closed(self, channel, reply_code, reply_text):
>>>>         """Invoked by pika when RabbitMQ unexpectedly closes the
>>>> channel.
>>>>         Channels are usually closed if you attempt to do something that
>>>>         violates the protocol, such as re-declare an exchange or queue
>>>> with
>>>>         different parameters. In this case, we'll close the connection
>>>>         to shutdown the object.
>>>>
>>>>         :param pika.channel.Channel: The closed channel
>>>>         :param int reply_code: The numeric reason the channel was closed
>>>>         :param str reply_text: The text reason the channel was closed
>>>>
>>>>         """
>>>>         LOGGER.warning('Channel %i was closed: (%s) %s',
>>>>                        channel, reply_code, reply_text)
>>>>         self._connection.close()
>>>>
>>>>     def on_channel_open(self, channel):
>>>>         """This method is invoked by pika when the channel has been
>>>> opened.
>>>>         The channel object is passed in so we can make use of it.
>>>>
>>>>         Since the channel is now open, we'll declare the exchange to
>>>> use.
>>>>
>>>>         :param pika.channel.Channel channel: The channel object
>>>>
>>>>         """
>>>>         LOGGER.info('Channel opened')
>>>>         self._channel = channel
>>>>         self.add_on_channel_close_callback()
>>>>         self.setup_exchange(self.EXCHANGE)
>>>>
>>>>     def setup_exchange(self, exchange_name):
>>>>         """Setup the exchange on RabbitMQ by invoking the
>>>> Exchange.Declare RPC
>>>>         command. When it is complete, the on_exchange_declareok method
>>>> will
>>>>         be invoked by pika.
>>>>
>>>>         :param str|unicode exchange_name: The name of the exchange to
>>>> declare
>>>>
>>>>         """
>>>>         LOGGER.info('Declaring exchange %s', exchange_name)
>>>>         self._channel.exchange_declare(self.on_exchange_declareok,
>>>>                                        exchange_name,
>>>>                                        self.EXCHANGE_TYPE)
>>>>
>>>>     def on_exchange_declareok(self, unused_frame):
>>>>         """Invoked by pika when RabbitMQ has finished the
>>>> Exchange.Declare RPC
>>>>         command.
>>>>
>>>>         :param pika.Frame.Method unused_frame: Exchange.DeclareOk
>>>> response frame
>>>>
>>>>         """
>>>>         LOGGER.info('Exchange declared')
>>>>         self.setup_queue(self.QUEUE)
>>>>
>>>>     def setup_queue(self, queue_name):
>>>>         """Setup the queue on RabbitMQ by invoking the Queue.Declare RPC
>>>>         command. When it is complete, the on_queue_declareok method will
>>>>         be invoked by pika.
>>>>
>>>>         :param str|unicode queue_name: The name of the queue to declare.
>>>>
>>>>         """
>>>>         LOGGER.info('Declaring queue %s', queue_name)
>>>>         self._channel.queue_declare(self.on_queue_declareok, queue_name)
>>>>
>>>>     def on_queue_declareok(self, method_frame):
>>>>         """Method invoked by pika when the Queue.Declare RPC call made
>>>> in
>>>>         setup_queue has completed. In this method we will bind the queue
>>>>         and exchange together with the routing key by issuing the
>>>> Queue.Bind
>>>>         RPC command. When this command is complete, the on_bindok
>>>> method will
>>>>         be invoked by pika.
>>>>
>>>>         :param pika.frame.Method method_frame: The Queue.DeclareOk frame
>>>>
>>>>         """
>>>>         LOGGER.info('Binding %s to %s with %s',
>>>>                     self.EXCHANGE, self.QUEUE, self.ROUTING_KEY)
>>>>         self._channel.queue_bind(self.on_bindok, self.QUEUE,
>>>>                                  self.EXCHANGE, self.ROUTING_KEY)
>>>>
>>>>     def add_on_cancel_callback(self):
>>>>         """Add a callback that will be invoked if RabbitMQ cancels the
>>>> consumer
>>>>         for some reason. If RabbitMQ does cancel the consumer,
>>>>         on_consumer_cancelled will be invoked by pika.
>>>>
>>>>         """
>>>>         LOGGER.info('Adding consumer cancellation callback')
>>>>         self._channel.add_on_cancel_callback(self.on_consumer_cancelled)
>>>>
>>>>     def on_consumer_cancelled(self, method_frame):
>>>>         """Invoked by pika when RabbitMQ sends a Basic.Cancel for a
>>>> consumer
>>>>         receiving messages.
>>>>
>>>>         :param pika.frame.Method method_frame: The Basic.Cancel frame
>>>>
>>>>         """
>>>>         LOGGER.info('Consumer was cancelled remotely, shutting down:
>>>> %r',
>>>>                     method_frame)
>>>>         if self._channel:
>>>>             self._channel.close()
>>>>
>>>>     def acknowledge_message(self, delivery_tag):
>>>>         """Acknowledge the message delivery from RabbitMQ by sending a
>>>>         Basic.Ack RPC method for the delivery tag.
>>>>
>>>>         :param int delivery_tag: The delivery tag from the
>>>> Basic.Deliver frame
>>>>
>>>>         """
>>>>         LOGGER.info('Acknowledging message %s', delivery_tag)
>>>>         self._channel.basic_ack(delivery_tag)
>>>>
>>>>     def on_message(self, unused_channel, basic_deliver, properties,
>>>> body):
>>>>         """Invoked by pika when a message is delivered from RabbitMQ.
>>>> The
>>>>         channel is passed for your convenience. The basic_deliver
>>>> object that
>>>>         is passed in carries the exchange, routing key, delivery tag and
>>>>         a redelivered flag for the message. The properties passed in is
>>>> an
>>>>         instance of BasicProperties with the message properties and the
>>>> body
>>>>         is the message that was sent.
>>>>
>>>>         :param pika.channel.Channel unused_channel: The channel object
>>>>         :param pika.Spec.Basic.Deliver: basic_deliver method
>>>>         :param pika.Spec.BasicProperties: properties
>>>>         :param str|unicode body: The message body
>>>>
>>>>         """
>>>>         LOGGER.info('Received message # %s from %s: %s',
>>>>                     basic_deliver.delivery_tag, properties.app_id, body)
>>>>         self.acknowledge_message(basic_deliver.delivery_tag)
>>>>
>>>>     def on_cancelok(self, unused_frame):
>>>>         """This method is invoked by pika when RabbitMQ acknowledges the
>>>>         cancellation of a consumer. At this point we will close the
>>>> channel.
>>>>         This will invoke the on_channel_closed method once the channel
>>>> has been
>>>>         closed, which will in-turn close the connection.
>>>>
>>>>         :param pika.frame.Method unused_frame: The Basic.CancelOk frame
>>>>
>>>>         """
>>>>         LOGGER.info('RabbitMQ acknowledged the cancellation of the
>>>> consumer')
>>>>         self.close_channel()
>>>>
>>>>     def stop_consuming(self):
>>>>         """Tell RabbitMQ that you would like to stop consuming by
>>>> sending the
>>>>         Basic.Cancel RPC command.
>>>>
>>>>         """
>>>>         if self._channel:
>>>>             LOGGER.info('Sending a Basic.Cancel RPC command to
>>>> RabbitMQ')
>>>>             self._channel.basic_cancel(self.on_cancelok,
>>>> self._consumer_tag)
>>>>
>>>>     def start_consuming(self):
>>>>         """This method sets up the consumer by first calling
>>>>         add_on_cancel_callback so that the object is notified if
>>>> RabbitMQ
>>>>         cancels the consumer. It then issues the Basic.Consume RPC
>>>> command
>>>>         which returns the consumer tag that is used to uniquely
>>>> identify the
>>>>         consumer with RabbitMQ. We keep the value to use it when we
>>>> want to
>>>>         cancel consuming. The on_message method is passed in as a
>>>> callback pika
>>>>         will invoke when a message is fully received.
>>>>
>>>>         """
>>>>         LOGGER.info('Issuing consumer related RPC commands')
>>>>         self.add_on_cancel_callback()
>>>>         self._consumer_tag =
>>>> self._channel.basic_consume(self.on_message,
>>>>                                                          self.QUEUE)
>>>>
>>>>      def on_bindok(self, unused_frame):
>>>>         """Invoked by pika when the Queue.Bind method has completed. At
>>>> this
>>>>         point we will start consuming messages by calling
>>>> start_consuming
>>>>         which will invoke the needed RPC commands to start the process.
>>>>
>>>>         :param pika.frame.Method unused_frame: The Queue.BindOk
>>>> response frame
>>>>
>>>>         """
>>>>         LOGGER.info('Queue bound')
>>>>         self.start_consuming()
>>>>
>>>>     def close_channel(self):
>>>>         """Call to close the channel with RabbitMQ cleanly by issuing
>>>> the
>>>>         Channel.Close RPC command.
>>>>
>>>>         """
>>>>         LOGGER.info('Closing the channel')
>>>>         self._channel.close()
>>>>
>>>>     def open_channel(self):
>>>>         """Open a new channel with RabbitMQ by issuing the Channel.Open
>>>> RPC
>>>>         command. When RabbitMQ responds that the channel is open, the
>>>>         on_channel_open callback will be invoked by pika.
>>>>
>>>>         """
>>>>         LOGGER.info('Creating a new channel')
>>>>         self._connection.channel(on_open_callback=self.on_channel_open)
>>>>
>>>>     def run(self):
>>>>         """Run the example consumer by connecting to RabbitMQ and then
>>>>         starting the IOLoop to block and allow the SelectConnection to
>>>> operate.
>>>>
>>>>         """
>>>>         self._connection = self.connect()
>>>>         self._connection.ioloop.start()
>>>>
>>>>     def stop(self):
>>>>         """Cleanly shutdown the connection to RabbitMQ by stopping the
>>>> consumer
>>>>         with RabbitMQ. When RabbitMQ confirms the cancellation,
>>>> on_cancelok
>>>>         will be invoked by pika, which will then closing the channel and
>>>>         connection. The IOLoop is started again because this method is
>>>> invoked
>>>>         when CTRL-C is pressed raising a KeyboardInterrupt exception.
>>>> This
>>>>         exception stops the IOLoop which needs to be running for pika to
>>>>         communicate with RabbitMQ. All of the commands issued prior to
>>>> starting
>>>>         the IOLoop will be buffered but not processed.
>>>>
>>>>         """
>>>>         LOGGER.info('Stopping')
>>>>         self._closing = True
>>>>         self.stop_consuming()
>>>>         self._connection.ioloop.start()
>>>>         LOGGER.info('Stopped')
>>>>
>>>>
>>>> def main():
>>>>     logging.basicConfig(level=logging.INFO, format=LOG_FORMAT)
>>>>     example = ExampleConsumer('mqserver10', 5672, 'guest', 'guest')
>>>>     try:
>>>>         example.run()
>>>>     except KeyboardInterrupt:
>>>>         example.stop()
>>>>
>>>>
>>>> if __name__ == '__main__':
>>>>     main()
>>>>
>>>>
>>>> On Thu, Aug 15, 2013 at 3:25 PM, Ask Solem <ask at rabbitmq.com> wrote:
>>>>
>>>>>
>>>>> On Aug 15, 2013, at 1:20 PM, Priyanki Vashi <vashi.priyanki at gmail.com>
>>>>> wrote:
>>>>>
>>>>> > Hi There ,
>>>>> >
>>>>> > This might be very basic error but since I am trying to use Tornado
>>>>> connection for the first time, help on this would be appreciated.
>>>>> >
>>>>> > I was trying to use Tornado consumer example given on following pika
>>>>> site.
>>>>> >
>>>>> >
>>>>> https://pika.readthedocs.org/en/0.9.13/examples/tornado_consumer.html
>>>>> >
>>>>> > I am running into following error. The example is with URL
>>>>> connection method.
>>>>> > But I also tried to use hostname and port method as well as tried
>>>>> changing to IP address instead of hostname but still it's the same error.
>>>>> >
>>>>> > I have pika 0.9.13 library installed. My consumer & Producer works
>>>>> fine with select.connection method so I believe library is correctly
>>>>> installed.
>>>>> >
>>>>> > Do I need to do something additional to get tornado connection
>>>>> working for both producer and consumer with pika?
>>>>> >
>>>>> > Please suggest.
>>>>> >
>>>>> > mq1 at mqserver1:~/Producer_Receiver/Latest$ python tornedo_c_1.py
>>>>> > Traceback (most recent call last):
>>>>> >   File "tornedo_c_1.py", line 357, in <module>
>>>>> >     main()
>>>>> >   File "tornedo_c_1.py", line 351, in main
>>>>> >     example.run()
>>>>> >   File "tornedo_c_1.py", line 326, in run
>>>>> >     self._connection = self.connect()
>>>>> >   File "tornedo_c_1.py", line 59, in connect
>>>>> >     adapters.TornadoConnection(self.parameters,
>>>>> self.on_connection_open, stop_ioloop_on_close=False)
>>>>> > TypeError: 'NoneType' object is not callable
>>>>>
>>>>>
>>>>> Maybe you passed None as a callback somewhere?  What is the value of
>>>>> on_connection_open for example?
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/b8b684d4/attachment.htm>

From ask at rabbitmq.com  Thu Aug 15 17:32:47 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 15 Aug 2013 17:32:47 +0100
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <CA+0nT8DScs+T05WmyxKXbjXW3qm5ykQxBLtAF0eVgVim11=nfg@mail.gmail.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
	<CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
	<CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>
	<CA+0nT8Cyg0N8GpFKt4zXEcb3DfwAAGBLUkZMLBsMNQZ1mujHXw@mail.gmail.com>
	<CAKgmDnEpUyU6YigxwudoU6TzA=--9r0wykmGU5xh4ZVwX7cSpA@mail.gmail.com>
	<CA+0nT8DScs+T05WmyxKXbjXW3qm5ykQxBLtAF0eVgVim11=nfg@mail.gmail.com>
Message-ID: <6C32B919-5F04-4871-A904-949E2774C98A@rabbitmq.com>


On Aug 15, 2013, at 5:28 PM, Priyanki Vashi <vashi.priyanki at gmail.com> wrote:

> Hi ,
> 
> I don't print 'y'. Which means I don't have tornado installed. 
> 
> Could you please guide me on how to install this tornado connector ?
> 
> I thought pika by default would include tornado so did not realized that this could be the case. 
> 

From looking at the source code I can tell that this will happen
if the 'pika.adapters.tornado_connection' module does not import properly.
If that happens it will simply ignore the error and TornadoConnection
will be None.


Try this:


    from pika.adapters.tornado_connection import TornadoConnection


That may give you the error and reason.

From michael.laing at nytimes.com  Thu Aug 15 17:38:39 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 15 Aug 2013 12:38:39 -0400
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <6C32B919-5F04-4871-A904-949E2774C98A@rabbitmq.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
	<CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
	<CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>
	<CA+0nT8Cyg0N8GpFKt4zXEcb3DfwAAGBLUkZMLBsMNQZ1mujHXw@mail.gmail.com>
	<CAKgmDnEpUyU6YigxwudoU6TzA=--9r0wykmGU5xh4ZVwX7cSpA@mail.gmail.com>
	<CA+0nT8DScs+T05WmyxKXbjXW3qm5ykQxBLtAF0eVgVim11=nfg@mail.gmail.com>
	<6C32B919-5F04-4871-A904-949E2774C98A@rabbitmq.com>
Message-ID: <CAKgmDnHuEu4nPpKAEuU7rJvAnUHn8MOV3bAisgOnNsLpkGxDTg@mail.gmail.com>

at the command line:

pip install tornado


On Thu, Aug 15, 2013 at 12:32 PM, Ask Solem <ask at rabbitmq.com> wrote:

>
> On Aug 15, 2013, at 5:28 PM, Priyanki Vashi <vashi.priyanki at gmail.com>
> wrote:
>
> > Hi ,
> >
> > I don't print 'y'. Which means I don't have tornado installed.
> >
> > Could you please guide me on how to install this tornado connector ?
> >
> > I thought pika by default would include tornado so did not realized that
> this could be the case.
> >
>
> From looking at the source code I can tell that this will happen
> if the 'pika.adapters.tornado_connection' module does not import properly.
> If that happens it will simply ignore the error and TornadoConnection
> will be None.
>
>
> Try this:
>
>
>     from pika.adapters.tornado_connection import TornadoConnection
>
>
> That may give you the error and reason.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/eef83d08/attachment.htm>

From mpietrek at skytap.com  Thu Aug 15 18:00:21 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 15 Aug 2013 10:00:21 -0700
Subject: [rabbitmq-discuss] Question on RabbitMQ and file I/O
	characteristics
In-Reply-To: <52021FD1.50906@rabbitmq.com>
References: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>
	<51FF779D.6040302@rabbitmq.com>
	<CACLE7iyDFtqS7ZWUr5TNmU-Ou-fE7CUBru3owpekRtLYWk0U=A@mail.gmail.com>
	<52011A7F.9010403@rabbitmq.com>
	<CACLE7izYTbUj9LguaP=hZ2x04+86jd2U9caAa7E6Y5KQEhfhWg@mail.gmail.com>
	<52021FD1.50906@rabbitmq.com>
Message-ID: <CACLE7iyQp_y5TZqpxv_Xh9OjixFSs8jPJU=7JK_gbdxhq1dS7Q@mail.gmail.com>

Sorry for coming back to this thread so much after your reply - Was off on
vacation for a week.

> But your ping-pong test is doing the same thing! If it can't send another
message until the previous one has been received, we can't coalesce
together two writes.

Understood - Back to the original question, in this scenario would you
expect each written message to cause approximately four disk writes?
Naively, I'd expect it to be closer to two or three writes.

It's fine if so - I just want to ensure that our experimental data matches
up with your expert opinion on what should be happening.

Thanks much,

Matt





On Wed, Aug 7, 2013 at 3:22 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/08/13 18:42, Matt Pietrek wrote:
>
>> The net effect is that messages 'ping-pong' between the two ioloop
>> threads as fast as possible. In the 'main' ioloop init, it sends an
>> initial message to kick things off.
>>
>
> <snip>
>
>
>  I also have a global switch (USE_TRANSACTIONS) that lets me switch
>> between using transactions and not. When set, it adds tx_select() when
>> opening the channels and tx_commit after publishing messages. For the
>> tests I was running, I wasn't using transactions. If I do run with
>> transactions the numbers are very similar (surprising I know, but I
>> stepped through the code to verify that the tx_xxx calls are only made
>> when I intend them to be.)
>>
>
> Ah, I see. The thing is that transactions are quite lightweight in and of
> themselves, the reason they tend to slow things down is they form a barrier
> across which we can't coalesce writes / have to wait for a synchronous
> network round trip.
>
> But your ping-pong test is doing the same thing! If it can't send another
> message until the previous one has been received, we can't coalesce
> together two writes. And it also ensures there's only one message on the
> wire at once.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/2cd00ad6/attachment.htm>

From akmartin at gmail.com  Thu Aug 15 18:26:24 2013
From: akmartin at gmail.com (akmartin)
Date: Thu, 15 Aug 2013 10:26:24 -0700 (PDT)
Subject: [rabbitmq-discuss] ConnectFailureException on CreateConnection()
Message-ID: <1376587584006-28850.post@n5.nabble.com>

The following exception is thrown when I try to connect to RabbitMq. My retry
logic forces another attempt and the second time through it succeeds. Every
invocation is configured with the same hostname and resolve to the same
endpoint.

I am running 3.1.3. Waiting on updated nuget packages to upgrade servers.

-----

A first chance exception of type
'RabbitMQ.Client.Exceptions.ConnectFailureException' occurred in
RabbitMQ.Client.dll

-----

RabbitMQ.Client.Exceptions.ConnectFailureException occurred
  HResult=-2146233087
  Message=Connection failed
  Source=RabbitMQ.Client
  StackTrace:
       at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Connect(TcpClient
socket, AmqpTcpEndpoint endpoint, Int32 timeout)
  InnerException: System.ArgumentException
       HResult=-2147024809
       Message=None of the discovered or specified addresses match the
socket address family.
Parameter name: context
       Source=System
       ParamName=context
       StackTrace:
            at System.Net.Sockets.Socket.EndConnect(IAsyncResult
asyncResult)
            at System.Net.Sockets.TcpClient.EndConnect(IAsyncResult
asyncResult)
            at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Connect(TcpClient
socket, AmqpTcpEndpoint endpoint, Int32 timeout)
       InnerException: 

-----

=INFO REPORT==== 15-Aug-2013::13:13:56 ===
Starting RabbitMQ 3.1.3 on Erlang R16B01
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 15-Aug-2013::13:13:56 ===
node           : rabbit at BOSRISTSTFAB201
home dir       : C:\Windows
config file(s) : (none)
cookie hash    : 4iMy9kPPnz2+kU/rcQz9Rw==
log            :
C:/Users/admin-amartin/AppData/Roaming/RabbitMQ/log/rabbit at BOSRISTSTFAB201.log
sasl log       :
C:/Users/admin-amartin/AppData/Roaming/RabbitMQ/log/rabbit at BOSRISTSTFAB201-sasl.log
database dir   :
c:/Users/admin-amartin/AppData/Roaming/RabbitMQ/db/rabbit at BOSRISTSTFAB201-mnesia

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
Limiting to approx 8092 file handles (7280 sockets)

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
Memory limit set to 3276MB of 8191MB total.

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
Disk free limit set to 1000MB

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
rabbit on node rabbit at BOSRISTSTFAB202 up

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
rabbit on node rabbit at MARRISTSTFAB202 up

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
rabbit on node rabbit at MARRISTSTFAB201 up

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
Management plugin started. Port: 15672

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
accepting AMQP connection <0.331.0> (10.20.40.96:53725 -> 10.20.40.90:5672)

=INFO REPORT==== 15-Aug-2013::13:13:58 ===
closing AMQP connection <0.331.0> (10.20.40.96:53725 -> 10.20.40.90:5672)



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/ConnectFailureException-on-CreateConnection-tp28850.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Thu Aug 15 19:33:26 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 15 Aug 2013 11:33:26 -0700
Subject: [rabbitmq-discuss] ANN: SimpleAmqpClient v2.3 released
Message-ID: <CAAt2po+Kf8m1-kaNf2c-ekocoeAX6FbDXhSGtWygS-mTfiM72A@mail.gmail.com>

SimpleAmqpClient is a developer-friendly C++ wrapper around rabbitmq-c.

New features for SimpleAmqpClient v2.3:
- SSL support.
- Compatibility with rabbitmq-c v0.4.0
- and more...

The complete ChangeLog can be found:
https://github.com/alanxz/SimpleAmqpClient/blob/v2.3/ChangeLog.md
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/275b5af3/attachment.htm>

From ramviv.123 at gmail.com  Thu Aug 15 20:10:55 2013
From: ramviv.123 at gmail.com (ramviv.123 at gmail.com)
Date: Thu, 15 Aug 2013 12:10:55 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <81ea8a73-8747-4b49-9f08-7edec5e5f487@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
	<61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
	<81ea8a73-8747-4b49-9f08-7edec5e5f487@googlegroups.com>
Message-ID: <a1231520-7071-4303-bfd8-bde84a03a01b@googlegroups.com>

I installed the latest 3.1.5 and the server comes out fine with no custom 
config or env file.  When I put the config filei above, it works as well 
with clustering working.  When I setup the env ffile the rabbitMQ server of 
the primary node always hangs and the secondary node always timesout trying 
to connect to the other host.  There is not much info in the logs either. 
 We change the env file above to use only one boot file which was created 
as described in the erlang documentation.

SASL_BOOT_FILE=/usr/lib/erlang/releases/R16B01/start_ssl
SERVER_START_ARGS=" -proto_dist inet_tls "

   The log file has this and nothing else

=INFO REPORT==== 15-Aug-2013::13:04:24 ===
Statistics database started.

=INFO REPORT==== 15-Aug-2013::13:04:24 ===
Server startup complete; 12 plugins started.
 * amqp_client
 * mochiweb
 * rabbitmq_auth_mechanism_ssl
 * rabbitmq_consistent_hash_exchange
 * rabbitmq_federation
 * rabbitmq_federation_management
 * rabbitmq_management
 * rabbitmq_management_agent
 * rabbitmq_management_visualiser
 * rabbitmq_tracing
 * rabbitmq_web_dispatch
 * webmachine

    Is there a way to turn on more tracing or someone else has seen these 
before.  Would appreciate any pointers.

Thanks
Venkat

On Wednesday, August 14, 2013 3:42:29 PM UTC-4, ramvi... at gmail.com wrote:
>
> As suggested, I upgraded erlang to R16B01 and RabbitMQ server to 3.1.4.1. 
>  After the upgrade the RabbitMQ server does not come up.  I removed any 
> custom env or config files as well as the mnesia tables. I also tried 
> removing all of the rabbitmq and erlang installs and reinstalling them.  I 
> have the following versions on the system
>
> # rpm -qa | grep -i esl | more
> esl-erlang-R16B01-1.x86_64
> # rpm -qa | grep -i rabbit
> rabbitmq-server-3.1.4-1.noarch
>
> The startup_log has the following.
>
>               Starting broker...
>
> BOOT FAILED
> ===========
>
> Error description:
>    {could_not_start,rabbit,undef}
>
> Log files (may contain more information):
>    /var/log/rabbitmq/rabbit at itops-dev-164.log
>    /var/log/rabbitmq/rabbit at itops-dev-164-sasl.log
>
> {"init terminating in 
> do_boot",{rabbit,failure_during_boot,{could_not_start,rabbit,undef}}}^M
> ^[[60G[^[[0;31mFAILED^[[0;39m]^M
>
>    I am also attaching the sasl log and erl_crash.dump.  Would appreciate 
> any help in solving this issue.
>
>
> On Tuesday, August 13, 2013 5:39:53 PM UTC-4, ramvi... at gmail.com wrote:
>>
>> We also noticed two other failures.  When we kill the epmd process and 
>> restart rabbitMQ we see the following error.  
>>
>> {error_logger,{{2013,8,13},{17,31,53}},"Protocol: ~p: not 
>> supported~n",["inet_tls"]}
>>
>>    According to one other thread here, this should go away if we use the 
>> latest version of erlang, which we are using.  Rabbit MQ also seems to 
>> recognize the latest version of erlang, when we do rabbitmqctl status. We 
>> checked this  removing the SSL.configuration.  As mentioned in the ssl 
>> config guide for erlang, if we uncomment the commented out section of the 
>> config file below, the RRabbitMQ server would just hang.  I am able to 
>> connect the WebUI, but I never get the success message on the terminal I 
>> started the server.  Also, the other node when brought up, times out trying 
>> to connect to this node.
>>
>> -Venkat
>>
>> On Tuesday, August 13, 2013 12:00:57 PM UTC-4, ramvi... at gmail.com wrote:
>>>
>>> Hi,
>>>
>>>     We are setting up a RabbitMQ env with clustering on the LAN and 
>>> federated on the WAN.  We also intend to use consistent hash on the 
>>> receiver side.  We were able to successfully setup a federated 
>>> configuration with ssl enabled.  But we are having issues trying to setup 
>>> ssl with clusters.  We are using RabbitMQ 3.1.3 with erlang 
>>> version  5.9.3.1.  We have setup the erlang config based on 
>>> http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.   I am able 
>>> connect tru an erlang client server program to send data back and forth and 
>>> so I know the ssl with erlang works.  But when I bring RabbitMQ with 
>>> clusters and take a TCP dump of the packets, the data transfer seem to be 
>>> clear text.  Is there a way to check if the clusters are configured for ssl 
>>> by any other means.  Also, would appreciate if someone can point out what 
>>> am I doing wrong here.  Here is the env file (rabbitmq-env.conf)
>>>
>>> SERVER_START_ARGS="-boot /usr/lib64/erlang/releases/R15B03/start_ssl 
>>> -proto_dist inet_tls"
>>> #SERVER_START_ARGS="${SERVER_START_ARGS} -pa 
>>> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
>>> #SERVER_START_ARGS="${SERVER_START_ARGS} 
>>> /usr/lib64/erlang/lib/asn1-1.8/ebin"
>>> #SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_portprogram_dir 
>>> /usr/lib64/erlang/lib/ssl-5.1.2/ebin"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_cacertfile 
>>> /etc/openssl/all_cacerts.pem"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_certfile 
>>> /etc/openssl/nn-vmrh5/cert.pem"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_keyfile 
>>> /etc/openssl/nn-vmrh5/key.pem"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt server_verify 1"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>>> server_fail_if_no_peer_cert true"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>>> server_secure_renegotiate true"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_cacertfile 
>>> /etc/openssl/all_cacerts.pem"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_certfile 
>>> /etc/openssl/nn-vmrh5/cert.pem"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_keyfile 
>>> /etc/openssl/nn-vmrh5/key.pem"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt client_verify 1"
>>> SERVER_START_ARGS="${SERVER_START_ARGS} -ssl_dist_opt 
>>> client_secure_renegotiate true"
>>> #echo SERVER_START_ARGS: ${SERVER_START_ARGS}
>>>
>>> Here is the rabbitmq.config for clustering and ssl option set for other 
>>> modes.
>>>
>>>
>>> [nn-vmrh5: /etc/rabbitmq]vi rabbitmq.config
>>> [
>>>     {rabbit, [
>>>         {default_vhost, <<"alert">>},
>>>         {tcp_listeners, [5672]},
>>>         {ssl_listeners, [5671]},
>>>         {rabbitmq_tracing, [{username, "guest"}]},
>>>         {cluster_nodes, ['rabbit at nn-vmrh5','rabbit at nn-vmrh5g']},
>>>         {ssl_options, [{cacertfile,"/etc/openssl/all_cacerts.pem"},
>>>                        {certfile,"/etc/openssl/nn-vmrh5/cert.pem"},
>>>                        {keyfile,"/etc/openssl/nn-vmrh5/key.pem"},
>>>                        {verify,verify_peer},
>>>                        {fail_if_no_peer_cert,true}] },
>>>         {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
>>>         {ssl_cert_login_from, common_name},
>>>         {log_levels, [{connection, info}]}
>>>     ] }
>>> ].
>>>
>>>    Would really appreciate any help on this.
>>>
>>> Thanks
>>> Venkat
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/d56144e0/attachment.htm>

From stuff at moesel.net  Thu Aug 15 21:09:46 2013
From: stuff at moesel.net (Chris)
Date: Thu, 15 Aug 2013 16:09:46 -0400
Subject: [rabbitmq-discuss] Hung Server Upgrading from 3.1.1 to 3.1.5 in a
	cluster
Message-ID: <CAHEpgBCvORiBktuDpHSEnx2SLmo-a-GLhSvbebsmDJjiMZoeHA@mail.gmail.com>

Hello,

I had a running cluster of two RabbitMQ 3.1.1 servers on Redhat 6.2.  I
left both running and then attempted to upgrade one (via yum).  After the
upgrade, rabbitmqctl reported the cluster_status was good, but none of my
consumers seemed to be working.

I then attempted to upgrade the other, hoping that would fix things, but
the upgrade just hung.  After killing the upgrade (ctl-c) I noted that I
couldn't stop rabbitmq-server anymore (not via service script or
rabbitmqctl).  I had to kill it manually.  After killing it, I re-ran the
upgrade and all was well.

Looking in the logs, I then saw a BUNCH of errors with timestamps
corresponding to when I upgraded the first server.  It seems that didn't go
cleanly on the remaining 3.1.1 node and might be responsible for all the
trouble.  Did I just get unlucky?

Here's the SASL log:

=CRASH REPORT==== 15-Aug-2013::14:27:49 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.271.0>
    registered_name: []
    exception exit: {{badmatch,{error,not_found}},
                     [{rabbit_mirror_queue_master,stop_all_slaves,2,
                          [{file,"src/rabbit_mirror_queue_master.erl"},
                           {line,179}]},
                      {rabbit_mirror_queue_master,delete_and_terminate,2,
                          [{file,"src/rabbit_mirror_queue_master.erl"},
                           {line,175}]},
                      {rabbit_amqqueue_process,'-terminate/2-fun-3-',5,
                          [{file,"src/rabbit_amqqueue_process.erl"},
                           {line,162}]},
                      {rabbit_amqqueue_process,terminate_shutdown,2,
                          [{file,"src/rabbit_amqqueue_process.erl"},
                           {line,272}]},
                      {gen_server2,terminate,3,
                          [{file,"src/gen_server2.erl"},{line,1031}]},
                      {proc_lib,wake_up,3,
                          [{file,"proc_lib.erl"},{line,249}]}]}
      in function  gen_server2:terminate/3 (src/gen_server2.erl, line 1034)
    ancestors: [rabbit_mirror_queue_slave_sup,rabbit_sup,<0.148.0>]
    messages: []
    links: [<0.270.0>]
    dictionary: [{guid,{{3434499189,622214121,884364685,3594937084},1}}]
    trap_exit: true
    status: running
    heap_size: 1598
    stack_size: 27
    reductions: 9106
  neighbours:

=SUPERVISOR REPORT==== 15-Aug-2013::14:27:49 ===
     Supervisor: {local,
                                           rabbit_mirror_queue_slave_sup}
     Context:    child_terminated
     Reason:     {{badmatch,{error,not_found}},
                  [{rabbit_mirror_queue_master,stop_all_slaves,2,
                       [{file,"src/rabbit_mirror_queue_master.erl"},
                        {line,179}]},
                   {rabbit_mirror_queue_master,delete_and_terminate,2,
                       [{file,"src/rabbit_mirror_queue_master.erl"},
                        {line,175}]},
                   {rabbit_amqqueue_process,'-terminate/2-fun-3-',5,

 [{file,"src/rabbit_amqqueue_process.erl"},{line,162}]},
                   {rabbit_amqqueue_process,terminate_shutdown,2,

 [{file,"src/rabbit_amqqueue_process.erl"},{line,272}]},
                   {gen_server2,terminate,3,
                       [{file,"src/gen_server2.erl"},{line,1031}]},
                   {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
     Offender:   [{pid,<0.271.0>},
                  {name,rabbit_mirror_queue_slave},
                  {mfa,
                      {rabbit_mirror_queue_slave,start_link,
                          [{amqqueue,
                               {resource,<<"acs">>,queue,

 <<"replies.4a0e284c-1662-463a-b363-cbb4e9557266">>},
                               true,false,none,
                               [{<<"x-expires">>,signedint,600000}],
                               <7111.3423.0>,[],[],
                               [{vhost,<<"acs">>},
                                {name,<<"ha-acs">>},
                                {pattern,<<".*">>},
                                {definition,
                                    [{<<"ha-mode">>,<<"exactly">>},
                                     {<<"ha-params">>,2}]},
                                {priority,0}],
                               [{<7111.3424.0>,<7111.3423.0>},
                                {<7111.8011.82>,<7111.8010.82>},
                                {<0.27964.278>,<0.27962.278>}]}]}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]

Thanks!
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/31e9945d/attachment.htm>

From handrix at gmail.com  Thu Aug 15 23:07:13 2013
From: handrix at gmail.com (mezgani ali)
Date: Thu, 15 Aug 2013 22:07:13 +0000
Subject: [rabbitmq-discuss] AMQP or HTTP API
Message-ID: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>

Hello,

I have a monitoring application based on many servers
http://imagebin.org/267710
the main application is hosted on a separated server and there are nodes.
The main server will communicate with nodes using HTTP
I need to retrieve data from database and send it to nodes where nodes have
to do some tasks like pinging client's server and measure latency.

The problem I have with HTTP API is that I don't know how to choose node
that will do the job, how to synchronize them. Please can you help me with
this
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/f30264e1/attachment.htm>

From Mark.Geib at echostar.com  Thu Aug 15 23:28:12 2013
From: Mark.Geib at echostar.com (Geib, Mark)
Date: Thu, 15 Aug 2013 22:28:12 +0000
Subject: [rabbitmq-discuss] How to catch RESOURCE_LOCKED exceptions in
 erlang client
Message-ID: <1BB6C6C6-0196-4E4B-A95F-7435EADA5112@echostar.com>

I am trying to use the feature of creating exclusive queues in order to limit consumers to "one at a time" for given messages but can not see how to catch the exception I receive when the second consumer tries to declare the same queue. Everything is working as excepted but I am not sure how to prevent my gen_server from terminating. I want to catch the event, then retry, to provide a "backup" consumer.

In my log file I see:
16:18:59.011 [error] CRASH REPORT Process 'amqp_worker_con_2:1' with 0 neighbours exited with reason: {{shutdown,{server_initiated_close,405,<<"RESOURCE_LOCKED - cannot obtain exclusive access to locked queue 'q1' in vhost '/'">>}},{gen_server,call,[<0.101.0>,{call,{'queue.declare',0,<<"q1">>,false,false,true,true,false,[]},none,<0.66.0>},infinity]}} in gen_server:terminate/6 line 744

Thanks for any help,

Mark Geib
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215


?We, the unwilling, led by the unknowing, are doing the impossible for the ungrateful. We have done so much, for so long, with so little, we are now qualified to do anything with nothing.? 
? Mother Teresa


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 203 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/1cdb79a3/attachment.pgp>

From joshua__lim at hotmail.com  Fri Aug 16 07:26:37 2013
From: joshua__lim at hotmail.com (joshua__lim)
Date: Thu, 15 Aug 2013 23:26:37 -0700 (PDT)
Subject: [rabbitmq-discuss] How to receive STOMP receipt only after the
 consumer has acknowledged the message?
In-Reply-To: <520CAE19.4030909@rabbitmq.com>
References: <1376553781942-28808.post@n5.nabble.com>
	<520CAE19.4030909@rabbitmq.com>
Message-ID: <1376634397522-28856.post@n5.nabble.com>

Hi Emile, thank you for your reply to my query.

> If you want an end-to-end proof of delivery from the consumer then you
> must set up an independent line of communication between the consumer
> and the producer and send a proof-of-delivery token back along that route.
<
> Depending on your needs you may wish to make consumer acknowledgements
> synchronous by acknowledging in a transaction before sending the
> proof-of-delivery.

Here's how I think I may implement the end to end delivery reporting.

For my case, I'll be running multiple threads and producers, connecting to a
RabbitMQ cluster of 2 servers.  Each producer will subscribe to a distinct
"ack" queue to receive acknowledgements for messages they sent.  The
consumer will need to know which "ack" queue to send the acknowledgement.

By "transaction", would you be referring to STOMP transaction?  I was just
testing ACK with the transaction header the last couple of hours but did not
manage to get it to work - ACK is processed without having to issue COMMIT. 
In the following test, I subscribed to the topic "keepalive", created a
transaction with id "gwtx8" and receive a message with payload "I'm alive!". 

 SUBSCRIBE
destination:/topic/presence
ack:client-individual
id:alertgateway1
persistent:true
receipt:005

^@
RECEIPT
receipt-id:005

BEGIN
transaction:gwtx8

^@
MESSAGE
subscription:alertgateway1
destination:/topic/presence
message-id:T_alertgateway1@@session-sAtZSzKtm_X58pl46L0_uw@@3
receipt:003
persistent:true
content-length:19

I'm alive!

 ACK
subscription:alertgateway1
message-id:T_alertgateway1@@session-sAtZSzKtm_X58pl46L0_uw@@3
transaction:gwtx8
receipt:001

^@
RECEIPT
receipt-id:001
--> ACK is processed without COMMIT




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-receive-STOMP-receipt-only-after-the-consumer-has-acknowledged-the-message-tp28808p28856.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Fri Aug 16 08:13:35 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 16 Aug 2013 08:13:35 +0100
Subject: [rabbitmq-discuss] AMQP or HTTP API
In-Reply-To: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>
References: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>
Message-ID: <15259B62-6952-4F2D-B7B7-8D82E615D6CF@rabbitmq.com>

It's not really clear what you're trying I do. 

On 15 Aug 2013, at 23:07, mezgani ali <handrix at gmail.com> wrote:
> 
> The problem I have with HTTP API is that I don't know how to choose node that will do the job, how to synchronize them. 

Are you talking about the rabbitmq-management plugins's http API?

From michael.justin at gmx.net  Fri Aug 16 08:41:40 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Fri, 16 Aug 2013 09:41:40 +0200
Subject: [rabbitmq-discuss] How to receive STOMP receipt only after the
 consumer has acknowledged the message?
In-Reply-To: <1376553781942-28808.post@n5.nabble.com>
References: <1376553781942-28808.post@n5.nabble.com>
Message-ID: <kukl3d$dhv$1@ger.gmane.org>


 >
 > I'm trying to figure out if it is possible for the receipt to be sent 
by the
 > broker only after the recipient has acknowledged the message?


A different approach could be request / response style communication 
using temporary queues. They exist only for the duration of a connection 
and can be used to send the "success" message or any other response from 
the other side to the client. RabbitMQ STOMP supports temporary queues. 
I am using them in a Delphi STOMP client library.

See https://www.rabbitmq.com/stomp.html

Section "Temp Queue Destinations"

Michael




From tim at rabbitmq.com  Fri Aug 16 09:30:17 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 16 Aug 2013 09:30:17 +0100
Subject: [rabbitmq-discuss] How to catch RESOURCE_LOCKED exceptions in
	erlang client
In-Reply-To: <1BB6C6C6-0196-4E4B-A95F-7435EADA5112@echostar.com>
References: <1BB6C6C6-0196-4E4B-A95F-7435EADA5112@echostar.com>
Message-ID: <AE8BB073-1908-4303-8A4B-721928F84FE8@rabbitmq.com>

Hi Mark,

On 15 Aug 2013, at 23:28, Geib, Mark wrote:
> I am trying to use the feature of creating exclusive queues in order to limit consumers to "one at a time" for given messages but can not see how to catch the exception I receive when the second consumer tries to declare the same queue. Everything is working as excepted but I am not sure how to prevent my gen_server from terminating. I want to catch the event, then retry, to provide a "backup" consumer.
> 

But isn't your second client/consumer just going to be stuck in a loop of constantly attempting a basic.consume, failing and then retrying again!? That seems like a serious waste of resources, both in the client and on the server. Worse still, it simply won't work because if the queue is exclusive, when the channel that declared it is closed, the queue will be deleted! Your second consumer will never be able to establish itself as a consumer. I guess that's probably not what you want.

I would look to other means if I were you. If you're simply trying to establish a pattern of one worker per job/process type, then just use a regular supervisor to achieve this. Establish the supervisor with just one child/worker, and that child will be restarted on demand. Alternatively, if you need to start many workers that run the same code, but with different configurations (e.g., interacting with different exchanges/queues, etc) then use a simple_one_for_one supervisor.

It's hard to give you more specific guidance without looking at your code, but here are some general points that might help...

Firstly, if you need some kind of retry logic, then you almost always want to use supervision trees to achieve it. In the few cases that you don't - for whatever reason - then doing your own "supervision" of workers is best achieved using monitors.

Secondly, there's no universal way to "prevent a gen_server from terminating", but there are a few things that can help:

1. handle "exit signals" generically by trapping exits in your init/1 callback and adding a handle_info/2 clause that "deals with them"

init(_) ->
    process_flag(trap_exit, true),
    etc....
    {ok, State}.

%% ...

handle_info({'EXIT', Pid, Reason}, State) ->
    handle_exit(Pid, Reason),
    {noreply, State}.

2. handle "exit signals" from other processes in the same way, linking or monitoring, then dealing with exits in handle_info

init(Config) ->
    {ok, Conn} = amqp_connection:start(parse_config(Config)),
    {ok, Chan} = amqp_connection:open_channel(Conn),
    {ok, #state{ connection = Conn, channel = Chan }}.

%% ...

handle_info({'EXIT', Pid, Reason}, State = #state{ channel = Chan }) when Pid == Chan ->
    report_channel_error(Pid, Reason),
    {ok, NewChan} = amqp_connection:open_channel(State#state.connection),
    {noreply, State#state{ channel = NewChan }}.

If a synchronous method on a channel fails, an exception will be thrown to the caller. For example:

{'EXIT',{{shutdown,{server_initiated_close, 405, Msg}}, _}} =
    catch amqp_channel:subscribe(Chan2, #'basic.consume'{queue = Q}, self()).

You can use erlang's try..catch..finally construct in places like this too.

BTW, if you're using amqp_gen_consumer then you have now way to avoid termination, since the channel will close once the RESOURCE_LOCKED channel error arrives. If on the other hand, your gen_server creates the channel, then you can handle this as I mentioned above.

In general though, I'd rethink your approach since it doesn't sound quite right to me.

HTH - cheers,

Tim


From tim at rabbitmq.com  Fri Aug 16 09:36:14 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 16 Aug 2013 09:36:14 +0100
Subject: [rabbitmq-discuss] How to catch RESOURCE_LOCKED exceptions in
	erlang client
In-Reply-To: <AE8BB073-1908-4303-8A4B-721928F84FE8@rabbitmq.com>
References: <1BB6C6C6-0196-4E4B-A95F-7435EADA5112@echostar.com>
	<AE8BB073-1908-4303-8A4B-721928F84FE8@rabbitmq.com>
Message-ID: <A8F81ED8-022D-4E66-B38A-3B7EC42F055C@rabbitmq.com>

On 16 Aug 2013, at 09:30, Tim Watson wrote:

Erm - quick errata: you also need

> 2. handle "exit signals" from other processes in the same way, linking or monitoring, then dealing with exits in handle_info
> 
> init(Config) ->
>    {ok, Conn} = amqp_connection:start(parse_config(Config)),
>    {ok, Chan} = amqp_connection:open_channel(Conn),
      link(Chan),
>    {ok, #state{ connection = Conn, channel = Chan }}.
> 

otherwise you won't get the {'EXIT', _, _} tuple if/when the channel process exits. With monitors it'd look like this:

init(Config) ->
    {ok, Conn} = amqp_connection:start(parse_config(Config)),
    {ok, Chan} = amqp_connection:open_channel(Conn),
    erlang:monitor(process, Chan),
    {ok, #state{ connection = Conn, channel = Chan }}.

%% ...

handle_info({'DOWN', _Ref, process, Pid, Reason}, State) ... etc


Cheers,
Tim

From matthias at rabbitmq.com  Fri Aug 16 09:50:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 16 Aug 2013 09:50:45 +0100
Subject: [rabbitmq-discuss] How to catch RESOURCE_LOCKED exceptions in
 erlang client
In-Reply-To: <AE8BB073-1908-4303-8A4B-721928F84FE8@rabbitmq.com>
References: <1BB6C6C6-0196-4E4B-A95F-7435EADA5112@echostar.com>
	<AE8BB073-1908-4303-8A4B-721928F84FE8@rabbitmq.com>
Message-ID: <520DE7E5.10009@rabbitmq.com>

On 16/08/13 09:30, Tim Watson wrote:
> But isn't your second client/consumer just going to be stuck in a
> loop of constantly attempting a basic.consume, failing and then
> retrying again!? That seems like a serious waste of resources, both
> in the client and on the server. Worse still, it simply won't work
> because if the queue is exclusive, when the channel that declared it
> is closed, the queue will be deleted! Your second consumer will never
> be able to establish itself as a consumer. I guess that's probably
> not what you want.

I suspect Mark was thinking of the exclusive consumer feature, i.e. the 
'exclusive' flag on basic.consume 
(http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.exclusive).

However, the "RESOURCE_LOCKED - cannot obtain exclusive access to locked 
queue 'q1' in vhost '/'" error message from Mark's email does actually 
correspond to an exclusive *queue* access failure, just as you have been 
describing above; the error message for an exclusive consumer violation 
would be "ACCESS_REFUSED - queue ... in exclusive use".

Regards,

Matthias.

From tim at rabbitmq.com  Fri Aug 16 09:57:37 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 16 Aug 2013 09:57:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering with SSL
In-Reply-To: <a1231520-7071-4303-bfd8-bde84a03a01b@googlegroups.com>
References: <f8fccacb-0632-430b-96cd-aa701ac92dce@googlegroups.com>
	<61e5fb23-dab0-441b-8021-0fcdd3c09386@googlegroups.com>
	<81ea8a73-8747-4b49-9f08-7edec5e5f487@googlegroups.com>
	<a1231520-7071-4303-bfd8-bde84a03a01b@googlegroups.com>
Message-ID: <4051446B-A663-433F-B9AA-B9AA53823390@rabbitmq.com>

On 15 Aug 2013, at 20:10, ramviv.123 at gmail.com wrote:
> I installed the latest 3.1.5 and the server comes out fine with no custom config or env file.  When I put the config filei above, it works as well with clustering working.  When I setup the env ffile the rabbitMQ server of the primary node always hangs and the secondary node always timesout trying to connect to the other host.

The second node your starting is exhibiting behaviour consistent with the first node not being up. What exactly do you mean by "the primary node always hangs" though?

>  There is not much info in the logs either.  We change the env file above to use only one boot file which was created as described in the erlang documentation.
> 
> SASL_BOOT_FILE=/usr/lib/erlang/releases/R16B01/start_ssl
> SERVER_START_ARGS=" -proto_dist inet_tls "
> 

You're using inet_tls_dist - are you sure all the relevant ports are open between both machines? What about the various ssl_dist_opt settings - I can't see any of these in your SERVER_START_ARGS, and without at least the server_certfile being provided, won't the distribution mechanism fail to work? Also, can you try it without overwriting the default start_sasl boot file (which is a bad idea IMO) but instead just adding `-boot /path/to/ssl/boot/file' instead?

Cheers,
Tim


From vashi.priyanki at gmail.com  Fri Aug 16 10:02:30 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Fri, 16 Aug 2013 11:02:30 +0200
Subject: [rabbitmq-discuss] Tornado Consumer example problem
In-Reply-To: <CAKgmDnHuEu4nPpKAEuU7rJvAnUHn8MOV3bAisgOnNsLpkGxDTg@mail.gmail.com>
References: <8623fc0f-a5f5-4677-a2c6-5b2a381c8cab@googlegroups.com>
	<B63C2846-7D84-4EFA-8106-D2AA1BEC0A1A@rabbitmq.com>
	<CA+0nT8D7P1dUuy-p8c69O=HBfG2p9B6-gMPYC75-3WRUa2M_NQ@mail.gmail.com>
	<CAKgmDnFLm73szhOL-heFNS1kbtjGrDZFVO33-=MeGCNmfBfWhA@mail.gmail.com>
	<CA+0nT8Cyg0N8GpFKt4zXEcb3DfwAAGBLUkZMLBsMNQZ1mujHXw@mail.gmail.com>
	<CAKgmDnEpUyU6YigxwudoU6TzA=--9r0wykmGU5xh4ZVwX7cSpA@mail.gmail.com>
	<CA+0nT8DScs+T05WmyxKXbjXW3qm5ykQxBLtAF0eVgVim11=nfg@mail.gmail.com>
	<6C32B919-5F04-4871-A904-949E2774C98A@rabbitmq.com>
	<CAKgmDnHuEu4nPpKAEuU7rJvAnUHn8MOV3bAisgOnNsLpkGxDTg@mail.gmail.com>
Message-ID: <CA+0nT8BCV9tjdkMUHysvrpuaAabEoLFiM6E5NMsG0+akbhvhmQ@mail.gmail.com>

Hi again,

You are right. There seems to be some problem during my library
installation.
So now I re-installed both pika and tornado but somehow pip did not worked
so I instead used apt-get and installed.

Thank you very much . It was of a great help.

I will also make publisher with tornado and see if I see any difference in
throughput.


Best Regards,
Priyanki.


On Thu, Aug 15, 2013 at 6:38 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> at the command line:
>
> pip install tornado
>
>
> On Thu, Aug 15, 2013 at 12:32 PM, Ask Solem <ask at rabbitmq.com> wrote:
>
>>
>> On Aug 15, 2013, at 5:28 PM, Priyanki Vashi <vashi.priyanki at gmail.com>
>> wrote:
>>
>> > Hi ,
>> >
>> > I don't print 'y'. Which means I don't have tornado installed.
>> >
>> > Could you please guide me on how to install this tornado connector ?
>> >
>> > I thought pika by default would include tornado so did not realized
>> that this could be the case.
>> >
>>
>> From looking at the source code I can tell that this will happen
>> if the 'pika.adapters.tornado_connection' module does not import properly.
>> If that happens it will simply ignore the error and TornadoConnection
>> will be None.
>>
>>
>> Try this:
>>
>>
>>     from pika.adapters.tornado_connection import TornadoConnection
>>
>>
>> That may give you the error and reason.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/fbbf303d/attachment.htm>

From vashi.priyanki at gmail.com  Fri Aug 16 10:33:44 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Fri, 16 Aug 2013 11:33:44 +0200
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
Message-ID: <CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>

Hi Again,

1) Regarding Overhead point:
You mentioned AMQP is a binary protocol. Could you give some importance of
this type of protocol with overhead ? Do you mean that it will have less
overhead than what I am saying ?

I might have made some mistake since I am new to this world. So please
guide me.

In my wireshark traces, I see following frames for every message I send. I
have publisher confirm and consumer ack enabled with prefetch_count not
set.

content header = 88 bytes ( does not show any direct info so not sure)
basic.publish frame = 85 bytes ( shows details of queue, exchange, routing
key etc)
content body = 137 bytes ( in this my payload is 100 bytes of string + 37
bytes might be checksum etc.)
basic.ack = 87 bytes (shows delivery tag number)

so from this I interpreted as 297 bytes  non-payload + 100 bytes of actual
payload = 397 total bytes for every message on wire.

Is this not normal ?

My publisher and consumer code looks like this.


2) Regarding Interrupts and context switches point:
I agree and understand what you said about context switch but I wanted to
bring this up since I felt my CPU was spending lot of time in doing context
switches and that could be one of the reason that I don't get any higher
throughput even if I increase number of producer and receiver.

This logic might be completely wrong but good to ask experts in this field
about this context switch increase.

3) Regarding changing to faster clients like Java or amqpc:
My current concern is not that I don't have sufficinet throughout, I would
like to understand given the fact later project need to use python based
client and not java based client, would like to understand how system
resources are used by rabbitmq.

Could you please guide me on

1) How to measure load on the disk, when running as high as I can run.

Thank you again !

Best Regards,
Priyanki.


On Thu, Aug 15, 2013 at 12:06 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Priyanki Vashi:
>
> > 1) I have a quite high bandwidth between my client (producer & receiver)
> and server. Its around 9.2 Gbps. I have confirmed this by running iperf
> utility. But the maximum bandwidth I can reach is only 160 mbps. (I have
> pika client and single rabbitmq DISK type)
>
> This means your client cannot publish faster.
>
> > 2) I then also took network traces using wireshark, and what I observed
> that the AMQP overhead was quite high then the actual payload. If I send
> 100 bytes of string then overhead is 300 bytes so for every message of 100
> bytes I end up sending 400 bytes on wire.
>
> That does not sound right. AMQP 0-9-1 is a binary protocol and for every
> published message
> without custom headers, you should get a few dozens of bytes + message
> payload.
>
> The rest is probably TCP and IP overhead. There is no way to use RabbitMQ
> over UDP.
>
> > Since I have publish confirm/ack enabled so I understand part of this
> but there is also content header and some overhead in content body as well.
> > Is this standard for most of the clients or its specific for
> pika-clients only ?
>
> For a basic.publish with payload, you will get 3 frames:
>
> [basic.publish method frame] [content headers] [content payload]
>
> If the message has no content, it becomes
>
> [basic.publish method frame] [content headers]
>
> with every correct client.
>
> > 3) I then also try to observer how my system resources are used. I am
> new to this but after some googling I learnt a linux command 'dstat
> -dmnsy'. This provides me disk usage, RAM usage, interrupts and context
> switches, network send/recev. What I observer that as I increase no of
> producer/receiver, compare to DISK and RAM usage, its interrupts and
> context switches, which increases rapidly.
> >
> > what does this really mean ?
>
> When you publish rapidly, RabbitMQ stores messages (and some metadata
> about them) in RAM and on disk. Context switches means that OS gives
> various processes (your publisher, RabbitMQ, other processes running) time
> to execute. Flat network traffic rate suggests your publisher cannot
> publish any faster.
>
> > 4) Also, after certain point the value under network send/receive field
> remains constant. Not sure what does this mean also ?
>
> See above.
>
> >
> > I am pasting here one of the observed sample from dstat.
> >
> >    mq10 at mqserver10:~$ sudo rabbitmqadmin list queues vhost name node
> messages message_stats.publish_details.rate
> >
> +-------+------+-----------------+----------+------------------------------------+
> > | vhost | name |      node       | messages |
> message_stats.publish_details.rate |
> >
> +-------+------+-----------------+----------+------------------------------------+
> > | /     | 1    | Moon at mqserver10 | 5        | 3380.4
>           |
> > | /     | 2    | Moon at mqserver10 | 3        | 3649.0
>           |
> > | /     | 3    | Moon at mqserver10 | 6        | 3402.4
>           |
> > | /     | 4    | Moon at mqserver10 | 2        | 3450.8
>           |
> > | /     | 5    | Moon at mqserver10 | 3        | 3444.8
>           |
> >
> +-------+------+-----------------+----------+------------------------------------+
> > mq10 at mqserver10:~$ dstat -dmnsy
> > -dsk/total- ------memory-usage----- -net/total- ----swap--- ---system--
> >  read  writ| used  buff  cach  free| recv  send| used  free| int   csw
> >  100k 8974B| 188M 25.7M  115M 9674M|   0     0 |   0     0 |  15k 9759
> >    0    16k| 189M 25.7M  115M 9673M|6363k 4615k|   0     0 |  22k 6590
> >    0     0 | 189M 25.7M  115M 9673M|6666k 4847k|   0     0 |  22k 7846
> >    0     0 | 189M 25.7M  115M 9673M|6293k 4500k|   0     0 |  21k 7518
> >    0     0 | 189M 25.7M  115M 9674M|7049k 5121k|   0     0 |  22k 5936
> >    0     0 | 188M 25.7M  115M 9674M|6947k 5081k|   0     0 |  23k 6309
> >    0     0 | 188M 25.7M  115M 9674M|6387k 4741k|   0     0 |  22k 7020
> >    0     0 | 188M 25.7M  115M 9674M|6482k 4739k|   0     0 |  22k 7094
> >    0     0 | 189M 25.7M  115M 9673M|5642k 3976k|   0     0 |  18k 7586
> >    0     0 | 189M 25.7M  115M 9673M|6246k 4487k|   0     0 |  21k 7497
> >    0     0 | 189M 25.7M  115M 9673M|6631k 4827k|   0     0 |  21k 5924
> >    0     0 | 189M 25.7M  115M 9673M|6615k 4722k|   0     0 |  21k 5448
> >    0     0 | 190M 25.7M  115M 9672M|5677k 4051k|   0     0 |  20k 5757
> >    0     0 | 190M 25.7M  115M 9672M|6007k 4284k|   0     0 |  20k 6581
> >    0     0 | 190M 25.7M  115M 9672M|6983k 5052k|   0     0 |  23k 5704
> >    0     0 | 190M 25.7M  115M 9672M|6318k 4539k|   0     0 |  22k 6208
> >    0     0 | 190M 25.7M  115M 9672M|6769k 4862k|   0     0 |  23k 5952
> >    0     0 | 189M 25.7M  115M 9673M|6334k 4586k|   0     0 |  22k 6518
> >    0     0 | 191M 25.7M  115M 9671M|7019k 5089k|   0     0 |  23k 5937 ^C
>
> This suggests your publisher publishes at a roughly constant rate.
> Which, given spare network capacity (per your own words) suggests
> that the publisher cannot go any faster.
>
> > Also, what is the good profiler to run for rabbitmq server ?
>
> http://www.erlang.org/doc/efficiency_guide/profiling.html
>
> I'd like to point you that it's not RabbitMQ that seem to need profiling
> but your
> client.
>
> Try MulticastMain that ships with the RabbitMQ Java client or amqpc [1]
> to see what kind of thoughput your RabbitMQ node can offer with really fast
> clients.
>
> 1. https://github.com/gocardless/amqpc
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/b637f2ce/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Asyn_Pub_class.py
Type: application/octet-stream
Size: 14631 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/b637f2ce/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Asyn_Pub_1.py
Type: application/octet-stream
Size: 307 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/b637f2ce/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Asyn_Cons_1.py
Type: application/octet-stream
Size: 265 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/b637f2ce/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Asyn_Cons_class.py
Type: application/octet-stream
Size: 13986 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/b637f2ce/attachment-0003.obj>

From emile at rabbitmq.com  Fri Aug 16 11:12:45 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 16 Aug 2013 11:12:45 +0100
Subject: [rabbitmq-discuss] How to receive STOMP receipt only after the
 consumer has acknowledged the message?
In-Reply-To: <1376634397522-28856.post@n5.nabble.com>
References: <1376553781942-28808.post@n5.nabble.com>
	<520CAE19.4030909@rabbitmq.com>
	<1376634397522-28856.post@n5.nabble.com>
Message-ID: <520DFB1D.1000209@rabbitmq.com>

Hi,

On 16/08/13 07:26, joshua__lim wrote:
> By "transaction", would you be referring to STOMP transaction?  I was just
> testing ACK with the transaction header the last couple of hours but did not
> manage to get it to work - ACK is processed without having to issue COMMIT. 

Yes.

> RECEIPT
> receipt-id:001
> --> ACK is processed without COMMIT


This RECEIPT does not mean the the broker acted on the ACK, only that it
has been received and added to all the other actions pending a COMMIT.
You can confirm that the number of unacknowledged messages in the queue
will not decrease until you issue a commit.



-Emile




From ponmuthu at omnesysindia.com  Fri Aug 16 11:31:30 2013
From: ponmuthu at omnesysindia.com (PONMUTHU M)
Date: Fri, 16 Aug 2013 16:01:30 +0530
Subject: [rabbitmq-discuss] Doubt on Feaderation loop
Message-ID: <017901ce9a6b$c7f62aa0$57e27fe0$@omnesysindia.com>

Hi,

 

                I had created 2 federated nodes (different linux box) to
each other (say ex : A & B), there is no issue in that,  am able to
communicate each other.

 

                But the issue is when A & B having consumers with same
routing key then massages are getting routed to each other until max_hops
reaches.

 

I want to send/receive messages in a tree hierarchy.

 

Ex : ( SEND ) A->B , A->C , B->D , C->E , C->F

Ex : ( RECEIVE ) F->C , E->C , D->B ,C->A , B->A

 

                My aim is messages should not be looped in between two
federated exchanges even though they having same routing key.

 

                Kindly give your comments . Thanks in advance !!

                

Regards,

 

PONMUTHU M

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/3eba77c9/attachment.htm>

From handrix at gmail.com  Fri Aug 16 11:36:48 2013
From: handrix at gmail.com (mezgani ali)
Date: Fri, 16 Aug 2013 10:36:48 +0000
Subject: [rabbitmq-discuss] AMQP or HTTP API
In-Reply-To: <15259B62-6952-4F2D-B7B7-8D82E615D6CF@rabbitmq.com>
References: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>
	<15259B62-6952-4F2D-B7B7-8D82E615D6CF@rabbitmq.com>
Message-ID: <CAPuhCB2dPoE9B0nKjp_-anXJXhG=nRhUT6u2H91uh4-G4O5Zuw@mail.gmail.com>

No I talk about how to use rabbitmq to distribute task to nodes.


On Fri, Aug 16, 2013 at 8:13 AM, Tim Watson <watson.timothy at gmail.com>wrote:

> It's not really clear what you're trying I do.
>
> On 15 Aug 2013, at 23:07, mezgani ali <handrix at gmail.com> wrote:
> >
> > The problem I have with HTTP API is that I don't know how to choose node
> that will do the job, how to synchronize them.
>
> Are you talking about the rabbitmq-management plugins's http API?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Ali MEZGANI
*N*etwork *E*ngineering/*S*ecurity
http://www.nativelabs.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/a8ca6653/attachment.htm>

From mklishin at gopivotal.com  Fri Aug 16 12:25:39 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 Aug 2013 15:25:39 +0400
Subject: [rabbitmq-discuss] AMQP or HTTP API
In-Reply-To: <CAPuhCB2dPoE9B0nKjp_-anXJXhG=nRhUT6u2H91uh4-G4O5Zuw@mail.gmail.com>
References: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>
	<15259B62-6952-4F2D-B7B7-8D82E615D6CF@rabbitmq.com>
	<CAPuhCB2dPoE9B0nKjp_-anXJXhG=nRhUT6u2H91uh4-G4O5Zuw@mail.gmail.com>
Message-ID: <37514A6D-0A56-4828-B9AE-0C6170F9FFC6@gopivotal.com>

mezgani ali:

> No I talk about how to use rabbitmq to distribute task to nodes.

You can use one queue per worker node and as many consumers as appropriate.
They can communicate back to the main app using HTTP if that's more convenient.

Publishing can happen over AMQP 0-9-1 or other protocols RabbitMQ supports via
plugins (STOMP, MQTT, HTTP).

See [1] to learn more about common messaging scenarios and how to implement
them using RabbitMQ.

1. http://www.rabbitmq.com/getstarted.html
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/045cfb68/attachment.pgp>

From handrix at gmail.com  Fri Aug 16 13:24:50 2013
From: handrix at gmail.com (mezgani ali)
Date: Fri, 16 Aug 2013 12:24:50 +0000
Subject: [rabbitmq-discuss] AMQP or HTTP API
In-Reply-To: <37514A6D-0A56-4828-B9AE-0C6170F9FFC6@gopivotal.com>
References: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>
	<15259B62-6952-4F2D-B7B7-8D82E615D6CF@rabbitmq.com>
	<CAPuhCB2dPoE9B0nKjp_-anXJXhG=nRhUT6u2H91uh4-G4O5Zuw@mail.gmail.com>
	<37514A6D-0A56-4828-B9AE-0C6170F9FFC6@gopivotal.com>
Message-ID: <CAPuhCB1aw_vW8-OO8TuTLL99seLAJPAMgwZybPNro8gFo8ceBw@mail.gmail.com>

On Fri, Aug 16, 2013 at 12:25 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> mezgani ali:
>
> > No I talk about how to use rabbitmq to distribute task to nodes.
>
> You can use one queue per worker node and as many consumers as appropriate.
> They can communicate back to the main app using HTTP if that's more
> convenient.
>
> I think to use only one queue and the nodes will consume what the main app
produce like this
the job is distributed and the main app will not worry about how to
dispatch tasks to node.


> Publishing can happen over AMQP 0-9-1 or other protocols RabbitMQ supports
> via
> plugins (STOMP, MQTT, HTTP).
>
> See [1] to learn more about common messaging scenarios and how to implement
> them using RabbitMQ.
>
> 1. http://www.rabbitmq.com/getstarted.html
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Ali MEZGANI
*N*etwork *E*ngineering/*S*ecurity
http://www.nativelabs.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/bbdef7b0/attachment.htm>

From mklishin at gopivotal.com  Fri Aug 16 13:34:56 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 Aug 2013 16:34:56 +0400
Subject: [rabbitmq-discuss] AMQP or HTTP API
In-Reply-To: <CAPuhCB1aw_vW8-OO8TuTLL99seLAJPAMgwZybPNro8gFo8ceBw@mail.gmail.com>
References: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>
	<15259B62-6952-4F2D-B7B7-8D82E615D6CF@rabbitmq.com>
	<CAPuhCB2dPoE9B0nKjp_-anXJXhG=nRhUT6u2H91uh4-G4O5Zuw@mail.gmail.com>
	<37514A6D-0A56-4828-B9AE-0C6170F9FFC6@gopivotal.com>
	<CAPuhCB1aw_vW8-OO8TuTLL99seLAJPAMgwZybPNro8gFo8ceBw@mail.gmail.com>
Message-ID: <2B32FC15-462E-46E5-B817-08A4E04F391F@gopivotal.com>

mezgani ali:

> I think to use only one queue and the nodes will consume what the main app produce like this
> the job is distributed and the main app will not worry about how to dispatch tasks to node.

If every node can perform every job, it will work. You can use the "type" header to
indicate job type.

Note that if you plan on growing from a single rabbit node to a cluster, using a single queue
won't be optimal from both throughput scaling and HA points of view. But first things first, of course.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/9ae18208/attachment.pgp>

From simon at rabbitmq.com  Fri Aug 16 13:44:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Aug 2013 13:44:23 +0100
Subject: [rabbitmq-discuss] Doubt on Feaderation loop
In-Reply-To: <017901ce9a6b$c7f62aa0$57e27fe0$@omnesysindia.com>
References: <017901ce9a6b$c7f62aa0$57e27fe0$@omnesysindia.com>
Message-ID: <520E1EA7.5040902@rabbitmq.com>

On 16/08/13 11:31, PONMUTHU M wrote:
>                  But the issue is *when A & B having consumers with same
> routing key* then massages are getting routed to each other until
> max_hops reaches.

I'm afraid that's just how federation works. There's no cycle detection 
as yet.

We have some aspirations to add it, but we're aware that it won't solve 
all message duplication issues anyway (for example a directed graph with 
A->B, A->C, B->D and C->D will duplicate messages even though there's no 
loop).

Having said that, if you want to send messages in one direction through 
the tree you described then you can just make all the links 
unidirectional, there won't then be any loops.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From haster2004 at yandex.ru  Fri Aug 16 13:46:59 2013
From: haster2004 at yandex.ru (Haster)
Date: Fri, 16 Aug 2013 05:46:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
Message-ID: <1376657219195-28872.post@n5.nabble.com>

Hi there.
I have below problem:
I connect to rabbitmq server, and start loop of reading messages from some
queue.
After that I kill this queue on server -> but select function on socket
doesn't return any errors.
And If I create this queue again - I won't receive any messages (I try push
messages to queue from WEB interface)
So how can I process this situation?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Deleting-queues-doesn-t-cut-connection-tp28872.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Aug 16 13:51:49 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 Aug 2013 16:51:49 +0400
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
In-Reply-To: <1376657219195-28872.post@n5.nabble.com>
References: <1376657219195-28872.post@n5.nabble.com>
Message-ID: <FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>

Haster:

> I connect to rabbitmq server, and start loop of reading messages from some
> queue.

Can you post your code? Do you use a loop with basic.get or subscribe
for server-pushed deliveries using basic.consume?

> After that I kill this queue on server -> but select function on socket
> doesn't return any errors.

Removing a queue does not close the connection.

> And If I create this queue again - I won't receive any messages (I try push
> messages to queue from WEB interface)

This may mean a channel exception that your client or app code somehow
swallows. See RabbitMQ log, all channel exceptions will be logged there.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/cdbcc43a/attachment.pgp>

From handrix at gmail.com  Fri Aug 16 13:56:09 2013
From: handrix at gmail.com (mezgani ali)
Date: Fri, 16 Aug 2013 12:56:09 +0000
Subject: [rabbitmq-discuss] AMQP or HTTP API
In-Reply-To: <2B32FC15-462E-46E5-B817-08A4E04F391F@gopivotal.com>
References: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>
	<15259B62-6952-4F2D-B7B7-8D82E615D6CF@rabbitmq.com>
	<CAPuhCB2dPoE9B0nKjp_-anXJXhG=nRhUT6u2H91uh4-G4O5Zuw@mail.gmail.com>
	<37514A6D-0A56-4828-B9AE-0C6170F9FFC6@gopivotal.com>
	<CAPuhCB1aw_vW8-OO8TuTLL99seLAJPAMgwZybPNro8gFo8ceBw@mail.gmail.com>
	<2B32FC15-462E-46E5-B817-08A4E04F391F@gopivotal.com>
Message-ID: <CAPuhCB1UsdXV0Us-xzA2GU8w8ROABfD78n4j-LyeO4i3TrTFwQ@mail.gmail.com>

I have to retrive some data from database and put them into the queue,
let's take ping example
I will put IP addresses in queue and I have 6 nodes.

How I have to put data in 6 queue ? sequentially ? row 1 in queue 1, row 2
in queue 2, ..., row 7 in queue 1 ...
Please can you tell me how I will distribute jobs do you have any example
of code in python, PHP, ruby ??


On Fri, Aug 16, 2013 at 1:34 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> mezgani ali:
>
> > I think to use only one queue and the nodes will consume what the main
> app produce like this
> > the job is distributed and the main app will not worry about how to
> dispatch tasks to node.
>
> If every node can perform every job, it will work. You can use the "type"
> header to
> indicate job type.
>
> Note that if you plan on growing from a single rabbit node to a cluster,
> using a single queue
> won't be optimal from both throughput scaling and HA points of view. But
> first things first, of course.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Ali MEZGANI
*N*etwork *E*ngineering/*S*ecurity
http://www.nativelabs.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/72ceedad/attachment.htm>

From mklishin at gopivotal.com  Fri Aug 16 14:01:01 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 Aug 2013 17:01:01 +0400
Subject: [rabbitmq-discuss] AMQP or HTTP API
In-Reply-To: <CAPuhCB1UsdXV0Us-xzA2GU8w8ROABfD78n4j-LyeO4i3TrTFwQ@mail.gmail.com>
References: <CAPuhCB02jROyMr4Sy-3JdQsCeMJ=6PkbdkNCLvrQkh4a6K60dA@mail.gmail.com>
	<15259B62-6952-4F2D-B7B7-8D82E615D6CF@rabbitmq.com>
	<CAPuhCB2dPoE9B0nKjp_-anXJXhG=nRhUT6u2H91uh4-G4O5Zuw@mail.gmail.com>
	<37514A6D-0A56-4828-B9AE-0C6170F9FFC6@gopivotal.com>
	<CAPuhCB1aw_vW8-OO8TuTLL99seLAJPAMgwZybPNro8gFo8ceBw@mail.gmail.com>
	<2B32FC15-462E-46E5-B817-08A4E04F391F@gopivotal.com>
	<CAPuhCB1UsdXV0Us-xzA2GU8w8ROABfD78n4j-LyeO4i3TrTFwQ@mail.gmail.com>
Message-ID: <F4834174-BB07-482B-BDA5-A9BF821E5831@gopivotal.com>

mezgani ali:

> How I have to put data in 6 queue ? sequentially ? row 1 in queue 1, row 2 in queue 2, ..., row 7 in queue 1 ...
> Please can you tell me how I will distribute jobs do you have any example of code in python, PHP, ruby ??

If you need one message to only be in one queue, you can use default exchange and set
routing key to the name of the queue you want to publish to.

If you want a message to be copied into more than one queue, use a fanout or topic exchange.

There are code examples and tutorials for all of the above at
http://www.rabbitmq.com/getstarted.html, in both Ruby and PHP.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/4dfa277b/attachment.pgp>

From simon at rabbitmq.com  Fri Aug 16 14:01:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Aug 2013 14:01:46 +0100
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
In-Reply-To: <FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
References: <1376657219195-28872.post@n5.nabble.com>
	<FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
Message-ID: <520E22BA.2030704@rabbitmq.com>

On 16/08/13 13:51, Michael Klishin wrote:
>> >After that I kill this queue on server -> but select function on socket
>> >doesn't return any errors.
> Removing a queue does not close the connection.

Quite. This is what http://www.rabbitmq.com/consumer-cancel.html is for. 
Haster, does your client support that?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From haster2004 at yandex.ru  Fri Aug 16 14:09:03 2013
From: haster2004 at yandex.ru (Haster)
Date: Fri, 16 Aug 2013 06:09:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
In-Reply-To: <FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
References: <1376657219195-28872.post@n5.nabble.com>
	<FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
Message-ID: <1376658543622-28877.post@n5.nabble.com>

Vichael, thanks for reply.
I subscribe for server-pushed deliveries using basic.consume method.
Loop of reading is something like below?
  int wait(int fd, int timeout_msec)
  {
    fd_set fds;
    fd_set errfd;
    struct timeval tv;

    FD_ZERO(&fds);
    FD_SET(fd, &fds);

    FD_ZERO(&errfd);
    FD_SET(fd, &errfd);

    tv.tv_sec  = timeout_msec / 1000;
    tv.tv_usec = 1000 * (timeout_msec % 1000); //mksec

    int rc = select(fd + 1, &fds, NULL, &errfd, &tv);

    if(rc == -1)
      return SELECT_ERROR;
    else if(rc == 0)
      return TIMEOUT;
    if(FD_ISSET(fd, &errfd))
      return FDSET_ERROR;
    return READY;
  }

  RabbitMQMessage *RabbitMQQueueImpl::recv(int timeout)
throw(RabbitMQException) {
    amqp_connection_state_t conn = connection.getConnection();
    std::string temp;
    std::auto_ptr<RabbitMQMessageImpl> message(new RabbitMQMessageImpl(conn,
autoAck ? NULL : channel, 0, 0, 0));

    while (true) {
      amqp_maybe_release_buffers(conn);
      
      if (!amqp_data_in_buffer(conn) && !amqp_frames_enqueued(conn)) {
        *switch (wait(connection.getfd(), timeout)) {*
          case READY:
            break;
          case SELECT_ERROR:
          case FDSET_ERROR:
            throw RabbitMQException(-1, "Connection error");
          case TIMEOUT:
            return NULL;
          default:
            throw RabbitMQException(-1, "Unexpected");
        }
      }

      amqp_maybe_release_buffers(conn);

      amqp_frame_t frame;
      int result = amqp_simple_wait_frame(conn, &frame);

      if (result < 0) {
        return NULL;
      }
...



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Deleting-queues-doesn-t-cut-connection-tp28872p28877.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From haster2004 at yandex.ru  Fri Aug 16 14:18:49 2013
From: haster2004 at yandex.ru (Haster)
Date: Fri, 16 Aug 2013 06:18:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
In-Reply-To: <520E22BA.2030704@rabbitmq.com>
References: <1376657219195-28872.post@n5.nabble.com>
	<FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
	<520E22BA.2030704@rabbitmq.com>
Message-ID: <1376659129197-28878.post@n5.nabble.com>

Simon, 
As I understand when queue is deleting from server? rabbitmq send to client
basic.cancel. Is it right? 
(My english isn't enough to clear understand those text)

I use rabbitmq-c library in my project and as I know there is no support of
any callback functions (I use 0.3.0 version)



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Deleting-queues-doesn-t-cut-connection-tp28872p28878.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Aug 16 14:21:03 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 Aug 2013 17:21:03 +0400
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
In-Reply-To: <1376658543622-28877.post@n5.nabble.com>
References: <1376657219195-28872.post@n5.nabble.com>
	<FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
	<1376658543622-28877.post@n5.nabble.com>
Message-ID: <CFE8B3D2-58AC-43B4-A64F-EC75CFDFA53A@gopivotal.com>

Haster:

> I subscribe for server-pushed deliveries using basic.consume method.

In such case, you need to handle consumer cancellation notifications
[1].

> Loop of reading is something like below

Unfortunately, I'm not familiar with librabbitmq-c and the C++ library
built on top of it to tell how to use consumer cancellation notifications
and if they support it at all.

1. http://www.rabbitmq.com/consumer-cancel.html
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/c3279d45/attachment.pgp>

From haster2004 at yandex.ru  Fri Aug 16 14:40:27 2013
From: haster2004 at yandex.ru (Haster)
Date: Fri, 16 Aug 2013 06:40:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
In-Reply-To: <CFE8B3D2-58AC-43B4-A64F-EC75CFDFA53A@gopivotal.com>
References: <1376657219195-28872.post@n5.nabble.com>
	<FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
	<1376658543622-28877.post@n5.nabble.com>
	<CFE8B3D2-58AC-43B4-A64F-EC75CFDFA53A@gopivotal.com>
Message-ID: <1376660427330-28880.post@n5.nabble.com>

Michael and Simon, thanks for answers.

I understand that I have to realize some mechanism to handle basic.cancel
from server



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Deleting-queues-doesn-t-cut-connection-tp28872p28880.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From vashi.priyanki at gmail.com  Fri Aug 16 16:01:33 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Fri, 16 Aug 2013 17:01:33 +0200
Subject: [rabbitmq-discuss] Fwd: Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
	<CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
Message-ID: <CA+0nT8BP3XWDUc4BZ-wDEo+O3NTqY91zK1EpFz7tEuGDn169mA@mail.gmail.com>

Hi Again,

Since I did not receive any reply on my queries mentioned in my latest
reply, I was wondering if it has not sent properly and that's why posting
again.

Please bear with me in case you have received it and hope to get some more
insight on this.

Thank you again !

Best Regards,
Priyanki.

---------- Forwarded message ----------
From: Priyanki Vashi <vashi.priyanki at gmail.com>
Date: Fri, Aug 16, 2013 at 11:33 AM
Subject: Re: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
and Erlang R16B01 - Single Node and Cluster Node
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>


Hi Again,

1) Regarding Overhead point:
You mentioned AMQP is a binary protocol. Could you give some importance of
this type of protocol with overhead ? Do you mean that it will have less
overhead than what I am saying ?

I might have made some mistake since I am new to this world. So please
guide me.

In my wireshark traces, I see following frames for every message I send. I
have publisher confirm and consumer ack enabled with prefetch_count not
set.

content header = 88 bytes ( does not show any direct info so not sure)
basic.publish frame = 85 bytes ( shows details of queue, exchange, routing
key etc)
content body = 137 bytes ( in this my payload is 100 bytes of string + 37
bytes might be checksum etc.)
basic.ack = 87 bytes (shows delivery tag number)

so from this I interpreted as 297 bytes  non-payload + 100 bytes of actual
payload = 397 total bytes for every message on wire.

Is this not normal ?

My publisher and consumer code looks like this.


2) Regarding Interrupts and context switches point:
I agree and understand what you said about context switch but I wanted to
bring this up since I felt my CPU was spending lot of time in doing context
switches and that could be one of the reason that I don't get any higher
throughput even if I increase number of producer and receiver.

This logic might be completely wrong but good to ask experts in this field
about this context switch increase.

3) Regarding changing to faster clients like Java or amqpc:
My current concern is not that I don't have sufficinet throughout, I would
like to understand given the fact later project need to use python based
client and not java based client, would like to understand how system
resources are used by rabbitmq.

Could you please guide me on

1) How to measure load on the disk, when running as high as I can run.

Thank you again !

Best Regards,
Priyanki.


On Thu, Aug 15, 2013 at 12:06 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Priyanki Vashi:
>
> > 1) I have a quite high bandwidth between my client (producer & receiver)
> and server. Its around 9.2 Gbps. I have confirmed this by running iperf
> utility. But the maximum bandwidth I can reach is only 160 mbps. (I have
> pika client and single rabbitmq DISK type)
>
> This means your client cannot publish faster.
>
> > 2) I then also took network traces using wireshark, and what I observed
> that the AMQP overhead was quite high then the actual payload. If I send
> 100 bytes of string then overhead is 300 bytes so for every message of 100
> bytes I end up sending 400 bytes on wire.
>
> That does not sound right. AMQP 0-9-1 is a binary protocol and for every
> published message
> without custom headers, you should get a few dozens of bytes + message
> payload.
>
> The rest is probably TCP and IP overhead. There is no way to use RabbitMQ
> over UDP.
>
> > Since I have publish confirm/ack enabled so I understand part of this
> but there is also content header and some overhead in content body as well.
> > Is this standard for most of the clients or its specific for
> pika-clients only ?
>
> For a basic.publish with payload, you will get 3 frames:
>
> [basic.publish method frame] [content headers] [content payload]
>
> If the message has no content, it becomes
>
> [basic.publish method frame] [content headers]
>
> with every correct client.
>
> > 3) I then also try to observer how my system resources are used. I am
> new to this but after some googling I learnt a linux command 'dstat
> -dmnsy'. This provides me disk usage, RAM usage, interrupts and context
> switches, network send/recev. What I observer that as I increase no of
> producer/receiver, compare to DISK and RAM usage, its interrupts and
> context switches, which increases rapidly.
> >
> > what does this really mean ?
>
> When you publish rapidly, RabbitMQ stores messages (and some metadata
> about them) in RAM and on disk. Context switches means that OS gives
> various processes (your publisher, RabbitMQ, other processes running) time
> to execute. Flat network traffic rate suggests your publisher cannot
> publish any faster.
>
> > 4) Also, after certain point the value under network send/receive field
> remains constant. Not sure what does this mean also ?
>
> See above.
>
> >
> > I am pasting here one of the observed sample from dstat.
> >
> >    mq10 at mqserver10:~$ sudo rabbitmqadmin list queues vhost name node
> messages message_stats.publish_details.rate
> >
> +-------+------+-----------------+----------+------------------------------------+
> > | vhost | name |      node       | messages |
> message_stats.publish_details.rate |
> >
> +-------+------+-----------------+----------+------------------------------------+
> > | /     | 1    | Moon at mqserver10 | 5        | 3380.4
>           |
> > | /     | 2    | Moon at mqserver10 | 3        | 3649.0
>           |
> > | /     | 3    | Moon at mqserver10 | 6        | 3402.4
>           |
> > | /     | 4    | Moon at mqserver10 | 2        | 3450.8
>           |
> > | /     | 5    | Moon at mqserver10 | 3        | 3444.8
>           |
> >
> +-------+------+-----------------+----------+------------------------------------+
> > mq10 at mqserver10:~$ dstat -dmnsy
> > -dsk/total- ------memory-usage----- -net/total- ----swap--- ---system--
> >  read  writ| used  buff  cach  free| recv  send| used  free| int   csw
> >  100k 8974B| 188M 25.7M  115M 9674M|   0     0 |   0     0 |  15k 9759
> >    0    16k| 189M 25.7M  115M 9673M|6363k 4615k|   0     0 |  22k 6590
> >    0     0 | 189M 25.7M  115M 9673M|6666k 4847k|   0     0 |  22k 7846
> >    0     0 | 189M 25.7M  115M 9673M|6293k 4500k|   0     0 |  21k 7518
> >    0     0 | 189M 25.7M  115M 9674M|7049k 5121k|   0     0 |  22k 5936
> >    0     0 | 188M 25.7M  115M 9674M|6947k 5081k|   0     0 |  23k 6309
> >    0     0 | 188M 25.7M  115M 9674M|6387k 4741k|   0     0 |  22k 7020
> >    0     0 | 188M 25.7M  115M 9674M|6482k 4739k|   0     0 |  22k 7094
> >    0     0 | 189M 25.7M  115M 9673M|5642k 3976k|   0     0 |  18k 7586
> >    0     0 | 189M 25.7M  115M 9673M|6246k 4487k|   0     0 |  21k 7497
> >    0     0 | 189M 25.7M  115M 9673M|6631k 4827k|   0     0 |  21k 5924
> >    0     0 | 189M 25.7M  115M 9673M|6615k 4722k|   0     0 |  21k 5448
> >    0     0 | 190M 25.7M  115M 9672M|5677k 4051k|   0     0 |  20k 5757
> >    0     0 | 190M 25.7M  115M 9672M|6007k 4284k|   0     0 |  20k 6581
> >    0     0 | 190M 25.7M  115M 9672M|6983k 5052k|   0     0 |  23k 5704
> >    0     0 | 190M 25.7M  115M 9672M|6318k 4539k|   0     0 |  22k 6208
> >    0     0 | 190M 25.7M  115M 9672M|6769k 4862k|   0     0 |  23k 5952
> >    0     0 | 189M 25.7M  115M 9673M|6334k 4586k|   0     0 |  22k 6518
> >    0     0 | 191M 25.7M  115M 9671M|7019k 5089k|   0     0 |  23k 5937 ^C
>
> This suggests your publisher publishes at a roughly constant rate.
> Which, given spare network capacity (per your own words) suggests
> that the publisher cannot go any faster.
>
> > Also, what is the good profiler to run for rabbitmq server ?
>
> http://www.erlang.org/doc/efficiency_guide/profiling.html
>
> I'd like to point you that it's not RabbitMQ that seem to need profiling
> but your
> client.
>
> Try MulticastMain that ships with the RabbitMQ Java client or amqpc [1]
> to see what kind of thoughput your RabbitMQ node can offer with really fast
> clients.
>
> 1. https://github.com/gocardless/amqpc
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/2afc497c/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Asyn_Pub_class.py
Type: application/octet-stream
Size: 14631 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/2afc497c/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Asyn_Pub_1.py
Type: application/octet-stream
Size: 307 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/2afc497c/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Asyn_Cons_1.py
Type: application/octet-stream
Size: 265 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/2afc497c/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Asyn_Cons_class.py
Type: application/octet-stream
Size: 13986 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/2afc497c/attachment-0003.obj>

From Mark.Geib at echostar.com  Fri Aug 16 16:03:11 2013
From: Mark.Geib at echostar.com (Geib, Mark)
Date: Fri, 16 Aug 2013 15:03:11 +0000
Subject: [rabbitmq-discuss] How to catch RESOURCE_LOCKED exceptions in
 erlang client
In-Reply-To: <mailman.1.1376650801.28548.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1376650801.28548.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <065F453F-5803-4FDD-95D5-F76B8D7A360D@echostar.com>

Maybe more explanation will help.

I am trying to re-broadcast udp datagrams between different networks with a simple erlang application that listens to the specified UDP port, then publishes to a rabbitmq exchange. Then another erlang application is consuming the messages and broadcasting the datagram on whatever network is required, etc. These datagrams are near mission critical and so we are building completely, nearly, redundant paths. That is there will be two applications listening to the datagram source, both will publish to separate brokers, on different network paths. Then there will be two consumer applications each able to consume messages from both of the brokers being published to. What I need to do is prevent both consuming applications from broadcasting the datagram on the target network. We can not handle duplicates.

Here was my idea.

On the consuming client side we configure both clients the same, both brokers are listed in each config. When a client comes up it will try to connect to each broker, if those connections succeed then an attempt is made to create an exclusive queue on each broker, no bindings yet. If a client can create both exclusive queues then it will be the UDP broadcaster. At this point the client will bind one of the two queues to start receiving messages from one of the servers. The other exclusive queue is left unbound, so no messages are routed to it. The other client attempts the same, but will fail to create the exclusive queues. The connections to the two brokers will be maintained, but at some interval will continue to attempt to create the exclusive queues, if it should ever succeed then it will start broadcasting as the first client did. So in order to broadcast one of these applications must create both exclusive queues. What I was depending on was being able to use the exclusive queue as a sort of resource lock, but not do any bindings or consuming until I am sure I have "locked" all the brokers.

The case where one of the brokers is down, or un-reachable is handled by the clients where the connection attempt to that broker will fail, so the client assumes it is not useable, but is able to connect and create the exclusive queue on the other broker. In this case the client will be the broadcaster, since it is able to create the exclusive queue on all "available" brokers. Even if the other client is able to connect to both brokers it will not be able to create the exclusive queues on both, so will not broadcast.

Hope that helps.

Mark Geib
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215


?We, the unwilling, led by the unknowing, are doing the impossible for the ungrateful. We have done so much, for so long, with so little, we are now qualified to do anything with nothing.? 
? Mother Teresa

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 203 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/99efa943/attachment.pgp>

From stuff at moesel.net  Fri Aug 16 16:16:37 2013
From: stuff at moesel.net (Chris)
Date: Fri, 16 Aug 2013 11:16:37 -0400
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
In-Reply-To: <1376660427330-28880.post@n5.nabble.com>
References: <1376657219195-28872.post@n5.nabble.com>
	<FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
	<1376658543622-28877.post@n5.nabble.com>
	<CFE8B3D2-58AC-43B4-A64F-EC75CFDFA53A@gopivotal.com>
	<1376660427330-28880.post@n5.nabble.com>
Message-ID: <CAHEpgBD9KX67cBsMtHPKFNt_ubOLb2HcZGjrB69++m4ygrXmtQ@mail.gmail.com>

Hi Haster,

The rabbitmq-c library *does* support consumer cancel notifications.  I
recommend you check out this thread:

http://rabbitmq.1065348.n5.nabble.com/Consumer-Cancel-Notifications-in-rabbitmq-c-or-SimpleAmqpClient-tp28481p28498.html

-Chris


On Fri, Aug 16, 2013 at 9:40 AM, Haster <haster2004 at yandex.ru> wrote:

> Michael and Simon, thanks for answers.
>
> I understand that I have to realize some mechanism to handle basic.cancel
> from server
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Deleting-queues-doesn-t-cut-connection-tp28872p28880.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/6f6a6818/attachment.htm>

From tim at rabbitmq.com  Fri Aug 16 16:17:10 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 16 Aug 2013 16:17:10 +0100
Subject: [rabbitmq-discuss] How to catch RESOURCE_LOCKED exceptions in
 erlang client
In-Reply-To: <065F453F-5803-4FDD-95D5-F76B8D7A360D@echostar.com>
References: <mailman.1.1376650801.28548.rabbitmq-discuss@lists.rabbitmq.com>
	<065F453F-5803-4FDD-95D5-F76B8D7A360D@echostar.com>
Message-ID: <520E4276.9080702@rabbitmq.com>

Hi Mark,

Ok - without getting buried in the details, it sounds like what you want 
is a simple try...catch in your code to determine whether or not the 
queue.declare succeeds. That's fairly simple to do, since either you'll 
get back a #'queue.declare-ok'{} record or an error will propagate to 
the caller. In the latter case, you can set off a timer to retry when 
you're ready:

init(Config) ->
     {Timeout, Queue, Params} = parse_config(Config),
     {ok, Conn} = amqp_connection:start(Params),
     {ok, Chan} = amqp_connection:open_channel(Conn),
     State = #state{ connection = Conn, channel = Chan, queue = Queue, 
timeout = Timeout, status = idle },
     start_timer(State),
     {ok, State}.

handle_info(connect, State = #state{ status = running }) ->
     {noreply, State};
handle_info(connect, State = #state{ channel = Chan, queue = Queue }) ->
     try
         #'queue.declare_ok'{} = amqp_channel:call(Chan, 
#'queue.declare{ queue = Queue, exclusive = true }),
         {noreply, State#state{ status = running }}
     catch _:_ ->
         start_timer(State),
         {noreply, State}
     end.

start_timer(#state{ timeout = T }) ->
     erlang:send_after(T, self(),


Hopefully that'll get you going.

Cheers,
Tim


On 08/16/2013 04:03 PM, Geib, Mark wrote:
> Maybe more explanation will help.
>
> I am trying to re-broadcast udp datagrams between different networks with a simple erlang application that listens to the specified UDP port, then publishes to a rabbitmq exchange. Then another erlang application is consuming the messages and broadcasting the datagram on whatever network is required, etc. These datagrams are near mission critical and so we are building completely, nearly, redundant paths. That is there will be two applications listening to the datagram source, both will publish to separate brokers, on different network paths. Then there will be two consumer applications each able to consume messages from both of the brokers being published to. What I need to do is prevent both consuming applications from broadcasting the datagram on the target network. We can not handle duplicates.
>
> Here was my idea.
>
> On the consuming client side we configure both clients the same, both brokers are listed in each config. When a client comes up it will try to connect to each broker, if those connections succeed then an attempt is made to create an exclusive queue on each broker, no bindings yet. If a client can create both exclusive queues then it will be the UDP broadcaster. At this point the client will bind one of the two queues to start receiving messages from one of the servers. The other exclusive queue is left unbound, so no messages are routed to it. The other client attempts the same, but will fail to create the exclusive queues. The connections to the two brokers will be maintained, but at some interval will continue to attempt to create the exclusive queues, if it should ever succeed then it will start broadcasting as the first client did. So in order to broadcast one of these applications must create both exclusive queues. What I was depending on was being able to use the exclusive queue as a sort of resource lock, but not do any bindings or consuming until I am sure I have "locked" all the brokers.
>
> The case where one of the brokers is down, or un-reachable is handled by the clients where the connection attempt to that broker will fail, so the client assumes it is not useable, but is able to connect and create the exclusive queue on the other broker. In this case the client will be the broadcaster, since it is able to create the exclusive queue on all "available" brokers. Even if the other client is able to connect to both brokers it will not be able to create the exclusive queues on both, so will not broadcast.
>
> Hope that helps.
>
> Mark Geib
> Principal Engineer
> Cheyenne Software Engineering
> mark.geib at echostar.com / 35-215
>
>
> "We, the unwilling, led by the unknowing, are doing the impossible for the ungrateful. We have done so much, for so long, with so little, we are now qualified to do anything with nothing."
> -- Mother Teresa
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/821d68ea/attachment.htm>

From Mark.Geib at echostar.com  Fri Aug 16 16:31:27 2013
From: Mark.Geib at echostar.com (Geib, Mark)
Date: Fri, 16 Aug 2013 15:31:27 +0000
Subject: [rabbitmq-discuss] How to catch RESOURCE_LOCKED exceptions in
 erlang client
In-Reply-To: <520E4276.9080702@rabbitmq.com>
References: <mailman.1.1376650801.28548.rabbitmq-discuss@lists.rabbitmq.com>
	<065F453F-5803-4FDD-95D5-F76B8D7A360D@echostar.com>
	<520E4276.9080702@rabbitmq.com>
Message-ID: <56AF5FD2-39AE-4D1C-B81D-FC8EBC9BFE10@echostar.com>

That works, of course.

I guess I was expecting that the reply would just be something containing the error, different from the #'queue.declare_ok'{} that I could match on.

Thanks again.

Mark Geib
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215


?We, the unwilling, led by the unknowing, are doing the impossible for the ungrateful. We have done so much, for so long, with so little, we are now qualified to do anything with nothing.? 
? Mother Teresa


On Aug 16, 2013, at 9:17 AM, Tim Watson wrote:

> Hi Mark,
> 
> Ok - without getting buried in the details, it sounds like what you want is a simple try...catch in your code to determine whether or not the queue.declare succeeds. That's fairly simple to do, since either you'll get back a #'queue.declare-ok'{} record or an error will propagate to the caller. In the latter case, you can set off a timer to retry when you're ready:
> 
> init(Config) ->
>     {Timeout, Queue, Params} = parse_config(Config),
>     {ok, Conn} = amqp_connection:start(Params),
>     {ok, Chan} = amqp_connection:open_channel(Conn),
>     State = #state{ connection = Conn, channel = Chan, queue = Queue, timeout = Timeout, status = idle },
>     start_timer(State),
>     {ok, State}.
> 
> handle_info(connect, State = #state{ status = running }) ->
>     {noreply, State};
> handle_info(connect, State = #state{ channel = Chan, queue = Queue }) ->
>     try
>         #'queue.declare_ok'{} = amqp_channel:call(Chan, #'queue.declare{ queue = Queue, exclusive = true }),
>         {noreply, State#state{ status = running }}
>     catch _:_ ->
>         start_timer(State),
>         {noreply, State}
>     end.
> 
> start_timer(#state{ timeout = T }) ->
>     erlang:send_after(T, self(), 
> 
> 
> Hopefully that'll get you going.
> 
> Cheers,
> Tim
> 
> 
> On 08/16/2013 04:03 PM, Geib, Mark wrote:
>> Maybe more explanation will help.
>> 
>> I am trying to re-broadcast udp datagrams between different networks with a simple erlang application that listens to the specified UDP port, then publishes to a rabbitmq exchange. Then another erlang application is consuming the messages and broadcasting the datagram on whatever network is required, etc. These datagrams are near mission critical and so we are building completely, nearly, redundant paths. That is there will be two applications listening to the datagram source, both will publish to separate brokers, on different network paths. Then there will be two consumer applications each able to consume messages from both of the brokers being published to. What I need to do is prevent both consuming applications from broadcasting the datagram on the target network. We can not handle duplicates.
>> 
>> Here was my idea.
>> 
>> On the consuming client side we configure both clients the same, both brokers are listed in each config. When a client comes up it will try to connect to each broker, if those connections succeed then an attempt is made to create an exclusive queue on each broker, no bindings yet. If a client can create both exclusive queues then it will be the UDP broadcaster. At this point the client will bind one of the two queues to start receiving messages from one of the servers. The other exclusive queue is left unbound, so no messages are routed to it. The other client attempts the same, but will fail to create the exclusive queues. The connections to the two brokers will be maintained, but at some interval will continue to attempt to create the exclusive queues, if it should ever succeed then it will start broadcasting as the first client did. So in order to broadcast one of these applications must create both exclusive queues. What I was depending on was being able to use the exclus
>>  ive queue
>>  as a sort of resource lock, but not do any bindings or consuming until I am sure I have "locked" all the brokers.
>> 
>> The case where one of the brokers is down, or un-reachable is handled by the clients where the connection attempt to that broker will fail, so the client assumes it is not useable, but is able to connect and create the exclusive queue on the other broker. In this case the client will be the broadcaster, since it is able to create the exclusive queue on all "available" brokers. Even if the other client is able to connect to both brokers it will not be able to create the exclusive queues on both, so will not broadcast.
>> 
>> Hope that helps.
>> 
>> Mark Geib
>> Principal Engineer
>> Cheyenne Software Engineering
>> 
>> mark.geib at echostar.com
>>  / 35-215
>> 
>> 
>> ?We, the unwilling, led by the unknowing, are doing the impossible for the ungrateful. We have done so much, for so long, with so little, we are now qualified to do anything with nothing.? 
>> ? Mother Teresa
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> 
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 203 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/6a68cc56/attachment.pgp>

From tim at rabbitmq.com  Fri Aug 16 16:35:37 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 16 Aug 2013 16:35:37 +0100
Subject: [rabbitmq-discuss] How to catch RESOURCE_LOCKED exceptions in
 erlang client
In-Reply-To: <56AF5FD2-39AE-4D1C-B81D-FC8EBC9BFE10@echostar.com>
References: <mailman.1.1376650801.28548.rabbitmq-discuss@lists.rabbitmq.com>
	<065F453F-5803-4FDD-95D5-F76B8D7A360D@echostar.com>
	<520E4276.9080702@rabbitmq.com>
	<56AF5FD2-39AE-4D1C-B81D-FC8EBC9BFE10@echostar.com>
Message-ID: <520E46C9.7010802@rabbitmq.com>

On 08/16/2013 04:31 PM, Geib, Mark wrote:
> That works, of course.
>
> I guess I was expecting that the reply would just be something containing the error, different from the #'queue.declare_ok'{} that I could match on.
>
>

No, the channel will be closed when the declare fails. I forgot to 
mention (in my code example) that you'll need to create a new channel at 
that point (if it fails).

Cheers,
Tim

From mklishin at gopivotal.com  Fri Aug 16 16:45:46 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 Aug 2013 19:45:46 +0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
	and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
	<CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
Message-ID: <032B5CE5-5D1E-402A-A4DF-90D0AF66883B@gopivotal.com>

Priyanki Vashi:

> content header = 88 bytes ( does not show any direct info so not sure)
> basic.publish frame = 85 bytes ( shows details of queue, exchange, routing key etc) 
> content body = 137 bytes ( in this my payload is 100 bytes of string + 37 bytes might be checksum etc.)
> basic.ack = 87 bytes (shows delivery tag number) 
> 
> so from this I interpreted as 297 bytes  non-payload + 100 bytes of actual payload = 397 total bytes for every message on wire. 
> 
> Is this not normal ? 

I'd need to sit down and calculate how many bytes would a bare content header be packed into
but it's about right, except that

 * content header and body will vary depending on what you publish, what values the properties have, etc
 * basic.ack is optional, that is, you can publish without acks (which trades safety for improved throughput)

I'm slightly surprised that basic.publish frame is almost 90 bytes but it may be the case if e.g.
exchange name is unusually long.

> My publisher and consumer code looks like this. 

I assume it wasn't pasted by accident?

> 2) Regarding Interrupts and context switches point:
> I agree and understand what you said about context switch but I wanted to bring this up since I felt my CPU was spending lot of time in doing context switches and that could be one of the reason that I don't get any higher throughput even if I increase number of producer and receiver. 

How many cores (logical) does your CPU have? Do you only run a publisher and RabbitMQ on this machine?

> 3) Regarding changing to faster clients like Java or amqpc:
> My current concern is not that I don't have sufficinet throughout, I would like to understand given the fact later project need to use python based client and not java based client, would like to understand how system resources are used by rabbitmq. 

Seeing what kind of throughput you get with MulticastMain and/or amqpc will show you
how fast your hardware, network and RabbitMQ node can go. This can prove if you
are limited by your publisher's performance.

Then you can profile your publisher to see what takes time. I wasn't suggesting that you
should just use Java for your project, only to see if you can get a noticeably better
throughput with a different client.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/f1d5315a/attachment.pgp>

From vashi.priyanki at gmail.com  Fri Aug 16 17:04:06 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Fri, 16 Aug 2013 18:04:06 +0200
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <032B5CE5-5D1E-402A-A4DF-90D0AF66883B@gopivotal.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
	<CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
	<032B5CE5-5D1E-402A-A4DF-90D0AF66883B@gopivotal.com>
Message-ID: <CA+0nT8B+Wq=YSsY=-VevJYtDuwPFTH7LQwXFE4hnds6rxxwFdg@mail.gmail.com>

Hi Again ,

Thank you for your reply.

1) Sorry about not pasting code. But I realized that code is too long to
directly paste so I attached files then but looks like they are not
received so I am attaching again.

2) My exchange  as well as queue names are not really long. Neither my
routing key. For simplicity I just created exchange, queue and routing key
as string '1' , '2' like that so that later if required it's easy to
automate. For now I just run manually.

3) Regarding using faster client, I understand your point now and would
definitely give a try and see how it goes. I am thinking to give a try for
amqpc since it looks easy to give a try.

4) If you can quickly have a look at my current publisher/consumer and give
some higher level comments then it would help me to get direction.
In order to have easy start, I just adapted the examples of producer and
consumer given on pika site and I have not really brought in any major
changes since I wanted to get everything working and then slowly make
improvements if really required to this code.

Best Regards,
Priyanki.


On Fri, Aug 16, 2013 at 5:45 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Priyanki Vashi:
>
> > content header = 88 bytes ( does not show any direct info so not sure)
> > basic.publish frame = 85 bytes ( shows details of queue, exchange,
> routing key etc)
> > content body = 137 bytes ( in this my payload is 100 bytes of string +
> 37 bytes might be checksum etc.)
> > basic.ack = 87 bytes (shows delivery tag number)
> >
> > so from this I interpreted as 297 bytes  non-payload + 100 bytes of
> actual payload = 397 total bytes for every message on wire.
> >
> > Is this not normal ?
>
> I'd need to sit down and calculate how many bytes would a bare content
> header be packed into
> but it's about right, except that
>
>  * content header and body will vary depending on what you publish, what
> values the properties have, etc
>  * basic.ack is optional, that is, you can publish without acks (which
> trades safety for improved throughput)
>
> I'm slightly surprised that basic.publish frame is almost 90 bytes but it
> may be the case if e.g.
> exchange name is unusually long.
>
> > My publisher and consumer code looks like this.
>
> I assume it wasn't pasted by accident?
>
> > 2) Regarding Interrupts and context switches point:
> > I agree and understand what you said about context switch but I wanted
> to bring this up since I felt my CPU was spending lot of time in doing
> context switches and that could be one of the reason that I don't get any
> higher throughput even if I increase number of producer and receiver.
>
> How many cores (logical) does your CPU have? Do you only run a publisher
> and RabbitMQ on this machine?
>
> > 3) Regarding changing to faster clients like Java or amqpc:
> > My current concern is not that I don't have sufficinet throughout, I
> would like to understand given the fact later project need to use python
> based client and not java based client, would like to understand how system
> resources are used by rabbitmq.
>
> Seeing what kind of throughput you get with MulticastMain and/or amqpc
> will show you
> how fast your hardware, network and RabbitMQ node can go. This can prove
> if you
> are limited by your publisher's performance.
>
> Then you can profile your publisher to see what takes time. I wasn't
> suggesting that you
> should just use Java for your project, only to see if you can get a
> noticeably better
> throughput with a different client.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/b043f76d/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Pika_Pub_Cons.zip
Type: application/zip
Size: 8533 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/b043f76d/attachment.zip>

From simon at rabbitmq.com  Fri Aug 16 17:10:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Aug 2013 17:10:15 +0100
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
	<CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
Message-ID: <520E4EE7.4090401@rabbitmq.com>

I'm not completely sure where this discussion is going :-) but I'll 
pitch in anyway...

On 16/08/13 10:33, Priyanki Vashi wrote:
> In my wireshark traces, I see following frames for every message I send.
> I have publisher confirm and consumer ack enabled with prefetch_count
> not set.

Of course publisher confirm is optional. Also if the broker is busy 
enough it can start to issue acks with multiple=true. So you don't have 
to pay the cost of an ack for every message published.

> content header = 88 bytes ( does not show any direct info so not sure)
> basic.publish frame = 85 bytes ( shows details of queue, exchange,
> routing key etc)
> content body = 137 bytes ( in this my payload is 100 bytes of string +
> 37 bytes might be checksum etc.)

I don't see this much. Publishing with:

$ runjava.sh com.rabbitmq.examples.MulticastMain -C 1 -y0 -s 100

(i.e. publish 1 message of 100 bytes, don't consume anything, then stop)

I get a 255 byte (Ethernet) frame sent for the publish:

14 bytes Ethernet II header
20 bytes IPv4 header
32 bytes TCP header
59 bytes AMQP basic.publish method (variable size, including exchange 
name and routing key)
22 bytes content header (i.e. minimal basic.properties)
108 bytes content (100 bytes payload)

So I suspect there's something different with your client and / or test 
app. Note that things like whether you set anything in basic.properties 
can make quite a difference here, the AMQP encoding is designed to be 
shorter in the common case.

For most people the framing costs per message are not excessive. I don't 
think there is any particular waste there. If the costs are excessive 
for you, then MQTT would offer lower (but still present) per-message 
framing costs.

But you can't expect to send tiny messages and fill your network 
bandwidth anyway. Each message's framing has a fixed cost to decode, and 
then each message has a fixed cost for routing logic as well. (Even with 
fanout exchanges we still have to look up bindings after all.)

tl;dr: you'll notice much higher bandwidth utilisation if you start 
sending longer messages.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From vashi.priyanki at gmail.com  Fri Aug 16 18:44:29 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Fri, 16 Aug 2013 19:44:29 +0200
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
 and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <520E4EE7.4090401@rabbitmq.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
	<CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
	<520E4EE7.4090401@rabbitmq.com>
Message-ID: <CA+0nT8Bc34ffx5s1D8gDsuzF1R1vjKMBNuG_ADjOwEkY5G5t0A@mail.gmail.com>

Hi ,

Simon - Thanks for comparitive values and some more insight into my
questions. The discussion is going in a direction to understand

1) how good or bad my pika clients efficiciency is and then how exactly my
system resources are used by both client and rabbit server.

So far I can only see that if I send 100 byes of payload, maximum
throughput I get is around 30,000 msg/sec and maximum bandwidth usage is
160-170 mbps. Trying to understand what is happening in system with RAM,
memory etc. etc....

As you mentioned I see comapritively better bandwidth usage with 500 bytes
and 1000 bytes and they are in range of 350 Mbps and 580 Mpbs. Which I
don't know is appropriate or not.

Do you know if one can saturate 8Gbps link with Rabbit ?
I mean does the other fastest client could really show bandwidth usage like
2, 3 or 5 Gbps, given there are 20 cores of CPU and 10GB of RAM exclusively
given to rabbit or even higher RAM.

My goal is to understand and hopefully to pin point what could be the
bottleneck in the environment I am currently running.



For the earlier question of Micheal on number of cores, here is some more
info.

I have 10 physical cores and they are hyperthreaded so that's how I have 20
cores. I have such two machines. So then,

Machine-1 with 20 cores running exclusively my Producer & Receiver based on
pika
Machine-2, again with 20 cores running exclusively RABBITMQ server

I us KVM hypervisor and create virtual machine and through this control
both cores, RAM and DISK resources for both client and rabbit server.

I had noticed one more thing, may be worth mentioning. When I run

dstat --top-latency ( which I understand will show me a process with
highest latency) it most of the time display 'rcu_sched' process. After
some googling, I learnt that it's Read,Copy update scheduling available
with linux kernel > 2.6.x (I guess). This is a kind of improvement, which
allow to read memory while it's being updated. I don't know much of it.

Thank you again !

Best Regards,
Priyanki.



On Fri, Aug 16, 2013 at 6:10 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> I'm not completely sure where this discussion is going :-) but I'll pitch
> in anyway...
>
>
> On 16/08/13 10:33, Priyanki Vashi wrote:
>
>> In my wireshark traces, I see following frames for every message I send.
>> I have publisher confirm and consumer ack enabled with prefetch_count
>> not set.
>>
>
> Of course publisher confirm is optional. Also if the broker is busy enough
> it can start to issue acks with multiple=true. So you don't have to pay the
> cost of an ack for every message published.
>
>
>  content header = 88 bytes ( does not show any direct info so not sure)
>> basic.publish frame = 85 bytes ( shows details of queue, exchange,
>> routing key etc)
>> content body = 137 bytes ( in this my payload is 100 bytes of string +
>> 37 bytes might be checksum etc.)
>>
>
> I don't see this much. Publishing with:
>
> $ runjava.sh com.rabbitmq.examples.**MulticastMain -C 1 -y0 -s 100
>
> (i.e. publish 1 message of 100 bytes, don't consume anything, then stop)
>
> I get a 255 byte (Ethernet) frame sent for the publish:
>
> 14 bytes Ethernet II header
> 20 bytes IPv4 header
> 32 bytes TCP header
> 59 bytes AMQP basic.publish method (variable size, including exchange name
> and routing key)
> 22 bytes content header (i.e. minimal basic.properties)
> 108 bytes content (100 bytes payload)
>
> So I suspect there's something different with your client and / or test
> app. Note that things like whether you set anything in basic.properties can
> make quite a difference here, the AMQP encoding is designed to be shorter
> in the common case.
>
> For most people the framing costs per message are not excessive. I don't
> think there is any particular waste there. If the costs are excessive for
> you, then MQTT would offer lower (but still present) per-message framing
> costs.
>
> But you can't expect to send tiny messages and fill your network bandwidth
> anyway. Each message's framing has a fixed cost to decode, and then each
> message has a fixed cost for routing logic as well. (Even with fanout
> exchanges we still have to look up bindings after all.)
>
> tl;dr: you'll notice much higher bandwidth utilisation if you start
> sending longer messages.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/a9dc2117/attachment.htm>

From stuff at moesel.net  Fri Aug 16 19:49:11 2013
From: stuff at moesel.net (Chris)
Date: Fri, 16 Aug 2013 14:49:11 -0400
Subject: [rabbitmq-discuss] Hung Server Upgrading from 3.1.1 to 3.1.5 in
	a cluster
In-Reply-To: <CAHEpgBCvORiBktuDpHSEnx2SLmo-a-GLhSvbebsmDJjiMZoeHA@mail.gmail.com>
References: <CAHEpgBCvORiBktuDpHSEnx2SLmo-a-GLhSvbebsmDJjiMZoeHA@mail.gmail.com>
Message-ID: <CAHEpgBDgjtgtV7vL-9qQVSk5M2v9t-48o2e+Xftrc7oJ8FB_uA@mail.gmail.com>

FYI: I have not been able to reproduce this problem since it happened.
 Perhaps my servers were somehow in a bad state to begin with.  So... I
guess you can consider this as low-priority, for your informational
purposes only. ;-)

-Chris


On Thu, Aug 15, 2013 at 4:09 PM, Chris <stuff at moesel.net> wrote:

> Hello,
>
> I had a running cluster of two RabbitMQ 3.1.1 servers on Redhat 6.2.  I
> left both running and then attempted to upgrade one (via yum).  After the
> upgrade, rabbitmqctl reported the cluster_status was good, but none of my
> consumers seemed to be working.
>
> I then attempted to upgrade the other, hoping that would fix things, but
> the upgrade just hung.  After killing the upgrade (ctl-c) I noted that I
> couldn't stop rabbitmq-server anymore (not via service script or
> rabbitmqctl).  I had to kill it manually.  After killing it, I re-ran the
> upgrade and all was well.
>
> Looking in the logs, I then saw a BUNCH of errors with timestamps
> corresponding to when I upgraded the first server.  It seems that didn't go
> cleanly on the remaining 3.1.1 node and might be responsible for all the
> trouble.  Did I just get unlucky?
>
> Here's the SASL log:
>
> =CRASH REPORT==== 15-Aug-2013::14:27:49 ===
>   crasher:
>     initial call: gen:init_it/6
>     pid: <0.271.0>
>     registered_name: []
>     exception exit: {{badmatch,{error,not_found}},
>                      [{rabbit_mirror_queue_master,stop_all_slaves,2,
>                           [{file,"src/rabbit_mirror_queue_master.erl"},
>                            {line,179}]},
>                       {rabbit_mirror_queue_master,delete_and_terminate,2,
>                           [{file,"src/rabbit_mirror_queue_master.erl"},
>                            {line,175}]},
>                       {rabbit_amqqueue_process,'-terminate/2-fun-3-',5,
>                           [{file,"src/rabbit_amqqueue_process.erl"},
>                            {line,162}]},
>                       {rabbit_amqqueue_process,terminate_shutdown,2,
>                           [{file,"src/rabbit_amqqueue_process.erl"},
>                            {line,272}]},
>                       {gen_server2,terminate,3,
>                           [{file,"src/gen_server2.erl"},{line,1031}]},
>                       {proc_lib,wake_up,3,
>                           [{file,"proc_lib.erl"},{line,249}]}]}
>       in function  gen_server2:terminate/3 (src/gen_server2.erl, line 1034)
>     ancestors: [rabbit_mirror_queue_slave_sup,rabbit_sup,<0.148.0>]
>     messages: []
>     links: [<0.270.0>]
>     dictionary: [{guid,{{3434499189,622214121,884364685,3594937084},1}}]
>     trap_exit: true
>     status: running
>     heap_size: 1598
>     stack_size: 27
>     reductions: 9106
>   neighbours:
>
> =SUPERVISOR REPORT==== 15-Aug-2013::14:27:49 ===
>      Supervisor: {local,
>                                            rabbit_mirror_queue_slave_sup}
>      Context:    child_terminated
>      Reason:     {{badmatch,{error,not_found}},
>                   [{rabbit_mirror_queue_master,stop_all_slaves,2,
>                        [{file,"src/rabbit_mirror_queue_master.erl"},
>                         {line,179}]},
>                    {rabbit_mirror_queue_master,delete_and_terminate,2,
>                        [{file,"src/rabbit_mirror_queue_master.erl"},
>                         {line,175}]},
>                    {rabbit_amqqueue_process,'-terminate/2-fun-3-',5,
>
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,162}]},
>                    {rabbit_amqqueue_process,terminate_shutdown,2,
>
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,272}]},
>                    {gen_server2,terminate,3,
>                        [{file,"src/gen_server2.erl"},{line,1031}]},
>
>  {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>      Offender:   [{pid,<0.271.0>},
>                   {name,rabbit_mirror_queue_slave},
>                   {mfa,
>                       {rabbit_mirror_queue_slave,start_link,
>                           [{amqqueue,
>                                {resource,<<"acs">>,queue,
>
>  <<"replies.4a0e284c-1662-463a-b363-cbb4e9557266">>},
>                                true,false,none,
>                                [{<<"x-expires">>,signedint,600000}],
>                                <7111.3423.0>,[],[],
>                                [{vhost,<<"acs">>},
>                                 {name,<<"ha-acs">>},
>                                 {pattern,<<".*">>},
>                                 {definition,
>                                     [{<<"ha-mode">>,<<"exactly">>},
>                                      {<<"ha-params">>,2}]},
>                                 {priority,0}],
>                                [{<7111.3424.0>,<7111.3423.0>},
>                                 {<7111.8011.82>,<7111.8010.82>},
>                                 {<0.27964.278>,<0.27962.278>}]}]}},
>                   {restart_type,temporary},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>
> Thanks!
> Chris
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/05a1da97/attachment.htm>

From mklishin at gopivotal.com  Fri Aug 16 19:50:12 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 Aug 2013 22:50:12 +0400
Subject: [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3
	and Erlang R16B01 - Single Node and Cluster Node
In-Reply-To: <CA+0nT8Bc34ffx5s1D8gDsuzF1R1vjKMBNuG_ADjOwEkY5G5t0A@mail.gmail.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
	<B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>
	<7e282600-6354-43b9-8ca8-4bf7a3f1e4ab@googlegroups.com>
	<DED09A85-EEA6-4B5D-A286-18D8A294DCA3@gopivotal.com>
	<CA+0nT8CDwxBik+4Vkx8_QDfMDt7K4mk_CaGT+YURJsjbHpLKLw@mail.gmail.com>
	<08A73F14-54B9-471A-A195-430D8DCC12AB@gopivotal.com>
	<CA+0nT8BcK+6uBKY0V_dGMPXUaE4V7gXRs_RLU7fyi=A+7stUtA@mail.gmail.com>
	<520E4EE7.4090401@rabbitmq.com>
	<CA+0nT8Bc34ffx5s1D8gDsuzF1R1vjKMBNuG_ADjOwEkY5G5t0A@mail.gmail.com>
Message-ID: <3B830530-4ED1-46EA-9462-B2DDD8930FA2@gopivotal.com>

Priyanki Vashi:

> 1) how good or bad my pika clients efficiciency is and then how exactly my system resources are used by both client and rabbit server.

The goal really is still to see some evidence about producer being not fast enough. If you get much better results with faster publishers, esp.
if they can use multiple cores (MulticastMain can, I expect the same to be true of amqpc), that
would prove the hypothesis we have.

> So far I can only see that if I send 100 byes of payload, maximum throughput I get is around 30,000 msg/sec and maximum bandwidth usage is 160-170 mbps. Trying to understand what is happening in system with RAM, memory etc. etc.... 
> 
> As you mentioned I see comapritively better bandwidth usage with 500 bytes and 1000 bytes and they are in range of 350 Mbps and 580 Mpbs. Which I don't know is appropriate or not.
> 
> Do you know if one can saturate 8Gbps link with Rabbit ? 

Start publishing messages of 1-8 MB in size. You will see throughput drop but overall link saturation
should be higher.

> For the earlier question of Micheal on number of cores, here is some more info. 
> 
> I have 10 physical cores and they are hyperthreaded so that's how I have 20 cores. I have such two machines. So then,
> 
> Machine-1 with 20 cores running exclusively my Producer & Receiver based on pika
> Machine-2, again with 20 cores running exclusively RABBITMQ server

On this kind of machines, you should run 5-20 instances of both producer and consumer and context
switching won't be a problem.

You can always check core saturation and load average (a.k.a. how many processes expect the OS to give it a slice of CPU time) in htop. Increase numbers of producer and consumer until all 10 cores are
busy most of the time.

On the RabbitMQ side, running Erlang R16B01 and using multiple queues
(e.g. at least 1 per consumer) should help saturate more cores given that the runtime actually
needs them.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/1a0082a3/attachment.pgp>

From azimi.majid at yahoo.com  Sat Aug 17 05:18:17 2013
From: azimi.majid at yahoo.com (Majid Azimi)
Date: Fri, 16 Aug 2013 21:18:17 -0700 (PDT)
Subject: [rabbitmq-discuss] basicAck does not remove message from broker
Message-ID: <1376713097.50350.YahooMailNeo@web140106.mail.bf1.yahoo.com>

HI guys,

Can anyone help me with this question:
http://stackoverflow.com/questions/18247632/basicack-does-not-remove-message-from-broker-rabbitmq


thank you very much


From followb.chen at gmail.com  Sat Aug 17 08:12:14 2013
From: followb.chen at gmail.com (=?GB2312?B?s8K93A==?=)
Date: Sat, 17 Aug 2013 15:12:14 +0800
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
Message-ID: <CAB8Hozr9RKfEjUOkVNPQ=N2PLtY-Jj9Xnr=MZMkN4Up_znrh7g@mail.gmail.com>

HI,

      when i start rabbitmq-server, show errors follows

BOOT FAILED
===========

Error description:
   {{shutdown,
        {failed_to_start_child,rabbit_memory_monitor,
            {noproc,
                {gen_server,call,
                    [vm_memory_monitor,get_memory_limit,infinity]}}}},
    {child,undefined,rabbit_memory_monitor_sup,
        {rabbit_restartable_sup,start_link,

[rabbit_memory_monitor_sup,{rabbit_memory_monitor,start_link,[]}]},
        transient,infinity,supervisor,
        [rabbit_restartable_sup]}}

Log files (may contain more information):
   /home/map/rabbitmq/log/map.log
   /home/map/rabbitmq/log/map-sasl.log



BOOT FAILED
===========

Error description:
   {could_not_start,rabbit,
       {bad_return,
           {{rabbit,start,[normal,[]]},
            {'EXIT',
                {rabbit,failure_during_boot,
                    {{shutdown,
                         {failed_to_start_child,rabbit_memory_monitor,
                             {noproc,
                                 {gen_server,call,
                                     [vm_memory_monitor,get_memory_limit,
                                      infinity]}}}},
                     {child,undefined,rabbit_memory_monitor_sup,
                         {rabbit_restartable_sup,start_link,
                             [rabbit_memory_monitor_sup,
                              {rabbit_memory_monitor,start_link,[]}]},
                         transient,infinity,supervisor,
                         [rabbit_restartable_sup]}}}}}}}

{"init terminating in
do_boot",{rabbit,failure_during_boot,{could_not_start,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot,{{shutdown,{failed_to_start_child,rabbit_memory_monitor,{noproc,{gen_server,call,[vm_memory_monitor,get_memory_limit,infinity]}}}},{child,undefined,rabbit_memory_monitor_sup,{rabbit_restartable_sup,start_link,[rabbit_memory_monitor_sup,{rabbit_memory_monitor,start_link,[]}]},transient,infinity,supervisor,[rabbit_restartable_sup]}}}}}}}}}

yours,
Jeremy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130817/05d786ef/attachment.htm>

From max at maxmanders.co.uk  Sun Aug 18 13:34:44 2013
From: max at maxmanders.co.uk (Max Manders)
Date: Sun, 18 Aug 2013 05:34:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering Behaviour
Message-ID: <932f8257-1984-4ac2-b0b9-4634371f27e6@googlegroups.com>

Hi,

I don't have much experience using RabbitMQ, certainly not programmatically 
as a producer or consumer.  However, I've been asked to set up an HA 
RabbitMQ environment.  I'm using EC2 (implementation detail, assume I know 
what I'm doing with that respect).

I have a cluster configured according to `rabbitmqctl cluster_status`. 
 However, what I don't understand, as someone who hasn't interacted much 
with AMQP is around how things are distributed and how clients connect.

If I configure the cluster to use mirrored queues, I'm also working on the 
assumption that nodes may be transient and might get terminated and created 
via scaling events.  If a node dies, I can see via `rabbitmqctl 
cluster_status` that the node is still part of the cluster, but not a 
'running node'.  What are the implications of this?  If a client requests a 
message from a queue via an exchange, will the cluster service the request 
from an available node, knowing not to use the dead node?  Do I need to 
worry about cluster nodes versus running node; will the cluster remove a 
node that hasn't been running for some time, or should I programmatically 
clean up dead nodes?

Also, how do clients connect to a cluster?  Do I put a load balancer in 
front of a cluster and have an application connect to the load balancer? 
 Or should an application connect to a particular cluster node, or any 
cluster node?  Apologies for the questions, but I'm not developing the app, 
just providing the infrastructure / middleware; not a fan of doing so 
without having a better understanding.

Any help, gratefully received!

Cheers,
Max
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130818/e0d130ce/attachment.htm>

From mahi.rabbitmq at gmail.com  Sun Aug 18 17:43:06 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Sun, 18 Aug 2013 09:43:06 -0700
Subject: [rabbitmq-discuss] AMQP port 5672
Message-ID: <CAGOpLV49x=ZCscxG5eZZmazLkQ3=vYv0pR9K4E6HWCEX3vyu_g@mail.gmail.com>

Hi

How can I change amqp port number ( 5672) in rabbitmq server.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130818/1e4df646/attachment.htm>

From videlalvaro at gmail.com  Sun Aug 18 18:03:56 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 18 Aug 2013 19:03:56 +0200
Subject: [rabbitmq-discuss] AMQP port 5672
In-Reply-To: <CAGOpLV49x=ZCscxG5eZZmazLkQ3=vYv0pR9K4E6HWCEX3vyu_g@mail.gmail.com>
References: <CAGOpLV49x=ZCscxG5eZZmazLkQ3=vYv0pR9K4E6HWCEX3vyu_g@mail.gmail.com>
Message-ID: <CAMcAHLWt6aQ_wMUHJv0BnmKm2=yBQPKVM3Gt5=zzq7YchWyhFQ@mail.gmail.com>

Take a look at the Environment variables here:
http://www.rabbitmq.com/configure.html specifically RABBITMQ_NODE_PORT

-Alvaro


On Sun, Aug 18, 2013 at 6:43 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:

> Hi
>
> How can I change amqp port number ( 5672) in rabbitmq server.
>
> Thanks
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130818/e17010a7/attachment.htm>

From michael.s.klishin at gmail.com  Sun Aug 18 18:21:12 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 18 Aug 2013 21:21:12 +0400
Subject: [rabbitmq-discuss] ANN Langohr documentation updates
Message-ID: <CAE3HoVRjtP-muueEe845h4PcARGTdW4hvDA_55XqrrABvvj5iw@mail.gmail.com>

I'm happy to announce that Langohr [1] documentation is being actively
worked on again. There's already one full new guide available [2],
that covers RabbitMQ extensions and how to use them from Clojure.

At least two more guides (TLS/SSL support and Durability) are in the works
and will be published in a few days.

If you use or in the process of evaluating Langohr, take a look at [2]. It
covers
quite a few nice features RabbitMQ provides.

1. http://clojurerabbitmq.info
2. http://clojurerabbitmq.info/articles/extensions.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130818/820b1dd2/attachment.htm>

From daniel.bason at telogis.com  Mon Aug 19 03:58:52 2013
From: daniel.bason at telogis.com (Dan_b)
Date: Sun, 18 Aug 2013 19:58:52 -0700 (PDT)
Subject: [rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
Message-ID: <1376881132556-28899.post@n5.nabble.com>

Hi,

We have recently upgraded from rabbitmq-server 2.6.1 to 3.1.x (we have one
cluster running 3.1.5 and one running 3.1.3).  On both servers we have seen
the load average increase significantly, with it peaking up to 2x the number
cores.  The CPU utilization and IO wait aren't affected and it seems to be
down to internal locks.

Status is as follows (this is off peak):
Status of node rabbit at mq1 ...
[{pid,1535},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.1.5"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.5"},
      {rabbit,"RabbitMQ","3.1.5"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.5"},
      {webmachine,"webmachine","1.10.3-rmq3.1.5-gite9359c7"},
      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.1.5-git680dba8"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.5"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,157967560},
      {connection_procs,27074824},
      {queue_procs,59850832},
      {plugins,675680},
      {other_proc,10585832},
      {mnesia,1378504},
      {mgmt_db,10234568},
      {msg_index,4895480},
      {other_ets,8947648},
      {binary,10826584},
      {code,17261222},
      {atom,1552881},
      {other_system,4683505}]},
 {vm_memory_high_watermark,0.6},
 {vm_memory_limit,6442450944},
 {disk_free_limit,1000000000},
 {disk_free,18919137280},
 {file_descriptors,
     [{total_limit,3996},
      {total_used,611},
      {sockets_limit,3594},
      {sockets_used,391}]},
 {processes,[{limit,1048576},{used,4727}]},
 {run_queue,0},
 {uptime,607}]
...done.

Running an strace on one of the beam.smp sub-processes produces the
following:
Process 1595 attached - interrupt to quit
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235505, NULL) = 0
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
write(27,
"\0\0\0\0\0\3\324:\341\v\324\2345\204y\370\377c\23ry5\16\234\0\0\0\0\0\0\0\0"...,
48) = 48
futex(0x182324a0, FUTEX_WAKE_PRIVATE, 1) = 1
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235507, NULL) = -1 EAGAIN
(Resource temporarily unavailable)
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
fsync(27)                               = 0
write(99,
"\0\0\0\0\0\0\307\303c>\254\336\2268x\346\36\206\235\300\243\317\331\255\0\0\0\0\0\0\0\0"...,
48) = 48
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235509, NULL) = -1 EAGAIN
(Resource temporarily unavailable)
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
fsync(99)                               = 0
write(4, "!", 1)                        = 1
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235511, NULL) = 0
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
write(27,
"\0\0\0\0\0\3\324;I\236\257\221u\350\\\353\16\6\232\1XH\214D\0\0\0\0\0\0\0\0"...,
48) = 48
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235513, NULL) = -1 EAGAIN
(Resource temporarily unavailable)
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
fsync(27)                               = 0
futex(0x182324a0, FUTEX_WAKE_PRIVATE, 1) = 1
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235515, NULL) = 0
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
write(27,
"\0\0\0\0\0\3\324<}\235\263^\350w!\306A\334y\270P\232\37F\0\0\0\0\0\0\0\0"...,
48) = 48
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235517, NULL) = -1 EAGAIN
(Resource temporarily unavailable)
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
fsync(27)                               = 0
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235519, NULL) = 0
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
write(27,
"\0\0\0\0\0\3\324=\226(\16\265\355\200\307\7J\34b\4\240\"\355)\0\0\0\0\0\0\0\0"...,
48) = 48
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235521, NULL) = -1 EAGAIN
(Resource temporarily unavailable)
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
fsync(27)                               = 0
write(56,
"\0\0\0\0\0\0\3105X\22\252\\n\210\364&\300\1\331M~\227D!\0\0\0\0\0\0\0\0"...,
48) = 48
futex(0x18232420, FUTEX_WAKE_PRIVATE, 1) = 1
futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235523, NULL) = 0
futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
fsync(56)                               = 0
futex(0x18232420, FUTEX_WAKE_PRIVATE, 1) = 1


Any ideas on what is causing the locks?  Is there any further information I
can provide?

Regards
Dan



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/High-load-average-with-rabbitmq-server-3-1-x-tp28899.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From haster2004 at yandex.ru  Mon Aug 19 06:37:49 2013
From: haster2004 at yandex.ru (Haster)
Date: Sun, 18 Aug 2013 22:37:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Deleting queues doesn't cut connection?
In-Reply-To: <CAHEpgBD9KX67cBsMtHPKFNt_ubOLb2HcZGjrB69++m4ygrXmtQ@mail.gmail.com>
References: <1376657219195-28872.post@n5.nabble.com>
	<FA51601E-F37A-4228-96A7-6214DC99BDD9@gopivotal.com>
	<1376658543622-28877.post@n5.nabble.com>
	<CFE8B3D2-58AC-43B4-A64F-EC75CFDFA53A@gopivotal.com>
	<1376660427330-28880.post@n5.nabble.com>
	<CAHEpgBD9KX67cBsMtHPKFNt_ubOLb2HcZGjrB69++m4ygrXmtQ@mail.gmail.com>
Message-ID: <1376890669990-28900.post@n5.nabble.com>

Chris,
thanks a lot for information. i will investigate it.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Deleting-queues-doesn-t-cut-connection-tp28872p28900.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Mon Aug 19 07:52:49 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 07:52:49 +0100
Subject: [rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
In-Reply-To: <1376881132556-28899.post@n5.nabble.com>
References: <1376881132556-28899.post@n5.nabble.com>
Message-ID: <5211C0C1.9040400@rabbitmq.com>

Dan,

On 19/08/13 03:58, Dan_b wrote:
> We have recently upgraded from rabbitmq-server 2.6.1 to 3.1.x (we have one
> cluster running 3.1.5 and one running 3.1.3).  On both servers we have seen
> the load average increase significantly, with it peaking up to 2x the number
> cores.  The CPU utilization and IO wait aren't affected and it seems to be
> down to internal locks.

I'd guess those FUTEXes have something to do with timers. They are 
immediately followed by fsyncs, which in rabbit are typically triggered 
by timers. So the sequence you are seeing is

1. write message to disk
2. wait for timer to expire
3. fsync

e.g.

> write(27,
> "\0\0\0\0\0\3\324=\226(\16\265\355\200\307\7J\34b\4\240\"\355)\0\0\0\0\0\0\0\0"...,
> 48) = 48
> futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235521, NULL) = -1 EAGAIN
> (Resource temporarily unavailable)
> futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
> fsync(27)                               = 0

So nothing to worry about.

Matthias.

From matthias at rabbitmq.com  Mon Aug 19 08:08:35 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 08:08:35 +0100
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A2B29@EXCHG01-OM.omel.es>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
	<520A334A.9030005@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2B29@EXCHG01-OM.omel.es>
Message-ID: <5211C473.3060903@rabbitmq.com>

On 14/08/13 10:09, jandres wrote:
> I use Microsoft Network Monitor to get the traffic between the
> server and the LDAP, but I can?t see the traffic of the RabbitMQ LDAP
> Plugin. I can see the traffic between Apache and the LDAP, but not
> between RabbitMQ and LDAP.
> So, I think I have something wrong in my config file, buy I don?t
> know what.

Your config looks fine.

You didn't say what version of RabbitMQ you are running. In >=3.0.0, 
when the LDAP plug-in has been configured with network-level logging (as 
you have done in your config), the rabbit log file should contain 
entries for all connection attempts, looking like this:

LDAP connecting to servers: ["ldap-server"]

Do you see these in the logs?

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Aug 19 08:12:24 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 08:12:24 +0100
Subject: [rabbitmq-discuss] Question on RabbitMQ and file I/O
	characteristics
In-Reply-To: <CACLE7iyQp_y5TZqpxv_Xh9OjixFSs8jPJU=7JK_gbdxhq1dS7Q@mail.gmail.com>
References: <CACLE7ix6UVgxXxhPbF083jUDyOqvDkz1nnRLNLtDCrYM8KK2Vg@mail.gmail.com>
	<51FF779D.6040302@rabbitmq.com>
	<CACLE7iyDFtqS7ZWUr5TNmU-Ou-fE7CUBru3owpekRtLYWk0U=A@mail.gmail.com>
	<52011A7F.9010403@rabbitmq.com>
	<CACLE7izYTbUj9LguaP=hZ2x04+86jd2U9caAa7E6Y5KQEhfhWg@mail.gmail.com>
	<52021FD1.50906@rabbitmq.com>
	<CACLE7iyQp_y5TZqpxv_Xh9OjixFSs8jPJU=7JK_gbdxhq1dS7Q@mail.gmail.com>
Message-ID: <5211C558.5060804@rabbitmq.com>

Matt,

On 15/08/13 18:00, Matt Pietrek wrote:
> Understood - Back to the original question, in this scenario would you
> expect each written message to cause approximately four disk writes?
> Naively, I'd expect it to be closer to two or three writes.

1st write: message
2nd write: queue index data for publish
3rd write: queue index data for deliver
4th write: queue index data for ack

Matthias.

From daniel.bason at telogis.com  Mon Aug 19 08:37:40 2013
From: daniel.bason at telogis.com (Daniel Bason)
Date: Mon, 19 Aug 2013 19:37:40 +1200
Subject: [rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
In-Reply-To: <5211C0C1.9040400@rabbitmq.com>
References: <1376881132556-28899.post@n5.nabble.com>
	<5211C0C1.9040400@rabbitmq.com>
Message-ID: <CAHdxdCfQK_P28E-5cnmwPSbMbh15vdurr4ifYADbTm3h4V2ttg@mail.gmail.com>

Hi Matthias,

Thanks for the response, so the extra process queue during our peak message
throughput which in turn causes the load average to be reported much higher
is just a side effect of this?  We normally have about 600 connections
(mostly consumers) and our producers all publish to topic exchanges, we
have around 250 queues.

Regards
Dan


On Mon, Aug 19, 2013 at 6:52 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Dan,
>
>
> On 19/08/13 03:58, Dan_b wrote:
>
>> We have recently upgraded from rabbitmq-server 2.6.1 to 3.1.x (we have one
>> cluster running 3.1.5 and one running 3.1.3).  On both servers we have
>> seen
>> the load average increase significantly, with it peaking up to 2x the
>> number
>> cores.  The CPU utilization and IO wait aren't affected and it seems to be
>> down to internal locks.
>>
>
> I'd guess those FUTEXes have something to do with timers. They are
> immediately followed by fsyncs, which in rabbit are typically triggered by
> timers. So the sequence you are seeing is
>
> 1. write message to disk
> 2. wait for timer to expire
> 3. fsync
>
> e.g.
>
>
>  write(27,
>> "\0\0\0\0\0\3\324=\226(\16\**265\355\200\307\7J\34b\4\240\"**
>> \355)\0\0\0\0\0\0\0\0"...,
>> 48) = 48
>> futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235521, NULL) = -1 EAGAIN
>> (Resource temporarily unavailable)
>> futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
>> fsync(27)                               = 0
>>
>
> So nothing to worry about.
>
> Matthias.
>



-- 
*Dan Bason *
Infrastructure Engineer ? Telogis
www.telogis.com  www.telogis.co.nz
+1 201 477-1448 (USA)  +64 3 281-8065 (NZ)

<http://www.google.com/url?q=http%3A%2F%2Fwww.telogis.com%2F&sa=D&sntz=1&usg=AFrqEze6z4qIWKcAMjgXqM25xkuw9JMysQ>

*One Platform for Location Intelligence*

-- 


This e-mail, and any attachments, is intended only for use by the 
addressee(s) named herein and may contain legally privileged and/or 
confidential information.  It is the property of Telogis.  If you are not 
the intended recipient of this e-mail, you are hereby notified that any 
dissemination, distribution or copying of this e-mail, any attachments 
thereto, and use of the information contained, is strictly prohibited.  If 
you have received this e-mail in error, please notify the sender and 
permanently delete the original and any copy thereof.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/9bb2512d/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 19 08:45:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 08:45:58 +0100
Subject: [rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
In-Reply-To: <CAHdxdCfQK_P28E-5cnmwPSbMbh15vdurr4ifYADbTm3h4V2ttg@mail.gmail.com>
References: <1376881132556-28899.post@n5.nabble.com>
	<5211C0C1.9040400@rabbitmq.com>
	<CAHdxdCfQK_P28E-5cnmwPSbMbh15vdurr4ifYADbTm3h4V2ttg@mail.gmail.com>
Message-ID: <5211CD36.2010809@rabbitmq.com>

Dan,

On 19/08/13 08:37, Daniel Bason wrote:
> Thanks for the response, so the extra process queue during our peak
> message throughput which in turn causes the load average to be reported
> much higher is just a side effect of this?

I suspect so, though w/o delving into the Erlang VM, in particular its 
threading and I/O model, we cannot be sure. The VM typically uses as 
many threads as there are cores, but there is a separate pool of threads 
for I/O, so it's reasonable to conclude that under heavy I/O load the 
load average can exceed the number of cores.

Matthias.

From matthias at rabbitmq.com  Mon Aug 19 08:49:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 08:49:45 +0100
Subject: [rabbitmq-discuss] ConnectFailureException on CreateConnection()
In-Reply-To: <1376587584006-28850.post@n5.nabble.com>
References: <1376587584006-28850.post@n5.nabble.com>
Message-ID: <5211CE19.7010806@rabbitmq.com>

On 15/08/13 18:26, akmartin wrote:
> The following exception is thrown when I try to connect to RabbitMq.
> My retry logic forces another attempt and the second time through it
> succeeds. Every invocation is configured with the same hostname and
> resolve to the same endpoint.

Are these connection attempts made from some sort of test framework, 
that starts rabbit, connects, runs a test, stops rabbit, etc?

I am asking because...

> =INFO REPORT==== 15-Aug-2013::13:13:58 ===
> Management plugin started. Port: 15672
>
> =INFO REPORT==== 15-Aug-2013::13:13:58 ===
> accepting AMQP connection <0.331.0> (10.20.40.96:53725 -> 10.20.40.90:5672)

...this shows a connection getting accepted immediately as the broker 
comes up.

So I suspect what's happening is that the failed connection attempts 
occur during the broker startup phase, which suggests your test code, or 
whatever it is, doesn't wait for the broker to fully start before 
attempting to connect.

Unfortunately, afaik, there is no easy way on Windows to wait for the 
broker to start. So you may just have to retry the connection attempts 
until they succeed.

> I am running 3.1.3. Waiting on updated nuget packages to upgrade
> servers.

You can upgrade the server w/o upgrading the clients. And vice versa.


Regards,

Matthias.

From simon at rabbitmq.com  Mon Aug 19 09:01:47 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Aug 2013 09:01:47 +0100
Subject: [rabbitmq-discuss] AMQP port 5672
In-Reply-To: <CAMcAHLWt6aQ_wMUHJv0BnmKm2=yBQPKVM3Gt5=zzq7YchWyhFQ@mail.gmail.com>
References: <CAGOpLV49x=ZCscxG5eZZmazLkQ3=vYv0pR9K4E6HWCEX3vyu_g@mail.gmail.com>
	<CAMcAHLWt6aQ_wMUHJv0BnmKm2=yBQPKVM3Gt5=zzq7YchWyhFQ@mail.gmail.com>
Message-ID: <5211D0EB.7090508@rabbitmq.com>

On 18/08/2013 18:03, Alvaro Videla wrote:
> Take a look at the Environment variables here:
> http://www.rabbitmq.com/configure.html specifically RABBITMQ_NODE_PORT

Or tcp_listeners in the configuration file: 
http://www.rabbitmq.com/configure.html#configuration-file

Cheers, Simon


From simon at rabbitmq.com  Mon Aug 19 09:03:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Aug 2013 09:03:23 +0100
Subject: [rabbitmq-discuss] Failed to start rabbitmq-server
In-Reply-To: <CAB8Hozr9RKfEjUOkVNPQ=N2PLtY-Jj9Xnr=MZMkN4Up_znrh7g@mail.gmail.com>
References: <CAB8Hozr9RKfEjUOkVNPQ=N2PLtY-Jj9Xnr=MZMkN4Up_znrh7g@mail.gmail.com>
Message-ID: <5211D14B.6020704@rabbitmq.com>

That definitely looks broken. What errors show up in the log files?

Cheers, Simon

On 17/08/2013 08:12, ?? wrote:
> HI,
>
>        when i start rabbitmq-server, show errors follows
>
> BOOT FAILED
> ===========
>
> Error description:
>     {{shutdown,
>          {failed_to_start_child,rabbit_memory_monitor,
>              {noproc,
>                  {gen_server,call,
>                      [vm_memory_monitor,get_memory_limit,infinity]}}}},
>      {child,undefined,rabbit_memory_monitor_sup,
>          {rabbit_restartable_sup,start_link,
>
> [rabbit_memory_monitor_sup,{rabbit_memory_monitor,start_link,[]}]},
>          transient,infinity,supervisor,
>          [rabbit_restartable_sup]}}
>
> Log files (may contain more information):
>     /home/map/rabbitmq/log/map.log
>     /home/map/rabbitmq/log/map-sasl.log
>
>
>
> BOOT FAILED
> ===========
>
> Error description:
>     {could_not_start,rabbit,
>         {bad_return,
>             {{rabbit,start,[normal,[]]},
>              {'EXIT',
>                  {rabbit,failure_during_boot,
>                      {{shutdown,
>                           {failed_to_start_child,rabbit_memory_monitor,
>                               {noproc,
>                                   {gen_server,call,
>                                       [vm_memory_monitor,get_memory_limit,
>                                        infinity]}}}},
>                       {child,undefined,rabbit_memory_monitor_sup,
>                           {rabbit_restartable_sup,start_link,
>                               [rabbit_memory_monitor_sup,
>                                {rabbit_memory_monitor,start_link,[]}]},
>                           transient,infinity,supervisor,
>                           [rabbit_restartable_sup]}}}}}}}
>
> {"init terminating in
> do_boot",{rabbit,failure_during_boot,{could_not_start,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot,{{shutdown,{failed_to_start_child,rabbit_memory_monitor,{noproc,{gen_server,call,[vm_memory_monitor,get_memory_limit,infinity]}}}},{child,undefined,rabbit_memory_monitor_sup,{rabbit_restartable_sup,start_link,[rabbit_memory_monitor_sup,{rabbit_memory_monitor,start_link,[]}]},transient,infinity,supervisor,[rabbit_restartable_sup]}}}}}}}}}
>
> yours,
> Jeremy
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From matthias at rabbitmq.com  Mon Aug 19 09:09:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 09:09:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ QUEUE MESSAGES
In-Reply-To: <1375795934034-28612.post@n5.nabble.com>
References: <1374651001375-28315.post@n5.nabble.com>
	<51EF8407.4060806@rabbitmq.com>
	<1374652023304-28317.post@n5.nabble.com>
	<51EF86E7.8030105@rabbitmq.com>
	<1374652266203-28319.post@n5.nabble.com>
	<51EF8F98.5070601@rabbitmq.com>
	<1374660089485-28335.post@n5.nabble.com>
	<51EFAE12.7010208@rabbitmq.com>
	<1374756757556-28391.post@n5.nabble.com>
	<51F24C7B.7010403@rabbitmq.com>
	<1375795934034-28612.post@n5.nabble.com>
Message-ID: <5211D2C9.4020207@rabbitmq.com>

Artur,

On 06/08/13 14:32, rabbit15 wrote:
> Hi, I saw that there is still not the same like with my buffer. When I used
> my buffer than it was on the same speed all the time. If I run with
> qos.basic(1), but without my buffer than the speed was better than without
> qos, but still there are different values even 0.

As I explained, using basic.qos actually hurts performance, but can 
produce *more consistent* performance.

Note that in general when simultaneously sending to and consuming from a 
queue, the performance can fluctuate. That's because the queue is a 
synchronisation point - it can only deal with publishing *or* 
consuming/ack'ing. The balance between the two is down to scheduling and 
can shift over time.

Regards,

Matthias.

From haster2004 at yandex.ru  Mon Aug 19 09:32:17 2013
From: haster2004 at yandex.ru (Haster)
Date: Mon, 19 Aug 2013 01:32:17 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c and network problems
Message-ID: <1376901137922-28910.post@n5.nabble.com>

Hi there!
Does rabbitmq-c library have any method to check correctness of connection?

For example I call basic.consume and start reading loop from Server... And
server fall down, or network cord was cut by something... As I understand I
won't be  give noticed about this situations... (my loop is constructed on
waiting socket in select function)? 

So is it any way to know about such problems?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-and-network-problems-tp28910.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From 314992959 at qq.com  Mon Aug 19 10:01:55 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 19 Aug 2013 02:01:55 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c   use amqp_basic_ack(..., qwTag,
 ..)  twice  lead  consumer lose
Message-ID: <1376902915165-28911.post@n5.nabble.com>

I  try  to  use   amqp_basic_ack()  twice  with  same  parameter, it's  seem 
OK. rabbitmq server reply NROMAL.   But  I  check  list_consumers. find 
that  consumer  lose.  what's  the problem ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-use-amqp-basic-ack-qwTag-twice-lead-consumer-lose-tp28911.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Aug 19 10:08:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Aug 2013 10:08:13 +0100
Subject: [rabbitmq-discuss] rabbitmq-c   use amqp_basic_ack(..., qwTag,
 ..)  twice  lead  consumer lose
In-Reply-To: <1376902915165-28911.post@n5.nabble.com>
References: <1376902915165-28911.post@n5.nabble.com>
Message-ID: <5211E07D.7080309@rabbitmq.com>

On 19/08/2013 10:01, 3k4b251 wrote:
> I  try  to  use   amqp_basic_ack()  twice  with  same  parameter

You should not acknowledge the same delivery tag twice.

>, it's  seem OK. rabbitmq server reply NROMAL.

I don't know librabbitmq that well, but basic.ack is an asynchronous 
method, so the server can't reply at all. The NORMAL "reply" is 
presumably being given to you unconditionally by the client library.

> But  I  check  list_consumers. find
> that  consumer  lose.  what's  the problem ?

The consumer (and the channel) will have been closed. The server will 
have reported an error - I'm not sure how you get that in the C API.

Cheers, Simon


From watson.timothy at gmail.com  Mon Aug 19 10:23:20 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 19 Aug 2013 10:23:20 +0100
Subject: [rabbitmq-discuss] rabbitmq-c and network problems
In-Reply-To: <1376901137922-28910.post@n5.nabble.com>
References: <1376901137922-28910.post@n5.nabble.com>
Message-ID: <68C44942-7AD5-4E5C-8467-9B9E1DCCAA30@rabbitmq.com>

What you want to do is turn on AMQP heartbeats. IIRC the c client requires that you manage the send/recv of these by hand though.

On 19 Aug 2013, at 09:32, Haster <haster2004 at yandex.ru> wrote:

> Hi there!
> Does rabbitmq-c library have any method to check correctness of connection?
> 
> For example I call basic.consume and start reading loop from Server... And
> server fall down, or network cord was cut by something... As I understand I
> won't be  give noticed about this situations... (my loop is constructed on
> waiting socket in select function)? 
> 
> So is it any way to know about such problems?
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-and-network-problems-tp28910.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jtlg at vp.pl  Mon Aug 19 10:35:09 2013
From: jtlg at vp.pl (ModronMaze)
Date: Mon, 19 Aug 2013 02:35:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Enabling publisher confirms damages performance
	by a factor of 10x
Message-ID: <1376904909257-28914.post@n5.nabble.com>

Hi,

I tried to use publisher confirms to ensure my messages are not lost, but
encountered a performance issue. My test case is as follows:

1. One publisher sends 200.000 messages in a loop and asynchronously marks
them as confirmed.
2. One consumer reads messages from queue, executes some work (db access,
sends other messages etc)
3. Prefetch is set to 512.
4. Queue and messages are durable/persistent.
5. I tried using versions 3.0.2, 3.1.4, 3.1.5

Without using publisher confirms I publish at least *250 msg/s* (and ack
with the same speed). Queue contains only prefetched messages.

When I enable confirms (separate channel and connection - only for sending
messages that require it) speed drops to *15-25 msg/s*. Using management API
I found out that publisher's connection is constantly blocked by flow
control.
I think it is strange, because all messages are consumed as soon as they
enter a queue. I did not observe any problems with memory/disk limits.

I'm attaching a screenshot with blocked connection. Usually "To client" is
not zero (about 250 B/s).

<http://rabbitmq.1065348.n5.nabble.com/file/n28914/42.png> 






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Enabling-publisher-confirms-damages-performance-by-a-factor-of-10x-tp28914.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From haster2004 at yandex.ru  Mon Aug 19 10:52:07 2013
From: haster2004 at yandex.ru (Haster)
Date: Mon, 19 Aug 2013 02:52:07 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c and network problems
In-Reply-To: <68C44942-7AD5-4E5C-8467-9B9E1DCCAA30@rabbitmq.com>
References: <1376901137922-28910.post@n5.nabble.com>
	<68C44942-7AD5-4E5C-8467-9B9E1DCCAA30@rabbitmq.com>
Message-ID: <1376905927462-28915.post@n5.nabble.com>

Tim, thanks for reply.
I will read about hearbeats.
But what is IIRC client? Google doesn't get me any links...
I use rabbitmq-c client in my application, 




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-and-network-problems-tp28910p28915.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Mon Aug 19 10:55:25 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 19 Aug 2013 10:55:25 +0100
Subject: [rabbitmq-discuss] rabbitmq-c and network problems
In-Reply-To: <1376905927462-28915.post@n5.nabble.com>
References: <1376901137922-28910.post@n5.nabble.com>
	<68C44942-7AD5-4E5C-8467-9B9E1DCCAA30@rabbitmq.com>
	<1376905927462-28915.post@n5.nabble.com>
Message-ID: <B43BAE01-3C94-4B69-BFBB-FDB6A8A1EEB7@rabbitmq.com>

On 19 Aug 2013, at 10:52, Haster wrote:
> Tim, thanks for reply.
> I will read about hearbeats.
> But what is IIRC client? Google doesn't get me any links...
> I use rabbitmq-c client in my application, 
> 
> 

IIRC == If I Remember Correctly.


From joao.pereira at mobbit.com  Mon Aug 19 14:30:32 2013
From: joao.pereira at mobbit.com (Joao Gomes Pereira)
Date: Mon, 19 Aug 2013 14:30:32 +0100
Subject: [rabbitmq-discuss] rabbit federation is failing
In-Reply-To: <520CBBF6.7000707@rabbitmq.com>
References: <520BB5B7.2050205@mobbit.com> <520CBBF6.7000707@rabbitmq.com>
Message-ID: <52121DF8.9020906@mobbit.com>

They both failed, the upstream and the downstream.
The status was showing "running" in both sites. I didnt used the command 
"rabbitmqctl"
but i checked in the RabbitMQ managment (web interface).

Is this timeout normal? how can we deal with this situation in order to 
have the nodes federated 24/7 ?

Thanks
Joao Pereira



On 08/15/2013 12:31 PM, Simon MacMullen wrote:
> It's not obvious that those errors have anything to do with your problem.
>
> The first one is an inbound connection being dropped due to its 
> heartbeat being missed.
>
> The second is an error which (unfortunately) happens whenever a 
> federation link comes up; it needs to ensure that an exchange does not 
> exist, so it tries to delete it - if it already did not exist we log 
> an error.
>
> Federation should always re-establish links that have failed.
>
> So when you say it stopped working, what happened? Is 192.168.1.200 
> the upstream, downstream or both? What does the link status reporting 
> say? (http://www.rabbitmq.com/federation.html#status)
>
> Cheers, Simon
>
> On 14/08/13 17:52, Joao Gomes Pereira wrote:
>> Hello
>> I implemented a rabbit federation to exchange SMS messages between
>> diferent servers.
>> After working fine for some days, one of my nodes (192.168.1.200) just
>> stopped working.
>>
>> We can see some errors in the node log:
>>
>>
>> =INFO REPORT==== 13-Aug-2013::14:01:31 ===
>> Federation exchange 'LX' in vhost '/' connected to exchange 'LX' in
>> vhost '/' on amqp://94.46.208.100
>>
>> =ERROR REPORT==== 13-Aug-2013::14:03:46 ===
>> closing AMQP connection <0.5257.0> (94.46.208.98:45341 ->
>> 192.168.1.200:5672):
>> {heartbeat_timeout,running}
>>
>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>> accepting AMQP connection <0.5960.0> (94.46.208.98:60137 ->
>> 192.168.1.200:5672)
>>
>> =ERROR REPORT==== 13-Aug-2013::14:09:27 ===
>> connection <0.5960.0>, channel 3 - soft error:
>> {amqp_error,not_found,
>>              "no exchange 'federation: SMS_System ->
>> SMSDriver+Dispatcher-rabbit at insight-DISP-rabbit02 B' in vhost '/'",
>>              'exchange.delete'}
>>
>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>> accepting AMQP connection <0.5978.0> (94.46.208.98:20734 ->
>> 192.168.1.200:5672)
>>
>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>> closing AMQP connection <0.5978.0> (94.46.208.98:20734 ->
>> 192.168.1.200:5672)
>>
>>
>>
>>
>> How can I configure my node to be always federated?
>>
>> Thanks
>> regards
>> Joao Pereira
>>
>>
>>
>
>


-- 

From mas at crosscan.com  Mon Aug 19 14:34:31 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Mon, 19 Aug 2013 15:34:31 +0200
Subject: [rabbitmq-discuss] Consumer Cancel Notification do not work
Message-ID: <52121EE7.90900@crosscan.com>

Hi,

im currently expanding the php-amqplib by consumer cancel notification.

The problem is: i do never receive a basic.cancel by the server.

I do receive it neither when deleting the queue through the same channel 
through which i receive messages nor by deleting it manually via 
webinterface nor when the queue is relocated because of a failover (in 
case of mirrored queues).

[1] contains an example trace which is a result of the script found in 
[2]. Please note that the client already sends the correct capabilities 
which is not the case for the upstream version of phpamqplib.
As you can see in the script, the channel is not closed after it has 
received the message. Although i keep the channel open for minutes the 
basic.cancel never arrives.

[1] http://paste.debian.net/27030/
[2] http://paste.debian.net/27031/
--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From mas at crosscan.com  Mon Aug 19 14:37:10 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Mon, 19 Aug 2013 15:37:10 +0200
Subject: [rabbitmq-discuss] Consumer Cancel Notification do not work
In-Reply-To: <52121EE7.90900@crosscan.com>
References: <52121EE7.90900@crosscan.com>
Message-ID: <52121F86.6090803@crosscan.com>

Oh. we are talking about
RabbitMQ 3.1.5 with Erlang R15B01
--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From mklishin at gopivotal.com  Mon Aug 19 14:39:08 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 Aug 2013 17:39:08 +0400
Subject: [rabbitmq-discuss] Consumer Cancel Notification do not work
In-Reply-To: <52121EE7.90900@crosscan.com>
References: <52121EE7.90900@crosscan.com>
Message-ID: <B53773AC-FCCA-4A46-BE84-6F1F251EB03A@gopivotal.com>

Malte Schirmacher:

> The problem is: i do never receive a basic.cancel by the server.

Did you indicate that your client supports consumer cancellation notifications in the capabilities field?

RabbitMQ won't send extension methods that clients do not support. See [1] if you need
an example.

1. https://github.com/ruby-amqp/bunny/blob/master/lib/bunny/session.rb#L53
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/55f0cd4c/attachment.pgp>

From k.ross at resilientplc.com  Mon Aug 19 14:42:32 2013
From: k.ross at resilientplc.com (kzhen)
Date: Mon, 19 Aug 2013 06:42:32 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and SQL Server Integration Services
Message-ID: <1376919752650-28921.post@n5.nabble.com>

Hi all,

I've been working on a RabbitMQ extension for SQL Server Integration
Services (SSIS). SSIS is the Microsoft solution for designing extract
transform load (ETL) processes.

I've built a connector for RabbitMQ which allows an ETL developer to use a
RabbitMQ queue as a source.

If you're interested please take a look at my blog:

http://kzhendev.wordpress.com/2013/07/31/custom-ssis-components/

an example of how RabbitMQ could be used to load a dimension in a data
warehouse can be found here:

http://kzhendev.wordpress.com/2013/08/19/loading-a-data-warehouse-dimension-with-rabbitmq-and-ssis/

If you have any questions or feedback please let me know.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-and-SQL-Server-Integration-Services-tp28921.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mas at crosscan.com  Mon Aug 19 14:44:36 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Mon, 19 Aug 2013 15:44:36 +0200
Subject: [rabbitmq-discuss] Consumer Cancel Notification do not work
In-Reply-To: <B53773AC-FCCA-4A46-BE84-6F1F251EB03A@gopivotal.com>
References: <52121EE7.90900@crosscan.com>
	<B53773AC-FCCA-4A46-BE84-6F1F251EB03A@gopivotal.com>
Message-ID: <52122144.7000101@crosscan.com>

On 19/08/13 15:39, Michael Klishin wrote:

> Did you indicate that your client supports consumer cancellation notifications in the capabilities field?

I did, as you can see in the trace i linked :)

http://paste.debian.net/27030/

--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From mklishin at gopivotal.com  Mon Aug 19 14:45:23 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 Aug 2013 17:45:23 +0400
Subject: [rabbitmq-discuss] RabbitMQ and SQL Server Integration Services
In-Reply-To: <1376919752650-28921.post@n5.nabble.com>
References: <1376919752650-28921.post@n5.nabble.com>
Message-ID: <E8A0B97C-EDA1-43D1-8E95-7109018F8915@gopivotal.com>

kzhen:

> If you have any questions or feedback please let me know.

Do you have a separate site for the project? Or maybe a public code repository
with a README that explains what it is and how to use it?

We need somewhere to link to from the .NET tools section on rabbitmq.com ;)
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/26d36ba7/attachment.pgp>

From simon at rabbitmq.com  Mon Aug 19 14:47:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Aug 2013 14:47:01 +0100
Subject: [rabbitmq-discuss] Consumer Cancel Notification do not work
In-Reply-To: <52121EE7.90900@crosscan.com>
References: <52121EE7.90900@crosscan.com>
Message-ID: <521221D5.10701@rabbitmq.com>

On 19/08/13 14:34, Malte Schirmacher wrote:
> [1] contains an example trace which is a result of the script found in
> [2]. Please note that the client already sends the correct capabilities
> which is not the case for the upstream version of phpamqplib.

That looks about right. My suspicion is still that there is something 
wrong with the capabilities though. The trace doesn't make this clear 
unfortunately, but you are sending 'true' as an (AMQP) boolean, not a 
string, right? Does "rabbitmqctl list_connections name 
client_properties" look like the capabilities are listed correctly?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From k.ross at resilientplc.com  Mon Aug 19 14:58:23 2013
From: k.ross at resilientplc.com (kzhen)
Date: Mon, 19 Aug 2013 06:58:23 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and SQL Server Integration Services
In-Reply-To: <E8A0B97C-EDA1-43D1-8E95-7109018F8915@gopivotal.com>
References: <1376919752650-28921.post@n5.nabble.com>
	<E8A0B97C-EDA1-43D1-8E95-7109018F8915@gopivotal.com>
Message-ID: <1376920703228-28925.post@n5.nabble.com>

The code is all hosted in GitHub here:

https://github.com/kzhen/SSISRabbitMQ

The README is currently very short and to the point, but I will work on it
over the coming days so it clearly explains the different parts of the
system and how it can be used.

A link on the .Net tool section would be great 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-and-SQL-Server-Integration-Services-tp28921p28925.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Aug 19 15:16:38 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 Aug 2013 18:16:38 +0400
Subject: [rabbitmq-discuss] RabbitMQ and SQL Server Integration Services
In-Reply-To: <1376920703228-28925.post@n5.nabble.com>
References: <1376919752650-28921.post@n5.nabble.com>
	<E8A0B97C-EDA1-43D1-8E95-7109018F8915@gopivotal.com>
	<1376920703228-28925.post@n5.nabble.com>
Message-ID: <353DBF1D-F926-479A-80D1-451183B9CF6F@gopivotal.com>

kzhen:

> The README is currently very short and to the point, but I will work on it
> over the coming days so it clearly explains the different parts of the
> system and how it can be used.

Sounds good.

> A link on the .Net tool section would be great 

http://www.rabbitmq.com/devtools.html#dotnet-dev
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/f9b410a7/attachment.pgp>

From joao.pereira at mobbit.com  Mon Aug 19 15:20:06 2013
From: joao.pereira at mobbit.com (Joao Gomes Pereira)
Date: Mon, 19 Aug 2013 15:20:06 +0100
Subject: [rabbitmq-discuss] rabbit federation is failing
In-Reply-To: <52121DF8.9020906@mobbit.com>
References: <520BB5B7.2050205@mobbit.com> <520CBBF6.7000707@rabbitmq.com>
	<52121DF8.9020906@mobbit.com>
Message-ID: <52122996.5010102@mobbit.com>

My computers are rebooting every night at 00:30, without stoping 
rabbitMQ properly.
Could this be the problem? Because these errors in the federations show 
up in the first messages in the morning:





=ERROR REPORT==== 19-Aug-2013::08:51:36 ===
** Generic server <0.287.0> terminating
** Last message in was heartbeat_timeout
** When Server state == {state,amqp_network_connection,
{state,#Port<0.12096>,600,<0.298.0>,131072,
                                 undefined,false},
                             <0.285.0>,<0.289.0>,
{amqp_params_network,<<"guest">>,<<"guest">>,
<<"/">>,"94.46.208.100",5672,0,0,0,infinity,
                                 none,
                                 [#Fun<amqp_uri.7.32597394>,
                                  #Fun<amqp_uri.7.32597394>],
                                 [],[]},
                             0,
[{<<"capabilities">>,table,
[{<<"publisher_confirms">>,bool,true},
{<<"exchange_exchange_bindings">>,bool,true},
{<<"basic.nack">>,bool,true},
{<<"consumer_cancel_notify">>,bool,true}]},
                              {<<"copyright">>,longstr,
                               <<"Copyright (C) 2007-2013 VMware, Inc.">>},
{<<"information">>,longstr,
                               <<"Licensed under the MPL. See 
http://www.rabbitmq.com/">>},
{<<"platform">>,longstr,<<"Erlang/OTP">>},
{<<"product">>,longstr,<<"RabbitMQ">>},
{<<"version">>,longstr,<<"3.1.3">>}],
#Fun<amqp_connection_sup.0.39273983>,
#Fun<amqp_connection_sup.2.54430129>,false}
** Reason for termination ==
** heartbeat_timeout




=ERROR REPORT==== 19-Aug-2013::08:51:37 ===
** Generic server <0.234.0> terminating
** Last message in was {'DOWN',#Ref<0.0.0.1535>,process,<0.327.0>,shutdown}
** When Server state == {state,
                          {upstream,
[<<"amqp://94.46.208.100">>],
<<"LX">>,1000,1,1,36000000,none,false,'on-confirm',
                           none,<<"my-upstream">>},
{upstream_params,<<"amqp://94.46.208.100">>,
{amqp_params_network,<<"guest">>,<<"guest">>,
<<"/">>,"94.46.208.100",undefined,0,0,0,infinity,
                            none,
                            [#Fun<amqp_uri.7.32597394>,
                             #Fun<amqp_uri.7.32597394>],
                            [],[]},
                           {exchange,
{resource,<<"/">>,exchange,<<"LX">>},
                            fanout,true,false,false,[],
                            [{federation,
[{{<<"my-upstream">>,<<"LX">>},<<"B">>}]}],
                            [{vhost,<<"/">>},
                             {name,<<"federate-me">>},
                             {pattern,<<"LX">>},
                             {definition,
[{<<"federation-upstream-set">>,<<"all">>}]},
                             {priority,0}],
                            {[],[rabbit_federation_exchange]}}},
                          <0.287.0>,<0.327.0>,
<<"amq.ctag-48dZ1r0vSUQ_DIeVzVnH3g">>,
                          <<"federation: LX -> rabbit at europcar-disp-lx">>,
                          <<"federation: LX -> rabbit at europcar-disp-lx A">>,
                          {0,nil},
                          2,
                          {dict,1,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],
                             [[{<<>>,[]}|
                               {set,1,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],
[{resource,<<"/">>,queue,
<<"amq.gen-Lo9ghzM3Z7DLjpS_QXYJMw">>}],
                                  [],[],[],[],[],[],[]}}}]],
                             [],[]}}},
                          <0.259.0>,<0.278.0>,
{resource,<<"/">>,exchange,<<"LX">>},
                          {0,nil}}
** Reason for termination ==
** {upstream_channel_down,shutdown}






On 08/19/2013 02:30 PM, Joao Gomes Pereira wrote:
> They both failed, the upstream and the downstream.
> The status was showing "running" in both sites. I didnt used the 
> command "rabbitmqctl"
> but i checked in the RabbitMQ managment (web interface).
>
> Is this timeout normal? how can we deal with this situation in order 
> to have the nodes federated 24/7 ?
>
> Thanks
> Joao Pereira
>
>
>
> On 08/15/2013 12:31 PM, Simon MacMullen wrote:
>> It's not obvious that those errors have anything to do with your 
>> problem.
>>
>> The first one is an inbound connection being dropped due to its 
>> heartbeat being missed.
>>
>> The second is an error which (unfortunately) happens whenever a 
>> federation link comes up; it needs to ensure that an exchange does 
>> not exist, so it tries to delete it - if it already did not exist we 
>> log an error.
>>
>> Federation should always re-establish links that have failed.
>>
>> So when you say it stopped working, what happened? Is 192.168.1.200 
>> the upstream, downstream or both? What does the link status reporting 
>> say? (http://www.rabbitmq.com/federation.html#status)
>>
>> Cheers, Simon
>>
>> On 14/08/13 17:52, Joao Gomes Pereira wrote:
>>> Hello
>>> I implemented a rabbit federation to exchange SMS messages between
>>> diferent servers.
>>> After working fine for some days, one of my nodes (192.168.1.200) just
>>> stopped working.
>>>
>>> We can see some errors in the node log:
>>>
>>>
>>> =INFO REPORT==== 13-Aug-2013::14:01:31 ===
>>> Federation exchange 'LX' in vhost '/' connected to exchange 'LX' in
>>> vhost '/' on amqp://94.46.208.100
>>>
>>> =ERROR REPORT==== 13-Aug-2013::14:03:46 ===
>>> closing AMQP connection <0.5257.0> (94.46.208.98:45341 ->
>>> 192.168.1.200:5672):
>>> {heartbeat_timeout,running}
>>>
>>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>>> accepting AMQP connection <0.5960.0> (94.46.208.98:60137 ->
>>> 192.168.1.200:5672)
>>>
>>> =ERROR REPORT==== 13-Aug-2013::14:09:27 ===
>>> connection <0.5960.0>, channel 3 - soft error:
>>> {amqp_error,not_found,
>>>              "no exchange 'federation: SMS_System ->
>>> SMSDriver+Dispatcher-rabbit at insight-DISP-rabbit02 B' in vhost '/'",
>>>              'exchange.delete'}
>>>
>>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>>> accepting AMQP connection <0.5978.0> (94.46.208.98:20734 ->
>>> 192.168.1.200:5672)
>>>
>>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>>> closing AMQP connection <0.5978.0> (94.46.208.98:20734 ->
>>> 192.168.1.200:5672)
>>>
>>>
>>>
>>>
>>> How can I configure my node to be always federated?
>>>
>>> Thanks
>>> regards
>>> Joao Pereira
>>>
>>>
>>>
>>
>>
>
>


-- 

From simon at rabbitmq.com  Mon Aug 19 15:45:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Aug 2013 15:45:30 +0100
Subject: [rabbitmq-discuss] rabbit federation is failing
In-Reply-To: <52121DF8.9020906@mobbit.com>
References: <520BB5B7.2050205@mobbit.com> <520CBBF6.7000707@rabbitmq.com>
	<52121DF8.9020906@mobbit.com>
Message-ID: <52122F8A.3040100@rabbitmq.com>

It's still quite unclear to me what the "failure" is in your case. The 
log extracts you posted showed a link failing and being re-established. 
The status says "running". So what is the problem?

Cheers, Simon

On 19/08/13 14:30, Joao Gomes Pereira wrote:
> They both failed, the upstream and the downstream.
> The status was showing "running" in both sites. I didnt used the command
> "rabbitmqctl"
> but i checked in the RabbitMQ managment (web interface).
>
> Is this timeout normal? how can we deal with this situation in order to
> have the nodes federated 24/7 ?
>
> Thanks
> Joao Pereira
>
>
>
> On 08/15/2013 12:31 PM, Simon MacMullen wrote:
>> It's not obvious that those errors have anything to do with your problem.
>>
>> The first one is an inbound connection being dropped due to its
>> heartbeat being missed.
>>
>> The second is an error which (unfortunately) happens whenever a
>> federation link comes up; it needs to ensure that an exchange does not
>> exist, so it tries to delete it - if it already did not exist we log
>> an error.
>>
>> Federation should always re-establish links that have failed.
>>
>> So when you say it stopped working, what happened? Is 192.168.1.200
>> the upstream, downstream or both? What does the link status reporting
>> say? (http://www.rabbitmq.com/federation.html#status)
>>
>> Cheers, Simon
>>
>> On 14/08/13 17:52, Joao Gomes Pereira wrote:
>>> Hello
>>> I implemented a rabbit federation to exchange SMS messages between
>>> diferent servers.
>>> After working fine for some days, one of my nodes (192.168.1.200) just
>>> stopped working.
>>>
>>> We can see some errors in the node log:
>>>
>>>
>>> =INFO REPORT==== 13-Aug-2013::14:01:31 ===
>>> Federation exchange 'LX' in vhost '/' connected to exchange 'LX' in
>>> vhost '/' on amqp://94.46.208.100
>>>
>>> =ERROR REPORT==== 13-Aug-2013::14:03:46 ===
>>> closing AMQP connection <0.5257.0> (94.46.208.98:45341 ->
>>> 192.168.1.200:5672):
>>> {heartbeat_timeout,running}
>>>
>>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>>> accepting AMQP connection <0.5960.0> (94.46.208.98:60137 ->
>>> 192.168.1.200:5672)
>>>
>>> =ERROR REPORT==== 13-Aug-2013::14:09:27 ===
>>> connection <0.5960.0>, channel 3 - soft error:
>>> {amqp_error,not_found,
>>>              "no exchange 'federation: SMS_System ->
>>> SMSDriver+Dispatcher-rabbit at insight-DISP-rabbit02 B' in vhost '/'",
>>>              'exchange.delete'}
>>>
>>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>>> accepting AMQP connection <0.5978.0> (94.46.208.98:20734 ->
>>> 192.168.1.200:5672)
>>>
>>> =INFO REPORT==== 13-Aug-2013::14:09:27 ===
>>> closing AMQP connection <0.5978.0> (94.46.208.98:20734 ->
>>> 192.168.1.200:5672)
>>>
>>>
>>>
>>>
>>> How can I configure my node to be always federated?
>>>
>>> Thanks
>>> regards
>>> Joao Pereira
>>>
>>>
>>>
>>
>>
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From vashi.priyanki at gmail.com  Mon Aug 19 16:04:25 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Mon, 19 Aug 2013 08:04:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Question on packing of Bytes into Ethernet Frame
	for AMQP protocol
Message-ID: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>

Hi there ,

I wanted to understand little bit more about AMQP, rabbitmq and pika client 
capability of packing of AMQP bytes into one single ethernet frames before 
transmission through ethernet connectivity.

1) What is the default behavior of pika clients and rabbit server when it 
comes to packing of bytes into one single ethernet frame ?
For now I see that there is no packing done at all when I took trace on 
server side and I see individual frames for content-header (87bytes), 
content-body (137 bytes), basic.publish (87bytes) and basic- ack (87 bytes) 
so this makes total of 4 AMQP frames for 1 message and all four are just 
having a very small size.

2) Can we change this ? and if yes, how to change it  on server side? 

3) Does python-pika client supports such packing of bytes ? if yes, how to 
do achieve that also ? 

Attaching a small screenshot of trace, which I took on server side for 
better visualization. 
Any insight on this would be very helpful.

Best Regards,
Priyanki. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/7ca65d75/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: wireshark_screenshot_samples.jpg
Type: image/jpeg
Size: 214642 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/7ca65d75/attachment.jpg>

From mklishin at gopivotal.com  Mon Aug 19 16:10:31 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 Aug 2013 19:10:31 +0400
Subject: [rabbitmq-discuss] Question on packing of Bytes into Ethernet
	Frame for AMQP protocol
In-Reply-To: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>
References: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>
Message-ID: <4DA0E27B-6C4D-47D9-A5EC-04888589DF4B@gopivotal.com>

Priyanki Vashi:

> I wanted to understand little bit more about AMQP, rabbitmq and pika client capability of packing of AMQP bytes into one single ethernet frames before transmission through ethernet connectivity.
> 
> 1) What is the default behavior of pika clients and rabbit server when it comes to packing of bytes into one single ethernet frame ?
> For now I see that there is no packing done at all when I took trace on server side and I see individual frames for content-header (87bytes), content-body (137 bytes), basic.publish (87bytes) and basic- ack (87 bytes) so this makes total of 4 AMQP frames for 1 message and all four are just having a very small size.
> 
> 2) Can we change this ? and if yes, how to change it  on server side? 
> 
> 3) Does python-pika client supports such packing of bytes ? if yes, how to do achieve that also ? 

Both clients and RabbitMQ itself use sockets and are not aware Ethernet framing, MTU size value
used, et cetera. MTU size can be configured [1] but it's dangerous and no necessary 99% of the time.

1. http://www.debianhelp.co.uk/mtu.htm
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/7b083d22/attachment.pgp>

From simon at rabbitmq.com  Mon Aug 19 16:14:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Aug 2013 16:14:28 +0100
Subject: [rabbitmq-discuss] Hung Server Upgrading from 3.1.1 to 3.1.5 in
 a cluster
In-Reply-To: <CAHEpgBDgjtgtV7vL-9qQVSk5M2v9t-48o2e+Xftrc7oJ8FB_uA@mail.gmail.com>
References: <CAHEpgBCvORiBktuDpHSEnx2SLmo-a-GLhSvbebsmDJjiMZoeHA@mail.gmail.com>
	<CAHEpgBDgjtgtV7vL-9qQVSk5M2v9t-48o2e+Xftrc7oJ8FB_uA@mail.gmail.com>
Message-ID: <52123654.4070109@rabbitmq.com>

Thanks. BTW, we have seen that 
rabbit_mirror_queue_master:stop_all_slaves/2 stacktrace in recent soak 
testing of HA code - but not since fixing various other bugs in that 
area. So I think there was a real bug there (but one that was hard to 
hit) but it's now fixed. Hopefully.

Cheers, Simon

On 16/08/13 19:49, Chris wrote:
> FYI: I have not been able to reproduce this problem since it happened.
>   Perhaps my servers were somehow in a bad state to begin with.  So... I
> guess you can consider this as low-priority, for your informational
> purposes only. ;-)
>
> -Chris
>
>
> On Thu, Aug 15, 2013 at 4:09 PM, Chris <stuff at moesel.net
> <mailto:stuff at moesel.net>> wrote:
>
>     Hello,
>
>     I had a running cluster of two RabbitMQ 3.1.1 servers on Redhat 6.2.
>       I left both running and then attempted to upgrade one (via yum).
>       After the upgrade, rabbitmqctl reported the cluster_status was
>     good, but none of my consumers seemed to be working.
>
>     I then attempted to upgrade the other, hoping that would fix things,
>     but the upgrade just hung.  After killing the upgrade (ctl-c) I
>     noted that I couldn't stop rabbitmq-server anymore (not via service
>     script or rabbitmqctl).  I had to kill it manually.  After killing
>     it, I re-ran the upgrade and all was well.
>
>     Looking in the logs, I then saw a BUNCH of errors with timestamps
>     corresponding to when I upgraded the first server.  It seems that
>     didn't go cleanly on the remaining 3.1.1 node and might be
>     responsible for all the trouble.  Did I just get unlucky?
>
>     Here's the SASL log:
>
>     =CRASH REPORT==== 15-Aug-2013::14:27:49 ===
>        crasher:
>          initial call: gen:init_it/6
>          pid: <0.271.0>
>          registered_name: []
>          exception exit: {{badmatch,{error,not_found}},
>                           [{rabbit_mirror_queue_master,stop_all_slaves,2,
>                                [{file,"src/rabbit_mirror_queue_master.erl"},
>                                 {line,179}]},
>
>     {rabbit_mirror_queue_master,delete_and_terminate,2,
>                                [{file,"src/rabbit_mirror_queue_master.erl"},
>                                 {line,175}]},
>                            {rabbit_amqqueue_process,'-terminate/2-fun-3-',5,
>                                [{file,"src/rabbit_amqqueue_process.erl"},
>                                 {line,162}]},
>                            {rabbit_amqqueue_process,terminate_shutdown,2,
>                                [{file,"src/rabbit_amqqueue_process.erl"},
>                                 {line,272}]},
>                            {gen_server2,terminate,3,
>                                [{file,"src/gen_server2.erl"},{line,1031}]},
>                            {proc_lib,wake_up,3,
>                                [{file,"proc_lib.erl"},{line,249}]}]}
>            in function  gen_server2:terminate/3 (src/gen_server2.erl,
>     line 1034)
>          ancestors: [rabbit_mirror_queue_slave_sup,rabbit_sup,<0.148.0>]
>          messages: []
>          links: [<0.270.0>]
>          dictionary: [{guid,{{3434499189
>     <tel:3434499189>,622214121,884364685,3594937084},1}}]
>          trap_exit: true
>          status: running
>          heap_size: 1598
>          stack_size: 27
>          reductions: 9106
>        neighbours:
>
>     =SUPERVISOR REPORT==== 15-Aug-2013::14:27:49 ===
>           Supervisor: {local,
>
>       rabbit_mirror_queue_slave_sup}
>           Context:    child_terminated
>           Reason:     {{badmatch,{error,not_found}},
>                        [{rabbit_mirror_queue_master,stop_all_slaves,2,
>                             [{file,"src/rabbit_mirror_queue_master.erl"},
>                              {line,179}]},
>                         {rabbit_mirror_queue_master,delete_and_terminate,2,
>                             [{file,"src/rabbit_mirror_queue_master.erl"},
>                              {line,175}]},
>                         {rabbit_amqqueue_process,'-terminate/2-fun-3-',5,
>
>       [{file,"src/rabbit_amqqueue_process.erl"},{line,162}]},
>                         {rabbit_amqqueue_process,terminate_shutdown,2,
>
>       [{file,"src/rabbit_amqqueue_process.erl"},{line,272}]},
>                         {gen_server2,terminate,3,
>                             [{file,"src/gen_server2.erl"},{line,1031}]},
>
>       {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>           Offender:   [{pid,<0.271.0>},
>                        {name,rabbit_mirror_queue_slave},
>                        {mfa,
>                            {rabbit_mirror_queue_slave,start_link,
>                                [{amqqueue,
>                                     {resource,<<"acs">>,queue,
>
>       <<"replies.4a0e284c-1662-463a-b363-cbb4e9557266">>},
>                                     true,false,none,
>                                     [{<<"x-expires">>,signedint,600000}],
>                                     <7111.3423.0>,[],[],
>                                     [{vhost,<<"acs">>},
>                                      {name,<<"ha-acs">>},
>                                      {pattern,<<".*">>},
>                                      {definition,
>                                          [{<<"ha-mode">>,<<"exactly">>},
>                                           {<<"ha-params">>,2}]},
>                                      {priority,0}],
>                                     [{<7111.3424.0>,<7111.3423.0>},
>                                      {<7111.8011.82>,<7111.8010.82>},
>                                      {<0.27964.278>,<0.27962.278>}]}]}},
>                        {restart_type,temporary},
>                        {shutdown,4294967295},
>                        {child_type,worker}]
>
>     Thanks!
>     Chris
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From mas at crosscan.com  Mon Aug 19 16:19:34 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Mon, 19 Aug 2013 17:19:34 +0200
Subject: [rabbitmq-discuss] Consumer Cancel Notification do not work
In-Reply-To: <521221D5.10701@rabbitmq.com>
References: <52121EE7.90900@crosscan.com> <521221D5.10701@rabbitmq.com>
Message-ID: <52123786.9080902@crosscan.com>

On 19/08/13 15:47, Simon MacMullen wrote:

> That looks about right. My suspicion is still that there is something
> wrong with the capabilities though. The trace doesn't make this clear
> unfortunately, but you are sending 'true' as an (AMQP) boolean, not a
> string, right? Does "rabbitmqctl list_connections name
> client_properties" look like the capabilities are listed correctly?

You are right. that's the problem. It worked for publisher_confirms to 
simply send the table as a string. But from what i do know now i guess 
it worked because rabbitmq ignores the capabilities sent when it 
receives a confirm.select message ;-)

Thank you!

--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From simon at rabbitmq.com  Mon Aug 19 16:24:03 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Aug 2013 16:24:03 +0100
Subject: [rabbitmq-discuss] Consumer Cancel Notification do not work
In-Reply-To: <52123786.9080902@crosscan.com>
References: <52121EE7.90900@crosscan.com> <521221D5.10701@rabbitmq.com>
	<52123786.9080902@crosscan.com>
Message-ID: <52123893.1070400@rabbitmq.com>

On 19/08/13 16:19, Malte Schirmacher wrote:
> You are right. that's the problem. It worked for publisher_confirms to
> simply send the table as a string. But from what i do know now i guess
> it worked because rabbitmq ignores the capabilities sent when it
> receives a confirm.select message ;-)

Yeah, we don't actually check the capabilities table for confirms since 
if you sent confirm.select that's a pretty heavy hint you can handle 
confirms - whereas consumer cancels are entirely unsolicited.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From alan.antonuk at gmail.com  Mon Aug 19 16:33:42 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 19 Aug 2013 08:33:42 -0700
Subject: [rabbitmq-discuss] rabbitmq-c and network problems
In-Reply-To: <68C44942-7AD5-4E5C-8467-9B9E1DCCAA30@rabbitmq.com>
References: <1376901137922-28910.post@n5.nabble.com>
	<68C44942-7AD5-4E5C-8467-9B9E1DCCAA30@rabbitmq.com>
Message-ID: <CAAt2poLv28GDEFHSpr_0MTQ5Y9zuo4FaVgVCxvosPDavc8OnRg@mail.gmail.com>

The library will return a library error of AMQP_STATUS_CONNECTION_CLOSED if
the underling connection to the broker has been severed.

As of rabbitmq-c v0.4.0 the library will send and receive heartbeats when
doing long-running calls into the library (e.g., calling
amqp_consume_message()) after they've been enabled by specifying a non-zero
heartbeat parameter in amqp_login(). Note that if a heartbeat timeout
occurs a library error of AMQP_STATUS_HEARTBEAT_TIMEOUT will be returned.



On Mon, Aug 19, 2013 at 2:23 AM, Tim Watson <watson.timothy at gmail.com>wrote:

> What you want to do is turn on AMQP heartbeats. IIRC the c client requires
> that you manage the send/recv of these by hand though.
>
> On 19 Aug 2013, at 09:32, Haster <haster2004 at yandex.ru> wrote:
>
> > Hi there!
> > Does rabbitmq-c library have any method to check correctness of
> connection?
> >
> > For example I call basic.consume and start reading loop from Server...
> And
> > server fall down, or network cord was cut by something... As I
> understand I
> > won't be  give noticed about this situations... (my loop is constructed
> on
> > waiting socket in select function)?
> >
> > So is it any way to know about such problems?
> >
> >
> >
> > --
> > View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-and-network-problems-tp28910.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/47348c65/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 19 16:36:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 16:36:12 +0100
Subject: [rabbitmq-discuss] Question on packing of Bytes into Ethernet
 Frame for AMQP protocol
In-Reply-To: <4DA0E27B-6C4D-47D9-A5EC-04888589DF4B@gopivotal.com>
References: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>
	<4DA0E27B-6C4D-47D9-A5EC-04888589DF4B@gopivotal.com>
Message-ID: <52123B6C.6070406@rabbitmq.com>

On 19/08/13 16:10, Michael Klishin wrote:
> Both clients and RabbitMQ itself use sockets and are not aware
> Ethernet framing, MTU size value used, et cetera. MTU size can be
> configured [1] but it's dangerous and no necessary 99% of the time.

The RabbitMQ server and Java, Erlang and .net clients pass all the AMQP 
frames associated with content-bearing methods - i.e. the method, header 
and body frames - to the network layer before flushing the socket, so 
all these AMQP frames should generally only get split over multiple 
ethernet frames when exceeding the MTU size.

Matthias.

From alan.antonuk at gmail.com  Mon Aug 19 16:42:33 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 19 Aug 2013 08:42:33 -0700
Subject: [rabbitmq-discuss] rabbitmq-c use amqp_basic_ack(..., qwTag,
 ..) twice lead consumer lose
In-Reply-To: <5211E07D.7080309@rabbitmq.com>
References: <1376902915165-28911.post@n5.nabble.com>
	<5211E07D.7080309@rabbitmq.com>
Message-ID: <CAAt2poKe1Mqa+=kj-6_ynrEbXJiJVgKrdXbzKg_y1bB52n9HWw@mail.gmail.com>

>
>  , it's  seem OK. rabbitmq server reply NROMAL.
>>
>
> I don't know librabbitmq that well, but basic.ack is an asynchronous
> method, so the server can't reply at all. The NORMAL "reply" is presumably
> being given to you unconditionally by the client library.
>
> The return value from amqp_basic_ack() indicates that the write to the
underlying socket was successful, it does not indicate that the call was
correct from the broker's point of view.

>
>  But  I  check  list_consumers. find
>> that  consumer  lose.  what's  the problem ?
>>
>
> The consumer (and the channel) will have been closed. The server will have
> reported an error - I'm not sure how you get that in the C API.
>

The library will indicate a channel error occurred next time a function
that reads frames from the broker occurs. e.g., calling
amqp_simple_wait_frame() will return a AMQP_CHANNEL_CLOSE_METHOD on the
channel you did the invalid amqp_basic_ack().  Note that the broker will
only close the channel if an error occurs, it will not positively
acknowledge a correct basic.ack.

My recommendation is to add this to your applications processing loop -
when you go to read frames from the broker, check for channel.close methods
and take appropriate action.

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/df37c290/attachment.htm>

From michael.laing at nytimes.com  Mon Aug 19 16:54:22 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Mon, 19 Aug 2013 11:54:22 -0400
Subject: [rabbitmq-discuss] Question on packing of Bytes into Ethernet
 Frame for AMQP protocol
In-Reply-To: <52123B6C.6070406@rabbitmq.com>
References: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>
	<4DA0E27B-6C4D-47D9-A5EC-04888589DF4B@gopivotal.com>
	<52123B6C.6070406@rabbitmq.com>
Message-ID: <CAKgmDnHEJjeOz5oEV+URuKHRxPXz+=KWdRN_AwdeMPu6kwLjUw@mail.gmail.com>

pika sets TCP_NODELAY and does not provide an option to change it. Hence
you may have small packets by design.

ml


On Mon, Aug 19, 2013 at 11:36 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/08/13 16:10, Michael Klishin wrote:
>
>> Both clients and RabbitMQ itself use sockets and are not aware
>> Ethernet framing, MTU size value used, et cetera. MTU size can be
>> configured [1] but it's dangerous and no necessary 99% of the time.
>>
>
> The RabbitMQ server and Java, Erlang and .net clients pass all the AMQP
> frames associated with content-bearing methods - i.e. the method, header
> and body frames - to the network layer before flushing the socket, so all
> these AMQP frames should generally only get split over multiple ethernet
> frames when exceeding the MTU size.
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/3d7a7b4e/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 19 16:58:24 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 16:58:24 +0100
Subject: [rabbitmq-discuss] Question on packing of Bytes into Ethernet
 Frame for AMQP protocol
In-Reply-To: <CAKgmDnHEJjeOz5oEV+URuKHRxPXz+=KWdRN_AwdeMPu6kwLjUw@mail.gmail.com>
References: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>
	<4DA0E27B-6C4D-47D9-A5EC-04888589DF4B@gopivotal.com>
	<52123B6C.6070406@rabbitmq.com>
	<CAKgmDnHEJjeOz5oEV+URuKHRxPXz+=KWdRN_AwdeMPu6kwLjUw@mail.gmail.com>
Message-ID: <521240A0.10501@rabbitmq.com>

On 19/08/13 16:54, Laing, Michael wrote:
> pika sets TCP_NODELAY and does not provide an option to change it. Hence
> you may have small packets by design.

The server and the clients I mentioned set TCP_NODELAY too; the 
aggregation happens in buffers prior to hitting the O/S network layer.

Matthias.

From mas at crosscan.com  Mon Aug 19 18:21:11 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Mon, 19 Aug 2013 19:21:11 +0200
Subject: [rabbitmq-discuss] A minor bug
Message-ID: <52125407.7050404@crosscan.com>

Hello,

the documentation on [1] says the broker log will contain a line like 
"config file(s) : /etc/rabbitmq/rabbitmq.config".
I can't find such a file. Only if there is no config-file at all the log 
indicates this.

--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From simon at rabbitmq.com  Mon Aug 19 18:27:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Aug 2013 18:27:32 +0100
Subject: [rabbitmq-discuss] A minor bug
In-Reply-To: <52125407.7050404@crosscan.com>
References: <52125407.7050404@crosscan.com>
Message-ID: <52125584.2000305@rabbitmq.com>

On 19/08/13 18:21, Malte Schirmacher wrote:
> the documentation on [1] says the broker log will contain a line like
> "config file(s) : /etc/rabbitmq/rabbitmq.config".
> I can't find such a file. Only if there is no config-file at all the log
> indicates this.

... damn, you're right. Thanks for the report.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Mon Aug 19 18:52:59 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Aug 2013 18:52:59 +0100
Subject: [rabbitmq-discuss] A minor bug
In-Reply-To: <52125584.2000305@rabbitmq.com>
References: <52125407.7050404@crosscan.com> <52125584.2000305@rabbitmq.com>
Message-ID: <52125B7B.7060503@rabbitmq.com>

On 19/08/13 18:27, Simon MacMullen wrote:
> On 19/08/13 18:21, Malte Schirmacher wrote:
>> the documentation on [1] says the broker log will contain a line like
>> "config file(s) : /etc/rabbitmq/rabbitmq.config".
>> I can't find such a file. Only if there is no config-file at all the log
>> indicates this.
>
> ... damn, you're right. Thanks for the report.

Fixed. 
https://github.com/rabbitmq/rabbitmq-server/commit/5cc86a30ac59d52608f06e387ba6f6840b9b703e

This will be in tonight's nightly and the next bugfix release.

Matthias.

From michael.s.klishin at gmail.com  Mon Aug 19 19:56:19 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 19 Aug 2013 22:56:19 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.4.1 is released
Message-ID: <CAE3HoVQNqua4DnMmPXGh4EMpZ_9LFA5COcjfcMm=OcGsetsOOA@mail.gmail.com>

Langohr [1] is a small, feature complete Clojure client for RabbitMQ.

1.4.1 is a bug fix release. Release notes:
http://blog.clojurewerkz.org/blog/2013/08/16/langohr-1-dot-4-1-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/56de4277/attachment.htm>

From haster2004 at yandex.ru  Mon Aug 19 20:31:30 2013
From: haster2004 at yandex.ru (Haster)
Date: Mon, 19 Aug 2013 12:31:30 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c and network problems
In-Reply-To: <CAAt2poLv28GDEFHSpr_0MTQ5Y9zuo4FaVgVCxvosPDavc8OnRg@mail.gmail.com>
References: <1376901137922-28910.post@n5.nabble.com>
	<68C44942-7AD5-4E5C-8467-9B9E1DCCAA30@rabbitmq.com>
	<CAAt2poLv28GDEFHSpr_0MTQ5Y9zuo4FaVgVCxvosPDavc8OnRg@mail.gmail.com>
Message-ID: <1376940690522-28943.post@n5.nabble.com>

Alan, thanks for reply!

I use rabbitmq 0.3.0, and there is no yet method
amqp_login_with_parameters.. Is there any simple method to add this
functionality? And if not how can I realize it by myself? Should I use some
thread that will periodicaly send some specific method to server and get
anser from it or?

And now I check below usage case:
1) start server (I use old version version 2.8.6)
2) start consumer and start reading loop (befor this I have called
basic.consume method)
3) kill rabbitmq server
As a result I don't receive any errrors and my reading thread works as
befor. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-and-network-problems-tp28910p28943.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Mon Aug 19 21:19:25 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 19 Aug 2013 13:19:25 -0700
Subject: [rabbitmq-discuss] rabbitmq-c and network problems
In-Reply-To: <1376940690522-28943.post@n5.nabble.com>
References: <1376901137922-28910.post@n5.nabble.com>
	<68C44942-7AD5-4E5C-8467-9B9E1DCCAA30@rabbitmq.com>
	<CAAt2poLv28GDEFHSpr_0MTQ5Y9zuo4FaVgVCxvosPDavc8OnRg@mail.gmail.com>
	<1376940690522-28943.post@n5.nabble.com>
Message-ID: <CAAt2poJ6FY0NpLmHt-16Y36_JKF3mDr73Y5LnNd0MsCOimmTOA@mail.gmail.com>

On Mon, Aug 19, 2013 at 12:31 PM, Haster <haster2004 at yandex.ru> wrote:

>
> I use rabbitmq 0.3.0, and there is no yet method
> amqp_login_with_parameters.. Is there any simple method to add this
> functionality? And if not how can I realize it by myself? Should I use some
> thread that will periodicaly send some specific method to server and get
> anser from it or?
>

My recommendation is to upgrade rabbitmq-c to v0.4.0. While it is possible
to implement AMQP heartbeats from a client program, it requires in-depth
knowledge of the AMQP protocol, the innards of rabbitmq-c, and likely will
break when you get to the point of upgrading to v0.4.0.


> And now I check below usage case:
> 1) start server (I use old version version 2.8.6)
> 2) start consumer and start reading loop (befor this I have called
> basic.consume method)
> 3) kill rabbitmq server
> As a result I don't receive any errrors and my reading thread works as
> befor.
>
> Even without heartbeat support, the library should eventually error-out in
amqp_simple_wait_frame() when the socket is closed. There might be a few
messages in the client-side network buffer that will end up being consumed
by rabbitmq-c before it detects that socket has been closed.

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/508b8fa6/attachment.htm>

From tim at rabbitmq.com  Mon Aug 19 23:35:57 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 19 Aug 2013 23:35:57 +0100
Subject: [rabbitmq-discuss] Clustering Behaviour
In-Reply-To: <932f8257-1984-4ac2-b0b9-4634371f27e6@googlegroups.com>
References: <932f8257-1984-4ac2-b0b9-4634371f27e6@googlegroups.com>
Message-ID: <C7E4496D-433A-42DE-8BA9-159F35946575@rabbitmq.com>

Hi Max,

On 18 Aug 2013, at 13:34, Max Manders wrote:
> If I configure the cluster to use mirrored queues, I'm also working on the assumption that nodes may be transient and might get terminated and created via scaling events.

Not really sure what you mean by this. For the record, it is not entire nodes that are configured to use mirroring, but individual queues. In a RabbitMQ cluster, all schema definitions (e.g., queues, exchanges, bindings, users, etc) are replicated atomically between all nodes. Messages (inside queues) are normally not shared, but mirroring allows these to be replicated as well, for those queues to which the ha policy is applied.

> If a node dies, I can see via `rabbitmqctl cluster_status` that the node is still part of the cluster, but not a 'running node'.  What are the implications of this?

Client previously connected to that node will have been disconnected. If the master queue process for a mirrored queue previously resided on the now disconnected node, one of the remaining slaves - the most up date, i.e., complete replica - will be elected as the new master. When the node eventually re-establishes connectivity with the rest of the cluster, its copy of all the cluster-wide definitions (mentioned above) will be synchronised to reflect any changes that occurred whilst it was offline. If the node is selected (by an ha policy) to host mirrors for any HA/Mirrored queues, then slaves (i.e., replica queue processes) will be started for them.

>  If a client requests a message from a queue via an exchange, will the cluster service the request from an available node, knowing not to use the dead node?

That's not quite right - clients *publish* to exchanges and *consume* from queues. It sounds like your question is about location transparency (from the client's perspective) within a cluster however - in which case yes, that is right. Clients can connect to any node and see exchanges and queues that were declared on other nodes. Publishing and consuming works transparently, so that you can connect to any node in the cluster and publish to an exchange or consume from a queue, regardless of whether they were declared on the node to which you connected or not.

Queue will not however, magically "fail-over" if the node on which they were declared crashes - they will disappear from the cluster and any undelivered messages will be lost. If an exchange is bound to a queue on another node (and is not bound to any others!) and that node goes down, then the message will be lost since there is no longer a binding and the broker will drop the message in that case.

If a queue is mirrored (due to ha policy) however, you don't have to worry about that because a replica will take over and the message will be received there instead.

> Do I need to worry about cluster nodes versus running node; will the cluster remove a node that hasn't been running for some time, or should I programmatically clean up dead nodes?
> 

The cluster won't remove dead nodes. The assumption is that they will come back at some point. If they don't, then you are indeed responsible for removing them from the cluster.

> Also, how do clients connect to a cluster?  Do I put a load balancer in front of a cluster and have an application connect to the load balancer?

A lot of users seem to get along fine doing that.

> Or should an application connect to a particular cluster node, or any cluster node?  Apologies for the questions, but I'm not developing the app, just providing the infrastructure / middleware; not a fan of doing so without having a better understanding.
> 
> Any help, gratefully received!
> 

Sure not a problem. Hopefully I've answered some of the above without adding too much confusion! :)

Do spend some time reading the copious documentation on the website, and feel free to drop back here with any further questions.

Kind regards,

Tim



From goyalk at vmware.com  Tue Aug 20 02:15:06 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Mon, 19 Aug 2013 18:15:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to access management portal after
	upgarding erlang and RabbitMQ
Message-ID: <2dc98c94.000002d4.0000000b@KAPILPC.vmware.com>

I upgraded to Erlang R16B01 and RabbitMQ 3.1.5 and cannot access
management portal anymore. I have been using SSL and port 15671 for
management portal. I get this error:

 

On Chrome: Error 141 (net::ERR_SSL_CLIENT_AUTH_SIGNATURE_FAILED): Unknown
error.

On Firefox: The key does not support the requested operation. (Error code:
sec_error_invalid_key)

 

I did not change the RabbitMQ configuration or the SSL certificates, only
upgraded the software.

 

Any suggestions?

 

Thanks

Kapil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/c3fb87ad/attachment.htm>

From 314992959 at qq.com  Tue Aug 20 03:00:10 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 19 Aug 2013 19:00:10 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c use amqp_basic_ack(..., qwTag,
 ..) twice lead consumer lose
In-Reply-To: <CAAt2poKe1Mqa+=kj-6_ynrEbXJiJVgKrdXbzKg_y1bB52n9HWw@mail.gmail.com>
References: <1376902915165-28911.post@n5.nabble.com>
	<5211E07D.7080309@rabbitmq.com>
	<CAAt2poKe1Mqa+=kj-6_ynrEbXJiJVgKrdXbzKg_y1bB52n9HWw@mail.gmail.com>
Message-ID: <1376964010105-28947.post@n5.nabble.com>

I  did  a  test. try to  use amqp_basic_ack twice  after i got  the  message
delivery_tag .    it's seems  like that  channel  still  alive,  consumer
lose.  and  I  can still  receive  messages  from the same queue  without
any consumer.   And  the durable  messages  can not  remove from queue by
the amqp_basic_ack().  And  amqp_consume_message()  always  return 
AMQP_RESPONSE_NORMAL.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-use-amqp-basic-ack-qwTag-twice-lead-consumer-lose-tp28911p28947.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From adam at milrr.com  Mon Aug 19 21:47:59 2013
From: adam at milrr.com (Adam Miller)
Date: Mon, 19 Aug 2013 13:47:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Channel hangs after mirrored queue is promoted
	to master
Message-ID: <eb798c49-a2c6-4e7d-980a-f99a855288a7@googlegroups.com>

I'm running rabbit 3.1.5 server on Windows Server 2008 in a 2 node cluster. 
 I'm seeing issues where my .net client (using 3.1.5 of official .Net 
rabbitMQ client) is unable to continue consuming from a queue when its 
consuming from a mirror that has been promoted to a master.  I'm handling 
the Consumer.Canceled event, if I try to do a BasicConsume on the channel, 
(or interact with the connection), the code hangs for about 10-15 minutes 
until the server terminates the connection.  If I do nothing then messages 
won't be consumed.  My queue policy is ha-all, and my consuming application 
is connected to rabbitMQ on the same machine (amqp://localhost).  To 
recreate the scenario I just have to restart the RabbitMQ windows service 
on the machine that is currently the master.  How should I correctly handle 
the Consumer Cancellation Notification?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/12dde516/attachment.htm>

From amy at ebrary.com  Tue Aug 20 00:03:09 2013
From: amy at ebrary.com (Marco, Amy)
Date: Mon, 19 Aug 2013 23:03:09 +0000
Subject: [rabbitmq-discuss] join_cluster error: The nodes provided are
 either offline or not running
Message-ID: <CE37F23A.C0AA%amy.marco@proquest.com>

Hi,

I am receiving the following error upon trying to cluster two rabbitmq nodes.

dev-rmq03:pts/0{amy}/etc/rabbitmq>sudo rabbitmqctl join_cluster rabbit at dev-rmq02
Clustering node 'rabbit at dev-rmq03' with 'rabbit at dev-rmq02' ...
Error: {cannot_discover_cluster,"The nodes provided are either offline or not running"

I have opened ports :
iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport 4369 -j ACCEPT
iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport 5672 -j ACCEPT
iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport 5673 -j ACCEPT
iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport 15672 -j ACCEPT
iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport 55672 -j ACCEPT
iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport 15673 -j ACCEPT
iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport 15674 -j ACCEPT
(ps can you also tell me which ports I actually need? A developer keeps requesting additional ports for me to try but it makes me uncomfortable opening so many)

On both nodes. I can ping each hostname from each other and telnet to port 5672 to each.

I have also verified that the hash value and .erlang.cookie in $RABBIT_HOME is the same and have perms rabbitmq:rabbitmq 0400 each.

Log:

=INFO REPORT==== 19-Aug-2013::15:46:18 ===
node           : rabbit at dev-rmq03
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : fqOuPm+oysAbZXSsQO2ZfQ==
log            : /var/log/rabbitmq/rabbit at dev-rmq03.log
sasl log       : /var/log/rabbitmq/rabbit at dev-rmq03-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at dev-rmq03

=INFO REPORT==== 19-Aug-2013::15:46:18 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 19-Aug-2013::15:46:18 ===
Memory limit set to 1531MB of 3829MB total.

=INFO REPORT==== 19-Aug-2013::15:46:18 ===
Disk free limit set to 1000MB

=INFO REPORT==== 19-Aug-2013::15:46:18 ===
Adding vhost '/'

=INFO REPORT==== 19-Aug-2013::15:46:18 ===
Creating user 'guest'

=INFO REPORT==== 19-Aug-2013::15:46:18 ===
Setting user tags for user 'guest' to [administrator]

=INFO REPORT==== 19-Aug-2013::15:46:18 ===
Setting permissions for 'guest' in '/' to '.*', '.*', '.*'

=INFO REPORT==== 19-Aug-2013::15:46:19 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 19-Aug-2013::15:46:19 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 19-Aug-2013::15:46:19 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 19-Aug-2013::15:46:19 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 19-Aug-2013::15:46:19 ===
Server startup complete; 0 plugins started.

=INFO REPORT==== 19-Aug-2013::15:46:30 ===
Stopping RabbitMQ

=INFO REPORT==== 19-Aug-2013::15:46:30 ===
stopped TCP Listener on [::]:5672

Anything else you guys can think of for me to try to resolve this issue?

Thank you so much!

Amy

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/fdb456ae/attachment.htm>

From swordangel at gmail.com  Tue Aug 20 07:27:15 2013
From: swordangel at gmail.com (Kal Sze)
Date: Mon, 19 Aug 2013 23:27:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't use backtick in password
Message-ID: <f7f6cea2-2fc9-4783-9060-06427310ae5d@googlegroups.com>

Hello,

I have RabbitMQ running on Ubuntu 12.04 and Debian Wheezy
I'm trying to setup some RabbitMQ users with secure passwords, but it looks 
like some characters don't get escaped correctly:

    root at server:~# rabbitmqctl add_user foo "\`"
    sh: 1: Syntax error: EOF in backquote substitution

Best Regards,
Kal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/681b0166/attachment.htm>

From swordangel at gmail.com  Tue Aug 20 08:12:36 2013
From: swordangel at gmail.com (Kal Sze)
Date: Tue, 20 Aug 2013 00:12:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't use backtick in password
In-Reply-To: <f7f6cea2-2fc9-4783-9060-06427310ae5d@googlegroups.com>
References: <f7f6cea2-2fc9-4783-9060-06427310ae5d@googlegroups.com>
Message-ID: <4c412e91-f490-44ee-872c-a07a2ff1d03d@googlegroups.com>

On Tuesday, 20 August 2013 14:27:15 UTC+8, Kal Sze wrote:

> Hello,
>
> I have RabbitMQ running on Ubuntu 12.04 and Debian Wheezy
> I'm trying to setup some RabbitMQ users with secure passwords, but it 
> looks like some characters don't get escaped correctly:
>
>     root at server:~# rabbitmqctl add_user foo "\`"
>     sh: 1: Syntax error: EOF in backquote substitution
>
> Best Regards,
> Kal
>

After obtaining some help from the #bash channel on Freenode IRC, it 
appears that the correct fix would be to use proper string substitution in 
the rabbitmqctl script:

Replace this line:\
    su rabbitmq -s /bin/sh -c "/usr/lib/rabbitmq/bin/${SCRIPT} ${CMDLINE}"

With this line:
    su rabbitmq -s /bin/sh -c 'script=$1; shift; "$script" "$@"' _ 
"/usr/lib/rabbitmq/bin/${SCRIPT}" "$@"

Credit goes to user zendeavor of the #bash channel on Freenode IRC.

Best Regards,
Kal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/29c4c8d4/attachment.htm>

From mklishin at gopivotal.com  Tue Aug 20 10:06:17 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 Aug 2013 13:06:17 +0400
Subject: [rabbitmq-discuss] Channel hangs after mirrored queue is
	promoted to master
In-Reply-To: <eb798c49-a2c6-4e7d-980a-f99a855288a7@googlegroups.com>
References: <eb798c49-a2c6-4e7d-980a-f99a855288a7@googlegroups.com>
Message-ID: <85445DAA-9CB1-4A7C-9C44-175AC4CDE9F5@gopivotal.com>

Adam Miller:

> I'm handling the Consumer.Canceled event, if I try to do a BasicConsume on the channel, (or interact with the connection), the code hangs for about 10-15 minutes until the server terminates the connection

Adam,

Can you take a thread dump and post it here? This sounds like an issue recently fixed in the Java
client, maybe .NET has it, too.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/c6e73596/attachment.pgp>

From vashi.priyanki at gmail.com  Tue Aug 20 11:56:30 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Tue, 20 Aug 2013 12:56:30 +0200
Subject: [rabbitmq-discuss] Question on packing of Bytes into Ethernet
 Frame for AMQP protocol
In-Reply-To: <521240A0.10501@rabbitmq.com>
References: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>
	<4DA0E27B-6C4D-47D9-A5EC-04888589DF4B@gopivotal.com>
	<52123B6C.6070406@rabbitmq.com>
	<CAKgmDnHEJjeOz5oEV+URuKHRxPXz+=KWdRN_AwdeMPu6kwLjUw@mail.gmail.com>
	<521240A0.10501@rabbitmq.com>
Message-ID: <CA+0nT8BObGX3sa1YxxYSKy5vAMrCnQ0Pw27XV9PCrmCkY2Eo_g@mail.gmail.com>

Hi All ,

Thank you for your replies.

I still have following question on them.
It might be basic but I want to thoroughly understand what is the
difference between pika-client and other client (like .net or erlang, Java)
when it comes to such packing.

1) As I learnt now Pika, Erlang , Java and .net clients all set TCP_NODELAY
flag, which means that there is no intelligence within this clients to pack
bytes together to make almost equal to MTU. Is it correct ?

2) And then in case of some clients like Erlang, Java and .net, the
aggregation happens in buffer prior to hitting the O/S network layer so
then why it's not the behaviour in pika-clients ?

My MTU size is set to 1500 bytes but I don't see that such agreegation
happening.


3) I can see that server does such packing while sending to consumer but
still it does not fill till MTU limit. In my case I see it's just fill
maximum of 204 bytes from server to consumer ( showing basic-deliver,
content-body and content-header)
Is this the expected behavior of rabbit server ?

4) But I always see only individual frames (of individual methods) from
client to server.


Best Regards,
Priyanki.




On Mon, Aug 19, 2013 at 5:58 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/08/13 16:54, Laing, Michael wrote:
>
>> pika sets TCP_NODELAY and does not provide an option to change it. Hence
>> you may have small packets by design.
>>
>
> The server and the clients I mentioned set TCP_NODELAY too; the
> aggregation happens in buffers prior to hitting the O/S network layer.
>
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/334674e0/attachment.htm>

From simon at rabbitmq.com  Tue Aug 20 12:03:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Aug 2013 12:03:49 +0100
Subject: [rabbitmq-discuss] join_cluster error: The nodes provided are
 either offline or not running
In-Reply-To: <CE37F23A.C0AA%amy.marco@proquest.com>
References: <CE37F23A.C0AA%amy.marco@proquest.com>
Message-ID: <52134D15.7090007@rabbitmq.com>

Hi. You probably need to read 
http://www.rabbitmq.com/clustering.html#firewall, especially the bit 
about inet_dist_listen_min / inet_dist_listen_max.

Cheers, Simon

On 20/08/13 00:03, Marco, Amy wrote:
> Hi,
>
> I am receiving the following error upon trying to cluster two rabbitmq
> nodes.
>
> *dev-rmq03:pts/0{amy}/etc/rabbitmq>sudo rabbitmqctl join_cluster
> rabbit at dev-rmq02*
> *Clustering node 'rabbit at dev-rmq03' with 'rabbit at dev-rmq02' ...*
> *Error: {cannot_discover_cluster,"The nodes provided are either offline
> or not running"*
>
> I have opened ports :
> iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport
> *4369* -j ACCEPT
> iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport
> *5672* -j ACCEPT
> iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport
> *5673* -j ACCEPT
> iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport
> *15672* -j ACCEPT
> iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport
> *55672* -j ACCEPT
> iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport
> *15673* -j ACCEPT
> iptables -A INPUT -i eth0 -m state --state NEW -m tcp -p tcp --dport
> *15674* -j ACCEPT
> (ps can you also tell me which ports I actually need? A developer keeps
> requesting additional ports for me to try but it makes me uncomfortable
> opening so many)
>
> On both nodes. I can ping each hostname from each other and telnet to
> port 5672 to each.
>
> I have also verified that the hash value and .erlang.cookie in
> $RABBIT_HOME is the same and have perms rabbitmq:rabbitmq 0400 each.
>
> Log:
>
> =INFO REPORT==== 19-Aug-2013::15:46:18 ===
> node           : rabbit at dev-rmq03
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : fqOuPm+oysAbZXSsQO2ZfQ==
> log            : /var/log/rabbitmq/rabbit at dev-rmq03.log
> sasl log       : /var/log/rabbitmq/rabbit at dev-rmq03-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at dev-rmq03
>
> =INFO REPORT==== 19-Aug-2013::15:46:18 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 19-Aug-2013::15:46:18 ===
> Memory limit set to 1531MB of 3829MB total.
>
> =INFO REPORT==== 19-Aug-2013::15:46:18 ===
> Disk free limit set to 1000MB
>
> =INFO REPORT==== 19-Aug-2013::15:46:18 ===
> Adding vhost '/'
>
> =INFO REPORT==== 19-Aug-2013::15:46:18 ===
> Creating user 'guest'
>
> =INFO REPORT==== 19-Aug-2013::15:46:18 ===
> Setting user tags for user 'guest' to [administrator]
>
> =INFO REPORT==== 19-Aug-2013::15:46:18 ===
> Setting permissions for 'guest' in '/' to '.*', '.*', '.*'
>
> =INFO REPORT==== 19-Aug-2013::15:46:19 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 19-Aug-2013::15:46:19 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =WARNING REPORT==== 19-Aug-2013::15:46:19 ===
> msg_store_persistent: rebuilding indices from scratch
>
> =INFO REPORT==== 19-Aug-2013::15:46:19 ===
> started TCP Listener on [::]:5672
>
> =INFO REPORT==== 19-Aug-2013::15:46:19 ===
> Server startup complete; 0 plugins started.
>
> =INFO REPORT==== 19-Aug-2013::15:46:30 ===
> Stopping RabbitMQ
>
> =INFO REPORT==== 19-Aug-2013::15:46:30 ===
> stopped TCP Listener on [::]:5672
>
> Anything else you guys can think of for me to try to resolve this issue?
>
> Thank you so much!
>
> Amy
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From tilak.chauhan at ymail.com  Tue Aug 20 12:14:34 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Tue, 20 Aug 2013 04:14:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages are getting lost when I restart RMQ in
	producer server
Message-ID: <1376997274936-28954.post@n5.nabble.com>

Hi,

I've installed/configured RMQ in multiple servers and they all are connected
though RMQ clustering. There is one producer sever which is responsible
publishing messges into multiple queues and other severs (consumer servers)
consume messages from the queues. So far everything was working fine, but
recently I've noticed one problem that is when I restart RMQ in any of the
consumer server then all the messages which were in queues (before restart)
appears back in the queues. In other words, If I restart rmq in any consumer
server then all messages still persist. But when I restart rmq in producer
server then all the messages are getting lost from the queues (in this case
messages also getting lost from all consumer severs, too).

Please anybody assist me here.. One more thing all rmq related configuration
in all the servers (producer and consumers) is same.

Thanks,
T.luck





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-are-getting-lost-when-I-restart-RMQ-in-producer-server-tp28954.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Aug 20 12:16:08 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 Aug 2013 15:16:08 +0400
Subject: [rabbitmq-discuss] Question on packing of Bytes into Ethernet
	Frame for AMQP protocol
In-Reply-To: <CA+0nT8BObGX3sa1YxxYSKy5vAMrCnQ0Pw27XV9PCrmCkY2Eo_g@mail.gmail.com>
References: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>
	<4DA0E27B-6C4D-47D9-A5EC-04888589DF4B@gopivotal.com>
	<52123B6C.6070406@rabbitmq.com>
	<CAKgmDnHEJjeOz5oEV+URuKHRxPXz+=KWdRN_AwdeMPu6kwLjUw@mail.gmail.com>
	<521240A0.10501@rabbitmq.com>
	<CA+0nT8BObGX3sa1YxxYSKy5vAMrCnQ0Pw27XV9PCrmCkY2Eo_g@mail.gmail.com>
Message-ID: <10C02FD4-194A-44BE-80B5-28CF277189CC@gopivotal.com>

Priyanki Vashi:

> 1) As I learnt now Pika, Erlang , Java and .net clients all set TCP_NODELAY flag, which means that there is no intelligence within this clients to pack bytes together to make almost equal to MTU. Is it correct ?

Setting TCP_NODELAY on a socket disables Nagle's algorithm. See
http://boundary.com/blog/2012/05/02/know-a-delay-nagles-algorithm-and-you/
and http://tools.ietf.org/html/rfc896.

Clients simply write data to a socket and are not aware of Ethernet framing. 

> 2) And then in case of some clients like Erlang, Java and .net, the aggregation happens in buffer prior to hitting the O/S network layer so then why it's not the behaviour in pika-clients ?
> 
> My MTU size is set to 1500 bytes but I don't see that such agreegation happening. 

"aggregation in a buffer" basically means that when you need to write 3 frames like this

[basic.publish frame] [content header frame] [message payload frame]

you serialize and concatenate them all in a buffer (or similar) and call socket.write
(or similar) once instead of 3 times. This *may* help achieve the kind of framing you want but there are
no guarantees and clients do not control that, the OS does.

> 
> 3) I can see that server does such packing while sending to consumer but still it does not fill till MTU limit. In my case I see it's just fill maximum of 204 bytes from server to consumer ( showing basic-deliver, content-body and content-header)  
> Is this the expected behavior of rabbit server ? 
> 4) But I always see only individual frames (of individual methods) from client to server.

I will assume this discussion is a continuation to your earlier emails about trying to saturate
a link with Pika and RabbitMQ.

Have you tried using MulticastMain, amqpc or a custom Java program after all to see
if it's any different? With the Java client, it is possible to tweak TCP_NODELAY
setting and see if it produces any results.

Also, if your link is not saturated, trying to pack multiple TCP segments
into a single Ethernet frame won't make it saturated.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/4e16e981/attachment.pgp>

From mklishin at gopivotal.com  Tue Aug 20 12:18:04 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 Aug 2013 15:18:04 +0400
Subject: [rabbitmq-discuss] Channel hangs after mirrored queue is
	promoted to master
In-Reply-To: <85445DAA-9CB1-4A7C-9C44-175AC4CDE9F5@gopivotal.com>
References: <eb798c49-a2c6-4e7d-980a-f99a855288a7@googlegroups.com>
	<85445DAA-9CB1-4A7C-9C44-175AC4CDE9F5@gopivotal.com>
Message-ID: <4B9BCEDC-D104-4BA4-8D31-6ECE4D3DA5B9@gopivotal.com>

Michael Klishin:

> Can you take a thread dump and post it here? This sounds like an issue recently fixed in the Java
> client, maybe .NET has it, too.

I can confirm that it is indeed the issue. .NET client does not dispatch consumer methods
(such as basic.cancel) in a thread pool. This means that operations that expect a response
(queue.declare, basic.consume) will block the network I/O thread if executed from
a basic.cancel handler.

To work around this, perform those operations from a newly created thread.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/7358780b/attachment.pgp>

From mklishin at gopivotal.com  Tue Aug 20 12:19:59 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 Aug 2013 15:19:59 +0400
Subject: [rabbitmq-discuss] Messages are getting lost when I restart RMQ
	in producer server
In-Reply-To: <1376997274936-28954.post@n5.nabble.com>
References: <1376997274936-28954.post@n5.nabble.com>
Message-ID: <F71E885F-FE0B-4239-B7D8-90690B0D01A4@gopivotal.com>

tluck:

> But when I restart rmq in producer
> server then all the messages are getting lost from the queues (in this case
> messages also getting lost from all consumer severs, too).
> 
> Please anybody assist me here.. One more thing all rmq related configuration
> in all the servers (producer and consumers) is same.

Are you using mirrored (HA) queues? If not, sounds like this is what you want.

http://www.rabbitmq.com/ha.html
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/5646abc8/attachment.pgp>

From vashi.priyanki at gmail.com  Tue Aug 20 12:53:09 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Tue, 20 Aug 2013 13:53:09 +0200
Subject: [rabbitmq-discuss] Question on packing of Bytes into Ethernet
 Frame for AMQP protocol
In-Reply-To: <10C02FD4-194A-44BE-80B5-28CF277189CC@gopivotal.com>
References: <b75c3c33-f615-41da-a8f2-11dfe575ede7@googlegroups.com>
	<4DA0E27B-6C4D-47D9-A5EC-04888589DF4B@gopivotal.com>
	<52123B6C.6070406@rabbitmq.com>
	<CAKgmDnHEJjeOz5oEV+URuKHRxPXz+=KWdRN_AwdeMPu6kwLjUw@mail.gmail.com>
	<521240A0.10501@rabbitmq.com>
	<CA+0nT8BObGX3sa1YxxYSKy5vAMrCnQ0Pw27XV9PCrmCkY2Eo_g@mail.gmail.com>
	<10C02FD4-194A-44BE-80B5-28CF277189CC@gopivotal.com>
Message-ID: <CA+0nT8B5YG4gs9kE-+wT=5=m3DpTebyeQ8uUcF28dAdE0=-H6g@mail.gmail.com>

Hi ,

I am in the process using amqpc but in the mean time I thought to ask on my
queries.
I did not particularly thought of just saturating the link but after
checking most of my traces I found no packing so just asked about it.

I will write back once I do my analysis.

Thank you again for writing back.

//P


On Tue, Aug 20, 2013 at 1:16 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Priyanki Vashi:
>
> > 1) As I learnt now Pika, Erlang , Java and .net clients all set
> TCP_NODELAY flag, which means that there is no intelligence within this
> clients to pack bytes together to make almost equal to MTU. Is it correct ?
>
> Setting TCP_NODELAY on a socket disables Nagle's algorithm. See
> http://boundary.com/blog/2012/05/02/know-a-delay-nagles-algorithm-and-you/
> and http://tools.ietf.org/html/rfc896.
>
> Clients simply write data to a socket and are not aware of Ethernet
> framing.
>
> > 2) And then in case of some clients like Erlang, Java and .net, the
> aggregation happens in buffer prior to hitting the O/S network layer so
> then why it's not the behaviour in pika-clients ?
> >
> > My MTU size is set to 1500 bytes but I don't see that such agreegation
> happening.
>
> "aggregation in a buffer" basically means that when you need to write 3
> frames like this
>
> [basic.publish frame] [content header frame] [message payload frame]
>
> you serialize and concatenate them all in a buffer (or similar) and call
> socket.write
> (or similar) once instead of 3 times. This *may* help achieve the kind of
> framing you want but there are
> no guarantees and clients do not control that, the OS does.
>
> >
> > 3) I can see that server does such packing while sending to consumer but
> still it does not fill till MTU limit. In my case I see it's just fill
> maximum of 204 bytes from server to consumer ( showing basic-deliver,
> content-body and content-header)
> > Is this the expected behavior of rabbit server ?
> > 4) But I always see only individual frames (of individual methods) from
> client to server.
>
> I will assume this discussion is a continuation to your earlier emails
> about trying to saturate
> a link with Pika and RabbitMQ.
>
> Have you tried using MulticastMain, amqpc or a custom Java program after
> all to see
> if it's any different? With the Java client, it is possible to tweak
> TCP_NODELAY
> setting and see if it produces any results.
>
> Also, if your link is not saturated, trying to pack multiple TCP segments
> into a single Ethernet frame won't make it saturated.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/3a66fddd/attachment.htm>

From tilak.chauhan at ymail.com  Tue Aug 20 13:53:51 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Tue, 20 Aug 2013 05:53:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages are getting lost when I restart RMQ
	in producer server
In-Reply-To: <F71E885F-FE0B-4239-B7D8-90690B0D01A4@gopivotal.com>
References: <1376997274936-28954.post@n5.nabble.com>
	<F71E885F-FE0B-4239-B7D8-90690B0D01A4@gopivotal.com>
Message-ID: <1377003231334-28960.post@n5.nabble.com>

Thanks MK for your help. I'll certainly look to use your solution. 

One more thing, I've set cluster_partition_handling = autoheal because I
faced network partition related issues on different  nodes. It appears that
this is also causing some problem because sometimes some of the
unacknowledged/unprocessed messages also getting lost from the queues. 

Thanks,
Tluck



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-are-getting-lost-when-I-restart-RMQ-in-producer-server-tp28954p28960.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Aug 20 13:58:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Aug 2013 13:58:21 +0100
Subject: [rabbitmq-discuss] Can't use backtick in password
In-Reply-To: <4c412e91-f490-44ee-872c-a07a2ff1d03d@googlegroups.com>
References: <f7f6cea2-2fc9-4783-9060-06427310ae5d@googlegroups.com>
	<4c412e91-f490-44ee-872c-a07a2ff1d03d@googlegroups.com>
Message-ID: <521367ED.8070406@rabbitmq.com>

On 20/08/13 08:12, Kal Sze wrote:
> After obtaining some help from the #bash channel on Freenode IRC, it
> appears that the correct fix would be to use proper string substitution
> in the rabbitmqctlscript:
>
> Replace this line:\
>      su rabbitmq -s /bin/sh -c "/usr/lib/rabbitmq/bin/${SCRIPT} ${CMDLINE}"
>
> With this line:
>      su rabbitmq -s /bin/sh -c 'script=$1; shift; "$script" "$@"' _
> "/usr/lib/rabbitmq/bin/${SCRIPT}" "$@"

Ah, thank you. We will stare carefully at this change, all the while 
cursing whoever invented string substitution in shell scripts... :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From swordangel at gmail.com  Tue Aug 20 14:06:21 2013
From: swordangel at gmail.com (Kal Sze)
Date: Tue, 20 Aug 2013 21:06:21 +0800
Subject: [rabbitmq-discuss] Can't use backtick in password
In-Reply-To: <521367ED.8070406@rabbitmq.com>
References: <f7f6cea2-2fc9-4783-9060-06427310ae5d@googlegroups.com>
	<4c412e91-f490-44ee-872c-a07a2ff1d03d@googlegroups.com>
	<521367ED.8070406@rabbitmq.com>
Message-ID: <CAGZiy71fgpE09e-fhBDQVDU0HCsn6L-ic8Xsd6fOGjk=T8pz8Q@mail.gmail.com>

Hello Simon,

Sorry. Maybe I was jumping to conclusions. It appears that the "fix"
is also broken in subtle ways. If I apply the fix and try this:

    $ sudo rabbitmqctl set_permissions -p foo foo ".*" ".*" ".*"

It would fail. I tried sticking a line of  `echo "$@"` in
/usr/lib/rabbitmq/bin/rabbitmqctl, right before the `exec` command.
Somehow the '-p' ends up getting dropped from $@. I don't really know
why.

So the only thing we are sure about is that the current rabbitmqctl
script in version 3.1.5 is broken for edge cases with special
characters in the password.

Best Regards,
Kal

On 20 August 2013 20:58, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 20/08/13 08:12, Kal Sze wrote:
>>
>> After obtaining some help from the #bash channel on Freenode IRC, it
>> appears that the correct fix would be to use proper string substitution
>> in the rabbitmqctlscript:
>>
>> Replace this line:\
>>      su rabbitmq -s /bin/sh -c "/usr/lib/rabbitmq/bin/${SCRIPT}
>> ${CMDLINE}"
>>
>> With this line:
>>      su rabbitmq -s /bin/sh -c 'script=$1; shift; "$script" "$@"' _
>> "/usr/lib/rabbitmq/bin/${SCRIPT}" "$@"
>
>
> Ah, thank you. We will stare carefully at this change, all the while cursing
> whoever invented string substitution in shell scripts... :-)
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Aug 20 14:08:59 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Aug 2013 14:08:59 +0100
Subject: [rabbitmq-discuss] Can't use backtick in password
In-Reply-To: <CAGZiy71fgpE09e-fhBDQVDU0HCsn6L-ic8Xsd6fOGjk=T8pz8Q@mail.gmail.com>
References: <f7f6cea2-2fc9-4783-9060-06427310ae5d@googlegroups.com>
	<4c412e91-f490-44ee-872c-a07a2ff1d03d@googlegroups.com>
	<521367ED.8070406@rabbitmq.com>
	<CAGZiy71fgpE09e-fhBDQVDU0HCsn6L-ic8Xsd6fOGjk=T8pz8Q@mail.gmail.com>
Message-ID: <52136A6B.4050800@rabbitmq.com>

On 20/08/13 14:06, Kal Sze wrote:
> Hello Simon,
>
> Sorry. Maybe I was jumping to conclusions. It appears that the "fix"
> is also broken in subtle ways. If I apply the fix and try this:
>
>      $ sudo rabbitmqctl set_permissions -p foo foo ".*" ".*" ".*"
>
> It would fail. I tried sticking a line of  `echo "$@"` in
> /usr/lib/rabbitmq/bin/rabbitmqctl, right before the `exec` command.
> Somehow the '-p' ends up getting dropped from $@. I don't really know
> why.
>
> So the only thing we are sure about is that the current rabbitmqctl
> script in version 3.1.5 is broken for edge cases with special
> characters in the password.

Thanks for the update. Oh well, more cursing then...

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From reaperman123456789 at gmail.com  Tue Aug 20 16:12:48 2013
From: reaperman123456789 at gmail.com (reaperman123456789 at gmail.com)
Date: Tue, 20 Aug 2013 08:12:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Routing through multiple dead-letter exchanges
Message-ID: <70165e37-459c-494d-8230-003a88ee3cad@googlegroups.com>

This is my setup:

I have an exchange named "live" with a queue named "livequeue" bound to it 
by routing key "msg", and another exchange named "deferred" with a queue 
named "deferredqueue" bound to it, also with routing key "msg".
"livequeue" has set the exchange "deferred" as dead-letter exchange and 
"msg" as dead-letter routing key, and "deferredqueue" has set a message TTL 
of 5 minutes, "live" as dead-letter exchange and "msg" as dead-letter 
routing key.
Messages are initially published to exchange "live" with routing key "msg" 
by a publisher, so they end up in queue "livequeue". Consumers will read 
from "livequeue" and either process and ack the message, or if they can't 
process it right away, reject it with requeue set to false. On rejection, 
the message will move to "deferredqueue" through the dead-letter exchange 
of "livequeue".
Everything works as expected up to this point. However, when the message 
TTL of "deferredqueue" is up, I expected the message to reappear again in 
"livequeue" via the dead-letter exchange of "deferredqueue", but the 
message is dropped instead.
If, however, I ack the message in "livequeue" and publish it to 
"deferredqueue" using basic_publish, instead of rejecting it, the message *
does* reappear in "livequeue"  after the TTL is over, as expected.

So my question is, is this the normal (intended) behavior, or am I doing 
something wrong? If this is the normal behavior, is there a way to change 
it by some exchange/queue/message property, so it will work as I initially 
planned?
This is *not* a request to change anything in RabbitMQ or AMQP, I just want 
to know how to handle this kind of thing properly.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/15e03a4f/attachment.htm>

From tim at rabbitmq.com  Tue Aug 20 16:37:34 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 20 Aug 2013 16:37:34 +0100
Subject: [rabbitmq-discuss] Routing through multiple dead-letter
	exchanges
In-Reply-To: <70165e37-459c-494d-8230-003a88ee3cad@googlegroups.com>
References: <70165e37-459c-494d-8230-003a88ee3cad@googlegroups.com>
Message-ID: <68AB98DC-BAE0-4BE7-93E1-73DE80BDD5AD@rabbitmq.com>

Hi,

On 20 Aug 2013, at 16:12, reaperman123456789 at gmail.com wrote:
> Everything works as expected up to this point. However, when the message TTL of "deferredqueue" is up, I expected the message to reappear again in "livequeue" via the dead-letter exchange of "deferredqueue", but the message is dropped instead.
> If, however, I ack the message in "livequeue" and publish it to "deferredqueue" using basic_publish, instead of rejecting it, the message does reappear in "livequeue"  after the TTL is over, as expected.
> 
> So my question is, is this the normal (intended) behavior, or am I doing something wrong? 

This is indeed normal/expected behaviour. Dead letter cycles that occur entirely due to expiry are removed, so if the TTL expiry initially occurred in 'livequeue' then when the message later expires in 'deferredqueue' it won't be delivered to 'livequeue' again.

> If this is the normal behavior, is there a way to change it by some exchange/queue/message property, so it will work as I initially planned?

That one I'm not so sure about. One way to handle this would be to use the shovel plugin to handle republishing messages once they expire in the 'deferredqueue', rather than attempting to use TTL + DLX in a cyclic configuration. Set up a third exchange + queue: 'repub-ex' and 'repub-queue'. Configure the DLX for the 'deferredqueue' to publish to the 'repub-ex'  exchange. Enable the shovel plugin and set up the 'repub-queue' as the source and the 'live' exchange as the destination. Once messages in the 'deferredqueue' expire, they will be delivered to the 'repub-ex' exchange and routed to the 'repub-queue', at which point the shovel will dequeue and ACK them, then publish them to the 'live' exchange once again. You can configure the shovel plugin to add a custom header to these messages to indicate that they're being republished, if that's something your client application needs to now. 

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/9926c0be/attachment.htm>

From alan.antonuk at gmail.com  Tue Aug 20 18:49:13 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 20 Aug 2013 10:49:13 -0700
Subject: [rabbitmq-discuss] rabbitmq-c use amqp_basic_ack(..., qwTag,
 ..) twice lead consumer lose
In-Reply-To: <1376964010105-28947.post@n5.nabble.com>
References: <1376902915165-28911.post@n5.nabble.com>
	<5211E07D.7080309@rabbitmq.com>
	<CAAt2poKe1Mqa+=kj-6_ynrEbXJiJVgKrdXbzKg_y1bB52n9HWw@mail.gmail.com>
	<1376964010105-28947.post@n5.nabble.com>
Message-ID: <CAAt2poK6Fz0fF=O6Q25UPbDitxoiX1rxfn=NyEWm_WzWq4wctA@mail.gmail.com>

Here's an example double-ack'ing a message:
https://github.com/alanxz/rabbitmq-c/blob/e7626673f7834aa59858347196c5f549759ccec3/examples/amqp_consumer.c

When you basic.ack a message twice, it will cause a channel-exception (a
channel.close method), and the channel will be closed.


On Mon, Aug 19, 2013 at 7:00 PM, 3k4b251 <314992959 at qq.com> wrote:

> I  did  a  test. try to  use amqp_basic_ack twice  after i got  the
>  message
> delivery_tag .    it's seems  like that  channel  still  alive,  consumer
> lose.  and  I  can still  receive  messages  from the same queue  without
> any consumer.   And  the durable  messages  can not  remove from queue by
> the amqp_basic_ack().  And  amqp_consume_message()  always  return
> AMQP_RESPONSE_NORMAL.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-use-amqp-basic-ack-qwTag-twice-lead-consumer-lose-tp28911p28947.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/7fcb7683/attachment.htm>

From mahi.rabbitmq at gmail.com  Tue Aug 20 18:51:41 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Tue, 20 Aug 2013 10:51:41 -0700
Subject: [rabbitmq-discuss] Shovel plugin
Message-ID: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>

Hi

I enabled shovel plugin and shovel management plugin but not able to see in
GUI interface ( shovel Tab).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/c437b9db/attachment.htm>

From mklishin at gopivotal.com  Tue Aug 20 18:54:00 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 Aug 2013 21:54:00 +0400
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
Message-ID: <55C20404-BEB5-4443-B8A3-E9F904091A7E@gopivotal.com>

mahi e:

> I enabled shovel plugin and shovel management plugin but not able to see in GUI interface ( shovel Tab).

Mahi,

Did you restart RabbitMQ after that? Do you see anything related to plugins in the log?

What does rabbitm-plugins list output?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/31c536ae/attachment.pgp>

From videlalvaro at gmail.com  Tue Aug 20 18:54:27 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 20 Aug 2013 19:54:27 +0200
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
Message-ID: <CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>

Did you restart the rabbitmq server afterwards?


On Tue, Aug 20, 2013 at 7:51 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:

> Hi
>
> I enabled shovel plugin and shovel management plugin but not able to see
> in GUI interface ( shovel Tab).
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/f4419511/attachment.htm>

From mahi.rabbitmq at gmail.com  Tue Aug 20 21:35:54 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Tue, 20 Aug 2013 13:35:54 -0700
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
Message-ID: <CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>

yes i enabled and restarted server

[E] rabbitmq_shovel                   3.1.3
[E] rabbitmq_shovel_management        3.1.3


On Tue, Aug 20, 2013 at 10:54 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Did you restart the rabbitmq server afterwards?
>
>
> On Tue, Aug 20, 2013 at 7:51 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:
>
>> Hi
>>
>> I enabled shovel plugin and shovel management plugin but not able to see
>> in GUI interface ( shovel Tab).
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/74512af4/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 20 22:23:55 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 Aug 2013 22:23:55 +0100
Subject: [rabbitmq-discuss] Routing through multiple dead-letter
	exchanges
In-Reply-To: <68AB98DC-BAE0-4BE7-93E1-73DE80BDD5AD@rabbitmq.com>
References: <70165e37-459c-494d-8230-003a88ee3cad@googlegroups.com>
	<68AB98DC-BAE0-4BE7-93E1-73DE80BDD5AD@rabbitmq.com>
Message-ID: <5213DE6B.70902@rabbitmq.com>

On 20/08/13 16:37, Tim Watson wrote:
> Hi,
>
> On 20 Aug 2013, at 16:12, reaperman123456789 at gmail.com
> <mailto:reaperman123456789 at gmail.com> wrote:
>> Everything works as expected up to this point. However, when the
>> message TTL of "deferredqueue" is up, I expected the message to
>> reappear again in "livequeue" via the dead-letter exchange of
>> "deferredqueue", but the message is dropped instead.
>> If, however, I ack the message in "livequeue" and publish it to
>> "deferredqueue" using basic_publish, instead of rejecting it, the
>> message /does/ reappear in "livequeue"  after the TTL is over, as
>> expected.
>>
>> So my question is, is this the normal (intended) behavior, or am I
>> doing something wrong?
>
> This is indeed normal/expected behaviour. Dead letter cycles that occur
> entirely due to expiry are removed, so if the TTL expiry initially
> occurred in 'livequeue' then when the message later expires in
> 'deferredqueue' it won't be delivered to 'livequeue' again.

But in the OPs example, the initial dead-lettering from livequeue is not 
due to TTL but a reject. So there is no TTL-only cycle and hence the 
message should be re-delivered to livequeue.

The cycle detection used to be stricter though prior to 3.1.0. Perhaps 
the OP is running an older version?

Matthias.

From daniel.bason at telogis.com  Tue Aug 20 22:28:50 2013
From: daniel.bason at telogis.com (Dan_b)
Date: Tue, 20 Aug 2013 14:28:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Recover messages from corrupted persister log
	RabbitMQ 1.7.2
Message-ID: <1377034130280-28972.post@n5.nabble.com>

Hi List,

We have an old version of rabbit running (we are in the process of
upgrading) - 1.7.2.  RabbitMQ crashed with an out of memory error and the
persister log got corrupted.  We have moved it out to get the server up and
running again, but is there anyway to recover messages from this?

Regards
Dan



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Recover-messages-from-corrupted-persister-log-RabbitMQ-1-7-2-tp28972.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Aug 20 22:40:02 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 Aug 2013 01:40:02 +0400
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
	<CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>
Message-ID: <CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>

mahi e:

> yes i enabled and restarted server 
> 
> [E] rabbitmq_shovel                   3.1.3
> [E] rabbitmq_shovel_management        3.1.3

Can you post a UI screenshot that demonstrates the issue?
Is there anything that looks suspicious in the log?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130821/773de72f/attachment.pgp>

From mklishin at gopivotal.com  Tue Aug 20 22:47:47 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 Aug 2013 01:47:47 +0400
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
	<CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>
	<CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>
Message-ID: <11F73E19-222A-401C-B13E-25FB468C2A4E@gopivotal.com>

Michael Klishin:

> Can you post a UI screenshot that demonstrates the issue?

I just tried enabling rabbitmq_shovel_management and I see Shovel status
under the Admin tab:

https://www.monosnap.com/image/pbshrbuhl9GQ9IwaIltvEhxeY
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130821/56feba03/attachment.pgp>

From mahi.rabbitmq at gmail.com  Wed Aug 21 01:32:36 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Tue, 20 Aug 2013 17:32:36 -0700
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <11F73E19-222A-401C-B13E-25FB468C2A4E@gopivotal.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
	<CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>
	<CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>
	<11F73E19-222A-401C-B13E-25FB468C2A4E@gopivotal.com>
Message-ID: <CAGOpLV4Beq6KTN4W0JNS6PWqGWLCxAGAn_obmgeXYpWfDmiMFw@mail.gmail.com>

[image: Inline image 1]



There is no shovel tab


On Tue, Aug 20, 2013 at 2:47 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Michael Klishin:
>
> > Can you post a UI screenshot that demonstrates the issue?
>
> I just tried enabling rabbitmq_shovel_management and I see Shovel status
> under the Admin tab:
>
> https://www.monosnap.com/image/pbshrbuhl9GQ9IwaIltvEhxeY
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/7a69c8a1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 13794 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/7a69c8a1/attachment.png>

From mahi.rabbitmq at gmail.com  Wed Aug 21 01:34:13 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Tue, 20 Aug 2013 17:34:13 -0700
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CAGOpLV4Beq6KTN4W0JNS6PWqGWLCxAGAn_obmgeXYpWfDmiMFw@mail.gmail.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
	<CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>
	<CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>
	<11F73E19-222A-401C-B13E-25FB468C2A4E@gopivotal.com>
	<CAGOpLV4Beq6KTN4W0JNS6PWqGWLCxAGAn_obmgeXYpWfDmiMFw@mail.gmail.com>
Message-ID: <CAGOpLV7jwOy1Ta36eYA6G2QMB46sMpXGrZCe+NDAUV5YyAoZ_Q@mail.gmail.com>

no errosr in logfiles



On Tue, Aug 20, 2013 at 5:32 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:

> [image: Inline image 1]
>
>
>
> There is no shovel tab
>
>
> On Tue, Aug 20, 2013 at 2:47 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>
>> Michael Klishin:
>>
>> > Can you post a UI screenshot that demonstrates the issue?
>>
>> I just tried enabling rabbitmq_shovel_management and I see Shovel status
>> under the Admin tab:
>>
>> https://www.monosnap.com/image/pbshrbuhl9GQ9IwaIltvEhxeY
>> --
>> MK
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/41180349/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 13794 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/41180349/attachment.png>

From michael.laing at nytimes.com  Wed Aug 21 01:38:09 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 20 Aug 2013 20:38:09 -0400
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CAGOpLV7jwOy1Ta36eYA6G2QMB46sMpXGrZCe+NDAUV5YyAoZ_Q@mail.gmail.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
	<CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>
	<CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>
	<11F73E19-222A-401C-B13E-25FB468C2A4E@gopivotal.com>
	<CAGOpLV4Beq6KTN4W0JNS6PWqGWLCxAGAn_obmgeXYpWfDmiMFw@mail.gmail.com>
	<CAGOpLV7jwOy1Ta36eYA6G2QMB46sMpXGrZCe+NDAUV5YyAoZ_Q@mail.gmail.com>
Message-ID: <CAKgmDnGDmy-gAs6GKWuaeKFZF3304JmL86dMVPLK1B5d9rLSfw@mail.gmail.com>

try clicking on the admin tab - the screen shot shows the overview.


On Tue, Aug 20, 2013 at 8:34 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:

> no errosr in logfiles
>
>
>
> On Tue, Aug 20, 2013 at 5:32 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:
>
>> [image: Inline image 1]
>>
>>
>>
>> There is no shovel tab
>>
>>
>> On Tue, Aug 20, 2013 at 2:47 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>>
>>> Michael Klishin:
>>>
>>> > Can you post a UI screenshot that demonstrates the issue?
>>>
>>> I just tried enabling rabbitmq_shovel_management and I see Shovel status
>>> under the Admin tab:
>>>
>>> https://www.monosnap.com/image/pbshrbuhl9GQ9IwaIltvEhxeY
>>> --
>>> MK
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/1bb76731/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 13794 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/1bb76731/attachment.png>

From vikram.vis at gmail.com  Wed Aug 21 02:07:48 2013
From: vikram.vis at gmail.com (Vikram Viswanathan)
Date: Tue, 20 Aug 2013 18:07:48 -0700
Subject: [rabbitmq-discuss] Message filtering
Message-ID: <521412E4.90005@gmail.com>

Hi,
     I have a requirement where my rabbitmq consumer needs to receive 
messages from a single queue based on a certain filtering criteria. 
Something like a jms, where I can create a consumer based  header 
property of messages.

    I do not want this to be done by exchange routing key, because this 
can mandate creating a large number of queues(I can possibly have a 
million routing keys)

    Is there a way to do it?

    BTW, How much memory is allocated for each durable queue created in 
the server ? Is there a way to tune this parameter ?

Thanks,
-Vikram


From goyalk at vmware.com  Wed Aug 21 02:11:10 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Tue, 20 Aug 2013 18:11:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CAKgmDnGDmy-gAs6GKWuaeKFZF3304JmL86dMVPLK1B5d9rLSfw@mail.gmail.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>	<CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>	<CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>	<11F73E19-222A-401C-B13E-25FB468C2A4E@gopivotal.com>	<CAGOpLV4Beq6KTN4W0JNS6PWqGWLCxAGAn_obmgeXYpWfDmiMFw@mail.gmail.com>	<CAGOpLV7jwOy1Ta36eYA6G2QMB46sMpXGrZCe+NDAUV5YyAoZ_Q@mail.gmail.com>
	<CAKgmDnGDmy-gAs6GKWuaeKFZF3304JmL86dMVPLK1B5d9rLSfw@mail.gmail.com>
Message-ID: <29c688a0.000002d4.0000001d@KAPILPC.vmware.com>

Mahi,



Did you try logging out of management portal and logging back in?



I have noticed this with tracing plugin, where I?ll not see the tracing tab 
until and re-login (after a rabbitmq restart as well of course).



Thanks
Kapil



From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Laing, 
Michael
Sent: Tuesday, August 20, 2013 5:38 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovel plugin



try clicking on the admin tab - the screen shot shows the overview.



On Tue, Aug 20, 2013 at 8:34 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:

no errosr in logfiles





On Tue, Aug 20, 2013 at 5:32 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:

Inline image 1







There is no shovel tab



On Tue, Aug 20, 2013 at 2:47 PM, Michael Klishin <mklishin at gopivotal.com> 
wrote:

Michael Klishin:


> Can you post a UI screenshot that demonstrates the issue?

I just tried enabling rabbitmq_shovel_management and I see Shovel status
under the Admin tab:

https://www.monosnap.com/image/pbshrbuhl9GQ9IwaIltvEhxeY
--
MK



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss






_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/9f5c7fb7/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 13794 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/9f5c7fb7/attachment.png>

From swordangel at gmail.com  Wed Aug 21 03:52:00 2013
From: swordangel at gmail.com (Kal Sze)
Date: Tue, 20 Aug 2013 19:52:00 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ server not listening to default AMQP
	port
Message-ID: <fa46e2f7-363c-49b7-99c0-1022af26c34f@googlegroups.com>

Hello,

I installed RabbitMQ 3.1.5 on Ubuntu 12.04, using the rabbitmq.com apt 
repository. Somehow it seems that it is not listening to the default AMQP 
port on IPv4 interfaces, only on IPv6, even though I don't have a 
rabbitmq-env.conf file defined. Instead, a random IPv4 port is picked every 
time the RabbitMQ server is started:

    $ sudo netstat -lnp | grep beam
    tcp        0      0 0.0.0.0:52905           0.0.0.0:*               
LISTEN      16239/beam
    tcp6       0      0 :::5672                 :::*                   
 LISTEN      16239/beam
    $ sudo service rabbitmq-server restart
     * Restarting message broker rabbitmq-server                           
             [ OK ]
    $ sudo netstat -lnp | grep beam
    tcp        0      0 0.0.0.0:39405           0.0.0.0:*               
LISTEN      9432/beam
    tcp6       0      0 :::5672                 :::*                   
 LISTEN      9432/beam

Is that supposed to be a bug?

Best Regards,
Kal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/31a8f9fa/attachment.htm>

From mahi.rabbitmq at gmail.com  Wed Aug 21 04:32:21 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Tue, 20 Aug 2013 20:32:21 -0700
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <29c688a0.000002d4.0000001d@KAPILPC.vmware.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
	<CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>
	<CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>
	<11F73E19-222A-401C-B13E-25FB468C2A4E@gopivotal.com>
	<CAGOpLV4Beq6KTN4W0JNS6PWqGWLCxAGAn_obmgeXYpWfDmiMFw@mail.gmail.com>
	<CAGOpLV7jwOy1Ta36eYA6G2QMB46sMpXGrZCe+NDAUV5YyAoZ_Q@mail.gmail.com>
	<CAKgmDnGDmy-gAs6GKWuaeKFZF3304JmL86dMVPLK1B5d9rLSfw@mail.gmail.com>
	<29c688a0.000002d4.0000001d@KAPILPC.vmware.com>
Message-ID: <CAGOpLV7h==ut6s6wiCSW+Jct2-GXH2rD9988vwU=QDO+Z4xewg@mail.gmail.com>

Hi

now only i enabled tracing plugin ( not familiar with tracing)  , Yes i
tired logging out ,

[image: Inline image 1]


On Tue, Aug 20, 2013 at 6:11 PM, Kapil Goyal <goyalk at vmware.com> wrote:

> Mahi,****
>
> ** **
>
> Did you try logging out of management portal and logging back in?****
>
> ** **
>
> I have noticed this with tracing plugin, where I?ll not see the tracing
> tab until and re-login (after a rabbitmq restart as well of course).****
>
> ** **
>
> Thanks
> Kapil****
>
> ** **
>
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Laing, Michael
> *Sent:* Tuesday, August 20, 2013 5:38 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Shovel plugin****
>
> ** **
>
> try clicking on the admin tab - the screen shot shows the overview.****
>
> ** **
>
> On Tue, Aug 20, 2013 at 8:34 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:**
> **
>
> no errosr in logfiles****
>
> ** **
>
> ** **
>
> On Tue, Aug 20, 2013 at 5:32 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:**
> **
>
> [image: Inline image 1]****
>
> ** **
>
> ** **
>
> ** **
>
> There is no shovel tab****
>
> ** **
>
> On Tue, Aug 20, 2013 at 2:47 PM, Michael Klishin <mklishin at gopivotal.com>
> wrote:****
>
> Michael Klishin:****
>
>
> > Can you post a UI screenshot that demonstrates the issue?****
>
> I just tried enabling rabbitmq_shovel_management and I see Shovel status
> under the Admin tab:
>
> https://www.monosnap.com/image/pbshrbuhl9GQ9IwaIltvEhxeY
> --
> MK
>
> ****
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
> ** **
>
> ** **
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/2d07af91/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 13794 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/2d07af91/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 26793 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/2d07af91/attachment-0001.png>

From daniel.bason at telogis.com  Wed Aug 21 05:36:14 2013
From: daniel.bason at telogis.com (Dan_b)
Date: Tue, 20 Aug 2013 21:36:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue mirroring policy ordering
Message-ID: <1377059774859-28982.post@n5.nabble.com>

Hi guys,

Sorry about the spate of questions, but I've just recently started managing
a rabbitmq environment and been tasking with upgrading and scaling from a
single node to multiple with mirorring.

For scaling we would like to move some of our queues to additional
master/slave pairs using a nodes policy.  My question is how is the order of
those policies interpreted?  Could we have a policy for specific queues and
then have a catch all policy (using a .* for example) to mirror the
remaining queues?  Should the more specific policy come first or last?

Cheers
Dan



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Queue-mirroring-policy-ordering-tp28982.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From sr.aathithyan at outlook.com  Wed Aug 21 06:12:56 2013
From: sr.aathithyan at outlook.com (Aathithyan SR)
Date: Wed, 21 Aug 2013 05:12:56 +0000
Subject: [rabbitmq-discuss] Reg:Heart Beat Lost
Message-ID: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>

Hi,
What is the reason for Heartbeat lost can any one explain about it?I need a solution for avoiding the heartbeat lost kindly do the needful Thanks in advance
Thanks & Regards,Aathithyan S R 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130821/af13182a/attachment.htm>

From matthias at rabbitmq.com  Wed Aug 21 06:43:48 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Aug 2013 06:43:48 +0100
Subject: [rabbitmq-discuss] Shovel plugin
In-Reply-To: <CAGOpLV7h==ut6s6wiCSW+Jct2-GXH2rD9988vwU=QDO+Z4xewg@mail.gmail.com>
References: <CAGOpLV7Odq4qTm1rWB2Pnu5smuqh+Qrpm=4nK2iVeGD6-G77jw@mail.gmail.com>
	<CAMcAHLWrDtMoOP9=ejvFJnnMu+Fv9E6KB0vCAaaaSd6SiRO5AQ@mail.gmail.com>
	<CAGOpLV6V4RLBVw+A2yP5NrxzsqWOX0h4DCwynfze2jn3pb_fng@mail.gmail.com>
	<CEFEDDCD-E8C7-42EC-868C-195B7DBFA02A@gopivotal.com>
	<11F73E19-222A-401C-B13E-25FB468C2A4E@gopivotal.com>
	<CAGOpLV4Beq6KTN4W0JNS6PWqGWLCxAGAn_obmgeXYpWfDmiMFw@mail.gmail.com>
	<CAGOpLV7jwOy1Ta36eYA6G2QMB46sMpXGrZCe+NDAUV5YyAoZ_Q@mail.gmail.com>
	<CAKgmDnGDmy-gAs6GKWuaeKFZF3304JmL86dMVPLK1B5d9rLSfw@mail.gmail.com>
	<29c688a0.000002d4.0000001d@KAPILPC.vmware.com>
	<CAGOpLV7h==ut6s6wiCSW+Jct2-GXH2rD9988vwU=QDO+Z4xewg@mail.gmail.com>
Message-ID: <52145394.1080404@rabbitmq.com>

On 21/08/13 04:32, mahi e wrote:
> now only i enabled tracing plugin ( not familiar with tracing)  , Yes i
> tired logging out ,
>
> Inline image 1

In that screenshot you can see the 'Shovel Status' in the right-hand 
side navigation, just below Tracing.

Matthias.

From mklishin at gopivotal.com  Wed Aug 21 09:23:22 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 Aug 2013 12:23:22 +0400
Subject: [rabbitmq-discuss] Reg:Heart Beat Lost
In-Reply-To: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>
References: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>
Message-ID: <76B9E19F-5213-4693-B899-E5A7FEB5EE62@gopivotal.com>

Aathithyan SR:

> What is the reason for Heartbeat lost can any one explain about it?

A peer (either a client or RabbitMQ node) did not notify another peer for
2 subsequent time intervals.

> I need a solution for avoiding the heartbeat lost kindly do the needful 

Make sure that your client supports heartbeats and enable them. Publishing
a message or issuing any protocol command counts for heartbeats, too.

Note that missing heartbeats can happen for a legitimate reason, e.g.
a network failure or a firewall somewhere between RabbitMQ and a client
dropping "inactive" TCP connections.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130821/2625f97a/attachment.pgp>

From emile at rabbitmq.com  Wed Aug 21 10:05:53 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 21 Aug 2013 10:05:53 +0100
Subject: [rabbitmq-discuss] Message filtering
In-Reply-To: <521412E4.90005@gmail.com>
References: <521412E4.90005@gmail.com>
Message-ID: <521482F1.5040304@rabbitmq.com>


Hi,

On 21/08/13 02:07, Vikram Viswanathan wrote:
> I have a requirement where my rabbitmq consumer needs to receive 
> messages from a single queue based on a certain filtering criteria. 
> Something like a jms, where I can create a consumer based header 
> property of messages.

RabbitMQ does not support queue filtering. Messages can only be
retrieved from the head of the queue. The idea of retrieving all the
messages from a queue and rejecting non-matches is explicitly
discouraged in the protocol specification.

> I do not want this to be done by exchange routing key, because this 
> can mandate creating a large number of queues(I can possibly have a 
> million routing keys)
> 
> Is there a way to do it?

If you don't want a queue for each possible routing key you could aim
for an intermediate granularity. Or partition consumers by capability,
create a queue per partition and route messages according to the
capabilities required for processing.

> BTW, How much memory is allocated for each durable queue created in 
> the server ? Is there a way to tune this parameter ?

You can limit the memory a queue is likely to need by limiting the
length of the queue or the time that messages may spend in the queue:

http://www.rabbitmq.com/maxlength.html
http://www.rabbitmq.com/ttl.html





-Emile







From simon at rabbitmq.com  Wed Aug 21 10:09:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Aug 2013 10:09:24 +0100
Subject: [rabbitmq-discuss] Queue mirroring policy ordering
In-Reply-To: <1377059774859-28982.post@n5.nabble.com>
References: <1377059774859-28982.post@n5.nabble.com>
Message-ID: <521483C4.6070008@rabbitmq.com>

Policies can be given an optional priority (if you don't specify it the 
default is 0, it can be any integer). Highest priority wins. If two 
policies with the same priority match, the choice is arbitrary.

Cheers, Simon

On 21/08/13 05:36, Dan_b wrote:
> Hi guys,
>
> Sorry about the spate of questions, but I've just recently started managing
> a rabbitmq environment and been tasking with upgrading and scaling from a
> single node to multiple with mirorring.
>
> For scaling we would like to move some of our queues to additional
> master/slave pairs using a nodes policy.  My question is how is the order of
> those policies interpreted?  Could we have a policy for specific queues and
> then have a catch all policy (using a .* for example) to mirror the
> remaining queues?  Should the more specific policy come first or last?
>
> Cheers
> Dan
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Queue-mirroring-policy-ordering-tp28982.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Aug 21 10:11:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Aug 2013 10:11:31 +0100
Subject: [rabbitmq-discuss] Recover messages from corrupted persister
 log RabbitMQ 1.7.2
In-Reply-To: <1377034130280-28972.post@n5.nabble.com>
References: <1377034130280-28972.post@n5.nabble.com>
Message-ID: <52148443.8000605@rabbitmq.com>

Probably not I'm afraid. The persister was completely rewritten in 2.0.0 
and the author of the original version has left the team so I'm not sure 
we even have much knowledge left of how it used to work.

Cheers, Simon

On 20/08/13 22:28, Dan_b wrote:
> Hi List,
>
> We have an old version of rabbit running (we are in the process of
> upgrading) - 1.7.2.  RabbitMQ crashed with an out of memory error and the
> persister log got corrupted.  We have moved it out to get the server up and
> running again, but is there anyway to recover messages from this?
>
> Regards
> Dan
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Recover-messages-from-corrupted-persister-log-RabbitMQ-1-7-2-tp28972.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Wed Aug 21 10:12:54 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 21 Aug 2013 10:12:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ server not listening to default
 AMQP port
In-Reply-To: <fa46e2f7-363c-49b7-99c0-1022af26c34f@googlegroups.com>
References: <fa46e2f7-363c-49b7-99c0-1022af26c34f@googlegroups.com>
Message-ID: <52148496.6060205@rabbitmq.com>


Hi,

On 21/08/13 03:52, Kal Sze wrote:

>     tcp        0      0 0.0.0.0:39405           0.0.0.0:*              
> LISTEN      9432/beam

This is the Erlang distribution protocol port. For more details see
http://www.erlang.org/doc/apps/erts/erl_dist_protocol.html
You should see the same port number on the output of "epmd -names"

>     tcp6       0      0 :::5672                 :::*                  
>  LISTEN      9432/beam

The broker attempts to detect dual stacks during boot and starts network
listeners accordingly. You should be able to access the broker via IPv4
or IPv6 with a default config.


-Emile

From simon at rabbitmq.com  Wed Aug 21 10:20:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Aug 2013 10:20:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ server not listening to default
 AMQP port
In-Reply-To: <52148496.6060205@rabbitmq.com>
References: <fa46e2f7-363c-49b7-99c0-1022af26c34f@googlegroups.com>
	<52148496.6060205@rabbitmq.com>
Message-ID: <52148658.1030605@rabbitmq.com>

On 21/08/13 10:12, Emile Joubert wrote:
> The broker attempts to detect dual stacks during boot and starts network
> listeners accordingly. You should be able to access the broker via IPv4
> or IPv6 with a default config.

Just to expand on this: Linux (by default) treats IPv4 as a special case 
of IPv6, so by listening on all IPv6 addresses we are also listening on 
all IPv4 ones.

Other OSes can behave differently. For further reading, the comment at 
http://hg.rabbitmq.com/rabbitmq-server/file/69052cb42a4b/src/rabbit_networking.erl#l389 
might be interesting.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Wed Aug 21 11:11:56 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 Aug 2013 14:11:56 +0400
Subject: [rabbitmq-discuss] ANN HotBunnies 2.0.0.pre11 is released
Message-ID: <F2D72899-F604-4222-BF9D-0FE8392E14A6@gopivotal.com>

HotBunnies [1] is a fast, easy to use JRuby client for RabbitMQ.

2.0.0.pre11 [2] is a development release that changes how deliveries are
dispatched to consumers. It has minor breaking API changes.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/08/21/hotbunnies-2-dot-0-0-dot-pre11-is-released/

The next release will likely be 2.0.0.rc1, so if you use HotBunnies, it's a good
idea to give this version a try.

Kudos to Theo Hultberg for contributing a lot of thoughtful feedback
(and code) to this release.

1. http://hotbunnies.info
2. https://rubygems.org/gems/hot_bunnies/versions/2.0.0.pre11-java
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130821/b0c70573/attachment.pgp>

From stuff at moesel.net  Wed Aug 21 12:52:32 2013
From: stuff at moesel.net (Chris)
Date: Wed, 21 Aug 2013 07:52:32 -0400
Subject: [rabbitmq-discuss] Message filtering
In-Reply-To: <521482F1.5040304@rabbitmq.com>
References: <521412E4.90005@gmail.com>
	<521482F1.5040304@rabbitmq.com>
Message-ID: <CAHEpgBAEVBZPvZk9qagNYX5eo8j59hJXZ_jb=Bmhr4XuO-xQ5Q@mail.gmail.com>

By the way, I apologize if you already know this, but you *can* have
multiple bindings on a queue.  So using routing keys wouldn't necessarily
imply a large number of queues.  In regards to memory, bindings do have a
memory footprint on the server, but if I recall, it is pretty small.

-Chris


On Wed, Aug 21, 2013 at 5:05 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 21/08/13 02:07, Vikram Viswanathan wrote:
> > I have a requirement where my rabbitmq consumer needs to receive
> > messages from a single queue based on a certain filtering criteria.
> > Something like a jms, where I can create a consumer based header
> > property of messages.
>
> RabbitMQ does not support queue filtering. Messages can only be
> retrieved from the head of the queue. The idea of retrieving all the
> messages from a queue and rejecting non-matches is explicitly
> discouraged in the protocol specification.
>
> > I do not want this to be done by exchange routing key, because this
> > can mandate creating a large number of queues(I can possibly have a
> > million routing keys)
> >
> > Is there a way to do it?
>
> If you don't want a queue for each possible routing key you could aim
> for an intermediate granularity. Or partition consumers by capability,
> create a queue per partition and route messages according to the
> capabilities required for processing.
>
> > BTW, How much memory is allocated for each durable queue created in
> > the server ? Is there a way to tune this parameter ?
>
> You can limit the memory a queue is likely to need by limiting the
> length of the queue or the time that messages may spend in the queue:
>
> http://www.rabbitmq.com/maxlength.html
> http://www.rabbitmq.com/ttl.html
>
>
>
>
>
> -Emile
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130821/af3a8c02/attachment.htm>

From jandres at omie.es  Wed Aug 21 13:21:30 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Wed, 21 Aug 2013 12:21:30 +0000
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <5211C473.3060903@rabbitmq.com>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
	<520A334A.9030005@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2B29@EXCHG01-OM.omel.es>
	<5211C473.3060903@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A3258@EXCHG01-OM.omel.es>

Thank you again.

Today I have installed the last version of RabbitMQ (3.1.5), but I have the same problem (I had the 3.1.4 version before).

I don't see what you say in the logs. This is the complete log of:

---------------------------------------------------------------------------------------------------------------------------
=INFO REPORT==== 21-Aug-2013::14:16:36 ===
Starting RabbitMQ 3.1.5 on Erlang R16B01
Copyright (C) 2007-2013 GoPivotal, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 21-Aug-2013::14:16:36 ===
node           : rabbit at NWSCC01-PRB
home dir       : C:\Windows
cookie hash    : OgkcvIercV6wE+clHwQEMA==
log            : E:/Logs/rabbitmq/rabbit at NWSCC01-PRB.log
sasl log       : E:/Logs/rabbitmq/rabbit at NWSCC01-PRB-sasl.log
database dir   : c:/Users/serv_wm/AppData/Roaming/RabbitMQ/db/rabbit at NWSCC01-PRB-mnesia

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
Limiting to approx 8092 file handles (7280 sockets)

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
Memory limit set to 3276MB of 8191MB total.

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
Disk free limit set to 1000MB

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
started SSL Listener on [::]:5671

=INFO REPORT==== 21-Aug-2013::14:16:40 ===
started SSL Listener on 0.0.0.0:5671

=INFO REPORT==== 21-Aug-2013::14:16:41 ===
Management plugin started. Port: 15672

=INFO REPORT==== 21-Aug-2013::14:16:41 ===
Statistics database started.

=INFO REPORT==== 21-Aug-2013::14:16:41 ===
Server startup complete; 7 plugins started.
 * amqp_client
 * mochiweb
 * rabbitmq_auth_backend_ldap
 * rabbitmq_management
 * rabbitmq_management_agent
 * rabbitmq_web_dispatch
 * webmachine

=INFO REPORT==== 21-Aug-2013::14:17:17 ===
accepting AMQP connection <0.328.0> (194.224.33.160:51198 -> 194.224.33.245:5671)

=ERROR REPORT==== 21-Aug-2013::14:17:23 ===
closing AMQP connection <0.328.0> (194.224.33.160:51198 -> 194.224.33.245:5671):
{handshake_error,starting,0,
                 {amqp_error,access_refused,
                             "PLAIN login refused: rabbit_auth_backend_ldap failed authenticating userCC: \"connect failed\"\n",
                             'connection.start_ok'}}

=INFO REPORT==== 21-Aug-2013::14:17:24 ===
accepting AMQP connection <0.335.0> (194.224.33.160:51335 -> 194.224.33.245:5671)

=ERROR REPORT==== 21-Aug-2013::14:17:29 ===
closing AMQP connection <0.335.0> (194.224.33.160:51335 -> 194.224.33.245:5671):
{handshake_error,starting,0,
                 {amqp_error,access_refused,
                             "PLAIN login refused: rabbit_auth_backend_ldap failed authenticating userCC: \"connect failed\"\n",
                             'connection.start_ok'}}
---------------------------------------------------------------------------------------------------------------------------

And this is my rabbitmq.config:

---------------------------------------------------------------------------------------------------------------------------
[ 
	{rabbit, 
		[
			{ssl_listeners, [5671]}, 
			{ssl_options, [{cacertfile,"e:/RabbitMQ Server/certificados/ssl.ca/ca.cer"}, 
							{certfile,"e:/RabbitMQ Server/certificados/ssl.crt/apache.pem"}, 
							{keyfile,"e:/RabbitMQ Server/certificados/ssl.key/apache.pem"}, 
							{verify,verify_peer}, 
							{fail_if_no_peer_cert,true}, 
							{ssl_cert_login_from, common_name}, 
							{auth_mechanisms, ['EXTERNAL']}] 
			}, 
			{auth_backends, [rabbit_auth_backend_ldap]} 
		]
	}, 
	{rabbit_auth_backend_ldap, 
		[ 	{servers,               ["194.224.33.177"]}, 
			{port,                  389}, 
			{other_bind, {"UserXX", "PassXX"}}, 
			{user_dn_pattern,       "uid=${username}"}, 
			{use_ssl,               false}, 
			{log,                   network} 
		] 
	} 
].
--------------------------------------------------------------------------------------------------------------------------------

I don't know what is happening.

Thank you!






-----Mensaje original-----
De: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Enviado el: lunes, 19 de agosto de 2013 9:09
Para: Discussions about RabbitMQ
CC: SAG - Jonathan Andr?s
Asunto: Re: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed

On 14/08/13 10:09, jandres wrote:
> I use Microsoft Network Monitor to get the traffic between the server 
> and the LDAP, but I can't see the traffic of the RabbitMQ LDAP Plugin. 
> I can see the traffic between Apache and the LDAP, but not between 
> RabbitMQ and LDAP.
> So, I think I have something wrong in my config file, buy I don't know 
> what.

Your config looks fine.

You didn't say what version of RabbitMQ you are running. In >=3.0.0, when the LDAP plug-in has been configured with network-level logging (as you have done in your config), the rabbit log file should contain entries for all connection attempts, looking like this:

LDAP connecting to servers: ["ldap-server"]

Do you see these in the logs?

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Aug 21 14:31:41 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Aug 2013 14:31:41 +0100
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A3258@EXCHG01-OM.omel.es>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
	<520A334A.9030005@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2B29@EXCHG01-OM.omel.es>
	<5211C473.3060903@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A3258@EXCHG01-OM.omel.es>
Message-ID: <5214C13D.9080004@rabbitmq.com>

On 21/08/13 13:21, SAG - Jonathan Andr?s wrote:
> Today I have installed the last version of RabbitMQ (3.1.5), but I
> have the same problem (I had the 3.1.4 version before).

Found the problem:

> {rabbit_auth_backend_ldap,

should be rabbitmq_auth_backend_ldap.

Terribly sorry about that; we really should have spotted this earlier.

Matthias.

From mcintoshj at gmail.com  Wed Aug 21 21:22:11 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 21 Aug 2013 15:22:11 -0500
Subject: [rabbitmq-discuss] Bug in 3.0.4,
 Fixed in current: Deleting virtual host does not delete policies in
 that VirtualHost
Message-ID: <CAD6m6fECSNSbh8jT_ypR=Zh3i+bbHNVPzVxXrTKJzMxd+AArrw@mail.gmail.com>

Couldn't find any place else to report this - thought I'd see if anyone
else had seen this.  Looks like it's fixed in 3.1.5 (tested against).  Just
reporting in case anyone else sees it :)

Jason

-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130821/9d1f4531/attachment.htm>

From matthias at rabbitmq.com  Wed Aug 21 21:31:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Aug 2013 21:31:10 +0100
Subject: [rabbitmq-discuss] Bug in 3.0.4,
 Fixed in current: Deleting virtual host does not delete policies in
 that VirtualHost
In-Reply-To: <CAD6m6fECSNSbh8jT_ypR=Zh3i+bbHNVPzVxXrTKJzMxd+AArrw@mail.gmail.com>
References: <CAD6m6fECSNSbh8jT_ypR=Zh3i+bbHNVPzVxXrTKJzMxd+AArrw@mail.gmail.com>
Message-ID: <5215238E.6000201@rabbitmq.com>

Jason,

On 21/08/13 21:22, Jason McIntosh wrote:
> Looks like it's fixed in 3.1.5 (tested against).

Really? We fixed that in 3.0.3. See 
https://www.rabbitmq.com/release-notes/README-3.0.3.txt:

"25456 ensure parameters and policies for a vhost are removed with that 
vhost"

So if you were really seeing that in 3.0.4 then something isn't right.

Matthias.

From randeep at pubnub.com  Wed Aug 21 22:56:47 2013
From: randeep at pubnub.com (Randeep Kang)
Date: Wed, 21 Aug 2013 14:56:47 -0700
Subject: [rabbitmq-discuss] PubNub Adapter to Enable Global Real-Time
	Delivery
Message-ID: <CAKuUpn66mUUg06Ov2XofzCGARN-=jD9E2jhGO4+5YtCU75Fiww@mail.gmail.com>

Greetings,

I'm a developer/evangelist with PubNub and I'm building an integration
framework/scaffolding using Java between RabbitMQ broker and our real-time
network.  We have been repeatedly asked if there are reference examples of
integrations with PubNub, and since no one has built one yet, I figured I'd
give it a shot.

PubNub is the leading real-time network that enables you to add real-time
functionality to your web properties.  We allow for broadcast and unicast
messaging as well as the core building blocks such as presence, history,
auth, api's, etc.  We're providing a global network that is distributed,
secure, fast, and reliable so folks can concentrate on their core
competencies with their apps and leave the build-out and operationalization
of a real-time delivery network to us.  Oh, and then you do not need to
worry about the headache of supporting large numbers of disparate devices
and corner cases such as mobile devices switching bands or catching up
after lost connections.  That's where PubNub shines.

There is some conceptual overlap between RabbitMQ and PubNub since we both
use the pub/sub model, but I'm not looking to displace RabbitMQ.  I am
thinking of ways to hook RabbitMQ into PubNub in order to offer new
capabilities that could not exist before.  I'd love to hear your feedback
on some of my ideas and also hear other real-world scenarios to highlight
in order to come up with a compelling and useful demo.

At a high-level, I am thinking of RabbitMQ behind the firewall, and PubNub
handling delivery in the cloud.   So imagine if a device behind the
corporate firewall produced a message to RabbitMQ.  My adapter would
consume this message from RabbitMQ, execute some business logic
(optionally), and then publish the message to PubNub's api.  At that point,
any device around the world subscribing to the appropriate PubNub channel
would receive the message within 250ms.  You would now have instant global
reach.

On the flip-side, a device can publish a message to PubNub, my adapter
behind the firewall would subscribe to this message, execute business logic
(optionally), and then produce a message to RabbitMQ.  You can then have
servers that consume these messages.  The beauty of this would be that the
producers and consumers would just speak to RabbitMQ in a very traditional
sense.

The kicker here is that you would gain the ability to not only reach a
worldwide audience across multiple device types, but you would also gain
the ability to communicate bi-directionally in real-time.  Enterprises
using RabbitMQ expect a certain level of resiliency, and I want to extend
that notion out into the cloud, where it was assumed to be either too
costly, complex, or just plain impossible.  And as far as scaling, you only
need to worry about your RabbitMQ deployment to handle message delivery
behind your firewall; you do not need to worry about scaling to handle
usage spikes or millions of connected devices.

I will follow up with more detailed use cases as the ideas come together.
 Eventually I'd like to publicize this project and obviously open it up to
the world to use/copy/share/extend.  In the meantime, if you have
real-world examples where you would have liked to extend RabbitMQ to reach
a global audience with real-time communication, please let me know and i
could try to highlight those scenarios.

thx,
randy kang
developer/evangelist
PubNub
randeep at pubnub.com
650-260-5264
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130821/8f1d2031/attachment.htm>

From wangjunbo924 at gmail.com  Thu Aug 22 04:15:59 2013
From: wangjunbo924 at gmail.com (Junius Wang)
Date: Thu, 22 Aug 2013 11:15:59 +0800
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
In-Reply-To: <1217501ce9425$026e58d0$074b0a70$@gmail.com>
References: <1217501ce9425$026e58d0$074b0a70$@gmail.com>
Message-ID: <062d01ce9ee5$f181d440$d4857cc0$@gmail.com>

I'm sorry to pick this email again because we really want to see any
comments from all of you.

The key point is that we try to prove the linear scaling of RabbitMQ high
availability queues but no lucky. What we see are that:

1.       The throughput of two node cluster is 50%-60% worse than a single
node broker.

2.       Adding more node did have improvement on throughput but we only got
25% improvement(throughput of 3 node cluster is 25% better than 2 node
cluster. 4 node cluster is 25% better than 3 node cluster too). What we
expected is a 45-degree line, that means when 2 nodes are used the
throughput is double. With 3 nodes, then triple.

 

Can anybody give any advice? What's the best practice in using RabbitMQ
mirror queues?

 

 

From: Junius Wang [mailto:wangjunbo924 at gmail.com] 
Sent: Thursday, August 08, 2013 6:50 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: questions about RabbitMQ linear scalability

 

Hi guys,

Our team are performing some performance tests and we try to prove that we
can get linear scalability of our services, it means when we add more
RabbitMQ nodes, the throughputs should increase as well.  We use RabbitMQ as
our backend message system. However, when we add more RabbitMQ servers to
cluster, the throughput decreases which is not expected and I would like to
ask for your help. Following are the details, any comments are appreciated.

 

We setup the our testing environment on AWS. All instances, including app
servers, RabbitMQ servers and Jmeter servers(host test tool Jmeter 2.7), are
of  type m1.xlarge(8ECUs, 4 Cores and 15Gib memory). For RabbitMQ servers,
"EBS optimized" are enabled, and the PIOPs are set to 2000 to improve the
disc read/write speed. There are two ELBs. One for App servers and the
another for RabbitMQ servers.  Here are some more environment
configurations:


Instances Type

m1.xlarge


connect pool size for App servers

40000


JVM args for App servers

-Xmx12G -Xms6G -XX:MaxPermSize=2G


App servers count

2


Jmeter servers

10


total concurrent users

4000


PIOPs for RabbitMQ Servers

2000


Consumer Prefetch Count

1000


message size

1KB


hipe_compile

FALSE

 

The designed topologic of broker:



1)      We create only one global topic exchange "events" to route all
incoming messages. It's durable.

2)      There will be an event log queue which receive all messages with
binding key "#". It's durable as well.

3)      There will be several queues for our external services and each
service queue may have several bindings to the global exchange which we
called eventypes.

Actually In our test scenarios,  we create only one service queue and only
one binding on this queue. Message publishers publish messages using the
only binding routing key.  So in fact, every message resides on two queues:
the event log queue and a test service queue. And all messages are
persistent.

 

We start with 1 single RabbitMQ node. And then run different configurations
with 2-RabbitMQ node cluster. For example ,1) change the node type 2)
enable/disable mirrored queues(also called high available queue, showed as
"ha" in the following tables). The test results shown as following:


configurations

Avg response time(ms)

Throughput(requests/sec)


1 rabbitmq node

1125

2702.904


2disc,ha

2957

1192.645


1disc+1ram,ha

3654

998.126


1disc+1ram,non-ha

1110

2799.826


 

1015

2720.422


2disc,non-ha

1289

2570.826


 

1080

2845.821


 

1118

2802.278

We can see that, while two rabbitmq servers are used, we see no throughput
improvement. This doesn't make sense to me. To my understanding,  Here comes
my questions:

1.       What does RabbitMQ cluster scalability means exactly? Does it refer
to the capacity of handing messages? The queue capacity? Or the message
number?

2.       The  mirrored queues seems to affect performance in a large scale.
What's the possible cause of this? 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/172471b1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 14245 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/172471b1/attachment.jpeg>

From jzhihui521 at gmail.com  Thu Aug 22 05:51:44 2013
From: jzhihui521 at gmail.com (Zhihui Jiao)
Date: Thu, 22 Aug 2013 12:51:44 +0800
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
In-Reply-To: <062d01ce9ee5$f181d440$d4857cc0$@gmail.com>
References: <1217501ce9425$026e58d0$074b0a70$@gmail.com>
	<062d01ce9ee5$f181d440$d4857cc0$@gmail.com>
Message-ID: <F1FF3B28-FB92-4051-9571-288271C3268D@gmail.com>

I don't think RabbitMQ will have linear scalability in any case(ha, non-ha):
In ha mode, message are broadcast to multiple nodes, so the more node you have, the worse performance you get 
if your setting is to ha all nodes int the cluster;
In non-ha mode, message data only reside in one queue on only one node, but queue meta are spread to all nodes
in the cluster, so if adding more nodes, you may got some performance improvement, but not linear improvement.

Zhihui Jiao

? 2013-8-22???11:15?Junius Wang <wangjunbo924 at gmail.com> ???

> I?m sorry to pick this email again because we really want to see any comments from all of you.
> The key point is that we try to prove the linear scaling of RabbitMQ high availability queues but no lucky. What we see are that:
> 1.       The throughput of two node cluster is 50%-60% worse than a single node broker.
> 2.       Adding more node did have improvement on throughput but we only got 25% improvement(throughput of 3 node cluster is 25% better than 2 node cluster. 4 node cluster is 25% better than 3 node cluster too). What we expected is a 45-degree line, that means when 2 nodes are used the throughput is double. With 3 nodes, then triple.
>  
> Can anybody give any advice? What?s the best practice in using RabbitMQ mirror queues?
>  
>  
> From: Junius Wang [mailto:wangjunbo924 at gmail.com] 
> Sent: Thursday, August 08, 2013 6:50 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: questions about RabbitMQ linear scalability
>  
> Hi guys,
> Our team are performing some performance tests and we try to prove that we can get linear scalability of our services, it means when we add more RabbitMQ nodes, the throughputs should increase as well.  We use RabbitMQ as our backend message system. However, when we add more RabbitMQ servers to cluster, the throughput decreases which is not expected and I would like to ask for your help. Following are the details, any comments are appreciated.
>  
> We setup the our testing environment on AWS. All instances, including app servers, RabbitMQ servers and Jmeter servers(host test tool Jmeter 2.7), are of  type m1.xlarge(8ECUs, 4 Cores and 15Gib memory). For RabbitMQ servers, ?EBS optimized? are enabled, and the PIOPs are set to 2000 to improve the disc read/write speed. There are two ELBs. One for App servers and the another for RabbitMQ servers.  Here are some more environment configurations:
> Instances Type
> m1.xlarge
> connect pool size for App servers
> 40000
> JVM args for App servers
> -Xmx12G -Xms6G -XX:MaxPermSize=2G
> App servers count
> 2
> Jmeter servers
> 10
> total concurrent users
> 4000
> PIOPs for RabbitMQ Servers
> 2000
> Consumer Prefetch Count
> 1000
> message size
> 1KB
> hipe_compile
> FALSE
>  
> The designed topologic of broker:
> <image001.jpg>
> 1)      We create only one global topic exchange ?events? to route all incoming messages. It?s durable.
> 2)      There will be an event log queue which receive all messages with binding key ?#?. It?s durable as well.
> 3)      There will be several queues for our external services and each service queue may have several bindings to the global exchange which we called eventypes.
> Actually In our test scenarios,  we create only one service queue and only one binding on this queue. Message publishers publish messages using the only binding routing key.  So in fact, every message resides on two queues: the event log queue and a test service queue. And all messages are persistent.
>  
> We start with 1 single RabbitMQ node. And then run different configurations with 2-RabbitMQ node cluster. For example ,1) change the node type 2) enable/disable mirrored queues(also called high available queue, showed as ?ha? in the following tables). The test results shown as following:
> configurations
> Avg response time(ms)
> Throughput(requests/sec)
> 1 rabbitmq node
> 1125
> 2702.904
> 2disc,ha
> 2957
> 1192.645
> 1disc+1ram,ha
> 3654
> 998.126
> 1disc+1ram,non-ha
> 1110
> 2799.826
>  
> 1015
> 2720.422
> 2disc,non-ha
> 1289
> 2570.826
>  
> 1080
> 2845.821
>  
> 1118
> 2802.278
> We can see that, while two rabbitmq servers are used, we see no throughput improvement. This doesn?t make sense to me. To my understanding,  Here comes my questions:
> 1.       What does RabbitMQ cluster scalability means exactly? Does it refer to the capacity of handing messages? The queue capacity? Or the message number?
> 2.       The  mirrored queues seems to affect performance in a large scale. What?s the possible cause of this?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/7bd45e06/attachment.htm>

From jandres at omie.es  Thu Aug 22 09:41:54 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Thu, 22 Aug 2013 08:41:54 +0000
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <5214C13D.9080004@rabbitmq.com>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
	<520A334A.9030005@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2B29@EXCHG01-OM.omel.es>
	<5211C473.3060903@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A3258@EXCHG01-OM.omel.es>
	<5214C13D.9080004@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A32B7@EXCHG01-OM.omel.es>

Thank you very much!

Now I can see the logs of the LDAP Plugin. But I think this directive is not working:

	{other_bind, {"UserXXX", "PassXXX"}},

Because I can?t see the UserXXX in the LDAP's log. This is the LDAP log when I use Apache (you can see that the UserXXX appears in the BIND dn):
----------------
[22/Aug/2013:10:22:36 +0200] conn=743 op=-1 msgId=-1 - fd=42 slot=42 LDAP connection from 194.224.33.245:54587 to 194.224.33.177
[22/Aug/2013:10:22:36 +0200] conn=743 op=0 msgId=1 - BIND dn=" UserXXX " method=128 version=3
[22/Aug/2013:10:22:36 +0200] conn=743 op=0 msgId=1 - RESULT err=0 tag=97 nentries=0 etime=0 dn=" UserXXX "
[22/Aug/2013:10:22:36 +0200] conn=743 op=1 msgId=2 - SRCH base="c=es" scope=2 filter="(&(userCertificate=*)(uid=DSISOFT2))" attrs="uid"
[22/Aug/2013:10:22:36 +0200] conn=743 op=1 msgId=2 - RESULT err=0 tag=101 nentries=1 etime=0
---------------

But this is the same log when I use RabbitMQ (the UserXXX doesn't appear):
---------------
[22/Aug/2013:10:15:34 +0200] conn=740 op=-1 msgId=-1 - fd=51 slot=51 LDAP connection from 194.224.33.245:54555 to 194.224.33.177
[22/Aug/2013:10:15:34 +0200] conn=740 op=0 msgId=1 - BIND dn="uid=DSISOFT2,ou=om,o=mycompany,c=ES" method=128 version=3
[22/Aug/2013:10:15:34 +0200] conn=740 op=0 msgId=1 - RESULT err=48 tag=97 nentries=0 etime=0
[22/Aug/2013:10:15:34 +0200] conn=740 op=1 msgId=0 - RESULT err=80 tag=120 nentries=0 etime=0
[22/Aug/2013:10:15:34 +0200] conn=740 op=-1 msgId=-1 - closing from 194.224.33.245:54555 - A1 - Client aborted connection -
[22/Aug/2013:10:15:34 +0200] conn=740 op=-1 msgId=-1 - closed.
---------------

I have tried with {other_bind, "anon"}, but doesn't work.

This is the RabbitMQ log:
--------------------------------------------------
=INFO REPORT==== 22-Aug-2013::10:15:34 ===
accepting AMQP connection <0.342.0> (194.224.33.160:47393 -> 194.224.33.245:5671)

=INFO REPORT==== 22-Aug-2013::10:15:34 ===
LDAP CHECK: login for DSISOFT2

=INFO REPORT==== 22-Aug-2013::10:15:34 ===
        LDAP filling template "uid=${username},ou=om,o=mycompany,c=ES" with
            [{username,<<"DSISOFT2">>}]

=INFO REPORT==== 22-Aug-2013::10:15:34 ===
        LDAP template result: "uid=DSISOFT2,ou=om,o=mycompany,c=ES"

=INFO REPORT==== 22-Aug-2013::10:15:34 ===
    LDAP connecting to servers: ["194.224.33.177"]

=INFO REPORT==== 22-Aug-2013::10:15:34 ===
    LDAP network traffic: bind request = {'BindRequest',3,
                                          "uid=DSISOFT2,ou=om,o=mycompany,c=ES",
                                          {simple,<<"guest">>}}

=INFO REPORT==== 22-Aug-2013::10:15:34 ===
    LDAP network traffic: bind reply = {ok,
                                        {'LDAPMessage',1,
                                         {bindResponse,
                                          {'BindResponse',
                                           inappropriateAuthentication,[],[],
                                           asn1_NOVALUE,asn1_NOVALUE}},
                                         asn1_NOVALUE}}

=INFO REPORT==== 22-Aug-2013::10:15:34 ===
    LDAP bind error: uid=DSISOFT2,ou=om,o=mycompany,c=ES inappropriateAuthentication

=INFO REPORT==== 22-Aug-2013::10:15:34 ===
LDAP DECISION: login for DSISOFT2: {error,inappropriateAuthentication}
--------------------------------------------------

And I have another question: Once the producer and the consumer are authenticated, can the consumer know who sent the message?

Thank you, thank you again!





-----Mensaje original-----
De: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Enviado el: mi?rcoles, 21 de agosto de 2013 15:32
Para: SAG - Jonathan Andr?s
CC: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed

On 21/08/13 13:21, SAG - Jonathan Andr?s wrote:
> Today I have installed the last version of RabbitMQ (3.1.5), but I 
> have the same problem (I had the 3.1.4 version before).

Found the problem:

> {rabbit_auth_backend_ldap,

should be rabbitmq_auth_backend_ldap.

Terribly sorry about that; we really should have spotted this earlier.

Matthias.

From valentin.polezhaev at gmail.com  Thu Aug 22 09:36:30 2013
From: valentin.polezhaev at gmail.com (Valentin Polezhaev)
Date: Thu, 22 Aug 2013 01:36:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
Message-ID: <672b9622-f88a-4198-8cb6-0d5a110d9ebc@googlegroups.com>

Hello,
I am new in Rabbit and I need to write consumer code which can 1) subscribe 
to queue with specified name, 2) recieve messages, 3) if another queue name 
is specified switch to new queue and start to recieve messages from it 4) 
go to step 2).

I use official .NET client and my code looks like:

\\consumer:

private string _currentQueue;

public T Consume(string queue)
{
    ...
    if (_currentQueue != queue)                
       Subscribe(queue);
    ... 
    var ea = (BasicDeliverEventArgs) _basicConsumer.Queue.Dequeue();
    ...               
}

private void Subscribe(string queue)
{
        _currentQueue = queue;
        if (_basicConsumer.IsRunning)
        {                
            _channel.BasicCancel(_basicConsumer.ConsumerTag);               
 
            _basicConsumer = new QueueingBasicConsumer(_channel) { 
ConsumerTag = GetNewTag()};
         }
         _channel.BasicConsume(_currentQueue, false, _basicConsumer);
}

For example I have 2 queues ("A", "B") with 2 messages in each and I 
consume in A-B-A-B order.
My code successfully reads first messages from both A and B queues, but 
third time (second read from A) it stays at line
var ea = (BasicDeliverEventArgs) _basicConsumer.Queue.Dequeue();
and nothing happens.

Moreover it'is strange that via control panel I can see 2 unacked messages 
in both A and B queues. Corresponding to program beheaviour I can 
understand unacked message in A queue but not in B - second consuming from 
B was not started yet.

Please, tell me the best way to do this.

I consider that simple reconnection will solve my problem, but seems it's a 
bad practice.

Thanks a lot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/da54876e/attachment.htm>

From mklishin at gopivotal.com  Thu Aug 22 09:51:21 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 12:51:21 +0400
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
In-Reply-To: <F1FF3B28-FB92-4051-9571-288271C3268D@gmail.com>
References: <1217501ce9425$026e58d0$074b0a70$@gmail.com>
	<062d01ce9ee5$f181d440$d4857cc0$@gmail.com>
	<F1FF3B28-FB92-4051-9571-288271C3268D@gmail.com>
Message-ID: <BA93A700-4DAC-4183-883B-F0CF2C2DAB57@gopivotal.com>

Zhihui Jiao:

> In ha mode, message are broadcast to multiple nodes, so the more node you have, the worse performance you get 
> if your setting is to ha all nodes int the cluster;

But you don't have to set it to all nodes, it can be a subset.

> In non-ha mode, message data only reside in one queue on only one node, but queue meta are spread to all nodes
> in the cluster, so if adding more nodes, you may got some performance improvement, but not linear improvement.

You will get roughly linear improvement if you use more queues instead of using a single
queue.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/934260cb/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug 22 09:56:15 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 12:56:15 +0400
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
In-Reply-To: <062d01ce9ee5$f181d440$d4857cc0$@gmail.com>
References: <1217501ce9425$026e58d0$074b0a70$@gmail.com>
	<062d01ce9ee5$f181d440$d4857cc0$@gmail.com>
Message-ID: <1CC19277-0A54-4D4B-AB59-591990BEDA67@gopivotal.com>

Junius Wang:

> 1.       The throughput of two node cluster is 50%-60% worse than a single node broker.

With mirroring, messages have to be copied to multiple (N or, depending on configuration, even all) nodes in the cluster. That obviously takes more time than not copying anything.

> 2.       Adding more node did have improvement on throughput but we only got 25% improvement(throughput of 3 node cluster is 25% better than 2 node cluster. 4 node cluster is 25% better than 3 node cluster too). What we expected is a 45-degree line, that means when 2 nodes are used the throughput is double. With 3 nodes, then triple.

You are not providing any details about your workload but the way you extend capacity with RabbitMQ is
by adding nodes and using more queues. Queue mirroring is an HA feature, which means copying
more data across the cluster.

Maximum throughput and highest availability are largely at odds with each other, so
you need to

1. Use multiple queues (and the number should grow with the number of nodes)
2. Choose what queues to mirror. Likely not all queues are equally important to your system, so you can make some of them non-HA.
3. Configure mirroring to, say, 2 nodes instead of "all".
4. If you know what node is the master for a particular queue (e.g. was declared on that node),
     make your clients connect there. It will decrease intra-cluster traffic.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/089f4ca1/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug 22 09:57:59 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 12:57:59 +0400
Subject: [rabbitmq-discuss] Reg:Heart Beat Lost
In-Reply-To: <BAY176-W136766E438177379F95C15EC4D0@phx.gbl>
References: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>,
	<76B9E19F-5213-4693-B899-E5A7FEB5EE62@gopivotal.com>
	<BAY176-W136766E438177379F95C15EC4D0@phx.gbl>
Message-ID: <CF33E2B1-0703-46B1-ADF9-13C69E354CF2@gopivotal.com>

Aathithyan SR:

> So in between this process i get heartbeat error).

Can you post the actual message you are getting?

> How to disable Heartbeat and keep the connection live for infinity time

You can set it to 0 from your client, set it to 0 in rabbitmq config or simply publish
dummy messages that are routed nowhere every N seconds (default heartbeat
interval is 30 minutes).
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/18400e5f/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug 22 09:58:40 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 12:58:40 +0400
Subject: [rabbitmq-discuss] Fwd:  Reg:Heart Beat Lost
References: <BAY176-W136766E438177379F95C15EC4D0@phx.gbl>
Message-ID: <3ACAC2BB-DB11-4827-8D17-0ED56EA7657A@gopivotal.com>

Forwarded message:

> From: Aathithyan SR <sr.aathithyan at outlook.com>
> Subject: RE: [rabbitmq-discuss] Reg:Heart Beat Lost
> Hi,
> 
> Thanks for your explanation .For me heartbeat lost error occurs in worker side.(ie my Queue contains 100 URL i am fetching each url to collect its HTML content so once finishing this process i acknowledge in order to delete the url in queue . So in between this process i get heartbeat error).How to disable Heartbeat and keep the connection live for infinity time
> 
> Thanks & Regards,
> Aathithyan S R
> 

--
MK

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/afddabff/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/afddabff/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug 22 10:01:30 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 13:01:30 +0400
Subject: [rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
In-Reply-To: <672b9622-f88a-4198-8cb6-0d5a110d9ebc@googlegroups.com>
References: <672b9622-f88a-4198-8cb6-0d5a110d9ebc@googlegroups.com>
Message-ID: <13FB8B9E-F9AA-408F-8ADB-354B1B3CA89A@gopivotal.com>

Valentin Polezhaev:

> For example I have 2 queues ("A", "B") with 2 messages in each and I consume in A-B-A-B order.
> My code successfully reads first messages from both A and B queues, but third time (second read from A) it stays at line
> var ea = (BasicDeliverEventArgs) _basicConsumer.Queue.Dequeue();
> and nothing happens.
> 
> Moreover it'is strange that via control panel I can see 2 unacked messages in both A and B queues. Corresponding to program beheaviour I can understand unacked message in A queue but not in B - second consuming from B was not started yet.

RabbitMQ will push up to N messages at a time on a channel, which is controlled
using BasicQos. QueueingConsumer then stores them in a linked queue in memory.

You need to set prefetch value to 1 using BasicQos, see
http://www.rabbitmq.com/tutorials/tutorial-two-java.html
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/5a5d521b/attachment.pgp>

From simon at rabbitmq.com  Thu Aug 22 10:05:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 Aug 2013 10:05:51 +0100
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A32B7@EXCHG01-OM.omel.es>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
	<520A334A.9030005@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2B29@EXCHG01-OM.omel.es>
	<5211C473.3060903@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A3258@EXCHG01-OM.omel.es>
	<5214C13D.9080004@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A32B7@EXCHG01-OM.omel.es>
Message-ID: <5215D46F.9010500@rabbitmq.com>

On 22/08/2013 9:41AM, SAG - Jonathan Andr?s wrote:
> Thank you very much!
>
> Now I can see the logs of the LDAP Plugin. But I think this directive
> is not working:
>
> {other_bind, {"UserXXX", "PassXXX"}},

 From http://www.rabbitmq.com/ldap.html:

"For authentication this plugin binds to the LDAP server as the user it
is trying to authenticate. This option controls how to bind for
authorisation queries, and to retrieve the details of a user who is
logging in without presenting a password (e.g. SASL EXTERNAL)."

So other_bind is only used after authenticating the user. Looking at the
documentation for mod_auth_ldap it looks like the Apache module does a
search using the configured username before attempting to bind using the
provided username. The RabbitMQ plugin doesn't do that.

> And I have another question: Once the producer and the consumer are
> authenticated, can the consumer know who sent the message?

See: http://www.rabbitmq.com/validated-user-id.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Thu Aug 22 10:08:39 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 13:08:39 +0400
Subject: [rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
In-Reply-To: <672b9622-f88a-4198-8cb6-0d5a110d9ebc@googlegroups.com>
References: <672b9622-f88a-4198-8cb6-0d5a110d9ebc@googlegroups.com>
Message-ID: <B9533925-AC2B-4587-90A5-431F077B6A8A@gopivotal.com>

Valentin Polezhaev:

> My code successfully reads first messages from both A and B queues, but third time (second read from A) it stays at line
> var ea = (BasicDeliverEventArgs) _basicConsumer.Queue.Dequeue();
> and nothing happens.

Just to clarify:

this particular behavior is likely due to the following: both messages in A were already delivered,
and take off the (internal to the client) linked queue, so subsequent invocations
will block the caller until a new delivery arrives.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/45cbdd60/attachment.pgp>

From valentin.polezhaev at gmail.com  Thu Aug 22 10:35:29 2013
From: valentin.polezhaev at gmail.com (Valentin Polezhaev)
Date: Thu, 22 Aug 2013 13:35:29 +0400
Subject: [rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
In-Reply-To: <B9533925-AC2B-4587-90A5-431F077B6A8A@gopivotal.com>
References: <672b9622-f88a-4198-8cb6-0d5a110d9ebc@googlegroups.com>
	<B9533925-AC2B-4587-90A5-431F077B6A8A@gopivotal.com>
Message-ID: <CAJ0j=PR2RB_jgEMm_mFzRJEvR-GVs2WAJvRXRAzA-NsGTZLDmQ@mail.gmail.com>

I try this at init step:

            _connection = _connectionFactory.CreateConnection();
            _channel = _connection.CreateModel();
            _channel.BasicQos(0, 1, false); //params are: prefetchSize,
prefetchCount, global
            _basicConsumer = new QueueingBasicConsumer(_channel)
{ConsumerTag = GetTag()};

and now I can only read one first message from A. When I try to read first
message from B I have exactly same problem.

_channel.BasicQos(0, 1, false); method call I took from old .NET client
docs.

Thanks.


2013/8/22 Michael Klishin <mklishin at gopivotal.com>

> Valentin Polezhaev:
>
> > My code successfully reads first messages from both A and B queues, but
> third time (second read from A) it stays at line
> > var ea = (BasicDeliverEventArgs) _basicConsumer.Queue.Dequeue();
> > and nothing happens.
>
> Just to clarify:
>
> this particular behavior is likely due to the following: both messages in
> A were already delivered,
> and take off the (internal to the client) linked queue, so subsequent
> invocations
> will block the caller until a new delivery arrives.
> --
> MK
>
>


-- 
With best regards, Valentin.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/d9b0e1bb/attachment.htm>

From mklishin at gopivotal.com  Thu Aug 22 10:41:49 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 13:41:49 +0400
Subject: [rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
In-Reply-To: <CAJ0j=PR2RB_jgEMm_mFzRJEvR-GVs2WAJvRXRAzA-NsGTZLDmQ@mail.gmail.com>
References: <672b9622-f88a-4198-8cb6-0d5a110d9ebc@googlegroups.com>
	<B9533925-AC2B-4587-90A5-431F077B6A8A@gopivotal.com>
	<CAJ0j=PR2RB_jgEMm_mFzRJEvR-GVs2WAJvRXRAzA-NsGTZLDmQ@mail.gmail.com>
Message-ID: <2B3173D3-0D05-4179-A6BE-5EDF6BFD5619@gopivotal.com>

Valentin Polezhaev:

> and now I can only read one first message from A. When I try to read first message from B I have exactly same problem.

This setting is per-channel, so it makes sense.

Take a look at BasicGet, it seems more appropriate for what you are trying to do (it is not
affected by the prefetch value, of course).
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/4c5eafb6/attachment.pgp>

From jandres at omie.es  Thu Aug 22 11:05:14 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Thu, 22 Aug 2013 10:05:14 +0000
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed
In-Reply-To: <5215D46F.9010500@rabbitmq.com>
References: <1376385577026-28750.post@n5.nabble.com>
	<520A1445.4010400@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2961@EXCHG01-OM.omel.es>
	<520A334A.9030005@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A2B29@EXCHG01-OM.omel.es>
	<5211C473.3060903@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A3258@EXCHG01-OM.omel.es>
	<5214C13D.9080004@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A32B7@EXCHG01-OM.omel.es>
	<5215D46F.9010500@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A3313@EXCHG01-OM.omel.es>

Thank you again.

I think I can't use the LDAP Plugin then. I need to do a search in the LDAP to find the user, I can't authenticate the user directly in the LDAP. This is no good news for me.

I have another problem creating a new user by the HTTP API, but I'll open a new question.

Thank you very much!







-----Mensaje original-----
De: Simon MacMullen [mailto:simon at rabbitmq.com] 
Enviado el: jueves, 22 de agosto de 2013 11:06
Para: Discussions about RabbitMQ
CC: SAG - Jonathan Andr?s
Asunto: Re: [rabbitmq-discuss] rabbit_auth_backend_ldap connect failed

On 22/08/2013 9:41AM, SAG - Jonathan Andr?s wrote:
> Thank you very much!
>
> Now I can see the logs of the LDAP Plugin. But I think this directive 
> is not working:
>
> {other_bind, {"UserXXX", "PassXXX"}},

 From http://www.rabbitmq.com/ldap.html:

"For authentication this plugin binds to the LDAP server as the user it is trying to authenticate. This option controls how to bind for authorisation queries, and to retrieve the details of a user who is logging in without presenting a password (e.g. SASL EXTERNAL)."

So other_bind is only used after authenticating the user. Looking at the documentation for mod_auth_ldap it looks like the Apache module does a search using the configured username before attempting to bind using the provided username. The RabbitMQ plugin doesn't do that.

> And I have another question: Once the producer and the consumer are 
> authenticated, can the consumer know who sent the message?

See: http://www.rabbitmq.com/validated-user-id.html

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

From valentin.polezhaev at gmail.com  Thu Aug 22 11:05:58 2013
From: valentin.polezhaev at gmail.com (Valentin Polezhaev)
Date: Thu, 22 Aug 2013 14:05:58 +0400
Subject: [rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
In-Reply-To: <2B3173D3-0D05-4179-A6BE-5EDF6BFD5619@gopivotal.com>
References: <672b9622-f88a-4198-8cb6-0d5a110d9ebc@googlegroups.com>
	<B9533925-AC2B-4587-90A5-431F077B6A8A@gopivotal.com>
	<CAJ0j=PR2RB_jgEMm_mFzRJEvR-GVs2WAJvRXRAzA-NsGTZLDmQ@mail.gmail.com>
	<2B3173D3-0D05-4179-A6BE-5EDF6BFD5619@gopivotal.com>
Message-ID: <CAJ0j=PTrH6kUFzE7rTjtQ_BvWh3EAdRPg54w3kmbLCdirt_DiA@mail.gmail.com>

Thanks


2013/8/22 Michael Klishin <mklishin at gopivotal.com>

> Valentin Polezhaev:
>
> > and now I can only read one first message from A. When I try to read
> first message from B I have exactly same problem.
>
> This setting is per-channel, so it makes sense.
>
> Take a look at BasicGet, it seems more appropriate for what you are trying
> to do (it is not
> affected by the prefetch value, of course).
> --
> MK
>
>


-- 
With best regards, Valentin.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/459b6dd8/attachment.htm>

From jandres at omie.es  Thu Aug 22 11:34:31 2013
From: jandres at omie.es (jandres)
Date: Thu, 22 Aug 2013 03:34:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Http API: new user
Message-ID: <1377167671234-29013.post@n5.nabble.com>

Hi,

i'm trying to create a new user using the HTTP API.

I can list the users that already exists, but when I try to create a new
one, I get this error:

org.springframework.web.client.ResourceAccessException: I/O error on PUT
request for "http://localhost:15672/api/users/newUser":Software caused
connection abort: recv failed; nested exception is java.net.SocketException:
Software caused connection abort: recv failed


I'm using Spring, and this is my code:

---------------
ConfigurableApplicationContext context = new
ClassPathXmlApplicationContext("config/client-rest-config.xml");
	      
		DefaultHttpClient httpClient = context.getBean(DefaultHttpClient.class); 
		RestTemplate restTemplate = context.getBean(RestTemplate.class); 

		String uri = "http://localhost:15672/api/users/newUser";
		HttpHeaders headers = new HttpHeaders();  
        headers.setContentType( MediaType.APPLICATION_JSON );  
        
        String pass = "{\"name\":\"newUser\", \"password\":\"secret\",
\"tags\":\"administrator\"}";
        HttpEntity<String> request= new HttpEntity<String>( pass, headers );  
        
        UsernamePasswordCredentials creds = 
                new UsernamePasswordCredentials("guest", "guest");
        AuthScope authScope = new AuthScope(AuthScope.ANY_HOST,
AuthScope.ANY_PORT, AuthScope.ANY_REALM);
        
        httpClient.getCredentialsProvider().setCredentials(authScope,
creds);
        try
        {
        	restTemplate.put( uri, request);  
        }catch(Exception e){
        	System.err.println(e);
        }
        try
        {
        	restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
        }catch(Exception e){
        	System.err.println(e);
        }
        Object usuarios =
restTemplate.getForObject("http://localhost:15672/api/users", Object.class);
		System.out.println("OK");
----------

I get the error in the lines:

  restTemplate.put( uri, request);  
  ...
  restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);

But i can list the users in the line:

  Object usuarios =
restTemplate.getForObject("http://localhost:15672/api/users", Object.class);


Thank you!






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Http-API-new-user-tp29013.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Aug 22 11:48:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 Aug 2013 11:48:15 +0100
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <1377167671234-29013.post@n5.nabble.com>
References: <1377167671234-29013.post@n5.nabble.com>
Message-ID: <5215EC6F.8060708@rabbitmq.com>

That looks superficially like it should work. Does anything show up in 
the logs when it fails?

Cheers, Simon

On 22/08/2013 11:34AM, jandres wrote:
> Hi,
>
> i'm trying to create a new user using the HTTP API.
>
> I can list the users that already exists, but when I try to create a new
> one, I get this error:
>
> org.springframework.web.client.ResourceAccessException: I/O error on PUT
> request for "http://localhost:15672/api/users/newUser":Software caused
> connection abort: recv failed; nested exception is java.net.SocketException:
> Software caused connection abort: recv failed
>
>
> I'm using Spring, and this is my code:
>
> ---------------
> ConfigurableApplicationContext context = new
> ClassPathXmlApplicationContext("config/client-rest-config.xml");
> 	
> 		DefaultHttpClient httpClient = context.getBean(DefaultHttpClient.class);
> 		RestTemplate restTemplate = context.getBean(RestTemplate.class);
>
> 		String uri = "http://localhost:15672/api/users/newUser";
> 		HttpHeaders headers = new HttpHeaders();
>          headers.setContentType( MediaType.APPLICATION_JSON );
>
>          String pass = "{\"name\":\"newUser\", \"password\":\"secret\",
> \"tags\":\"administrator\"}";
>          HttpEntity<String> request= new HttpEntity<String>( pass, headers );
>
>          UsernamePasswordCredentials creds =
>                  new UsernamePasswordCredentials("guest", "guest");
>          AuthScope authScope = new AuthScope(AuthScope.ANY_HOST,
> AuthScope.ANY_PORT, AuthScope.ANY_REALM);
>
>          httpClient.getCredentialsProvider().setCredentials(authScope,
> creds);
>          try
>          {
>          	restTemplate.put( uri, request);
>          }catch(Exception e){
>          	System.err.println(e);
>          }
>          try
>          {
>          	restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
>          }catch(Exception e){
>          	System.err.println(e);
>          }
>          Object usuarios =
> restTemplate.getForObject("http://localhost:15672/api/users", Object.class);
> 		System.out.println("OK");
> ----------
>
> I get the error in the lines:
>
>    restTemplate.put( uri, request);
>    ...
>    restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
>
> But i can list the users in the line:
>
>    Object usuarios =
> restTemplate.getForObject("http://localhost:15672/api/users", Object.class);
>
>
> Thank you!
>
>
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Http-API-new-user-tp29013.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jandres at omie.es  Thu Aug 22 13:37:39 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Thu, 22 Aug 2013 12:37:39 +0000
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <5215EC6F.8060708@rabbitmq.com>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>

No, I can't see anything in the logs, just the exception in the client.

I have tried with CURL (curl -i -u guest:guest -H "content-type:applicacion/json" -XPUT -d '{"password":"secret", "tags":"administrator"}' http://localhost:15672/api/users/newUser )

But I get the error: 415 Unsupported Media Type.



-----Mensaje original-----
De: Simon MacMullen [mailto:simon at rabbitmq.com] 
Enviado el: jueves, 22 de agosto de 2013 12:48
Para: Discussions about RabbitMQ
CC: SAG - Jonathan Andr?s
Asunto: Re: [rabbitmq-discuss] Http API: new user

That looks superficially like it should work. Does anything show up in the logs when it fails?

Cheers, Simon

On 22/08/2013 11:34AM, jandres wrote:
> Hi,
>
> i'm trying to create a new user using the HTTP API.
>
> I can list the users that already exists, but when I try to create a 
> new one, I get this error:
>
> org.springframework.web.client.ResourceAccessException: I/O error on 
> PUT request for "http://localhost:15672/api/users/newUser":Software 
> caused connection abort: recv failed; nested exception is java.net.SocketException:
> Software caused connection abort: recv failed
>
>
> I'm using Spring, and this is my code:
>
> ---------------
> ConfigurableApplicationContext context = new 
> ClassPathXmlApplicationContext("config/client-rest-config.xml");
> 	
> 		DefaultHttpClient httpClient = context.getBean(DefaultHttpClient.class);
> 		RestTemplate restTemplate = context.getBean(RestTemplate.class);
>
> 		String uri = "http://localhost:15672/api/users/newUser";
> 		HttpHeaders headers = new HttpHeaders();
>          headers.setContentType( MediaType.APPLICATION_JSON );
>
>          String pass = "{\"name\":\"newUser\", 
> \"password\":\"secret\", \"tags\":\"administrator\"}";
>          HttpEntity<String> request= new HttpEntity<String>( pass, 
> headers );
>
>          UsernamePasswordCredentials creds =
>                  new UsernamePasswordCredentials("guest", "guest");
>          AuthScope authScope = new AuthScope(AuthScope.ANY_HOST, 
> AuthScope.ANY_PORT, AuthScope.ANY_REALM);
>
>          httpClient.getCredentialsProvider().setCredentials(authScope,
> creds);
>          try
>          {
>          	restTemplate.put( uri, request);
>          }catch(Exception e){
>          	System.err.println(e);
>          }
>          try
>          {
>          	restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
>          }catch(Exception e){
>          	System.err.println(e);
>          }
>          Object usuarios =
> restTemplate.getForObject("http://localhost:15672/api/users", Object.class);
> 		System.out.println("OK");
> ----------
>
> I get the error in the lines:
>
>    restTemplate.put( uri, request);
>    ...
>    restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
>
> But i can list the users in the line:
>
>    Object usuarios =
> restTemplate.getForObject("http://localhost:15672/api/users", 
> Object.class);
>
>
> Thank you!
>
>
>
>
>
>
> --
> View this message in context: 
> http://rabbitmq.1065348.n5.nabble.com/Http-API-new-user-tp29013.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--
Simon MacMullen
RabbitMQ, Pivotal

From frank.shearar at gmail.com  Thu Aug 22 14:08:51 2013
From: frank.shearar at gmail.com (Frank Shearar)
Date: Thu, 22 Aug 2013 14:08:51 +0100
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>
Message-ID: <CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>

On 22 August 2013 13:37, SAG - Jonathan Andr?s <jandres at omie.es> wrote:
> No, I can't see anything in the logs, just the exception in the client.
>
> I have tried with CURL (curl -i -u guest:guest -H "content-type:applicacion/json" -XPUT -d '{"password":"secret", "tags":"administrator"}' http://localhost:15672/api/users/newUser )
>
> But I get the error: 415 Unsupported Media Type.

That's because you need "content-type:application/json". Note the "t".

frank

>
> -----Mensaje original-----
> De: Simon MacMullen [mailto:simon at rabbitmq.com]
> Enviado el: jueves, 22 de agosto de 2013 12:48
> Para: Discussions about RabbitMQ
> CC: SAG - Jonathan Andr?s
> Asunto: Re: [rabbitmq-discuss] Http API: new user
>
> That looks superficially like it should work. Does anything show up in the logs when it fails?
>
> Cheers, Simon
>
> On 22/08/2013 11:34AM, jandres wrote:
>> Hi,
>>
>> i'm trying to create a new user using the HTTP API.
>>
>> I can list the users that already exists, but when I try to create a
>> new one, I get this error:
>>
>> org.springframework.web.client.ResourceAccessException: I/O error on
>> PUT request for "http://localhost:15672/api/users/newUser":Software
>> caused connection abort: recv failed; nested exception is java.net.SocketException:
>> Software caused connection abort: recv failed
>>
>>
>> I'm using Spring, and this is my code:
>>
>> ---------------
>> ConfigurableApplicationContext context = new
>> ClassPathXmlApplicationContext("config/client-rest-config.xml");
>>
>>               DefaultHttpClient httpClient = context.getBean(DefaultHttpClient.class);
>>               RestTemplate restTemplate = context.getBean(RestTemplate.class);
>>
>>               String uri = "http://localhost:15672/api/users/newUser";
>>               HttpHeaders headers = new HttpHeaders();
>>          headers.setContentType( MediaType.APPLICATION_JSON );
>>
>>          String pass = "{\"name\":\"newUser\",
>> \"password\":\"secret\", \"tags\":\"administrator\"}";
>>          HttpEntity<String> request= new HttpEntity<String>( pass,
>> headers );
>>
>>          UsernamePasswordCredentials creds =
>>                  new UsernamePasswordCredentials("guest", "guest");
>>          AuthScope authScope = new AuthScope(AuthScope.ANY_HOST,
>> AuthScope.ANY_PORT, AuthScope.ANY_REALM);
>>
>>          httpClient.getCredentialsProvider().setCredentials(authScope,
>> creds);
>>          try
>>          {
>>               restTemplate.put( uri, request);
>>          }catch(Exception e){
>>               System.err.println(e);
>>          }
>>          try
>>          {
>>               restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
>>          }catch(Exception e){
>>               System.err.println(e);
>>          }
>>          Object usuarios =
>> restTemplate.getForObject("http://localhost:15672/api/users", Object.class);
>>               System.out.println("OK");
>> ----------
>>
>> I get the error in the lines:
>>
>>    restTemplate.put( uri, request);
>>    ...
>>    restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
>>
>> But i can list the users in the line:
>>
>>    Object usuarios =
>> restTemplate.getForObject("http://localhost:15672/api/users",
>> Object.class);
>>
>>
>> Thank you!
>>
>>
>>
>>
>>
>>
>> --
>> View this message in context:
>> http://rabbitmq.1065348.n5.nabble.com/Http-API-new-user-tp29013.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From liam.reilly.1 at gmail.com  Thu Aug 22 15:33:31 2013
From: liam.reilly.1 at gmail.com (Liam Reilly)
Date: Thu, 22 Aug 2013 07:33:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Clustering issue - (2x Virtual Box
 OpenSuse machines) (NOOB)
Message-ID: <fe02350e-e2ab-430f-a0a0-cc791a552be9@googlegroups.com>

I've got a couple of OpenSuse VM's configured in Virtual Box.  

I have rabbit running on both.

rabbit at devserver
rabbit at devagent

I've added both machines to each others hosts files and I can do a sudo 
/usr/sbin/rabbitmqctl -n rabbit@{hostname} status from either machine to 
see the full status output of the node.

So both machines are happy at this point.  

I've also got Celery working and load balancing tasks using the 
rabbit at devserver RabbitMQ queue.

Now I stopped the rabbit at devagent instance and tried to add to the 
@devserver using the cluster command

sudo /usr/sbin/rabbitmqctl cluster rabbit at devserver 

to which I get 

Clustering node rabbit at devagent with [rabbit at devserver] ...
Error: unable to connect to node rabbit at devagent:  nodedown

DIAGNOSTICS

nodes in question:  [rabbit at devagent]

hosts, their running nodes and ports:
- devagent:  [{rabbitmqctl10831, 48309}]

current node details:
- node name rabbitmqctl10831 at devagent
- home dir: /var/lib/rabbitmq
- cookie hash:  LczRqz4mQrqdzWYMcog==

I have modified the erlang cookie on both machines so these match btw.

Any idea's?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/9a17376d/attachment.htm>

From yby538 at 163.com  Thu Aug 22 14:03:16 2013
From: yby538 at 163.com (yby538)
Date: Thu, 22 Aug 2013 21:03:16 +0800
Subject: [rabbitmq-discuss] Hi,
	all.How to get messages from the rabbitmq server which is installed
	in another machine?
Message-ID: <1a125ebb.54be.140a61f35c2.Coremail.yby538@163.com>

Hi,all

I am a rabbitmq user from China and i am sorry that my English is very poor...

I have two machines.One is real and the other one is installed by Vmware Workstation.They connect via NAT
The real one(host machine) was set to: IP:192.168.241.1 Subnetmask:255.255.255.0 gateway IP:192.168.241.2
and the virtual machine was set to: IP:192.168.241.11 Subnetmask:255.255.255.0 gateway IP:192.168.241.2
and I have installed rabbitmq both in host machine and viratual machine.I run this code in my host machine:
ConnectionFactory factorySTC = new ConnectionFactory();
factorySTC.setHost("localhost");
factorySTC.setPort(5672);
Connection connectionSTC = factorySTC.newConnection();
Channel channelSTC = connectionSTC.createChannel();
channelSTC.queueDeclare("queue", true, false, false, null);
String message="helloworld";       
channelSTC.basicPublish("","queue",
MessageProperties.PERSISTENT_TEXT_PLAIN,message.getBytes());
I mean,i want to send "hellworld" to queue "queue"
and I run this code in my host machine(whose ip was set to 192.168.241.11 above):
ConnectionFactory factorySTC = new ConnectionFactory();
factorySTC.setHost("192.168.241.1");
factorySTC.setPort(5672);
Connection connectionSTC = factorySTC.newConnection();
Channel channelSTC = connectionSTC.createChannel();
channelSTC.queueDeclare("queue", true, false, false, null);
QueueingConsumer cosumerSTC=new QueueingConsumer(channelSTC);
QueueingConsumer.Delivery delivery = cosumerSTC.nextDelivery();
String message = new String(delivery.getBody());
but it does not work.It failed and something shows that"connect timed out...."
so,how to solve this problem?I mean,i want to get message from the rabbitmq queues which are installed in machines which are in the same LAN with my pc...
thanks very very very much in advance...
Regards...

2013-08-22



yby538
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/6622e9dc/attachment.htm>

From mklishin at gopivotal.com  Thu Aug 22 16:03:53 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 19:03:53 +0400
Subject: [rabbitmq-discuss] RabbitMQ Clustering issue - (2x Virtual Box
	OpenSuse machines) (NOOB)
In-Reply-To: <fe02350e-e2ab-430f-a0a0-cc791a552be9@googlegroups.com>
References: <fe02350e-e2ab-430f-a0a0-cc791a552be9@googlegroups.com>
Message-ID: <7D99C459-41B7-467D-A5DE-08A17EF3A724@gopivotal.com>

Liam Reilly:

> Now I stopped the rabbit at devagent instance and tried to add to the @devserver using the cluster command
> 
> sudo /usr/sbin/rabbitmqctl cluster rabbit at devserver 

Liam,

Did you stop RabbitMQ using OS services? In other words, did you stop the process
or used stop_app to stop the app but keep the VM running?

http://www.rabbitmq.com/clustering.html#transcript has more info about how to stop
a node before joining a cluster.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/7597498f/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug 22 16:06:39 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 19:06:39 +0400
Subject: [rabbitmq-discuss] Hi,
	all.How to get messages from the rabbitmq server which is installed
	in another machine?
In-Reply-To: <1a125ebb.54be.140a61f35c2.Coremail.yby538@163.com>
References: <1a125ebb.54be.140a61f35c2.Coremail.yby538@163.com>
Message-ID: <15383646-95C1-4CAE-99CD-74164EEAB4F2@gopivotal.com>

yby538:

> but it does not work.It failed and something shows that"connect timed out...."
> 
> so,how to solve this problem?I mean,i want to get message from the rabbitmq queues which are installed in machines which are in the same LAN with my pc...

It may be a firewall issue. 

Make sure 192.168.241.1 allows connections on ports
5672, 5671 (if you need TLS/SSL) and 4369 (if you plan to use rabbitmqctl to control
the node on 192.168.241.1, or use clustering).

For example, can you connect to 192.168.241.1:5672 using telnet?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/29eacc9e/attachment.pgp>

From emile at rabbitmq.com  Thu Aug 22 16:17:45 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 22 Aug 2013 16:17:45 +0100
Subject: [rabbitmq-discuss] Hi,
 all.How to get messages from the rabbitmq server which is installed
 in another machine?
In-Reply-To: <1a125ebb.54be.140a61f35c2.Coremail.yby538@163.com>
References: <1a125ebb.54be.140a61f35c2.Coremail.yby538@163.com>
Message-ID: <52162B99.9030400@rabbitmq.com>

On 22/08/13 14:03, yby538 wrote:

> and I have installed rabbitmq both in host machine and viratual
> machine.

Your test only requires one broker.

> and I run this code in my host machine

> but it does not work.It failed and something shows that"connect timed
> out...."

This means the network was not reachable. Check your network setup. The
internal and external address ranges in NAT are normally disjoint.

Make sure there is no firewall rules on the broker server that block
access and make sure that you can establish TCP connections from the
client machine to the broker using something simple like telnet on port
5672.




-Emile







From mklishin at gopivotal.com  Thu Aug 22 17:15:52 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 20:15:52 +0400
Subject: [rabbitmq-discuss] Fwd:  Reg:Heart Beat Lost
References: <BAY176-W321531EA8C7F78853EA1B6EC4D0@phx.gbl>
Message-ID: <606C1C45-90A9-4641-9015-450EE521A1D6@gopivotal.com>

Forwarded message:

> Fromr: Aathithyan SR <sr.aathithyan at outlook.com>
> Subject: RE: [rabbitmq-discuss] Reg:Heart Beat Lost
> 
> Thanks for your suggestion ,I tried adding 0 in receiver end even though its throwing the same error .I dont find config file for rabbitmq in default   
> 
> > Subject: Re: [rabbitmq-discuss] Reg:Heart Beat Lost
> > From: mklishin at gopivotal.com
> > Date: Thu, 22 Aug 2013 12:57:59 +0400
> > CC: rabbitmq-discuss at lists.rabbitmq.com
> > To: sr.aathithyan at outlook.com
> > 
> > Aathithyan SR:
> > 
> > > So in between this process i get heartbeat error).
> > 
> > Can you post the actual message you are getting?
> > 
> > > How to disable Heartbeat and keep the connection live for infinity time
> > 
> > You can set it to 0 from your client, set it to 0 in rabbitmq config or simply publish
> > dummy messages that are routed nowhere every N seconds (default heartbeat
> > interval is 30 minutes).
> > --
> > MK
> >

--
MK

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/07f0f817/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/07f0f817/attachment.pgp>

From mklishin at gopivotal.com  Thu Aug 22 17:17:25 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 20:17:25 +0400
Subject: [rabbitmq-discuss] Reg:Heart Beat Lost
In-Reply-To: <BAY176-W321531EA8C7F78853EA1B6EC4D0@phx.gbl>
References: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>,
	<76B9E19F-5213-4693-B899-E5A7FEB5EE62@gopivotal.com>
	<BAY176-W136766E438177379F95C15EC4D0@phx.gbl>,
	<CF33E2B1-0703-46B1-ADF9-13C69E354CF2@gopivotal.com>
	<BAY176-W321531EA8C7F78853EA1B6EC4D0@phx.gbl>
Message-ID: <BD8A03E2-2CE2-4810-A3E2-7A7298F04768@gopivotal.com>

Aathithyan SR:

> Thanks for your suggestion ,I tried adding 0 in receiver end even though its throwing the same error .I dont find config file for rabbitmq in default 

Aathithyan,

Please do post the error message you are getting and use Reply All so that your messages
get to the list as well.

Your client may be lacking heartbeats support. So far you haven't posted any error messages
or mentioned what client that is.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/1c8cd5bb/attachment.pgp>

From sr.aathithyan at outlook.com  Thu Aug 22 17:48:12 2013
From: sr.aathithyan at outlook.com (Aathithyan SR)
Date: Thu, 22 Aug 2013 16:48:12 +0000
Subject: [rabbitmq-discuss] Reg:Heart Beat Lost
In-Reply-To: <BD8A03E2-2CE2-4810-A3E2-7A7298F04768@gopivotal.com>
References: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>, ,
	<76B9E19F-5213-4693-B899-E5A7FEB5EE62@gopivotal.com>,
	<BAY176-W136766E438177379F95C15EC4D0@phx.gbl>, ,
	<CF33E2B1-0703-46B1-ADF9-13C69E354CF2@gopivotal.com>,
	<BAY176-W321531EA8C7F78853EA1B6EC4D0@phx.gbl>,
	<BD8A03E2-2CE2-4810-A3E2-7A7298F04768@gopivotal.com>
Message-ID: <BAY176-W4652B1D8CA08BE2A179F61EC4D0@phx.gbl>

The Error message which I get was "Heartbeat Lost" other than this i didn't get any error  .I am using Perl as my sender and receiver .One more issue which I am facing is I can able to push only 80 messages at a time ,this issue came when I set up rabbitmq in amazon EC2
Thanks & Regards,Aathithyan S R

From: mklishin at gopivotal.com
Date: Thu, 22 Aug 2013 20:17:25 +0400
To: sr.aathithyan at outlook.com; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Reg:Heart Beat Lost

Aathithyan SR:
 
> Thanks for your suggestion ,I tried adding 0 in receiver end even though its throwing the same error .I dont find config file for rabbitmq in default 
 
Aathithyan,
 
Please do post the error message you are getting and use Reply All so that your messages
get to the list as well.
 
Your client may be lacking heartbeats support. So far you haven't posted any error messages
or mentioned what client that is.
--
MK
 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/a637cc92/attachment.htm>

From jandres at omie.es  Thu Aug 22 17:51:29 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Thu, 22 Aug 2013 16:51:29 +0000
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>,
	<CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>

Yes, you are right, sorry, I did it in a hurry.

But If i try with this:

curl -i -v -u guest:guest -H "content-type:application/json" -XPUT -d'{"password":"secret","tags":"administrator"}' http://localhost:15672/api/users/newUser


Now i get this:

Error: bad_request, Reason: not_json.



Thank you again.


________________________________________
De: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] en nombre de Frank Shearar [frank.shearar at gmail.com]
Enviado el: jueves, 22 de agosto de 2013 15:08
Para: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] Http API: new user

On 22 August 2013 13:37, SAG - Jonathan Andr?s <jandres at omie.es> wrote:
> No, I can't see anything in the logs, just the exception in the client.
>
> I have tried with CURL (curl -i -u guest:guest -H "content-type:applicacion/json" -XPUT -d '{"password":"secret", "tags":"administrator"}' http://localhost:15672/api/users/newUser )
>
> But I get the error: 415 Unsupported Media Type.

That's because you need "content-type:application/json". Note the "t".

frank

>
> -----Mensaje original-----
> De: Simon MacMullen [mailto:simon at rabbitmq.com]
> Enviado el: jueves, 22 de agosto de 2013 12:48
> Para: Discussions about RabbitMQ
> CC: SAG - Jonathan Andr?s
> Asunto: Re: [rabbitmq-discuss] Http API: new user
>
> That looks superficially like it should work. Does anything show up in the logs when it fails?
>
> Cheers, Simon
>
> On 22/08/2013 11:34AM, jandres wrote:
>> Hi,
>>
>> i'm trying to create a new user using the HTTP API.
>>
>> I can list the users that already exists, but when I try to create a
>> new one, I get this error:
>>
>> org.springframework.web.client.ResourceAccessException: I/O error on
>> PUT request for "http://localhost:15672/api/users/newUser":Software
>> caused connection abort: recv failed; nested exception is java.net.SocketException:
>> Software caused connection abort: recv failed
>>
>>
>> I'm using Spring, and this is my code:
>>
>> ---------------
>> ConfigurableApplicationContext context = new
>> ClassPathXmlApplicationContext("config/client-rest-config.xml");
>>
>>               DefaultHttpClient httpClient = context.getBean(DefaultHttpClient.class);
>>               RestTemplate restTemplate = context.getBean(RestTemplate.class);
>>
>>               String uri = "http://localhost:15672/api/users/newUser";
>>               HttpHeaders headers = new HttpHeaders();
>>          headers.setContentType( MediaType.APPLICATION_JSON );
>>
>>          String pass = "{\"name\":\"newUser\",
>> \"password\":\"secret\", \"tags\":\"administrator\"}";
>>          HttpEntity<String> request= new HttpEntity<String>( pass,
>> headers );
>>
>>          UsernamePasswordCredentials creds =
>>                  new UsernamePasswordCredentials("guest", "guest");
>>          AuthScope authScope = new AuthScope(AuthScope.ANY_HOST,
>> AuthScope.ANY_PORT, AuthScope.ANY_REALM);
>>
>>          httpClient.getCredentialsProvider().setCredentials(authScope,
>> creds);
>>          try
>>          {
>>               restTemplate.put( uri, request);
>>          }catch(Exception e){
>>               System.err.println(e);
>>          }
>>          try
>>          {
>>               restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
>>          }catch(Exception e){
>>               System.err.println(e);
>>          }
>>          Object usuarios =
>> restTemplate.getForObject("http://localhost:15672/api/users", Object.class);
>>               System.out.println("OK");
>> ----------
>>
>> I get the error in the lines:
>>
>>    restTemplate.put( uri, request);
>>    ...
>>    restTemplate.exchange(uri, HttpMethod.PUT, request, Object.class);
>>
>> But i can list the users in the line:
>>
>>    Object usuarios =
>> restTemplate.getForObject("http://localhost:15672/api/users",
>> Object.class);
>>
>>
>> Thank you!
>>
>>
>>
>>
>>
>>
>> --
>> View this message in context:
>> http://rabbitmq.1065348.n5.nabble.com/Http-API-new-user-tp29013.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mklishin at gopivotal.com  Thu Aug 22 17:55:43 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 20:55:43 +0400
Subject: [rabbitmq-discuss] Reg:Heart Beat Lost
In-Reply-To: <BAY176-W4652B1D8CA08BE2A179F61EC4D0@phx.gbl>
References: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>, ,
	<76B9E19F-5213-4693-B899-E5A7FEB5EE62@gopivotal.com>,
	<BAY176-W136766E438177379F95C15EC4D0@phx.gbl>, ,
	<CF33E2B1-0703-46B1-ADF9-13C69E354CF2@gopivotal.com>,
	<BAY176-W321531EA8C7F78853EA1B6EC4D0@phx.gbl>,
	<BD8A03E2-2CE2-4810-A3E2-7A7298F04768@gopivotal.com>
	<BAY176-W4652B1D8CA08BE2A179F61EC4D0@phx.gbl>
Message-ID: <679611CE-55C9-424D-9474-05CB4E42A971@gopivotal.com>

Aathithyan SR:

> I am using Perl as my sender and receiver

Perl has multiple clients. Which one do you use?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/b8825531/attachment.pgp>

From sr.aathithyan at outlook.com  Thu Aug 22 17:59:10 2013
From: sr.aathithyan at outlook.com (Aathithyan SR)
Date: Thu, 22 Aug 2013 16:59:10 +0000
Subject: [rabbitmq-discuss] Reg:Heart Beat Lost
In-Reply-To: <679611CE-55C9-424D-9474-05CB4E42A971@gopivotal.com>
References: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>,
	, , <76B9E19F-5213-4693-B899-E5A7FEB5EE62@gopivotal.com>, ,
	<BAY176-W136766E438177379F95C15EC4D0@phx.gbl>, 
	, , <CF33E2B1-0703-46B1-ADF9-13C69E354CF2@gopivotal.com>, ,
	<BAY176-W321531EA8C7F78853EA1B6EC4D0@phx.gbl>, ,
	<BD8A03E2-2CE2-4810-A3E2-7A7298F04768@gopivotal.com>,
	<BAY176-W4652B1D8CA08BE2A179F61EC4D0@phx.gbl>,
	<679611CE-55C9-424D-9474-05CB4E42A971@gopivotal.com>
Message-ID: <BAY176-W81958B8E7C133A23FD2F9EC4D0@phx.gbl>

I am using Net::RabbitFoot in perl 

From: mklishin at gopivotal.com
Date: Thu, 22 Aug 2013 20:55:43 +0400
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Reg:Heart Beat Lost

Aathithyan SR:
 
> I am using Perl as my sender and receiver
 
Perl has multiple clients. Which one do you use?
--
MK
 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/c964f0eb/attachment.htm>

From prabodh.upreti at vce.com  Thu Aug 22 18:38:48 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Thu, 22 Aug 2013 10:38:48 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq shutdown return code 2
Message-ID: <1377193128005-29028.post@n5.nabble.com>

Hello

We have Puppet shutting down rabbitmq.  It should normally return 0 I
believe but we are seeing return code 2 which our system is treating as a
problem shutdown.

why would it be returning 2 instead of 0.  Maybe taking more time to save
before exiting? Thank you.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-shutdown-return-code-2-tp29028.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Thu Aug 22 18:42:25 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 Aug 2013 21:42:25 +0400
Subject: [rabbitmq-discuss] rabbitmq shutdown return code 2
In-Reply-To: <1377193128005-29028.post@n5.nabble.com>
References: <1377193128005-29028.post@n5.nabble.com>
Message-ID: <52F30872-5D41-4EE7-B20F-D4E219A68ABA@gopivotal.com>

Prabodh Upreti:

> why would it be returning 2 instead of 0.  Maybe taking more time to save
> before exiting? Thank you.

What command is used for shut down? Is there anything in RabbitMQ log?
What OS do you use and how did you install RabbitMQ?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/51990f4b/attachment.pgp>

From prabodh.upreti at vce.com  Thu Aug 22 19:39:55 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Thu, 22 Aug 2013 11:39:55 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq shutdown return code 2
In-Reply-To: <1377193128005-29028.post@n5.nabble.com>
References: <1377193128005-29028.post@n5.nabble.com>
Message-ID: <1377196795094-29030.post@n5.nabble.com>

Nothing on the logs

Error: Could not stop Service[rabbitmq-server]: Execution of '/sbin/service
rabbitmq-server stop' returned 2: 
Error: /Stage[main]//Service[rabbitmq-server]/ensure: change from running to
stopped failed: Could not stop Service[rabbitmq-server]: Execution of
'/sbin/service rabbitmq-server stop' returned 2: 


I don't know too much about puppet but I will add details once I find out
more.  I checked the logs and and I see a normal shutdown. thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-shutdown-return-code-2-tp29028p29030.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jondokulil at gmail.com  Thu Aug 22 20:17:35 2013
From: jondokulil at gmail.com (Jon Dokulil)
Date: Thu, 22 Aug 2013 12:17:35 -0700 (PDT)
Subject: [rabbitmq-discuss] A three-node cluster hangs completely in ec2
Message-ID: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>

We've seen this happen twice now and each time it's been a pain to work 
around (we ended up creating a whole new cluster each time). Here's the 
scenario we have seen:

Our setup:

   1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each node 
   is in a different availability zone in the US-EAST region on AWS. We'll 
   call them nodes A, B, and C
   2. Each queue is using an HA policy
   3. All queues are durable
   4. We Basic.Publish with DeliveryMode=2
   5. All clients are initially connected to node A

The scenario:

   1. Node A is shutdown (the last time I did it via 'sudo 
   /etc/init.d/rabbitmq-server stop
   2. All connected clients see the shutdown and successfully transition to 
   using one of the other nodes. About half connect to node B and the other 
   half connect to node C
   3. We notice that a few of the queues still show their "node" as being 
   node A, even though it is not currently running.
   4. Node A is brought back online. The RabbitMQ management console 
   (webapp) shows everything is fine on the homepage.
   5. When A comes back online, those queues that show A as their 'node' 
   now show zero mirrors.
   6. I attempt to delete the queue via the management webapp. At that 
   point all three nodes become 100% unresponsive. The management webapp fails 
   to respond and all communication in our application stops. CPU fluctuates 
   between 10-40% on but memory doesn't seem to be leaking. It's difficult to 
   know what is happening because rabbitmqctl is also unresponsive. Attempts 
   to gracefully stop the nodes all hang.

Does anybody have experience with this? What additional information should 
I provide? It's causing a lot of stress and confuses the heck out of me. 
Any guidance is much appreciated.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/e6d7e508/attachment.htm>

From stuff at moesel.net  Thu Aug 22 21:20:58 2013
From: stuff at moesel.net (Chris)
Date: Thu, 22 Aug 2013 16:20:58 -0400
Subject: [rabbitmq-discuss] A three-node cluster hangs completely in ec2
In-Reply-To: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
References: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
Message-ID: <CAHEpgBD3mKdKTYVqCC3mNkMGJD8RH3v2AOYfSGPEC-Px3j8a2g@mail.gmail.com>

Hi Jon,

I'm not 100% familiar with Amazon's availability zones and how they work,
but... it sounds to me like they are in different locations and different
networks?  If so, clustering is probably not a good idea in this case.
 See: http://www.rabbitmq.com/partitions.html

I don't know if this is the cause for the issues you've seen, but it may be
the cause of issues in the future...  On the other hand, if I am wrong
about availabity zones, then you can safely disregard this message! ;-)

-Chris



On Thu, Aug 22, 2013 at 3:17 PM, Jon Dokulil <jondokulil at gmail.com> wrote:

> We've seen this happen twice now and each time it's been a pain to work
> around (we ended up creating a whole new cluster each time). Here's the
> scenario we have seen:
>
> Our setup:
>
>    1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each
>    node is in a different availability zone in the US-EAST region on AWS.
>    We'll call them nodes A, B, and C
>    2. Each queue is using an HA policy
>    3. All queues are durable
>    4. We Basic.Publish with DeliveryMode=2
>    5. All clients are initially connected to node A
>
> The scenario:
>
>    1. Node A is shutdown (the last time I did it via 'sudo
>    /etc/init.d/rabbitmq-server stop
>    2. All connected clients see the shutdown and successfully transition
>    to using one of the other nodes. About half connect to node B and the other
>    half connect to node C
>    3. We notice that a few of the queues still show their "node" as being
>    node A, even though it is not currently running.
>    4. Node A is brought back online. The RabbitMQ management console
>    (webapp) shows everything is fine on the homepage.
>    5. When A comes back online, those queues that show A as their 'node'
>    now show zero mirrors.
>    6. I attempt to delete the queue via the management webapp. At that
>    point all three nodes become 100% unresponsive. The management webapp fails
>    to respond and all communication in our application stops. CPU fluctuates
>    between 10-40% on but memory doesn't seem to be leaking. It's difficult to
>    know what is happening because rabbitmqctl is also unresponsive. Attempts
>    to gracefully stop the nodes all hang.
>
> Does anybody have experience with this? What additional information should
> I provide? It's causing a lot of stress and confuses the heck out of me.
> Any guidance is much appreciated.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/b172cf2a/attachment.htm>

From videlalvaro at gmail.com  Thu Aug 22 22:10:10 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 22 Aug 2013 23:10:10 +0200
Subject: [rabbitmq-discuss] A three-node cluster hangs completely in ec2
In-Reply-To: <CAHEpgBD3mKdKTYVqCC3mNkMGJD8RH3v2AOYfSGPEC-Px3j8a2g@mail.gmail.com>
References: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
	<CAHEpgBD3mKdKTYVqCC3mNkMGJD8RH3v2AOYfSGPEC-Px3j8a2g@mail.gmail.com>
Message-ID: <CAMcAHLVufZzyJcGhQ1WErJyGSRx1_hrinkdzEAV4HL3BTQ+ZRA@mail.gmail.com>

As a comment to Chris answer: Instagram uses RabbitMQ HA across
availability zones: https://twitter.com/rbranson/status/310461932618534913

More details about their setup here:
http://blogs.vmware.com/vfabric/2013/04/how-instagram-feeds-work-celery-and-rabbitmq.html


On Thu, Aug 22, 2013 at 10:20 PM, Chris <stuff at moesel.net> wrote:

> Hi Jon,
>
> I'm not 100% familiar with Amazon's availability zones and how they work,
> but... it sounds to me like they are in different locations and different
> networks?  If so, clustering is probably not a good idea in this case.
>  See: http://www.rabbitmq.com/partitions.html
>
> I don't know if this is the cause for the issues you've seen, but it may
> be the cause of issues in the future...  On the other hand, if I am wrong
> about availabity zones, then you can safely disregard this message! ;-)
>
> -Chris
>
>
>
> On Thu, Aug 22, 2013 at 3:17 PM, Jon Dokulil <jondokulil at gmail.com> wrote:
>
>> We've seen this happen twice now and each time it's been a pain to work
>> around (we ended up creating a whole new cluster each time). Here's the
>> scenario we have seen:
>>
>> Our setup:
>>
>>    1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each
>>    node is in a different availability zone in the US-EAST region on AWS.
>>    We'll call them nodes A, B, and C
>>    2. Each queue is using an HA policy
>>    3. All queues are durable
>>    4. We Basic.Publish with DeliveryMode=2
>>    5. All clients are initially connected to node A
>>
>> The scenario:
>>
>>    1. Node A is shutdown (the last time I did it via 'sudo
>>    /etc/init.d/rabbitmq-server stop
>>    2. All connected clients see the shutdown and successfully transition
>>    to using one of the other nodes. About half connect to node B and the other
>>    half connect to node C
>>    3. We notice that a few of the queues still show their "node" as
>>    being node A, even though it is not currently running.
>>    4. Node A is brought back online. The RabbitMQ management console
>>    (webapp) shows everything is fine on the homepage.
>>    5. When A comes back online, those queues that show A as their 'node'
>>    now show zero mirrors.
>>    6. I attempt to delete the queue via the management webapp. At that
>>    point all three nodes become 100% unresponsive. The management webapp fails
>>    to respond and all communication in our application stops. CPU fluctuates
>>    between 10-40% on but memory doesn't seem to be leaking. It's difficult to
>>    know what is happening because rabbitmqctl is also unresponsive. Attempts
>>    to gracefully stop the nodes all hang.
>>
>> Does anybody have experience with this? What additional information
>> should I provide? It's causing a lot of stress and confuses the heck out of
>> me. Any guidance is much appreciated.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/cf59667f/attachment.htm>

From jondokulil at gmail.com  Fri Aug 23 00:25:50 2013
From: jondokulil at gmail.com (Jon Dokulil)
Date: Thu, 22 Aug 2013 16:25:50 -0700 (PDT)
Subject: [rabbitmq-discuss] A three-node cluster hangs completely in ec2
In-Reply-To: <CAMcAHLVufZzyJcGhQ1WErJyGSRx1_hrinkdzEAV4HL3BTQ+ZRA@mail.gmail.com>
References: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
	<CAHEpgBD3mKdKTYVqCC3mNkMGJD8RH3v2AOYfSGPEC-Px3j8a2g@mail.gmail.com>
	<CAMcAHLVufZzyJcGhQ1WErJyGSRx1_hrinkdzEAV4HL3BTQ+ZRA@mail.gmail.com>
Message-ID: <916a9ccf-6f4b-4ead-a281-56f21f59019e@googlegroups.com>

@Chris - that is a valid point. AZs are physically separate locations, 
however Amazon did specifically design them to "feel" like the same 
network. They located them close enough geographically (within something 
like 10-50 miles) to achieve normal latency of <1ms. Network partitions are 
a normal part of life in the AWS world.

Either way - in my case I think the fact that I'm spread across three AZs 
isn't relevant. I have a three-node cluster, stopped and then started a 
single node in the cluster, then deleted a queue... which caused the entire 
cluster to become unavailable.

On Thursday, August 22, 2013 2:10:10 PM UTC-7, Alvaro Videla wrote:
>
> As a comment to Chris answer: Instagram uses RabbitMQ HA across 
> availability zones: https://twitter.com/rbranson/status/310461932618534913
>
> More details about their setup here: 
> http://blogs.vmware.com/vfabric/2013/04/how-instagram-feeds-work-celery-and-rabbitmq.html
>
>
> On Thu, Aug 22, 2013 at 10:20 PM, Chris <st... at moesel.net <javascript:>>wrote:
>
>> Hi Jon,
>>
>> I'm not 100% familiar with Amazon's availability zones and how they work, 
>> but... it sounds to me like they are in different locations and different 
>> networks?  If so, clustering is probably not a good idea in this case. 
>>  See: http://www.rabbitmq.com/partitions.html
>>
>> I don't know if this is the cause for the issues you've seen, but it may 
>> be the cause of issues in the future...  On the other hand, if I am wrong 
>> about availabity zones, then you can safely disregard this message! ;-)
>>
>> -Chris
>>
>>
>>
>> On Thu, Aug 22, 2013 at 3:17 PM, Jon Dokulil <jondo... at gmail.com<javascript:>
>> > wrote:
>>
>>> We've seen this happen twice now and each time it's been a pain to work 
>>> around (we ended up creating a whole new cluster each time). Here's the 
>>> scenario we have seen:
>>>
>>> Our setup:
>>>
>>>    1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each 
>>>    node is in a different availability zone in the US-EAST region on AWS. 
>>>    We'll call them nodes A, B, and C 
>>>    2. Each queue is using an HA policy
>>>    3. All queues are durable
>>>    4. We Basic.Publish with DeliveryMode=2 
>>>    5. All clients are initially connected to node A
>>>
>>> The scenario:
>>>
>>>    1. Node A is shutdown (the last time I did it via 'sudo 
>>>    /etc/init.d/rabbitmq-server stop 
>>>    2. All connected clients see the shutdown and successfully 
>>>    transition to using one of the other nodes. About half connect to node B 
>>>    and the other half connect to node C
>>>    3. We notice that a few of the queues still show their "node" as 
>>>    being node A, even though it is not currently running. 
>>>    4. Node A is brought back online. The RabbitMQ management console 
>>>    (webapp) shows everything is fine on the homepage.
>>>    5. When A comes back online, those queues that show A as their 
>>>    'node' now show zero mirrors. 
>>>    6. I attempt to delete the queue via the management webapp. At that 
>>>    point all three nodes become 100% unresponsive. The management webapp fails 
>>>    to respond and all communication in our application stops. CPU fluctuates 
>>>    between 10-40% on but memory doesn't seem to be leaking. It's difficult to 
>>>    know what is happening because rabbitmqctl is also unresponsive. Attempts 
>>>    to gracefully stop the nodes all hang. 
>>>
>>> Does anybody have experience with this? What additional information 
>>> should I provide? It's causing a lot of stress and confuses the heck out of 
>>> me. Any guidance is much appreciated.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq... at lists.rabbitmq.com <javascript:>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com <javascript:>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/f1639687/attachment.htm>

From jondokulil at gmail.com  Fri Aug 23 00:26:30 2013
From: jondokulil at gmail.com (Jon Dokulil)
Date: Thu, 22 Aug 2013 16:26:30 -0700 (PDT)
Subject: [rabbitmq-discuss] A three-node cluster hangs completely in ec2
In-Reply-To: <CAMcAHLVufZzyJcGhQ1WErJyGSRx1_hrinkdzEAV4HL3BTQ+ZRA@mail.gmail.com>
References: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
	<CAHEpgBD3mKdKTYVqCC3mNkMGJD8RH3v2AOYfSGPEC-Px3j8a2g@mail.gmail.com>
	<CAMcAHLVufZzyJcGhQ1WErJyGSRx1_hrinkdzEAV4HL3BTQ+ZRA@mail.gmail.com>
Message-ID: <5513d2a0-0171-4f35-a2b8-611d2bce0bef@googlegroups.com>

@Alvaro - thanks for the link, that's an interesting article.

On Thursday, August 22, 2013 2:10:10 PM UTC-7, Alvaro Videla wrote:
>
> As a comment to Chris answer: Instagram uses RabbitMQ HA across 
> availability zones: https://twitter.com/rbranson/status/310461932618534913
>
> More details about their setup here: 
> http://blogs.vmware.com/vfabric/2013/04/how-instagram-feeds-work-celery-and-rabbitmq.html
>
>
> On Thu, Aug 22, 2013 at 10:20 PM, Chris <st... at moesel.net <javascript:>>wrote:
>
>> Hi Jon,
>>
>> I'm not 100% familiar with Amazon's availability zones and how they work, 
>> but... it sounds to me like they are in different locations and different 
>> networks?  If so, clustering is probably not a good idea in this case. 
>>  See: http://www.rabbitmq.com/partitions.html
>>
>> I don't know if this is the cause for the issues you've seen, but it may 
>> be the cause of issues in the future...  On the other hand, if I am wrong 
>> about availabity zones, then you can safely disregard this message! ;-)
>>
>> -Chris
>>
>>
>>
>> On Thu, Aug 22, 2013 at 3:17 PM, Jon Dokulil <jondo... at gmail.com<javascript:>
>> > wrote:
>>
>>> We've seen this happen twice now and each time it's been a pain to work 
>>> around (we ended up creating a whole new cluster each time). Here's the 
>>> scenario we have seen:
>>>
>>> Our setup:
>>>
>>>    1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each 
>>>    node is in a different availability zone in the US-EAST region on AWS. 
>>>    We'll call them nodes A, B, and C 
>>>    2. Each queue is using an HA policy
>>>    3. All queues are durable
>>>    4. We Basic.Publish with DeliveryMode=2 
>>>    5. All clients are initially connected to node A
>>>
>>> The scenario:
>>>
>>>    1. Node A is shutdown (the last time I did it via 'sudo 
>>>    /etc/init.d/rabbitmq-server stop 
>>>    2. All connected clients see the shutdown and successfully 
>>>    transition to using one of the other nodes. About half connect to node B 
>>>    and the other half connect to node C
>>>    3. We notice that a few of the queues still show their "node" as 
>>>    being node A, even though it is not currently running. 
>>>    4. Node A is brought back online. The RabbitMQ management console 
>>>    (webapp) shows everything is fine on the homepage.
>>>    5. When A comes back online, those queues that show A as their 
>>>    'node' now show zero mirrors. 
>>>    6. I attempt to delete the queue via the management webapp. At that 
>>>    point all three nodes become 100% unresponsive. The management webapp fails 
>>>    to respond and all communication in our application stops. CPU fluctuates 
>>>    between 10-40% on but memory doesn't seem to be leaking. It's difficult to 
>>>    know what is happening because rabbitmqctl is also unresponsive. Attempts 
>>>    to gracefully stop the nodes all hang. 
>>>
>>> Does anybody have experience with this? What additional information 
>>> should I provide? It's causing a lot of stress and confuses the heck out of 
>>> me. Any guidance is much appreciated.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq... at lists.rabbitmq.com <javascript:>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com <javascript:>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/3594ad11/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 23 00:41:35 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 23 Aug 2013 00:41:35 +0100
Subject: [rabbitmq-discuss] A three-node cluster hangs completely in ec2
In-Reply-To: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
References: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
Message-ID: <5216A1AF.2090805@rabbitmq.com>

Jon,

On 22/08/13 20:17, Jon Dokulil wrote:
> We've seen this happen twice now and each time it's been a pain to work
> around (we ended up creating a whole new cluster each time). Here's the
> scenario we have seen:
>
> Our setup:
>
>  1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each
>     node is in a different availability zone in the US-EAST region on
>     AWS. We'll call them nodes A, B, and C
>  2. Each queue is using an HA policy
>  3. All queues are durable
>  4. We Basic.Publish with DeliveryMode=2
>  5. All clients are initially connected to node A
>
> The scenario:
>
>  1. Node A is shutdown (the last time I did it via 'sudo
>     /etc/init.d/rabbitmq-server stop
>  2. All connected clients see the shutdown and successfully transition
>     to using one of the other nodes. About half connect to node B and
>     the other half connect to node C
>  3. We notice that a few of the queues still show their "node" as being
>     node A, even though it is not currently running.
>  4. Node A is brought back online. The RabbitMQ management console
>     (webapp) shows everything is fine on the homepage.
>  5. When A comes back online, those queues that show A as their 'node'
>     now show zero mirrors.
>  6. I attempt to delete the queue via the management webapp. At that
>     point all three nodes become 100% unresponsive. The management
>     webapp fails to respond and all communication in our application
>     stops. CPU fluctuates between 10-40% on but memory doesn't seem to
>     be leaking. It's difficult to know what is happening because
>     rabbitmqctl is also unresponsive. Attempts to gracefully stop the
>     nodes all hang.

Is this reproducible at will?

If so, please grab the RabbitMQ log files (both the normal and the sasl 
log) from all nodes, post them and indicate at what time you performed 
each of the above steps, so we can correlate that with log entries.

Regards,

Matthias.

From wangjunbo924 at gmail.com  Fri Aug 23 03:14:54 2013
From: wangjunbo924 at gmail.com (Junius Wang)
Date: Fri, 23 Aug 2013 10:14:54 +0800
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
In-Reply-To: <1CC19277-0A54-4D4B-AB59-591990BEDA67@gopivotal.com>
References: <1217501ce9425$026e58d0$074b0a70$@gmail.com>
	<062d01ce9ee5$f181d440$d4857cc0$@gmail.com>
	<1CC19277-0A54-4D4B-AB59-591990BEDA67@gopivotal.com>
Message-ID: <07bc01ce9fa6$91259570$b370c050$@gmail.com>

Thanks your guys.  It really helps us a lot understanding the mirror queues.


In our test scenarios, we actually always set an mirrored queues with
ha-mode "exactly" on 2 nodes.  I'd like to provide some details:
Before every test ( after a new RabbitMQ node added/removed to the cluster):
1).we reset the policy to "exactly" on 2 nodes. 2). declared 10 queues using
rabbitmqctl and force them distributed evenly on all nodes.  e.g.in a 2 node
cluster,5 queues resides on rabbit1, another 5 resides on rabbit2. 3-3-4 for
3 node cluster ,3-3-2-2 for 4 node cluster.   3) declare a 'topic" exchange
4) binding the 10 queues to the exchange with 10 different routing keys.
Publishers publish messages with the 10 routing keys by turns. Thus all
queues receive the same number of messages.  
Is the number of queues large enough?  we can declare more queues in test
but I don't think there will be too many queues in production.  

publishers connect to the cluster via load balancer(AWS ELB) as well as
consumers, they don't know to which node they are connect.  So we may not
decrease the intra-cluster traffic. But  we can try some high bandwidth
instances. Does this help?
 Another question is that we will have a queue with lots of messages
handled, perhaps 5000/sec(size of 2K), which is about 90% of the total
messages handled by the cluster.  It's hard for us to split it into multiple
queues, it's really a big design change which we try to avoid. From your
comments, even if messages are synchronized on only 2 nodes , hardly we can
get linear scaling , right?  If so, is the network traffic the major factor
impacting the performance?  If so ,we can try some high bandwidth instances
or using AWS instance group. Hopes that will get better performance.


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael
Klishin
Sent: Thursday, August 22, 2013 4:56 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] questions about RabbitMQ linear scalability

Junius Wang:

> 1.       The throughput of two node cluster is 50%-60% worse than a single
node broker.

With mirroring, messages have to be copied to multiple (N or, depending on
configuration, even all) nodes in the cluster. That obviously takes more
time than not copying anything.

> 2.       Adding more node did have improvement on throughput but we only
got 25% improvement(throughput of 3 node cluster is 25% better than 2 node
cluster. 4 node cluster is 25% better than 3 node cluster too). What we
expected is a 45-degree line, that means when 2 nodes are used the
throughput is double. With 3 nodes, then triple.

You are not providing any details about your workload but the way you extend
capacity with RabbitMQ is by adding nodes and using more queues. Queue
mirroring is an HA feature, which means copying more data across the
cluster.

Maximum throughput and highest availability are largely at odds with each
other, so you need to

1. Use multiple queues (and the number should grow with the number of nodes)
2. Choose what queues to mirror. Likely not all queues are equally important
to your system, so you can make some of them non-HA.
3. Configure mirroring to, say, 2 nodes instead of "all".
4. If you know what node is the master for a particular queue (e.g. was
declared on that node),
     make your clients connect there. It will decrease intra-cluster
traffic.
--
MK



From david.tinker at gmail.com  Fri Aug 23 07:16:14 2013
From: david.tinker at gmail.com (David Tinker)
Date: Fri, 23 Aug 2013 08:16:14 +0200
Subject: [rabbitmq-discuss] ANN QDB 0.4.7 released
Message-ID: <CA+O6_FdS+0rThKW0-QrZeP1S=h6o+Zp4tgnjTbpe1ETtU_9SHA@mail.gmail.com>

Release Notes:
- Added limit parameter to outputs to stop after outputting a certain
number of messages. Use limit to avoid overloading a RabbitMQ server
when restoring or replaying messages from a QDB queue,

http://qdb.io/ Persistent Message Queues With Replay and #RabbitMQ Integration

From liam.reilly.1 at gmail.com  Fri Aug 23 09:39:30 2013
From: liam.reilly.1 at gmail.com (Liam Reilly)
Date: Fri, 23 Aug 2013 01:39:30 -0700 (PDT)
Subject: [rabbitmq-discuss] A three-node cluster hangs completely in ec2
In-Reply-To: <CAMcAHLVufZzyJcGhQ1WErJyGSRx1_hrinkdzEAV4HL3BTQ+ZRA@mail.gmail.com>
References: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
	<CAHEpgBD3mKdKTYVqCC3mNkMGJD8RH3v2AOYfSGPEC-Px3j8a2g@mail.gmail.com>
	<CAMcAHLVufZzyJcGhQ1WErJyGSRx1_hrinkdzEAV4HL3BTQ+ZRA@mail.gmail.com>
Message-ID: <ffbffbe5-56d0-4fd5-9dd9-ee51a9809a67@googlegroups.com>

That's a great article!

On Thursday, 22 August 2013 22:10:10 UTC+1, Alvaro Videla wrote:
>
> As a comment to Chris answer: Instagram uses RabbitMQ HA across 
> availability zones: https://twitter.com/rbranson/status/310461932618534913
>
> More details about their setup here: 
> http://blogs.vmware.com/vfabric/2013/04/how-instagram-feeds-work-celery-and-rabbitmq.html
>
>
> On Thu, Aug 22, 2013 at 10:20 PM, Chris <st... at moesel.net <javascript:>>wrote:
>
>> Hi Jon,
>>
>> I'm not 100% familiar with Amazon's availability zones and how they work, 
>> but... it sounds to me like they are in different locations and different 
>> networks?  If so, clustering is probably not a good idea in this case. 
>>  See: http://www.rabbitmq.com/partitions.html
>>
>> I don't know if this is the cause for the issues you've seen, but it may 
>> be the cause of issues in the future...  On the other hand, if I am wrong 
>> about availabity zones, then you can safely disregard this message! ;-)
>>
>> -Chris
>>
>>
>>
>> On Thu, Aug 22, 2013 at 3:17 PM, Jon Dokulil <jondo... at gmail.com<javascript:>
>> > wrote:
>>
>>> We've seen this happen twice now and each time it's been a pain to work 
>>> around (we ended up creating a whole new cluster each time). Here's the 
>>> scenario we have seen:
>>>
>>> Our setup:
>>>
>>>    1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each 
>>>    node is in a different availability zone in the US-EAST region on AWS. 
>>>    We'll call them nodes A, B, and C 
>>>    2. Each queue is using an HA policy
>>>    3. All queues are durable
>>>    4. We Basic.Publish with DeliveryMode=2 
>>>    5. All clients are initially connected to node A
>>>
>>> The scenario:
>>>
>>>    1. Node A is shutdown (the last time I did it via 'sudo 
>>>    /etc/init.d/rabbitmq-server stop 
>>>    2. All connected clients see the shutdown and successfully 
>>>    transition to using one of the other nodes. About half connect to node B 
>>>    and the other half connect to node C
>>>    3. We notice that a few of the queues still show their "node" as 
>>>    being node A, even though it is not currently running. 
>>>    4. Node A is brought back online. The RabbitMQ management console 
>>>    (webapp) shows everything is fine on the homepage.
>>>    5. When A comes back online, those queues that show A as their 
>>>    'node' now show zero mirrors. 
>>>    6. I attempt to delete the queue via the management webapp. At that 
>>>    point all three nodes become 100% unresponsive. The management webapp fails 
>>>    to respond and all communication in our application stops. CPU fluctuates 
>>>    between 10-40% on but memory doesn't seem to be leaking. It's difficult to 
>>>    know what is happening because rabbitmqctl is also unresponsive. Attempts 
>>>    to gracefully stop the nodes all hang. 
>>>
>>> Does anybody have experience with this? What additional information 
>>> should I provide? It's causing a lot of stress and confuses the heck out of 
>>> me. Any guidance is much appreciated.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq... at lists.rabbitmq.com <javascript:>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com <javascript:>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/3d8adf83/attachment.htm>

From emile at rabbitmq.com  Fri Aug 23 09:49:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 23 Aug 2013 09:49:33 +0100
Subject: [rabbitmq-discuss] A three-node cluster hangs completely in ec2
In-Reply-To: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
References: <d3dc6a40-4694-485f-89ec-fc3e4a235b32@googlegroups.com>
Message-ID: <5217221D.5070502@rabbitmq.com>


Hi Jon,

On 22/08/13 20:17, Jon Dokulil wrote:

>  2. Each queue is using an HA policy

Which HA policy are they using? (all/exactly/nodes)

>  3. We notice that a few of the queues still show their "node" as being
>     node A, even though it is not currently running.

>  5. When A comes back online, those queues that show A as their 'node'
>     now show zero mirrors.

What do you mean by "their node"? How did you determine this? What was
the output of "rabbitmqctl cluster_status" when A started up?

>  6. I attempt to delete the queue via the management webapp. At that
>     point all three nodes become 100% unresponsive.

Do nodes still accept connections on port 5672?

> Does anybody have experience with this? What additional information
> should I provide? It's causing a lot of stress and confuses the heck out
> of me. Any guidance is much appreciated.

Are there any errors in the logfiles? The logfiles and sasl logs of all
3 brokers may help to determine the cause.

Please provide the output of "rabbitmqctl report" from just before the
brokers becomes unresponsive.

Can you reproduce the issue 100% reliably, and does this only happen on EC2?




-Emile






From matthias at rabbitmq.com  Fri Aug 23 10:17:04 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 23 Aug 2013 10:17:04 +0100
Subject: [rabbitmq-discuss] Enabling publisher confirms damages
 performance by a factor of 10x
In-Reply-To: <1376904909257-28914.post@n5.nabble.com>
References: <1376904909257-28914.post@n5.nabble.com>
Message-ID: <52172890.9090401@rabbitmq.com>

On 19/08/13 10:35, ModronMaze wrote:
> I tried to use publisher confirms to ensure my messages are not lost, but
> encountered a performance issue. My test case is as follows:
>
> 1. One publisher sends 200.000 messages in a loop and asynchronously marks
> them as confirmed.
> 2. One consumer reads messages from queue, executes some work (db access,
> sends other messages etc)
> 3. Prefetch is set to 512.
> 4. Queue and messages are durable/persistent.
> 5. I tried using versions 3.0.2, 3.1.4, 3.1.5
>
> Without using publisher confirms I publish at least *250 msg/s* (and ack
> with the same speed). Queue contains only prefetched messages.
>
> When I enable confirms (separate channel and connection - only for sending
> messages that require it) speed drops to *15-25 msg/s*. Using management API
> I found out that publisher's connection is constantly blocked by flow
> control.
> I think it is strange, because all messages are consumed as soon as they
> enter a queue.

The messages still need to be written to disk (modulo any internal 
optimisations) since the broker needs to take responsibility for them 
until they get acknowledged.

The performance you are seeing is what I'd expect when publishers wait 
for confirmation after every single message. But you say above that 
publishers mark messages as confirmed "asynchronously", so presumably 
you are not doing that.

Here's a test using MulticastMain (which ships with the Java client), 
which I believe reproduces your test case exactly, except that the 
consumer is not doing any work and the messages are 1k in size (you 
didn't indicate how large the messages are, so I just guessed).

$ runjava.sh com.rabbitmq.examps.MulticastMain -f persistent -c 1000 -q 
512 -C 200000 -s 1024 -i 10
starting consumer #0
starting producer #0
...
time: 50.493s, sent: 1999 msg/s, confirmed: 2000 msg/s, nacked: 0 msg/s, 
received: 1546 msg/s, min/avg/max latency: 9165385/11000052/11717636 
microseconds
...
time: 70.532s, sent: 1954 msg/s, confirmed: 1979 msg/s, nacked: 0 msg/s, 
received: 1559 msg/s, min/avg/max latency: 13392164/15317946/16613307 
microseconds
...

As you can see, this results in a sending rate of about 2kHz and a 
receiving rate of about 1.5kHz.

Running the same test with "synchronous" confirm, i.e. waiting for a 
confirm after every message ("-c 1"), drops the rate to about 10Hz.


Regards,

Matthias.

From emile at rabbitmq.com  Fri Aug 23 10:31:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 23 Aug 2013 10:31:40 +0100
Subject: [rabbitmq-discuss] Unable to access management portal after
 upgarding erlang and RabbitMQ
In-Reply-To: <2dc98c94.000002d4.0000000b@KAPILPC.vmware.com>
References: <2dc98c94.000002d4.0000000b@KAPILPC.vmware.com>
Message-ID: <52172BFC.2080705@rabbitmq.com>

On 20/08/13 02:15, Kapil Goyal wrote:
> I upgraded to Erlang R16B01 and RabbitMQ 3.1.5 and cannot access
> management portal anymore. I have been using SSL and port 15671 for
> management portal. I get this error:
> 
> On Chrome: Error 141 (net::ERR_SSL_CLIENT_AUTH_SIGNATURE_FAILED):
> Unknown error.
> 
> On Firefox: The key does not support the requested operation. (Error
> code: sec_error_invalid_key)
> 
> I did not change the RabbitMQ configuration or the SSL certificates,
> only upgraded the software.


From mklishin at gopivotal.com  Fri Aug 23 12:45:17 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 Aug 2013 15:45:17 +0400
Subject: [rabbitmq-discuss] Reg:Heart Beat Lost
In-Reply-To: <BAY176-W81958B8E7C133A23FD2F9EC4D0@phx.gbl>
References: <BAY176-W11C47150638715D5A3896DEC4C0@phx.gbl>, , ,
	<76B9E19F-5213-4693-B899-E5A7FEB5EE62@gopivotal.com>, ,
	<BAY176-W136766E438177379F95C15EC4D0@phx.gbl>, , ,
	<CF33E2B1-0703-46B1-ADF9-13C69E354CF2@gopivotal.com>, ,
	<BAY176-W321531EA8C7F78853EA1B6EC4D0@phx.gbl>, ,
	<BD8A03E2-2CE2-4810-A3E2-7A7298F04768@gopivotal.com>,
	<BAY176-W4652B1D8CA08BE2A179F61EC4D0@phx.gbl>,
	<679611CE-55C9-424D-9474-05CB4E42A971@gopivotal.com>
	<BAY176-W81958B8E7C133A23FD2F9EC4D0@phx.gbl>
Message-ID: <7318BE73-C68F-4A5E-BA3E-89CDF6E2E72D@gopivotal.com>

Aathithyan SR:

> I am using Net::RabbitFoot in perl

I'm being told that Net::RabbitFoot does support heartbeats.

Can you post a code snippet that demonstrates how you connect to RabbitMQ
with heartbeats enabled?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/4cf05e31/attachment.pgp>

From verenate at verenate.com  Fri Aug 23 12:57:10 2013
From: verenate at verenate.com (Guillaume Vernat)
Date: Fri, 23 Aug 2013 13:57:10 +0200
Subject: [rabbitmq-discuss] File descriptors slowly reaching 1024...
Message-ID: <CAJaPRW4EhUkC-2QQpbZ04w98C5cAM6ifPqGDwRiSWFWcVZZZ+w@mail.gmail.com>

Hy,

How to reduce used file descriptors with rabbimq 3.0.x cluster ? Master is
slowly reaching 1024. Help say that it doesnt matter but I dislike this
yellow color and I do prefer the green one :)

Guillaume.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/87a7ed83/attachment.htm>

From mklishin at gopivotal.com  Fri Aug 23 13:03:19 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 Aug 2013 16:03:19 +0400
Subject: [rabbitmq-discuss] File descriptors slowly reaching 1024...
In-Reply-To: <CAJaPRW4EhUkC-2QQpbZ04w98C5cAM6ifPqGDwRiSWFWcVZZZ+w@mail.gmail.com>
References: <CAJaPRW4EhUkC-2QQpbZ04w98C5cAM6ifPqGDwRiSWFWcVZZZ+w@mail.gmail.com>
Message-ID: <0488D8FF-DCA7-408A-9A35-F143E0D98A90@gopivotal.com>

Guillaume Vernat:

> How to reduce used file descriptors with rabbimq 3.0.x cluster ? Master is slowly reaching 1024. Help say that it doesnt matter but I dislike this yellow color and I do prefer the green one :)

Guillaume,

You can keep fewer connections open but you really should increase open file descriptors limit
for the rabbitmq user instead:

http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/#Changing-the-limit
https://cs.uwaterloo.ca/~brecht/servers/openfiles.html
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/41063ddf/attachment.pgp>

From demesg at gmail.com  Fri Aug 23 15:52:40 2013
From: demesg at gmail.com (ku3ia)
Date: Fri, 23 Aug 2013 07:52:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <4FDF3B75.6010703@rabbitmq.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
Message-ID: <1377269560927-29046.post@n5.nabble.com>

Hi! I have the same problem. I'm on v. 3.1.5 and haproxy 1.4.18. But my
haproxy and rabbitmq server is on the same machine. I had removed any
servers and leave config as is:

/etc/haproxy/haproxy.cfg
# this config needs haproxy-1.1.28 or haproxy-1.2.1

global
  log 127.0.0.1 local0
  log 127.0.0.1 local1 notice
  #log loghost local0 info
  maxconn 4096
  #chroot /usr/share/haproxy
  user haproxy
  group haproxy
  daemon
  #debug
  #quiet

defaults
  log global
  mode tcp
  option tcplog
  option dontlognull
  retries 3
  option redispatch
  maxconn 2000
  contimeout 5000
  clitimeout 50000
  srvtimeout 50000

listen rabbitmq 0.0.0.0:5670
  mode tcp
  balance leastconn
  server server1 127.0.0.1:5672 check inter 3000 downinter 500

listen stat :80
  mode http
  option httplog
  stats enable
  stats uri /admin/stat
  stats refresh 30s

I'm using .NET client. Starting connection... stating channel. Look at the
management module. Its all ok. But after some seconds, may be 10 or more on
Overview section there are no more connections.

When I'm connecting direct to rabbitmq server without HAProxy everything
looks fine, no losts! Please advice. Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Suddenly-dropping-all-conns-tp16885p29046.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Aug 23 15:55:37 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 Aug 2013 18:55:37 +0400
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <1377269560927-29046.post@n5.nabble.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
Message-ID: <52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>

ku3ia:

> Overview section there are no more connections.
> 
> When I'm connecting direct to rabbitmq server without HAProxy everything
> looks fine, no losts! Please advice. Thanks.

Can you please post your RabbitMQ log file fragment right after the issue
happens? (feel free to annotate the log)
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/6a08f248/attachment.pgp>

From demesg at gmail.com  Fri Aug 23 16:30:37 2013
From: demesg at gmail.com (ku3ia)
Date: Fri, 23 Aug 2013 08:30:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
Message-ID: <1377271837123-29048.post@n5.nabble.com>

I had restarted server, haproxy and xonnected again. Here the log:
...
=INFO REPORT==== 23-Aug-2013::18:18:12 ===
accepting AMQP connection <0.323.0> (127.0.0.1:50367 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:12 ===
closing AMQP connection <0.323.0> (127.0.0.1:50367 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:15 ===
accepting AMQP connection <0.329.0> (127.0.0.1:50368 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:15 ===
closing AMQP connection <0.329.0> (127.0.0.1:50368 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:18 ===
accepting AMQP connection <0.333.0> (127.0.0.1:50369 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:18 ===
closing AMQP connection <0.333.0> (127.0.0.1:50369 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:18 ===
accepting AMQP connection <0.337.0> (127.0.0.1:50370 -> 127.0.0.1:5672)

=INFO REPORT==== 23-Aug-2013::18:18:21 ===
accepting AMQP connection <0.351.0> (127.0.0.1:50371 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:21 ===
closing AMQP connection <0.351.0> (127.0.0.1:50371 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:24 ===
accepting AMQP connection <0.356.0> (127.0.0.1:50372 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:24 ===
closing AMQP connection <0.356.0> (127.0.0.1:50372 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:27 ===
accepting AMQP connection <0.361.0> (127.0.0.1:50373 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:27 ===
closing AMQP connection <0.361.0> (127.0.0.1:50373 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:30 ===
accepting AMQP connection <0.367.0> (127.0.0.1:50374 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:30 ===
closing AMQP connection <0.367.0> (127.0.0.1:50374 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:33 ===
accepting AMQP connection <0.372.0> (127.0.0.1:50375 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:33 ===
closing AMQP connection <0.372.0> (127.0.0.1:50375 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:36 ===
accepting AMQP connection <0.378.0> (127.0.0.1:50376 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:36 ===
closing AMQP connection <0.378.0> (127.0.0.1:50376 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:39 ===
accepting AMQP connection <0.383.0> (127.0.0.1:50377 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:39 ===
closing AMQP connection <0.383.0> (127.0.0.1:50377 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:42 ===
accepting AMQP connection <0.389.0> (127.0.0.1:50378 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:42 ===
closing AMQP connection <0.389.0> (127.0.0.1:50378 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:45 ===
accepting AMQP connection <0.395.0> (127.0.0.1:50379 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:45 ===
closing AMQP connection <0.395.0> (127.0.0.1:50379 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:48 ===
accepting AMQP connection <0.399.0> (127.0.0.1:50380 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:48 ===
closing AMQP connection <0.399.0> (127.0.0.1:50380 -> 127.0.0.1:5672):
connection_closed_abruptly

=ERROR REPORT==== 23-Aug-2013::18:18:49 ===
closing AMQP connection <0.337.0> (127.0.0.1:50370 -> 127.0.0.1:5672):
{heartbeat_timeout,running}

=INFO REPORT==== 23-Aug-2013::18:18:51 ===
accepting AMQP connection <0.406.0> (127.0.0.1:50381 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:51 ===
closing AMQP connection <0.406.0> (127.0.0.1:50381 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 23-Aug-2013::18:18:54 ===
accepting AMQP connection <0.411.0> (127.0.0.1:50382 -> 127.0.0.1:5672)

=WARNING REPORT==== 23-Aug-2013::18:18:54 ===
closing AMQP connection <0.411.0> (127.0.0.1:50382 -> 127.0.0.1:5672):
connection_closed_abruptly
...

As I see every 3 seconds, like in haproxy config file, but why it closes?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Suddenly-dropping-all-conns-tp16885p29048.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Aug 23 16:38:19 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 Aug 2013 19:38:19 +0400
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <1377271837123-29048.post@n5.nabble.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
	<1377271837123-29048.post@n5.nabble.com>
Message-ID: <B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>

ku3ia:

> =ERROR REPORT==== 23-Aug-2013::18:18:49 ===
> closing AMQP connection <0.337.0> (127.0.0.1:50370 -> 127.0.0.1:5672):
> {heartbeat_timeout,running}

This means a connection was closed because of missed heartbeats. By defaults heartbeat
timeout value is something like 30 minutes, did you override it to be a few seconds?

> =WARNING REPORT==== 23-Aug-2013::18:18:51 ===
> closing AMQP connection <0.406.0> (127.0.0.1:50381 -> 127.0.0.1:5672):
> connection_closed_abruptly

This means HAproxy closed TCP connection before the client could properly close
AMQP 0-9-1 connection.

To me this looks like a combination of proxy and heartbeat (mis)configuration.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/388f5bbb/attachment.pgp>

From demesg at gmail.com  Fri Aug 23 16:44:35 2013
From: demesg at gmail.com (ku3ia)
Date: Fri, 23 Aug 2013 08:44:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
	<1377271837123-29048.post@n5.nabble.com>
	<B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>
Message-ID: <1377272675467-29050.post@n5.nabble.com>

Michael, thanks for your post. My Heartbeat parameter is 10 seconds. Ok, I'll
try to set the same check inter and heartbeat parameters.

Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Suddenly-dropping-all-conns-tp16885p29050.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Aug 23 16:46:53 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 Aug 2013 19:46:53 +0400
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <1377272675467-29050.post@n5.nabble.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
	<1377271837123-29048.post@n5.nabble.com>
	<B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>
	<1377272675467-29050.post@n5.nabble.com>
Message-ID: <B389F8D3-44FE-4FC4-8E38-73223774FE60@gopivotal.com>

ku3ia:

> Michael, thanks for your post. My Heartbeat parameter is 10 seconds. Ok, I'll
> try to set the same check inter and heartbeat parameters.

This means that both Rabbit and clients will (try to) send them out about every 4 seconds,
to cover for some edge cases/race conditions.

I'd suggest investigating why client heartbeats do not get through the proxy.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/d85093fd/attachment.pgp>

From Andrew.Miller at sentry.com  Fri Aug 23 17:10:08 2013
From: Andrew.Miller at sentry.com (Miller Andrew)
Date: Fri, 23 Aug 2013 11:10:08 -0500
Subject: [rabbitmq-discuss] Header exchange filtering on Int32 numbers
Message-ID: <6DA47758DD70A84CAB1C2A6629FEC4D312A6621D@sho-p-excmbx-02.sentry.com>

I have a header exchange setup, with a durable queue bound to it with a blank routing key, and a single argument of "SourceEventCount=2", where 2 is specified as a Number.  When I publish to the exchange from the .Net client, if the SourceEventCount header value I add is an Int32, it doesn't get routed to the queue.  It only works if I cast the header value to an Int64.  Is this a bug, or am I doing something wrong?

RabbitMQ 3.1.3, Erlang R16B01, .Net client 3.1.0

This e-mail is confidential.  If you are not the intended recipient, you must not disclose or use the information contained in it.  If you have received this e-mail in error, please tell us immediately by return e-mail to Email. Control at sentry.com and delete the document.

E-mails containing unprofessional, discourteous or offensive remarks violate Sentry policy. You may report employee violations by forwarding the message to Email. Control at sentry.com.

No recipient may use the information in this e-mail in violation of any civil or criminal statute. Sentry disclaims all liability for any unauthorized uses of this e-mail or its contents.

This e-mail constitutes neither an offer nor an acceptance of any offer. No contract may be entered into by a Sentry employee without express approval from an authorized Sentry manager.

Warning: Computer viruses can be transmitted via e-mail. Sentry accepts no liability or responsibility for any damage caused by any virus transmitted with this e-mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/3a61db93/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 23 17:33:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 23 Aug 2013 17:33:27 +0100
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>,
	<CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>
Message-ID: <52178ED7.5040907@rabbitmq.com>

On 22/08/13 17:51, SAG - Jonathan Andr?s wrote:
> Yes, you are right, sorry, I did it in a hurry.
>
> But If i try with this:
>
> curl -i -v -u guest:guest -H "content-type:application/json" -XPUT -d'{"password":"secret","tags":"administrator"}' http://localhost:15672/api/users/newUser
>
>
> Now i get this:
>
> Error: bad_request, Reason: not_json.

The above works fine for me against 3.1.5 on Erlang R16B:

$ curl -i -v -u guest:guest -H "content-type:application/json" -XPUT 
-d'{"password":"secret","tags":"administrator"}' 
http://localhost:15672/api/users/newUser
* About to connect() to localhost port 15672 (#0)
*   Trying 127.0.0.1... connected
* Server auth using Basic with user 'guest'
 > PUT /api/users/newUser HTTP/1.1
 > Authorization: Basic Z3Vlc3Q6Z3Vlc3Q=
 > User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 
OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3
 > Host: localhost:15672
 > Accept: */*
 > content-type:application/json
 > Content-Length: 44
 >
* upload completely sent off: 44out of 44 bytes
< HTTP/1.1 204 No Content
HTTP/1.1 204 No Content
< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
< Date: Fri, 23 Aug 2013 16:28:43 GMT
Date: Fri, 23 Aug 2013 16:28:43 GMT
< Content-Type: application/json
Content-Type: application/json
< Content-Length: 0
Content-Length: 0

<
* Connection #0 to host localhost left intact
* Closing connection #0


Perhaps you are running a rabbit/erlang that is too old.


Regards,

Matthias.

From ra22597 at gmail.com  Fri Aug 23 17:32:09 2013
From: ra22597 at gmail.com (Richard Adams)
Date: Fri, 23 Aug 2013 09:32:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem installing on MacOSX?
Message-ID: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>

Hello, 
 I am a newcomer to RabbitMQ and tried to install version 3.1.5  on MacOSX  
10.5 using the instructions listed here:

https://www.rabbitmq.com/install-standalone-mac.html

which produced the following output:

sce-bio-c02080:sbin radams$ ./rabbitmq-server 
dyld: unknown required load command 0x80000022
./rabbitmq-server: line 94:  1956 Trace/BPT trap          ${ERL_DIR}erl -pa 
"$RABBITMQ_EBIN_ROOT" -boot "${CLEAN_BOOT_FILE}" -noinput -hidden -s 
rabbit_prelaunch -sname rabbitmqprelaunch$$ -extra "${RABBITMQ_NODENAME}"

Is there a minimum OS version for MacOSX? Realise 10.5 is a bit long in the 
tooth these days but if so it would be good if this was prominent on the 
download page.

Thanks 
Richard Adams

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/a52e528b/attachment.htm>

From mklishin at gopivotal.com  Fri Aug 23 19:08:28 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 Aug 2013 22:08:28 +0400
Subject: [rabbitmq-discuss] Problem installing on MacOSX?
In-Reply-To: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>
References: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>
Message-ID: <6824FBA1-081B-467D-8388-EE35AE944BBF@gopivotal.com>

Richard Adams:

> Is there a minimum OS version for MacOSX? Realise 10.5 is a bit long in the tooth these days but if so it would be good if this was prominent on the download page.

Richard,

It is likely because the bundled Erlang version was compiled against a more recent version.

Have you tried installing Erlang e.g. via Homebrew and then using a tarball?
Note that Homebrew rabbitmq formula also uses the standalone bundle.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/5b716a2d/attachment.pgp>

From videlalvaro at gmail.com  Fri Aug 23 19:09:10 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 23 Aug 2013 12:09:10 -0600
Subject: [rabbitmq-discuss] Problem installing on MacOSX?
In-Reply-To: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>
References: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>
Message-ID: <CAMcAHLVmkeKiLDQ8CwhpeovxUDDTzUh=RE7X=Wh_0n9JDE+d1Q@mail.gmail.com>

I don't have an old mac at hand now to test it and sincerely I don't
remember which version of Mac is used to build the tarball.

In any case. If you want to install Erlang on your own from here
https://www.erlang-solutions.com/downloads/download-erlang-otp then you can
easily run this tarball: http://www.rabbitmq.com/install-generic-unix.html


On Fri, Aug 23, 2013 at 10:32 AM, Richard Adams <ra22597 at gmail.com> wrote:

> Hello,
>  I am a newcomer to RabbitMQ and tried to install version 3.1.5  on
> MacOSX  10.5 using the instructions listed here:
>
> https://www.rabbitmq.com/install-standalone-mac.html
>
> which produced the following output:
>
> sce-bio-c02080:sbin radams$ ./rabbitmq-server
> dyld: unknown required load command 0x80000022
> ./rabbitmq-server: line 94:  1956 Trace/BPT trap          ${ERL_DIR}erl
> -pa "$RABBITMQ_EBIN_ROOT" -boot "${CLEAN_BOOT_FILE}" -noinput -hidden -s
> rabbit_prelaunch -sname rabbitmqprelaunch$$ -extra "${RABBITMQ_NODENAME}"
>
> Is there a minimum OS version for MacOSX? Realise 10.5 is a bit long in
> the tooth these days but if so it would be good if this was prominent on
> the download page.
>
> Thanks
> Richard Adams
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/562d5e3c/attachment.htm>

From Ron.Cordell at RelayHealth.com  Fri Aug 23 19:55:00 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron)
Date: Fri, 23 Aug 2013 18:55:00 +0000
Subject: [rabbitmq-discuss] Network partitions
Message-ID: <0B8CD6850421B745BE39BC5C7601923271FFA6DB@DDCEP50016.na.corp.mckesson.com>

Just curious about if people using RMQ clusters have issues with network partitions and what they've done to try to resolve them.

We're using RMQ 3.1.3 at the moment in a clustered configuration. We're not quite using it in a production capacity at this point. We are seeing nodes in the cluster declaring a network partition and we're in the process of trying to determine what's going on.

What have others done when seeing network partition issues like this?

To answer some up front questions:

  *   all nodes in the cluster are in the same network VLAN
  *   All nodes in the cluster are not on the same switch, necessarily, for HA reasons
  *   The cluster is behind an F5 load balancer that presents a VIP to the application

Cheers,

Ron Cordell

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/86a2b6a3/attachment.htm>

From mcintoshj at gmail.com  Fri Aug 23 22:21:37 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 23 Aug 2013 16:21:37 -0500
Subject: [rabbitmq-discuss] Queues disappeared after a cluster upgrade to
	3.1.5, Erlang R16B01
Message-ID: <CAD6m6fGJEKfOcsokTLOwLgOWibzdShf+5bxk6UjMH1h0-Y7-sg@mail.gmail.com>

We just upgraded our Alpha environment to 3.1.5 and Erlang R16B01.  In the
process, ALL of our queue definitions disappeared.  Checking logs, I get a
 whole lot of errors like the below (names redacted).  Thankfully, I can
auto-generate all the stuff again, but I'm having errors on my "upgrader"
node right now that is preventing it from even working - the webgui gives a
"ReferenceError: queue_length is not defined" error and doesn't display any
information. Note, I followed the instructions - picked an upgrader node,
shutdown all the other nodes in order, brought the "upgrader" node back
online, then the others in sequential order.  This has me really really
spooked though.

Any advice??
Thanks!
Jason

=ERROR REPORT==== 23-Aug-2013::15:37:50 ===
** Generic server <0.303.0> terminating
** Last message in was {'EXIT',<0.350.0>,normal}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"EXCHANGE">>,queue,
                           <<"QUEUE">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <0.303.0>,[],[],
                          [{vhost,<<"pca">>},
                           {name,<<"HA">>},
                           {pattern,<<"^(?!amq\\.).*">>},
                           {definition,[{<<"ha-mode">>,<<"all">>}]},
                           {priority,0}],
                          [{<0.261.0>,<0.260.0>},
                           {<0.308.0>,<0.260.0>},
                           {<0.299.0>,<0.258.0>},
                           {<0.562.0>,<0.561.0>}]},
                         none,false,rabbit_mirror_queue_master,
                         {state,
                          {resource,<<"EXCHANGE">>,queue,
                           <<"QUEUE">>},
                          <0.351.0>,<0.350.0>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,0,0,0},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           0,
                           {0,nil},
                           {0,nil},
                           {qistate,

"/data/rabbitmq/rabbitmq/mnesia/cluster/queues/8FHU53A729K2C3KLMS8XPVKJD",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            #Ref<0.0.0.1702>,0,65536,
                            #Fun<rabbit_variable_queue.2.81334491>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,

 <<247,77,14,2,221,67,18,168,38,83,171,47,207,31,
                               187,253>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,450623,

"/data/rabbitmq/rabbitmq/mnesia/cluster/msg_store_persistent"},
                             rabbit_msg_store_ets_index,

 "/data/rabbitmq/rabbitmq/mnesia/cluster/msg_store_persistent",
                             <0.301.0>,454733,446535,458830,462927},
                            {client_msstate,msg_store_transient,

 <<12,4,24,179,230,120,71,131,21,190,238,120,9,176,
                               231,238>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                        undefined,undefined,undefined,running}
** Reason for termination ==
** {{badmatch,{error,not_found}},
    [{rabbit_mirror_queue_master,stop_all_slaves,2,[]},
     {rabbit_mirror_queue_master,delete_and_terminate,2,[]},
     {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6,[]},
     {rabbit_amqqueue_process,terminate_shutdown,2,[]},
     {gen_server2,terminate,3,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
** In 'terminate' callback with reason ==
** normal


-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/7bf3e60e/attachment.htm>

From mcintoshj at gmail.com  Fri Aug 23 22:51:22 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 23 Aug 2013 16:51:22 -0500
Subject: [rabbitmq-discuss] Queues disappeared after a cluster upgrade
	to 3.1.5, Erlang R16B01
In-Reply-To: <CAD6m6fGJEKfOcsokTLOwLgOWibzdShf+5bxk6UjMH1h0-Y7-sg@mail.gmail.com>
References: <CAD6m6fGJEKfOcsokTLOwLgOWibzdShf+5bxk6UjMH1h0-Y7-sg@mail.gmail.com>
Message-ID: <CAD6m6fEcU36QUpUsD-jORhXMYg5UHkkVVvfowrfXKo0XjnfoCQ@mail.gmail.com>

Here's some other details from the logs if it might help (note I discovered
the web-gui issue was a cache issue):

=INFO REPORT==== 23-Aug-2013::15:37:43 ===
upgrades: Mnesia dir backed up to
"/data/rabbitmq/rabbitmq/mnesia/cluster-upgrade-backup"

=INFO REPORT==== 23-Aug-2013::15:37:43 ===
mnesia upgrades: 1 to apply

=INFO REPORT==== 23-Aug-2013::15:37:43 ===
mnesia upgrades: Breaking cluster

=INFO REPORT==== 23-Aug-2013::15:37:43 ===
mnesia upgrades: Applying rabbit_upgrade_functions:exchange_decorators

=INFO REPORT==== 23-Aug-2013::15:37:43 ===
mnesia upgrades: All upgrades applied successfully

=INFO REPORT==== 23-Aug-2013::15:37:44 ===
Starting RabbitMQ 3.1.5 on Erlang R16B01
Copyright (C) 2007-2013 GoPivotal, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 23-Aug-2013::15:37:44 ===
node           : cluster at rabbitmqm10t
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : 9fmMn2E9ImSXspwK+tgGgQ==
log            : /data/rabbitmq/cluster.log
sasl log       : /data/rabbitmq/cluster-sasl.log
database dir   : /data/rabbitmq/rabbitmq/mnesia/cluster

=INFO REPORT==== 23-Aug-2013::15:37:45 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 23-Aug-2013::15:37:45 ===
upgrades: Mnesia backup removed

=INFO REPORT==== 23-Aug-2013::15:37:45 ===
Memory limit set to 396MB of 991MB total.

=INFO REPORT==== 23-Aug-2013::15:37:45 ===
Disk free limit set to 1000MB



On Fri, Aug 23, 2013 at 4:21 PM, Jason McIntosh <mcintoshj at gmail.com> wrote:

> We just upgraded our Alpha environment to 3.1.5 and Erlang R16B01.  In the
> process, ALL of our queue definitions disappeared.  Checking logs, I get a
>  whole lot of errors like the below (names redacted).  Thankfully, I can
> auto-generate all the stuff again, but I'm having errors on my "upgrader"
> node right now that is preventing it from even working - the webgui gives a
> "ReferenceError: queue_length is not defined" error and doesn't display
> any information. Note, I followed the instructions - picked an upgrader
> node, shutdown all the other nodes in order, brought the "upgrader" node
> back online, then the others in sequential order.  This has me really
> really spooked though.
>
> Any advice??
> Thanks!
> Jason
>
> =ERROR REPORT==== 23-Aug-2013::15:37:50 ===
> ** Generic server <0.303.0> terminating
> ** Last message in was {'EXIT',<0.350.0>,normal}
> ** When Server state == {q,
>                          {amqqueue,
>                           {resource,<<"EXCHANGE">>,queue,
>                            <<"QUEUE">>},
>                           true,false,none,
>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
>                           <0.303.0>,[],[],
>                           [{vhost,<<"pca">>},
>                            {name,<<"HA">>},
>                            {pattern,<<"^(?!amq\\.).*">>},
>                            {definition,[{<<"ha-mode">>,<<"all">>}]},
>                            {priority,0}],
>                           [{<0.261.0>,<0.260.0>},
>                            {<0.308.0>,<0.260.0>},
>                            {<0.299.0>,<0.258.0>},
>                            {<0.562.0>,<0.561.0>}]},
>                          none,false,rabbit_mirror_queue_master,
>                          {state,
>                           {resource,<<"EXCHANGE">>,queue,
>                            <<"QUEUE">>},
>                           <0.351.0>,<0.350.0>,rabbit_variable_queue,
>                           {vqstate,
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            {delta,0,0,0},
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            0,
>                            {0,nil},
>                            {0,nil},
>                            {qistate,
>
> "/data/rabbitmq/rabbitmq/mnesia/cluster/queues/8FHU53A729K2C3KLMS8XPVKJD",
>                             {{dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              []},
>                             #Ref<0.0.0.1702>,0,65536,
>                             #Fun<rabbit_variable_queue.2.81334491>,
>                             {0,nil}},
>                            {{client_msstate,msg_store_persistent,
>
>  <<247,77,14,2,221,67,18,168,38,83,171,47,207,31,
>                                187,253>>,
>                              {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,450623,
>
> "/data/rabbitmq/rabbitmq/mnesia/cluster/msg_store_persistent"},
>                              rabbit_msg_store_ets_index,
>
>  "/data/rabbitmq/rabbitmq/mnesia/cluster/msg_store_persistent",
>                              <0.301.0>,454733,446535,458830,462927},
>                             {client_msstate,msg_store_transient,
>
>  <<12,4,24,179,230,120,71,131,21,190,238,120,9,176,
>                                231,238>>,
>                              {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                         undefined,undefined,undefined,running}
> ** Reason for termination ==
> ** {{badmatch,{error,not_found}},
>     [{rabbit_mirror_queue_master,stop_all_slaves,2,[]},
>      {rabbit_mirror_queue_master,delete_and_terminate,2,[]},
>      {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6,[]},
>      {rabbit_amqqueue_process,terminate_shutdown,2,[]},
>      {gen_server2,terminate,3,[]},
>      {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
> ** In 'terminate' callback with reason ==
> ** normal
>
>
> --
> Jason McIntosh
> http://mcintosh.poetshome.com/blog/
> 573-424-7612
>



-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/00bb7427/attachment.htm>

From mcintoshj at gmail.com  Fri Aug 23 23:01:59 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 23 Aug 2013 17:01:59 -0500
Subject: [rabbitmq-discuss] Queues disappeared after a cluster upgrade
	to 3.1.5, Erlang R16B01
In-Reply-To: <CAD6m6fEcU36QUpUsD-jORhXMYg5UHkkVVvfowrfXKo0XjnfoCQ@mail.gmail.com>
References: <CAD6m6fGJEKfOcsokTLOwLgOWibzdShf+5bxk6UjMH1h0-Y7-sg@mail.gmail.com>
	<CAD6m6fEcU36QUpUsD-jORhXMYg5UHkkVVvfowrfXKo0XjnfoCQ@mail.gmail.com>
Message-ID: <CAD6m6fHU-QcXv5nvMNHUaqUHZMVkHjcZLgwRjVRwYMokjRET0Q@mail.gmail.com>

More investigation...  R16B01 installs here:
/usr/lib/erlang/erts-5.10.2/

A ps auf shows /usr/lib/erlang/erts-5.9.3.1/bin/epmd -daemon as still
running.  SO I'm wondering if that might have an impact.  Note here's how
I'm doing my install:

stop rabbit on server X (upgrader is Z, other node is Y)
remove all rabbit/erlang RPM's
Reinstall rabbit software
Update rabbitmqadmin
Enable management plugins (just in case)
Enable auto start.

Rinse and repeat on servers Y, then Z and then start bringing them up
starting with upgrader node. First start Z, then start Y, then start X.
Jason


On Fri, Aug 23, 2013 at 4:51 PM, Jason McIntosh <mcintoshj at gmail.com> wrote:

> Here's some other details from the logs if it might help (note I
> discovered the web-gui issue was a cache issue):
>
> =INFO REPORT==== 23-Aug-2013::15:37:43 ===
> upgrades: Mnesia dir backed up to
> "/data/rabbitmq/rabbitmq/mnesia/cluster-upgrade-backup"
>
> =INFO REPORT==== 23-Aug-2013::15:37:43 ===
> mnesia upgrades: 1 to apply
>
> =INFO REPORT==== 23-Aug-2013::15:37:43 ===
> mnesia upgrades: Breaking cluster
>
> =INFO REPORT==== 23-Aug-2013::15:37:43 ===
> mnesia upgrades: Applying rabbit_upgrade_functions:exchange_decorators
>
> =INFO REPORT==== 23-Aug-2013::15:37:43 ===
> mnesia upgrades: All upgrades applied successfully
>
> =INFO REPORT==== 23-Aug-2013::15:37:44 ===
> Starting RabbitMQ 3.1.5 on Erlang R16B01
> Copyright (C) 2007-2013 GoPivotal, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> =INFO REPORT==== 23-Aug-2013::15:37:44 ===
> node           : cluster at rabbitmqm10t
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : 9fmMn2E9ImSXspwK+tgGgQ==
> log            : /data/rabbitmq/cluster.log
> sasl log       : /data/rabbitmq/cluster-sasl.log
> database dir   : /data/rabbitmq/rabbitmq/mnesia/cluster
>
> =INFO REPORT==== 23-Aug-2013::15:37:45 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 23-Aug-2013::15:37:45 ===
> upgrades: Mnesia backup removed
>
> =INFO REPORT==== 23-Aug-2013::15:37:45 ===
> Memory limit set to 396MB of 991MB total.
>
> =INFO REPORT==== 23-Aug-2013::15:37:45 ===
> Disk free limit set to 1000MB
>
>
>
> On Fri, Aug 23, 2013 at 4:21 PM, Jason McIntosh <mcintoshj at gmail.com>wrote:
>
>> We just upgraded our Alpha environment to 3.1.5 and Erlang R16B01.  In
>> the process, ALL of our queue definitions disappeared.  Checking logs, I
>> get a  whole lot of errors like the below (names redacted).  Thankfully, I
>> can auto-generate all the stuff again, but I'm having errors on my
>> "upgrader" node right now that is preventing it from even working - the
>> webgui gives a "ReferenceError: queue_length is not defined" error and
>> doesn't display any information. Note, I followed the instructions - picked
>> an upgrader node, shutdown all the other nodes in order, brought the
>> "upgrader" node back online, then the others in sequential order.  This has
>> me really really spooked though.
>>
>> Any advice??
>> Thanks!
>> Jason
>>
>> =ERROR REPORT==== 23-Aug-2013::15:37:50 ===
>> ** Generic server <0.303.0> terminating
>> ** Last message in was {'EXIT',<0.350.0>,normal}
>> ** When Server state == {q,
>>                          {amqqueue,
>>                           {resource,<<"EXCHANGE">>,queue,
>>                            <<"QUEUE">>},
>>                           true,false,none,
>>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
>>                           <0.303.0>,[],[],
>>                           [{vhost,<<"pca">>},
>>                            {name,<<"HA">>},
>>                            {pattern,<<"^(?!amq\\.).*">>},
>>                            {definition,[{<<"ha-mode">>,<<"all">>}]},
>>                            {priority,0}],
>>                           [{<0.261.0>,<0.260.0>},
>>                            {<0.308.0>,<0.260.0>},
>>                            {<0.299.0>,<0.258.0>},
>>                            {<0.562.0>,<0.561.0>}]},
>>                          none,false,rabbit_mirror_queue_master,
>>                          {state,
>>                           {resource,<<"EXCHANGE">>,queue,
>>                            <<"QUEUE">>},
>>                           <0.351.0>,<0.350.0>,rabbit_variable_queue,
>>                           {vqstate,
>>                            {0,{[],[]}},
>>                            {0,{[],[]}},
>>                            {delta,0,0,0},
>>                            {0,{[],[]}},
>>                            {0,{[],[]}},
>>                            0,
>>                            {0,nil},
>>                            {0,nil},
>>                            {qistate,
>>
>> "/data/rabbitmq/rabbitmq/mnesia/cluster/queues/8FHU53A729K2C3KLMS8XPVKJD",
>>                             {{dict,0,16,16,8,80,48,
>>
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>
>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                              []},
>>                             #Ref<0.0.0.1702>,0,65536,
>>                             #Fun<rabbit_variable_queue.2.81334491>,
>>                             {0,nil}},
>>                            {{client_msstate,msg_store_persistent,
>>
>>  <<247,77,14,2,221,67,18,168,38,83,171,47,207,31,
>>                                187,253>>,
>>                              {dict,0,16,16,8,80,48,
>>
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>
>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                              {state,450623,
>>
>> "/data/rabbitmq/rabbitmq/mnesia/cluster/msg_store_persistent"},
>>                              rabbit_msg_store_ets_index,
>>
>>  "/data/rabbitmq/rabbitmq/mnesia/cluster/msg_store_persistent",
>>                              <0.301.0>,454733,446535,458830,462927},
>>                             {client_msstate,msg_store_transient,
>>
>>  <<12,4,24,179,230,120,71,131,21,190,238,120,9,176,
>>                                231,238>>,
>>                              {dict,0,16,16,8,80,48,
>>
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>
>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                         undefined,undefined,undefined,running}
>> ** Reason for termination ==
>> ** {{badmatch,{error,not_found}},
>>     [{rabbit_mirror_queue_master,stop_all_slaves,2,[]},
>>      {rabbit_mirror_queue_master,delete_and_terminate,2,[]},
>>      {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6,[]},
>>      {rabbit_amqqueue_process,terminate_shutdown,2,[]},
>>      {gen_server2,terminate,3,[]},
>>      {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>> ** In 'terminate' callback with reason ==
>> ** normal
>>
>>
>> --
>> Jason McIntosh
>> http://mcintosh.poetshome.com/blog/
>> 573-424-7612
>>
>
>
>
> --
> Jason McIntosh
> http://mcintosh.poetshome.com/blog/
> 573-424-7612
>



-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130823/28d4dd45/attachment.htm>

From 314992959 at qq.com  Sat Aug 24 14:57:53 2013
From: 314992959 at qq.com (3k4b251)
Date: Sat, 24 Aug 2013 06:57:53 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c     can't  recieve  message
Message-ID: <1377352673704-29061.post@n5.nabble.com>

  I  send  a  durable  message  to   queue:  123456  .    
Then  I   use   amqp_basic_consume(...,123456,tag,..).  
Then   I  receive  the  message  and   delivery_tag.    
the message  will be still  alive  in  the  queue  if  I  not   use 
amqp_basic_ack(...,delivery_tag).  
Then I use  amqp_basic_cancel(tag)  to remove queue listener without  use 
amqp_basic_ack() before;
Then I use  amqp_basic_consume(123456,tag)  twice. It's  seems  like that 
the server  didn't  push the message  to me .  
So  I  restart the connection to server. Then  use 
amqp_basic_consume(123456,tag).  server push message  to me .
  So  I just want to know ,  if  I  lose the  message  ack, how  can  I get
the message  again by the same consumer ? Only to  restart connection ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-recieve-message-tp29061.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Sat Aug 24 18:20:51 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 24 Aug 2013 10:20:51 -0700
Subject: [rabbitmq-discuss] rabbitmq-c can't recieve message
In-Reply-To: <1377352673704-29061.post@n5.nabble.com>
References: <1377352673704-29061.post@n5.nabble.com>
Message-ID: <CAAt2poKz2h2H5tEOzaAFRTCHBcT1RqLPiEDp8tSmkZn1QxasSw@mail.gmail.com>

You need to send a basic.recover method (amqp_basic_recover()).

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.recover


On Sat, Aug 24, 2013 at 6:57 AM, 3k4b251 <314992959 at qq.com> wrote:

>   I  send  a  durable  message  to   queue:  123456  .
> Then  I   use   amqp_basic_consume(...,123456,tag,..).
> Then   I  receive  the  message  and   delivery_tag.
> the message  will be still  alive  in  the  queue  if  I  not   use
> amqp_basic_ack(...,delivery_tag).
> Then I use  amqp_basic_cancel(tag)  to remove queue listener without  use
> amqp_basic_ack() before;
> Then I use  amqp_basic_consume(123456,tag)  twice. It's  seems  like that
> the server  didn't  push the message  to me .
> So  I  restart the connection to server. Then  use
> amqp_basic_consume(123456,tag).  server push message  to me .
>   So  I just want to know ,  if  I  lose the  message  ack, how  can  I get
> the message  again by the same consumer ? Only to  restart connection ?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-recieve-message-tp29061.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130824/d6c4e5ca/attachment.htm>

From alexanderschatten at gmx.at  Sat Aug 24 20:18:59 2013
From: alexanderschatten at gmx.at (Alexander Schatten)
Date: Sat, 24 Aug 2013 21:18:59 +0200
Subject: [rabbitmq-discuss] Problem installing on MacOSX?
In-Reply-To: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>
References: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>
Message-ID: <C3754EA4-4CF8-4186-902E-D1FDD144C628@gmx.at>

A general consideration: do not follow that installation path, use HomeBrew instead; most likely you are using it already anyway as most developers do.




On 23.08.2013, at 18:32, Richard Adams <ra22597 at gmail.com> wrote:

> Hello, 
>  I am a newcomer to RabbitMQ and tried to install version 3.1.5  on MacOSX  10.5 using the instructions listed here:
> 
> https://www.rabbitmq.com/install-standalone-mac.html
> 
> which produced the following output:
> 
> sce-bio-c02080:sbin radams$ ./rabbitmq-server 
> dyld: unknown required load command 0x80000022
> ./rabbitmq-server: line 94:  1956 Trace/BPT trap          ${ERL_DIR}erl -pa "$RABBITMQ_EBIN_ROOT" -boot "${CLEAN_BOOT_FILE}" -noinput -hidden -s rabbit_prelaunch -sname rabbitmqprelaunch$$ -extra "${RABBITMQ_NODENAME}"
> 
> Is there a minimum OS version for MacOSX? Realise 10.5 is a bit long in the tooth these days but if so it would be good if this was prominent on the download page.
> 
> Thanks 
> Richard Adams
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
==========================================
Dr. Alexander Schatten
==========================================
http://www.schatten.info
http://sichten.blogspot.com
Follow me at 
https://alpha.app.net/alex_buzz
http://twitter.com/alex_buzz
==========================================
"Die Grenzen meiner Sprache
bedeuten die Grenzen meiner Welt.", Wittgenstein

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 496 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130824/689bd626/attachment.pgp>

From mklishin at gopivotal.com  Sat Aug 24 20:21:36 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 24 Aug 2013 23:21:36 +0400
Subject: [rabbitmq-discuss] Problem installing on MacOSX?
In-Reply-To: <C3754EA4-4CF8-4186-902E-D1FDD144C628@gmx.at>
References: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>
	<C3754EA4-4CF8-4186-902E-D1FDD144C628@gmx.at>
Message-ID: <41F2750B-1DC1-4C04-81A0-6752A33054AA@gopivotal.com>

Alexander Schatten:

> A general consideration: do not follow that installation path, use HomeBrew instead

Homebrew RabbitMQ formula has been using the standalone bundle for a few
months now (since briefly after 3.1.3, AFAIR).
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130824/92ccabe4/attachment.pgp>

From videlalvaro at gmail.com  Sat Aug 24 22:23:07 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 24 Aug 2013 15:23:07 -0600
Subject: [rabbitmq-discuss] Problem installing on MacOSX?
In-Reply-To: <C3754EA4-4CF8-4186-902E-D1FDD144C628@gmx.at>
References: <943fdaf2-9a76-40b4-9aea-590f95bd2d75@googlegroups.com>
	<C3754EA4-4CF8-4186-902E-D1FDD144C628@gmx.at>
Message-ID: <CAMcAHLVAwaFKri1-U82kqR3Uf-bRoN8mKjg_CrcwGTS9NK9cJA@mail.gmail.com>

Hombrew uses the same standalone tarball anyway. Using homebrew won't solve
his problem now

On Saturday, August 24, 2013, Alexander Schatten wrote:

> A general consideration: do not follow that installation path, use
> HomeBrew instead; most likely you are using it already anyway as most
> developers do.
>
>
>
>
> On 23.08.2013, at 18:32, Richard Adams <ra22597 at gmail.com <javascript:;>>
> wrote:
>
> > Hello,
> >  I am a newcomer to RabbitMQ and tried to install version 3.1.5  on
> MacOSX  10.5 using the instructions listed here:
> >
> > https://www.rabbitmq.com/install-standalone-mac.html
> >
> > which produced the following output:
> >
> > sce-bio-c02080:sbin radams$ ./rabbitmq-server
> > dyld: unknown required load command 0x80000022
> > ./rabbitmq-server: line 94:  1956 Trace/BPT trap          ${ERL_DIR}erl
> -pa "$RABBITMQ_EBIN_ROOT" -boot "${CLEAN_BOOT_FILE}" -noinput -hidden -s
> rabbit_prelaunch -sname rabbitmqprelaunch$$ -extra "${RABBITMQ_NODENAME}"
> >
> > Is there a minimum OS version for MacOSX? Realise 10.5 is a bit long in
> the tooth these days but if so it would be good if this was prominent on
> the download page.
> >
> > Thanks
> > Richard Adams
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com <javascript:;>
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> ==========================================
> Dr. Alexander Schatten
> ==========================================
> http://www.schatten.info
> http://sichten.blogspot.com
> Follow me at
> https://alpha.app.net/alex_buzz
> http://twitter.com/alex_buzz
> ==========================================
> "Die Grenzen meiner Sprache
> bedeuten die Grenzen meiner Welt.", Wittgenstein
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130824/994eedeb/attachment.htm>

From 314992959 at qq.com  Sun Aug 25 19:02:44 2013
From: 314992959 at qq.com (3k4b251)
Date: Sun, 25 Aug 2013 11:02:44 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c can't recieve message
In-Reply-To: <CAAt2poKz2h2H5tEOzaAFRTCHBcT1RqLPiEDp8tSmkZn1QxasSw@mail.gmail.com>
References: <1377352673704-29061.post@n5.nabble.com>
	<CAAt2poKz2h2H5tEOzaAFRTCHBcT1RqLPiEDp8tSmkZn1QxasSw@mail.gmail.com>
Message-ID: <1377453764536-29066.post@n5.nabble.com>

It's  seems   amqp_basic_recover()    try  to   recover  all  the  consumers 
in  one channel. 
but  I  just  want  to  use  it  for  one queue.  
You  know  sometimes    I  have  many  queues   and  I  recieve messages 
and acks.
 I  will answer  server the  ack  with  a little delay.    if  I use 
amqp_basic_recover(), It means  I  will  receive the messages   from  queues
again ,but  actually I  needn't.  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-recieve-message-tp29061p29066.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Sun Aug 25 19:38:57 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sun, 25 Aug 2013 11:38:57 -0700
Subject: [rabbitmq-discuss] rabbitmq-c can't recieve message
In-Reply-To: <1377453764536-29066.post@n5.nabble.com>
References: <1377352673704-29061.post@n5.nabble.com>
	<CAAt2poKz2h2H5tEOzaAFRTCHBcT1RqLPiEDp8tSmkZn1QxasSw@mail.gmail.com>
	<1377453764536-29066.post@n5.nabble.com>
Message-ID: <CAAt2po+Ph3=8=H+0eKxRAt4R9s2YHHhRMxYL6XoxdQpa6586zw@mail.gmail.com>

Then use a separate channel for each queue.


On Sun, Aug 25, 2013 at 11:02 AM, 3k4b251 <314992959 at qq.com> wrote:

> It's  seems   amqp_basic_recover()    try  to   recover  all  the
>  consumers
> in  one channel.
> but  I  just  want  to  use  it  for  one queue.
> You  know  sometimes    I  have  many  queues   and  I  recieve messages
> and acks.
>  I  will answer  server the  ack  with  a little delay.    if  I use
> amqp_basic_recover(), It means  I  will  receive the messages   from
>  queues
> again ,but  actually I  needn't.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-recieve-message-tp29061p29066.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130825/d3dfd18e/attachment.htm>

From philippe at automate-dev.com  Sun Aug 25 16:24:06 2013
From: philippe at automate-dev.com (Philippe T'Seyen)
Date: Sun, 25 Aug 2013 08:24:06 -0700 (PDT)
Subject: [rabbitmq-discuss] ruby RPC client delivery_info.consumer.cancel
Message-ID: <a295f22c-8582-41a4-a70f-5bd557dec309@googlegroups.com>



The RPC example on the rabbitmq website mentions: delivery_info.consumer.cancel to cancel the subscribe loop.

In newer versions of Bunny I think this should become *channel**.consumers[delivery_info.consumer_tag].cancel* ?

However my ruby rpc client is not behaving as expected: the client hangs and does not return the result.

The code is over here: https://gist.github.com/anonymous/6334383

And this is the logging that is generated. The stacktrace is generated once I stop the debug session.

send_message
result from server "{\"exception\":\"java.lang.NullPointerException\\n\\tat com.automatedev.releasequeue.debian.metadata.impl.handler.MetadataReader.getControlContent(MetadataReader.java:70)\\n\\tat com.automatedev.releasequeue.debian.metadata.impl.handler.MetadataReader.getMetadata(MetadataReader.java:32)\\n\\tat com.automatedev.releasequeue.debian.metadata.impl.handler.MetadataHandler.getMetadata(MetadataHandler.java:46)\\n\\tat com.automatedev.releasequeue.debian.metadata.impl.handler.MetadataHandler.handleMessage(MetadataHandler.java:32)\\n\\tat com.automatedev.releasequeue.debian.message.impl.MessageBeanImpl.handleMessage(MessageBeanImpl.java:98)\\n\\tat com.automatedev.releasequeue.debian.message.impl.MessageBeanImpl.receiveAndHandleMessage(MessageBeanImpl.java:78)\\n\\tat com.automatedev.releasequeue.debian.message.impl.MessageBeanImpl$1.run(MessageBeanImpl.java:65)\\n\\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\\n\\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\\n\\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\\n\\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\\n\\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\\n\\tat java.lang.Thread.run(Thread.java:722)\\n\"}"
/home/philippe/.rvm/gems/ruby-1.9.3-p286 at releasequeue/gems/bunny-0.9.0.pre10/lib/bunny/consumer_work_pool.rb:48:in `join': Interrupt
	from /home/philippe/.rvm/gems/ruby-1.9.3-p286 at releasequeue/gems/bunny-0.9.0.pre10/lib/bunny/consumer_work_pool.rb:48:in `block in join'
	from /home/philippe/.rvm/gems/ruby-1.9.3-p286 at releasequeue/gems/bunny-0.9.0.pre10/lib/bunny/consumer_work_pool.rb:48:in `each'
	from /home/philippe/.rvm/gems/ruby-1.9.3-p286 at releasequeue/gems/bunny-0.9.0.pre10/lib/bunny/consumer_work_pool.rb:48:in `join'
	from /home/philippe/.rvm/gems/ruby-1.9.3-p286 at releasequeue/gems/bunny-0.9.0.pre10/lib/bunny/queue.rb:187:in `subscribe'
	from /home/philippe/projects/releasequeue/script/rpc.rb:18:in `send_message'
	from /home/philippe/projects/releasequeue/script/rpc.rb:32:in `<top (required)>'
	from -e:1:in `load'
	from -e:1:in `<main>'

Any help is appreciated!

Philippe

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130825/df127baa/attachment.htm>

From mklishin at gopivotal.com  Sun Aug 25 20:11:36 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 25 Aug 2013 23:11:36 +0400
Subject: [rabbitmq-discuss] ruby RPC client delivery_info.consumer.cancel
In-Reply-To: <a295f22c-8582-41a4-a70f-5bd557dec309@googlegroups.com>
References: <a295f22c-8582-41a4-a70f-5bd557dec309@googlegroups.com>
Message-ID: <CB8AD4D7-30BC-41EA-B3E3-C98CAD3A40C7@gopivotal.com>

Philippe T'Seyen:

> In newer versions of Bunny I think this should become channel.consumers[delivery_info.consumer_tag].cancel ?

That's what Consumer#cancel does.

> However my ruby rpc client is not behaving as expected: the client hangs and does not return the result.

See https://github.com/ruby-amqp/bunny/issues/145.

We just did not update the code to use a better version. Note that tutorials are just that,
tutorials to get you started.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130825/e1a5fef0/attachment.pgp>

From mklishin at gopivotal.com  Sun Aug 25 23:00:19 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 02:00:19 +0400
Subject: [rabbitmq-discuss] Fwd: ruby RPC client
	delivery_info.consumer.cancel
References: <CACqwerEORQ9cB_jHtXiC8pvx9o_Hv_GKj1kP5XbAr35OdXn3dw@mail.gmail.com>
Message-ID: <94585B29-F72B-4FCC-8C0B-8558DF805023@gopivotal.com>

Forwarded message:

> From: "Philippe T'Seyen" <philippe at automate-dev.com>
> Subject: Re: [rabbitmq-discuss] ruby RPC client delivery_info.consumer.cancel
> 
> Ok, that helps!
> 
> Thanks.
> 
> Philippe

--
MK

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/4da6e3a1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/4da6e3a1/attachment.pgp>

From mklishin at gopivotal.com  Sun Aug 25 23:00:30 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 02:00:30 +0400
Subject: [rabbitmq-discuss] ruby RPC client delivery_info.consumer.cancel
In-Reply-To: <CACqwerEORQ9cB_jHtXiC8pvx9o_Hv_GKj1kP5XbAr35OdXn3dw@mail.gmail.com>
References: <a295f22c-8582-41a4-a70f-5bd557dec309@googlegroups.com>
	<CB8AD4D7-30BC-41EA-B3E3-C98CAD3A40C7@gopivotal.com>
	<CACqwerEORQ9cB_jHtXiC8pvx9o_Hv_GKj1kP5XbAr35OdXn3dw@mail.gmail.com>
Message-ID: <CF711E14-A220-4D7E-AC13-7DD51061A962@gopivotal.com>

Philippe T'Seyen:

> Ok, that helps!

I updated the tutorial:
https://github.com/rabbitmq/rabbitmq-tutorials/commit/a864a54c38e67489bce6da63b0f0234ceedd3aa0

Will update the site some time next week.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/6ec209eb/attachment.pgp>

From 314992959 at qq.com  Mon Aug 26 02:49:44 2013
From: 314992959 at qq.com (3k4b251)
Date: Sun, 25 Aug 2013 18:49:44 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c can't recieve message
In-Reply-To: <CAAt2po+Ph3=8=H+0eKxRAt4R9s2YHHhRMxYL6XoxdQpa6586zw@mail.gmail.com>
References: <1377352673704-29061.post@n5.nabble.com>
	<CAAt2poKz2h2H5tEOzaAFRTCHBcT1RqLPiEDp8tSmkZn1QxasSw@mail.gmail.com>
	<1377453764536-29066.post@n5.nabble.com>
	<CAAt2po+Ph3=8=H+0eKxRAt4R9s2YHHhRMxYL6XoxdQpa6586zw@mail.gmail.com>
Message-ID: <1377481784489-29072.post@n5.nabble.com>

I  can  not  create   channel  for  every  queue.   actually   I  may  create  
more  than one  million queues.   Also  I  don't  want  to   recieve 
messages   from  all  the queues  again. I  just  want  to  recover   one 
queues  or  one  conusmers.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-recieve-message-tp29061p29072.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From 314992959 at qq.com  Mon Aug 26 03:21:40 2013
From: 314992959 at qq.com (3k4b251)
Date: Sun, 25 Aug 2013 19:21:40 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c can't recieve message
In-Reply-To: <CAAt2po+Ph3=8=H+0eKxRAt4R9s2YHHhRMxYL6XoxdQpa6586zw@mail.gmail.com>
References: <1377352673704-29061.post@n5.nabble.com>
	<CAAt2poKz2h2H5tEOzaAFRTCHBcT1RqLPiEDp8tSmkZn1QxasSw@mail.gmail.com>
	<1377453764536-29066.post@n5.nabble.com>
	<CAAt2po+Ph3=8=H+0eKxRAt4R9s2YHHhRMxYL6XoxdQpa6586zw@mail.gmail.com>
Message-ID: <1377483700014-29073.post@n5.nabble.com>

may be  I  should  use   amqp_basic_reject ()?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-recieve-message-tp29061p29073.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From yby538 at 163.com  Mon Aug 26 05:09:56 2013
From: yby538 at 163.com (yby538)
Date: Mon, 26 Aug 2013 12:09:56 +0800
Subject: [rabbitmq-discuss] Hi,
	all.How to get messages from the rabbitmq server which is
	installed	in another machine?
In-Reply-To: <15383646-95C1-4CAE-99CD-74164EEAB4F2@gopivotal.com>
References: <1a125ebb.54be.140a61f35c2.Coremail.yby538@163.com><15383646-95C1-4CAE-99CD-74164EEAB4F2@gopivotal.com>
Message-ID: <659ab825.288f.140b8d05c33.Coremail.yby538@163.com>

thank you very much

2013-08-26



yby538



????Michael Klishin <mklishin at gopivotal.com>
?????2013-08-22 23:06
???Re: [rabbitmq-discuss] Hi, all.How to get messages from the rabbitmq server which is installed in another machine?
????"Discussions about RabbitMQ"<rabbitmq-discuss at lists.rabbitmq.com>
???"yby538"<yby538 at 163.com>

yby538: 

> but it does not work.It failed and something shows that"connect timed out...." 
>  
> so,how to solve this problem?I mean,i want to get message from the rabbitmq queues which are installed in machines which are in the same LAN with my pc... 

It may be a firewall issue.  

Make sure 192.168.241.1 allows connections on ports 
5672, 5671 (if you need TLS/SSL) and 4369 (if you plan to use rabbitmqctl to control 
the node on 192.168.241.1, or use clustering). 

For example, can you connect to 192.168.241.1:5672 using telnet? 
-- 
MK 


_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/f09dd76d/attachment.htm>

From alan.antonuk at gmail.com  Mon Aug 26 05:13:37 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sun, 25 Aug 2013 21:13:37 -0700
Subject: [rabbitmq-discuss] ANN: rabbitmq-c v0.4.1 is released
Message-ID: <CAAt2poJU5qyNTWvyFEoVt4Y8MhcbnB2nesTdZrYt0Wek4f24XA@mail.gmail.com>

rabbitmq-c is the C-language AMQP client for RabbitMQ

Highlights of changes since v0.4.0:

- Removed distribution-specific packaging.
- Bug fixes

A complete ChangeLog can be found:
https://github.com/alanxz/rabbitmq-c/blob/v0.4.1/ChangeLog.md
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130825/e12efab2/attachment.htm>

From demesg at gmail.com  Mon Aug 26 07:46:25 2013
From: demesg at gmail.com (ku3ia)
Date: Sun, 25 Aug 2013 23:46:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <B389F8D3-44FE-4FC4-8E38-73223774FE60@gopivotal.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
	<1377271837123-29048.post@n5.nabble.com>
	<B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>
	<1377272675467-29050.post@n5.nabble.com>
	<B389F8D3-44FE-4FC4-8E38-73223774FE60@gopivotal.com>
Message-ID: <1377499585998-29076.post@n5.nabble.com>

Hm... Seems I understand why connection falls. When using haproxy, you have:
client -> haproxy srv -> rabbit src (2 tcp connections)
and w/o haproxy:
client -> rabbit srv (1 tcp conn)
On this forum
http://www.serverphorums.com/read.php?10,129475
Willy confirms my suppose:

> Opps, sorry, I did not notice the end of the question. It is not
> possible to send the data back to the client because it is not the
> same TCP connection, so it's not a matter of using one address or
> the other.
> 
> There is one connection from the client to haproxy and another one
> from haproxy to the server.

So, seems and heartbeats are unavailable between client and server, even all
is on the same machine.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Suddenly-dropping-all-conns-tp16885p29076.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jandres at omie.es  Mon Aug 26 07:48:41 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Mon, 26 Aug 2013 06:48:41 +0000
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <52178ED7.5040907@rabbitmq.com>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>,
	<CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>
	<52178ED7.5040907@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A5B82@EXCHG01-OM.omel.es>

I think I have the last versions of rabbit and Erlang:

	=INFO REPORT==== 26-Aug-2013::08:42:28 ===
	Starting RabbitMQ 3.1.5 on Erlang R16B01

If I try with:

	curl -i -v -u guest:guest -H "content-type:application/json" -XPUT -d'{"password":"secret","tags":"administrator"}' http://localhost:15672/api/users/newUser

I get this in the logs:

	=ERROR REPORT==== 26-Aug-2013::08:44:04 ===
	webmachine error: path="/api/users/newUser"
	"Bad Request"

And it's the same that works for you. I don't understand what is happening.




-----Mensaje original-----
De: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Enviado el: viernes, 23 de agosto de 2013 18:33
Para: Discussions about RabbitMQ
CC: SAG - Jonathan Andr?s
Asunto: Re: [rabbitmq-discuss] Http API: new user

On 22/08/13 17:51, SAG - Jonathan Andr?s wrote:
> Yes, you are right, sorry, I did it in a hurry.
>
> But If i try with this:
>
> curl -i -v -u guest:guest -H "content-type:application/json" -XPUT 
> -d'{"password":"secret","tags":"administrator"}' 
> http://localhost:15672/api/users/newUser
>
>
> Now i get this:
>
> Error: bad_request, Reason: not_json.

The above works fine for me against 3.1.5 on Erlang R16B:

$ curl -i -v -u guest:guest -H "content-type:application/json" -XPUT -d'{"password":"secret","tags":"administrator"}' 
http://localhost:15672/api/users/newUser
* About to connect() to localhost port 15672 (#0)
*   Trying 127.0.0.1... connected
* Server auth using Basic with user 'guest'
 > PUT /api/users/newUser HTTP/1.1
 > Authorization: Basic Z3Vlc3Q6Z3Vlc3Q=  > User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0
OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3  > Host: localhost:15672  > Accept: */*  > content-type:application/json  > Content-Length: 44  >
* upload completely sent off: 44out of 44 bytes < HTTP/1.1 204 No Content
HTTP/1.1 204 No Content
< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact) < Date: Fri, 23 Aug 2013 16:28:43 GMT
Date: Fri, 23 Aug 2013 16:28:43 GMT
< Content-Type: application/json
Content-Type: application/json
< Content-Length: 0
Content-Length: 0

<
* Connection #0 to host localhost left intact
* Closing connection #0


Perhaps you are running a rabbit/erlang that is too old.


Regards,

Matthias.

From matthias at rabbitmq.com  Mon Aug 26 09:52:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Aug 2013 09:52:42 +0100
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <1377499585998-29076.post@n5.nabble.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
	<1377271837123-29048.post@n5.nabble.com>
	<B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>
	<1377272675467-29050.post@n5.nabble.com>
	<B389F8D3-44FE-4FC4-8E38-73223774FE60@gopivotal.com>
	<1377499585998-29076.post@n5.nabble.com>
Message-ID: <521B175A.3070700@rabbitmq.com>

On 26/08/13 07:46, ku3ia wrote:
> Hm... Seems I understand why connection falls. [...]
> So, seems and heartbeats are unavailable between client and server, even all
> is on the same machine.

That makes no sense. Heartbeats are an AMQP feature. They are 
sent/received over the same TCP/IP connection as all the normal AMQP 
traffic.

Matthias.

From matthias at rabbitmq.com  Mon Aug 26 09:58:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Aug 2013 09:58:40 +0100
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A5B82@EXCHG01-OM.omel.es>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>,
	<CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>
	<52178ED7.5040907@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A5B82@EXCHG01-OM.omel.es>
Message-ID: <521B18C0.2010403@rabbitmq.com>

On 26/08/13 07:48, SAG - Jonathan Andr?s wrote:
> I think I have the last versions of rabbit and Erlang:
>
> 	=INFO REPORT==== 26-Aug-2013::08:42:28 ===
> 	Starting RabbitMQ 3.1.5 on Erlang R16B01
>
> If I try with:
>
> 	curl -i -v -u guest:guest -H "content-type:application/json" -XPUT -d'{"password":"secret","tags":"administrator"}' http://localhost:15672/api/users/newUser
>
> I get this in the logs:
>
> 	=ERROR REPORT==== 26-Aug-2013::08:44:04 ===
> 	webmachine error: path="/api/users/newUser"
> 	"Bad Request"
>
> And it's the same that works for you. I don't understand what is happening.

I thought you said it complained with "Error: bad_request, Reason: 
not_json"?

What version of curl are you running? And on what O/S?

Do other calls to the management API work? Does the management UI work? 
Does rabbitmqadmin work?

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Aug 26 09:59:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Aug 2013 09:59:23 +0100
Subject: [rabbitmq-discuss] rabbitmq-c can't recieve message
In-Reply-To: <1377483700014-29073.post@n5.nabble.com>
References: <1377352673704-29061.post@n5.nabble.com>
	<CAAt2poKz2h2H5tEOzaAFRTCHBcT1RqLPiEDp8tSmkZn1QxasSw@mail.gmail.com>
	<1377453764536-29066.post@n5.nabble.com>
	<CAAt2po+Ph3=8=H+0eKxRAt4R9s2YHHhRMxYL6XoxdQpa6586zw@mail.gmail.com>
	<1377483700014-29073.post@n5.nabble.com>
Message-ID: <521B18EB.7000005@rabbitmq.com>

On 26/08/13 03:21, 3k4b251 wrote:
> may be  I  should  use   amqp_basic_reject ()?

if you know the deliver tag of the message, yes.

Matthias.

From mklishin at gopivotal.com  Mon Aug 26 10:30:03 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 13:30:03 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.10.4 is released
Message-ID: <CB5C431D-E35B-49B7-8318-665832078D73@gopivotal.com>

Bunny [1] is a feature complete, easy to use Ruby client for RabbitMQ.

0.10.3 and 0.10.4 are two usability releases that are completely backwards
compatible.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/08/26/bunny-0-dot-10-dot-4-is-released/

Kudos to Carl H?rberg and Jingwen Owen Ou for contributing to these back-to-back
releases.

1. http://rubybunny.info
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/8b01617f/attachment.pgp>

From demesg at gmail.com  Mon Aug 26 11:21:40 2013
From: demesg at gmail.com (ku3ia)
Date: Mon, 26 Aug 2013 03:21:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <521B175A.3070700@rabbitmq.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
	<1377271837123-29048.post@n5.nabble.com>
	<B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>
	<1377272675467-29050.post@n5.nabble.com>
	<B389F8D3-44FE-4FC4-8E38-73223774FE60@gopivotal.com>
	<1377499585998-29076.post@n5.nabble.com>
	<521B175A.3070700@rabbitmq.com>
Message-ID: <1377512500727-29082.post@n5.nabble.com>

Hm, then I don't understand, why heartbeat checks are failed... I'd turned
off HAProxy checks and on logs there are only messages with heartbeat falls.


Matthias Radestock-3 wrote
> On 26/08/13 07:46, ku3ia wrote:
>> Hm... Seems I understand why connection falls. [...]
>> So, seems and heartbeats are unavailable between client and server, even
>> all
>> is on the same machine.
> 
> That makes no sense. Heartbeats are an AMQP feature. They are 
> sent/received over the same TCP/IP connection as all the normal AMQP 
> traffic.
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list

> rabbitmq-discuss at .rabbitmq

> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Suddenly-dropping-all-conns-tp16885p29082.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Aug 26 11:24:39 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 14:24:39 +0400
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <1377512500727-29082.post@n5.nabble.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
	<1377271837123-29048.post@n5.nabble.com>
	<B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>
	<1377272675467-29050.post@n5.nabble.com>
	<B389F8D3-44FE-4FC4-8E38-73223774FE60@gopivotal.com>
	<1377499585998-29076.post@n5.nabble.com>
	<521B175A.3070700@rabbitmq.com>
	<1377512500727-29082.post@n5.nabble.com>
Message-ID: <3F43D4ED-71E5-439B-8326-A9328E8DAFA5@gopivotal.com>

ku3ia:

> Hm, then I don't understand, why heartbeat checks are failed... I'd turned
> off HAProxy checks and on logs there are only messages with heartbeat falls.

Clients also track how long ago they've seen a server heartbeat.
It may be that your client detects an issue slightly earlier than RabbitMQ.

The real issue seems to be that your HAproxy setup is withholding heartbeats, which
are just protocol frames sent over TCP.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/65df11bb/attachment.pgp>

From matthias at rabbitmq.com  Mon Aug 26 11:25:55 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Aug 2013 11:25:55 +0100
Subject: [rabbitmq-discuss] Suddenly dropping all conns?
In-Reply-To: <1377512500727-29082.post@n5.nabble.com>
References: <1B0DB90F-08B5-4C71-BC90-D1571CDCC50D@jefftrout.com>
	<4FDF3B75.6010703@rabbitmq.com>
	<1377269560927-29046.post@n5.nabble.com>
	<52B38155-5699-4C94-A28F-2AE81FEFDB55@gopivotal.com>
	<1377271837123-29048.post@n5.nabble.com>
	<B1CD9D6A-3F09-4374-89BF-F3AE9E6447F5@gopivotal.com>
	<1377272675467-29050.post@n5.nabble.com>
	<B389F8D3-44FE-4FC4-8E38-73223774FE60@gopivotal.com>
	<1377499585998-29076.post@n5.nabble.com>
	<521B175A.3070700@rabbitmq.com>
	<1377512500727-29082.post@n5.nabble.com>
Message-ID: <521B2D33.7090605@rabbitmq.com>

On 26/08/13 11:21, ku3ia wrote:
> Hm, then I don't understand, why heartbeat checks are failed... I'd turned
> off HAProxy checks and on logs there are only messages with heartbeat falls.

Perhaps the client you are using isn't supporting heartbeats properly.

Matthias.


From jandres at omie.es  Mon Aug 26 12:10:20 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Mon, 26 Aug 2013 11:10:20 +0000
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <521B18C0.2010403@rabbitmq.com>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>,
	<CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>
	<52178ED7.5040907@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A5B82@EXCHG01-OM.omel.es>
	<521B18C0.2010403@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A5C17@EXCHG01-OM.omel.es>

Yes, the message "Error: bad_request, Reason: not_json" is the response of the server. This message:

	=ERROR REPORT==== 26-Aug-2013::08:44:04 ===
 	webmachine error: path="/api/users/newUser"
	"Bad Request"

Is in the logs of RabbitMQ.

I'm using CURL/7.31.0 on windows (windows 7 or windows server 2008, the same results).

This others calls works well:

	curl -i -u guest:guest http://localhost:15672/api/vhosts

	curl -i -v -u guest:guest -H "content-type:application/json" http://localhost:15672/api/users

But I have the same problem with this:

	curl -i -u guest:guest -H "content-type:application/json" -XPUT -d'{"type":"direct","auto_delete":false,"durable":true,"arguments":[]}' http://localhost:15672/api/exchanges/%2f/my-new-exchange

The Rabbit admin works well too.

Thank you!


-----Mensaje original-----
De: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Enviado el: lunes, 26 de agosto de 2013 10:59
Para: SAG - Jonathan Andr?s
CC: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] Http API: new user

On 26/08/13 07:48, SAG - Jonathan Andr?s wrote:
> I think I have the last versions of rabbit and Erlang:
>
> 	=INFO REPORT==== 26-Aug-2013::08:42:28 ===
> 	Starting RabbitMQ 3.1.5 on Erlang R16B01
>
> If I try with:
>
> 	curl -i -v -u guest:guest -H "content-type:application/json" -XPUT -d'{"password":"secret","tags":"administrator"}' http://localhost:15672/api/users/newUser
>
> I get this in the logs:
>
> 	=ERROR REPORT==== 26-Aug-2013::08:44:04 ===
> 	webmachine error: path="/api/users/newUser"
> 	"Bad Request"
>
> And it's the same that works for you. I don't understand what is happening.

I thought you said it complained with "Error: bad_request, Reason: 
not_json"?

What version of curl are you running? And on what O/S?

Do other calls to the management API work? Does the management UI work? 
Does rabbitmqadmin work?

Regards,

Matthias.

From Tobias.Gutzmann at ist.com  Mon Aug 26 12:15:32 2013
From: Tobias.Gutzmann at ist.com (Tobias Gutzmann)
Date: Mon, 26 Aug 2013 11:15:32 +0000
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A5C17@EXCHG01-OM.omel.es>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>,
	<CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>
	<52178ED7.5040907@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A5B82@EXCHG01-OM.omel.es>
	<521B18C0.2010403@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A5C17@EXCHG01-OM.omel.es>
Message-ID: <3CE1D10F927704449D41EF6BCB35373D41696F@hermes>

Hi,

If I'm not totally mistaken, http header names are case-sensitive, so it should be "Content-type", and you might need a space after the colon.

Regards,
Tobias

-----Ursprungligt meddelande-----
Fr?n: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] F?r SAG - Jonathan Andr?s
Skickat: den 26 augusti 2013 13:10
Till: Matthias Radestock
Kopia: Discussions about RabbitMQ
?mne: Re: [rabbitmq-discuss] Http API: new user

Yes, the message "Error: bad_request, Reason: not_json" is the response of the server. This message:

	=ERROR REPORT==== 26-Aug-2013::08:44:04 ===
 	webmachine error: path="/api/users/newUser"
	"Bad Request"

Is in the logs of RabbitMQ.

I'm using CURL/7.31.0 on windows (windows 7 or windows server 2008, the same results).

This others calls works well:

	curl -i -u guest:guest http://localhost:15672/api/vhosts

	curl -i -v -u guest:guest -H "content-type:application/json" http://localhost:15672/api/users

But I have the same problem with this:

	curl -i -u guest:guest -H "content-type:application/json" -XPUT -d'{"type":"direct","auto_delete":false,"durable":true,"arguments":[]}' http://localhost:15672/api/exchanges/%2f/my-new-exchange

The Rabbit admin works well too.

Thank you!


-----Mensaje original-----
De: Matthias Radestock [mailto:matthias at rabbitmq.com] Enviado el: lunes, 26 de agosto de 2013 10:59
Para: SAG - Jonathan Andr?s
CC: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] Http API: new user

On 26/08/13 07:48, SAG - Jonathan Andr?s wrote:
> I think I have the last versions of rabbit and Erlang:
>
> 	=INFO REPORT==== 26-Aug-2013::08:42:28 ===
> 	Starting RabbitMQ 3.1.5 on Erlang R16B01
>
> If I try with:
>
> 	curl -i -v -u guest:guest -H "content-type:application/json" -XPUT 
> -d'{"password":"secret","tags":"administrator"}' 
> http://localhost:15672/api/users/newUser
>
> I get this in the logs:
>
> 	=ERROR REPORT==== 26-Aug-2013::08:44:04 ===
> 	webmachine error: path="/api/users/newUser"
> 	"Bad Request"
>
> And it's the same that works for you. I don't understand what is happening.

I thought you said it complained with "Error: bad_request, Reason: 
not_json"?

What version of curl are you running? And on what O/S?

Do other calls to the management API work? Does the management UI work? 
Does rabbitmqadmin work?

Regards,

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Mon Aug 26 12:19:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Aug 2013 12:19:40 +0100
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10A5C17@EXCHG01-OM.omel.es>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>,
	<CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>
	<52178ED7.5040907@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A5B82@EXCHG01-OM.omel.es>
	<521B18C0.2010403@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A5C17@EXCHG01-OM.omel.es>
Message-ID: <521B39CC.2020205@rabbitmq.com>

On 26/08/13 12:10, SAG - Jonathan Andr?s wrote:
> I'm using CURL/7.31.0 on windows

...in which case the problem may well be Windows shell escaping, which 
is different than under Unix.

I am no expert in Windows scripting, but 
https://www.rabbitmq.com/ha.html has some example of unix vs windows 
rabbitmqctl commands which may be a useful guide for constructing a curl 
command line. In particular note that instead of surrounding literally 
quoted text with '', it is surrounded with "" and all occurrences of " 
are doubled ("").

Matthias.

From jandres at omie.es  Mon Aug 26 12:28:24 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Mon, 26 Aug 2013 11:28:24 +0000
Subject: [rabbitmq-discuss] Http API: new user
In-Reply-To: <521B39CC.2020205@rabbitmq.com>
References: <1377167671234-29013.post@n5.nabble.com>
	<5215EC6F.8060708@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A336A@EXCHG01-OM.omel.es>,
	<CAJbhyRE0LOJSdmmN_nL=J8mS9irzKt5L-dPUJYjbLG=CmLpnmA@mail.gmail.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A43BE@EXCHG01-OM.omel.es>
	<52178ED7.5040907@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A5B82@EXCHG01-OM.omel.es>
	<521B18C0.2010403@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10A5C17@EXCHG01-OM.omel.es>
	<521B39CC.2020205@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10A5C50@EXCHG01-OM.omel.es>

Thank you very much!

curl -i -v -u guest:guest -H ""content-type:application/json"" -XPUT -d"{""password"":""secret"",""tags"":""administrator""}" http://localhost:15672/api/users/newUser

It works!

Now I'll try with the Java + Spring project.



-----Mensaje original-----
De: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Enviado el: lunes, 26 de agosto de 2013 13:20
Para: SAG - Jonathan Andr?s
CC: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] Http API: new user

On 26/08/13 12:10, SAG - Jonathan Andr?s wrote:
> I'm using CURL/7.31.0 on windows

...in which case the problem may well be Windows shell escaping, which is different than under Unix.

I am no expert in Windows scripting, but https://www.rabbitmq.com/ha.html has some example of unix vs windows rabbitmqctl commands which may be a useful guide for constructing a curl command line. In particular note that instead of surrounding literally quoted text with '', it is surrounded with "" and all occurrences of " 
are doubled ("").

Matthias.

From prabodh.upreti at vce.com  Mon Aug 26 16:35:04 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Mon, 26 Aug 2013 08:35:04 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq shutdown return code 2
In-Reply-To: <1377196795094-29030.post@n5.nabble.com>
References: <1377193128005-29028.post@n5.nabble.com>
	<1377196795094-29030.post@n5.nabble.com>
Message-ID: <1377531304340-29089.post@n5.nabble.com>

looks like it is just executing

/sbin/service rabbitmq-server stop. which is then returning 2.  shutdown_err
file and other log files all clean.  Could it just be taking longer than
normal to shutdown.  appreciate any feedback. thx.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-shutdown-return-code-2-tp29028p29089.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Aug 26 16:38:04 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 19:38:04 +0400
Subject: [rabbitmq-discuss] rabbitmq shutdown return code 2
In-Reply-To: <1377531304340-29089.post@n5.nabble.com>
References: <1377193128005-29028.post@n5.nabble.com>
	<1377196795094-29030.post@n5.nabble.com>
	<1377531304340-29089.post@n5.nabble.com>
Message-ID: <794AE8FF-3E0B-4F65-939B-DF812DEFCCA1@gopivotal.com>

Prabodh Upreti:

> /sbin/service rabbitmq-server stop. which is then returning 2.  shutdown_err
> file and other log files all clean.  Could it just be taking longer than
> normal to shutdown.  appreciate any feedback. thx.

How was RabbitMQ installed? It can also be a problem with the init script.

Can you paste the init script or at least explain what package was used to
install RabbitMQ?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/f04ff37e/attachment.pgp>

From ricardo.ekm at gmail.com  Mon Aug 26 16:42:10 2013
From: ricardo.ekm at gmail.com (ricardo.ekm)
Date: Mon, 26 Aug 2013 08:42:10 -0700 (PDT)
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <5031FBCC.8080606@rabbitmq.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<1345232635161-21485.post@n5.nabble.com>
	<5031FBCC.8080606@rabbitmq.com>
Message-ID: <1377531730313-29091.post@n5.nabble.com>

Hi,
We're also pretty much interested in this feature. This is specially useful
for teams migrating from JMS to RabbitMQ as this very used in JMS world.
Considering there is a trend of moving from heavy JEE servers to lightweight
ones (this is my case), having retry limit/delivery delay would increase the
adoption of RabbitMQ I believe.

Do you plan to implement this anytime soon? I've heard you are filling the
gaps between RabbitMQ and JMS
(http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-support-JMS-in-the-future-td24361.html),
so may be this is already in progress?

Thanks.

Ricardo



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/redelivered-count-tp13512p29091.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From prabodh.upreti at vce.com  Mon Aug 26 16:55:56 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Mon, 26 Aug 2013 08:55:56 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq shutdown return code 2
In-Reply-To: <794AE8FF-3E0B-4F65-939B-DF812DEFCCA1@gopivotal.com>
References: <1377193128005-29028.post@n5.nabble.com>
	<1377196795094-29030.post@n5.nabble.com>
	<1377531304340-29089.post@n5.nabble.com>
	<794AE8FF-3E0B-4F65-939B-DF812DEFCCA1@gopivotal.com>
Message-ID: <1377532556238-29092.post@n5.nabble.com>

Ok, I found this in one of the log files:

=SUPERVISOR REPORT==== 26-Aug-2013::15:48:17 ===
     Supervisor: {<0.1487.0>,rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.1505.0>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]

Hope this has more meaning. Could you please let me know what could be
wrong? thx.

prabodh



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-shutdown-return-code-2-tp29028p29092.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From prabodh.upreti at vce.com  Mon Aug 26 17:11:41 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Mon, 26 Aug 2013 09:11:41 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq shutdown return code 2
In-Reply-To: <1377532556238-29092.post@n5.nabble.com>
References: <1377193128005-29028.post@n5.nabble.com>
	<1377196795094-29030.post@n5.nabble.com>
	<1377531304340-29089.post@n5.nabble.com>
	<794AE8FF-3E0B-4F65-939B-DF812DEFCCA1@gopivotal.com>
	<1377532556238-29092.post@n5.nabble.com>
Message-ID: <1377533501169-29093.post@n5.nabble.com>

Could this be because a consumer is still connected to rabbitmq when the
shutdown happens?  We are n the process of changing the shutdown order where
we will shutdown the consumer then rabbitmq.  Please let me know if there is
no need to do that. thx.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-shutdown-return-code-2-tp29028p29093.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From vashi.priyanki at gmail.com  Mon Aug 26 17:31:49 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Mon, 26 Aug 2013 09:31:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
 Publisher confirms and Consumer Acknowledgement
Message-ID: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>

Hi everyone,

I have following query on configuring bulk acknowledgement. From both 
server to Publisher and from Consumer to server.

Do Rabbit support bulk acknowledgement for both Publisher confirm and 
consumer ack ? 
If yes, how to configure bulk acknowledgement both at server and client 
side ? 

I have learnt from rabbitmq site that multiple flag in 'basic.ack' method, 
controls single message acknowledgement or multiple acknowledgement. 

I could set 'multiple' to True in basic.ack method on consumer side but how 
to check that consumer is really acknowledging multiple messages and also 
where & how to configure message count value? (I mean is it possible to 
have only one ack for a group of messages received by consumer instead of 
individual ack for every message)  

In my wireshark traces, I see multiple is set to 'True' in 'basic.ack' 
method, which is sent from Consumer to Server but not sure weather it's 
really working or not  since it shows no difference in behavior in 
comparison to multiple to false. (I have tracked this as per delivery-tag 
value).


And on the server side, I see that a file 'rabbit_framing.hrl' , has 
basic.ack with multiple flag = false.
Do I need to change this to true to get multiple messages acknowledges from 
server to publisher ( for bulk ack for publisher confirm method?) 

Please  suggest.

Best Regards,
Priyanki. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/16090816/attachment.htm>

From mklishin at gopivotal.com  Mon Aug 26 17:37:05 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 20:37:05 +0400
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
	Publisher confirms and Consumer Acknowledgement
In-Reply-To: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
Message-ID: <6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>

Priyanki Vashi:

> I have learnt from rabbitmq site that multiple flag in 'basic.ack' method, controls single message acknowledgement or multiple acknowledgement. 
> 
> I could set 'multiple' to True in basic.ack method on consumer side but how to check that consumer is really acknowledging multiple messages and also where & how to configure message count value? (I mean is it possible to have only one ack for a group of messages received by consumer instead of individual ack for every message)  
> 
> In my wireshark traces, I see multiple is set to 'True' in 'basic.ack' method, which is sent from Consumer to Server but not sure weather it's really working or not  since it shows no difference in behavior in comparison to multiple to false. (I have tracked this as per delivery-tag value).

basic.ack with multiple = true will acknowledge all outstanding (unacknowledged) messages.
Acknowledged messages are removed from the queue.

Try adding a consumer and acknowledging, say, every 100th delivery with multiple = true.

If there is only one unacknowledged delivery, multiple = true is effectively the same as multiple = false.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/72639f84/attachment.pgp>

From mikeb at squaremobius.net  Mon Aug 26 17:49:17 2013
From: mikeb at squaremobius.net (Michael Bridgen)
Date: Mon, 26 Aug 2013 17:49:17 +0100
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
 Publisher confirms and Consumer Acknowledgement
In-Reply-To: <6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
	<6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
Message-ID: <CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>

On 26 August 2013 17:37, Michael Klishin <mklishin at gopivotal.com> wrote:
> Priyanki Vashi:
>
>> I have learnt from rabbitmq site that multiple flag in 'basic.ack' method, controls single message acknowledgement or multiple acknowledgement.
>>
>> I could set 'multiple' to True in basic.ack method on consumer side but how to check that consumer is really acknowledging multiple messages and also where & how to configure message count value? (I mean is it possible to have only one ack for a group of messages received by consumer instead of individual ack for every message)
>>
>> In my wireshark traces, I see multiple is set to 'True' in 'basic.ack' method, which is sent from Consumer to Server but not sure weather it's really working or not  since it shows no difference in behavior in comparison to multiple to false. (I have tracked this as per delivery-tag value).
>
> basic.ack with multiple = true will acknowledge all outstanding (unacknowledged) messages.

Not quite true. basic.ack with multiple = true, *and* delivery-tag =
0, will acknowledge all outstanding messages (on the channel).

From mklishin at gopivotal.com  Mon Aug 26 17:58:16 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 20:58:16 +0400
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
	Publisher confirms and Consumer Acknowledgement
In-Reply-To: <CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
	<6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
	<CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>
Message-ID: <86C1C6E7-9F85-45A8-97DA-341F80C0FF07@gopivotal.com>

Michael Bridgen:

> Not quite true. basic.ack with multiple = true, *and* delivery-tag =
> 0, will acknowledge all outstanding messages (on the channel).

My bad.

With delivery_tag = N, all unacknowledged deliveries up to N will be ack-ed.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/a3791478/attachment.pgp>

From dustin at weebly.com  Mon Aug 26 18:14:38 2013
From: dustin at weebly.com (Dustin Doiron)
Date: Mon, 26 Aug 2013 10:14:38 -0700
Subject: [rabbitmq-discuss] Hard limit on API values returned?
Message-ID: <CAJTEvF=mKn9zV6HhALsjs=spbFxQ1rf4=-DpkzDb6OC5QQDOaQ@mail.gmail.com>

Hi all,

I believe we've identified a limitation in the values returned by the
/api/connections interface, and was looking to see if anyone else can
confirm this behavior.

It appears that when any field returned in the API request to
/api/connections reaches approximately 4294967296 (2^32), the statistics
counter is dramatically reset, affecting the integrity of counter data in
the next request.

For example, see this selected subset of response for two sequential
requests to /api/connections:

{"recv_oct":4294345813,"recv_cnt":134449509,"send_oct":525608688,"send_cnt":43620989,"send_pend":0,"state":"running","last_blocked_by":"none","last_blocked_age":"infinity","channels":1,"recv_oct_details":{"rate":161293.3401346077,"interval":5002984,"last_event":1377291327321},"send_oct_details":{"rate":2854.2965558154897,"interval":5002984,"last_event":1377291327321},"type":"network","node":"rabbit at localhost
","name":"10.123.123.50:28676 ->
10.123.123.50:5672","address":"10.123.123.50","port":5672,"peer_address":"10.123.123.50","peer_port":28676,"ssl":false,"peer_cert_subject":"","peer_cert_issuer":"","peer_cert_validity":"","auth_mechanism":"PLAIN","ssl_protocol":"","ssl_key_exchange":"","ssl_cipher":"","ssl_hash":"","protocol":"AMQP
0-9-1","user":"webservice","vhost":"webservice","timeout":10,"frame_max":131072,"client_properties":{}}

{"recv_oct":14977,"recv_cnt":134453219,"send_oct":525623280,"send_cnt":43622201,"send_pend":0,"state":"running","last_blocked_by":"none","last_blocked_age":"infinity","channels":1,"recv_oct_details":{"rate":-858689105.5064446,"interval":5001031,"last_event":1377291332322},"send_oct_details":{"rate":2917.798349980234,"interval":5001031,"last_event":1377291332322},"type":"network","node":"rabbit at localhost
","name":"10.123.123.50:28676 ->
10.123.123.50:5672","address":"10.123.123.50","port":5672,"peer_address":"10.123.123.50","peer_port":28676,"ssl":false,"peer_cert_subject":"","peer_cert_issuer":"","peer_cert_validity":"","auth_mechanism":"PLAIN","ssl_protocol":"","ssl_key_exchange":"","ssl_cipher":"","ssl_hash":"","protocol":"AMQP
0-9-1","user":"webservice","vhost":"webservice","timeout":10,"frame_max":131072,"client_properties":{}}

The recv_oct counter reaches approximately 4294967296 between the first and
second requests, causing it to reset for the second request. This also
causes the recv rate to report an incorrect value. We're unsure if this is
a more widespread issue at this time.

Please let me know if additional information is required to reproduce this
behavior.

Thanks,
Dustin Doiron
Weebly.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/32009a65/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 26 18:40:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Aug 2013 18:40:34 +0100
Subject: [rabbitmq-discuss] Hard limit on API values returned?
In-Reply-To: <CAJTEvF=mKn9zV6HhALsjs=spbFxQ1rf4=-DpkzDb6OC5QQDOaQ@mail.gmail.com>
References: <CAJTEvF=mKn9zV6HhALsjs=spbFxQ1rf4=-DpkzDb6OC5QQDOaQ@mail.gmail.com>
Message-ID: <521B9312.1040902@rabbitmq.com>

Dustin,

On 26/08/13 18:14, Dustin Doiron wrote:
> It appears that when any field returned in the API request to
> /api/connections reaches approximately 4294967296 (2^32), the statistics
> counter is dramatically reset, affecting the integrity of counter data
> in the next request.

What version of Erlang are you running? We reported a bug to the 
Erlang/OTP team a while ago that caused the behaviour you are 
describing. That bug got fixed in R16A, released 7 months ago. See 
http://www.erlang.org/download/otp_src_R16A_RELEASE_CANDIDATE.readme

OTP-10746  The octet counters in the gen_tcp/inet interface could behave
            in unexpected ways on 64bit platforms. The behaviour is now
            as expected.

Regards,

Matthias.


From dustin at weebly.com  Mon Aug 26 18:51:33 2013
From: dustin at weebly.com (Dustin Doiron)
Date: Mon, 26 Aug 2013 10:51:33 -0700
Subject: [rabbitmq-discuss] Hard limit on API values returned?
In-Reply-To: <521B9312.1040902@rabbitmq.com>
References: <CAJTEvF=mKn9zV6HhALsjs=spbFxQ1rf4=-DpkzDb6OC5QQDOaQ@mail.gmail.com>
	<521B9312.1040902@rabbitmq.com>
Message-ID: <CAJTEvFkLUXJ8eB+TmJ2KnQ_CpyXWwBZLDNmo_pZ26zzCixkPDw@mail.gmail.com>

That does sound like it, and we are currently running R15B01. We'll
upgrade, which will likely solve our issue. Thanks!


On Mon, Aug 26, 2013 at 10:40 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Dustin,
>
>
> On 26/08/13 18:14, Dustin Doiron wrote:
>
>> It appears that when any field returned in the API request to
>> /api/connections reaches approximately 4294967296 (2^32), the statistics
>> counter is dramatically reset, affecting the integrity of counter data
>> in the next request.
>>
>
> What version of Erlang are you running? We reported a bug to the
> Erlang/OTP team a while ago that caused the behaviour you are describing.
> That bug got fixed in R16A, released 7 months ago. See
> http://www.erlang.org/**download/otp_src_R16A_RELEASE_**CANDIDATE.readme<http://www.erlang.org/download/otp_src_R16A_RELEASE_CANDIDATE.readme>
>
> OTP-10746  The octet counters in the gen_tcp/inet interface could behave
>            in unexpected ways on 64bit platforms. The behaviour is now
>            as expected.
>
> Regards,
>
> Matthias.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/2d9db204/attachment.htm>

From bbehzadi.goog at gmail.com  Mon Aug 26 20:50:26 2013
From: bbehzadi.goog at gmail.com (Behnam Behzadi)
Date: Mon, 26 Aug 2013 12:50:26 -0700
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
 Publisher confirms and Consumer Acknowledgement
In-Reply-To: <86C1C6E7-9F85-45A8-97DA-341F80C0FF07@gopivotal.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
	<6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
	<CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>
	<86C1C6E7-9F85-45A8-97DA-341F80C0FF07@gopivotal.com>
Message-ID: <CAOfK0i5At3KDbuVi10k0WysMYFtfkYjugJpENJh1OTZVH6JKZg@mail.gmail.com>

That implies that delivery_tag is unique per channel, right?

So, how would this work if there's not a 1:1 correspondence between
channels and queues and each queue has its own independent consumer thread?
 e.g. let's say we have 2 queues on one channel and each queue is consumed
asynchronously by a consumer thread.  If one of the consumer threads sends
a bulk ack it may inadvertently end up sending ack for the messages that
the other thread is consuming.  Will it not?

Thanks
Behnam


On Mon, Aug 26, 2013 at 9:58 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Michael Bridgen:
>
> > Not quite true. basic.ack with multiple = true, *and* delivery-tag =
> > 0, will acknowledge all outstanding messages (on the channel).
>
> My bad.
>
> With delivery_tag = N, all unacknowledged deliveries up to N will be
> ack-ed.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/432bd44c/attachment.htm>

From mklishin at gopivotal.com  Mon Aug 26 20:53:24 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 23:53:24 +0400
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
	Publisher confirms and Consumer Acknowledgement
In-Reply-To: <CAOfK0i5At3KDbuVi10k0WysMYFtfkYjugJpENJh1OTZVH6JKZg@mail.gmail.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
	<6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
	<CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>
	<86C1C6E7-9F85-45A8-97DA-341F80C0FF07@gopivotal.com>
	<CAOfK0i5At3KDbuVi10k0WysMYFtfkYjugJpENJh1OTZVH6JKZg@mail.gmail.com>
Message-ID: <82E8C450-079E-4B56-8F7F-6E5B34920401@gopivotal.com>

Behnam Behzadi:

> That implies that delivery_tag is unique per channel, right?
> 
> So, how would this work if there's not a 1:1 correspondence between channels and queues and each queue has its own independent consumer thread?  e.g. let's say we have 2 queues on one channel and each queue is consumed asynchronously by a consumer thread.  If one of the consumer threads sends a bulk ack it may inadvertently end up sending ack for the messages that the other thread is consuming.  Will it not?

Every delivery on a channel carries a unique id, regardless of what consumer it is for.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/7273e7a8/attachment.pgp>

From mklishin at gopivotal.com  Mon Aug 26 20:57:48 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 Aug 2013 23:57:48 +0400
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
	Publisher confirms and Consumer Acknowledgement
In-Reply-To: <CAOfK0i5At3KDbuVi10k0WysMYFtfkYjugJpENJh1OTZVH6JKZg@mail.gmail.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
	<6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
	<CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>
	<86C1C6E7-9F85-45A8-97DA-341F80C0FF07@gopivotal.com>
	<CAOfK0i5At3KDbuVi10k0WysMYFtfkYjugJpENJh1OTZVH6JKZg@mail.gmail.com>
Message-ID: <E0FD0BD4-C871-409F-909E-D97EB30D5CD9@gopivotal.com>

Behnam Behzadi:

>  let's say we have 2 queues on one channel and each queue is consumed asynchronously by a consumer thread.  If one of the consumer threads sends a bulk ack it may inadvertently end up sending ack for the messages that the other thread is consuming.  Will it not?

Correct, with more than one consumer on a channel, you need to be careful to coordinate
them if they use acks with multiple = true.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/6358232b/attachment.pgp>

From bbehzadi.goog at gmail.com  Mon Aug 26 21:23:40 2013
From: bbehzadi.goog at gmail.com (Behnam Behzadi)
Date: Mon, 26 Aug 2013 13:23:40 -0700
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
 Publisher confirms and Consumer Acknowledgement
In-Reply-To: <E0FD0BD4-C871-409F-909E-D97EB30D5CD9@gopivotal.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
	<6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
	<CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>
	<86C1C6E7-9F85-45A8-97DA-341F80C0FF07@gopivotal.com>
	<CAOfK0i5At3KDbuVi10k0WysMYFtfkYjugJpENJh1OTZVH6JKZg@mail.gmail.com>
	<E0FD0BD4-C871-409F-909E-D97EB30D5CD9@gopivotal.com>
Message-ID: <CAOfK0i6TStUVUuPjN7WDXWjnk25UWMEuiaeC-URvRdjXen4KUQ@mail.gmail.com>

That coordination is non-trivial and very error-prone. Any reasons
delivery-tag is not unique per queue? Of course we'd have to pass the
queueName to Channel.basicAck() method in that case. Does AMQP allow such
implementation?

Thanks
Behnam


On Mon, Aug 26, 2013 at 12:57 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Behnam Behzadi:
>
> >  let's say we have 2 queues on one channel and each queue is consumed
> asynchronously by a consumer thread.  If one of the consumer threads sends
> a bulk ack it may inadvertently end up sending ack for the messages that
> the other thread is consuming.  Will it not?
>
> Correct, with more than one consumer on a channel, you need to be careful
> to coordinate
> them if they use acks with multiple = true.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/3164c557/attachment.htm>

From mklishin at gopivotal.com  Mon Aug 26 21:26:26 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 Aug 2013 00:26:26 +0400
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
	Publisher confirms and Consumer Acknowledgement
In-Reply-To: <CAOfK0i6TStUVUuPjN7WDXWjnk25UWMEuiaeC-URvRdjXen4KUQ@mail.gmail.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
	<6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
	<CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>
	<86C1C6E7-9F85-45A8-97DA-341F80C0FF07@gopivotal.com>
	<CAOfK0i5At3KDbuVi10k0WysMYFtfkYjugJpENJh1OTZVH6JKZg@mail.gmail.com>
	<E0FD0BD4-C871-409F-909E-D97EB30D5CD9@gopivotal.com>
	<CAOfK0i6TStUVUuPjN7WDXWjnk25UWMEuiaeC-URvRdjXen4KUQ@mail.gmail.com>
Message-ID: <1E337BCE-09B0-4E54-AE5B-98933A0C1FEC@gopivotal.com>

Behnam Behzadi:

> That coordination is non-trivial and very error-prone. Any reasons delivery-tag is not unique per queue? Of course we'd have to pass the queueName to Channel.basicAck() method in that case. Does AMQP allow such implementation?

basic.ack works per channel in the protocol. No, you cannot scope it by queue.

You can ack one delivery at a time which would require no coordination.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/74329266/attachment.pgp>

From matthias at rabbitmq.com  Mon Aug 26 21:37:06 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Aug 2013 21:37:06 +0100
Subject: [rabbitmq-discuss] Query on bulk acknowledgement - For both
 Publisher confirms and Consumer Acknowledgement
In-Reply-To: <1E337BCE-09B0-4E54-AE5B-98933A0C1FEC@gopivotal.com>
References: <18839a14-fcf8-4477-84f5-d8bef5fb1c58@googlegroups.com>
	<6537BB51-F62D-4DDB-B333-579AA2771733@gopivotal.com>
	<CAMZ8XCgbQjOVr+U3Xgjd+w+4gKrPoccjJu6n0Oy-V8v_=oa_NA@mail.gmail.com>
	<86C1C6E7-9F85-45A8-97DA-341F80C0FF07@gopivotal.com>
	<CAOfK0i5At3KDbuVi10k0WysMYFtfkYjugJpENJh1OTZVH6JKZg@mail.gmail.com>
	<E0FD0BD4-C871-409F-909E-D97EB30D5CD9@gopivotal.com>
	<CAOfK0i6TStUVUuPjN7WDXWjnk25UWMEuiaeC-URvRdjXen4KUQ@mail.gmail.com>
	<1E337BCE-09B0-4E54-AE5B-98933A0C1FEC@gopivotal.com>
Message-ID: <521BBC72.1010005@rabbitmq.com>

On 26/08/13 21:26, Michael Klishin wrote:
> Behnam Behzadi:
>
>> That coordination is non-trivial and very error-prone. Any reasons
>> delivery-tag is not unique per queue? Of course we'd have to pass
>> the queueName to Channel.basicAck() method in that case. Does AMQP
>> allow such implementation?
>
> basic.ack works per channel in the protocol. No, you cannot scope it
> by queue.
>
> You can ack one delivery at a time which would require no
> coordination. -- MK

Or simply use one channel per consumer.


Matthias.

From fred at dushin.net  Tue Aug 27 01:27:27 2013
From: fred at dushin.net (Dushin Fred)
Date: Mon, 26 Aug 2013 20:27:27 -0400
Subject: [rabbitmq-discuss] Docs/Advice on extending HTTP API
Message-ID: <277EB6AE-9F7C-482E-8BE8-9CA7E0051870@dushin.net>


I have some administrative operations I would like to add, via an additional plugin (OTP application), to a RabbitMQ instance.  I have reasonably successful writing a few generic plugins, which as I understand it are basically just OTP applications that have been registered with RabbitMQ, but I am having some difficulty fully understanding how to interface with mochiweb to add operations to the REST API.  (I am less interested in making changes to the WebUI, but understanding how to do that would be a bonus.)

So far, I have copied the rabbitmq_shovel_management plugin (using the 3.1.5 branch on rabbitmq-public-umbrella), as a guide, and I have managed to insert my own dummy code for get operations, and I can do an HTTP GET to get the data that the plugin is providing, e.g., via

%%--------------------------------------------------------------------

init(_Config) -> {ok, #context{}}.

content_types_provided(ReqData, Context) ->
   {[{"application/json", to_json}], ReqData, Context}.

to_json(ReqData, Context) ->
    rabbit_mgmt_util:reply(status(), ReqData, Context).

is_authorized(ReqData, Context) ->
    rabbit_mgmt_util:is_authorized_admin(ReqData, Context).

%%--------------------------------------------------------------------

status() ->
	[{name, <<"foo">>}, {node, <<"bar">>} ].

I am now interested in using PUT and POST operations to pass parameters to allow state mutation on the server (a la REST principles).

I don't suppose there is any documentation on anything more than the metronome sample plugin.  Is there a simple example to follow, in the umbrella code, that would give me an architectural understanding of how the rabbit_mgmt_extension behavior can be leveraged?

Short of that, can anyone explain the roles of the following functions?

content_types_provided/2
resource_exists/2
to_json/2
is_authorized/2

augmented/2
basic/1

Who calls them?  When are they called?  Can anything general be said about the parameters to these functions?   (Yes, I too can use io:format :)

Sorry for the somewhat vague set of questions, but I haven't gotten cozy with mochiweb (though I have done some work with YAWS), so I am just hunting for a few pointers.

Thanks in advance,

-Fred
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/6e196b4a/attachment.htm>

From neilbriancastro at gmail.com  Mon Aug 26 22:03:57 2013
From: neilbriancastro at gmail.com (slash)
Date: Mon, 26 Aug 2013 14:03:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>
References: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>
Message-ID: <1377551037343-29107.post@n5.nabble.com>

Has anyone been able to figure this out?I experience the same issue with
connections being closed at precisely the 30-minute mark after a connection
is established. I tried setting the connection parameter
*heartbeat_interval* to both zero and 3600 and also the *socket_timeout* to
1860 seconds. Acknowledging early before a long-running process does not
work either.The EC2 instances are running linux and has pika 0.9.13.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Keeping-idle-connections-alive-in-EC2-tp25324p29107.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130826/28ad142f/attachment.htm>

From yuva670 at gmail.com  Tue Aug 27 08:52:35 2013
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Tue, 27 Aug 2013 13:22:35 +0530
Subject: [rabbitmq-discuss] Closing stuck client connections
Message-ID: <CAPrynAWBo424+gsxSpQ7FLNo-8EGyTdU_uwr0w1eg6pSR7-_rA@mail.gmail.com>

Hi,

In our application of rabbitmq in running services, consumers hang after
consuming some messages, in such cases, the client waits on for the ack
from the consumer. As a result, many connections are opened and we have to
force close them manually. Is there any timeout mechanism for connections
to close after a fixed time duration, so that such connections do not block
rabbitmq.


Thanks,
Mahesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/98f7c5e6/attachment.htm>

From mklishin at gopivotal.com  Tue Aug 27 09:11:39 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 Aug 2013 12:11:39 +0400
Subject: [rabbitmq-discuss] Closing stuck client connections
In-Reply-To: <CAPrynAWBo424+gsxSpQ7FLNo-8EGyTdU_uwr0w1eg6pSR7-_rA@mail.gmail.com>
References: <CAPrynAWBo424+gsxSpQ7FLNo-8EGyTdU_uwr0w1eg6pSR7-_rA@mail.gmail.com>
Message-ID: <6394655D-95A6-4309-A96B-C7321E27732C@gopivotal.com>

Mahesh Viraktamath:

> Is there any timeout mechanism for connections to close after a fixed time duration, so that such connections do not block rabbitmq.

Have you tried using shorter heartbeat intervals? Also, unless you run out of file descriptors
available to RabbitMQ, consumer connections should not block anything. But even in that
case increasing max # of file descriptors (ulimit -n) is a much better solution.
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/85f96c62/attachment.pgp>

From yuva670 at gmail.com  Tue Aug 27 09:20:10 2013
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Tue, 27 Aug 2013 13:50:10 +0530
Subject: [rabbitmq-discuss] Closing stuck client connections
In-Reply-To: <6394655D-95A6-4309-A96B-C7321E27732C@gopivotal.com>
References: <CAPrynAWBo424+gsxSpQ7FLNo-8EGyTdU_uwr0w1eg6pSR7-_rA@mail.gmail.com>
	<6394655D-95A6-4309-A96B-C7321E27732C@gopivotal.com>
Message-ID: <CAPrynAUw+7Td7Jo_Xb4e6UJ_OW3XAZf=PFt5gztSOhpkYor7BA@mail.gmail.com>

Yes, the solution is appropriate for avoiding the connection blocking. In
our case, the consumer itself hangs and the client waits for the ack and
the connection goes idle. We need to close such connections where the ack
is delayed from the consumer side.


Thanks again,
Mahesh


On Tue, Aug 27, 2013 at 1:41 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Mahesh Viraktamath:
>
> > Is there any timeout mechanism for connections to close after a fixed
> time duration, so that such connections do not block rabbitmq.
>
> Have you tried using shorter heartbeat intervals? Also, unless you run out
> of file descriptors
> available to RabbitMQ, consumer connections should not block anything. But
> even in that
> case increasing max # of file descriptors (ulimit -n) is a much better
> solution.
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/d7967475/attachment.htm>

From mklishin at gopivotal.com  Tue Aug 27 09:21:02 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 Aug 2013 12:21:02 +0400
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <1377551037343-29107.post@n5.nabble.com>
References: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>
	<1377551037343-29107.post@n5.nabble.com>
Message-ID: <2F69895B-F905-41BC-8FA3-AB4C2A7EADE9@gopivotal.com>

slash:

> I tried setting the connection parameter heartbeat_interval to both zero and 3600 and also the socket_timeout to 1860 seconds

These are pretty high intervals. Have you tried setting heartbeats to, say, 20-30 seconds?
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/ce3986b9/attachment.pgp>

From mklishin at gopivotal.com  Tue Aug 27 09:23:36 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 Aug 2013 12:23:36 +0400
Subject: [rabbitmq-discuss] Closing stuck client connections
In-Reply-To: <CAPrynAUw+7Td7Jo_Xb4e6UJ_OW3XAZf=PFt5gztSOhpkYor7BA@mail.gmail.com>
References: <CAPrynAWBo424+gsxSpQ7FLNo-8EGyTdU_uwr0w1eg6pSR7-_rA@mail.gmail.com>
	<6394655D-95A6-4309-A96B-C7321E27732C@gopivotal.com>
	<CAPrynAUw+7Td7Jo_Xb4e6UJ_OW3XAZf=PFt5gztSOhpkYor7BA@mail.gmail.com>
Message-ID: <E6862A0C-D27C-410B-8C99-9788DD9C978E@gopivotal.com>

Mahesh Viraktamath:

> We need to close such connections where the ack is delayed from the consumer side.

You can close connections and get more detailed information about them using HTTP API [1]
but I'm afraid there is no tracking how long ago a message was delivered.

1. http://hg.rabbitmq.com/rabbitmq-management/raw-file/fbdc912fa1e5/priv/www/api/index.html
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/8731c611/attachment.pgp>

From emile at rabbitmq.com  Tue Aug 27 09:29:52 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Aug 2013 09:29:52 +0100
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <1377531730313-29091.post@n5.nabble.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<1345232635161-21485.post@n5.nabble.com>
	<5031FBCC.8080606@rabbitmq.com>
	<1377531730313-29091.post@n5.nabble.com>
Message-ID: <521C6380.70500@rabbitmq.com>

On 26/08/13 16:42, ricardo.ekm wrote:
> Do you plan to implement this anytime soon? I've heard you are filling the
> gaps between RabbitMQ and JMS
> (http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-support-JMS-in-the-future-td24361.html),
> so may be this is already in progress?

Unfortunately this feature enjoys low priority at the moment, but that
will change if many customers request it.




-Emile




From emile at rabbitmq.com  Tue Aug 27 10:11:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Aug 2013 10:11:50 +0100
Subject: [rabbitmq-discuss] rabbitmq shutdown return code 2
In-Reply-To: <1377532556238-29092.post@n5.nabble.com>
References: <1377193128005-29028.post@n5.nabble.com>
	<1377196795094-29030.post@n5.nabble.com>
	<1377531304340-29089.post@n5.nabble.com>
	<794AE8FF-3E0B-4F65-939B-DF812DEFCCA1@gopivotal.com>
	<1377532556238-29092.post@n5.nabble.com>
Message-ID: <521C6D56.8060401@rabbitmq.com>

On 26/08/13 16:55, Prabodh Upreti wrote:
> =SUPERVISOR REPORT==== 26-Aug-2013::15:48:17 ===
>      Supervisor: {<0.1487.0>,rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     shutdown
>      Offender:   [{pid,<0.1505.0>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
> 
> Hope this has more meaning.

Not really, it just says a channel crashed without providing a reason.
The reason might appear earlier in the log.

> Could this be because a consumer is still connected to rabbitmq when the
> shutdown happens?  We are n the process of changing the shutdown order where
> we will shutdown the consumer then rabbitmq.  Please let me know if there is
> no need to do that.

Connected consumers won't prevent the broker from shutting down, and the
presence of consumers is unlikely to affect the return code in the way
you describe.


As Michael said, it would help to know how the broker was installed.
Also, do you get the same return code if you stop the broker manually?



-Emile




From jtlg at vp.pl  Tue Aug 27 10:52:52 2013
From: jtlg at vp.pl (ModronMaze)
Date: Tue, 27 Aug 2013 02:52:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Enabling publisher confirms damages
 performance by a factor of 10x
In-Reply-To: <52172890.9090401@rabbitmq.com>
References: <1376904909257-28914.post@n5.nabble.com>
	<52172890.9090401@rabbitmq.com>
Message-ID: <1377597172420-29119.post@n5.nabble.com>

On 23.08.2013 11:17, Matthias Radestock wrote:
> The performance you are seeing is what I'd expect when publishers wait for
> confirmation after every single message. But you say above that publishers
> mark messages as confirmed "asynchronously", so presumably you are not
> doing that. 
You are right. I am maintaining a map of unconfirmed messages and removing
them in confirmation callback. Currently there is no checking or waiting at
all.

> Here's a test using MulticastMain (which ships with the Java client),
> which I believe reproduces your test case exactly, except that the
> consumer is not doing any work and the messages are 1k in size (you didn't
> indicate how large the messages are, so I just guessed). 
1k is ok. I run these tests and got results similar to yours:

./runjava.sh com.rabbitmq.examples.MulticastMain -f persistent -c 1000 -q
512 -C 200000 -s 1024 -i 10
time: 10,041s, sent: 2647 msg/s, confirmed: 2547 msg/s, nacked: 0 msg/s,
received: 2121 msg/s, min/avg/max latency: 6692/1110959/1869794 microseconds
time: 20,055s, sent: 2832 msg/s, confirmed: 2832 msg/s, nacked: 0 msg/s,
received: 2321 msg/s, min/avg/max latency: 1852817/2620249/3774515
microseconds
time: 30,056s, sent: 2646 msg/s, confirmed: 2646 msg/s, nacked: 0 msg/s,
received: 2149 msg/s, min/avg/max latency: 3577167/4903928/5873513
microseconds

./runjava.sh com.rabbitmq.examples.MulticastMain -f persistent -c 1 -q 512
-C 200000 -s 1024 -i 10
time: 10,034s, sent: 16 msg/s, confirmed: 16 msg/s, nacked: 0 msg/s,
received: 16 msg/s, min/avg/max latency: 590/877/9948 microseconds
time: 20,046s, sent: 16 msg/s, confirmed: 16 msg/s, nacked: 0 msg/s,
received: 16 msg/s, min/avg/max latency: 519/701/1562 microseconds
time: 30,086s, sent: 18 msg/s, confirmed: 18 msg/s, nacked: 0 msg/s,
received: 18 msg/s, min/avg/max latency: 506/784/8283 microseconds

I verified my implementation once again and there is one difference: I am
using flag mandatory. So I run the test with this flag:

./runjava.sh com.rabbitmq.examples.MulticastMain -f persistent mandatory -c
2000 -q 512 -C 200000 -s 1024 -i 10
time: 10,068s, sent: 212 msg/s, returned: 0 msg/s, confirmed: 83 msg/s,
nacked: 0 msg/s, received: 84 msg/s, min/avg/max latency:
11511/5031823/8173326 microseconds
time: 20,089s, sent: 96 msg/s, returned: 0 msg/s, confirmed: 91 msg/s,
nacked: 0 msg/s, received: 91 msg/s, min/avg/max latency:
8249958/10334398/13137973 microseconds
time: 30,284s, sent: 90 msg/s, returned: 0 msg/s, confirmed: 86 msg/s,
nacked: 0 msg/s, received: 86 msg/s, min/avg/max latency:
12775852/15313769/17857810 microseconds

./runjava.sh com.rabbitmq.examples.MulticastMain -f persistent mandatory -q
512 -C 200000 -s 1024 -i 10
time: 10,000s, sent: 6979 msg/s, returned: 0 msg/s, received: 6766 msg/s,
min/avg/max latency: 8588/347330/1112170 microseconds
time: 20,000s, sent: 7955 msg/s, returned: 0 msg/s, received: 7965 msg/s,
min/avg/max latency: 159450/238629/369709 microseconds


It appears that the problem happens when I use both publisher confirms and
mandatory flag. Dropping mandatory flag solves it (I tested it and sending
is much faster in my application).
Still, I am surprised to see such drop in performance. What is the reason?

Regards,
ModronMaze



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Enabling-publisher-confirms-damages-performance-by-a-factor-of-10x-tp28914p29119.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue Aug 27 10:58:58 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Aug 2013 10:58:58 +0100
Subject: [rabbitmq-discuss] Queues disappeared after a cluster upgrade
 to 3.1.5, Erlang R16B01
In-Reply-To: <CAD6m6fHU-QcXv5nvMNHUaqUHZMVkHjcZLgwRjVRwYMokjRET0Q@mail.gmail.com>
References: <CAD6m6fGJEKfOcsokTLOwLgOWibzdShf+5bxk6UjMH1h0-Y7-sg@mail.gmail.com>
	<CAD6m6fEcU36QUpUsD-jORhXMYg5UHkkVVvfowrfXKo0XjnfoCQ@mail.gmail.com>
	<CAD6m6fHU-QcXv5nvMNHUaqUHZMVkHjcZLgwRjVRwYMokjRET0Q@mail.gmail.com>
Message-ID: <521C7862.9010306@rabbitmq.com>

On 23/08/13 23:01, Jason McIntosh wrote:
> A ps auf shows /usr/lib/erlang/erts-5.9.3.1/bin/epmd -daemon as still
> running.  SO I'm wondering if that might have an impact.

Depending on how you upgraded Erlang you may need to stop this process
manually. I'd be surprised if this was the cause of the error though.

> stop rabbit on server X (upgrader is Z, other node is Y)
> remove all rabbit/erlang RPM's
> Reinstall rabbit software
> Update rabbitmqadmin
> Enable management plugins (just in case)
> Enable auto start.
> 
> Rinse and repeat on servers Y, then Z and then start bringing them up
> starting with upgrader node. First start Z, then start Y, then start X.


From tim at rabbitmq.com  Tue Aug 27 11:30:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 27 Aug 2013 11:30:07 +0100
Subject: [rabbitmq-discuss] Docs/Advice on extending HTTP API
In-Reply-To: <277EB6AE-9F7C-482E-8BE8-9CA7E0051870@dushin.net>
References: <277EB6AE-9F7C-482E-8BE8-9CA7E0051870@dushin.net>
Message-ID: <61EFCDB8-A9E4-4849-82A4-03BA7058A5E0@rabbitmq.com>

Hi Fred,

On 27 Aug 2013, at 01:27, Dushin Fred wrote:
> Short of that, can anyone explain the roles of the following functions?
> 
> content_types_provided/2
> resource_exists/2
> to_json/2
> is_authorized/2
> 
> augmented/2
> basic/1
> 
> Who calls them?  When are they called?  Can anything general be said about the parameters to these functions?   (Yes, I too can use io:format :)
> 
> Sorry for the somewhat vague set of questions, but I haven't gotten cozy with mochiweb (though I have done some work with YAWS), so I am just hunting for a few pointers.
> 

This is more to do with webmachine - a RESTFul web development framework that runs on top of mochiweb. You might want to take a look at http://webmachine.basho.com/ for documentation of resource handler callbacks and other useful bits an pieces.

Cheers,
Tim


From mklishin at gopivotal.com  Tue Aug 27 11:36:07 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 Aug 2013 14:36:07 +0400
Subject: [rabbitmq-discuss] ANN HotBunnies 2.0.0.pre12 is released
Message-ID: <8C3FE86E-A35D-4621-93B4-27C11CAB5E88@gopivotal.com>

HotBunnies [1] is a feature rich, fast RabbitMQ client for JRuby.

2.0.0.pre12 introduces a couple of minor features and fixes
a regression in pre11.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/08/27/hotbunnies-2-dot-0-0-dot-pre12-is-released/

1. http://hotbunnies.info
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/afff9bf4/attachment.pgp>

From michael.laing at nytimes.com  Tue Aug 27 11:49:11 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 27 Aug 2013 06:49:11 -0400
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <2F69895B-F905-41BC-8FA3-AB4C2A7EADE9@gopivotal.com>
References: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>
	<1377551037343-29107.post@n5.nabble.com>
	<2F69895B-F905-41BC-8FA3-AB4C2A7EADE9@gopivotal.com>
Message-ID: <CAKgmDnGa87f8CZPm2RHH3hRqsON5YJeOZ+oASXUe5FO_9Mr+nQ@mail.gmail.com>

We run lots of ec2 connections without problem and also use pika 0.9.13 or
0.9.14pre.

Some connections go idle for lengthy periods. We use the default heartbeat
of 600 secs for most connections.

If going through a load balancer like EC2's ELB or haproxy, we found a
heartbeat of 25 seconds worked well. At the current time we have engineered
load balancers out of our architecture by using AWS Route 53 least latency
/ weighted routing with health checks.

Our domain specific framework built on pika automatically reconnects if we
do lose a connection, typically trying a different machine in the cluster
via the above routing scheme. Inter- and intra-region shovel/federation
links do this explicitly using standard multi-endpoint configurations.

So I would try the default of 600 secs, i.e. don't specify a heartbeat, or
use 25 secs if a load balancer is in the picture.

ml


On Tue, Aug 27, 2013 at 4:21 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> slash:
>
> > I tried setting the connection parameter heartbeat_interval to both zero
> and 3600 and also the socket_timeout to 1860 seconds
>
> These are pretty high intervals. Have you tried setting heartbeats to,
> say, 20-30 seconds?
> --
> MK
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/027664bf/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 27 12:39:48 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 27 Aug 2013 12:39:48 +0100
Subject: [rabbitmq-discuss] Enabling publisher confirms damages
 performance by a factor of 10x
In-Reply-To: <1377597172420-29119.post@n5.nabble.com>
References: <1376904909257-28914.post@n5.nabble.com>
	<52172890.9090401@rabbitmq.com>
	<1377597172420-29119.post@n5.nabble.com>
Message-ID: <521C9004.1090000@rabbitmq.com>

On 27/08/13 10:52, ModronMaze wrote:
> It appears that the problem happens when I use both publisher confirms and
> mandatory flag. Dropping mandatory flag solves it (I tested it and sending
> is much faster in my application).
> Still, I am surprised to see such drop in performance. What is the reason?

'mandatory' is processed synchronously within the broker. So it is 
fairly expensive. Alas there is some weird scheduling / timing issue at 
play here that make the combination of mandatory and confirms perform 
exceptionally badly.

Try running
   rabbitmqctl eval 'erlang:system_flag(schedulers_online, 1).'
and then repeat the test. For me that increases the mandatory+confirm 
peformance by a factor of 11.

I have filed a bug to investigate this further. Meanwhile I suggest 
dropping 'mandatory' if you can.

Matthias.

From emile at rabbitmq.com  Tue Aug 27 13:09:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Aug 2013 13:09:57 +0100
Subject: [rabbitmq-discuss] Header exchange filtering on Int32 numbers
In-Reply-To: <6DA47758DD70A84CAB1C2A6629FEC4D312A6621D@sho-p-excmbx-02.sentry.com>
References: <6DA47758DD70A84CAB1C2A6629FEC4D312A6621D@sho-p-excmbx-02.sentry.com>
Message-ID: <521C9715.6010206@rabbitmq.com>


Hi Andrew,

On 23/08/13 17:10, Miller Andrew wrote:
> I have a header exchange setup, with a durable queue bound to it with a
> blank routing key, and a single argument of ?SourceEventCount=2?, where
> 2 is specified as a Number.  When I publish to the exchange from the
> .Net client, if the SourceEventCount header value I add is an Int32, it
> doesn?t get routed to the queue.  It only works if I cast the header
> value to an Int64.  Is this a bug, or am I doing something wrong?

At the time of writing the implementation of the headers exchange in
RabbitMQ demands that the values as well as their types match. If the
arguments table of the binding had a 64bit integer then only messages
with 64bit integers in the header will match. See

http://hg.rabbitmq.com/rabbitmq-server/file/e555ae16396f/src/rabbit_exchange_type_headers.erl#l112

The specification is not as strict, so there is scope for relaxing this
restriction. Thanks for the suggestion. The release notes will make
mention of this change if it is implemented in the future. In the
meantime please ensure that both values and types match.





-Emile









From Punit.Jain at emc.com  Tue Aug 27 13:38:23 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Tue, 27 Aug 2013 08:38:23 -0400
Subject: [rabbitmq-discuss] Regarding disk free limit
Message-ID: <DB14E94115BBC84E8960C12C176D06763B14D5AA@MX25A.corp.emc.com>

Hi,
We are using RabbitMQ in a system where root partition doesn't have much space. To avoid unnecessary blockage of connections we have set "disk_free_limit" to 8MB. Is there any disadvantage of setting the limit this low while default limit is 1GB?

Thanks,
Punit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/09754472/attachment.htm>

From emile at rabbitmq.com  Tue Aug 27 13:47:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Aug 2013 13:47:02 +0100
Subject: [rabbitmq-discuss] Regarding disk free limit
In-Reply-To: <DB14E94115BBC84E8960C12C176D06763B14D5AA@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06763B14D5AA@MX25A.corp.emc.com>
Message-ID: <521C9FC6.30808@rabbitmq.com>

On 27/08/13 13:38, Jain, Punit wrote:

> We are using RabbitMQ in a system where root partition doesn?t have much
> space. To avoid unnecessary blockage of connections we have set
> ?disk_free_limit? to 8MB. Is there any disadvantage of setting the limit
> this low while default limit is 1GB?

The broker will activate flow-control later if the disk gets full. If
you deal with large messages or very high message rates then you run a
slightly higher risk of a crash due to running out of disk space.



-Emile




From fred at dushin.net  Tue Aug 27 13:49:12 2013
From: fred at dushin.net (Dushin Fred)
Date: Tue, 27 Aug 2013 08:49:12 -0400
Subject: [rabbitmq-discuss] Docs/Advice on extending HTTP API
In-Reply-To: <61EFCDB8-A9E4-4849-82A4-03BA7058A5E0@rabbitmq.com>
References: <277EB6AE-9F7C-482E-8BE8-9CA7E0051870@dushin.net>
	<61EFCDB8-A9E4-4849-82A4-03BA7058A5E0@rabbitmq.com>
Message-ID: <9463ABE0-5CD7-41BF-B2FC-E22974CFAFA9@dushin.net>

Excellent, thanks for that, Tim.  This link [1] is especially helpful, in case anyone else is struggling with the same.

Leave it to the folks at Basho to write up some cool stuff.

-Fred

[1] https://github.com/basho/webmachine/wiki/Resource-Functions

On Aug 27, 2013, at 6:30 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Fred,
> 
> On 27 Aug 2013, at 01:27, Dushin Fred wrote:
>> Short of that, can anyone explain the roles of the following functions?
>> 
>> content_types_provided/2
>> resource_exists/2
>> to_json/2
>> is_authorized/2
>> 
>> augmented/2
>> basic/1
>> 
>> Who calls them?  When are they called?  Can anything general be said about the parameters to these functions?   (Yes, I too can use io:format :)
>> 
>> Sorry for the somewhat vague set of questions, but I haven't gotten cozy with mochiweb (though I have done some work with YAWS), so I am just hunting for a few pointers.
>> 
> 
> This is more to do with webmachine - a RESTFul web development framework that runs on top of mochiweb. You might want to take a look at http://webmachine.basho.com/ for documentation of resource handler callbacks and other useful bits an pieces.
> 
> Cheers,
> Tim
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Punit.Jain at emc.com  Tue Aug 27 13:58:39 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Tue, 27 Aug 2013 08:58:39 -0400
Subject: [rabbitmq-discuss] Regarding disk free limit
In-Reply-To: <521C9FC6.30808@rabbitmq.com>
References: <DB14E94115BBC84E8960C12C176D06763B14D5AA@MX25A.corp.emc.com>
	<521C9FC6.30808@rabbitmq.com>
Message-ID: <DB14E94115BBC84E8960C12C176D06763B14D5AD@MX25A.corp.emc.com>

Thanks for the explanation, Emile. We are neither dealing with large messages and nor the rate is high, and we are also not using message persistence. This system is an upstream for another broker configured in federation. I think only incase of link failure messages are expected to queued up in upstream queue which will be in memory in my understanding, right? Still, is there any way RabbitMQ occupying disk space? Currently we have around 1GB free space in root partition which will not be used by any software or user.

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Tuesday, August 27, 2013 6:17 PM
To: Discussions about RabbitMQ
Cc: Jain, Punit
Subject: Re: [rabbitmq-discuss] Regarding disk free limit

On 27/08/13 13:38, Jain, Punit wrote:

> We are using RabbitMQ in a system where root partition doesn't have 
> much space. To avoid unnecessary blockage of connections we have set 
> "disk_free_limit" to 8MB. Is there any disadvantage of setting the 
> limit this low while default limit is 1GB?

The broker will activate flow-control later if the disk gets full. If you deal with large messages or very high message rates then you run a slightly higher risk of a crash due to running out of disk space.



-Emile





From emile at rabbitmq.com  Tue Aug 27 14:14:10 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Aug 2013 14:14:10 +0100
Subject: [rabbitmq-discuss] Regarding disk free limit
In-Reply-To: <DB14E94115BBC84E8960C12C176D06763B14D5AD@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06763B14D5AA@MX25A.corp.emc.com>
	<521C9FC6.30808@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D06763B14D5AD@MX25A.corp.emc.com>
Message-ID: <521CA622.2020208@rabbitmq.com>


Hi,

On 27/08/13 13:58, Jain, Punit wrote:
> we are also not using message persistence.

Messages could still be written to disk even if it is not required.

> This system is an upstream for another broker configured in
> federation. I think only incase of link failure messages are expected
> to queued up in upstream queue which will be in memory in my 
> understanding, right?

If the consumers are guaranteed always to be faster than the publishers
then queues will never need to hold any messages. In your case the queue
will grow as a result of link failure.

> Still, is there any way RabbitMQ occupying disk space? Currently we
> have around 1GB free space in root partition which will not be used
> by any software or user.

The broker may decide to start paging messages to disk when a relatively
small percentage of RAM is in use. 8Mb is a pretty slim safety margin.
You should weigh the cost of recovering from a crash against the cost of
extra disk space.




-Emile



From neilbriancastro at gmail.com  Tue Aug 27 14:28:20 2013
From: neilbriancastro at gmail.com (slash)
Date: Tue, 27 Aug 2013 06:28:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <2F69895B-F905-41BC-8FA3-AB4C2A7EADE9@gopivotal.com>
References: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>
	<1377551037343-29107.post@n5.nabble.com>
	<2F69895B-F905-41BC-8FA3-AB4C2A7EADE9@gopivotal.com>
Message-ID: <1377610100511-29131.post@n5.nabble.com>

Michael Klishin-2 wrote
> slash:
> 
>> I tried setting the connection parameter heartbeat_interval to both zero
>> and 3600 and also the socket_timeout to 1860 seconds
> 
> These are pretty high intervals. Have you tried setting heartbeats to,
> say, 20-30 seconds?
> --
> MK
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list

> rabbitmq-discuss at .rabbitmq

> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> signature.asc (506 bytes)
> &lt;http://rabbitmq.1065348.n5.nabble.com/attachment/29115/0/signature.asc&gt;

Thank you Michael!

I haven't tried setting it to those numbers but I've tried several
combinations including NOT specifying any of those parameters. The reason I
set those numbers high is on the belief that they will keep my connections
alive longer before timing out.

Nonetheless, I will try those figures you suggested.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Keeping-idle-connections-alive-in-EC2-tp25324p29131.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From neilbriancastro at gmail.com  Tue Aug 27 15:01:30 2013
From: neilbriancastro at gmail.com (slash)
Date: Tue, 27 Aug 2013 07:01:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <CAKgmDnGa87f8CZPm2RHH3hRqsON5YJeOZ+oASXUe5FO_9Mr+nQ@mail.gmail.com>
References: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>
	<1377551037343-29107.post@n5.nabble.com>
	<2F69895B-F905-41BC-8FA3-AB4C2A7EADE9@gopivotal.com>
	<CAKgmDnGa87f8CZPm2RHH3hRqsON5YJeOZ+oASXUe5FO_9Mr+nQ@mail.gmail.com>
Message-ID: <1377612090757-29132.post@n5.nabble.com>

Laing, Michael P. wrote
> We run lots of ec2 connections without problem and also use pika 0.9.13 or
> 0.9.14pre.
> 
> Some connections go idle for lengthy periods. We use the default heartbeat
> of 600 secs for most connections.
> 
> If going through a load balancer like EC2's ELB or haproxy, we found a
> heartbeat of 25 seconds worked well. At the current time we have
> engineered
> load balancers out of our architecture by using AWS Route 53 least latency
> / weighted routing with health checks.
> 
> Our domain specific framework built on pika automatically reconnects if we
> do lose a connection, typically trying a different machine in the cluster
> via the above routing scheme. Inter- and intra-region shovel/federation
> links do this explicitly using standard multi-endpoint configurations.
> 
> So I would try the default of 600 secs, i.e. don't specify a heartbeat, or
> use 25 secs if a load balancer is in the picture.
> 
> ml
> 
> 
> On Tue, Aug 27, 2013 at 4:21 AM, Michael Klishin &lt;

> mklishin@

> &gt;wrote:
> 
>> slash:
>>
>> > I tried setting the connection parameter heartbeat_interval to both
>> zero
>> and 3600 and also the socket_timeout to 1860 seconds
>>
>> These are pretty high intervals. Have you tried setting heartbeats to,
>> say, 20-30 seconds?
>> --
>> MK
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> 

> rabbitmq-discuss at .rabbitmq

>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list

> rabbitmq-discuss at .rabbitmq

> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Thank you for sharing- it helps to know this pika, Rabbitmq, ec2 stack
works.

I've tried several values for that parameter INCLUDING NOT specifying it
which should default to 600. Yesterday, I also tried different high and low
values for the tcp_keepalive_time of the producer/consumer ec2 instances.
All failed. I still got the *pika.Connection.Close* exception at the
30-minute mark.

I'm running 3-5 connections between 2 EC2 machines launched from a Linux
AMI. The size of messaging data are in the order of kilobytes only. One of
the instances that has the long running process runs an FFMPEG transcoder.
But for debugging purposes I replaced it with a 30-minute while loop that
calls *process_event_data* and *sleep* methods of the
*pika.BlockingConnection* object. I also send a fan-out message every
iteration to make sure data is sent across the connection.

Any thoughts?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Keeping-idle-connections-alive-in-EC2-tp25324p29132.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mcintoshj at gmail.com  Tue Aug 27 15:11:49 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 27 Aug 2013 09:11:49 -0500
Subject: [rabbitmq-discuss] Queues disappeared after a cluster upgrade
 to 3.1.5, Erlang R16B01
In-Reply-To: <521C7862.9010306@rabbitmq.com>
References: <CAD6m6fGJEKfOcsokTLOwLgOWibzdShf+5bxk6UjMH1h0-Y7-sg@mail.gmail.com>
	<CAD6m6fEcU36QUpUsD-jORhXMYg5UHkkVVvfowrfXKo0XjnfoCQ@mail.gmail.com>
	<CAD6m6fHU-QcXv5nvMNHUaqUHZMVkHjcZLgwRjVRwYMokjRET0Q@mail.gmail.com>
	<521C7862.9010306@rabbitmq.com>
Message-ID: <CAD6m6fGz2Sw-tjNESe6ZiOokr3r4giQMU=pPDviQVW7vuqPaOg@mail.gmail.com>

I upgraded from 3.0.4 to 3.1.5 and from esl-erlang R15B03 to esl-erlang
R16B01.  I've been doing some digging and can't find any reason why this
would happen, no additional log files, nothing.  Note there are three nodes
involved in a cluster.  I upgraded my "dvlp" sample box which wasn't
clustered with no problem using the exact same script I used to upgrade my
alpha cluster.  Below is the script I'm using (might be useful for others
upgrading a cluster).  I'm going to try recreating my
"Alpha" environment and redoing the upgrade.  The ONLY thing that I can
think of - I was doing stop/starts as part of training of the cluster about
20 minutes before I did the upgrade to test various concepts, e.g. message
loss, master node recovery, etc. etc.  At this point, if people haven't
seen or heard of this, I'll chalk it up to something funky disk or
otherwise until I can try and replicate it.  My biggest concern at this
point is that because i no longer have the backup's of the mnesia database,
replicating the environment won't replicate exactly what was in the
database, and so I won't be able to replicate it.  When I start deploying
to our production environment, I won't make that mistake - I'll shutdown
rabbit, back up my whole rabbit_data_directory first :)
Thanks!
Jason

# ########################################
# 04/22/2013 - JasonMcIntosh - core upgrade script to go through each
reported node in a cluster and upgrade it
# ########################################
if [ ! -e /data/rabbitmq ]; then
echo "No rabbit found on $1" > /var/log/rabbit_upgrade.log
exit 0
fi

export LOG_FILE=/var/log/rabbitmq/upgrade.log
rm -f $LOG_FILE

export CLUSTER_STATUS="`rabbitmqctl cluster_status`"
export CLUSTER_STATUS="`echo $CLUSTER_STATUS|tr -d ' \n'`"
echo "Started at `date`" >> $LOG_FILE
echo "$CLUSTER_STATUS" >> $LOG_FILE
echo "" >> $LOG_FILE

getServerFQDN() {
SERVER_FQDN=`echo $1 | awk -F@ '{print $2};'`
FQDN=`nslookup $SERVER_FQDN|grep Name|awk -F\: '{print $2}'|sed 's/ //g'`
echo $FQDN
}

upgradeRabbitNode() {
SERVER_FQDN=`getServerFQDN $1`
echo "Doing upgrade of $SERVER_FQDN" >> $LOG_FILE
# The upgrade deploy job actually stops the rabbit server, shouldn't need
this, but we'll do it anways
  # Not exact commands below as I'm using bladelogic internal commands to
do these, but the idea should be the same.
remote_exec ${SERVER_FQDN} service rabbitmq-server stop  >> $LOG_FILE
remote_exec $SERVER_FQDN yum -y erase rabbit* erlang* >> $LOG_FILE
        remote_exec  $SERVER_FQDN yum -y install rabbitmq-server-3.1.5...
>> $LOG_FILE
        remote_exec $SERVER_FQDN rabbitmq-plugins enable
rabbitmq_management rabbitmq_management_agent
rabbitmq_management_visualiser rabbitmq_shovel rabbitmq_shovel_management>>
$LOG_FILE
        remote_exec  $SERVER_FQDN chkconfig rabbitmq-server on
}


#Get the cluster nodes and pick the first disk node as the "upgrader" node
export UPGRADER_NODE=`echo "$CLUSTER_STATUS"|awk -F\[ '{print $4}'|awk -F\]
'{print $1}'|awk -F, '{print $1}'`
export UPGRADER_FQDN=`getServerFQDN $UPGRADER_NODE`
export NODE_LIST="`echo $CLUSTER_STATUS|awk -F\[
'{sub(/.*running_nodes/,\"\")};1'|awk -F\[ '{print $2}'|awk -F\] '{print
$1}'|sed -e 's/,/ /g'`"

echo "Node list: $NODE_LIST " >> $LOG_FILE
echo "Disk node for last upgrade $UPGRADER_NODE">> $LOG_FILE

if [ "$UPGRADER_NODE" = "" ]; then
echo " ** No upgrader node found! EXITING" >> $LOG_FILE
exit -1
fi


#Shutdown and upgrade all other nodes than the upgrader node
echo "Doing upgrade of all non upgrade nodes..." >> $LOG_FILE
for clusterNode in ${NODE_LIST}; do
if [ $clusterNode != $UPGRADER_NODE ]; then
upgradeRabbitNode $clusterNode
fi
done

#Upgrade the upgrader node now.
echo "Upgrade the core upgrade node ..." >> $LOG_FILE
upgradeRabbitNode $UPGRADER_NODE

#NOW start all nodes, starting with the upgrader node.
echo "Starting rabbit on upgrader node..." >> $LOG_FILE
remote_exec $UPGRADER_FQDN service rabbitmq-server start >> $LOG_FILE
for clusterNode in ${NODE_LIST}; do
if [ $clusterNode != $UPGRADER_NODE ]; then
SERVER_FQDN=`getServerFQDN $clusterNode`
echo "Starting rabbit on NON upgrade nodes..." >> $LOG_FILE
remote_exec $SERVER_FQDN service rabbitmq-server start >> $LOG_FILE
fi
done

#Finally, make sure our HA Policy is applied to all our virtual hosts

echo "Finished with upgrade..." >> $LOG_FILE
#Report how we worked out...
echo "
RESULTS
"
cat $LOG_FILE



On Tue, Aug 27, 2013 at 4:58 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 23/08/13 23:01, Jason McIntosh wrote:
> > A ps auf shows /usr/lib/erlang/erts-5.9.3.1/bin/epmd -daemon as still
> > running.  SO I'm wondering if that might have an impact.
>
> Depending on how you upgraded Erlang you may need to stop this process
> manually. I'd be surprised if this was the cause of the error though.
>
> > stop rabbit on server X (upgrader is Z, other node is Y)
> > remove all rabbit/erlang RPM's
> > Reinstall rabbit software
> > Update rabbitmqadmin
> > Enable management plugins (just in case)
> > Enable auto start.
> >
> > Rinse and repeat on servers Y, then Z and then start bringing them up
> > starting with upgrader node. First start Z, then start Y, then start X.
>
> From which versions did you upgrade?
>
> > On Fri, Aug 23, 2013 at 4:51 PM, Jason McIntosh wrote:
>
> >     =INFO REPORT==== 23-Aug-2013::15:37:45 ===
> >     Disk free limit set to 1000MB
>
> Were there any other log messages in either logfile or console messages
> on any nodes in the interval between or near 15:37:45 - 15:37:50?
>
> >         =ERROR REPORT==== 23-Aug-2013::15:37:50 ===
> >         ** Generic server <0.303.0> terminating
> >         ** Last message in was {'EXIT',<0.350.0>,normal}
> Did you perform the same upgrade in other environments, and the failure
> only occurred in one of the environments?
>
>
>
> -Emile
>
>
>
>
>
>
>
>
>


-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/2b4d3ec6/attachment.htm>

From emile at rabbitmq.com  Tue Aug 27 18:19:10 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Aug 2013 18:19:10 +0100
Subject: [rabbitmq-discuss] Queues disappeared after a cluster upgrade
 to 3.1.5, Erlang R16B01
In-Reply-To: <CAD6m6fGz2Sw-tjNESe6ZiOokr3r4giQMU=pPDviQVW7vuqPaOg@mail.gmail.com>
References: <CAD6m6fGJEKfOcsokTLOwLgOWibzdShf+5bxk6UjMH1h0-Y7-sg@mail.gmail.com>
	<CAD6m6fEcU36QUpUsD-jORhXMYg5UHkkVVvfowrfXKo0XjnfoCQ@mail.gmail.com>
	<CAD6m6fHU-QcXv5nvMNHUaqUHZMVkHjcZLgwRjVRwYMokjRET0Q@mail.gmail.com>
	<521C7862.9010306@rabbitmq.com>
	<CAD6m6fGz2Sw-tjNESe6ZiOokr3r4giQMU=pPDviQVW7vuqPaOg@mail.gmail.com>
Message-ID: <521CDF8E.1000905@rabbitmq.com>

Hi Jason,


On 27/08/13 15:11, Jason McIntosh wrote:
> The ONLY thing that I can think of - I was doing stop/starts as part
> of training of the cluster about 20 minutes before I did the upgrade
> to test various concepts, e.g. message loss, master node recovery,
> etc. etc. At this point, if people haven't seen or heard of this,
> I'll chalk it up to something funky disk or otherwise until I can try
> and replicate it.

This unlikely to be a disk issue.

We have seen this stacktrace before, but not in the context of upgrading
and always in the presence of some other error that turned out to be the
root cause. The cases that we were testing also involved lots of
starting and stopping of nodes. That might be a prerequisite.

> My biggest concern at this point is that because i no longer have the
> backup's of the mnesia database, replicating the environment won't
> replicate exactly what was in the database, and so I won't be able to
> replicate it. When I start deploying to our production environment, I
> won't make that mistake - I'll shutdown rabbit, back up my whole
> rabbit_data_directory first :)

If you are able to reproduce the error then a database backup might be
helpful. Even if you can provide more of the log entries from your
previous message to show how & when nodes are started in relation to
each other.





-Emile





From davidv at spindance.com  Tue Aug 27 23:20:05 2013
From: davidv at spindance.com (David van Geest)
Date: Tue, 27 Aug 2013 18:20:05 -0400
Subject: [rabbitmq-discuss] does RabbitMQ or Erlang/OTP attempt to match the
	CN of a client TLS cert?
Message-ID: <CANaOvh9uX4a219K6fWGrqOgJtMMeNMhvF9A5W=7-FEW1mLdcOQ@mail.gmail.com>

Hi all,

If a client connects to RabbitMQ using TLS, and client certificates are
required by RabbitMQ, will RabbitMQ or Erlang/OTP attempt to match the CN
on the client certificate with the client's hostname? Does it attempt to
match the client certificate CN with anything at all?

Thanks,
-David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/f1085ea8/attachment.htm>

From davidv at spindance.com  Tue Aug 27 23:45:31 2013
From: davidv at spindance.com (David van Geest)
Date: Tue, 27 Aug 2013 18:45:31 -0400
Subject: [rabbitmq-discuss] does RabbitMQ or Erlang/OTP attempt to match
 the CN of a client TLS cert?
In-Reply-To: <CANaOvh9uX4a219K6fWGrqOgJtMMeNMhvF9A5W=7-FEW1mLdcOQ@mail.gmail.com>
References: <CANaOvh9uX4a219K6fWGrqOgJtMMeNMhvF9A5W=7-FEW1mLdcOQ@mail.gmail.com>
Message-ID: <CANaOvh95jVuS5jstSv0Q1hfDcHc6rQhfCPaqiZC2Yp2JigEhfw@mail.gmail.com>

On Tue, Aug 27, 2013 at 6:20 PM, David van Geest <davidv at spindance.com>wrote:

>
> If a client connects to RabbitMQ using TLS, and client certificates are
> required by RabbitMQ, will RabbitMQ or Erlang/OTP attempt to match the CN
> on the client certificate with the client's hostname? Does it attempt to
> match the client certificate CN with anything at all?
>
>
Reading a bit more, it seems like the CN only matters if you are
using rabbitmq-auth-mechanism-ssl which will attempt to match the
certificate CN vs the user database in question. If you are using some
other SASL mechanism (say, PLAIN), the CN does not matter. Correct?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/a0b53d6c/attachment.htm>

From akbar.pirani7 at gmail.com  Wed Aug 28 00:09:08 2013
From: akbar.pirani7 at gmail.com (Akbar Pirani)
Date: Tue, 27 Aug 2013 19:09:08 -0400
Subject: [rabbitmq-discuss] Problems with running RabbitMQ auth backend http
 plugin built from source with RabbitMQ 3.1.5 release
Message-ID: <CAMVmnJQ30yFYxg2xRqM2ZOrUE_jnB2HfaDDjQpMobyLfWfnKGg@mail.gmail.com>

I am using RabbitMQ 3.1.5 on Mac OS X 10.8.4 (12E55) installed using brew.
Since the rabbitmq-auth-backend-http plugin is not provided with the
release I built it from the source using the build process described at
http://correlia.blogspot.com/2012/07/rabbitmq-with-http-backend-plugin.html
 and http://www.rabbitmq.com/plugin-development.html

The plugin was built using Erlang R15B03 (erts-5.9.3.1). Then I copied the
built plugin in rabbitmq plugins directory and enabled it and tried to use
it by making a web stomp request. I am getting the following error
in rabbit at localhost.log

=ERROR REPORT==== 26-Aug-2013::20:19:26 ===
** Generic server <0.533.0> terminating
** Last message in was connect
** When Server state == {state,amqp_direct_connection,
                            {state,undefined,undefined,undefined,undefined,
                                undefined,undefined,undefined},
                            <0.532.0>,undefined,
                            {amqp_params_direct,
                                <<"6c979dea-8d9a-4921-85d0-c5e9c2539126">>,
                                <<"5e860b7b-00fe-4d9c-98e7-7fe3bb7a73d3">>,
                                <<"/">>,rabbit at localhost,
                                {amqp_adapter_info,
                                    {127,0,0,1},
                                    15674,
                                    {127,0,0,1},
                                    52498,
                                    <<"127.0.0.1:52498 -> 127.0.0.1:15674
">>,
                                    {'Web STOMP',"1.0"},
                                    [{ssl,false}]},
                                []},
                            undefined,undefined,
                            #Fun<amqp_connection_sup.1.55585968>,
                            #Fun<amqp_connection_sup.2.55585968>,false}
** Reason for termination ==
** {{case_clause,
        {badrpc,
            {'EXIT',
                {undef,
                    [{edoc_lib,escape_uri,
                         ["6c979dea-8d9a-4921-85d0-c5e9c2539126"],
                         []},
                     {rabbit_auth_backend_http,escape,2,
                         [{file,"src/rabbit_auth_backend_http.erl"},
                          {line,96}]},
                     {rabbit_auth_backend_http,'-q/2-lc$^0/1-0-',1,
                         [{file,"src/rabbit_auth_backend_http.erl"},
                          {line,91}]},
                     {rabbit_auth_backend_http,q,2,
                         [{file,"src/rabbit_auth_backend_http.erl"},
                          {line,91}]},
                     {rabbit_auth_backend_http,check_user_login,2,
                         [{file,"src/rabbit_auth_backend_http.erl"},
                          {line,37}]},
                     {rabbit_access_control,'-check_user_login/2-fun-0-',4,

 [{file,"src/rabbit_access_control.erl"},{line,56}]},
                     {lists,foldl,3,[{file,"lists.erl"},{line,1248}]},
                     {rabbit_direct,connect0,7,
                         [{file,"src/rabbit_direct.erl"},{line,88}]}]}}}},
    [{amqp_direct_connection,connect,4,
         [{file,"src/amqp_direct_connection.erl"},{line,132}]},
     {amqp_gen_connection,handle_call,3,
         [{file,"src/amqp_gen_connection.erl"},{line,177}]},
     {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
     {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}

Any ideas on what the problem is and how it can be resolved?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/dc6f4a27/attachment.htm>

From akbar.pirani7 at gmail.com  Tue Aug 27 23:59:22 2013
From: akbar.pirani7 at gmail.com (Akbar Pirani)
Date: Tue, 27 Aug 2013 15:59:22 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-http plugin for RabbitMQ
	3.1.5
Message-ID: <7ae8b9ef-b5a7-44c0-a09e-5cddb972ed6d@googlegroups.com>

I am using RabbitMQ 3.1.5 on Mac OS X 10.8.4 (12E55) installed using brew. 
Since the rabbitmq-auth-backend-http plugin is not provided with the 
release I built it from the source using the build process described 
at http://correlia.blogspot.com/2012/07/rabbitmq-with-http-backend-plugin.html 
and http://www.rabbitmq.com/plugin-development.html

The plugin was built using Erlang R15B03 (erts-5.9.3.1). Then I copied the 
built plugin in rabbitmq plugins directory and enabled it and tried to use 
it by making a web stomp request. I am getting the following error 
in rabbit at localhost.log

=ERROR REPORT==== 26-Aug-2013::20:19:26 ===
** Generic server <0.533.0> terminating
** Last message in was connect
** When Server state == {state,amqp_direct_connection,
                            {state,undefined,undefined,undefined,undefined,
                                undefined,undefined,undefined},
                            <0.532.0>,undefined,
                            {amqp_params_direct,
                                <<"6c979dea-8d9a-4921-85d0-c5e9c2539126">>,
                                <<"5e860b7b-00fe-4d9c-98e7-7fe3bb7a73d3">>,
                                <<"/">>,rabbit at localhost,
                                {amqp_adapter_info,
                                    {127,0,0,1},
                                    15674,
                                    {127,0,0,1},
                                    52498,
                                    <<"127.0.0.1:52498 -> 
127.0.0.1:15674">>,
                                    {'Web STOMP',"1.0"},
                                    [{ssl,false}]},
                                []},
                            undefined,undefined,
                            #Fun<amqp_connection_sup.1.55585968>,
                            #Fun<amqp_connection_sup.2.55585968>,false}
** Reason for termination ==
** {{case_clause,
        {badrpc,
            {'EXIT',
                {undef,
                    [{edoc_lib,escape_uri,
                         ["6c979dea-8d9a-4921-85d0-c5e9c2539126"],
                         []},
                     {rabbit_auth_backend_http,escape,2,
                         [{file,"src/rabbit_auth_backend_http.erl"},
                          {line,96}]},
                     {rabbit_auth_backend_http,'-q/2-lc$^0/1-0-',1,
                         [{file,"src/rabbit_auth_backend_http.erl"},
                          {line,91}]},
                     {rabbit_auth_backend_http,q,2,
                         [{file,"src/rabbit_auth_backend_http.erl"},
                          {line,91}]},
                     {rabbit_auth_backend_http,check_user_login,2,
                         [{file,"src/rabbit_auth_backend_http.erl"},
                          {line,37}]},
                     {rabbit_access_control,'-check_user_login/2-fun-0-',4,
                        
 [{file,"src/rabbit_access_control.erl"},{line,56}]},
                     {lists,foldl,3,[{file,"lists.erl"},{line,1248}]},
                     {rabbit_direct,connect0,7,
                         [{file,"src/rabbit_direct.erl"},{line,88}]}]}}}},
    [{amqp_direct_connection,connect,4,
         [{file,"src/amqp_direct_connection.erl"},{line,132}]},
     {amqp_gen_connection,handle_call,3,
         [{file,"src/amqp_gen_connection.erl"},{line,177}]},
     {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
     {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}

Any ideas on what the problem is and how it can be resolved?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/739edadf/attachment.htm>

From akbar.pirani7 at gmail.com  Wed Aug 28 00:01:01 2013
From: akbar.pirani7 at gmail.com (Akbar Pirani)
Date: Tue, 27 Aug 2013 19:01:01 -0400
Subject: [rabbitmq-discuss] stomp plugin doesn't work in Ubuntu Natty
In-Reply-To: <4DA46077.9030001@rabbitmq.com>
References: <4DA46077.9030001@rabbitmq.com>
Message-ID: <521D2FAD.8050706@gmail.com>

I am using RabbitMQ 3.1.5 on Mac OS X 10.8.4 (12E55) installed using 
brew. Since the rabbitmq-auth-backend-http plugin is not provided with 
the release I built it from the source using the build process described 
at 
http://correlia.blogspot.com/2012/07/rabbitmq-with-http-backend-plugin.html 
<http://correlia.blogspot.com/2012/07/rabbitmq-with-http-backend-plugin.html>and 
http://www.rabbitmq.com/plugin-development.html 
<http://www.rabbitmq.com/plugin-development.html>

The plugin was built using Erlang R15B03 (erts-5.9.3.1). Then I copied 
the built plugin in rabbitmq plugins directory and enabled it and tried 
to use it by making a web stomp request. I am getting the following 
error in rabbit at localhost.log

=ERROR REPORT==== 26-Aug-2013::20:19:26 ===
** Generic server <0.533.0> terminating
** Last message in was connect
** When Server state == {state,amqp_direct_connection,
             {state,undefined,undefined,undefined,undefined,
                 undefined,undefined,undefined},
             <0.532.0>,undefined,
             {amqp_params_direct,
                 <<"6c979dea-8d9a-4921-85d0-c5e9c2539126">>,
                 <<"5e860b7b-00fe-4d9c-98e7-7fe3bb7a73d3">>,
                 <<"/">>,rabbit at localhost,
                 {amqp_adapter_info,
                     {127,0,0,1},
                     15674,
                     {127,0,0,1},
                     52498,
                     <<"127.0.0.1:52498 
<http://127.0.0.1:52498/>->127.0.0.1:15674 <http://127.0.0.1:15674/>">>,
                     {'Web STOMP',"1.0"},
                     [{ssl,false}]},
                 []},
             undefined,undefined,
             #Fun<amqp_connection_sup.1.55585968>,
             #Fun<amqp_connection_sup.2.55585968>,false}
** Reason for termination ==
** {{case_clause,
         {badrpc,
{'EXIT',
{undef,
     [{edoc_lib,escape_uri,
          ["6c979dea-8d9a-4921-85d0-c5e9c2539126"],
          []},
      {rabbit_auth_backend_http,escape,2,
          [{file,"src/rabbit_auth_backend_http.erl"},
           {line,96}]},
      {rabbit_auth_backend_http,'-q/2-lc$^0/1-0-',1,
          [{file,"src/rabbit_auth_backend_http.erl"},
           {line,91}]},
      {rabbit_auth_backend_http,q,2,
          [{file,"src/rabbit_auth_backend_http.erl"},
           {line,91}]},
      {rabbit_auth_backend_http,check_user_login,2,
          [{file,"src/rabbit_auth_backend_http.erl"},
           {line,37}]},
      {rabbit_access_control,'-check_user_login/2-fun-0-',4,
          [{file,"src/rabbit_access_control.erl"},{line,56}]},
      {lists,foldl,3,[{file,"lists.erl"},{line,1248}]},
      {rabbit_direct,connect0,7,
          [{file,"src/rabbit_direct.erl"},{line,88}]}]}}}},
[{amqp_direct_connection,connect,4,
  [{file,"src/amqp_direct_connection.erl"},{line,132}]},
  {amqp_gen_connection,handle_call,3,
  [{file,"src/amqp_gen_connection.erl"},{line,177}]},
  {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
  {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}

Any ideas on what the problem is and how it can be resolved?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130827/cfbdfc29/attachment.htm>

From emile at rabbitmq.com  Wed Aug 28 09:55:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Aug 2013 09:55:25 +0100
Subject: [rabbitmq-discuss] stomp plugin doesn't work in Ubuntu Natty
In-Reply-To: <521D2FAD.8050706@gmail.com>
References: <4DA46077.9030001@rabbitmq.com> <521D2FAD.8050706@gmail.com>
Message-ID: <521DBAFD.3010305@rabbitmq.com>


Hi,

On 28/08/13 00:01, Akbar Pirani wrote:
> I am using RabbitMQ 3.1.5 on Mac OS X 10.8.4 (12E55) installed using
> brew. Since the rabbitmq-auth-backend-http plugin is not provided with
> the release

Are you sure? What does "rabbitmq-plugins list" return?

>                 {undef,
>                     [{edoc_lib,escape_uri,

If this is undefined then your Erlang installation is incomplete. Make
sure EDoc in installed: http://www.erlang.org/doc/apps/edoc/chapter.html

> Any ideas on what the problem is and how it can be resolved?

Definitely nothing to do with Ubuntu Natty - please start a new question
on a new thread.





-Emile




From emile at rabbitmq.com  Wed Aug 28 10:36:01 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Aug 2013 10:36:01 +0100
Subject: [rabbitmq-discuss] does RabbitMQ or Erlang/OTP attempt to match
 the CN of a client TLS cert?
In-Reply-To: <CANaOvh95jVuS5jstSv0Q1hfDcHc6rQhfCPaqiZC2Yp2JigEhfw@mail.gmail.com>
References: <CANaOvh9uX4a219K6fWGrqOgJtMMeNMhvF9A5W=7-FEW1mLdcOQ@mail.gmail.com>
	<CANaOvh95jVuS5jstSv0Q1hfDcHc6rQhfCPaqiZC2Yp2JigEhfw@mail.gmail.com>
Message-ID: <521DC481.3050702@rabbitmq.com>

On 27/08/13 23:45, David van Geest wrote:
> On Tue, Aug 27, 2013 at 6:20 PM, David van Geest <davidv at spindance.com
> <mailto:davidv at spindance.com>> wrote:
> 
> 
>     If a client connects to RabbitMQ using TLS, and client certificates
>     are required by RabbitMQ, will RabbitMQ or Erlang/OTP attempt to
>     match the CN on the client certificate with the client's hostname?
>     Does it attempt to match the client certificate CN with anything at all?
> 
> 
> Reading a bit more, it seems like the CN only matters if you are
> using rabbitmq-auth-mechanism-ssl which will attempt to match the
> certificate CN vs the user database in question. If you are using some
> other SASL mechanism (say, PLAIN), the CN does not matter. Correct?

Yes. It is also possible to provide your own verification function that
accepts a certificate. This Erlang function accepts a certificate as one
of its arguments. See the verify_fun configuration option in
http://www.erlang.org/doc/man/ssl.html




-Emile




From tim at rabbitmq.com  Wed Aug 28 10:57:08 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 28 Aug 2013 10:57:08 +0100
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
In-Reply-To: <07bc01ce9fa6$91259570$b370c050$@gmail.com>
References: <1217501ce9425$026e58d0$074b0a70$@gmail.com>
	<062d01ce9ee5$f181d440$d4857cc0$@gmail.com>
	<1CC19277-0A54-4D4B-AB59-591990BEDA67@gopivotal.com>
	<07bc01ce9fa6$91259570$b370c050$@gmail.com>
Message-ID: <A842478B-8993-4C1A-ACCF-96897EBB8E24@rabbitmq.com>

Junius,

On 23 Aug 2013, at 03:14, Junius Wang wrote:
> Before every test ( after a new RabbitMQ node added/removed to the cluster):
> 1).we reset the policy to "exactly" on 2 nodes. 2). declared 10 queues using
> rabbitmqctl and force them distributed evenly on all nodes.  e.g.in a 2 node
> cluster,5 queues resides on rabbit1, another 5 resides on rabbit2. 3-3-4 for
> 3 node cluster ,3-3-2-2 for 4 node cluster.   3) declare a 'topic" exchange
> 4) binding the 10 queues to the exchange with 10 different routing keys.
> Publishers publish messages with the 10 routing keys by turns. Thus all
> queues receive the same number of messages.  
> Is the number of queues large enough?  we can declare more queues in test
> but I don't think there will be too many queues in production.  
> 

Let's re-visit the point Michael made about adding more queues:

"the way you extend capacity with RabbitMQ is by adding nodes and using more queues"

In any messaging system where queues exhibit FIFO behaviour, each queue is a concurrency bottleneck, because it can handle only 1 message at a time. If the queue handled more than 1 inbound message at a time, it would not be possible to enforce the FIFO characteristics, since without some kind of concurrency control the ordering would be non-deterministic. The question of whether or not the number of queues is "large enough" is application specific. Where you need FIFO ordering, you'll want a single queue. Where you are processing messages separately and/or do not require ordering (e.g., between messages of different "types") then you can use separate queues: this is a design choice that only you can make. The point Michael made is that the more queues you shove messages into, the better the concurrency will be, which in turn may yield performance benefits in terms of throughput.

As to the point about "adding nodes" - a single RabbitMQ node has a finite processing capacity, dependent on available operating system resources and client usage patterns. If you work out the maximum capacity "n" of a single node in your application, where the combination of available system resources and application load on the broker is at its peak, then by adding a second node, you might increase the system's overall capacity to something close to 2n. There are important caveats here though, as Michael has already pointed out: clients can connect to any node in a cluster, but if the queue with which they're communicating resides on another node, messages (both in and out of the broker) must be transmitted between nodes.

> publishers connect to the cluster via load balancer(AWS ELB) as well as
> consumers, they don't know to which node they are connect.  So we may not
> decrease the intra-cluster traffic. But  we can try some high bandwidth
> instances. Does this help?

Increased bandwidth might be helpful, but the points Michael made will still stand. There is always going to be "some" additional overhead due to inter-node communications, because network latency is the dominating factor here. Think about a classic 2-tier application: the biggest "cost" is usually communicating with the backend (e.g., a database or some such), and *that* cost is due to the network round trips more often than not.

> Another question is that we will have a queue with lots of messages
> handled, perhaps 5000/sec(size of 2K), which is about 90% of the total
> messages handled by the cluster.  It's hard for us to split it into multiple
> queues, it's really a big design change which we try to avoid. From your
> comments, even if messages are synchronized on only 2 nodes , hardly we can
> get linear scaling , right?

That's correct. The queue must handle messages in FIFO order and has an upper bound on how fast it can receive from and/or deliver messages to its clients.

> If so, is the network traffic the major factor impacting the performance? If so ,we can try some high bandwidth instances
> or using AWS instance group. Hopes that will get better performance.

Yes and no. If the clients interacting with the queue are connected to another node, then the cost of inter-node traffic will have an impact. A equally important potential cost you must be aware of though, is that of mirroring the queue across even two cluster nodes. When a queue is mirrored, the master queue process cannot take full responsibility for a message until that message has been accepted by all replicas. Even if the mirroring policy is set to "exactly 2 nodes", this still means that a message delivered to the queue on node-1 must also be transmitted to node-2. If the message is 'persistent', then both nodes must flush to disk. If confirms are in use, no confirm can be issued until both nodes have received the message, flushed it to disk and the master *knows* that this has taken place. That's a lot of work per-message.

So as Michael said, HA/Mirroring is not a feature that helps performance - it is a feature that increases resiliency in case of node failures. Adding bandwidth is only part of the story. Even with more bandwidth, there is still going to be higher latency, not only because of the amount of inter-node traffic, but also because each node has to complete some work in order to keep the replicas in sync.

I would suggest that you look very hard at that "queue with lots of messages handled" and see if you can split it up. Imagine if you were writing to a database and you had this one giant table that almost every transaction had to write to. This would become a bottleneck quickly and you'd look to split it up if possible, or if not then at least to partition it based on suitable indexes. We don't have a feature for "partitioning a queue over multiple nodes" yet, so you'll have to think about partitioning the messages yourself. If you can do that, and therefore increase the number of queues that are able to concurrently handle messages, you should get a decent performance increase.

HTH.

Tim

> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael
> Klishin
> Sent: Thursday, August 22, 2013 4:56 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] questions about RabbitMQ linear scalability
> 
> Junius Wang:
> 
>> 1.       The throughput of two node cluster is 50%-60% worse than a single
> node broker.
> 
> With mirroring, messages have to be copied to multiple (N or, depending on
> configuration, even all) nodes in the cluster. That obviously takes more
> time than not copying anything.
> 
>> 2.       Adding more node did have improvement on throughput but we only
> got 25% improvement(throughput of 3 node cluster is 25% better than 2 node
> cluster. 4 node cluster is 25% better than 3 node cluster too). What we
> expected is a 45-degree line, that means when 2 nodes are used the
> throughput is double. With 3 nodes, then triple.
> 
> You are not providing any details about your workload but the way you extend
> capacity with RabbitMQ is by adding nodes and using more queues. Queue
> mirroring is an HA feature, which means copying more data across the
> cluster.
> 
> Maximum throughput and highest availability are largely at odds with each
> other, so you need to
> 
> 1. Use multiple queues (and the number should grow with the number of nodes)
> 2. Choose what queues to mirror. Likely not all queues are equally important
> to your system, so you can make some of them non-HA.
> 3. Configure mirroring to, say, 2 nodes instead of "all".
> 4. If you know what node is the master for a particular queue (e.g. was
> declared on that node),
>     make your clients connect there. It will decrease intra-cluster
> traffic.
> --
> MK
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Wed Aug 28 11:00:15 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 28 Aug 2013 11:00:15 +0100
Subject: [rabbitmq-discuss] Network partitions
In-Reply-To: <0B8CD6850421B745BE39BC5C7601923271FFA6DB@DDCEP50016.na.corp.mckesson.com>
References: <0B8CD6850421B745BE39BC5C7601923271FFA6DB@DDCEP50016.na.corp.mckesson.com>
Message-ID: <D68AB25D-2244-41BF-8940-B4E610E705B2@rabbitmq.com>

Hi Ron,

Can you provide a bit more detail about which nodes detected a partition, what the log messages said when this happened and what the network topology looks like? If the nodes are "loosing touch" with each other due to latency in one or more switches, it may be necessary to look at the net_tick time interval used to detect partitions between erlang VMs. I would however, be vary wary of messing about with this kind of setting, since unintended consequences may ensue. The more you can tell us about the symptoms and your environment, the better we'll be able to advise you.

Cheers,

Tim

On 23 Aug 2013, at 19:55, Cordell, Ron wrote:

> Just curious about if people using RMQ clusters have issues with network partitions and what they've done to try to resolve them.
> 
> We're using RMQ 3.1.3 at the moment in a clustered configuration. We're not quite using it in a production capacity at this point. We are seeing nodes in the cluster declaring a network partition and we're in the process of trying to determine what's going on.
> 
> What have others done when seeing network partition issues like this?
> 
> To answer some up front questions:
> all nodes in the cluster are in the same network VLAN
> All nodes in the cluster are not on the same switch, necessarily, for HA reasons
> The cluster is behind an F5 load balancer that presents a VIP to the application
> Cheers,
> 
> Ron Cordell
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/8d3b6dac/attachment.htm>

From emile at rabbitmq.com  Wed Aug 28 11:04:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Aug 2013 11:04:33 +0100
Subject: [rabbitmq-discuss] Network partitions
In-Reply-To: <0B8CD6850421B745BE39BC5C7601923271FFA6DB@DDCEP50016.na.corp.mckesson.com>
References: <0B8CD6850421B745BE39BC5C7601923271FFA6DB@DDCEP50016.na.corp.mckesson.com>
Message-ID: <521DCB31.8030405@rabbitmq.com>


Hi Ron,

On 23/08/13 19:55, Cordell, Ron wrote:
> Just curious about if people using RMQ clusters have issues with network
> partitions and what they've done to try to resolve them.

Clusters partition if network connectivity between nodes is lost, so
that would be the first place to look. The broker logfiles will contain
the time of the event which you can use to correlate with events from
your own network monitoring.

Clustering is not recommended if the network between nodes is
unreliable. For further details on how to diagnose and respond to
partitions see https://www.rabbitmq.com/partitions.html


-Emile





From nayak.arindam at gmail.com  Wed Aug 28 12:15:11 2013
From: nayak.arindam at gmail.com (Arindam Nayak)
Date: Wed, 28 Aug 2013 04:15:11 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
Message-ID: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>

I have written a rabbitmq consumer service, which is a windows service, it 
constantly polls (something like while(true)) and reads queue data and 
process, it works fine for 4-5 days, but suddenly after that it gets 
detached from queue and stalls windows service until i manually restarts 
that windows service. I have using .net client libraries. I have also added 
restart code. that re creates connection , binds to queue and then listens 
, but that restart code does not work. When i tried to debug the service, 
it does not help, it stops debug process abruptly , at connection 
re-creation time. Please help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/1fdfe20a/attachment.htm>

From emile at rabbitmq.com  Wed Aug 28 12:47:46 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Aug 2013 12:47:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
Message-ID: <521DE362.10209@rabbitmq.com>


Hi,

On 28/08/13 12:15, Arindam Nayak wrote:
> it gets detached from queue and stalls windows service

> When i tried to debug the service, it does not help

What do you mean by "detached"? Was the network disconnected?

Have you checked the broker logfiles or the OS event log? Does
"rabbitmqctl report" produce output that you can share?

Does this only happen when running as a service, or does the same happen
when the broker is run as a foreground application?

How did you debug the service - what were the results?

Any other diagnostic information you can provide will help determine the
cause.



-Emile





From drazvan at gmail.com  Wed Aug 28 13:30:32 2013
From: drazvan at gmail.com (Razvan Dinu)
Date: Wed, 28 Aug 2013 05:30:32 -0700 (PDT)
Subject: [rabbitmq-discuss] A weird case of "PRECONDITION_FAILED - unknown
	delivery tag"
Message-ID: <14c94f91-d0b8-467a-9f03-c72b2e9ad7f5@googlegroups.com>

Hello guys,

I've been using RabbitMQ for a while, but this time I have an error which I 
did not manage to track down:  "PRECONDITION_FAILED - unknown delivery tag 
XXX"  (where XXX varies).

Now, I've done my research and I know it's usually because of double 
ack-ing, ack-ing on wrong channels or ack-ing messages that should not be 
ack-ed. I've checked at least a dozen times, and it doesn't seem to be the 
case for me. 

I've simplified the scenario to the minimum required to reproduce the error 
(I'm running RabbitMQ 3.0.3 Erlang R15B01; the code is written in python 
using pika 0.9.10p0). 

I have one working agent which has two threads:
 - thread one that fetches tasks continuously and puts them in a list
 - a worker thread that continuously takes tasks from the list and performs 
them

See code here: http://pastebin.com/PG8quVSw

Here's what happens (see example output here: http://pastebin.com/6f1sWsYa ): 
the agent starts by initializing, pre-fetches 10 tasks (the prefech_count 
is set to 10) and then tasks are executed one by one. We can see that as 
soon as one task is ACK-ed, a new one is fetched so that the prefetch queue 
is staying at 10 items. However, as we can see at line 52 in the example 
output, the error message (406, 'PRECONDITION_FAILED - unknown delivery tag 
12') is returned. The channel is closed, and when the next 10 tasks from 
the prefetch queue try to send the ACK they get the error that the channel 
is closed. The tasks are prefetched again on the new channel that was 
opened automatically and then everything continues fine till the end (there 
were 60 tasks in total in the queue). 

THE PROBLEM: why did ACK 12 failed?

I managed to reproduce this consistently, but always at at different 
message, sometimes 42, 34 etc. One weird thing is that the error about the 
unknown delivery tag is not returned on the call to basic_ack (line 13 in 
the code), but on the code that consumes the queue (line 45). My guess is 
that there's a race somewhere, but can't figure where. In pika maybe? If I 
uncomment lines 34 and 35 from the code, it happens a lot less, but it 
still happens 1-2 times on 1000 messages. I think it has something to do 
with ACK-ing from one thread using the same channel that is used for 
listening on another thread. But I see no other way of implementing this 
scenario, with an internal pre-fetch queue on the consumer side. And to 
answer the question, why do I need this, it's because I need the worker to 
be able to take a peak at some of the tasks in the queues.

Any ideas? 

Thanks,
Raz



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/f8f0c91a/attachment.htm>

From nayak.arindam at gmail.com  Wed Aug 28 14:20:02 2013
From: nayak.arindam at gmail.com (Arindam)
Date: Wed, 28 Aug 2013 18:50:02 +0530
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <521DE362.10209@rabbitmq.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<521DE362.10209@rabbitmq.com>
Message-ID: <CAJ=9sHu-=an7tdfHG7LMdDMU5CRToO0B6dfjK_oepPZgS=mVwA@mail.gmail.com>

Please see my replies inline.

What do you mean by "detached"? Was the network disconnected?

*Detached means -- consumer is not able to process data from queue.*
*
*
*Scenario- when consume is up, it shows in management UI , consumers
section of queue.*
*
*
*when consumer is detached, in management UI , it no more displays that
consumer. when i check with that windows service, it shows service is
running fine, but log file for that service shows "SharedQueue closed".*
*
*
*No, the network in up at all time, i don' t know exact reason for
disconnection (may be that queue is idle for some time period) . Make a
note that, rabbitmq server is hosted in one machine(windows server 2008)
and consumer runs from other system (windows server 2003). Both has got
same version of rabbit mq server DLLs.*

Have you checked the broker logfiles or the OS event log? Does
"rabbitmqctl report" produce output that you can share?

*No i have not checked that, can you tell me location for that log files?
and how to use that command, and decode informations.*


Does this only happen when running as a service, or does the same happen
when the broker is run as a foreground application?
*
*
*I have not tested consumer/broker in foreground, but i need that in
windows service only, so that my problem will be resolved.*

How did you debug the service - what were the results?

*I have created a console app with same code as service, then manually
introduced an exception and tried restarting the consumer (added init code
for connection, model, consumer -- Model.BasicConsume(QueueName, autoAck,
consumer)), but it abruptly escapes/exits the debug program.*

Any other diagnostic information you can provide will help determine the
cause.

*I have one more error in log file --  The AMQP operation was interrupted:
AMQP close-reason, initiated by Application, code=200, text="Goodbye",
classId=0, methodId=0, cause= *

*Regards*
*Arindam Nayak*
*Pune *
*+91 8600491854*


On 28 August 2013 17:17, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 28/08/13 12:15, Arindam Nayak wrote:
> > it gets detached from queue and stalls windows service
>
> > When i tried to debug the service, it does not help
>
> What do you mean by "detached"? Was the network disconnected?
>
> Have you checked the broker logfiles or the OS event log? Does
> "rabbitmqctl report" produce output that you can share?
>
> Does this only happen when running as a service, or does the same happen
> when the broker is run as a foreground application?
>
> How did you debug the service - what were the results?
>
> Any other diagnostic information you can provide will help determine the
> cause.
>
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/660286bb/attachment.htm>

From emile at rabbitmq.com  Wed Aug 28 14:21:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Aug 2013 14:21:18 +0100
Subject: [rabbitmq-discuss] A weird case of "PRECONDITION_FAILED -
 unknown delivery tag"
In-Reply-To: <14c94f91-d0b8-467a-9f03-c72b2e9ad7f5@googlegroups.com>
References: <14c94f91-d0b8-467a-9f03-c72b2e9ad7f5@googlegroups.com>
Message-ID: <521DF94E.1010409@rabbitmq.com>


Hi,

On 28/08/13 13:30, Razvan Dinu wrote:

> it's usually because of double ack-ing, ack-ing on wrong channels or
> ack-ing messages that should not be ack-ed. I've checked at least a
> dozen times, and it doesn't seem to be the case for me.

A good way to verify that claim independently from the client code is to
connect to the broker via the Tracer:

http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html

The protocol trace will show whether messages are being acknowledged
correctly.

> I think it has something to do with ACK-ing from one thread using the
> same channel that is used for listening on another thread.

If you use multiple threads to access the same channel then you must
make sure they are synchronised. A better solution is to provide each
thread with its own channel.

> it's because I need the worker to be able to take a peak at some of
> the tasks in the queues.

Can the criteria being peeked at be placed in a header or the routing
key instead? Try to route those messages differently and avoid the need
for peeking.




-Emile



From emile at rabbitmq.com  Wed Aug 28 14:41:20 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Aug 2013 14:41:20 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <CAJ=9sHu-=an7tdfHG7LMdDMU5CRToO0B6dfjK_oepPZgS=mVwA@mail.gmail.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<521DE362.10209@rabbitmq.com>
	<CAJ=9sHu-=an7tdfHG7LMdDMU5CRToO0B6dfjK_oepPZgS=mVwA@mail.gmail.com>
Message-ID: <521DFE00.5040507@rabbitmq.com>

On 28/08/13 14:20, Arindam wrote:
> What do you mean by "detached"? Was the network disconnected?
> 
> /Detached means -- consumer is not able to process data from queue./
>
> /Scenario- when consume is up, it shows in management UI , consumers
> section of queue./
>
> /when consumer is detached, in management UI , it no more displays that
> consumer. when i check with that windows service, it shows service is
> running fine, but log file for that service shows "SharedQueue closed"./
>
> /No, the network in up at all time, i don' t know exact reason for
> disconnection (may be that queue is idle for some time period) ./

If you suspect a network timeout then please turn on AMQP heartbeats and
see if that helps.

> Have you checked the broker logfiles or the OS event log? Does
> "rabbitmqctl report" produce output that you can share?
> 
> /No i have not checked that, can you tell me location for that log
> files? and how to use that command, and decode informations./

Please see the "Logging" section:
http://www.rabbitmq.com/install-windows.html

The instructions on how to use that command are documented:
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html


> Does this only happen when running as a service, or does the same happen
> when the broker is run as a foreground application?
> /
> /I have not tested consumer/broker in foreground, but i need that in
> windows service only, so that my problem will be resolved./

Running as an application will help determine whether the problem is
service-specific.

> Any other diagnostic information you can provide will help determine the
> cause.
> 
> /I have one more error in log file --  The AMQP operation was
> interrupted: AMQP close-reason, initiated by Application, code=200,
> text="Goodbye", classId=0, methodId=0, cause= /

This means the client application closed the connection normally. Check
why your application closed the connection.





-Emile



From nayak.arindam at gmail.com  Wed Aug 28 15:08:34 2013
From: nayak.arindam at gmail.com (Arindam)
Date: Wed, 28 Aug 2013 19:38:34 +0530
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <521DFE00.5040507@rabbitmq.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<521DE362.10209@rabbitmq.com>
	<CAJ=9sHu-=an7tdfHG7LMdDMU5CRToO0B6dfjK_oepPZgS=mVwA@mail.gmail.com>
	<521DFE00.5040507@rabbitmq.com>
Message-ID: <CAJ=9sHsXCvZbUeu24KDNRfy6aGLuaqHACJdRPOB2pkzVjLtrQw@mail.gmail.com>

Thanks for your reply!

I have checked rabbitmq server log, it is showing error as
"connection_closed_abruptly".
I am using rabbitmq's topic exchange conf. So i am having 4-5 consumers.
but single server with one exchange, having 5 routing key- each mapped to 5
queue. 5 queue has got 5 consumer in diff machines. So even if, one
consumer is down, still others are working. How is it possible, even i
don't know. So i have written code to restart, that does not even work. But
if i manually restarts service in that particular system, this helps.

- Arindam


On 28 August 2013 19:11, Emile Joubert <emile at rabbitmq.com> wrote:

> On 28/08/13 14:20, Arindam wrote:
> > What do you mean by "detached"? Was the network disconnected?
> >
> > /Detached means -- consumer is not able to process data from queue./
> >
> > /Scenario- when consume is up, it shows in management UI , consumers
> > section of queue./
> >
> > /when consumer is detached, in management UI , it no more displays that
> > consumer. when i check with that windows service, it shows service is
> > running fine, but log file for that service shows "SharedQueue closed"./
> >
> > /No, the network in up at all time, i don' t know exact reason for
> > disconnection (may be that queue is idle for some time period) ./
>
> If you suspect a network timeout then please turn on AMQP heartbeats and
> see if that helps.
>
> > Have you checked the broker logfiles or the OS event log? Does
> > "rabbitmqctl report" produce output that you can share?
> >
> > /No i have not checked that, can you tell me location for that log
> > files? and how to use that command, and decode informations./
>
> Please see the "Logging" section:
> http://www.rabbitmq.com/install-windows.html
>
> The instructions on how to use that command are documented:
> http://www.rabbitmq.com/man/rabbitmqctl.1.man.html
>
>
> > Does this only happen when running as a service, or does the same happen
> > when the broker is run as a foreground application?
> > /
> > /I have not tested consumer/broker in foreground, but i need that in
> > windows service only, so that my problem will be resolved./
>
> Running as an application will help determine whether the problem is
> service-specific.
>
> > Any other diagnostic information you can provide will help determine the
> > cause.
> >
> > /I have one more error in log file --  The AMQP operation was
> > interrupted: AMQP close-reason, initiated by Application, code=200,
> > text="Goodbye", classId=0, methodId=0, cause= /
>
> This means the client application closed the connection normally. Check
> why your application closed the connection.
>
>
>
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/b00b1d7e/attachment.htm>

From drazvan at gmail.com  Wed Aug 28 16:39:19 2013
From: drazvan at gmail.com (Razvan Dinu)
Date: Wed, 28 Aug 2013 18:39:19 +0300
Subject: [rabbitmq-discuss] A weird case of "PRECONDITION_FAILED -
 unknown delivery tag"
In-Reply-To: <521DF94E.1010409@rabbitmq.com>
References: <14c94f91-d0b8-467a-9f03-c72b2e9ad7f5@googlegroups.com>
	<521DF94E.1010409@rabbitmq.com>
Message-ID: <CAPVCTfPXK=7EYrhFpAaK5uUngjMbq-GbQ5biG9dmT8f8iVbkww@mail.gmail.com>

Hi Emile, thanks for your reply.

As I mentioned I'm on a python oriented environment, so can't use the
Tracer you provided directly. I look for an equivalent or if not I'll try
to use that one. However, i'm pretty sure that the ACKs are sent correctly
(there's only one line with basic_ack in my code, and from the logging
messages it looks like it is called correctly). Nevertheless I'll use the
tracer approach just to make sure.

About synchronizing the two threads that are using the channel I don't
think it's possible. I could synchronize sending the ACK messages on the
worker thread but the consumer thread can wait indefinitely for messages to
come. And I don't see where I would have the opportunity to take a lock
since once the consumer thread starts listening, we have no control over
it. We only get the callback when a message arrives. I guess the general
question here would be: what is the correct way of fetching the messages on
one thread and doing the work on another (from a synchronization point of
view)?

And to explain a bit more the "peeking at messages" scenario, here's the
reason. Imagine each task requires fetching some data from a database
(located on a different server). As always, doing bulk operations is a lot
faster. So when the worker needs to fetch data for one task, from the
database server, it will check if there are other tasks in the local queue
that also need data, and request everything in bulk. So when the 1st task
is processed, data is fetched also for task 2,3,4..10. So the processing
for those tasks will be much faster afterwards, because they'll find the
data they need in a local cache. Then task 11 will probably fetch the data
for tasks 11 to 20 and so on. It's an optimization I'm making on the client
side improve the speed.

I guess in a few words what I'm trying to implement is bulk processing on
the client side. Maybe there's a different way to do this.

Cheers,
Raz


On Wed, Aug 28, 2013 at 4:21 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 28/08/13 13:30, Razvan Dinu wrote:
>
> > it's usually because of double ack-ing, ack-ing on wrong channels or
> > ack-ing messages that should not be ack-ed. I've checked at least a
> > dozen times, and it doesn't seem to be the case for me.
>
> A good way to verify that claim independently from the client code is to
> connect to the broker via the Tracer:
>
> http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html
>
> The protocol trace will show whether messages are being acknowledged
> correctly.
>
> > I think it has something to do with ACK-ing from one thread using the
> > same channel that is used for listening on another thread.
>
> If you use multiple threads to access the same channel then you must
> make sure they are synchronised. A better solution is to provide each
> thread with its own channel.
>
> > it's because I need the worker to be able to take a peak at some of
> > the tasks in the queues.
>
> Can the criteria being peeked at be placed in a header or the routing
> key instead? Try to route those messages differently and avoid the need
> for peeking.
>
>
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/b9d5cc47/attachment.htm>

From mklishin at gopivotal.com  Wed Aug 28 16:43:03 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 28 Aug 2013 19:43:03 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.10.5 is released
Message-ID: <E834787E-8616-4A48-AAB3-5820239B6FE5@gopivotal.com>

Bunny [1] is an easy to use, feature complete Ruby client for RabbitMQ.

0.10.5 is a bug fix release that restores Ruby 1.8.7 compatibility.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/08/28/bunny-0-dot-10-dot-5-is-released/

1. http://rubybunny.info
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/2148e60c/attachment.pgp>

From emile at rabbitmq.com  Wed Aug 28 17:18:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Aug 2013 17:18:50 +0100
Subject: [rabbitmq-discuss] A weird case of "PRECONDITION_FAILED -
 unknown delivery tag"
In-Reply-To: <CAPVCTfPXK=7EYrhFpAaK5uUngjMbq-GbQ5biG9dmT8f8iVbkww@mail.gmail.com>
References: <14c94f91-d0b8-467a-9f03-c72b2e9ad7f5@googlegroups.com>
	<521DF94E.1010409@rabbitmq.com>
	<CAPVCTfPXK=7EYrhFpAaK5uUngjMbq-GbQ5biG9dmT8f8iVbkww@mail.gmail.com>
Message-ID: <521E22EA.8000300@rabbitmq.com>


Hi,

On 28/08/13 16:39, Razvan Dinu wrote:
> As I mentioned I'm on a python oriented environment, so can't use the
> Tracer you provided directly. 

You can install the Tracer in a location separate from your broker and
client application if needed. It passes frames between the client and
the broker showing the interaction at the AMQP level. Any protocol
analyser with AMQP 0.9.1 capability should work, if you prefer not to
use Java.

> what is the correct way of fetching the messages on one thread and
> doing the work on another (from a synchronization point of view)?

Avoid the need for multiple threads to use a channel in the first place.
If you can't avoid it then you must synchronise the threads around
synchronous AMQP methods, otherwise the protocol stream will become corrupt.

You should also obviously make sure that any shared data structures in
your application (such as prefetch_queue) are thread-safe.




-Emile






From davidv at spindance.com  Wed Aug 28 17:42:05 2013
From: davidv at spindance.com (David van Geest)
Date: Wed, 28 Aug 2013 12:42:05 -0400
Subject: [rabbitmq-discuss] does RabbitMQ or Erlang/OTP attempt to match
 the CN of a client TLS cert?
In-Reply-To: <521DC481.3050702@rabbitmq.com>
References: <CANaOvh9uX4a219K6fWGrqOgJtMMeNMhvF9A5W=7-FEW1mLdcOQ@mail.gmail.com>
	<CANaOvh95jVuS5jstSv0Q1hfDcHc6rQhfCPaqiZC2Yp2JigEhfw@mail.gmail.com>
	<521DC481.3050702@rabbitmq.com>
Message-ID: <CANaOvh_KPmQ9xENgferTxRv82afWcJwgOz08C72P2C+P1NmR_Q@mail.gmail.com>

On Wed, Aug 28, 2013 at 5:36 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 27/08/13 23:45, David van Geest wrote:
> > On Tue, Aug 27, 2013 at 6:20 PM, David van Geest <davidv at spindance.com
> > <mailto:davidv at spindance.com>> wrote:
> >
> >
> >     If a client connects to RabbitMQ using TLS, and client certificates
> >     are required by RabbitMQ, will RabbitMQ or Erlang/OTP attempt to
> >     match the CN on the client certificate with the client's hostname?
> >     Does it attempt to match the client certificate CN with anything at
> all?
> >
> >
> > Reading a bit more, it seems like the CN only matters if you are
> > using rabbitmq-auth-mechanism-ssl which will attempt to match the
> > certificate CN vs the user database in question. If you are using some
> > other SASL mechanism (say, PLAIN), the CN does not matter. Correct?
>
> Yes. It is also possible to provide your own verification function that
> accepts a certificate. This Erlang function accepts a certificate as one
> of its arguments. See the verify_fun configuration option in
> http://www.erlang.org/doc/man/ssl.html
>
>
Excellent, thanks. Those docs are helpful as well.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/fc36c961/attachment.htm>

From videlalvaro at gmail.com  Wed Aug 28 17:54:59 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 28 Aug 2013 10:54:59 -0600
Subject: [rabbitmq-discuss] stomp plugin doesn't work in Ubuntu Natty
In-Reply-To: <521DBAFD.3010305@rabbitmq.com>
References: <4DA46077.9030001@rabbitmq.com> <521D2FAD.8050706@gmail.com>
	<521DBAFD.3010305@rabbitmq.com>
Message-ID: <CAMcAHLU-xn8X8X0BgtsaW++Nze2FbXK9eXHO=g5RGvwVP_fp6g@mail.gmail.com>

Hi,

If you are using brew, then you probably have this RabbitMQ version
installed: https://www.rabbitmq.com/install-standalone-mac.html

That version doesn't include edoc.

Since this plugin is not part of the RabbitMQ distribution, then we have to
decide with the team what to do with regards to edoc.

Cheers,

Alvaro


On Wed, Aug 28, 2013 at 2:55 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 28/08/13 00:01, Akbar Pirani wrote:
> > I am using RabbitMQ 3.1.5 on Mac OS X 10.8.4 (12E55) installed using
> > brew. Since the rabbitmq-auth-backend-http plugin is not provided with
> > the release
>
> Are you sure? What does "rabbitmq-plugins list" return?
>
> >                 {undef,
> >                     [{edoc_lib,escape_uri,
>
> If this is undefined then your Erlang installation is incomplete. Make
> sure EDoc in installed: http://www.erlang.org/doc/apps/edoc/chapter.html
>
> > Any ideas on what the problem is and how it can be resolved?
>
> Definitely nothing to do with Ubuntu Natty - please start a new question
> on a new thread.
>
>
>
>
>
> -Emile
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/a4c59736/attachment.htm>

From Ron.Cordell at RelayHealth.com  Wed Aug 28 19:18:32 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron)
Date: Wed, 28 Aug 2013 18:18:32 +0000
Subject: [rabbitmq-discuss] Unable to Start Cluster Nodes on Windows
Message-ID: <0B8CD6850421B745BE39BC5C7601923271FFFAE8@DDCEP50016.na.corp.mckesson.com>

We have a 5 node cluster that went down last night as a result of a Windows patching event where the patch scripts didn't insure the integrity of the cluster in between stopping/patching/starting nodes.

We are unable to now start any node in the cluster ? the rabbitmqctl.bat start says it is unable to start the service.

Attempting to look at logs is not possible until the machine is rebooted because the Erlang process has a lock and we are unable to kill the Elang process.

This is RabbitMQ 3.1.3 with Erlang 16B.

First question I have is what the heck do we have to do to kill the Erlang process? It doesn't respond to kill <pid> or killing the process from the task dialog. Since we have RabbitMQ installed as a service, we have to set the service to not start automatically to prevent the erlang process from starting.

Unfortunately, rebooting the machine doesn't allow access to the logs. Even though there's no Erlang process running, the log files remain unaccessible so I can't find out what's going on.

At this point I'm considering uninstalling/re-installing in order to see if we can at least get the cluster up and running again, but I'm afraid we'll lose all messages.

Thanks for any ideas?

-Ron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/539925ec/attachment.htm>

From mpietrek at skytap.com  Wed Aug 28 20:03:42 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 28 Aug 2013 12:03:42 -0700
Subject: [rabbitmq-discuss] Using SelectConnection to simulate a blocking
	"basic_get"
Message-ID: <CACLE7ix8+KT=qJ8H68Sit_Okzk+FWiw=awKaP=6g9fNaAVb_7g@mail.gmail.com>

(I know this is Pika, rather than specifically RabbitMQ, but figure there's
a broader audience here.)

In our architecture, I'm investigating moving away from polling with
basic_get, and towards using basic_consume.

However, our twist is that our overall design doesn't just let us call
connection.io.loop.start() and handle all our messages inside the
registered handler like all the example code does.

What I'd like to do is something like the following, but I can't quite
figure out the combination of calls/callbacks to make it work.

Goals:

   - Create a "blocking" routine that either returns a message or "None" if
   the whole system is shutting down:
   - Let the broker push 1 message/time to us, rather than us polling via
   basic_get.


Here's my admittedly incomplete thoughts on how this might work:

   - Create a SelectConnection instance
   - In the blocking read logic, use basic_consume to tell the broker it's
   OK to send a message to us now (prefetch=1).
   - call connection.ioloop.start()
   - In the message handler, save off the message, then send a basic_cancel
   to tell the broker "No more for now, thanks!"
   - The connection.ioloop.start() returns to the caller
   - Return the saved message to the caller.
   - Wash, rinse, repeat...

Is this sane? Are there examples of how I might do this?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/108d809b/attachment.htm>

From michael at rabbitmq.com  Wed Aug 28 20:13:22 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Wed, 28 Aug 2013 23:13:22 +0400
Subject: [rabbitmq-discuss] Using SelectConnection to simulate a
	blocking "basic_get"
In-Reply-To: <CACLE7ix8+KT=qJ8H68Sit_Okzk+FWiw=awKaP=6g9fNaAVb_7g@mail.gmail.com>
References: <CACLE7ix8+KT=qJ8H68Sit_Okzk+FWiw=awKaP=6g9fNaAVb_7g@mail.gmail.com>
Message-ID: <DCE455B3-412A-4599-9869-1E7C3EF49327@rabbitmq.com>

Matt Pietrek:

> Is this sane? Are there examples of how I might do this?

Matt,

I'm not very familiar with Pika implementation but believe this approach
means you will create a new connection for every delivery. That will be
really inefficient (less than using basic.get).

Maybe running Pika I/O loop in a separate thread would be sufficient?
The only inconvenient part about this is how to gracefully make it shut down
but this can be done.

If you want to have a caller blocking API that uses basic.consume and basic.cancel,
consider using condition variables, e.g. as in [1] (which is not Python but hopefully
close enough).

1. https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/ruby/rpc_client.rb
--
MK
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/3eafb4b5/attachment.pgp>

From Ron.Cordell at RelayHealth.com  Wed Aug 28 21:43:33 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron)
Date: Wed, 28 Aug 2013 20:43:33 +0000
Subject: [rabbitmq-discuss] Unable to Start Cluster Nodes on Windows
In-Reply-To: <0B8CD6850421B745BE39BC5C7601923271FFFAE8@DDCEP50016.na.corp.mckesson.com>
Message-ID: <0B8CD6850421B745BE39BC5C7601923271FFFD6B@DDCEP50016.na.corp.mckesson.com>

To answer all my questions and to leave a trail for others :)  ::

We use a Vormetric encryption agent on each of the RMQ nodes because the messages that the RMQ clusters handle must be encrypted at rest.

It turns out that, somehow, the Windows Firewall policies were changed in  a way that prevented the Vormetric agent from starting, which in turn prevented the Erlang process from accessing its files on the file system. It appeared that the Erlang process would just hang waiting to access its files, and the RabbitMQ service would not start.

Correcting the Vormetric agent situation corrected the issue.

<sigh>

Sorry for the panic email? ;)

From: <Cordell>, Ronald Cordell <Ron.Cordell at RelayHealth.com<mailto:Ron.Cordell at RelayHealth.com>>
Reply-To: Discussions RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Wednesday, August 28, 2013 11:18 AM
To: Discussions RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] Unable to Start Cluster Nodes on Windows

We have a 5 node cluster that went down last night as a result of a Windows patching event where the patch scripts didn't insure the integrity of the cluster in between stopping/patching/starting nodes.

We are unable to now start any node in the cluster ? the rabbitmqctl.bat start says it is unable to start the service.

Attempting to look at logs is not possible until the machine is rebooted because the Erlang process has a lock and we are unable to kill the Elang process.

This is RabbitMQ 3.1.3 with Erlang 16B.

First question I have is what the heck do we have to do to kill the Erlang process? It doesn't respond to kill <pid> or killing the process from the task dialog. Since we have RabbitMQ installed as a service, we have to set the service to not start automatically to prevent the erlang process from starting.

Unfortunately, rebooting the machine doesn't allow access to the logs. Even though there's no Erlang process running, the log files remain unaccessible so I can't find out what's going on.

At this point I'm considering uninstalling/re-installing in order to see if we can at least get the cluster up and running again, but I'm afraid we'll lose all messages.

Thanks for any ideas?

-Ron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/c663cfa8/attachment.htm>

From mahi.rabbitmq at gmail.com  Thu Aug 29 04:22:19 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Wed, 28 Aug 2013 20:22:19 -0700
Subject: [rabbitmq-discuss] startup error
Message-ID: <CAGOpLV7NpQaXTKtrrqDF-ejyYtzPggiHsK1fw=28CSqaeB2kAw@mail.gmail.com>

Hi



C:\Program Files (x86)\RabbitMQ
Server\rabbitmq_server-3.1.3\sbin>rabbitmq-server.bat start

              RabbitMQ 3.1.3. Copyright (C) 2007-2013 VMware, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs:
C:/Users/meaga/AppData/Roaming/RabbitMQ/log/rabbit at MEAGA-WS.log
  ######  ##
 C:/Users/meaga/AppData/Roaming/RabbitMQ/log/rabbit at MEAGA-WS-sasl.log
  ##########
              Starting broker...

BOOT FAILED
===========

Error description:
   {case_clause,
       {error,
           {{shutdown,
                {failed_to_start_child,tcp_listener,
                    {cannot_listen,{0,0,0,0,0,0,0,0},5672,eacces}}},
            {child,undefined,'rabbit_tcp_listener_sup_:::5672',
                {tcp_listener_sup,start_link,
                    [{0,0,0,0,0,0,0,0},
                     5672,
                     [inet6,binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}],
                     {rabbit_networking,tcp_listener_started,[amqp]},
                     {rabbit_networking,tcp_listener_stopped,[amqp]},
                     {rabbit_networking,start_client,[]},
                     "TCP Listener"]},
                transient,infinity,supervisor,
                [tcp_listener_sup]}}}}

Log files (may contain more information):
   C:/Users/meaga/AppData/Roaming/RabbitMQ/log/rabbit at MEAGA-WS.log
   C:/Users/meaga/AppData/Roaming/RabbitMQ/log/rabbit at MEAGA-WS-sasl.log

Stack trace:
   [{rabbit_networking,start_listener0,4,[]},
    {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4,[]},
    {rabbit_networking,start_listener,4,[]},
    {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1,[]},
    {rabbit_networking,boot_tcp,0,[]},
    {rabbit_networking,boot,0,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]}]



BOOT FAILED
===========

Error description:
   {could_not_start,rabbit,
    {bad_return,
     {{rabbit,start,[normal,[]]},
      {'EXIT',
       {rabbit,failure_during_boot,
        {case_clause,
         {error,
          {{shutdown,
            {failed_to_start_child,tcp_listener,
             {cannot_listen,{0,0,0,0,0,0,0,0},5672,eacces}}},
           {child,undefined,'rabbit_tcp_listener_sup_:::5672',
            {tcp_listener_sup,start_link,
             [{0,0,0,0,0,0,0,0},
              5672,
              [inet6,binary,
               {packet,raw},
               {reuseaddr,true},
               {backlog,128},
               {nodelay,true},
               {linger,{true,0}},
               {exit_on_close,false}],
              {rabbit_networking,tcp_listener_started,[amqp]},
              {rabbit_networking,tcp_listener_stopped,[amqp]},
              {rabbit_networking,start_client,[]},
              "TCP Listener"]},
            transient,infinity,supervisor,
            [tcp_listener_sup]}}}}}}}}}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/6c435595/attachment.htm>

From daniel.bason at telogis.com  Thu Aug 29 05:14:36 2013
From: daniel.bason at telogis.com (Daniel Bason)
Date: Thu, 29 Aug 2013 16:14:36 +1200
Subject: [rabbitmq-discuss] startup error
In-Reply-To: <CAGOpLV7NpQaXTKtrrqDF-ejyYtzPggiHsK1fw=28CSqaeB2kAw@mail.gmail.com>
References: <CAGOpLV7NpQaXTKtrrqDF-ejyYtzPggiHsK1fw=28CSqaeB2kAw@mail.gmail.com>
Message-ID: <CAHdxdCfYxDDuuCmrh4uNZdUxH+odkacR0FLqye=HFKC2E1L01g@mail.gmail.com>

I'm by no means an expert but it looks like it's having trouble binding to
the default rabbitmq port (5672).  Is there something already listening on
that port?


On Thu, Aug 29, 2013 at 3:22 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:

> Hi
>
>
>
> C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-3.1.3\sbin>rabbitmq-server.bat start
>
>               RabbitMQ 3.1.3. Copyright (C) 2007-2013 VMware, Inc.
>   ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>   ##  ##
>   ##########  Logs:
> C:/Users/meaga/AppData/Roaming/RabbitMQ/log/rabbit at MEAGA-WS.log
>   ######  ##
>  C:/Users/meaga/AppData/Roaming/RabbitMQ/log/rabbit at MEAGA-WS-sasl.log
>   ##########
>               Starting broker...
>
> BOOT FAILED
> ===========
>
> Error description:
>    {case_clause,
>        {error,
>            {{shutdown,
>                 {failed_to_start_child,tcp_listener,
>                     {cannot_listen,{0,0,0,0,0,0,0,0},5672,eacces}}},
>             {child,undefined,'rabbit_tcp_listener_sup_:::5672',
>                 {tcp_listener_sup,start_link,
>                     [{0,0,0,0,0,0,0,0},
>                      5672,
>                      [inet6,binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}],
>                      {rabbit_networking,tcp_listener_started,[amqp]},
>                      {rabbit_networking,tcp_listener_stopped,[amqp]},
>                      {rabbit_networking,start_client,[]},
>                      "TCP Listener"]},
>                 transient,infinity,supervisor,
>                 [tcp_listener_sup]}}}}
>
> Log files (may contain more information):
>    C:/Users/meaga/AppData/Roaming/RabbitMQ/log/rabbit at MEAGA-WS.log
>    C:/Users/meaga/AppData/Roaming/RabbitMQ/log/rabbit at MEAGA-WS-sasl.log
>
> Stack trace:
>    [{rabbit_networking,start_listener0,4,[]},
>     {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4,[]},
>     {rabbit_networking,start_listener,4,[]},
>     {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1,[]},
>     {rabbit_networking,boot_tcp,0,[]},
>     {rabbit_networking,boot,0,[]},
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>     {rabbit,run_boot_step,1,[]}]
>
>
>
> BOOT FAILED
> ===========
>
> Error description:
>    {could_not_start,rabbit,
>     {bad_return,
>      {{rabbit,start,[normal,[]]},
>       {'EXIT',
>        {rabbit,failure_during_boot,
>         {case_clause,
>          {error,
>           {{shutdown,
>             {failed_to_start_child,tcp_listener,
>              {cannot_listen,{0,0,0,0,0,0,0,0},5672,eacces}}},
>            {child,undefined,'rabbit_tcp_listener_sup_:::5672',
>             {tcp_listener_sup,start_link,
>              [{0,0,0,0,0,0,0,0},
>               5672,
>               [inet6,binary,
>                {packet,raw},
>                {reuseaddr,true},
>                {backlog,128},
>                {nodelay,true},
>                {linger,{true,0}},
>                {exit_on_close,false}],
>               {rabbit_networking,tcp_listener_started,[amqp]},
>               {rabbit_networking,tcp_listener_stopped,[amqp]},
>               {rabbit_networking,start_client,[]},
>               "TCP Listener"]},
>             transient,infinity,supervisor,
>             [tcp_listener_sup]}}}}}}}}}
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
*Dan Bason *
Infrastructure Engineer ? Telogis
www.telogis.com  www.telogis.co.nz
+1 201 477-1448 (USA)  +64 3 281-8065 (NZ)

<http://www.google.com/url?q=http%3A%2F%2Fwww.telogis.com%2F&sa=D&sntz=1&usg=AFrqEze6z4qIWKcAMjgXqM25xkuw9JMysQ>

*One Platform for Location Intelligence*

-- 


This e-mail, and any attachments, is intended only for use by the 
addressee(s) named herein and may contain legally privileged and/or 
confidential information.  It is the property of Telogis.  If you are not 
the intended recipient of this e-mail, you are hereby notified that any 
dissemination, distribution or copying of this e-mail, any attachments 
thereto, and use of the information contained, is strictly prohibited.  If 
you have received this e-mail in error, please notify the sender and 
permanently delete the original and any copy thereof.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/e4917e4d/attachment.htm>

From r_vijay_fl at yahoo.com  Wed Aug 28 23:21:00 2013
From: r_vijay_fl at yahoo.com (.netnewbie)
Date: Wed, 28 Aug 2013 15:21:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Failed to Create Cookie file RabbitMQ in Windows
Message-ID: <1377728460028-29161.post@n5.nabble.com>

I am trying to run the following command

rabbitmq-plugins.bat enable rabbitmq_management  
and its giving me an error Failed to create cookie file h:/ .

I am using windows 7, Erlang Version R16B01 and RabbitMQ-Server version
3.1.5

I am using my work PC and our Corporate policy sets the HOMEDRIVE to h: and
HOMEPATH to / and i dont think they will let me change this.

I can see the .erlang.cookie file under C:\Windows.

Could someone let me know of a workaround for this ? 

Thanks in advance !



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Failed-to-Create-Cookie-file-RabbitMQ-in-Windows-tp29161.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From natalya.arbit at gmail.com  Thu Aug 29 07:03:30 2013
From: natalya.arbit at gmail.com (Isosceles)
Date: Wed, 28 Aug 2013 23:03:30 -0700 (PDT)
Subject: [rabbitmq-discuss] plugin development on Windows - possible?
Message-ID: <070e31db-0be3-429b-9b31-6ab4a8aeecd4@googlegroups.com>

I'm getting conflicting information on whether it's possible to 
compile/build RabbitMQ plugins on Windows with cygwin. Some posts claim 
it's totally doable while others say it's out of question because of 
filesystem conventions and escript behavior on Win. Was anybody successful 
developing addins on Windows?  I'm trying to gather as much information as 
I can before attempting it.  Windows would be my preferred platform but I 
want to know if it's even possible, so I don't waste time.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/01c1d926/attachment.htm>

From aflaed at gmail.com  Thu Aug 29 08:18:20 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Thu, 29 Aug 2013 00:18:20 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
Message-ID: <b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>

Did you get any exception when trying recreate connection?
Where you lost connection - in consumer or producer? Can you provide your 
code? 
Without more detail information nobody can helps you.

?????, 28 ??????? 2013 ?., 15:15:11 UTC+4 ???????????? Arindam Nayak 
???????:
>
> I have written a rabbitmq consumer service, which is a windows service, it 
> constantly polls (something like while(true)) and reads queue data and 
> process, it works fine for 4-5 days, but suddenly after that it gets 
> detached from queue and stalls windows service until i manually restarts 
> that windows service. I have using .net client libraries. I have also added 
> restart code. that re creates connection , binds to queue and then listens 
> , but that restart code does not work. When i tried to debug the service, 
> it does not help, it stops debug process abruptly , at connection 
> re-creation time. Please help.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/8aa97092/attachment.htm>

From aflaed at gmail.com  Thu Aug 29 08:35:04 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Thu, 29 Aug 2013 00:35:04 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Management HTTP API historical samples
	question
Message-ID: <2b72dd5f-2526-41f3-8b14-759d464ee530@googlegroups.com>

Hello, in documentation in section about historical samples there is 
sentence ? "The end of the range returned will always correspond to the 
present", but API does not return me actual information about message total 
count, for example:
*
http://localhost:15672/api/overview?columns=node,queue_totals&lengths_age=600&lengths_incr=100
*
*response:*

{
"queue_totals": {
"messages": 65,
"messages_details": {
"rate": -0.4,
"samples": [{
"sample": 65,
"timestamp": 1377761000000
},
{
"sample": 88,
"timestamp": 1377760900000
},
{
"sample": 108,
"timestamp": 1377760800000
},
...
}

But last element in samples array doesn't correspond to present, if i use 
less length increment, the information will be more accurate:
*
http://localhost:15672/api/overview?columns=node,queue_totals&lengths_age=600&lengths_incr=1
*
*response:*

{
"queue_totals": {
"messages": 53,
"messages_details": {
"rate": 0.0,
"samples": [{
"sample": 53,
"timestamp": 1377761059000
},
{
"sample": 53,
"timestamp": 1377761058000
},
{
"sample": 53,
"timestamp": 1377761057000
},

...

}

How I can get info about queues messages count for last N seconds including 
real-time information?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/b23d49d3/attachment.htm>

From michael at rabbitmq.com  Thu Aug 29 09:17:32 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Thu, 29 Aug 2013 12:17:32 +0400
Subject: [rabbitmq-discuss] Failed to Create Cookie file RabbitMQ in
	Windows
In-Reply-To: <1377728460028-29161.post@n5.nabble.com>
References: <1377728460028-29161.post@n5.nabble.com>
Message-ID: <0E32245B-2143-4B94-9F4E-A9E4C1ED5FCF@rabbitmq.com>

.netnewbie:

> I am using my work PC and our Corporate policy sets the HOMEDRIVE to h: and
> HOMEPATH to / and i dont think they will let me change this.
> 
> I can see the .erlang.cookie file under C:\Windows.
> 
> Could someone let me know of a workaround for this ? 

It should be sufficient to copy .erlang.cookie to H:/ and make sure RabbitMQ process
has sufficient permissions to read it.

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/34e4eb7a/attachment.pgp>

From michael at rabbitmq.com  Thu Aug 29 09:21:10 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Thu, 29 Aug 2013 12:21:10 +0400
Subject: [rabbitmq-discuss] startup error
In-Reply-To: <CAGOpLV7NpQaXTKtrrqDF-ejyYtzPggiHsK1fw=28CSqaeB2kAw@mail.gmail.com>
References: <CAGOpLV7NpQaXTKtrrqDF-ejyYtzPggiHsK1fw=28CSqaeB2kAw@mail.gmail.com>
Message-ID: <FCB46ABE-52B7-4FF7-8C3F-3C89F0F277AA@rabbitmq.com>

mahi e:

>                 {failed_to_start_child,tcp_listener,
>                     {cannot_listen,{0,0,0,0,0,0,0,0},5672,eacces}}},

RabbitMQ tried to bind to 0.0.0.0:5672 and failed with EACCESS.

I'm not a Windows expert by according to [1] it may be either because
another process is running on the same interface/port or due to "forbidden
access permissions".

1. http://msdn.microsoft.com/en-us/library/windows/desktop/ms740668%28v=vs.85%29.aspx

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/13b6f2b8/attachment.pgp>

From emile at rabbitmq.com  Thu Aug 29 10:23:52 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 29 Aug 2013 10:23:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
Message-ID: <521F1328.1040105@rabbitmq.com>

On 29/08/13 08:18, ????? ??????? wrote:

> Without more detail information nobody can helps you.

Agreed.  Arindam, please check whether you can answer more of the
questions in the thread so we can help you get to the bottom of the problem.


-Emile





From emile at rabbitmq.com  Thu Aug 29 10:33:31 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 29 Aug 2013 10:33:31 +0100
Subject: [rabbitmq-discuss] plugin development on Windows - possible?
In-Reply-To: <070e31db-0be3-429b-9b31-6ab4a8aeecd4@googlegroups.com>
References: <070e31db-0be3-429b-9b31-6ab4a8aeecd4@googlegroups.com>
Message-ID: <521F156B.9080000@rabbitmq.com>


Hi,

On 29/08/13 07:03, Isosceles wrote:
> I'm getting conflicting information on whether it's possible to
> compile/build RabbitMQ plugins on Windows with cygwin. Some posts claim
> it's totally doable while others say it's out of question because of
> filesystem conventions and escript behavior on Win.

At the time of writing the released plugins cannot be built by Cygwin
from within the public umbrella repository due to the reasons you list.
You might be able to work around those issues or build your plugin using
your own build infrastructure.

If you have a choice then opt for a Unix/GNU platform (such as Linux)
where the existing build infrastructure will work.



-Emile




From nayak.arindam at gmail.com  Thu Aug 29 10:39:11 2013
From: nayak.arindam at gmail.com (Arindam)
Date: Thu, 29 Aug 2013 15:09:11 +0530
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <521F1328.1040105@rabbitmq.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<521F1328.1040105@rabbitmq.com>
Message-ID: <CAJ=9sHvVaswjZigvGVno8jteNLUa8qQeSOjZxXngyNqin-Zk2w@mail.gmail.com>

Please check my comments inline.

Did you get any exception when trying recreate connection?
Yes, it is showing SharedQueue closed,  when i am trying to debug it is
getting lost, progam is getting abruptly stoped.

Where you lost connection - in consumer or producer? Can you provide your
code?
In cosumer, sure i will share my code.

Without more detail information nobody can helps you.
I will share my code, and i will show you a screencast of mine while
debugging. Just give me 1 day time,i will do those stuffs.




- Arindam


On 29 August 2013 14:53, Emile Joubert <emile at rabbitmq.com> wrote:

> On 29/08/13 08:18, ????? ??????? wrote:
>
> > Without more detail information nobody can helps you.
>
> Agreed.  Arindam, please check whether you can answer more of the
> questions in the thread so we can help you get to the bottom of the
> problem.
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/394b2e9c/attachment.htm>

From emile at rabbitmq.com  Thu Aug 29 10:52:59 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 29 Aug 2013 10:52:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <CAJ=9sHvVaswjZigvGVno8jteNLUa8qQeSOjZxXngyNqin-Zk2w@mail.gmail.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<521F1328.1040105@rabbitmq.com>
	<CAJ=9sHvVaswjZigvGVno8jteNLUa8qQeSOjZxXngyNqin-Zk2w@mail.gmail.com>
Message-ID: <521F19FB.6090005@rabbitmq.com>

On 29/08/13 10:39, Arindam wrote:


> i will share my code.

If you share code please try to pare it down to the smallest possible
self-contained program that demonstrates the problem.


> i will show you a screencast
I'm not sure that's necessary. It would be more useful to know whether
the broker logged anything when the "SharedQueue closed" error appeared,
and to get the full text of any log entries at that time, from both the
regular and sasl logs.

You have not said whether turning on heartbeats helped, or whether
running as an application rather than a service made any difference, or
whether "rabbitmqctl report" from the time of the error yielded useful
information.



-Emile





From simon at rabbitmq.com  Thu Aug 29 11:02:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Aug 2013 11:02:07 +0100
Subject: [rabbitmq-discuss] File descriptors slowly reaching 1024...
In-Reply-To: <0488D8FF-DCA7-408A-9A35-F143E0D98A90@gopivotal.com>
References: <CAJaPRW4EhUkC-2QQpbZ04w98C5cAM6ifPqGDwRiSWFWcVZZZ+w@mail.gmail.com>
	<0488D8FF-DCA7-408A-9A35-F143E0D98A90@gopivotal.com>
Message-ID: <521F1C1F.3000907@rabbitmq.com>

On 23/08/2013 1:03PM, Michael Klishin wrote:
> Guillaume Vernat:
>
>> How to reduce used file descriptors with rabbimq 3.0.x cluster ?
>> Master is slowly reaching 1024. Help say that it doesnt matter but
>> I dislike this yellow color and I do prefer the green one :)

If there is a gradual increase that suggests that some client is leaking 
connections (each connection takes one FD, RabbitMQ then uses some of 
the rest for queue disk storage). Check the connections list in mgmt to 
see if anything is out of the ordinary.

If there is no connection leak but you have a large number of queues 
then the number of FDs used by RabbitMQ for disk storage can be quite 
large - but this is softer; as FDs start to become scarce RabbitMQ will 
try to use fewer for disk storage.

> Guillaume,
>
> You can keep fewer connections open but you really should increase
> open file descriptors limit for the rabbitmq user instead:
>
> http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/#Changing-the-limit
>https://cs.uwaterloo.ca/~brecht/servers/openfiles.html

Of course, if something is leaking connections, then increasing the 
limit will only delay the problem :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Aug 29 11:16:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Aug 2013 11:16:48 +0100
Subject: [rabbitmq-discuss] Regarding disk free limit
In-Reply-To: <DB14E94115BBC84E8960C12C176D06763B14D5AD@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06763B14D5AA@MX25A.corp.emc.com>
	<521C9FC6.30808@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D06763B14D5AD@MX25A.corp.emc.com>
Message-ID: <521F1F90.7010003@rabbitmq.com>

On 27/08/2013 1:58PM, Jain, Punit wrote:
> Still, is there any way RabbitMQ occupying disk space? Currently we
> have around 1GB free space in root partition which will not be used
> by any software or user.

All current versions of RabbitMQ will page messages out to disk if 
memory starts to become even slightly tight.

The next release (3.2.0 in case someone is reading this on a web archive 
in the future) will make this tunable, so if you really need to ensure 
RabbitMQ never pages messages out you could install a nightly build and 
investigate the vm_memory_high_watermark_paging_ratio configuration item 
documented at http://next.rabbitmq.com/memory.html#memsup-paging - 
setting it to a number greater than 1.0 should disable paging.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Aug 29 11:29:55 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Aug 2013 11:29:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ Management HTTP API historical
 samples question
In-Reply-To: <2b72dd5f-2526-41f3-8b14-759d464ee530@googlegroups.com>
References: <2b72dd5f-2526-41f3-8b14-759d464ee530@googlegroups.com>
Message-ID: <521F22A3.5020008@rabbitmq.com>

Hmm, possibly that documentation should be clarified. Really it will 
attempt to return samples up to (the_present modulo lengths_incr), so 
that the inter-sample spacing is consistent.

For the latest value, check the value given outside "samples" - i.e. 
queue_totals.messages in your example.

Cheers, Simon

On 29/08/2013 8:35AM, ????? ??????? wrote:
> Hello, in documentation in section about historical samples there is
> sentence ? "The end of the range returned will always correspond to the
> present", but API does not return me actual information about message
> total count, for example:
> *http://localhost:15672/api/overview?columns=node,queue_totals&lengths_age=600&lengths_incr=100*
> *response:*
>
>     {
>     "queue_totals": {
>     "messages": 65,
>     "messages_details": {
>     "rate": -0.4,
>     "samples": [{
>     "sample": 65,
>     "timestamp": 1377761000000
>     },
>     {
>     "sample": 88,
>     "timestamp": 1377760900000
>     },
>     {
>     "sample": 108,
>     "timestamp": 1377760800000
>     },
>     ...
>     }
>
> But last element in samples array doesn't correspond to present, if i
> use less length increment, the information will be more accurate:
> *http://localhost:15672/api/overview?columns=node,queue_totals&lengths_age=600&lengths_incr=1*
> *response:*
>
>     {
>     "queue_totals": {
>     "messages": 53,
>     "messages_details": {
>     "rate": 0.0,
>     "samples": [{
>     "sample": 53,
>     "timestamp": 1377761059000
>     },
>     {
>     "sample": 53,
>     "timestamp": 1377761058000
>     },
>     {
>     "sample": 53,
>     "timestamp": 1377761057000
>     },
>
>     ...
>
>     }
>
> How I can get info about queues messages count for last N seconds
> including real-time information?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From aflaed at gmail.com  Thu Aug 29 11:35:15 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Thu, 29 Aug 2013 14:35:15 +0400
Subject: [rabbitmq-discuss] RabbitMQ Management HTTP API historical
 samples question
In-Reply-To: <521F22A3.5020008@rabbitmq.com>
References: <2b72dd5f-2526-41f3-8b14-759d464ee530@googlegroups.com>
	<521F22A3.5020008@rabbitmq.com>
Message-ID: <CANV4tdXPzAOJp5ExAaxv-EgxbUq7TtOrdu6_UsBx4QhL-=GeOw@mail.gmail.com>

The problem is that queue_totals.messages value always is identical with
the last value in samples array.
It seems there is no way to get actual value with big lengths_incr values.


2013/8/29 Simon MacMullen <simon at rabbitmq.com>

> Hmm, possibly that documentation should be clarified. Really it will
> attempt to return samples up to (the_present modulo lengths_incr), so that
> the inter-sample spacing is consistent.
>
> For the latest value, check the value given outside "samples" - i.e.
> queue_totals.messages in your example.
>
> Cheers, Simon
>
> On 29/08/2013 8:35AM, ????? ??????? wrote:
>
>> Hello, in documentation in section about historical samples there is
>> sentence -- "The end of the range returned will always correspond to the
>> present", but API does not return me actual information about message
>> total count, for example:
>> *http://localhost:15672/api/**overview?columns=node,queue_**
>> totals&lengths_age=600&**lengths_incr=100*<http://localhost:15672/api/overview?columns=node,queue_totals&lengths_age=600&lengths_incr=100*>
>> *response:*
>>
>>     {
>>     "queue_totals": {
>>     "messages": 65,
>>     "messages_details": {
>>     "rate": -0.4,
>>     "samples": [{
>>     "sample": 65,
>>     "timestamp": 1377761000000
>>     },
>>     {
>>     "sample": 88,
>>     "timestamp": 1377760900000
>>     },
>>     {
>>     "sample": 108,
>>     "timestamp": 1377760800000
>>     },
>>     ...
>>     }
>>
>> But last element in samples array doesn't correspond to present, if i
>> use less length increment, the information will be more accurate:
>> *http://localhost:15672/api/**overview?columns=node,queue_**
>> totals&lengths_age=600&**lengths_incr=1*<http://localhost:15672/api/overview?columns=node,queue_totals&lengths_age=600&lengths_incr=1*>
>> *response:*
>>
>>     {
>>     "queue_totals": {
>>     "messages": 53,
>>     "messages_details": {
>>     "rate": 0.0,
>>     "samples": [{
>>     "sample": 53,
>>     "timestamp": 1377761059000
>>     },
>>     {
>>     "sample": 53,
>>     "timestamp": 1377761058000
>>     },
>>     {
>>     "sample": 53,
>>     "timestamp": 1377761057000
>>     },
>>
>>     ...
>>
>>     }
>>
>> How I can get info about queues messages count for last N seconds
>> including real-time information?
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
? ?????????,
??????? ?????
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/fb5e6dac/attachment.htm>

From simon at rabbitmq.com  Thu Aug 29 11:53:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Aug 2013 11:53:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ Management HTTP API historical
 samples question
In-Reply-To: <CANV4tdXPzAOJp5ExAaxv-EgxbUq7TtOrdu6_UsBx4QhL-=GeOw@mail.gmail.com>
References: <2b72dd5f-2526-41f3-8b14-759d464ee530@googlegroups.com>
	<521F22A3.5020008@rabbitmq.com>
	<CANV4tdXPzAOJp5ExAaxv-EgxbUq7TtOrdu6_UsBx4QhL-=GeOw@mail.gmail.com>
Message-ID: <521F2819.5070809@rabbitmq.com>

On 29/08/2013 11:35AM, ????? ??????? wrote:
> The problem is that queue_totals.messages value always is identical with
> the last value in samples array.
> It seems there is no way to get actual value with big lengths_incr values.

Oh, you're quite right. I'll file a bug to look into changing that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dilip.aim11 at gmail.com  Thu Aug 29 12:08:41 2013
From: dilip.aim11 at gmail.com (dilip.aim11)
Date: Thu, 29 Aug 2013 04:08:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Sent message to other Network Rabbit MQ
Message-ID: <1377774521587-29178.post@n5.nabble.com>

Hi ,

I know how to send message from one machine to another machine in same
network .
But how can i send message to rabbit MQ which is in different network.

i have consumer app in my machine . now i want to send message to Queue .
which is in different network .

how can i achieve this . i m u using  C# .NET .
Please provide me any suggestion . 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Sent-message-to-other-Network-Rabbit-MQ-tp29178.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From aflaed at gmail.com  Thu Aug 29 12:16:31 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Thu, 29 Aug 2013 15:16:31 +0400
Subject: [rabbitmq-discuss] RabbitMQ Management HTTP API historical
 samples question
In-Reply-To: <521F2819.5070809@rabbitmq.com>
References: <2b72dd5f-2526-41f3-8b14-759d464ee530@googlegroups.com>
	<521F22A3.5020008@rabbitmq.com>
	<CANV4tdXPzAOJp5ExAaxv-EgxbUq7TtOrdu6_UsBx4QhL-=GeOw@mail.gmail.com>
	<521F2819.5070809@rabbitmq.com>
Message-ID: <CANV4tdXnjMCGd18sFG=TewEUYjc2J4zd7AFX+H60=HB9qc20Wg@mail.gmail.com>

Thank you! :-)


2013/8/29 Simon MacMullen <simon at rabbitmq.com>

> On 29/08/2013 11:35AM, ????? ??????? wrote:
>
>> The problem is that queue_totals.messages value always is identical with
>> the last value in samples array.
>> It seems there is no way to get actual value with big lengths_incr values.
>>
>
> Oh, you're quite right. I'll file a bug to look into changing that.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
? ?????????,
??????? ?????
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/cda89d92/attachment.htm>

From michael at rabbitmq.com  Thu Aug 29 12:19:57 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Thu, 29 Aug 2013 15:19:57 +0400
Subject: [rabbitmq-discuss] Sent message to other Network Rabbit MQ
In-Reply-To: <1377774521587-29178.post@n5.nabble.com>
References: <1377774521587-29178.post@n5.nabble.com>
Message-ID: <3A8ED0A2-58C7-4CBA-A67F-DFA7A5AF2145@rabbitmq.com>

dilip.aim11:

> But how can i send message to rabbit MQ which is in different network.
> 
> i have consumer app in my machine . now i want to send message to Queue .
> which is in different network .
> 
> how can i achieve this . i m u using  C# .NET

You connect to RabbitMQ nodes on a different network the same way you connect
to nodes on the same network: by using an IP address that needs to be reachable
or a domain name which needs to resolve to a reachable IP address.

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/b0add10e/attachment.pgp>

From arindam_nitrkl at hotmail.com  Thu Aug 29 10:38:37 2013
From: arindam_nitrkl at hotmail.com (Arindam Nayak)
Date: Thu, 29 Aug 2013 15:08:37 +0530
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>,
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
Message-ID: <COL128-W20C968D59E84AD43970CE9EA340@phx.gbl>

Please check my comments inline.
Did you get any exception when trying recreate connection?
Yes, it is showing SharedQueue closed,  when i am trying to debug it is getting lost, progam is getting abruptly stoped.
Where you lost connection - in consumer or producer? Can you provide your code? In cosumer, sure i will share my code.
Without more detail information nobody can helps you.I will share my code, and i will show you a screencast of mine while debugging. Just give me 1 day time,i will do those stuffs.
Date: Thu, 29 Aug 2013 00:18:20 -0700
From: aflaed at gmail.com
To: rabbitmq-discuss at googlegroups.com
CC: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ consumer rebind in .net

Did you get any exception when trying recreate connection?
Where you lost connection - in consumer or producer? Can you provide your code? Without more detail information nobody can helps you.

?????, 28 ??????? 2013 ?., 15:15:11 UTC+4 ???????????? Arindam Nayak ???????:I have written a rabbitmq consumer service, which is a windows service, it constantly polls (something like while(true)) and reads queue data and process, it works fine for 4-5 days, but suddenly after that it gets detached from queue and stalls windows service until i manually restarts that windows service. I have using .net client libraries. I have also added restart code. that re creates connection , binds to queue and then listens , but that restart code does not work. When i tried to debug the service, it does not help, it stops debug process abruptly , at connection re-creation time. Please help.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/c01048d6/attachment.htm>

From simon at rabbitmq.com  Thu Aug 29 12:42:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Aug 2013 12:42:53 +0100
Subject: [rabbitmq-discuss] stomp plugin doesn't work in Ubuntu Natty
In-Reply-To: <CAMcAHLU-xn8X8X0BgtsaW++Nze2FbXK9eXHO=g5RGvwVP_fp6g@mail.gmail.com>
References: <4DA46077.9030001@rabbitmq.com> <521D2FAD.8050706@gmail.com>
	<521DBAFD.3010305@rabbitmq.com>
	<CAMcAHLU-xn8X8X0BgtsaW++Nze2FbXK9eXHO=g5RGvwVP_fp6g@mail.gmail.com>
Message-ID: <521F33BD.2040407@rabbitmq.com>

On 28/08/2013 5:54PM, Alvaro Videla wrote:
> Since this plugin is not part of the RabbitMQ distribution, then we have
> to decide with the team what to do with regards to edoc.

I removed the dependency on edoc here: 
https://github.com/simonmacmullen/rabbitmq-auth-backend-http/commit/e7ac6289a6c02b350f822f6f059f1932cc21a5c8

Akbar, please pull and recompile.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From nayak.arindam at gmail.com  Thu Aug 29 12:58:35 2013
From: nayak.arindam at gmail.com (Arindam Nayak)
Date: Thu, 29 Aug 2013 04:58:35 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
Message-ID: <415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>

I have uploaded screencast for this - link  - 
http://screencast.com/t/NG75rMlwOlH1

On Thursday, 29 August 2013 12:48:20 UTC+5:30, ????? ??????? wrote:
>
> Did you get any exception when trying recreate connection?
> Where you lost connection - in consumer or producer? Can you provide your 
> code? 
> Without more detail information nobody can helps you.
>
> ?????, 28 ??????? 2013 ?., 15:15:11 UTC+4 ???????????? Arindam Nayak 
> ???????:
>>
>> I have written a rabbitmq consumer service, which is a windows service, 
>> it constantly polls (something like while(true)) and reads queue data and 
>> process, it works fine for 4-5 days, but suddenly after that it gets 
>> detached from queue and stalls windows service until i manually restarts 
>> that windows service. I have using .net client libraries. I have also added 
>> restart code. that re creates connection , binds to queue and then listens 
>> , but that restart code does not work. When i tried to debug the service, 
>> it does not help, it stops debug process abruptly , at connection 
>> re-creation time. Please help.
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/4f7eddb8/attachment.htm>

From opalsie at gmail.com  Thu Aug 29 14:18:48 2013
From: opalsie at gmail.com (Artur Nike)
Date: Thu, 29 Aug 2013 15:18:48 +0200
Subject: [rabbitmq-discuss] ldap user declare queue =problem
Message-ID: <CAOBraDH+G71-u8jZcs4Ui8dcRU9SF7BZTNZmvx4=cCLasftpjg@mail.gmail.com>

I have a problem :) .

I configured, or rather do me wondering, RMQ to use ldap (openldap)
for authentication and authorization.

LDAP works ok, but the LDAP-user can not declare exchanges and queues,
(login wheel:pass it works, published msg to exchange works, read msg from
queque works )

Here's my Rabbit configs :

CONFIG1:
[
  {rabbit, [
     {auth_backends, [rabbit_auth_backend_ldap,
rabbit_auth_backend_internal]},
     {tcp_listeners, []},
     {ssl_listeners, [{"127.0.0.1", 5671} ]},
     {ssl_options, [{cacertfile,"/home/hg/cert/testca/cacert.pem"},
                    {certfile,"/home/hg/cert/server/cert.pem"},
                    {keyfile,"/home/hg/cert/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,true}]}
   ]
  },
  {rabbitmq_auth_backend_ldap,
   [ {servers,               ["localhost"]},
     {user_dn_pattern,       "cn=${username},o=org1,dc=nodomain"},
     {use_ssl,               false},
     {port,                  389},
     {log,                   true},
     {resource_access_query,
      {for, [{permission, configure, {in_group,
"cn=wheel,o=org1,dc=nodomain"}},
             {permission, write,
              {for, [{resource, queue,    {in_group,
"cn=wheel,o=org1,dc=nodomain"}},
                     {resource, exchange, {constant, true}}]}},
             {permission, read,
              {for, [{resource, exchange, {in_group,
"cn=wheel,o=org1,dc=nodomain"}},
                     {resource, queue,    {constant, true}}]}}
            ]
      }},
     {tag_queries,           [{administrator, {constant, false}},
                              {management,    {constant, true}}]}
   ]
  }
].

LOG:
=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP DECISION: does wheel have tag management? true

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP DECISION: login for wheel: ok

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP CHECK: access to vhost "/" for "wheel"

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP bind succeeded: cn=wheel,o=org1,dc=nodomain

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluating query: {constant,true}

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluated constant: true

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP DECISION: access to vhost "/" for "wheel": ok

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP CHECK: configure permission for queue "tyerter" in "/" for "wheel"

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP bind succeeded: cn=wheel,o=org1,dc=nodomain

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluating query: {for,
                            [{permission,configure,
                              {in_group,"cn=wheel,o=org1,dc=nodomain"}},
                             {permission,write,
                              {for,
                               [{resource,queue,
                                 {in_group,"cn=wheel,o=org1,dc=nodomain"}},
                                {resource,exchange,{constant,true}}]}},
                             {permission,read,
                              {for,
                               [{resource,exchange,
                                 {in_group,"cn=wheel,o=org1,dc=nodomain"}},
                                {resource,queue,{constant,true}}]}}]}

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP selecting subquery permission = configure

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluating query: {in_group,"cn=wheel,o=org1,dc=nodomain"}

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluating query: {in_group,"cn=wheel,o=org1,dc=nodomain","member"}

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
        LDAP filling template "cn=wheel,o=org1,dc=nodomain" with
            [{username,<<"wheel">>},
             {user_dn,"cn=wheel,o=org1,dc=nodomain"},
             {vhost,<<"/">>},
             {resource,queue},
             {name,<<"tyerter">>},
             {permission,configure}]

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
        LDAP template result: "cn=wheel,o=org1,dc=nodomain"

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluated in_group for "cn=wheel,o=org1,dc=nodomain": false

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP DECISION: configure permission for queue "tyerter" in "/" for "wheel":
denied

=ERROR REPORT==== 29-Aug-2013::14:24:05 ===
connection <0.1234.0>, channel 1 - soft error:
{amqp_error,access_refused,
            "access to queue 'tyerter' in vhost '/' refused for user
'wheel'",
            'queue.declare'}

=ERROR REPORT==== 29-Aug-2013::14:24:05 ===
webmachine error: path="/api/queues/%2F/tyerter"
"Unauthorized"



Can anyone have any suggestions or experience with this problem.
For all thank you in advance.

Muniek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/44121917/attachment.htm>

From david.tinker at gmail.com  Thu Aug 29 15:36:38 2013
From: david.tinker at gmail.com (David Tinker)
Date: Thu, 29 Aug 2013 16:36:38 +0200
Subject: [rabbitmq-discuss] ANN QDB 0.4.8 released
Message-ID: <CA+O6_FcH9mFcAtw9nH4PFxB7JweoCQJRWJSsUE3TvEQPCiVUOA@mail.gmail.com>

Release Notes:
- Fixed a rare "output stuck" bug related to RabbitMQ connection issues

The next release will have filtering of messages on routing key and/or
grep of message body.

http://qdb.io/ Persistent Message Queues With Replay and #RabbitMQ Integration

From akbar.pirani7 at gmail.com  Thu Aug 29 16:29:54 2013
From: akbar.pirani7 at gmail.com (akbar.pirani7 at gmail.com)
Date: Thu, 29 Aug 2013 15:29:54 +0000
Subject: [rabbitmq-discuss] stomp plugin doesn't work in Ubuntu Natty
Message-ID: <2104642447-1377790200-cardhu_decombobulator_blackberry.rim.net-632907447-@b25.c24.bise6.blackberry>

Thanks Simon. I will try it out and let you know the results.
------Original Message------
From: Simon MacMullen
To: Discussions about RabbitMQ
Cc: Alvaro Videla
Cc: Akbar Pirani
Subject: Re: [rabbitmq-discuss] stomp plugin doesn't work in Ubuntu Natty
Sent: Aug 29, 2013 7:42 AM

On 28/08/2013 5:54PM, Alvaro Videla wrote:
> Since this plugin is not part of the RabbitMQ distribution, then we have
> to decide with the team what to do with regards to edoc.

I removed the dependency on edoc here: 
https://github.com/simonmacmullen/rabbitmq-auth-backend-http/commit/e7ac6289a6c02b350f822f6f059f1932cc21a5c8

Akbar, please pull and recompile.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal


Sent via BlackBerry by AT&T

From mcintoshj at gmail.com  Thu Aug 29 16:36:07 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 29 Aug 2013 10:36:07 -0500
Subject: [rabbitmq-discuss] File descriptors slowly reaching 1024...
In-Reply-To: <521F1C1F.3000907@rabbitmq.com>
References: <CAJaPRW4EhUkC-2QQpbZ04w98C5cAM6ifPqGDwRiSWFWcVZZZ+w@mail.gmail.com>
	<0488D8FF-DCA7-408A-9A35-F143E0D98A90@gopivotal.com>
	<521F1C1F.3000907@rabbitmq.com>
Message-ID: <CAD6m6fHVJZZbsJy4H6HKaZD-3hpTBpextM7tE+O3xuafnssxUA@mail.gmail.com>

One thing to be careful of if you're going to increase your limits - RHEL
based systems (centos for example) have separate soft limits in the
following locations:
/etc/security/limits.d/90-nproc.conf
/etc/security/limits.conf

The 90-nproc.conf file has the 1024 limit for all users on a system.

Jason


On Thu, Aug 29, 2013 at 5:02 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 23/08/2013 1:03PM, Michael Klishin wrote:
>
>> Guillaume Vernat:
>>
>>  How to reduce used file descriptors with rabbimq 3.0.x cluster ?
>>> Master is slowly reaching 1024. Help say that it doesnt matter but
>>> I dislike this yellow color and I do prefer the green one :)
>>>
>>
> If there is a gradual increase that suggests that some client is leaking
> connections (each connection takes one FD, RabbitMQ then uses some of the
> rest for queue disk storage). Check the connections list in mgmt to see if
> anything is out of the ordinary.
>
> If there is no connection leak but you have a large number of queues then
> the number of FDs used by RabbitMQ for disk storage can be quite large -
> but this is softer; as FDs start to become scarce RabbitMQ will try to use
> fewer for disk storage.
>
>
>  Guillaume,
>>
>> You can keep fewer connections open but you really should increase
>> open file descriptors limit for the rabbitmq user instead:
>>
>> http://docs.basho.com/riak/**latest/ops/tuning/open-files-**
>> limit/#Changing-the-limit<http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/#Changing-the-limit>
>> https://cs.uwaterloo.ca/~**brecht/servers/openfiles.html<https://cs.uwaterloo.ca/~brecht/servers/openfiles.html>
>>
>
> Of course, if something is leaking connections, then increasing the limit
> will only delay the problem :-)
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/31c3b3e8/attachment.htm>

From mcintoshj at gmail.com  Thu Aug 29 16:43:19 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 29 Aug 2013 10:43:19 -0500
Subject: [rabbitmq-discuss] questions about RabbitMQ linear scalability
In-Reply-To: <A842478B-8993-4C1A-ACCF-96897EBB8E24@rabbitmq.com>
References: <1217501ce9425$026e58d0$074b0a70$@gmail.com>
	<062d01ce9ee5$f181d440$d4857cc0$@gmail.com>
	<1CC19277-0A54-4D4B-AB59-591990BEDA67@gopivotal.com>
	<07bc01ce9fa6$91259570$b370c050$@gmail.com>
	<A842478B-8993-4C1A-ACCF-96897EBB8E24@rabbitmq.com>
Message-ID: <CAD6m6fHoXrLFtffBQALkEo38nJepdaN+MK=7X8DFHqGS4k3xBg@mail.gmail.com>

Something we did for high latency systems was to publish to a fanout
exchange that's bound to an x-concurrent-hash exchange.  Then we multiplex
the queues, so instead of "myqueue" we create 10 queues "myqueue1"...
"myqueue10".  As long as ordering isn't an issue, this allows you to get a
greatly increased through-put.  But then you have to consume from multiple
queues not a single queue.  An example of where we use this technique is
when dealing with physical location differences (e.g. Chicago to Dallas
would be an example) where latency is fairly high.  We use shovels (btw,
remember to set a prefetch OTHER than 0 - we hit major performance issues
otherwise related to network latency) to transmit from each of the 10
queues back to a single exchange/queue on the remote side.

Jason


On Wed, Aug 28, 2013 at 4:57 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Junius,
>
> On 23 Aug 2013, at 03:14, Junius Wang wrote:
> > Before every test ( after a new RabbitMQ node added/removed to the
> cluster):
> > 1).we reset the policy to "exactly" on 2 nodes. 2). declared 10 queues
> using
> > rabbitmqctl and force them distributed evenly on all nodes.  e.g.in a 2
> node
> > cluster,5 queues resides on rabbit1, another 5 resides on rabbit2. 3-3-4
> for
> > 3 node cluster ,3-3-2-2 for 4 node cluster.   3) declare a 'topic"
> exchange
> > 4) binding the 10 queues to the exchange with 10 different routing keys.
> > Publishers publish messages with the 10 routing keys by turns. Thus all
> > queues receive the same number of messages.
> > Is the number of queues large enough?  we can declare more queues in test
> > but I don't think there will be too many queues in production.
> >
>
> Let's re-visit the point Michael made about adding more queues:
>
> "the way you extend capacity with RabbitMQ is by adding nodes and using
> more queues"
>
> In any messaging system where queues exhibit FIFO behaviour, each queue is
> a concurrency bottleneck, because it can handle only 1 message at a time.
> If the queue handled more than 1 inbound message at a time, it would not be
> possible to enforce the FIFO characteristics, since without some kind of
> concurrency control the ordering would be non-deterministic. The question
> of whether or not the number of queues is "large enough" is application
> specific. Where you need FIFO ordering, you'll want a single queue. Where
> you are processing messages separately and/or do not require ordering
> (e.g., between messages of different "types") then you can use separate
> queues: this is a design choice that only you can make. The point Michael
> made is that the more queues you shove messages into, the better the
> concurrency will be, which in turn may yield performance benefits in terms
> of throughput.
>
> As to the point about "adding nodes" - a single RabbitMQ node has a finite
> processing capacity, dependent on available operating system resources and
> client usage patterns. If you work out the maximum capacity "n" of a single
> node in your application, where the combination of available system
> resources and application load on the broker is at its peak, then by adding
> a second node, you might increase the system's overall capacity to
> something close to 2n. There are important caveats here though, as Michael
> has already pointed out: clients can connect to any node in a cluster, but
> if the queue with which they're communicating resides on another node,
> messages (both in and out of the broker) must be transmitted between nodes.
>
> > publishers connect to the cluster via load balancer(AWS ELB) as well as
> > consumers, they don't know to which node they are connect.  So we may not
> > decrease the intra-cluster traffic. But  we can try some high bandwidth
> > instances. Does this help?
>
> Increased bandwidth might be helpful, but the points Michael made will
> still stand. There is always going to be "some" additional overhead due to
> inter-node communications, because network latency is the dominating factor
> here. Think about a classic 2-tier application: the biggest "cost" is
> usually communicating with the backend (e.g., a database or some such), and
> *that* cost is due to the network round trips more often than not.
>
> > Another question is that we will have a queue with lots of messages
> > handled, perhaps 5000/sec(size of 2K), which is about 90% of the total
> > messages handled by the cluster.  It's hard for us to split it into
> multiple
> > queues, it's really a big design change which we try to avoid. From your
> > comments, even if messages are synchronized on only 2 nodes , hardly we
> can
> > get linear scaling , right?
>
> That's correct. The queue must handle messages in FIFO order and has an
> upper bound on how fast it can receive from and/or deliver messages to its
> clients.
>
> > If so, is the network traffic the major factor impacting the
> performance? If so ,we can try some high bandwidth instances
> > or using AWS instance group. Hopes that will get better performance.
>
> Yes and no. If the clients interacting with the queue are connected to
> another node, then the cost of inter-node traffic will have an impact. A
> equally important potential cost you must be aware of though, is that of
> mirroring the queue across even two cluster nodes. When a queue is
> mirrored, the master queue process cannot take full responsibility for a
> message until that message has been accepted by all replicas. Even if the
> mirroring policy is set to "exactly 2 nodes", this still means that a
> message delivered to the queue on node-1 must also be transmitted to
> node-2. If the message is 'persistent', then both nodes must flush to disk.
> If confirms are in use, no confirm can be issued until both nodes have
> received the message, flushed it to disk and the master *knows* that this
> has taken place. That's a lot of work per-message.
>
> So as Michael said, HA/Mirroring is not a feature that helps performance -
> it is a feature that increases resiliency in case of node failures. Adding
> bandwidth is only part of the story. Even with more bandwidth, there is
> still going to be higher latency, not only because of the amount of
> inter-node traffic, but also because each node has to complete some work in
> order to keep the replicas in sync.
>
> I would suggest that you look very hard at that "queue with lots of
> messages handled" and see if you can split it up. Imagine if you were
> writing to a database and you had this one giant table that almost every
> transaction had to write to. This would become a bottleneck quickly and
> you'd look to split it up if possible, or if not then at least to partition
> it based on suitable indexes. We don't have a feature for "partitioning a
> queue over multiple nodes" yet, so you'll have to think about partitioning
> the messages yourself. If you can do that, and therefore increase the
> number of queues that are able to concurrently handle messages, you should
> get a decent performance increase.
>
> HTH.
>
> Tim
>
> >
> > -----Original Message-----
> > From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> > [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
> Michael
> > Klishin
> > Sent: Thursday, August 22, 2013 4:56 PM
> > To: Discussions about RabbitMQ
> > Subject: Re: [rabbitmq-discuss] questions about RabbitMQ linear
> scalability
> >
> > Junius Wang:
> >
> >> 1.       The throughput of two node cluster is 50%-60% worse than a
> single
> > node broker.
> >
> > With mirroring, messages have to be copied to multiple (N or, depending
> on
> > configuration, even all) nodes in the cluster. That obviously takes more
> > time than not copying anything.
> >
> >> 2.       Adding more node did have improvement on throughput but we only
> > got 25% improvement(throughput of 3 node cluster is 25% better than 2
> node
> > cluster. 4 node cluster is 25% better than 3 node cluster too). What we
> > expected is a 45-degree line, that means when 2 nodes are used the
> > throughput is double. With 3 nodes, then triple.
> >
> > You are not providing any details about your workload but the way you
> extend
> > capacity with RabbitMQ is by adding nodes and using more queues. Queue
> > mirroring is an HA feature, which means copying more data across the
> > cluster.
> >
> > Maximum throughput and highest availability are largely at odds with each
> > other, so you need to
> >
> > 1. Use multiple queues (and the number should grow with the number of
> nodes)
> > 2. Choose what queues to mirror. Likely not all queues are equally
> important
> > to your system, so you can make some of them non-HA.
> > 3. Configure mirroring to, say, 2 nodes instead of "all".
> > 4. If you know what node is the master for a particular queue (e.g. was
> > declared on that node),
> >     make your clients connect there. It will decrease intra-cluster
> > traffic.
> > --
> > MK
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/5fba31a5/attachment.htm>

From david.tinker at gmail.com  Thu Aug 29 18:05:23 2013
From: david.tinker at gmail.com (David Tinker)
Date: Thu, 29 Aug 2013 19:05:23 +0200
Subject: [rabbitmq-discuss] Please add QDB to devtools page on RabbitMQ site
Message-ID: <CA+O6_FchKQdZLiHMWVtW62MgV1FrBHtgPC9FN1xyBYSRkY6yKw@mail.gmail.com>

Hopefully this list is the right place to ask!

<a href="http://qdb.io/">QDB: Persistent Message Queues with Replay</a>
Backup RabbitMQ queues to disk and replay messages by timestamp or id.
Or use the REST API to send messages to a remote RabbitMQ with a
simple POST (easier and more flexible than using a shovel).

-- 
http://qdb.io/ Persistent Message Queues With Replay and #RabbitMQ Integration

From jkuch at gopivotal.com  Thu Aug 29 19:37:36 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 29 Aug 2013 11:37:36 -0700
Subject: [rabbitmq-discuss] plugin development on Windows - possible?
In-Reply-To: <521F156B.9080000@rabbitmq.com>
References: <070e31db-0be3-429b-9b31-6ab4a8aeecd4@googlegroups.com>
	<521F156B.9080000@rabbitmq.com>
Message-ID: <CANOx8N=TDxWUCjKRKP++6NCiP=5s2=sioffYV8d+Cck7ox7U7Q@mail.gmail.com>

The users I've talked to who have shown interest in doing this have usually
decided to pursue the Linux direction for their plugin development because
the pernicious interactions of Cygwin, the Erlang tools, and various other
things are so cagey, and you never quite know when you're safe.

Perhaps a Linux install in a VM is the easiest path forward.


On Thu, Aug 29, 2013 at 2:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 29/08/13 07:03, Isosceles wrote:
> > I'm getting conflicting information on whether it's possible to
> > compile/build RabbitMQ plugins on Windows with cygwin. Some posts claim
> > it's totally doable while others say it's out of question because of
> > filesystem conventions and escript behavior on Win.
>
> At the time of writing the released plugins cannot be built by Cygwin
> from within the public umbrella repository due to the reasons you list.
> You might be able to work around those issues or build your plugin using
> your own build infrastructure.
>
> If you have a choice then opt for a Unix/GNU platform (such as Linux)
> where the existing build infrastructure will work.
>
>
>
> -Emile
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/c791d98a/attachment.htm>

From akbar.pirani7 at gmail.com  Thu Aug 29 21:44:14 2013
From: akbar.pirani7 at gmail.com (Akbar Pirani)
Date: Thu, 29 Aug 2013 16:44:14 -0400
Subject: [rabbitmq-discuss] stomp plugin doesn't work in Ubuntu Natty
In-Reply-To: <2104642447-1377790200-cardhu_decombobulator_blackberry.rim.net-632907447-@b25.c24.bise6.blackberry>
References: <2104642447-1377790200-cardhu_decombobulator_blackberry.rim.net-632907447-@b25.c24.bise6.blackberry>
Message-ID: <CAMVmnJRwZRB8w3aejBUe1tjHncRLr0-U0mTsVen3PvvF90cReQ@mail.gmail.com>

Hi Simon:
We have tried building the rabbitmq-auth-backend-http  plugin on Mac OS-X
10.8.4 using the changes recommended by you and it gave the following error.

=ERROR REPORT==== 29-Aug-2013::14:03:22 ===
STOMP error frame sent:
Message: "Bad CONNECT"
Detail: "Access refused for user '671682ad-f2f2-42e4-8b3d-88444fce2e6f'\n"
Server private detail: none

I have added "Rajiv" and "Ramesh" to this email thread.  They will continue
to work on this issue, as I complete my 3 year contract tenure with AT&T
today.

The good news is we got it working on Ubuntu and based on that result
Ramesh and Rajiv are going to try once again on Mac. They shall keep you
informed.



On Thu, Aug 29, 2013 at 11:29 AM, <akbar.pirani7 at gmail.com> wrote:

> Thanks Simon. I will try it out and let you know the results.
> ------Original Message------
> From: Simon MacMullen
> To: Discussions about RabbitMQ
> Cc: Alvaro Videla
> Cc: Akbar Pirani
> Subject: Re: [rabbitmq-discuss] stomp plugin doesn't work in Ubuntu Natty
> Sent: Aug 29, 2013 7:42 AM
>
> On 28/08/2013 5:54PM, Alvaro Videla wrote:
> > Since this plugin is not part of the RabbitMQ distribution, then we have
> > to decide with the team what to do with regards to edoc.
>
> I removed the dependency on edoc here:
>
> https://github.com/simonmacmullen/rabbitmq-auth-backend-http/commit/e7ac6289a6c02b350f822f6f059f1932cc21a5c8
>
> Akbar, please pull and recompile.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
>
> Sent via BlackBerry by AT&T
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/6c791b91/attachment.htm>

From waseemtaj at yahoo.com  Fri Aug 30 00:41:12 2013
From: waseemtaj at yahoo.com (waseemtaj)
Date: Thu, 29 Aug 2013 16:41:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq boot failure with
	"tables_not_present"
In-Reply-To: <50F7D3D8.2050501@rabbitmq.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<50F7D3D8.2050501@rabbitmq.com>
Message-ID: <1377819672367-29192.post@n5.nabble.com>

Hi Simon


>>> I'll file a bug to get this fixed, but in the mean time if you 
could stagger the start of your cluster nodes (so that one node starts 
on its own, and then others can start simultaneously or apart) that will 
act as a workaround. 

Has this issue been fixed and if so which version was this fixed in? Thanks
in advance.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-boot-failure-with-tables-not-present-tp24494p29192.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From chun.wang at solutionforest.com.au  Fri Aug 30 01:58:18 2013
From: chun.wang at solutionforest.com.au (wushicola)
Date: Thu, 29 Aug 2013 17:58:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq priority queues
Message-ID: <1377824298907-29193.post@n5.nabble.com>

Hi guys,

I want to create several queues with different priorities, but when I
consume the message, how can I consume message from the high priority queue
first. I use java QueueingConsumer to do that, QueueingConsumer.Delivery
delivery = consumer.nextDelivery(); it seems I can not tell the next message
is from which queue. 

In this situation, do I need different channels for each queue? Or I only
need 1 channel, mutil queues, and 1 consumer?

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-priority-queues-tp29193.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael at rabbitmq.com  Fri Aug 30 09:39:31 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 12:39:31 +0400
Subject: [rabbitmq-discuss] Rabbitmq priority queues
In-Reply-To: <1377824298907-29193.post@n5.nabble.com>
References: <1377824298907-29193.post@n5.nabble.com>
Message-ID: <1050E87D-87F3-44DE-B8FF-F788C3201FC0@rabbitmq.com>

wushicola:

> In this situation, do I need different channels for each queue? Or I only
> need 1 channel, mutil queues, and 1 consumer?

To consume from multiple queues you need multiple consumers. They can use the same channel.

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/b7cf12b2/attachment.pgp>

From matthias at rabbitmq.com  Fri Aug 30 09:52:11 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Aug 2013 09:52:11 +0100
Subject: [rabbitmq-discuss] Rabbitmq priority queues
In-Reply-To: <1050E87D-87F3-44DE-B8FF-F788C3201FC0@rabbitmq.com>
References: <1377824298907-29193.post@n5.nabble.com>
	<1050E87D-87F3-44DE-B8FF-F788C3201FC0@rabbitmq.com>
Message-ID: <52205D3B.4050006@rabbitmq.com>

On 30/08/13 09:39, Michael Klishin wrote:
>> In this situation, do I need different channels for each queue? Or
>> I only need 1 channel, mutil queues, and 1 consumer?
>
> To consume from multiple queues you need multiple consumers. They can
> use the same channel.

I believe the OP's question pertains to the use of QueuingConsumer in 
this context. In particular, when using the same QueuingConsumer 
instance to consume from multiple queues, there is no way to distinguish 
which messages were delivered from which queues.

This could be addressed by adding the consumer tag to 
QueuingConsumer.Delivery. I have filed a bug for that.


Regards,

Matthias.

From simon at rabbitmq.com  Fri Aug 30 09:54:37 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 Aug 2013 09:54:37 +0100
Subject: [rabbitmq-discuss] Rabbitmq boot failure with
	"tables_not_present"
In-Reply-To: <1377819672367-29192.post@n5.nabble.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<50F7D3D8.2050501@rabbitmq.com>
	<1377819672367-29192.post@n5.nabble.com>
Message-ID: <52205DCD.3020608@rabbitmq.com>

On 30/08/2013 12:41AM, waseemtaj wrote:
> Has this issue been fixed and if so which version was this fixed in? Thanks
> in advance.

I'm afraid it hasn't been fixed yet.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From a.p.chatterjee at gmail.com  Fri Aug 30 10:33:05 2013
From: a.p.chatterjee at gmail.com (anirban)
Date: Fri, 30 Aug 2013 02:33:05 -0700 (PDT)
Subject: [rabbitmq-discuss] compiling rabbit-mq server on rhel 5 x86_64 -
	segmentation fault
Message-ID: <39c22464-33ef-48d3-b2d0-603c488b26df@googlegroups.com>




erl -version
Erlang (SMP,ASYNC_THREADS,HIPE) (BEAM) emulator version 5.6.5


cloned from the latest in the repo:

make:
make-3.81-3.el5

xslt:
libxslt-devel-1.1.17-4.el5_8.3
libxslt-1.1.17-4.el5_8.3



Makefile:375: deps.mk: No such file or directory
python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json 
../rabbitmq-codegen//credit_extension.json src/rabbit_framing_amqp_0_9_1.erl
python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.8.json 
src/rabbit_framing_amqp_0_8.erl
xsltproc --novalid --stringparam modulename "`basename 
src/rabbit_ctl_usage.erl .erl`" \
                docs/usage.xsl docs/rabbitmqctl.1.xml > 
src/rabbit_ctl_usage.erl.tmp
/bin/sh: line 1: 10489 Segmentation fault      xsltproc --novalid 
--stringparam modulename "`basename src/rabbit_ctl_usage.erl .erl`" 
docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp
make: *** [src/rabbit_ctl_usage.erl] Error 139

am I missing anything obvious ?

-anirban

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/17b422b2/attachment.htm>

From simon at rabbitmq.com  Fri Aug 30 10:59:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 Aug 2013 10:59:34 +0100
Subject: [rabbitmq-discuss] compiling rabbit-mq server on rhel 5 x86_64
 - segmentation fault
In-Reply-To: <39c22464-33ef-48d3-b2d0-603c488b26df@googlegroups.com>
References: <39c22464-33ef-48d3-b2d0-603c488b26df@googlegroups.com>
Message-ID: <52206D06.4000601@rabbitmq.com>

Well, xsltproc is segfaulting, but you probably knew that. 1.1.17 is 
really quite old - it predates the first line of code written for 
RabbitMQ! Not sure what advice I can give other than "upgrade xsltproc".

That's also an old version of Erlang BTW, see 
http://www.rabbitmq.com/install-rpm.html for tips on getting a newer one.

And of course you may not need to compile RabbitMQ; if you don't want to 
use the RPM you can install the binary tarball: 
http://www.rabbitmq.com/install-generic-unix.html

Cheers, Simon

On 30/08/2013 10:33AM, anirban wrote:
>
>
>
> erl -version
> Erlang (SMP,ASYNC_THREADS,HIPE) (BEAM) emulator version 5.6.5
>
>
> cloned from the latest in the repo:
>
> make:
> make-3.81-3.el5
>
> xslt:
> libxslt-devel-1.1.17-4.el5_8.3
> libxslt-1.1.17-4.el5_8.3
>
>
>
> Makefile:375: deps.mk: No such file or directory
> python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json
> ../rabbitmq-codegen//credit_extension.json src/rabbit_framing_amqp_0_9_1.erl
> python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.8.json
> src/rabbit_framing_amqp_0_8.erl
> xsltproc --novalid --stringparam modulename "`basename
> src/rabbit_ctl_usage.erl .erl`" \
>                  docs/usage.xsl docs/rabbitmqctl.1.xml >
> src/rabbit_ctl_usage.erl.tmp
> /bin/sh: line 1: 10489 Segmentation fault      xsltproc --novalid
> --stringparam modulename "`basename src/rabbit_ctl_usage.erl .erl`"
> docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp
> make: *** [src/rabbit_ctl_usage.erl] Error 139
>
> am I missing anything obvious ?
>
> -anirban
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From a.p.chatterjee at gmail.com  Fri Aug 30 11:16:11 2013
From: a.p.chatterjee at gmail.com (Anirban Chatterjee)
Date: Fri, 30 Aug 2013 11:16:11 +0100
Subject: [rabbitmq-discuss] compiling rabbit-mq server on rhel 5 x86_64
	- segmentation fault
In-Reply-To: <52206D06.4000601@rabbitmq.com>
References: <39c22464-33ef-48d3-b2d0-603c488b26df@googlegroups.com>
	<52206D06.4000601@rabbitmq.com>
Message-ID: <2E3BFFA1-1548-492B-BE05-DDC540A7A6D6@gmail.com>

Thanks Simon 
If only rhel-updates had a newer version !!


-anirban 

On 30 Aug 2013, at 10:59, Simon MacMullen <simon at rabbitmq.com> wrote:

> Well, xsltproc is segfaulting, but you probably knew that. 1.1.17 is really quite old - it predates the first line of code written for RabbitMQ! Not sure what advice I can give other than "upgrade xsltproc".
> 
> That's also an old version of Erlang BTW, see http://www.rabbitmq.com/install-rpm.html for tips on getting a newer one.
> 
> And of course you may not need to compile RabbitMQ; if you don't want to use the RPM you can install the binary tarball: http://www.rabbitmq.com/install-generic-unix.html
> 
> Cheers, Simon
> 
> On 30/08/2013 10:33AM, anirban wrote:
>> 
>> 
>> 
>> erl -version
>> Erlang (SMP,ASYNC_THREADS,HIPE) (BEAM) emulator version 5.6.5
>> 
>> 
>> cloned from the latest in the repo:
>> 
>> make:
>> make-3.81-3.el5
>> 
>> xslt:
>> libxslt-devel-1.1.17-4.el5_8.3
>> libxslt-1.1.17-4.el5_8.3
>> 
>> 
>> 
>> Makefile:375: deps.mk: No such file or directory
>> python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json
>> ../rabbitmq-codegen//credit_extension.json src/rabbit_framing_amqp_0_9_1.erl
>> python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.8.json
>> src/rabbit_framing_amqp_0_8.erl
>> xsltproc --novalid --stringparam modulename "`basename
>> src/rabbit_ctl_usage.erl .erl`" \
>>                 docs/usage.xsl docs/rabbitmqctl.1.xml >
>> src/rabbit_ctl_usage.erl.tmp
>> /bin/sh: line 1: 10489 Segmentation fault      xsltproc --novalid
>> --stringparam modulename "`basename src/rabbit_ctl_usage.erl .erl`"
>> docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp
>> make: *** [src/rabbit_ctl_usage.erl] Error 139
>> 
>> am I missing anything obvious ?
>> 
>> -anirban
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal

From sekhar434145 at gmail.com  Fri Aug 30 11:20:00 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 30 Aug 2013 15:50:00 +0530
Subject: [rabbitmq-discuss] How does Messages will be persisted in RabbitMQ?
Message-ID: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>

HI,

I would like to know, how the messages are stored in RabbitMQ server.
Whether it is file level or DB level persistence?

And please let clarify me what is DISC, RAM and MNESIA.

Thanks in advace.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/2eec709e/attachment.htm>

From sekhar434145 at gmail.com  Fri Aug 30 11:20:43 2013
From: sekhar434145 at gmail.com (sekhar434)
Date: Fri, 30 Aug 2013 03:20:43 -0700 (PDT)
Subject: [rabbitmq-discuss] How does Messages will be persisted in RabbitMQ?
Message-ID: <1377858043194-29200.post@n5.nabble.com>

HI,I would like to know, how the messages are stored in RabbitMQ server.
Whether it is file level or DB level persistence?And please let clarify me
what is DISC, RAM and MNESIA.Thanks in advace.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-does-Messages-will-be-persisted-in-RabbitMQ-tp29200.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/4cfdbcc3/attachment.htm>

From michael at rabbitmq.com  Fri Aug 30 11:28:53 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 14:28:53 +0400
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
Message-ID: <D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>

Rajasekhar P:

> I would like to know, how the messages are stored in RabbitMQ server. Whether it is file level or DB level persistence?

RabbitMQ uses its own storage layer for messages, not an external database. Certain parts of it are pluggable
and can use K/V stores such as Tokyo Cabinet.

> 
> And please let clarify me what is DISC, RAM and MNESIA

Mnesia is a distributed database that RabbitMQ uses to store information about users, exchanges, queues, bindings, etc. Messages or message positions in queues are not stored in Mnesia.

Mnesia can store data either in RAM or on disk, or both. You can learn about disk and RAM nodes
on [1]. If you want to learn more about Mnesia, see [2], but
you don't need to learn anything about it in order to use RabbitMQ.

1. http://www.rabbitmq.com/clustering.html
2. http://www.erlang.org/doc/apps/mnesia/Mnesia_chap1.html#id57488

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/389a3dd0/attachment.pgp>

From emile at rabbitmq.com  Fri Aug 30 11:30:11 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 30 Aug 2013 11:30:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
Message-ID: <52207433.5020608@rabbitmq.com>

On 29/08/13 12:58, Arindam Nayak wrote:
> I have uploaded screencast for this - link  -
> http://screencast.com/t/NG75rMlwOlH1


Thanks for taking the time to do this. However I must confess I don't
find it very useful in understanding the issue. A minimal,
self-contained program that demonstrates the problem will be more useful.



-Emile







From jeremy.gomez at raceform.co.uk  Fri Aug 30 10:57:31 2013
From: jeremy.gomez at raceform.co.uk (Jeremy G)
Date: Fri, 30 Aug 2013 02:57:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Message not being delivered to consumer
Message-ID: <6a8f2ff6-697a-49f0-99db-0cebe523405c@googlegroups.com>

Setup: Centos 6.2, RabbitMQ 3.1.3, PHP 5.4.3

I am attempting to run the demo scripts from Alvaro Videla's php-amqlib (
https://github.com/videlalvaro/php-amqplib), specifically
amqp_consumer_non_blocking.php &  amqp_publisher.php 

One console is running 'php amqp_consumer_non_blocking.php', so I open 
another console and run 'php amqp_publisher.php This is a test'

'amqp_consumer_non_blocking.php' sits waiting with:

< 60,20: Basic.consume
waiting for 60,21
waiting for a new frame
> 60,21: Basic.consume_ok

and 'amqp_publisher.php' produces this:

< 60,40: Basic.publish
< [hex]:
0000  02 00 01 00 00 00 1A 00  3C 00 00 00 00 00 00 00   ........ <.......
0010  00 00 0E 90 00 0A 74 65  78 74 2F 70 6C 61 69 6E   .....te xt/plain
0020  02 CE                                              .?

< [hex]:
0000  03 00 01 00 00 00 0E 54  68 69 73 20 69 73 20 61   .......T his is a
0010  20 74 65 73 74 CE                                   test?

< [hex]:
0000  01 00 01 00 00 00 0B 00  14 00 28 00 00 00 00 00   ........ ..(.....
0010  00 00 CE                                           ..?

< 20,40: Channel.close
waiting for 20,41
waiting for a new frame

The message does not get delivered.

However, I have run these scripts on another virtual machine (Centos 6.2, 
Rabbit 3.1.3, PHP 5.4.3) and get the following from 'amqp_publisher.php':

< 60,40: Basic.publish
< [hex]:
0000  02 00 01 00 00 00 1A 00  3C 00 00 00 00 00 00 00   ........ <.......
0010  00 00 0E 90 00 0A 74 65  78 74 2F 70 6C 61 69 6E   .....te xt/plain
0020  02 CE                                              .?

< [hex]:
0000  03 00 01 00 00 00 0E 54  68 69 73 20 69 73 20 61   .......T his is a
0010  20 74 65 73 74 CE                                   test?

< [hex]:
0000  01 00 01 00 00 00 0B 00  14 00 28 00 00 00 00 00   ........ ..(.....
0010  00 00 CE                                           ..?

< 20,40: Channel.close
waiting for 20,41
waiting for a new frame
> 20,41: Channel.close_ok
< [hex]:
0000  01 00 00 00 00 00 0B 00  0A 00 32 00 00 00 00 00   ........ ..2.....
0010  00 00 CE                                           ..?

< 10,50: Connection.close
waiting for 10,51
waiting for a new frame
*> 10,51: Connection.close_ok*
*closing socket*

And this from the consumer script:

< 60,20: Basic.consume
waiting for 60,21
waiting for a new frame
> 60,21: Basic.consume_ok
waiting for any method
waiting for a new frame
*> 60,60: Basic.deliver*
*waiting for a new frame*
*waiting for a new frame*
*
*
*--------*
*This is a test*
*--------*
*< [hex]:*
*0000  01 00 01 00 00 00 0D 00  3C 00 50 00 00 00 00 00   ........ <.P.....*
*0010  00 00 01 00 CE                                     ....?*
*
*
*< 60,80: Basic.ack*

What could be the reason that the message is not being delivered?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/9d6e68e1/attachment.htm>

From sekhar434145 at gmail.com  Fri Aug 30 11:47:09 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 30 Aug 2013 16:17:09 +0530
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
Message-ID: <CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>

Thanks MK.

As you have mentioned Messages are not stored in Mnesia.  In my local
system I have configured RABBITMQ_BASE to \ect\
RabbitMQBase\db\rabbit at node1-mnesia Mnesia Mnesia under this "db" folder
created which is having "msg_store_persistent " and "msg_store_transient"
sub folders. So, can you please let me know where can I check messages
persistence.

Thanks in advace!!!


On Fri, Aug 30, 2013 at 3:58 PM, Michael Klishin <michael at rabbitmq.com>wrote:

> Rajasekhar P:
>
> > I would like to know, how the messages are stored in RabbitMQ server.
> Whether it is file level or DB level persistence?
>
> RabbitMQ uses its own storage layer for messages, not an external
> database. Certain parts of it are pluggable
> and can use K/V stores such as Tokyo Cabinet.
>
> >
> > And please let clarify me what is DISC, RAM and MNESIA
>
> Mnesia is a distributed database that RabbitMQ uses to store information
> about users, exchanges, queues, bindings, etc. Messages or message
> positions in queues are not stored in Mnesia.
>
> Mnesia can store data either in RAM or on disk, or both. You can learn
> about disk and RAM nodes
> on [1]. If you want to learn more about Mnesia, see [2], but
> you don't need to learn anything about it in order to use RabbitMQ.
>
> 1. http://www.rabbitmq.com/clustering.html
> 2. http://www.erlang.org/doc/apps/mnesia/Mnesia_chap1.html#id57488
>
> MK
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/31dac009/attachment.htm>

From michael at rabbitmq.com  Fri Aug 30 11:52:49 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 14:52:49 +0400
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
Message-ID: <2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>

Rajasekhar P:

> In my local system I have configured RABBITMQ_BASE to \ect\RabbitMQBase\db\rabbit at node1-mnesia Mnesia Mnesia under this "db" folder created which is having "msg_store_persistent " and "msg_store_transient" sub folders. So, can you please let me know where can I check messages persistence.

Message stores keep files under the mnesia directory but Mnesia never touches those files.
What do you mean
by "check messages persistence"? Do you want to inspect messages on disk?

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/1eae9e4b/attachment.pgp>

From sekhar434145 at gmail.com  Fri Aug 30 11:59:28 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 30 Aug 2013 16:29:28 +0530
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
Message-ID: <CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>

As you have mentioned messages are not stored on Mnesia. But, durable
messages are recovered even the RabbitMQ restarted, so where exactly these
messages are stored?


On Fri, Aug 30, 2013 at 4:22 PM, Michael Klishin <michael at rabbitmq.com>wrote:

> Rajasekhar P:
>
> > In my local system I have configured RABBITMQ_BASE to
> \ect\RabbitMQBase\db\rabbit at node1-mnesia Mnesia Mnesia under this "db"
> folder created which is having "msg_store_persistent " and
> "msg_store_transient" sub folders. So, can you please let me know where can
> I check messages persistence.
>
> Message stores keep files under the mnesia directory but Mnesia never
> touches those files.
> What do you mean
> by "check messages persistence"? Do you want to inspect messages on disk?
>
> MK
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/c54d2525/attachment.htm>

From michael at rabbitmq.com  Fri Aug 30 12:03:19 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 15:03:19 +0400
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
Message-ID: <066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>

Rajasekhar P:

> As you have mentioned messages are not stored on Mnesia. But, durable messages are recovered even the RabbitMQ restarted, so where exactly these messages are stored?

They are stored in files in a custom format.

See also http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/.

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/d902db13/attachment.pgp>

From matthias at rabbitmq.com  Fri Aug 30 12:09:18 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Aug 2013 12:09:18 +0100
Subject: [rabbitmq-discuss] Message not being delivered to consumer
In-Reply-To: <6a8f2ff6-697a-49f0-99db-0cebe523405c@googlegroups.com>
References: <6a8f2ff6-697a-49f0-99db-0cebe523405c@googlegroups.com>
Message-ID: <52207D5E.3010501@rabbitmq.com>

On 30/08/13 10:57, Jeremy G wrote:
> and 'amqp_publisher.php' produces this:
> [...]
> < 20,40: Channel.close
> waiting for 20,41
> waiting for a new frame
>
> The message does not get delivered.

vs

> < 20,40: Channel.close
> waiting for 20,41
> waiting for a new frame
>  > 20,41: Channel.close_ok

Observe that in the first case you are not seeing a Channel.close_ok.

> What could be the reason that the message is not being delivered?

The most likely reason is that the server has blocked the publisher due 
to a resource alarm. Check your server logs.

Matthias.

From nayak.arindam at gmail.com  Fri Aug 30 12:19:15 2013
From: nayak.arindam at gmail.com (Arindam Nayak)
Date: Fri, 30 Aug 2013 04:19:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
Message-ID: <833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>

I have uploaded sample code for this. Link is - http://j.mp/rbconsumer.  

How to reproduce this --

Run the program , put break points on  (Consumer.cs)
1. RestartConsumer() function start point,
2. while (isConsuming) {
3. catch (Exception exp)

I have not written producer for this, when i run this, i put something in 
queue(i.e. producer kind) from management UI.

So , when running the program it will 1st hit (#2 while (isConsuming)), and 
then introduce an exception (may be restart rabbitmq server or something 
else),
then it will hit "#3catch(Exception exp)", this will subsequently call 
restart code, you can check how, main application exits while executing 
restart code.


On Thursday, 29 August 2013 17:28:35 UTC+5:30, Arindam Nayak wrote:
>
> I have uploaded screencast for this - link  - 
> http://screencast.com/t/NG75rMlwOlH1
>
> On Thursday, 29 August 2013 12:48:20 UTC+5:30, ????? ??????? wrote:
>>
>> Did you get any exception when trying recreate connection?
>> Where you lost connection - in consumer or producer? Can you provide your 
>> code? 
>> Without more detail information nobody can helps you.
>>
>> ?????, 28 ??????? 2013 ?., 15:15:11 UTC+4 ???????????? Arindam Nayak 
>> ???????:
>>>
>>> I have written a rabbitmq consumer service, which is a windows service, 
>>> it constantly polls (something like while(true)) and reads queue data and 
>>> process, it works fine for 4-5 days, but suddenly after that it gets 
>>> detached from queue and stalls windows service until i manually restarts 
>>> that windows service. I have using .net client libraries. I have also added 
>>> restart code. that re creates connection , binds to queue and then listens 
>>> , but that restart code does not work. When i tried to debug the service, 
>>> it does not help, it stops debug process abruptly , at connection 
>>> re-creation time. Please help.
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/5230f1d0/attachment.htm>

From sekhar434145 at gmail.com  Fri Aug 30 12:31:05 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 30 Aug 2013 17:01:05 +0530
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
Message-ID: <CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>

I have gone through the link, here backing stores are for writing the
messages into disk. But, I couldn't understand the use of database which
mentioned in the article.  Can you please explain me how can I use database
here. Thank you!!!


On Fri, Aug 30, 2013 at 4:33 PM, Michael Klishin <michael at rabbitmq.com>wrote:

> Rajasekhar P:
>
> > As you have mentioned messages are not stored on Mnesia. But, durable
> messages are recovered even the RabbitMQ restarted, so where exactly these
> messages are stored?
>
> They are stored in files in a custom format.
>
> See also
> http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/
> .
>
> MK
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/1df8d72f/attachment.htm>

From michael at rabbitmq.com  Fri Aug 30 12:34:21 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 15:34:21 +0400
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
Message-ID: <161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>

Rajasekhar P:

> I have gone through the link, here backing stores are for writing the messages into disk. But, I couldn't understand the use of database which mentioned in the article.  Can you please explain me how can I use database here. Thank you!!!

You don't use it. RabbitMQ does. You simply publish messages as persistent
if you want them to be stored on disk. Backing stores is an implementation detail
(so is the use of Mnesia for storing user/vhost/queue/exchange/binding info.

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/74d98e51/attachment.pgp>

From sekhar434145 at gmail.com  Fri Aug 30 12:42:26 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 30 Aug 2013 17:12:26 +0530
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
Message-ID: <CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>

Thanks MK and am new to this RabbitMQ, sorry if I am asking silly
questions.

So, you mean we shouldn't use any database where RabbitMQ does for us ,

    1> with internal database and
    2> even it doesn't use even any file system.

In this case how can we restore the database in case of server crash or
some other issue.



On Fri, Aug 30, 2013 at 5:04 PM, Michael Klishin <michael at rabbitmq.com>wrote:

> Rajasekhar P:
>
> > I have gone through the link, here backing stores are for writing the
> messages into disk. But, I couldn't understand the use of database which
> mentioned in the article.  Can you please explain me how can I use database
> here. Thank you!!!
>
> You don't use it. RabbitMQ does. You simply publish messages as persistent
> if you want them to be stored on disk. Backing stores is an implementation
> detail
> (so is the use of Mnesia for storing user/vhost/queue/exchange/binding
> info.
>
> MK
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/ee986bc9/attachment.htm>

From michael at rabbitmq.com  Fri Aug 30 12:49:30 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 15:49:30 +0400
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
Message-ID: <7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>

Rajasekhar P:

> So, you mean we shouldn't use any database where RabbitMQ does for us ,
> 
>     1> with internal database and 
>     2> even it doesn't use even any file system. 
> 
> In this case how can we restore the database in case of server crash or some other issue.

RabbitMQ will recover durable queues/exchanges and persistent messages in those queues
on start. It will also perform database upgrades when you install a newer version.

To create a backup RabbitMQ database you need to stop the node and copy Mnesia directory,
the archive it how you see appropriate. To restore, replace Mnesia directory dir with a one
from backup.

You can try it locally by overriding RABBITMQ_MNESIA_DIR, see http://www.rabbitmq.com/relocate.html.

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/3de223b0/attachment.pgp>

From tim at rabbitmq.com  Fri Aug 30 13:11:43 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 30 Aug 2013 13:11:43 +0100
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
	<7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
Message-ID: <9DE998FC-FB9E-4ACC-9E3E-AA93339EFE30@rabbitmq.com>

What Michael said, plus just to clarify...

On 30 Aug 2013, at 12:49, Michael Klishin wrote:
>> So, you mean we shouldn't use any database where RabbitMQ does for us ,
>> 

Not only shouldn't you, you *cannot* use an alternative database for the purpose of storing persistent messages.

A vanilla RabbitMQ install (with no plugins in use) uses three different kinds of databases, two of which are persisted to disk:

1. mnesia - used to store "schema" data, such as queue, exchange and binding definitions (as per Michael's earlier explanation), either to disk or in ram
2. the message store - used to store persistent messages to disk (and messages that require paging due to memory pressure)
3. the message store index - stores the position of messages in queues, in memory by default (but can use alternative mechanisms such as tokyo cabinet)

>>    2> even it doesn't use even any file system. 
>> 

It *does* use the file system. The internal database writes data to a number of files which are (incidentally) stored underneath the root mnesia directory, although they have nothing to do with mnesia (we just store them in the same directory). These files contain data encoded in an internal format which is not human readable and we do not provide any tools for inspecting the contents of these database files.

>> In this case how can we restore the database in case of server crash or some other issue.
> 
> RabbitMQ will recover durable queues/exchanges and persistent messages in those queues
> on start. It will also perform database upgrades when you install a newer version.
> 

Specifically, RabbitMQ will use the aforementioned files when recovering persistent messages stored in durable queues on startup.

Tim

From david.tinker at gmail.com  Fri Aug 30 13:34:47 2013
From: david.tinker at gmail.com (David Tinker)
Date: Fri, 30 Aug 2013 14:34:47 +0200
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <9DE998FC-FB9E-4ACC-9E3E-AA93339EFE30@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
	<7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
	<9DE998FC-FB9E-4ACC-9E3E-AA93339EFE30@rabbitmq.com>
Message-ID: <CA+O6_Ffvf9Xmab4Z9JQXeTd7f0GvXCbqg=oadTEA7taFk5hiPg@mail.gmail.com>

If you need to be able to access Rabbit queues outside of RabbitMQ
(for looking at consumed messages or to replay messages for testing or
recovery) you could use QDB (http://qdb.io/). QDB is a standalone
message server that integrates with RabbitMQ. Its easy to configure it
to consume messages from a RabbitMQ queue and play them back etc.

On Fri, Aug 30, 2013 at 2:11 PM, Tim Watson <tim at rabbitmq.com> wrote:
> What Michael said, plus just to clarify...
>
> On 30 Aug 2013, at 12:49, Michael Klishin wrote:
>>> So, you mean we shouldn't use any database where RabbitMQ does for us ,
>>>
>
> Not only shouldn't you, you *cannot* use an alternative database for the purpose of storing persistent messages.
>
> A vanilla RabbitMQ install (with no plugins in use) uses three different kinds of databases, two of which are persisted to disk:
>
> 1. mnesia - used to store "schema" data, such as queue, exchange and binding definitions (as per Michael's earlier explanation), either to disk or in ram
> 2. the message store - used to store persistent messages to disk (and messages that require paging due to memory pressure)
> 3. the message store index - stores the position of messages in queues, in memory by default (but can use alternative mechanisms such as tokyo cabinet)
>
>>>    2> even it doesn't use even any file system.
>>>
>
> It *does* use the file system. The internal database writes data to a number of files which are (incidentally) stored underneath the root mnesia directory, although they have nothing to do with mnesia (we just store them in the same directory). These files contain data encoded in an internal format which is not human readable and we do not provide any tools for inspecting the contents of these database files.
>
>>> In this case how can we restore the database in case of server crash or some other issue.
>>
>> RabbitMQ will recover durable queues/exchanges and persistent messages in those queues
>> on start. It will also perform database upgrades when you install a newer version.
>>
>
> Specifically, RabbitMQ will use the aforementioned files when recovering persistent messages stored in durable queues on startup.
>
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
http://qdb.io/ Persistent Message Queues With Replay and #RabbitMQ Integration

From sekhar434145 at gmail.com  Fri Aug 30 13:40:16 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 30 Aug 2013 18:10:16 +0530
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
	<7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
Message-ID: <CAH75Yb4AvjSnpxgurZ7acNTwLLQ18mj1oKB8Ry5YqZBqGi738A@mail.gmail.com>

I have added RABBITMQ_BASE, RABBITMQ_MNESIA_DIR and RABBITMQ_MNESIA_BASE in
envt var's. But, the folder RABBITMQ_MNESIA_DIR folder is not updated even
after restarting the server. Do I need to setup any other things?


On Fri, Aug 30, 2013 at 5:19 PM, Michael Klishin <michael at rabbitmq.com>wrote:

> Rajasekhar P:
>
> > So, you mean we shouldn't use any database where RabbitMQ does for us ,
> >
> >     1> with internal database and
> >     2> even it doesn't use even any file system.
> >
> > In this case how can we restore the database in case of server crash or
> some other issue.
>
> RabbitMQ will recover durable queues/exchanges and persistent messages in
> those queues
> on start. It will also perform database upgrades when you install a newer
> version.
>
> To create a backup RabbitMQ database you need to stop the node and copy
> Mnesia directory,
> the archive it how you see appropriate. To restore, replace Mnesia
> directory dir with a one
> from backup.
>
> You can try it locally by overriding RABBITMQ_MNESIA_DIR, see
> http://www.rabbitmq.com/relocate.html.
>
> MK
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/a285a3d2/attachment.htm>

From emile at rabbitmq.com  Fri Aug 30 13:47:27 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 30 Aug 2013 13:47:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
	<833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>
Message-ID: <5220945F.201@rabbitmq.com>


Hi,

On 30/08/13 12:19, Arindam Nayak wrote:
> main application exits while executing restart code.

The main application exits because it has completed executing. Do you
consider that a problem? (BTW I note that RestartConsumer() is not
guaranteed to call Consume().)

Do you expect an exception that never arrives, or do you get an
exception that you don't expect, or do you get a different exception
from the one you expect?

If the exception is unexpected could you please post the stacktrace?

If the exception is missing or wrong in your view can you point out
where you expect it to be thrown?




-Emile





From michael at rabbitmq.com  Fri Aug 30 13:51:54 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 16:51:54 +0400
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <CAH75Yb4AvjSnpxgurZ7acNTwLLQ18mj1oKB8Ry5YqZBqGi738A@mail.gmail.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
	<7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
	<CAH75Yb4AvjSnpxgurZ7acNTwLLQ18mj1oKB8Ry5YqZBqGi738A@mail.gmail.com>
Message-ID: <1C8B3569-EF1B-4A6E-8D5F-7651E5BE19EC@rabbitmq.com>

Rajasekhar P:

> I have added RABBITMQ_BASE, RABBITMQ_MNESIA_DIR and RABBITMQ_MNESIA_BASE in envt var's. But, the folder RABBITMQ_MNESIA_DIR folder is not updated even after restarting the server. Do I need to setup any other things?

How did you do that? RabbitMQ process needs to have those env vars to be in set in
its environment. If you use RabbitMQ from packages [1] [2], it should be taken care of
by the package scripts.

1. http://www.rabbitmq.com/install-debian.html
2. http://www.rabbitmq.com/install-rpm.html

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/3528dd62/attachment.pgp>

From nayak.arindam at gmail.com  Fri Aug 30 13:56:54 2013
From: nayak.arindam at gmail.com (Arindam Nayak)
Date: Fri, 30 Aug 2013 05:56:54 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
	<833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>
Message-ID: <549e83cd-2742-4f0f-9d3f-12acd97980a7@googlegroups.com>

The main application exits because it has completed executing. Do you
consider that a problem? (BTW I note that RestartConsumer() is not
guaranteed to call Consume().)
- no, i am telling main application works still we have some data in queue, 
when queue is exhausted, still main application gets stuck in while loop 
(this is my expected behaviour, again when we have data in queue, it 
processes, this is the case for 90% of time). But out of that 10% time, i 
don't know what is the exact exception, so i have written restartconsumer 
to restart service, which is not working even, you have confirmed this.

Do you expect an exception that never arrives, or do you get an
exception that you don't expect, or do you get a different exception
from the one you expect?

yes, i am getting an exception that i don't event expect.

If the exception is unexpected could you please post the stacktrace?

If the exception is missing or wrong in your view can you point out
where you expect it to be thrown?

For this above question, i have to design separate consumer service and 
post you stacktrace and all required log files (give me 2 days time, i will 
do that), Sorry about that, i can not post my production rabbitmq server 
stacktrace, and consumers.


On Friday, 30 August 2013 16:49:15 UTC+5:30, Arindam Nayak wrote:
>
> I have uploaded sample code for this. Link is - http://j.mp/rbconsumer.  
>
> How to reproduce this --
>
> Run the program , put break points on  (Consumer.cs)
> 1. RestartConsumer() function start point,
> 2. while (isConsuming) {
> 3. catch (Exception exp)
>
> I have not written producer for this, when i run this, i put something in 
> queue(i.e. producer kind) from management UI.
>
> So , when running the program it will 1st hit (#2 while (isConsuming)), 
> and then introduce an exception (may be restart rabbitmq server or 
> something else),
> then it will hit "#3catch(Exception exp)", this will subsequently call 
> restart code, you can check how, main application exits while executing 
> restart code.
>
>
> On Thursday, 29 August 2013 17:28:35 UTC+5:30, Arindam Nayak wrote:
>>
>> I have uploaded screencast for this - link  - 
>> http://screencast.com/t/NG75rMlwOlH1
>>
>> On Thursday, 29 August 2013 12:48:20 UTC+5:30, ????? ??????? wrote:
>>>
>>> Did you get any exception when trying recreate connection?
>>> Where you lost connection - in consumer or producer? Can you provide 
>>> your code? 
>>> Without more detail information nobody can helps you.
>>>
>>> ?????, 28 ??????? 2013 ?., 15:15:11 UTC+4 ???????????? Arindam Nayak 
>>> ???????:
>>>>
>>>> I have written a rabbitmq consumer service, which is a windows service, 
>>>> it constantly polls (something like while(true)) and reads queue data and 
>>>> process, it works fine for 4-5 days, but suddenly after that it gets 
>>>> detached from queue and stalls windows service until i manually restarts 
>>>> that windows service. I have using .net client libraries. I have also added 
>>>> restart code. that re creates connection , binds to queue and then listens 
>>>> , but that restart code does not work. When i tried to debug the service, 
>>>> it does not help, it stops debug process abruptly , at connection 
>>>> re-creation time. Please help.
>>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/a39a31fa/attachment.htm>

From sekhar434145 at gmail.com  Fri Aug 30 14:05:08 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 30 Aug 2013 18:35:08 +0530
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <1C8B3569-EF1B-4A6E-8D5F-7651E5BE19EC@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
	<7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
	<CAH75Yb4AvjSnpxgurZ7acNTwLLQ18mj1oKB8Ry5YqZBqGi738A@mail.gmail.com>
	<1C8B3569-EF1B-4A6E-8D5F-7651E5BE19EC@rabbitmq.com>
Message-ID: <CAH75Yb48Y-pxcXMheQNr5QxJHBCU3cj7d3u9KvbMgAT+PMa4TA@mail.gmail.com>

I am working on Windows, when I set RABBITMQ_BASE working to some directory
(C:\RabbitMQBase). After creating the queue default folder like "db",
"log", etc will created automatically. But, no file is created under
RABBITMQ_MNESIA_DIR.


On Fri, Aug 30, 2013 at 6:21 PM, Michael Klishin <michael at rabbitmq.com>wrote:

> Rajasekhar P:
>
> > I have added RABBITMQ_BASE, RABBITMQ_MNESIA_DIR and RABBITMQ_MNESIA_BASE
> in envt var's. But, the folder RABBITMQ_MNESIA_DIR folder is not updated
> even after restarting the server. Do I need to setup any other things?
>
> How did you do that? RabbitMQ process needs to have those env vars to be
> in set in
> its environment. If you use RabbitMQ from packages [1] [2], it should be
> taken care of
> by the package scripts.
>
> 1. http://www.rabbitmq.com/install-debian.html
> 2. http://www.rabbitmq.com/install-rpm.html
>
> MK
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/ee953b44/attachment.htm>

From sekhar434145 at gmail.com  Fri Aug 30 14:09:40 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 30 Aug 2013 18:39:40 +0530
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <CAH75Yb48Y-pxcXMheQNr5QxJHBCU3cj7d3u9KvbMgAT+PMa4TA@mail.gmail.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
	<7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
	<CAH75Yb4AvjSnpxgurZ7acNTwLLQ18mj1oKB8Ry5YqZBqGi738A@mail.gmail.com>
	<1C8B3569-EF1B-4A6E-8D5F-7651E5BE19EC@rabbitmq.com>
	<CAH75Yb48Y-pxcXMheQNr5QxJHBCU3cj7d3u9KvbMgAT+PMa4TA@mail.gmail.com>
Message-ID: <CAH75Yb6geNQzqtUUViMJ37bzUkwySjR=nhv-gUpmNPxOfCOYcA@mail.gmail.com>

generated folders are
C:\RabbitMQBase\db\rabbit at PRAJASEKHARLT-mnesia\msg_store_persistent,
C:\RabbitMQBase\db\rabbit at PRAJASEKHARLT-mnesia\msg_store_transient,
C:\RabbitMQBase\log..
etc


On Fri, Aug 30, 2013 at 6:35 PM, Rajasekhar P <sekhar434145 at gmail.com>wrote:

> I am working on Windows, when I set RABBITMQ_BASE working to some
> directory (C:\RabbitMQBase). After creating the queue default folder like
> "db", "log", etc will created automatically. But, no file is created under
> RABBITMQ_MNESIA_DIR.
>
>
> On Fri, Aug 30, 2013 at 6:21 PM, Michael Klishin <michael at rabbitmq.com>wrote:
>
>> Rajasekhar P:
>>
>> > I have added RABBITMQ_BASE, RABBITMQ_MNESIA_DIR and
>> RABBITMQ_MNESIA_BASE in envt var's. But, the folder RABBITMQ_MNESIA_DIR
>> folder is not updated even after restarting the server. Do I need to setup
>> any other things?
>>
>> How did you do that? RabbitMQ process needs to have those env vars to be
>> in set in
>> its environment. If you use RabbitMQ from packages [1] [2], it should be
>> taken care of
>> by the package scripts.
>>
>> 1. http://www.rabbitmq.com/install-debian.html
>> 2. http://www.rabbitmq.com/install-rpm.html
>>
>> MK
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/db2c4b63/attachment.htm>

From nayak.arindam at gmail.com  Fri Aug 30 14:22:49 2013
From: nayak.arindam at gmail.com (Arindam Nayak)
Date: Fri, 30 Aug 2013 06:22:49 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <549e83cd-2742-4f0f-9d3f-12acd97980a7@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
	<833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>
	<549e83cd-2742-4f0f-9d3f-12acd97980a7@googlegroups.com>
Message-ID: <1e7f2115-eb5c-4865-829e-62f492ece52f@googlegroups.com>

Anyways, i have uploaded log files from my local rabbit mq server ( 
consumer code which i have given just now, connects to my local rabbitmq 
server).

https://docs.google.com/file/d/0B1FltX8OwUHuRXZMTGo3LUpLdm8/edit
https://docs.google.com/file/d/0B1FltX8OwUHuQXNDVFFDTVBLQWc/edit

On Friday, 30 August 2013 18:26:54 UTC+5:30, Arindam Nayak wrote:
>
> The main application exits because it has completed executing. Do you
> consider that a problem? (BTW I note that RestartConsumer() is not
> guaranteed to call Consume().)
> - no, i am telling main application works still we have some data in 
> queue, when queue is exhausted, still main application gets stuck in while 
> loop (this is my expected behaviour, again when we have data in queue, it 
> processes, this is the case for 90% of time). But out of that 10% time, i 
> don't know what is the exact exception, so i have written restartconsumer 
> to restart service, which is not working even, you have confirmed this.
>
> Do you expect an exception that never arrives, or do you get an
> exception that you don't expect, or do you get a different exception
> from the one you expect?
>
> yes, i am getting an exception that i don't event expect.
>
> If the exception is unexpected could you please post the stacktrace?
>
> If the exception is missing or wrong in your view can you point out
> where you expect it to be thrown?
>
> For this above question, i have to design separate consumer service and 
> post you stacktrace and all required log files (give me 2 days time, i will 
> do that), Sorry about that, i can not post my production rabbitmq server 
> stacktrace, and consumers.
>
>
> On Friday, 30 August 2013 16:49:15 UTC+5:30, Arindam Nayak wrote:
>>
>> I have uploaded sample code for this. Link is - http://j.mp/rbconsumer.  
>>
>> How to reproduce this --
>>
>> Run the program , put break points on  (Consumer.cs)
>> 1. RestartConsumer() function start point,
>> 2. while (isConsuming) {
>> 3. catch (Exception exp)
>>
>> I have not written producer for this, when i run this, i put something in 
>> queue(i.e. producer kind) from management UI.
>>
>> So , when running the program it will 1st hit (#2 while (isConsuming)), 
>> and then introduce an exception (may be restart rabbitmq server or 
>> something else),
>> then it will hit "#3catch(Exception exp)", this will subsequently call 
>> restart code, you can check how, main application exits while executing 
>> restart code.
>>
>>
>> On Thursday, 29 August 2013 17:28:35 UTC+5:30, Arindam Nayak wrote:
>>>
>>> I have uploaded screencast for this - link  - 
>>> http://screencast.com/t/NG75rMlwOlH1
>>>
>>> On Thursday, 29 August 2013 12:48:20 UTC+5:30, ????? ??????? wrote:
>>>>
>>>> Did you get any exception when trying recreate connection?
>>>> Where you lost connection - in consumer or producer? Can you provide 
>>>> your code? 
>>>> Without more detail information nobody can helps you.
>>>>
>>>> ?????, 28 ??????? 2013 ?., 15:15:11 UTC+4 ???????????? Arindam Nayak 
>>>> ???????:
>>>>>
>>>>> I have written a rabbitmq consumer service, which is a windows 
>>>>> service, it constantly polls (something like while(true)) and reads queue 
>>>>> data and process, it works fine for 4-5 days, but suddenly after that it 
>>>>> gets detached from queue and stalls windows service until i manually 
>>>>> restarts that windows service. I have using .net client libraries. I have 
>>>>> also added restart code. that re creates connection , binds to queue and 
>>>>> then listens , but that restart code does not work. When i tried to debug 
>>>>> the service, it does not help, it stops debug process abruptly , at 
>>>>> connection re-creation time. Please help.
>>>>>
>>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/7ff5d148/attachment.htm>

From emile at rabbitmq.com  Fri Aug 30 14:30:23 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 30 Aug 2013 14:30:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <1e7f2115-eb5c-4865-829e-62f492ece52f@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
	<833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>
	<549e83cd-2742-4f0f-9d3f-12acd97980a7@googlegroups.com>
	<1e7f2115-eb5c-4865-829e-62f492ece52f@googlegroups.com>
Message-ID: <52209E6F.8000805@rabbitmq.com>

On 30/08/13 14:22, Arindam Nayak wrote:

> https://docs.google.com/file/d/0B1FltX8OwUHuRXZMTGo3LUpLdm8/edit
> https://docs.google.com/file/d/0B1FltX8OwUHuQXNDVFFDTVBLQWc/edit


This says that disk free space monitoring is disabled, because the
broker was unable to read the output from a spawned shell:

C:\Windows\system32\cmd.exe /cdir /-C /W
"c:/Users/arindamn/AppData/Roaming/RabbitMQ/db/rabbit at ARINDAMN1-mnesia"


This is unlikely to be related to the other problems, but worth
investigating nevertheless.




-Emile

From michael at rabbitmq.com  Fri Aug 30 14:35:48 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 17:35:48 +0400
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <CAH75Yb6geNQzqtUUViMJ37bzUkwySjR=nhv-gUpmNPxOfCOYcA@mail.gmail.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
	<7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
	<CAH75Yb4AvjSnpxgurZ7acNTwLLQ18mj1oKB8Ry5YqZBqGi738A@mail.gmail.com>
	<1C8B3569-EF1B-4A6E-8D5F-7651E5BE19EC@rabbitmq.com>
	<CAH75Yb48Y-pxcXMheQNr5QxJHBCU3cj7d3u9KvbMgAT+PMa4TA@mail.gmail.com>
	<CAH75Yb6geNQzqtUUViMJ37bzUkwySjR=nhv-gUpmNPxOfCOYcA@mail.gmail.com>
Message-ID: <D0EAD6ED-991F-4209-8F16-3AA38A19922D@rabbitmq.com>

Rajasekhar P:

> generated folders are C:\RabbitMQBase\db\rabbit at PRAJASEKHARLT-mnesia\msg_store_persistent, C:\RabbitMQBase\db\rabbit at PRAJASEKHARLT-mnesia\msg_store_transient, C:\RabbitMQBase\log.. etc

My guess is that if RABBITMQ_BASE is set, all other directory paths are calculated against it.

I was suggesting to set RABBITMQ_MNESIA_DIR only. In any case, your Mnesia directory
path is C:\RabbitMQBase\db\rabbit at PRAJASEKHARLT-mnesia\

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/4d4aa3f0/attachment.pgp>

From nayak.arindam at gmail.com  Fri Aug 30 14:40:33 2013
From: nayak.arindam at gmail.com (Arindam Nayak)
Date: Fri, 30 Aug 2013 06:40:33 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <1e7f2115-eb5c-4865-829e-62f492ece52f@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
	<833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>
	<549e83cd-2742-4f0f-9d3f-12acd97980a7@googlegroups.com>
	<1e7f2115-eb5c-4865-829e-62f492ece52f@googlegroups.com>
Message-ID: <d73c9333-6dd9-4b51-99b7-2e97bf02b7f7@googlegroups.com>

So what i need to do? should i execute this command?

C:\Windows\system32\cmd.exe /cdir /-C /W
"c:/Users/arindamn/AppData/Roaming/RabbitMQ/db/rabbit at ARINDAMN1-mnesia"


Or how to enable disk space monitoring?


On Friday, 30 August 2013 18:52:49 UTC+5:30, Arindam Nayak wrote:
>
> Anyways, i have uploaded log files from my local rabbit mq server ( 
> consumer code which i have given just now, connects to my local rabbitmq 
> server).
>
> https://docs.google.com/file/d/0B1FltX8OwUHuRXZMTGo3LUpLdm8/edit
> https://docs.google.com/file/d/0B1FltX8OwUHuQXNDVFFDTVBLQWc/edit
>
> On Friday, 30 August 2013 18:26:54 UTC+5:30, Arindam Nayak wrote:
>>
>> The main application exits because it has completed executing. Do you
>> consider that a problem? (BTW I note that RestartConsumer() is not
>> guaranteed to call Consume().)
>> - no, i am telling main application works still we have some data in 
>> queue, when queue is exhausted, still main application gets stuck in while 
>> loop (this is my expected behaviour, again when we have data in queue, it 
>> processes, this is the case for 90% of time). But out of that 10% time, i 
>> don't know what is the exact exception, so i have written restartconsumer 
>> to restart service, which is not working even, you have confirmed this.
>>
>> Do you expect an exception that never arrives, or do you get an
>> exception that you don't expect, or do you get a different exception
>> from the one you expect?
>>
>> yes, i am getting an exception that i don't event expect.
>>
>> If the exception is unexpected could you please post the stacktrace?
>>
>> If the exception is missing or wrong in your view can you point out
>> where you expect it to be thrown?
>>
>> For this above question, i have to design separate consumer service and 
>> post you stacktrace and all required log files (give me 2 days time, i will 
>> do that), Sorry about that, i can not post my production rabbitmq server 
>> stacktrace, and consumers.
>>
>>
>> On Friday, 30 August 2013 16:49:15 UTC+5:30, Arindam Nayak wrote:
>>>
>>> I have uploaded sample code for this. Link is - http://j.mp/rbconsumer. 
>>>  
>>>
>>> How to reproduce this --
>>>
>>> Run the program , put break points on  (Consumer.cs)
>>> 1. RestartConsumer() function start point,
>>> 2. while (isConsuming) {
>>> 3. catch (Exception exp)
>>>
>>> I have not written producer for this, when i run this, i put something 
>>> in queue(i.e. producer kind) from management UI.
>>>
>>> So , when running the program it will 1st hit (#2 while (isConsuming)), 
>>> and then introduce an exception (may be restart rabbitmq server or 
>>> something else),
>>> then it will hit "#3catch(Exception exp)", this will subsequently call 
>>> restart code, you can check how, main application exits while executing 
>>> restart code.
>>>
>>>
>>> On Thursday, 29 August 2013 17:28:35 UTC+5:30, Arindam Nayak wrote:
>>>>
>>>> I have uploaded screencast for this - link  - 
>>>> http://screencast.com/t/NG75rMlwOlH1
>>>>
>>>> On Thursday, 29 August 2013 12:48:20 UTC+5:30, ????? ??????? wrote:
>>>>>
>>>>> Did you get any exception when trying recreate connection?
>>>>> Where you lost connection - in consumer or producer? Can you provide 
>>>>> your code? 
>>>>> Without more detail information nobody can helps you.
>>>>>
>>>>> ?????, 28 ??????? 2013 ?., 15:15:11 UTC+4 ???????????? Arindam Nayak 
>>>>> ???????:
>>>>>>
>>>>>> I have written a rabbitmq consumer service, which is a windows 
>>>>>> service, it constantly polls (something like while(true)) and reads queue 
>>>>>> data and process, it works fine for 4-5 days, but suddenly after that it 
>>>>>> gets detached from queue and stalls windows service until i manually 
>>>>>> restarts that windows service. I have using .net client libraries. I have 
>>>>>> also added restart code. that re creates connection , binds to queue and 
>>>>>> then listens , but that restart code does not work. When i tried to debug 
>>>>>> the service, it does not help, it stops debug process abruptly , at 
>>>>>> connection re-creation time. Please help.
>>>>>>
>>>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/759cec21/attachment.htm>

From michael at rabbitmq.com  Fri Aug 30 14:42:27 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 30 Aug 2013 17:42:27 +0400
Subject: [rabbitmq-discuss] How does Messages will be persisted in
	RabbitMQ?
In-Reply-To: <D0EAD6ED-991F-4209-8F16-3AA38A19922D@rabbitmq.com>
References: <CAH75Yb5u+4eicLGMw0H+S3+Zp_=x+K1zi3DbNabRrF=DBRNK8A@mail.gmail.com>
	<D1E78EBE-C7D6-48BC-8B34-F84B31046AC1@rabbitmq.com>
	<CAH75Yb4F5vFt8AVCsvjmVr9JnyGCw6TxvaPneDiVhm09spBMFw@mail.gmail.com>
	<2C2A53D9-92B8-449A-BB9E-7008306ABD67@rabbitmq.com>
	<CAH75Yb5XFbPko7AE11mxexG=p=Nf6-zCSvDYKqrFeqXEBDGP=g@mail.gmail.com>
	<066D2831-BC44-465F-A002-8F52E6037C08@rabbitmq.com>
	<CAH75Yb49BqLov054BPB=6Bq0y7ahzE5bf=dx1RxNzNMNrNLfTQ@mail.gmail.com>
	<161251C3-1587-463B-9371-AD1A70950745@rabbitmq.com>
	<CAH75Yb7hqoa11K=nBMyepsQbME=oBvRROAY3+gt4XJaZfyBB8w@mail.gmail.com>
	<7B2FAA30-830B-4254-9CC0-5F91C1147198@rabbitmq.com>
	<CAH75Yb4AvjSnpxgurZ7acNTwLLQ18mj1oKB8Ry5YqZBqGi738A@mail.gmail.com>
	<1C8B3569-EF1B-4A6E-8D5F-7651E5BE19EC@rabbitmq.com>
	<CAH75Yb48Y-pxcXMheQNr5QxJHBCU3cj7d3u9KvbMgAT+PMa4TA@mail.gmail.com>
	<CAH75Yb6geNQzqtUUViMJ37bzUkwySjR=nhv-gUpmNPxOfCOYcA@mail.gmail.com>
	<D0EAD6ED-991F-4209-8F16-3AA38A19922D@rabbitmq.com>
Message-ID: <4C0352C3-88C8-4EF6-8AAF-2C824E555125@rabbitmq.com>

Michael Klishin:

> My guess is that if RABBITMQ_BASE is set, all other directory paths are calculated against it.

That's not correct. If RABBITMQ_MNESIA_DIR is set, it will be used. If not, it will be calculated
against RABBITMQ_BASE path.

Using either method is fine for experimenting with backups.

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/451bd068/attachment.pgp>

From jeremy.gomez at racingpost.com  Fri Aug 30 15:13:56 2013
From: jeremy.gomez at racingpost.com (Jeremy Gomez)
Date: Fri, 30 Aug 2013 15:13:56 +0100
Subject: [rabbitmq-discuss] Message not being delivered to consumer
In-Reply-To: <52207D5E.3010501@rabbitmq.com>
References: <6a8f2ff6-697a-49f0-99db-0cebe523405c@googlegroups.com>
	<52207D5E.3010501@rabbitmq.com>
Message-ID: <CAFoYFMusJicFP_1EjE7OOAVfa5rT9et9ruE7-9sAKnFv904a8w@mail.gmail.com>

I checked the logs and you were absolutely correct, so many thanks
Matthias.

When I did  ' less /var/log/rabbitmq/rabbit\@localhost.log ' , I got :

=INFO REPORT==== 30-Aug-2013::12:48:48 ===
Disk free limit set to 1000MB

=INFO REPORT==== 30-Aug-2013::12:48:48 ===
Disk free space insufficient. Free bytes:588042240 Limit:1000000000

=WARNING REPORT==== 30-Aug-2013::12:48:48 ===
disk resource limit alarm set on node 'rabbit at rp-dev-sdapps2'.

**********************************************************
*** Publishers will be blocked until this alarm clears ***
**********************************************************




On 30 August 2013 12:09, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 30/08/13 10:57, Jeremy G wrote:
>
>> and 'amqp_publisher.php' produces this:
>> [...]
>>
>> < 20,40: Channel.close
>> waiting for 20,41
>> waiting for a new frame
>>
>> The message does not get delivered.
>>
>
> vs
>
>
>  < 20,40: Channel.close
>> waiting for 20,41
>> waiting for a new frame
>>  > 20,41: Channel.close_ok
>>
>
> Observe that in the first case you are not seeing a Channel.close_ok.
>
>
>  What could be the reason that the message is not being delivered?
>>
>
> The most likely reason is that the server has blocked the publisher due to
> a resource alarm. Check your server logs.
>
> Matthias.
>

IMPORTANT NOTICE This email (including any attachments) is meant only for the intended recipient. It may also contain confidential and privileged information. If you are not the intended recipient, any reliance on, use, publication, disclosure, distribution or copying of this email or attachments is strictly prohibited. Please notify the sender immediately by email if you have received this message by mistake and delete the email and all attachments.
Any views or opinions in this email are solely those of the author and do not necessarily represent those of Centurycomm Ltd or its associated group companies ("Racing Post Group"). The Racing Post Group accepts no liability for the content of this email, or for the consequences of any actions taken on the basis of the information provided, unless that information is subsequently confirmed to you in writing by the Racing Post Group. Although every reasonable effort is made to keep its network free from viruses, The Racing Post Group accepts no liability for any virus transmitted by this email or any attachments or otherwise for any damage to the recipient's systems or data caused by this message or its attachments.   The recipient should use up-to-date virus checking software. Email to or from this address may be subject to interception or monitoring for operational reasons or for lawful business practices.  Anyone who communicates with us by e-mail is taken to accept the ris
 ks in doing so.
Centurycomm Ltd is registered in England No 3387163, with its address at 5 Fleet Place, London, EC4M 7RD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/36a76794/attachment.htm>

From emile at rabbitmq.com  Fri Aug 30 15:52:14 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 30 Aug 2013 15:52:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer rebind in .net
In-Reply-To: <d73c9333-6dd9-4b51-99b7-2e97bf02b7f7@googlegroups.com>
References: <49a80bf9-a466-4d4e-8c1b-d2c0687f0faa@googlegroups.com>
	<b7cb7227-b442-4afa-b5ab-b3dc71893d49@googlegroups.com>
	<415223d8-b4e5-4605-aba8-dc6076c8aebd@googlegroups.com>
	<833e30ed-59e4-45b0-be9c-fc813765812c@googlegroups.com>
	<549e83cd-2742-4f0f-9d3f-12acd97980a7@googlegroups.com>
	<1e7f2115-eb5c-4865-829e-62f492ece52f@googlegroups.com>
	<d73c9333-6dd9-4b51-99b7-2e97bf02b7f7@googlegroups.com>
Message-ID: <5220B19E.9000002@rabbitmq.com>

On 30/08/13 14:40, Arindam Nayak wrote:
> So what i need to do? should i execute this command?
> 
> C:\Windows\system32\cmd.exe /cdir /-C /W
> "c:/Users/arindamn/AppData/Roaming/RabbitMQ/db/rabbit at ARINDAMN1-mnesia"
> 
> 
> Or how to enable disk space monitoring?

To be clear, this is probably a separate issue. Solving this issue will
not make your client code re-consume.

You normally don't need to take any action to make disk monitoring work.
The broker will automatically stop accepting messages when there is less
that 1Gb free space on the RabbitMQ database drive/partition. In your
case disk free space monitoring was stopped, because the broker could
not determine how much free space is available. The broker uses the
command above. You should try to execute the same command as the same
user that the broker runs as and make sure you don't get an error.




-Emile









From stuff at moesel.net  Fri Aug 30 16:26:41 2013
From: stuff at moesel.net (Chris)
Date: Fri, 30 Aug 2013 11:26:41 -0400
Subject: [rabbitmq-discuss] AutoHeal not working after yanking network cable
Message-ID: <CAHEpgBCOD8WTZ12_CFOxi87HHbjigzK0QGknSpvVZ+mMRYQ0Zw@mail.gmail.com>

Hi All,

As part of our testing of failovers, we yank the network cable on a machine
(to simulate a switch going down).  When we plug it back in, RabbitMQ goes
into the network partition mode.  At first we were using the default
('ignore') option for dealing with partitions, but it caused problems.

After that we put the nodes into 'autoheal' mode.  This did not improve
things.  Not only did the minority node not rejoin the partition, but it
refused to restart without manually killing the process.  It also caused
problems on the other nodes (in the majority).  They stopped accepting
connections and I couldn't even log into the web UI.  So clearly,
'autoheal' didn't seem to work as intended.

We're using RabbitMQ 3.1.1.  Is there anything fixed since then that might
help with our situation?  Our end goal is to have everything working again
without intervention.  I understand that this could cause *some* data loss
during the autoheal process, but this is probably OK.  We'd love just to
get all three nodes happy again without having to manually restart any
nodes.

Thanks,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/d1399474/attachment.htm>

From simon at rabbitmq.com  Fri Aug 30 17:53:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 Aug 2013 17:53:56 +0100
Subject: [rabbitmq-discuss] AutoHeal not working after yanking network
 cable
In-Reply-To: <CAHEpgBCOD8WTZ12_CFOxi87HHbjigzK0QGknSpvVZ+mMRYQ0Zw@mail.gmail.com>
References: <CAHEpgBCOD8WTZ12_CFOxi87HHbjigzK0QGknSpvVZ+mMRYQ0Zw@mail.gmail.com>
Message-ID: <5220CE24.4070501@rabbitmq.com>

There was definitely a bug in autoheal fixed in 3.1.1, but I'm not aware 
of anything since then. However it's possible some other bug that we 
have fixed is causing your problems with autoheal.

So:

1) You might as well try 3.1.5.
2) Are there any crashes in the logs on the minority node?

Cheers, Simon

On 30/08/2013 4:26PM, Chris wrote:
> Hi All,
>
> As part of our testing of failovers, we yank the network cable on a
> machine (to simulate a switch going down).  When we plug it back in,
> RabbitMQ goes into the network partition mode.  At first we were using
> the default ('ignore') option for dealing with partitions, but it caused
> problems.
>
> After that we put the nodes into 'autoheal' mode.  This did not improve
> things.  Not only did the minority node not rejoin the partition, but it
> refused to restart without manually killing the process.  It also caused
> problems on the other nodes (in the majority).  They stopped accepting
> connections and I couldn't even log into the web UI.  So clearly,
> 'autoheal' didn't seem to work as intended.
>
> We're using RabbitMQ 3.1.1.  Is there anything fixed since then that
> might help with our situation?  Our end goal is to have everything
> working again without intervention.  I understand that this could cause
> *some* data loss during the autoheal process, but this is probably OK.
>   We'd love just to get all three nodes happy again without having to
> manually restart any nodes.
>
> Thanks,
> Chris
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mas at crosscan.com  Fri Aug 30 18:14:46 2013
From: mas at crosscan.com (Malte Schirmacher)
Date: Fri, 30 Aug 2013 19:14:46 +0200
Subject: [rabbitmq-discuss] Lost queue on cluster node shutdown
Message-ID: <5220D306.8030001@crosscan.com>

Hi,

we run three-node-cluster with RabbitMQ 3.1.5, Erlang R15B01 on Ubuntu 12.10
Today we intended to increase the file descriptor limit from 10240 to 
40960. For this we changed the value in /etc/default/rabbitmq-server, 
shut down the node and tried to start it again.
But rabbit did not come up again. Instead it produces thousands of lines 
of stack traces. I think i nopasted the relevanr part here [1]
Unfortunately we lost a durable(!) queue through this bug containing 
some persistent(!) messages :-/

I think some nice guy from the IRC already filed a bug regarding this bug.

Thanks
   Malte


[1] http://paste.debian.net/32426/
--
Geschaeftsanschrift/Business Address: crosscan GmbH | Ruhrstra?e 48 | 58452 Witten | Germany
Support: +49.2302.28232-22 Phone: +49.2302.28232-00 Fax: +49.2302.28232-09 
Geschaeftsfuehrung/Management Board: Philip Lehmann, Erwin Berg, Ulrich Kellner
Sitz Witten, Amtsgericht Bochum, HRB 8036/Registered Office Witten, Commercial Register of the Bochum County Court, HRB 8036
UST-ID-Nr./VAT-IdNo.: DE234398770


From matthias at rabbitmq.com  Fri Aug 30 19:32:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Aug 2013 19:32:12 +0100
Subject: [rabbitmq-discuss] Lost queue on cluster node shutdown
In-Reply-To: <5220D306.8030001@crosscan.com>
References: <5220D306.8030001@crosscan.com>
Message-ID: <5220E52C.8010702@rabbitmq.com>

Malte,

On 30/08/13 18:14, Malte Schirmacher wrote:
> we run three-node-cluster with RabbitMQ 3.1.5, Erlang R15B01 on Ubuntu
> 12.10
> Today we [...] shut down the node and tried to start it again.
> But rabbit did not come up again. Instead it produces thousands of lines
> of stack traces. I think i nopasted the relevanr part here [1]
> Unfortunately we lost a durable(!) queue through this bug containing
> some persistent(!) messages :-/

I am pretty sure that this is a known bug that we fixed a few weeks ago. 
The fix is in the nightly builds but is too complex to go into a bugfix 
release so will have to wait for the next feature release.

The bug is most likely to surface when nodes in clustered rabbits with 
HA queues are shut down while they are dealing with a fair amount of 
traffic.

> I think some nice guy from the IRC already filed a bug regarding this bug.

Yes, Emile did.

Matthias.

From matthias at rabbitmq.com  Fri Aug 30 20:58:53 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Aug 2013 20:58:53 +0100
Subject: [rabbitmq-discuss] Lost queue on cluster node shutdown
In-Reply-To: <5220E52C.8010702@rabbitmq.com>
References: <5220D306.8030001@crosscan.com> <5220E52C.8010702@rabbitmq.com>
Message-ID: <5220F97D.70000@rabbitmq.com>

Malte,

On 30/08/13 19:32, Matthias Radestock wrote:
> On 30/08/13 18:14, Malte Schirmacher wrote:
>> we run three-node-cluster with RabbitMQ 3.1.5, Erlang R15B01 on Ubuntu
>> 12.10
>> Today we [...] shut down the node and tried to start it again.
>> But rabbit did not come up again. Instead it produces thousands of lines
>> of stack traces. I think i nopasted the relevanr part here [1]
>> Unfortunately we lost a durable(!) queue through this bug containing
>> some persistent(!) messages :-/
>
> I am pretty sure that this is a known bug that we fixed a few weeks ago.
> The fix is in the nightly builds but is too complex to go into a bugfix
> release so will have to wait for the next feature release.

Actually, the fragments you posted are follow-on errors, not the root 
causes, and it's impossible to determine what the cause may have been. 
Please post the complete rabbit and sasl logs from all nodes. Or at 
least the *first* few errors from all nodes.

Regards,

Matthias.

From fercascue at gmail.com  Fri Aug 30 12:29:45 2013
From: fercascue at gmail.com (fercascue)
Date: Fri, 30 Aug 2013 04:29:45 -0700 (PDT)
Subject: [rabbitmq-discuss] amqpcpp
Message-ID: <1377862185893-29211.post@n5.nabble.com>

Hi, 

Triying to use amqpcpp with RabbitMQ, i have a problem building the client
example:
"cannot find -lrabbitmq"
I have already installed RabbitMQ server and so on. 

Any idea?
Thanks in advance. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/amqpcpp-tp29211.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tush_mishra at yahoo.co.in  Fri Aug 30 15:09:33 2013
From: tush_mishra at yahoo.co.in (tushmish)
Date: Fri, 30 Aug 2013 07:09:33 -0700 (PDT)
Subject: [rabbitmq-discuss] installation problem - service stops
 automatically, web management console missing
Message-ID: <1377871773361-29229.post@n5.nabble.com>

Hi,

I had installed RabbitMQ 3.1.5 earlier with the default settings on Win 7
enterprise, 64bit. I could see the RabbitMQ service running. I was also able
to run the web management console.

I had also installed R16B01 Windows 64 Bit Binary File, from
http://www.erlang.org/download.html.

Laer, there was a requirement to change it to RabbitMQ  3.0.1. I uninstalled
3.1.5, restarted my system and installed 3.0.1. I could see the RabbitMQ
service running. But on hitting http://localhost:15672, the web management
console didnot appear. Also, the RabbitMQ service goes down every time I
tried to view the web management console.

What am I missing ?

Thanks,
Tushar





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/installation-problem-service-stops-automatically-web-management-console-missing-tp29229.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From viraj.gupte at credorax.com  Fri Aug 30 15:17:10 2013
From: viraj.gupte at credorax.com (Viraj Gupte)
Date: Fri, 30 Aug 2013 07:17:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrading RabbitMQ cluster
Message-ID: <c7f0faa0-cd47-4d02-a2c3-03f542455266@googlegroups.com>

I have a two node rabbitmq cluster that runs version 2.8.7 and erlang 
R14B04. I want to upgrade this cluster to RabbitMq 3.1.0 and Erlang R15. 
Few questions:
1. Do I have to backup the mnesia directory present on 2.8.7 version and 
use it when I upgrade to 3.1.0 ?
2. How should I backup the messages present in the queues?

Thanks,
VG
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/c0e30cbb/attachment.htm>

From alan.antonuk at gmail.com  Sat Aug 31 02:47:32 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 30 Aug 2013 18:47:32 -0700
Subject: [rabbitmq-discuss] amqpcpp
In-Reply-To: <1377862185893-29211.post@n5.nabble.com>
References: <1377862185893-29211.post@n5.nabble.com>
Message-ID: <CAAt2po+g=WbQXGGf341HqVVxq-q7WOJNVTOdgs3-hXt0GMyHqw@mail.gmail.com>

amqpcpp is a C++ wrapper around rabbitmq-c.  You need to build and install
rabbitmq-c:

https://github.com/alanxz/rabbitmq-c

-Alan


On Fri, Aug 30, 2013 at 4:29 AM, fercascue <fercascue at gmail.com> wrote:

> Hi,
>
> Triying to use amqpcpp with RabbitMQ, i have a problem building the client
> example:
> "cannot find -lrabbitmq"
> I have already installed RabbitMQ server and so on.
>
> Any idea?
> Thanks in advance.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/amqpcpp-tp29211.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130830/9fbf1dfb/attachment.htm>

From michael at rabbitmq.com  Sat Aug 31 10:37:54 2013
From: michael at rabbitmq.com (Michael Klishin)
Date: Sat, 31 Aug 2013 13:37:54 +0400
Subject: [rabbitmq-discuss] Upgrading RabbitMQ cluster
In-Reply-To: <c7f0faa0-cd47-4d02-a2c3-03f542455266@googlegroups.com>
References: <c7f0faa0-cd47-4d02-a2c3-03f542455266@googlegroups.com>
Message-ID: <4E9B245D-F889-4CE9-9530-2B6DB8C256AA@rabbitmq.com>

Viraj Gupte:

> 1. Do I have to backup the mnesia directory present on 2.8.7 version and use it when I upgrade to 3.1.0 ?

Doing a backup is a good idea. The original directory will be used to perform any upgrades
necessary.

> 2. How should I backup the messages present in the queues?

Stop the node and back up the entire Mnesia directory (message store keeps files under it).

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130831/b619684f/attachment.pgp>

From mahi.rabbitmq at gmail.com  Sat Aug 31 23:26:59 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Sat, 31 Aug 2013 15:26:59 -0700
Subject: [rabbitmq-discuss] cluster setup not working
Message-ID: <CAGOpLV5wviABdYVZBwGD=5SVh_CdBGCX4Q-s=bCuo8+eE_u7Ow@mail.gmail.com>

Hi

These are the steps performed for cluster.

1. I installed on two server A and B
2. Took from A .erlang.cookie file and placed in B

Executed steps in server B

/rabbitmqctl stop_app
 ./rabbitmqctl reset
 ./rabbitmqctl join_cluster --ram rabbit at B
 ./rabbitmqctl start_app
./rabbitmqctl cluster_status

Cluster was successful.

I wrote a sample program to publish message and given connection details of
server A ( Server A is down.)

java.net.ConnectException: Connection refused: connect
at java.net.DualStackPlainSocketImpl.connect0(Native Method)
at
java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:79)
at
java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
at
java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
at
java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172)
at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
at java.net.Socket.connect(Socket.java:579)

And my assumption is should publish to server B because in cluster setup up
and running.


Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130831/e5813a77/attachment.htm>

From colin.webber at freedomit.co.za  Sat Aug 31 10:10:35 2013
From: colin.webber at freedomit.co.za (Colin Webber)
Date: Sat, 31 Aug 2013 02:10:35 -0700 (PDT)
Subject: [rabbitmq-discuss] ReferenceError: filter_ui is not defined (after
	upgrade)
Message-ID: <d763038c-972e-49ab-9817-22a1442bfc42@googlegroups.com>

I upgraded from v3.0.2 to v3.1.5 using apt-get upgrade on Ubuntu 10.04. 
 The upgrade was reported as successful, however now in the web management 
console only the Overview page can be accessed.  Attempting to navigate to 
other pages results in the following error being displayed at the bottom of 
the web page:

ReferenceError: filter_ui is not defined

Also, it appears that the

Are there other steps I need to follow for the upgrade to complete?  Any 
advice would be appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130831/94b05fd6/attachment.htm>

